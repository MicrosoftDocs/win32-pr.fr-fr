---
description: Un demandeur doit avoir une compréhension bien définie de l’état de l’enregistreur qui y participe pendant la création de clichés instantanés, ainsi que pendant les opérations de sauvegarde et de restauration.
ms.assetid: 676d5cff-bd28-43f0-a402-d184c96f0061
title: Détermination de l’état de l’enregistreur
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 719322a18808748e92d412c48c7b7628fdac9d51
ms.sourcegitcommit: 70f39ec77d19d3c32c376ee2831753d2cafae41a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/09/2021
ms.locfileid: "104211363"
---
# <a name="determining-writer-status"></a><span data-ttu-id="1338e-103">Détermination de l’état de l’enregistreur</span><span class="sxs-lookup"><span data-stu-id="1338e-103">Determining Writer Status</span></span>

<span data-ttu-id="1338e-104">Un demandeur doit avoir une compréhension bien définie de l’état de l’enregistreur qui y participe pendant la création de clichés instantanés, ainsi que pendant les opérations de sauvegarde et de restauration.</span><span class="sxs-lookup"><span data-stu-id="1338e-104">A requester needs to have a well-defined understanding about the status of the writer that participates with it during shadow copy creation, and during backup and restore operations.</span></span> <span data-ttu-id="1338e-105">Pour ce faire, il est recommandé d’effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="1338e-105">To do so, it is recommended:</span></span>

-   <span data-ttu-id="1338e-106">Les demandeurs utilisent [**IVssBackupComponents :: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents :: GetWriterStatusCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatuscount)et [**IVssBackupComponents :: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).</span><span class="sxs-lookup"><span data-stu-id="1338e-106">Requesters use [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatusCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatuscount), and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).</span></span>
-   <span data-ttu-id="1338e-107">Comme décrit dans [vue d’ensemble du traitement d’une sauvegarde sous VSS](overview-of-processing-a-backup-under-vss.md) et [vue d’ensemble du traitement d’une restauration sous VSS](overview-of-processing-a-restore-under-vss.md), ces méthodes sont particulièrement utiles lorsqu’elles sont appelées dans une séquence de sauvegarde ou de restauration bien définie.</span><span class="sxs-lookup"><span data-stu-id="1338e-107">As described in [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md) and [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md), these methods are most useful when called in a well-defined backup or restore sequence.</span></span> <span data-ttu-id="1338e-108">En général, cela signifie que les enregistreurs doivent être interrogés après qu’un demandeur a terminé l’une de ses tâches et a généré un événement VSS.</span><span class="sxs-lookup"><span data-stu-id="1338e-108">Typically, this means that the writers should be queried after a requester has completed one of its tasks and generated a VSS event.</span></span>

    <span data-ttu-id="1338e-109">Lors du traitement d’une sauvegarde, un demandeur doit interroger un enregistreur à la suite de l’exécution des méthodes suivantes.</span><span class="sxs-lookup"><span data-stu-id="1338e-109">When processing a backup, a requester should query a writer following the completion of the following methods.</span></span> <span data-ttu-id="1338e-110">Les demandeurs doivent appeler [**GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) après avoir appelé [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) pour que la session de l’enregistreur soit définie sur un état terminé.</span><span class="sxs-lookup"><span data-stu-id="1338e-110">Requesters must call [**GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) after calling [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) to cause the writer session to be set to a completed state.</span></span>

    > [!Note]  
    > <span data-ttu-id="1338e-111">Cela n’est nécessaire que sur Windows Server 2008 avec Service Pack 2 (SP2) et versions antérieures.</span><span class="sxs-lookup"><span data-stu-id="1338e-111">This is only necessary on Windows Server 2008 with Service Pack 2 (SP2) and earlier.</span></span>

     

    <dl> <dt>

[<span data-ttu-id="1338e-112">**IVssBackupComponents ::P repareForBackup**</span><span class="sxs-lookup"><span data-stu-id="1338e-112">**IVssBackupComponents::PrepareForBackup**</span></span>](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)
</dt> <dt>

[<span data-ttu-id="1338e-113">**IVssBackupComponents ::D oSnapshotSet**</span><span class="sxs-lookup"><span data-stu-id="1338e-113">**IVssBackupComponents::DoSnapshotSet**</span></span>](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)
</dt> <dt>

[<span data-ttu-id="1338e-114">**IVssBackupComponents::BackupComplete**</span><span class="sxs-lookup"><span data-stu-id="1338e-114">**IVssBackupComponents::BackupComplete**</span></span>](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete)
</dt> </dl>

<span data-ttu-id="1338e-115">Pendant les opérations de restauration, un demandeur doit interroger un enregistreur après avoir terminé les méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="1338e-115">During restore operations, a requester should query a writer after completion of these methods:</span></span>
<dl> <dt>

[<span data-ttu-id="1338e-116">**IVssBackupComponents ::P Restore**</span><span class="sxs-lookup"><span data-stu-id="1338e-116">**IVssBackupComponents::PreRestore**</span></span>](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)
</dt> <dt>

[<span data-ttu-id="1338e-117">**IVssBackupComponents ::P ostRestore**</span><span class="sxs-lookup"><span data-stu-id="1338e-117">**IVssBackupComponents::PostRestore**</span></span>](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)
</dt> </dl>

-   <span data-ttu-id="1338e-118">Les appels à [**IVssBackupComponents :: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) qui ne font pas partie d’une séquence de sauvegarde ou de restauration bien définie ne fournissent pas une image fiable de l’état de l’enregistreur, car ils peuvent refléter des conditions qui n’indiquent pas d’échec dans l’opération actuelle, par exemple :</span><span class="sxs-lookup"><span data-stu-id="1338e-118">Calls to [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) that are not part of a well-defined backup or restore sequence do not provide a reliable picture of writer status, because they might reflect conditions that do not indicate failure in the current operation, such as:</span></span>
    -   <span data-ttu-id="1338e-119">Échec de la création d’un cliché instantané précédent</span><span class="sxs-lookup"><span data-stu-id="1338e-119">A failure of a previous shadow copy creation</span></span>
    -   <span data-ttu-id="1338e-120">Erreur dans une opération de sauvegarde ou de restauration précoce</span><span class="sxs-lookup"><span data-stu-id="1338e-120">An error in an early backup or restore operation</span></span>
    -   <span data-ttu-id="1338e-121">Un enregistreur qui ne répond pas traite actuellement un événement</span><span class="sxs-lookup"><span data-stu-id="1338e-121">An unresponsive writer currently processing an event</span></span>

<span data-ttu-id="1338e-122">Par conséquent, les développeurs ne doivent pas s’appuyer sur l’état de l’enregistreur renvoyé par des processus autres que le demandeur ou tenter de surveiller la progression d’une instance de l’interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) avec une autre (éventuellement dans un thread distinct).</span><span class="sxs-lookup"><span data-stu-id="1338e-122">Therefore, developers should not rely on writer status returned by processes other then the requester or attempt to monitor the progress of one instance of the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface with another (possibly in a separate thread).</span></span>

<span data-ttu-id="1338e-123">Notez que pour les opérations de sauvegarde, où il est nécessaire d’examiner les documents de métadonnées de l’enregistreur des writers, il n’est pas nécessaire d’appeler [**IVssBackupComponents :: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) et [**IVssBackupComponents :: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) après la génération et la gestion de l’événement d' [*identification*](vssgloss-i.md) provoqué par [**IVssBackupComponents :: GatherWriterMetdata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="1338e-123">Note that for backup operations, where it is necessary to examine writers' Writer Metadata Documents, there is no need for a requester call to [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) following the generation and handling of the [*Identify*](vssgloss-i.md) event caused by [**IVssBackupComponents::GatherWriterMetdata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span>

<span data-ttu-id="1338e-124">[**IVssBackupComponents :: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) signale uniquement l’état des enregistreurs dont les métadonnées ont été fournies à VSS par les rédacteurs [*identifient*](vssgloss-i.md) les gestionnaires d’événements, [**CVssWriter :: OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) (et retournés au demandeur par [**IVssBackupComponents :: GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) et [**IVssBackupComponents :: GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata)).</span><span class="sxs-lookup"><span data-stu-id="1338e-124">[**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) reports only the status of those writers whose metadata was provided to VSS by writers' [*Identify*](vssgloss-i.md) event handlers, [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) (and returned to the requester by [**IVssBackupComponents::GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) and [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata)).</span></span>

<span data-ttu-id="1338e-125">Si l’implémentation d’un writer de [**CVssWriter :: OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) échoue, les métadonnées de ce writer ne feront pas partie de la liste des documents de métadonnées de l’enregistreur fournis à VSS, aucune information d’État n’est disponible et l’appel est redondant.</span><span class="sxs-lookup"><span data-stu-id="1338e-125">If a writer's implementation of [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) fails, that writer's metadata will not be part of the list of Writer Metadata Documents provided to VSS, no status information will be available, and the call would be redundant.</span></span>

<span data-ttu-id="1338e-126">Pour les opérations de restauration, où le demandeur n’a pas besoin d’examiner les documents de métadonnées de l’enregistreur des enregistreurs en cours d’exécution, l’appel de [**IVssBackupComponents :: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) et de [**IVssBackupComponents :: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) peut être un moyen plus efficace de déterminer les writers qui s’exécutent.</span><span class="sxs-lookup"><span data-stu-id="1338e-126">For restore operations, where the requester does not need to examine Writer Metadata Documents of executing writers, calling [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) may be a more efficient way to determine which writers are executing.</span></span>

 

 



