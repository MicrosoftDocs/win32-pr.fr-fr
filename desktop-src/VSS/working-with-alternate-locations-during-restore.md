---
description: Il existe de nombreuses raisons pour lesquelles un demandeur n’est pas autorisé à restaurer les fichiers du support de sauvegarde à leur emplacement d’origine.
ms.assetid: 2a9cfd99-5a2c-4c0c-98ff-11c745298cda
title: Utilisation d’autres emplacements pendant la restauration
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1338d76f98153ccb388e86e738b408c03dd253b4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106514440"
---
# <a name="working-with-alternate-locations-during-restore"></a><span data-ttu-id="45b85-103">Utilisation d’autres emplacements pendant la restauration</span><span class="sxs-lookup"><span data-stu-id="45b85-103">Working with Alternate Locations during Restore</span></span>

<span data-ttu-id="45b85-104">Il existe de nombreuses raisons pour lesquelles un demandeur n’est pas autorisé à restaurer les fichiers du support de sauvegarde à leur emplacement d’origine.</span><span class="sxs-lookup"><span data-stu-id="45b85-104">There are many reasons why a requester either should not, or may not, be able to restore files from backup media to their original location.</span></span> <span data-ttu-id="45b85-105">Par exemple, une méthode ou une cible de restauration peut nécessiter une telle restauration, ou l’emplacement de restauration actuel peut être occupé et non inscriptible.</span><span class="sxs-lookup"><span data-stu-id="45b85-105">For example, a restore method or target may require such a restoration, or the current restoration location may be occupied and unwritable.</span></span>

<span data-ttu-id="45b85-106">Pour gérer ces cas-là, un enregistreur peut avoir défini un [*mappage d’emplacement secondaire*](vssgloss-a.md), une destination de restauration non standard à utiliser pour des circonstances particulières.</span><span class="sxs-lookup"><span data-stu-id="45b85-106">To handle such cases, a writer may have defined an [*alternate location mapping*](vssgloss-a.md), a nonstandard restore destination to be used for special circumstances.</span></span>

<span data-ttu-id="45b85-107">Le terme autre mappage d’emplacement, tel qu’il est utilisé avec VSS, ne doit pas être confondu avec le terme [*autre chemin*](vssgloss-a.md).</span><span class="sxs-lookup"><span data-stu-id="45b85-107">The term alternate location mapping, as used with VSS, should not be confused with the term [*alternate path*](vssgloss-a.md).</span></span> <span data-ttu-id="45b85-108">Les mappages d’emplacements alternatifs sont utilisés uniquement pendant les opérations de restauration et font référence à une autre destination pour les opérations de restauration.</span><span class="sxs-lookup"><span data-stu-id="45b85-108">Alternate location mappings are used only during restore operations, and refer to an alternate destination for restore operations.</span></span> <span data-ttu-id="45b85-109">Les chemins d’accès alternatifs sont utilisés uniquement pendant les opérations de sauvegarde et font référence à une autre source à partir de laquelle effectuer la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="45b85-109">Alternate paths are used only during backup operations, and refer to an alternate source from which to back up.</span></span>

<span data-ttu-id="45b85-110">Pour utiliser d’autres mappages d’emplacements pendant la restauration, un demandeur effectue les opérations suivantes (généralement après la génération d’un événement de [**prérestauration**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ) :</span><span class="sxs-lookup"><span data-stu-id="45b85-110">To use alternate location mappings during restore, a requester would do the following (typically following the generation of a [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event):</span></span>

1.  <span data-ttu-id="45b85-111">À l’aide d’une instance de l’interface [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) obtenue en extrayant un writer stocké, un demandeur utilise la méthode [**IVssExamineWriterMetadata :: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) pour obtenir les mappages d’emplacement de remplacement d’un writer en tant qu’instances de l’interface [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) .</span><span class="sxs-lookup"><span data-stu-id="45b85-111">Using an instance of the [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) interface obtained by retrieving a stored writer, a requester uses the [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) method to obtain a writer's alternate location mappings as instances of the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) interface.</span></span>

    > [!Note]  
    > <span data-ttu-id="45b85-112">Le demandeur utilise [**IVssExamineWriterMetadata :: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), et non [**IVssComponent :: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="45b85-112">The requester uses [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), not [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span> <span data-ttu-id="45b85-113">La première retourne les mappages d’emplacements secondaires pouvant être utilisés par un demandeur.</span><span class="sxs-lookup"><span data-stu-id="45b85-113">The former returns those alternate location mappings available for use by a requester.</span></span> <span data-ttu-id="45b85-114">Ce dernier est utilisé pour indiquer les autres mappages d’emplacements réellement utilisés par un demandeur.</span><span class="sxs-lookup"><span data-stu-id="45b85-114">The latter is used to indicate those alternate location mappings actually used by a requester.</span></span>

     

2.  <span data-ttu-id="45b85-115">L’appel à [**IVssExamineWriterMetadata :: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) retourne une instance de l’interface [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) .</span><span class="sxs-lookup"><span data-stu-id="45b85-115">The call to the [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) returns an instance of the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) interface.</span></span> <span data-ttu-id="45b85-116">Cette instance contient des informations sur le jeu de fichiers (un chemin d’accès spécifié par [**IVssWMFiledesc :: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), une spécification de fichier retournée via [**IVssWMFiledesc :: GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)et un indicateur de récurrence obtenu de [**IVssWMFiledesc :: GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive), correspondant à l’un des jeux de fichiers ajoutés (à l’aide [](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)de [**IVssCreateWriterMetadata :: AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata :**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)</span><span class="sxs-lookup"><span data-stu-id="45b85-116">This instance contains file set information—a path specified by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), a file specification returned through [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and a recursion flag obtained from [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)—matching one of the file sets added (using [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) to one of the components managed by the writer.</span></span>

    <span data-ttu-id="45b85-117">La valeur retournée par [**IVssWMFiledesc :: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) est le mappage d’emplacement de remplacement pour ce jeu de fichiers.</span><span class="sxs-lookup"><span data-stu-id="45b85-117">The value returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) is the alternate location mapping for this file set.</span></span>

3.  <span data-ttu-id="45b85-118">Les mappages d’emplacements secondaires ne contiennent pas d’informations sur les composants. il est donc nécessaire de comparer les informations sur le jeu de fichiers (chemin d’accès, spécification de fichier et indicateur de récurrence) obtenues en appelant [**IVssExamineWriterMetadata :: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) à celles contenues dans les composants du writer.</span><span class="sxs-lookup"><span data-stu-id="45b85-118">Alternate location mappings do not contain component information, so it will be necessary to compare the file set information (path, file specification, and recursion flag) obtained by calling [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) to that contained by the writer's components.</span></span>

    <span data-ttu-id="45b85-119">Vous pouvez trouver ces informations en effectuant une itération sur les composants du writer et en appelant [**IVssExamineWriterMetadata :: GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) pour obtenir une instance de l’interface [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) et utiliser [**IVssWMComponent :: GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) pour obtenir une instance [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) contenant les informations sur le jeu de fichiers du composant.</span><span class="sxs-lookup"><span data-stu-id="45b85-119">This information can be found by iterating over the writer's components and calling [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) to get an instance of the [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) interface and use [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) to obtain a [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) instance containing the component file set information.</span></span>

    <span data-ttu-id="45b85-120">Lorsque les informations sur le jeu de fichiers retournées par l’instance de [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) obtenue à partir de [**IVssExamineWriterMetadata :: GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) et [**IVssWMComponent :: GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) correspondent à celles obtenues à partir de l’instance **IVssWMFiledesc** dérivée de [**IVssWMFiledesc :: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation), le composant qui gère les fichiers avec le mappage d’emplacement de substitution spécifique a été trouvé.</span><span class="sxs-lookup"><span data-stu-id="45b85-120">When the file set information returned by the instance of [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) obtained from [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) and [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) matches that obtained from the **IVssWMFiledesc** instance derived from [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation), the component managing the files with the specific alternate location mapping has been found.</span></span>

4.  <span data-ttu-id="45b85-121">Une fois le composant localisé, le demandeur peut déterminer les conditions dans lesquelles un autre mappage d’emplacement doit être utilisé en procédant comme suit :</span><span class="sxs-lookup"><span data-stu-id="45b85-121">Having located the component, the requester can determine the conditions under which an alternate location mapping should be used by doing the following:</span></span>

    -   <span data-ttu-id="45b85-122">Examen de la méthode de restauration du composant, obtenue en appelant [**IVssExamineWriterMetadata :: GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span><span class="sxs-lookup"><span data-stu-id="45b85-122">Examining the component's restore method, which is obtained by calling [**IVssExamineWriterMetadata::GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span></span>
    -   <span data-ttu-id="45b85-123">Vérification pour déterminer si une cible de restauration remplace la méthode Restore, en appelant [**IVssComponent :: GetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget).</span><span class="sxs-lookup"><span data-stu-id="45b85-123">Checking to see if a restore target overrides the restore method, by calling [**IVssComponent::GetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget).</span></span>

        <span data-ttu-id="45b85-124">Si le composant trouvé dans le document de métadonnées du writer avait été [*explicitement inclus*](vssgloss-e.md) dans la sauvegarde, l’instance de l’interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondra à ce composant.</span><span class="sxs-lookup"><span data-stu-id="45b85-124">If the component found in the Writer Metadata Document had been [*explicitly included*](vssgloss-e.md) in the backup, the instance of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface will correspond to that component.</span></span> <span data-ttu-id="45b85-125">Si le composant avait été [*implicitement inclus*](vssgloss-i.md) dans la sauvegarde, l’instance de **IVssComponent** correspond au composant définissant le jeu de composants dont le composant dans le document de métadonnées de writer est un sous-composant.</span><span class="sxs-lookup"><span data-stu-id="45b85-125">If the component had been [*implicitly included*](vssgloss-i.md) in the backup, then the instance of **IVssComponent** will correspond to the component defining the component set of which the component in the Writer Metadata Document is a subcomponent.</span></span>

5.  <span data-ttu-id="45b85-126">Avec ces informations, le demandeur peut déterminer le composant par composant s’il doit restaurer un jeu de fichiers donné d’un composant donné vers une destination définie par le mappage de l’emplacement secondaire.</span><span class="sxs-lookup"><span data-stu-id="45b85-126">With this information, the requester can determine on a component-by-component basis if it needs to restore a given file set of a given component to a destination defined by the alternate location mapping.</span></span>

6.  <span data-ttu-id="45b85-127">Lors de l’utilisation d’un mappage d’emplacement secondaire, le demandeur respecte le descripteur de fichier et l’indicateur récursif du jeu de fichiers et utilise le chemin d’accès fourni par le mappage de l’emplacement secondaire.</span><span class="sxs-lookup"><span data-stu-id="45b85-127">When using an alternate location mapping, the requester respects the file set's file descriptor and recursive flag and uses the path provided by the alternate location mapping.</span></span>

    <span data-ttu-id="45b85-128">Le demandeur indique qu’il a utilisé un autre mappage d’emplacement au cours d’une opération de restauration en appelant [**IVssBackupComponents :: AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping) avec les informations d’emplacement par défaut du jeu de fichiers, l’autre destination de restauration utilisée et un nom de composant.</span><span class="sxs-lookup"><span data-stu-id="45b85-128">The requester indicates that it has used an alternate location mapping during a restore operation by calling the [**IVssBackupComponents::AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping) with the file set's default location information, the alternate restore destination used, and a component name.</span></span>

    <span data-ttu-id="45b85-129">Si le jeu de fichiers a été géré par un composant qui a été explicitement inclus dans la sauvegarde, le nom de ce composant sera utilisé.</span><span class="sxs-lookup"><span data-stu-id="45b85-129">If the file set was managed by a component that was explicitly included in the backup, that component name will be used.</span></span> <span data-ttu-id="45b85-130">Si le jeu de fichiers a été géré par un composant qui a été implicitement inclus dans la sauvegarde, le nom utilisé correspond à celui du composant qui définit le jeu de composants dont le composant qui gère le jeu de fichiers est un sous-composant.</span><span class="sxs-lookup"><span data-stu-id="45b85-130">If the file set was managed by a component that was implicitly included in the backup, then the name used will be that of the component defining the component set of which the component managing the file set is a subcomponent.</span></span>

<span data-ttu-id="45b85-131">Les enregistreurs vérifient si les jeux de fichiers de l’un de leurs composants ont été restaurés dans un autre mappage d’emplacement en appelant [**IVssComponent :: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="45b85-131">Writers verify whether file sets from one of their components were restored to an alternate location mapping by calling [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>

 

 



