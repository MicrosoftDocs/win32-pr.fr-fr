---
description: Il est possible qu’une application de sauvegarde (demandeur) se termine et ne génère pas d’événement BackupComplete.
ms.assetid: 8e6a1f4f-ba62-46ea-965e-b0c6526ece89
title: Gestion des événements BackupShutdown
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 939e8e64ca9ee463b0b8331e607f8068c3325d5c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106519646"
---
# <a name="handling-backupshutdown-events"></a><span data-ttu-id="2ea47-103">Gestion des événements BackupShutdown</span><span class="sxs-lookup"><span data-stu-id="2ea47-103">Handling BackupShutdown Events</span></span>

<span data-ttu-id="2ea47-104">Il est possible qu’une application de sauvegarde (demandeur) se termine et ne génère pas d’événement [*BackupComplete*](vssgloss-b.md) .</span><span class="sxs-lookup"><span data-stu-id="2ea47-104">It is possible for a backup application (requester) to terminate and not generate a [*BackupComplete*](vssgloss-b.md) event.</span></span> <span data-ttu-id="2ea47-105">L’application de sauvegarde peut se bloquer ou être arrêtée (à partir du gestionnaire des tâches, par exemple) et ne pas être en mesure d’appeler [**IVssBackupComponents :: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span><span class="sxs-lookup"><span data-stu-id="2ea47-105">The backup application could crash, or be terminated (from the Task Manager, for example) and not be able to call [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>

<span data-ttu-id="2ea47-106">Par conséquent, l’infrastructure VSS (plutôt que le demandeur) génère un événement [*BackupShutdown*](vssgloss-b.md) chaque fois qu’une instance de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) participant à une sauvegarde est libérée, qu’elle soit libérée par le demandeur ou par le système.</span><span class="sxs-lookup"><span data-stu-id="2ea47-106">Therefore, the VSS infrastructure (rather than the requester) generates a [*BackupShutdown*](vssgloss-b.md) event whenever an instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) participating in a backup is released, whether it is released by the requester or by the system.</span></span>

<span data-ttu-id="2ea47-107">Si une sauvegarde se déroule correctement, un enregistreur reçoit un événement BackupComplete suivi d’un événement BackupShutdown.</span><span class="sxs-lookup"><span data-stu-id="2ea47-107">If a backup proceeds properly, a writer will receive a BackupComplete event followed by a BackupShutdown event.</span></span>

<span data-ttu-id="2ea47-108">Si l’opération est abandonnée (le demandeur génère un [*événement d’abandon*](vssgloss-a.md) en appelant [**IVssBackupComponents :: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) ou échoue brusquement, un enregistreur peut recevoir uniquement un événement BackupShutdown et il peut ne pas recevoir d’autres événements qui effectuent des opérations de nettoyage.</span><span class="sxs-lookup"><span data-stu-id="2ea47-108">If the operation aborts (the requester generates an [*Abort event*](vssgloss-a.md) by calling [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) or fails abruptly, a writer may receive only a BackupShutdown event, and it may not receive other events that perform cleanup operations.</span></span> <span data-ttu-id="2ea47-109">Il revient à un enregistreur de déterminer si un événement BackupShutdown suit une séquence d’événements appropriée, ou représente une défaillance inattendue des opérations de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="2ea47-109">It is up to a writer to determine whether a BackupShutdown event follows a proper sequence of events, or represents an unexpected failure of the backup operations.</span></span>

<span data-ttu-id="2ea47-110">Le gestionnaire d’événements BackupShutdown, [**CVssWriter :: OnBackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown), reçoit l' \_ ID VSS (Guid) du jeu de clichés instantanés de l’opération de sauvegarde en cours d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="2ea47-110">The BackupShutdown event handler, [**CVssWriter::OnBackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown), receives the VSS\_ID (GUID) of the shadow copy set of the backup operation being shut down.</span></span> <span data-ttu-id="2ea47-111">L’enregistreur peut l’utiliser pour déterminer l’opération de sauvegarde en cours d’arrêt, s’il a stocké l’ID du jeu de clichés instantanés pendant sa séquence de sauvegarde (par exemple, à partir de [**CVssWriter :: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze), [**CVssWriter :: OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)ou [**CVssWriter :: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) à l’aide de [**CVssWriter :: GetCurrentSnapshotSetId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid).</span><span class="sxs-lookup"><span data-stu-id="2ea47-111">The writer can use this to determine which backup operation is being shut down, if it has stored the shadow copy set ID during its backup sequence (for example, from within [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze), [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw), or [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) by using [**CVssWriter::GetCurrentSnapshotSetId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid).</span></span>

<span data-ttu-id="2ea47-112">Toutefois, un enregistreur ne doit pas appeler [**CVssWriter :: GetCurrentSnapshotSetId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid) à partir de [**CVssWriter :: OnBackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown).</span><span class="sxs-lookup"><span data-stu-id="2ea47-112">However, a writer should not call [**CVssWriter::GetCurrentSnapshotSetId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid) from within [**CVssWriter::OnBackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown).</span></span> <span data-ttu-id="2ea47-113">En outre, **CVssWriter :: GetCurrentSnapshotSetId** ne peut pas être appelé après le retour de [**CVssWriter :: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) .</span><span class="sxs-lookup"><span data-stu-id="2ea47-113">Also, **CVssWriter::GetCurrentSnapshotSetId** cannot be called after [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) returns.</span></span>

<span data-ttu-id="2ea47-114">Il est possible que le writer soit impliqué dans plusieurs opérations de sauvegarde, et si un événement BackupShutdown est appelé en raison d’un arrêt brutal d’un demandeur, l' \_ ID VSS renvoyé peut être celui d’une autre opération de sauvegarde à laquelle le writer participe.</span><span class="sxs-lookup"><span data-stu-id="2ea47-114">It is possible for the writer to be involved in multiple backup operations, and if a BackupShutdown event is called because of an abrupt shutdown of a requester, the VSS\_ID returned could be that of another backup operation the writer was participating in.</span></span>

 

 



