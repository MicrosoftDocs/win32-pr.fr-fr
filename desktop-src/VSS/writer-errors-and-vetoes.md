---
description: Un enregistreur peut échouer pour de nombreuses raisons de programmation.
ms.assetid: 50eced73-3917-4d7e-96cc-2d793b448738
title: Erreurs d’écriture et veto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c24c15ad10766fc6ec395ed058ab3cb72a689d9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104201452"
---
# <a name="writer-errors-and-vetoes"></a><span data-ttu-id="5b1bc-103">Erreurs d’écriture et veto</span><span class="sxs-lookup"><span data-stu-id="5b1bc-103">Writer Errors and Vetoes</span></span>

<span data-ttu-id="5b1bc-104">Un enregistreur peut échouer pour de nombreuses raisons de programmation.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-104">A writer can fail for numerous programmatic reasons.</span></span> <span data-ttu-id="5b1bc-105">Dans ce cas, l’opération de sauvegarde, de restauration ou de cliché instantané en cours doit être refusée en appelant la méthode [**CVssWriter :: SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure) dans l’une de ses méthodes de gestionnaire (par exemple, [**CVssWriter :: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) ou [**CVssWriter :: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) et en retournant **true**.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-105">When this happens, it should veto the ongoing backup, restore, or shadow copy operation by calling the [**CVssWriter::SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure) method in one of its handler methods (for example, [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) or [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) and returning **TRUE**.</span></span> <span data-ttu-id="5b1bc-106">Elle peut également définir éventuellement une chaîne de message d’erreur en réponse à une condition d’échec dans certaines méthodes de gestionnaire avec les méthodes [**IVssComponentEx :: SetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setprepareforbackupfailuremsg), [**IVssComponentEx :: SetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setpostsnapshotfailuremsg), [**IVssComponent :: SetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setprerestorefailuremsg)et [**IVssComponent :: SetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setpostrestorefailuremsg) .</span><span class="sxs-lookup"><span data-stu-id="5b1bc-106">It can also optionally set an error message string in response to a failure condition in certain handler methods with the [**IVssComponentEx::SetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setprepareforbackupfailuremsg), [**IVssComponentEx::SetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setpostsnapshotfailuremsg), [**IVssComponent::SetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setprerestorefailuremsg), and [**IVssComponent::SetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setpostrestorefailuremsg) methods.</span></span> <span data-ttu-id="5b1bc-107">Le demandeur peut accepter le veto ou poursuivre la sauvegarde, en ignorant le veto.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-107">The requester can accept the veto or continue with the backup, ignoring the veto.</span></span>

<span data-ttu-id="5b1bc-108">Un demandeur doit vérifier l’état de l’enregistreur (à l’aide de [**IVssBackupComponents :: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) et [**IVssBackupComponents :: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)) après chaque événement qu’il génère.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-108">A requester should check the writer status (using [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)) following each event it generates.</span></span>

<span data-ttu-id="5b1bc-109">Dans certains cas, les messages d’erreur peuvent être récupérés à partir de ces échecs (à l’aide des méthodes [**IVssComponentEx :: GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg), [**IVssComponent :: GetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getprerestorefailuremsg), [**IVssComponentEx :: GetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getpostsnapshotfailuremsg)et [**IVssComponent :: GetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpostrestorefailuremsg) ), ou un enregistreur peut choisir de définir des métadonnées (à l’aide de [**IVssComponent :: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata) et [**IVssComponent :: SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) avec les informations d’état d’erreur).</span><span class="sxs-lookup"><span data-stu-id="5b1bc-109">In some cases, error messages can be retrieved from these failures (using the [**IVssComponentEx::GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg), [**IVssComponent::GetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getprerestorefailuremsg), [**IVssComponentEx::GetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getpostsnapshotfailuremsg), and [**IVssComponent::GetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpostrestorefailuremsg) methods), or a writer may choose to set metadata (using [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata) and [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) with error state information).</span></span> <span data-ttu-id="5b1bc-110">Pour obtenir un exemple de code qui montre comment afficher ces messages d’erreur, consultez [**IVssComponentEx :: GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg).</span><span class="sxs-lookup"><span data-stu-id="5b1bc-110">For example code that shows how to view such error messages, see [**IVssComponentEx::GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg).</span></span>

<span data-ttu-id="5b1bc-111">Selon l’état d’erreur, un demandeur ou son opérateur peut redémarrer la sauvegarde et le cliché instantané avec toute modification nécessaire à l’état du travail ou du système de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-111">Depending on the error state, a requester or its operator could restart the backup and shadow copy with any necessary modification to the state of the backup job or system.</span></span>

<span data-ttu-id="5b1bc-112">Par exemple, supposons que [**GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) a retourné ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="5b1bc-112">For example, suppose [**GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) returned the following:</span></span>

-   <span data-ttu-id="5b1bc-113">Service **VSS \_ E \_ WRITERERROR \_ INCONSISTENTSNAPSHOT** suggère qu’un demandeur peut ajouter des volumes supplémentaires au cliché instantané</span><span class="sxs-lookup"><span data-stu-id="5b1bc-113">**VSS\_E\_WRITERERROR\_INCONSISTENTSNAPSHOT** suggests that a requester might add additional volumes to the shadow copy</span></span>
-   <span data-ttu-id="5b1bc-114">Service **VSS \_ E \_ WRITERERROR \_ renouvelable** indique que toute nouvelle tentative sans reconfiguration peut fonctionner.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-114">**VSS\_E\_WRITERERROR\_RETRYABLE** indicates that retrying without reconfiguration might work.</span></span> <span data-ttu-id="5b1bc-115">Si le writer continue à retourner l’erreur après plusieurs tentatives, essayez de redémarrer le service qui héberge l’enregistreur.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-115">If the writer continues to return the error after several retries, try restarting the service that hosts the writer.</span></span> <span data-ttu-id="5b1bc-116">Les Writers suivants sont hébergés dans le service VSS : Registry Writer, éditeur de base de données d’inscription de classe COM+, enregistreur d’optimisation de cliché instantané et Enregistreur ASR (Automated System Recovery).</span><span class="sxs-lookup"><span data-stu-id="5b1bc-116">The following writers are hosted in the VSS service: registry writer, COM+ class registration database writer, shadow copy optimization writer, and Automated System Recovery (ASR) writer.</span></span> <span data-ttu-id="5b1bc-117">Si le writer appartient à une application qui héberge l’enregistreur dans son propre processus, essayez de redémarrer l’application.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-117">If the writer belongs to an application that hosts the writer in its own process, try restarting the application.</span></span>

    <span data-ttu-id="5b1bc-118">**Windows Server 2003 et Windows XP :** Les enregistreurs suivants sont hébergés dans le service VSS : Registry Writer, l’enregistreur de base de données d’inscription de classe COM+, l’enregistreur des journaux des événements d’application et l’enregistreur Microsoft SQL Server 2000 Desktop Engine (MSDE).</span><span class="sxs-lookup"><span data-stu-id="5b1bc-118">**Windows Server 2003 and Windows XP:** The following writers are hosted in the VSS service: registry writer, COM+ class registration database writer, application event log writer, and Microsoft SQL Server 2000 Desktop Engine (MSDE) writer.</span></span>

-   <span data-ttu-id="5b1bc-119">\_ \_ L’état de l’enregistreur VSS E \_ \_ non \_ disponible indique qu’un enregistreur a peut-être atteint le nombre maximal de sessions de sauvegarde et de restauration disponibles et que la nouvelle tentative peut fonctionner lorsque le système est moins occupé.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-119">VSS\_E\_WRITER\_STATUS\_NOT\_AVAILABLE indicates that a writer may have reached the maximum number of available backup and restore sessions, and retrying might work when the system is less busy.</span></span>
-   <span data-ttu-id="5b1bc-120">Service **VSS \_ Le \_ \_** **\_ \_ \_ délai d’expiration** de WRITERERROR OUTOFRESOURCES ou VSS e WRITERERROR peut suggérer une réduction de la charge système avant une nouvelle tentative</span><span class="sxs-lookup"><span data-stu-id="5b1bc-120">**VSS\_E\_WRITERERROR\_OUTOFRESOURCES** or **VSS\_E\_WRITERERROR\_TIMEOUT** might suggest that system load be reduced prior to retrying</span></span>
-   <span data-ttu-id="5b1bc-121">Service **VSS \_ E \_ WRITERERROR non \_ renouvelable** ou l' **enregistreur VSS \_ e \_ \_ ne \_ répondrait probablement pas** une erreur de writer, si bien qu’il n’est pas possible de tenter de sauvegarder ses données avec VSS.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-121">**VSS\_E\_WRITERERROR\_NONRETRYABLE** or **VSS\_E\_WRITER\_NOT\_RESPONDING** would likely indicate a writer error so severe as to preclude trying to back up its data with VSS.</span></span>

<span data-ttu-id="5b1bc-122">En fonction du writer et des composants qui les génèrent, il n’est pas toujours nécessaire pour une application de sauvegarde d’abandonner suite à une erreur de veto ou d’erreur.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-122">Depending on which writer and which components generate them, it is not always necessary for a backup application to abort following a veto or error.</span></span>

<span data-ttu-id="5b1bc-123">Par exemple, un demandeur peut décider que l’intention du cliché instantané est de sauvegarder l’application A et que le veto a été reçu de l’enregistreur pour l’application de sauvegarde B. Dans ce cas, il est parfaitement acceptable de continuer à sauvegarder l’application A tout en ignorant le veto.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-123">For example, a requester may decide that the intent of the shadow copy is to back up application A and the veto has been received from the writer for backup application B. In this case, it is perfectly acceptable to continue to back up application A while ignoring the veto.</span></span>

<span data-ttu-id="5b1bc-124">Voici quelques exemples de refus d’un rédacteur :</span><span class="sxs-lookup"><span data-stu-id="5b1bc-124">The following are examples of a writer veto:</span></span>

-   <span data-ttu-id="5b1bc-125">Le writer veto le processus de création de clichés instantanés lorsqu’il n’a pas pu interrompre ses activités pendant la création du cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-125">The writer vetoes the shadow copy creation process when it could not suspend its activities during the time the shadow copy was being created.</span></span> <span data-ttu-id="5b1bc-126">Cela indique qu’il y a une forte probabilité que le cliché instantané ne soit pas valide, car une opération d’écriture s’est produite pendant l’état de blocage.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-126">This indicates that there is a high probability that the shadow copy is not valid because a write operation has occurred during the Freeze state.</span></span>
-   <span data-ttu-id="5b1bc-127">Une application de sauvegarde a demandé un cliché instantané du volume C : et un enregistreur détermine qu’un cliché instantané de C : et D : est de sauvegarder ses données.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-127">A backup application has requested a shadow copy of only volume C: and a writer determines that a shadow copy of C: and D: is to back up its data.</span></span> <span data-ttu-id="5b1bc-128">Dans ce cas, l’enregistreur est refusé.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-128">In this case, the writer will veto.</span></span> <span data-ttu-id="5b1bc-129">L’application de sauvegarde peut examiner les métadonnées et déterminer si le writer sera ignoré ou si le processus de création de clichés instantanés sera abandonné et redémarré ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="5b1bc-129">The backup application may examine the metadata and determine whether the writer will be ignored or the shadow copy creation process will be aborted and later restarted.</span></span>

 

 



