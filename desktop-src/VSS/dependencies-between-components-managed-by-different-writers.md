---
description: Dans certains cas, les données d’un enregistreur dépendent de données gérées par un autre writer. Dans ce cas, vous devez sauvegarder ou restaurer les données à partir des deux enregistreurs.
ms.assetid: 0413c289-74b7-4e83-a227-00bfb264e56e
title: Dépendances entre les composants gérés par différents Writers
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91ba3be6a2c2f0a722c4c5f06ca95351e004e1cd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104320685"
---
# <a name="dependencies-between-components-managed-by-different-writers"></a><span data-ttu-id="e6ddb-104">Dépendances entre les composants gérés par différents Writers</span><span class="sxs-lookup"><span data-stu-id="e6ddb-104">Dependencies between Components Managed by Different Writers</span></span>

<span data-ttu-id="e6ddb-105">Dans certains cas, les données d’un enregistreur dépendent de données gérées par un autre writer.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-105">There are situations where data from one writer depends on data managed by another writer.</span></span> <span data-ttu-id="e6ddb-106">Dans ce cas, vous devez sauvegarder ou restaurer les données à partir des deux enregistreurs.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-106">In these cases, you should back up or restore data from both writers.</span></span>

<span data-ttu-id="e6ddb-107">VSS gère ce problème à l’aide de la notion de dépendance explicite du composant Writer et de l’interface [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) .</span><span class="sxs-lookup"><span data-stu-id="e6ddb-107">VSS handles this problem through the notion of an explicit writer-component dependency and the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface.</span></span>

<span data-ttu-id="e6ddb-108">Un enregistreur ajoute une ou plusieurs dépendances lors de la création du document de métadonnées de l’enregistreur à l’aide de la méthode [**IVssCreateWriterMetadata :: AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) .</span><span class="sxs-lookup"><span data-stu-id="e6ddb-108">A writer adds one or more dependencies while creating the Writer Metadata Document using the [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) method.</span></span> <span data-ttu-id="e6ddb-109">Le writer passe à la méthode le nom et le chemin d’accès logique du composant dépendant (qu’il gère), ainsi que le nom et le chemin d’accès logique et l' [*ID de classe du writer*](vssgloss-w.md) (GUID identifiant la classe) du composant dont il dépend.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-109">The writer passes the method the name and logical path of the dependent component (which it manages), as well as the name and logical path and the [*writer class ID*](vssgloss-w.md) (the GUID identifying the class) of the component upon which it depends.</span></span>

<span data-ttu-id="e6ddb-110">Une fois établie, cette dépendance informe le demandeur qu’au cours d’une opération de sauvegarde ou de restauration, le composant dépendant et les cibles de ses dépendances doivent participer.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-110">Once established, this dependency informs the requester that during any backup or restore operation both the dependent component and the targets of its dependencies must participate.</span></span>

<span data-ttu-id="e6ddb-111">Un composant donné peut avoir plusieurs dépendances, ce qui nécessite qu’il et toutes ses cibles dépendantes participent à la sauvegarde et à la restauration.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-111">A given component can have multiple dependencies, which requires that it and all its dependent targets participate in the backup and restore together.</span></span>

<span data-ttu-id="e6ddb-112">Le composant dépendant et/ou la ou les cibles de ses dépendances peuvent être inclus [*explicitement*](vssgloss-e.md) ou [*implicitement*](vssgloss-i.md) dans une opération de sauvegarde ou de restauration.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-112">The dependent component and/or the target(s) of its dependencies can be included either [*explicitly*](vssgloss-e.md) or [*implicitly*](vssgloss-i.md) in a backup or restore operations.</span></span>

<span data-ttu-id="e6ddb-113">Le mécanisme de dépendance du composant d’écriture explicite ne doit pas être utilisé pour créer une dépendance entre deux composants sur le même Writer.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-113">The explicit writer component dependency mechanism should not be used to create a dependency between two components on the same writer.</span></span> <span data-ttu-id="e6ddb-114">Les règles de sélection peuvent fournir la même fonctionnalité plus efficacement sans risque de dépendances circulaires.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-114">The selection rules can supply the same functionality more efficiently without risk of circular dependencies.</span></span>

<span data-ttu-id="e6ddb-115">Par exemple, [**IVssCreateWriterMetadata :: AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) peut être utilisé pour définir la dépendance du composant writerData (avec le chemin d’accès logique « ») de l’enregistreur MyWriter sur le composant internetData (avec le chemin d’accès logique «Connections ») d’un writer nommé InternetConnector avec un ID de classe de writer X. (même s’il est possible que plusieurs rédacteurs ayant le même ID de classe se trouvent simultanément sur le système, la confusion est évitée car la combinaison du chemin d’accès logique et du nom du composant est unique sur le système sous VSS.)</span><span class="sxs-lookup"><span data-stu-id="e6ddb-115">As an example, [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) could be used to define the dependency of the component writerData (with logical path "") of the writer MyWriter on component internetData (with a logical path of "Connections") of a writer named InternetConnector with a writer Class ID X. (While it is possible for multiple writers with the same class ID to be on the system simultaneously, confusion will be avoided because the combination of logical path and component name is unique on the system under VSS.)</span></span>

<span data-ttu-id="e6ddb-116">Un enregistreur ajoute plusieurs dépendances à un composant donné simplement en appelant [**IVssCreateWriterMetadata :: AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) répété avec des composants différents de rédacteurs différents.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-116">A writer adds multiple dependencies to a given component simply by calling [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) repeated with different components from different writers.</span></span> <span data-ttu-id="e6ddb-117">Vous pouvez trouver le nombre d’autres composants dont dépend un composant donné en examinant le membre **cDependencies** de la structure [**VSS \_ COMPONENTINFO**](/windows/desktop/api/VsBackup/ns-vsbackup-vss_componentinfo) .</span><span class="sxs-lookup"><span data-stu-id="e6ddb-117">The number of other components a given component depends on can be found by examining the **cDependencies** member of the [**VSS\_COMPONENTINFO**](/windows/desktop/api/VsBackup/ns-vsbackup-vss_componentinfo) structure.</span></span>

<span data-ttu-id="e6ddb-118">Un rédacteur ou un demandeur récupère des instances de l’interface [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) avec [**IVssWMComponent :: GetDependency**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdependency).</span><span class="sxs-lookup"><span data-stu-id="e6ddb-118">A writer or requester retrieves instances of the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface with [**IVssWMComponent::GetDependency**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdependency).</span></span> <span data-ttu-id="e6ddb-119">**IVssWMDependency** retourne le nom du composant, le chemin d’accès logique et l’ID de classe du writer qui gère le composant qui est la cible de la dépendance.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-119">The **IVssWMDependency** returns the component name, logical path, and class ID of the writer managing the component that is the target of the dependency.</span></span>

<span data-ttu-id="e6ddb-120">Le mécanisme de dépendance ne régit pas un ordre de préférence particulier entre le composant dépendant et les cibles de ses dépendances.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-120">The dependency mechanism does not prescribe any particular order of preference between the dependent component and the targets of its dependencies.</span></span> <span data-ttu-id="e6ddb-121">Comme indiqué ci-dessus, toute dépendance indique qu’à chaque fois qu’un composant donné est sauvegardé ou restauré, le ou les composants dont il dépend doivent être également sauvegardés ou restaurés.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-121">As noted above, all a dependency indicates is that whenever a given component is either backed up or restored, the component or components it depends on must be backed up or restored as well.</span></span> <span data-ttu-id="e6ddb-122">L’implémentation exacte de la dépendance est à la discrétion de l’application de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-122">The exact implementation of dependency is at the discretion of the backup application.</span></span>

<span data-ttu-id="e6ddb-123">Par exemple, dans le cas ci-dessus, le composant writerData (chemin logique « ») dépend du composant InternetConnector («connexions » du chemin logique).</span><span class="sxs-lookup"><span data-stu-id="e6ddb-123">For example, in the case above, the component writerData (logical path "") depends on component InternetConnector (logical path "Connections").</span></span> <span data-ttu-id="e6ddb-124">Un demandeur est libre d’interpréter cela de l’une des manières suivantes :</span><span class="sxs-lookup"><span data-stu-id="e6ddb-124">A requester is free to interpret this in either of the following ways:</span></span>

-   <span data-ttu-id="e6ddb-125">Si le composant dépendant, writerData, est sélectionné (implicitement ou explicitement) pour la sauvegarde ou la restauration, le demandeur doit sélectionner (implicitement ou explicitement) la cible de sa dépendance, internetData</span><span class="sxs-lookup"><span data-stu-id="e6ddb-125">If the dependent component, writerData, is selected (implicitly or explicitly) for backup or restore, the requester must select (either implicitly or explicitly) the target of its dependency, internetData</span></span>
-   <span data-ttu-id="e6ddb-126">Si la cible de sa dépendance, internetData, n’est pas sélectionnée pour la sauvegarde, alors le composant dépendant, writerData, ne doit pas être sélectionné.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-126">If the target of its dependency, internetData, is not selected for backup, then the dependent component, writerData, should not be selected.</span></span>

<span data-ttu-id="e6ddb-127">Toutefois, lors du développement de la prise en charge des dépendances, les développeurs de demandeurs doivent savoir qu’il n’existe aucun moyen pour un writer de déterminer si l’un de ses composants est la cible d’une dépendance.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-127">However, when developing support for dependencies, requester developers should be aware that there is no way a writer can determine if one of its components is a target of a dependency.</span></span>

## <a name="declaring-remote-dependencies"></a><span data-ttu-id="e6ddb-128">Déclaration de dépendances distantes</span><span class="sxs-lookup"><span data-stu-id="e6ddb-128">Declaring Remote Dependencies</span></span>

<span data-ttu-id="e6ddb-129">Une application distribuée est une application qui peut être configurée pour utiliser un ou plusieurs ordinateurs à la fois.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-129">A distributed application is an application that can be configured to use one or more computers at a time.</span></span> <span data-ttu-id="e6ddb-130">En règle générale, l’application s’exécute sur un ou plusieurs ordinateurs de serveur d’applications et communique avec (mais peut ne pas s’exécuter sur) un ou plusieurs serveurs de base de données.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-130">Typically the application runs on one or more application server computers and communicates with (but may or may not actually run on) one or more database server computers.</span></span> <span data-ttu-id="e6ddb-131">Cette configuration est parfois appelée déploiement multi-système.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-131">This configuration is sometimes referred to as a multi-system deployment.</span></span> <span data-ttu-id="e6ddb-132">Souvent, la même application peut également être configurée pour s’exécuter sur un seul ordinateur exécutant à la fois un serveur d’applications et un serveur de base de données.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-132">Often the same application can also be configured to run on a single computer that runs both an application server and a database server.</span></span> <span data-ttu-id="e6ddb-133">Une telle configuration est appelée déploiement à système unique.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-133">Such a configuration is called a single-system deployment.</span></span> <span data-ttu-id="e6ddb-134">Dans les deux configurations, le serveur d’applications et le serveur de base de données ont chacun leurs propres enregistreurs VSS indépendants.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-134">In both configurations, the application server and database server each have their own independent VSS writers.</span></span>

<span data-ttu-id="e6ddb-135">Dans un déploiement multi-système, si un composant géré par le writer de l’application dépend d’un composant distant géré par l’enregistreur du serveur de base de données, il s’agit d’une dépendance distante.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-135">In a multi-system deployment, if a component managed by the application's writer depends on a remote component managed by the database server's writer, this is called a remote dependency.</span></span> <span data-ttu-id="e6ddb-136">(Un déploiement de système unique, en revanche, n’a que des dépendances locales.)</span><span class="sxs-lookup"><span data-stu-id="e6ddb-136">(A single-system deployment, in contrast, has only local dependencies.)</span></span>

<span data-ttu-id="e6ddb-137">À titre d’exemple de déploiement multi-système, considérez un serveur d’applications qui utilise un serveur de base de données SQL Server comme un magasin de données.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-137">As an example of a multi-system deployment, consider an application server that uses a SQL Server database server as a data store.</span></span> <span data-ttu-id="e6ddb-138">Les données spécifiques à l’application, y compris les composants WebPart, les fichiers de contenu Web et la métabase IIS, résident sur un ou plusieurs ordinateurs, appelés serveurs Web frontaux.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-138">The application-specific data, which includes the web parts, web content files, and the IIS metabase, resides on one or more computers, called front-end web servers.</span></span> <span data-ttu-id="e6ddb-139">Le magasin de données SQL réel, qui comprend la base de données de configuration et plusieurs bases de données de contenu, réside sur un ou plusieurs autres ordinateurs, appelés serveurs de bases de données principaux.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-139">The actual SQL data store, which includes the Config database and multiple Content databases, resides on one or more other computers, called back-end database servers.</span></span> <span data-ttu-id="e6ddb-140">Chacun des serveurs Web frontaux contient le même contenu et la même configuration spécifiques à l’application.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-140">Each of the front-end web servers contains the same application-specific content and configuration.</span></span> <span data-ttu-id="e6ddb-141">Chacun des serveurs de base de données principaux peut héberger n’importe quelle base de données de contenu ou la base de données de configuration.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-141">Each of the back-end database servers can host any of the Content databases or the Config database.</span></span> <span data-ttu-id="e6ddb-142">Le logiciel d’application s’exécute uniquement sur les serveurs Web frontaux, et non sur les serveurs de base de données.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-142">The application software runs only on the front-end web servers, not on the database servers.</span></span> <span data-ttu-id="e6ddb-143">Dans cette configuration, l’enregistreur VSS de l’application a des dépendances distantes sur les composants gérés par le writer SQL.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-143">In this configuration, the application's VSS writer has remote dependencies on the components managed by the SQL writer.</span></span>

<span data-ttu-id="e6ddb-144">Un enregistreur peut déclarer une dépendance distante en appelant la méthode [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) , en préen ajoutant « \\ \\ *remotecomputername* \\ », où *remotecomputername* est le nom de l’ordinateur sur lequel se trouve le composant distant, et le chemin logique dans le paramètre *wszOnLogicalPath* .</span><span class="sxs-lookup"><span data-stu-id="e6ddb-144">A writer can declare a remote dependency by calling the [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) method, prepending "\\\\*RemoteComputerName*\\", where *RemoteComputerName* is the name of the computer where the remote component resides, to the logical path in the *wszOnLogicalPath* parameter.</span></span> <span data-ttu-id="e6ddb-145">La valeur de *remotecomputername* peut être une adresse IP ou un nom d’ordinateur retourné par la fonction [**GetComputerNameEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getcomputernameexa) .</span><span class="sxs-lookup"><span data-stu-id="e6ddb-145">The value of *RemoteComputerName* can be an IP address or a computer name returned by the [**GetComputerNameEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getcomputernameexa) function.</span></span>

<span data-ttu-id="e6ddb-146">**Windows Server 2003 :** Un enregistreur ne peut pas déclarer de dépendances distantes tant que Windows Server 2003 avec Service Pack 1 (SP1) n’est pas installé.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-146">**Windows Server 2003:** A writer cannot declare remote dependencies until Windows Server 2003 with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="e6ddb-147">Pour identifier une dépendance, un demandeur appelle les méthodes [**GetWriterId**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getwriterid), [**GetLogicalPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getlogicalpath)et [**GetComponentName**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getcomponentname) de l’interface [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) .</span><span class="sxs-lookup"><span data-stu-id="e6ddb-147">To identify a dependency, a requester calls the [**GetWriterId**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getwriterid), [**GetLogicalPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getlogicalpath), and [**GetComponentName**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getcomponentname) methods of the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface.</span></span> <span data-ttu-id="e6ddb-148">Le demandeur doit examiner le nom du composant retourné par **GetComponentName** dans le paramètre *pbstrComponentName* .</span><span class="sxs-lookup"><span data-stu-id="e6ddb-148">The requester must examine the component name that **GetComponentName** returns in the *pbstrComponentName* parameter.</span></span> <span data-ttu-id="e6ddb-149">Si le nom du composant commence par « \\ \\ », le demandeur doit supposer qu’il spécifie une dépendance distante et que le premier composant suivant « \\ \\ » est le *remotecomputername* qui a été spécifié lorsque le writer a appelé [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency).</span><span class="sxs-lookup"><span data-stu-id="e6ddb-149">If the component name begins with "\\\\", the requester must assume that it specifies a remote dependency and that the first component following "\\\\" is the *RemoteComputerName* that was specified when the writer called [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency).</span></span> <span data-ttu-id="e6ddb-150">Si le nom du composant ne commence pas par « \\ \\ », le demandeur doit supposer qu’il spécifie une dépendance locale.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-150">If the component name does not begin with "\\\\", the requester should assume that it specifies a local dependency.</span></span>

<span data-ttu-id="e6ddb-151">S’il existe une dépendance distante, le demandeur doit sauvegarder le composant distant lorsqu’il sauvegarde le composant local.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-151">If there is a remote dependency, the requester must back up the remote component when it backs up the local component.</span></span> <span data-ttu-id="e6ddb-152">Pour sauvegarder le composant distant, le demandeur doit avoir un agent sur l’ordinateur distant et doit lancer la sauvegarde sur l’ordinateur distant.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-152">To back up the remote component, the requester should have an agent on the remote computer and should initiate the backup on the remote computer.</span></span>

## <a name="structuring-remote-dependencies"></a><span data-ttu-id="e6ddb-153">Structuration des dépendances distantes</span><span class="sxs-lookup"><span data-stu-id="e6ddb-153">Structuring Remote Dependencies</span></span>

<span data-ttu-id="e6ddb-154">Il est important de comprendre qu’une dépendance n’est pas un composant dans et de lui-même.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-154">It is important to understand that a dependency is not a component in and of itself.</span></span> <span data-ttu-id="e6ddb-155">Un composant est nécessaire pour contenir la dépendance.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-155">A component is necessary to hold the dependency.</span></span>

<span data-ttu-id="e6ddb-156">Les exemples suivants illustrent deux façons de structurer un ensemble de dépendances.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-156">The following examples show two ways to structure a set of dependencies.</span></span>

``` syntax
Example 1:
    Writer 1
        Component A
            File A
            File B
            Dependency (SQL/MSDE Writer, Component X, "\")
            Dependency (SQL/MSDE Writer, Component Y, "\")

Example 2:
    Writer 2
        Component A
            File A
            File B
        Component B
            Dependency (SQL/MSDE Writer, Component X, "\")
            Dependency (SQL/MSDE Writer, Component Y, "\")
```

<span data-ttu-id="e6ddb-157">Dans l’exemple 1, les dépendances sont détenues par le composant A. Étant donné que seuls les composants peuvent être sélectionnés, et non des fichiers individuels, la structuration des dépendances de composant A nécessiterait que le composant entier, à la fois les fichiers et les dépendances, doive toujours être sauvegardé et restauré ensemble.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-157">In example 1, the dependencies are held by Component A. Because only components can be selected, not individual files, structuring Component A's dependencies this way would require that the entire component, both the files and the dependencies, must always be backed up and restored together.</span></span> <span data-ttu-id="e6ddb-158">Ils ne peuvent pas être sauvegardés ou restaurés individuellement.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-158">They cannot be backed up or restored individually.</span></span>

<span data-ttu-id="e6ddb-159">Dans l’exemple 2, les composants distincts (composants A et B) contiennent chacune des dépendances.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-159">In example 2, separate components (Components A and B) hold each of the dependencies.</span></span> <span data-ttu-id="e6ddb-160">Dans ce cas, les deux composants peuvent être sélectionnés indépendamment, et donc sauvegardés et restaurés indépendamment.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-160">In this case, the two components can be selected independently, and therefore backed up and restored independently.</span></span> <span data-ttu-id="e6ddb-161">La structuration des dépendances de cette façon offre à une application distribuée une plus grande flexibilité dans la gestion de ses dépendances distantes.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-161">Structuring the dependencies this way gives a distributed application much more flexibility in managing its remote dependencies.</span></span>

## <a name="supporting-remote-dependencies"></a><span data-ttu-id="e6ddb-162">Prise en charge des dépendances distantes</span><span class="sxs-lookup"><span data-stu-id="e6ddb-162">Supporting Remote Dependencies</span></span>

<span data-ttu-id="e6ddb-163">Un demandeur peut fournir une prise en charge complète ou partielle des dépendances distantes.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-163">A requester can provide full or partial support for remote dependencies.</span></span>

<span data-ttu-id="e6ddb-164">Pour assurer une prise en charge complète, le demandeur doit effectuer les opérations suivantes au moment de la sauvegarde et de la restauration.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-164">To provide full support, the requester should do the following at backup and restore time.</span></span>

<span data-ttu-id="e6ddb-165">Au moment de la sauvegarde, le demandeur doit démarrer la sauvegarde sur l’ordinateur frontal (local), déterminer les dépendances existantes et mettre en attente les tâches de sauvegarde supplémentaires pour capturer les bases de données principales.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-165">At backup time, the requester must start the backup on the front-end (local) computer, determine the dependencies that exist, and spool additional backup jobs to capture the back-end databases.</span></span> <span data-ttu-id="e6ddb-166">Le demandeur doit attendre la fin des tâches de sauvegarde principales sur l’ordinateur distant avant d’appeler les méthodes [**IVssBackupComponents :: SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) et [**IVssBackupComponents :: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) .</span><span class="sxs-lookup"><span data-stu-id="e6ddb-166">The requester must wait until after the back-end backup jobs on the remote computer have completed before calling the [**IVssBackupComponents::SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) and [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) methods.</span></span> <span data-ttu-id="e6ddb-167">Si le demandeur attend que la sauvegarde des composants principaux soit terminée avant d’appeler **BackupComplete**, cela génère une sauvegarde plus facile à récupérer pour un enregistreur qui implémente des améliorations supplémentaires, telles que le verrouillage de la topologie, par exemple, pendant la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-167">If the requester waits until the backup of back-end components is complete before calling **BackupComplete**, this will produce a more easily recoverable backup for a writer that implements additional enhancements—such as topology locking, for example—during the backup.</span></span> <span data-ttu-id="e6ddb-168">La procédure suivante décrit ce que le demandeur doit faire :</span><span class="sxs-lookup"><span data-stu-id="e6ddb-168">The following procedure outlines what the requester should do:</span></span>

1.  <span data-ttu-id="e6ddb-169">Sur l’ordinateur local, le demandeur appelle les méthodes [**IVssBackupComponents :: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**IVssBackupComponents :: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents ::P Repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)et [**IVssBackupComponents ::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) .</span><span class="sxs-lookup"><span data-stu-id="e6ddb-169">On the local computer, the requester calls the [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), and [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) methods.</span></span>
2.  <span data-ttu-id="e6ddb-170">Une fois le cliché instantané local terminé, mais avant la fin de la sauvegarde, le demandeur met en attente les tâches de sauvegarde supplémentaires en envoyant une demande à son agent sur l’ordinateur distant.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-170">After the local shadow copy is completed, but before the backup is completed, the requester spools additional backup jobs by sending a request to its agent on the remote computer.</span></span>
3.  <span data-ttu-id="e6ddb-171">Sur l’ordinateur distant, l’agent du demandeur effectue la séquence de sauvegarde mise en attente en appelant [**InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), [**DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded)et [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span><span class="sxs-lookup"><span data-stu-id="e6ddb-171">On the remote computer, the requester's agent performs the spooled backup sequence by calling [**InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), [**DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded), and [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>
4.  <span data-ttu-id="e6ddb-172">Lorsque l’agent du demandeur a terminé les travaux mis en file d’attente sur l’ordinateur distant, le demandeur termine la séquence de sauvegarde en appelant [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) et [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span><span class="sxs-lookup"><span data-stu-id="e6ddb-172">When the requester's agent has completed the spooled jobs on the remote computer, the requester completes the backup sequence by calling [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) and [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>

<span data-ttu-id="e6ddb-173">Au moment de la restauration, le demandeur doit démarrer la restauration impliquant l’ordinateur frontal (local), sélectionner les composants et leurs dépendances à restaurer, puis envoyer l’événement de [**prérestauration**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) en appelant la méthode de **rerestauration IVssBackupComponents ::P** .</span><span class="sxs-lookup"><span data-stu-id="e6ddb-173">At restore time, the requester must start the restore involving the front-end (local) computer, select the components and their dependencies to be restored, and then send the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event by calling the **IVssBackupComponents::PreRestore** method.</span></span> <span data-ttu-id="e6ddb-174">Le demandeur doit ensuite mettre en file d’attente les travaux de restauration du serveur principal sur l’ordinateur distant et appeler la méthode [**IVssBackupComponents ::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) lorsque les restaurations du serveur principal sont terminées.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-174">The requester should then spool the back-end restore jobs on the remote computer and call the [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) method when the back-end restores are complete.</span></span> <span data-ttu-id="e6ddb-175">Cette exigence confère à l’enregistreur frontal un contrôle accru sur l’expérience de restauration et une meilleure expérience utilisateur d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-175">This requirement gives the front-end writer more control over the restore experience and a better administrator user experience overall.</span></span> <span data-ttu-id="e6ddb-176">Étant donné que les sauvegardes sur chacun des systèmes ne se produisent pas au même point dans le temps, le rédacteur frontal doit effectuer un nettoyage des données principales.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-176">Because the backups across each of the systems do not occur at the same point in time, the front-end writer will need to perform some cleanup of the back-end data.</span></span> <span data-ttu-id="e6ddb-177">Dans l’exemple d’application abordé dans le précédent « déclaration des dépendances distantes », l’enregistreur doit lancer un remappage ou une réindexation de site après la restauration d’une des bases de données principales.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-177">In the example application discussed in the preceding "Declaring Remote Dependencies", the writer should initiate a site remapping or reindexing after a restore of one of the back-end databases has completed.</span></span> <span data-ttu-id="e6ddb-178">Pour ce faire, le rédacteur doit recevoir des événements sur le serveur frontal.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-178">To do this, the writer must receive events on the front-end server.</span></span> <span data-ttu-id="e6ddb-179">La procédure suivante décrit ce que le demandeur doit faire :</span><span class="sxs-lookup"><span data-stu-id="e6ddb-179">The following procedure outlines what the requester should do:</span></span>

1.  <span data-ttu-id="e6ddb-180">Sur l’ordinateur local, le demandeur appelle [**IVssBackupComponents :: InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents :: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) (ou [**IVssBackupComponentsEx :: SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)) et la [**prérestauration**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).</span><span class="sxs-lookup"><span data-stu-id="e6ddb-180">On the local computer, the requester calls [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) (or [**IVssBackupComponentsEx::SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)), and [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).</span></span>
2.  <span data-ttu-id="e6ddb-181">Une fois la phase de [**prérestauration**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) terminée, mais avant le début de la phase [**postRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) , le demandeur met en attente des travaux de restauration supplémentaires en envoyant une demande à son agent sur l’ordinateur distant.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-181">After the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) phase is completed, but before the [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) phase begins, the requester spools additional restore jobs by sending a request to its agent on the remote computer.</span></span>
3.  <span data-ttu-id="e6ddb-182">Sur l’ordinateur distant, l’agent du demandeur effectue les travaux de restauration mis en attente en appelant [**InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore), [**Restore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), [**SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) (ou [**SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)) et [**postRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span><span class="sxs-lookup"><span data-stu-id="e6ddb-182">On the remote computer, the requester's agent performs the spooled restore jobs by calling [**InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore), [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), [**SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) (or [**SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)), and [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>
4.  <span data-ttu-id="e6ddb-183">Lorsque l’agent du demandeur a terminé les travaux mis en file d’attente sur l’ordinateur distant, le demandeur termine la séquence de restauration en appelant [**IVssBackupComponents :: SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) et [**postRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span><span class="sxs-lookup"><span data-stu-id="e6ddb-183">When the requester's agent has completed the spooled jobs on the remote computer, the requester completes the restore sequence by calling [**IVssBackupComponents::SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) and [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>

<span data-ttu-id="e6ddb-184">Pour assurer la prise en charge partielle des dépendances distantes, le demandeur doit suivre les dépendances distantes et les inclure dans le cadre de la sauvegarde, mais le classement des événements sur les systèmes frontaux et principaux, comme détaillé dans les deux procédures précédentes, n’est pas nécessaire.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-184">To provide partial support for remote dependencies, the requester must follow remote dependencies and include them as part of the backup, but the ordering of events on front-end and back-end systems as detailed in the previous two procedures would not be required.</span></span> <span data-ttu-id="e6ddb-185">Pour un demandeur qui implémente uniquement la prise en charge partielle, le demandeur doit faire référence à la documentation sur la sauvegarde/restauration de l’application de Writer pour comprendre quels scénarios peuvent être pris en charge.</span><span class="sxs-lookup"><span data-stu-id="e6ddb-185">For a requester that implements only partial support, the requester should refer to the writer application's backup/restore documentation to understand what scenarios can be supported.</span></span>

 

 
