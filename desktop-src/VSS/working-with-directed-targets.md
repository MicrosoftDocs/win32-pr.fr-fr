---
description: Le mécanisme cible dirigée permet aux rédacteurs de remapper des fichiers au moment de la restauration.
ms.assetid: c0b4ab26-2bb6-4b0f-b837-01057983b49b
title: Utilisation des cibles dirigées
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bd2e15ec873b87030a2d01be69d2c3e5f95a193
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104033996"
---
# <a name="working-with-directed-targets"></a><span data-ttu-id="0dfd6-103">Utilisation des cibles dirigées</span><span class="sxs-lookup"><span data-stu-id="0dfd6-103">Working with Directed Targets</span></span>

<span data-ttu-id="0dfd6-104">Le mécanisme [*cible dirigée*](vssgloss-d.md) permet aux rédacteurs de remapper des fichiers au moment de la restauration.</span><span class="sxs-lookup"><span data-stu-id="0dfd6-104">The [*directed target*](vssgloss-d.md) mechanism allows writers to remap files at restore time.</span></span> <span data-ttu-id="0dfd6-105">Cela permet aux rédacteurs d’effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="0dfd6-105">This allows writers to do the following:</span></span>

-   <span data-ttu-id="0dfd6-106">Spécifiez les nouveaux emplacements cibles (analogues à [**IVssBackupComponents :: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)) du demandeur.</span><span class="sxs-lookup"><span data-stu-id="0dfd6-106">Specify new target locations (analogous to a requester's [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)).</span></span>
-   <span data-ttu-id="0dfd6-107">Récupérez de l’espace disque en restaurant uniquement les parties nécessaires d’un fichier sur le disque, en particulier lors de la sauvegarde d’un fichier à l’aide du mécanisme de [*fichier partiel*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="0dfd6-107">Reclaim disk space by restoring only needed parts of a file to disk, particularly when a file was backed up using the [*partial file*](vssgloss-p.md) mechanism.</span></span>
-   <span data-ttu-id="0dfd6-108">Modifiez le format de fichier pour répondre aux besoins actuels.</span><span class="sxs-lookup"><span data-stu-id="0dfd6-108">Change the file format to meet current needs.</span></span>

<span data-ttu-id="0dfd6-109">Tout fichier à utiliser avec une opération cible dirigée doit avoir une [*cible de restauration*](vssgloss-r.md) de VSS \_ RT \_ dirigée.</span><span class="sxs-lookup"><span data-stu-id="0dfd6-109">Any file to be used with a directed target operation must have a [*restore target*](vssgloss-r.md) of VSS\_RT\_DIRECTED.</span></span>

<span data-ttu-id="0dfd6-110">Une fois qu’un demandeur peut prendre en charge une opération cible dirigée, un enregistreur (lors de la gestion de l’événement de [**prérestauration**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ) utilise [**IVssComponent :: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) pour l’instance de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondant au composant qui gère le fichier (ou le composant qui définit le jeu de composants qui contient le fichier) pour définir la manière dont le fichier doit être remappé lors de la restauration.</span><span class="sxs-lookup"><span data-stu-id="0dfd6-110">Once it has been established that a requester can support a directed target operation, a writer (while handling the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event) uses the [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file) to define how the file is to be remapped on restore.</span></span>

<span data-ttu-id="0dfd6-111">Dans à l’aide de [**IVssComponent :: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget), les enregistreurs spécifient le nom de fichier et le chemin d’accès utilisés pour sauvegarder le fichier, le nom de fichier et le chemin d’accès de sa destination de restauration (ces valeurs peuvent être les mêmes que le nom et le chemin d’accès du fichier d’origine) et les plages de fichiers source et de destination.</span><span class="sxs-lookup"><span data-stu-id="0dfd6-111">In using [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget), writers specify the file name and path used to back up the file, the file name and path of its restore destination (these values can be the same as the original file name and path), and source and destination file ranges.</span></span>

<span data-ttu-id="0dfd6-112">Comme avec les opérations de fichiers partielles, les listes de plages sont des paires d’offsets dans le fichier à sauvegarder (en octets) et la longueur de la section à restaurer (en octets), le décalage et la longueur séparés par un signe deux-points, et chaque paire séparée par une virgule : \*Offset1 \***:**_length1_*_,_* \* Offset2 \***:**_length2_.</span><span class="sxs-lookup"><span data-stu-id="0dfd6-112">As with partial file operations, range lists are pairs of offsets into the file to be backed up (in bytes) and the length of the section to be restored (in bytes), the offset and length being separated by a colon, and each pair separated by a comma: *Offset1\***:**_Length1_*_,_\* \*Offset2\***:**_Length2_.</span></span> <span data-ttu-id="0dfd6-113">Chaque valeur est un entier 64 bits au format hexadécimal ou décimal.</span><span class="sxs-lookup"><span data-stu-id="0dfd6-113">Each value is a 64-bit integer in either hexadecimal or decimal format.</span></span>

<span data-ttu-id="0dfd6-114">Si un enregistreur doit utiliser le mécanisme cible dirigé pour que le demandeur restaure un fichier vers un nouvel emplacement, il aurait appelé [**IVssComponent :: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) avec le nom de fichier et le chemin d’accès d’origine, ainsi que le nouveau nom de fichier et le chemin d’accès et spécifiez les plages de destination source avec un décalage de zéro et une longueur égale à celle de la taille de fichier entière</span><span class="sxs-lookup"><span data-stu-id="0dfd6-114">If a writer needs to use the directed target mechanism to have the requester restore a file to a new location, it would have called [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) with the original file name and path and the new file name and path, and specify source destination ranges with a zero offset and a length equal to that of the entire file size.</span></span>

<span data-ttu-id="0dfd6-115">Par exemple, si un enregistreur doit avoir un fichier de 200 Ko, C : \\ WriterData \\ index. dat, restauré sous la forme c : \\ WriterData \\ OldIndex. dat, la chaîne de la plage source et de destination serait «**0:204880**».</span><span class="sxs-lookup"><span data-stu-id="0dfd6-115">For instance, if a writer needs to have a 200K file, C:\\WriterData\\Index.dat, restored as C:\\WriterData\\OldIndex.dat, the source and destination range string would be "**0:204880**."</span></span>

<span data-ttu-id="0dfd6-116">Pour remapper un fichier de grande taille partiellement sauvegardé, le demandeur utilise la plage source utilisée pour sauvegarder le fichier et une plage de destination qui réduira la taille du fichier.</span><span class="sxs-lookup"><span data-stu-id="0dfd6-116">To remap a large, partially backed-up file, the requester would use the source range used to back up the file and a destination range that will reduce the file size.</span></span> <span data-ttu-id="0dfd6-117">Les informations de la plage source peuvent être obtenues à l’aide de [**IVssComponent :: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) pour l’instance de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondant au composant qui gère le fichier (ou le composant qui définit le jeu de composants qui contient le fichier).</span><span class="sxs-lookup"><span data-stu-id="0dfd6-117">The source range information can be obtained by using [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

<span data-ttu-id="0dfd6-118">Si le fichier partiellement sauvegardé était initialement un fichier volumineux dont l’en-tête, octets 64-512, contient un nombre d’enregistrements et d’autres informations fréquemment mises à jour, et dont les données les plus récentes doivent se trouver dans les 65536 derniers octets du fichier (octets 0x1239E8577A à 0x1239E7577A), un enregistreur peut spécifier une liste de plages sources comme chaîne "**64:448, 0x1239E8577A : 65536**."</span><span class="sxs-lookup"><span data-stu-id="0dfd6-118">If the partially backed-up file was initially a large file whose header, bytes 64-512, contains a records count and other frequently updated information, and whose most recent data is to be found in the file's last 65536 bytes—bytes 0x1239E8577A to 0x1239E7577A, a writer could specify a source range list as the string "**64:448,0x1239E8577A:65536**."</span></span>

<span data-ttu-id="0dfd6-119">Si l’auteur souhaite remapper le fichier restauré pour contenir uniquement l’en-tête et les données les plus récentes, la liste de plages peut être la chaîne «**0:488488:65536**».</span><span class="sxs-lookup"><span data-stu-id="0dfd6-119">If the writer wanted to remap the restored file to contain only the header and most recent data, the range list could be the string "**0:488,488:65536**."</span></span>

<span data-ttu-id="0dfd6-120">Avant d’effectuer une opération de restauration, un demandeur doit vérifier si des fichiers nécessitent une prise en charge cible dirigée.</span><span class="sxs-lookup"><span data-stu-id="0dfd6-120">Prior to actually performing a restore operation, a requester should check to see if any files require directed target support.</span></span>

<span data-ttu-id="0dfd6-121">Pour ce faire, le demandeur itère d’abord sur les enregistreurs avec des composants stockés dans son document composants de sauvegarde à l’aide de [**IVssBackupComponents :: GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) et [**IVssBackupComponents :: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span><span class="sxs-lookup"><span data-stu-id="0dfd6-121">To do this, the requester first iterates over the writers with stored components in its Backup Components Document using [**IVssBackupComponents::GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) and [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span></span>

<span data-ttu-id="0dfd6-122">L’interface [**IVssBackupComponents :: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) est ensuite utilisée pour retourner des instances de l’interface [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , qui fournit les méthodes [**IVssWriterComponentsExt :: GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) et [**IVssWriterComponentsExt :: GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) qui permettent au demandeur d’obtenir des instances [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="0dfd6-122">The [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) interface is then used to return instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, which provides [**IVssWriterComponentsExt::GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) and [**IVssWriterComponentsExt::GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) methods that allow the requester to obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) instances.</span></span>

<span data-ttu-id="0dfd6-123">Cela permet à un demandeur d’obtenir des candidats ciblés à l’aide de [**IVssComponent :: GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) et de [**IVssComponent :: GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) pour l’instance de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondant au composant qui gère le fichier (ou le composant qui définit le jeu de composants qui contient le fichier).</span><span class="sxs-lookup"><span data-stu-id="0dfd6-123">This allows a requester to obtain directed target candidates by using [**IVssComponent::GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) and [**IVssComponent::GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

 

 
