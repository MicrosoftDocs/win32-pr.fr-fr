---
description: En savoir plus sur le rôle d’écriture dans les sauvegardes incrémentielles et différentielles, qui nécessitent une coopération étroite entre les demandeurs et les writers.
ms.assetid: 3cf5dd1f-dc58-42bc-925f-fee7d34053c5
title: Rôle d’écriture dans la sauvegarde de magasins complexes
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30e34952cc4a2184d2f9abcc43283d24f64bdcc3
ms.sourcegitcommit: d0eb44d0a95f5e5efbfec3d3e9c143f5cba25bc3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/17/2021
ms.locfileid: "112262151"
---
# <a name="writer-role-in-backing-up-complex-stores"></a><span data-ttu-id="3116c-103">Rôle d’écriture dans la sauvegarde de magasins complexes</span><span class="sxs-lookup"><span data-stu-id="3116c-103">Writer Role in Backing Up Complex Stores</span></span>

<span data-ttu-id="3116c-104">Comme avec toutes les opérations importantes sous VSS, les sauvegardes [*incrémentielles*](vssgloss-i.md) et [*différentielles*](vssgloss-d.md) requièrent une coopération étroite entre les demandeurs et les rédacteurs.</span><span class="sxs-lookup"><span data-stu-id="3116c-104">As with all important operations under VSS, [*incremental*](vssgloss-i.md) and [*differential*](vssgloss-d.md) backups require close cooperation between requesters and writers.</span></span>

## <a name="backup-types"></a><span data-ttu-id="3116c-105">Types de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="3116c-105">Backup Types</span></span>

<span data-ttu-id="3116c-106">L’infrastructure fournit une prise en charge spéciale de cinq types de sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="3116c-106">The infrastructure provides special support for five types of backup.</span></span> <span data-ttu-id="3116c-107">En voici le détail :</span><span class="sxs-lookup"><span data-stu-id="3116c-107">They are described as follows:</span></span>

-   <span data-ttu-id="3116c-108">Full (**VSS \_ BT \_ complet**).</span><span class="sxs-lookup"><span data-stu-id="3116c-108">Full (**VSS\_BT\_FULL**).</span></span> <span data-ttu-id="3116c-109">Les fichiers seront sauvegardés quelle que soit leur date de dernière sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-109">Files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="3116c-110">L’historique de sauvegarde de chaque fichier est mis à jour, et ce type de sauvegarde peut être utilisé comme base d’une sauvegarde incrémentielle ou différentielle.</span><span class="sxs-lookup"><span data-stu-id="3116c-110">The backup history of each file will be updated, and this type of backup can be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="3116c-111">Si des fichiers journaux sont présents, ils peuvent être tronqués à la suite de cette sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-111">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="3116c-112">La restauration d’une sauvegarde complète nécessite une seule image de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-112">Restoring a full backup requires only a single backup image.</span></span>

-   <span data-ttu-id="3116c-113">Différentielle (**\_ \_ différentielle BT VSS**).</span><span class="sxs-lookup"><span data-stu-id="3116c-113">Differential (**VSS\_BT\_DIFFERENTIAL**).</span></span> <span data-ttu-id="3116c-114">L’API VSS est utilisée pour s’assurer que seuls les fichiers qui ont été modifiés ou ajoutés depuis la dernière sauvegarde complète doivent être copiés sur un support de stockage. toutes les informations de sauvegarde intermédiaires sont ignorées.</span><span class="sxs-lookup"><span data-stu-id="3116c-114">The VSS API is used to ensure that only files that have been changed or added since the last full backup are to be copied to a storage medium; all intermediate backup information is ignored.</span></span> <span data-ttu-id="3116c-115">Cela peut inclure des fichiers entiers ou des plages spécifiques dans des fichiers.</span><span class="sxs-lookup"><span data-stu-id="3116c-115">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="3116c-116">Une sauvegarde différentielle est associée à une sauvegarde complète et ne peut généralement pas être restaurée tant que la sauvegarde complète n’a pas été restaurée.</span><span class="sxs-lookup"><span data-stu-id="3116c-116">A differential backup is associated with a full backup, and generally cannot be restored until the full backup has been restored.</span></span> <span data-ttu-id="3116c-117">Si des fichiers journaux sont présents, ils ne sont généralement pas tronqués à la suite de cette sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-117">If there are log files, they will usually not be truncated as a result of this backup.</span></span>

    <span data-ttu-id="3116c-118">La restauration d’une sauvegarde différentielle nécessite l’image de sauvegarde d’origine et l’image de sauvegarde différentielle la plus récente effectuée depuis la dernière sauvegarde complète.</span><span class="sxs-lookup"><span data-stu-id="3116c-118">Restoring a differential backup requires the original backup image and the most recent differential backup image made since the last full backup.</span></span>

-   <span data-ttu-id="3116c-119">Incrémentiel (**VSS \_ BT \_ incrémentiel**).</span><span class="sxs-lookup"><span data-stu-id="3116c-119">Incremental (**VSS\_BT\_INCREMENTAL**).</span></span> <span data-ttu-id="3116c-120">L’API VSS est utilisée pour s’assurer que seuls les fichiers qui ont été modifiés ou ajoutés depuis la dernière sauvegarde complète ou incrémentielle doivent être copiés sur un support de stockage.</span><span class="sxs-lookup"><span data-stu-id="3116c-120">The VSS API is used to ensure that only files that have been changed or added since the last full or incremental backup are to be copied to a storage medium.</span></span> <span data-ttu-id="3116c-121">Cela peut inclure des fichiers entiers ou des plages spécifiques dans des fichiers.</span><span class="sxs-lookup"><span data-stu-id="3116c-121">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="3116c-122">Certains enregistreurs n’autorisent pas le mélange des sauvegardes incrémentielles avec les sauvegardes différentielles.</span><span class="sxs-lookup"><span data-stu-id="3116c-122">Some writers do not allow incremental backups to be mixed with differential backups.</span></span> <span data-ttu-id="3116c-123">Si des fichiers journaux sont présents, ils peuvent être tronqués à la suite de cette sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-123">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="3116c-124">La restauration d’une sauvegarde incrémentielle nécessite l’image de sauvegarde d’origine et toutes les images de sauvegarde incrémentielles effectuées depuis la sauvegarde initiale.</span><span class="sxs-lookup"><span data-stu-id="3116c-124">Restoring an incremental backup requires the original backup image and all incremental backup images made since the initial backup.</span></span>

-   <span data-ttu-id="3116c-125">Sauvegarde de fichier journal (**\_ \_ Journal BT VSS**).</span><span class="sxs-lookup"><span data-stu-id="3116c-125">Log Backup (**VSS\_BT\_LOG**).</span></span> <span data-ttu-id="3116c-126">Seuls les fichiers journaux d’un enregistreur (fichiers ajoutés à un composant avec la méthode [**IVssCreateWriterMetadata :: AddDataBaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) et récupérés par un appel à [**IVssWMComponent :: GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)) sont sauvegardés.</span><span class="sxs-lookup"><span data-stu-id="3116c-126">Only a writer's log files (files added to a component with the [**IVssCreateWriterMetadata::AddDataBaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) method, and retrieved by a call to [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)) will be backed up.</span></span> <span data-ttu-id="3116c-127">Ce type de sauvegarde est spécifique à VSS.</span><span class="sxs-lookup"><span data-stu-id="3116c-127">This backup type is specific to VSS.</span></span> <span data-ttu-id="3116c-128">Les sauvegardes de fichier journal ont tendance à être effectuées très souvent.</span><span class="sxs-lookup"><span data-stu-id="3116c-128">Log backups tend to be taken quite frequently.</span></span> <span data-ttu-id="3116c-129">En règle générale, le fichier journal est tronqué à la suite de cette sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-129">Typically, the log file will be truncated as a result of this backup.</span></span>
-   <span data-ttu-id="3116c-130">Copie de sauvegarde **( \_ \_ copie de VSS BT**).</span><span class="sxs-lookup"><span data-stu-id="3116c-130">Copy Backup (**VSS\_BT\_COPY**).</span></span> <span data-ttu-id="3116c-131">À l’instar du \_ \_ type de sauvegarde complète VSS BT, les fichiers sont sauvegardés quelle que soit leur date de dernière sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-131">Like the VSS\_BT\_FULL backup type, files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="3116c-132">Toutefois, l’historique de sauvegarde de chaque fichier n’est pas mis à jour et ce type de sauvegarde ne peut pas être utilisé comme base d’une sauvegarde incrémentielle ou différentielle.</span><span class="sxs-lookup"><span data-stu-id="3116c-132">However, the backup history of each file will not be updated, and this type of backup cannot be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="3116c-133">Les fichiers journaux ne doivent jamais être tronqués à la suite d’une sauvegarde de copie.</span><span class="sxs-lookup"><span data-stu-id="3116c-133">Log files should never be truncated as a result of a copy backup.</span></span>

<dl> <dt>

<span data-ttu-id="3116c-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Prise en charge partielle des fichiers</span><span class="sxs-lookup"><span data-stu-id="3116c-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Partial File Support</span></span>
</dt> <dd>

<span data-ttu-id="3116c-135">Certains enregistreurs prennent en charge la restauration de fichiers par le biais du remplacement des parties des fichiers qu’ils gèrent.</span><span class="sxs-lookup"><span data-stu-id="3116c-135">Some writers support file restoration through the overwriting of parts of the files they manage.</span></span> <span data-ttu-id="3116c-136">Un demandeur peut être conçu pour tirer parti de cela et, si tel est le cas, il indique cela en définissant les informations dans [**IVssBackupComponents :: SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span><span class="sxs-lookup"><span data-stu-id="3116c-136">A requester may be designed to take advantage of this, and if so it indicates this by setting the information in [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span>

</dd> </dl>

<span data-ttu-id="3116c-137">Les rédacteurs indiquent le type de sauvegardes prises en charge en appelant [**IVssCreateWriterMetadata :: SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) lors du traitement de l’événement d' [*identification*](vssgloss-i.md) .</span><span class="sxs-lookup"><span data-stu-id="3116c-137">The writers indicate what type of backups are supported by calling [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) while processing the [*Identify*](vssgloss-i.md) event.</span></span> <span data-ttu-id="3116c-138">Le paramètre *dsSchemaMask* de la méthode **IVssCreateWriterMetadata :: SetBackupSchema** est un masque de bits indiquant les types de sauvegarde pris en charge.</span><span class="sxs-lookup"><span data-stu-id="3116c-138">The *dsSchemaMask* parameter to the **IVssCreateWriterMetadata::SetBackupSchema** method is a bit mask indicating what types of backup are supported.</span></span> <span data-ttu-id="3116c-139">Tous les enregistreurs doivent prendre en charge les sauvegardes complètes.</span><span class="sxs-lookup"><span data-stu-id="3116c-139">All writers must support full backups.</span></span>

<dl> <dt>

<span data-ttu-id="3116c-140"><span id="VSS_BS_DIFFERENTIAL"></span><span id="vss_bs_differential"></span>**VSS \_ BS \_ différentiel**</span><span class="sxs-lookup"><span data-stu-id="3116c-140"><span id="VSS_BS_DIFFERENTIAL"></span><span id="vss_bs_differential"></span>**VSS\_BS\_DIFFERENTIAL**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-141">Indique la prise en charge des sauvegardes différentielles.</span><span class="sxs-lookup"><span data-stu-id="3116c-141">Indicates support for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-142"><span id="VSS_BS_INCREMENTAL"></span><span id="vss_bs_incremental"></span>**VSS \_ BS \_ incrémentiel**</span><span class="sxs-lookup"><span data-stu-id="3116c-142"><span id="VSS_BS_INCREMENTAL"></span><span id="vss_bs_incremental"></span>**VSS\_BS\_INCREMENTAL**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-143">Indique la prise en charge des sauvegardes incrémentielles.</span><span class="sxs-lookup"><span data-stu-id="3116c-143">Indicates support for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-144"><span id="VSS_BS_LOG"></span><span id="vss_bs_log"></span>**\_Journal VSS BS \_**</span><span class="sxs-lookup"><span data-stu-id="3116c-144"><span id="VSS_BS_LOG"></span><span id="vss_bs_log"></span>**VSS\_BS\_LOG**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-145">Indique la prise en charge des sauvegardes de fichiers journaux.</span><span class="sxs-lookup"><span data-stu-id="3116c-145">Indicates support for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-146"><span id="VSS_BS_COPY"></span><span id="vss_bs_copy"></span>**\_copie VSS BS \_**</span><span class="sxs-lookup"><span data-stu-id="3116c-146"><span id="VSS_BS_COPY"></span><span id="vss_bs_copy"></span>**VSS\_BS\_COPY**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-147">Indique la prise en charge des sauvegardes de copie.</span><span class="sxs-lookup"><span data-stu-id="3116c-147">Indicates support for copy backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-148"><span id="VSS_BS_EXCLUSIVE_INCREMENTAL_DIFFERENTIAL"></span><span id="vss_bs_exclusive_incremental_differential"></span>**\_ \_ \_ différentielle incrémentielle VSS BS exclusive \_**</span><span class="sxs-lookup"><span data-stu-id="3116c-148"><span id="VSS_BS_EXCLUSIVE_INCREMENTAL_DIFFERENTIAL"></span><span id="vss_bs_exclusive_incremental_differential"></span>**VSS\_BS\_EXCLUSIVE\_INCREMENTAL\_DIFFERENTIAL**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-149">Indique qu’un enregistreur ne prend pas en charge le mélange de sauvegardes incrémentielles avec des sauvegardes différentielles.</span><span class="sxs-lookup"><span data-stu-id="3116c-149">Indicates that a writer does not support mixing incremental backups with differential backups.</span></span>

</dd> </dl>

<span data-ttu-id="3116c-150">Le writer peut déterminer le type de sauvegarde en cours d’exécution en appelant [**CVssWriter :: GetBackupType**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype).</span><span class="sxs-lookup"><span data-stu-id="3116c-150">The writer can determine what type of backup is being performed by calling [**CVssWriter::GetBackupType**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype).</span></span> <span data-ttu-id="3116c-151">Le point le plus à l’origine de cette opération est le traitement de l’événement PrepareForBackup.</span><span class="sxs-lookup"><span data-stu-id="3116c-151">The earliest point when this can be performed is while processing the PrepareForBackup event.</span></span> <span data-ttu-id="3116c-152">**CVssWriter :: GetBackupType** retourne un membre de l’énumération du [**\_ \_ type de sauvegarde VSS**](/windows/desktop/api/Vss/ne-vss-vss_backup_type) .</span><span class="sxs-lookup"><span data-stu-id="3116c-152">**CVssWriter::GetBackupType** will return a member of the [**VSS\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_backup_type) enumeration.</span></span> <span data-ttu-id="3116c-153">Si le type de sauvegarde n’est pas pris en charge par le writer, le writer doit traiter la sauvegarde comme une sauvegarde complète.</span><span class="sxs-lookup"><span data-stu-id="3116c-153">If the backup type is not supported by the writer, then the writer should treat the backup as a full backup.</span></span>

## <a name="backup-stamps"></a><span data-ttu-id="3116c-154">Tampons de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="3116c-154">Backup Stamps</span></span>

<span data-ttu-id="3116c-155">Les sauvegardes incrémentielles et différentielles sont toujours liées à une sauvegarde précédente.</span><span class="sxs-lookup"><span data-stu-id="3116c-155">Incremental and differential backups are always tied to a previous backup.</span></span> <span data-ttu-id="3116c-156">Il existe deux façons de lier des sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="3116c-156">There are two ways to tie backups.</span></span> <span data-ttu-id="3116c-157">Pour les magasins de données simples, le demandeur peut effectuer le suivi de la corrélation entre les sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="3116c-157">For simple data stores, the requester can keep track of the correlation between backups.</span></span> <span data-ttu-id="3116c-158">Toutefois, pour les magasins de données plus complexes, l’enregistreur doit conserver son propre horodatage avec la sauvegarde. cet horodateur peut assurer le suivi de la position du journal, des informations de point de contrôle, etc.</span><span class="sxs-lookup"><span data-stu-id="3116c-158">However, for more complex data stores, the writer will need to maintain its own timestamp with the backup; this timestamp may keep track of log position, checkpoint information, and so on.</span></span> <span data-ttu-id="3116c-159">Un enregistreur indique qu’il a besoin de ses propres horodateurs en définissant le bit **VSS \_ BS \_ horodaté** lorsqu’il appelle [**IVssCreateWriterMetadata :: SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span><span class="sxs-lookup"><span data-stu-id="3116c-159">A writer indicates that it needs its own timestamps by setting the **VSS\_BS\_TIMESTAMPED** bit when it calls [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span></span>

<span data-ttu-id="3116c-160">Un enregistreur peut stocker un horodateur avec chaque composant en cours de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-160">A writer can store a timestamp with each component that is being backed up.</span></span> <span data-ttu-id="3116c-161">L’enregistreur stocke l’horodateur en appelant [**IVssComponent :: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)et en passant une représentation sous forme de chaîne de l’horodatage pour le paramètre *wszBackupStamp* .</span><span class="sxs-lookup"><span data-stu-id="3116c-161">The writer stores the timestamp by calling [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp), and passing in a string representation of the stamp for the *wszBackupStamp* parameter.</span></span> <span data-ttu-id="3116c-162">En règle générale, un enregistreur appellera cette méthode lors du traitement de l’événement [*PostSnapshot*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="3116c-162">Generally, a writer will call this method while processing the [*PostSnapshot*](vssgloss-p.md) event.</span></span> <span data-ttu-id="3116c-163">Toutefois, pour les sauvegardes qui n’impliquent pas de cliché instantané, l’événement PostSnapshot ne sera pas envoyé.</span><span class="sxs-lookup"><span data-stu-id="3116c-163">However, for backups that do not involve a shadow copy, the PostSnapshot event will not be sent.</span></span> <span data-ttu-id="3116c-164">Dans ce cas, **IVssComponent :: SetBackupStamp** doit être appelé lors du traitement de l’événement [*PrepareForBackup*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="3116c-164">In this case, **IVssComponent::SetBackupStamp** must be called while processing the [*PrepareForBackup*](vssgloss-p.md) event.</span></span>

<span data-ttu-id="3116c-165">Lorsqu’une sauvegarde incrémentielle ou différentielle est effectuée, le demandeur indique au writer le tampon de sauvegarde de la sauvegarde précédente qui sert de base pour cette sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-165">When an incremental or differential backup is being performed, the requester will indicate to the writer the backup stamp of the previous backup that is serving as a base for this backup.</span></span> <span data-ttu-id="3116c-166">L’enregistreur peut accéder à ce tampon de sauvegarde précédent lors du traitement de l’événement PrepareForBackup ou PostSnapshot, en appelant [**IVssComponent :: GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="3116c-166">The writer can access this previous backup stamp while processing either the PrepareForBackup or PostSnapshot event, by calling [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span> <span data-ttu-id="3116c-167">Le writer peut utiliser l’horodatage retourné pour déterminer ce qui doit être sauvegardé.</span><span class="sxs-lookup"><span data-stu-id="3116c-167">The writer can use the returned stamp to determine what needs to be backed up.</span></span>

## <a name="backup-strategies"></a><span data-ttu-id="3116c-168">Stratégies de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="3116c-168">Backup Strategies</span></span>

### <a name="file-backup-files-strategies"></a><span data-ttu-id="3116c-169">Stratégies de fichiers de sauvegarde de fichiers</span><span class="sxs-lookup"><span data-stu-id="3116c-169">File Backup Files Strategies</span></span>

<span data-ttu-id="3116c-170">Souvent, certains fichiers signalés dans les métadonnées de l’enregistreur doivent être sauvegardés uniquement lors de l’exécution de certains types de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-170">Often, certain files reported in the writer metadata need only be backed up when performing certain types of backup.</span></span> <span data-ttu-id="3116c-171">Certains fichiers peuvent être requis uniquement lorsque vous effectuez une sauvegarde complète.</span><span class="sxs-lookup"><span data-stu-id="3116c-171">Some files may only be required when performing a full backup.</span></span> <span data-ttu-id="3116c-172">D’autres fichiers peuvent uniquement être requis lors de l’exécution d’une sauvegarde incrémentielle ou différentielle.</span><span class="sxs-lookup"><span data-stu-id="3116c-172">Other files may only be required when performing an incremental or differential backup.</span></span> <span data-ttu-id="3116c-173">VSS fournit une méthode permettant aux rédacteurs d’indiquer ces informations au demandeur.</span><span class="sxs-lookup"><span data-stu-id="3116c-173">VSS provides a method for the writers to indicate this information to the requester.</span></span> <span data-ttu-id="3116c-174">Lors de l’ajout de fichiers à des composants à l’aide de [**IVssCreateWriterMetadata :: AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata :: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)ou [**IVssCreateWriterMetadata :: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), le paramètre *dwBackupTypeMask* indique pour quels types de sauvegarde ces fichiers doivent être sauvegardés.</span><span class="sxs-lookup"><span data-stu-id="3116c-174">When adding files to components using [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), the *dwBackupTypeMask* parameter indicates for which backup types these files must be backed up.</span></span> <span data-ttu-id="3116c-175">Le masque peut contenir une ou plusieurs des valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="3116c-175">The mask can contain one or more of the following values:</span></span>

<dl> <dt>

<span data-ttu-id="3116c-176"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**\_ \_ sauvegarde complète VSS \_ FSBT \_ requise**</span><span class="sxs-lookup"><span data-stu-id="3116c-176"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-177">Requis pour les sauvegardes complètes.</span><span class="sxs-lookup"><span data-stu-id="3116c-177">Required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-178"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**\_ \_ sauvegarde différentielle FSBT \_ VSS \_ requise**</span><span class="sxs-lookup"><span data-stu-id="3116c-178"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-179">Requis pour les sauvegardes différentielles.</span><span class="sxs-lookup"><span data-stu-id="3116c-179">Required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-180"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**\_sauvegarde VSS FSBT \_ \_ \_ requise**</span><span class="sxs-lookup"><span data-stu-id="3116c-180"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**VSS\_FSBT\_INCREMENTAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-181">Requis pour les sauvegardes incrémentielles.</span><span class="sxs-lookup"><span data-stu-id="3116c-181">Required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-182"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**\_sauvegarde du \_ Journal FSBT VSS \_ \_ requise**</span><span class="sxs-lookup"><span data-stu-id="3116c-182"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**VSS\_FSBT\_LOG\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-183">Requis pour les sauvegardes de fichiers journaux.</span><span class="sxs-lookup"><span data-stu-id="3116c-183">Required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-184"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**\_sauvegarde VSS FSBT \_ toutes les \_ sauvegardes \_ requises**</span><span class="sxs-lookup"><span data-stu-id="3116c-184"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**VSS\_FSBT\_ALL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-185">Obligatoire pour tous les types de sauvegardes ; Il s’agit de la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="3116c-185">Required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="3116c-186">Cette spécification remplace la spécification de sélectivité du composant.</span><span class="sxs-lookup"><span data-stu-id="3116c-186">This specification overrides the component's selectivity specification.</span></span> <span data-ttu-id="3116c-187">Par exemple, imaginez un composant dont les fichiers sont tous marqués avec la **\_ sauvegarde de \_ fichier journal VSS FSBT \_ \_ obligatoire** , mais pas avec la **\_ \_ sauvegarde complète VSS FSBT \_ \_ requise**.</span><span class="sxs-lookup"><span data-stu-id="3116c-187">For example, consider a component whose files are all marked with **VSS\_FSBT\_LOG\_BACKUP\_REQUIRED** but not with **VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**.</span></span> <span data-ttu-id="3116c-188">Supposons que ce composant ne peut pas être sélectionné pour la sauvegarde (*bSelectable* a la valeur false lorsque [**IVssCreateWriterMetadata :: AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) a été appelé).</span><span class="sxs-lookup"><span data-stu-id="3116c-188">Suppose this component is not selectable for backup (*bSelectable* was false when [**IVssCreateWriterMetadata::AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) was called).</span></span> <span data-ttu-id="3116c-189">Dans le cas d’une sauvegarde de fichier journal, cela signifie que tous les fichiers de ce composant doivent toujours être sauvegardés.</span><span class="sxs-lookup"><span data-stu-id="3116c-189">In the case of a log backup, this means that all the files in this component must always be backed up.</span></span> <span data-ttu-id="3116c-190">Toutefois, dans le cas d’une sauvegarde complète, aucun des fichiers ne doit être sauvegardé, bien que le fait que la sélectivité du composant indique qu’il doit être sauvegardé.</span><span class="sxs-lookup"><span data-stu-id="3116c-190">However, in the case of a full backup, none of the files need to be backed up, despite the fact that the component's selectivity implies it should be backed up.</span></span>

### <a name="backup-by-last-modify-time"></a><span data-ttu-id="3116c-191">Sauvegarde par heure de la dernière modification</span><span class="sxs-lookup"><span data-stu-id="3116c-191">Backup By Last Modify Time</span></span>

<span data-ttu-id="3116c-192">L’un des moyens pour un writer d’indiquer les fichiers qui ont changé est d’utiliser le mécanisme de fichier différent.</span><span class="sxs-lookup"><span data-stu-id="3116c-192">One way for a writer to indicate what files have changed is by using the differenced file mechanism.</span></span> <span data-ttu-id="3116c-193">Un enregistreur peut spécifier que certains fichiers d’un composant ne doivent être sauvegardés que s’ils ont été modifiés depuis un certain temps.</span><span class="sxs-lookup"><span data-stu-id="3116c-193">A writer can specify that certain files in a component should only be backed up if they have been modified since a certain time.</span></span> <span data-ttu-id="3116c-194">Le writer appelle [**IVssComponent :: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) avec une spécification de fichier et une heure de dernière modification.</span><span class="sxs-lookup"><span data-stu-id="3116c-194">The writer calls [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) with a file specification and a last modify time.</span></span> <span data-ttu-id="3116c-195">**IVssComponent :: AddDifferencedFilesByLastModifyTime** est généralement appelé lors du traitement de l’événement PostSnapshot, bien qu’il puisse être appelé lors du traitement de l’événement PrepareForBackup.</span><span class="sxs-lookup"><span data-stu-id="3116c-195">**IVssComponent::AddDifferencedFilesByLastModifyTime** is typically called while processing the PostSnapshot event, although it can be called while processing the PrepareForBackup event.</span></span> <span data-ttu-id="3116c-196">Le demandeur doit ensuite sauvegarder tous les fichiers correspondant à la spécification de fichier qui ont été modifiés depuis l’heure spécifiée.</span><span class="sxs-lookup"><span data-stu-id="3116c-196">The requester must then back up all files matching the file specification that have changed since the specified time.</span></span> <span data-ttu-id="3116c-197">Si le writer utilise le mécanisme de tampon de sauvegarde, cette dernière heure de modification sera déterminée en fonction du tampon de sauvegarde précédent dans le document de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-197">If the writer is using the backup stamp mechanism, this last modify time will be determined based on the previous backup stamp in the backup document.</span></span> <span data-ttu-id="3116c-198">Le writer peut également passer la valeur zéro pour l’heure de la dernière modification, ce qui indique que le demandeur est chargé de déterminer l’heure de la dernière sauvegarde et que les fichiers ont été modifiés depuis ce moment.</span><span class="sxs-lookup"><span data-stu-id="3116c-198">The writer can also pass in zero for the last modify time, which indicates that the requester is responsible for determining the time of the last backup and the files changed since that time.</span></span>

### <a name="partial-file-backup"></a><span data-ttu-id="3116c-199">Sauvegarde de fichiers partielle</span><span class="sxs-lookup"><span data-stu-id="3116c-199">Partial File Backup</span></span>

<span data-ttu-id="3116c-200">Une autre façon pour un enregistreur d’indiquer des modifications au demandeur est d’utiliser le mécanisme de fichier partiel.</span><span class="sxs-lookup"><span data-stu-id="3116c-200">Another way for a writer to indicate changes to the requester is by using the partial-file mechanism.</span></span> <span data-ttu-id="3116c-201">Un enregistreur peut spécifier des plages d’octets dans des fichiers de composants qui doivent être sauvegardés ; l’enregistreur peut spécifier ces plages de fichiers lors du traitement de l’événement PostSnapshot ou PrepareForBackup.</span><span class="sxs-lookup"><span data-stu-id="3116c-201">A writer can specify byte ranges within component files that need to be backed up; the writer may specify these file ranges while processing either the PostSnapshot or PrepareForBackup event.</span></span> <span data-ttu-id="3116c-202">Le writer appelle [**IVssComponent :: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) pour ajouter des spécifications de fichier partielles à la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-202">The writer calls [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) to add partial file specifications to the backup.</span></span> <span data-ttu-id="3116c-203">Une spécification de fichier partielle se compose d’un chemin d’accès et d’un nom de fichier, ainsi que d’informations sur les plages du fichier qui doivent être sauvegardées.</span><span class="sxs-lookup"><span data-stu-id="3116c-203">A partial file specification consists of a path and file name together with information about what ranges in the file need to be backed up.</span></span>

### <a name="file-specification-rules"></a><span data-ttu-id="3116c-204">Règles de spécification de fichier</span><span class="sxs-lookup"><span data-stu-id="3116c-204">File Specification Rules</span></span>

<span data-ttu-id="3116c-205">[**IVssComponent :: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) ou [**IVssComponent :: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) peuvent être utilisés pour modifier les spécifications de fichier fournies pendant l’événement d’identification, ou pour ajouter des fichiers entièrement nouveaux à la spécification.</span><span class="sxs-lookup"><span data-stu-id="3116c-205">[**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) or [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) can both be used to modify file specifications given during the Identify event, or to add completely new files to the specification.</span></span> <span data-ttu-id="3116c-206">Si le writer modifie le jeu d’informations pendant l’événement d’identification à l’aide de **IVssComponent :: AddDifferencedFilesByLastModifyTime**, la spécification de fichier doit correspondre exactement à l’une des spécifications de fichier dans le composant actuel.</span><span class="sxs-lookup"><span data-stu-id="3116c-206">If the writer is modifying information set during the Identify event using **IVssComponent::AddDifferencedFilesByLastModifyTime**, then the file specification must exactly match one of the file specifications in the current component.</span></span> <span data-ttu-id="3116c-207">La spécification de fichier ne doit pas chevaucher partiellement des fichiers dans le composant actuel et ne doit pas correspondre à des fichiers dans d’autres composants.</span><span class="sxs-lookup"><span data-stu-id="3116c-207">The file specification must not partially overlap files in the current component, and it must not match files in any other components.</span></span> <span data-ttu-id="3116c-208">Toutefois, les fichiers spécifiés à l’aide de **IVssComponent :: AddPartialFile** peuvent chevaucher partiellement une autre spécification de fichier.</span><span class="sxs-lookup"><span data-stu-id="3116c-208">Files specified using **IVssComponent::AddPartialFile** can, however, partially overlap another file specification.</span></span> <span data-ttu-id="3116c-209">Les informations définies par **IVssComponent :: AddDifferencedFilesByLastModifyTime** ou **IVssComponent :: AddPartialFile** remplacent le jeu d’informations précédemment à l’aide de l’interface [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) en réponse à l’événement d’identification.</span><span class="sxs-lookup"><span data-stu-id="3116c-209">Information set by **IVssComponent::AddDifferencedFilesByLastModifyTime** or **IVssComponent::AddPartialFile** overrides the information set earlier using the [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) interface in response to the Identify event.</span></span>

<span data-ttu-id="3116c-210">Les spécifications de fichier générales peuvent avoir une valeur d’emplacement secondaire (définie par le paramètre *wszAlternateLocation* de [**IVssCreateWriterMetadata :: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) qui indique un autre emplacement à partir duquel obtenir le fichier au moment de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-210">General file specifications can have an alternate-location value (set by the *wszAlternateLocation* parameter of [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) that indicates an alternate location to obtain the file from at backup time.</span></span> <span data-ttu-id="3116c-211">Si la spécification de fichier définie par le biais des mécanismes de fichier de différences ou de fichiers partiels correspond à une spécification de fichier existante qui a un autre emplacement, l’application de sauvegarde obtiendra les données à partir de cet autre emplacement.</span><span class="sxs-lookup"><span data-stu-id="3116c-211">If the file specification set through the differenced-file or partial-file mechanisms matches an existing file specification that has an alternate location, the backup application will obtain the data from this alternate location.</span></span>

<span data-ttu-id="3116c-212">Si la spécification de fichier définie dans [**IVssComponent :: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) ou dans [**IVssComponent :: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) ne correspond pas aux fichiers du composant en cours de sauvegarde, tous les fichiers correspondants sont ajoutés à la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-212">If the file specification set in [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) or in [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) does not match and files in the component that are being backed up, then all matching files are now added to the backup.</span></span> <span data-ttu-id="3116c-213">Vous devez veiller à ce que l’enregistreur ajoute uniquement des fichiers qui existent sur un volume qui est déjà en cours de copie fantôme au cours de cette tâche. dans le cas contraire, le demandeur peut ne pas réussir à sauvegarder ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="3116c-213">Care must be taken that the writer only adds files that exist on a volume that is already being shadow copied while doing this; otherwise, the requester may fail to back up these files.</span></span> <span data-ttu-id="3116c-214">Si ces fonctions sont appelées lors du traitement de l’événement PostSnapshot, cela peut être déterminé à l’aide de la méthode [**CVssWriter :: IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected) .</span><span class="sxs-lookup"><span data-stu-id="3116c-214">If these functions are called while processing the PostSnapshot event, this can be determined by using the [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected) method.</span></span> <span data-ttu-id="3116c-215">En cas d’appel lors de la gestion de l’événement PrepareForBackup, le writer doit effectuer cette détermination à l’aide d’une autre méthode.</span><span class="sxs-lookup"><span data-stu-id="3116c-215">If called while handling the PrepareForBackup event, the writer must make this determination using another method.</span></span>

### <a name="backup-without-a-shadow-copy"></a><span data-ttu-id="3116c-216">Sauvegarde sans cliché instantané</span><span class="sxs-lookup"><span data-stu-id="3116c-216">Backup Without a Shadow Copy</span></span>

<span data-ttu-id="3116c-217">Certains types de fichiers n’ont peut-être pas besoin d’être sauvegardés sur un volume de clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="3116c-217">Certain types of files may not need to be backed up off of a shadow copy volume.</span></span> <span data-ttu-id="3116c-218">Par exemple, cela est souvent vrai pour les fichiers journaux de base de données.</span><span class="sxs-lookup"><span data-stu-id="3116c-218">For example, this will often be true of database log files.</span></span> <span data-ttu-id="3116c-219">Étant donné que les fichiers journaux augmentent de manière monotone et qu’un enregistreur peut spécifier exactement les portions du fichier à sauvegarder à l’aide de fichiers partiels, il est souvent possible de sauvegarder la déconnexion du volume d’origine.</span><span class="sxs-lookup"><span data-stu-id="3116c-219">Since log files grow monotonically, and a writer can specify exactly what portions of the file to back up using partial files, it will often be possible to back up the log off the original volume.</span></span> <span data-ttu-id="3116c-220">En guise d’optimisation, un enregistreur peut marquer les fichiers qui requièrent des clichés instantanés pour différents types de sauvegarde à l’aide des indicateurs définis dans le paramètre *dwBackupTypeMask* de [**IVssCreateWriterMetadata :: AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata :: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)ou [**IVssCreateWriterMetadata :: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup).</span><span class="sxs-lookup"><span data-stu-id="3116c-220">As an optimization, a writer can mark which files require shadow copies for different backup types using the flags set in the *dwBackupTypeMask* parameter of [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup).</span></span> <span data-ttu-id="3116c-221">Les indicateurs pris en charge sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="3116c-221">Supported flags include the following:</span></span>

<dl> <dt>

<span data-ttu-id="3116c-222"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**\_ \_ instantané complet VSS \_ FSBT \_ requis**</span><span class="sxs-lookup"><span data-stu-id="3116c-222"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**VSS\_FSBT\_FULL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-223">Cliché instantané requis pour les sauvegardes complètes.</span><span class="sxs-lookup"><span data-stu-id="3116c-223">Shadow copy required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-224"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**\_ \_ instantané différentiel FSBT \_ VSS \_ requis**</span><span class="sxs-lookup"><span data-stu-id="3116c-224"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-225">Cliché instantané requis pour les sauvegardes différentielles.</span><span class="sxs-lookup"><span data-stu-id="3116c-225">Shadow copy required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-226"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**\_instantané FSBT \_ incrémentiel VSS \_ \_ requis**</span><span class="sxs-lookup"><span data-stu-id="3116c-226"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**VSS\_FSBT\_INCREMENTAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-227">Cliché instantané requis pour les sauvegardes incrémentielles.</span><span class="sxs-lookup"><span data-stu-id="3116c-227">Shadow copy required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-228"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**\_instantané de \_ Journal FSBT VSS \_ \_ requis**</span><span class="sxs-lookup"><span data-stu-id="3116c-228"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**VSS\_FSBT\_LOG\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-229">Cliché instantané requis pour les sauvegardes de fichiers journaux.</span><span class="sxs-lookup"><span data-stu-id="3116c-229">Shadow copy required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="3116c-230"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**\_FSBT VSS \_ tous les \_ instantanés \_ requis**</span><span class="sxs-lookup"><span data-stu-id="3116c-230"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**VSS\_FSBT\_ALL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="3116c-231">Cliché instantané requis pour tous les types de sauvegardes ; Il s’agit de la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="3116c-231">Shadow copy required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="3116c-232">Si un volume spécifique contient uniquement des composants qui ne nécessitent pas de cliché instantané pour cette sauvegarde, le demandeur peut ignorer l’étape de création d’un cliché instantané pour ce volume.</span><span class="sxs-lookup"><span data-stu-id="3116c-232">If a specific volume contains only components that do not require a shadow copy for this backup, the requester can skip the step of creating a shadow copy for this volume.</span></span> <span data-ttu-id="3116c-233">Toutes les données de ce volume peuvent être copiées sur le support de sauvegarde directement à partir du volume d’origine.</span><span class="sxs-lookup"><span data-stu-id="3116c-233">All the data on this volume can be copied to the backup media directly from the original volume.</span></span>

## <a name="backup-cleanup"></a><span data-ttu-id="3116c-234">Nettoyage de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="3116c-234">Backup Cleanup</span></span>

<span data-ttu-id="3116c-235">Si le writer doit effectuer une troncation du journal ou un autre nettoyage après la sauvegarde, l’emplacement approprié pour effectuer cette opération s’effectue lors du traitement de l’événement [*BackupComplete*](vssgloss-b.md) .</span><span class="sxs-lookup"><span data-stu-id="3116c-235">If the writer needs to perform log truncation or other post-backup cleanup, the proper place to do this is while processing the [*BackupComplete*](vssgloss-b.md) event.</span></span> <span data-ttu-id="3116c-236">L’événement [*BackupShutdown*](vssgloss-b.md) sera envoyé un peu plus tard après BackupComplete. un nettoyage peut également être effectué dans le gestionnaire d’événements BackupShutdown.</span><span class="sxs-lookup"><span data-stu-id="3116c-236">The [*BackupShutdown*](vssgloss-b.md) event will be sent some time after BackupComplete, so some cleanup may also be done in the BackupShutdown event handler.</span></span>

<span data-ttu-id="3116c-237">L’événement BackupShutdown est toujours envoyé après l’arrêt d’une sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-237">The BackupShutdown event is always sent after termination of a backup.</span></span> <span data-ttu-id="3116c-238">Si le demandeur se termine anormalement lors de l’exécution d’une sauvegarde, BackupShutdown est envoyé immédiatement, sans envoyer d’abord BackupComplete.</span><span class="sxs-lookup"><span data-stu-id="3116c-238">If the requester terminates abnormally while performing a backup, BackupShutdown will be sent immediately, without first sending BackupComplete.</span></span> <span data-ttu-id="3116c-239">Si le writer doit nettoyer un État, cela peut être fait ici ; Toutefois, la troncation du journal ne doit pas se produire dans cet événement, car la sauvegarde ne s’est pas nécessairement terminée.</span><span class="sxs-lookup"><span data-stu-id="3116c-239">If the writer needs to clean up any state, that may be done here; however, log truncation should not happen in this event because the backup did not necessarily complete.</span></span>

## <a name="restore-strategies"></a><span data-ttu-id="3116c-240">Stratégies de restauration</span><span class="sxs-lookup"><span data-stu-id="3116c-240">Restore Strategies</span></span>

<span data-ttu-id="3116c-241">Les tâches de base des enregistreurs à la restauration sont de vérifier que la restauration peut se produire dans la gestion de l’événement de prérestauration et que la restauration s’est produite dans la gestion de l’événement PostRestore.</span><span class="sxs-lookup"><span data-stu-id="3116c-241">The basic tasks of writers at restore are to verify that the restore can happen in handling the PreRestore event, and that the restore has happened in handling the PostRestore event.</span></span> <span data-ttu-id="3116c-242">Les magasins plus complexes effectuent également un processus de récupération dans le gestionnaire PostRestore.</span><span class="sxs-lookup"><span data-stu-id="3116c-242">More complex stores will also perform a recovery process in the PostRestore handler.</span></span> <span data-ttu-id="3116c-243">Si la restauration fait partie d’une restauration incrémentielle ou différentielle, le rédacteur souhaite généralement retarder ce processus de récupération jusqu’à ce que toutes les restaurations incrémentielles ou différentielles aient été effectuées.</span><span class="sxs-lookup"><span data-stu-id="3116c-243">If the restore is part of an incremental or differential restore, the writer will generally want to delay this recovery process until all incremental or differential restores have been completed.</span></span> <span data-ttu-id="3116c-244">[**IVssComponent :: GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) indique s’il s’agit de la dernière restauration de ce composant, ou s’il y a plus de restaurations à venir.</span><span class="sxs-lookup"><span data-stu-id="3116c-244">[**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) will indicate whether this is the final restore of this component, or whether there are more restores to come.</span></span> <span data-ttu-id="3116c-245">Si **IVssComponent :: GetAdditionalRestores** retourne la **valeur true**, l’enregistreur ne doit pas exécuter sa procédure de récupération sur ce composant.</span><span class="sxs-lookup"><span data-stu-id="3116c-245">If **IVssComponent::GetAdditionalRestores** returns **true**, the writer should not perform its recovery procedure on that component.</span></span>

## <a name="new-targets"></a><span data-ttu-id="3116c-246">Nouvelles cibles</span><span class="sxs-lookup"><span data-stu-id="3116c-246">New Targets</span></span>

<span data-ttu-id="3116c-247">S’il est pris en charge par l’enregistreur, le demandeur peut restaurer les fichiers de données dans un emplacement autre que l’emplacement d’origine de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="3116c-247">If supported by the writer, the requester can restore data files to a location other than the original backup-time location.</span></span> <span data-ttu-id="3116c-248">Un enregistreur indique la prise en charge de ce mode de restauration, car il **prend en charge le nouveau bit \_ \_ \_ \_ \_ cible** dans le paramètre *dsSchemaMask* lors de l’appel de [**IVssCreateWriterMetadata :: SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span><span class="sxs-lookup"><span data-stu-id="3116c-248">A writer indicates support for this restore mode by setting the **VSS\_BS\_WRITER\_SUPPORTS\_NEW\_TARGET** bit in the *dsSchemaMask* parameter when calling [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span></span> <span data-ttu-id="3116c-249">Un enregistreur obtient les nouveaux emplacements pour les fichiers de composant au moment de la restauration en appelant [**IVssComponent :: GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) et [**IVssComponent :: GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget).</span><span class="sxs-lookup"><span data-stu-id="3116c-249">A writer obtains the new locations for component files at restore time by calling [**IVssComponent::GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) and [**IVssComponent::GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget).</span></span>

## <a name="directed-targets"></a><span data-ttu-id="3116c-250">Cibles dirigées</span><span class="sxs-lookup"><span data-stu-id="3116c-250">Directed Targets</span></span>

<span data-ttu-id="3116c-251">Pour les scénarios de restauration complexes, un enregistreur peut souhaiter mapper des plages d’un fichier sauvegardé sur différentes plages du même fichier ou d’un fichier différent.</span><span class="sxs-lookup"><span data-stu-id="3116c-251">For complicated restore scenarios, a writer may want to map ranges of a backed-up file onto different ranges of the same or a different file.</span></span> <span data-ttu-id="3116c-252">Pour ce faire, vous pouvez utiliser le mécanisme de cible dirigée.</span><span class="sxs-lookup"><span data-stu-id="3116c-252">This can be done by using the directed-target mechanism.</span></span> <span data-ttu-id="3116c-253">Pour ce faire, un enregistreur doit d’abord indiquer que cela se produit en appelant [**IVssComponent :: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), en transmettant le paramètre *cible* dans **VSS \_ RT \_** .</span><span class="sxs-lookup"><span data-stu-id="3116c-253">To do this, a writer must first indicate this is happening by calling [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), passing in **VSS\_RT\_DIRECTED** for the *target* parameter.</span></span> <span data-ttu-id="3116c-254">Ensuite, pour chaque mappage, le writer appelle [**IVssComponent :: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).</span><span class="sxs-lookup"><span data-stu-id="3116c-254">Then, for each mapping, the writer calls [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).</span></span> <span data-ttu-id="3116c-255">Cette méthode prend un chemin d’accès complet à un fichier source sur la sauvegarde et un chemin d’accès complet à un fichier de destination qui sera restauré vers.</span><span class="sxs-lookup"><span data-stu-id="3116c-255">This method takes a full path to a source file on the backup and a full path to a destination file that will be restored to.</span></span> <span data-ttu-id="3116c-256">Elle prend également une liste de plages pour chacun de ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="3116c-256">It also takes a ranges list for each of these files.</span></span> <span data-ttu-id="3116c-257">Le writer appelle ces fonctions lors de la gestion de l’événement de prérestauration, et le demandeur est ensuite chargé de restaurer les plages spécifiées dans le fichier source vers les plages mappées dans le fichier de destination.</span><span class="sxs-lookup"><span data-stu-id="3116c-257">The writer calls these functions while handling the PreRestore event, and the requester is then responsible for restoring the specified ranges in the source file to the mapped ranges in the destination file.</span></span> <span data-ttu-id="3116c-258">Le format de la chaîne de plages est le même que dans [ **IVssComponent :: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)</span><span class="sxs-lookup"><span data-stu-id="3116c-258">The format of the ranges string is the same as in [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)</span></span>

## <a name="private-writer-metadata"></a><span data-ttu-id="3116c-259">Métadonnées de l’enregistreur privé</span><span class="sxs-lookup"><span data-stu-id="3116c-259">Private Writer Metadata</span></span>

<span data-ttu-id="3116c-260">Il est souvent utile pour un enregistreur de conserver les métadonnées privées avec une sauvegarde pour effectuer correctement une restauration incrémentielle ou différentielle.</span><span class="sxs-lookup"><span data-stu-id="3116c-260">It is often useful for a writer to maintain private metadata with a backup to properly perform an incremental or differential restore.</span></span> <span data-ttu-id="3116c-261">Un enregistreur peut appeler [**IVssComponent :: SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) tout en gérant PrepareForBackup ou PostSnapshot pour stocker les métadonnées.</span><span class="sxs-lookup"><span data-stu-id="3116c-261">A writer may call [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) while handling either PrepareForBackup or PostSnapshot to store metadata.</span></span> <span data-ttu-id="3116c-262">Ces métadonnées sont accessibles par le writer pendant la prérestauration ou l’PostRestore en appelant [**IVssComponent :: GetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupmetadata).</span><span class="sxs-lookup"><span data-stu-id="3116c-262">This metadata can be accessed by the writer during either PreRestore or PostRestore by calling [**IVssComponent::GetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupmetadata).</span></span> <span data-ttu-id="3116c-263">Les métadonnées peuvent également être stockées avec une spécification de fichier partielle à l’aide du paramètre *wszMetadata* de [**IVssComponent :: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile); Ces métadonnées sont accessibles par le biais du paramètre *pbstrMetadata* de [**IVssComponent :: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span><span class="sxs-lookup"><span data-stu-id="3116c-263">Metadata can also be stored with partial file specification by using the *wszMetadata* parameter of [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile); this metadata is accessed through the *pbstrMetadata* parameter of [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span></span> <span data-ttu-id="3116c-264">Le writer peut également passer des métadonnées à lui-même entre [**CVssWriter :: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) et [**CVssWriter :: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span><span class="sxs-lookup"><span data-stu-id="3116c-264">The writer can also pass metadata to itself between [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) and [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span></span> <span data-ttu-id="3116c-265">Dans **CVssWriter :: OnPreRestore**, les métadonnées sont définies en appelant [**IVssComponent :: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata).</span><span class="sxs-lookup"><span data-stu-id="3116c-265">In **CVssWriter::OnPreRestore**, the metadata is set by calling [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata).</span></span> <span data-ttu-id="3116c-266">Dans **CVssWriter :: OnPostRestore**, les métadonnées sont récupérées en appelant [**IVssComponent :: GetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoremetadata).</span><span class="sxs-lookup"><span data-stu-id="3116c-266">In **CVssWriter::OnPostRestore**, the metadata is retrieved by calling [**IVssComponent::GetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoremetadata).</span></span>

-   [<span data-ttu-id="3116c-267">Rôle d’écriture dans VSS sauvegardes incrémentielles et différentielles</span><span class="sxs-lookup"><span data-stu-id="3116c-267">Writer Role in VSS Incremental and Differential Backups</span></span>](writer-role-in-vss-incremental-and-differential-backups.md)
-   [<span data-ttu-id="3116c-268">Rôle demandeur dans VSS sauvegardes incrémentielles et différentielles</span><span class="sxs-lookup"><span data-stu-id="3116c-268">Requester Role in VSS Incremental and Differential Backups</span></span>](requestor-role-in-vss-incremental-and-differential-backups.md)

 

 



