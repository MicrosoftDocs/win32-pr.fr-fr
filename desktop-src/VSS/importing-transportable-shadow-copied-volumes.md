---
description: Il est parfois souhaitable de créer un cliché instantané sur un système, mais d’utiliser le cliché instantané sur un second système.
ms.assetid: 4ec63917-03c0-434e-892e-3d9d4c47740e
title: Importation de volumes de clichés instantanés transportables
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d259fbc047d088ee1f7064804a3ee98fe48da1b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104115163"
---
# <a name="importing-transportable-shadow-copied-volumes"></a><span data-ttu-id="a361b-103">Importation de volumes de clichés instantanés transportables</span><span class="sxs-lookup"><span data-stu-id="a361b-103">Importing Transportable Shadow Copied Volumes</span></span>

<span data-ttu-id="a361b-104">Il est parfois souhaitable de créer un cliché instantané sur un système, mais d’utiliser le cliché instantané sur un second système.</span><span class="sxs-lookup"><span data-stu-id="a361b-104">It is sometimes desirable to create a shadow copy on one system, but use the shadow copy on a second system.</span></span>

<span data-ttu-id="a361b-105">Considérez le cas où les données à sauvegarder sont normalement gérées par un système donné (*systemOne*) au cours d’opérations normales et que ces données sont stockées physiquement sur une baie de stockage ou un appareil.</span><span class="sxs-lookup"><span data-stu-id="a361b-105">Consider the case where data to be backed up is normally managed by a given system (*systemOne*) during normal operations, and that this data is physically stored on a storage array or an appliance.</span></span>

<span data-ttu-id="a361b-106">Pour limiter les interruptions de *systemOne* (car les opérations de sauvegarde peuvent nécessiter de nombreuses ressources), il est préférable d’effectuer la sauvegarde à l’aide de *systemTwo*, un serveur de sauvegarde, qui a accès au même groupe de stockage que *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="a361b-106">To minimize any disruption to *systemOne* (because backup operations can be resource intensive), it is desirable to perform the backup using *systemTwo*, a backup server, which has access to the same storage array as *systemOne*.</span></span>

<span data-ttu-id="a361b-107">Pour garantir le bon cliché instantané, en coopérant avec les enregistreurs sur *systemOne* et en préservant l’état de manière appropriée pour les tâches en cours, le cliché instantané doit être exécuté par *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="a361b-107">To ensure a proper shadow copy—cooperating with the writers on *systemOne* and preserving the state appropriately for ongoing tasks—the shadow copy should be performed by *systemOne*.</span></span>

<span data-ttu-id="a361b-108">Par conséquent, *systemOne* doit créer un [*cliché instantané transportable*](vssgloss-t.md), que *systemTwo* va importer ensuite.</span><span class="sxs-lookup"><span data-stu-id="a361b-108">Therefore, *systemOne* must create a [*transportable shadow copy*](vssgloss-t.md), which *systemTwo* will then import.</span></span>

<span data-ttu-id="a361b-109">**Windows server 2003, Standard Edition, Windows server 2003, Web Edition et Windows XP :** Les jeux de clichés instantanés transportables ne sont pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="a361b-109">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition and Windows XP:** Transportable shadow copy sets are not supported.</span></span> <span data-ttu-id="a361b-110">Toutes les éditions de Windows Server 2003 avec Service Pack 1 (SP1) prennent en charge les jeux de clichés instantanés transportables.</span><span class="sxs-lookup"><span data-stu-id="a361b-110">All editions of Windows Server 2003 with Service Pack 1 (SP1) support transportable shadow copy sets.</span></span>

<span data-ttu-id="a361b-111">Un exemple classique d’importation d’un cliché instantané transportable peut se poursuivre de la façon suivante :</span><span class="sxs-lookup"><span data-stu-id="a361b-111">A typical example of importing a transportable shadow copy can proceed in the following way:</span></span>

1.  <span data-ttu-id="a361b-112">Initialement, l’unité logique (LUN) qui est fournie par le groupe de stockage est montée en tant que volume sur *systemOne* (par exemple, F :).</span><span class="sxs-lookup"><span data-stu-id="a361b-112">Initially, the logical unit (LUN) that is provided by the storage array is mounted as a volume on *systemOne* (say, F:).</span></span>
2.  <span data-ttu-id="a361b-113">Un demandeur qui s’exécute sur *systemOne* instancie une instance de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) et se poursuit comme s’il avait préparé une sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="a361b-113">A requester that is running on *systemOne* instantiates an instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) and proceeds as if it were preparing for a backup.</span></span> <span data-ttu-id="a361b-114">(Pour plus d’informations, consultez [Présentation de l’initialisation de](overview-of-backup-initialization.md)la sauvegarde, [vue d’ensemble de la phase de découverte de la sauvegarde](overview-of-the-backup-discovery-phase.md)et [vue d’ensemble des tâches de pré-sauvegarde](overview-of-pre-backup-tasks.md) .)</span><span class="sxs-lookup"><span data-stu-id="a361b-114">(See [Overview of Backup Initialization](overview-of-backup-initialization.md), [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), and [Overview of Pre-Backup Tasks](overview-of-pre-backup-tasks.md) for more information.)</span></span>
3.  <span data-ttu-id="a361b-115">Le demandeur sur *systemOne* modifie le contexte de cliché instantané qui est généralement utilisé pour l’opération de sauvegarde locale (sauvegarde de l'**\_ \_ application \_ CTX VSS**) pour indiquer qu’un cliché instantané transportable sera créé (**VSS \_ VOLSNAP \_ attr \_ transportable**).</span><span class="sxs-lookup"><span data-stu-id="a361b-115">The requester on *systemOne* modifies the shadow copy context that is typically used for local backup operation (**VSS\_CTX\_APP\_BACKUP**) to indicate that a transportable shadow copy will be created (**VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**).</span></span> <span data-ttu-id="a361b-116">L’attribut transportable peut également être ajouté à d’autres contextes de clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="a361b-116">The transportable attribute can be added to other shadow copy contexts as well.</span></span>
4.  <span data-ttu-id="a361b-117">Avec un contexte de cliché instantané de la **\_ \_ \_ sauvegarde** VSS de l’application systemOne VSS \| **\_ VOLSNAP \_ attr \_ transportable**, le demandeur qui se trouve sur  crée un cliché instantané en appelant [**IVssBackupComponents ::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="a361b-117">With a shadow copy context of **VSS\_CTX\_APP\_BACKUP** \| **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**, the requester that is on *systemOne* creates a shadow copy by calling [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span>
5.  <span data-ttu-id="a361b-118">*SystemOne* utilise [**IVssBackupComponents :: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) pour enregistrer l’état actuel du document des composants de sauvegarde et [**IVssExamineWriterMetadata :: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) pour enregistrer les documents de métadonnées de l’enregistreur du writer.</span><span class="sxs-lookup"><span data-stu-id="a361b-118">*SystemOne* uses [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) to save the current state of the Backup Components Document and [**IVssExamineWriterMetadata::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) to save each writer's Writer Metadata Documents.</span></span> <span data-ttu-id="a361b-119">Les chaînes XML qui contiennent ces documents sont ensuite mises à la disposition d’un demandeur qui s’exécute sur *systemTwo*.</span><span class="sxs-lookup"><span data-stu-id="a361b-119">The XML strings that contain these documents are then made available to a requester that is running on *systemTwo*.</span></span>

    <span data-ttu-id="a361b-120">Le demandeur transfère le document des composants de sauvegarde vers *systemTwo*.</span><span class="sxs-lookup"><span data-stu-id="a361b-120">The requester transfers the Backup Components Document to *systemTwo*.</span></span>

    <span data-ttu-id="a361b-121">Notez que le demandeur sur *systemOne* ne libère pas son instance de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) à ce stade si l’objectif du cliché instantané est pour la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="a361b-121">Note that the requester on *systemOne* does not release its instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) at this point if the purpose of the shadow copy is for backup.</span></span> <span data-ttu-id="a361b-122">L’interface doit rester ouverte jusqu’à ce que *systemTwo* termine correctement ses opérations de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="a361b-122">The interface should remain open until *systemTwo* successfully finishes its backup operations.</span></span> <span data-ttu-id="a361b-123">Uniquement si le demandeur émet un événement [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) , car certains enregistreurs tronquent les journaux et effectuent d’autres tâches après une sauvegarde réussie.</span><span class="sxs-lookup"><span data-stu-id="a361b-123">Only then should the requester issue a [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event since some writers will truncate logs and do other work after a successful backup.</span></span> <span data-ttu-id="a361b-124">Si l’objectif du cliché instantané est l’exploration de données ou à d’autres fins, l’interface peut être fermée à cette étape.</span><span class="sxs-lookup"><span data-stu-id="a361b-124">If the goal of the shadow copy is data mining or other purposes, then the interface can be closed at this step.</span></span>

6.  <span data-ttu-id="a361b-125">Le demandeur sur *systemTwo* appelle ensuite [**IVssBackupComponents :: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) pour obtenir l’accès au cliché instantané qui a été créé par le demandeur sur *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="a361b-125">The requester on *systemTwo* then calls [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) to get access to the shadow copy that was created by the requester on *systemOne*.</span></span>
    > [!Note]  
    > <span data-ttu-id="a361b-126">Le demandeur est responsable de la sérialisation de l’opération de cliché instantané de l’importation.</span><span class="sxs-lookup"><span data-stu-id="a361b-126">The requester is responsible for serializing the import shadow copy operation.</span></span> <span data-ttu-id="a361b-127">En outre, si l’appel à [**IVssBackupComponents :: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) échoue, le service VSS ne nettoie pas les numéros d’unités logiques qui lui sont propres.</span><span class="sxs-lookup"><span data-stu-id="a361b-127">Also, if the call to [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) fails, the VSS won't clean up LUNs on it's own.</span></span> <span data-ttu-id="a361b-128">Le demandeur doit lancer le nettoyage des numéros d’unités logiques.</span><span class="sxs-lookup"><span data-stu-id="a361b-128">The requester has to initiate the cleanup of LUNs.</span></span>

     

7.  <span data-ttu-id="a361b-129">Le demandeur sur *systemTwo* procède à la sauvegarde du matériel des clichés instantanés exactement comme s’il sauvegardait un cliché instantané créé par lui-même (consultez [vue d’ensemble de la sauvegarde réelle des fichiers](overview-of-actual-backup-of-files.md)).</span><span class="sxs-lookup"><span data-stu-id="a361b-129">The requester on *systemTwo* proceeds with the backup of the shadow copied material exactly as if it were backing up a shadow copy that it created by itself (see [Overview of Actual Backup Of Files](overview-of-actual-backup-of-files.md)).</span></span>

    <span data-ttu-id="a361b-130">Le demandeur sur *systemTwo* obtient l' [*objet appareil*](vssgloss-d.md) du cliché instantané à l’aide de [**IVssBackupComponents :: GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties) sur le cliché instantané importé et l’ajoute au début des chemins d’accès aux fichiers d’origine qui ont été obtenus à partir des métadonnées pour accéder aux fichiers à sauvegarder.</span><span class="sxs-lookup"><span data-stu-id="a361b-130">The requester on *systemTwo* obtains the shadow copy's [*device object*](vssgloss-d.md) using [**IVssBackupComponents::GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties) on the imported shadow copy and appends that to the beginning of the original file paths that were obtained from the metadata to access files to be backed up.</span></span>

8.  <span data-ttu-id="a361b-131">Après avoir utilisé le cliché instantané, le demandeur sur *systemTwo* doit supprimer le cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="a361b-131">After using the shadow copy, the requester on *systemTwo* must delete the shadow copy.</span></span> <span data-ttu-id="a361b-132">Comme pour les clichés instantanés non transportables, si le contexte de cliché instantané indique des clichés instantanés de mise en sortie automatique (par exemple, la sauvegarde de la copie de **\_ \_ sauvegarde de VSS**), le fait de libérer le [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) sur *systemTwo* entraîne la suppression du cliché instantané par le service VSS.</span><span class="sxs-lookup"><span data-stu-id="a361b-132">As with non-transportable shadow copies, if the shadow copy context indicates auto-release shadow copies (for example, **VSS\_CTX\_BACKUP**), then releasing the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) on *systemTwo* will cause the VSS service to delete the shadow copy.</span></span> <span data-ttu-id="a361b-133">Dans le cas contraire, si le contexte indique un cliché instantané persistant (par exemple, la restauration de l' **\_ \_ application \_ CTX VSS**), le demandeur sur *systemTwo* doit supprimer explicitement le cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="a361b-133">Otherwise, if the context indicates a persistent shadow copy (for example, **VSS\_CTX\_APP\_ROLLBACK**), then the requester on *systemTwo* must explicitly delete the shadow copy.</span></span>

    <span data-ttu-id="a361b-134">Ensuite, le demandeur sur *systemTwo* signale au demandeur sur *systemOne* qu’il a fini de sauvegarder le cliché instantané transportable.</span><span class="sxs-lookup"><span data-stu-id="a361b-134">Then the requester on *systemTwo* signals the requester on *systemOne* that it has finished with the backup of the transportable shadow copy.</span></span>

9.  <span data-ttu-id="a361b-135">Une fois que le demandeur sur *systemOne* a reçu une notification indiquant que le demandeur sur *systemTwo* a terminé la sauvegarde du cliché instantané transportable, il avertit les enregistreurs de son système en générant un événement [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) avec un appel à **IVssBackupComponents :: BackupComplete**.</span><span class="sxs-lookup"><span data-stu-id="a361b-135">After the requester on *systemOne* has received notification that the requester on *systemTwo* has finished the backup of the transportable shadow copy, it notifies the writers on its system by generating a [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event with a call to **IVssBackupComponents::BackupComplete**.</span></span> <span data-ttu-id="a361b-136">À ce stade, le demandeur sur *systemOne* est libre de libérer son instance de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="a361b-136">At this point, the requester on *systemOne* is free to release its instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span></span>

<span data-ttu-id="a361b-137">**Clichés instantanés transportables dans un cluster :** Les clichés instantanés transportables doivent être importés à partir de l’extérieur du cluster tant que le volume d’origine est monté au sein du cluster.</span><span class="sxs-lookup"><span data-stu-id="a361b-137">**Transportable shadow copies in a cluster:** Transportable shadow copies must be imported from outside the cluster as long as the original volume is mounted within the cluster.</span></span> <span data-ttu-id="a361b-138">Pour plus d’informations sur l’implémentation d’une récupération rapide dans un cluster, consultez [récupération rapide à l’aide de volumes de clichés instantanés transportables](fast-recovery-using-transportable-shadow-copied-volumes.md).</span><span class="sxs-lookup"><span data-stu-id="a361b-138">For information about implementing a fast recovery in a cluster, see [Fast Recovery Using Transportable Shadow Copied Volumes](fast-recovery-using-transportable-shadow-copied-volumes.md).</span></span>

 

 



