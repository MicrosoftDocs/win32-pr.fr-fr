---
description: Les enregistreurs sont des applications ou des services qui stockent des informations persistantes dans des fichiers sur disque et qui fournissent les noms et les emplacements de ces fichiers aux demandeurs à l’aide de l’interface de cliché instantané.
ms.assetid: 24fc2d7c-f8d6-49ca-9bb5-0179bef68e78
title: Writers
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 52ca409e8dc6153a6b3e2b747dc23cc391055471
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106543661"
---
# <a name="writers"></a><span data-ttu-id="84371-103">Writers</span><span class="sxs-lookup"><span data-stu-id="84371-103">Writers</span></span>

<span data-ttu-id="84371-104">Les [*enregistreurs*](vssgloss-w.md) sont des applications ou des services qui stockent des informations persistantes dans des fichiers sur disque et qui fournissent les noms et les emplacements de ces fichiers aux demandeurs à l’aide de l’interface de cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="84371-104">[*Writers*](vssgloss-w.md) are applications or services that store persistent information in files on disk and that provide the names and locations of these files to requesters by using the shadow copy interface.</span></span>

<span data-ttu-id="84371-105">Pendant les opérations de sauvegarde, les rédacteurs garantissent que leurs données sont inversées et stables, adaptées au cliché instantané et à la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="84371-105">During backup operations, writers ensure that their data is quiescent and stable—suitable for shadow copy and backup.</span></span> <span data-ttu-id="84371-106">Les enregistreurs collaborent avec les restaurations en déverrouillant les fichiers lorsque cela est possible et en indiquant d’autres emplacements si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="84371-106">Writers collaborate with restores by unlocking files when possible and indicating alternate locations when necessary.</span></span>

<span data-ttu-id="84371-107">Si aucun Writer n’est présent au cours d’une opération de sauvegarde VSS, vous pouvez toujours créer un cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="84371-107">If no writers are present during a VSS backup operation, a shadow copy can still be created.</span></span> <span data-ttu-id="84371-108">Dans ce cas, toutes les données du volume copié par cliché instantané seront dans l' [*État de cohérence*](vssgloss-c.md)en cas d’incident.</span><span class="sxs-lookup"><span data-stu-id="84371-108">In this case, all data on the shadow-copied volume will be in the [*crash-consistent state*](vssgloss-c.md).</span></span>

## <a name="writer-state"></a><span data-ttu-id="84371-109">État de l’enregistreur</span><span class="sxs-lookup"><span data-stu-id="84371-109">Writer State</span></span>

<span data-ttu-id="84371-110">Les Writers conservent leur état dans un objet de métadonnées XML, le [*document de métadonnées*](vssgloss-w.md)de l’enregistreur.</span><span class="sxs-lookup"><span data-stu-id="84371-110">Writers maintain their state in an XML-based metadata object, the [*Writer Metadata Document*](vssgloss-w.md).</span></span>

<span data-ttu-id="84371-111">Les métadonnées de ce writer sont la seule structure de données qui contient le [*jeu de fichiers*](vssgloss-f.md)(chemin d’accès, spécification de fichier et indicateur de récurrence) des données à sauvegarder et à restaurer.</span><span class="sxs-lookup"><span data-stu-id="84371-111">This writer metadata is the only data structure that contains the [*file set*](vssgloss-f.md)—path, file specification, and recursion flag—of the data to be backed up and restored.</span></span>

<span data-ttu-id="84371-112">Le document de métadonnées de l’enregistreur organise les jeux de fichiers du writer en groupes ou [*composants*](vssgloss-c.md).</span><span class="sxs-lookup"><span data-stu-id="84371-112">The Writer Metadata Document organizes the writer's file sets into groups or [*components*](vssgloss-c.md).</span></span> <span data-ttu-id="84371-113">La relation entre l’un de ces composants et les opérations de sauvegarde et de restauration sur les autres composants gérés par le writer est décrite dans le document de métadonnées de l’enregistreur par la sélectivité du composant [*pour la sauvegarde*](vssgloss-s.md), sa [*sélectivité pour la restauration*](vssgloss-s.md)et ses [*chemins logiques*](vssgloss-l.md).</span><span class="sxs-lookup"><span data-stu-id="84371-113">The relationship of one of these components during backup and restore operations to the other components managed by the writer is described in the Writer Metadata Document by the component's [*selectability for backup*](vssgloss-s.md), its [*selectability for restore*](vssgloss-s.md), and its [*logical paths*](vssgloss-l.md).</span></span> <span data-ttu-id="84371-114">(Pour plus d’informations, consultez Configuration de l' [Organisation des composants](definition-of-components-by-writers.md) et [utilisation de la sélectivité et des chemins logiques](working-with-selectability-and-logical-paths.md).)</span><span class="sxs-lookup"><span data-stu-id="84371-114">(For more information, see [Setting up Component Organization](definition-of-components-by-writers.md) and [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md).)</span></span>

<span data-ttu-id="84371-115">Ce document contient également des informations supplémentaires qui régissent la restauration des fichiers et d’autres problèmes.</span><span class="sxs-lookup"><span data-stu-id="84371-115">Additional information that governs file restoration and other issues is also contained in this document.</span></span>

<span data-ttu-id="84371-116">Le demandeur a besoin des métadonnées de l’enregistreur, conjointement avec son propre document de composants de sauvegarde, pour traiter une sauvegarde ou une restauration.</span><span class="sxs-lookup"><span data-stu-id="84371-116">The requester needs the writer metadata, in conjunction with its own Backup Components Document, to process a backup or a restore.</span></span>

<span data-ttu-id="84371-117">Contrairement au document sur les composants de sauvegarde, le document de métadonnées de l’enregistreur doit être considéré comme une structure en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="84371-117">Unlike the Backup Components Document, the Writer Metadata Document should be thought of as a read-only structure.</span></span> <span data-ttu-id="84371-118">Une fois qu’un enregistreur l’a créé, le document n’est pas modifié.</span><span class="sxs-lookup"><span data-stu-id="84371-118">Once a writer creates it, the document is not altered.</span></span>

## <a name="writer-event-handling"></a><span data-ttu-id="84371-119">Gestion des événements du writer</span><span class="sxs-lookup"><span data-stu-id="84371-119">Writer Event Handling</span></span>

<span data-ttu-id="84371-120">Les opérations VSS d’un enregistreur sont lancées par le biais de la réception d’événements COM.</span><span class="sxs-lookup"><span data-stu-id="84371-120">A writer's VSS operations are initiated through the receipt of COM events.</span></span>

<span data-ttu-id="84371-121">Quand aucun événement n’est présent, un enregistreur n’effectue pas d’opérations VSS (telles qu’une sauvegarde ou une restauration VSS).</span><span class="sxs-lookup"><span data-stu-id="84371-121">When no events are present, a writer does not perform VSS operations (such as a VSS backup or restore).</span></span> <span data-ttu-id="84371-122">Au lieu de cela, il effectue son travail normal, tel que la réponse aux requêtes de base de données, la gestion des données utilisateur ou la fourniture d’autres services.</span><span class="sxs-lookup"><span data-stu-id="84371-122">Instead, it performs its normal work, such as responding to database queries, managing user data, or providing other services.</span></span>

<span data-ttu-id="84371-123">Pour garantir le bon fonctionnement de la gestion des erreurs pour plusieurs sessions parallèles de sauvegarde et de restauration, et pour garantir qu’une seule session de sauvegarde ou de restauration n’endommage pas une autre, vous devez effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="84371-123">To ensure that error handling for multiple parallel backup and restore sessions is performed correctly, and to ensure that one backup or restore session does not corrupt another, you must do the following:</span></span>

-   <span data-ttu-id="84371-124">Si le gestionnaire d’événements d’un writer (tel que [**CVssWriter :: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)) appelle la méthode [**CVssWriterEx2 :: GetSessionId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-getsessionid), [**CVssWriter :: SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure)ou [**CVssWriterEx2 :: SetWriterFailureEx**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-setwriterfailureex) , le gestionnaire d’événements doit appeler la méthode dans le même thread que celui qui a appelé le gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="84371-124">If a writer's event handler (such as [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)) calls the [**CVssWriterEx2::GetSessionId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-getsessionid), [**CVssWriter::SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure), or [**CVssWriterEx2::SetWriterFailureEx**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-setwriterfailureex) method, the event handler must call the method in the same thread that called the event handler.</span></span>
-   <span data-ttu-id="84371-125">L’implémentation de votre writer d’un gestionnaire d’événements tel que [**OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) peut décharger le travail vers les threads de travail si vous le souhaitez, à condition que chaque thread de travail marshale tous les rapports d’erreurs nécessaires au thread du gestionnaire d’événements d’origine.</span><span class="sxs-lookup"><span data-stu-id="84371-125">Your writer’s implementation of an event handler such as [**OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) can offload work to worker threads if desired, as long as each worker thread marshals any needed error reporting back to the original event handler thread.</span></span>

## <a name="handling-identify-events"></a><span data-ttu-id="84371-126">Gestion des événements d’identification</span><span class="sxs-lookup"><span data-stu-id="84371-126">Handling Identify Events</span></span>

<span data-ttu-id="84371-127">À l’exception de l’événement d’identification, le type et l’ordre des événements reçus par un writer dépend uniquement du type d’opérations VSS en cours.</span><span class="sxs-lookup"><span data-stu-id="84371-127">With the exception of the Identify event, the type and order of the events a writer receives depends uniquely on the type of VSS operations that are currently ongoing.</span></span>

<span data-ttu-id="84371-128">L’événement d’identification nécessite que les enregistreurs fournissent les informations système relatives à leur configuration et aux fichiers qu’ils gèrent par le biais de leur [*document de métadonnées d’écriture*](vssgloss-w.md).</span><span class="sxs-lookup"><span data-stu-id="84371-128">The Identify event requires writers to provide the system information about their configuration and the files they manage through their [*Writer Metadata Document*](vssgloss-w.md).</span></span> <span data-ttu-id="84371-129">Un événement d’identification est généré pour la prise en charge de presque toutes les opérations VSS, y compris les requêtes système, ainsi que les opérations de cliché instantané et de sauvegarde et de restauration.</span><span class="sxs-lookup"><span data-stu-id="84371-129">An Identify event is generated in support of almost any VSS operation, including system queries as well as shadow copy and backup and restore operations.</span></span> <span data-ttu-id="84371-130">Par conséquent, toute implémentation du gestionnaire d’événements identify [**CVssWriter :: OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) doit pouvoir gérer un événement d’identification à tout moment, y compris au milieu du traitement d’une autre opération VSS, telle qu’une sauvegarde ou une restauration.</span><span class="sxs-lookup"><span data-stu-id="84371-130">Therefore, any writer's implementation of the Identify event handler [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) must be able to handle an Identify event at any time—including in the middle of processing another VSS operation, such as a backup or restore.</span></span> <span data-ttu-id="84371-131">Un événement d’identification ne doit jamais être considéré comme faisant partie du cycle de vie d’une opération VSS, même si sa génération peut être attendue et requise avant le début de cette opération.</span><span class="sxs-lookup"><span data-stu-id="84371-131">An Identify event should never be thought of as part of the life cycle of a VSS operation, even though its generation may be expected and required prior to the start of that operation.</span></span>

<span data-ttu-id="84371-132">Il est particulièrement important que les informations d’État relatives à une opération VSS ne soient pas modifiées dans [**CVssWriter :: OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), car la réception d’un événement non ordonné réinitialise ces informations.</span><span class="sxs-lookup"><span data-stu-id="84371-132">It is particularly important that state information about a VSS operation not be modified in [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), because receipt of an out-of-order event would reset that information.</span></span>

## <a name="backup-and-restore-events"></a><span data-ttu-id="84371-133">Événements de sauvegarde et de restauration</span><span class="sxs-lookup"><span data-stu-id="84371-133">Backup and Restore Events</span></span>

<span data-ttu-id="84371-134">Selon qu’elle participe à une sauvegarde ou une restauration, un enregistreur recevra entre deux et sept événements, en plus d’un événement d’identification initial.</span><span class="sxs-lookup"><span data-stu-id="84371-134">Depending on whether it is participating in a backup or restore, a writer will receive between two and seven events, in addition to an initial Identify event.</span></span>

<span data-ttu-id="84371-135">La gestion de ces événements constitue (du point de vue d’un enregistreur) le cycle de vie d’une opération de sauvegarde ou de restauration.</span><span class="sxs-lookup"><span data-stu-id="84371-135">Handling these events constitutes (from the point of view of a writer) the life cycle of a backup or restore operation.</span></span>

<span data-ttu-id="84371-136">Dans une opération de sauvegarde classique (consultez [vue d’ensemble du traitement d’une sauvegarde sous VSS](overview-of-processing-a-backup-under-vss.md)), un enregistreur peut gérer les événements suivants (en plus d’un événement d’identification initial) :</span><span class="sxs-lookup"><span data-stu-id="84371-136">In a typical backup operation (see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md)), a writer would handle the following events (in addition to an initial Identify event):</span></span>

-   <span data-ttu-id="84371-137">PrepareForBackup</span><span class="sxs-lookup"><span data-stu-id="84371-137">PrepareForBackup</span></span>
-   <span data-ttu-id="84371-138">PrepareForSnapshot</span><span class="sxs-lookup"><span data-stu-id="84371-138">PrepareForSnapshot</span></span>
-   <span data-ttu-id="84371-139">Freeze</span><span class="sxs-lookup"><span data-stu-id="84371-139">Freeze</span></span>
-   <span data-ttu-id="84371-140">Libérer</span><span class="sxs-lookup"><span data-stu-id="84371-140">Thaw</span></span>
-   <span data-ttu-id="84371-141">PostSnapshot</span><span class="sxs-lookup"><span data-stu-id="84371-141">PostSnapshot</span></span>
-   <span data-ttu-id="84371-142">BackupComplete</span><span class="sxs-lookup"><span data-stu-id="84371-142">BackupComplete</span></span>
-   <span data-ttu-id="84371-143">BackupShutdown</span><span class="sxs-lookup"><span data-stu-id="84371-143">BackupShutdown</span></span>

<span data-ttu-id="84371-144">Dans une opération de restauration classique (consultez [vue d’ensemble du traitement d’une restauration sous VSS](overview-of-processing-a-restore-under-vss.md)), un enregistreur peut gérer les événements suivants :</span><span class="sxs-lookup"><span data-stu-id="84371-144">In a typical restore operation (see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md)), a writer would handle the following events:</span></span>

-   <span data-ttu-id="84371-145">Prérestauration</span><span class="sxs-lookup"><span data-stu-id="84371-145">PreRestore</span></span>
-   <span data-ttu-id="84371-146">PostRestore</span><span class="sxs-lookup"><span data-stu-id="84371-146">PostRestore</span></span>

 

 



