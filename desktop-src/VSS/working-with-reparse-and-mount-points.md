---
description: Le traitement de l’un des jeux de fichiers d’un composant peut demander à un demandeur de traverser une arborescence de répertoires de manière récursive, ce qui peut obliger le demandeur à gérer les dossiers montés et les points d’analyse (tels que les liens) qui pointent vers des données qui ne sont pas sur le volume actuel.
ms.assetid: d0e08598-a8a2-489b-9cb2-e989bed1ce53
title: Utilisation des dossiers montés et des points d’analyse
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 397a7aa88f39361f788f9aac882b4f9d337fd6f8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106515856"
---
# <a name="working-with-mounted-folders-and-reparse-points"></a><span data-ttu-id="0ce17-103">Utilisation des dossiers montés et des points d’analyse</span><span class="sxs-lookup"><span data-stu-id="0ce17-103">Working with Mounted Folders and Reparse Points</span></span>

<span data-ttu-id="0ce17-104">Le traitement de l’un des jeux de fichiers d’un composant peut demander à un demandeur de traverser une arborescence de répertoires de manière récursive, ce qui peut obliger le demandeur à gérer les dossiers montés et les points d’analyse (tels que les liens) qui pointent vers des données qui ne sont pas sur le volume actuel.</span><span class="sxs-lookup"><span data-stu-id="0ce17-104">Processing one of a component's file sets may require a requester to traverse a directory tree recursively, which can require the requester to handle mounted folders and reparse points (such as links) that point to data that is not on the current volume.</span></span>

<span data-ttu-id="0ce17-105">Les demandeurs doivent suivre les dossiers montés et les points d’analyse lors du parcours d’une arborescence de répertoires, et VSS a des instructions bien définies pour les gérer pour les opérations de sauvegarde et de restauration.</span><span class="sxs-lookup"><span data-stu-id="0ce17-105">Requesters are expected to follow mounted folders and reparse points when traversing a directory tree, and VSS has well-defined guidelines for handling them for backup and restore operations.</span></span>

<span data-ttu-id="0ce17-106">Pour illustrer ces instructions, prenons l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="0ce17-106">To illustrate these guidelines, consider the following example:</span></span>

-   <span data-ttu-id="0ce17-107">Le volume \\ \\ ? \\ Le volume {GUID \_ 1} contient la lettre de lecteur C : \\ .</span><span class="sxs-lookup"><span data-stu-id="0ce17-107">The volume \\\\?\\Volume{GUID\_1} has the drive letter C:\\.</span></span>
-   <span data-ttu-id="0ce17-108">Un jeu de fichiers a un chemin d’accès de C : \\ WriterData.</span><span class="sxs-lookup"><span data-stu-id="0ce17-108">A file set has a path of C:\\WriterData.</span></span>
-   <span data-ttu-id="0ce17-109">Une spécification de fichier \* . dat est utilisée par le jeu de fichiers.</span><span class="sxs-lookup"><span data-stu-id="0ce17-109">A file specification \*.dat is used by the file set.</span></span>
-   <span data-ttu-id="0ce17-110">La récursivité du jeu de fichiers est définie sur **true**.</span><span class="sxs-lookup"><span data-stu-id="0ce17-110">The file set's recursion is set to **TRUE**.</span></span>
-   <span data-ttu-id="0ce17-111">Le répertoire C : \\ WriterData se trouve sur le volume \\ \\ ? \\ Volume {GUID \_ 1}.</span><span class="sxs-lookup"><span data-stu-id="0ce17-111">The directory C:\\WriterData is located on the volume \\\\?\\Volume{GUID\_1}.</span></span>
-   <span data-ttu-id="0ce17-112">Le répertoire C : \\ WriterData \\ archive est un dossier monté.</span><span class="sxs-lookup"><span data-stu-id="0ce17-112">The directory C:\\WriterData\\Archive is a mounted folder.</span></span>
-   <span data-ttu-id="0ce17-113">Le volume \\ \\ ? \\ Le volume {GUID \_ 2} est associé au dossier monté C : \\ WriterData \\ archive.</span><span class="sxs-lookup"><span data-stu-id="0ce17-113">The volume \\\\?\\Volume{GUID\_2} is associated with the mounted folder C:\\WriterData\\Archive.</span></span>

## <a name="handling-mounted-folders-and-reparse-points-during-backup"></a><span data-ttu-id="0ce17-114">Gestion des dossiers montés et des points d’analyse pendant la sauvegarde</span><span class="sxs-lookup"><span data-stu-id="0ce17-114">Handling Mounted Folders and Reparse Points during Backup</span></span>

<span data-ttu-id="0ce17-115">Les règles de base pour gérer les dossiers montés et les points d’analyse sous VSS lors de l’exécution d’une sauvegarde récursive peuvent être résumées comme suit :</span><span class="sxs-lookup"><span data-stu-id="0ce17-115">The basic rules for handling mounted folders and reparse points under VSS when performing a recursive backup can be summarized as follows:</span></span>

-   <span data-ttu-id="0ce17-116">Les chemins d’accès sont suivis des dossiers montés et des points d’analyse.</span><span class="sxs-lookup"><span data-stu-id="0ce17-116">Paths are followed across mounted folders and reparse points.</span></span>
-   <span data-ttu-id="0ce17-117">Si un dossier monté ou un point d’analyse pointe vers un volume, ce volume doit être un cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="0ce17-117">If a mounted folder or reparse point points to a volume, that volume should be shadow copied.</span></span>
-   <span data-ttu-id="0ce17-118">Si un volume contient des dossiers montés ou des points d’analyse, ceux-ci s’affichent dans le cliché instantané du volume.</span><span class="sxs-lookup"><span data-stu-id="0ce17-118">If a volume contains mounted folders or reparse points, these will appear in the shadow copy of the volume.</span></span>
-   <span data-ttu-id="0ce17-119">Les données qui se trouvent sous le dossier monté ou le point d’analyse sont capturées dans le cliché instantané du volume vers lequel pointe le dossier monté ou le point d’analyse.</span><span class="sxs-lookup"><span data-stu-id="0ce17-119">Data that is under the mounted folder or reparse point is captured in the shadow copy of the volume that the mounted folder or reparse point points to.</span></span>

<span data-ttu-id="0ce17-120">Pour illustrer l’utilisation de l’exemple ci-dessus, étant donné que l’indicateur récursif est défini, le demandeur doit examiner toutes les données de l’archive C : \\ WriterData \\ et ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="0ce17-120">To illustrate using the example above, because the recursive flag is set, the requester must examine all data under C:\\WriterData\\Archive and below.</span></span>

<span data-ttu-id="0ce17-121">Le demandeur doit ajouter le volume avec la lettre de lecteur C : \\ ( \\ \\ ? \\ Volume {GUID \_ 1}) et le volume associé au dossier monté C : \\ WriterData \\ Archive ( \\ \\ ? \\ Volume {GUID \_ 2}) au jeu de clichés instantanés à l’aide de [**IVssBackupComponents :: AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="0ce17-121">The requester must add both the volume with drive letter C:\\ (\\\\?\\Volume{GUID\_1}) and the volume associated with the mounted folder C:\\WriterData\\Archive (\\\\?\\Volume{GUID\_2}) to the shadow copy set using [**IVssBackupComponents::AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span></span>

<span data-ttu-id="0ce17-122">Le dossier monté C : \\ \\ Archive WriterData apparaît dans le cliché instantané du volume \\ \\ ? \\ Volume {GUID \_ 1}, qui a un objet d’appareil nommé deviceObject1.</span><span class="sxs-lookup"><span data-stu-id="0ce17-122">The mounted folder C:\\WriterData\\Archive appears in the shadow copy of volume \\\\?\\Volume{GUID\_1}, which has a device object named deviceObject1.</span></span>

<span data-ttu-id="0ce17-123">Toutefois, VSS ne copiera aucune donnée dans ce dossier monté (données sur \\ \\ ? \\ Volume {GUID \_ 2}) au cliché instantané référencé par deviceObject1.</span><span class="sxs-lookup"><span data-stu-id="0ce17-123">However, VSS will not copy any data under that mounted folder (data on \\\\?\\Volume{GUID\_2}) to the shadow copy referenced by deviceObject1.</span></span> <span data-ttu-id="0ce17-124">Au lieu de cela, les données sont capturées dans le cliché instantané de \\ \\ ? \\ Volume {GUID \_ 2}, qui a un objet d’appareil nommé deviceObject2.</span><span class="sxs-lookup"><span data-stu-id="0ce17-124">Instead, that data is captured in the shadow copy of \\\\?\\Volume{GUID\_2}, which has a device object named deviceObject2.</span></span>

<span data-ttu-id="0ce17-125">Par conséquent, un demandeur qui sauvegarde des fichiers copiés par des clichés instantanés sous C : \\ WriterData utilise le chemin d’accès deviceObject1 \\ WriterData pour rechercher les fichiers correspondant à c : \\ WriterData \\ \* . dat.</span><span class="sxs-lookup"><span data-stu-id="0ce17-125">Therefore, a requester that is backing up shadow copied files under C:\\WriterData will use a path of deviceObject1\\WriterData to search for files matching C:\\WriterData\\\*.dat.</span></span>

<span data-ttu-id="0ce17-126">Pour sauvegarder les fichiers de clichés instantanés sous C : \\ WriterData \\ Archive, le demandeur utilise le chemin d’accès deviceObject2 (car le répertoire racine de \\ \\ ? \\ Le volume {GUID \_ 2} a été associé au dossier monté c : \\ writer \\ Archive) pour rechercher les fichiers correspondant à c : \\ WriterData \\ Archive \\ \* . dat.</span><span class="sxs-lookup"><span data-stu-id="0ce17-126">To back up shadow copied files under C:\\WriterData\\Archive, the requester will use a path of deviceObject2 (because the root directory of \\\\?\\Volume{GUID\_2} was associated with the mounted folder C:\\Writer\\Archive) to search for files matching C:\\WriterData\\Archive\\\*.dat.</span></span>

<span data-ttu-id="0ce17-127">Notez qu’un point d’analyse est géré de la même façon qu’un dossier monté.</span><span class="sxs-lookup"><span data-stu-id="0ce17-127">Note that a reparse point is handled in the same way as a mounted folder.</span></span> <span data-ttu-id="0ce17-128">Le point d’analyse apparaît dans le cliché instantané du premier volume.</span><span class="sxs-lookup"><span data-stu-id="0ce17-128">The reparse point appears in the shadow copy of the first volume.</span></span> <span data-ttu-id="0ce17-129">Les données sous le point d’analyse apparaissent dans le cliché instantané du deuxième volume.</span><span class="sxs-lookup"><span data-stu-id="0ce17-129">The data under the reparse point appears in the shadow copy of the second volume.</span></span>

<span data-ttu-id="0ce17-130">Lors de la sauvegarde, les demandeurs doivent stocker des informations sur les dossiers montés et les volumes qui leur sont associés, ainsi que sur les points d’analyse et leurs cibles pour s’assurer que toutes les données sont sauvegardées et restaurées correctement.</span><span class="sxs-lookup"><span data-stu-id="0ce17-130">During backup, requesters should store information about mounted folders and the volumes associated with them as well as reparse points and their targets to ensure that all data is backed up and restored correctly.</span></span>

## <a name="handling-mount-and-reparse-points-during-restore"></a><span data-ttu-id="0ce17-131">Gestion des points de montage et d’analyse lors de la restauration</span><span class="sxs-lookup"><span data-stu-id="0ce17-131">Handling Mount and Reparse Points during Restore</span></span>

<span data-ttu-id="0ce17-132">Lors de la restauration de fichiers, le demandeur doit suivre des instructions légèrement différentes de celles qui ont été utilisées pendant la sauvegarde (sans tenir compte des problèmes tels que le [*mappage d’emplacement secondaire*](vssgloss-a.md) et le [*nouvel emplacement cible*](vssgloss-n.md)) :</span><span class="sxs-lookup"><span data-stu-id="0ce17-132">When restoring files, the requester must follow guidelines somewhat different from those that were used during backup (ignoring issues such as [*alternate location mapping*](vssgloss-a.md) and [*new target location*](vssgloss-n.md)):</span></span>

-   <span data-ttu-id="0ce17-133">Comme précédemment, si la récursivité est requise, les chemins d’accès sont suivis sur les dossiers montés et les points d’analyse.</span><span class="sxs-lookup"><span data-stu-id="0ce17-133">As before, if recursion is required, paths are followed across mounted folders and reparse points.</span></span>
-   <span data-ttu-id="0ce17-134">Les dossiers montés doivent être restaurés.</span><span class="sxs-lookup"><span data-stu-id="0ce17-134">Mounted folders are to be restored.</span></span>
-   <span data-ttu-id="0ce17-135">Les emplacements de restauration des dossiers montés et des points d’analyse sont ceux qui sont déterminés par leurs chemins d’accès d’origine.</span><span class="sxs-lookup"><span data-stu-id="0ce17-135">The restoration locations of mounted folders and reparse points are those determined by their original paths.</span></span>

<span data-ttu-id="0ce17-136">Si les noms de volume persistent entre la sauvegarde et la restauration (c’est-à-dire que vous ne recréez pas les volumes), les dossiers montés restaurés et les points d’analyse doivent pointer vers les volumes appropriés.</span><span class="sxs-lookup"><span data-stu-id="0ce17-136">If the volume names persist between backup and restore—that is, you do not re-create the volumes—restored mounted folders and reparse points should point to the correct volumes.</span></span>

<span data-ttu-id="0ce17-137">Par conséquent, dans l’exemple ci-dessus, si le dossier monté C : \\ WriterData \\ Archive a été restauré sur ( \\ \\ ? \\ Le volume {GUID \_ 1}) et le volume précédemment associé ont été restaurés à ( \\ \\ ? \\ Volume {GUID \_ 2}), les fichiers et la structure de fichiers restaurés sont corrects et cohérents.</span><span class="sxs-lookup"><span data-stu-id="0ce17-137">Therefore, in the example discussed above, if the mounted folder C:\\WriterData\\Archive was restored to (\\\\?\\Volume{GUID\_1}) and the volume previously associated with it was restored to (\\\\?\\Volume{GUID\_2}), the restored files and file structure would be correct and consistent.</span></span>

<span data-ttu-id="0ce17-138">Il se peut que les données soient restaurées sur un système où les noms de volume changent.</span><span class="sxs-lookup"><span data-stu-id="0ce17-138">It may happen that data is restored to a system where volume names changed.</span></span> <span data-ttu-id="0ce17-139">Cela peut être dû à des pannes de disque, dans lesquelles vous devrez peut-être effectuer une récupération manuelle du système et recréer des volumes.</span><span class="sxs-lookup"><span data-stu-id="0ce17-139">This could be due to disk crashes, where you might need to perform a manual system recovery and re-create volumes.</span></span> <span data-ttu-id="0ce17-140">Dans ce type de situation, les dossiers montés et les points d’analyse ne seront plus valides après la restauration.</span><span class="sxs-lookup"><span data-stu-id="0ce17-140">In this type of situation, mounted folders and reparse points will no longer be valid after restore.</span></span> <span data-ttu-id="0ce17-141">Pour recréer les fichiers et la structure de fichiers sur le volume restauré, vous devez supprimer les dossiers montés et les points d’analyse restaurés, puis les recréer sur le disque.</span><span class="sxs-lookup"><span data-stu-id="0ce17-141">To re-create the files and file structure on the restored volume will require deleting the restored mounted folders and reparse points and re-creating them on disk.</span></span> <span data-ttu-id="0ce17-142">C’est à l’application de sauvegarde de décider si cela est approprié.</span><span class="sxs-lookup"><span data-stu-id="0ce17-142">It is up to the backup application to decide whether this is appropriate.</span></span>

<span data-ttu-id="0ce17-143">Notez qu’il est possible que la destination de restauration d’un dossier monté soit déjà occupée.</span><span class="sxs-lookup"><span data-stu-id="0ce17-143">Note that it is possible that the restore destination for a mounted folder is already occupied.</span></span> <span data-ttu-id="0ce17-144">Par exemple, l’archive C : \\ WriterData \\ contient peut-être déjà certains fichiers.</span><span class="sxs-lookup"><span data-stu-id="0ce17-144">For example, C:\\WriterData\\Archive might already contain some files.</span></span> <span data-ttu-id="0ce17-145">C’est à l’application de sauvegarde de décider comment gérer cette situation.</span><span class="sxs-lookup"><span data-stu-id="0ce17-145">It is up to the backup application to decide how to handle this situation.</span></span>

 

 



