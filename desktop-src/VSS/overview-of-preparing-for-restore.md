---
description: Lors de la préparation d’une restauration, un demandeur utilise les documents de métadonnées de l’enregistreur stocké conjointement avec son propre document de composants de sauvegarde récupérés pour déterminer ce qui doit être restauré et comment.
ms.assetid: 36cf188f-fce6-467c-a200-cbd9dc8f31a6
title: Vue d’ensemble de la préparation pour la restauration
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d8b1bc3e429da5be9872e8345fe6da32a5340005
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106534465"
---
# <a name="overview-of-preparing-for-restore"></a><span data-ttu-id="339ce-103">Vue d’ensemble de la préparation pour la restauration</span><span class="sxs-lookup"><span data-stu-id="339ce-103">Overview of Preparing for Restore</span></span>

<span data-ttu-id="339ce-104">Lors de la préparation d’une restauration, un demandeur utilise les documents de métadonnées de l’enregistreur stocké conjointement avec son propre document de composants de sauvegarde récupérés pour déterminer ce qui doit être restauré et comment.</span><span class="sxs-lookup"><span data-stu-id="339ce-104">In preparing for a restore, a requester uses the stored Writer Metadata Documents in conjunction with its own retrieved Backup Components Document to determine what is to be restored and how.</span></span> <span data-ttu-id="339ce-105">Pour plus d’informations, consultez [vue d’ensemble du traitement d’une restauration sous VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="339ce-105">For more information, see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="339ce-106">Après la sélection des composants candidats à la restauration, les enregistreurs en cours d’exécution sur le système accèdent au document des composants de sauvegarde du demandeur.</span><span class="sxs-lookup"><span data-stu-id="339ce-106">Following the selection of restore candidate components, writers currently running on the system access the requester's Backup Components Document.</span></span> <span data-ttu-id="339ce-107">Les enregistreurs utilisent cet accès pour indiquer comment entraîner une difficulté minimale pour l’exécution des services en raison de la restauration.</span><span class="sxs-lookup"><span data-stu-id="339ce-107">Writers use this access to indicate how to cause minimum difficulty for running services due to the restore.</span></span>

<span data-ttu-id="339ce-108">Une fois cette opération terminée, le demandeur dispose de suffisamment d’informations pour déterminer les fichiers qui devront être restaurés, ainsi que l’emplacement et la manière dont ils doivent être restaurés.</span><span class="sxs-lookup"><span data-stu-id="339ce-108">After this is completed, the requester has enough information to determine which files will need to be restored, as well as where and how they should be restored.</span></span> <span data-ttu-id="339ce-109">(Pour plus d’informations, consultez [génération d’un jeu de restauration](generating-a-restore-set.md).)</span><span class="sxs-lookup"><span data-stu-id="339ce-109">(For more information, see [Generating a Restore Set](generating-a-restore-set.md).)</span></span>

<span data-ttu-id="339ce-110">Le tableau suivant présente la séquence des actions et des événements qui sont nécessaires à la préparation d’une opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="339ce-110">The following table shows the sequence of actions and events that are required to prepare for a restore operation.</span></span>



| <span data-ttu-id="339ce-111">Action du demandeur</span><span class="sxs-lookup"><span data-stu-id="339ce-111">Requester action</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | <span data-ttu-id="339ce-112">Événement</span><span class="sxs-lookup"><span data-stu-id="339ce-112">Event</span></span>                                                         | <span data-ttu-id="339ce-113">Action d’écriture</span><span class="sxs-lookup"><span data-stu-id="339ce-113">Writer action</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="339ce-114">Récupérez des informations à partir du document sur les composants de sauvegarde à propos des composants [*explicitement inclus*](vssgloss-e.md) dans l’opération de sauvegarde (voir [**IVssBackupComponents :: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)) Examinez les documents de métadonnées de l’enregistreur récupéré pour obtenir des détails sur les composants inclus explicitement dans la sauvegarde, ainsi que tous les sous-composants de Find [*implicitement inclus*](vssgloss-i.md) .</span><span class="sxs-lookup"><span data-stu-id="339ce-114">Retrieve information from the Backup Components Document about the components [*explicitly included*](vssgloss-e.md) in the backup operation (see [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)) Examine retrieved Writer Metadata Documents to get details about those components explicitly included in the backup, and any find [*implicitly included*](vssgloss-i.md) subcomponents.</span></span> <span data-ttu-id="339ce-115">(Consultez [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent).)</span><span class="sxs-lookup"><span data-stu-id="339ce-115">(See [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent).)</span></span><br/> | <span data-ttu-id="339ce-116">Aucune</span><span class="sxs-lookup"><span data-stu-id="339ce-116">None</span></span>                                                          | <span data-ttu-id="339ce-117">Aucune</span><span class="sxs-lookup"><span data-stu-id="339ce-117">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <span data-ttu-id="339ce-118">Sélectionnez les composants et les ensembles de composants à restaurer (consultez [**IVssBackupComponents :: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) et [**IVssBackupComponents :: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).)</span><span class="sxs-lookup"><span data-stu-id="339ce-118">Select components and component sets to be restored (see [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) and [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).)</span></span>                                                                                                                                                                                                                                                                                                                                                                                          | <span data-ttu-id="339ce-119">Aucune</span><span class="sxs-lookup"><span data-stu-id="339ce-119">None</span></span>                                                          | <span data-ttu-id="339ce-120">Aucune</span><span class="sxs-lookup"><span data-stu-id="339ce-120">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <span data-ttu-id="339ce-121">Le demandeur permet à l’enregistreur de mettre à jour le document des composants de sauvegarde et peut éventuellement communiquer des options de restauration spéciales à l’enregistreur.</span><span class="sxs-lookup"><span data-stu-id="339ce-121">The requester allows the writer to update the Backup Components Document and may optionally communicate any special restore options to the writer.</span></span> <span data-ttu-id="339ce-122">(Consultez [**IVssBackupComponents :: SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**IVssBackupComponents :: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)et [**IVssBackupComponents ::P Restore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).)</span><span class="sxs-lookup"><span data-stu-id="339ce-122">(See [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget), and [**IVssBackupComponents::PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).)</span></span>                                                                                                                                                                                                                                         | [<span data-ttu-id="339ce-123">*Prérestauration*</span><span class="sxs-lookup"><span data-stu-id="339ce-123">*PreRestore*</span></span>](vssgloss-p.md) | <span data-ttu-id="339ce-124">L’enregistreur détermine la participation à la restauration, prépare les fichiers à restaurer et éventuellement modifie le document des composants de sauvegarde, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="339ce-124">The writer determines participation in the restore, prepares files to restore, and optionally modifies Backup Components Document if necessary.</span></span> <span data-ttu-id="339ce-125">(Consultez [**CVssWriter :: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent :: IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**IVssComponent :: GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent :: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent :: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent :: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).)</span><span class="sxs-lookup"><span data-stu-id="339ce-125">(See [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent::IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**IVssComponent::GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).)</span></span> |
| <span data-ttu-id="339ce-126">Le demandeur attend les enregistreurs pour gérer l’événement de [**prérestauration**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) avec [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="339ce-126">The requester waits on writers to handle the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event with [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span> <span data-ttu-id="339ce-127">Il doit également vérifier l’état de l’enregistreur.</span><span class="sxs-lookup"><span data-stu-id="339ce-127">It should also verify writer status.</span></span> <span data-ttu-id="339ce-128">(Consultez [**IVssBackupComponents :: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents :: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).)</span><span class="sxs-lookup"><span data-stu-id="339ce-128">(See [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).)</span></span>                                                                                                                                                                                                                                                                                  | <span data-ttu-id="339ce-129">Aucune</span><span class="sxs-lookup"><span data-stu-id="339ce-129">None</span></span>                                                          | <span data-ttu-id="339ce-130">Aucune</span><span class="sxs-lookup"><span data-stu-id="339ce-130">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |



 

## <a name="requester-actions-during-restore-preparations"></a><span data-ttu-id="339ce-131">Actions du demandeur pendant les préparatifs de restauration</span><span class="sxs-lookup"><span data-stu-id="339ce-131">Requester Actions during Restore Preparations</span></span>

<span data-ttu-id="339ce-132">Pour déterminer quels sont les composants candidats à la restauration, le demandeur doit effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="339ce-132">To determine which components are candidates for restore, the requester must do the following:</span></span>

-   <span data-ttu-id="339ce-133">Établissez le composant et la structure du [*jeu de composants*](vssgloss-c.md) utilisée pour effectuer la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="339ce-133">Establish the component and the [*component set*](vssgloss-c.md) structure used to make the backup.</span></span>
-   <span data-ttu-id="339ce-134">Examinez la [*sélectivité des composants pour la restauration*](vssgloss-s.md).</span><span class="sxs-lookup"><span data-stu-id="339ce-134">Examine the components' [*selectability for restore*](vssgloss-s.md).</span></span>
-   <span data-ttu-id="339ce-135">Utilisez les instructions de sélectivité (utilisation de la[sélectivité pour la restauration et](working-with-selectability-for-restore-and-subcomponents.md)les sous-composants) pour choisir les composants à inclure.</span><span class="sxs-lookup"><span data-stu-id="339ce-135">Use selectability guidelines ([Working with Selectability for Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md)) to choose components to include.</span></span>
-   <span data-ttu-id="339ce-136">Utilisez les informations du [*jeu de fichiers*](vssgloss-f.md) du composant pour déterminer quels fichiers sur le support de sauvegarde doivent être restaurés.</span><span class="sxs-lookup"><span data-stu-id="339ce-136">Use component [*file set*](vssgloss-f.md) information to determine which files on the backup media must be restored.</span></span>

<span data-ttu-id="339ce-137">Pour ce faire, le demandeur doit examiner les composants [*inclus explicitement*](vssgloss-e.md) dans le document des composants de sauvegarde stocké.</span><span class="sxs-lookup"><span data-stu-id="339ce-137">To do this, the requester needs to examine [*explicitly included*](vssgloss-e.md) components in the stored Backup Components Document.</span></span> <span data-ttu-id="339ce-138">Ces informations sur les composants sont disponibles à la base de l’enregistreur à l’aide de [**IVssBackupComponents :: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents), qui retourne des instances de l’interface [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , à partir desquelles les informations de Writer et les instances de l’interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) peuvent être récupérées.</span><span class="sxs-lookup"><span data-stu-id="339ce-138">This component information is available on a writer-by-writer basis using [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents), which returns instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, from which both writer information and instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface can be retrieved.</span></span>

<span data-ttu-id="339ce-139">Comme indiqué ailleurs ([à l’aide de composants par le demandeur](use-of-components-by-the-requestor.md)), le document sur les composants de sauvegarde et l’interface **IVssComponent** ne contiennent pas suffisamment d’informations pour prendre en charge la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="339ce-139">As noted elsewhere ([Use of Components by the Requester](use-of-components-by-the-requestor.md)), the Backup Components Document and the **IVssComponent** interface do not contain enough information to support the backup.</span></span> <span data-ttu-id="339ce-140">Par conséquent, le demandeur doit examiner le document de métadonnées de l’enregistreur stocké correspondant à l’aide de [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) (consultez les [informations d’identification du rédacteur](writer-metadata-document-contents.md)).</span><span class="sxs-lookup"><span data-stu-id="339ce-140">Therefore, the requester must examine the corresponding stored Writer Metadata Document by using [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) (see [Writer Identification Information](writer-metadata-document-contents.md)).</span></span>

<span data-ttu-id="339ce-141">Le nombre de composants gérés par chaque Writer est retourné par [**IVssExamineWriterMetadata :: GetFileCounts**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts).</span><span class="sxs-lookup"><span data-stu-id="339ce-141">The number of components each writer manages is returned by [**IVssExamineWriterMetadata::GetFileCounts**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts).</span></span> <span data-ttu-id="339ce-142">Le demandeur peut ensuite utiliser [**IVssExamineWriterMetadata :: GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) pour obtenir une interface [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) pour chaque composant géré par un enregistreur.</span><span class="sxs-lookup"><span data-stu-id="339ce-142">The requester can then use [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) to get an [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) interface for each component a writer manages.</span></span>

<span data-ttu-id="339ce-143">En examinant la [*sélectivité des composants pour la sauvegarde*](vssgloss-s.md) et les [*chemins logiques*](vssgloss-l.md) (voir [utilisation de la sélectivité et des chemins logiques](working-with-selectability-and-logical-paths.md)), un demandeur est en mesure d’identifier les composants qui ont défini les jeux de composants de sauvegarde (composants inclus explicitement) et les membres des sous-composants de ces ensembles (composants inclus implicitement).</span><span class="sxs-lookup"><span data-stu-id="339ce-143">By examining the components' [*selectability for backup*](vssgloss-s.md) and [*logical paths*](vssgloss-l.md) (see [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md)), a requester is able to identify the components that defined backup-time component sets (explicitly included components), and the subcomponents members of those sets (implicitly included components).</span></span>

<span data-ttu-id="339ce-144">Les demandeurs indiquent par le biais du document sur les composants de sauvegarde si un composant doit être restauré explicitement, à l’aide de [**IVssBackupComponents :: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) ou [**IVssBackupComponents :: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).</span><span class="sxs-lookup"><span data-stu-id="339ce-144">Requesters indicate through the Backup Components Document if a component is to be explicitly restored, using either [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) or [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).</span></span> <span data-ttu-id="339ce-145">Le choix de la méthode dépend de la manière dont le composant a été sauvegardé à l’origine et [*de sa sélectivité pour la restauration*](vssgloss-s.md).</span><span class="sxs-lookup"><span data-stu-id="339ce-145">The choice of method will depend on how the component was originally backed up and its [*selectability for restore*](vssgloss-s.md).</span></span> <span data-ttu-id="339ce-146">Ces composants inclus explicitement pour la restauration désignent d’autres composants inclus implicitement (voir utilisation de la [sélectivité pour la restauration et](working-with-selectability-for-restore-and-subcomponents.md) des sous-composants pour plus d’informations).</span><span class="sxs-lookup"><span data-stu-id="339ce-146">These components explicitly included for restore designate other components which are implicitly included (see [Working with Selectability for Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md) for details).</span></span>

<span data-ttu-id="339ce-147">Un demandeur peut inclure explicitement aucun des composants de l’enregistreur en cours d’exécution pour la restauration à l’aide de [**IVssBackupComponents :: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) ou [**IVssBackupComponents :: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).</span><span class="sxs-lookup"><span data-stu-id="339ce-147">A requester may explicitly include none of a currently executing writer's components for restore using [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) or [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).</span></span> <span data-ttu-id="339ce-148">Dans ce cas, ce writer ne recevra aucun événement VSS pour le reste de l’opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="339ce-148">In this case, that writer will not receive any VSS events for the remainder of the restore operation.</span></span>

<span data-ttu-id="339ce-149">L’utilisation explicite de [**IVssBackupComponents :: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) ou de [**IVssBackupComponents :: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) pour sélectionner un composant d’un writer qui n’est pas en cours d’exécution retourne une \_ \_ erreur objet VSS E \_ \_ introuvable.</span><span class="sxs-lookup"><span data-stu-id="339ce-149">Explicitly using either [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) or [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) to select a component of a writer that is not currently running returns a VSS\_E\_OBJECT\_NOT\_FOUND error.</span></span> <span data-ttu-id="339ce-150">Pour plus d’informations sur la restauration des données des enregistreurs manquants, consultez restaurations [sans participation au rédacteur](restores-without-writer-participation.md) .</span><span class="sxs-lookup"><span data-stu-id="339ce-150">See [Restores without Writer Participation](restores-without-writer-participation.md) for information on restoring the data of missing writers.</span></span>

<span data-ttu-id="339ce-151">Pour permettre à un enregistreur d’avoir des informations complètes sur lesquelles agir, les options de restauration spécifiques à l’enregistreur et l’indication d’une restauration incrémentielle peuvent être envoyées aux enregistreurs par les appels du demandeur à [**IVssBackupComponents :: SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) et [**IVssBackupComponents :: SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores), respectivement.</span><span class="sxs-lookup"><span data-stu-id="339ce-151">To enable a writer to have complete information upon which to act, writer-specific restore options and indication of an incremental restore can be sent to the writers by requester calls to [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) and [**IVssBackupComponents::SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores), respectively.</span></span>

<span data-ttu-id="339ce-152">À ce stade, un demandeur a terminé sa préparation et génère un événement de **prérestauration** en appelant [**IVssBackupComponents ::P Restore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), ce qui permet aux rédacteurs de se préparer pour la restauration réelle.</span><span class="sxs-lookup"><span data-stu-id="339ce-152">At this point, a requester has finished its preparation, and it generates a **PreRestore** event by calling [**IVssBackupComponents::PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), allowing writers to prepare for the actual restore.</span></span>

## <a name="writer-actions-during-restore-preparations"></a><span data-ttu-id="339ce-153">Actions d’écriture pendant les préparatifs de restauration</span><span class="sxs-lookup"><span data-stu-id="339ce-153">Writer Actions during Restore Preparations</span></span>

<span data-ttu-id="339ce-154">La préparation de l’enregistreur pour l’opération de restauration se produit lors de la gestion de l’événement de [**prérestauration**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) avec la méthode virtuelle [**CVssWriter :: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore).</span><span class="sxs-lookup"><span data-stu-id="339ce-154">Writer preparation for the restore operation occurs when handling the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event with the virtual method [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore).</span></span> <span data-ttu-id="339ce-155">L’implémentation par défaut retourne simplement sans entreprendre aucune action.</span><span class="sxs-lookup"><span data-stu-id="339ce-155">The default implementation simply returns without taking any action.</span></span> <span data-ttu-id="339ce-156">Les enregistreurs peuvent choisir de substituer l’implémentation par défaut pour exercer davantage de contrôle :</span><span class="sxs-lookup"><span data-stu-id="339ce-156">Writers may choose to override the default implementation to exercise more control by:</span></span>

-   <span data-ttu-id="339ce-157">Substitution des [*méthodes de restauration*](vssgloss-r.md) avec les [*cibles de restauration*](vssgloss-r.md)</span><span class="sxs-lookup"><span data-stu-id="339ce-157">Overriding [*restore methods*](vssgloss-r.md) with [*restore targets*](vssgloss-r.md)</span></span>
-   <span data-ttu-id="339ce-158">Définition des [ *cibles dirigées*](vssgloss-d.md)</span><span class="sxs-lookup"><span data-stu-id="339ce-158">Defining [*directed targets*](vssgloss-d.md)</span></span>
-   <span data-ttu-id="339ce-159">Création de messages d’erreur et de données supplémentaires</span><span class="sxs-lookup"><span data-stu-id="339ce-159">Creating error messages and additional data</span></span>
-   <span data-ttu-id="339ce-160">Indication des informations de tampon de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="339ce-160">Supplying backup stamp information</span></span>

<span data-ttu-id="339ce-161">Le gestionnaire d’événements [**CVssWriter :: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) reçoit une instance du [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), à partir de laquelle il peut obtenir des interfaces [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) pour ceux de ses composants explicitement inclus dans le document des composants de sauvegarde lors de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="339ce-161">The event handler [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) receives an instance of the [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), from which it can obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interfaces for those of its components explicitly included in the Backup Components Document during backup.</span></span>

<span data-ttu-id="339ce-162">Informations sur les sous-composants inclus implicitement dans les opérations de sauvegarde et inclus explicitement dans les restaurations à l’aide d’une instance du **IVssComponent** correspondant au composant qui a défini son [*jeu de composants*](vssgloss-c.md)de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="339ce-162">Information about subcomponents implicitly included in backup operations and explicitly included in restores by using an instance of the **IVssComponent** corresponding to the component that defined its backup [*component set*](vssgloss-c.md).</span></span>

<span data-ttu-id="339ce-163">La méthode [**IVssComponent :: IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) est utilisée pour déterminer si un composant explicitement inclus pour la sauvegarde doit être restauré.</span><span class="sxs-lookup"><span data-stu-id="339ce-163">The [**IVssComponent::IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) method is used to determine whether an explicitly included for backup component is to be restored.</span></span>

<span data-ttu-id="339ce-164">Pour déterminer si un sous-composant de sauvegarde a été inclus explicitement dans la restauration, les enregistreurs utilisent [**IVssComponent :: GetRestoreSubcomponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).</span><span class="sxs-lookup"><span data-stu-id="339ce-164">To determine if a backup subcomponent was explicitly included in the restore, writers use [**IVssComponent::GetRestoreSubcomponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).</span></span>

<span data-ttu-id="339ce-165">L’enregistreur doit examiner le [*jeu de fichiers*](vssgloss-f.md) dans chaque composant et déterminer s’il doit prendre des mesures pour prendre en charge la restauration.</span><span class="sxs-lookup"><span data-stu-id="339ce-165">The writer should examine the [*file set*](vssgloss-f.md) in each component and determine if it needs to take actions to support the restore.</span></span> <span data-ttu-id="339ce-166">Le writer devra évaluer s’il souhaite que ses fichiers actuels soient remplacés, ou s’il nécessite la restauration vers de nouveaux emplacements.</span><span class="sxs-lookup"><span data-stu-id="339ce-166">The writer will need to evaluate if it wants its current files overwritten, or if it will require restoration to new locations.</span></span> <span data-ttu-id="339ce-167">Les actions peuvent inclure les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="339ce-167">Actions can include the following:</span></span>

-   <span data-ttu-id="339ce-168">Obtention et action des options spécifiques du writer ou du demandeur régissant les opérations de restauration (voir [**IVssComponent :: GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions))</span><span class="sxs-lookup"><span data-stu-id="339ce-168">Getting and acting on any writer- or requester-specific options governing restore operations (see [**IVssComponent::GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions))</span></span>
-   <span data-ttu-id="339ce-169">Fermer et rendre accessibles en écriture les fichiers actuellement ouverts</span><span class="sxs-lookup"><span data-stu-id="339ce-169">Closing and making writable any currently open files</span></span>
-   <span data-ttu-id="339ce-170">Mise à jour de la cible de restauration (par exemple, pour forcer la restauration vers un autre mappage d’emplacement).</span><span class="sxs-lookup"><span data-stu-id="339ce-170">Updating the restore target (for instance, to force restoration to an alternate location mapping).</span></span> <span data-ttu-id="339ce-171">Consultez [**IVssComponent :: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget).</span><span class="sxs-lookup"><span data-stu-id="339ce-171">See [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget).</span></span>
-   <span data-ttu-id="339ce-172">Communication avec le demandeur via des métadonnées privées (voir [**IVssComponent :: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))</span><span class="sxs-lookup"><span data-stu-id="339ce-172">Communicating with the requester via private metadata (see [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))</span></span>
-   <span data-ttu-id="339ce-173">Indiquant qu’un fichier doit être restauré par remappage via la définition des [*cibles dirigées*](vssgloss-d.md) (consultez [**IVssComponent :: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget))</span><span class="sxs-lookup"><span data-stu-id="339ce-173">Indicating that a file should be restored by remapping through the definition of [*directed targets*](vssgloss-d.md) (see [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget))</span></span>

<span data-ttu-id="339ce-174">L’instance de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) utilisée est celle créée par l’inclusion explicite du composant dans le document des composants de sauvegarde pendant la sauvegarde, ou celle du composant définissant le jeu de composants de sauvegarde dont il était membre (voir utilisation de la [sélectivité pour la restauration et](working-with-selectability-for-restore-and-subcomponents.md)les sous-composants).</span><span class="sxs-lookup"><span data-stu-id="339ce-174">The instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) used will either be that created by the component's explicit inclusion in the Backup Components Document during backup, or that of the component defining the backup component set of which it was a member (see [Working with Selectability For Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md)).</span></span>

 

 
