---
description: 'Les événements d’abandon peuvent être générés au cours d’une opération de sauvegarde dans l’un des cas suivants :'
ms.assetid: c2e39cdd-0ff8-4030-9bec-9e003b4d9520
title: Abandon des opérations VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 35e4b82ba4227dfeb02e3da91c9bc1e77f10f492
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106523244"
---
# <a name="aborting-vss-operations"></a><span data-ttu-id="dbdba-103">Abandon des opérations VSS</span><span class="sxs-lookup"><span data-stu-id="dbdba-103">Aborting VSS Operations</span></span>

<span data-ttu-id="dbdba-104">Les événements d' [*abandon*](vssgloss-a.md) peuvent être générés au cours d’une opération de sauvegarde dans l’un des cas suivants :</span><span class="sxs-lookup"><span data-stu-id="dbdba-104">[*Abort*](vssgloss-a.md) events can be generated during a backup operation in any of the following cases:</span></span>

-   <span data-ttu-id="dbdba-105">Un demandeur génère explicitement un [*événement d’abandon*](vssgloss-a.md) en appelant [**IVssBackupComponents :: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span><span class="sxs-lookup"><span data-stu-id="dbdba-105">A requester explicitly generates an [*Abort event*](vssgloss-a.md) by calling [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span></span>
-   <span data-ttu-id="dbdba-106">Les gestionnaires d’événements [*Freeze*](vssgloss-f.md) et [*dégeler*](vssgloss-t.md) d’un enregistreur [**(CVssWriter :: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) et [**CVssWriter :: OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) retournent la **valeur false** ou ne peuvent pas se terminer dans la fenêtre de temps spécifiée dans [**CVssWriter :: Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize).</span><span class="sxs-lookup"><span data-stu-id="dbdba-106">A writer's [*Freeze*](vssgloss-f.md) and [*Thaw*](vssgloss-t.md) event handlers ([**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) and [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) return **false**, or cannot complete in the time window specified in [**CVssWriter::Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize).</span></span>
-   <span data-ttu-id="dbdba-107">Le fournisseur ou VSS n’a pas pu être créé lors de la création d’un cliché instantané à la suite de l’événement [*PrepareForSnapshot*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="dbdba-107">There is any failure of the provider or VSS during the creation of a shadow copy following the [*PrepareForSnapshot*](vssgloss-p.md) event.</span></span>

<span data-ttu-id="dbdba-108">Les abandons ne sont pas pris en charge pour les opérations de restauration.</span><span class="sxs-lookup"><span data-stu-id="dbdba-108">Aborts are not supported for restore operations.</span></span>

## <a name="requester-handling-and-creation-of-abort-events"></a><span data-ttu-id="dbdba-109">Traitement des demandeurs et création d’événements d’abandon</span><span class="sxs-lookup"><span data-stu-id="dbdba-109">Requester Handling and Creation of Abort Events</span></span>

<span data-ttu-id="dbdba-110">Une instance de l’interface [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) peut être utilisée pour une seule sauvegarde. par conséquent, si une erreur se produit lors du traitement d’une sauvegarde, il est généralement préférable de libérer l’instance actuelle et de recommencer.</span><span class="sxs-lookup"><span data-stu-id="dbdba-110">An instance of the [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface can be used for only one backup, so if an error occurs in processing a backup it is generally best to release the current instance and start over.</span></span>

<span data-ttu-id="dbdba-111">Un demandeur doit signaler explicitement qu’il abandonne une opération de sauvegarde (à l’aide de [**IVssBackupComponents :: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) uniquement après la préparation réelle d’une sauvegarde, impliquant des enregistreurs ou la création d’un cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="dbdba-111">A requester should explicitly signal that it is aborting a backup operation (using [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) only after the actual preparation for a backup, involving writers, or the creation of a shadow copy has taken place.</span></span>

<span data-ttu-id="dbdba-112">Concrètement, cela signifie que chaque fois qu’un demandeur doit arrêter une opération de sauvegarde après avoir généré un événement [*PrepareForBackup*](vssgloss-p.md) en appelant [**IVssBackupComponents ::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), il doit appeler [**IVssBackupComponents :: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) et attendre son retour avant de libérer l’instance [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) actuelle.</span><span class="sxs-lookup"><span data-stu-id="dbdba-112">Effectively, this means that any time a requester needs to stop a backup operation after generating a [*PrepareForBackup*](vssgloss-p.md) event by calling [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), it should call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) and await its return prior to releasing the current [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) instance.</span></span>

<span data-ttu-id="dbdba-113">Par exemple, si un enregistreur a refusé une opération de sauvegarde, un demandeur doit utiliser [**IVssBackupComponents :: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) pour notifier à tous les autres enregistreurs que l’opération de sauvegarde ne sera pas effectuée.</span><span class="sxs-lookup"><span data-stu-id="dbdba-113">For example, if a writer vetoed a backup operation, a requester should use [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) to notify all other writers that the backup operation will not be completed.</span></span>

<span data-ttu-id="dbdba-114">Avant d’appeler [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), ou si l’appel à **PrepareForBackup** échoue, un demandeur peut libérer l’instance actuelle de l’interface [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) sans avoir à générer un événement d’abandon.</span><span class="sxs-lookup"><span data-stu-id="dbdba-114">Prior to calling [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), or if the call to **PrepareForBackup** fails, a requester can release the current instance of the [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface without needing to generate an Abort event.</span></span>

<span data-ttu-id="dbdba-115">Par exemple, si l’instance actuelle de [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) est utilisée uniquement pour obtenir des informations en appelant [**IVSSBackupComponents :: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) et en générant un événement d' [*identification*](vssgloss-i.md) , une fois que les informations ont été retournées, l’instance de **IVSSBackupComponents** peut simplement être libérée.</span><span class="sxs-lookup"><span data-stu-id="dbdba-115">For example, if the current instance of [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) is being used merely to obtain information by calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) and generating an [*Identify*](vssgloss-i.md) event, once information has been returned the instance of **IVSSBackupComponents** can simply be released.</span></span>

<span data-ttu-id="dbdba-116">Un demandeur génère un certain nombre d’événements ([*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*dégeler*](vssgloss-t.md)et [*PostSnapshot*](vssgloss-p.md)) lorsqu’il appelle [**IVssBackupComponents ::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="dbdba-116">A requester generates a number of events ([*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), and [*PostSnapshot*](vssgloss-p.md)) when it calls [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="dbdba-117">Lors de la gestion des événements Freeze et dégeler, un enregistreur peut échouer et générer un événement d’abandon seul.</span><span class="sxs-lookup"><span data-stu-id="dbdba-117">While handling the Freeze and Thaw events, a writer may fail and can generate an Abort event on its own.</span></span> <span data-ttu-id="dbdba-118">L’échec de la gestion des événements PrepareForSnapshot et PostSnapshot ne génère pas d’événement d’abandon.</span><span class="sxs-lookup"><span data-stu-id="dbdba-118">Failure to handle PrepareForSnapshot and PostSnapshot events does not generate an Abort event.</span></span>

<span data-ttu-id="dbdba-119">Il n’est pas toujours possible pour un demandeur de savoir si un événement d’abandon a été généré quand [**IVssBackupComponents ::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) indique un échec.</span><span class="sxs-lookup"><span data-stu-id="dbdba-119">It is not always possible for a requester to know if an Abort event was generated when [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) indicates failure.</span></span> <span data-ttu-id="dbdba-120">Par conséquent, un demandeur qui doit mettre fin à une opération de sauvegarde, car l’état de **IVssBackupComponents ::D osnapshotset** indique qu’un problème doit toujours appeler [**IVssBackupComponents :: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span><span class="sxs-lookup"><span data-stu-id="dbdba-120">Therefore, a requester that needs to terminate a backup operation because the status of **IVssBackupComponents::DoSnapshotSet** indicates a problem should still call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span></span>

<span data-ttu-id="dbdba-121">Si un demandeur a appelé [**IVssBackupComponents :: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup), il n’est pas nécessaire d’appeler [**IVssBackupComponents :: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) avant de libérer une instance de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="dbdba-121">If a requester has called [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup), it is not necessary to call [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) prior to releasing an instance of [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span></span>

## <a name="writer-handling-and-creation-of-abort-events"></a><span data-ttu-id="dbdba-122">Gestion de l’enregistreur et création d’événements d’abandon</span><span class="sxs-lookup"><span data-stu-id="dbdba-122">Writer Handling and Creation of Abort Events</span></span>

<span data-ttu-id="dbdba-123">Comme indiqué précédemment, un enregistreur peut recevoir un événement d’abandon d’un demandeur, ou le fournisseur peut déclencher un événement lui-même.</span><span class="sxs-lookup"><span data-stu-id="dbdba-123">As noted previously, a writer can receive an Abort event from a requester, or the provider can trigger one itself.</span></span> <span data-ttu-id="dbdba-124">En outre, il est possible pour un enregistreur de recevoir plusieurs événements d’abandon dans certaines circonstances.</span><span class="sxs-lookup"><span data-stu-id="dbdba-124">Also, it is possible for a writer to receive multiple Abort events under certain circumstances.</span></span> <span data-ttu-id="dbdba-125">Les développeurs d’enregistreur doivent coder toute implémentation de [**CVssWriter :: OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) en tenant compte de cela.</span><span class="sxs-lookup"><span data-stu-id="dbdba-125">Writer developers should code any implementation of [**CVssWriter::OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) with this in mind.</span></span>

<span data-ttu-id="dbdba-126">Dans le cadre de la gestion d’un événement d’abandon, un enregistreur doit tenter de restaurer le processus qu’il a géré dans son état d’exécution normal, ainsi que d’effectuer la gestion des erreurs et la journalisation.</span><span class="sxs-lookup"><span data-stu-id="dbdba-126">In handling an Abort event, a writer should attempt to restore whatever process it managed to its normal running state, as well as perform any error handling and logging.</span></span>

<span data-ttu-id="dbdba-127">Cela peut signifier qu’une implémentation de [**CVssWriter :: OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) devra peut-être effectuer de nombreuses tâches, ou toutes, des mêmes tâches que le gestionnaire d’événements dégeler ([**CVssWriter :: OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) et le gestionnaire d’événements PostSnapshot ([**CVssWriter :: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)), et ces gestionnaires peuvent être appelés à partir de **CVssWriter :: OnAbort**.</span><span class="sxs-lookup"><span data-stu-id="dbdba-127">This may mean that an implementation of [**CVssWriter::OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) might have to perform many, if not all, of the same tasks as the Thaw event handler ([**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) and the PostSnapshot event handler ([**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)), and these handlers can be called from within **CVssWriter::OnAbort**.</span></span>

 

 



