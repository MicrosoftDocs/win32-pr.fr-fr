---
description: Lors de l’initialisation d’une opération de restauration VSS, un demandeur doit récupérer le document du composant de sauvegarde et chaque document de métadonnées de l’enregistreur approprié créé et enregistré pendant l’opération de sauvegarde.
ms.assetid: 0a087125-c9d4-460a-8153-3e2e26633ac2
title: Vue d’ensemble de l’initialisation de la restauration
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6eb62e5282a74e38cd53d36c8ba004f4b8069746
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104115154"
---
# <a name="overview-of-restore-initialization"></a><span data-ttu-id="47f33-103">Vue d’ensemble de l’initialisation de la restauration</span><span class="sxs-lookup"><span data-stu-id="47f33-103">Overview of Restore Initialization</span></span>

<span data-ttu-id="47f33-104">Lors de l’initialisation d’une opération de restauration VSS, un demandeur doit récupérer le document du composant de sauvegarde et chaque document de métadonnées de l’enregistreur approprié créé et enregistré pendant l’opération de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="47f33-104">In initializing a VSS restore operation, a requester needs to retrieve the Backup Component Document and each relevant Writer Metadata Document created and saved during the backup operation.</span></span> <span data-ttu-id="47f33-105">L’état actuel de l’enregistreur est interrogé dans le traitement de l' [*événement d’identification*](vssgloss-i.md) généré par le demandeur.</span><span class="sxs-lookup"><span data-stu-id="47f33-105">The writer will have its current state queried in handling the [*Identify event*](vssgloss-i.md) that the requester generates.</span></span> <span data-ttu-id="47f33-106">Pour plus d’informations, consultez [vue d’ensemble du traitement d’une restauration sous VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="47f33-106">For more information, see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="47f33-107">Le tableau suivant présente la séquence des actions et des événements qui sont requis pour initialiser une opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="47f33-107">The following table shows the sequence of actions and events that are required to initialize a restore operation.</span></span>



| <span data-ttu-id="47f33-108">Action du demandeur</span><span class="sxs-lookup"><span data-stu-id="47f33-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                       | <span data-ttu-id="47f33-109">Événement</span><span class="sxs-lookup"><span data-stu-id="47f33-109">Event</span></span>                                                     | <span data-ttu-id="47f33-110">Action d’écriture</span><span class="sxs-lookup"><span data-stu-id="47f33-110">Writer action</span></span>                                                                                                                                                                                                                                                                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="47f33-111">Créez une interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , initialisez-la pour gérer une restauration et chargez les métadonnées du demandeur stocké (consultez [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**IVssBackupComponents :: InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore)).</span><span class="sxs-lookup"><span data-stu-id="47f33-111">Create an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface, initialize it to manage a restore, and load stored requester metadata (see [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore)).</span></span> | <span data-ttu-id="47f33-112">Aucune</span><span class="sxs-lookup"><span data-stu-id="47f33-112">None</span></span>                                                      | <span data-ttu-id="47f33-113">Aucune</span><span class="sxs-lookup"><span data-stu-id="47f33-113">None</span></span>                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="47f33-114">Appelez [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) pour créer des interfaces [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) et les charger avec les métadonnées de l’enregistreur stocké.</span><span class="sxs-lookup"><span data-stu-id="47f33-114">Call [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) to create [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) interfaces and load them with stored writer metadata.</span></span>                                                                                                           | <span data-ttu-id="47f33-115">Aucune</span><span class="sxs-lookup"><span data-stu-id="47f33-115">None</span></span>                                                      | <span data-ttu-id="47f33-116">Aucune</span><span class="sxs-lookup"><span data-stu-id="47f33-116">None</span></span>                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="47f33-117">Lancer un contact asynchrone avec des enregistreurs (consultez [**IVssBackupComponents :: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).)</span><span class="sxs-lookup"><span data-stu-id="47f33-117">Initiate asynchronous contact with writers (see [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).)</span></span>                                                                                                                                                                      | [<span data-ttu-id="47f33-118">*Repérer*</span><span class="sxs-lookup"><span data-stu-id="47f33-118">*Identify*</span></span>](vssgloss-i.md) | <span data-ttu-id="47f33-119">L’enregistreur commence la gestion des événements à la prise en charge de la restauration.</span><span class="sxs-lookup"><span data-stu-id="47f33-119">The writer begins event handling in support of the restore.</span></span> <span data-ttu-id="47f33-120">Crée le document de métadonnées de l’enregistreur (consultez [utilisation du document de métadonnées de l’enregistreur](working-with-the-writer-metadata-document.md), [**CVssWriter :: OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata)).</span><span class="sxs-lookup"><span data-stu-id="47f33-120">Creates the Writer Metadata Document (see [Working with the Writer Metadata Document](working-with-the-writer-metadata-document.md), [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata)).</span></span> |
| <span data-ttu-id="47f33-121">Le demandeur attend que les Writers s’initialisent en appelant [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="47f33-121">The requester waits for writers to initialize by calling [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span>                                                                                                                                                                                                                               | <span data-ttu-id="47f33-122">Aucune</span><span class="sxs-lookup"><span data-stu-id="47f33-122">None</span></span>                                                      | <span data-ttu-id="47f33-123">Aucune</span><span class="sxs-lookup"><span data-stu-id="47f33-123">None</span></span>                                                                                                                                                                                                                                                                                                                      |



 

## <a name="requester-actions-during-restore-initialization"></a><span data-ttu-id="47f33-124">Actions du demandeur pendant l’initialisation de la restauration</span><span class="sxs-lookup"><span data-stu-id="47f33-124">Requester Actions during Restore Initialization</span></span>

<span data-ttu-id="47f33-125">Pendant la phase d’initialisation d’une restauration, le demandeur doit avoir accès au document des composants de sauvegarde stockés et à tous les documents de métadonnées de l’enregistreur.</span><span class="sxs-lookup"><span data-stu-id="47f33-125">During the initialization phase of a restore, the requester needs to have access to the stored Backup Components Document and all the Writer Metadata Documents.</span></span>

<span data-ttu-id="47f33-126">En fonction de l’implémentation, cela signifie soit que le demandeur exige que le support de sauvegarde soit monté et lisible, soit qu’un autre mécanisme d’accès aux métadonnées stockées soit disponible.</span><span class="sxs-lookup"><span data-stu-id="47f33-126">Depending on the implementation, this will mean either that the requester will require that backup media be mounted and readable, or that some other mechanism for accessing the stored metadata be available.</span></span>

<span data-ttu-id="47f33-127">Le demandeur utilise le document XML stocké contenant le document des composants de sauvegarde du demandeur qui a effectué la sauvegarde pour initialiser son document de composants de sauvegarde à l’aide de [**IVssBackupComponents :: InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) peut accéder aux informations.</span><span class="sxs-lookup"><span data-stu-id="47f33-127">The requester uses the stored XML document containing the Backup Components Document of the requester that performed the backup to initialize its Backup Components Document using [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) can access the information.</span></span>

<span data-ttu-id="47f33-128">Comme c’était le cas lors de la sauvegarde, le document sur les composants de sauvegarde ne dispose pas d’informations suffisantes pour prendre en charge une restauration. par conséquent, le demandeur a besoin d’accéder aux documents de métadonnées de l’enregistreur stockés pendant la sauvegarde (consultez [utilisation des composants par le demandeur](use-of-components-by-the-requestor.md)).</span><span class="sxs-lookup"><span data-stu-id="47f33-128">As was the case during the backup, the Backup Components Document has insufficient information to support a restore; therefore, the requester needs access to those Writer Metadata Documents stored during backup (see [Use of Components by the Requester](use-of-components-by-the-requestor.md)).</span></span>

<span data-ttu-id="47f33-129">Le demandeur récupère les métadonnées de l’enregistreur stocké en appelant [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) pour chaque enregistreur dont les données ont été sauvegardées et doit maintenant être restauré.</span><span class="sxs-lookup"><span data-stu-id="47f33-129">The requester retrieves the stored writer metadata by calling [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) for each writer whose data was backed up and now is to be restored.</span></span> <span data-ttu-id="47f33-130">Cette fonction crée un objet [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) pour chaque Writer et charge le document de métadonnées de l’enregistreur du writer dans l’objet.</span><span class="sxs-lookup"><span data-stu-id="47f33-130">This function creates an [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) object for each writer and loads the writer's Writer Metadata Document into the object.</span></span>

<span data-ttu-id="47f33-131">Comme c’était le cas lors de la sauvegarde, pour initier la coopération entre lui-même et les rédacteurs du système, un demandeur doit générer un événement d' [*identification*](vssgloss-i.md) en appelant [**IVssBackupComponents :: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="47f33-131">As was the case during the backup, to initiate cooperation between itself and the system's writers, a requester must generate an [*Identify*](vssgloss-i.md) event by calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="47f33-132">Il n’est pas nécessaire d’appeler [**IVssBackupComponents :: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) après l’achèvement de [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="47f33-132">It is not necessary to call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) following the completion of [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="47f33-133">Les enregistreurs qui ne parviennent pas à traiter l’événement d' [*identification*](vssgloss-i.md) ne seront pas inclus dans la liste des enregistreurs fournissant les métadonnées à retourner par [**IVssBackupComponents :: GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) et [**IVssBackupComponents :: GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (consultez Détermination de l’état de l' [enregistreur](determining-writer-status.md)).</span><span class="sxs-lookup"><span data-stu-id="47f33-133">Writers that fail to process the [*Identify*](vssgloss-i.md) event will not be included in the list of writers providing the metadata to be returned by [**IVssBackupComponents::GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) and [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (see [Determining Writer Status](determining-writer-status.md)).</span></span>

<span data-ttu-id="47f33-134">Comme pour l’opération de sauvegarde, un demandeur devra interroger et analyser les informations contenues dans le document sur les composants de sauvegarde et les comparer aux données dans les documents de métadonnées de l’enregistreur pour déterminer les composants qui ont été sauvegardés et choisir ceux à restaurer (voir [vue d’ensemble de la préparation à la restauration](overview-of-preparing-for-restore.md)).</span><span class="sxs-lookup"><span data-stu-id="47f33-134">As with the backup operation, a requester will need to query and parse the information in the Backup Components Document and compare it to data in the Writer Metadata Documents to determine which components were backed up and to choose those to be restored (see [Overview of Preparing for Restore](overview-of-preparing-for-restore.md)).</span></span> <span data-ttu-id="47f33-135">En outre, le demandeur doit générer une liste détaillée contenant des informations sur les fichiers sur le support de sauvegarde sélectionné pour la restauration, ainsi que sur la manière et l’emplacement de restauration.</span><span class="sxs-lookup"><span data-stu-id="47f33-135">In addition, the requester will need to generate a detailed list containing information about the files on the backup media selected for restore, as well as how and where they are to be restored.</span></span> <span data-ttu-id="47f33-136">(Voir [génération d’un jeu de restauration](generating-a-restore-set.md).)</span><span class="sxs-lookup"><span data-stu-id="47f33-136">(See [Generating a Restore Set](generating-a-restore-set.md).)</span></span>

<span data-ttu-id="47f33-137">Par conséquent, certaines applications de sauvegarde peuvent être utiles à stocker sur le support de sauvegarde leur propre liste (dans leur propre format optimisé) des fichiers et leur auteur, composant, procédure de restauration et informations d’emplacement associés.</span><span class="sxs-lookup"><span data-stu-id="47f33-137">Therefore, some backup applications may find it useful to have stored on the backup media their own list (in their own optimized format) of the files and their associated writer, component, restore procedure, and location information.</span></span> <span data-ttu-id="47f33-138">Cette liste peut être utilisée pour réduire la quantité d’analyses et de comparaison des documents de métadonnées de l’enregistreur et les documents du composant de sauvegarde nécessaires à la prise en charge d’une restauration.</span><span class="sxs-lookup"><span data-stu-id="47f33-138">This list can be used to minimize the amount of parsing and comparing of Writer Metadata Documents and the Backup Component Documents required to support a restore.</span></span>

## <a name="writer-actions-during-restore-initialization"></a><span data-ttu-id="47f33-139">Actions d’écriture pendant l’initialisation de la restauration</span><span class="sxs-lookup"><span data-stu-id="47f33-139">Writer Actions during Restore Initialization</span></span>

<span data-ttu-id="47f33-140">Comme c’est le cas lors d’une opération de restauration, en réponse à l’événement d’identification, VSS appelle la méthode de gestionnaire virtuelle [**CVssWriter :: OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify)de chaque enregistreur.</span><span class="sxs-lookup"><span data-stu-id="47f33-140">Just as is done during a restore operation, in response to the Identify event, VSS calls each writer's virtual handler method [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).</span></span>

<span data-ttu-id="47f33-141">Notez que les applications autres que le demandeur actuel (par exemple, les applications système) peuvent générer des événements d’identification, qui doivent être gérés par le writer.</span><span class="sxs-lookup"><span data-stu-id="47f33-141">Note that applications other than the current requester (for instance, system applications) can generate Identify events, which must be handled by the writer.</span></span> <span data-ttu-id="47f33-142">En outre, il n’existe aucun moyen pour un writer de déterminer à partir de [**CVssWriter :: OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) l’application qui a généré l’événement d’identification.</span><span class="sxs-lookup"><span data-stu-id="47f33-142">In addition, there is no way for a writer to determine from within [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) which application has generated the Identify event.</span></span>

<span data-ttu-id="47f33-143">Étant donné qu’un writer peut recevoir plusieurs événements d’identification lors du traitement d’une opération de restauration, les enregistreurs ne doivent jamais définir d’informations d’État dans le gestionnaire [**CVssWriter :: OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) .</span><span class="sxs-lookup"><span data-stu-id="47f33-143">Given that a writer may receive several Identify events while processing a restore operation, writers should never set state information in the [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) handler.</span></span> <span data-ttu-id="47f33-144">Au lieu de cela, ils doivent utiliser le même algorithme pour créer le document de métadonnées de l’enregistreur que lors des opérations de sauvegarde (pour plus d’informations, consultez [actions de l’enregistreur pendant l’initialisation](overview-of-backup-initialization.md) de la sauvegarde).</span><span class="sxs-lookup"><span data-stu-id="47f33-144">Instead, they must use the same algorithm for creating their Writer Metadata Document as was done during backup operations (see [Writer Actions during Backup Initialization](overview-of-backup-initialization.md) for more information).</span></span>

 

 



