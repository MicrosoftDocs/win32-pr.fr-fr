---
description: Un jeu de sauvegarde est une liste de tous les fichiers à sauvegarder, de leur emplacement et de la manière de les sauvegarder.
ms.assetid: 34a66a9c-c1bc-437d-b034-59dc0c88228c
title: Génération d’un jeu de sauvegarde
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 827d9ecb90ac376aa9818b61e8dab65550ff8c50
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106534208"
---
# <a name="generating-a-backup-set"></a><span data-ttu-id="b219f-103">Génération d’un jeu de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="b219f-103">Generating A Backup Set</span></span>

<span data-ttu-id="b219f-104">Un jeu de sauvegarde est une liste de tous les fichiers à sauvegarder, de leur emplacement et de la manière de les sauvegarder.</span><span class="sxs-lookup"><span data-stu-id="b219f-104">A backup set is a list of all files to be backed up, their locations, and how to back them up.</span></span>

<span data-ttu-id="b219f-105">Un demandeur doit utiliser les fichiers contenus sur les volumes clichés instantanés une fois que le [**IVssBackupComponents ::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) a réussi à générer la liste complète des fichiers à sauvegarder.</span><span class="sxs-lookup"><span data-stu-id="b219f-105">A requester must make use of the files contained on the shadow-copied volumes after the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) returns successfully to generate the full list of files to be backed up.</span></span>

<span data-ttu-id="b219f-106">En outre, un demandeur doit gérer la possibilité que certains fichiers aient [*d’autres chemins d’accès*](vssgloss-a.md) et que certains fichiers aient été exclus.</span><span class="sxs-lookup"><span data-stu-id="b219f-106">In addition, a requester must deal with the possibility that some files have [*alternate paths*](vssgloss-a.md) and that some files have been excluded.</span></span>

<span data-ttu-id="b219f-107">Un algorithme permettant de sélectionner les fichiers à sauvegarder doit être placé sur une [*instance de writer*](vssgloss-w.md) par l’instance de writer, composant par composant (comme c’est le cas lors de la restauration ; consultez [génération d’un jeu de restauration](generating-a-restore-set.md)) et peut continuer en procédant comme suit :</span><span class="sxs-lookup"><span data-stu-id="b219f-107">An algorithm for selecting files to back up should go on a [*writer instance*](vssgloss-w.md) by writer instance, component-by-component basis (as will be the case during restore; see [Generating a Restore Set](generating-a-restore-set.md)) and might proceed by doing the following:</span></span>

1.  <span data-ttu-id="b219f-108">Détermination des volumes contenant les fichiers de l’enregistreur et des objets périphériques correspondants</span><span class="sxs-lookup"><span data-stu-id="b219f-108">Determining the volumes that contain the writer's files and the corresponding device objects</span></span>
2.  <span data-ttu-id="b219f-109">À l’aide des informations sur le [*jeu de fichiers*](vssgloss-f.md) (contenues dans les objets [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) retournés par [**IVssExamineWriterMetadata :: GetExcludeFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getexcludefile)) pour créer une liste des fichiers explicitement exclus, si nécessaire, à l’aide de **FindFileFirst**, **FindFileFirstEx** et **FindNextFile**.</span><span class="sxs-lookup"><span data-stu-id="b219f-109">Using the [*file set*](vssgloss-f.md) information (contained in [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) objects returned by [**IVssExamineWriterMetadata::GetExcludeFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getexcludefile)) to create a list of the explicitly excluded files, if necessary using **FindFileFirst**, **FindFileFirstEx**, and **FindNextFile**.</span></span>
3.  <span data-ttu-id="b219f-110">Itération sur tous les composants d’un enregistreur, à l’aide de [**IVssExamineWriterMetadata :: GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent).</span><span class="sxs-lookup"><span data-stu-id="b219f-110">Iterating over all of a writer's components, using [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent).</span></span> <span data-ttu-id="b219f-111">Si un composant sélectionnable est sélectionné, utilisez le [*chemin d’accès logique*](vssgloss-l.md) pour obtenir les composants qui ne sont pas sélectionnables associés dans un jeu de composants.</span><span class="sxs-lookup"><span data-stu-id="b219f-111">If a selectable component is selected, use [*logical path*](vssgloss-l.md) to obtain those nonselectable components associated with it in a component set.</span></span> <span data-ttu-id="b219f-112">(Voir [utilisation de la sélectivité et des chemins logiques](working-with-selectability-and-logical-paths.md).)</span><span class="sxs-lookup"><span data-stu-id="b219f-112">(See [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md).)</span></span>
4.  <span data-ttu-id="b219f-113">Obtention des [*jeux de fichiers*](vssgloss-f.md) contenus dans chaque composant sélectionné à l’aide de l’interface [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) correspondant à chaque composant qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="b219f-113">Obtaining the [*file sets*](vssgloss-f.md) contained in each selected component by using the [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) interface corresponding to each component it contains.</span></span>
5.  <span data-ttu-id="b219f-114">Génération d’une liste de fichiers à partir des spécifications, si nécessaire, à l’aide de **FindFileFirst**, **FindFileFirstEx** et **FindNextFile**.</span><span class="sxs-lookup"><span data-stu-id="b219f-114">Generating a list of files from the specifications—if necessary using **FindFileFirst**, **FindFileFirstEx**, and **FindNextFile**.</span></span>
6.  <span data-ttu-id="b219f-115">Vérification de chaque fichier de la liste générée à partir des informations relatives aux composants par rapport à la liste des fichiers exclus générés ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="b219f-115">Checking each file in the list generated from component information against the list of excluded files generated above.</span></span> <span data-ttu-id="b219f-116">Cela doit être fait à l’aide du chemin d’accès par défaut pour le fichier (retourné par [**IVssWMFiledesc :: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), et non par le chemin d’accès de remplacement retourné par [**IVssWMFiledesc :: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)).</span><span class="sxs-lookup"><span data-stu-id="b219f-116">This should be done using the default path for the file (returned by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), not by the alternate path returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)).</span></span> <span data-ttu-id="b219f-117">Si le fichier correspond à la liste exclue, il ne sera pas sauvegardé.</span><span class="sxs-lookup"><span data-stu-id="b219f-117">If the file matches the excluded list, it will not be backed up.</span></span>
7.  <span data-ttu-id="b219f-118">Choix de l’emplacement réel à partir duquel effectuer la sauvegarde (en utilisant le chemin alternatif s’il a été défini)</span><span class="sxs-lookup"><span data-stu-id="b219f-118">Choosing the actual location from which to back up (using the alternate path if it was set)</span></span>
8.  <span data-ttu-id="b219f-119">À ce stade, une liste complète de fichiers et de leurs emplacements est disponible et une sauvegarde peut commencer.</span><span class="sxs-lookup"><span data-stu-id="b219f-119">At this point, a full list of files and their locations is available and a backup can begin.</span></span>

<span data-ttu-id="b219f-120">Après la génération d’un jeu de sauvegarde initial pour tous les enregistreurs présents sur le système, le demandeur vérifie ensuite la clé de Registre suivante :</span><span class="sxs-lookup"><span data-stu-id="b219f-120">After an initial backup set has been generated for all writers that are present on the system, the requester then checks the following registry key:</span></span>

<span data-ttu-id="b219f-121">**HKEY \_ local \_ machine \\ System \\ CurrentControlSet \\ Control \\ backuprestore \\ FilesNotToBackup**</span><span class="sxs-lookup"><span data-stu-id="b219f-121">**HKEY\_LOCAL\_MACHINE\\System\\CurrentControlSet\\Control\\BackupRestore\\FilesNotToBackup**</span></span>

<span data-ttu-id="b219f-122">Le demandeur utilise les sous-clés sous cette clé comme suit :</span><span class="sxs-lookup"><span data-stu-id="b219f-122">The requester uses the subkeys under this key as follows:</span></span>

-   <span data-ttu-id="b219f-123">Si un enregistreur est présent sur le système, et qu’il existe une sous-clé dont le nom correspond au nom du writer, cette sous-clé doit être ignorée.</span><span class="sxs-lookup"><span data-stu-id="b219f-123">If a writer is present on the system, and there is a subkey whose name matches the writer's name, that subkey must be ignored.</span></span>
-   <span data-ttu-id="b219f-124">Si un enregistreur est présent sur le système mais qu’il est actuellement absent du jeu de sauvegarde et qu’il existe une sous-clé correspondante, tous les fichiers spécifiés dans les données de la sous-clé sont exclus et doivent être supprimés du jeu de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="b219f-124">If a writer was present on the system but is currently absent from the backup set, and there is a matching subkey, any files specified in the subkey data are excluded and must be removed from the backup set.</span></span>
-   <span data-ttu-id="b219f-125">L’application de sauvegarde ajoute des fichiers aux données de sous-clé en créant une valeur à plusieurs \_ valeurs SZ contenant une liste de spécifications de fichiers pour les fichiers qui ne doivent pas être sauvegardés.</span><span class="sxs-lookup"><span data-stu-id="b219f-125">The backup application adds files to the subkey data by creating a MULTI\_SZ value containing a list of file specifications for the files that must not be backed up.</span></span> <span data-ttu-id="b219f-126">Chaque chaîne dans la valeur à plusieurs \_ SZ doit contenir une spécification de fichier.</span><span class="sxs-lookup"><span data-stu-id="b219f-126">Each string in the MULTI\_SZ value should contain one file specification.</span></span>
-   <span data-ttu-id="b219f-127">Les spécifications de fichier peuvent contenir le ?</span><span class="sxs-lookup"><span data-stu-id="b219f-127">File specifications can contain the ?</span></span> <span data-ttu-id="b219f-128">et les \* caractères génériques.</span><span class="sxs-lookup"><span data-stu-id="b219f-128">and \* wildcard characters.</span></span> <span data-ttu-id="b219f-129">Une spécification peut être rendue récursive en ajoutant la valeur/s à la fin.</span><span class="sxs-lookup"><span data-stu-id="b219f-129">A specification can be made recursive by appending /s to the end.</span></span> <span data-ttu-id="b219f-130">Par exemple, si vous spécifiez « % TEMP% \\ \* /s », tous les fichiers du répertoire% Temp% et de tous ses sous-répertoires ne sont pas sauvegardés.</span><span class="sxs-lookup"><span data-stu-id="b219f-130">For example, specifying "%TEMP%\\\* /s" causes all files in the %TEMP% directory and all of its subdirectories not to be backed up.</span></span>

 

 



