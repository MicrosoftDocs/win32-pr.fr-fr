---
description: Après une restauration, les rédacteurs vérifient l’état de l’opération afin de pouvoir utiliser les données restaurées et traiter les erreurs.
ms.assetid: f9def67a-c4ea-4014-929f-51fbd10d770a
title: Vue d’ensemble du nettoyage et de l’arrêt de la restauration
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 391e029cdb109589b42240b5482f6aba2ff43555
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104034344"
---
# <a name="overview-of-restore-clean-up-and-termination"></a><span data-ttu-id="b5e9b-103">Vue d’ensemble du nettoyage et de l’arrêt de la restauration</span><span class="sxs-lookup"><span data-stu-id="b5e9b-103">Overview of Restore Clean up and Termination</span></span>

<span data-ttu-id="b5e9b-104">Après une restauration, les rédacteurs vérifient l’état de l’opération afin de pouvoir utiliser les données restaurées et traiter les erreurs.</span><span class="sxs-lookup"><span data-stu-id="b5e9b-104">Following a restore, writers check the status of the operation so that they can make use of the restored data and deal with errors.</span></span> <span data-ttu-id="b5e9b-105">Le demandeur doit attendre la fin de cette activité.</span><span class="sxs-lookup"><span data-stu-id="b5e9b-105">The requester must wait for the completion of this activity.</span></span> <span data-ttu-id="b5e9b-106">Pour plus d’informations, consultez [vue d’ensemble du traitement d’une restauration sous VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="b5e9b-106">For more information, see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="b5e9b-107">Le tableau suivant présente la séquence des actions et des événements qui sont requis après l’exécution d’une opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="b5e9b-107">The following table shows the sequence of actions and events that are required after a restore operation has taken place.</span></span>



| <span data-ttu-id="b5e9b-108">Action du demandeur</span><span class="sxs-lookup"><span data-stu-id="b5e9b-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                                                                              | <span data-ttu-id="b5e9b-109">Événement</span><span class="sxs-lookup"><span data-stu-id="b5e9b-109">Event</span></span>                                                           | <span data-ttu-id="b5e9b-110">Action d’écriture</span><span class="sxs-lookup"><span data-stu-id="b5e9b-110">Writer action</span></span>                                                                                                                                                                                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="b5e9b-111">Le demandeur indique la fin de la restauration (voir [**IVssBackupComponents ::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)).</span><span class="sxs-lookup"><span data-stu-id="b5e9b-111">The requester indicates the end of the restore (see [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)).</span></span>                                                                                                                                                                                                                                           | [<span data-ttu-id="b5e9b-112">*PostRestore*</span><span class="sxs-lookup"><span data-stu-id="b5e9b-112">*PostRestore*</span></span>](vssgloss-p.md) | <span data-ttu-id="b5e9b-113">L’enregistreur effectue un nettoyage après la restauration et gère les échecs de restauration et les fichiers qui ont été restaurés à des emplacements non standard (voir [**CVssWriter :: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)).</span><span class="sxs-lookup"><span data-stu-id="b5e9b-113">The writer conducts post-restore cleanup, and handles restoration failures and files that have been restored to nonstandard locations (see [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)).</span></span> |
| <span data-ttu-id="b5e9b-114">Le demandeur attend que les enregistreurs gèrent l’événement [**postRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) avec [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="b5e9b-114">The requester waits on writers to handle the [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) event with [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span> <span data-ttu-id="b5e9b-115">Il doit également vérifier l’état de l’enregistreur (consultez [**IVssBackupComponents :: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents :: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).</span><span class="sxs-lookup"><span data-stu-id="b5e9b-115">It should also verify writer status (see [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).</span></span> | <span data-ttu-id="b5e9b-116">Aucune</span><span class="sxs-lookup"><span data-stu-id="b5e9b-116">None</span></span>                                                            | <span data-ttu-id="b5e9b-117">Aucune</span><span class="sxs-lookup"><span data-stu-id="b5e9b-117">None</span></span>                                                                                                                                                                                                                                               |
| <span data-ttu-id="b5e9b-118">Le demandeur libère l’interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) .</span><span class="sxs-lookup"><span data-stu-id="b5e9b-118">The requester releases the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface.</span></span>                                                                                                                                                                                                                                                                                    | <span data-ttu-id="b5e9b-119">Aucune</span><span class="sxs-lookup"><span data-stu-id="b5e9b-119">None</span></span>                                                            | <span data-ttu-id="b5e9b-120">Aucune</span><span class="sxs-lookup"><span data-stu-id="b5e9b-120">None</span></span>                                                                                                                                                                                                                                               |



 

## <a name="requester-actions-during-cleanup-and-termination"></a><span data-ttu-id="b5e9b-121">Actions du demandeur pendant le nettoyage et l’arrêt</span><span class="sxs-lookup"><span data-stu-id="b5e9b-121">Requester Actions during Cleanup and Termination</span></span>

<span data-ttu-id="b5e9b-122">À ce stade, un demandeur indique la fin de ses activités de restauration de fichiers en générant un événement [*postRestore*](vssgloss-p.md) en appelant [**IVssBackupComponents ::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span><span class="sxs-lookup"><span data-stu-id="b5e9b-122">At this point, a requester indicates the end of its file restoration activities by generating a [*PostRestore*](vssgloss-p.md) event by calling [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>

<span data-ttu-id="b5e9b-123">Les actions du demandeur sont limitées à l’attente sur les enregistreurs, ce qui peut nécessiter un nettoyage final et gérer les erreurs de restauration, ainsi que la libération de l’interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) une fois que tous les enregistreurs sont retournés par la gestion de l’événement [*postRestore*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="b5e9b-123">The requester's actions are limited to waiting on the writers, which may need to perform some final cleanup and handle restore errors, and releasing the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface after all writers have returned from handling the [*PostRestore*](vssgloss-p.md) event.</span></span>

## <a name="writer-actions-during-cleanup-and-termination"></a><span data-ttu-id="b5e9b-124">Actions d’écriture pendant le nettoyage et l’arrêt</span><span class="sxs-lookup"><span data-stu-id="b5e9b-124">Writer Actions during Cleanup and Termination</span></span>

<span data-ttu-id="b5e9b-125">L’événement [*postRestore*](vssgloss-p.md) est géré par la méthode virtuelle [**CVssWriter :: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span><span class="sxs-lookup"><span data-stu-id="b5e9b-125">The [*PostRestore*](vssgloss-p.md) event is handled by the virtual method [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span></span> <span data-ttu-id="b5e9b-126">L’implémentation par défaut retourne simplement la **valeur true** sans entreprendre aucune action.</span><span class="sxs-lookup"><span data-stu-id="b5e9b-126">The default implementation simply returns **true** without taking any action.</span></span> <span data-ttu-id="b5e9b-127">Si un enregistreur doit exercer davantage de contrôle sur la situation postérieure à la restauration, il peut substituer cette méthode.</span><span class="sxs-lookup"><span data-stu-id="b5e9b-127">If a writer needs to exercise more control of the post-restore situation, it can override this method.</span></span>

<span data-ttu-id="b5e9b-128">En plus de tout nettoyage normal (tel que la suppression des fichiers temporaires) qu’un writer peut effectuer dans [**CVssWriter :: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), il peut gérer la réussite ou l’échec des opérations de restauration.</span><span class="sxs-lookup"><span data-stu-id="b5e9b-128">In addition to any normal cleanup (such as removing temporary files) that a writer might perform in [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), it can handle the success or failure of restore operations.</span></span>

<span data-ttu-id="b5e9b-129">La manière dont il gère les erreurs de restauration, les fichiers restaurés à un autre emplacement et la nécessité de restaurations ultérieures sont entièrement à la discrétion de l’auteur.</span><span class="sxs-lookup"><span data-stu-id="b5e9b-129">How it handles restore errors, files restored to an alternate location, and the need for future restores are completely at the writer's discretion.</span></span> <span data-ttu-id="b5e9b-130">Les actions classiques peuvent inclure la comparaison de fichiers dans d’autres emplacements ou de nouveaux emplacements avec les fichiers en cours d’utilisation, la fusion de données à partir de plusieurs fichiers ou le démarrage de nouvelles sessions connectées aux nouveaux fichiers de données.</span><span class="sxs-lookup"><span data-stu-id="b5e9b-130">Typical actions might include comparing files in alternate or new locations with files currently in use, merging data from multiple files, or starting new sessions connected to the new data files.</span></span> <span data-ttu-id="b5e9b-131">Le service VSS fournit les mécanismes suivants pour prendre en charge cette fonction composant par composant :</span><span class="sxs-lookup"><span data-stu-id="b5e9b-131">VSS provides the following mechanisms for supporting this on a component-by-component basis:</span></span>

-   <span data-ttu-id="b5e9b-132">La réussite ou l’échec de la restauration d’un composant se trouve avec [**IVssComponent :: GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus).</span><span class="sxs-lookup"><span data-stu-id="b5e9b-132">Success or failure in restoring any component can be found with [**IVssComponent::GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus).</span></span>
-   <span data-ttu-id="b5e9b-133">L’utilisation de mappages d’emplacements alternatifs dans la restauration des fichiers est indiquée par [**IVssComponent :: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="b5e9b-133">The use of alternate location mappings in restoring files will be indicated by [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>
-   <span data-ttu-id="b5e9b-134">Déterminer si une restauration est incrémentielle et nécessite des restaurations supplémentaires est effectuée en appelant [**IVssComponent :: GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores).</span><span class="sxs-lookup"><span data-stu-id="b5e9b-134">Determining if a restore is incremental and will require further restores is done by calling [**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores).</span></span> <span data-ttu-id="b5e9b-135">Les writers qui nécessitent une restauration complète de leurs données ne doivent pas redémarrer tant que cette méthode n’a pas retourné la valeur false.</span><span class="sxs-lookup"><span data-stu-id="b5e9b-135">Writers that need a complete restoration of their data should not restart until this method returns false.</span></span>
-   <span data-ttu-id="b5e9b-136">Les enregistreurs peuvent déterminer si le demandeur a besoin de restaurer des fichiers à un emplacement non spécifié précédemment à l’aide de [**IVssComponent :: GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) et [**IVssComponent :: GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)</span><span class="sxs-lookup"><span data-stu-id="b5e9b-136">Writers can determine if the requester has needed to restore files to a previously unspecified location using [**IVssComponent::GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) and [**IVssComponent::GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)</span></span>

<span data-ttu-id="b5e9b-137">(Pour plus d’informations sur la restauration de fichiers dans des emplacements autres que les emplacements par défaut, consultez [emplacements de sauvegarde et de restauration non définis par défaut](non-default-backup-and-restore-locations.md).)</span><span class="sxs-lookup"><span data-stu-id="b5e9b-137">(For more information on restoring files to non-default locations, see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md).)</span></span>

<span data-ttu-id="b5e9b-138">Comme pour toute méthode [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , les informations retournées par une instance donnée s’appliquent aux composants [*explicitement inclus*](vssgloss-e.md) pour la sauvegarde et à l’un de ses sous-composants inclus [*implicitement*](vssgloss-i.md) pour les sous-composants de sauvegarde, y compris ceux inclus explicitement pour la restauration par le demandeur à l’aide de [**IVssBackupComponents :: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) (voir utilisation de la [sélectivité pour la restauration et](working-with-selectability-for-restore-and-subcomponents.md) des sous-composants)</span><span class="sxs-lookup"><span data-stu-id="b5e9b-138">As with any [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) method, the information returned by a given instance applies to those components [*explicitly included*](vssgloss-e.md) for backup and any of its [*implicitly included*](vssgloss-i.md) for backup subcomponents, including those subcomponents explicitly included for restore by the requester using [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) (see [Working with Selectability For Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md) for details).</span></span>

<span data-ttu-id="b5e9b-139">Étant donné que les enregistreurs auront besoin d’accéder au document des composants de sauvegarde, il est important que le demandeur ne libère pas l’interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) jusqu’à la fin du traitement des writers.</span><span class="sxs-lookup"><span data-stu-id="b5e9b-139">Because the writers will require access to the Backup Components Document, it is important that the requester not release the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface until writers have finished processing.</span></span>

 

 



