---
description: Processus de création de clichés instantanés
ms.assetid: ca484eec-31c6-4790-9232-3ed67263f6fb
title: Processus de création de clichés instantanés
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4239e2b671edcaeb35b404d9b9411b43316c0212
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103751597"
---
# <a name="the-shadow-copy-creation-process"></a><span data-ttu-id="a14f2-103">Processus de création de clichés instantanés</span><span class="sxs-lookup"><span data-stu-id="a14f2-103">The Shadow Copy Creation Process</span></span>

<span data-ttu-id="a14f2-104">Vous trouverez ci-dessous une description détaillée du rôle du fournisseur de matériel lors de la création d’un jeu de clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="a14f2-104">The following is a detailed description of the hardware provider's role in the creation of a shadow copy set.</span></span> <span data-ttu-id="a14f2-105">Pour obtenir un diagramme de ce processus, consultez [création de clichés instantanés pour les fournisseurs](shadow-copy-creation-for-providers.md).</span><span class="sxs-lookup"><span data-stu-id="a14f2-105">For a diagram of this process, see [Shadow Copy Creation for Providers](shadow-copy-creation-for-providers.md).</span></span>

1.  <span data-ttu-id="a14f2-106">Au fur et à mesure que le demandeur ajoute chaque volume au jeu de clichés instantanés, VSS détermine les numéros d’unités logiques associés.</span><span class="sxs-lookup"><span data-stu-id="a14f2-106">As the requester adds each volume to the shadow copy set, VSS determines the associated LUNs.</span></span> <span data-ttu-id="a14f2-107">Par exemple, un volume fractionné peut être composé de plusieurs numéros d’unité logique (LUN).</span><span class="sxs-lookup"><span data-stu-id="a14f2-107">For example, a spanned volume could be composed of multiple LUNs.</span></span> <span data-ttu-id="a14f2-108">VSS crée des [**informations de \_ lun \_ VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) initiales à l’aide d’informations sur l’appareil physique pour chaque numéro d’unité logique.</span><span class="sxs-lookup"><span data-stu-id="a14f2-108">VSS creates an initial [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) using physical device information for each LUN.</span></span>
2.  <span data-ttu-id="a14f2-109">VSS appelle [**AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) pour déterminer si le fournisseur prend en charge un cliché instantané pour ce numéro d’unité logique.</span><span class="sxs-lookup"><span data-stu-id="a14f2-109">VSS calls [**AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) to determine if the provider supports a shadow copy for that LUN.</span></span> <span data-ttu-id="a14f2-110">Le fournisseur de matériel utilise [**les \_ \_ informations de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) pour déterminer si les numéros d’unités logiques sont pris en charge.</span><span class="sxs-lookup"><span data-stu-id="a14f2-110">The hardware provider uses the [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) to determine whether the LUNs are supported.</span></span> <span data-ttu-id="a14f2-111">Cette détermination doit être tout ou rien : le même fournisseur de matériel doit prendre en charge tous les numéros d’unités logiques contribuant à un volume spécifique.</span><span class="sxs-lookup"><span data-stu-id="a14f2-111">This determination must be all or nothing—the same hardware provider must support all LUNs contributing to a specific volume.</span></span> <span data-ttu-id="a14f2-112">Dans l’exemple de volume fractionné, le fournisseur ne peut pas indiquer qu’il ne prend en charge qu’un seul des numéros d’unités logiques qui composent le volume.</span><span class="sxs-lookup"><span data-stu-id="a14f2-112">In the spanned volume example, the provider cannot indicate that it supports only one of the LUNs that comprise the volume.</span></span>
3.  <span data-ttu-id="a14f2-113">Pour chaque volume du jeu de clichés instantanés, VSS appelle [**IVssHardwareSnapshotProvider :: BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) avec le même tableau de structures d' [**\_ \_ informations de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) .</span><span class="sxs-lookup"><span data-stu-id="a14f2-113">For each volume in the shadow copy set, VSS calls [**IVssHardwareSnapshotProvider::BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) with the same array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures.</span></span> <span data-ttu-id="a14f2-114">Dans un seul appel, tous les numéros d’unités logiques du tableau sont uniques, mais le même numéro d’unité logique peut apparaître dans un appel suivant chaque fois que le même numéro d’unité logique contribue à plusieurs volumes.</span><span class="sxs-lookup"><span data-stu-id="a14f2-114">Within a single call, all LUNs in the array are unique, but the same LUN may appear in a subsequent call whenever the same LUN contributes to multiple volumes.</span></span> <span data-ttu-id="a14f2-115">Le fournisseur doit gérer ce cas correctement.</span><span class="sxs-lookup"><span data-stu-id="a14f2-115">The provider must handle that case correctly.</span></span>
4.  <span data-ttu-id="a14f2-116">Immédiatement après [**IVssProviderCreateSnapshotSet :: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots), VSS définit les indicateurs en lecture seule, masqué, sans lettre de lecteur et de cliché instantané sur tous les numéros d’unités logiques affectés.</span><span class="sxs-lookup"><span data-stu-id="a14f2-116">Immediately after [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots), VSS will set the read-only, hidden, no drive letter, and shadow copy flags on all affected LUNs.</span></span> <span data-ttu-id="a14f2-117">Les indicateurs sont mis en œuvre à l’aide de secteurs cachés sur des disques MBR ou des bits spécifiques du système d’exploitation dans l’entrée d’en-tête de partition sur des disques GPT.</span><span class="sxs-lookup"><span data-stu-id="a14f2-117">The flags are implemented using hidden sectors on MBR disks or operating-system-specific bits in the partition header entry on GPT disks.</span></span> <span data-ttu-id="a14f2-118">Les indicateurs entraînent la surface de tous les volumes sur les disques affectés sur les ordinateurs de réception en lecture seule et masqués.</span><span class="sxs-lookup"><span data-stu-id="a14f2-118">The flags will cause all volumes on the affected disks to be surfaced on the receiving machines as read-only and hidden.</span></span> <span data-ttu-id="a14f2-119">Notez que les numéros d’unités logiques des clichés instantanés n’ont pas été validés à ce niveau. ainsi, en cas de panne du système, les indicateurs sont effacés et le numéro d’unité logique d’origine n’est pas affecté.</span><span class="sxs-lookup"><span data-stu-id="a14f2-119">Note that the shadow-copied LUNs have not been committed at this stage, so that in the event of a system crash, the flags will be cleared and the original LUN will not be affected.</span></span> <span data-ttu-id="a14f2-120">Autrement dit, tous les volumes sur le numéro d’unité logique d’origine sont traités comme normaux et conservent leurs attributions de lettres de lecteur, dossiers montés et état de lecture/écriture d’origine.</span><span class="sxs-lookup"><span data-stu-id="a14f2-120">That is, all volumes on the original LUN will be treated as normal—and keep their original drive-letter assignments, mounted folders, and read/write status.</span></span>
    > [!Note]  
    > <span data-ttu-id="a14f2-121">Les fournisseurs ne doivent pas tenter de modifier l’un des indicateurs LUN.</span><span class="sxs-lookup"><span data-stu-id="a14f2-121">Providers should not attempt to modify any of the LUN flags.</span></span>

     

5.  <span data-ttu-id="a14f2-122">À [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), les numéros d’unité logique de cliché instantané sont validés.</span><span class="sxs-lookup"><span data-stu-id="a14f2-122">At [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), the shadow copy LUNs are committed.</span></span> <span data-ttu-id="a14f2-123">**CommitSnapshots** doit être retourné en quelques secondes, sans quoi le processus de création de cliché instantané peut échouer.</span><span class="sxs-lookup"><span data-stu-id="a14f2-123">**CommitSnapshots** should be returned within a few seconds or the whole shadow copy creation process will probably fail.</span></span>
6.  <span data-ttu-id="a14f2-124">Après [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS efface les indicateurs sur tous les numéros d’unités logiques d’origine impliqués dans le cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="a14f2-124">After [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS clears the flags on all original LUNs involved in the shadow copy.</span></span> <span data-ttu-id="a14f2-125">Étant donné que les numéros d’unités logiques des clichés instantanés ont été validés à ce stade, les LUN des clichés instantanés conservent ces indicateurs.</span><span class="sxs-lookup"><span data-stu-id="a14f2-125">Since the shadow copy LUNs have been committed at this point, the shadow copy LUNs retain these flags.</span></span>
7.  <span data-ttu-id="a14f2-126">Après [**IVssProviderCreateSnapshotSet ::P ostcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots), VSS efface les indicateurs LUN (qu’il a définis après [**IVssProviderCreateSnapshotSet :: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)) et notifie les enregistreurs à libérer.</span><span class="sxs-lookup"><span data-stu-id="a14f2-126">After [**IVssProviderCreateSnapshotSet::PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots), VSS clears the LUN flags (that it set after [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)) and notifies the writers to thaw.</span></span> <span data-ttu-id="a14f2-127">VSS appelle ensuite les méthodes [**IVssProviderCreateSnapshotSet ::P refinalcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-prefinalcommitsnapshots) et [**IVssProviderCreateSnapshotSet ::P ostfinalcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postfinalcommitsnapshots) du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="a14f2-127">VSS then calls the provider's [**IVssProviderCreateSnapshotSet::PreFinalCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-prefinalcommitsnapshots) and [**IVssProviderCreateSnapshotSet::PostFinalCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postfinalcommitsnapshots) methods.</span></span>
8.  <span data-ttu-id="a14f2-128">VSS récupère un tableau des structures [**d' \_ \_ informations de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) , une pour chaque numéro d’unité logique de cliché instantané nouvellement créé, en appelant [**IVssHardwareSnapshotProvider :: GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns).</span><span class="sxs-lookup"><span data-stu-id="a14f2-128">VSS retrieves an array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures, one for each newly created shadow copy LUN, by calling [**IVssHardwareSnapshotProvider::GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns).</span></span> <span data-ttu-id="a14f2-129">Le fournisseur doit fournir suffisamment d’informations pour permettre à VSS et au fournisseur d’identifier les clichés instantanés à un moment ultérieur et sur tout système connecté au sous-système.</span><span class="sxs-lookup"><span data-stu-id="a14f2-129">The provider must provide enough information to allow VSS and the provider to identify the shadow copies at any later time and on any system connected to the subsystem.</span></span> <span data-ttu-id="a14f2-130">À ce stade, les numéros d’unité logique de clichés instantanés doivent être inaccessibles à cet ordinateur. le fournisseur doit utiliser un mécanisme autre que simplement en lisant les informations du numéro d’unité logique.</span><span class="sxs-lookup"><span data-stu-id="a14f2-130">At this time, the shadow copy LUNs should be inaccessible to this machine—the provider must use some mechanism other than by simply reading the information from the LUN.</span></span>
9.  <span data-ttu-id="a14f2-131">Pour les clichés instantanés transportables, VSS ajoute les éléments suivants au document des composants de sauvegarde décrivant le jeu de clichés instantanés :</span><span class="sxs-lookup"><span data-stu-id="a14f2-131">For transportable shadow copies, VSS appends the following to the Backup Components Document describing the shadow copy set:</span></span>
    1.  <span data-ttu-id="a14f2-132">Tableau d' [**\_ \_ informations LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) d’origine.</span><span class="sxs-lookup"><span data-stu-id="a14f2-132">The original LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array.</span></span>
    2.  <span data-ttu-id="a14f2-133">Nouveau groupe d' [**\_ \_ informations LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) LUN de cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="a14f2-133">The new shadow copy LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array.</span></span>
    3.  <span data-ttu-id="a14f2-134">Les étendues de disque pour chaque volume dans le jeu de clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="a14f2-134">The disk extents for each volume in the shadow copy set.</span></span>
10. <span data-ttu-id="a14f2-135">Pour les clichés instantanés à importation automatique, le processus d’importation commence.</span><span class="sxs-lookup"><span data-stu-id="a14f2-135">For auto-import shadow copies, the import process begins.</span></span> <span data-ttu-id="a14f2-136">Dans [**IVssHardwareSnapshotProvider :: LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), le fournisseur recevra les [**informations de \_ lun \_ VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) générées dans [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) au moment de la création.</span><span class="sxs-lookup"><span data-stu-id="a14f2-136">In [**IVssHardwareSnapshotProvider::LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), the provider will be given the [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) generated in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) at creation time.</span></span> <span data-ttu-id="a14f2-137">Pendant la **LocateLuns**, le fournisseur doit rendre les numéros d’unités logiques de clichés instantanés visibles au système.</span><span class="sxs-lookup"><span data-stu-id="a14f2-137">During **LocateLuns**, the provider should make those shadow copy LUNs visible to the system.</span></span> <span data-ttu-id="a14f2-138">Le fournisseur ne doit pas provoquer une nouvelle analyse de bus.</span><span class="sxs-lookup"><span data-stu-id="a14f2-138">The provider should not cause a bus rescan.</span></span> <span data-ttu-id="a14f2-139">VSS entraînera une nouvelle analyse et une énumération pour permettre la découverte des numéros d’unités logiques par PNP et les volumes à mettre en ligne.</span><span class="sxs-lookup"><span data-stu-id="a14f2-139">VSS will cause the rescan and enumeration to allow the LUNs to be discovered by PNP and the volumes to come online.</span></span>
11. <span data-ttu-id="a14f2-140">VSS appelle [**IVssHardwareSnapshotProvider :: FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) pour les disques nouvellement arrivés dans le système.</span><span class="sxs-lookup"><span data-stu-id="a14f2-140">VSS calls [**IVssHardwareSnapshotProvider::FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) for the newly arrived disks in the system.</span></span> <span data-ttu-id="a14f2-141">VSS utilise le tableau d' [**\_ \_ informations LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) LUN de cliché instantané de **FillInLunInfo**, en le comparant aux **\_ \_ informations de LUN VDS** générées lors de la création dans [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) et aux étendues de disque pour chaque volume dans le jeu de clichés instantanés afin d’identifier les numéros d’unités logiques de clichés instantanés nouvellement arrivés.</span><span class="sxs-lookup"><span data-stu-id="a14f2-141">VSS uses the shadow copy LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array from **FillInLunInfo**, comparing it with the **VDS\_LUN\_INFORMATION** generated during creation in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) and the disk extents for each volume in the shadow copy set to identify the newly arrived shadow copy LUNs.</span></span>
12. <span data-ttu-id="a14f2-142">À ce stade, tous les volumes contenus sur les numéros d’unités logiques de clichés instantanés sont montés masqués et en lecture seule, et VSS a un mappage du volume original au volume de clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="a14f2-142">At this point, all volumes contained on the shadow copy LUNs are mounted hidden and read-only, and VSS has a mapping from original volume to shadow copy volume.</span></span>

<span data-ttu-id="a14f2-143">Étant donné qu’un même numéro d’unité logique peut contenir des portions de plusieurs volumes, l’ensemble des numéros d’unités logiques de clichés instantanés peut inclure des volumes « supplémentaires ».</span><span class="sxs-lookup"><span data-stu-id="a14f2-143">Because a single LUN can contain portions of multiple volumes, the set of shadow copy LUNs may include "extra" volumes.</span></span> <span data-ttu-id="a14f2-144">Ces volumes ne font pas partie du jeu de clichés instantanés et ne doivent pas être utilisés, car leur cohérence n’est pas garantie.</span><span class="sxs-lookup"><span data-stu-id="a14f2-144">Those volumes are not part of the shadow copy set and should not be used as they are not guaranteed to be consistent.</span></span>

<span data-ttu-id="a14f2-145">Après l’importation, le cliché instantané est accessible via la méthode [**IVssBackupComponents :: Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query) .</span><span class="sxs-lookup"><span data-stu-id="a14f2-145">After import, the shadow copy can be accessed via the [**IVssBackupComponents::Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query) method.</span></span> <span data-ttu-id="a14f2-146">Un cliché instantané peut également être exposé sous la forme d’une lettre de lecteur, d’un dossier monté ou d’un partage à l’aide de [**IVssBackupComponents :: ExposeSnapshot**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot).</span><span class="sxs-lookup"><span data-stu-id="a14f2-146">A shadow copy can also be exposed as a drive letter, mounted folder, or share using [**IVssBackupComponents::ExposeSnapshot**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot).</span></span> <span data-ttu-id="a14f2-147">Un jeu de clichés instantanés peut également être converti en numéro d’unité logique standard à l’aide de la méthode [**IVssBackupComponents :: BreakSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-breaksnapshotset) .</span><span class="sxs-lookup"><span data-stu-id="a14f2-147">A shadow copy set may also be converted to a regular LUN by using the [**IVssBackupComponents::BreakSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-breaksnapshotset) method.</span></span> <span data-ttu-id="a14f2-148">À partir de là, les applications de gestion peuvent utiliser les API de gestion de disque appropriées pour gérer davantage le numéro d’unité logique (par exemple, modifier les attributs de lecture/écriture).</span><span class="sxs-lookup"><span data-stu-id="a14f2-148">From there management applications can use appropriate disk management APIs to further manage the LUN (such as changing the read/write attributes).</span></span>

### <a name="transportable-shadow-copies-on-a-san"></a><span data-ttu-id="a14f2-149">Clichés instantanés transportables sur un réseau SAN</span><span class="sxs-lookup"><span data-stu-id="a14f2-149">Transportable Shadow Copies on a SAN</span></span>

<span data-ttu-id="a14f2-150">À compter de Windows Server 2003, Datacenter Edition et Windows Server 2003, Enterprise Edition, VSS active les jeux de clichés instantanés transportables sur un réseau SAN.</span><span class="sxs-lookup"><span data-stu-id="a14f2-150">Beginning with Windows Server 2003, Datacenter Edition and Windows Server 2003, Enterprise Edition, VSS enables transportable shadow copy sets on a SAN.</span></span> <span data-ttu-id="a14f2-151">Du point de vue d’un fournisseur qui peut transporter des numéros d’unités logiques entre les ordinateurs hôtes, il y a peu ou pas de différence entre un ensemble non transportable et un jeu de clichés instantanés transportables.</span><span class="sxs-lookup"><span data-stu-id="a14f2-151">From the point of view of a provider capable of transporting LUNs between hosts, there is little or no difference between a non-transportable and a transportable shadow copy set.</span></span>

<span data-ttu-id="a14f2-152">**Windows server 2003, Standard Edition, Windows server 2003, Web Edition et Windows XP :** Les jeux de clichés instantanés transportables ne sont pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="a14f2-152">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition and Windows XP:** Transportable shadow copy sets are not supported.</span></span> <span data-ttu-id="a14f2-153">Toutes les éditions de Windows Server 2003 avec Service Pack 1 (SP1) prennent en charge les jeux de clichés instantanés transportables.</span><span class="sxs-lookup"><span data-stu-id="a14f2-153">All editions of Windows Server 2003 with Service Pack 1 (SP1) support transportable shadow copy sets.</span></span>

<span data-ttu-id="a14f2-154">Les jeux de clichés instantanés transportables doivent être créés à l’aide de l’attribut transportable de l’attribut **\_ \_ \_ transportable** [**de l’environnement \_ \_ \_ \_**](/windows/desktop/api/Vss/ne-vss-vss_volume_snapshot_attributes) VSS</span><span class="sxs-lookup"><span data-stu-id="a14f2-154">Transportable shadow copy sets must be created with the **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE** attribute added to the shadow copy context described by the [**\_VSS\_VOLUME\_SNAPSHOT\_ATTRIBUTES**](/windows/desktop/api/Vss/ne-vss-vss_volume_snapshot_attributes) enumeration.</span></span> <span data-ttu-id="a14f2-155">Tous les volumes de l’ensemble doivent être transportables.</span><span class="sxs-lookup"><span data-stu-id="a14f2-155">All volumes in the set must be transportable.</span></span> <span data-ttu-id="a14f2-156">En retournant la réussite de [**IVssHardwareSnapshotProvider :: AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported), le fournisseur indique que non seulement il prend en charge le numéro d’unité logique, mais également qu’il peut transporter le numéro d’unité logique.</span><span class="sxs-lookup"><span data-stu-id="a14f2-156">By returning success from [**IVssHardwareSnapshotProvider::AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported), the provider is indicating that not only does it support the LUN, but also that it can transport the LUN.</span></span> <span data-ttu-id="a14f2-157">La création d’un jeu de clichés instantanés transportables se termine lorsque le service VSS enregistre les informations sur le numéro d’unité logique dans le document des composants de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="a14f2-157">The creation of a transportable shadow copy set concludes when VSS records the LUN information in the Backup Components Document.</span></span> <span data-ttu-id="a14f2-158">Un jeu de clichés instantanés ne peut être importé qu’une seule fois après la création initiale.</span><span class="sxs-lookup"><span data-stu-id="a14f2-158">A shadow copy set may only be imported once after initial creation.</span></span>

<span data-ttu-id="a14f2-159">Sur l’ordinateur récepteur, le demandeur importe le jeu de clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="a14f2-159">On the receiving machine, the requester imports the shadow copy set.</span></span> <span data-ttu-id="a14f2-160">La méthode [**IVssBackupComponents :: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) utilise le document composants de sauvegarde décrivant le jeu de clichés instantanés comme entrée.</span><span class="sxs-lookup"><span data-stu-id="a14f2-160">The [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) method uses the Backup Components Document describing the shadow copy set as input.</span></span> <span data-ttu-id="a14f2-161">L’importation continue par :</span><span class="sxs-lookup"><span data-stu-id="a14f2-161">Importing proceeds by:</span></span>

1.  <span data-ttu-id="a14f2-162">VSS construit un tableau de structures d' [**informations de \_ lun \_ VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) de clichés instantanés à partir du document sur les composants de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="a14f2-162">VSS constructs an array of shadow copy [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures from the Backup Components Document.</span></span>
2.  <span data-ttu-id="a14f2-163">Lorsque VSS appelle [**IVssHardwareSnapshotProvider :: LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), le tableau des structures d' [**\_ \_ informations de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) générées dans [**IVssHardwareSnapshotProvider :: GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) est passé au fournisseur.</span><span class="sxs-lookup"><span data-stu-id="a14f2-163">When VSS calls [**IVssHardwareSnapshotProvider::LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), the array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures generated in [**IVssHardwareSnapshotProvider::GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) will be passed to the provider.</span></span> <span data-ttu-id="a14f2-164">Lors du traitement de cette méthode, le fournisseur doit rendre les numéros d’unités logiques de clichés instantanés visibles au système.</span><span class="sxs-lookup"><span data-stu-id="a14f2-164">While processing this method, the provider should make those shadow copy LUNs visible to the system.</span></span> <span data-ttu-id="a14f2-165">Le fournisseur ne doit pas provoquer une nouvelle analyse de bus.</span><span class="sxs-lookup"><span data-stu-id="a14f2-165">The provider should not cause a bus rescan.</span></span> <span data-ttu-id="a14f2-166">VSS déclenchera la nouvelle analyse et l’énumération pour permettre aux numéros d’unités logiques d’être détectés par PNP et les volumes à mettre en ligne.</span><span class="sxs-lookup"><span data-stu-id="a14f2-166">VSS will trigger the rescan and enumeration to allow the LUNs to be discovered by PNP and the volumes to come online.</span></span>
3.  <span data-ttu-id="a14f2-167">VSS appelle [**IVssHardwareSnapshotProvider :: FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) pour les disques nouvellement arrivés dans le système.</span><span class="sxs-lookup"><span data-stu-id="a14f2-167">VSS calls [**IVssHardwareSnapshotProvider::FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) for the newly arrived disks in the system.</span></span> <span data-ttu-id="a14f2-168">VSS utilise le tableau LUN des clichés instantanés des structures d' [**\_ \_ informations de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) de **FillInLunInfo**, en le comparant aux **\_ \_ informations de LUN VDS** générées pendant la création du jeu de clichés instantanés dans [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) et aux étendues de disque pour chaque volume du jeu de clichés instantanés afin d’identifier les numéros d’unités logiques des clichés instantanés nouvellement arrivés.</span><span class="sxs-lookup"><span data-stu-id="a14f2-168">VSS uses the shadow copy LUN array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures from **FillInLunInfo**, comparing it with the **VDS\_LUN\_INFORMATION** generated during shadow copy set creation in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) and the disk extents for each volume in the shadow copy set to identify the newly arrived shadow copy LUNs.</span></span>
4.  <span data-ttu-id="a14f2-169">À ce stade, tous les volumes contenus sur les numéros d’unités logiques transportés sont montés masqués et en lecture seule et VSS ont un mappage du volume d’origine au volume de clichés instantanés.</span><span class="sxs-lookup"><span data-stu-id="a14f2-169">At this point, all volumes contained on the transported LUNs are mounted hidden and read-only and VSS has a mapping from the original volume to the shadow copy volume.</span></span>

<span data-ttu-id="a14f2-170">Pour la seule machine et le cas transportable, la séquence est semblable à partir du point où [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) est appelé.</span><span class="sxs-lookup"><span data-stu-id="a14f2-170">For both the single machine and transportable case, the sequence is similar starting with the point that [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) is called.</span></span> <span data-ttu-id="a14f2-171">Pour l’importation automatique, les étapes se produisent directement après la création.</span><span class="sxs-lookup"><span data-stu-id="a14f2-171">For auto-import, the steps happen directly after creation.</span></span>

 

 
