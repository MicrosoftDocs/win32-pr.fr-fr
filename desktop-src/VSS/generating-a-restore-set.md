---
description: Un jeu de restauration est une liste de tous les fichiers à restaurer et des emplacements vers lesquels ils seront restaurés.
ms.assetid: 3196c26c-3407-4c00-a800-c3497df583e5
title: Génération d’un jeu de restauration
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db3447ba6d258a5f22fff958761abc7ac0e4f27f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106521519"
---
# <a name="generating-a-restore-set"></a><span data-ttu-id="d6b1e-103">Génération d’un jeu de restauration</span><span class="sxs-lookup"><span data-stu-id="d6b1e-103">Generating A Restore Set</span></span>

<span data-ttu-id="d6b1e-104">Un jeu de restauration est une liste de tous les fichiers à restaurer et des emplacements vers lesquels ils seront restaurés.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-104">A restore set is a list of all files to be restored and the locations to which they will be restored.</span></span>

<span data-ttu-id="d6b1e-105">Comme lors de la génération de la liste des fichiers de sauvegarde (consultez [génération d’un jeu de sauvegarde](generating-a-backup-set.md)), un algorithme permettant de déterminer les fichiers à restaurer et l’emplacement de leur restauration doit effectuer l' [*instance*](vssgloss-w.md) de l’enregistreur par l’instance de Writer et, par composant, pour chaque instance du writer.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-105">As when generating the backup file list (see [Generating A Backup Set](generating-a-backup-set.md)), an algorithm for determining which files to restore and where to restore them must proceed [*writer instance*](vssgloss-w.md) by writer instance, and on a component-by-component basis for each writer instance.</span></span>

<span data-ttu-id="d6b1e-106">Il est nécessaire d’associer chaque fichier sur le support de sauvegarde au composant qui l’a géré.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-106">It is necessary to associate each file on the backup media with the component that managed it.</span></span> <span data-ttu-id="d6b1e-107">Il est également nécessaire d’obtenir la [*méthode de restauration*](vssgloss-r.md)du composant de gestion, les informations sur la [*cible de restauration*](vssgloss-r.md) du fichier et ses [*mappages d’emplacements secondaires*](vssgloss-a.md) (le cas échéant).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-107">It is also necessary to obtain the managing component's [*restore method*](vssgloss-r.md), and the file's [*restore target*](vssgloss-r.md) information, and its [*alternate location mappings*](vssgloss-a.md) (if any).</span></span>

<span data-ttu-id="d6b1e-108">Certains fichiers peuvent également nécessiter des opérations de [*fichiers partielles*](vssgloss-p.md) ou des [*cibles dirigées*](vssgloss-d.md) pour la restauration.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-108">Some files may also require [*partial files*](vssgloss-p.md) operations or [*directed targets*](vssgloss-d.md) for restore.</span></span>

<span data-ttu-id="d6b1e-109">En examinant la [*sélectivité des composants pour la sauvegarde*](vssgloss-s.md) et les [*chemins logiques*](vssgloss-l.md) (voir [utilisation de la sélectivité et des chemins logiques](working-with-selectability-and-logical-paths.md)), un demandeur est en mesure de déterminer la structure du composant de l’opération de sauvegarde qu’il va restaurer.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-109">By examining the components' [*selectability for backup*](vssgloss-s.md) and [*logical paths*](vssgloss-l.md) (see [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md)), a requester is able to determine the component structure of the backup operation it is going to restore.</span></span>

<span data-ttu-id="d6b1e-110">Avec la structure de composant de la sauvegarde établie, le demandeur peut obtenir les informations sur le [*jeu de fichiers*](vssgloss-f.md) de chaque composant (spécification de fichier, chemin d’accès et indicateur de récurrence).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-110">With the component structure of the backup established, the requester can get each component's [*file set*](vssgloss-f.md) information (file specification, path, and recursion flag).</span></span> <span data-ttu-id="d6b1e-111">Un demandeur peut ensuite générer un jeu de restauration.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-111">A requester can then generate a restore set.</span></span>

<span data-ttu-id="d6b1e-112">Les fichiers nécessitant des [*fichiers partiels*](vssgloss-p.md)ou des [*cibles dirigées*](vssgloss-d.md) fournissent leurs propres instructions de restauration détaillées (consultez emplacements de restauration [et de sauvegarde non définis par défaut](non-default-backup-and-restore-locations.md)), qui peuvent ensuite être ajoutés au jeu de restauration.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-112">Files requiring [*partial files*](vssgloss-p.md), or [*directed targets*](vssgloss-d.md) provide their own detailed restoration instructions (see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md)), which can then be added to the restore set.</span></span>

<span data-ttu-id="d6b1e-113">Un mécanisme classique de génération d’un jeu de restauration pour les fichiers qui ne sont pas impliqués dans des opérations de fichiers partiels, ou les [*cibles dirigées*](vssgloss-d.md) peut se poursuivre en procédant comme suit :</span><span class="sxs-lookup"><span data-stu-id="d6b1e-113">A typical mechanism for generating a restore set for files not involved with partial files operations, or [*directed targets*](vssgloss-d.md) might proceed by doing the following:</span></span>

1.  <span data-ttu-id="d6b1e-114">Obtenez la liste des fichiers sur le support de sauvegarde, y compris leurs chemins d’accès d’origine.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-114">Obtain a list of files on the backup media, including their original paths.</span></span>

2.  <span data-ttu-id="d6b1e-115">Identifiez la [*classe de writer*](vssgloss-w.md) et le composant pour chaque fichier sur le support de sauvegarde en procédant comme suit :</span><span class="sxs-lookup"><span data-stu-id="d6b1e-115">Identify the [*writer class*](vssgloss-w.md) and component for each file on the backup media by doing the following:</span></span>

    -   <span data-ttu-id="d6b1e-116">Pour chaque enregistreur, obtenez les informations sur le composant ([**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)) en appelant [**IVssExamineWriterMetadata :: GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) sur tous ses composants.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-116">For each writer, obtain component information ([**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)) by calling [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) on all its components.</span></span>
    -   <span data-ttu-id="d6b1e-117">Pour chaque composant, obtenez les informations de descripteur de fichier ([**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc)) pour chaque ensemble de fichiers que le composant contient (selon les types de données que le composant contient en appelant [**IVssWMComponent :: GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile), [**IVssWMComponent :: GetDatabaseFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabasefile)et [**IVssWMComponent :: GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-117">For each component, obtain file descriptor ([**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc)) information for every set of files the component contains (depending on the types of data the component contains by calling [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile), [**IVssWMComponent::GetDatabaseFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabasefile), and [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile).</span></span>
    -   <span data-ttu-id="d6b1e-118">Comparez les informations de nom et de chemin d’accès du fichier à celles retournées par les informations de chemin d’accès contenues dans le descripteur de fichier pour chaque ensemble de fichiers dans un composant (retourné par [**IVssWMFiledesc :: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc :: GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)et [**IVssWMFiledesc :: GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)) par rapport aux informations de chemin des fichiers stockés pour déterminer si le fichier fait partie du composant.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-118">Compare the file's name and path information against that returned by the path information contained in the file descriptor for each set of files in a component (returned by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)) against stored files path information to determine whether the file is part of the component.</span></span>
        > [!Note]  
        > <span data-ttu-id="d6b1e-119">Vous devez ignorer les autres informations sur l’emplacement dans le descripteur de fichier récupéré à partir d’un composant trouvé dans un document de métadonnées de l’enregistreur stocké (autrement dit, [**IVssWMFiledesc :: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) ne retourne pas la **valeur null**).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-119">You should ignore any alternate location information in the file descriptor retrieved from a component found in a stored Writer Metadata Document (that is, [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) does not return **NULL**).</span></span> <span data-ttu-id="d6b1e-120">Cet autre emplacement est le [*chemin alternatif*](vssgloss-a.md), qui est utilisé uniquement lors de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-120">This alternate location is the [*alternate path*](vssgloss-a.md), which is used only during backup.</span></span>

         

3.  <span data-ttu-id="d6b1e-121">Obtenez d’autres informations de mappage pour chaque fichier sur le support de sauvegarde :</span><span class="sxs-lookup"><span data-stu-id="d6b1e-121">Obtain alternate mapping information for each file on the backup media:</span></span>

    -   <span data-ttu-id="d6b1e-122">Les mappages de fichiers de remplacement sont stockés au moment de l’écriture, et non au niveau du composant, et sont obtenus à partir de l’objet [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) retourné par [**IVssExamineWriterMetadata :: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-122">Alternate file mappings are stored at the writer, not the component level, and are obtained from the object [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping).</span></span>
    -   <span data-ttu-id="d6b1e-123">Vous pouvez déterminer si un fichier particulier possède un autre mappage d’emplacement en vérifiant le chemin d’accès et le nom du fichier par rapport au chemin d’accès et à la spécification de fichier contenus dans le mappage de l’emplacement de remplacement retourné par [**IVssExamineWriterMetadata :: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), via [**IVssWMFiledesc :: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc :: GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)et [**IVssWMFiledesc :: GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-123">You can determine if a particular file has an alternate location mapping by checking the file's path and name against the path and file specification contained in the alternate location mapping returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), via [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive).</span></span> <span data-ttu-id="d6b1e-124">(Si un autre chemin d’accès a été utilisé lors de la sauvegarde, ces informations doivent être ignorées au cours de cette vérification du traitement d’une restauration.)</span><span class="sxs-lookup"><span data-stu-id="d6b1e-124">(If an alternate path was used during backup, that information should be ignored during this check in processing a restore.)</span></span>
    -   <span data-ttu-id="d6b1e-125">Si un fichier et un emplacement de remplacement mappent les descripteurs de fichiers à, vous utilisez la méthode [**IVssWMFiledesc :: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) de l’objet [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) retourné par [**IVssExamineWriterMetadata :: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) pour Rechercher l’autre emplacement vers lequel vous pouvez restaurer le fichier.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-125">If a file and an alternate location mappings file descriptors match, you then use the [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) method of the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) object returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) to find the alternate location to which you can restore the file.</span></span>
    -   <span data-ttu-id="d6b1e-126">Le mappage de l’autre emplacement obtenu de cette façon n’accepte pas nécessairement celui renvoyé par le document des composants de sauvegarde par [**IVssComponent :: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-126">The alternate location mapping obtained in this way will not necessarily agree with that returned from the Backup Components Document by [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span> <span data-ttu-id="d6b1e-127">La valeur [**IVssWMFiledesc :: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) n’est pas vide uniquement si le mappage d’emplacement secondaire est utilisé pour un fichier.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-127">The [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) value is nonblank only if the alternate location mapping is used for a file.</span></span>

4.  <span data-ttu-id="d6b1e-128">Avec ces informations de fichier et de composant, le document composants de sauvegarde peut être interrogé pour obtenir des informations sur les cibles de restauration, les options et les nouveaux emplacements de restauration pour chaque fichier.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-128">With this file and component information, the Backup Components Document can be queried to obtain information about restore targets, options, and new restore locations for each file.</span></span> <span data-ttu-id="d6b1e-129">Ces informations peuvent être associées à la liste des fichiers, composants et emplacements secondaires.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-129">This information can be combined with the list of files, components, and alternate locations.</span></span>

5.  <span data-ttu-id="d6b1e-130">Les fichiers non protégés par les rédacteurs peuvent être sélectionnés de manière cohérente avec les opérations de restauration traditionnelles.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-130">Files not protected by writers can be selected in a manner consistent with traditional restore operations.</span></span>

<span data-ttu-id="d6b1e-131">À ce stade, un demandeur doit avoir une liste de tous les fichiers dont il a besoin pour la restauration, ainsi que des instructions sur la façon de les restaurer et de commencer à restaurer des fichiers sur la base de :</span><span class="sxs-lookup"><span data-stu-id="d6b1e-131">At this point, a requester should have a list of all the files it needs to restore, along with instructions about how to restore them, and can begin restoring files on the basis of:</span></span>

-   <span data-ttu-id="d6b1e-132">Si des mappages d’emplacements de substitution, ou l’emplacement de fichier d’origine doivent être utilisés comme cible pour la restauration, dépend de la présence ou de l’absence d’un fichier à cet emplacement cible et des paramètres de composant de la [**\_ \_ cible de restauration VSS**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restore_target) et de l' [**\_ \_ énumération VSS RESTOREMETHOD**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) (consultez [emplacements de sauvegarde et de restauration non définis par défaut](non-default-backup-and-restore-locations.md)).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-132">Whether alternate location mappings, or the original file location is to be used as the target for the restore will depend on the presence or absence of a file at that target location and component settings of [**VSS\_RESTORE\_TARGET**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restore_target) and [**VSS\_RESTOREMETHOD\_ENUM**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) (see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md)).</span></span>
-   <span data-ttu-id="d6b1e-133">Le fait qu’une tentative de restauration aboutisse dépende de problèmes tels que les autorisations d’accès de la cible, si les fichiers cibles sont verrouillés et d’autres problèmes conventionnels liés à la restauration des fichiers.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-133">Whether an attempt at restoration succeeds will depend on issues such as the access permissions of the target, if target files are locked, and other conventional issues involved in file restoration.</span></span>
-   <span data-ttu-id="d6b1e-134">La réussite ou l’échec de la restauration d’un composant donné pour une instance de writer donnée doit être conservé dans le document des composants de sauvegarde en appelant [**IVssBackupComponents :: SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-134">The success or failure of restoring a given component for a given writer instance should be preserved in the Backup Components Document by calling [**IVssBackupComponents::SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus).</span></span> <span data-ttu-id="d6b1e-135">Cela rendra les informations accessibles aux enregistreurs lors du traitement de l’événement PostRestore.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-135">This will make the information accessible to writers when they process the PostRestore event.</span></span>
-   <span data-ttu-id="d6b1e-136">Si un fichier est restauré vers un autre mappage d’emplacement, le demandeur doit appeler [**IVssBackupComponents :: AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-136">If a file is restored to an alternate location mapping, the requester must call [**IVssBackupComponents::AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping).</span></span> <span data-ttu-id="d6b1e-137">Cela permettra aux rédacteurs de déterminer si leurs fichiers ont été restaurés à d’autres emplacements via [**IVssComponent :: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="d6b1e-137">This will allow writers to determine whether their files have been restored to alternate locations through the [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>
-   <span data-ttu-id="d6b1e-138">Les demandeurs peuvent trouver qu’il est souhaitable de restaurer les fichiers à de nouveaux emplacements.</span><span class="sxs-lookup"><span data-stu-id="d6b1e-138">Requesters may find it desirable to restore files to completely new locations.</span></span> <span data-ttu-id="d6b1e-139">Cela est acceptable, mais le demandeur doit l’indiquer à l’enregistreur à l’aide de la méthode [**IVssBackupComponents :: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) .</span><span class="sxs-lookup"><span data-stu-id="d6b1e-139">This is acceptable, but the requester must indicate this to the writer by using the [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) method.</span></span>

 

 



