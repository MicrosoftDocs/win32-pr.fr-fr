---
description: VSS permet à un demandeur d’accéder au cliché instantané de volumes contenant des données pour la sauvegarde et de copier des données sur un support de sauvegarde.
ms.assetid: 187f26f2-f191-4703-9bde-3357f1ceef0c
title: Vue d’ensemble de la sauvegarde réelle des fichiers
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 98a504ff5a41725e33a2eb27792a3c6c89d00276
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106539087"
---
# <a name="overview-of-actual-backup-of-files"></a><span data-ttu-id="5c31a-103">Vue d’ensemble de la sauvegarde réelle des fichiers</span><span class="sxs-lookup"><span data-stu-id="5c31a-103">Overview of Actual Backup Of Files</span></span>

<span data-ttu-id="5c31a-104">VSS permet à un demandeur d’accéder au cliché instantané de volumes contenant des données pour la sauvegarde et de copier des données sur un support de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="5c31a-104">VSS enables a requester to access the shadow copy of volumes containing data for backup and to copy data to backup media.</span></span> <span data-ttu-id="5c31a-105">Les enregistreurs poursuivent généralement le fonctionnement normal au cours de ce processus.</span><span class="sxs-lookup"><span data-stu-id="5c31a-105">Writers generally proceed with normal operation during this process.</span></span> <span data-ttu-id="5c31a-106">Pour plus d’informations, consultez [vue d’ensemble du traitement d’une sauvegarde sous VSS](overview-of-processing-a-backup-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="5c31a-106">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="5c31a-107">Le tableau suivant présente la séquence des actions et des événements qui sont requis pour la sauvegarde des fichiers.</span><span class="sxs-lookup"><span data-stu-id="5c31a-107">The following table shows the sequence of actions and events that are required for files to be backed up.</span></span>



<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="5c31a-108">Action du demandeur</span><span class="sxs-lookup"><span data-stu-id="5c31a-108">Requester action</span></span></th>
<th><span data-ttu-id="5c31a-109">Événement</span><span class="sxs-lookup"><span data-stu-id="5c31a-109">Event</span></span></th>
<th><span data-ttu-id="5c31a-110">Action d’écriture</span><span class="sxs-lookup"><span data-stu-id="5c31a-110">Writer action</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="5c31a-111">Accéder aux fichiers sur le volume de clichés instantanés (voir <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties"><strong>IVssBackupComponents :: GetSnapshotProperties</strong></a>, <a href="/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop"><strong>VSS_SNAPSHOT_PROP</strong></a>)</span><span class="sxs-lookup"><span data-stu-id="5c31a-111">Access files on the shadow-copied volume (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties"><strong>IVssBackupComponents::GetSnapshotProperties</strong></a>, <a href="/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop"><strong>VSS_SNAPSHOT_PROP</strong></a>)</span></span></td>
<td><span data-ttu-id="5c31a-112">Aucune</span><span class="sxs-lookup"><span data-stu-id="5c31a-112">None</span></span></td>
<td><span data-ttu-id="5c31a-113">Aucune</span><span class="sxs-lookup"><span data-stu-id="5c31a-113">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="5c31a-114">Générez la liste des fichiers à sauvegarder et copiez les données du fichier sur le support de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="5c31a-114">Generate the list of files to back up, and copy file data to backup media.</span></span></td>
<td><span data-ttu-id="5c31a-115">Aucune</span><span class="sxs-lookup"><span data-stu-id="5c31a-115">None</span></span></td>
<td><span data-ttu-id="5c31a-116">Aucune</span><span class="sxs-lookup"><span data-stu-id="5c31a-116">None</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="5c31a-117">Indique la réussite ou l’échec de la sauvegarde avec <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded"><strong>IVssBackupComponents :: SetBackupSucceeded</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="5c31a-117">Indicate the success or failure of the backup with <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded"><strong>IVssBackupComponents::SetBackupSucceeded</strong></a>.</span></span></td>
<td><span data-ttu-id="5c31a-118">Aucune</span><span class="sxs-lookup"><span data-stu-id="5c31a-118">None</span></span></td>
<td><span data-ttu-id="5c31a-119">Aucune</span><span class="sxs-lookup"><span data-stu-id="5c31a-119">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="5c31a-120">Le demandeur indique que la sauvegarde s’est terminée en appelant <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents :: BackupComplete</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="5c31a-120">The requester indicates that the backup has completed by calling <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents::BackupComplete</strong></a>.</span></span></td>
<td><span data-ttu-id="5c31a-121"><a href="vssgloss-b.md"><em>BackupComplete</em></a></span><span class="sxs-lookup"><span data-stu-id="5c31a-121"><a href="vssgloss-b.md"><em>BackupComplete</em></a></span></span></td>
<td><span data-ttu-id="5c31a-122">Effectuez un nettoyage après la sauvegarde (consultez <a href="/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete"><strong>CVssWriter :: OnBackupComplete</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents"><strong>IVssWriterComponents</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent"><strong>IVssComponent</strong></a>).</span><span class="sxs-lookup"><span data-stu-id="5c31a-122">Perform any post-backup cleanup (see <a href="/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete"><strong>CVssWriter::OnBackupComplete</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents"><strong>IVssWriterComponents</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent"><strong>IVssComponent</strong></a>).</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="5c31a-123">Le demandeur attend que tous les enregistreurs accusent réception de l’événement <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents :: BackupComplete</strong></a> à l’aide de <a href="/windows/desktop/api/Vss/nn-vss-ivssasync"><strong>IVssAsync</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="5c31a-123">The requester waits for all writers to acknowledge receipt of the <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents::BackupComplete</strong></a> event using <a href="/windows/desktop/api/Vss/nn-vss-ivssasync"><strong>IVssAsync</strong></a>.</span></span> <span data-ttu-id="5c31a-124">Il doit également vérifier l’état de l’enregistreur (consultez <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus"><strong>IVssBackupComponents :: GatherWriterStatus</strong></a>, <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus"><strong>IVssBackupComponents :: GetWriterStatus</strong></a>).</span><span class="sxs-lookup"><span data-stu-id="5c31a-124">It should also verify writer status (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus"><strong>IVssBackupComponents::GatherWriterStatus</strong></a>, <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus"><strong>IVssBackupComponents::GetWriterStatus</strong></a>).</span></span> <span data-ttu-id="5c31a-125">Le demandeur doit appeler <strong>GatherWriterStatus</strong> à ce stade pour que la session de l’enregistreur soit définie sur un état terminé.</span><span class="sxs-lookup"><span data-stu-id="5c31a-125">The requester must call <strong>GatherWriterStatus</strong> at this time to cause the writer session to be set to a completed state.</span></span>
<blockquote>
[!Note]<br />
<span data-ttu-id="5c31a-126">Cela n’est nécessaire que sur Windows Server 2008 avec Service Pack 2 (SP2) et versions antérieures.</span><span class="sxs-lookup"><span data-stu-id="5c31a-126">This is only necessary on Windows Server 2008 with Service Pack 2 (SP2) and earlier.</span></span>
</blockquote>
<br/></td>
<td><span data-ttu-id="5c31a-127">Aucune</span><span class="sxs-lookup"><span data-stu-id="5c31a-127">None</span></span></td>
<td><span data-ttu-id="5c31a-128">Aucune</span><span class="sxs-lookup"><span data-stu-id="5c31a-128">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="5c31a-129">Enregistrez le document des composants de sauvegarde et chaque document de métadonnées de l’enregistreur dans des documents XML, qui peuvent être écrits sur le support de sauvegarde (consultez <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml"><strong>IVssBackupComponents :: SaveAsXML</strong></a> et <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml"><strong>IVssExamineWriterMetadata :: SaveAsXML</strong></a>).</span><span class="sxs-lookup"><span data-stu-id="5c31a-129">Save the Backup Components Document and each Writer Metadata Document to XML documents, which can be written to the backup media (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml"><strong>IVssBackupComponents::SaveAsXML</strong></a> and <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml"><strong>IVssExamineWriterMetadata::SaveAsXML</strong></a>).</span></span></td>
<td><span data-ttu-id="5c31a-130">Aucune</span><span class="sxs-lookup"><span data-stu-id="5c31a-130">None</span></span></td>
<td><span data-ttu-id="5c31a-131">Aucune</span><span class="sxs-lookup"><span data-stu-id="5c31a-131">None</span></span></td>
</tr>
</tbody>
</table>



 

## <a name="writer-actions-during-backup-of-files"></a><span data-ttu-id="5c31a-132">Actions d’écriture lors de la sauvegarde de fichiers</span><span class="sxs-lookup"><span data-stu-id="5c31a-132">Writer Actions during Backup of Files</span></span>

<span data-ttu-id="5c31a-133">Une fois le cliché instantané terminé, toutes les opérations d’e/s sur le système sauvegardées doivent pouvoir reprendre sans interrompre l’intégrité de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="5c31a-133">After the shadow copy has been completed, all I/O operations on the system that is being backed up should be able to resume without disrupting the integrity of the backup.</span></span> <span data-ttu-id="5c31a-134">Il s’agit de l’une des principales motivations pour disposer de la fonctionnalité de cliché instantané.</span><span class="sxs-lookup"><span data-stu-id="5c31a-134">This is one of the prime motivations for having the shadow copy functionality.</span></span>

<span data-ttu-id="5c31a-135">Par conséquent, comme dans la phase de découverte (voir [vue d’ensemble de la phase de découverte de sauvegarde](overview-of-the-backup-discovery-phase.md)), il y a peu de demandes placées sur les enregistreurs lors de la sauvegarde de fichiers.</span><span class="sxs-lookup"><span data-stu-id="5c31a-135">Therefore, as in the discovery phase (see [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md)), there are few demands placed on the writers while files are actually being backed up.</span></span>

<span data-ttu-id="5c31a-136">Une fois qu’une sauvegarde est terminée et qu’un demandeur a généré un événement [*BackupComplete*](vssgloss-b.md) , VSS appelle la méthode [**CVssWriter :: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) de chaque enregistreur, une méthode virtuelle qui, par défaut, retourne simplement **true**.</span><span class="sxs-lookup"><span data-stu-id="5c31a-136">After a backup has completed, and a requester has generated a [*BackupComplete*](vssgloss-b.md) event, VSS will call each writer's [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) method, a virtual method that by default simply returns **TRUE**.</span></span> <span data-ttu-id="5c31a-137">Toutefois, les Writers peuvent remplacer l’implémentation par défaut et effectuer des actions telles que la suppression des fichiers temporaires restants, ou utiliser l’interface [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) avec laquelle elle est appelée pour vérifier l’état de la sauvegarde de chacun de ses composants [*inclus explicitement*](vssgloss-e.md) (et de tout [*ensemble de composants*](vssgloss-c.md) qu’ils peuvent définir) en extrayant l’objet [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondant.</span><span class="sxs-lookup"><span data-stu-id="5c31a-137">However, writers can override the default implementation and take such actions as removing remaining temporary files, or use the [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface it is called with to check the state of the backup of each of its [*included explicitly*](vssgloss-e.md) components (and any [*component set*](vssgloss-c.md) they might define) by retrieving the corresponding [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) object.</span></span> <span data-ttu-id="5c31a-138">Le rédacteur peut ensuite déterminer et agir sur la réussite ou l’échec de la sauvegarde en appelant [**IVssComponent : GetBackupSucceeded**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupsucceeded).</span><span class="sxs-lookup"><span data-stu-id="5c31a-138">The writer can then determine, and act on, the success or failure of the backup by calling [**IVssComponent:GetBackupSucceeded**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupsucceeded).</span></span> <span data-ttu-id="5c31a-139">La valeur retournée par **IVssComponent : GetBackupSucceeded** est **true** uniquement si tous les fichiers inclus explicitement dans le composant et tous les éléments [*implicitement inclus*](vssgloss-i.md) de l’un de ses sous- [*composants*](vssgloss-s.md) ont été correctement sauvegardés.</span><span class="sxs-lookup"><span data-stu-id="5c31a-139">The value returned by **IVssComponent:GetBackupSucceeded** will be **TRUE** only if all explicitly included files in the component and all [*implicitly included*](vssgloss-i.md) of any of its [*subcomponents*](vssgloss-s.md) have been successfully backed up.</span></span>

<span data-ttu-id="5c31a-140">Lorsque l’appel à [**CVssWriter :: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) est terminé, le demandeur doit appeler [**IVssBackupComponents :: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) et [**IVssBackupComponents :: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) (pour chaque Writer) une dernière fois.</span><span class="sxs-lookup"><span data-stu-id="5c31a-140">When the call to [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) has completed, the requester should call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) (for each writer) one last time.</span></span> <span data-ttu-id="5c31a-141">La mémoire de l’état de session du writer est une ressource limitée et les enregistreurs doivent finalement réutiliser les États de session.</span><span class="sxs-lookup"><span data-stu-id="5c31a-141">The writer session state memory is a limited resource and writers must eventually reuse session states.</span></span> <span data-ttu-id="5c31a-142">Cette étape marque l’état de la session de sauvegarde du writer comme étant terminé et notifie à VSS que cet emplacement de session de sauvegarde peut être réutilisé par une opération de sauvegarde ultérieure.</span><span class="sxs-lookup"><span data-stu-id="5c31a-142">This step marks the writer’s backup session state as completed and notifies VSS that this backup session slot can be reused by a subsequent backup operation.</span></span>

## <a name="requester-actions-during-backup-of-files"></a><span data-ttu-id="5c31a-143">Actions du demandeur pendant la sauvegarde des fichiers</span><span class="sxs-lookup"><span data-stu-id="5c31a-143">Requester Actions during Backup of Files</span></span>

<span data-ttu-id="5c31a-144">Comme indiqué dans [vue d’ensemble de la phase de découverte de la sauvegarde](overview-of-the-backup-discovery-phase.md), vous ne devez pas générer la liste réelle des fichiers à sauvegarder tant que le cliché instantané n’est pas terminé.</span><span class="sxs-lookup"><span data-stu-id="5c31a-144">As noted in [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), you should not generate the actual list of files to be backed up until the shadow copy has completed.</span></span>

<span data-ttu-id="5c31a-145">L' [*objet appareil*](vssgloss-d.md) correspondant au cliché instantané d’un volume donné est utilisé pour obtenir l’accès aux fichiers sur le volume des clichés instantanés une fois que le cliché instantané est terminé.</span><span class="sxs-lookup"><span data-stu-id="5c31a-145">The [*device object*](vssgloss-d.md) corresponding to the shadow copy of a given volume is used to get access to files on the shadow copied volume once the shadow copy has completed.</span></span> <span data-ttu-id="5c31a-146">L’objet appareil est obtenu à partir de l’objet [**\_ \_ prop instantané VSS**](/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop) renvoyé par [**IVssBackupComponents :: GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties).</span><span class="sxs-lookup"><span data-stu-id="5c31a-146">The device object is obtained from the [**VSS\_SNAPSHOT\_PROP**](/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop) object returned by [**IVssBackupComponents::GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties).</span></span> <span data-ttu-id="5c31a-147">Chaque cliché instantané d’un jeu de clichés instantanés aura son propre objet appareil.</span><span class="sxs-lookup"><span data-stu-id="5c31a-147">Each shadow copy of a shadow copy set will have its own device object.</span></span>

<span data-ttu-id="5c31a-148">L’objet appareil et les chemins obtenus à partir des spécifications du document de métadonnées de l’enregistreur sont ensuite utilisés pour sélectionner les fichiers à sauvegarder.</span><span class="sxs-lookup"><span data-stu-id="5c31a-148">The device object and the paths obtained from the Writer Metadata Document specifications of components are then used to select files for backup.</span></span> <span data-ttu-id="5c31a-149">Pour plus d’informations, consultez [l’accès du demandeur aux clichés instantanés des données](requestor-access-to-shadow-copied-data.md) .</span><span class="sxs-lookup"><span data-stu-id="5c31a-149">See [Requester Access to Shadow Copied Data](requestor-access-to-shadow-copied-data.md) for more information.</span></span>

<span data-ttu-id="5c31a-150">Les fichiers qui seront inclus dans la liste de sauvegarde dépendent de la nature de la sauvegarde particulière, de la sélectivité des composants [*pour la sauvegarde*](vssgloss-s.md)et de la structure du chemin d’accès logique du writer (voir utilisation de la [sélectivité pour la sauvegarde](working-with-selectability-for-backup.md)).</span><span class="sxs-lookup"><span data-stu-id="5c31a-150">Which files will be included in the backup list depends on the nature of the particular backup, upon component [*selectability for backup*](vssgloss-s.md), and the logical path structure of the writer (see [Working with Selectability for Backup](working-with-selectability-for-backup.md)).</span></span>

<span data-ttu-id="5c31a-151">En plus des fichiers spécifiés dans les composants, un writer donné peut également avoir des fichiers explicitement exclus.</span><span class="sxs-lookup"><span data-stu-id="5c31a-151">In addition to files specified in the components, a given writer may also have explicitly excluded files.</span></span> <span data-ttu-id="5c31a-152">L’exclusion de fichier doit toujours être respectée, quels que soient les composants sélectionnés.</span><span class="sxs-lookup"><span data-stu-id="5c31a-152">File exclusion must always be respected, regardless of which components are selected.</span></span>

<span data-ttu-id="5c31a-153">Comme indiqué dans [vue d’ensemble de la phase de découverte de sauvegarde](overview-of-the-backup-discovery-phase.md), un dossier monté ou un point d’analyse peut apparaître dans un cliché instantané et peut être sauvegardé.</span><span class="sxs-lookup"><span data-stu-id="5c31a-153">Also as noted in [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), a mounted folder or reparse point can appear in a shadow copy and can be backed up.</span></span> <span data-ttu-id="5c31a-154">Toutefois, un dossier monté ou un point d’analyse ne peut pas être parcouru sur le volume cliché instantané (voir [utilisation des dossiers montés et des points d’analyse](working-with-reparse-and-mount-points.md)).</span><span class="sxs-lookup"><span data-stu-id="5c31a-154">However, a mounted folder or reparse point cannot be traversed on the shadow-copied volume (see [Working with Mounted Folders and Reparse Points](working-with-reparse-and-mount-points.md)).</span></span>

<span data-ttu-id="5c31a-155">Vous devez également prendre garde pendant une opération de sauvegarde, si le [*chemin alternatif*](vssgloss-a.md) retourné par [**IVssWMFiledesc :: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) n’est pas vide.</span><span class="sxs-lookup"><span data-stu-id="5c31a-155">Care should also be taken during a backup operation, if the [*alternate path*](vssgloss-a.md) returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) is not blank.</span></span> <span data-ttu-id="5c31a-156">Un autre chemin d’accès diffère d’un [*autre mappage d’emplacement*](vssgloss-a.md) en ce qu’il est utilisé uniquement pendant les sauvegardes, alors qu’un autre mappage d’emplacement est utilisé uniquement pendant les restaurations.</span><span class="sxs-lookup"><span data-stu-id="5c31a-156">An alternate path differs from an [*alternate location mapping*](vssgloss-a.md) in that it is used only during backups, while an alternate location mapping is used only during restores.</span></span>

<span data-ttu-id="5c31a-157">Dans ce cas, les données ne doivent pas être sauvegardées à partir de leur emplacement normal (indiqué par [**IVssWMFiledesc :: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), mais à partir de l’emplacement retourné par [**IVssWMFiledesc :: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation).</span><span class="sxs-lookup"><span data-stu-id="5c31a-157">In this case, the data is not to be backed up from its normal location (indicated by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), but from the location returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation).</span></span> <span data-ttu-id="5c31a-158">Lors de la restauration, le fichier doit être renvoyé à son emplacement normal.</span><span class="sxs-lookup"><span data-stu-id="5c31a-158">On restore, the file should be returned to its normal location.</span></span> <span data-ttu-id="5c31a-159">Pour plus d’informations, consultez [emplacements de sauvegarde et de restauration non par défaut](non-default-backup-and-restore-locations.md) .</span><span class="sxs-lookup"><span data-stu-id="5c31a-159">See [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md) for more information.</span></span>

<span data-ttu-id="5c31a-160">VSS n’impose aucune restriction sur le mécanisme réel de sauvegarde des données sur un support de stockage ou sur le choix de cette moyenne.</span><span class="sxs-lookup"><span data-stu-id="5c31a-160">VSS places no restrictions on the actual mechanism of backing up data to a storage medium or the choice of that medium.</span></span> <span data-ttu-id="5c31a-161">Toutefois, il est recommandé de traiter les fichiers de chaque composant de chaque [*instance de writer*](vssgloss-w.md) comme une unité.</span><span class="sxs-lookup"><span data-stu-id="5c31a-161">However, it is recommended that the files of each component of each [*writer instance*](vssgloss-w.md) be processed as a unit.</span></span> <span data-ttu-id="5c31a-162">Pour plus d’informations sur les meilleures pratiques pour la génération de la liste des fichiers de sauvegarde, consultez [génération d’un jeu de sauvegarde](generating-a-backup-set.md) .</span><span class="sxs-lookup"><span data-stu-id="5c31a-162">See [Generating A Backup Set](generating-a-backup-set.md) for a discussion of best practices in generating the backup file list.</span></span>

<span data-ttu-id="5c31a-163">La réussite ou l’échec de la sauvegarde de tous les fichiers gérés par un composant donné et (s’il définit un [*jeu de composants*](vssgloss-c.md)). ses sous- [*composants*](vssgloss-s.md) pour une instance de writer donnée doivent être conservés dans le document des composants de sauvegarde en appelant [**IVssBackupComponents :: SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded).</span><span class="sxs-lookup"><span data-stu-id="5c31a-163">The success or failure of backing up any of the files managed by a given component and (if it defines a [*component set*](vssgloss-c.md)) its [*subcomponents*](vssgloss-s.md) for a given writer instance should be preserved in the Backup Components Document by calling [**IVssBackupComponents::SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded).</span></span> <span data-ttu-id="5c31a-164">Si un fichier géré par un composant ou un jeu de composants ne parvient pas à sauvegarder, l’ensemble du composant est considéré comme ayant échoué.</span><span class="sxs-lookup"><span data-stu-id="5c31a-164">If any file managed by a component or component set fails to back up, the entire component is said to fail.</span></span> <span data-ttu-id="5c31a-165">Les informations exactes relatives au fichier qui n’a pas pu être sauvegardé doivent toujours être journalisées.</span><span class="sxs-lookup"><span data-stu-id="5c31a-165">Exact information about which file failed to back up should always be logged.</span></span>

<span data-ttu-id="5c31a-166">Les développeurs peuvent trouver utile de stocker un enregistrement sur le support de sauvegarde des fichiers qui sont sauvegardés, les composants et le jeu de composants dont ils étaient membres, leur spécification et leurs chemins d’origine.</span><span class="sxs-lookup"><span data-stu-id="5c31a-166">Developers may find it helpful to store a record on the backup media of which files are backed up, the components and component set they were a member of, their specification, and what their original paths were.</span></span> <span data-ttu-id="5c31a-167">Il peut également être utile de stocker des informations telles que la définition de chaque composant de l’enregistreur.</span><span class="sxs-lookup"><span data-stu-id="5c31a-167">It may also be useful to store information such as each writer's component definition.</span></span> <span data-ttu-id="5c31a-168">Cela peut rendre l’opération de récupération plus simple.</span><span class="sxs-lookup"><span data-stu-id="5c31a-168">Doing this may make the retrieval operation simpler.</span></span> <span data-ttu-id="5c31a-169">Toutefois, ces détails sont laissés au développeur du demandeur.</span><span class="sxs-lookup"><span data-stu-id="5c31a-169">However, such details are left to the requester developer.</span></span>

<span data-ttu-id="5c31a-170">Étant donné que les enregistreurs peuvent modifier le document des composants de sauvegarde lors de la gestion de l’événement [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) généré par l’appel du demandeur à [**IVssBackupComponents ::D Osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), le document des composants de sauvegarde ne doit pas être enregistré tant que cet appel asynchrone n’est pas terminé.</span><span class="sxs-lookup"><span data-stu-id="5c31a-170">Because writers can modify the Backup Components Document while handling the [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) event generated by the requester's call to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), the Backup Components Document should not be saved until after that asynchronous call has completed.</span></span>

<span data-ttu-id="5c31a-171">Bien qu’elle puisse avoir lieu plus tôt, elle est également un moment pratique pour enregistrer le document de métadonnées de l’enregistreur.</span><span class="sxs-lookup"><span data-stu-id="5c31a-171">Although it may take place earlier, this is also a convenient time to save the Writer Metadata Document.</span></span>

<span data-ttu-id="5c31a-172">Il est très important que le document des composants de sauvegarde et les documents de métadonnées de l’enregistreur soient conservés à l’aide de [**IVssBackupComponents :: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) et [**IVssExamineWriterMetadata :: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml).</span><span class="sxs-lookup"><span data-stu-id="5c31a-172">It is very important that both the Backup Components Document and the Writer Metadata Documents be preserved using [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) and [**IVssExamineWriterMetadata::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml).</span></span> <span data-ttu-id="5c31a-173">Si ce n’est pas le cas, il n’est pas possible d’utiliser VSS lors de la restauration des fichiers.</span><span class="sxs-lookup"><span data-stu-id="5c31a-173">If they are not, it will not be possible to make use of VSS during file restoration.</span></span>

<span data-ttu-id="5c31a-174">Outre le stockage des métadonnées d’origine, certaines applications de sauvegarde peuvent être utiles pour enregistrer une copie de leur propre liste des fichiers (dans leur propre format optimisé), ainsi que leur auteur, composant, procédure de restauration et procédure de restauration associés, sur le support de sauvegarde en vue d’une récupération ultérieure.</span><span class="sxs-lookup"><span data-stu-id="5c31a-174">In addition to storing the original metadata, some backup applications may find it useful to save a copy of their own list of the files (in their own optimized format)—and their associated writer, component, restore procedure, and location information—to the backup media for later retrieval.</span></span> <span data-ttu-id="5c31a-175">Une telle liste peut être utilisée pour éviter une partie de l’analyse et de la comparaison des documents de métadonnées de l’enregistreur et des documents du composant de sauvegarde lors de la restauration.</span><span class="sxs-lookup"><span data-stu-id="5c31a-175">Such a list can be used to avoid some of the parsing and comparing of Writer Metadata Documents and the Backup Component Documents during restore.</span></span>

<span data-ttu-id="5c31a-176">Les volumes en cours de sauvegarde peuvent contenir des données qui ne sont pas gérées par les enregistreurs VSS.</span><span class="sxs-lookup"><span data-stu-id="5c31a-176">Volumes being backed up may have data that is not managed by VSS writers.</span></span> <span data-ttu-id="5c31a-177">Ces données peuvent et doivent être sauvegardées à partir du volume de clichés instantanés, où elles seront dans un [*État de cohérence*](vssgloss-c.md)en cas d’incident.</span><span class="sxs-lookup"><span data-stu-id="5c31a-177">This data can and should be backed up from the shadow copied volume, where it will be in a [*crash-consistent state*](vssgloss-c.md).</span></span> <span data-ttu-id="5c31a-178">Pour plus d’informations, consultez [sauvegardes sans participation au rédacteur](backups-without-writer-participation.md) .</span><span class="sxs-lookup"><span data-stu-id="5c31a-178">See [Backups without Writer Participation](backups-without-writer-participation.md) for more information.</span></span>

 

 




