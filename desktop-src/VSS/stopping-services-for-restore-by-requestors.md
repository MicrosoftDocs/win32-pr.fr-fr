---
description: Il peut s’avérer nécessaire d’arrêter un service avant et redémarré à la suite d’une opération de restauration.
ms.assetid: 111d1281-ad83-49bc-868c-1106a0e25a2a
title: Arrêt des services pour la restauration par les demandeurs
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 548af25a4b4550d35a8e6fa4d4c0e791897b6e0a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106533872"
---
# <a name="stopping-services-for-restore-by-requesters"></a><span data-ttu-id="831d6-103">Arrêt des services pour la restauration par les demandeurs</span><span class="sxs-lookup"><span data-stu-id="831d6-103">Stopping Services for Restore by Requesters</span></span>

<span data-ttu-id="831d6-104">Il peut s’avérer nécessaire d’arrêter un service avant et redémarré à la suite d’une opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="831d6-104">It may be necessary for a service to be stopped prior to and restarted following a restore operation.</span></span>

<span data-ttu-id="831d6-105">En règle générale, l’arrêt et le démarrage d’un service pour prendre en charge une restauration sont effectués par un enregistreur lors du traitement de l’événement de [*prérestauration*](vssgloss-p.md) (avec [**CVssWriter :: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) et de l’événement [*postRestore*](vssgloss-p.md) (avec [**CVssWriter :: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore)).</span><span class="sxs-lookup"><span data-stu-id="831d6-105">Typically, stopping and starting a service to support a restore would be performed by a writer when handling the [*PreRestore*](vssgloss-p.md) event (with [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) and the [*PostRestore*](vssgloss-p.md) event (with [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore)).</span></span>

<span data-ttu-id="831d6-106">Toutefois, dans certains cas, il peut être nécessaire qu’un demandeur arrête explicitement un service en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="831d6-106">However, there may be cases when it is necessary for a requester to explicitly stop a running service.</span></span> <span data-ttu-id="831d6-107">Les enregistreurs indiquent si c’est le cas en définissant la \_ valeur VSS RME \_ Stop \_ Restore \_ Start ou VSS \_ RME \_ Restore \_ Stop \_ Start de l’énumération [**VSS \_ RESTOREMETHOD \_ enum**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) comme argument de la méthode Restore d’un appel à la méthode [**IVssCreateWriterMetadata :: SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod) et en spécifiant le nom du service à arrêter.</span><span class="sxs-lookup"><span data-stu-id="831d6-107">Writers indicate if this is the case by setting the VSS\_RME\_STOP\_RESTORE\_START or VSS\_RME\_RESTORE\_STOP\_START value of the [**VSS\_RESTOREMETHOD\_ENUM**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) enumeration as the restore method argument of a call to the [**IVssCreateWriterMetadata::SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod) method and specifying the name of the service to be stopped.</span></span>

<span data-ttu-id="831d6-108">Un demandeur obtient des informations sur la méthode de restauration et le nom du service à arrêter lors de l’utilisation des métadonnées de l’enregistreur à l’aide de la méthode [**IVssExamineWriterMetadata :: GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod) .</span><span class="sxs-lookup"><span data-stu-id="831d6-108">A requester obtains information about the restore method and the name of the service to be stopped when working with writer metadata by using the [**IVssExamineWriterMetadata::GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod) method.</span></span>

<span data-ttu-id="831d6-109">Il est important que le rédacteur, lorsque vous spécifiez le nom d’un service à arrêter, utilise le nom public correct de ce service.</span><span class="sxs-lookup"><span data-stu-id="831d6-109">It is important that the writer, when specifying the name of a service to be stopped, uses the correct publicly known name of that service.</span></span> <span data-ttu-id="831d6-110">Un nom ambigu ou inexact peut entraîner l’arrêt d’un service incorrect par les demandeurs ou l’incapacité à déterminer quel service arrêter.</span><span class="sxs-lookup"><span data-stu-id="831d6-110">An ambiguous or inaccurate name may result in requesters stopping the wrong service or being unable to determine which service to stop.</span></span>

<span data-ttu-id="831d6-111">Une fois l’opération de restauration terminée, les demandeurs doivent redémarrer le service.</span><span class="sxs-lookup"><span data-stu-id="831d6-111">After the completion of the restore operation, requesters must restart the service.</span></span>

<span data-ttu-id="831d6-112">Vous devez être prudent lors de la conception et de l’implémentation d’enregistreurs qui prennent en charge les services que les demandeurs doivent arrêter et redémarrer.</span><span class="sxs-lookup"><span data-stu-id="831d6-112">You must be careful in designing and implementing writers that support services that requesters must stop and restart.</span></span> <span data-ttu-id="831d6-113">En particulier, ces Writers ne doivent pas faire partie du service, autrement dit, l’enregistreur lui-même ne doit pas nécessairement être arrêté, puis redémarré au cours de l’opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="831d6-113">Specifically, such writers should not actually be part of the service—that is, the writer itself should not need to be stopped and then restarted in the course of the restore operation.</span></span>

<span data-ttu-id="831d6-114">Un enregistreur dont le processus est arrêté aura une instance de writer différente lors du redémarrage.</span><span class="sxs-lookup"><span data-stu-id="831d6-114">A writer whose process is stopped will have a different writer instance upon restart.</span></span> <span data-ttu-id="831d6-115">La nouvelle instance du writer ne recevra pas les événements VSS destinés à l’instance d’origine du writer.</span><span class="sxs-lookup"><span data-stu-id="831d6-115">The new instance of the writer will not receive VSS events intended for the original instance of the writer.</span></span> <span data-ttu-id="831d6-116">Plus précisément, si le processus d’une instance de writer est arrêté après la gestion d’un événement de prérestauration, la nouvelle instance ne recevra pas l’événement PostRestore.</span><span class="sxs-lookup"><span data-stu-id="831d6-116">Specifically, if the process of a writer instance is stopped after handling a PreRestore event, the new instance will not receive the PostRestore event.</span></span> <span data-ttu-id="831d6-117">En outre, VSS génère une erreur indiquant la perte d’un writer participant dans l’opération de restauration, et [**IVssBackupComponents ::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) peut retourner un échec.</span><span class="sxs-lookup"><span data-stu-id="831d6-117">Further, VSS will generate an error indicating the loss of a participating writer in the restore operation, and [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) may return a failure.</span></span>

 

 



