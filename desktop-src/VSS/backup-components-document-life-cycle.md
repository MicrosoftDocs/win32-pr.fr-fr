---
description: Les demandeurs ont la responsabilité principale du cycle de vie d’un document sur les composants de sauvegarde.
ms.assetid: 287b7b9a-ac04-4a74-83c1-2cdd4a571ac1
title: Cycle de vie des documents des composants de sauvegarde
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a4bcb0263f46466d7be2bc19f3c8809167b2da08
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106529458"
---
# <a name="backup-components-document-life-cycle"></a><span data-ttu-id="13aef-103">Cycle de vie des documents des composants de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="13aef-103">Backup Components Document Life Cycle</span></span>

<span data-ttu-id="13aef-104">Les demandeurs ont la responsabilité principale du cycle de vie d’un document sur les composants de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="13aef-104">Requesters have primary responsibility for the life cycle of a Backup Components Document.</span></span>

<span data-ttu-id="13aef-105">Ce contrôle est exercé par une instance de l’objet d’interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) retourné par [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="13aef-105">This control is exercised by an instance of the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface object returned by [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span></span>

<span data-ttu-id="13aef-106">Un demandeur doit initialiser un document de composants de sauvegarde avant une sauvegarde ou une restauration en appelant [**IVssBackupComponents :: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) ou [**IVssBackupComponents :: InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span><span class="sxs-lookup"><span data-stu-id="13aef-106">A requester must initialize a Backup Components Document prior to a backup or restore by calling [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) or [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span></span> <span data-ttu-id="13aef-107">Le demandeur peut initialiser le document comme vide ou il peut charger une copie précédemment stockée du document.</span><span class="sxs-lookup"><span data-stu-id="13aef-107">The requester can initialize the document as empty, or it can load a previously stored copy of the document.</span></span>

<span data-ttu-id="13aef-108">Pour les opérations de sauvegarde, un document de composants de sauvegarde est généralement initialisé comme vide.</span><span class="sxs-lookup"><span data-stu-id="13aef-108">For backup operations, a Backup Components Document is typically initialized as empty.</span></span> <span data-ttu-id="13aef-109">Ses données seront remplies avec la collaboration des rédacteurs du système au cours du traitement de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="13aef-109">Its data will be filled in with cooperation from the system's writers in the course of processing the backup.</span></span>

<span data-ttu-id="13aef-110">Pour les opérations de restauration, un document composants de sauvegarde est généralement initialisé à partir d’un document stocké généré au cours de la sauvegarde initiale.</span><span class="sxs-lookup"><span data-stu-id="13aef-110">For restore operations, a Backup Components Document is typically initialized from a stored document generated during the initial backup.</span></span> <span data-ttu-id="13aef-111">Cela permet à la restauration (conjointement avec l’examen des documents de métadonnées de l’enregistreur stocké) de déterminer quelles données ont été initialement sauvegardées et comment elles doivent être restaurées.</span><span class="sxs-lookup"><span data-stu-id="13aef-111">This allows the restore (in conjunction with examination of stored Writer Metadata Documents) to determine what data was initially backed up and how it should be restored.</span></span>

<span data-ttu-id="13aef-112">La sauvegarde des [*clichés instantanés transportables*](vssgloss-t.md) est une exception à cette règle.</span><span class="sxs-lookup"><span data-stu-id="13aef-112">Backing up [*transportable shadow copies*](vssgloss-t.md) is an exception to this rule.</span></span> <span data-ttu-id="13aef-113">Dans ce cas, un cliché instantané peut avoir été déplacé d’un système (où il a été créé avec le document des composants de la sauvegarde initiale) vers un autre au moyen de réassigner l’unité logique d’un périphérique de stockage partagé.</span><span class="sxs-lookup"><span data-stu-id="13aef-113">In this case, a shadow copy could have been moved from one system (where it was created along with the initial Backup Components Document) to another by means of reassigning a shared storage device's logical unit.</span></span> <span data-ttu-id="13aef-114">Pour sauvegarder dans ces circonstances, un demandeur charge l’état de sauvegarde stocké et se poursuit là où le système initial s’est arrêté.</span><span class="sxs-lookup"><span data-stu-id="13aef-114">To back up under these circumstances, a requester loads the stored backup state and proceeds from where the initial system left off.</span></span> <span data-ttu-id="13aef-115">(Pour plus d’informations, consultez [importation de volumes de clichés instantanés transportables](importing-transportable-shadow-copied-volumes.md).)</span><span class="sxs-lookup"><span data-stu-id="13aef-115">(For more information, see [Importing Transportable Shadow Copied Volumes](importing-transportable-shadow-copied-volumes.md).)</span></span>

<span data-ttu-id="13aef-116">Au cours du traitement d’une sauvegarde, le demandeur décide quels composants doivent être copiés sur la base des composants marqués comme [*sélectionnables pour la sauvegarde*](vssgloss-s.md), les [*chemins logiques*](vssgloss-l.md)du composant et sa propre logique interne.</span><span class="sxs-lookup"><span data-stu-id="13aef-116">In the course of processing a backup, the requester decides which components to actually copy on the basis of which components are marked as [*selectable for backup*](vssgloss-s.md), the component's [*logical paths*](vssgloss-l.md), and its own internal logic.</span></span>

<span data-ttu-id="13aef-117">Certains des composants seront [*inclus explicitement*](vssgloss-e.md) dans l’opération de sauvegarde ; des informations sur le composant seront ajoutées au document composants de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="13aef-117">Some of the components will be [*explicitly included*](vssgloss-e.md) in the backup operation; information about the component will be added to the Backup Components Document.</span></span> <span data-ttu-id="13aef-118">D’autres seront [*incluses implicitement*](vssgloss-i.md) dans la sauvegarde. les informations sur les composants ajoutés ne sont pas ajoutées au document composants de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="13aef-118">Others will be [*implicitly included*](vssgloss-i.md) in the backup; information about the added components will not be added to the Backup Components Document.</span></span>

<span data-ttu-id="13aef-119">Tous les composants d’un enregistreur non sélectionnables pour les composants de sauvegarde sans ancêtre sélectionnable dans leur chemin logique, et ceux sélectionnables pour les composants de sauvegarde choisis par le demandeur, seront ajoutés de manière explicite.</span><span class="sxs-lookup"><span data-stu-id="13aef-119">All of a writer's nonselectable for backup components without a selectable ancestor in their logical path, and those selectable for backup components the requester chooses, will be added explicitly.</span></span>

<span data-ttu-id="13aef-120">Les composants non sélectionnables et sélectionnables pour les composants de sauvegarde peuvent être ajoutés implicitement s’ils ont un ancêtre sélectionnable dans leur chemin logique, qui est explicitement inclus dans la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="13aef-120">Both nonselectable and selectable for backup components can be added implicitly if they have a selectable ancestor in their logical path, which is explicitly included in the backup.</span></span> <span data-ttu-id="13aef-121">Ces composants (sous-[*composants*](vssgloss-s.md)) sont des membres de [*jeux de composants*](vssgloss-s.md) définis par leur ancêtre sélectionnable.</span><span class="sxs-lookup"><span data-stu-id="13aef-121">These components ([*subcomponents*](vssgloss-s.md)) are members of [*component sets*](vssgloss-s.md) defined by their selectable ancestor.</span></span>

<span data-ttu-id="13aef-122">Lors du traitement des opérations de restauration, le demandeur utilise la [*sélectivité pour la restauration*](vssgloss-s.md) au lieu de la possibilité de sélection pour la sauvegarde, conjointement avec les informations de chemin d’accès logique et sa propre logique interne pour déterminer les fichiers à restaurer.</span><span class="sxs-lookup"><span data-stu-id="13aef-122">When handling restore operations, the requester uses [*selectability for restore*](vssgloss-s.md) instead of selectability for backup in conjunction with logical path information and its own internal logic to decide which files to restore.</span></span>

<span data-ttu-id="13aef-123">Si un composant qui avait été implicitement ajouté à la sauvegarde est à présent explicitement ajouté à la restauration, le demandeur met à jour le document des composants de sauvegarde avec les informations de ce composant.</span><span class="sxs-lookup"><span data-stu-id="13aef-123">If a component that had been implicitly added to the backup is now to be explicitly added to the restore, the requester will update the Backup Components Document with that component's information.</span></span>

<span data-ttu-id="13aef-124">Les informations sur les composants stockés sont disponibles à la fois pour les demandeurs et les Writers via des instances de l’interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="13aef-124">Information about the stored components is available both to requesters and writers through instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface.</span></span>

<span data-ttu-id="13aef-125">C’est par le biais des interfaces [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) que les rédacteurs peuvent interroger et (jusqu’à la fin des événements [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) et [**postRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) ) modifier les informations dans le document des composants de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="13aef-125">It is through [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interfaces that writers can query and (until the end of [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) and [**PostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) events) modify information in the Backup Components Document.</span></span>

<span data-ttu-id="13aef-126">Quand le gestionnaire d’événements [**CVssWriter :: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter :: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**CVssWriter :: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**CVssWriter :: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete)ou [**CVssWriter :: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) est appelé, un writer reçoit une instance d’une interface [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) .</span><span class="sxs-lookup"><span data-stu-id="13aef-126">When the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete), or [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) event handler is called, a writer receives an instance of an [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface.</span></span>

<span data-ttu-id="13aef-127">Notez que, lors de la génération de l’événement [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) , le document composants de sauvegarde est en lecture seule et, par conséquent, [**CVssWriter :: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) ne peut pas utiliser l’interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) pour le modifier.</span><span class="sxs-lookup"><span data-stu-id="13aef-127">Note that upon generation of the [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event, the Backup Components Document is made read-only, and therefore [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) cannot use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to modify it.</span></span>

<span data-ttu-id="13aef-128">À partir de l’interface [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) , l’enregistreur peut récupérer des instances de l’interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) qui lui permettra d’accéder à tous ses composants explicitement ajoutés au document des composants de sauvegarde et à modifier leur état.</span><span class="sxs-lookup"><span data-stu-id="13aef-128">From the [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface, the writer can retrieve instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface that will allow it to access all of its components explicitly added to the Backup Components Document and to alter their state.</span></span> <span data-ttu-id="13aef-129">Pour plus d’informations, consultez [vue d’ensemble du traitement d’une sauvegarde sous VSS](overview-of-processing-a-backup-under-vss.md) et [vue d’ensemble du traitement d’une restauration sous VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="13aef-129">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md) and [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="13aef-130">Les documents des composants de sauvegarde sont supprimés de la mémoire lors de la libération de l’interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , et doivent être stockés à l’aide de [**IVssBackupComponents :: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml), ou toutes leurs informations seront perdues.</span><span class="sxs-lookup"><span data-stu-id="13aef-130">Backup Components Documents are removed from memory when the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface is released, and must be stored using [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml), or all their information will be lost.</span></span>

<span data-ttu-id="13aef-131">En outre, lorsqu’un document [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) est correctement libéré, un événement [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) est généré et des [*clichés instantanés de mise en sortie automatique*](vssgloss-a.md) sont supprimés.</span><span class="sxs-lookup"><span data-stu-id="13aef-131">In addition, when an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) document is properly released, a [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) event is generated and [*auto-release shadow copies*](vssgloss-a.md) are deleted.</span></span>

 

 



