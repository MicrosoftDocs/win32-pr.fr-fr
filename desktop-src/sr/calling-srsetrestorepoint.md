---
title: Appel de SRSetRestorePoint
description: Une application peut créer un point de restauration avant de provoquer une modification importante du système, telle qu’une mise à jour de l’installation, de la désinstallation ou de la fonctionnalité.
ms.assetid: 77981e75-8c3f-4ecc-82f4-e88d68df661a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b877c4fe73bcedad363bb4c9cc770a9638550dbd
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103674854"
---
# <a name="calling-srsetrestorepoint"></a><span data-ttu-id="70417-103">Appel de SRSetRestorePoint</span><span class="sxs-lookup"><span data-stu-id="70417-103">Calling SRSetRestorePoint</span></span>

<span data-ttu-id="70417-104">Une application peut créer un point de restauration avant de provoquer une modification importante du système, telle qu’une mise à jour de l’installation, de la désinstallation ou de la fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="70417-104">An application can create a restore point before it causes a significant system change, such as an install, uninstall, or feature update.</span></span>

<span data-ttu-id="70417-105">Les programmes d’installation doivent créer un point de restauration juste avant l’installation en appelant la fonction [**SRSetRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) avec le membre **dwEventType** de la structure [**RESTOREPOINTINFO**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-restorepointinfoa) définie sur commencer la \_ \_ modification système.</span><span class="sxs-lookup"><span data-stu-id="70417-105">Installers should create a restore point just prior to installation by calling the [**SRSetRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) function with the **dwEventType** member of the [**RESTOREPOINTINFO**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-restorepointinfoa) structure set to BEGIN\_SYSTEM\_CHANGE.</span></span> <span data-ttu-id="70417-106">Pour signaler à la restauration du système que l’installation est terminée, appelez **SRSetRestorePoint** avec **DWEVENTTYPE** défini sur terminer la \_ modification du système \_ .</span><span class="sxs-lookup"><span data-stu-id="70417-106">To notify System Restore that the installation has been completed, call **SRSetRestorePoint** with **dwEventType** set to END\_SYSTEM\_CHANGE.</span></span>

<span data-ttu-id="70417-107">Si l’utilisateur annule l’installation de l’application, le programme d’installation peut supprimer le point de restauration créé au début de l’installation.</span><span class="sxs-lookup"><span data-stu-id="70417-107">If the user cancels the application installation, the installer may remove the restore point it created when the installation began.</span></span> <span data-ttu-id="70417-108">La suppression du point de restauration est facultative et peut empêcher l’utilisateur d’effectuer une récupération à partir de modifications non intentionnelles apportées par le programme d’installation au cours de l’annulation.</span><span class="sxs-lookup"><span data-stu-id="70417-108">Removing the restore point is optional and can prevent the user from recovering from unintentional changes made by the installer during the cancellation.</span></span> <span data-ttu-id="70417-109">Si le programme d’installation doit supprimer un point de restauration, il peut appeler la fonction [**SRRemoveRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srremoverestorepoint) ou appeler [**SRSetRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) avec **dwRestorePointType** défini sur opération annulée \_ , **DWEVENTTYPE** définir \_ sur \_ la modification du système de fin et **LlSequenceNumber** défini sur la valeur retournée par l’appel initial à **SRSetRestorePoint**.</span><span class="sxs-lookup"><span data-stu-id="70417-109">If the installer is to remove a restore point, it can call the [**SRRemoveRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srremoverestorepoint) function, or call [**SRSetRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) with **dwRestorePointType** set to CANCELLED\_OPERATION, **dwEventType** set to END\_SYSTEM\_CHANGE, and **llSequenceNumber** set to the value returned by the initial call to **SRSetRestorePoint**.</span></span>

<span data-ttu-id="70417-110">**Windows 8 :  **</span><span class="sxs-lookup"><span data-stu-id="70417-110">**Windows 8:  **</span></span>

<span data-ttu-id="70417-111">Une nouvelle clé de registre permet aux développeurs d’applications de modifier la fréquence de création du point de restauration.</span><span class="sxs-lookup"><span data-stu-id="70417-111">A new registry key enables application developers to change the frequency of restore-point creation.</span></span>

<span data-ttu-id="70417-112">Les applications doivent créer cette clé pour l’utiliser, car elle n’est pas préexistante dans le système.</span><span class="sxs-lookup"><span data-stu-id="70417-112">Applications should create this key to use it because it will not preexist in the system.</span></span> <span data-ttu-id="70417-113">Les éléments suivants s’appliquent par défaut si la clé n’existe pas.</span><span class="sxs-lookup"><span data-stu-id="70417-113">The following will apply by default if the key does not exist.</span></span> <span data-ttu-id="70417-114">Si une application appelle la fonction **SRSetRestorePoint** pour créer un point de restauration, Windows ignore la création de ce nouveau point de restauration si des points de restauration ont été créés au cours des dernières 24 heures.</span><span class="sxs-lookup"><span data-stu-id="70417-114">If an application calls the **SRSetRestorePoint** function to create a restore point, Windows skips creating this new restore point if any restore points have been created in the last 24 hours.</span></span> <span data-ttu-id="70417-115">La restauration du système définit le membre **IISequenceNumber** de la structure [**STATEMGRSTATUS**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-statemgrstatus) sur le numéro de séquence du point de restauration créé précédemment dans la journée et définit la valeur du membre **nStatus** sur **erreur \_ réussite**.</span><span class="sxs-lookup"><span data-stu-id="70417-115">System Restore sets the **IISequenceNumber** member of the [**STATEMGRSTATUS**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-statemgrstatus) structure to the sequence number for the restore point created previously in the day and sets the value of the **nStatus** member to **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="70417-116">La fonction **SRSetRestorePoint** retourne la **valeur true**.</span><span class="sxs-lookup"><span data-stu-id="70417-116">The **SRSetRestorePoint** function returns **TRUE**.</span></span>

<span data-ttu-id="70417-117">Les développeurs peuvent écrire des applications qui créent la valeur **DWORD** **SystemRestorePointCreationFrequency** sous la clé de Registre **HKLM \\ Software \\ Microsoft \\ Windows NT \\ CurrentVersion \\ SystemRestore**.</span><span class="sxs-lookup"><span data-stu-id="70417-117">Developers can write applications that create the **DWORD** value **SystemRestorePointCreationFrequency** under the registry key **HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore**.</span></span> <span data-ttu-id="70417-118">La valeur de cette clé de Registre peut modifier la fréquence de création du point de restauration.</span><span class="sxs-lookup"><span data-stu-id="70417-118">The value of this registry key can change the frequency of restore point creation.</span></span> <span data-ttu-id="70417-119">La valeur de cette clé de Registre peut modifier la fréquence de création du point de restauration.</span><span class="sxs-lookup"><span data-stu-id="70417-119">The value of this registry key can change the frequency of restore point creation.</span></span>

<span data-ttu-id="70417-120">Si l’application appelle **SRSetRestorePoint** pour créer un point de restauration et que la valeur de la clé de Registre est 0, la restauration du système n’ignore pas la création du nouveau point de restauration.</span><span class="sxs-lookup"><span data-stu-id="70417-120">If the application calls **SRSetRestorePoint** to create a restore point, and the registry key value is 0, system restore does not skip creating the new restore point.</span></span>

<span data-ttu-id="70417-121">Si l’application appelle **SRSetRestorePoint** pour créer un point de restauration et que la valeur de la clé de Registre est l’entier N, la restauration du système ignore la création d’un nouveau point de restauration si des points de restauration ont été créés au cours des N minutes précédentes.</span><span class="sxs-lookup"><span data-stu-id="70417-121">If the application calls **SRSetRestorePoint** to create a restore point, and the registry key value is the integer N, system restore skips creating a new restore point if any restore points were created in the previous N minutes.</span></span>

<span data-ttu-id="70417-122">**Windows 8 :  **</span><span class="sxs-lookup"><span data-stu-id="70417-122">**Windows 8:  **</span></span>

<span data-ttu-id="70417-123">La restauration du système exécutée sur Windows 8 surveille les fichiers du volume de démarrage qui sont pertinents pour la restauration du système uniquement.</span><span class="sxs-lookup"><span data-stu-id="70417-123">System Restore running on Windows 8 monitors files in the boot volume that are relevant for system restore only.</span></span> <span data-ttu-id="70417-124">Les captures instantanées du volume de démarrage créé par la restauration du système exécutée sur Windows 8 peuvent être supprimées si l’instantané est ensuite exposé par une version antérieure de Windows.</span><span class="sxs-lookup"><span data-stu-id="70417-124">Snapshots of the boot volume created by System Restore running on Windows 8 may be deleted if the snapshot is subsequently exposed by an earlier version of Windows.</span></span> <span data-ttu-id="70417-125">Notez que bien qu’il n’existe qu’un seul volume système, il existe un volume de démarrage pour chaque système d’exploitation dans un système à démarrage multiple.</span><span class="sxs-lookup"><span data-stu-id="70417-125">Note that although there is only one system volume, there is one boot volume for each operating system in a multi-boot system.</span></span>

<span data-ttu-id="70417-126">Les développeurs peuvent écrire des applications qui créent la valeur **DWORD** **ScopeSnapshots** sous la clé de Registre **HKLM \\ Software \\ Microsoft \\ Windows NT \\ CurrentVersion \\ SystemRestore**.</span><span class="sxs-lookup"><span data-stu-id="70417-126">Developers can write applications that create the **DWORD** value **ScopeSnapshots** under the registry key **HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore**.</span></span> <span data-ttu-id="70417-127">Si la valeur de cette clé de Registre est égale à 0, la restauration du système crée des instantanés du volume de démarrage de la même façon que dans les versions antérieures de Windows.</span><span class="sxs-lookup"><span data-stu-id="70417-127">If this registry key value is 0, System Restore creates snapshots of the boot volume in the same way as in earlier versions of Windows.</span></span> <span data-ttu-id="70417-128">Si cette valeur est supprimée, la restauration du système exécutée sur Windows 8 reprend la création de captures instantanées qui surveillent les fichiers du volume de démarrage qui sont pertinents pour la restauration du système uniquement.</span><span class="sxs-lookup"><span data-stu-id="70417-128">If this value is deleted, System Restore running on Windows 8 resumes creating snapshots that monitor files in the boot volume that are relevant for system restore only.</span></span>

<span data-ttu-id="70417-129">Pour obtenir un exemple, consultez Utilisation de la [restauration du système](using-system-restore.md).</span><span class="sxs-lookup"><span data-stu-id="70417-129">For an example, see [Using System Restore](using-system-restore.md).</span></span>

 

 




