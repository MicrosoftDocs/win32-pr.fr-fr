---
title: Prise en charge de plusieurs tronçons dans WinRM
description: Windows Remote Management (WinRM) prend en charge la délégation des informations d’identification de l’utilisateur sur plusieurs ordinateurs distants.
ms.assetid: 0e6c8966-bb05-4dfb-b154-300fa76e8d9c
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f22c3d66e8605e932fe15b812f92d51350da2d69
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104482808"
---
# <a name="multi-hop-support-in-winrm"></a><span data-ttu-id="f66ef-103">Prise en charge de plusieurs tronçons dans WinRM</span><span class="sxs-lookup"><span data-stu-id="f66ef-103">Multi-Hop Support in WinRM</span></span>

<span data-ttu-id="f66ef-104">Windows Remote Management (WinRM) prend en charge la délégation des informations d’identification de l’utilisateur sur plusieurs ordinateurs distants.</span><span class="sxs-lookup"><span data-stu-id="f66ef-104">Windows Remote Management (WinRM) supports the delegation of user credentials across multiple remote computers.</span></span> <span data-ttu-id="f66ef-105">La fonctionnalité de prise en charge de plusieurs tronçons peut désormais utiliser le fournisseur de services de sécurité des informations d’identification (CredSSP) pour l’authentification.</span><span class="sxs-lookup"><span data-stu-id="f66ef-105">The multi-hop support functionality can now use Credential Security Service Provider (CredSSP) for authentication.</span></span> <span data-ttu-id="f66ef-106">CredSSP permet à une application de déléguer les informations d’identification de l’utilisateur de l’ordinateur client au serveur cible.</span><span class="sxs-lookup"><span data-stu-id="f66ef-106">CredSSP enables an application to delegate the user's credentials from the client computer to the target server.</span></span>

<span data-ttu-id="f66ef-107">L’authentification CredSSP est destinée aux environnements où la délégation Kerberos ne peut pas être utilisée.</span><span class="sxs-lookup"><span data-stu-id="f66ef-107">CredSSP authentication is intended for environments where Kerberos delegation cannot be used.</span></span> <span data-ttu-id="f66ef-108">La prise en charge de CredSSP a été ajoutée pour permettre à un utilisateur de se connecter à un serveur distant et d’avoir la possibilité d’accéder à un ordinateur de second saut, tel qu’un partage de fichiers.</span><span class="sxs-lookup"><span data-stu-id="f66ef-108">Support for CredSSP was added to allow a user to connect to a remote server and have the ability to access a second-hop machine, such as a file share.</span></span>

<span data-ttu-id="f66ef-109">Pour plus d’informations sur CredSSP, consultez [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="f66ef-109">For more information about CredSSP, see [KB 951608](https://support.microsoft.com/kb/951608).</span></span>

> [!Note]  
> <span data-ttu-id="f66ef-110">Les clients et les serveurs WinRM prendront en charge l’authentification CredSSP uniquement avec des informations d’identification explicites.</span><span class="sxs-lookup"><span data-stu-id="f66ef-110">WinRM clients and servers will support CredSSP authentication only with explicit credentials.</span></span>

 

## <a name="multi-hop-support-configuration-setup-and-details"></a><span data-ttu-id="f66ef-111">Configuration et détails de la configuration de la prise en charge de plusieurs tronçons</span><span class="sxs-lookup"><span data-stu-id="f66ef-111">Multi-Hop Support Configuration Setup and Details</span></span>

<span data-ttu-id="f66ef-112">Il existe plusieurs mécanismes pour configurer les paramètres WinRM.</span><span class="sxs-lookup"><span data-stu-id="f66ef-112">There are multiple mechanisms for configuring WinRM settings.</span></span> <span data-ttu-id="f66ef-113">Dans la procédure suivante, l’utilitaire **WinRM** et l’éditeur de stratégie de groupe (**gpedit. msc**) sont utilisés.</span><span class="sxs-lookup"><span data-stu-id="f66ef-113">In the following procedure, the **winrm** utility and Group Policy editor (**GPEdit.msc**) are used.</span></span> <span data-ttu-id="f66ef-114">CredSSP peut également être activé pour WinRM à l’aide de Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f66ef-114">CredSSP can also be enabled for WinRM by using Windows PowerShell.</span></span> <span data-ttu-id="f66ef-115">Pour obtenir des informations de configuration détaillées et des exemples d’utilisation, consultez les applets de commande Windows PowerShell [Enable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true), [obten-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true)et [Disable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) .</span><span class="sxs-lookup"><span data-stu-id="f66ef-115">See the [Enable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true), [Get-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true), and [Disable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) Windows PowerShell cmdlets for detailed configuration information and usage examples.</span></span>

<span data-ttu-id="f66ef-116">La délégation CredSSP doit être activée dans les paramètres client et dans les paramètres de service sur l’ordinateur distant.</span><span class="sxs-lookup"><span data-stu-id="f66ef-116">CredSSP delegation must be enabled in the client settings and in the service settings on the remote computer.</span></span> <span data-ttu-id="f66ef-117">En outre, l’utilisation de CredSSP requiert la configuration d’un [*écouteur*](windows-remote-management-glossary.md) HTTP ou https sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="f66ef-117">In addition, using CredSSP requires setting up an HTTP or HTTPS [*listener*](windows-remote-management-glossary.md) on the server.</span></span>

<span data-ttu-id="f66ef-118">**Pour configurer la prise en charge de plusieurs tronçons à l’aide de l’authentification CredSSP pour WinRM**</span><span class="sxs-lookup"><span data-stu-id="f66ef-118">**To configure multi-hop support using CredSSP authentication for WinRM**</span></span>

1.  <span data-ttu-id="f66ef-119">CredSSP doit être activé dans les paramètres de configuration du client.</span><span class="sxs-lookup"><span data-stu-id="f66ef-119">CredSSP must be enabled in the client configuration settings.</span></span> <span data-ttu-id="f66ef-120">Cet indicateur peut être activé manuellement ou par le biais d’un paramètre de stratégie de groupe.</span><span class="sxs-lookup"><span data-stu-id="f66ef-120">This flag can be enabled manually or through a Group Policy setting.</span></span> <span data-ttu-id="f66ef-121">La valeur par défaut est **False**.</span><span class="sxs-lookup"><span data-stu-id="f66ef-121">The default setting is **False**.</span></span> <span data-ttu-id="f66ef-122">La stratégie **autoriser l’authentification CredSSP** se trouve à l’emplacement suivant : Configuration ordinateur \\ modèle d’administration \\ composants Windows \\ Windows Remote Management (WinRM) \\ WinRM client.</span><span class="sxs-lookup"><span data-stu-id="f66ef-122">The **Allow CredSSP authentication** policy is located at the following path: Computer Configuration\\Administrative template\\Windows Components\\Windows Remote Management (WinRM)\\WinRM Client.</span></span>

    <span data-ttu-id="f66ef-123">La commande suivante montre comment utiliser l’utilitaire WinRM pour activer CredSSP sur le client WinRM :</span><span class="sxs-lookup"><span data-stu-id="f66ef-123">The following command demonstrates how to use the winrm utility to enable CredSSP on the WinRM client:</span></span>

    <span data-ttu-id="f66ef-124">**winrm set winrm/config/client/auth @ {CredSSP = "true"}**</span><span class="sxs-lookup"><span data-stu-id="f66ef-124">**winrm set winrm/config/client/auth @{CredSSP="true"}**</span></span>

2.  <span data-ttu-id="f66ef-125">CredSSP doit être activé dans les paramètres de configuration du service WinRM.</span><span class="sxs-lookup"><span data-stu-id="f66ef-125">CredSSP must be enabled in the WinRM service configuration settings.</span></span> <span data-ttu-id="f66ef-126">Cet indicateur peut être activé manuellement ou par le biais d’un paramètre de stratégie de groupe.</span><span class="sxs-lookup"><span data-stu-id="f66ef-126">This flag can be enabled manually or through a Group Policy setting.</span></span> <span data-ttu-id="f66ef-127">La valeur par défaut est **False**.</span><span class="sxs-lookup"><span data-stu-id="f66ef-127">The default setting is **False**.</span></span> <span data-ttu-id="f66ef-128">La stratégie **autoriser l’authentification CredSSP** se trouve à l’emplacement suivant : Configuration ordinateur \\ modèle d’administration \\ composants Windows \\ Windows Remote Management (WinRM) \\ WinRM service.</span><span class="sxs-lookup"><span data-stu-id="f66ef-128">The **Allow CredSSP authentication** policy is located at the following path: Computer Configuration\\Administrative template\\Windows Components\\Windows Remote Management (WinRM)\\WinRM Service.</span></span>

    <span data-ttu-id="f66ef-129">La commande suivante montre comment utiliser l’utilitaire WinRM pour activer CredSSP sur le service WinRM :</span><span class="sxs-lookup"><span data-stu-id="f66ef-129">The following command demonstrates how to use the winrm utility to enable CredSSP on the WinRM service:</span></span>

    <span data-ttu-id="f66ef-130">**winrm set winrm/config/service/auth @ {CredSSP = "true"}**</span><span class="sxs-lookup"><span data-stu-id="f66ef-130">**winrm set winrm/config/service/auth @{CredSSP="true"}**</span></span>

3.  <span data-ttu-id="f66ef-131">Le paramètre de stratégie autoriser la délégation de nouvelles informations d’identification (**AllowFreshCredentials**) doit être activé sur le client WinRM, et un nom de principal du service (SPN) avec le préfixe WSMan doit être ajouté à la stratégie.</span><span class="sxs-lookup"><span data-stu-id="f66ef-131">The Allow Delegating Fresh Credentials (**AllowFreshCredentials**) policy setting must be enabled on the WinRM client, and a Service Principal Name (SPN) with the WSMAN prefix must be added to the policy.</span></span> <span data-ttu-id="f66ef-132">Le SPN représente l’ordinateur cible auquel les informations d’identification de l’utilisateur peuvent être déléguées.</span><span class="sxs-lookup"><span data-stu-id="f66ef-132">The SPN represents the target computer to which the user credentials can be delegated.</span></span> <span data-ttu-id="f66ef-133">Le SPN peut être défini sur un ou plusieurs ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="f66ef-133">The SPN can be set to one or more computers.</span></span> <span data-ttu-id="f66ef-134">Le tableau suivant contient des exemples de formats valides pour les noms de principal du service.</span><span class="sxs-lookup"><span data-stu-id="f66ef-134">The following table contains examples of valid formats for SPNs.</span></span>

    

    | <span data-ttu-id="f66ef-135">SPN</span><span class="sxs-lookup"><span data-stu-id="f66ef-135">SPN</span></span>                                       | <span data-ttu-id="f66ef-136">Description</span><span class="sxs-lookup"><span data-stu-id="f66ef-136">Description</span></span>                                                                         |
    |-------------------------------------------|-------------------------------------------------------------------------------------|
    | <span data-ttu-id="f66ef-137">WSMAN/myComputer. myDomain. com</span><span class="sxs-lookup"><span data-stu-id="f66ef-137">WSMAN/myComputer.myDomain.com</span></span><br/>  | <span data-ttu-id="f66ef-138">Serveur WinRM s’exécutant sur myComputer.myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="f66ef-138">WinRM server running on myComputer.myDomain.com.</span></span><br/>                         |
    | <span data-ttu-id="f66ef-139">WSMAN/ \* . mydomain.com</span><span class="sxs-lookup"><span data-stu-id="f66ef-139">WSMAN/\*.myDomain.com</span></span><br/>          | <span data-ttu-id="f66ef-140">Tous les serveurs WinRM s’exécutant dans myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="f66ef-140">All WinRM servers running in myDomain.com.</span></span><br/>                               |
    | <span data-ttu-id="f66ef-141">WSMAN/ \* . fabrikam.mydomain.com</span><span class="sxs-lookup"><span data-stu-id="f66ef-141">WSMAN/\*.fabrikam.myDomain.com</span></span><br/> | <span data-ttu-id="f66ef-142">Tous les serveurs WinRM s’exécutant sur sur tous les ordinateurs dans. fabrikam.myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="f66ef-142">All WinRM servers running in on all computers in .fabrikam.myDomain.com.</span></span><br/> |

    

     

    <span data-ttu-id="f66ef-143">Pour plus d’informations sur la définition des stratégies de groupe, consultez [installation et configuration de Windows Remote Management](installation-and-configuration-for-windows-remote-management.md).</span><span class="sxs-lookup"><span data-stu-id="f66ef-143">For more information about setting Group Policies, see [Installation and Configuration for Windows Remote Management](installation-and-configuration-for-windows-remote-management.md).</span></span>

    <span data-ttu-id="f66ef-144">Pour plus d’informations sur la stratégie **AllowFreshCredentials** , consultez la description de la stratégie fournie par l’éditeur de stratégie de groupe et [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="f66ef-144">For more information about the **AllowFreshCredentials** policy, see the policy description provided by the Group Policy editor and [KB 951608](https://support.microsoft.com/kb/951608).</span></span> <span data-ttu-id="f66ef-145">La stratégie **AllowFreshCredentials** se trouve à l’emplacement suivant : Configuration ordinateur \\ modèles d’administration \\ délégation des \\ informations d’identification système.</span><span class="sxs-lookup"><span data-stu-id="f66ef-145">The **AllowFreshCredentials** policy is located at the following path: Computer Configuration\\Administrative Templates\\System\\Credentials Delegation.</span></span>

4.  <span data-ttu-id="f66ef-146">Un [*écouteur*](windows-remote-management-glossary.md) HTTPS ou http doit être configuré sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="f66ef-146">An HTTPS or HTTP [*listener*](windows-remote-management-glossary.md) must be configured on the server.</span></span> <span data-ttu-id="f66ef-147">L’empreinte numérique de certificat utilisée pour configurer l' *écouteur* HTTPS est également utilisée pour configurer le paramètre CertificateThumbprint sous les paramètres du service WinRM.</span><span class="sxs-lookup"><span data-stu-id="f66ef-147">The certificate thumbprint used for configuring the HTTPS *listener* is also used to configure the CertificateThumbprint setting under the WinRM service settings.</span></span>

    <span data-ttu-id="f66ef-148">La commande suivante montre comment utiliser l’utilitaire WinRM pour configurer un [*écouteur*](windows-remote-management-glossary.md)https :</span><span class="sxs-lookup"><span data-stu-id="f66ef-148">The following command demonstrates how to use the winrm utility to configure an HTTPS [*listener*](windows-remote-management-glossary.md):</span></span>

    <span data-ttu-id="f66ef-149">**WinRM quickconfig-transport : https**</span><span class="sxs-lookup"><span data-stu-id="f66ef-149">**winrm quickconfig -transport:https**</span></span>

<span data-ttu-id="f66ef-150">Si l’authentification Kerberos entre le client et le serveur n’est pas possible, l’utilisateur doit configurer l’un des paramètres suivants pour la prise en charge de plusieurs sauts :</span><span class="sxs-lookup"><span data-stu-id="f66ef-150">If Kerberos authentication between the client and server is not possible, the user must configure one of the following settings for multi-hop support:</span></span>

-   <span data-ttu-id="f66ef-151">Pour une meilleure sécurité, l’utilisateur doit ajouter l’attribut **CertificateThumbprint** au paramètre du service WinRM.</span><span class="sxs-lookup"><span data-stu-id="f66ef-151">For better security, the user should add the **CertificateThumbprint** attribute to the WinRM service setting.</span></span> <span data-ttu-id="f66ef-152">Si le service WinRM est configuré avec un attribut **CertificateThumbprint** , le service tente de localiser le certificat correspondant dans le magasin de l’ordinateur local et utilise ce certificat pour l’authentification CredSSP.</span><span class="sxs-lookup"><span data-stu-id="f66ef-152">If the WinRM service is configured with a **CertificateThumbprint** attribute, the service attempts to locate the corresponding certificate in the Local Machine store and uses this certificate for the CredSSP authentication.</span></span> <span data-ttu-id="f66ef-153">Si le service WinRM utilise un certificat du magasin de l’ordinateur local pour authentifier le serveur, le compte de service réseau doit être autorisé à accéder à la clé privée du certificat.</span><span class="sxs-lookup"><span data-stu-id="f66ef-153">If the WinRM service uses a certificate from the Local Machine store to authenticate the server, the Network Service account must be allowed access to the private key of the certificate.</span></span>

    > [!Note]  
    > <span data-ttu-id="f66ef-154">Si le paramètre de service n’est pas configuré, le serveur WinRM utilise un certificat auto-signé qui est créé en mémoire pour chiffrer les messages envoyés au client.</span><span class="sxs-lookup"><span data-stu-id="f66ef-154">If the service setting is not configured, the WinRM server uses a self-signed certificate that is created in memory to encrypt messages sent to the client.</span></span> <span data-ttu-id="f66ef-155">Toutefois, ce certificat n’est pas utilisé pour l’authentification.</span><span class="sxs-lookup"><span data-stu-id="f66ef-155">However, this certificate is not used for authentication.</span></span>

     

-   <span data-ttu-id="f66ef-156">Si aucune authentification Kerberos ni aucune empreinte de certificat n’est disponible, l’utilisateur peut activer l’authentification NTLM.</span><span class="sxs-lookup"><span data-stu-id="f66ef-156">If neither Kerberos authentication nor certificate thumbprints are available, the user can enable NTLM authentication.</span></span> <span data-ttu-id="f66ef-157">Si l’authentification NTLM est utilisée, la stratégie autoriser les nouvelles informations d’identification avec l’authentification de serveur NTLM uniquement (**AllowFreshCredentialsWhenNTLMOnly**) doit être activée et un nom principal de service avec le préfixe WSMan doit être ajouté à la stratégie.</span><span class="sxs-lookup"><span data-stu-id="f66ef-157">If NTLM authentication is used, the Allow Fresh Credentials with NTLM-only Server Authentication (**AllowFreshCredentialsWhenNTLMOnly**) policy must be enabled, and an SPN with the WSMAN prefix must be added to the policy.</span></span> <span data-ttu-id="f66ef-158">Ce paramètre est moins sécurisé que l’authentification Kerberos et les empreintes numériques des certificats, car les informations d’identification sont envoyées à un serveur non authentifié.</span><span class="sxs-lookup"><span data-stu-id="f66ef-158">This setting is less secure than both Kerberos authentication and certificate thumbprints, because credentials are sent to an unauthenticated server.</span></span>

    <span data-ttu-id="f66ef-159">Pour plus d’informations sur la stratégie **AllowFreshCredentialsWhenNTLMOnly** , consultez la description de la stratégie fournie par l’éditeur de stratégie de groupe et [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="f66ef-159">For more information about the **AllowFreshCredentialsWhenNTLMOnly** policy, see the policy description provided by the Group Policy editor and [KB 951608](https://support.microsoft.com/kb/951608).</span></span> <span data-ttu-id="f66ef-160">La stratégie **AllowFreshCredentialsWhenNTLMOnly** se trouve à l’emplacement suivant : Configuration ordinateur \\ modèles d’administration \\ délégation des \\ informations d’identification système.</span><span class="sxs-lookup"><span data-stu-id="f66ef-160">The **AllowFreshCredentialsWhenNTLMOnly** policy is located at the following path: Computer Configuration\\Administrative Templates\\System\\Credentials Delegation.</span></span>

## <a name="using-credssp-authentication-with-explicit-credentials"></a><span data-ttu-id="f66ef-161">Utilisation de l’authentification CredSSP avec des informations d’identification explicites</span><span class="sxs-lookup"><span data-stu-id="f66ef-161">Using CredSSP Authentication with Explicit Credentials</span></span>

<span data-ttu-id="f66ef-162">Un utilisateur peut spécifier des informations d’identification explicites sur HTTP et HTTPs.</span><span class="sxs-lookup"><span data-stu-id="f66ef-162">A user can specify explicit credentials over both HTTP and HTTPS.</span></span> <span data-ttu-id="f66ef-163">La commande suivante montre comment utiliser l’utilitaire WinRM pour effectuer une opération distante à l’aide de l’authentification CredSSP avec des informations d’identification explicites sur HTTPs :</span><span class="sxs-lookup"><span data-stu-id="f66ef-163">The following command demonstrates how to use the winrm utility to perform a remote operation using CredSSP authentication with explicit credentials over HTTPS:</span></span>

<span data-ttu-id="f66ef-164">**WinRM OPERATION-Remote : https://myMachine -Authentication : CredSSP-username : myUsername-Password : monmotdepasse**</span><span class="sxs-lookup"><span data-stu-id="f66ef-164">**winrm OPERATION -remote:https://myMachine -authentication:CredSSP -username:myUsername -password:myPassword**</span></span>

 

