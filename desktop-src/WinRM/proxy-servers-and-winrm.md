---
title: Serveurs proxy et WinRM
description: Windows Remote Management (WinRM) utilise HTTP et HTTPs pour envoyer des messages entre les ordinateurs client et serveur. En général, le client WinRM envoie des messages directement au serveur WinRM. Les clients WinRM peuvent également être configurés pour utiliser un serveur proxy.
ms.assetid: f8137b3a-7704-4b21-a923-6e2692e18d90
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e07bbfebb4c8f0eb9e77a8942d54677b55c60006
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103727397"
---
# <a name="proxy-servers-and-winrm"></a><span data-ttu-id="951a0-105">Serveurs proxy et WinRM</span><span class="sxs-lookup"><span data-stu-id="951a0-105">Proxy Servers and WinRM</span></span>

<span data-ttu-id="951a0-106">Windows Remote Management (WinRM) utilise HTTP et HTTPs pour envoyer des messages entre les ordinateurs client et serveur.</span><span class="sxs-lookup"><span data-stu-id="951a0-106">Windows Remote Management (WinRM) uses HTTP and HTTPS to send messages between the client and server computers.</span></span> <span data-ttu-id="951a0-107">En général, le client WinRM envoie des messages directement au serveur WinRM.</span><span class="sxs-lookup"><span data-stu-id="951a0-107">In general, the WinRM client sends messages directly to the WinRM server.</span></span> <span data-ttu-id="951a0-108">Les clients WinRM peuvent également être configurés pour utiliser un serveur proxy.</span><span class="sxs-lookup"><span data-stu-id="951a0-108">WinRM clients can be also configured to use a proxy server.</span></span>

<span data-ttu-id="951a0-109">Pour plus d'informations, consultez les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="951a0-109">For more information, see the following sections:</span></span>

-   [<span data-ttu-id="951a0-110">Configuration d’un serveur proxy pour WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="951a0-110">Configuring a Proxy Server for WinRM 2.0</span></span>](#configuring-a-proxy-server-for-winrm-20)
    -   [<span data-ttu-id="951a0-111">Connexions par proxy HTTPs</span><span class="sxs-lookup"><span data-stu-id="951a0-111">HTTPS-Based Proxy Connections</span></span>](#https-based-proxy-connections)
    -   [<span data-ttu-id="951a0-112">Connexions par proxy basées sur HTTP</span><span class="sxs-lookup"><span data-stu-id="951a0-112">HTTP-Based Proxy Connections</span></span>](#http-based-proxy-connections)
-   [<span data-ttu-id="951a0-113">Configuration d’un serveur proxy pour WinRM 1,1 et versions antérieures</span><span class="sxs-lookup"><span data-stu-id="951a0-113">Configuring a Proxy Server for WinRM 1.1 and Earlier</span></span>](#configuring-a-proxy-server-for-winrm-11-and-earlier)

## <a name="configuring-a-proxy-server-for-winrm-20"></a><span data-ttu-id="951a0-114">Configuration d’un serveur proxy pour WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="951a0-114">Configuring a Proxy Server for WinRM 2.0</span></span>

<span data-ttu-id="951a0-115">WinRM 2,0 prend en charge un large éventail de configurations de proxy.</span><span class="sxs-lookup"><span data-stu-id="951a0-115">WinRM 2.0 supports a wide range of proxy configurations.</span></span> <span data-ttu-id="951a0-116">Par exemple, WinRM prend en charge les proxies pour les transports HTTP et HTTPs, ainsi que pour les serveurs proxy authentifiés et non authentifiés.</span><span class="sxs-lookup"><span data-stu-id="951a0-116">For example, WinRM supports proxies for HTTP and HTTPS transports and for authenticated and unauthenticated proxy servers.</span></span>

### <a name="https-based-proxy-connections"></a><span data-ttu-id="951a0-117">Connexions HTTPS-Based proxy</span><span class="sxs-lookup"><span data-stu-id="951a0-117">HTTPS-Based Proxy Connections</span></span>

<span data-ttu-id="951a0-118">Pour une meilleure sécurité et une affinité basée sur la connexion, le protocole HTTPs doit être utilisé comme mécanisme de transport.</span><span class="sxs-lookup"><span data-stu-id="951a0-118">For better security and connection-based affinity, HTTPS should be used as the transport mechanism.</span></span>

<span data-ttu-id="951a0-119">Si le serveur proxy requiert une authentification, les clients et les serveurs WinRM doivent utiliser le protocole HTTPs.</span><span class="sxs-lookup"><span data-stu-id="951a0-119">If the proxy server requires authentication, the WinRM clients and servers must use HTTPS.</span></span>

> [!Note]  
> <span data-ttu-id="951a0-120">L’authentification auprès du serveur proxy est indépendante de l’authentification au serveur de destination.</span><span class="sxs-lookup"><span data-stu-id="951a0-120">Authentication to the proxy server is independent from the authentication to the destination server.</span></span>

 

### <a name="http-based-proxy-connections"></a><span data-ttu-id="951a0-121">Connexions HTTP-Based proxy</span><span class="sxs-lookup"><span data-stu-id="951a0-121">HTTP-Based Proxy Connections</span></span>

<span data-ttu-id="951a0-122">Si aucune authentification du serveur proxy n’est requise, le protocole HTTP ou HTTPs peut être utilisé pour le transport.</span><span class="sxs-lookup"><span data-stu-id="951a0-122">If no proxy server authentication is required, either HTTP or HTTPs can be used for transport.</span></span> <span data-ttu-id="951a0-123">Toutefois, les connexions basées sur HTTP entre un client WinRM et un serveur WinRM via un serveur proxy peuvent être problématiques.</span><span class="sxs-lookup"><span data-stu-id="951a0-123">However, HTTP-based connections from a WinRM client to a WinRM server through a proxy server can be problematic.</span></span>

<span data-ttu-id="951a0-124">Les problèmes suivants peuvent se produire lors de l’utilisation de connexions basées sur HTTP :</span><span class="sxs-lookup"><span data-stu-id="951a0-124">The following issues might be encountered when using HTTP-based connections:</span></span>

-   <span data-ttu-id="951a0-125">Le serveur proxy ne prend pas en charge l’authentification basée sur la connexion, ce qui peut entraîner l’échec de l’authentification sur le serveur de destination en raison d’une erreur d’accès refusé.</span><span class="sxs-lookup"><span data-stu-id="951a0-125">The proxy server does not support connection-based authentication, which can cause the authentication against the destination server to fail with an access denied error.</span></span>
-   <span data-ttu-id="951a0-126">Plusieurs ensembles d’informations d’identification sont nécessaires pour se connecter au serveur de destination et au serveur proxy.</span><span class="sxs-lookup"><span data-stu-id="951a0-126">More than one set of credentials is needed to connect to the destination server and to the proxy server.</span></span>
-   <span data-ttu-id="951a0-127">Les serveurs proxy HTTP peuvent ne pas prendre en charge la possibilité de gérer les connexions serveur et basées sur le client associées.</span><span class="sxs-lookup"><span data-stu-id="951a0-127">HTTP-based proxy servers might not support the ability to maintain the associated client-based and server-based connections.</span></span> <span data-ttu-id="951a0-128">Si le proxy ne lie pas fortement un client à un serveur et conserve la connexion TCP/IP, les clients non authentifiés peuvent accéder aux données.</span><span class="sxs-lookup"><span data-stu-id="951a0-128">If the proxy does not strongly link a client to a server and maintain the TCP/IP connection, unauthenticated clients might gain access to data.</span></span> <span data-ttu-id="951a0-129">En outre, l’absence d’affinité de connexion peut entraîner l’échec de l’authentification sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="951a0-129">Also, the lack of connection affinity might cause the authentication to fail against the server.</span></span>

<span data-ttu-id="951a0-130">Si vous devez utiliser le protocole HTTP comme transport, le serveur proxy doit prendre en charge la configuration suivante pour obtenir une meilleure réponse WinRM et empêcher les échecs d’accès refusés pour les clients WinRM :</span><span class="sxs-lookup"><span data-stu-id="951a0-130">If HTTP must be used as the transport, the proxy server should support the following configuration to achieve a better WinRM response and to prevent access denied failures for WinRM clients:</span></span>

-   <span data-ttu-id="951a0-131">Prise en charge de HTTP/1.1.</span><span class="sxs-lookup"><span data-stu-id="951a0-131">Support for HTTP/1.1.</span></span> <span data-ttu-id="951a0-132">HTTP/1.1 est plus strict dans le mappage de l’affinité de connexion entre le client et le serveur.</span><span class="sxs-lookup"><span data-stu-id="951a0-132">HTTP/1.1 is more stringent in mapping connection affinity between client and server.</span></span>
-   <span data-ttu-id="951a0-133">Authentification basée sur la connexion pour Negotiate, Kerberos et CredSSP.</span><span class="sxs-lookup"><span data-stu-id="951a0-133">Connection-based authentication for Negotiate, Kerberos, and CredSSP authentication.</span></span>

    <span data-ttu-id="951a0-134">L’authentification d’une demande nécessite plusieurs allers-retours entre le client et le serveur.</span><span class="sxs-lookup"><span data-stu-id="951a0-134">Authentication of a request requires multiple round-trips between the client and server.</span></span> <span data-ttu-id="951a0-135">La plus grande négociation pour l’authentification est terminée une fois que le serveur d’authentification (WinRM) a envoyé une réponse au client qui n’est pas une réponse 401 (non autorisé).</span><span class="sxs-lookup"><span data-stu-id="951a0-135">Most negotiation for authentication is complete after the authenticating (WinRM) server sends a response to the client that is not a 401 response (Unauthorized).</span></span> <span data-ttu-id="951a0-136">Si le serveur WinRM renvoie une réponse au client qui n’est pas une réponse 401, le proxy ne doit pas fermer la connexion.</span><span class="sxs-lookup"><span data-stu-id="951a0-136">If the WinRM server returns a response to the client that is not a 401 response, the proxy should not close the connection.</span></span>

    <span data-ttu-id="951a0-137">Plusieurs paires demande/réponse peuvent être envoyées entre le client et le serveur avant l’envoi des données de paquet réelles.</span><span class="sxs-lookup"><span data-stu-id="951a0-137">Multiple request/response pairs can be sent between client and server before the actual packet data is sent.</span></span> <span data-ttu-id="951a0-138">WinRM 2,0 utilise les schémas d’authentification Negotiate et Kerberos avec le chiffrement, ce qui peut ajouter des allers-retours supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="951a0-138">WinRM 2.0 uses the Negotiate and Kerberos authentication schemes with encryption, which can add extra round-trips.</span></span> <span data-ttu-id="951a0-139">Les données ne peuvent pas être envoyées au serveur tant que l’authentification n’est pas terminée.</span><span class="sxs-lookup"><span data-stu-id="951a0-139">Data cannot be sent to the server until the authentication is complete.</span></span>

    <span data-ttu-id="951a0-140">Le serveur WinRM renvoie une réponse de niveau 200 qui indique que l’authentification est terminée.</span><span class="sxs-lookup"><span data-stu-id="951a0-140">The WinRM server returns a 200-level response that indicates that the authentication is complete.</span></span> <span data-ttu-id="951a0-141">Les serveurs proxy HTTP peuvent mettre fin à l’affinité d’authentification basée sur la connexion et fermer la connexion TCP/IP après avoir reçu la réponse de niveau 200 du serveur WinRM.</span><span class="sxs-lookup"><span data-stu-id="951a0-141">HTTP-based proxy servers might end the connection-based authentication affinity and close the TCP/IP connection after receiving the 200-level response from the WinRM server.</span></span> <span data-ttu-id="951a0-142">Le dernier aller-retour entre le client et le serveur n’inclut pas le paquet de demande d’origine.</span><span class="sxs-lookup"><span data-stu-id="951a0-142">The final round-trip from client to server does not include the original request packet.</span></span> <span data-ttu-id="951a0-143">Si le serveur proxy ferme la connexion, le serveur tente de réauthentifier le client et la demande du client n’est peut-être jamais envoyée au serveur.</span><span class="sxs-lookup"><span data-stu-id="951a0-143">If the proxy server closes the connection, the server will attempt to re-authenticate the client and the client request might never be sent to the server.</span></span> <span data-ttu-id="951a0-144">Si l’affinité basée sur la connexion n’est pas gérée, l’authentification par rapport au serveur de destination peut échouer avec une erreur d’accès refusé.</span><span class="sxs-lookup"><span data-stu-id="951a0-144">If the connection-based affinity is not maintained, authentication against the destination server can fail with an access denied error.</span></span>

-   <span data-ttu-id="951a0-145">Persistance de la connexion.</span><span class="sxs-lookup"><span data-stu-id="951a0-145">Connection persistence.</span></span> <span data-ttu-id="951a0-146">La connexion TCP/IP du client au proxy doit continuer à mapper à la même connexion TCP/IP entre le proxy et le serveur.</span><span class="sxs-lookup"><span data-stu-id="951a0-146">The client TCP/IP connection to the proxy should continue to map to the same TCP/IP connection from the proxy to the server.</span></span> <span data-ttu-id="951a0-147">La gestion de cette connexion permet d’obtenir un niveau de performance plus élevé.</span><span class="sxs-lookup"><span data-stu-id="951a0-147">Maintaining this connection helps to achieve a higher level of performance.</span></span> <span data-ttu-id="951a0-148">Si la connexion n’est pas maintenue, chaque requête doit être authentifiée de nouveau, ce qui peut affecter les performances.</span><span class="sxs-lookup"><span data-stu-id="951a0-148">If the connection is not maintained, every request must be re-authenticated, which might affect performance.</span></span>

### <a name="encryption-and-winrm-20"></a><span data-ttu-id="951a0-149">Chiffrement et WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="951a0-149">Encryption and WinRM 2.0</span></span>

<span data-ttu-id="951a0-150">WinRM 2,0 prend en charge le chiffrement sur HTTP à l’aide des schémas d’authentification Negotiate, Kerberos et CredSSP.</span><span class="sxs-lookup"><span data-stu-id="951a0-150">WinRM 2.0 supports encryption over HTTP by using the Negotiate, Kerberos, and CredSSP authentication schemes.</span></span> <span data-ttu-id="951a0-151">Si un serveur WinRM prend en charge le protocole HTTP et est accessible via un proxy, le serveur WinRM doit appliquer le chiffrement et ne pas autoriser le trafic réseau non chiffré.</span><span class="sxs-lookup"><span data-stu-id="951a0-151">If a WinRM server supports HTTP and is accessed through a proxy, the WinRM server must enforce encryption and not allow unencrypted network traffic.</span></span>

<span data-ttu-id="951a0-152">Dans tous les cas, les requêtes HTTP non chiffrées doivent être envoyées par les serveurs proxy.</span><span class="sxs-lookup"><span data-stu-id="951a0-152">Under no circumstances should unencrypted HTTP requests be sent through proxy servers.</span></span> <span data-ttu-id="951a0-153">Lorsque les données doivent traverser un serveur proxy avant d’être envoyées au serveur de destination, les problèmes de sécurité suivants sont très importants :</span><span class="sxs-lookup"><span data-stu-id="951a0-153">When data must pass through a proxy server before being sent to the destination server, the following security issues are very important:</span></span>

-   <span data-ttu-id="951a0-154">Il est possible qu’un serveur proxy malveillant examine toutes les paires demande/réponse, y compris les informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="951a0-154">It is possible that a malicious proxy server could examine every request/response pair, including credentials.</span></span>
-   <span data-ttu-id="951a0-155">Si les connexions TCP/IP ne sont pas fortement mappées entre le client WinRM et le serveur proxy, et entre le serveur proxy et le serveur de destination, un client non autorisé peut se connecter au serveur de destination à l’aide de la même connexion authentifiée entre le serveur proxy et le serveur de destination.</span><span class="sxs-lookup"><span data-stu-id="951a0-155">If the TCP/IP connections are not strongly mapped between both the WinRM client and the proxy server and between the proxy server and the destination server, an unauthorized client could connect to the destination server by using the same authenticated connection from the proxy server to the destination server.</span></span> <span data-ttu-id="951a0-156">Le serveur de destination peut autoriser l’accès du client non authentifié aux données.</span><span class="sxs-lookup"><span data-stu-id="951a0-156">The destination server might allow the unauthenticated client access to data.</span></span> <span data-ttu-id="951a0-157">Si le chiffrement est appliqué, le serveur de destination envoie un message d’accès refusé au client non authentifié.</span><span class="sxs-lookup"><span data-stu-id="951a0-157">If encryption is enforced, the destination server sends an access denied message to the unauthenticated client.</span></span>

<span data-ttu-id="951a0-158">L’utilisation du chiffrement permet d’atténuer les problèmes de sécurité potentiels.</span><span class="sxs-lookup"><span data-stu-id="951a0-158">Using encryption would mitigate these potential security issues.</span></span>

## <a name="configuring-a-proxy-server-for-winrm-11-and-earlier"></a><span data-ttu-id="951a0-159">Configuration d’un serveur proxy pour WinRM 1,1 et versions antérieures</span><span class="sxs-lookup"><span data-stu-id="951a0-159">Configuring a Proxy Server for WinRM 1.1 and Earlier</span></span>

<span data-ttu-id="951a0-160">Si un proxy est requis pour atteindre le serveur WinRM, le client WinRM s’appuie sur la configuration du proxy des services HTTP Windows (WinHTTP).</span><span class="sxs-lookup"><span data-stu-id="951a0-160">If a proxy is required to reach the WinRM server, the WinRM client relies on the Windows HTTP services (WinHTTP) proxy configuration.</span></span> <span data-ttu-id="951a0-161">Par défaut, WinHTTP n’est pas configuré pour utiliser un serveur proxy.</span><span class="sxs-lookup"><span data-stu-id="951a0-161">By default, WinHTTP is not configured to use a proxy server.</span></span> <span data-ttu-id="951a0-162">La configuration du proxy WinHTTP peut être modifiée à l’aide des utilitaires de ligne de commande [ProxyCfg.exe](/previous-versions/windows/desktop/ms761351(v=vs.85)) ou [netsh](/previous-versions/windows/it-pro/windows-server-2003/cc785383(v=ws.10)) .</span><span class="sxs-lookup"><span data-stu-id="951a0-162">WinHTTP proxy configuration can be changed by using the [ProxyCfg.exe](/previous-versions/windows/desktop/ms761351(v=vs.85)) or [netsh](/previous-versions/windows/it-pro/windows-server-2003/cc785383(v=ws.10)) command-line utilities.</span></span>

<span data-ttu-id="951a0-163">**WinRM 1,1 et versions antérieures :** WinRM n’utilise pas les paramètres de proxy d’Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="951a0-163">**WinRM 1.1 and Earlier:** WinRM does not use the Internet Explorer proxy settings.</span></span>

 

 