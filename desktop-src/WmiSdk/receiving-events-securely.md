---
description: Les consommateurs temporaires et permanents ont des méthodes différentes pour sécuriser la remise des événements.
ms.assetid: cd02e5db-f9e2-438b-9632-0a1387a6d4e3
ms.tgt_platform: multiple
title: Réception des événements en toute sécurité
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f27d156213553ee17a346d780cbea0ff82beca83
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106537042"
---
# <a name="receiving-events-securely"></a><span data-ttu-id="368c4-103">Réception des événements en toute sécurité</span><span class="sxs-lookup"><span data-stu-id="368c4-103">Receiving Events Securely</span></span>

<span data-ttu-id="368c4-104">Les consommateurs temporaires et permanents ont des méthodes différentes pour sécuriser la remise des événements.</span><span class="sxs-lookup"><span data-stu-id="368c4-104">Temporary and permanent consumers have different methods of securing event delivery.</span></span>

<span data-ttu-id="368c4-105">Les sections suivantes sont présentées dans cette rubrique :</span><span class="sxs-lookup"><span data-stu-id="368c4-105">The following sections are discussed in this topic:</span></span>

-   [<span data-ttu-id="368c4-106">Sécurisation des consommateurs temporaires</span><span class="sxs-lookup"><span data-stu-id="368c4-106">Securing Temporary Consumers</span></span>](#securing-temporary-consumers)
-   [<span data-ttu-id="368c4-107">Sécurisation des consommateurs permanents</span><span class="sxs-lookup"><span data-stu-id="368c4-107">Securing Permanent Consumers</span></span>](#securing-permanent-consumers)
-   [<span data-ttu-id="368c4-108">Sécurisation de l’abonnement permanent</span><span class="sxs-lookup"><span data-stu-id="368c4-108">Securing the Permanent Subscription</span></span>](#securing-the-permanent-subscription)
-   [<span data-ttu-id="368c4-109">Définition d’une Administrator-Only SD</span><span class="sxs-lookup"><span data-stu-id="368c4-109">Setting an Administrator-Only SD</span></span>](#setting-an-administrator-only-sd)
-   [<span data-ttu-id="368c4-110">Emprunt de l’identité du fournisseur d’événements</span><span class="sxs-lookup"><span data-stu-id="368c4-110">Impersonating the Event Provider Identity</span></span>](#impersonating-the-event-provider-identity)
-   [<span data-ttu-id="368c4-111">Sid et abonnements permanents</span><span class="sxs-lookup"><span data-stu-id="368c4-111">SIDs and Permanent Subscriptions</span></span>](#sids-and-permanent-subscriptions)
-   [<span data-ttu-id="368c4-112">Création d’abonnements permanents à l’aide de comptes de domaine</span><span class="sxs-lookup"><span data-stu-id="368c4-112">Creating Permanent Subscriptions Using Domain Accounts</span></span>](#creating-permanent-subscriptions-using-domain-accounts)
-   [<span data-ttu-id="368c4-113">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="368c4-113">Related topics</span></span>](#related-topics)

## <a name="securing-temporary-consumers"></a><span data-ttu-id="368c4-114">Sécurisation des consommateurs temporaires</span><span class="sxs-lookup"><span data-stu-id="368c4-114">Securing Temporary Consumers</span></span>

<span data-ttu-id="368c4-115">Un [*consommateur temporaire*](gloss-t.md) s’exécute jusqu’à ce que le système soit redémarré ou que WMI soit arrêté, mais ne peut pas être démarré si un événement spécifique est déclenché.</span><span class="sxs-lookup"><span data-stu-id="368c4-115">A [*temporary consumers*](gloss-t.md) runs until the system is rebooted or WMI is stopped but cannot be started if a specific event is raised.</span></span> <span data-ttu-id="368c4-116">Par exemple, un appel à [**SWbemServices.ExecNotificationQueryAsync**](swbemservices-execnotificationqueryasync.md) crée un consommateur temporaire.</span><span class="sxs-lookup"><span data-stu-id="368c4-116">For example, a call to [**SWbemServices.ExecNotificationQueryAsync**](swbemservices-execnotificationqueryasync.md) creates a temporary consumer.</span></span>

<span data-ttu-id="368c4-117">Les appels [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) ou [**IWbemServices :: ExecNotificationQuery**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-execnotificationquery) créent des consommateurs d’événements temporaires.</span><span class="sxs-lookup"><span data-stu-id="368c4-117">The calls [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) or [**IWbemServices::ExecNotificationQuery**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-execnotificationquery) create temporary event consumers.</span></span> <span data-ttu-id="368c4-118">Les consommateurs temporaires ne peuvent pas contrôler qui fournit des événements au [*récepteur*](gloss-s.md) d’événements qu’ils créent.</span><span class="sxs-lookup"><span data-stu-id="368c4-118">Temporary consumers cannot control who provides events to the event [*sink*](gloss-s.md) they create.</span></span>

<span data-ttu-id="368c4-119">Les appels aux méthodes [**ExecNotificationQuery**](swbemservices-execnotificationquery.md) peuvent être effectués de façon synchrone, [*semisynchronously*](gloss-s.md)ou asynchrone.</span><span class="sxs-lookup"><span data-stu-id="368c4-119">Calls to [**ExecNotificationQuery**](swbemservices-execnotificationquery.md) methods can be made synchronously, [*semisynchronously*](gloss-s.md), or asynchronously.</span></span> <span data-ttu-id="368c4-120">Par exemple, [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) est une méthode synchrone qui peut être appelée semisynchronously, en fonction de la façon dont le paramètre *IFlags* est défini.</span><span class="sxs-lookup"><span data-stu-id="368c4-120">For example, [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) is a synchronous method that can be called semisynchronously, depending on how the *iflags* parameter is set.</span></span> <span data-ttu-id="368c4-121">[**SWbemServices.ExecNotificationQueryAsync**](swbemservices-execnotificationqueryasync.md) est un appel asynchrone.</span><span class="sxs-lookup"><span data-stu-id="368c4-121">[**SWbemServices.ExecNotificationQueryAsync**](swbemservices-execnotificationqueryasync.md) is an asynchronous call.</span></span>

<span data-ttu-id="368c4-122">N’oubliez pas que le rappel au récepteur pour les versions asynchrones de ces appels peut ne pas être retourné au même niveau d’authentification que l’appel effectué par le script.</span><span class="sxs-lookup"><span data-stu-id="368c4-122">Be aware that the callback to the sink for the asynchronous versions of these calls might not be returned at the same authentication level as the call the script made.</span></span> <span data-ttu-id="368c4-123">Par conséquent, il est recommandé d’utiliser des appels semi-synchrones au lieu d’appels asynchrones.</span><span class="sxs-lookup"><span data-stu-id="368c4-123">Therefore, it is recommended that you use semisynchronous instead of asynchronous calls.</span></span> <span data-ttu-id="368c4-124">Si vous avez besoin d’une communication asynchrone, consultez [appel d’une méthode](calling-a-method.md) et [définition de la sécurité sur un appel asynchrone](setting-security-on-an-asynchronous-call.md).</span><span class="sxs-lookup"><span data-stu-id="368c4-124">If you require asynchronous communication, see [Calling a Method](calling-a-method.md) and [Setting Security on an Asynchronous Call](setting-security-on-an-asynchronous-call.md).</span></span>

<span data-ttu-id="368c4-125">Les abonnés de script ne peuvent pas vérifier les droits d’accès d’un fournisseur d’événements pour fournir des événements au récepteur créé par le script.</span><span class="sxs-lookup"><span data-stu-id="368c4-125">Scripting subscribers cannot check the access rights of an event provider to provide events to the sink created by the script.</span></span> <span data-ttu-id="368c4-126">Par conséquent, il est recommandé que les appels à [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) utilisent la forme semi-synchrone de l’appel et utilisent des paramètres de sécurité spécifiques.</span><span class="sxs-lookup"><span data-stu-id="368c4-126">Therefore, it is recommended that calls to [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) use the semisynchronous form of the call and use specific security settings.</span></span> <span data-ttu-id="368c4-127">Pour plus d’informations, consultez [création d’un appel semi-synchrone avec VBScript](making-a-semisynchronous-call-with-vbscript.md).</span><span class="sxs-lookup"><span data-stu-id="368c4-127">For more information, see [Making a Semisynchronous Call with VBScript](making-a-semisynchronous-call-with-vbscript.md).</span></span>

## <a name="securing-permanent-consumers"></a><span data-ttu-id="368c4-128">Sécurisation des consommateurs permanents</span><span class="sxs-lookup"><span data-stu-id="368c4-128">Securing Permanent Consumers</span></span>

<span data-ttu-id="368c4-129">Un [*consommateur permanent*](gloss-p.md) dispose d’un abonnement permanent aux événements d’un fournisseur d’événements qui est conservé après le redémarrage du système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="368c4-129">A [*permanent consumers*](gloss-p.md) has a permanent subscription to events from an event provider that will persist after the operating system is restarted.</span></span> <span data-ttu-id="368c4-130">Un fournisseur d’événements qui prend en charge les consommateurs permanents est un [*fournisseur de consommateur d’événements*](gloss-e.md).</span><span class="sxs-lookup"><span data-stu-id="368c4-130">An event provider that supports permanent consumers is a [*event consumer provider*](gloss-e.md).</span></span> <span data-ttu-id="368c4-131">Si le fournisseur d’événements n’est pas en cours d’exécution lorsqu’un événement se produit, WMI démarre le fournisseur lorsqu’il doit remettre des événements.</span><span class="sxs-lookup"><span data-stu-id="368c4-131">If the event provider is not running when an event occurs, then WMI starts the provider when it needs to deliver events.</span></span> <span data-ttu-id="368c4-132">WMI identifie le fournisseur de consommateurs auquel les événements doivent être remis, en fonction de l’instance [**\_ \_ EventConsumerProviderRegistration**](--eventconsumerproviderregistration.md) , qui associe l’instance [**\_ \_ Win32Provider**](--win32provider.md) du fournisseur de consommateurs à une [*classe de consommateur logique*](gloss-l.md) définie par le fournisseur de consommateur.</span><span class="sxs-lookup"><span data-stu-id="368c4-132">WMI identifies which consumer provider the events should be delivered to, based on the [**\_\_EventConsumerProviderRegistration**](--eventconsumerproviderregistration.md) instance, which associates the consumer provider [**\_\_Win32Provider**](--win32provider.md) instance with a [*logical consumer class*](gloss-l.md) defined by the consumer provider.</span></span> <span data-ttu-id="368c4-133">Pour plus d’informations sur le rôle des fournisseurs de consommateurs, consultez [écriture d’un fournisseur de consommateur d’événements](writing-an-event-consumer-provider.md).</span><span class="sxs-lookup"><span data-stu-id="368c4-133">For more information about the role of consumer providers, see [Writing an Event Consumer Provider](writing-an-event-consumer-provider.md).</span></span>

<span data-ttu-id="368c4-134">Les consommateurs permanents peuvent contrôler qui leur envoie des événements et les fournisseurs d’événements peuvent contrôler les utilisateurs qui accèdent à leurs événements.</span><span class="sxs-lookup"><span data-stu-id="368c4-134">Permanent consumers can control who sends them events and event providers can control who accesses their events.</span></span>

<span data-ttu-id="368c4-135">Les applications et les scripts clients créent des instances de la classe de consommateur logique dans le cadre d’un abonnement.</span><span class="sxs-lookup"><span data-stu-id="368c4-135">Client scripts and applications create instances of the logical consumer class as part of a subscription.</span></span> <span data-ttu-id="368c4-136">La classe de consommateur logique définit les informations contenues dans l’événement, ce que le client peut faire avec l’événement et comment l’événement est remis.</span><span class="sxs-lookup"><span data-stu-id="368c4-136">The logical consumer class defines what information the event contains, what the client can do with the event, and how the event is delivered.</span></span>

<span data-ttu-id="368c4-137">Les [classes de consommateur standard](standard-consumer-classes.md) WMI fournissent des exemples du rôle des classes de consommateur logiques.</span><span class="sxs-lookup"><span data-stu-id="368c4-137">The WMI [Standard Consumer Classes](standard-consumer-classes.md) provide examples of the role of logical consumer classes.</span></span> <span data-ttu-id="368c4-138">Pour plus d’informations, consultez [surveillance et réponse aux événements avec des consommateurs standard](monitoring-and-responding-to-events-with-standard-consumers.md).</span><span class="sxs-lookup"><span data-stu-id="368c4-138">For more information, see [Monitoring and Responding to Events with Standard Consumers](monitoring-and-responding-to-events-with-standard-consumers.md).</span></span>

## <a name="securing-the-permanent-subscription"></a><span data-ttu-id="368c4-139">Sécurisation de l’abonnement permanent</span><span class="sxs-lookup"><span data-stu-id="368c4-139">Securing the Permanent Subscription</span></span>

<span data-ttu-id="368c4-140">Les abonnements permanents sont plus susceptibles de provoquer des problèmes de sécurité dans WMI et présentent donc les exigences de sécurité suivantes :</span><span class="sxs-lookup"><span data-stu-id="368c4-140">Permanent subscriptions have greater potential to cause security problems in WMI and therefore have the following security requirements:</span></span>

-   <span data-ttu-id="368c4-141">L’instance de consommateur logique, le [**\_ \_ EventFilter**](--eventfilter.md)et les instances [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md) doivent avoir le même identificateur de sécurité (SID) individuel dans la propriété **CreatorSID** .</span><span class="sxs-lookup"><span data-stu-id="368c4-141">The logical consumer instance, the [**\_\_EventFilter**](--eventfilter.md), and the [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md) instances must have the same individual security identifier (SID) in the **CreatorSID** property.</span></span> <span data-ttu-id="368c4-142">Pour plus d’informations, consultez [conserver le même sid dans toutes les instances d’un abonnement permanent](#sids-and-permanent-subscriptions).</span><span class="sxs-lookup"><span data-stu-id="368c4-142">For more information, see [Keeping the same SID in all instances of a permanent subscription](#sids-and-permanent-subscriptions).</span></span>
-   <span data-ttu-id="368c4-143">Le compte qui crée l’abonnement doit être un compte de domaine disposant de privilèges d’administrateur local ou du compte de groupe Administrateurs local.</span><span class="sxs-lookup"><span data-stu-id="368c4-143">The account that creates the subscription must be either a domain account with local administrator privileges or the local Administrators group account.</span></span> <span data-ttu-id="368c4-144">L’utilisation du SID du groupe administrateurs permet à l’abonnement de continuer à fonctionner sur l’ordinateur local, même s’il est déconnecté du réseau.</span><span class="sxs-lookup"><span data-stu-id="368c4-144">Using the Administrators group SID allows the subscription to continue to work on the local computer, even if it is disconnected from the network.</span></span> <span data-ttu-id="368c4-145">L’utilisation d’un compte de domaine permet l’identification exacte de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="368c4-145">Using a domain account allows exact identification of the user.</span></span>

    <span data-ttu-id="368c4-146">Toutefois, si l’ordinateur n’est pas connecté et que le compte de création est un compte de domaine, le consommateur échoue, car WMI ne peut pas vérifier l’identité du compte.</span><span class="sxs-lookup"><span data-stu-id="368c4-146">However, if the computer is not connected and the creating account is a domain account, the consumer fails because WMI cannot verify the identity of the account.</span></span> <span data-ttu-id="368c4-147">Pour éviter l’échec de l’abonnement si l’ordinateur est déconnecté du réseau, utilisez le SID du groupe administrateurs pour un abonnement.</span><span class="sxs-lookup"><span data-stu-id="368c4-147">To avoid subscription failure if the computer is disconnected from the network, use the Administrators group SID for a subscription.</span></span> <span data-ttu-id="368c4-148">Dans ce cas, vous devez vous assurer que le compte LocalSystem peut accéder aux données d’appartenance au groupe sur le domaine.</span><span class="sxs-lookup"><span data-stu-id="368c4-148">In this case, you should ensure that the LocalSystem account can access group membership data on the domain.</span></span> <span data-ttu-id="368c4-149">Certains fournisseurs de consommateurs d’événements ont des exigences particulièrement élevées en matière de sécurité, car un abonnement non autorisé peut causer des dommages importants.</span><span class="sxs-lookup"><span data-stu-id="368c4-149">Some event consumer providers have particularly high security requirements, since a rogue subscription can cause great damage.</span></span> <span data-ttu-id="368c4-150">Exemples : consommateurs standard, [**ActiveScriptEventConsumer**](activescripteventconsumer.md) et [**CommandLineEventConsumer**](commandlineeventconsumer.md).</span><span class="sxs-lookup"><span data-stu-id="368c4-150">Examples are the standard consumers, [**ActiveScriptEventConsumer**](activescripteventconsumer.md) and [**CommandLineEventConsumer**](commandlineeventconsumer.md).</span></span>

-   <span data-ttu-id="368c4-151">Vous pouvez configurer l’abonnement permanent pour accepter uniquement les événements provenant d’identités de fournisseur d’événements spécifiques.</span><span class="sxs-lookup"><span data-stu-id="368c4-151">You can configure the permanent subscription to only accept events from specific event provider identities.</span></span> <span data-ttu-id="368c4-152">Définissez le descripteur de sécurité dans la propriété **EventAccess** de l’instance [**\_ \_ EventFilter**](--eventfilter.md) sur les identités du fournisseur d’événements.</span><span class="sxs-lookup"><span data-stu-id="368c4-152">Set the security descriptor in the **EventAccess** property of the [**\_\_EventFilter**](--eventfilter.md) instance to the event provider identities.</span></span> <span data-ttu-id="368c4-153">WMI compare l’identité du fournisseur d’événements au descripteur de sécurité pour déterminer si le fournisseur dispose de l’accès de **\_ \_ publication WBEM approprié** .</span><span class="sxs-lookup"><span data-stu-id="368c4-153">WMI compares the identity of the event provider to the security descriptor to determine if the provider has **WBEM\_RIGHT\_PUBLISH** access.</span></span> <span data-ttu-id="368c4-154">Pour plus d’informations, consultez [constantes de sécurité WMI](wmi-security-constants.md).</span><span class="sxs-lookup"><span data-stu-id="368c4-154">For more information, see [WMI Security Constants](wmi-security-constants.md).</span></span>

    <span data-ttu-id="368c4-155">Si le filtre autorise l’accès à l’identité du fournisseur d’événements, il approuve également l’événement.</span><span class="sxs-lookup"><span data-stu-id="368c4-155">If the filter allows access to the event provider identity, then it also trusts the event.</span></span> <span data-ttu-id="368c4-156">Cela permet au consommateur qui a reçu l’événement de déclencher un événement délégué.</span><span class="sxs-lookup"><span data-stu-id="368c4-156">This allows the consumer that received the event to raise a delegated event.</span></span>

    <span data-ttu-id="368c4-157">**Remarque**  La valeur par défaut du descripteur de sécurité dans **EventAccess** est **null**, ce qui permet d’accéder à tout le monde.</span><span class="sxs-lookup"><span data-stu-id="368c4-157">**Note**  The default for the security descriptor in **EventAccess** is **NULL**, which allows access to everyone.</span></span> <span data-ttu-id="368c4-158">La limitation de l’accès à l’instance d’abonnement de [**\_ \_ EventFilter**](--eventfilter.md) est recommandée pour une meilleure sécurité des événements.</span><span class="sxs-lookup"><span data-stu-id="368c4-158">Limiting access in the subscription instance of [**\_\_EventFilter**](--eventfilter.md) is recommended for better event security.</span></span>

## <a name="setting-an-administrator-only-sd"></a><span data-ttu-id="368c4-159">Définition d’une Administrator-Only SD</span><span class="sxs-lookup"><span data-stu-id="368c4-159">Setting an Administrator-Only SD</span></span>

<span data-ttu-id="368c4-160">L’exemple de code C++ suivant crée un descripteur de sécurité administrateur uniquement sur l’instance [**\_ \_ EventFilter**](--eventfilter.md) .</span><span class="sxs-lookup"><span data-stu-id="368c4-160">The following C++ code example creates an administrator-only security descriptor on the [**\_\_EventFilter**](--eventfilter.md) instance.</span></span> <span data-ttu-id="368c4-161">Cet exemple crée le descripteur de sécurité à l’aide du langage SDDL ( [Security Descriptor Definition Language](/windows/desktop/SecAuthZ/security-descriptor-definition-language) ).</span><span class="sxs-lookup"><span data-stu-id="368c4-161">This example creates the security descriptor using [Security Descriptor Definition Language](/windows/desktop/SecAuthZ/security-descriptor-definition-language) (SDDL).</span></span> <span data-ttu-id="368c4-162">Pour plus d’informations sur l' **\_ \_ abonnement WBEM correct**, consultez [constantes de sécurité WMI](wmi-security-constants.md).</span><span class="sxs-lookup"><span data-stu-id="368c4-162">For more information about **WBEM\_RIGHT\_SUBSCRIBE**, see [WMI Security Constants](wmi-security-constants.md).</span></span>


```C++
// Create SD that allows only administrators 
//    to send events to this filter. 
// The SDDL settings are O:BAG:BAD:(A;;0x80;;;BA)
// Set the EventAccess property in the 
//    IWbemClassObject of the __EventFilter instance. 
   long lMask = WBEM_RIGHT_PUBLISH;
     WCHAR wBuf[MAX_PATH];
     _ltow( lMask, wBuf, 16 );
 
HRESULT hRes = pEventFilterInstance->Put( L"EventAccess", 0,
    &_variant_t( L"O:BAG:BAD:(A;;0x80;;;BA)" ), NULL );
```



<span data-ttu-id="368c4-163">L’exemple de code précédent requiert la référence et les \# instructions include suivantes.</span><span class="sxs-lookup"><span data-stu-id="368c4-163">The previous code example requires the following reference and \#include statements.</span></span>


```C++
#define _WIN32_DCOM
#include <wbemidl.h>
#include <comdef.h>

#pragma comment(lib, "wbemuuid.lib")
```



## <a name="impersonating-the-event-provider-identity"></a><span data-ttu-id="368c4-164">Emprunt de l’identité du fournisseur d’événements</span><span class="sxs-lookup"><span data-stu-id="368c4-164">Impersonating the Event Provider Identity</span></span>

<span data-ttu-id="368c4-165">Un consommateur permanent peut avoir besoin d’emprunter l’identité du fournisseur d’événements pour traiter l’événement.</span><span class="sxs-lookup"><span data-stu-id="368c4-165">A permanent consumer may need to impersonate the event provider to process the event.</span></span> <span data-ttu-id="368c4-166">Les consommateurs permanents peuvent emprunter l’identité du fournisseur d’événements uniquement lorsque les conditions suivantes sont réunies :</span><span class="sxs-lookup"><span data-stu-id="368c4-166">Permanent consumers can only impersonate the event provider when the following conditions exist:</span></span>

-   <span data-ttu-id="368c4-167">La propriété **MaintainSecurityContext** de l’instance de [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md) a la valeur **true**.</span><span class="sxs-lookup"><span data-stu-id="368c4-167">The instance of [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md) has the **MaintainSecurityContext** property set to **True**.</span></span>
-   <span data-ttu-id="368c4-168">Un événement est remis dans le même contexte de sécurité que celui dans lequel se trouvait le fournisseur lorsqu’il a généré l’événement.</span><span class="sxs-lookup"><span data-stu-id="368c4-168">An event is delivered in the same security context that the provider was in when it generated the event.</span></span> <span data-ttu-id="368c4-169">Seul un consommateur implémenté en tant que DLL, un consommateur in-process, peut recevoir des événements dans le contexte de sécurité du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="368c4-169">Only a consumer implemented as a DLL, an in-process consumer, can receive events in the security context of the provider.</span></span> <span data-ttu-id="368c4-170">Pour plus d’informations sur la sécurité des fournisseurs et des consommateurs in-process, consultez [hébergement et sécurité des fournisseurs](provider-hosting-and-security.md).</span><span class="sxs-lookup"><span data-stu-id="368c4-170">For more information about security of in-process providers and consumers, see [Provider Hosting and Security](provider-hosting-and-security.md).</span></span>
-   <span data-ttu-id="368c4-171">Le fournisseur d’événements s’exécute dans un processus qui autorise l’emprunt d’identité.</span><span class="sxs-lookup"><span data-stu-id="368c4-171">The event provider is running in a process that allows impersonation.</span></span>

<span data-ttu-id="368c4-172">Le compte qui exécute le processus de consommateur doit avoir un accès en **\_ écriture complet** à l’espace de stockage WMI (également connu sous le nom de référentiel CIM).</span><span class="sxs-lookup"><span data-stu-id="368c4-172">The account running the consumer process must have **FULL\_WRITE** access to the WMI repository (also known as the CIM repository).</span></span> <span data-ttu-id="368c4-173">Dans l’abonnement, les instances [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md), [**\_ \_ EventConsumer**](--eventconsumer.md)et [**\_ \_ EventFilter**](--eventfilter.md) doivent avoir la même valeur d’identificateur de sécurité (SID) dans la propriété **CreatorSID** .</span><span class="sxs-lookup"><span data-stu-id="368c4-173">In the subscription, the [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md), [**\_\_EventConsumer**](--eventconsumer.md), and [**\_\_EventFilter**](--eventfilter.md) instances must have the same individual security identifier (SID) value in the **CreatorSID** property.</span></span> <span data-ttu-id="368c4-174">WMI stocke le SID dans **CreatorSID** pour chaque instance.</span><span class="sxs-lookup"><span data-stu-id="368c4-174">WMI stores the SID in the **CreatorSID** for each instance.</span></span>

## <a name="sids-and-permanent-subscriptions"></a><span data-ttu-id="368c4-175">Sid et abonnements permanents</span><span class="sxs-lookup"><span data-stu-id="368c4-175">SIDs and Permanent Subscriptions</span></span>

<span data-ttu-id="368c4-176">Un abonnement permanent ne fonctionne pas lorsque la liaison, le consommateur et le filtre ne sont pas créés par le même utilisateur, ce qui signifie que les [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md), [**\_ \_ EventConsumer**](--eventconsumer.md)et [**\_ \_ EventFilter**](--eventfilter.md) doivent avoir la même valeur d’identificateur de sécurité (SID) individuelle dans la propriété **CreatorSID** .</span><span class="sxs-lookup"><span data-stu-id="368c4-176">A permanent subscription does not work when the binding, the consumer, and the filter are not created by the same user, which means that the [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md), [**\_\_EventConsumer**](--eventconsumer.md), and [**\_\_EventFilter**](--eventfilter.md) must have the same individual security identifier (SID) value in the **CreatorSID** property.</span></span> <span data-ttu-id="368c4-177">Windows Management Instrumentation (WMI) stocke cette valeur.</span><span class="sxs-lookup"><span data-stu-id="368c4-177">Windows Management Instrumentation (WMI) stores this value.</span></span>

## <a name="creating-permanent-subscriptions-using-domain-accounts"></a><span data-ttu-id="368c4-178">Création d’abonnements permanents à l’aide de comptes de domaine</span><span class="sxs-lookup"><span data-stu-id="368c4-178">Creating Permanent Subscriptions Using Domain Accounts</span></span>

<span data-ttu-id="368c4-179">Plusieurs problèmes doivent être pris en compte lors de l’utilisation de comptes de domaine pour créer des abonnements permanents.</span><span class="sxs-lookup"><span data-stu-id="368c4-179">Several issues must be considered when using domain accounts to create permanent subscriptions.</span></span> <span data-ttu-id="368c4-180">Chaque abonnement permanent doit toujours fonctionner quand aucun utilisateur n’est connecté, ce qui signifie qu’il fonctionne sous le compte LocalSystem intégré.</span><span class="sxs-lookup"><span data-stu-id="368c4-180">Every permanent subscription should still work when no user is logged on, which means they function under the built-in LocalSystem account.</span></span>

<span data-ttu-id="368c4-181">Si un utilisateur de domaine est le créateur d’un abonnement permanent pour les consommateurs sensibles à la sécurité ([**ActiveScriptEventConsumer**](activescripteventconsumer.md), [**CommandLineEventConsumer**](commandlineeventconsumer.md)), WMI vérifie si la propriété **CreatorSID** de la classe [**\_ \_ EventFilter**](--eventfilter.md) , la classe [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md) et les instances de consommateur appartiennent à un utilisateur membre du groupe Administrateurs local.</span><span class="sxs-lookup"><span data-stu-id="368c4-181">If a domain user is the creator of a permanent subscription for security sensitive consumers ([**ActiveScriptEventConsumer**](activescripteventconsumer.md), [**CommandLineEventConsumer**](commandlineeventconsumer.md)), then WMI verifies whether the **CreatorSID** property of the [**\_\_EventFilter**](--eventfilter.md) class, [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md) class, and the consumer instances belong to a user who is member of local Administrators group.</span></span>

<span data-ttu-id="368c4-182">L’exemple de code suivant montre comment vous pouvez spécifier la propriété **CreatorSID** .</span><span class="sxs-lookup"><span data-stu-id="368c4-182">The following code example shows how you can specify the **CreatorSID** property.</span></span>

``` syntax
 instance of __EventFilter as $FILTER
    {
        // this is the Administrators SID in array of bytes format
        CreatorSID = {1,2,0,0,0,0,0,5,32,0,0,0,32,2,0,0};    
        // Add filter code here ...
    }

    instance of ActiveScriptEventConsumer as $CONSUMER
    {
       CreatorSID = {1,2,0,0,0,0,0,5,32,0,0,0,32,2,0,0};
       // Add consumer code here ...
    }

    instance of __FilterToConsumerBinding
    {
       CreatorSID = {1,2,0,0,0,0,0,5,32,0,0,0,32,2,0,0};
       Consumer = $CONSUMER;
       Filter = $FILTER;
       // Add binding code here ...
    }
```

<span data-ttu-id="368c4-183">Pour les situations inter-domaines, ajoutez des utilisateurs authentifiés au « groupe d’accès d’autorisation Windows ».</span><span class="sxs-lookup"><span data-stu-id="368c4-183">For cross domain situations, add Authenticated Users to the "Windows Authorization Access Group".</span></span>

## <a name="related-topics"></a><span data-ttu-id="368c4-184">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="368c4-184">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="368c4-185">Sécurisation des événements WMI</span><span class="sxs-lookup"><span data-stu-id="368c4-185">Securing WMI Events</span></span>](securing-wmi-events.md)
</dt> <dt>

[<span data-ttu-id="368c4-186">Réception d’un événement WMI</span><span class="sxs-lookup"><span data-stu-id="368c4-186">Receiving a WMI Event</span></span>](receiving-a-wmi-event.md)
</dt> </dl>

 

 
