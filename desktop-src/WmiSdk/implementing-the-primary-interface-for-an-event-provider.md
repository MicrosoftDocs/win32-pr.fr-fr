---
description: Un fournisseur d’événements doit implémenter l’interface IWbemEventProvider pour générer des notifications d’événements.
ms.assetid: ae33c9f5-61f7-4488-a281-01d7f9c62c46
ms.tgt_platform: multiple
title: Implémentation de l’interface principale pour un fournisseur d’événements
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5621a2c6d0901a7925828149dd5c1480c2b11456
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103952467"
---
# <a name="implementing-the-primary-interface-for-an-event-provider"></a><span data-ttu-id="7e04b-103">Implémentation de l’interface principale pour un fournisseur d’événements</span><span class="sxs-lookup"><span data-stu-id="7e04b-103">Implementing the Primary Interface for an Event Provider</span></span>

<span data-ttu-id="7e04b-104">Un fournisseur d’événements doit implémenter l’interface [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) pour générer des notifications d’événements.</span><span class="sxs-lookup"><span data-stu-id="7e04b-104">An event provider must implement the [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) interface to generate event notifications.</span></span> <span data-ttu-id="7e04b-105">WMI appelle la méthode [**IWbemEventProvider ::P rovideevents**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventprovider-provideevents) du fournisseur et transmet un pointeur vers l’objet récepteur, qui est une implémentation de l’interface [**IWbemObjectSink**](iwbemobjectsink.md) .</span><span class="sxs-lookup"><span data-stu-id="7e04b-105">WMI calls the [**IWbemEventProvider::ProvideEvents**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventprovider-provideevents) method of the provider and passes in a pointer to the sink object, which is an implementation of the [**IWbemObjectSink**](iwbemobjectsink.md) interface.</span></span> <span data-ttu-id="7e04b-106">Lorsque le fournisseur d’événements est prêt à générer une notification, le fournisseur appelle la méthode [**IWbemObjectSink :: indique**](/windows/desktop/api/Wbemcli/nf-wbemcli-iwbemobjectsink-indicate) .</span><span class="sxs-lookup"><span data-stu-id="7e04b-106">When the event provider is ready to generate a notification, the provider calls the [**IWbemObjectSink::Indicate**](/windows/desktop/api/Wbemcli/nf-wbemcli-iwbemobjectsink-indicate) method.</span></span>

<span data-ttu-id="7e04b-107">Un fournisseur d’événements doit placer les notifications générées par le biais de [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) dans les objets d’événement.</span><span class="sxs-lookup"><span data-stu-id="7e04b-107">An event provider should place the notifications generated through [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) in event objects.</span></span> <span data-ttu-id="7e04b-108">Vous devez implémenter des objets d’événement en tant qu’entrées dans un tableau d’interfaces [**IWbemClassObject**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemclassobject) représenté par le paramètre *ppObjArray* de la méthode d' [**indication**](/windows/desktop/api/Wbemcli/nf-wbemcli-iwbemobjectsink-indicate) .</span><span class="sxs-lookup"><span data-stu-id="7e04b-108">You should implement event objects as entries in an array of [**IWbemClassObject**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemclassobject) interfaces represented by the *ppObjArray* parameter of the [**Indicate**](/windows/desktop/api/Wbemcli/nf-wbemcli-iwbemobjectsink-indicate) method.</span></span> <span data-ttu-id="7e04b-109">Étant donné que les **IWbemClassObjects** sont des objets com, le fournisseur doit incrémenter le décompte de références pour le récepteur en appelant la méthode [**IWbemObjectSink :: AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) .</span><span class="sxs-lookup"><span data-stu-id="7e04b-109">Because **IWbemClassObjects** are COM objects, the provider must increment the reference count for the sink by calling the [**IWbemObjectSink::AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) method.</span></span> <span data-ttu-id="7e04b-110">Les fournisseurs d’événements qui doivent fournir de nombreuses notifications (par exemple, les événements 400) doivent créer un objet d’événement unique pour chaque notification en générant une nouvelle instance ou en clonant une instance existante.</span><span class="sxs-lookup"><span data-stu-id="7e04b-110">Event providers that must supply many notifications (for example, 400 events) should create a unique event object for each notification by either spawning a new instance or cloning an existing one.</span></span> <span data-ttu-id="7e04b-111">WMI ne contient jamais un objet d’événement au-delà de la fin de l’appel d' **indication** , et n’a pas d’exigences spéciales pour le **AddRef** au-dessus et au-delà de la norme com.</span><span class="sxs-lookup"><span data-stu-id="7e04b-111">WMI never holds onto an event object past the completion of the **Indicate** call, and has no special requirements for **AddRef** above and beyond the COM standard.</span></span>

<span data-ttu-id="7e04b-112">Tenez compte des recommandations suivantes lors de l’implémentation d’un fournisseur d’événements :</span><span class="sxs-lookup"><span data-stu-id="7e04b-112">Consider the following guidelines when implementing an event provider:</span></span>

-   <span data-ttu-id="7e04b-113">N’apportez pas de modifications de classe lors de la maintenance d’un appel client.</span><span class="sxs-lookup"><span data-stu-id="7e04b-113">Do not make any class changes while servicing a client call.</span></span>
-   <span data-ttu-id="7e04b-114">N’émettez pas d’appels liés aux événements, tels qu’un appel qui modifie un filtre d’événement.</span><span class="sxs-lookup"><span data-stu-id="7e04b-114">Do not issue any event-related calls, such as a call that modifies an event filter.</span></span>
-   <span data-ttu-id="7e04b-115">Traitez toutes les demandes que le service de gestion Windows émet, telles que [**CancelQuery**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventproviderquerysink-cancelquery), avant de réexécuter un événement.</span><span class="sxs-lookup"><span data-stu-id="7e04b-115">Process any requests that the Windows Management service issues, such as [**CancelQuery**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventproviderquerysink-cancelquery), before refiring an event.</span></span>

    <span data-ttu-id="7e04b-116">Si vous ne traitez pas la requête, le déclenchement de l’événement peut empêcher l’événement d’être accepté.</span><span class="sxs-lookup"><span data-stu-id="7e04b-116">If you do not process the request, then refiring the event might block the event from ever being accepted.</span></span>

-   <span data-ttu-id="7e04b-117">N’appelez jamais [**IWbemObjectSink :: SetStatus**](/windows/desktop/api/Wbemcli/nf-wbemcli-iwbemobjectsink-setstatus) à partir d’un fournisseur.</span><span class="sxs-lookup"><span data-stu-id="7e04b-117">Never call [**IWbemObjectSink::SetStatus**](/windows/desktop/api/Wbemcli/nf-wbemcli-iwbemobjectsink-setstatus) from within a provider.</span></span>

 

 
