---
description: Un fournisseur d’événements est un objet COM qui fournit à WMI des notifications d’événements intrinsèques et extrinsèques.
ms.assetid: 075bdc65-4ea3-4f91-9823-1d2d0dc13423
ms.tgt_platform: multiple
title: Écriture d’un fournisseur d’événements
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bb118d89f214e9fc651c1c9d93abfcfe43f49fc7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106538875"
---
# <a name="writing-an-event-provider"></a><span data-ttu-id="fce38-103">Écriture d’un fournisseur d’événements</span><span class="sxs-lookup"><span data-stu-id="fce38-103">Writing an Event Provider</span></span>

<span data-ttu-id="fce38-104">Un fournisseur d’événements est un objet COM qui fournit à WMI des notifications d’événements intrinsèques et extrinsèques.</span><span class="sxs-lookup"><span data-stu-id="fce38-104">An event provider is a COM object that supplies WMI with notifications of intrinsic and extrinsic events.</span></span> <span data-ttu-id="fce38-105">Un événement intrinsèque signale une modification de données interne à WMI, tandis qu’un événement extrinsèque signale un événement défini par l’utilisateur qui n’est pas décrit par un événement intrinsèque.</span><span class="sxs-lookup"><span data-stu-id="fce38-105">An intrinsic event reports an internal data change to WMI, while an extrinsic event reports a user-defined event not described by an intrinsic event.</span></span> <span data-ttu-id="fce38-106">Par exemple, un événement en réponse à des modifications, à la création ou à la suppression de la classe [**\_ disque logique Win32**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) est classifié comme un événement intrinsèque.</span><span class="sxs-lookup"><span data-stu-id="fce38-106">For example, an event in response to changes, creation, or deletion of the [**Win32\_LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) class would classify as an intrinsic event.</span></span> <span data-ttu-id="fce38-107">Un événement qui est généré sur la base d’autres éléments que la modification, la création ou la suppression d’un objet WMI existant est un événement extrinsèque.</span><span class="sxs-lookup"><span data-stu-id="fce38-107">An event that is generated on the basis of something other than the modification, creation, or deletion of an existing WMI object is an extrinsic event.</span></span> <span data-ttu-id="fce38-108">Quelle que soit la classe prise en charge, vous pouvez implémenter tous les fournisseurs d’événements de la même manière.</span><span class="sxs-lookup"><span data-stu-id="fce38-108">Regardless of the supported class, you can implement all event providers in the same manner.</span></span>

<span data-ttu-id="fce38-109">La procédure suivante décrit comment implémenter un fournisseur d’événements.</span><span class="sxs-lookup"><span data-stu-id="fce38-109">The following procedure describes how to implement an event provider.</span></span>

<span data-ttu-id="fce38-110">**Pour implémenter un fournisseur d’événements**</span><span class="sxs-lookup"><span data-stu-id="fce38-110">**To implement an event provider**</span></span>

1.  <span data-ttu-id="fce38-111">Concevez et inscrivez votre fournisseur de classes avec WMI.</span><span class="sxs-lookup"><span data-stu-id="fce38-111">Design and register your class provider with WMI.</span></span>

    <span data-ttu-id="fce38-112">Les fournisseurs de classes s’inscrivent auprès de WMI en créant une instance [**\_ \_ Win32Provider**](--win32provider.md) et une classe [**\_ \_ EventProviderRegistration**](--eventproviderregistration.md) .</span><span class="sxs-lookup"><span data-stu-id="fce38-112">Class providers register with WMI by creating a [**\_\_Win32Provider**](--win32provider.md) instance and an [**\_\_EventProviderRegistration**](--eventproviderregistration.md) class.</span></span> <span data-ttu-id="fce38-113">Pour plus d’informations, consultez [inscription d’un fournisseur d’événements](registering-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="fce38-113">For more information, see [Registering an Event Provider](registering-an-event-provider.md).</span></span>

2.  <span data-ttu-id="fce38-114">Implémentez l’interface [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) pour votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="fce38-114">Implement the [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) interface for your provider.</span></span>

    <span data-ttu-id="fce38-115">L’interface [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) est une interface couramment utilisée par WMI pour charger et initialiser tous les fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="fce38-115">The [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) interface is a common interface WMI uses to load and initialize all providers.</span></span> <span data-ttu-id="fce38-116">Pour plus d’informations, consultez [initialisation d’un fournisseur](initializing-a-provider.md).</span><span class="sxs-lookup"><span data-stu-id="fce38-116">For more information, see [Initializing a Provider](initializing-a-provider.md).</span></span>

3.  <span data-ttu-id="fce38-117">Implémentez [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) comme interface principale pour votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="fce38-117">Implement the [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) as the primary interface for your provider.</span></span>

    <span data-ttu-id="fce38-118">L’interface [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) utilise la méthode **ProviderEvents** pour fournir des événements à WMI.</span><span class="sxs-lookup"><span data-stu-id="fce38-118">The [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) interface uses the **ProviderEvents** method to supply events to WMI.</span></span> <span data-ttu-id="fce38-119">Pour plus d’informations, consultez [implémentation de l’interface principale pour un fournisseur d’événements](implementing-the-primary-interface-for-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="fce38-119">For more information, see [Implementing the Primary Interface for an Event Provider](implementing-the-primary-interface-for-an-event-provider.md).</span></span>

    > [!Note]  
    > <span data-ttu-id="fce38-120">Les fournisseurs d’événements doivent utiliser le modèle de multithread « both ».</span><span class="sxs-lookup"><span data-stu-id="fce38-120">Event providers must use the multithreading model "Both".</span></span>

     

4.  <span data-ttu-id="fce38-121">Si vous le souhaitez, vous pouvez également implémenter l’interface [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) pour augmenter les performances de votre fournisseur d’événements.</span><span class="sxs-lookup"><span data-stu-id="fce38-121">Optionally, you may also implement the [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) interface to increase the performance of your event provider.</span></span>

    <span data-ttu-id="fce38-122">L’interface [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) permet au fournisseur d’optimiser les requêtes avant d’envoyer une réponse à WMI et est particulièrement utile pour un fournisseur qui fournit des événements de plusieurs types et qui doit effectuer autant d’optimisations internes que possible.</span><span class="sxs-lookup"><span data-stu-id="fce38-122">The [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) interface allows the provider to optimize queries before sending a response to WMI, and is most useful for a provider that supplies events of multiple types and that needs to perform as many internal optimizations as possible.</span></span> <span data-ttu-id="fce38-123">Pour plus d’informations, consultez [optimisation d’un fournisseur d’événements](optimizing-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="fce38-123">For more information, see [Optimizing an Event Provider](optimizing-an-event-provider.md).</span></span>

5.  <span data-ttu-id="fce38-124">Implémentez l’interface [**IWbemEventProviderSecurity**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) pour limiter les consommateurs à certains identificateurs de sécurité (SID) ou implémentez [**IWbemEventSink :: SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) pour sécuriser le récepteur lui-même.</span><span class="sxs-lookup"><span data-stu-id="fce38-124">Implement the [**IWbemEventProviderSecurity**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) interface to limit consumers to certain security identifiers (SIDs) or implement [**IWbemEventSink::SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) to secure the sink itself.</span></span> <span data-ttu-id="fce38-125">Le fournisseur peut également définir la **propriété \_ descripteur de sécurité** dans la classe d’événements pour sécuriser les événements individuels dans le code MOF.</span><span class="sxs-lookup"><span data-stu-id="fce38-125">The provider can also set the **SECURITY\_DESCRIPTOR** property in the event class to secure individual events in the MOF code.</span></span> <span data-ttu-id="fce38-126">Pour plus d’informations, consultez [sécurisation des événements WMI](securing-wmi-events.md).</span><span class="sxs-lookup"><span data-stu-id="fce38-126">For more information, see [Securing WMI Events](securing-wmi-events.md).</span></span>
6.  <span data-ttu-id="fce38-127">Ajoutez tout code supplémentaire nécessaire pour votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="fce38-127">Add any additional code necessary for your provider.</span></span>

    <span data-ttu-id="fce38-128">Lorsque vous concevez votre fournisseur, vous devez probablement appeler des interfaces WMI.</span><span class="sxs-lookup"><span data-stu-id="fce38-128">When designing your provider, you most likely need to call WMI interfaces.</span></span> <span data-ttu-id="fce38-129">Pour plus d’informations, consultez [appel d’une méthode](calling-a-method.md).</span><span class="sxs-lookup"><span data-stu-id="fce38-129">For more information, see [Calling a Method](calling-a-method.md).</span></span>

    <span data-ttu-id="fce38-130">Lorsque vous récupérez des informations pour un client, vous devrez peut-être accéder aux niveaux de sécurité de ce client.</span><span class="sxs-lookup"><span data-stu-id="fce38-130">When retrieving information for a client, you may need to access the security levels for that client.</span></span> <span data-ttu-id="fce38-131">Pour plus d’informations, consultez [emprunt d’identité d’un client](impersonating-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="fce38-131">For more information, see [Impersonating a Client](impersonating-a-client.md).</span></span>

7.  <span data-ttu-id="fce38-132">Remplacez le fournisseur préexistant par votre nouveau code.</span><span class="sxs-lookup"><span data-stu-id="fce38-132">Replace the preexisting provider with your new code.</span></span>

    <span data-ttu-id="fce38-133">Vous n’avez pas besoin d’effectuer cette étape si vous n’avez pas de fournisseur préexistant à copier.</span><span class="sxs-lookup"><span data-stu-id="fce38-133">You do not need to perform this step if you do not have a preexisting provider to copy over.</span></span> <span data-ttu-id="fce38-134">Pour plus d’informations, consultez [mise à jour d’un fournisseur](updating-a-provider.md).</span><span class="sxs-lookup"><span data-stu-id="fce38-134">For more information, see [Updating a Provider](updating-a-provider.md).</span></span>

<span data-ttu-id="fce38-135">Une application cliente peut demander un événement en s’inscrivant auprès de WMI en tant que consommateur d’événements.</span><span class="sxs-lookup"><span data-stu-id="fce38-135">A client application can request an event by registering itself with WMI as an event consumer.</span></span> <span data-ttu-id="fce38-136">Pour plus d’informations, consultez [réception d’un événement WMI](receiving-a-wmi-event.md).</span><span class="sxs-lookup"><span data-stu-id="fce38-136">For more information, see [Receiving a WMI Event](receiving-a-wmi-event.md).</span></span>

 

 
