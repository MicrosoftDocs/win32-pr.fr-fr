---
description: Les classes WMI C++ qui font partie de l’infrastructure du fournisseur WMI ne sont plus recommandées pour une utilisation.
ms.assetid: d2414a72-3435-4035-bcd9-b3ec87f5709c
ms.tgt_platform: multiple
title: Classes de l’utilitaire de l’infrastructure du fournisseur
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cab09c99fe2597cacd81e55a4ed18bd4e286ff16
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106521982"
---
# <a name="provider-framework-utility-classes"></a><span data-ttu-id="938a3-103">Classes de l’utilitaire de l’infrastructure du fournisseur</span><span class="sxs-lookup"><span data-stu-id="938a3-103">Provider Framework Utility Classes</span></span>

<span data-ttu-id="938a3-104">\[Les classes WMI C++ qui font partie de l’infrastructure de fournisseur WMI qui est maintenant considérée comme ayant un état final, et aucun développement, amélioration ou mise à jour supplémentaire n’est disponible pour les problèmes non liés à la sécurité qui affectent ces bibliothèques.</span><span class="sxs-lookup"><span data-stu-id="938a3-104">\[WMI C++ classes that are part of the WMI Provider Framework which is now considered in final state, and no further development, enhancements, or updates will be available for non-security related issues affecting these libraries.</span></span> <span data-ttu-id="938a3-105">Les [API mi](/previous-versions/windows/desktop/wmi_v2/windows-management-infrastructure) doivent être utilisées pour tout nouveau développement.\]</span><span class="sxs-lookup"><span data-stu-id="938a3-105">The [MI APIs](/previous-versions/windows/desktop/wmi_v2/windows-management-infrastructure) should be used for all new development.\]</span></span>

<span data-ttu-id="938a3-106">Les bibliothèques de l’infrastructure du fournisseur Framedyd.dll (version de débogage) et Framedyn.dll (version Release) implémentent plusieurs classes d’assistance de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="938a3-106">The provider framework libraries Framedyd.dll (debug version) and Framedyn.dll (release version) implement several provider helper classes.</span></span> <span data-ttu-id="938a3-107">Certaines fonctions de Framedyn.dll ont été supprimées des fichiers d’en-tête.</span><span class="sxs-lookup"><span data-stu-id="938a3-107">Some functions in Framedyn.dll have been removed from the header files.</span></span> <span data-ttu-id="938a3-108">Pour continuer à utiliser ces fonctions, ajoutez `#define FRAMEWORK_ALLOW_DEPRECATED` à votre code avant d’inclure Fwcommon. h.</span><span class="sxs-lookup"><span data-stu-id="938a3-108">To continue to use these functions, add `#define FRAMEWORK_ALLOW_DEPRECATED` to your code before including Fwcommon.h.</span></span>

<span data-ttu-id="938a3-109">Vous pouvez décharger des fournisseurs individuels qui ne sont plus nécessaires.</span><span class="sxs-lookup"><span data-stu-id="938a3-109">You can unload individual providers that are no longer required.</span></span>

<span data-ttu-id="938a3-110">Pour utiliser cette fonctionnalité, vous devez apporter les trois modifications suivantes à votre fournisseur dans MainDll. cpp :</span><span class="sxs-lookup"><span data-stu-id="938a3-110">To use this capability, you must make the three following changes to your provider in MainDll.cpp:</span></span>

-   <span data-ttu-id="938a3-111">Dans la fonction **DllMain** où vous appelez [**CWbemProviderGlue :: FrameworkLoginDLL**](/windows/desktop/api/WbemGlue/nf-wbemglue-cwbemproviderglue-frameworklogindll(lpcwstr_plong)), vous devez ajouter un deuxième paramètre qui est un pointeur vers une valeur long.</span><span class="sxs-lookup"><span data-stu-id="938a3-111">In the function **DllMain** where you call [**CWbemProviderGlue::FrameworkLoginDLL**](/windows/desktop/api/WbemGlue/nf-wbemglue-cwbemproviderglue-frameworklogindll(lpcwstr_plong)), you must add a second parameter which is a pointer to a long.</span></span>
-   <span data-ttu-id="938a3-112">Dans la fonction **DllCanUnloadNow** où vous appelez [**CWbemProviderGlue :: FrameworkLogoffDLL**](/windows/desktop/api/WbemGlue/nf-wbemglue-cwbemproviderglue-frameworklogoffdll(lpcwstr_plong)), vous devez ajouter un deuxième paramètre qui est un pointeur vers une valeur long.</span><span class="sxs-lookup"><span data-stu-id="938a3-112">In the function **DllCanUnloadNow** where you call [**CWbemProviderGlue::FrameworkLogoffDLL**](/windows/desktop/api/WbemGlue/nf-wbemglue-cwbemproviderglue-frameworklogoffdll(lpcwstr_plong)), you must add a second parameter which is a pointer to a long.</span></span>
-   <span data-ttu-id="938a3-113">Dans la fonction **DllGetClassObject** dans laquelle vous créez une instance de **CWbemGlueFactory**, vous devez ajouter un paramètre qui est un pointeur vers une valeur long.</span><span class="sxs-lookup"><span data-stu-id="938a3-113">In the function **DllGetClassObject** where you create an instance of **CWbemGlueFactory**, you must add a parameter which is a pointer to a long.</span></span>

<span data-ttu-id="938a3-114">Dans les trois cas, le pointeur vers long doit être le même pointeur.</span><span class="sxs-lookup"><span data-stu-id="938a3-114">In all three cases, the pointer to a long must be the same pointer.</span></span>

> [!Note]  
> <span data-ttu-id="938a3-115">Dans mainDLL. cpp, les routines **DllGetClassObject**, **DllCanUnloadNow**, **DllRegisterServer**, **DllUnregisterServer** et **DllMain** doivent être encapsulées dans un bloc try/catch.</span><span class="sxs-lookup"><span data-stu-id="938a3-115">In Maindll.cpp, **DllGetClassObject**, **DllCanUnloadNow**, **DllRegisterServer**, **DllUnregisterServer** and **DllMain** routines must be wrapped in a try/catch block.</span></span>

 

> [!Caution]  
> <span data-ttu-id="938a3-116">Les builds de débogage de fournisseur sont liées à Framedyd. lib pour Framedyd.dll.</span><span class="sxs-lookup"><span data-stu-id="938a3-116">Provider debug builds link with Framedyd.lib for Framedyd.dll.</span></span> <span data-ttu-id="938a3-117">Framedyd.dll se trouve dans le répertoire bin du kit de développement logiciel (SDK) Microsoft Windows \\ qui n’est pas inclus dans le chemin d’accès système.</span><span class="sxs-lookup"><span data-stu-id="938a3-117">Framedyd.dll is in the Microsoft Windows Software Development Kit (SDK) \\bin directory which is not included in the system path.</span></span> <span data-ttu-id="938a3-118">Quand une version Debug d’un fournisseur est testée avec le service de gestion Windows, le chargement du fournisseur Framework échoue car Framedyd.dll ou l’une de ses dépendances ne sera pas trouvé.</span><span class="sxs-lookup"><span data-stu-id="938a3-118">When a debug build of a provider is tested with the Windows Management service, the framework provider will fail to load because Framedyd.dll or one of its dependencies will not be located.</span></span> <span data-ttu-id="938a3-119">Par conséquent, vous devez copier Framedyd.dll à partir du \\ répertoire SDK Windows bin vers \\ le \\ répertoire system32 wbem ou ajouter le \\ répertoire SDK Windows bin au chemin de recherche du système.</span><span class="sxs-lookup"><span data-stu-id="938a3-119">Therefore, you must either copy Framedyd.dll from the Windows SDK \\bin directory to the \\system32\\wbem directory or add the Windows SDK \\bin directory to the system search path.</span></span>

 

<span data-ttu-id="938a3-120">Le tableau suivant répertorie les classes de l’utilitaire de l’infrastructure du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="938a3-120">The following table lists the provider framework utility classes.</span></span>



| <span data-ttu-id="938a3-121">Classe utilitaire</span><span class="sxs-lookup"><span data-stu-id="938a3-121">Utility class</span></span>                                          | <span data-ttu-id="938a3-122">Description</span><span class="sxs-lookup"><span data-stu-id="938a3-122">Description</span></span>                                                                                                                     |
|--------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="938a3-123">**CHString**</span><span class="sxs-lookup"><span data-stu-id="938a3-123">**CHString**</span></span>](chstring.md)                           | <span data-ttu-id="938a3-124">Fournit des fonctions de comparaison et de manipulation de chaînes pour WMI.</span><span class="sxs-lookup"><span data-stu-id="938a3-124">Provides string comparison and manipulation functions for WMI.</span></span>                                                                  |
| [<span data-ttu-id="938a3-125">**CHStringArray**</span><span class="sxs-lookup"><span data-stu-id="938a3-125">**CHStringArray**</span></span>](/windows/desktop/api/ChStrArr/nl-chstrarr-chstringarray)                 | <span data-ttu-id="938a3-126">Contient pour la création et la manipulation de tableaux de CHString.</span><span class="sxs-lookup"><span data-stu-id="938a3-126">Contains for creating and manipulating arrays of CHString.</span></span>                                                                      |
| [<span data-ttu-id="938a3-127">**TRefPointerCollection**</span><span class="sxs-lookup"><span data-stu-id="938a3-127">**TRefPointerCollection**</span></span>](/windows/desktop/api/RefPtrCo/nl-refptrco-trefpointercollection) | <span data-ttu-id="938a3-128">Accorde l’accès à une classe de conteneur pour les pointeurs.</span><span class="sxs-lookup"><span data-stu-id="938a3-128">Grants access to a container class for pointers.</span></span>                                                                                |
| [<span data-ttu-id="938a3-129">**WBEMTime**</span><span class="sxs-lookup"><span data-stu-id="938a3-129">**WBEMTime**</span></span>](wbemtime.md)                           | <span data-ttu-id="938a3-130">Facilite les conversions entre les différents formats d’heure d’exécution de Windows et ANSI C.</span><span class="sxs-lookup"><span data-stu-id="938a3-130">Facilitates conversions between various Windows and ANSI C run-time time formats.</span></span>                                               |
| [<span data-ttu-id="938a3-131">**WBEMTimeSpan**</span><span class="sxs-lookup"><span data-stu-id="938a3-131">**WBEMTimeSpan**</span></span>](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan)                   | <span data-ttu-id="938a3-132">Contient des fonctions d’assistance utilisées pour calculer et conserver la différence de temps entre deux objets [**WBEMTime**](wbemtime.md) .</span><span class="sxs-lookup"><span data-stu-id="938a3-132">Contains helper functions used to calculate and hold the time span difference between two [**WBEMTime**](wbemtime.md) objects.</span></span> |



 

> [!Note]  
> <span data-ttu-id="938a3-133">Les classes [**CHString**](chstring.md) et [**CHStringArray**](/windows/desktop/api/ChStrArr/nl-chstrarr-chstringarray) sont similaires à la Microsoft Foundation classes (MFC) **CString** et à **CStringArray**.</span><span class="sxs-lookup"><span data-stu-id="938a3-133">The [**CHString**](chstring.md) and [**CHStringArray**](/windows/desktop/api/ChStrArr/nl-chstrarr-chstringarray) classes are similar to the Microsoft Foundation Classes (MFC) **CString** and **CStringArray**.</span></span> <span data-ttu-id="938a3-134">Les versions de WMI existent pour permettre aux développeurs d’accéder à des méthodes de comparaison et de manipulation de chaînes sans avoir à accéder aux MFC.</span><span class="sxs-lookup"><span data-stu-id="938a3-134">The WMI versions exist so that developers can access to string manipulation and comparison methods without having to access MFC.</span></span> <span data-ttu-id="938a3-135">Les classes [**WBEMTime**](wbemtime.md) et [**WBEMTimeSpan**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan) sont également similaires aux classes MFC **ctime** et **CTimeSpan** .</span><span class="sxs-lookup"><span data-stu-id="938a3-135">The [**WBEMTime**](wbemtime.md) and [**WBEMTimeSpan**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan) classes are also similar to the MFC **CTime** and **CTimeSpan** classes.</span></span> <span data-ttu-id="938a3-136">Les versions WMI sont capables de stocker la précision de la durée de la nanoseconde et peuvent également être converties vers et à partir de **BSTR**.</span><span class="sxs-lookup"><span data-stu-id="938a3-136">The WMI versions are capable of storing time to nanosecond accuracy, and can also convert to and from **BSTR**.</span></span> <span data-ttu-id="938a3-137">Pour plus d’informations sur les classes CString, CStringArray, CTime et CTimeSpan, consultez les [Microsoft Foundation classes](https://msdn.microsoft.com/library/d06h2x6e(VS.71).aspx) sur MSDN.</span><span class="sxs-lookup"><span data-stu-id="938a3-137">For more information about the CString, CStringArray, CTime, and CTimeSpan classes, see the [Microsoft Foundation Classes](https://msdn.microsoft.com/library/d06h2x6e(VS.71).aspx) on MSDN.</span></span>

 

<span data-ttu-id="938a3-138">Les valeurs **BSTR** retournées par les méthodes [**WBEMTime**](wbemtime.md) sont au [format de date et d’heure](date-and-time-format.md): « AAAAMMJJHHMMSS. mmmmmmsUUU »</span><span class="sxs-lookup"><span data-stu-id="938a3-138">**BSTR** values returned by [**WBEMTime**](wbemtime.md) methods are in [Date and Time Format](date-and-time-format.md): "yyyymmddHHMMSS.mmmmmmsUUU"</span></span>

<span data-ttu-id="938a3-139">Les valeurs **BSTR** retournées par les méthodes [**WBEMTimeSpan**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan) sont au [format d’intervalle](interval-format.md): « ddddddddHHMMSS. mmmmmm : 000 »</span><span class="sxs-lookup"><span data-stu-id="938a3-139">**BSTR** values returned by [**WBEMTimeSpan**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan) methods are in [Interval Format](interval-format.md): "ddddddddHHMMSS.mmmmmm:000"</span></span>

<span data-ttu-id="938a3-140">Bien que les heures et les intervalles de temps soient stockés en interne en tant que nanosecondes, ils ne sont pas nécessairement stockés avec une précision de nanoseconde.</span><span class="sxs-lookup"><span data-stu-id="938a3-140">Although times and time spans are stored internally as nanoseconds, they are not necessarily stored with nanosecond accuracy.</span></span> <span data-ttu-id="938a3-141">Cela est dû au fait que les objets [**WBEMTime**](wbemtime.md) peuvent être construits à l’aide de formats d’heure précis à une seconde (**struct TM** et **Time \_ t**).</span><span class="sxs-lookup"><span data-stu-id="938a3-141">This is because [**WBEMTime**](wbemtime.md) objects can be constructed using time formats that are accurate to a second (**struct tm**, and **time\_t**).</span></span> <span data-ttu-id="938a3-142">L’ajout de décimales artificielles n’augmente pas la précision.</span><span class="sxs-lookup"><span data-stu-id="938a3-142">Adding artificial decimal places does not increase the accuracy.</span></span>

 

 
