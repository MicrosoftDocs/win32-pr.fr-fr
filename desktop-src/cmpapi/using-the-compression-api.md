---
description: De nombreuses applications doivent utiliser la compression et la décompression des données sans perte. L’API de compression simplifie cela en exposant les algorithmes de compression Windows par le biais d’une API publique.
ms.assetid: D603A7DE-D4A1-4515-9702-B03C81504661
title: Utilisation de l’API de compression
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 01eff163f4ea1ccf03e1cd4ac9cb16a26afeb265
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104111298"
---
# <a name="using-the-compression-api"></a><span data-ttu-id="e353c-104">Utilisation de l’API de compression</span><span class="sxs-lookup"><span data-stu-id="e353c-104">Using the Compression API</span></span>

<span data-ttu-id="e353c-105">De nombreuses applications doivent utiliser la compression et la décompression des données sans perte.</span><span class="sxs-lookup"><span data-stu-id="e353c-105">Many applications need to use lossless data compression and decompression.</span></span> <span data-ttu-id="e353c-106">L’API de compression simplifie cela en exposant les algorithmes de compression Windows par le biais d’une API publique.</span><span class="sxs-lookup"><span data-stu-id="e353c-106">The Compression API simplifies this by exposing Windows compression algorithms through a public API.</span></span> <span data-ttu-id="e353c-107">Chaque algorithme de compression a un ensemble de propriétés qui contrôle son comportement.</span><span class="sxs-lookup"><span data-stu-id="e353c-107">Each compression algorithm has a set of properties that controls its behavior.</span></span> <span data-ttu-id="e353c-108">L’API de compression expose une interface qui permet au développeur de définir ou d’interroger les valeurs de ces propriétés.</span><span class="sxs-lookup"><span data-stu-id="e353c-108">The Compression API exposes an interface that enables the developer to set or query the values of these properties.</span></span> <span data-ttu-id="e353c-109">Toutes les propriétés des algorithmes de compression pris en charge ont des valeurs par défaut qui représentent les valeurs couramment utilisées de ces propriétés.</span><span class="sxs-lookup"><span data-stu-id="e353c-109">All properties for the supported compression algorithms have default values representing commonly used values of these properties.</span></span> <span data-ttu-id="e353c-110">Si une propriété est requise pour la compression et la décompression, les valeurs par défaut sont identiques, ce qui garantit que des valeurs identiques sont utilisées pour la compression et la décompression.</span><span class="sxs-lookup"><span data-stu-id="e353c-110">If a property is required for both compression and decompression, the default values will be identical, ensuring identical values are used for compression and decompression.</span></span>

## <a name="selecting-the-compression-algorithm"></a><span data-ttu-id="e353c-111">Sélection de l’algorithme de compression</span><span class="sxs-lookup"><span data-stu-id="e353c-111">Selecting the compression algorithm</span></span>

<span data-ttu-id="e353c-112">Une fois qu’un développeur a décidé qu’une application a besoin de compresser ou de décompresser les données, l’étape suivante consiste à choisir un algorithme de compression.</span><span class="sxs-lookup"><span data-stu-id="e353c-112">After a developer decides that an application needs to compress or decompress data, the next step is to choose a compression algorithm.</span></span> <span data-ttu-id="e353c-113">Cela peut dépendre de tests pour trouver la combinaison optimale de vitesse, de taux de compression et de mémoire requise pour une application particulière.</span><span class="sxs-lookup"><span data-stu-id="e353c-113">This may depend upon tests to find the best performing combination of speed, compression ratio, and memory requirement for a particular application.</span></span> <span data-ttu-id="e353c-114">La liste suivante fournit une comparaison relative des algorithmes de compression actuellement pris en charge par l’API de compression.</span><span class="sxs-lookup"><span data-stu-id="e353c-114">The following list gives a relative comparison of the compression algorithms currently supported by the Compression API.</span></span> <span data-ttu-id="e353c-115">Toutes les options ne sont pas disponibles pour chaque algorithme de compression, et la comparaison est approximative, car les performances peuvent dépendre des données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="e353c-115">Not every option is available for every compression algorithm, and the comparison is approximate because performance can depend on the input data.</span></span>

<span data-ttu-id="e353c-116">XPRESS (**compresser l' \_ algorithme \_ Xpress**)</span><span class="sxs-lookup"><span data-stu-id="e353c-116">XPRESS (**COMPRESS\_ALGORITHM\_XPRESS**)</span></span>

-   <span data-ttu-id="e353c-117">Très rapide avec des exigences de ressources insuffisantes</span><span class="sxs-lookup"><span data-stu-id="e353c-117">Very fast with low resource requirements</span></span>
-   <span data-ttu-id="e353c-118">Taux de compression moyen</span><span class="sxs-lookup"><span data-stu-id="e353c-118">Medium compression ratio</span></span>
-   <span data-ttu-id="e353c-119">Vitesses de compression et de décompression élevées</span><span class="sxs-lookup"><span data-stu-id="e353c-119">High compression and decompression speeds</span></span>
-   <span data-ttu-id="e353c-120">Mémoire insuffisante</span><span class="sxs-lookup"><span data-stu-id="e353c-120">Low memory requirement</span></span>
-   <span data-ttu-id="e353c-121">Prend en charge l’option de **\_ niveau de \_ classe \_ d’informations compress** disponible dans l’énumération de [**\_ \_ classe d’informations compress**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="e353c-121">Supports the **COMPRESS\_INFORMATION\_CLASS\_LEVEL** option available in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="e353c-122">La valeur par défaut est **(DWORD) 0**.</span><span class="sxs-lookup"><span data-stu-id="e353c-122">The default value is **(DWORD)0**.</span></span> <span data-ttu-id="e353c-123">Pour certaines données, la valeur **(DWORD) 1** peut améliorer le taux de compression avec une vitesse de compression légèrement inférieure.</span><span class="sxs-lookup"><span data-stu-id="e353c-123">For some data, the value **(DWORD)1** can improve the compression ratio with a slightly slower compression speed.</span></span>

<span data-ttu-id="e353c-124">Codage XPRESS avec Huffman (**compression d' \_ algorithme \_ Xpress \_ Huff**)</span><span class="sxs-lookup"><span data-stu-id="e353c-124">XPRESS with Huffman encoding (**COMPRESS\_ALGORITHM\_XPRESS\_HUFF**)</span></span>

-   <span data-ttu-id="e353c-125">Le taux de compression est plus élevé que **compresser l' \_ algorithme \_ Xpress**</span><span class="sxs-lookup"><span data-stu-id="e353c-125">Compression ratio is higher than **COMPRESS\_ALGORITHM\_XPRESS**</span></span>
-   <span data-ttu-id="e353c-126">Taux de compression moyen</span><span class="sxs-lookup"><span data-stu-id="e353c-126">Medium compression ratio</span></span>
-   <span data-ttu-id="e353c-127">Vitesses de compression moyenne à élevée et de décompression</span><span class="sxs-lookup"><span data-stu-id="e353c-127">Medium to high compression and decompression speeds</span></span>
-   <span data-ttu-id="e353c-128">Mémoire insuffisante</span><span class="sxs-lookup"><span data-stu-id="e353c-128">Low memory requirement</span></span>
-   <span data-ttu-id="e353c-129">Prend en charge l’option **compresser les \_ données de \_ \_ niveau classe** dans l’énumération de [**\_ \_ classe d’informations compress**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="e353c-129">Supports the **COMPRESS\_INFORMATION\_CLASS\_LEVEL** option in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="e353c-130">La valeur par défaut est **(DWORD) 0**.</span><span class="sxs-lookup"><span data-stu-id="e353c-130">The default value is **(DWORD)0**.</span></span> <span data-ttu-id="e353c-131">Pour certaines données, la valeur **(DWORD) 1** peut améliorer le taux de compression avec une vitesse de compression légèrement inférieure.</span><span class="sxs-lookup"><span data-stu-id="e353c-131">For some data, the value **(DWORD)1** can improve the compression ratio with a slightly slower compression speed.</span></span>

<span data-ttu-id="e353c-132">MSZIP (**compresser l' \_ algorithme \_ MSZIP**)</span><span class="sxs-lookup"><span data-stu-id="e353c-132">MSZIP (**COMPRESS\_ALGORITHM\_MSZIP**)</span></span>

-   <span data-ttu-id="e353c-133">Utilise plus de ressources qu’un **\_ algorithme compress \_ Xpress \_ Huff**</span><span class="sxs-lookup"><span data-stu-id="e353c-133">Uses more resources than **COMPRESS\_ALGORITHM\_XPRESS\_HUFF**</span></span>
-   <span data-ttu-id="e353c-134">Génère un bloc compressé similaire à la RFC 1951.</span><span class="sxs-lookup"><span data-stu-id="e353c-134">Generates a compressed block similar to RFC 1951.</span></span>
-   <span data-ttu-id="e353c-135">Taux de compression moyen à élevé</span><span class="sxs-lookup"><span data-stu-id="e353c-135">Medium to high compression ratio</span></span>
-   <span data-ttu-id="e353c-136">Vitesse de compression moyenne et vitesse de décompression élevée</span><span class="sxs-lookup"><span data-stu-id="e353c-136">Medium compression speed and high decompression speed</span></span>
-   <span data-ttu-id="e353c-137">Mémoire moyenne requise</span><span class="sxs-lookup"><span data-stu-id="e353c-137">Medium memory requirement</span></span>

<span data-ttu-id="e353c-138">LZMS (**compresser l' \_ algorithme \_ LZMS**)</span><span class="sxs-lookup"><span data-stu-id="e353c-138">LZMS (**COMPRESS\_ALGORITHM\_LZMS**)</span></span>

-   <span data-ttu-id="e353c-139">Bon algorithme si la taille des données à compresser est supérieure à 2 Mo.</span><span class="sxs-lookup"><span data-stu-id="e353c-139">Good algorithm if the size of the data to be compressed is over 2MB.</span></span>
-   <span data-ttu-id="e353c-140">Taux de compression élevé</span><span class="sxs-lookup"><span data-stu-id="e353c-140">High compression ratio</span></span>
-   <span data-ttu-id="e353c-141">Vitesse de compression faible et vitesse de décompression élevée</span><span class="sxs-lookup"><span data-stu-id="e353c-141">Low compression speed and high decompression speed</span></span>
-   <span data-ttu-id="e353c-142">Exigence de mémoire moyenne à élevée</span><span class="sxs-lookup"><span data-stu-id="e353c-142">Medium to high memory requirement</span></span>
-   <span data-ttu-id="e353c-143">Prend en charge l’option de **taille de bloc de \_ classe d’informations \_ \_ \_ Compress** dans l’énumération de [**\_ \_ classe d’informations compress**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="e353c-143">Supports the **COMPRESS\_INFORMATION\_CLASS\_BLOCK\_SIZE** option in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="e353c-144">Une taille minimale de 1 Mo est suggérée pour obtenir un meilleur taux de compression.</span><span class="sxs-lookup"><span data-stu-id="e353c-144">A minimum size of 1 MB is suggested to get a better compression ratio.</span></span>

## <a name="deciding-which-compression-api-mode-to-use"></a><span data-ttu-id="e353c-145">Choix du mode d’API de compression à utiliser</span><span class="sxs-lookup"><span data-stu-id="e353c-145">Deciding which Compression API mode to use</span></span>

<span data-ttu-id="e353c-146">Une fois que le développeur a sélectionné l’algorithme de compression, la décision suivante est celle des deux modes de l’API de compression à utiliser : mode mémoire tampon ou mode bloc.</span><span class="sxs-lookup"><span data-stu-id="e353c-146">After a developer selects the compression algorithm, the next decision is which of the two modes of the Compression API to use: buffer mode or block mode.</span></span> <span data-ttu-id="e353c-147">Le mode mémoire tampon a été développé pour une utilisation simplifiée et est recommandé dans la plupart des cas.</span><span class="sxs-lookup"><span data-stu-id="e353c-147">Buffer mode was developed for ease of use and is recommended for most cases.</span></span>

<span data-ttu-id="e353c-148">Le mode mémoire tampon fractionne automatiquement la mémoire tampon d’entrée en blocs d’une taille appropriée pour l’algorithme de compression sélectionné.</span><span class="sxs-lookup"><span data-stu-id="e353c-148">Buffer mode automatically splits up the input buffer into blocks of a size that is appropriate for the selected compression algorithm.</span></span> <span data-ttu-id="e353c-149">Le mode mémoire tampon met en forme et stocke automatiquement la taille de la mémoire tampon non compressée dans la mémoire tampon compressée.</span><span class="sxs-lookup"><span data-stu-id="e353c-149">The buffer mode automatically formats and stores the uncompressed buffer size in the compressed buffer.</span></span> <span data-ttu-id="e353c-150">La taille de la mémoire tampon compressée n’est pas enregistrée automatiquement et l’application doit l’enregistrer pour la décompression.</span><span class="sxs-lookup"><span data-stu-id="e353c-150">The size of the compressed buffer is not automatically saved, and the application needs to save this for decompression.</span></span> <span data-ttu-id="e353c-151">N’incluez pas l’indicateur **Compress \_ RAW** dans le paramètre *Algorithm* lorsque vous appelez [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) et [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) pour utiliser le mode buffer.</span><span class="sxs-lookup"><span data-stu-id="e353c-151">Do not include the **COMPRESS\_RAW** flag in the *Algorithm* parameter when you call [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) to use buffer mode.</span></span> <span data-ttu-id="e353c-152">Pour obtenir un exemple de code d’une application en mode mémoire tampon, consultez la section utilisation de l' [API de compression en mode mémoire tampon](using-the-compression-api-in-buffer-mode.md) .</span><span class="sxs-lookup"><span data-stu-id="e353c-152">For a code example of a buffer mode application, see the [Using the Compression API in buffer mode](using-the-compression-api-in-buffer-mode.md) section.</span></span>

<span data-ttu-id="e353c-153">Le mode blocage permet au développeur de contrôler la taille du bloc, mais nécessite davantage de travail par l’application.</span><span class="sxs-lookup"><span data-stu-id="e353c-153">Block mode enables the developer to control the block size, but requires more work be done by the application.</span></span> <span data-ttu-id="e353c-154">Lors de l’utilisation du mode bloc, l’application doit scinder les données d’entrée en éléments de taille appropriée lors de la compression, puis replacer les parties lors de la décompression.</span><span class="sxs-lookup"><span data-stu-id="e353c-154">When using block mode, the application has to break the input data into appropriately sized pieces when compressing and then put the pieces back together when decompressing.</span></span> <span data-ttu-id="e353c-155">Le mode bloc échoue si la taille de la mémoire tampon d’entrée est supérieure à la taille de bloc interne de l’algorithme de compression.</span><span class="sxs-lookup"><span data-stu-id="e353c-155">The block mode fails if the size of the input buffer is greater than the internal block size of the compression algorithm.</span></span> <span data-ttu-id="e353c-156">La taille de bloc interne est de 32 Ko pour MSZIP et 1 Go pour les algorithmes de compression XPRESS.</span><span class="sxs-lookup"><span data-stu-id="e353c-156">The internal block size is 32KB for the MSZIP and 1GB for the XPRESS compression algorithms.</span></span> <span data-ttu-id="e353c-157">La taille de bloc interne pour LZMS peut être configurée jusqu’à 64 Go avec une augmentation correspondante de l’utilisation de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="e353c-157">The internal block size for LZMS is configurable up to 64GB with a corresponding increase in memory use.</span></span> <span data-ttu-id="e353c-158">La taille de la mémoire tampon compressée n’est pas enregistrée automatiquement, et l’application doit également l’enregistrer pour la décompression.</span><span class="sxs-lookup"><span data-stu-id="e353c-158">The size of the compressed buffer is not automatically saved, and the application also needs to save this for decompression.</span></span> <span data-ttu-id="e353c-159">La valeur du paramètre *UncompressedBufferSize* de la [**décompression**](/windows/desktop/api/compressapi/nf-compressapi-decompress) doit être exactement égale à la taille d’origine des données non compressées, et pas seulement à la taille de la mémoire tampon de sortie.</span><span class="sxs-lookup"><span data-stu-id="e353c-159">The value of *UncompressedBufferSize* parameter of [**Decompress**](/windows/desktop/api/compressapi/nf-compressapi-decompress) must be exactly equal to the original size of the uncompressed data and not just the size of the output buffer.</span></span> <span data-ttu-id="e353c-160">Cela signifie que votre application doit enregistrer la taille d’origine exacte des données non compressées, ainsi que les données compressées et la taille compressée, lors de l’utilisation du mode bloc.</span><span class="sxs-lookup"><span data-stu-id="e353c-160">This means your application should save the exact original size of the uncompressed data, as well as the compressed data and compressed size, when using block mode.</span></span> <span data-ttu-id="e353c-161">Incluez l’indicateur de **compression \_ brute** dans le paramètre d' *algorithme* lorsque vous appelez à la fois [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) et [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) pour utiliser le mode bloc.</span><span class="sxs-lookup"><span data-stu-id="e353c-161">Include the **COMPRESS\_RAW** flag in the *Algorithm* parameter when you call both [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) to use block mode.</span></span> <span data-ttu-id="e353c-162">Pour obtenir un exemple de code d’une application en mode bloc, consultez la section utilisation de l' [API de compression en mode bloc](using-the-compression-api-in-block-mode.md) .</span><span class="sxs-lookup"><span data-stu-id="e353c-162">For a code example of a block mode application, see the [Using the Compression API in block mode](using-the-compression-api-in-block-mode.md) section.</span></span>

## <a name="custom-memory-allocation"></a><span data-ttu-id="e353c-163">Allocation de mémoire personnalisée</span><span class="sxs-lookup"><span data-stu-id="e353c-163">Custom memory allocation</span></span>

<span data-ttu-id="e353c-164">Les applications de mémoire tampon et en mode bloc ont la possibilité de spécifier une routine d’allocation de mémoire personnalisée quand elles appellent [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) et [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor).</span><span class="sxs-lookup"><span data-stu-id="e353c-164">Buffer and block mode applications have the option to specify a custom memory allocation routine when they call [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor).</span></span> <span data-ttu-id="e353c-165">Le paramètre *AllocationRoutines* spécifie la structure des [**\_ \_ routines d’allocation de compression**](/windows/desktop/api/compressapi/ns-compressapi-compress_allocation_routines) qui contient la routine d’allocation de mémoire.</span><span class="sxs-lookup"><span data-stu-id="e353c-165">The *AllocationRoutines* parameter specifies the [**COMPRESS\_ALLOCATION\_ROUTINES**](/windows/desktop/api/compressapi/ns-compressapi-compress_allocation_routines) structure that contains the memory allocation routine.</span></span> <span data-ttu-id="e353c-166">L’application peut ensuite définir la taille de bloc pour le compresseur à l’aide de [**SetCompressorInformation**](/windows/desktop/api/compressapi/nf-compressapi-setcompressorinformation).</span><span class="sxs-lookup"><span data-stu-id="e353c-166">The application can then set the block size for the compressor using [**SetCompressorInformation**](/windows/desktop/api/compressapi/nf-compressapi-setcompressorinformation).</span></span> <span data-ttu-id="e353c-167">Consultez la section [utilisation de l’API de compression en mode bloc](using-the-compression-api-in-block-mode.md) pour obtenir un exemple de routine d’allocation personnalisée simple.</span><span class="sxs-lookup"><span data-stu-id="e353c-167">See the [Using the Compression API in block mode](using-the-compression-api-in-block-mode.md) section for an example of a simple customized allocation routine.</span></span>

 

 



