---
description: Une autorité de certification Microsoft (CA) peut être configurée pour archiver et récupérer la clé privée associée à la clé publique envoyée dans la demande de certificat.
ms.assetid: c6535dbf-c3fe-4f70-9a70-02805253a651
title: Serveur de récupération de clé
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b4e9fd60b7ee6596b98953d382978be64695c035
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103865029"
---
# <a name="key-recovery-server"></a><span data-ttu-id="25085-103">Serveur de récupération de clé</span><span class="sxs-lookup"><span data-stu-id="25085-103">Key Recovery Server</span></span>

<span data-ttu-id="25085-104">Une autorité de certification Microsoft (CA) peut être configurée pour archiver et récupérer la clé privée associée à la clé publique envoyée dans la demande de certificat.</span><span class="sxs-lookup"><span data-stu-id="25085-104">A Microsoft certification authority (CA) can be configured to archive and recover the private key associated with the public key submitted in the certificate request.</span></span> <span data-ttu-id="25085-105">La récupération est utile si une clé est perdue.</span><span class="sxs-lookup"><span data-stu-id="25085-105">Recovery is useful if a key is lost.</span></span> <span data-ttu-id="25085-106">Par défaut, seules les clés de chiffrement peuvent être archivées.</span><span class="sxs-lookup"><span data-stu-id="25085-106">By default, only encryption keys can be archived.</span></span> <span data-ttu-id="25085-107">Il n’est pas nécessaire d’archiver les clés destinées uniquement à la signature, car seule la clé publique est nécessaire pour vérifier une signature si la clé de signature privée est perdue.</span><span class="sxs-lookup"><span data-stu-id="25085-107">It is not necessary to archive keys intended only for signing because only the public key is needed to verify a signature if the private signing key is lost.</span></span>

<span data-ttu-id="25085-108">Pour archiver une clé, l’autorité de certification doit être configurée pour émettre des certificats de l’agent de récupération de clé (KRA) et avoir déjà émis au moins un.</span><span class="sxs-lookup"><span data-stu-id="25085-108">To archive a key, the CA must be configured to issue key recovery agent (KRA) certificates and to have already issued at least one.</span></span> <span data-ttu-id="25085-109">Un agent de récupération de clé est un administrateur autorisé par une organisation à déchiffrer les clés privées.</span><span class="sxs-lookup"><span data-stu-id="25085-109">A key recovery agent is an administrator authorized by an organization to decrypt private keys.</span></span> <span data-ttu-id="25085-110">Pour améliorer la sécurité, nous recommandons que les rôles agent de récupération de clé et gestionnaire de certificat soient attribués à des personnes différentes, que le gestionnaire de certificats est autorisé à récupérer sans déchiffrer les clés archivées, et que l’agent de récupération de clé soit autorisé à déchiffrer les clés, mais pas à les récupérer.</span><span class="sxs-lookup"><span data-stu-id="25085-110">To enhance security, we recommend that the key recovery agent and the certificate manager roles be assigned to different individuals, that the certificate manager be permitted to retrieve but not decrypt archived keys, and that the key recovery agent be permitted to decrypt keys but not retrieve them.</span></span>

## <a name="key-archival"></a><span data-ttu-id="25085-111">Archivage de clé</span><span class="sxs-lookup"><span data-stu-id="25085-111">Key Archival</span></span>

<span data-ttu-id="25085-112">Un client demande généralement un certificat à l’aide d’un modèle.</span><span class="sxs-lookup"><span data-stu-id="25085-112">A client typically requests a certificate by using a template.</span></span> <span data-ttu-id="25085-113">Si le modèle requiert l’archivage de la clé privée, les étapes suivantes sont effectuées par le client et l’autorité de certification :</span><span class="sxs-lookup"><span data-stu-id="25085-113">If the template requires that the private key be archived, the following steps are performed by the client and the CA:</span></span>

1.  <span data-ttu-id="25085-114">Le client récupère et valide le certificat d’échange d’autorité de certification pour déterminer s’il a été signé à l’aide de la même clé que celle utilisée pour signer le certificat de signature de l’autorité de certification.</span><span class="sxs-lookup"><span data-stu-id="25085-114">The client retrieves and validates the CA exchange certificate to determine whether it has been signed by the same key that was used to sign the CA signing certificate.</span></span> <span data-ttu-id="25085-115">Cela garantit que la seule autorité de certification qui peut déchiffrer la clé privée est l’autorité de certification à partir de laquelle un certificat est demandé.</span><span class="sxs-lookup"><span data-stu-id="25085-115">This ensures that the only CA that can decrypt the private key is the CA from which a certificate is being requested.</span></span>
2.  <span data-ttu-id="25085-116">La clé publique dans le certificat d’échange d’autorité de certification est utilisée pour chiffrer la clé privée associée à la demande de certificat et la demande est envoyée à l’autorité de certification.</span><span class="sxs-lookup"><span data-stu-id="25085-116">The public key in the CA exchange certificate is used to encrypt the private key associated with the certificate request, and the request is sent to the CA.</span></span>
3.  <span data-ttu-id="25085-117">L’autorité de certification utilise la clé privée associée à son certificat Exchange pour déchiffrer la clé privée envoyée par le client et vérifie que les clés publique et privée de la demande sont liées.</span><span class="sxs-lookup"><span data-stu-id="25085-117">The CA uses the private key associated with its exchange certificate to decrypt the private key sent by the client and verifies that the public and private keys in the request are related.</span></span>
4.  <span data-ttu-id="25085-118">L’autorité de certification chiffre la clé privée à l’aide de la clé publique dans le certificat KRA.</span><span class="sxs-lookup"><span data-stu-id="25085-118">The CA encrypts the private key by using the public key in the KRA certificate.</span></span> <span data-ttu-id="25085-119">Si l’autorité de certification a émis plusieurs certificats KRA, elle chiffre la clé privée une seule fois avec chaque clé publique disponible afin que tout agent de récupération de clé autorisé puisse récupérer une clé.</span><span class="sxs-lookup"><span data-stu-id="25085-119">If the CA has issued multiple KRA certificates, it encrypts the private key once with each available public key so that any authorized key recovery agent can recover a key.</span></span> <span data-ttu-id="25085-120">Les clés privées chiffrées sont stockées dans la base de données de certificats.</span><span class="sxs-lookup"><span data-stu-id="25085-120">The encrypted private keys are stored in the certificate database.</span></span>
5.  <span data-ttu-id="25085-121">L’autorité de certification libère toutes les références à la clé privée et libère en toute sécurité et met à zéro toute la mémoire qui contenait la clé.</span><span class="sxs-lookup"><span data-stu-id="25085-121">The CA releases all references to the private key and securely frees and zeros all memory that contained the key.</span></span> <span data-ttu-id="25085-122">Cela permet de s’assurer que l’autorité de certification n’a plus accès à la clé au format texte clair.</span><span class="sxs-lookup"><span data-stu-id="25085-122">This ensures that the CA has no further access to the key in clear text format.</span></span>

> [!Note]  
> <span data-ttu-id="25085-123">Seule une demande CMC peut être utilisée pour l’archivage de clé.</span><span class="sxs-lookup"><span data-stu-id="25085-123">Only a CMC request can be used for key archival.</span></span> <span data-ttu-id="25085-124">Les demandes CMC sont représentées par l’interface [**IX509CertificateRequestCmc**](/windows/desktop/api/CertEnroll/nn-certenroll-ix509certificaterequestcmc) .</span><span class="sxs-lookup"><span data-stu-id="25085-124">CMC requests are represented by the [**IX509CertificateRequestCmc**](/windows/desktop/api/CertEnroll/nn-certenroll-ix509certificaterequestcmc) interface.</span></span>

 

## <a name="key-recovery"></a><span data-ttu-id="25085-125">Récupération de clé</span><span class="sxs-lookup"><span data-stu-id="25085-125">Key Recovery</span></span>

<span data-ttu-id="25085-126">La récupération de clé n’est pas directement prise en charge par les services de certificats Active Directory ou l’API d’inscription de certificats.</span><span class="sxs-lookup"><span data-stu-id="25085-126">Key recovery is not directly supported by Active Directory Certificate Services or the Certificate Enrollment API.</span></span> <span data-ttu-id="25085-127">Toutefois, Microsoft fournit les applications suivantes pour vous aider dans le processus :</span><span class="sxs-lookup"><span data-stu-id="25085-127">Microsoft does, however, provide the following applications to help with the process:</span></span>

-   <span data-ttu-id="25085-128">Certutil.exe est un programme de ligne de commande qui peut être utilisé pour récupérer des informations de configuration de l’autorité de certification, vérifier les certificats, les paires de clés et les chaînes de certificats, et sauvegarder et restaurer des clés.</span><span class="sxs-lookup"><span data-stu-id="25085-128">Certutil.exe is a command line program that can be used to retrieve CA configuration information, verify certificates, key pairs, and certificate chains, and back up and restore keys.</span></span> <span data-ttu-id="25085-129">Il est inclus dans les systèmes d’exploitation serveur à compter de Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="25085-129">It is included in server operating systems beginning with Windows Server 2003.</span></span>
-   <span data-ttu-id="25085-130">Krecover.exe est un programme basé sur une boîte de dialogue qui permet la récupération de clés.</span><span class="sxs-lookup"><span data-stu-id="25085-130">Krecover.exe is a dialog box–based program that enables key recovery.</span></span> <span data-ttu-id="25085-131">Il est inclus dans le kit de ressources à partir de Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="25085-131">It is included with the Resource Kit beginning with Windows Server 2003.</span></span>

<span data-ttu-id="25085-132">Les étapes suivantes sont effectuées pour récupérer une clé privée :</span><span class="sxs-lookup"><span data-stu-id="25085-132">The following steps are performed to recover a private key:</span></span>

1.  <span data-ttu-id="25085-133">Le gestionnaire de certificats localise les candidats potentiels à la récupération de clé dans la base de données de certificats à l’aide du nom du certificat, du demandeur ou de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="25085-133">The certificate manager locates potential candidates for key recovery in the certificate database by using the name of the certificate, requester, or user.</span></span> <span data-ttu-id="25085-134">La commande **certutil** **-GetKey** peut être utilisée à cet effet.</span><span class="sxs-lookup"><span data-stu-id="25085-134">The **Certutil** **-getkey** command can be used for this purpose.</span></span>
2.  <span data-ttu-id="25085-135">Une fois que le gestionnaire de certificats dispose d’une liste de certificats, la commande **-GetKey** est appelée à nouveau avec un numéro de série de certificat spécifique ou un curseur de défilement pour récupérer un \# fichier PKCS 7 contenant le certificat KRA, la chaîne de certificats utilisateur et la clé privée qui a été chiffrée au cours de l’archivage à l’aide de la clé publique de l’agent de récupération.</span><span class="sxs-lookup"><span data-stu-id="25085-135">Once the certificate manager has a list of certificates, the **-getkey** command is called again with a specific certificate serial number or thumb print to retrieve a PKCS \#7 file that contains the KRA certificate, user certificate chain, and the private key that was encrypted during archival by using the KRA public key.</span></span>
3.  <span data-ttu-id="25085-136">Le gestionnaire de certificats passe le contrôle du processus à l’agent de récupération de clé dont la clé privée correspond à la clé publique contenue dans le certificat KRA.</span><span class="sxs-lookup"><span data-stu-id="25085-136">The certificate manager passes control of the process to the key recovery agent whose private key matches the public key contained in the KRA certificate.</span></span>
4.  <span data-ttu-id="25085-137">L’agent de récupération de clé déchiffre la clé privée archivée renvoyée dans le \# fichier PKCS 7 à l’aide de la clé privée Kra.</span><span class="sxs-lookup"><span data-stu-id="25085-137">The key recovery agent decrypts the archived private key returned in the PKCS \#7 file by using the KRA private key.</span></span> <span data-ttu-id="25085-138">Pour ce faire, vous pouvez utiliser la commande **certutil** **-recoverkey** qui place la clé dans un fichier PKCS 12 protégé par mot de passe \# .</span><span class="sxs-lookup"><span data-stu-id="25085-138">This can be done by using the **Certutil** **-recoverkey** command which places the key in a password-protected PKCS \#12 file.</span></span> <span data-ttu-id="25085-139">Le client doit recevoir le mot de passe via un mécanisme hors bande sécurisé.</span><span class="sxs-lookup"><span data-stu-id="25085-139">The client must be given the password through a secure out-of-band mechanism.</span></span>
5.  <span data-ttu-id="25085-140">Le client importe le \# fichier PKCS 12 et utilise le mot de passe pour récupérer la clé.</span><span class="sxs-lookup"><span data-stu-id="25085-140">The client imports the PKCS \#12 file and uses the password to retrieve the key.</span></span>

## <a name="related-topics"></a><span data-ttu-id="25085-141">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="25085-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="25085-142">Éléments PKI</span><span class="sxs-lookup"><span data-stu-id="25085-142">PKI Elements</span></span>](about-pki-components.md)
</dt> </dl>

 

 



