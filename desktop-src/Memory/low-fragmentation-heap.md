---
description: La fragmentation du tas est un État dans lequel la mémoire disponible est décomposée en blocs petits et non contigus.
ms.assetid: d10abf82-423c-4942-b05e-55de3a5c4219
title: Tas de fragmentation faible
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8ad14a97fa6d95b663f63b21f0982332ba0de01e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106544839"
---
# <a name="low-fragmentation-heap"></a><span data-ttu-id="31882-103">Tas de fragmentation faible</span><span class="sxs-lookup"><span data-stu-id="31882-103">Low-fragmentation Heap</span></span>

<span data-ttu-id="31882-104">\[Les informations contenues dans cette rubrique s’appliquent à Windows Server 2003 et Windows XP.</span><span class="sxs-lookup"><span data-stu-id="31882-104">\[The information in this topic applies to Windows Server 2003 and Windows XP.</span></span> <span data-ttu-id="31882-105">À compter de Windows Vista, le système utilise le tas de faible fragmentation (LFH) en fonction des besoins pour traiter les demandes d’allocation de mémoire.</span><span class="sxs-lookup"><span data-stu-id="31882-105">Starting with Windows Vista, the system uses the low-fragmentation heap (LFH) as needed to service memory allocation requests.</span></span> <span data-ttu-id="31882-106">Les applications n’ont pas besoin d’activer le LFH pour leurs tas.\]</span><span class="sxs-lookup"><span data-stu-id="31882-106">Applications do not need to enable the LFH for their heaps.\]</span></span>

<span data-ttu-id="31882-107">La fragmentation du tas est un État dans lequel la mémoire disponible est décomposée en blocs petits et non contigus.</span><span class="sxs-lookup"><span data-stu-id="31882-107">Heap fragmentation is a state in which available memory is broken into small, noncontiguous blocks.</span></span> <span data-ttu-id="31882-108">Lorsqu’un segment de mémoire est fragmenté, l’allocation de mémoire peut échouer même lorsque la mémoire disponible totale dans le tas est suffisante pour satisfaire une demande, car aucun bloc de mémoire unique n’est suffisamment grand.</span><span class="sxs-lookup"><span data-stu-id="31882-108">When a heap is fragmented, memory allocation can fail even when the total available memory in the heap is enough to satisfy a request, because no single block of memory is large enough.</span></span> <span data-ttu-id="31882-109">Le segment de fragmentation faible (LFH) permet de réduire la fragmentation du tas.</span><span class="sxs-lookup"><span data-stu-id="31882-109">The low-fragmentation heap (LFH) helps to reduce heap fragmentation.</span></span>

<span data-ttu-id="31882-110">LFH n’est pas un segment de mémoire séparé.</span><span class="sxs-lookup"><span data-stu-id="31882-110">The LFH is not a separate heap.</span></span> <span data-ttu-id="31882-111">Au lieu de cela, il s’agit d’une stratégie que les applications peuvent activer pour leurs tas.</span><span class="sxs-lookup"><span data-stu-id="31882-111">Instead, it is a policy that applications can enable for their heaps.</span></span> <span data-ttu-id="31882-112">Lorsque le LFH est activé, le système alloue de la mémoire dans certaines tailles prédéterminées.</span><span class="sxs-lookup"><span data-stu-id="31882-112">When the LFH is enabled, the system allocates memory in certain predetermined sizes.</span></span> <span data-ttu-id="31882-113">Quand une application demande une allocation de mémoire à partir d’un segment de mémoire sur lequel le LFH est activé, le système alloue le plus petit bloc de mémoire suffisamment grand pour contenir la taille demandée.</span><span class="sxs-lookup"><span data-stu-id="31882-113">When an application requests a memory allocation from a heap that has the LFH enabled, the system allocates the smallest block of memory that is large enough to contain the requested size.</span></span> <span data-ttu-id="31882-114">Le système n’utilise pas le LFH pour les allocations supérieures à 16 Ko, que le LFH soit activé ou non.</span><span class="sxs-lookup"><span data-stu-id="31882-114">The system does not use the LFH for allocations larger than 16 KB, whether or not the LFH is enabled.</span></span>

<span data-ttu-id="31882-115">Une application doit activer LFH uniquement pour le tas par défaut du processus appelant ou pour les [tas privés](heap-functions.md) créés par l’application.</span><span class="sxs-lookup"><span data-stu-id="31882-115">An application should enable the LFH only for the default heap of the calling process or for [private heaps](heap-functions.md) that the application has created.</span></span> <span data-ttu-id="31882-116">Pour activer LFH pour un segment de mémoire, utilisez la fonction [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) pour obtenir un handle vers le tas par défaut du processus appelant, ou utilisez le handle vers un tas privé créé par la fonction [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) .</span><span class="sxs-lookup"><span data-stu-id="31882-116">To enable the LFH for a heap, use the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) function to obtain a handle to the default heap of the calling process, or use the handle to a private heap created by the [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function.</span></span> <span data-ttu-id="31882-117">Appelez ensuite la fonction [**HeapSetInformation**](/windows/desktop/api/HeapApi/nf-heapapi-heapsetinformation) avec le descripteur.</span><span class="sxs-lookup"><span data-stu-id="31882-117">Then call the [**HeapSetInformation**](/windows/desktop/api/HeapApi/nf-heapapi-heapsetinformation) function with the handle.</span></span>

<span data-ttu-id="31882-118">Le LFH ne peut pas être activé pour les tas créés avec un segment de mémoire **\_ non \_ Serialize** ou pour les tas créés avec une taille fixe.</span><span class="sxs-lookup"><span data-stu-id="31882-118">The LFH cannot be enabled for heaps created with **HEAP\_NO\_SERIALIZE** or for heaps created with a fixed size.</span></span> <span data-ttu-id="31882-119">Le LFH ne peut pas non plus être activé si vous utilisez les outils de débogage du tas dans [outils de débogage pour Windows](/windows-hardware/drivers/debugger/) ou [Microsoft Application Verifier](https://www.microsoft.com/downloads/details.aspx?FamilyID=c4a25ab9-649d-4a1b-b4a7-c9d8b095df18&displaylang=en).</span><span class="sxs-lookup"><span data-stu-id="31882-119">The LFH also cannot be enabled if you are using the heap debugging tools in [Debugging Tools for Windows](/windows-hardware/drivers/debugger/) or [Microsoft Application Verifier](https://www.microsoft.com/downloads/details.aspx?FamilyID=c4a25ab9-649d-4a1b-b4a7-c9d8b095df18&displaylang=en).</span></span>

<span data-ttu-id="31882-120">Une fois que le LFH a été activé pour un segment de mémoire, il ne peut pas être désactivé.</span><span class="sxs-lookup"><span data-stu-id="31882-120">After the LFH has been enabled for a heap, it cannot be disabled.</span></span>

<span data-ttu-id="31882-121">Les applications qui tirent le meilleur parti des LFH sont des applications multithread qui allouent fréquemment de la mémoire et utilisent une variété de tailles d’allocation inférieures à 16 Ko.</span><span class="sxs-lookup"><span data-stu-id="31882-121">Applications that benefit most from the LFH are multithreaded applications that allocate memory frequently and use a variety of allocation sizes under 16 KB.</span></span> <span data-ttu-id="31882-122">Toutefois, toutes les applications ne bénéficient pas de LFH.</span><span class="sxs-lookup"><span data-stu-id="31882-122">However, not all applications benefit from the LFH.</span></span> <span data-ttu-id="31882-123">Pour évaluer les effets de l’activation des LFH dans votre application, utilisez les données de profilage des performances.</span><span class="sxs-lookup"><span data-stu-id="31882-123">To assess the effects of enabling the LFH in your application, use performance profiling data.</span></span>

 

 
