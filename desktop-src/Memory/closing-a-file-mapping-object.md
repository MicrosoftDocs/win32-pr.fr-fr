---
description: Lorsqu’un processus est terminé avec l’objet de mappage de fichier, il doit détruire toutes les vues de fichier dans son espace d’adressage à l’aide de la fonction UnmapViewOfFile pour chaque affichage de fichier.
ms.assetid: d62d068c-9b1d-4dbf-8b21-31a636a41456
title: Fermeture d’un objet de mappage de fichier
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ab35152bd90d401ca7f30a7497d1f0b06263539
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103864865"
---
# <a name="closing-a-file-mapping-object"></a><span data-ttu-id="96ad4-103">Fermeture d’un objet de mappage de fichier</span><span class="sxs-lookup"><span data-stu-id="96ad4-103">Closing a File Mapping Object</span></span>

<span data-ttu-id="96ad4-104">Lorsqu’un processus est terminé avec l’objet de mappage de fichier, il doit détruire toutes les vues de fichier dans son espace d’adressage à l’aide de la fonction [**UnmapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-unmapviewoffile) pour chaque affichage de fichier.</span><span class="sxs-lookup"><span data-stu-id="96ad4-104">When a process has finished with the file mapping object, it should destroy all file views in its address space by using the [**UnmapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-unmapviewoffile) function for each file view.</span></span>

<span data-ttu-id="96ad4-105">L’annulation du mappage d’une vue mappée d’un fichier invalide la plage occupée par la vue dans l’espace d’adressage du processus et rend la plage disponible pour d’autres allocations.</span><span class="sxs-lookup"><span data-stu-id="96ad4-105">Unmapping a mapped view of a file invalidates the range occupied by the view in the address space of the process and makes the range available for other allocations.</span></span> <span data-ttu-id="96ad4-106">Elle supprime l’entrée de la plage de travail pour chaque page virtuelle non mappée faisant partie de la plage de travail du processus et réduit la taille du jeu de travail du processus.</span><span class="sxs-lookup"><span data-stu-id="96ad4-106">It removes the working set entry for each unmapped virtual page that was part of the working set of the process and reduces the working set size of the process.</span></span> <span data-ttu-id="96ad4-107">Elle décrémente également le nombre de partages de la page physique correspondante.</span><span class="sxs-lookup"><span data-stu-id="96ad4-107">It also decrements the share count of the corresponding physical page.</span></span>

<span data-ttu-id="96ad4-108">Les pages modifiées de la vue non mappée ne sont pas écrites sur le disque tant que leur nombre de partages n’atteint pas zéro, ou en d’autres termes, jusqu’à ce qu’ils soient démappés ou supprimés des jeux de travail de tous les processus qui partagent les pages.</span><span class="sxs-lookup"><span data-stu-id="96ad4-108">Modified pages in the unmapped view are not written to disk until their share count reaches zero, or in other words, until they are unmapped or trimmed from the working sets of all processes that share the pages.</span></span> <span data-ttu-id="96ad4-109">Même si les pages modifiées sont écrites « tardivement » sur le disque ; autrement dit, les modifications peuvent être mises en cache en mémoire et écrites sur le disque ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="96ad4-109">Even then, the modified pages are written "lazily" to disk; that is, modifications may be cached in memory and written to disk at a later time.</span></span> <span data-ttu-id="96ad4-110">Pour réduire le risque de perte de données en cas de panne de courant ou de panne du système, les applications doivent vider explicitement les pages modifiées à l’aide de la fonction [**FlushViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) .</span><span class="sxs-lookup"><span data-stu-id="96ad4-110">To minimize the risk of data loss in the event of a power failure or a system crash, applications should explicitly flush modified pages using the [**FlushViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) function.</span></span>

<span data-ttu-id="96ad4-111">Quand chaque processus se termine à l’aide de l’objet de mappage de fichier et que toutes les vues n’ont pas été mappées, il doit fermer le handle de l’objet de mappage de fichier et le fichier sur le disque en appelant [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle).</span><span class="sxs-lookup"><span data-stu-id="96ad4-111">When each process finishes using the file mapping object and has unmapped all views, it must close the file mapping object's handle and the file on disk by calling [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle).</span></span> <span data-ttu-id="96ad4-112">Ces appels à **CloseHandle** échouent même si des vues de fichiers sont toujours ouvertes.</span><span class="sxs-lookup"><span data-stu-id="96ad4-112">These calls to **CloseHandle** succeed even when there are file views that are still open.</span></span> <span data-ttu-id="96ad4-113">Toutefois, le fait de laisser les vues de fichiers mappées entraîne des fuites de mémoire.</span><span class="sxs-lookup"><span data-stu-id="96ad4-113">However, leaving file views mapped causes memory leaks.</span></span>

 

 
