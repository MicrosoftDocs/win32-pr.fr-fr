---
description: Chaque processus a un segment de mémoire par défaut fourni par le système. Les applications qui effectuent des allocations fréquentes à partir du tas peuvent améliorer les performances à l’aide de tas privés.
ms.assetid: cfb683fa-4f46-48b5-9a28-f4625a9cb8cd
title: Fonctions de tas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d0e591c1e349ed6806cbebe00a178a99e63bb412
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103864861"
---
# <a name="heap-functions"></a><span data-ttu-id="a92d0-104">Fonctions de tas</span><span class="sxs-lookup"><span data-stu-id="a92d0-104">Heap Functions</span></span>

<span data-ttu-id="a92d0-105">Chaque processus a un segment de mémoire par défaut fourni par le système.</span><span class="sxs-lookup"><span data-stu-id="a92d0-105">Each process has a default heap provided by the system.</span></span> <span data-ttu-id="a92d0-106">Les applications qui effectuent des allocations fréquentes à partir du tas peuvent améliorer les performances à l’aide de tas privés.</span><span class="sxs-lookup"><span data-stu-id="a92d0-106">Applications that make frequent allocations from the heap can improve performance by using private heaps.</span></span>

<span data-ttu-id="a92d0-107">Un tas privé est un bloc d’une ou plusieurs pages dans l’espace d’adressage du processus appelant.</span><span class="sxs-lookup"><span data-stu-id="a92d0-107">A private heap is a block of one or more pages in the address space of the calling process.</span></span> <span data-ttu-id="a92d0-108">Après avoir créé le tas privé, le processus utilise des fonctions telles que [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) et [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) pour gérer la mémoire dans ce tas.</span><span class="sxs-lookup"><span data-stu-id="a92d0-108">After creating the private heap, the process uses functions such as [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) and [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) to manage the memory in that heap.</span></span>

<span data-ttu-id="a92d0-109">Les fonctions de tas peuvent également être utilisées pour gérer la mémoire dans le tas par défaut du processus, à l’aide du handle retourné par la fonction [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) .</span><span class="sxs-lookup"><span data-stu-id="a92d0-109">The heap functions can also be used to manage memory in the process's default heap, using the handle returned by the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) function.</span></span> <span data-ttu-id="a92d0-110">Les nouvelles applications doivent utiliser les fonctions de tas au lieu des [fonctions globales et locales](global-and-local-functions.md) à cet effet.</span><span class="sxs-lookup"><span data-stu-id="a92d0-110">New applications should use the heap functions instead of the [global and local functions](global-and-local-functions.md) for this purpose.</span></span>

<span data-ttu-id="a92d0-111">Il n’existe aucune différence entre la mémoire allouée à partir d’un tas privé et celle allouée à l’aide des autres fonctions d’allocation de mémoire.</span><span class="sxs-lookup"><span data-stu-id="a92d0-111">There is no difference between memory allocated from a private heap and that allocated by using the other memory allocation functions.</span></span> <span data-ttu-id="a92d0-112">Pour obtenir la liste complète des fonctions, consultez le tableau dans [fonctions de gestion](memory-management-functions.md)de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="a92d0-112">For a complete list of functions, see the table in [Memory Management Functions](memory-management-functions.md).</span></span>

> [!Note]  
> <span data-ttu-id="a92d0-113">Un thread doit appeler des fonctions de tas uniquement pour le tas par défaut du processus et les tas privés que le thread crée et gère, à l’aide de handles retournés par la fonction [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) ou [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) .</span><span class="sxs-lookup"><span data-stu-id="a92d0-113">A thread should call heap functions only for the process's default heap and private heaps that the thread creates and manages, using handles returned by the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) or [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function.</span></span>

 

<span data-ttu-id="a92d0-114">La fonction [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) crée un objet de tas privé à partir duquel le processus appelant peut allouer des blocs de mémoire à l’aide de la fonction [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) .</span><span class="sxs-lookup"><span data-stu-id="a92d0-114">The [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function creates a private heap object from which the calling process can allocate memory blocks by using the [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) function.</span></span> <span data-ttu-id="a92d0-115">**HeapCreate** spécifie à la fois une taille initiale et une taille maximale pour le tas.</span><span class="sxs-lookup"><span data-stu-id="a92d0-115">**HeapCreate** specifies both an initial size and a maximum size for the heap.</span></span> <span data-ttu-id="a92d0-116">La taille initiale détermine le nombre de pages validées, en lecture/écriture initialement allouées pour le segment de mémoire.</span><span class="sxs-lookup"><span data-stu-id="a92d0-116">The initial size determines the number of committed, read/write pages initially allocated for the heap.</span></span> <span data-ttu-id="a92d0-117">La taille maximale détermine le nombre total de pages réservées.</span><span class="sxs-lookup"><span data-stu-id="a92d0-117">The maximum size determines the total number of reserved pages.</span></span> <span data-ttu-id="a92d0-118">Ces pages créent un bloc contigu dans l’espace d’adressage virtuel d’un processus dans lequel le tas peut croître.</span><span class="sxs-lookup"><span data-stu-id="a92d0-118">These pages create a contiguous block in the virtual address space of a process into which the heap can grow.</span></span> <span data-ttu-id="a92d0-119">Les pages supplémentaires sont automatiquement validées à partir de cet espace réservé si les demandes par **HeapAlloc** dépassent la taille actuelle des pages validées, en supposant que le stockage physique correspondant est disponible.</span><span class="sxs-lookup"><span data-stu-id="a92d0-119">Additional pages are automatically committed from this reserved space if requests by **HeapAlloc** exceed the current size of committed pages, assuming that the physical storage for it is available.</span></span> <span data-ttu-id="a92d0-120">Une fois les pages validées, elles ne sont pas dévalidées tant que le processus n’est pas terminé ou que le segment de mémoire n’a pas été détruit en appelant la fonction [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) .</span><span class="sxs-lookup"><span data-stu-id="a92d0-120">Once the pages are committed, they are not decommitted until the process is terminated or until the heap is destroyed by calling the [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) function.</span></span>

<span data-ttu-id="a92d0-121">La mémoire d’un objet de tas privé est accessible uniquement au processus qui l’a créé.</span><span class="sxs-lookup"><span data-stu-id="a92d0-121">The memory of a private heap object is accessible only to the process that created it.</span></span> <span data-ttu-id="a92d0-122">Si une bibliothèque de liens dynamiques (DLL) crée un tas privé, elle le fait dans l’espace d’adressage du processus qui a appelé la DLL.</span><span class="sxs-lookup"><span data-stu-id="a92d0-122">If a dynamic-link library (DLL) creates a private heap, it does so in the address space of the process that called the DLL.</span></span> <span data-ttu-id="a92d0-123">Il est uniquement accessible à ce processus.</span><span class="sxs-lookup"><span data-stu-id="a92d0-123">It is accessible only to that process.</span></span>

<span data-ttu-id="a92d0-124">La fonction [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) alloue un nombre spécifié d’octets à partir d’un tas privé et retourne un pointeur vers le bloc alloué.</span><span class="sxs-lookup"><span data-stu-id="a92d0-124">The [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) function allocates a specified number of bytes from a private heap and returns a pointer to the allocated block.</span></span> <span data-ttu-id="a92d0-125">Ce pointeur peut être utilisé dans les fonctions [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**HeapReAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**HEAPSIZE**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)et [**HeapValidate**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) .</span><span class="sxs-lookup"><span data-stu-id="a92d0-125">This pointer can be used in the [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**HeapReAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize), and [**HeapValidate**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) functions.</span></span>

<span data-ttu-id="a92d0-126">La mémoire allouée par [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) n’est pas déplaçable.</span><span class="sxs-lookup"><span data-stu-id="a92d0-126">Memory allocated by [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) is not movable.</span></span> <span data-ttu-id="a92d0-127">L’adresse retournée par **HeapAlloc** est valide jusqu’à ce que le bloc de mémoire soit libéré ou réalloué ; le bloc de mémoire n’a pas besoin d’être verrouillé.</span><span class="sxs-lookup"><span data-stu-id="a92d0-127">The address returned by **HeapAlloc** is valid until the memory block is freed or reallocated; the memory block does not need to be locked.</span></span>

<span data-ttu-id="a92d0-128">Étant donné que le système ne peut pas compacter un tas privé, il peut être fragmenté.</span><span class="sxs-lookup"><span data-stu-id="a92d0-128">Because the system cannot compact a private heap, it can become fragmented.</span></span> <span data-ttu-id="a92d0-129">Les applications qui allouent de grandes quantités de mémoire dans différentes tailles d’allocation peuvent utiliser le [tas de faible fragmentation](low-fragmentation-heap.md) pour réduire la fragmentation du tas.</span><span class="sxs-lookup"><span data-stu-id="a92d0-129">Applications that allocate large amounts of memory in various allocation sizes can use the [low-fragmentation heap](low-fragmentation-heap.md) to reduce heap fragmentation.</span></span>

<span data-ttu-id="a92d0-130">Une utilisation possible pour les fonctions de tas consiste à créer un tas privé lorsqu’un processus démarre, en spécifiant une taille initiale suffisante pour répondre aux besoins en mémoire du processus.</span><span class="sxs-lookup"><span data-stu-id="a92d0-130">A possible use for the heap functions is to create a private heap when a process starts up, specifying an initial size sufficient to satisfy the memory requirements of the process.</span></span> <span data-ttu-id="a92d0-131">Si l’appel à la fonction [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) échoue, le processus peut se terminer ou informer l’utilisateur de l’insuffisance de mémoire. Toutefois, s’il y parvient, le processus est assuré de disposer de la mémoire dont il a besoin.</span><span class="sxs-lookup"><span data-stu-id="a92d0-131">If the call to the [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function fails, the process can terminate or notify the user of the memory shortage; if it succeeds, however, the process is assured of having the memory it needs.</span></span>

<span data-ttu-id="a92d0-132">La mémoire demandée par [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) peut être ou ne pas être contiguë.</span><span class="sxs-lookup"><span data-stu-id="a92d0-132">Memory requested by [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) may or may not be contiguous.</span></span> <span data-ttu-id="a92d0-133">La mémoire allouée dans un segment de mémoire par [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) est contiguë.</span><span class="sxs-lookup"><span data-stu-id="a92d0-133">Memory allocated within a heap by [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) is contiguous.</span></span> <span data-ttu-id="a92d0-134">Vous ne devez pas écrire ou lire à partir de la mémoire dans un tas à l’exception de celui alloué par **HeapAlloc**, et vous ne devez pas non plus supposer une relation entre deux zones de mémoire allouée par **HeapAlloc**.</span><span class="sxs-lookup"><span data-stu-id="a92d0-134">You should not write to or read from memory in a heap except that allocated by **HeapAlloc**, nor should you assume any relationship between two areas of memory allocated by **HeapAlloc**.</span></span>

<span data-ttu-id="a92d0-135">Vous ne devez pas faire référence à la mémoire qui a été libérée par [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree).</span><span class="sxs-lookup"><span data-stu-id="a92d0-135">You should not refer in any way to memory that has been freed by [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree).</span></span> <span data-ttu-id="a92d0-136">Une fois la mémoire libérée, toutes les informations qui y sont susceptibles de l’être sont infinies.</span><span class="sxs-lookup"><span data-stu-id="a92d0-136">After the memory is freed, any information that may have been in it is gone forever.</span></span> <span data-ttu-id="a92d0-137">Si vous avez besoin d’informations, ne libérez pas de mémoire contenant les informations.</span><span class="sxs-lookup"><span data-stu-id="a92d0-137">If you require information, do not free memory containing the information.</span></span> <span data-ttu-id="a92d0-138">Les appels de fonction qui retournent des informations sur la mémoire (par exemple, [**HEAPSIZE**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)) ne peuvent pas être utilisés avec la mémoire libérée, car ils peuvent retourner des données factices.</span><span class="sxs-lookup"><span data-stu-id="a92d0-138">Function calls that return information about memory (such as [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)) may not be used with freed memory, as they may return bogus data.</span></span>

<span data-ttu-id="a92d0-139">La fonction [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) détruit un objet de tas privé.</span><span class="sxs-lookup"><span data-stu-id="a92d0-139">The [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) function destroys a private heap object.</span></span> <span data-ttu-id="a92d0-140">Il annule la validation et libère toutes les pages de l’objet segment de mémoire, et invalide le descripteur du tas.</span><span class="sxs-lookup"><span data-stu-id="a92d0-140">It decommits and releases all the pages of the heap object, and it invalidates the handle to the heap.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a92d0-141">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="a92d0-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a92d0-142">Comparaison des méthodes d’allocation de mémoire</span><span class="sxs-lookup"><span data-stu-id="a92d0-142">Comparing Memory Allocation Methods</span></span>](comparing-memory-allocation-methods.md)
</dt> </dl>

 

 



