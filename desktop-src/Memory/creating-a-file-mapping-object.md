---
description: La première étape du mappage d’un fichier consiste à ouvrir le fichier en appelant la fonction CreateFile.
ms.assetid: e00d8742-b717-419c-902c-9a286d75d8aa
title: Création d’un objet de mappage de fichier
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 550609cf9d8a052e324c585fc046472278bb428c
ms.sourcegitcommit: 8ebcf6cd36f67f8bcf78e76ae8923d65b8995c8a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/05/2021
ms.locfileid: "111524353"
---
# <a name="creating-a-file-mapping-object"></a><span data-ttu-id="5e534-103">Création d’un objet de mappage de fichier</span><span class="sxs-lookup"><span data-stu-id="5e534-103">Creating a File Mapping Object</span></span>

<span data-ttu-id="5e534-104">La première étape du mappage d’un fichier consiste à ouvrir le fichier en appelant la fonction [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="5e534-104">The first step in mapping a file is to open the file by calling the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="5e534-105">Pour vous assurer que les autres processus ne peuvent pas écrire dans la partie du fichier qui est mappée, vous devez ouvrir le fichier avec un accès exclusif.</span><span class="sxs-lookup"><span data-stu-id="5e534-105">To ensure that other processes cannot write to the portion of the file that is mapped, you should open the file with exclusive access.</span></span> <span data-ttu-id="5e534-106">En outre, le descripteur de fichier doit rester ouvert jusqu’à ce que le processus n’ait plus besoin de l’objet de mappage de fichier.</span><span class="sxs-lookup"><span data-stu-id="5e534-106">In addition, the file handle should remain open until the process no longer needs the file mapping object.</span></span> <span data-ttu-id="5e534-107">Un moyen simple d’obtenir un accès exclusif consiste à spécifier zéro dans le paramètre *fdwShareMode* de **CreateFile**.</span><span class="sxs-lookup"><span data-stu-id="5e534-107">An easy way to obtain exclusive access is to specify zero in the *fdwShareMode* parameter of **CreateFile**.</span></span> <span data-ttu-id="5e534-108">Le handle retourné par **CreateFile** est utilisé par la fonction [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) pour créer un objet de mappage de fichier.</span><span class="sxs-lookup"><span data-stu-id="5e534-108">The handle returned by **CreateFile** is used by the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function to create a file mapping object.</span></span>

<span data-ttu-id="5e534-109">La fonction [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) retourne un handle vers l’objet de mappage de fichier.</span><span class="sxs-lookup"><span data-stu-id="5e534-109">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function returns a handle to the file mapping object.</span></span> <span data-ttu-id="5e534-110">Ce descripteur sera utilisé lors [de la création d’une vue de fichier](creating-a-file-view.md) afin que vous puissiez accéder à la mémoire partagée.</span><span class="sxs-lookup"><span data-stu-id="5e534-110">This handle will be used when [creating a file view](creating-a-file-view.md) so that you can access the shared memory.</span></span> <span data-ttu-id="5e534-111">Quand vous appelez **CreateFileMapping**, vous spécifiez un nom d’objet, le nombre d’octets à mapper à partir du fichier et l’autorisation de lecture/écriture pour la mémoire mappée.</span><span class="sxs-lookup"><span data-stu-id="5e534-111">When you call **CreateFileMapping**, you specify an object name, the number of bytes to be mapped from the file, and the read/write permission for the mapped memory.</span></span> <span data-ttu-id="5e534-112">Le premier processus qui appelle **CreateFileMapping** crée l’objet de mappage de fichier.</span><span class="sxs-lookup"><span data-stu-id="5e534-112">The first process that calls **CreateFileMapping** creates the file mapping object.</span></span> <span data-ttu-id="5e534-113">Les processus qui appellent **CreateFileMapping** pour un objet existant reçoivent un handle vers l’objet existant.</span><span class="sxs-lookup"><span data-stu-id="5e534-113">Processes calling **CreateFileMapping** for an existing object receive a handle to the existing object.</span></span> <span data-ttu-id="5e534-114">Vous pouvez savoir si un appel réussi à **CreateFileMapping** a créé ou ouvert l’objet de mappage de fichier en appelant la fonction [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) .</span><span class="sxs-lookup"><span data-stu-id="5e534-114">You can tell whether or not a successful call to **CreateFileMapping** created or opened the file mapping object by calling the [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span> <span data-ttu-id="5e534-115">**GetLastError** **ne retourne aucune \_ erreur** au processus de création et l' **erreur \_ \_ existe déjà** pour les processus suivants.</span><span class="sxs-lookup"><span data-stu-id="5e534-115">**GetLastError** returns **NO\_ERROR** to the creating process and **ERROR\_ALREADY\_EXISTS** to subsequent processes.</span></span>

<span data-ttu-id="5e534-116">La fonction [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) échoue si les indicateurs d’accès sont en conflit avec ceux spécifiés lors de l’ouverture du fichier par la fonction [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="5e534-116">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function fails if the access flags conflict with those specified when the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function opened the file.</span></span> <span data-ttu-id="5e534-117">Par exemple, pour lire et écrire dans le fichier :</span><span class="sxs-lookup"><span data-stu-id="5e534-117">For example, to read and write to the file:</span></span>

-   <span data-ttu-id="5e534-118">Spécifiez les valeurs d' **\_ écriture** génériques **\_ en lecture** et générique dans le paramètre *fdwAccess* de [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="5e534-118">Specify the **GENERIC\_READ** and **GENERIC\_WRITE** values in the *fdwAccess* parameter of [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span></span>
-   <span data-ttu-id="5e534-119">Spécifiez la valeur **\_ ReadWrite de page** dans le paramètre *fdwProtect* de [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span><span class="sxs-lookup"><span data-stu-id="5e534-119">Specify the **PAGE\_READWRITE** value in the *fdwProtect* parameter of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span></span>

<span data-ttu-id="5e534-120">La création d’un objet de mappage de fichier ne valide pas la mémoire physique, il la réserve uniquement.</span><span class="sxs-lookup"><span data-stu-id="5e534-120">Creating a file mapping object does not commit physical memory, it only reserves it.</span></span>

## <a name="file-mapping-size"></a><span data-ttu-id="5e534-121">Taille du mappage de fichier</span><span class="sxs-lookup"><span data-stu-id="5e534-121">File Mapping Size</span></span>

<span data-ttu-id="5e534-122">La taille de l’objet de mappage de fichier est indépendante de la taille du fichier mappé.</span><span class="sxs-lookup"><span data-stu-id="5e534-122">The size of the file mapping object is independent of the size of the file being mapped.</span></span> <span data-ttu-id="5e534-123">Toutefois, si l’objet de mappage de fichier est plus grand que le fichier, le système développe le fichier avant que [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) ne retourne.</span><span class="sxs-lookup"><span data-stu-id="5e534-123">However, if the file mapping object is larger than the file, the system expands the file before [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) returns.</span></span> <span data-ttu-id="5e534-124">Si l’objet de mappage de fichier est plus petit que le fichier, le système mappe uniquement le nombre spécifié d’octets à partir du fichier.</span><span class="sxs-lookup"><span data-stu-id="5e534-124">If the file mapping object is smaller than the file, the system maps only the specified number of bytes from the file.</span></span>

<span data-ttu-id="5e534-125">Les paramètres *dwMaximumSizeHigh* et *dwMaximumSizeLow* de [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) vous permettent de spécifier le nombre d’octets à mapper à partir du fichier :</span><span class="sxs-lookup"><span data-stu-id="5e534-125">The *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) allow you to specify the number of bytes to be mapped from the file:</span></span>

-   <span data-ttu-id="5e534-126">Si vous ne souhaitez pas que la taille du fichier change (par exemple, lors du mappage de fichiers en lecture seule), appelez [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) et spécifiez zéro pour *dwMaximumSizeHigh* et *dwMaximumSizeLow*.</span><span class="sxs-lookup"><span data-stu-id="5e534-126">When you do not want the size of the file to change (for example, when mapping read-only files), call [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) and specify zero for both *dwMaximumSizeHigh* and *dwMaximumSizeLow*.</span></span> <span data-ttu-id="5e534-127">Cela crée un objet de mappage de fichier qui a exactement la même taille que le fichier.</span><span class="sxs-lookup"><span data-stu-id="5e534-127">Doing this creates a file mapping object that is exactly the same size as the file.</span></span> <span data-ttu-id="5e534-128">Dans le cas contraire, vous devez calculer ou estimer la taille du fichier fini, car la taille des objets de mappage de fichier est statique. une fois créé, leur taille ne peut pas être augmentée ou diminuée.</span><span class="sxs-lookup"><span data-stu-id="5e534-128">Otherwise, you must calculate or estimate the size of the finished file because file mapping objects are static in size; once created, their size cannot be increased or decreased.</span></span> <span data-ttu-id="5e534-129">Une tentative de mappage d’un fichier avec une longueur de zéro de cette manière échoue avec un code d’erreur de **fichier d’erreur \_ \_ non valide**.</span><span class="sxs-lookup"><span data-stu-id="5e534-129">An attempt to map a file with a length of zero in this manner fails with an error code of **ERROR\_FILE\_INVALID**.</span></span> <span data-ttu-id="5e534-130">Les programmes doivent tester les fichiers dont la longueur est égale à zéro et rejeter ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="5e534-130">Programs should test for files with a length of zero and reject such files.</span></span>

-   <span data-ttu-id="5e534-131">La taille d’un objet de mappage de fichier qui est stocké par un fichier nommé est limitée par l’espace disque.</span><span class="sxs-lookup"><span data-stu-id="5e534-131">The size of a file mapping object that is backed by a named file is limited by disk space.</span></span> <span data-ttu-id="5e534-132">La taille d’une vue de fichier est limitée au plus grand bloc contigu disponible de mémoire virtuelle non réservée.</span><span class="sxs-lookup"><span data-stu-id="5e534-132">The size of a file view is limited to the largest available contiguous block of unreserved virtual memory.</span></span> <span data-ttu-id="5e534-133">Il se trouve au maximum de 2 Go moins la mémoire virtuelle déjà réservée par le processus.</span><span class="sxs-lookup"><span data-stu-id="5e534-133">This is at most 2 GB minus the virtual memory already reserved by the process.</span></span>

<span data-ttu-id="5e534-134">La taille de l’objet de mappage de fichier que vous sélectionnez contrôle à quelle distance dans le fichier vous pouvez « voir » le mappage de mémoire.</span><span class="sxs-lookup"><span data-stu-id="5e534-134">The size of the file mapping object that you select controls how far into the file you can "see" with memory mapping.</span></span> <span data-ttu-id="5e534-135">Si vous créez un objet de mappage de fichier dont la taille est de 500 Ko, vous avez accès uniquement aux 500 premiers Ko du fichier, quelle que soit la taille du fichier.</span><span class="sxs-lookup"><span data-stu-id="5e534-135">If you create a file mapping object that is 500 Kb in size, you have access only to the first 500 Kb of the file, regardless of the size of the file.</span></span> <span data-ttu-id="5e534-136">Étant donné qu’il ne coûte aucune ressource système pour créer un objet de mappage de fichier plus volumineux, créez un objet de mappage de fichier qui correspond à la taille du fichier (définissez les paramètres *dwMaximumSizeHigh* et *dwMaximumSizeLow* de [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) à la fois sur zéro) même si vous ne prévoyez pas d’afficher l’intégralité du fichier.</span><span class="sxs-lookup"><span data-stu-id="5e534-136">Since it does not cost you any system resources to create a larger file mapping object, create a file mapping object that is the size of the file (set the *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) both to zero) even if you do not expect to view the entire file.</span></span> <span data-ttu-id="5e534-137">Le coût des ressources système est lié à la création des vues et à leur accès.</span><span class="sxs-lookup"><span data-stu-id="5e534-137">The cost in system resources comes in creating the views and accessing them.</span></span>

<span data-ttu-id="5e534-138">Vous pouvez afficher une partie du fichier qui ne commence pas au début du fichier.</span><span class="sxs-lookup"><span data-stu-id="5e534-138">You can view a portion of the file that does not start at the beginning of the file.</span></span> <span data-ttu-id="5e534-139">Pour plus d’informations, consultez [création d’une vue dans un fichier](creating-a-view-within-a-file.md).</span><span class="sxs-lookup"><span data-stu-id="5e534-139">For more information, see [Creating a View Within a File](creating-a-view-within-a-file.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="5e534-140">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="5e534-140">Related topics</span></span>

<dl> <dt>
  
[<span data-ttu-id="5e534-141">Création d’un affichage des fichiers</span><span class="sxs-lookup"><span data-stu-id="5e534-141">Creating a File View</span></span>](creating-a-file-view.md)
</dt> <dt>

[<span data-ttu-id="5e534-142">Création d’une vue dans un fichier</span><span class="sxs-lookup"><span data-stu-id="5e534-142">Creating a View Within a File</span></span>](creating-a-view-within-a-file.md)
</dt> </dl>


 
