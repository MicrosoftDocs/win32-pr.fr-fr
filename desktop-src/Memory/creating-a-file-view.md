---
description: Pour mapper les données d’un fichier à la mémoire virtuelle d’un processus, vous devez créer une vue du fichier.
ms.assetid: b1ebd9a4-cde4-4c0c-80d2-5ccb655cd3a4
title: Création d’un affichage des fichiers
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 498f7ba132efd9ecf82f9ec087492c9622824b51
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103951917"
---
# <a name="creating-a-file-view"></a><span data-ttu-id="0a605-103">Création d’un affichage des fichiers</span><span class="sxs-lookup"><span data-stu-id="0a605-103">Creating a File View</span></span>

<span data-ttu-id="0a605-104">Pour mapper les données d’un fichier à la mémoire virtuelle d’un processus, vous devez créer une vue du fichier.</span><span class="sxs-lookup"><span data-stu-id="0a605-104">To map the data from a file to the virtual memory of a process, you must create a view of the file.</span></span> <span data-ttu-id="0a605-105">Les fonctions [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) et [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) utilisent le descripteur d’objet de mappage de fichier retourné par [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) pour créer une vue du fichier ou une partie du fichier dans l’espace d’adressage virtuel du processus.</span><span class="sxs-lookup"><span data-stu-id="0a605-105">The [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) and [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) functions use the file mapping object handle returned by [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) to create a view of the file or a portion of the file in the process's virtual address space.</span></span> <span data-ttu-id="0a605-106">Ces fonctions échouent si les indicateurs d’accès sont en conflit avec ceux spécifiés lorsque **CreateFileMapping** a créé l’objet de mappage de fichier.</span><span class="sxs-lookup"><span data-stu-id="0a605-106">These functions fail if the access flags conflict with those specified when **CreateFileMapping** created the file mapping object.</span></span>

<span data-ttu-id="0a605-107">La fonction [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) retourne un pointeur vers l’affichage des fichiers.</span><span class="sxs-lookup"><span data-stu-id="0a605-107">The [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) function returns a pointer to the file view.</span></span> <span data-ttu-id="0a605-108">En déréférençant un pointeur dans la plage d’adresses spécifiée dans **MapViewOfFile**, une application peut lire des données à partir du fichier et écrire des données dans le fichier.</span><span class="sxs-lookup"><span data-stu-id="0a605-108">By dereferencing a pointer in the range of addresses specified in **MapViewOfFile**, an application can read data from the file and write data to the file.</span></span> <span data-ttu-id="0a605-109">L’écriture dans l’affichage des fichiers entraîne des modifications de l’objet de mappage de fichier.</span><span class="sxs-lookup"><span data-stu-id="0a605-109">Writing to the file view results in changes to the file mapping object.</span></span> <span data-ttu-id="0a605-110">L’écriture réelle dans le fichier sur le disque est gérée par le système.</span><span class="sxs-lookup"><span data-stu-id="0a605-110">The actual writing to the file on disk is handled by the system.</span></span> <span data-ttu-id="0a605-111">Les données ne sont pas réellement transférées au moment où l’objet de mappage de fichier est écrit.</span><span class="sxs-lookup"><span data-stu-id="0a605-111">Data is not actually transferred at the time the file mapping object is written to.</span></span> <span data-ttu-id="0a605-112">Au lieu de cela, une grande partie de l’entrée et de la sortie du fichier (e/s) est mise en cache pour améliorer les performances générales du système.</span><span class="sxs-lookup"><span data-stu-id="0a605-112">Instead, much of the file input and output (I/O) is cached to improve general system performance.</span></span> <span data-ttu-id="0a605-113">Les applications peuvent remplacer ce comportement en appelant la fonction [**FlushViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) pour forcer le système à effectuer immédiatement des transactions sur disque.</span><span class="sxs-lookup"><span data-stu-id="0a605-113">Applications can override this behavior by calling the [**FlushViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) function to force the system to perform disk transactions immediately.</span></span>

<span data-ttu-id="0a605-114">La fonction [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) fonctionne exactement comme la fonction [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) , à ceci près qu’elle permet à un processus de spécifier l’adresse de base de la vue du fichier dans l’espace d’adressage virtuel du processus dans le paramètre *lpvBase* .</span><span class="sxs-lookup"><span data-stu-id="0a605-114">The [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) function works exactly like the [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) function except that it allows a process to specify the base address of the view of the file in the process's virtual address space in the *lpvBase* parameter.</span></span> <span data-ttu-id="0a605-115">S’il n’y a pas assez d’espace à l’adresse spécifiée, l’appel échoue.</span><span class="sxs-lookup"><span data-stu-id="0a605-115">If there is not enough space at the specified address, the call fails.</span></span> <span data-ttu-id="0a605-116">Par conséquent, si vous devez mapper un fichier à la même adresse dans plusieurs processus, les processus doivent négocier une adresse appropriée : le paramètre *lpvBase* doit être un multiple entier de la granularité d’allocation de mémoire système ou l’appel échoue.</span><span class="sxs-lookup"><span data-stu-id="0a605-116">Therefore, if you must map a file to the same address in multiple processes, the processes should negotiate an appropriate address: The *lpvBase* parameter must be an integral multiple of the system memory allocation granularity or the call fails.</span></span> <span data-ttu-id="0a605-117">Pour obtenir la granularité d’allocation de mémoire du système, utilisez la fonction [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) , qui remplit les membres d’une structure d' [**\_ informations système**](/windows/win32/api/sysinfoapi/ns-sysinfoapi-system_info) .</span><span class="sxs-lookup"><span data-stu-id="0a605-117">To obtain the system's memory allocation granularity, use the [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) function, which fills in the members of a [**SYSTEM\_INFO**](/windows/win32/api/sysinfoapi/ns-sysinfoapi-system_info) structure.</span></span>

<span data-ttu-id="0a605-118">Une application peut créer plusieurs vues de fichiers à partir du même objet de mappage de fichier.</span><span class="sxs-lookup"><span data-stu-id="0a605-118">An application can create multiple file views from the same file mapping object.</span></span> <span data-ttu-id="0a605-119">Une vue de fichier peut avoir une taille différente de celle de l’objet de mappage de fichier dont elle est dérivée, mais elle doit être inférieure à l’objet de mappage de fichier.</span><span class="sxs-lookup"><span data-stu-id="0a605-119">A file view can be a different size than the file mapping object from which it is derived, but it must be smaller than the file mapping object.</span></span> <span data-ttu-id="0a605-120">Le décalage spécifié par les paramètres *dwOffsetHigh* et *dwOffsetLow* de [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) doit être un multiple de la granularité d’allocation du système.</span><span class="sxs-lookup"><span data-stu-id="0a605-120">The offset specified by the *dwOffsetHigh* and *dwOffsetLow* parameters of [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) must be a multiple of the allocation granularity of the system.</span></span>

## <a name="related-topics"></a><span data-ttu-id="0a605-121">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="0a605-121">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0a605-122">Création d’une vue dans un fichier</span><span class="sxs-lookup"><span data-stu-id="0a605-122">Creating a View Within a File</span></span>](creating-a-view-within-a-file.md)
</dt> </dl>

 

 
