---
description: L’infrastructure homologue utilise des événements pour informer les applications des modifications qui se sont produites au sein d’un réseau pair à pair, par exemple un nœud ajouté ou supprimé dans un graphique.
ms.assetid: a056da1c-b8f9-4dad-8df9-df24c6b359b7
title: Infrastructure des événements homologues
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6347ad6a7dd0cf2fae4a0aa623bfda48ab0aa9f8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106531951"
---
# <a name="peer-events-infrastructure"></a><span data-ttu-id="c2672-103">Infrastructure des événements homologues</span><span class="sxs-lookup"><span data-stu-id="c2672-103">Peer Events Infrastructure</span></span>

<span data-ttu-id="c2672-104">L’infrastructure homologue utilise des événements pour informer les applications des modifications qui se sont produites au sein d’un réseau pair à pair, par exemple un nœud ajouté ou supprimé dans un graphique.</span><span class="sxs-lookup"><span data-stu-id="c2672-104">The Peer Infrastructure uses events to notify applications of changes that have occurred within a peer network, for example, a node that is added or removed from a graph.</span></span> <span data-ttu-id="c2672-105">Les infrastructures de représentation graphique et de regroupement d’homologues utilisent l’infrastructure des événements homologues.</span><span class="sxs-lookup"><span data-stu-id="c2672-105">The Peer Graphing and Peer Grouping Infrastructures use the peer events infrastructure.</span></span>

## <a name="receiving-peer-event-notification"></a><span data-ttu-id="c2672-106">Réception d’une notification d’événement homologue</span><span class="sxs-lookup"><span data-stu-id="c2672-106">Receiving Peer Event Notification</span></span>

<span data-ttu-id="c2672-107">Un homologue peut s’inscrire pour recevoir une notification lorsqu’un attribut d’un graphique ou d’un groupe est modifié ou qu’un événement homologue spécifique se produit.</span><span class="sxs-lookup"><span data-stu-id="c2672-107">A peer can register to receive notification when an attribute of a graph or group changes, or a specific peer event occurs.</span></span> <span data-ttu-id="c2672-108">Une application homologue appelle la fonction [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent) ou [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent) et passe un handle d’événement à l’infrastructure homologue, créée précédemment par un appel à [**CreateEvent**](graphing-reference-links.md).</span><span class="sxs-lookup"><span data-stu-id="c2672-108">A peer application calls the [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent) or [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent) function, and passes an event handle to the Peer Infrastructure, which is created previously by a call to [**CreateEvent**](graphing-reference-links.md).</span></span> <span data-ttu-id="c2672-109">L’infrastructure homologue utilise le descripteur pour signaler à une application qu’un événement homologue s’est produit.</span><span class="sxs-lookup"><span data-stu-id="c2672-109">The Peer Infrastructure uses the handle to signal an application that a peer event has occurred.</span></span>

<span data-ttu-id="c2672-110">L’application passe également une série d' [**\_ \_ \_ inscriptions d’événements de graphiques homologues**](/windows/desktop/api/P2P/ns-p2p-peer_graph_event_registration) ou de structures d' [**inscription d' \_ événements de groupe \_ \_ homologue**](/windows/desktop/api/P2P/ns-p2p-peer_group_event_registration) qui indiquent à l’infrastructure homologue les événements homologues spécifiques pour lesquels l’application demande une notification.</span><span class="sxs-lookup"><span data-stu-id="c2672-110">The application also passes a series of [**PEER\_GRAPH\_EVENT\_REGISTRATION**](/windows/desktop/api/P2P/ns-p2p-peer_graph_event_registration) or [**PEER\_GROUP\_EVENT\_REGISTRATION**](/windows/desktop/api/P2P/ns-p2p-peer_group_event_registration) structures that indicate to the Peer Infrastructure the specific peer events for which the application is requesting notification.</span></span> <span data-ttu-id="c2672-111">L’application doit également spécifier exactement le nombre de structures passées.</span><span class="sxs-lookup"><span data-stu-id="c2672-111">The application must also specify exactly how many structures are being passed.</span></span>

## <a name="peer-graphing-events"></a><span data-ttu-id="c2672-112">Événements de représentation graphique d’homologue</span><span class="sxs-lookup"><span data-stu-id="c2672-112">Peer Graphing Events</span></span>

<span data-ttu-id="c2672-113">Une application de représentation graphique des homologues peut s’inscrire pour recevoir une notification pour 9 événements de graphique homologue.</span><span class="sxs-lookup"><span data-stu-id="c2672-113">A Peer Graphing application can register to receive notification for 9 peer graph events.</span></span> <span data-ttu-id="c2672-114">Chaque nom d’événement est précédé d’un **\_ \_ \_ événement de graphique homologue**, par exemple, l’état du graphique de l' **homologue \_ \_ \_ a changé**.</span><span class="sxs-lookup"><span data-stu-id="c2672-114">Each event name is prefaced with **PEER\_GRAPH\_EVENT\_**, for example, **PEER\_GRAPH\_STATUS\_CHANGED**.</span></span> <span data-ttu-id="c2672-115">Sauf indication contraire, les informations relatives à une modification sont récupérées à l’aide de [**PeerGraphGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata).</span><span class="sxs-lookup"><span data-stu-id="c2672-115">Unless otherwise noted, information about a change is retrieved by using [**PeerGraphGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata).</span></span>

-   <span data-ttu-id="c2672-116">**Homologue \_ L' \_ État de l’événement Graph \_ \_ Changed** indique que l’état d’un graphique a été modifié, par exemple, un nœud a été synchronisé avec un graphique.</span><span class="sxs-lookup"><span data-stu-id="c2672-116">**PEER\_GRAPH\_EVENT\_STATUS\_CHANGED** indicates that the status of a graph is changed, for example, a node has synchronized with a graph.</span></span>
-   <span data-ttu-id="c2672-117">**Homologue \_ La \_ propriété de l’événement Graph \_ \_ Changed** indique qu’une propriété d’un graphique ou d’un groupe a été modifiée, par exemple, le nom convivial d’un graphique a changé.</span><span class="sxs-lookup"><span data-stu-id="c2672-117">**PEER\_GRAPH\_EVENT\_PROPERTY\_CHANGED** indicates that a property of a graph or group is changed, for example, the friendly name of a graph has changed.</span></span>
    > [!Note]  
    > <span data-ttu-id="c2672-118">L’application doit appeler [**PeerGraphGetProperties**](/windows/desktop/api/P2P/nf-p2p-peergraphgetproperties) pour obtenir les informations modifiées.</span><span class="sxs-lookup"><span data-stu-id="c2672-118">The application must call [**PeerGraphGetProperties**](/windows/desktop/api/P2P/nf-p2p-peergraphgetproperties) to obtain the changed information.</span></span>

     

-   <span data-ttu-id="c2672-119">**Homologue \_ Enregistrement d’événement de graphique \_ \_ \_ modifié** indique qu’un enregistrement a été modifié, par exemple, un enregistrement est supprimé.</span><span class="sxs-lookup"><span data-stu-id="c2672-119">**PEER\_GRAPH\_EVENT\_RECORD\_CHANGED** indicates that a record is changed, for example, a record is deleted.</span></span>
-   <span data-ttu-id="c2672-120">**Homologue \_ La \_ \_ \_ connexion directe d’événement de graphique** indique qu’une connexion directe a été modifiée, par exemple, un nœud est connecté.</span><span class="sxs-lookup"><span data-stu-id="c2672-120">**PEER\_GRAPH\_EVENT\_DIRECT\_CONNECTION** indicates that a direct connection is changed, for example, a node has connected.</span></span>
-   <span data-ttu-id="c2672-121">**Homologue \_ La \_ \_ \_ connexion du voisin de l’événement Graph** indique qu’une connexion à un nœud voisin a été modifiée, par exemple, un nœud est connecté.</span><span class="sxs-lookup"><span data-stu-id="c2672-121">**PEER\_GRAPH\_EVENT\_NEIGHBOR\_CONNECTION** indicates that a connection to a neighbor node is changed, for example, a node has connected.</span></span>
-   <span data-ttu-id="c2672-122">**Homologue \_ Les \_ \_ \_ données entrantes de l’événement Graph** indiquent que des données ont été reçues d’une connexion directe ou voisine.</span><span class="sxs-lookup"><span data-stu-id="c2672-122">**PEER\_GRAPH\_EVENT\_INCOMING\_DATA** indicates that data has been received from a direct or neighbor connection.</span></span>
-   <span data-ttu-id="c2672-123">**Homologue \_ L' \_ événement Graph \_ Connection \_ Required** indique que l’infrastructure de création de graphiques requiert une nouvelle connexion.</span><span class="sxs-lookup"><span data-stu-id="c2672-123">**PEER\_GRAPH\_EVENT\_CONNECTION\_REQUIRED** indicates that the Graphing Infrastructure requires a new connection.</span></span>
    > [!Note]  
    > <span data-ttu-id="c2672-124">Un appel à [**PeerGraphConnect**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) se connecte à un nouveau nœud.</span><span class="sxs-lookup"><span data-stu-id="c2672-124">A call to [**PeerGraphConnect**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) connects to a new node.</span></span> <span data-ttu-id="c2672-125">Un appel à [**PeerGraphGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata) ne retourne pas de données.</span><span class="sxs-lookup"><span data-stu-id="c2672-125">A call to [**PeerGraphGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata) does not return data.</span></span>

     

-   <span data-ttu-id="c2672-126">**Homologue \_ Le \_ nœud d’événement Graph \_ \_ Changed** indique que les informations de présence du nœud ont été modifiées, par exemple, une adresse IP a changé.</span><span class="sxs-lookup"><span data-stu-id="c2672-126">**PEER\_GRAPH\_EVENT\_NODE\_CHANGED** indicates that node presence information is changed, for example, an IP address has changed.</span></span>
-   <span data-ttu-id="c2672-127">**Homologue \_ L' \_ événement \_ de graphique synchronisé** indique qu’un type d’enregistrement spécifique est synchronisé.</span><span class="sxs-lookup"><span data-stu-id="c2672-127">**PEER\_GRAPH\_EVENT\_SYNCHRONIZED** indicates that a specific record type is synchronized.</span></span>

<span data-ttu-id="c2672-128">Une fois qu’une application a reçu une notification indiquant qu’un événement homologue s’est produit, l’application appelle [**PeerGraphGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata)et passe le handle d’événement homologue retourné par [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).</span><span class="sxs-lookup"><span data-stu-id="c2672-128">After an application receives notification that a peer event has occurred, the application calls [**PeerGraphGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata), and passes the peer event handle returned by [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).</span></span> <span data-ttu-id="c2672-129">L’infrastructure homologue retourne un pointeur vers une structure de [**\_ données d' \_ événement \_ de graphique homologue**](/windows/desktop/api/P2P/ns-p2p-peer_graph_event_data) qui contient les données demandées.</span><span class="sxs-lookup"><span data-stu-id="c2672-129">The Peer Infrastructure returns a pointer to a [**PEER\_GRAPH\_EVENT\_DATA**](/windows/desktop/api/P2P/ns-p2p-peer_graph_event_data) structure that contains the requested data.</span></span> <span data-ttu-id="c2672-130">Cette fonction doit être appelée jusqu’à ce qu' **\_ \_ aucune \_ \_ donnée d’événement** ne soit retournée.</span><span class="sxs-lookup"><span data-stu-id="c2672-130">This function should be called until **PEER\_S\_NO\_EVENT\_DATA** is returned.</span></span>

<span data-ttu-id="c2672-131">Une fois qu’une application n’a pas besoin d’une notification d’événement homologue, l’application appelle [**PeerGraphUnregisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphunregisterevent)et passe le handle d’événement homologue retourné par [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent) lorsque l’application est inscrite.</span><span class="sxs-lookup"><span data-stu-id="c2672-131">After an application does not require a peer event notification, the application calls either [**PeerGraphUnregisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphunregisterevent), and passes the peer event handle returned by [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent) when the application registered.</span></span>

## <a name="handling-graph-connection-referrals"></a><span data-ttu-id="c2672-132">Gestion des références de connexion au graphique</span><span class="sxs-lookup"><span data-stu-id="c2672-132">Handling Graph Connection Referrals</span></span>

<span data-ttu-id="c2672-133">Quand [**PeerGraphConnect**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) est appelé, l’homologue qui se connecte est averti de la réussite ou de l’échec par le biais de l’événement de **\_ \_ \_ \_ connexion voisine de l’événement de graphique homologue** asynchrone.</span><span class="sxs-lookup"><span data-stu-id="c2672-133">When [**PeerGraphConnect**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) is called, the connecting peer is notified of success or failure through the asynchronous **PEER\_GRAPH\_EVENT\_NEIGHBOR\_CONNECTION** event.</span></span> <span data-ttu-id="c2672-134">Si la connexion a échoué en raison de problèmes de mise en réseau spécifiques (par exemple, un pare-feu mal configuré), l’événement de **\_ \_ \_ \_ connexion voisine de l’événement du graphique homologue** est déclenché, avec l’état de la connexion défini sur **connexion d’égal \_ \_ échec**.</span><span class="sxs-lookup"><span data-stu-id="c2672-134">If the connection failed due to a specific networking issues (such as a misconfigured firewall), the **PEER\_GRAPH\_EVENT\_NEIGHBOR\_CONNECTION** event is raised, with the connection status set to **PEER\_CONNECTION\_FAILED**.</span></span>

<span data-ttu-id="c2672-135">Toutefois, lorsqu’un homologue reçoit une référence lorsqu’il tente de se connecter à un nœud occupé, la **\_ \_ \_ \_ connexion voisine de l’événement du graphique homologue** est déclenchée sur l’homologue qui se connecte, l’état de la connexion ayant la valeur **\_ \_ échec** de la connexion.</span><span class="sxs-lookup"><span data-stu-id="c2672-135">However, when a peer receives a referral when it attempts to connect to a busy node, the **PEER\_GRAPH\_EVENT\_NEIGHBOR\_CONNECTION** is raised on the connecting peer, with the connection status set to **PEER\_CONNECTION\_FAILED**.</span></span> <span data-ttu-id="c2672-136">L’homologue qui se connecte peut être référencé par un autre nœud qui est occupé et peut envoyer une référence, et le même événement et le même État sont déclenchés sur l’homologue qui se connecte.</span><span class="sxs-lookup"><span data-stu-id="c2672-136">The connecting peer may be referred to another node which itself is busy and may send a referral, and the same event and status are raised on the connecting peer.</span></span> <span data-ttu-id="c2672-137">Cette chaîne de références entraînant l’échec de la **\_ connexion \_ homologue** les États des événements peuvent se poursuivre jusqu’à épuisement du nombre maximal de tentatives de connexion.</span><span class="sxs-lookup"><span data-stu-id="c2672-137">This chain of referrals that result in **PEER\_CONNECTION\_FAILED** event statuses can continue until the maximum number of connection attempts has been exhausted.</span></span> <span data-ttu-id="c2672-138">L’homologue n’a pas de mécanisme permettant de déterminer la différence entre une tentative de connexion complète et la référence de connexion.</span><span class="sxs-lookup"><span data-stu-id="c2672-138">The peer does not have a mechanism to determine the difference between a full connection attempt and the connection referral.</span></span>

<span data-ttu-id="c2672-139">Pour résoudre ce problème, les développeurs doivent envisager d’utiliser les événements de changement d’État du graphique des homologues pour déterminer si la tentative de connexion a réussi.</span><span class="sxs-lookup"><span data-stu-id="c2672-139">To address this issue, developers should consider using the peer graph status change events to determine if the connection attempt suceeded.</span></span> <span data-ttu-id="c2672-140">Si l’événement n’est pas reçu dans un intervalle de temps spécifique, l’application peut supposer que l’homologue qui se connecte est référencé et que l’application homologue doit considérer la tentative de connexion comme une défaillance.</span><span class="sxs-lookup"><span data-stu-id="c2672-140">If the event is not received within a specific amount of time, the application can assume that the connecting peer is being referred and that the peer application should consider the connection attempt a failure.</span></span>

## <a name="peer-grouping-events"></a><span data-ttu-id="c2672-141">Événements de regroupement d’homologues</span><span class="sxs-lookup"><span data-stu-id="c2672-141">Peer Grouping Events</span></span>

<span data-ttu-id="c2672-142">Une application de regroupement pair peut s’inscrire pour recevoir une notification pour 8 événements homologues.</span><span class="sxs-lookup"><span data-stu-id="c2672-142">A Peer Grouping application can register to receive notification for 8 peer events.</span></span> <span data-ttu-id="c2672-143">Chaque nom d’événement est précédé d’un **\_ \_ événement \_ de groupe homologue**, par exemple, l’état de l' **événement du groupe homologue \_ \_ \_ \_ a été modifié**.</span><span class="sxs-lookup"><span data-stu-id="c2672-143">Each event name is prefaced with **PEER\_GROUP\_EVENT\_**; for example, **PEER\_GROUP\_EVENT\_STATUS\_CHANGED**.</span></span> <span data-ttu-id="c2672-144">Sauf indication contraire, les informations relatives à une modification sont récupérées à l’aide de [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span><span class="sxs-lookup"><span data-stu-id="c2672-144">Unless otherwise noted, information about a change is retrieved by using [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span></span>

-   <span data-ttu-id="c2672-145">**Homologue \_ État de l’événement de groupe \_ \_ \_ modifié** indique que l’état du groupe a changé.</span><span class="sxs-lookup"><span data-stu-id="c2672-145">**PEER\_GROUP\_EVENT\_STATUS\_CHANGED** indicates that the group status has changed.</span></span> <span data-ttu-id="c2672-146">Il existe deux valeurs d’État possibles : l' **État du groupe homologue est à l' \_ \_ \_ écoute**, ce qui indique que le groupe n’a pas de connexion et qu’il attend de nouveaux membres et que l' **État du groupe homologue \_ a des \_ \_ connexions**, ce qui indique que le groupe a au moins une connexion.</span><span class="sxs-lookup"><span data-stu-id="c2672-146">There are two status values possible: **PEER\_GROUP\_STATUS\_LISTENING**, which indicates that the group has no connections and is waiting for new members; and **PEER\_GROUP\_STATUS\_HAS CONNECTIONS**, which indicates that the group has at least one connection.</span></span> <span data-ttu-id="c2672-147">Cette valeur d’État peut être obtenue en appelant [**PeerGroupGetStatus**](/windows/desktop/api/P2P/nf-p2p-peergroupgetstatus) après le déclenchement de cet événement.</span><span class="sxs-lookup"><span data-stu-id="c2672-147">This status value can be obtained by calling [**PeerGroupGetStatus**](/windows/desktop/api/P2P/nf-p2p-peergroupgetstatus) after this event is raised.</span></span>
-   <span data-ttu-id="c2672-148">**Homologue \_ La \_ propriété d’événement de groupe \_ \_ Changed** indique que les propriétés de groupe ont été modifiées ou mises à jour par le créateur du groupe.</span><span class="sxs-lookup"><span data-stu-id="c2672-148">**PEER\_GROUP\_EVENT\_PROPERTY\_CHANGED** indicates that the group properties have been changed or updated by the group creator.</span></span>
-   <span data-ttu-id="c2672-149">**Homologue \_ Enregistrement d’événement de groupe \_ \_ \_ modifié** indique qu’une opération d’enregistrement a été effectuée.</span><span class="sxs-lookup"><span data-stu-id="c2672-149">**PEER\_GROUP\_EVENT\_RECORD\_CHANGED** indicates that a record operation has been performed.</span></span> <span data-ttu-id="c2672-150">Cet événement est déclenché lorsqu’un homologue participant au groupe publie, met à jour ou supprime un enregistrement.</span><span class="sxs-lookup"><span data-stu-id="c2672-150">This event is raised when a peer participating in the group publishes, updates, or deletes a record.</span></span> <span data-ttu-id="c2672-151">Par exemple, cet événement est déclenché lorsqu’une application chat envoie un message de conversation.</span><span class="sxs-lookup"><span data-stu-id="c2672-151">For example, this event is raised when a chat application sends a chat message.</span></span>
-   <span data-ttu-id="c2672-152">**Homologue \_ Le \_ membre d’événement de groupe \_ \_ Changed** indique que l’état d’un membre dans le groupe a changé.</span><span class="sxs-lookup"><span data-stu-id="c2672-152">**PEER\_GROUP\_EVENT\_MEMBER\_CHANGED** indicates that a member's status within the group has changed.</span></span> <span data-ttu-id="c2672-153">Les changements d’État sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="c2672-153">Status changes include:</span></span>
    -   <span data-ttu-id="c2672-154">**Homologue \_ MEMBRE \_ connecté**.</span><span class="sxs-lookup"><span data-stu-id="c2672-154">**PEER\_MEMBER\_CONNECTED**.</span></span> <span data-ttu-id="c2672-155">Un homologue s’est connecté au groupe.</span><span class="sxs-lookup"><span data-stu-id="c2672-155">A peer has connected to the group.</span></span>
    -   <span data-ttu-id="c2672-156">**Homologue \_ MEMBRE \_ déconnecté**.</span><span class="sxs-lookup"><span data-stu-id="c2672-156">**PEER\_MEMBER\_DISCONNECTED**.</span></span> <span data-ttu-id="c2672-157">Un homologue s’est déconnecté du groupe.</span><span class="sxs-lookup"><span data-stu-id="c2672-157">A peer has disconnected from the group.</span></span>
    -   <span data-ttu-id="c2672-158">**Homologue \_ MEMBRE \_ joint**.</span><span class="sxs-lookup"><span data-stu-id="c2672-158">**PEER\_MEMBER\_JOINED**.</span></span> <span data-ttu-id="c2672-159">De nouvelles informations d’appartenance ont été publiées pour un homologue.</span><span class="sxs-lookup"><span data-stu-id="c2672-159">New membership information has been published for a peer.</span></span>
    -   <span data-ttu-id="c2672-160">**Homologue \_ MEMBRE \_ mis à jour**.</span><span class="sxs-lookup"><span data-stu-id="c2672-160">**PEER\_MEMBER\_UPDATED**.</span></span> <span data-ttu-id="c2672-161">Un homologue a été mis à jour avec de nouvelles informations, telles qu’une nouvelle adresse IP.</span><span class="sxs-lookup"><span data-stu-id="c2672-161">A peer has updated with new information, such as a new IP address.</span></span>
-   <span data-ttu-id="c2672-162">**Homologue \_ \_connexion du \_ voisin \_ d’événement de groupe**.</span><span class="sxs-lookup"><span data-stu-id="c2672-162">**PEER\_GROUP\_EVENT\_NEIGHBOR\_CONNECTION**.</span></span> <span data-ttu-id="c2672-163">Les pairs qui feront partie des connexions des voisins au sein du groupe doivent s’inscrire à cet événement.</span><span class="sxs-lookup"><span data-stu-id="c2672-163">Peers who will participate in neighbor connections within the group must register for this event.</span></span> <span data-ttu-id="c2672-164">Notez que l’inscription à cet événement ne permet pas à l’homologue de recevoir des données ; l’inscription de cet événement garantit uniquement la notification lors de la réception d’une demande de connexion voisine.</span><span class="sxs-lookup"><span data-stu-id="c2672-164">Note that registering for this event does not enable the peer to receive data; registration for this event only ensures notification when a request for a neighbor connection is received.</span></span>
-   <span data-ttu-id="c2672-165">**Homologue \_ \_ \_ \_ connexion directe d’événement de groupe**.</span><span class="sxs-lookup"><span data-stu-id="c2672-165">**PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION**.</span></span> <span data-ttu-id="c2672-166">Les pairs qui feront partie des connexions directes au sein du groupe doivent s’inscrire à cet événement.</span><span class="sxs-lookup"><span data-stu-id="c2672-166">Peers who will participate in direct connections within the group must register for this event.</span></span> <span data-ttu-id="c2672-167">Notez que l’inscription à cet événement ne permet pas à l’homologue de recevoir des données ; l’inscription de cet événement garantit uniquement la notification lors de la réception d’une demande de connexion directe.</span><span class="sxs-lookup"><span data-stu-id="c2672-167">Note that registering for this event does not enable the peer to receive data; registration for this event only ensures notification when a request for a direct connection is received.</span></span>
-   <span data-ttu-id="c2672-168">**Homologue \_ Regroupez les \_ \_ \_ données entrantes**.</span><span class="sxs-lookup"><span data-stu-id="c2672-168">**PEER\_GROUP\_EVENT\_INCOMING\_DATA**.</span></span> <span data-ttu-id="c2672-169">Les pairs qui recevront des données via un voisin ou une connexion directe doivent s’inscrire à cet événement.</span><span class="sxs-lookup"><span data-stu-id="c2672-169">Peers who will receive data over a neighbor or direct connection must register for this event.</span></span> <span data-ttu-id="c2672-170">Lorsque cet événement est déclenché, les données opaques transmises par l’autre homologue participant peuvent être obtenues en appelant [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span><span class="sxs-lookup"><span data-stu-id="c2672-170">When this event is raised, the opaque data transmitted by the other participating peer can be obtained by calling [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span></span> <span data-ttu-id="c2672-171">Notez que pour recevoir cet événement, l’homologue doit avoir déjà été inscrit pour la connexion **directe d’événement de groupe homologue \_ \_ \_ \_** ou la **\_ \_ \_ \_ connexion voisine d’événement de groupe pair**.</span><span class="sxs-lookup"><span data-stu-id="c2672-171">Note that to receive this event, the peer must have previously registered for **PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION** or **PEER\_GROUP\_EVENT\_NEIGHBOR\_CONNECTION**.</span></span>
-   <span data-ttu-id="c2672-172">**Homologue \_ \_ \_ \_ échec** de la connexion de l’événement de groupe.</span><span class="sxs-lookup"><span data-stu-id="c2672-172">**PEER\_GROUP\_EVENT\_CONNECTION\_FAILED**.</span></span> <span data-ttu-id="c2672-173">Une connexion a échoué pour une raison quelconque.</span><span class="sxs-lookup"><span data-stu-id="c2672-173">A connection failed for some reason.</span></span> <span data-ttu-id="c2672-174">Aucune donnée n’est fournie lorsque cet événement est déclenché, et [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) ne doit pas être appelé.</span><span class="sxs-lookup"><span data-stu-id="c2672-174">No data is provided when this event is raised, and [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) should not be called.</span></span>

<span data-ttu-id="c2672-175">Une fois qu’une application a reçu une notification indiquant qu’un événement homologue s’est produit (à l’exclusion de [](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata)l’échec de la **\_ connexion d’événement de groupe \_ \_ \_ pair**), l’application appelle PeerGroupGetEventData et passe le handle d’événement homologue retourné par [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span><span class="sxs-lookup"><span data-stu-id="c2672-175">After an application receives notification that a peer event has occurred (excluding **PEER\_GROUP\_EVENT\_CONNECTION\_FAILED**), the application calls [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata), and passes the peer event handle returned by [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span> <span data-ttu-id="c2672-176">L’infrastructure homologue retourne un pointeur vers une structure de [**\_ données d' \_ événement \_ de groupe pair**](/windows/win32/api/p2p/ns-p2p-peer_group_event_data-r1) qui contient les données demandées.</span><span class="sxs-lookup"><span data-stu-id="c2672-176">The Peer Infrastructure returns a pointer to a [**PEER\_GROUP\_EVENT\_DATA**](/windows/win32/api/p2p/ns-p2p-peer_group_event_data-r1) structure that contains the requested data.</span></span> <span data-ttu-id="c2672-177">Cette fonction doit être appelée jusqu’à ce qu' **\_ \_ aucune \_ \_ donnée d’événement ne** soit retournée.</span><span class="sxs-lookup"><span data-stu-id="c2672-177">This function must be called until **PEER\_S\_NO\_EVENT\_DATA** is returned.</span></span> <span data-ttu-id="c2672-178">Quand une application ne requiert plus de notification pour un événement homologue, un appel à [**PeerGroupUnregisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupunregisterevent)doit être effectué en passant le handle d’événement homologue retourné par **PeerGroupRegisterEvent** lorsque l’application est inscrite pour l’événement particulier.</span><span class="sxs-lookup"><span data-stu-id="c2672-178">When an application no longer requires notification for a peer event, a call must be made to [**PeerGroupUnregisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupunregisterevent), passing the peer event handle returned by **PeerGroupRegisterEvent** when the application registered for the particular event.</span></span>

## <a name="example-of-registering-for-peer-graphing-events"></a><span data-ttu-id="c2672-179">Exemple d’inscription pour les événements de représentation graphique d’homologue</span><span class="sxs-lookup"><span data-stu-id="c2672-179">Example of Registering for Peer Graphing Events</span></span>

<span data-ttu-id="c2672-180">L’exemple de code suivant montre comment s’inscrire auprès des événements de représentation graphique des homologues.</span><span class="sxs-lookup"><span data-stu-id="c2672-180">The following code sample shows you how to register with the Peer Graphing events.</span></span>


```C++
//-----------------------------------------------------------------------------
// Function: RegisterForEvents
//
// Purpose:  Registers the EventCallback function so it can be called for only
//           the events that are specified.
//
// Returns:  HRESULT
//
HRESULT RegisterForEvents()
{
    HPEEREVENT  g_hPeerEvent = NULL;        // The one PeerEvent handle
    HANDLE      g_hEvent = NULL;            // Handle signaled by Graphing when we have an event
    HRESULT hr = S_OK;
    PEER_GRAPH_EVENT_REGISTRATION regs[] = {
        { PEER_GRAPH_EVENT_RECORD_CHANGED, 0 },
        { PEER_GRAPH_EVENT_NODE_CHANGED,   0 },
        { PEER_GRAPH_EVENT_STATUS_CHANGED, 0 },
        { PEER_GRAPH_EVENT_DIRECT_CONNECTION, 0 },
        { PEER_GRAPH_EVENT_INCOMING_DATA, 0 },
    };

    g_hEvent = CreateEvent(NULL, FALSE, FALSE, NULL);
    if (g_hEvent == NULL)
    {
        wprintf(L"CreateEvent call failed.\n");
        hr = E_OUTOFMEMORY;
    }
    else
    {
        hr = PeerGraphRegisterEvent(g_hGraph, g_hEvent, celems(regs), regs,  &g_hPeerEvent);
        if (FAILED(hr))
        {
           wprintf(L"PeerGraphRegisterEvent call failed.\n");
            CloseHandle(g_hEvent);
            g_hEvent = NULL;
        }
    }

    if (SUCCEEDED(hr))
    {
        if (!RegisterWaitForSingleObject(&g_hWait, g_hEvent, EventCallback, NULL, INFINITE, WT_EXECUTEDEFAULT))
        {
            hr = HRESULT_FROM_WIN32(GetLastError());
            wprintf(L"Could not set up event callback.\n");
            CloseHandle(g_hEvent);
            g_hEvent = NULL;
        }
    }

    return hr;
}
```



 

 



