---
description: Cette rubrique explique comment une application se connecte à un groupe homologue à l’aide des API de regroupement pair.
ms.assetid: 56fa28d8-3b3a-4cd5-8448-c8c4ce8d0b2c
title: Comment se connecter à un groupe homologue
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d5bb3f41342573742e634a6e7ebce283188f3ffd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106544867"
---
# <a name="how-to-connect-to-a-peer-group"></a><span data-ttu-id="f3529-103">Comment se connecter à un groupe homologue</span><span class="sxs-lookup"><span data-stu-id="f3529-103">How to Connect to a Peer Group</span></span>

<span data-ttu-id="f3529-104">Cette rubrique explique comment une application se connecte à un groupe homologue à l’aide des API de regroupement pair.</span><span class="sxs-lookup"><span data-stu-id="f3529-104">This topic discusses how an application connects to a peer group using the Peer Grouping APIs.</span></span>

## <a name="joining-a-peer-group"></a><span data-ttu-id="f3529-105">Joindre un groupe homologue</span><span class="sxs-lookup"><span data-stu-id="f3529-105">Joining a Peer Group</span></span>

<span data-ttu-id="f3529-106">Pour joindre un groupe homologue, appelez [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), en transmettant le nom d’identité de l’homologue et de l’invitation (et un nom de Cloud PNRP facultatif, si le nom du Cloud dans l’invitation est ambigu).</span><span class="sxs-lookup"><span data-stu-id="f3529-106">To join a peer group, call [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), passing in the identity name of the peer and the invitation (and an optional PNRP cloud name, if the cloud name in the invitation is ambiguous).</span></span>

<span data-ttu-id="f3529-107">En cas de réussite, [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) retourne un handle vers le groupe homologue.</span><span class="sxs-lookup"><span data-stu-id="f3529-107">If successful, [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) returns a handle to the peer group.</span></span>

<span data-ttu-id="f3529-108">Si l’homologue a déjà rejoint le groupe homologue, puis fermé le handle, le groupe homologue doit être rouvert en appelant [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) et en passant le nom du groupe homologue.</span><span class="sxs-lookup"><span data-stu-id="f3529-108">If the peer has previously joined the peer group and then closed the handle, the peer group should be reopened by calling [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) and passing in the name of the peer group.</span></span> <span data-ttu-id="f3529-109">Cet appel retourne un nouveau handle de groupe homologue.</span><span class="sxs-lookup"><span data-stu-id="f3529-109">This call returns a new peer group handle.</span></span>

<span data-ttu-id="f3529-110">Une fois le groupe homologue correctement joint, l’homologue peut se connecter directement au groupe homologue et commencer à interagir en appelant [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span><span class="sxs-lookup"><span data-stu-id="f3529-110">Once the peer group is successfully joined, the peer may connect directly to the peer group and begin interacting by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span></span> <span data-ttu-id="f3529-111">Une fois connecté, l’homologue est considéré comme « en ligne ».</span><span class="sxs-lookup"><span data-stu-id="f3529-111">After connecting, the peer is considered to be "online".</span></span>

<span data-ttu-id="f3529-112">Si une application n’interagit pas avec le groupe à ce moment-là, elle peut rester « hors connexion ».</span><span class="sxs-lookup"><span data-stu-id="f3529-112">If an application will not interact with the group at the time, it can remain "offline".</span></span> <span data-ttu-id="f3529-113">S’il choisit de participer directement au groupe homologue dans une instance ultérieure, un appel ultérieur à [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) le met en ligne.</span><span class="sxs-lookup"><span data-stu-id="f3529-113">If it chooses to participate directly in the peer group at a later instance, a subsequent call to [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) will bring it online.</span></span> <span data-ttu-id="f3529-114">Une fois qu’un homologue a rejoint le groupe homologue, il doit se connecter au moins une fois avant de pouvoir publier des enregistrements dans le groupe homologue.</span><span class="sxs-lookup"><span data-stu-id="f3529-114">After a peer has joined the peer group, it must connect at least once before it will be able to publish records to the peer group.</span></span>

## <a name="opening-a-peer-group-without-connecting-offline"></a><span data-ttu-id="f3529-115">Ouverture d’un groupe homologue sans connexion (hors connexion)</span><span class="sxs-lookup"><span data-stu-id="f3529-115">Opening a Peer Group Without Connecting (Offline)</span></span>

<span data-ttu-id="f3529-116">Souvent, vous souhaiterez peut-être que l’application se connecte à un groupe pair, mais ne la participe pas directement, en recevant et en publiant des mises à jour d’enregistrement, mais pas en envoyant ou en recevant des messages de données.</span><span class="sxs-lookup"><span data-stu-id="f3529-116">Often, you may wish to have an application connect to a peer group but not directly participate it, receiving and publishing record updates but not sending or receiving data messages.</span></span> <span data-ttu-id="f3529-117">Une application est dans cet État « hors connexion » immédiatement après l’appel de [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin)ou [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) .</span><span class="sxs-lookup"><span data-stu-id="f3529-117">An application is in this "offline" state immediately after [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), or [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) have been called.</span></span>

<span data-ttu-id="f3529-118">Une application hors connexion peut être mise en ligne à tout moment en appelant [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span><span class="sxs-lookup"><span data-stu-id="f3529-118">An offline application can go online at any time by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span></span> <span data-ttu-id="f3529-119">Une fois connecté, un groupe homologue ne peut pas passer en mode hors connexion jusqu’à ce que toutes les autres applications associées à cette identité et partageant ce groupe y aient également fermé des connexions.</span><span class="sxs-lookup"><span data-stu-id="f3529-119">Once connected, a peer group cannot go offline until all other applications associated with this identity and sharing this group have closed connections to it as well.</span></span>

<span data-ttu-id="f3529-120">Un groupe homologue est une ressource partagée, avec le même groupe homologue disponible pour plusieurs applications.</span><span class="sxs-lookup"><span data-stu-id="f3529-120">A peer group is a shared resource, with the same peer group available to multiple applications.</span></span> <span data-ttu-id="f3529-121">Si plusieurs applications pour la même identité et l’utilisateur Windows utilisent le même groupe pair, elles partagent également la même base de données sous-jacente et les mêmes connexions (voisin et direct).</span><span class="sxs-lookup"><span data-stu-id="f3529-121">If more than one application for the same identity and Windows user is using the same peer group, they also share the same underlying database and connections (neighbor and direct).</span></span> <span data-ttu-id="f3529-122">Si l’une de ces applications appelle [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect), toutes les autres applications pour cette identité/cet utilisateur participant au groupe se connectent également au groupe.</span><span class="sxs-lookup"><span data-stu-id="f3529-122">If any one of these applications calls [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect), all of the other applications for this identity/user participating in the group also connect to the group.</span></span> <span data-ttu-id="f3529-123">Si un enregistrement est ajouté par une application alors que le groupe est hors connexion, d’autres applications sont également en mesure de le voir.</span><span class="sxs-lookup"><span data-stu-id="f3529-123">If a record is added by one application while the group is offline, other applications are also be able to see it.</span></span> <span data-ttu-id="f3529-124">En conséquence, une application doit être prête à se connecter à tout moment.</span><span class="sxs-lookup"><span data-stu-id="f3529-124">As a result, an application must be ready to go online at any time.</span></span>

## <a name="connecting-to-a-peer-group-online"></a><span data-ttu-id="f3529-125">Connexion à un groupe homologue (en ligne)</span><span class="sxs-lookup"><span data-stu-id="f3529-125">Connecting to a Peer Group (Online)</span></span>

<span data-ttu-id="f3529-126">Pour commencer à participer à un groupe, appelez [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) après avoir créé, rejoint ou ouvert le groupe.</span><span class="sxs-lookup"><span data-stu-id="f3529-126">To begin participating in a group, call [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) after creating, joining, or opening the group.</span></span> <span data-ttu-id="f3529-127">Dans cet État, les connexions directes peuvent être ouvertes avec d’autres pairs qui participent au même groupe en appelant [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection).</span><span class="sxs-lookup"><span data-stu-id="f3529-127">In this state, direct connections can be opened with other peers participating in the same group by calling [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection).</span></span>

<span data-ttu-id="f3529-128">Pour détecter si une tentative de connexion a échoué, inscrivez-vous à l' \_ événement d’échec de connexion d’événement de groupe pair \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="f3529-128">To detect if a connection attempt has failed, register for the PEER\_GROUP\_EVENT\_CONNECTION\_FAILED event.</span></span> <span data-ttu-id="f3529-129">Cet événement est déclenché si l’infrastructure de regroupement ne peut pas trouver un autre membre auquel se connecter, ou si la connexion échoue avant la synchronisation de la base de données de groupe et qu’une autre connexion ne peut pas être établie.</span><span class="sxs-lookup"><span data-stu-id="f3529-129">This event is raised if the grouping infrastructure cannot find another member to connect to, or if the connection fails before the group database is synchronized and another connection cannot be established.</span></span>

<span data-ttu-id="f3529-130">Bien que plusieurs applications qui s’exécutent sur l’homologue et qui participent au même groupe avec la même identité d’homologue puissent être hors connexion, un appel à [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) par l’une des applications entraîne la mise en ligne de toutes les applications.</span><span class="sxs-lookup"><span data-stu-id="f3529-130">Although multiple applications executing on the peer and participating in the same group with the same peer identity may be offline, a call to [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) by any one of the applications results in all of the applications becoming online.</span></span>

<span data-ttu-id="f3529-131">En outre, si une application sur l’homologue s’est connectée au groupe, toutes les autres applications qui appellent [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) ou [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) sont immédiatement connectées.</span><span class="sxs-lookup"><span data-stu-id="f3529-131">Also, if one application on the peer has connected to the group, any other applications that call [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) or [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) are immediately connected as well.</span></span> <span data-ttu-id="f3529-132">Si une application appelle [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), le descripteur est fermé uniquement pour cette application.</span><span class="sxs-lookup"><span data-stu-id="f3529-132">If an application calls [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), the handle is closed for only that application.</span></span> <span data-ttu-id="f3529-133">Par conséquent, un appel ultérieur à **PeerGroupOpen** par l’application retourne un nouveau descripteur de groupe et l’application est mise en ligne immédiatement si d’autres applications qui participent au même groupe sont toujours connectées.</span><span class="sxs-lookup"><span data-stu-id="f3529-133">Thus, a subsequent call to **PeerGroupOpen** by the application returns a new group handle, and the application is brought online immediately if any other applications participating in the same group are still connected.</span></span>

## <a name="sending-and-receiving-data"></a><span data-ttu-id="f3529-134">Envoi et réception de données</span><span class="sxs-lookup"><span data-stu-id="f3529-134">Sending and Receiving Data</span></span>

<span data-ttu-id="f3529-135">Pour envoyer et recevoir des données entre des nœuds membres spécifiques du groupe, les connexions directes doivent être établies avec les membres avec lesquels vous souhaitez interagir.</span><span class="sxs-lookup"><span data-stu-id="f3529-135">To send and receive data between specific member nodes in the group, direct connections must be established with those members you intend to interact with.</span></span> <span data-ttu-id="f3529-136">L’établissement d’une connexion directe est un appel asynchrone à [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection), en passant le handle d’un groupe connecté, ainsi que l’identité de l’homologue dans le groupe auquel vous souhaitez vous connecter.</span><span class="sxs-lookup"><span data-stu-id="f3529-136">Establishing a direct connection is an asynchronous call to [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection), passing in the handle for a connected group as well as the identity of the peer within the group you wish to connect to.</span></span> <span data-ttu-id="f3529-137">Cette méthode renverra un ID de connexion.</span><span class="sxs-lookup"><span data-stu-id="f3529-137">This method will return a connection ID.</span></span> <span data-ttu-id="f3529-138">Si l’appel réussit, un \_ événement de \_ \_ connexion directe d’événement de groupe pair \_ est déclenché sur l’homologue, en validant l’ID de connexion.</span><span class="sxs-lookup"><span data-stu-id="f3529-138">If the call is successful, a PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION event is raised on the peer, validating the connection ID.</span></span>

<span data-ttu-id="f3529-139">Pour recevoir des connexions directes d’autres homologues en ligne, inscrivez-vous à l' \_ événement de connexion directe d’événement de groupe homologue \_ \_ \_ avec un appel à [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span><span class="sxs-lookup"><span data-stu-id="f3529-139">To receive direct connections from other online peers, register for the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION event with a call to [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span>

<span data-ttu-id="f3529-140">Une fois qu’une connexion directe a été établie, l’application peut commencer à envoyer des données avec des appels à [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata), en transmettant l’ID de connexion valide.</span><span class="sxs-lookup"><span data-stu-id="f3529-140">Once a direct connection has been successfully established, the application can begin sending data with calls to [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata), passing the valid connection ID.</span></span> <span data-ttu-id="f3529-141">L’ordonnancement des transmissions de données à parties multiples est géré par **PeerGroupSendData**.</span><span class="sxs-lookup"><span data-stu-id="f3529-141">The ordering of multipart data transmissions is handled by **PeerGroupSendData**.</span></span> <span data-ttu-id="f3529-142">Toutefois, les applications doivent implémenter une pile de protocole appropriée pour gérer les données opaques retournées par cet appel d’API.</span><span class="sxs-lookup"><span data-stu-id="f3529-142">However, applications should implement a proper protocol stack for handling the opaque data returned by this API call.</span></span>

<span data-ttu-id="f3529-143">Pour recevoir des données via une connexion directe, l’application doit s’inscrire à \_ l' \_ événement de données entrantes de l’événement de groupe pair \_ \_ avec [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span><span class="sxs-lookup"><span data-stu-id="f3529-143">To receive data over a direct connection, the application must register for the PEER\_GROUP\_EVENT\_INCOMING\_DATA event with [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span> <span data-ttu-id="f3529-144">Le gestionnaire d’événements est chargé d’obtenir et de classer les données opaques et de les transmettre à l’application.</span><span class="sxs-lookup"><span data-stu-id="f3529-144">The event handler is responsible for obtaining and ordering the opaque data, and passing it to the application.</span></span> <span data-ttu-id="f3529-145">Ces données sont obtenues dans le gestionnaire d’événements en appelant [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) avec le descripteur des événements inscrits.</span><span class="sxs-lookup"><span data-stu-id="f3529-145">This data is obtained within the event handler by calling [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) with the handle to the registered events.</span></span>

<span data-ttu-id="f3529-146">Une connexion directe est fermée en appelant [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) et en passant l’ID de connexion obtenu lors d’un appel précédent à [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) ou reçu dans les données d’événement pour la \_ \_ connexion directe au groupe d’événements homologues \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="f3529-146">A direct connection is closed by calling [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) and passing in the connection ID obtained by a previous call to [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) or received in the event data for PEER\_EVENT\_GROUP\_DIRECT\_CONNECTION.</span></span>

 

 



