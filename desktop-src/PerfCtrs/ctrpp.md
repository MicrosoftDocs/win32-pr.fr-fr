---
description: L’outil CTRPP est un pré-processeur qui analyse et valide votre manifeste de compteurs.
ms.assetid: 3939f6a1-0a94-429d-a71e-b37f045fea13
title: CTRPP
ms.topic: reference
ms.date: 08/17/2020
topic_type:
- APIRef
- kbSyntax
api_name:
- CTRPP
api_type:
- NA
api_location: ''
ms.openlocfilehash: dce12de641dda7b07871a4447190772533598748
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/05/2021
ms.locfileid: "104321718"
---
# <a name="ctrpp"></a><span data-ttu-id="9c2d3-103">CTRPP</span><span class="sxs-lookup"><span data-stu-id="9c2d3-103">CTRPP</span></span>

<span data-ttu-id="9c2d3-104">L’outil CTRPP est un pré-processeur qui analyse et valide le manifeste pour votre fournisseur v2.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-104">The CTRPP tool is a pre-processor that parses and validates the manifest for your V2 provider.</span></span> <span data-ttu-id="9c2d3-105">L’outil génère des `.rc` ressources avec les chaînes requises par les consommateurs de votre fournisseur et génère un `.h` en-tête avec le code que vous utilisez pour fournir vos données de compteur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-105">The tool generates `.rc` resources with the strings needed by consumers of your provider, and it generates a `.h` header with code that you use to provide your counter data.</span></span> <span data-ttu-id="9c2d3-106">Vous devez exécuter l’outil CTRPP pendant la génération de votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-106">You should run the CTRPP tool during the build of your provider.</span></span> <span data-ttu-id="9c2d3-107">Vous devez utiliser le code généré comme point de départ lors du développement de votre fournisseur au lieu d’essayer de générer ce code vous-même.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-107">You should use the generated code as a starting point when developing your provider instead of trying to generate this code yourself.</span></span>

```syntax
ctrpp -o codeFile -rc rcFile [-legacy] [-MemoryRoutines] [-NotificationCallback] [-prefix prefix] [-ch symFile] [-backcompat] inputFile
```

## <a name="arguments"></a><span data-ttu-id="9c2d3-108">Arguments</span><span class="sxs-lookup"><span data-stu-id="9c2d3-108">Arguments</span></span>

|<span data-ttu-id="9c2d3-109">Option</span><span class="sxs-lookup"><span data-stu-id="9c2d3-109">Option</span></span>              |<span data-ttu-id="9c2d3-110">Description</span><span class="sxs-lookup"><span data-stu-id="9c2d3-110">Description</span></span>
|--------------------|-----------
|<span data-ttu-id="9c2d3-111">*FichierEntrée*</span><span class="sxs-lookup"><span data-stu-id="9c2d3-111">*inputFile*</span></span>         |<span data-ttu-id="9c2d3-112">**Obligatoire :** Spécifie le nom du `.man` fichier (manifeste XML) qui définit vos compteurs.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-112">**Required:** Specifies the name of the `.man` (XML manifest) file that defines your counters.</span></span>
|<span data-ttu-id="9c2d3-113">**-o** *CodeFile*</span><span class="sxs-lookup"><span data-stu-id="9c2d3-113">**-o** *codeFile*</span></span>   |<span data-ttu-id="9c2d3-114">**Obligatoire :** Spécifie le nom du `.h` fichier de code à générer par ctrpp.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-114">**Required:** Specifies the name of the `.h` code file to be generated by CTRPP.</span></span> <span data-ttu-id="9c2d3-115">Ce fichier contient des fonctions d’assistance inline C/C++ qui simplifient l’initialisation et la désinitialisation de votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-115">This file will contain C/C++ inline helper functions that simplify initializing and uninitializing your provider.</span></span>
|<span data-ttu-id="9c2d3-116">**-RC** *rcFile*</span><span class="sxs-lookup"><span data-stu-id="9c2d3-116">**-rc** *rcFile*</span></span>    |<span data-ttu-id="9c2d3-117">**Obligatoire :** Spécifie le nom du `.rc` fichier de ressources à générer par ctrpp.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-117">**Required:** Specifies the name of the `.rc` (resource file) to be generated by CTRPP.</span></span> <span data-ttu-id="9c2d3-118">Ce fichier contient la table de chaînes du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-118">This file will contain the provider's string table.</span></span>
|<span data-ttu-id="9c2d3-119">**-ch** *symFile*</span><span class="sxs-lookup"><span data-stu-id="9c2d3-119">**-ch** *symFile*</span></span>   |<span data-ttu-id="9c2d3-120">Spécifie le nom du fichier de symboles facultatifs `.h` à générer par ctrpp.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-120">Specifies the name of the optional `.h` symbol file to be generated by CTRPP.</span></span> <span data-ttu-id="9c2d3-121">Ce fichier contient des symboles C/C++ pour les noms et les GUID de chaque CounterSet dans le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-121">This file will contain C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span>
|<span data-ttu-id="9c2d3-122">**-** *préfixe* préfixe</span><span class="sxs-lookup"><span data-stu-id="9c2d3-122">**-prefix** *prefix*</span></span>|<span data-ttu-id="9c2d3-123">Spécifie le préfixe à utiliser pour les variables et les fonctions définies dans le fichier d’en-tête généré.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-123">Specifies the prefix to use for the variables and functions defined in the generated header file.</span></span>
|<span data-ttu-id="9c2d3-124">**-NotificationCallback**</span><span class="sxs-lookup"><span data-stu-id="9c2d3-124">**-NotificationCallback**</span></span>|<span data-ttu-id="9c2d3-125">Modifie la signature par défaut de la fonction [**CounterInitialize**](counterinitialize.md) pour inclure des paramètres pour la spécification du nom des fonctions de rappel [*ControlCallback*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest), [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc)et [*FreeMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-125">Changes the default signature of the [**CounterInitialize**](counterinitialize.md) function to include parameters for specifying the name of [*ControlCallback*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest), [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc), and [*FreeMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) callback functions.</span></span> <span data-ttu-id="9c2d3-126">Cet argument a le même effet que l’inclusion `callback` de l’attribut dans l’élément [**Provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-126">This argument has the same effect as including the `callback` attribute in the [**provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) element.</span></span>
|<span data-ttu-id="9c2d3-127">**-migrer** *outputfile*</span><span class="sxs-lookup"><span data-stu-id="9c2d3-127">**-migrate** *outputFile*</span></span>|<span data-ttu-id="9c2d3-128">Au lieu de générer et de créer des `.h` `.rc` fichiers, met à niveau le manifeste *FichierEntrée* vers la dernière version et l’enregistre dans *FichierSortie*.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-128">Instead of generating `.h` and `.rc` files, upgrades the *inputFile* manifest to the latest version and saves it to *outputFile*.</span></span> <span data-ttu-id="9c2d3-129">Ce commutateur ne peut pas être utilisé avec d’autres commutateurs.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-129">This switch cannot be used with other switches.</span></span> <span data-ttu-id="9c2d3-130">Utilisation : `CTRPP -migrate NewFile.man OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="9c2d3-130">Usage: `CTRPP -migrate NewFile.man OldFile.man`</span></span>
|<span data-ttu-id="9c2d3-131">**-Incompatibilité**</span><span class="sxs-lookup"><span data-stu-id="9c2d3-131">**-BackCompat**</span></span>     |<span data-ttu-id="9c2d3-132">**Déconseillé :** La prise en charge des fournisseurs en mode noyau a été ajoutée dans Windows 7.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-132">**Deprecated:** Support for kernel-mode providers was added in Windows 7.</span></span> <span data-ttu-id="9c2d3-133">Par défaut, le code généré par CTRPP pour les fournisseurs en mode noyau est incompatible avec les versions antérieures de Windows (le pilote ne peut pas se charger en raison d’API manquantes `Pcw***` ).</span><span class="sxs-lookup"><span data-stu-id="9c2d3-133">By default, the code generated by CTRPP for kernel-mode providers will be incompatible with earlier versions of Windows (driver will fail to load due to missing `Pcw***` APIs).</span></span> <span data-ttu-id="9c2d3-134">Défini `-BackCompat` pour activer la compatibilité avec les versions antérieures de Windows.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-134">Set `-BackCompat` to enable compatibility with earlier versions of Windows.</span></span> <span data-ttu-id="9c2d3-135">Le pilote chargera dynamiquement les API nécessaires et le code généré désactivera silencieusement le fournisseur si les API ne sont pas disponibles.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-135">The driver will dynamically load the necessary APIs and the generated code will silently disable the provider if the APIs are not available.</span></span>
|<span data-ttu-id="9c2d3-136">**-MemoryRoutines**</span><span class="sxs-lookup"><span data-stu-id="9c2d3-136">**-MemoryRoutines**</span></span> |<span data-ttu-id="9c2d3-137">**Déconseillé :** En cas d’utilisation avec le `-Legacy` commutateur, comprend des modèles pour les routines de mémoire dans le code généré.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-137">**Deprecated:** When used with the `-Legacy` switch, includes templates for memory routines in the generated code.</span></span> <span data-ttu-id="9c2d3-138">Sinon, cet argument a le même effet que le `-NotificationCallback` commutateur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-138">Otherwise, this argument has the same effect as the `-NotificationCallback` switch.</span></span>
|<span data-ttu-id="9c2d3-139">**-Hérité**</span><span class="sxs-lookup"><span data-stu-id="9c2d3-139">**-Legacy**</span></span>         |<span data-ttu-id="9c2d3-140">**Déconseillé :** Génère `*.h` des `*.c` fichiers,, `*.rc` et `*_r.h` à l’aide des modèles de code Windows Vista (génère PerfAutoInitialize et PerfAutoCleanup au lieu de CounterInitialize et CounterCleanup).</span><span class="sxs-lookup"><span data-stu-id="9c2d3-140">**Deprecated:** Generates `*.h`, `*.c`, `*.rc`, and `*_r.h` files using the Windows Vista code templates (generates PerfAutoInitialize and PerfAutoCleanup instead of CounterInitialize and CounterCleanup).</span></span> <span data-ttu-id="9c2d3-141">Ce commutateur peut être utilisé avec **-MemoryRoutines** et **-NotificationCallback** , mais il ne peut pas être utilisé avec d’autres commutateurs.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-141">This switch can be used with **-MemoryRoutines** and **-NotificationCallback** but cannot be used with any other switches.</span></span> <span data-ttu-id="9c2d3-142">N’utilisez pas les commutateurs **-o** ou **-RC** avec ce commutateur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-142">Do not use the **-o** or **-rc** switches with this switch.</span></span> <span data-ttu-id="9c2d3-143">Les fichiers générés sont nommés en fonction du nom du manifeste et sont écrits dans le répertoire qui contenait le manifeste.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-143">The generated files will be named based on the name of the manifest and will be written to the directory that contained the manifest.</span></span> <span data-ttu-id="9c2d3-144">Utilisation : `CTRPP -legacy OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="9c2d3-144">Usage: `CTRPP -legacy OldFile.man`</span></span>

## <a name="remarks"></a><span data-ttu-id="9c2d3-145">Notes</span><span class="sxs-lookup"><span data-stu-id="9c2d3-145">Remarks</span></span>

<span data-ttu-id="9c2d3-146">L’outil CTRPP génère un fichier de `.h` code, un `.rc` fichier de ressources et, éventuellement, génère un `.h` fichier de symboles.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-146">The CTRPP tool generates a `.h` code file, an `.rc` resource file, and optionally generates a `.h` symbol file.</span></span>

### <a name="using-the-generated-resource-file"></a><span data-ttu-id="9c2d3-147">Utilisation du fichier de ressources généré</span><span class="sxs-lookup"><span data-stu-id="9c2d3-147">Using the generated resource file</span></span>

<span data-ttu-id="9c2d3-148">L’outil CTRPP génère un `.rc` fichier de ressources qui contient les chaînes localisables nécessaires aux consommateurs du countersets du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-148">The CTRPP tool will generate a `.rc` resource file that contains the localizable strings needed by consumers of the provider's countersets.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9c2d3-149">Les ressources de ce fichier doivent être incluses dans votre binaire de fournisseur et le chemin d’accès complet au fichier binaire du fournisseur doit être inscrit pendant l’installation du manifeste de votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-149">The resources from this file must be included into your provider binary and the full path to the provider binary must be registered during the installation of your provider's manifest.</span></span> <span data-ttu-id="9c2d3-150">Les consommateurs qui ne parviennent pas à localiser et à charger les ressources ne pourront pas utiliser les countersets de votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-150">Consumers that are unable to locate and load the resources will be unable to use your provider's countersets.</span></span>

<span data-ttu-id="9c2d3-151">Les ressources de type chaîne doivent être gérées comme suit :</span><span class="sxs-lookup"><span data-stu-id="9c2d3-151">The string resources should be handled as follows:</span></span>

- <span data-ttu-id="9c2d3-152">Le développeur modifie le fichier manifeste du fournisseur ( `.man` ) afin de définir l' `applicationIdentity` attribut du fournisseur sur le nom d’un fournisseur binaire (. DLL,. SYS ou. EXE) qui contiendra les ressources de type chaîne pour le fournisseur et sera installé dans le cadre du composant fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-152">The developer edits the provider manifest (`.man`) file to set the `applicationIdentity` attribute of the provider to the name of a provider binary (.DLL, .SYS, or .EXE) that will contain the string resources for the provider and will be installed as part of the provider component.</span></span>
- <span data-ttu-id="9c2d3-153">L’outil CTRPP lit le manifeste du fournisseur et génère un `.rc` fichier.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-153">The CTRPP tool reads the provider manifest and generates an `.rc` file.</span></span>
- <span data-ttu-id="9c2d3-154">L’outil [RC (compilateur de ressources)](../menurc/resource-compiler.md) compile les données du fichier généré par ctrpp `.rc` pour générer un `.res` fichier contenant les ressources binaires.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-154">The [RC (resource compiler)](../menurc/resource-compiler.md) tool compiles the data from the CTRPP-generated `.rc` file to generate a `.res` file containing the binary resources.</span></span> <span data-ttu-id="9c2d3-155">Pour ce faire, vous pouvez compiler directement le fichier généré par CTRPP `.rc` ou en compilant un autre `.rc` fichier qui comprend le fichier généré par ctrpp `.rc` via une `#include` directive.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-155">This can be done either by directly compiling the CTRPP-generated `.rc` file OR by compiling another `.rc` file that includes the CTRPP-generated `.rc` file via an `#include` directive.</span></span>
- <span data-ttu-id="9c2d3-156">L’éditeur de liens incorpore les données du fichier généré par RC `.res` dans le binaire du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-156">The linker embeds the data from the RC-generated `.res` file into the provider binary.</span></span>
- <span data-ttu-id="9c2d3-157">Pendant l’installation, le fichier binaire du fournisseur est copié sur le système de l’utilisateur et le manifeste du fournisseur est enregistré à l’aide de l' [outil lodctr](/windows-server/administration/windows-commands/lodctr).</span><span class="sxs-lookup"><span data-stu-id="9c2d3-157">During installation, the provider binary is copied onto the user's system and the provider manifest is registered using the [lodctr tool](/windows-server/administration/windows-commands/lodctr).</span></span> <span data-ttu-id="9c2d3-158">L’outil lodctr convertit l' `applicationIdentity` attribut du manifeste du fournisseur en chemin d’accès complet et enregistre le chemin d’accès complet au fichier binaire du fournisseur dans le registre.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-158">The lodctr tool converts the `applicationIdentity` attribute of the provider manifest into a full path and records the full path to the provider binary in the registry.</span></span>
  - <span data-ttu-id="9c2d3-159">Si le fichier binaire du fournisseur se trouve dans le même répertoire que le manifeste, utilisez : `lodctr.exe /m:"C:\full\manifest\path\manifest.man"` .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-159">If the provider binary is in the same directory as the manifest, use: `lodctr.exe /m:"C:\full\manifest\path\manifest.man"`.</span></span> <span data-ttu-id="9c2d3-160">lodctr associe le chemin d’accès du manifeste spécifié à l’attribut du manifeste `applicationIdentity` pour former le chemin d’accès complet.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-160">lodctr will combine the specified manifest path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="9c2d3-161">Sinon, utilisez `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-161">Otherwise, use `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span></span> <span data-ttu-id="9c2d3-162">lodctr associe le chemin d’accès binaire spécifié à l' `applicationIdentity` attribut du manifeste pour former le chemin d’accès complet.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-162">lodctr will combine the specified binary path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="9c2d3-163">À des fins de diagnostic, vous pouvez inspecter le chemin d’accès complet enregistré en vérifiant la `ApplicationIdentity` valeur de la clé de Registre `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}` .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-163">For diagnostic purposes, you can inspect the recorded full path by checking the `ApplicationIdentity` value of registry key `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}`.</span></span>
  - <span data-ttu-id="9c2d3-164">Si le fichier binaire utilise MUI pour la localisation, veillez à copier le fichier MUI avec le fichier binaire.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-164">If the binary is using MUI for localization, be sure to copy the MUI file along with the binary.</span></span>
- <span data-ttu-id="9c2d3-165">Pendant la collection CounterSet, le consommateur utilise le chemin d’accès complet enregistré au fichier binaire du fournisseur pour rechercher et charger les chaînes nécessaires à partir des ressources du binaire du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-165">During counterset collection, the consumer uses the recorded full path to the provider binary to locate and load the necessary strings from the provider binary's resources.</span></span>

### <a name="using-the-generated-code-file-in-a-user-mode-provider"></a><span data-ttu-id="9c2d3-166">Utilisation du fichier de code généré dans un fournisseur en mode utilisateur</span><span class="sxs-lookup"><span data-stu-id="9c2d3-166">Using the generated code file in a user-mode provider</span></span>

<span data-ttu-id="9c2d3-167">L’outil CTRPP génère un `.h` fichier de code C/C++.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-167">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="9c2d3-168">Si l’attribut du manifeste du fournisseur `providerType` a la valeur `userMode` , le fichier de code généré contient les définitions suivantes qui sont utiles pour le codage d’un fournisseur en mode utilisateur :</span><span class="sxs-lookup"><span data-stu-id="9c2d3-168">If the provider manifest's `providerType` attribute is set to `userMode`, the generated code file will contain the following definitions that are helpful in coding a user-mode provider:</span></span>

- <span data-ttu-id="9c2d3-169">Une fonction d’initialisation du fournisseur nommée [ \* **préfixe \* CounterInitialize**](counterinitialize.md).</span><span class="sxs-lookup"><span data-stu-id="9c2d3-169">An provider initialization function named [\***prefix\*CounterInitialize**](counterinitialize.md).</span></span>
- <span data-ttu-id="9c2d3-170">Une fonction de nettoyage du fournisseur nommée [ \* **préfixe \* CounterCleanup**](countercleanup.md).</span><span class="sxs-lookup"><span data-stu-id="9c2d3-170">A provider cleanup function named [\***prefix\*CounterCleanup**](countercleanup.md).</span></span>
- <span data-ttu-id="9c2d3-171">Variable globale \***Provider** _ qui stocke le handle du fournisseur ouvert par la fonction _ \*_prefix_CounterInitialize\*\*.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-171">A global ***provider** _ variable that stores the provider handle opened by the _ *_prefix_CounterInitialize** function.</span></span> <span data-ttu-id="9c2d3-172">Le nom de la variable est la valeur de l' `symbol` attribut de l' `provider` élément dans le manifeste.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-172">The variable's name is the value of the `symbol` attribute of the `provider` element in the manifest.</span></span> <span data-ttu-id="9c2d3-173">Cette variable doit être utilisée dans les appels à `PerfCreateInstance` , `PerfDeleteInstance` et à d’autres API pour contrôler les données de votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-173">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="9c2d3-174">Pour chaque CounterSet, une variable \*\*GUID \* CounterSet \*\*\* globale avec le GUID du CounterSet.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-174">For each counterset, a global \***counterset\*GUID** variable with the counterset GUID.</span></span> <span data-ttu-id="9c2d3-175">Le nom de la variable est la valeur de l’attribut de l' `counterSet` élément `symbol` plus le suffixe « GUID », par exemple `MyCounterSetGUID` .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-175">The variable's name is the value of the `counterSet` element's `symbol` attribute plus the suffix "GUID", e.g. `MyCounterSetGUID`.</span></span> <span data-ttu-id="9c2d3-176">Cette variable doit être utilisée dans les appels à `PerfCreateInstance` , `PerfDeleteInstance` et à d’autres API pour contrôler les données de votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-176">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="9c2d3-177">Pour chaque compteur, une macro de ***compteur*** avec la valeur du compteur `id` .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-177">For each counter, a ***counter*** macro with the counter's `id` value.</span></span> <span data-ttu-id="9c2d3-178">Le nom de la macro est la valeur de l’attribut de l' `counter` élément `symbol` .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-178">The macro's name is the value of the `counter` element's `symbol` attribute.</span></span> <span data-ttu-id="9c2d3-179">Cette macro doit être utilisée dans les appels à `PerfSetCounterRefValue` , `PerfSetULongLongCounterValue` et à d’autres API pour définir les données de votre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-179">This macro should be used in calls to `PerfSetCounterRefValue`, `PerfSetULongLongCounterValue`, and other APIs for setting your provider's data.</span></span>

<span data-ttu-id="9c2d3-180">Dans les noms de fonction, ***prefix*** fait référence à la valeur du `-prefix` paramètre de ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-180">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="9c2d3-181">Si le `-prefix` paramètre n’est pas utilisé, les fonctions sont nommées `CounterInitialize` et `CounterCleanup` .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-181">If the `-prefix` parameter is not used the functions will be named `CounterInitialize` and `CounterCleanup`.</span></span>

### <a name="using-the-generated-code-file-in-a-kernel-mode-provider"></a><span data-ttu-id="9c2d3-182">Utilisation du fichier de code généré dans un fournisseur en mode noyau</span><span class="sxs-lookup"><span data-stu-id="9c2d3-182">Using the generated code file in a kernel-mode provider</span></span>

<span data-ttu-id="9c2d3-183">L’outil CTRPP génère un `.h` fichier de code C/C++.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-183">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="9c2d3-184">Si l’attribut du manifeste du fournisseur `providerType` a la valeur `kernelMode` , le fichier de code généré contient les définitions suivantes qui sont utiles pour coder les countersets d’un fournisseur en mode noyau :</span><span class="sxs-lookup"><span data-stu-id="9c2d3-184">If the provider manifest's `providerType` attribute is set to `kernelMode`, the generated code file will contain the following definitions that are helpful in coding a kernel-mode provider's countersets:</span></span>

- <span data-ttu-id="9c2d3-185">Une fonction d’initialisation CounterSet nommée <b> *prefix* Register *CounterSet*</b>.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-185">A counterset initialization function named <b>*prefix* Register *Counterset*</b>.</span></span> <span data-ttu-id="9c2d3-186">Cette fonction remplit une structure [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) , puis appelle [PcwRegister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister), en plaçant le handle d’inscription du CounterSet résultant dans la variable globale ***CounterSet*** .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-186">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure then invokes [PcwRegister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister), putting the resulting counterset registration handle into the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="9c2d3-187">Une fonction de nettoyage du <b> *CounterSet nommée* Unregister *CounterSet*</b>.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-187">A counterset cleanup function named <b>*prefix* Unregister *Counterset*</b>.</span></span> <span data-ttu-id="9c2d3-188">Cette fonction appelle [PcwUnregister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) sur le handle d’inscription du CounterSet dans la variable globale ***CounterSet*** .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-188">This function invokes [PcwUnregister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) on the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="9c2d3-189">Une fonction de création d’instance nommée <b> *prefix* Create *CounterSet*</b>.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-189">An instance creation function named <b>*prefix* Create *Counterset*</b>.</span></span> <span data-ttu-id="9c2d3-190">Cette fonction remplit un tableau de structures [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) , puis appelle [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) à l’aide du handle d’inscription du CounterSet dans la variable globale ***CounterSet*** .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-190">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) using the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="9c2d3-191">Une fonction de nettoyage d’instance nommée « <b> *préfixe*», fermer *CounterSet*</b>.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-191">An instance cleanup function named <b>*prefix* Close *Counterset*</b>.</span></span> <span data-ttu-id="9c2d3-192">Cette fonction appelle [PcwCloseInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance).</span><span class="sxs-lookup"><span data-stu-id="9c2d3-192">This function invokes [PcwCloseInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance).</span></span>
- <span data-ttu-id="9c2d3-193">Une fonction de création de rapports d’instance nommée <b> *prefix* Add *CounterSet*</b> à utiliser à partir de la fonction de rappel du CounterSet.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-193">An instance reporting function named <b>*prefix* Add *Counterset*</b> to be used from the counterset callback function.</span></span> <span data-ttu-id="9c2d3-194">Cette fonction remplit un tableau de structures [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) , puis appelle [PcwAddInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance).</span><span class="sxs-lookup"><span data-stu-id="9c2d3-194">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwAddInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance).</span></span>
- <span data-ttu-id="9c2d3-195">**SDK Windows 20H1 et versions ultérieures :** Une fonction d’initialisation RegInfo nommée <b> *prefix* InitRegistrationInformation *CounterSet*</b> pour une utilisation dans des scénarios avancés.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-195">**Windows SDK 20H1 and later:** A RegInfo initialization function named <b>*prefix* InitRegistrationInformation *Counterset*</b> for use in advanced scenarios.</span></span> <span data-ttu-id="9c2d3-196">Cette fonction remplit une structure [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) .</span><span class="sxs-lookup"><span data-stu-id="9c2d3-196">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure.</span></span> <span data-ttu-id="9c2d3-197">Cette fonction peut être utilisée dans les cas où le <b>Registre de *préfixe* généré *CounterSet*</b> ne répond pas à vos besoins, par exemple lorsque vous souhaitez personnaliser les valeurs dans la structure RegInfo ou lorsque vous souhaitez stocker le handle retourné dans une autre variable.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-197">This function can be used in cases where the generated <b>*prefix* Register *Counterset*</b> does not meet your needs, e.g. when you want to customize the values in the RegInfo structure or when you want to store the returned handle in another variable.</span></span>

<span data-ttu-id="9c2d3-198">Dans les noms de fonction, ***prefix*** fait référence à la valeur du `-prefix` paramètre de ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-198">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="9c2d3-199">Si le `-prefix` paramètre n’est pas utilisé, les fonctions n’ont pas de préfixe.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-199">If the `-prefix` parameter is not used the functions will have no prefix.</span></span>

> [!NOTE]
> <span data-ttu-id="9c2d3-200">La fonction <b>Add *CounterSet* de *préfixe*</b> générée est utilisée quand vous avez un rappel de CounterSet.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-200">The generated <b>*prefix* Add *Counterset*</b> function is used when you have a counterset callback.</span></span> <span data-ttu-id="9c2d3-201">Le <b> *préfixe* généré Create *CounterSet*</b> et le <b> *préfixe* de la fonction *CounterSet*</b> sont utilisés lorsque vous n’avez pas de rappel CounterSet.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-201">The generated <b>*prefix* Create *Counterset*</b> and <b>*prefix* Close *Counterset*</b> functions are used when you do not have a counterset callback.</span></span>

### <a name="using-the-generated-symbol-file"></a><span data-ttu-id="9c2d3-202">Utilisation du fichier de symboles généré</span><span class="sxs-lookup"><span data-stu-id="9c2d3-202">Using the generated symbol file</span></span>

<span data-ttu-id="9c2d3-203">Si le paramètre **-ch** est spécifié sur la ligne de commande, l’outil ctrpp génère un `.h` fichier de symboles.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-203">If the **-ch** parameter is specified on the command line, the CTRPP tool will generate a `.h` symbol file.</span></span> <span data-ttu-id="9c2d3-204">Ce fichier contient les symboles C/C++ pour les noms et les GUID de chaque CounterSet dans le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="9c2d3-204">This file contains the C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span> <span data-ttu-id="9c2d3-205">Les symboles peuvent être utilisés lors de l’écriture de programmes codés en dur pour consommer les données de ce CounterSet à l’aide des [fonctions de consommateur de Perflib v2](using-the-perflib-functions-to-consume-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="9c2d3-205">The symbols can be used when writing programs that are hard-coded to consume the data from this counterset using the [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md).</span></span>

## <a name="requirements"></a><span data-ttu-id="9c2d3-206">Configuration requise</span><span class="sxs-lookup"><span data-stu-id="9c2d3-206">Requirements</span></span>

|                         ||
|-------------------------|----
| <span data-ttu-id="9c2d3-207">Client minimal pris en charge</span><span class="sxs-lookup"><span data-stu-id="9c2d3-207">Minimum supported client</span></span>| <span data-ttu-id="9c2d3-208">Applications de \[ Bureau Windows Vista uniquement\]</span><span class="sxs-lookup"><span data-stu-id="9c2d3-208">Windows Vista \[desktop apps only\]</span></span>
| <span data-ttu-id="9c2d3-209">Serveur minimal pris en charge</span><span class="sxs-lookup"><span data-stu-id="9c2d3-209">Minimum supported server</span></span>| <span data-ttu-id="9c2d3-210">Applications de bureau Windows Server 2008 \[ uniquement\]</span><span class="sxs-lookup"><span data-stu-id="9c2d3-210">Windows Server 2008 \[desktop apps only\]</span></span>
