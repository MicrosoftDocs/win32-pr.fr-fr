---
description: Pour ouvrir un fichier journal en lecture, appelez PdhOpenQuery et spécifiez un chemin d’accès au fichier journal.
ms.assetid: 1d8f8662-df1f-4f84-8b65-c152f79cc5c6
title: Utilisation des fichiers journaux
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba2032b90036f8f58c07d8c7e80e7e7ac2b2701c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106524654"
---
# <a name="working-with-log-files"></a><span data-ttu-id="3c53f-103">Utilisation des fichiers journaux</span><span class="sxs-lookup"><span data-stu-id="3c53f-103">Working with Log Files</span></span>

<span data-ttu-id="3c53f-104">Pour ouvrir un fichier journal en lecture, appelez [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) et spécifiez un chemin d’accès au fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-104">To open a log file for reading, call [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) and specify a path to the log file.</span></span> <span data-ttu-id="3c53f-105">Pour ouvrir un fichier journal en écriture, vous devez appeler [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span><span class="sxs-lookup"><span data-stu-id="3c53f-105">To open a log file for writing, you must call [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span></span> <span data-ttu-id="3c53f-106">Pour fermer un fichier journal, appelez [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) ou [**PdhCloseLog**](/windows/desktop/api/Pdh/nf-pdh-pdhcloselog) selon la fonction que vous avez utilisée pour ouvrir le fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-106">To close a log file, call either [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) or [**PdhCloseLog**](/windows/desktop/api/Pdh/nf-pdh-pdhcloselog) depending on which function you used to open the log file.</span></span>

## <a name="reading-from-a-log-file"></a><span data-ttu-id="3c53f-107">Lire à partir d’un fichier journal</span><span class="sxs-lookup"><span data-stu-id="3c53f-107">Reading from a log file</span></span>

<span data-ttu-id="3c53f-108">La lecture des données de performances à partir d’un fichier journal est identique à la lecture de données à partir d’une source en temps réel. pour cela, vous pouvez ouvrir une requête, ajouter des compteurs à la requête et appeler [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) pour collecter un exemple à partir du fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-108">Reading performance data from a log file is the same as reading data from a real time source—you open a query, add counters to the query and call [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) to collect a sample from the log file.</span></span> <span data-ttu-id="3c53f-109">**PdhCollectQueryData** retourne PDH \_ aucune \_ \_ donnée quand vous atteignez la fin du fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-109">**PdhCollectQueryData** returns PDH\_NO\_MORE\_DATA when you reach the end of the log file.</span></span>

<span data-ttu-id="3c53f-110">Chaque exemple dans le fichier journal contient un horodatage pour le moment où il a été initialement collecté et écrit dans le fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-110">Each sample in the log file contains a time stamp for when it was originally collected and written to the log file.</span></span> <span data-ttu-id="3c53f-111">Pour récupérer l’horodatage du premier et du dernier échantillon dans le fichier journal, appelez la fonction [**PdhGetDataSourceTimeRange**](/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangea) .</span><span class="sxs-lookup"><span data-stu-id="3c53f-111">To retrieve the time stamp for the first and last sample in the log file, call the [**PdhGetDataSourceTimeRange**](/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangea) function.</span></span> <span data-ttu-id="3c53f-112">Si vous souhaitez limiter les exemples que vous avez lus dans le journal à un intervalle de temps spécifique, consultez [définition d’une plage de temps pour une requête](setting-a-time-range-for-a-query.md).</span><span class="sxs-lookup"><span data-stu-id="3c53f-112">If you want to limit the samples that you read from the log to a specific time range, see [Setting a Time Range for a Query](setting-a-time-range-for-a-query.md).</span></span>

<span data-ttu-id="3c53f-113">Si vous ne connaissez pas les objets de performance et les compteurs présents dans le fichier journal, vous pouvez appeler [**PdhEnumObjects**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsa) pour déterminer la liste des objets.</span><span class="sxs-lookup"><span data-stu-id="3c53f-113">If you do not know which performance objects and counters exist in the log file, you can call [**PdhEnumObjects**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsa) to determine the list of objects.</span></span> <span data-ttu-id="3c53f-114">À partir d’un objet, vous pouvez appeler [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa) ou [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) pour récupérer une liste des instances et des compteurs de l’objet contenus dans le fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-114">Given an object, you can call either [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa) or [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) to retrieve a list of the object's instances and counters contained in the log file.</span></span>

<span data-ttu-id="3c53f-115">Si vous appelez [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa), utilisez les listes d’instances et de compteurs pour créer un chemin d’accès pour chaque combinaison possible d’instance et de compteur.</span><span class="sxs-lookup"><span data-stu-id="3c53f-115">If you call [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa), use the instance and counter lists to create a path for each possible combination of instance and counter.</span></span> <span data-ttu-id="3c53f-116">Quand vous appelez [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) pour ajouter le compteur à la requête, la fonction échoue si le fichier journal ne contient pas la combinaison donnée.</span><span class="sxs-lookup"><span data-stu-id="3c53f-116">When you call [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) to add the counter to the query, the function will fail if the log file does not contain the given combination.</span></span>

<span data-ttu-id="3c53f-117">Si vous utilisez [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha), vous pouvez créer un chemin d’accès qui contient un caractère générique pour le nom et le compteur de l’instance, par exemple, \\ Object ( \* ) \\ \* .</span><span class="sxs-lookup"><span data-stu-id="3c53f-117">If you use [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha), you can create a path that contains a wildcard for the instance name and counter, for example, \\object(\*)\\\*.</span></span> <span data-ttu-id="3c53f-118">La fonction retourne le \_ \_ chemin d’accès PDH non valide si l’objet ne contient pas d’instance.</span><span class="sxs-lookup"><span data-stu-id="3c53f-118">The function returns PDH\_INVALID\_PATH if the object does not contain an instance.</span></span> <span data-ttu-id="3c53f-119">Dans ce cas, appelez **PdhExpandWildCardPath** à l’aide d’un caractère générique pour le compteur uniquement, par exemple, \\ Object \\ \* .</span><span class="sxs-lookup"><span data-stu-id="3c53f-119">In this case, call **PdhExpandWildCardPath** using a wildcard for counter only, for example, \\object\\\*.</span></span>

<span data-ttu-id="3c53f-120">Les systèmes d’exploitation plus récents peuvent lire les fichiers journaux qui ont été générés sur des systèmes d’exploitation plus anciens. Toutefois, les fichiers journaux créés sur Windows Vista et les systèmes d’exploitation ultérieurs ne peuvent pas être lus sur des systèmes d’exploitation antérieurs.</span><span class="sxs-lookup"><span data-stu-id="3c53f-120">Newer operating systems can read log files that were generated on older operating systems; however, log files that were created on Windows Vista and later operating systems cannot be read on earlier operating systems.</span></span>

<span data-ttu-id="3c53f-121">Pour obtenir un exemple qui lit des données à partir d’un fichier journal, consultez [lecture des données de performances à partir d’un fichier journal](reading-performance-data-from-a-log-file.md).</span><span class="sxs-lookup"><span data-stu-id="3c53f-121">For an example that reads data from a log file, see [Reading Performance Data from a Log File](reading-performance-data-from-a-log-file.md).</span></span>

## <a name="reading-from-multiple-log-files"></a><span data-ttu-id="3c53f-122">Lecture à partir de plusieurs fichiers journaux</span><span class="sxs-lookup"><span data-stu-id="3c53f-122">Reading from multiple log files</span></span>

<span data-ttu-id="3c53f-123">Si vous avez besoin de créer une requête qui lit à partir de plusieurs fichiers journaux, appelez [**PdhBindInputDataSource**](/windows/desktop/api/Pdh/nf-pdh-pdhbindinputdatasourcea) pour lier les fichiers journaux.</span><span class="sxs-lookup"><span data-stu-id="3c53f-123">If you need to create a query that reads from several log files, call the [**PdhBindInputDataSource**](/windows/desktop/api/Pdh/nf-pdh-pdhbindinputdatasourcea) to bind the log files together.</span></span> <span data-ttu-id="3c53f-124">Vous devez ensuite utiliser des fonctions PDH qui se terminent par « H », par exemple, [**PdhOpenQueryH**](/windows/desktop/api/Pdh/nf-pdh-pdhopenqueryh).</span><span class="sxs-lookup"><span data-stu-id="3c53f-124">You then need to use PDH functions that end in 'H', for example, [**PdhOpenQueryH**](/windows/desktop/api/Pdh/nf-pdh-pdhopenqueryh).</span></span>

## <a name="writing-to-a-log-file"></a><span data-ttu-id="3c53f-125">Écriture dans un fichier journal</span><span class="sxs-lookup"><span data-stu-id="3c53f-125">Writing to a log file</span></span>

<span data-ttu-id="3c53f-126">Avant d’écrire dans un fichier journal, appelez [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) pour créer une requête et spécifier la source des données de performances, qu’il s’agisse de données en temps réel ou d’un fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-126">Before writing to a log file, call [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) to create a query and specify the source of the performance data, either real time data or a log file.</span></span> <span data-ttu-id="3c53f-127">Ensuite, ajoutez les compteurs que vous souhaitez interroger.</span><span class="sxs-lookup"><span data-stu-id="3c53f-127">Then, add the counters that you want to query.</span></span>

<span data-ttu-id="3c53f-128">Pour ouvrir le fichier de destination, appelez [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span><span class="sxs-lookup"><span data-stu-id="3c53f-128">To open the destination file, call [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span></span> <span data-ttu-id="3c53f-129">Spécifiez la requête lorsque vous ouvrez le fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-129">Specify the query when you open the log file.</span></span> <span data-ttu-id="3c53f-130">Pour collecter les données de performances et les écrire dans le fichier journal, appelez [**PdhUpdateLog**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga).</span><span class="sxs-lookup"><span data-stu-id="3c53f-130">To collect the performance data and write it to the log file, call [**PdhUpdateLog**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga).</span></span>

<span data-ttu-id="3c53f-131">Si les données du compteur sont écrites dans un fichier journal délimité par des virgules (. csv) ou délimité par des tabulations (. TSV) et que le chemin d’accès contient une instance générique, le chemin d’accès est développé et seules les instances qui existent au moment où le chemin d’accès est développé sont incluses dans le fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-131">If the counter data is being written to comma-delimited (.csv) or tab-delimited (.tsv) log file and the path contains a wildcard instance, the path is expanded and only those instances that exist at the time the path is expanded are included in the log file.</span></span> <span data-ttu-id="3c53f-132">Toutefois, pour les fichiers journaux binaires (. BLG) ou SQL, le caractère générique n’est pas développé afin que le fichier journal contienne des instances créées lors de la journalisation.</span><span class="sxs-lookup"><span data-stu-id="3c53f-132">However, for binary (.blg) or SQL log files, the wildcard is not expanded so that the log file contains instances that are created during logging.</span></span>

<span data-ttu-id="3c53f-133">Pour obtenir un exemple qui écrit des données dans un fichier journal, consultez [écriture de données de performances dans un fichier journal](writing-performance-data-to-a-log-file.md).</span><span class="sxs-lookup"><span data-stu-id="3c53f-133">For an example that writes data to a log file, see [Writing Performance Data to a Log File](writing-performance-data-to-a-log-file.md).</span></span>

## <a name="compressing-a-log-file"></a><span data-ttu-id="3c53f-134">Compression d’un fichier journal</span><span class="sxs-lookup"><span data-stu-id="3c53f-134">Compressing a log file</span></span>

<span data-ttu-id="3c53f-135">Vous pouvez utiliser la fonction [**PdhComputeCounterStatistics**](/windows/desktop/api/Pdh/nf-pdh-pdhcomputecounterstatistics) pour compresser un fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-135">You can use the [**PdhComputeCounterStatistics**](/windows/desktop/api/Pdh/nf-pdh-pdhcomputecounterstatistics) function to compress a log file.</span></span> <span data-ttu-id="3c53f-136">Par exemple, lisez dix enregistrements dans un fichier journal, appelez **PdhComputeCounterStatistics** pour calculer la valeur moyenne, puis écrivez la valeur moyenne dans un fichier journal de sortie.</span><span class="sxs-lookup"><span data-stu-id="3c53f-136">For example, read ten records from a log file, call **PdhComputeCounterStatistics** to compute the mean value and then write the mean value to an output log file.</span></span>

<span data-ttu-id="3c53f-137">La rubrique suivante fournit des informations supplémentaires sur l’utilisation d’un fichier journal.</span><span class="sxs-lookup"><span data-stu-id="3c53f-137">The following topic provides additional information on using a log file.</span></span>

-   [<span data-ttu-id="3c53f-138">Obtention de la taille d’un fichier journal</span><span class="sxs-lookup"><span data-stu-id="3c53f-138">Getting the Size of a Log File</span></span>](getting-the-size-of-a-log-file.md)

 

 



