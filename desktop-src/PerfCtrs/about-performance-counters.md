---
description: Les compteurs sont utilisés pour fournir des informations sur le fonctionnement du système d’exploitation ou d’une application, d’un service ou d’un pilote.
ms.assetid: d172a131-61d3-4fc1-8e0c-b07b2bd34f80
title: À propos des compteurs de performance
ms.topic: article
ms.date: 08/17/2020
ms.openlocfilehash: dec7c71e99ab614ee64e3d1e8c9620f0be78c14a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103865137"
---
# <a name="about-performance-counters"></a><span data-ttu-id="5e1a7-103">À propos des compteurs de performance</span><span class="sxs-lookup"><span data-stu-id="5e1a7-103">About Performance Counters</span></span>

<span data-ttu-id="5e1a7-104">Les compteurs de performances Windows fournissent une couche d’abstraction de haut niveau avec une interface cohérente pour la collecte de différents types de données système telles que les statistiques d’utilisation du processeur, de la mémoire et du disque.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-104">Windows Performance Counters provide a high-level abstraction layer with a consistent interface for collecting various kinds of system data such as CPU, memory, and disk usage statistics.</span></span> <span data-ttu-id="5e1a7-105">Les administrateurs système utilisent des compteurs de performances pour surveiller les problèmes de performances ou de comportement.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-105">System administrators use performance counters to monitor for performance or behavior problems.</span></span> <span data-ttu-id="5e1a7-106">Les développeurs de logiciels utilisent des compteurs de performances pour inspecter l’utilisation des ressources de leurs composants.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-106">Software developers use performance counters to inspect the resource usage of their components.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5e1a7-107">Les compteurs de performances Windows sont optimisés pour la découverte et la collecte des données d’administration/de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-107">Windows Performance Counters are optimized for administrative/diagnostic data discovery and collection.</span></span> <span data-ttu-id="5e1a7-108">Ils ne sont pas appropriés pour la collecte de données à haute fréquence ou pour le profilage d’application, car ils ne sont pas conçus pour être collectés plusieurs fois par seconde.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-108">They are not appropriate for high-frequency data collection or for application profiling since they are not designed to be collected more than once per second.</span></span> <span data-ttu-id="5e1a7-109">Pour un accès plus faible aux informations système, vous pouvez préférer des API plus directes, telles que [**Process Status Helper**](../psapi/process-status-helper.md), [**GlobalMemoryStatusEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex), [**GetSystemTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getsystemtimes)ou [**fonction getprocesstimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocesstimes).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-109">For lower-overhead access to system information, you might prefer more direct APIs such as [**Process Status Helper**](../psapi/process-status-helper.md), [**GlobalMemoryStatusEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex), [**GetSystemTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getsystemtimes), or [**GetProcessTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocesstimes).</span></span> <span data-ttu-id="5e1a7-110">Pour le profilage, vous pouvez collecter des journaux ETW avec les données de profilage système à l’aide de [**tracelog.exe**](/windows-hardware/drivers/devtest/tracelog) avec des `-critsec` options, `-dpcisr` , `-eflag` ou `-ProfileSource` , ou vous pouvez utiliser le [**profilage des compteurs matériels**](/previous-versions/windows/desktop/hcp/hcp-reference).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-110">For profiling, you might collect ETW logs with system profiling data using [**tracelog.exe**](/windows-hardware/drivers/devtest/tracelog) with `-critsec`, `-dpcisr`, `-eflag`, or `-ProfileSource` options, or you might use [**Hardware Counter Profiling**](/previous-versions/windows/desktop/hcp/hcp-reference).</span></span>

> [!NOTE]
> <span data-ttu-id="5e1a7-111">Ne confondez pas les compteurs de performances Windows avec l’API [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) .</span><span class="sxs-lookup"><span data-stu-id="5e1a7-111">Do not confuse Windows Performance Counters with the [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) API.</span></span> <span data-ttu-id="5e1a7-112">Les compteurs de performances Windows fournissent une abstraction de haut niveau pour de nombreux types d’informations système.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-112">Windows Performance Counters provide a high-level abstraction for many kinds of system information.</span></span> <span data-ttu-id="5e1a7-113">La fonction QueryPerformanceCounter fournit un accès optimisé à un horodatage haute précision.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-113">The QueryPerformanceCounter function provides optimized access to a high-precision timestamp.</span></span>

## <a name="getting-started"></a><span data-ttu-id="5e1a7-114">Mise en route</span><span class="sxs-lookup"><span data-stu-id="5e1a7-114">Getting Started</span></span>

- <span data-ttu-id="5e1a7-115">Utilisez les [outils de compteur de performance](performance-counters-tools.md) lorsque vous souhaitez collecter ou afficher les données de performances d’un système.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-115">Use [Performance Counter Tools](performance-counters-tools.md) when you want to collect or view the performance data from a system.</span></span>
- <span data-ttu-id="5e1a7-116">Utilisez les [API de collection de compteurs de performance](consuming-counter-data.md) lorsque vous souhaitez écrire un script ou un programme qui collecte les données de performances à partir du système local.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-116">Use [Performance Counter Collection APIs](consuming-counter-data.md) when you want to write a script or a program that collects performance data from the local system.</span></span>
- <span data-ttu-id="5e1a7-117">Utilisez les [classes de compteur de performances WMI](/windows/desktop/WmiSdk/monitoring-performance-data) lorsque vous souhaitez collecter des données de performances à partir d’un système local ou distant à l’aide de WMI.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-117">Use [WMI Performance Counter Classes](/windows/desktop/WmiSdk/monitoring-performance-data) when you want to collect performance data from a local or remote system using WMI.</span></span>
- <span data-ttu-id="5e1a7-118">Utilisez les [API du fournisseur de compteurs de performance](providing-counter-data.md) lorsque vous souhaitez publier des données de performances à partir de votre composant logiciel.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-118">Use [Performance Counter Provider APIs](providing-counter-data.md) when you want to publish performance data from your software component.</span></span>

## <a name="concepts"></a><span data-ttu-id="5e1a7-119">Concepts</span><span class="sxs-lookup"><span data-stu-id="5e1a7-119">Concepts</span></span>

<span data-ttu-id="5e1a7-120">Le système de compteurs de performances Windows est organisé en **consommateurs**, **fournisseurs**, **countersets**, **compteurs**, **instances** et **valeurs de compteur**.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-120">The Windows Performance Counter system is organized into **consumers**, **providers**, **countersets**, **counters**, **instances**, and **counter values**.</span></span>

<span data-ttu-id="5e1a7-121">Un **consommateur** est un composant logiciel qui utilise des données de performances.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-121">A **consumer** is a software component that makes use of performance data.</span></span> <span data-ttu-id="5e1a7-122">Windows comprend plusieurs [outils intégrés](performance-counters-tools.md) qui utilisent des données de performances.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-122">Windows includes several [built-in tools](performance-counters-tools.md) that make use of performance data.</span></span> <span data-ttu-id="5e1a7-123">Il s’agit notamment du gestionnaire des tâches, du moniteur de ressource, de l’analyseur de performances, d' typeperf.exe, logman.exe et relog.exe.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-123">These include Task Manager, Resource Monitor, Performance Monitor, typeperf.exe, logman.exe, and relog.exe.</span></span> <span data-ttu-id="5e1a7-124">Les développeurs peuvent écrire des scripts et des applications qui accèdent aux compteurs de performances via des [API de compteur de performances](consuming-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-124">Developers can write scripts and applications that access performance counters via [performance counter APIs](consuming-counter-data.md).</span></span>

<span data-ttu-id="5e1a7-125">Un **fournisseur** est un composant logiciel qui [génère et publie des données de performances](providing-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-125">A **provider** is a software component that [generates and publishes performance data](providing-counter-data.md).</span></span> <span data-ttu-id="5e1a7-126">Un fournisseur publiera des données pour un ou plusieurs *countersets*.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-126">A provider will publish data for one or more *countersets*.</span></span> <span data-ttu-id="5e1a7-127">Par exemple, un système de base de données peut s’inscrire lui-même en tant que fournisseur de données de performances.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-127">For example, a database system might register itself as a performance data provider.</span></span>

- <span data-ttu-id="5e1a7-128">Un **fournisseur v1** est un composant logiciel qui publie des données de performances à l’aide d’une [dll de performance](providing-counter-data-using-a-performance-dll.md) qui s’exécute dans le processus du consommateur.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-128">A **V1 provider** is a software component that publishes performance data via a [performance DLL](providing-counter-data-using-a-performance-dll.md) that runs in the process of the consumer.</span></span> <span data-ttu-id="5e1a7-129">Un fournisseur v1 est installé sur un système par le biais d’un `.ini` fichier.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-129">A V1 provider is installed onto a system via an `.ini` file.</span></span> <span data-ttu-id="5e1a7-130">L’architecture du fournisseur v1 est déconseillée.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-130">The V1 provider architecture is deprecated.</span></span> <span data-ttu-id="5e1a7-131">Les nouveaux fournisseurs doivent utiliser l’architecture du fournisseur v2.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-131">New providers should use the V2 provider architecture.</span></span>
- <span data-ttu-id="5e1a7-132">Un **fournisseur v2** est un composant logiciel qui publie les données de performances via les [API du fournisseur de compteurs de performance](providing-counter-data-using-version-2-0.md).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-132">A **V2 provider** is a software component that publishes performance data via the [performance counter provider APIs](providing-counter-data-using-version-2-0.md).</span></span> <span data-ttu-id="5e1a7-133">Un fournisseur v2 est installé sur un système via un `.man` fichier (manifeste XML).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-133">A V2 provider is installed onto a system via a `.man` (XML manifest) file.</span></span>

<span data-ttu-id="5e1a7-134">Un **CounterSet** est un regroupement de données de performances au sein d’un fournisseur.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-134">A **counterset** is a grouping of performance data within a provider.</span></span> <span data-ttu-id="5e1a7-135">Un CounterSet a un nom et un ou plusieurs *compteurs*.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-135">A counterset has a name and one or more *counters*.</span></span> <span data-ttu-id="5e1a7-136">La collecte des données à partir d’un CounterSet retourne un certain nombre d' *instances*.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-136">Collecting the data from a counterset returns a number of *instances*.</span></span> <span data-ttu-id="5e1a7-137">Dans certaines API Windows, les countersets sont appelés **objets de performance**.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-137">In some Windows APIs, countersets are called **performance objects**.</span></span> <span data-ttu-id="5e1a7-138">Par exemple, un fournisseur de données de performances pour un système de base de données peut fournir un CounterSet pour les statistiques par base de données.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-138">For example, a performance data provider for a database system might provide a counterset for per-database statistics.</span></span>

<span data-ttu-id="5e1a7-139">Un **compteur** est la définition d’un élément de données de performances unique.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-139">A **counter** is the definition of single piece of performance data.</span></span> <span data-ttu-id="5e1a7-140">Un compteur a un nom et un type.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-140">A counter has a name and a type.</span></span> <span data-ttu-id="5e1a7-141">Par exemple, un CounterSet « statistiques par base de données » peut contenir un compteur nommé « transactions par seconde » avec le type `PERF_COUNTER_COUNTER` .</span><span class="sxs-lookup"><span data-stu-id="5e1a7-141">For example, a "per-database statistics" counterset might contain a counter named "transactions per second" with type `PERF_COUNTER_COUNTER`.</span></span>

<span data-ttu-id="5e1a7-142">Une **instance** est une entité sur laquelle les données de performance sont signalées.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-142">An **instance** is an entity about which performance data is reported.</span></span> <span data-ttu-id="5e1a7-143">Une instance a un nom (chaîne) et une ou plusieurs *valeurs de compteur*.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-143">An instance has a name (string) and one or more *counter values*.</span></span> <span data-ttu-id="5e1a7-144">Par exemple, un CounterSet « statistiques par base de données » peut contenir une instance par base de données.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-144">For example, a "per-database statistics" counterset might contain one instance per database.</span></span> <span data-ttu-id="5e1a7-145">Le nom de l’instance est le nom de la base de données, et chaque instance contient des valeurs de compteur pour les compteurs « transactions par seconde », « utilisation de la mémoire » et « utilisation du disque ».</span><span class="sxs-lookup"><span data-stu-id="5e1a7-145">The instance name would be the database name, and each instance would contain counter values for "transactions per second", "memory usage", and "disk usage" counters.</span></span>

<span data-ttu-id="5e1a7-146">Une **valeur de compteur** est la valeur d’un seul élément de données de compteur de performance.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-146">A **counter value** is the value of a single piece of performance counter data.</span></span> <span data-ttu-id="5e1a7-147">Une valeur de compteur est un entier non signé, 32 bits ou 64 bits selon le type du compteur correspondant.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-147">A counter value is an unsigned integer, either 32-bit or 64-bit depending on the type of the corresponding counter.</span></span> <span data-ttu-id="5e1a7-148">Lorsque vous parlez d’une *instance*, une *valeur de compteur* peut parfois être appelée un *compteur* ou une *valeur*.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-148">When talking about an *instance*, a *counter value* might sometimes be called a *counter* or a *value*.</span></span>

> [!TIP]
> <span data-ttu-id="5e1a7-149">Il peut être utile de mettre en relation les termes du compteur de performance avec des termes de feuille de calcul plus familiers.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-149">It might be helpful to relate performance counter terms to more familiar spreadsheet terms.</span></span> <span data-ttu-id="5e1a7-150">Un **CounterSet** est semblable à une table.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-150">A **counterset** is like a table.</span></span> <span data-ttu-id="5e1a7-151">Un **compteur** est semblable à une colonne.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-151">A **counter** is like a column.</span></span> <span data-ttu-id="5e1a7-152">Une **instance** est comme une ligne.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-152">An **instance** is like a row.</span></span> <span data-ttu-id="5e1a7-153">Une **valeur de compteur** est semblable à une cellule dans la table.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-153">A **counter value** is like a cell in the table.</span></span>

<span data-ttu-id="5e1a7-154">Les **countersets à instance unique** contiennent toujours des données pour une seule instance.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-154">**Single-instance countersets** always contain data for exactly one instance.</span></span> <span data-ttu-id="5e1a7-155">Cela est courant pour les countersets qui signalent des statistiques système-globales.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-155">This is common for countersets that report system-global statistics.</span></span> <span data-ttu-id="5e1a7-156">Par exemple, Windows dispose d’un CounterSet intégré à instance unique nommé « Memory » qui rend compte de l’utilisation de la mémoire globale.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-156">For example, Windows has a built-in single-instance counterset named "Memory" that reports on global memory usage.</span></span>

<span data-ttu-id="5e1a7-157">Les **Countersets multi-instances** contiennent des données pour un nombre variable d’instances.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-157">**Multi-instance countersets** contain data for a variable number of instances.</span></span> <span data-ttu-id="5e1a7-158">Cela est courant pour les countersets qui signalent des entités dans le système.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-158">This is common for countersets that report about entities within the system.</span></span> <span data-ttu-id="5e1a7-159">Par exemple, Windows dispose d’un CounterSet intégré à plusieurs instances nommé « informations sur le processeur » qui signale une instance pour chaque UC installée.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-159">For example, Windows has a built-in multi-instance counterset named "Processor Information" that reports one instance for each installed CPU.</span></span>

<span data-ttu-id="5e1a7-160">Les consommateurs recueillent et enregistrent périodiquement les données du CounterSet d’un fournisseur.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-160">Consumers will periodically collect and record the data from a provider's counterset.</span></span> <span data-ttu-id="5e1a7-161">Par exemple, le consommateur peut collecter des données une fois par seconde ou une fois par minute.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-161">For example, the consumer might collect data once per second or once per minute.</span></span> <span data-ttu-id="5e1a7-162">Les données collectées sont appelées **exemples**.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-162">The data collected is called a **sample**.</span></span> <span data-ttu-id="5e1a7-163">Un exemple se compose d’horodatages et de données pour les instances du CounterSet.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-163">A sample consists of timestamps along with the data for instances of the counterset.</span></span> <span data-ttu-id="5e1a7-164">Les données de chaque instance incluent le nom de l’instance (chaîne) et un ensemble de valeurs de compteur (entiers, une valeur pour chaque compteur dans le CounterSet).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-164">The data for each instance includes the instance name (string) and a set of counter values (integers, one value for each counter in the counterset).</span></span>

<span data-ttu-id="5e1a7-165">Les noms d’instance doivent normalement être uniques dans un exemple, c’est-à-dire qu’un fournisseur ne doit pas retourner deux instances du même nom dans le cadre d’un seul échantillon.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-165">Instance names should normally be unique within a sample, i.e. a provider should not return two instances with the same name as part of a single sample.</span></span> <span data-ttu-id="5e1a7-166">Certains fournisseurs plus anciens ne respectant pas cette règle, les [consommateurs doivent être en mesure de tolérer des noms d’instance non uniques](handling-duplicate-instance-names.md).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-166">Some older providers do not follow this rule, so [consumers must be able to tolerate non-unique instance names](handling-duplicate-instance-names.md).</span></span> <span data-ttu-id="5e1a7-167">Comme les noms d’instance ne respectent pas la casse, les instances ne doivent pas avoir de noms qui diffèrent uniquement par la casse.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-167">Instance names are not case-sensitive, so instances should not have names that differ only in case.</span></span>

> [!NOTE]
> <span data-ttu-id="5e1a7-168">Pour des raisons de compatibilité descendante, le CounterSet « Process » retourne des noms d’instance non uniques en fonction du nom de fichier EXE.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-168">For backwards-compatibility reasons, the "Process" counterset returns non-unique instance names based on the EXE filename.</span></span> <span data-ttu-id="5e1a7-169">Cela peut entraîner des résultats confus, en particulier lorsqu’un processus avec un nom non unique démarre ou s’arrête, car cela entraîne généralement des problèmes de données en raison d’une correspondance incorrecte des noms d’instance entre les exemples.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-169">This can cause confusing results, especially when a process with a non-unique name starts up or shuts down, as this will typically result in data glitches due to incorrect matching of instance names between samples.</span></span> <span data-ttu-id="5e1a7-170">Les consommateurs du CounterSet « process » doivent pouvoir tolérer ces noms d’instance non uniques et les problèmes de données résultants.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-170">Consumers of of the "Process" counterset must be able to tolerate these non-unique instance names and the resulting data glitches.</span></span>

<span data-ttu-id="5e1a7-171">Les noms d’instance doivent être stables entre les exemples, c’est-à-dire qu’un fournisseur doit utiliser le même nom d’instance pour la même entité chaque fois que le CounterSet est collecté.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-171">Instance names must be stable across samples, i.e. a provider should use the same instance name for the same entity each time the counterset is collected.</span></span>

<span data-ttu-id="5e1a7-172">Chaque compteur a un type.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-172">Each counter has a type.</span></span> <span data-ttu-id="5e1a7-173">Le type de compteur indique le type de la **valeur brute** du compteur (entier non signé 32 bits ou entier 64 bits non signé).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-173">The counter type indicates the type of the counter's **raw value** (either unsigned 32-bit integer or unsigned 64-bit integer).</span></span> <span data-ttu-id="5e1a7-174">Le type de compteur indique également ce que représente la valeur brute du compteur, qui détermine comment la valeur brute doit être traitée pour générer des statistiques utiles.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-174">The counter type also indicates what the counter's raw value represents, which determines how the raw value should be processed to generate useful statistics.</span></span>

<span data-ttu-id="5e1a7-175">Alors que certains types de compteurs sont simples et ont une valeur brute qui est directement utile, de nombreux types de compteurs nécessitent un [traitement supplémentaire](calculating-counter-values.md) pour créer une **valeur mise en forme** utile.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-175">While some counter types are simple and have a raw value that is directly useful, many counter types require [additional processing](calculating-counter-values.md) to create a useful **formatted value**.</span></span> <span data-ttu-id="5e1a7-176">Pour produire la valeur mise en forme, certains types de compteurs requièrent des valeurs brutes de deux exemples, certains types de compteurs requièrent des horodateurs, et certains types de compteurs requièrent des valeurs brutes de plusieurs compteurs.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-176">To produce the formatted value, some counter types require raw values from two samples, some counter types require timestamps, and some counter types require raw values from multiple counters.</span></span> <span data-ttu-id="5e1a7-177">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="5e1a7-177">For example:</span></span>

- <span data-ttu-id="5e1a7-178">`PERF_COUNTER_LARGE_RAWCOUNT` est une valeur brute de 64 bits qui ne nécessite aucun traitement.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-178">`PERF_COUNTER_LARGE_RAWCOUNT` is a 64-bit raw value that requires no processing to be useful.</span></span> <span data-ttu-id="5e1a7-179">Il convient pour les valeurs à un point dans le temps, telles que « octets de mémoire en cours d’utilisation ».</span><span class="sxs-lookup"><span data-stu-id="5e1a7-179">It is appropriate for point-in-time values such as "Bytes of memory in use".</span></span>
- <span data-ttu-id="5e1a7-180">`PERF_COUNTER_RAWCOUNT_HEX` est une valeur brute de 32 bits qui requiert uniquement une mise en forme hexadécimale simple.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-180">`PERF_COUNTER_RAWCOUNT_HEX` is a 32-bit raw value that requires only simple hexadecimal formatting to be useful.</span></span> <span data-ttu-id="5e1a7-181">Il convient à un point dans le temps ou à des informations d’identification telles que « Flags » ou « adresse de base ».</span><span class="sxs-lookup"><span data-stu-id="5e1a7-181">It is appropriate for point-in-time or identifying information such as "Flags" or "Base Address".</span></span>
- <span data-ttu-id="5e1a7-182">`PERF_COUNTER_BULK_COUNT` est une valeur brute de 64 bits qui indique le nombre d’événements et est utilisée pour calculer la vitesse à laquelle les événements se produisent.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-182">`PERF_COUNTER_BULK_COUNT` is a 64-bit raw value that indicates a count of events and is used to compute the rate at which the events occur.</span></span> <span data-ttu-id="5e1a7-183">Pour être utile, ce type de compteur requiert deux exemples qui sont séparés dans le temps.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-183">To be useful, this counter type requires two samples that are separated in time.</span></span> <span data-ttu-id="5e1a7-184">La valeur mise en forme est le taux d’événements, c’est-à-dire le nombre de fois où l’événement s’est produit par seconde sur l’intervalle entre les deux échantillons.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-184">The formatted value is the event rate, i.e. the number of times the event occurred per second over the interval between the two samples.</span></span> <span data-ttu-id="5e1a7-185">À partir de deux exemples `s0` et `s1` , la valeur mise en forme (taux d’événements) est calculée sous la forme `(s1.EventCount - s0.EventCount)/(s1.TimestampInSeconds - s0.TimestampInSeconds)` .</span><span class="sxs-lookup"><span data-stu-id="5e1a7-185">Given two samples `s0` and `s1`, the formatted value (event rate) would be computed as `(s1.EventCount - s0.EventCount)/(s1.TimestampInSeconds - s0.TimestampInSeconds)`.</span></span>

<span data-ttu-id="5e1a7-186">Les fournisseurs doivent se comporter comme s’ils étaient sans État. par exemple, la collecte de données à partir d’un CounterSet ne doit pas affecter l’état du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-186">Providers are expected to behave as if they are stateless, i.e. collecting data from a counterset should not visibly affect the state of the provider.</span></span> <span data-ttu-id="5e1a7-187">Par exemple, un fournisseur ne doit pas réinitialiser les valeurs de compteur à 0 lorsqu’un CounterSet est collecté et qu’il ne doit pas utiliser l’horodateur d’une collection précédente pour ajuster les valeurs de la collection actuelle.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-187">For example, a provider should not reset counter values to 0 when a counterset is collected and it should not use the timestamp of a previous collection to adjust the values in the current collection.</span></span> <span data-ttu-id="5e1a7-188">Au lieu de cela, il doit fournir des valeurs de compteur brutes simples avec des types exacts afin que le consommateur puisse calculer des statistiques utiles en fonction des valeurs brutes et de leurs horodateurs.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-188">Instead, it should provide simple raw counter values with accurate types so that the consumer can compute useful statistics based on the raw values and their timestamps.</span></span>

## <a name="performance-api-architecture"></a><span data-ttu-id="5e1a7-189">Architecture de l’API de performances</span><span class="sxs-lookup"><span data-stu-id="5e1a7-189">Performance API Architecture</span></span>

![Les applications de compteur de performance appellent des API Windows qui appellent des fournisseurs pour obtenir des données de performances.](images/architecture.png)

<span data-ttu-id="5e1a7-191">Les consommateurs des compteurs de performances sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="5e1a7-191">Performance counter consumers include:</span></span>

- <span data-ttu-id="5e1a7-192">[Applications fournies par Microsoft](performance-counters-tools.md) , telles que le gestionnaire des tâches, les moniteur de ressource, l’analyseur de performances et les typeperf.exe.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-192">[Microsoft-provided applications](performance-counters-tools.md) such as Task Manager, Resource Monitor, Performance Monitor, and typeperf.exe.</span></span>
- <span data-ttu-id="5e1a7-193">Surfaces d’API de haut niveau fournies par Microsoft qui exposent des données de compteurs de performances telles que les [classes de performance WMI](/windows/desktop/WmiSdk/monitoring-performance-data).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-193">Microsoft-provided high-level API surfaces that expose performance counter data such as [WMI Performance Classes](/windows/desktop/WmiSdk/monitoring-performance-data).</span></span>
- <span data-ttu-id="5e1a7-194">Vos propres applications ou scripts qui utilisent des [API de consommateur de compteur de performance](consuming-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-194">Your own applications or scripts that use [performance counter consumer APIs](consuming-counter-data.md).</span></span>

<span data-ttu-id="5e1a7-195">La plupart des consommateurs de compteurs de performances utilisent des API de [PDH.dll](using-the-pdh-functions-to-consume-counter-data.md) pour collecter des données de performances.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-195">Most performance counter consumers use APIs from [PDH.dll](using-the-pdh-functions-to-consume-counter-data.md) to collect performance data.</span></span> <span data-ttu-id="5e1a7-196">PDH gère de nombreux aspects complexes de la collecte des compteurs de performances, tels que l’analyse des requêtes, la mise en correspondance des instances sur plusieurs échantillons et le calcul des valeurs mises en forme à partir des données de compteur brutes.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-196">PDH manages many complex aspects of gathering performance counters such as parsing queries, matching up instances across multiple samples, and computing formatted values from the raw counter data.</span></span> <span data-ttu-id="5e1a7-197">L’implémentation PDH utilise les API du registre lors de l’utilisation des données d’un fournisseur v1 et utilise les API de consommateur v2 lors de l’utilisation de données à partir d’un fournisseur v2.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-197">The PDH implementation uses the registry APIs when consuming data from a V1 provider and uses the V2 consumer APIs when consuming data from a V2 provider.</span></span>

<span data-ttu-id="5e1a7-198">Certains anciens consommateurs de compteurs de performances utilisent les [API du Registre](using-the-registry-functions-to-consume-counter-data.md) pour collecter les données de performances à partir de la `HKEY_PERFORMANCE_DATA` clé de Registre spéciale.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-198">Some older performance counter consumers use the [registry APIs](using-the-registry-functions-to-consume-counter-data.md) to collect performance data from the special `HKEY_PERFORMANCE_DATA` registry key.</span></span> <span data-ttu-id="5e1a7-199">Cela n’est pas recommandé pour le nouveau code, car le traitement des données à partir du Registre est complexe et sujet aux erreurs.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-199">This is not recommended for new code because processing the data from the registry is complex and error-prone.</span></span> <span data-ttu-id="5e1a7-200">L’implémentation de l’API du Registre prend directement en charge la collecte de données à partir des fournisseurs v1.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-200">The registry API implementation directly supports collecting data from V1 providers.</span></span> <span data-ttu-id="5e1a7-201">Il prend indirectement en charge la collecte de données à partir de fournisseurs v2 via une couche de traduction qui utilise les API de consommateur v2.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-201">It indirectly supports collecting data from V2 providers through a translation layer that uses the V2 consumer APIs.</span></span>

<span data-ttu-id="5e1a7-202">Certains consommateurs de compteur de performance utilisent les [fonctions de consommateur de Perflib v2](using-the-perflib-functions-to-consume-counter-data.md) pour accéder directement aux données à partir de fournisseurs v2.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-202">Some performance counter consumers use the [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md) to directly access data from V2 providers.</span></span> <span data-ttu-id="5e1a7-203">Cela est plus complexe que l’utilisation de données à l’aide des API PDH, mais cette approche peut être utile si les API PDH ne peuvent pas être utilisées en raison de problèmes de performances ou de dépendance.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-203">This is more complex than consuming data using the PDH APIs, but this approach can be useful if PDH APIs cannot be used due to performance or dependency concerns.</span></span> <span data-ttu-id="5e1a7-204">L’implémentation de PerfLib v2 prend directement en charge la collecte de données à partir de fournisseurs v2.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-204">The PerfLib V2 implementation directly supports collecting data from V2 providers.</span></span> <span data-ttu-id="5e1a7-205">Elle ne prend pas en charge la collecte de données à partir de fournisseurs v1.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-205">It does not support collecting data from V1 providers.</span></span>

> [!NOTE]
> <span data-ttu-id="5e1a7-206">Windows OneCore n’inclut pas PDH.dll et n’inclut pas la prise en charge de l’utilisation des données des compteurs de performances via les API du Registre.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-206">Windows OneCore does not include PDH.dll and does not include support for consuming performance counter data via the registry APIs.</span></span> <span data-ttu-id="5e1a7-207">Les consommateurs qui s’exécutent sur OneCore doivent utiliser les fonctions de consommateur de PerfLib v2.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-207">Consumers running on OneCore must use the PerfLib V2 Consumer functions.</span></span>

<span data-ttu-id="5e1a7-208">Les fournisseurs v1 sont implémentés en tant que DLL de fournisseur chargé dans le processus consommateur.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-208">V1 providers are implemented as a provider DLL that is loaded into the consumer process.</span></span> <span data-ttu-id="5e1a7-209">L’implémentation de l’API du Registre gère le chargement de la DLL du fournisseur, l’appel de la DLL pour collecter les données de performances et le déchargement de la DLL, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-209">The registry API implementation manages loading the provider DLL, calling into the DLL to collect performance data, and unloading the DLL as appropriate.</span></span> <span data-ttu-id="5e1a7-210">La DLL du fournisseur est responsable de la [collecte des données de performances selon les besoins](communicating-with-your-application.md), par exemple en utilisant les API Windows normales, RPC, les canaux nommés, la mémoire partagée ou d’autres mécanismes de communication entre processus.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-210">The provider DLL is responsible for [collecting performance data as appropriate](communicating-with-your-application.md), e.g. by using normal Windows APIs, RPC, named pipes, shared memory, or other interprocess communication mechanisms.</span></span>

<span data-ttu-id="5e1a7-211">Les fournisseurs v2 sont implémentés comme un programme en mode utilisateur (souvent un service Windows) ou un pilote en mode noyau.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-211">V2 providers are implemented as either a user-mode program (often a Windows service) or a kernel-mode driver.</span></span> <span data-ttu-id="5e1a7-212">En général, le code du fournisseur de données de performances est intégré directement dans un composant existant (par exemple, le pilote ou le service signale des statistiques sur lui-même).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-212">Usually the performance data provider code is integrated directly into an existing component (i.e. the driver or service is reporting statistics about itself).</span></span> <span data-ttu-id="5e1a7-213">L’implémentation de PerfLib v2 gère les demandes et les réponses via l’extension du noyau PCW.sys, de sorte que le fournisseur n’a généralement pas besoin d’implémenter de communication interprocessus pour fournir les données de performances.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-213">The PerfLib V2 implementation manages requests and responses via the PCW.sys kernel extension so the provider usually does not need to implement any interprocess communication to provide the performance data.</span></span>

> [!NOTE]
> <span data-ttu-id="5e1a7-214">Les API et les outils du compteur de performances Windows incluent une prise en charge limitée de l’accès aux compteurs de performances à partir d’autres ordinateurs via le Registre distant (pour les fournisseurs v1) et RPC (pour les fournisseurs v2).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-214">Windows Performance Counter APIs and tools include limited support for accessing performance counters from other machines via Remote Registry (for V1 providers) and RPC (for V2 providers).</span></span> <span data-ttu-id="5e1a7-215">Cette prise en charge est souvent difficile à utiliser en termes de contrôles d’authentification (les outils et les API peuvent uniquement s’authentifier en tant qu’utilisateur actuel), ainsi qu’en termes de [configuration du système](accessing-remote-counter-data.md) (les points de terminaison et les services nécessaires sont désactivés par défaut).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-215">This support is often hard to use in terms of authentication controls (the tools and APIs can only authenticate as the current user) as well as in terms of [system configuration](accessing-remote-counter-data.md) (the necessary endpoints and services are disabled by default).</span></span> <span data-ttu-id="5e1a7-216">Dans de nombreux cas, il est préférable d’accéder aux compteurs de performance des systèmes distants via [WMI](/windows/desktop/WmiSdk/monitoring-performance-data) plutôt qu’à l’aide de la prise en charge intégrée de l’accès à distance.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-216">In many cases, it is better to access the performance counters of remote systems via [WMI](/windows/desktop/WmiSdk/monitoring-performance-data) rather than via the built-in remote access support.</span></span>

## <a name="developer-audience"></a><span data-ttu-id="5e1a7-217">Développeurs concernés</span><span class="sxs-lookup"><span data-stu-id="5e1a7-217">Developer audience</span></span>

<span data-ttu-id="5e1a7-218">Les compteurs de performances sont souvent utilisés par les administrateurs pour identifier les problèmes de performances ou le comportement anormal des systèmes, par les développeurs pour étudier l’utilisation des ressources des composants logiciels et par les utilisateurs individuels pour comprendre comment les programmes se comportent sur leur système.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-218">Performance counters are often consumed by administrators to identify performance issues or abnormal behavior of systems, by developers to study resource usage of software components, and by individual users to understand how programs are behaving on their system.</span></span> <span data-ttu-id="5e1a7-219">L’utilisation peut se faire via des outils d’interface utilisateur graphique tels que le gestionnaire des tâches ou l’analyseur de performances, des outils en ligne de commande comme typeperf.exe ou logman.exe, via des scripts via WMI et PowerShell, ou via des API C/C++ et .NET.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-219">Usage may occur via GUI tools like Task Manager or Performance Monitor, command-line tools like typeperf.exe or logman.exe, via scripting via WMI and PowerShell, or through C/C++ and .NET APIs.</span></span>

<span data-ttu-id="5e1a7-220">Les fournisseurs de compteurs de performances sont généralement implémentés en tant que pilotes en mode noyau ou services en mode utilisateur.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-220">Performance counter providers are usually implemented as kernel-mode drivers or user-mode services.</span></span> <span data-ttu-id="5e1a7-221">Les fournisseurs de compteurs de performances sont généralement écrits en C ou C++.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-221">Performance counter providers are usually written in C or C++.</span></span>

## <a name="run-time-requirements"></a><span data-ttu-id="5e1a7-222">Conditions d’exécution</span><span class="sxs-lookup"><span data-stu-id="5e1a7-222">Run-time requirements</span></span>

<span data-ttu-id="5e1a7-223">Pour plus d’informations sur les exigences d’exécution d’un élément de programmation particulier, consultez la section Configuration requise de la page de référence de cet élément.</span><span class="sxs-lookup"><span data-stu-id="5e1a7-223">For information about run-time requirements for a particular programming element, see the Requirements section of the reference page for that element.</span></span>

<span data-ttu-id="5e1a7-224">Pour plus d’informations sur l’historique des versions, consultez [Nouveautés](performance-counters-what-s-new.md).</span><span class="sxs-lookup"><span data-stu-id="5e1a7-224">For version history, see [What's New](performance-counters-what-s-new.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="5e1a7-225">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="5e1a7-225">See also</span></span>

[<span data-ttu-id="5e1a7-226">Using Performance Counters</span><span class="sxs-lookup"><span data-stu-id="5e1a7-226">Using Performance Counters</span></span>](using-performance-counters.md)

[<span data-ttu-id="5e1a7-227">Référence des compteurs de performance</span><span class="sxs-lookup"><span data-stu-id="5e1a7-227">Performance Counters Reference</span></span>](performance-counters-reference.md)
