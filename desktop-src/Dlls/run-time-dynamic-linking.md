---
description: Lorsque l’application appelle les fonctions LoadLibrary ou LoadLibraryEx, le système tente de localiser la DLL (pour plus d’informations, consultez l’ordre de recherche de la bibliothèque Dynamic-Link).
ms.assetid: 81e237a9-3c32-46a5-88d3-c978f43dad54
title: Run-Time la liaison dynamique
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a9e215ac83ecdc0615b8030e2e215857c67fe6e5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106521418"
---
# <a name="run-time-dynamic-linking"></a><span data-ttu-id="a297c-103">Run-Time la liaison dynamique</span><span class="sxs-lookup"><span data-stu-id="a297c-103">Run-Time Dynamic Linking</span></span>

<span data-ttu-id="a297c-104">Lorsque l’application appelle les fonctions [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) , le système tente de localiser la dll (pour plus d’informations, consultez ordre de recherche dans la [bibliothèque de liens dynamiques](dynamic-link-library-search-order.md)).</span><span class="sxs-lookup"><span data-stu-id="a297c-104">When the application calls the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) functions, the system attempts to locate the DLL (for details, see [Dynamic-Link Library Search Order](dynamic-link-library-search-order.md)).</span></span> <span data-ttu-id="a297c-105">Si la recherche est réussie, le système mappe le module DLL dans l’espace d’adressage virtuel du processus et incrémente le décompte de références.</span><span class="sxs-lookup"><span data-stu-id="a297c-105">If the search succeeds, the system maps the DLL module into the virtual address space of the process and increments the reference count.</span></span> <span data-ttu-id="a297c-106">Si l’appel à **LoadLibrary** ou **LoadLibraryEx** spécifie une dll dont le code est déjà mappé dans l’espace d’adressage virtuel du processus appelant, la fonction retourne simplement un handle à la dll et incrémente le nombre de références de dll.</span><span class="sxs-lookup"><span data-stu-id="a297c-106">If the call to **LoadLibrary** or **LoadLibraryEx** specifies a DLL whose code is already mapped into the virtual address space of the calling process, the function simply returns a handle to the DLL and increments the DLL reference count.</span></span> <span data-ttu-id="a297c-107">Notez que deux dll qui ont les mêmes nom et extension de fichier de base mais se trouvent dans des répertoires différents ne sont pas considérées comme étant la même DLL.</span><span class="sxs-lookup"><span data-stu-id="a297c-107">Note that two DLLs that have the same base file name and extension but are found in different directories are not considered to be the same DLL.</span></span>

<span data-ttu-id="a297c-108">Le système appelle la fonction de point d’entrée dans le contexte du thread qui a appelé [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span><span class="sxs-lookup"><span data-stu-id="a297c-108">The system calls the entry-point function in the context of the thread that called [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="a297c-109">La fonction de point d’entrée n’est pas appelée si la DLL a déjà été chargée par le processus par le biais d’un appel à **LoadLibrary** ou **LoadLibraryEx** sans appel correspondant à la fonction [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) .</span><span class="sxs-lookup"><span data-stu-id="a297c-109">The entry-point function is not called if the DLL was already loaded by the process through a call to **LoadLibrary** or **LoadLibraryEx** with no corresponding call to the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function.</span></span>

<span data-ttu-id="a297c-110">Si le système ne peut pas trouver la DLL ou si la fonction de point d’entrée retourne FALSe, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) retourne null.</span><span class="sxs-lookup"><span data-stu-id="a297c-110">If the system cannot find the DLL or if the entry-point function returns FALSE, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) returns NULL.</span></span> <span data-ttu-id="a297c-111">Si **LoadLibrary** ou **LoadLibraryEx** parvient à fonctionner, il retourne un handle au module dll.</span><span class="sxs-lookup"><span data-stu-id="a297c-111">If **LoadLibrary** or **LoadLibraryEx** succeeds, it returns a handle to the DLL module.</span></span> <span data-ttu-id="a297c-112">Le processus peut utiliser ce handle pour identifier la DLL dans un appel à la fonction [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)ou [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) .</span><span class="sxs-lookup"><span data-stu-id="a297c-112">The process can use this handle to identify the DLL in a call to the [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) function.</span></span>

<span data-ttu-id="a297c-113">La fonction [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) retourne un handle utilisé dans [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)ou [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span><span class="sxs-lookup"><span data-stu-id="a297c-113">The [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) function returns a handle used in [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span></span> <span data-ttu-id="a297c-114">La fonction **GetModuleHandle** ne fonctionne que si le module dll est déjà mappé dans l’espace d’adressage du processus par liaison au moment du chargement ou par un appel précédent à [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span><span class="sxs-lookup"><span data-stu-id="a297c-114">The **GetModuleHandle** function succeeds only if the DLL module is already mapped into the address space of the process by load-time linking or by a previous call to [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="a297c-115">Contrairement à **LoadLibrary** ou **LoadLibraryEx**, **GetModuleHandle** n’incrémente pas le nombre de références de module.</span><span class="sxs-lookup"><span data-stu-id="a297c-115">Unlike **LoadLibrary** or **LoadLibraryEx**, **GetModuleHandle** does not increment the module reference count.</span></span> <span data-ttu-id="a297c-116">La fonction [**GetModuleFileName**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) récupère le chemin d’accès complet du module associé à un handle retourné par **GetModuleHandle**, **LoadLibrary** ou **LoadLibraryEx**.</span><span class="sxs-lookup"><span data-stu-id="a297c-116">The [**GetModuleFileName**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function retrieves the full path of the module associated with a handle returned by **GetModuleHandle**, **LoadLibrary**, or **LoadLibraryEx**.</span></span>

<span data-ttu-id="a297c-117">Le processus peut utiliser [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) pour obtenir l’adresse d’une fonction exportée dans la dll à l’aide d’un handle de module dll retourné par [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa), [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea).</span><span class="sxs-lookup"><span data-stu-id="a297c-117">The process can use [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) to get the address of an exported function in the DLL using a DLL module handle returned by [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa), [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea).</span></span>

<span data-ttu-id="a297c-118">Lorsque le module DLL n’est plus nécessaire, le processus peut appeler [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) ou [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span><span class="sxs-lookup"><span data-stu-id="a297c-118">When the DLL module is no longer needed, the process can call [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span></span> <span data-ttu-id="a297c-119">Ces fonctions décrémentent le nombre de références de module et annulent le démappage du Code DLL de l’espace d’adressage virtuel du processus si le nombre de références est égal à zéro.</span><span class="sxs-lookup"><span data-stu-id="a297c-119">These functions decrement the module reference count and unmap the DLL code from the virtual address space of the process if the reference count is zero.</span></span>

<span data-ttu-id="a297c-120">La liaison dynamique au moment de l’exécution permet au processus de continuer à s’exécuter même si aucune DLL n’est disponible.</span><span class="sxs-lookup"><span data-stu-id="a297c-120">Run-time dynamic linking enables the process to continue running even if a DLL is not available.</span></span> <span data-ttu-id="a297c-121">Le processus peut ensuite utiliser une autre méthode pour atteindre son objectif.</span><span class="sxs-lookup"><span data-stu-id="a297c-121">The process can then use an alternate method to accomplish its objective.</span></span> <span data-ttu-id="a297c-122">Par exemple, si un processus ne parvient pas à localiser une seule DLL, il peut essayer d’en utiliser un autre ou notifier l’utilisateur d’une erreur.</span><span class="sxs-lookup"><span data-stu-id="a297c-122">For example, if a process is unable to locate one DLL, it can try to use another, or it can notify the user of an error.</span></span> <span data-ttu-id="a297c-123">Si l’utilisateur peut fournir le chemin d’accès complet de la DLL manquante, le processus peut utiliser ces informations pour charger la DLL même si elle ne se trouve pas dans le chemin de recherche normal.</span><span class="sxs-lookup"><span data-stu-id="a297c-123">If the user can provide the full path of the missing DLL, the process can use this information to load the DLL even though it is not in the normal search path.</span></span> <span data-ttu-id="a297c-124">Cette situation contraste avec la liaison au moment du chargement, dans laquelle le système arrête simplement le processus s’il ne trouve pas la DLL.</span><span class="sxs-lookup"><span data-stu-id="a297c-124">This situation contrasts with load-time linking, in which the system simply terminates the process if it cannot find the DLL.</span></span>

<span data-ttu-id="a297c-125">La liaison dynamique au moment de l’exécution peut entraîner des problèmes si la DLL utilise la fonction [**DllMain**](dllmain.md) pour effectuer l’initialisation de chaque thread d’un processus, car le point d’entrée n’est pas appelé pour les threads qui existaient avant l’appel de [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) .</span><span class="sxs-lookup"><span data-stu-id="a297c-125">Run-time dynamic linking can cause problems if the DLL uses the [**DllMain**](dllmain.md) function to perform initialization for each thread of a process, because the entry-point is not called for threads that existed before [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) is called.</span></span> <span data-ttu-id="a297c-126">Pour obtenir un exemple illustrant la façon de résoudre ce problème, consultez [utilisation du stockage local des threads dans une bibliothèque de Dynamic-Link](using-thread-local-storage-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="a297c-126">For an example showing how to deal with this problem, see [Using Thread Local Storage in a Dynamic-Link Library](using-thread-local-storage-in-a-dynamic-link-library.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="a297c-127">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="a297c-127">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a297c-128">Utilisation de la liaison dynamique au moment de l’exécution</span><span class="sxs-lookup"><span data-stu-id="a297c-128">Using Run-time Dynamic Linking</span></span>](using-run-time-dynamic-linking.md)
</dt> </dl>

 

 
