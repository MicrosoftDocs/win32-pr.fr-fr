---
description: Une bibliothèque de Dynamic-Link (DLL) peut contenir des données globales ou des données locales.
ms.assetid: b1f6811e-c413-4124-9ccb-ea59b7a8a7ff
title: Dynamic-Link des données de bibliothèque
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 83280d3bfc449061c44f9e8bfd9b47833e7eca19
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106530227"
---
# <a name="dynamic-link-library-data"></a><span data-ttu-id="f57a9-103">Dynamic-Link des données de bibliothèque</span><span class="sxs-lookup"><span data-stu-id="f57a9-103">Dynamic-Link Library Data</span></span>

<span data-ttu-id="f57a9-104">Une bibliothèque de Dynamic-Link (DLL) peut contenir des données globales ou des données locales.</span><span class="sxs-lookup"><span data-stu-id="f57a9-104">A Dynamic-Link Library (DLL) can contain global data or local data.</span></span>

## <a name="variable-scope"></a><span data-ttu-id="f57a9-105">Portée des variables</span><span class="sxs-lookup"><span data-stu-id="f57a9-105">Variable Scope</span></span>

<span data-ttu-id="f57a9-106">Les variables déclarées comme globales dans un fichier de code source DLL sont traitées comme des variables globales par le compilateur et l’éditeur de liens, mais chaque processus qui charge une DLL donnée obtient sa propre copie des variables globales de cette DLL.</span><span class="sxs-lookup"><span data-stu-id="f57a9-106">Variables that are declared as global in a DLL source code file are treated as global variables by the compiler and linker, but each process that loads a given DLL gets its own copy of that DLL's global variables.</span></span> <span data-ttu-id="f57a9-107">La portée des variables statiques est limitée au bloc dans lequel les variables statiques sont déclarées.</span><span class="sxs-lookup"><span data-stu-id="f57a9-107">The scope of static variables is limited to the block in which the static variables are declared.</span></span> <span data-ttu-id="f57a9-108">Par conséquent, chaque processus possède sa propre instance des variables globales et statiques de la DLL par défaut.</span><span class="sxs-lookup"><span data-stu-id="f57a9-108">As a result, each process has its own instance of the DLL global and static variables by default.</span></span>

> [!Note]  
> <span data-ttu-id="f57a9-109">Vos outils de développement peuvent vous permettre de remplacer le comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="f57a9-109">Your development tools may allow you to override the default behavior.</span></span> <span data-ttu-id="f57a9-110">Par exemple, le compilateur Visual C++ prend en charge la **\# section pragma** et l’éditeur de liens prend en charge l’option/section.</span><span class="sxs-lookup"><span data-stu-id="f57a9-110">For example, the Visual C++ compiler supports **\#pragma section** and the linker supports the /SECTION option.</span></span> <span data-ttu-id="f57a9-111">Pour plus d’informations, consultez la documentation fournie avec vos outils de développement.</span><span class="sxs-lookup"><span data-stu-id="f57a9-111">For more information, see the documentation included with your development tools.</span></span>

 

## <a name="dynamic-memory-allocation"></a><span data-ttu-id="f57a9-112">Allocation de Mémoire dynamique</span><span class="sxs-lookup"><span data-stu-id="f57a9-112">Dynamic Memory Allocation</span></span>

<span data-ttu-id="f57a9-113">Lorsqu’une DLL alloue de la mémoire à l’aide de l’une des fonctions d’allocation de mémoire ([**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**LocalAlloc**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**HeapAlloc**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc)et [**VirtualAlloc**](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc)), la mémoire est allouée dans l’espace d’adressage virtuel du processus appelant et est accessible uniquement aux threads de ce processus.</span><span class="sxs-lookup"><span data-stu-id="f57a9-113">When a DLL allocates memory using any of the memory allocation functions ([**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**LocalAlloc**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**HeapAlloc**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc), and [**VirtualAlloc**](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc)), the memory is allocated in the virtual address space of the calling process and is accessible only to the threads of that process.</span></span>

<span data-ttu-id="f57a9-114">Une DLL peut utiliser le mappage de fichiers pour allouer de la mémoire qui peut être partagée entre les processus.</span><span class="sxs-lookup"><span data-stu-id="f57a9-114">A DLL can use file mapping to allocate memory that can be shared among processes.</span></span> <span data-ttu-id="f57a9-115">Pour une présentation générale de l’utilisation du mappage de fichiers pour créer une mémoire partagée nommée, consultez [mappage de fichiers](/windows/desktop/Memory/file-mapping).</span><span class="sxs-lookup"><span data-stu-id="f57a9-115">For a general discussion of how to use file mapping to create named shared memory, see [File Mapping](/windows/desktop/Memory/file-mapping).</span></span> <span data-ttu-id="f57a9-116">Pour obtenir un exemple qui utilise la fonction [**DllMain**](dllmain.md) pour configurer la mémoire partagée à l’aide du mappage de fichiers, consultez [utilisation de la mémoire partagée dans une bibliothèque de Dynamic-Link](using-shared-memory-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="f57a9-116">For an example that uses the [**DllMain**](dllmain.md) function to set up shared memory using file mapping, see [Using Shared Memory in a Dynamic-Link Library](using-shared-memory-in-a-dynamic-link-library.md).</span></span>

## <a name="thread-local-storage"></a><span data-ttu-id="f57a9-117">stockage local des threads</span><span class="sxs-lookup"><span data-stu-id="f57a9-117">Thread Local Storage</span></span>

<span data-ttu-id="f57a9-118">Les fonctions de stockage local des threads (TLS) permettent à une DLL d’allouer un index pour le stockage et la récupération d’une valeur différente pour chaque thread d’un processus multithread.</span><span class="sxs-lookup"><span data-stu-id="f57a9-118">The thread local storage (TLS) functions enable a DLL to allocate an index for storing and retrieving a different value for each thread of a multithreaded process.</span></span> <span data-ttu-id="f57a9-119">Par exemple, une application de feuille de calcul peut créer une nouvelle instance du même thread chaque fois que l’utilisateur ouvre une nouvelle feuille de calcul.</span><span class="sxs-lookup"><span data-stu-id="f57a9-119">For example, a spreadsheet application can create a new instance of the same thread each time the user opens a new spreadsheet.</span></span> <span data-ttu-id="f57a9-120">Une DLL qui fournit les fonctions pour diverses opérations de feuille de calcul peut utiliser TLS pour enregistrer les informations sur l’état actuel de chaque feuille de calcul (ligne, colonne, etc.).</span><span class="sxs-lookup"><span data-stu-id="f57a9-120">A DLL providing the functions for various spreadsheet operations can use TLS to save information about the current state of each spreadsheet (row, column, and so on).</span></span> <span data-ttu-id="f57a9-121">Pour une présentation générale du stockage local des threads, consultez [stockage local des threads](/windows/desktop/ProcThread/thread-local-storage).</span><span class="sxs-lookup"><span data-stu-id="f57a9-121">For a general discussion of thread local storage, see [Thread Local Storage](/windows/desktop/ProcThread/thread-local-storage).</span></span> <span data-ttu-id="f57a9-122">Pour obtenir un exemple qui utilise la fonction [**DllMain**](dllmain.md) pour configurer le stockage local des threads, consultez [utilisation du stockage local des threads dans une bibliothèque de Dynamic-Link](using-thread-local-storage-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="f57a9-122">For an example that uses the [**DllMain**](dllmain.md) function to set up thread local storage, see [Using Thread Local Storage in a Dynamic-Link Library](using-thread-local-storage-in-a-dynamic-link-library.md).</span></span>

<span data-ttu-id="f57a9-123">**Windows Server 2003 et Windows XP :** Le compilateur Visual C++ prend en charge une syntaxe qui vous permet de déclarer des variables de thread local : **\_ declspec (thread)**.</span><span class="sxs-lookup"><span data-stu-id="f57a9-123">**Windows Server 2003 and Windows XP:** The Visual C++ compiler supports a syntax that enables you to declare thread-local variables: **\_declspec(thread)**.</span></span> <span data-ttu-id="f57a9-124">Si vous utilisez cette syntaxe dans une DLL, vous ne pourrez pas charger la DLL explicitement à l’aide de [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) sur les versions de Windows antérieures à Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="f57a9-124">If you use this syntax in a DLL, you will not be able to load the DLL explicitly using [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) on versions of Windows prior to Windows Vista.</span></span> <span data-ttu-id="f57a9-125">Si votre DLL sera chargée de manière explicite, vous devez utiliser les fonctions de stockage local des threads au lieu de **\_ declspec (thread)**.</span><span class="sxs-lookup"><span data-stu-id="f57a9-125">If your DLL will be loaded explicitly, you must use the thread local storage functions instead of **\_declspec(thread)**.</span></span>

 

 
