---
description: La fonction WSAAccept permet à une application d’obtenir des informations sur l’appelant, telles que l’identificateur de l’appelant et la qualité de service, avant de décider d’accepter ou non une demande de connexion entrante.
ms.assetid: 65883556-6890-4d0a-8c7f-c4ff68642caf
title: Configuration et destruction de la connexion
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9c4ac1f32524d097e11825f8104eb41fee3c528
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106513226"
---
# <a name="connection-setup-and-teardown"></a><span data-ttu-id="753e2-103">Configuration et destruction de la connexion</span><span class="sxs-lookup"><span data-stu-id="753e2-103">Connection Setup and Teardown</span></span>

<span data-ttu-id="753e2-104">La fonction [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) permet à une application d’obtenir des informations sur l’appelant, telles que l’identificateur de l’appelant et la qualité de service, avant de décider d’accepter ou non une demande de connexion entrante.</span><span class="sxs-lookup"><span data-stu-id="753e2-104">The [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) function lets an application obtain caller information such as caller identifier and Quality of Service before deciding whether to accept an incoming connection request.</span></span> <span data-ttu-id="753e2-105">Cela est effectué avec un rappel à une fonction de condition fournie par l’application.</span><span class="sxs-lookup"><span data-stu-id="753e2-105">This is done with a callback to an application-supplied condition function.</span></span>

<span data-ttu-id="753e2-106">Les données utilisateur à utilisateur spécifiées par des paramètres dans la fonction [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) et la fonction condition de [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) peuvent être transférées à l’homologue lors de l’établissement de la connexion, à condition que cette fonctionnalité soit prise en charge par le fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="753e2-106">User-to-user data specified by parameters in the [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) function and the condition function of [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) can be transferred to the peer during connection establishment, provided this feature is supported by the service provider.</span></span>

<span data-ttu-id="753e2-107">Il est également possible (pour les protocoles qui le prennent en charge) d’échanger des données utilisateur entre les points de terminaison au moment de la destruction de la connexion.</span><span class="sxs-lookup"><span data-stu-id="753e2-107">It is also possible (for protocols that support this) to exchange user data between the endpoints at connection teardown time.</span></span> <span data-ttu-id="753e2-108">La fin qui initie la destruction peut appeler la fonction [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) pour indiquer qu’il n’y a plus de données à envoyer et à initialiser la séquence de destruction de la connexion.</span><span class="sxs-lookup"><span data-stu-id="753e2-108">The end that initiates the teardown can call the [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) function to indicate that no more data be sent and to initiate the connection teardown sequence.</span></span> <span data-ttu-id="753e2-109">Pour certains protocoles, une partie de la déconnexion est la remise de données déconnectées de l’initiateur de destruction.</span><span class="sxs-lookup"><span data-stu-id="753e2-109">For certain protocols, part of teardown is the delivery of disconnect data from the teardown initiator.</span></span> <span data-ttu-id="753e2-110">Après avoir reçu une notification indiquant que la terminaison distante a initié la déconnexion (généralement par l' \_ indication FD Close), la fonction [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) peut être appelée pour recevoir les données de déconnexion, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="753e2-110">After receiving notice that the remote end has initiated teardown (typically by the FD\_CLOSE indication), the [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) function can be called to receive the disconnect data, if any.</span></span>

<span data-ttu-id="753e2-111">Pour illustrer la façon dont les données de déconnexion peuvent être utilisées, examinez le scénario suivant.</span><span class="sxs-lookup"><span data-stu-id="753e2-111">To illustrate how disconnect data can be used, consider the following scenario.</span></span> <span data-ttu-id="753e2-112">La moitié du client d’une application client/serveur est responsable de l’arrêt d’une connexion de Socket.</span><span class="sxs-lookup"><span data-stu-id="753e2-112">The client half of a client/server application is responsible for terminating a socket connection.</span></span> <span data-ttu-id="753e2-113">Coïncide avec l’arrêt, il fournit (à l’aide de données déconnectées) le nombre total de transactions qu’il a traitées avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="753e2-113">Coincident with the termination, it provides (using disconnect data) the total number of transactions it processed with the server.</span></span> <span data-ttu-id="753e2-114">Le serveur répond à son tour avec le total cumulé des transactions qu’il a traitées avec tous les clients.</span><span class="sxs-lookup"><span data-stu-id="753e2-114">The server in turn responds with the cumulative total of transactions that it has processed with all clients.</span></span> <span data-ttu-id="753e2-115">La séquence d’appels et d’indications peut se présenter comme suit :</span><span class="sxs-lookup"><span data-stu-id="753e2-115">The sequence of calls and indications might occur as follows:</span></span>

| <span data-ttu-id="753e2-116">Côté client</span><span class="sxs-lookup"><span data-stu-id="753e2-116">Client side</span></span>                                                                                                              | <span data-ttu-id="753e2-117">Côté serveur</span><span class="sxs-lookup"><span data-stu-id="753e2-117">Server side</span></span>                                                                                                                                                                                                                   |
|--------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="753e2-118">(1) appelez [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) pour conclure la session et le total de la transaction d’approvisionnement.</span><span class="sxs-lookup"><span data-stu-id="753e2-118">(1) Invoke [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) to conclude session and supply transaction total.</span></span>            |                                                                                                                                                                                                                               |
|                                                                                                                          | <span data-ttu-id="753e2-119">(2) obtenir FD \_ Close, [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) avec une valeur de retour égale à zéro, ou un retour d’erreur [WSAEDISCON](windows-sockets-error-codes-2.md) de [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) indiquant un arrêt correct en cours.</span><span class="sxs-lookup"><span data-stu-id="753e2-119">(2) Get FD\_CLOSE, [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) with a return value of zero, or [WSAEDISCON](windows-sockets-error-codes-2.md) error return from [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) indicating graceful shutdown in progress.</span></span> |
|                                                                                                                          | <span data-ttu-id="753e2-120">(3) appelez [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) pour connaître le total de la transaction du client.</span><span class="sxs-lookup"><span data-stu-id="753e2-120">(3) Invoke [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) to get client's transaction total.</span></span>                                                                                                                                |
|                                                                                                                          | <span data-ttu-id="753e2-121">(4) calcul total cumulé de toutes les transactions.</span><span class="sxs-lookup"><span data-stu-id="753e2-121">(4) Compute cumulative grand total of all transactions.</span></span>                                                                                                                                                                       |
|                                                                                                                          | <span data-ttu-id="753e2-122">(5) appelez [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) pour transmettre le total général.</span><span class="sxs-lookup"><span data-stu-id="753e2-122">(5) Invoke [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) to transmit grand total.</span></span>                                                                                                                                          |
| <span data-ttu-id="753e2-123">(6) recevoir l' \_ indication FD Close.</span><span class="sxs-lookup"><span data-stu-id="753e2-123">(6) Receive FD\_CLOSE indication.</span></span>                                                                                        | <span data-ttu-id="753e2-124">(5A) appeler [**opération closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="753e2-124">(5a) Invoke [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>                                                                                                                                                                             |
| <span data-ttu-id="753e2-125">(7) appelez [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) pour recevoir et stocker le total cumulé des transactions.</span><span class="sxs-lookup"><span data-stu-id="753e2-125">(7) Invoke [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) to receive and store cumulative grand total of transactions.</span></span> |                                                                                                                                                                                                                               |
| <span data-ttu-id="753e2-126">(8) appeler [ **opération closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)</span><span class="sxs-lookup"><span data-stu-id="753e2-126">(8) Invoke [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)</span></span>                                                                          |                                                                                                                                                                                                                               |



 

<span data-ttu-id="753e2-127">Notez que l’étape (5A) doit suivre l’étape (5), mais qu’elle n’a pas de relation de synchronisation avec STEP (6), (7) ou (8).</span><span class="sxs-lookup"><span data-stu-id="753e2-127">Note that step (5a) must follow step (5), but has no timing relationship with step (6), (7), or (8).</span></span>

 

 



