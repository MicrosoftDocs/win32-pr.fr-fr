---
description: La fonction WSADuplicateSocket est introduite pour permettre le partage de socket entre les processus.
ms.assetid: f7cf40e9-f3a6-4b62-8a78-df25464e2365
title: Sockets partagés
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fb6753b01f6389254756254d2ebe196af8e2a8a3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103951581"
---
# <a name="shared-sockets"></a><span data-ttu-id="c1231-103">Sockets partagés</span><span class="sxs-lookup"><span data-stu-id="c1231-103">Shared Sockets</span></span>

<span data-ttu-id="c1231-104">La fonction [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) est introduite pour permettre le partage de socket entre les processus.</span><span class="sxs-lookup"><span data-stu-id="c1231-104">The [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) function is introduced to enable socket sharing across processes.</span></span> <span data-ttu-id="c1231-105">Un processus source appelle **WSADuplicateSocket** pour obtenir une structure [**d' \_ informations de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) spéciale pour un identificateur de processus cible.</span><span class="sxs-lookup"><span data-stu-id="c1231-105">A source process calls **WSADuplicateSocket** to obtain a special [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure for a target process identifier.</span></span> <span data-ttu-id="c1231-106">Il utilise un mécanisme de communication interprocessus (IPC) pour passer le contenu de cette structure à un processus cible.</span><span class="sxs-lookup"><span data-stu-id="c1231-106">It uses some interprocess communications (IPC) mechanism to pass the contents of this structure to a target process.</span></span> <span data-ttu-id="c1231-107">Le processus cible utilise ensuite la structure d' **\_ informations WSAPROTOCOL** dans un appel à [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket).</span><span class="sxs-lookup"><span data-stu-id="c1231-107">The target process then uses the **WSAPROTOCOL\_INFO** structure in a call to [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket).</span></span> <span data-ttu-id="c1231-108">Le descripteur de socket retourné par cette fonction sera un descripteur de socket supplémentaire vers un Socket sous-jacent qui devient donc partagé.</span><span class="sxs-lookup"><span data-stu-id="c1231-108">The socket descriptor returned by this function will be an additional socket descriptor to an underlying socket which thus becomes shared.</span></span> <span data-ttu-id="c1231-109">Les sockets peuvent être partagés entre les threads d’un processus donné sans utiliser la fonction **WSADuplicateSocket** , car un descripteur de socket est valide dans tous les threads d’un processus.</span><span class="sxs-lookup"><span data-stu-id="c1231-109">Sockets can be shared among threads in a given process without using the **WSADuplicateSocket** function because a socket descriptor is valid in all threads of a process.</span></span>

<span data-ttu-id="c1231-110">Les deux descripteurs (ou plus) qui font référence à un socket partagé peuvent être utilisés indépendamment en ce qui concerne les e/s.</span><span class="sxs-lookup"><span data-stu-id="c1231-110">The two (or more) descriptors that reference a shared socket can be used independently as far as I/O is concerned.</span></span> <span data-ttu-id="c1231-111">Toutefois, l’interface Winsock n’implémente aucun type de contrôle d’accès, de sorte que les processus doivent coordonner les opérations sur un socket partagé.</span><span class="sxs-lookup"><span data-stu-id="c1231-111">However, the Winsock interface does not implement any type of access control, so the processes must coordinate any operations on a shared socket.</span></span> <span data-ttu-id="c1231-112">Un exemple classique de partage de sockets consiste à utiliser un processus pour créer des sockets et établir des connexions.</span><span class="sxs-lookup"><span data-stu-id="c1231-112">A typical example of sharing sockets is to use one process for creating sockets and establishing connections.</span></span> <span data-ttu-id="c1231-113">Ce processus transmet ensuite les sockets aux autres processus qui sont responsables de l’échange d’informations.</span><span class="sxs-lookup"><span data-stu-id="c1231-113">This process then hands off sockets to other processes that are responsible for information exchange.</span></span>

<span data-ttu-id="c1231-114">La fonction [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) crée des descripteurs de socket et non le Socket sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="c1231-114">The [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) function creates socket descriptors and not the underlying socket.</span></span> <span data-ttu-id="c1231-115">Par conséquent, tous les États associés à un socket sont communs à tous les descripteurs.</span><span class="sxs-lookup"><span data-stu-id="c1231-115">As a result, all the states associated with a socket are held in common across all the descriptors.</span></span> <span data-ttu-id="c1231-116">Par exemple, une opération [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) effectuée à l’aide d’un descripteur est ensuite visible à l’aide d’un [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) à partir d’un ou de tous les descripteurs.</span><span class="sxs-lookup"><span data-stu-id="c1231-116">For example, a [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) operation performed using one descriptor is subsequently visible using a [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) from any or all descriptors.</span></span> <span data-ttu-id="c1231-117">Un processus peut appeler [**opération closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) sur un socket dupliqué et le descripteur est libéré.</span><span class="sxs-lookup"><span data-stu-id="c1231-117">A process can call [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) on a duplicated socket and the descriptor will become deallocated.</span></span> <span data-ttu-id="c1231-118">Toutefois, le Socket sous-jacent reste ouvert jusqu’à ce que **opération closesocket** soit appelé avec le dernier descripteur restant.</span><span class="sxs-lookup"><span data-stu-id="c1231-118">The underlying socket, however, remains open until **closesocket** is called with the last remaining descriptor.</span></span>

<span data-ttu-id="c1231-119">La notification sur les sockets partagés est soumise aux contraintes habituelles des fonctions [**WSAAsyncSelect**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) et [**WSAEventSelect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaeventselect) .</span><span class="sxs-lookup"><span data-stu-id="c1231-119">Notification on shared sockets is subject to the usual constraints of the [**WSAAsyncSelect**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) and [**WSAEventSelect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaeventselect) functions.</span></span> <span data-ttu-id="c1231-120">L’émission de l’un de ces appels à l’aide de l’un des descripteurs partagés annule toute inscription d’événement précédente pour le socket, quel que soit le descripteur utilisé pour effectuer cette inscription.</span><span class="sxs-lookup"><span data-stu-id="c1231-120">Issuing either of these calls using any of the shared descriptors cancels any previous event registration for the socket, regardless of which descriptor was used to make that registration.</span></span> <span data-ttu-id="c1231-121">Par exemple, il n’est pas possible d’avoir des événements de lecture de lecture FD de réception \_ et de traitement B pour les événements d' \_ écriture FD.</span><span class="sxs-lookup"><span data-stu-id="c1231-121">Thus, for example, it would not be possible to have process A receive FD\_READ events and process B receive FD\_WRITE events.</span></span> <span data-ttu-id="c1231-122">Dans les situations où une coordination étroite est nécessaire, il est suggéré aux développeurs d’utiliser des threads au lieu de processus distincts.</span><span class="sxs-lookup"><span data-stu-id="c1231-122">For situations when such tight coordination is required, it is suggested that developers use threads instead of separate processes.</span></span>

 

 
