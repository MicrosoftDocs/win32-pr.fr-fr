---
description: La structure WSAQUERYSET permet de former des requêtes pour la fonction NSPLookupServiceBegin et de fournir des résultats de requête pour la fonction NSPLookupServiceNext.
ms.assetid: 017b5828-bc6e-42b7-aba7-21648b2dd707
title: Query-Related les structures de données dans l’index SPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57ce5a7016bd2ad96f464137177036b470c64a95
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104567687"
---
# <a name="query-related-data-structures-in-the-spi"></a><span data-ttu-id="063cc-103">Query-Related les structures de données dans l’index SPI</span><span class="sxs-lookup"><span data-stu-id="063cc-103">Query-Related Data Structures in the SPI</span></span>

<span data-ttu-id="063cc-104">La structure [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) permet de former des requêtes pour [**NSPLookupServiceBegin**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicebegin)et de fournir des résultats de requête pour [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span><span class="sxs-lookup"><span data-stu-id="063cc-104">The [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure is used to form queries for [**NSPLookupServiceBegin**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicebegin), and used to deliver query results for [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span></span> <span data-ttu-id="063cc-105">Il s’agit d’une structure complexe, car elle contient des pointeurs vers plusieurs autres structures, dont certaines font référence à d’autres structures.</span><span class="sxs-lookup"><span data-stu-id="063cc-105">It is a complex structure because it contains pointers to several other structures, some of which reference still other structures.</span></span> <span data-ttu-id="063cc-106">La relation entre **WSAQUERYSET** et les structures qu’elle référence est illustrée comme suit :</span><span class="sxs-lookup"><span data-stu-id="063cc-106">The relationship between **WSAQUERYSET** and the structures it references is illustrated as follows:</span></span>

![structures wsaqueryset](images/ovrvw3-2.png)

<span data-ttu-id="063cc-108">Au sein de la structure [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) , la plupart des membres sont explicites, mais certaines méritent une explication supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="063cc-108">Within the [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure, most of the members are self explanatory, but some deserve additional explanation.</span></span> <span data-ttu-id="063cc-109">Le **dwSize nul** sera rempli avec sizeof ( **WSAQUERYSET**) et peut être utilisé par les fournisseurs d’espaces de noms pour détecter et s’adapter aux différentes versions de la structure **WSAQUERYSET** qui peuvent apparaître.</span><span class="sxs-lookup"><span data-stu-id="063cc-109">The **dwSize** will be filled in with sizeof( **WSAQUERYSET**), and can be used by namespace providers to detect and adapt to different versions of the **WSAQUERYSET** structure that may appear.</span></span>

<span data-ttu-id="063cc-110">Le membre **dwOutputFlags** est utilisé par un fournisseur d’espaces de noms pour fournir des données supplémentaires sur les résultats de la requête.</span><span class="sxs-lookup"><span data-stu-id="063cc-110">The **dwOutputFlags** member is used by a namespace provider to provide additional data about query results.</span></span> <span data-ttu-id="063cc-111">Pour plus d’informations, consultez [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span><span class="sxs-lookup"><span data-stu-id="063cc-111">For more information, see [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span></span>

<span data-ttu-id="063cc-112">La structure [**WSAECOMPARATOR**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) référencée par **lpVersion** est utilisée pour la contrainte de requête et les résultats.</span><span class="sxs-lookup"><span data-stu-id="063cc-112">The [**WSAECOMPARATOR**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) structure referenced by **lpversion** is used for both query constraint and results.</span></span> <span data-ttu-id="063cc-113">Pour les requêtes, le membre **dwVersion** indique la version souhaitée du service.</span><span class="sxs-lookup"><span data-stu-id="063cc-113">For queries, the **dwVersion** member indicates the desired version of the service.</span></span> <span data-ttu-id="063cc-114">Le membre **ecHow** est un type énuméré qui spécifie la façon dont la comparaison sera effectuée.</span><span class="sxs-lookup"><span data-stu-id="063cc-114">The **ecHow** member is an enumerated type which specifies how the comparison will be made.</span></span> <span data-ttu-id="063cc-115">Les choix possibles sont \_ égal à, ce qui nécessite qu’une correspondance exacte dans la version se produit, ou comp \_ NOTLESS qui spécifie que le numéro de version du service ne doit pas être inférieur à la valeur de **dwVersion**.</span><span class="sxs-lookup"><span data-stu-id="063cc-115">The choices are COMP\_EQUALS which requires that an exact match in version occurs, or COMP\_NOTLESS which specifies that the service's version number be no less than the value of **dwVersion**.</span></span>

<span data-ttu-id="063cc-116">L’interprétation de **dwNameSpace** et de **lpNSProviderId** dépend de la façon dont la structure est utilisée et est décrite plus en détail dans les descriptions de fonction individuelles qui utilisent cette structure.</span><span class="sxs-lookup"><span data-stu-id="063cc-116">The interpretation of **dwNameSpace** and **lpNSProviderId** depends upon how the structure is being used and is described further in the individual function descriptions that utilize this structure.</span></span>

<span data-ttu-id="063cc-117">Le membre **lpszContext** s’applique aux espaces de noms hiérarchiques et spécifie le point de départ d’une requête ou l’emplacement dans la hiérarchie où le service réside.</span><span class="sxs-lookup"><span data-stu-id="063cc-117">The **lpszContext** member applies to hierarchical namespaces, and specifies the starting point of a query or the location within the hierarchy where the service resides.</span></span> <span data-ttu-id="063cc-118">Les règles générales sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="063cc-118">The general rules are:</span></span>

-   <span data-ttu-id="063cc-119">La valeur **null**("") commence la recherche dans le contexte par défaut.</span><span class="sxs-lookup"><span data-stu-id="063cc-119">A value of **NULL**, blank ("") will start the search at the default context.</span></span>
-   <span data-ttu-id="063cc-120">La valeur « \\ » démarre la recherche en haut de l’espace de noms.</span><span class="sxs-lookup"><span data-stu-id="063cc-120">A value of "\\" starts the search at the top of the namespace.</span></span>
-   <span data-ttu-id="063cc-121">Toute autre valeur commence la recherche au point désigné.</span><span class="sxs-lookup"><span data-stu-id="063cc-121">Any other value starts the search at the designated point.</span></span>

<span data-ttu-id="063cc-122">Les fournisseurs qui ne prennent pas en charge la relation contenant-contenu peuvent retourner une erreur si tout autre chose que « » ou « » \\ est spécifié.</span><span class="sxs-lookup"><span data-stu-id="063cc-122">Providers that do not support containment may return an error if anything other than "" or "\\" is specified.</span></span> <span data-ttu-id="063cc-123">Les fournisseurs qui prennent en charge la relation contenant-contenu limitée, tels que les groupes, doivent accepter « », « » \\ ou un point désigné.</span><span class="sxs-lookup"><span data-stu-id="063cc-123">Providers that support limited containment, such as groups, should accept "", '\\", or a designated point.</span></span> <span data-ttu-id="063cc-124">Les contextes sont spécifiques à l’espace de noms.</span><span class="sxs-lookup"><span data-stu-id="063cc-124">Contexts are namespace specific.</span></span> <span data-ttu-id="063cc-125">Si **dwNameSpace** est \_ All NS, seul « » ou « » \\ doit être passé comme contexte, car ceux-ci sont reconnus par tous les espaces de noms.</span><span class="sxs-lookup"><span data-stu-id="063cc-125">If **dwNameSpace** is NS\_ALL, then only "" or "\\" should be passed as the context because these are recognized by all namespaces.</span></span>

<span data-ttu-id="063cc-126">Le membre **lpszQueryString** est utilisé pour fournir des informations supplémentaires sur les requêtes spécifiques à l’espace de noms, telles qu’une chaîne décrivant un service et un nom de protocole de transport bien connus, comme dans « FTP/TCP ».</span><span class="sxs-lookup"><span data-stu-id="063cc-126">The **lpszQueryString** member is used to supply additional, namespace-specific query information such as a string describing a well-known service and transport protocol name, as in "ftp/tcp".</span></span>

<span data-ttu-id="063cc-127">La structure [**AFPROTOCOLS**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) référencée par **lpafpProtocols** est utilisée à des fins de requête uniquement et fournit une liste de protocoles pour contraindre la requête.</span><span class="sxs-lookup"><span data-stu-id="063cc-127">The [**AFPROTOCOLS**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) structure referenced by **lpafpProtocols** is used for query purposes only, and supplies a list of protocols to constrain the query.</span></span> <span data-ttu-id="063cc-128">Ces protocoles sont représentés par des paires (de famille d’adresses, protocole), car les valeurs de protocole n’ont que la signification dans le contexte d’une famille d’adresses.</span><span class="sxs-lookup"><span data-stu-id="063cc-128">These protocols are represented as (address family, protocol) pairs, because protocol values only have meaning within the context of an address family.</span></span>

<span data-ttu-id="063cc-129">Le tableau de la structure d' [**\_ informations CSADDR**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) référencé par **lpcsaBuffer** contient toutes les informations requises pour qu’un service soit utilisé pour établir une écoute ou un client à utiliser lors de l’établissement d’une connexion au service.</span><span class="sxs-lookup"><span data-stu-id="063cc-129">The array of [**CSADDR\_INFO**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) structure referenced by **lpcsaBuffer** contains all of the information required for either a service to use in establishing a listen, or a client to use in establishing a connection to the service.</span></span> <span data-ttu-id="063cc-130">Les membres **LocalAddr** et **RemoteAddr** contiennent directement une structure [**d' \_ adresse de socket**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) .</span><span class="sxs-lookup"><span data-stu-id="063cc-130">The **LocalAddr** and **RemoteAddr** members both directly contain a [**SOCKET\_ADDRESS**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) structure.</span></span> <span data-ttu-id="063cc-131">Un service crée un socket à l’aide du tuple (LocalAddr. lpSockaddr->sa \_ Family, iSocketType, iProtocol).</span><span class="sxs-lookup"><span data-stu-id="063cc-131">A service would create a socket using the tuple (LocalAddr.lpSockaddr->sa\_family, iSocketType, iProtocol).</span></span> <span data-ttu-id="063cc-132">Il lie le socket à une adresse locale à l’aide de LocalAddr. lpSockaddr et LocalAddr. lpSockaddrLength.</span><span class="sxs-lookup"><span data-stu-id="063cc-132">It would bind the socket to a local address using LocalAddr.lpSockaddr, and LocalAddr.lpSockaddrLength.</span></span> <span data-ttu-id="063cc-133">Le client crée son socket avec le Tuple (RemoteAddr. lpSockaddr->sa \_ Family, iSocketType, iProtocol) et utilise la combinaison de RemoteAddr. lpSockaddr et RemoteAddr. lpSockaddrLength lors de l’établissement d’une connexion à distance.</span><span class="sxs-lookup"><span data-stu-id="063cc-133">The client creates its socket with the tuple (RemoteAddr.lpSockaddr->sa\_family, iSocketType, iProtocol), and uses the combination of RemoteAddr.lpSockaddr, and RemoteAddr.lpSockaddrLength when making a remote connection.</span></span>

 

 
