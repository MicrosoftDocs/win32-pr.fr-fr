---
description: Demande comment la pile de mise en réseau doit gérer certains comportements pour lesquels la méthode par défaut de gestion du comportement peut varier entre les différentes versions de Windows.
ms.assetid: 9574e21f-5ac4-4210-8031-2f3b07416813
title: Code de contrôle SIO_SET_COMPATIBILITY_MODE
ms.topic: reference
ms.date: 05/20/2019
req.target-min-winverclnt: Windows Vista [desktop apps only]
req.target-min-winversvr: Windows Server 2008 [desktop apps only]
api_location:
- mstcpip.h
ms.openlocfilehash: 58972595adb71a30728cb4817a80814cd987a6de
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106514017"
---
# <a name="sio_set_compatibility_mode-control-code"></a><span data-ttu-id="98e03-103">Code de contrôle SIO_SET_COMPATIBILITY_MODE</span><span class="sxs-lookup"><span data-stu-id="98e03-103">SIO_SET_COMPATIBILITY_MODE Control Code</span></span>

## <a name="description"></a><span data-ttu-id="98e03-104">Description</span><span class="sxs-lookup"><span data-stu-id="98e03-104">Description</span></span>

<span data-ttu-id="98e03-105">Le code de contrôle du **mode de compatibilité SIO Set demande comment la pile de mise \_ \_ \_ en** réseau doit gérer certains comportements pour lesquels la méthode par défaut de gestion du comportement peut varier d’une version à l’autre de Windows.</span><span class="sxs-lookup"><span data-stu-id="98e03-105">The **SIO\_SET\_COMPATIBILITY\_MODE** control code requests how the networking stack should handle certain behaviors for which the default way of handling the behavior may differ across Windows versions.</span></span>

<span data-ttu-id="98e03-106">Pour effectuer cette opération, appelez la fonction [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) ou **WSPIoctl** avec les paramètres suivants.</span><span class="sxs-lookup"><span data-stu-id="98e03-106">To perform this operation, call the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function with the following parameters.</span></span>

```cpp
int WSAIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_SET_COMPATIBILITY_MODE, // dwIoControlCode
  (LPVOID) lpvInBuffer,    // pointer to WSA_COMPATIBILITY_MODE struct
  (DWORD) cbInBuffer,      // length of input buffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
);
```

```cpp
int WSPIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_SET_COMPATIBILITY_MODE, // dwIoControlCode
  (LPVOID) lpvInBuffer,    // pointer to WSA_COMPATIBILITY_MODE struct
  (DWORD) cbInBuffer,      // length of input buffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
  (LPWSATHREADID) lpThreadId,   // a WSATHREADID structure
  (LPINT) lpErrno   // a pointer to the error code.
);
```

## <a name="parameters"></a><span data-ttu-id="98e03-107">Paramètres</span><span class="sxs-lookup"><span data-stu-id="98e03-107">Parameters</span></span>

### <a name="s"></a><span data-ttu-id="98e03-108">s</span><span class="sxs-lookup"><span data-stu-id="98e03-108">s</span></span>

<span data-ttu-id="98e03-109">Descripteur identifiant un Socket.</span><span class="sxs-lookup"><span data-stu-id="98e03-109">A descriptor identifying a socket.</span></span>

### <a name="dwiocontrolcode"></a><span data-ttu-id="98e03-110">dwIoControlCode</span><span class="sxs-lookup"><span data-stu-id="98e03-110">dwIoControlCode</span></span>

<span data-ttu-id="98e03-111">Code de contrôle de l’opération.</span><span class="sxs-lookup"><span data-stu-id="98e03-111">The control code for the operation.</span></span>
<span data-ttu-id="98e03-112">Utilisez **le \_ \_ \_ mode de compatibilité SIO Set** pour cette opération.</span><span class="sxs-lookup"><span data-stu-id="98e03-112">Use **SIO\_SET\_COMPATIBILITY\_MODE** for this operation.</span></span>

### <a name="lpvinbuffer"></a><span data-ttu-id="98e03-113">lpvInBuffer</span><span class="sxs-lookup"><span data-stu-id="98e03-113">lpvInBuffer</span></span>

<span data-ttu-id="98e03-114">Pointeur vers la mémoire tampon d’entrée.</span><span class="sxs-lookup"><span data-stu-id="98e03-114">A pointer to the input buffer.</span></span>
<span data-ttu-id="98e03-115">Ce paramètre doit pointer vers une structure de **\_ \_ mode de compatibilité WSA** .</span><span class="sxs-lookup"><span data-stu-id="98e03-115">This parameter should point to a **WSA\_COMPATIBILITY\_MODE** structure.</span></span>

### <a name="cbinbuffer"></a><span data-ttu-id="98e03-116">cbInBuffer</span><span class="sxs-lookup"><span data-stu-id="98e03-116">cbInBuffer</span></span>

<span data-ttu-id="98e03-117">Taille, en octets, de la mémoire tampon d’entrée.</span><span class="sxs-lookup"><span data-stu-id="98e03-117">The size, in bytes, of the input buffer.</span></span>
<span data-ttu-id="98e03-118">Ce paramètre doit être supérieur ou égal à la taille de la structure du **\_ \_ mode de compatibilité WSA** vers laquelle pointe le paramètre *lpvInBuffer* .</span><span class="sxs-lookup"><span data-stu-id="98e03-118">This parameter should equal to or greater than the size of the **WSA\_COMPATIBILITY\_MODE** structure pointed to by the *lpvInBuffer* parameter.</span></span>

### <a name="lpvoutbuffer"></a><span data-ttu-id="98e03-119">lpvOutBuffer</span><span class="sxs-lookup"><span data-stu-id="98e03-119">lpvOutBuffer</span></span>

<span data-ttu-id="98e03-120">Pointeur vers la mémoire tampon de sortie.</span><span class="sxs-lookup"><span data-stu-id="98e03-120">A pointer to the output buffer.</span></span>
<span data-ttu-id="98e03-121">Ce paramètre n’est pas utilisé pour cette opération.</span><span class="sxs-lookup"><span data-stu-id="98e03-121">This parameter is unused for this operation.</span></span>

### <a name="cboutbuffer"></a><span data-ttu-id="98e03-122">cbOutBuffer</span><span class="sxs-lookup"><span data-stu-id="98e03-122">cbOutBuffer</span></span>

<span data-ttu-id="98e03-123">Taille, en octets, de la mémoire tampon de sortie.</span><span class="sxs-lookup"><span data-stu-id="98e03-123">The size, in bytes, of the output buffer.</span></span>
<span data-ttu-id="98e03-124">Ce paramètre doit avoir la valeur zéro.</span><span class="sxs-lookup"><span data-stu-id="98e03-124">This parameter must be set to zero.</span></span>

### <a name="lpcbbytesreturned"></a><span data-ttu-id="98e03-125">lpcbBytesReturned</span><span class="sxs-lookup"><span data-stu-id="98e03-125">lpcbBytesReturned</span></span>

<span data-ttu-id="98e03-126">Pointeur vers une variable qui reçoit la taille, en octets, des données stockées dans la mémoire tampon de sortie.</span><span class="sxs-lookup"><span data-stu-id="98e03-126">A pointer to a variable that receives the size, in bytes, of the data stored in the output buffer.</span></span>
<span data-ttu-id="98e03-127">Ce paramètre retourné pointe vers une valeur **DWORD** égale à zéro pour cette opération, car il n’y a pas de sortie.</span><span class="sxs-lookup"><span data-stu-id="98e03-127">This returned parameter points to a **DWORD** value of zero for this operation, since there is no output.</span></span>

### <a name="lpvoverlapped"></a><span data-ttu-id="98e03-128">lpvOverlapped</span><span class="sxs-lookup"><span data-stu-id="98e03-128">lpvOverlapped</span></span>

<span data-ttu-id="98e03-129">Pointeur vers une structure [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) .</span><span class="sxs-lookup"><span data-stu-id="98e03-129">A pointer to a [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) structure.</span></span>

<span data-ttu-id="98e03-130">Si le socket *s* a été créé sans l’attribut Overlapped, le paramètre *lpOverlapped* est ignoré.</span><span class="sxs-lookup"><span data-stu-id="98e03-130">If socket *s* was created without the overlapped attribute, the *lpOverlapped* parameter is ignored.</span></span>

<span data-ttu-id="98e03-131">Si *s* a été ouvert avec l’attribut Overlapped et que le paramètre *lpOverlapped* n’a pas la **valeur null**, l’opération est exécutée en tant qu’opération Overlapped (asynchrone).</span><span class="sxs-lookup"><span data-stu-id="98e03-131">If *s* was opened with the overlapped attribute and the *lpOverlapped* parameter is not **NULL**, the operation is performed as an overlapped (asynchronous) operation.</span></span>
<span data-ttu-id="98e03-132">Dans ce cas, le paramètre *lpOverlapped* doit pointer vers une structure [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) valide.</span><span class="sxs-lookup"><span data-stu-id="98e03-132">In this case, *lpOverlapped* parameter must point to a valid [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) structure.</span></span>

<span data-ttu-id="98e03-133">Pour les opérations avec chevauchement, la fonction [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) ou **WSPIoctl** retourne immédiatement, et la méthode d’achèvement appropriée est signalée lorsque l’opération est terminée.</span><span class="sxs-lookup"><span data-stu-id="98e03-133">For overlapped operations, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns immediately, and the appropriate completion method is signaled when the operation has been completed.</span></span>
<span data-ttu-id="98e03-134">Sinon, la fonction ne retourne pas jusqu’à ce que l’opération soit terminée ou qu’une erreur se produise.</span><span class="sxs-lookup"><span data-stu-id="98e03-134">Otherwise, the function does not return until the operation has been completed or an error occurs.</span></span>

### <a name="lpcompletionroutine"></a><span data-ttu-id="98e03-135">lpCompletionRoutine</span><span class="sxs-lookup"><span data-stu-id="98e03-135">lpCompletionRoutine</span></span>

<span data-ttu-id="98e03-136">Type : \_ In_opt \_ [ **LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)</span><span class="sxs-lookup"><span data-stu-id="98e03-136">Type: \_In_opt\_ [**LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)</span></span>

<span data-ttu-id="98e03-137">Pointeur vers la routine de saisie semi-automatique appelée lorsque l’opération est terminée (ignoré pour les sockets non superposés).</span><span class="sxs-lookup"><span data-stu-id="98e03-137">A pointer to the completion routine called when the operation has been completed (ignored for non-overlapped sockets).</span></span>

### <a name="lpthreadid"></a><span data-ttu-id="98e03-138">lpThreadId</span><span class="sxs-lookup"><span data-stu-id="98e03-138">lpThreadId</span></span>

<span data-ttu-id="98e03-139">Pointeur vers une structure [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) qui doit être utilisée par le fournisseur dans un appel ultérieur à [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span><span class="sxs-lookup"><span data-stu-id="98e03-139">A pointer to a [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) structure to be used by the provider in a subsequent call to [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span></span>
<span data-ttu-id="98e03-140">Le fournisseur doit stocker la structure [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) référencée (pas le pointeur vers le même) jusqu’à ce que la fonction [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) soit retournée.</span><span class="sxs-lookup"><span data-stu-id="98e03-140">The provider should store the referenced [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) structure (not the pointer to same) until after the [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) function returns.</span></span>

<span data-ttu-id="98e03-141">**Remarque**  Ce paramètre s’applique uniquement à la fonction **WSPIoctl** .</span><span class="sxs-lookup"><span data-stu-id="98e03-141">**Note**  This parameter applies only to the **WSPIoctl** function.</span></span>

### <a name="lperrno"></a><span data-ttu-id="98e03-142">lpErrno</span><span class="sxs-lookup"><span data-stu-id="98e03-142">lpErrno</span></span>

<span data-ttu-id="98e03-143">Pointeur vers le code d’erreur.</span><span class="sxs-lookup"><span data-stu-id="98e03-143">A pointer to the error code.</span></span>

<span data-ttu-id="98e03-144">**Remarque**  Ce paramètre s’applique uniquement à la fonction **WSPIoctl** .</span><span class="sxs-lookup"><span data-stu-id="98e03-144">**Note**  This parameter applies only to the **WSPIoctl** function.</span></span>

## <a name="return-value"></a><span data-ttu-id="98e03-145">Valeur retournée</span><span class="sxs-lookup"><span data-stu-id="98e03-145">Return value</span></span>

<span data-ttu-id="98e03-146">Si l’opération se termine correctement, la fonction [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) ou **WSPIoctl** retourne la valeur zéro.</span><span class="sxs-lookup"><span data-stu-id="98e03-146">If the operation completes successfully, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns zero.</span></span>

<span data-ttu-id="98e03-147">Si l’opération échoue ou est en attente, la fonction [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) ou **WSPIoctl** retourne une **\_ erreur de socket**.</span><span class="sxs-lookup"><span data-stu-id="98e03-147">If the operation fails or is pending, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns **SOCKET\_ERROR**.</span></span>
<span data-ttu-id="98e03-148">Pour afficher les informations d’erreur étendues, appelez [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).</span><span class="sxs-lookup"><span data-stu-id="98e03-148">To get extended error information, call [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).</span></span>

| <span data-ttu-id="98e03-149">Code d'erreur</span><span class="sxs-lookup"><span data-stu-id="98e03-149">Error code</span></span> | <span data-ttu-id="98e03-150">Signification</span><span class="sxs-lookup"><span data-stu-id="98e03-150">Meaning</span></span> |
|------------|---------|
| <span data-ttu-id="98e03-151">**\_e/s WSA \_ en attente**</span><span class="sxs-lookup"><span data-stu-id="98e03-151">**WSA\_IO\_PENDING**</span></span> | <span data-ttu-id="98e03-152">Une opération avec chevauchement a été correctement initiée et l’achèvement sera indiqué ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="98e03-152">An overlapped operation was successfully initiated and completion will be indicated at a later time.</span></span> |
| <span data-ttu-id="98e03-153">**\_opération WSA \_ abandonnée**</span><span class="sxs-lookup"><span data-stu-id="98e03-153">**WSA\_OPERATION\_ABORTED**</span></span> | <span data-ttu-id="98e03-154">Une opération avec chevauchement a été annulée en raison de la fermeture du socket ou de l’exécution de la commande **SIO \_ flush** ioctl.</span><span class="sxs-lookup"><span data-stu-id="98e03-154">An overlapped operation was canceled due to the closure of the socket or the execution of the **SIO\_FLUSH** IOCTL command.</span></span> |
| <span data-ttu-id="98e03-155">**WSAEFAULT**</span><span class="sxs-lookup"><span data-stu-id="98e03-155">**WSAEFAULT**</span></span> | <span data-ttu-id="98e03-156">Le paramètre *lpOverlapped* ou *lpCompletionRoutine* n’est pas entièrement contenu dans une partie valide de l’espace d’adressage de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="98e03-156">The *lpOverlapped* or *lpCompletionRoutine* parameter is not totally contained in a valid part of the user address space.</span></span> |
| <span data-ttu-id="98e03-157">**WSAEINPROGRESS**</span><span class="sxs-lookup"><span data-stu-id="98e03-157">**WSAEINPROGRESS**</span></span> | <span data-ttu-id="98e03-158">La fonction est appelée lorsqu’un rappel est en cours.</span><span class="sxs-lookup"><span data-stu-id="98e03-158">The function is invoked when a callback is in progress.</span></span> |
| <span data-ttu-id="98e03-159">**WSAEINTR**</span><span class="sxs-lookup"><span data-stu-id="98e03-159">**WSAEINTR**</span></span> | <span data-ttu-id="98e03-160">Une opération de blocage a été interrompue.</span><span class="sxs-lookup"><span data-stu-id="98e03-160">A blocking operation was interrupted.</span></span> |
| <span data-ttu-id="98e03-161">**WSAEINVAL**</span><span class="sxs-lookup"><span data-stu-id="98e03-161">**WSAEINVAL**</span></span> | <span data-ttu-id="98e03-162">Le paramètre *dwIoControlCode* n’est pas une commande valide, ou un paramètre d’entrée spécifié n’est pas acceptable, ou la commande n’est pas applicable au type de socket spécifié.</span><span class="sxs-lookup"><span data-stu-id="98e03-162">The *dwIoControlCode* parameter is not a valid command, or a specified input parameter is not acceptable, or the command is not applicable to the type of socket specified.</span></span> <span data-ttu-id="98e03-163">Cette erreur est retournée si le paramètre *cbInBuffer* est inférieur à la structure **du \_ \_ mode de compatibilité WSA** .</span><span class="sxs-lookup"><span data-stu-id="98e03-163">This error is returned if the *cbInBuffer* parameter is less than the sizeof the **WSA\_COMPATIBILITY\_MODE** structure.</span></span>
| <span data-ttu-id="98e03-164">**WSAENETDOWN**</span><span class="sxs-lookup"><span data-stu-id="98e03-164">**WSAENETDOWN**</span></span> | <span data-ttu-id="98e03-165">Le sous-système réseau a échoué.</span><span class="sxs-lookup"><span data-stu-id="98e03-165">The network subsystem has failed.</span></span> |
| <span data-ttu-id="98e03-166">**WSAENOPROTOOPT**</span><span class="sxs-lookup"><span data-stu-id="98e03-166">**WSAENOPROTOOPT**</span></span> | <span data-ttu-id="98e03-167">L’option de socket n’est pas prise en charge sur le protocole spécifié.</span><span class="sxs-lookup"><span data-stu-id="98e03-167">The socket option is not supported on the specified protocol.</span></span> |
| <span data-ttu-id="98e03-168">**WSAENOTCONN**</span><span class="sxs-lookup"><span data-stu-id="98e03-168">**WSAENOTCONN**</span></span> | <span data-ttu-id="98e03-169">Le socket n’est pas connecté.</span><span class="sxs-lookup"><span data-stu-id="98e03-169">The socket s is not connected.</span></span> |
| <span data-ttu-id="98e03-170">**WSAENOTSOCK**</span><span class="sxs-lookup"><span data-stu-id="98e03-170">**WSAENOTSOCK**</span></span> | <span data-ttu-id="98e03-171">Le descripteur *s* n’est pas un Socket.</span><span class="sxs-lookup"><span data-stu-id="98e03-171">The descriptor *s* is not a socket.</span></span> |
| <span data-ttu-id="98e03-172">**WSAEOPNOTSUPP**</span><span class="sxs-lookup"><span data-stu-id="98e03-172">**WSAEOPNOTSUPP**</span></span> | <span data-ttu-id="98e03-173">La commande IOCTL spécifiée n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="98e03-173">The specified IOCTL command is not supported.</span></span> <span data-ttu-id="98e03-174">Cette erreur est retournée si l’IOCTL du **\_ mode de \_ compatibilité \_ SIO Set** n’est pas prise en charge par le fournisseur de transport.</span><span class="sxs-lookup"><span data-stu-id="98e03-174">This error is returned if the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL is not supported by the transport provider.</span></span> <span data-ttu-id="98e03-175">Cette erreur est également retournée lorsqu’une tentative d’utilisation de l’IOCTL du **\_ mode de \_ compatibilité \_ SIO Set** est effectuée sur un socket datagramme.</span><span class="sxs-lookup"><span data-stu-id="98e03-175">This error is also returned when an attempt to use the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL is made on a datagram socket.</span></span> |

## <a name="remarks"></a><span data-ttu-id="98e03-176">Notes</span><span class="sxs-lookup"><span data-stu-id="98e03-176">Remarks</span></span>

<span data-ttu-id="98e03-177">l’IOCTL du **mode de compatibilité Set SIO demande comment la pile de mise \_ \_ \_ en** réseau doit gérer certains comportements pour lesquels la méthode par défaut de gestion du comportement peut varier d’une version à l’autre de Windows.</span><span class="sxs-lookup"><span data-stu-id="98e03-177">the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL requests how the networking stack should handle certain behaviors for which the default way of handling the behavior may differ across Windows versions.</span></span>
<span data-ttu-id="98e03-178">La structure d’arguments d’entrée pour le **\_ \_ \_ mode de compatibilité Set SIO** est spécifiée dans la structure du **\_ \_ mode de compatibilité WSA** définie dans le fichier d’en-tête *Mswsockdef. h* .</span><span class="sxs-lookup"><span data-stu-id="98e03-178">The input argument structure for **SIO\_SET\_COMPATIBILITY\_MODE** is specified in the **WSA\_COMPATIBILITY\_MODE** structure defined in the *Mswsockdef.h* header file.</span></span>
<span data-ttu-id="98e03-179">Un pointeur vers la structure du **\_ \_ mode de compatibilité WSA** est passé dans le paramètre *cbInBuffer* .</span><span class="sxs-lookup"><span data-stu-id="98e03-179">A pointer to the **WSA\_COMPATIBILITY\_MODE** structure is passed in the *cbInBuffer* parameter.</span></span>
<span data-ttu-id="98e03-180">Cette structure est définie comme suit :</span><span class="sxs-lookup"><span data-stu-id="98e03-180">This structure is defined as follows:</span></span>

```cpp
// Need to #include <mswsock.h>

/* Argument structure for SIO_SET_COMPATIBILITY_MODE */
typedef struct _WSA_COMPATIBILITY_MODE {
    WSA_COMPATIBILITY_BEHAVIOR_ID BehaviorId;
    ULONG TargetOsVersion;
} WSA_COMPATIBILITY_MODE, *PWSA_COMPATIBILITY_MODE;
```

<span data-ttu-id="98e03-181">La valeur spécifiée dans le membre **BehaviorId** indique le comportement demandé.</span><span class="sxs-lookup"><span data-stu-id="98e03-181">The value specified in the **BehaviorId** member indicates the behavior requested.</span></span>
<span data-ttu-id="98e03-182">La valeur spécifiée dans le membre **TargetOsVersion** indique la version de Windows demandée pour le comportement.</span><span class="sxs-lookup"><span data-stu-id="98e03-182">The value specified in the **TargetOsVersion** member indicates the Windows version that is being requested for the behavior.</span></span>

<span data-ttu-id="98e03-183">Le membre **BehaviorId** peut être l’une des valeurs du type d’énumération d’ID de **\_ \_ comportement \_ de compatibilité WSA** défini dans le fichier d’en-tête *Mswsockdef. h* .</span><span class="sxs-lookup"><span data-stu-id="98e03-183">The **BehaviorId** member can be one of the values from the **WSA\_COMPATIBILITY\_BEHAVIOR\_ID** enumeration type defined in the *Mswsockdef.h* header file.</span></span>
<span data-ttu-id="98e03-184">Les valeurs possibles pour le membre **BehaviorId** sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="98e03-184">The possible values for the **BehaviorId** member are as follows:</span></span>

| <span data-ttu-id="98e03-185">Terme</span><span class="sxs-lookup"><span data-stu-id="98e03-185">Term</span></span> | <span data-ttu-id="98e03-186">Description</span><span class="sxs-lookup"><span data-stu-id="98e03-186">Description</span></span> |
|------|-------------|
| <span data-ttu-id="98e03-187">WsaBehaviorAll</span><span class="sxs-lookup"><span data-stu-id="98e03-187">WsaBehaviorAll</span></span> | <span data-ttu-id="98e03-188">Cela équivaut à demander tous les comportements compatibles possibles définis pour l’ID de **\_ comportement de \_ \_ compatibilité WSA**.</span><span class="sxs-lookup"><span data-stu-id="98e03-188">This is equivalent to requesting all of the possible compatible behaviors defined for **WSA\_COMPATIBILITY\_BEHAVIOR\_ID**.</span></span> |
| <span data-ttu-id="98e03-189">WsaBehaviorReceiveBuffering</span><span class="sxs-lookup"><span data-stu-id="98e03-189">WsaBehaviorReceiveBuffering</span></span> | <span data-ttu-id="98e03-190">Lorsque le membre **TargetOsVersion** est défini sur une valeur pour Windows Vista ou version ultérieure, la réduction de la taille de la mémoire tampon de réception TCP sur ce socket à l’aide de l’option de socket **\_ RCVBUF** est autorisée même après l’établissement d’une connexion TCP.</span><span class="sxs-lookup"><span data-stu-id="98e03-190">When the **TargetOsVersion** member is set to a value for Windows Vista or later, reductions to the TCP receive buffer size on this socket using the **SO\_RCVBUF** socket option are allowed even after a TCP connection has been establishment.</span></span> <span data-ttu-id="98e03-191">Lorsque le membre **TargetOsVersion** est défini sur une valeur antérieure à Windows Vista, la réduction de la taille de la mémoire tampon de réception TCP sur ce socket à l’aide de l’option de socket **\_ RCVBUF** n’est pas autorisée après l’établissement de la connexion.</span><span class="sxs-lookup"><span data-stu-id="98e03-191">When the **TargetOsVersion** member is set to a value earlier than Windows Vista, reductions to the TCP receive buffer size on this socket using the **SO\_RCVBUF** socket option are not allowed after connection establishment.</span></span> |
| <span data-ttu-id="98e03-192">WsaBehaviorAutoTuning</span><span class="sxs-lookup"><span data-stu-id="98e03-192">WsaBehaviorAutoTuning</span></span> | <span data-ttu-id="98e03-193">Quand le membre **TargetOsVersion** est défini sur une valeur pour Windows Vista ou version ultérieure, le réglage automatique de la fenêtre de réception est activé et le facteur d’échelle de la fenêtre TCP est réduit à 2 de la valeur par défaut 8.</span><span class="sxs-lookup"><span data-stu-id="98e03-193">When the **TargetOsVersion** member is set to a value for Windows Vista or later, receive window auto-tuning is enabled and the TCP window scale factor is reduced to 2 from the default value of 8.</span></span> <span data-ttu-id="98e03-194">Lorsque le **TargetOsVersion** est défini sur une valeur antérieure à Windows Vista, le réglage automatique de la fenêtre de réception est désactivé.</span><span class="sxs-lookup"><span data-stu-id="98e03-194">When the **TargetOsVersion** is set to a value earlier than Windows Vista, receive window auto-tuning is disabled.</span></span> <span data-ttu-id="98e03-195">L’option de mise à l’échelle de la fenêtre TCP est également désactivée et la taille maximale de la fenêtre de réception est limitée à 65 535 octets.</span><span class="sxs-lookup"><span data-stu-id="98e03-195">The TCP window scaling option is also disabled and the maximum true receive window size is limited to 65,535 bytes.</span></span> <span data-ttu-id="98e03-196">L’option de mise à l’échelle de la fenêtre TCP ne peut pas être négociée sur la connexion même si l’option de socket **\_ RCVBUF** a été appelée sur ce socket en spécifiant une valeur supérieure à 65 535 octets avant l’établissement de la connexion.</span><span class="sxs-lookup"><span data-stu-id="98e03-196">The TCP window scaling option can't be negotiated on the connection even if the **SO\_RCVBUF** socket option was called on this socket specifying a value greater than 65,535 bytes before the connection was established.</span></span> |

<span data-ttu-id="98e03-197">Le membre **TargetOsVersion** peut être l’une des constantes de version NTDDI définies dans le fichier d’en-tête *Sdkddkver. h* .</span><span class="sxs-lookup"><span data-stu-id="98e03-197">The **TargetOsVersion** member can be one of the NTDDI version constants defined in the *Sdkddkver.h* header file.</span></span>
<span data-ttu-id="98e03-198">Les valeurs possibles pour le membre **TargetOsVersion** sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="98e03-198">Some of the possible values for the **TargetOsVersion** member are as follows:</span></span>

| <span data-ttu-id="98e03-199">Terme</span><span class="sxs-lookup"><span data-stu-id="98e03-199">Term</span></span> | <span data-ttu-id="98e03-200">Description</span><span class="sxs-lookup"><span data-stu-id="98e03-200">Description</span></span> |
|------|-------------|
| <span data-ttu-id="98e03-201">NTDDI \_ LONGHORN</span><span class="sxs-lookup"><span data-stu-id="98e03-201">NTDDI\_LONGHORN</span></span> | <span data-ttu-id="98e03-202">Le comportement de la cible est le comportement par défaut de Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="98e03-202">The target behavior is the default for Windows Vista.</span></span> |
| <span data-ttu-id="98e03-203">NTDDI \_ WS03</span><span class="sxs-lookup"><span data-stu-id="98e03-203">NTDDI\_WS03</span></span> | <span data-ttu-id="98e03-204">Le comportement de la cible est la valeur par défaut pour Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="98e03-204">The target behavior is the default for Windows Server 2003.</span></span> |
| <span data-ttu-id="98e03-205">NTDDI \_ WinXP</span><span class="sxs-lookup"><span data-stu-id="98e03-205">NTDDI\_WINXP</span></span> | <span data-ttu-id="98e03-206">Le comportement de la cible est la valeur par défaut pour Windows XP.</span><span class="sxs-lookup"><span data-stu-id="98e03-206">The target behavior is the default for Windows XP.</span></span> |
| <span data-ttu-id="98e03-207">NTDDI \_ Win2K</span><span class="sxs-lookup"><span data-stu-id="98e03-207">NTDDI\_WIN2K</span></span> | <span data-ttu-id="98e03-208">Le comportement cible est la valeur par défaut pour Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="98e03-208">The target behavior is the default for Windows 2000.</span></span> |

<span data-ttu-id="98e03-209">L’impact principal du membre **TargetOsVersion** est le fait que ce membre soit défini sur une valeur égale ou supérieure à **NTDDI \_ LONGHORN**.</span><span class="sxs-lookup"><span data-stu-id="98e03-209">The primary impact of the **TargetOsVersion** member is whether this member is set to a value equal or greater than **NTDDI\_LONGHORN**.</span></span>

<span data-ttu-id="98e03-210">Les performances TCP dépendent non seulement du taux de transfert proprement dit, mais plutôt du produit du taux de transfert et du délai d’aller-retour.</span><span class="sxs-lookup"><span data-stu-id="98e03-210">TCP performance depends not only on the transfer rate itself, but rather on the product of the transfer rate and the round-trip delay time.</span></span>
<span data-ttu-id="98e03-211">Ce produit Bandwidth-Delay mesure la quantité de données qui « rempliront le canal ».</span><span class="sxs-lookup"><span data-stu-id="98e03-211">This bandwidth-delay product measures the amount of data that would "fill the pipe".</span></span>
<span data-ttu-id="98e03-212">Ce produit Bandwidth-delay est l’espace de la mémoire tampon requis au niveau de l’expéditeur et du récepteur pour obtenir un débit maximal sur la connexion TCP sur le chemin d’accès.</span><span class="sxs-lookup"><span data-stu-id="98e03-212">This bandwidth-delay product is the buffer space required at sender and receiver to obtain maximum throughput on the TCP connection over the path.</span></span>
<span data-ttu-id="98e03-213">Cet espace de mémoire tampon représente la quantité de données sans accusé de réception que TCP doit gérer afin de garder le pipeline complet.</span><span class="sxs-lookup"><span data-stu-id="98e03-213">This buffer space represents the amount of unacknowledged data that TCP must handle in order to keep the pipeline full.</span></span>
<span data-ttu-id="98e03-214">Des problèmes de performances TCP surviennent lorsque le produit Bandwidth-delay est volumineux.</span><span class="sxs-lookup"><span data-stu-id="98e03-214">TCP performance problems arise when the bandwidth-delay product is large.</span></span>
<span data-ttu-id="98e03-215">Un chemin d’accès réseau fonctionnant sous ces conditions est souvent appelé « long, pipe ».</span><span class="sxs-lookup"><span data-stu-id="98e03-215">A network path operating under these conditions is often called a "long, fat pipe".</span></span>
<span data-ttu-id="98e03-216">Citons par exemple des liaisons de satellite à haute capacité, des liaisons sans fil à haut débit et des liens fibre optique terrestre sur de longues distances.</span><span class="sxs-lookup"><span data-stu-id="98e03-216">Examples include high-capacity packet satellite links, high-speed wireless links, and terrestrial fiber-optical links over long distances.</span></span>

<span data-ttu-id="98e03-217">L’en-tête TCP utilise un champ de données 16 bits (le champ de fenêtre dans l’en-tête de paquet TCP) pour signaler la taille de la fenêtre de réception à l’expéditeur.</span><span class="sxs-lookup"><span data-stu-id="98e03-217">The TCP header uses a 16-bit data field (the Window field in the TCP packet header) to report the receive window size to the sender.</span></span>
<span data-ttu-id="98e03-218">Par conséquent, la plus grande fenêtre qui peut être utilisée est 65 535 octets.</span><span class="sxs-lookup"><span data-stu-id="98e03-218">Therefore, the largest window that can be used is 65,535 bytes.</span></span>
<span data-ttu-id="98e03-219">Pour contourner cette limitation, une option d’extension TCP, mise à l’échelle de la fenêtre TCP, a été ajoutée au protocole TCP hautes performances pour permettre à Windows de plus de 65 535 octets.</span><span class="sxs-lookup"><span data-stu-id="98e03-219">To circumvent this limitation a TCP extension option, TCP Window Scale, was added for high-performance TCP to allow windows larger than 65,535 bytes.</span></span>
<span data-ttu-id="98e03-220">L’option de mise à l’échelle de la fenêtre TCP (WSopt) est définie dans le document RFC 1323 disponible sur le [site Web](https://www.ietf.org/rfc/rfc1122.txt)de l’IETF.</span><span class="sxs-lookup"><span data-stu-id="98e03-220">The TCP Window Scale option (WSopt) is defined in RFC 1323 available at the [IETF website](https://www.ietf.org/rfc/rfc1122.txt).</span></span>
<span data-ttu-id="98e03-221">L’extension WSopt étend la définition de la fenêtre TCP à 32 bits à l’aide d’un facteur d’échelle logarithmique sur un octet pour étendre le champ de fenêtre de 16 bits dans l’en-tête TCP.</span><span class="sxs-lookup"><span data-stu-id="98e03-221">The WSopt extension expands the definition of the TCP window to 32 bits using a one-byte logarithmic scale factor to extend the 16-bit Window field in the TCP header.</span></span>
<span data-ttu-id="98e03-222">L’extension WSopt définit un facteur d’échelle implicite (2 à une puissance), qui est utilisé pour multiplier la valeur de taille de fenêtre trouvée dans un en-tête TCP pour obtenir la taille réelle de la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="98e03-222">The WSopt extension defines an implicit scale factor (2 to some power), which is used to multiply the window size value found in a TCP header to obtain the true window size.</span></span>
<span data-ttu-id="98e03-223">Par conséquent, un facteur d’échelle de fenêtre de 8 entraînerait une taille de fenêtre réelle égale à la valeur du champ de fenêtre dans l’en-tête TCP multiplié par 2 ^ 8 ou 256.</span><span class="sxs-lookup"><span data-stu-id="98e03-223">So a window scale factor of 8 would result in a true window size equal to the value in the Window field in the TCP header multiplied by 2^8 or 256.</span></span>
<span data-ttu-id="98e03-224">Par conséquent, si le champ de fenêtre dans l’en-tête TCP était défini sur la valeur maximale de 65 535 octets et que le facteur d’échelle WSopt a été négocié à une valeur de 8, la taille de la fenêtre réelle est de 16 776 960 octets.</span><span class="sxs-lookup"><span data-stu-id="98e03-224">So if the Window field in the TCP header was set to the maximum value of 65,535 bytes and the WSopt scale factor was negotiated to a value of 8, the true window size would be 16,776,960 bytes.</span></span>

<span data-ttu-id="98e03-225">La taille réelle de la fenêtre de réception et par conséquent, le facteur d’échelle est déterminé par l’espace de la mémoire tampon de réception maximal.</span><span class="sxs-lookup"><span data-stu-id="98e03-225">The true receive window size and therefore the scale factor is determined by the maximum receive buffer space.</span></span>
<span data-ttu-id="98e03-226">Cet espace de mémoire tampon maximal correspond à la quantité de données qu’un destinataire TCP autorise à envoyer à un expéditeur TCP avant d’avoir à attendre un accusé de réception.</span><span class="sxs-lookup"><span data-stu-id="98e03-226">This maximum buffer space is the amount of data that a TCP receiver allows a TCP sender to send before having to wait for an acknowledgement.</span></span>
<span data-ttu-id="98e03-227">Une fois la connexion établie, la taille de la fenêtre de réception est publiée dans chaque segment TCP (le champ de la fenêtre de l’en-tête TCP).</span><span class="sxs-lookup"><span data-stu-id="98e03-227">After the connection is established, the receive window size is advertised in each TCP segment (the Window field in the TCP header).</span></span>
<span data-ttu-id="98e03-228">La publication de la quantité maximale de données que l’expéditeur peut envoyer est un mécanisme de contrôle de workflow côté réception qui empêche l’expéditeur d’envoyer des données que le destinataire ne peut pas stocker.</span><span class="sxs-lookup"><span data-stu-id="98e03-228">Advertising the maximum amount of data that the sender can send is a receiver-side flow control mechanism that prevents the sender from sending data that the receiver cannot store.</span></span>
<span data-ttu-id="98e03-229">Un hôte d’envoi peut envoyer uniquement la quantité maximale de données publiées par le destinataire avant d’attendre un accusé de réception et une mise à jour de la taille de la fenêtre de réception.</span><span class="sxs-lookup"><span data-stu-id="98e03-229">A sending host can only send the maximum amount of data advertised by the receiver before waiting for an acknowledgment and a receive window size update.</span></span>

<span data-ttu-id="98e03-230">Sur Windows Server 2003 et Windows XP, l’espace de mémoire tampon de réception maximal qui représente la taille de la fenêtre de réception pour la pile TCP/IP a une valeur par défaut en fonction de la vitesse de liaison de l’interface d’envoi.</span><span class="sxs-lookup"><span data-stu-id="98e03-230">On Windows Server 2003 and Windows XP, the maximum receive buffer space which represents the receive window size for the TCP/IP stack has a default value based on the link speed of the sending interface.</span></span>
<span data-ttu-id="98e03-231">La valeur réelle s’ajuste automatiquement à des incréments pairs de la taille maximale de segment (MSS) négociée pendant l’établissement de la connexion TCP.</span><span class="sxs-lookup"><span data-stu-id="98e03-231">The actual value automatically adjusts to even increments of the maximum segment size (MSS) negotiated during TCP connection establishment.</span></span>
<span data-ttu-id="98e03-232">Par conséquent, pour un lien de 10 Mbits/s, la taille de la fenêtre de réception par défaut est normalement définie à 16 Ko, tandis que sur un lien 100 MBit/s, la taille de la fenêtre de réception par défaut est définie sur 65 535 octets.</span><span class="sxs-lookup"><span data-stu-id="98e03-232">So for a 10 Mbit/sec link, the default receive window size would normally be set to 16K bytes, while on a 100 MBit/sec link the default receive window size would be set to 65,535 bytes.</span></span>

<span data-ttu-id="98e03-233">Sur Windows Server 2003 et Windows XP, la véritable taille de fenêtre de réception maximale pour la pile TCP/IP peut être configurée manuellement à l’aide des valeurs de Registre suivantes sur une interface spécifique ou pour l’ensemble du système :</span><span class="sxs-lookup"><span data-stu-id="98e03-233">On Windows Server 2003 and Windows XP, the true maximum receive window size for the TCP/IP stack can be manually configured using the following registry values on a specific interface or for the entire system:</span></span>

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\TCPWindowSize`

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\Interface\TCPWindowSize`

<span data-ttu-id="98e03-234">La valeur de Registre pour **TcpWindowSize** peut être définie sur un maximum de 65 535 octets si vous n’utilisez pas l’extension WSopt ou un maximum de 1 073 741 823 octets lors de l’utilisation de l’extension WSopt (un facteur d’échelle maximal de 4 est pris en charge).</span><span class="sxs-lookup"><span data-stu-id="98e03-234">The registry value for **TCPWindowSize** can be set to a maximum of 65,535 bytes when not using the WSopt extension or a maximum of 1,073,741,823 bytes when the WSopt extension is used (a maximum scale factor of 4 is supported).</span></span>
<span data-ttu-id="98e03-235">Sans la mise à l’échelle de la fenêtre, une application peut uniquement atteindre un débit d’environ 5 mégabits par seconde (Mbits/s) sur un chemin d’accès avec un temps d’aller-retour de 100 millisecondes, quelle que soit la bande passante du chemin d’accès.</span><span class="sxs-lookup"><span data-stu-id="98e03-235">Without window scaling, an application can only achieve a throughput of approximately 5 megabits per second (Mbps) on a path with a 100 millisecond round-trip time (RTT), regardless of the path bandwidth.</span></span>
<span data-ttu-id="98e03-236">Ce débit peut être mis à l’échelle sur un gigabit par seconde (Gbits/s) avec la mise à l’échelle de la fenêtre, ce qui permet à TCP de négocier le facteur de mise à l’échelle pour la taille de la fenêtre pendant l’établissement de la connexion.</span><span class="sxs-lookup"><span data-stu-id="98e03-236">This throughput can be scaled to over a gigabit per second (Gbps) with window scaling, which allows TCP to negotiate the scaling factor for the window size during connection establishment.</span></span>

<span data-ttu-id="98e03-237">Sur Windows Server 2003 et Windows XP, l’extension WSopt peut être activée en définissant la valeur de Registre suivante.</span><span class="sxs-lookup"><span data-stu-id="98e03-237">On Windows Server 2003 and Windows XP, the WSopt extension can be enabled by setting the following registry value.</span></span>

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\Tcp1323Opts`

<span data-ttu-id="98e03-238">La valeur de Registre **TCP1323Opts** est un **DWORD** encodé de telle sorte que lorsque le bit 0 est défini, l’extension TCP WSopt est activée.</span><span class="sxs-lookup"><span data-stu-id="98e03-238">The **Tcp1323Opts** registry value is a **DWORD** encoded such that when bit 0 is set, TCP WSopt extension is enabled.</span></span>
<span data-ttu-id="98e03-239">Lorsque le bit 1 est défini, l’option d’horodatage TCP (TSopt) définie dans la RFC 1323 est activée.</span><span class="sxs-lookup"><span data-stu-id="98e03-239">When bit 1 is set, the TCP Timestamp option (TSopt) defined in RFC 1323 is enabled.</span></span>
<span data-ttu-id="98e03-240">Par conséquent, la valeur 1 ou 3 active l’extension WSopt.</span><span class="sxs-lookup"><span data-stu-id="98e03-240">So a value of either 1 or 3 will enable the WSopt extension.</span></span>

<span data-ttu-id="98e03-241">Sur Windows Server 2003 et Windows XP, la valeur par défaut est que les valeurs de Registre TCPWindowSize et Tcp1323Opts ne sont pas créées.</span><span class="sxs-lookup"><span data-stu-id="98e03-241">On Windows Server 2003 and Windows XP, the default is that the TCPWindowSize and the Tcp1323Opts registry values are not created.</span></span>
<span data-ttu-id="98e03-242">Par conséquent, la valeur par défaut est que l’extension WSopt est désactivée et que la taille de la fenêtre de réception TCP est définie par le système à la valeur maximale, jusqu’à 65 535 octets, en fonction de la vitesse de liaison.</span><span class="sxs-lookup"><span data-stu-id="98e03-242">So the default is that the WSopt extension is disabled and the TCP receive window size is set by the system to maximum value of up to 65,535 bytes based on the link speed.</span></span>
<span data-ttu-id="98e03-243">Lorsque la mise à l’échelle des fenêtres est activée sur Windows Server 2003 et Windows XP en définissant la valeur de Registre Tcp1323Opts, la mise à l’échelle des fenêtres sur une connexion TCP est toujours utilisée uniquement lorsque l’expéditeur et le destinataire incluent une option d’échelle de fenêtre TCP dans le segment Synchronize (SYN) qui est envoyé les uns aux autres pour négocier un facteur d’échelle de fenêtre.</span><span class="sxs-lookup"><span data-stu-id="98e03-243">When window scaling is enabled on Windows Server 2003 and Windows XP by setting the Tcp1323Opts registry value, window scaling on a TCP connection is still only used when both the sender and receiver include a TCP window scale option in the synchronize (SYN) segment sent to each other to negotiate a window scale factor.</span></span>
<span data-ttu-id="98e03-244">Lorsque la mise à l’échelle des fenêtres est utilisée sur une connexion, le champ fenêtre dans l’en-tête TCP est défini sur 65 535 octets et le facteur d’échelle de la fenêtre est utilisé pour ajuster la taille réelle de la fenêtre de réception par rapport au facteur d’échelle de la fenêtre négocié lorsque la connexion est établie.</span><span class="sxs-lookup"><span data-stu-id="98e03-244">When window scaling is used on a connection, the Window field in the TCP header is set to 65,535 bytes and the window scale factor is used to adjust the true receive window size upward by the window scale factor negotiated when the connection is established.</span></span>

<span data-ttu-id="98e03-245">Une application peut spécifier la taille de la fenêtre de réception TCP pour une connexion à l’aide de l’option de socket **so \_ RCVBUF** .</span><span class="sxs-lookup"><span data-stu-id="98e03-245">An application can specify the TCP receive window size for a connection by using the **SO\_RCVBUF** socket option.</span></span>
<span data-ttu-id="98e03-246">La taille de la fenêtre de réception TCP pour un socket peut être augmentée à tout moment à l’aide de **so \_ RCVBUF**, mais elle ne peut être réduite qu’avant d’établir une connexion.</span><span class="sxs-lookup"><span data-stu-id="98e03-246">The TCP receive window size for a socket can be increased at any time using **SO\_RCVBUF**, but it can only be decreased prior to establishing a connection.</span></span>
<span data-ttu-id="98e03-247">Pour pouvoir utiliser la mise à l’échelle de la fenêtre, une application doit spécifier une taille de fenêtre supérieure à 65 535 octets lors de l’utilisation de l’option de socket **so \_ RCVBUF** avant l’établissement de la connexion.</span><span class="sxs-lookup"><span data-stu-id="98e03-247">In order to use window scaling, an application must specify a window size larger than 65,535 bytes when using the **SO\_RCVBUF** socket option before the connection is established.</span></span>

<span data-ttu-id="98e03-248">La valeur idéale pour la taille de la fenêtre de réception TCP est souvent difficile à déterminer.</span><span class="sxs-lookup"><span data-stu-id="98e03-248">The ideal value for the TCP receive window size is often difficult to determine.</span></span>
<span data-ttu-id="98e03-249">Pour remplir la capacité du réseau entre l’expéditeur et le destinataire, la taille de la fenêtre de réception doit être définie sur le produit Bandwidth-Delay pour la connexion, qui est la bande passante multipliée par la durée aller-retour.</span><span class="sxs-lookup"><span data-stu-id="98e03-249">In order to fill the capacity of the network between the sender and receiver, the receive window size should be set to the bandwidth-delay product for the connection, which is the bandwidth multiplied by the round-trip time.</span></span>
<span data-ttu-id="98e03-250">Même si une application peut déterminer correctement le produit de délai de bande passante, il n’est toujours pas connu de la vitesse à laquelle l’application réceptrice récupère les données du tampon de données entrant (taux de récupération de l’application).</span><span class="sxs-lookup"><span data-stu-id="98e03-250">Even if an application can correctly determine the bandwidth-delay product, it is still not known how quickly the receiving application will retrieve data from the incoming data buffer (the application retrieve rate).</span></span>
<span data-ttu-id="98e03-251">Malgré la prise en charge de la mise à l’échelle de la fenêtre TCP, la taille maximale de la fenêtre de réception dans Windows Server 2003 et Windows XP peut toujours limiter le débit, car il s’agit d’une taille maximale fixe pour toutes les connexions TCP (sauf si elles sont spécifiées par application à l’aide de **so \_ RCVBUF**), ce qui peut améliorer le débit pour certaines connexions et réduire le</span><span class="sxs-lookup"><span data-stu-id="98e03-251">Despite the support for TCP window scaling, the maximum receive window size in Windows Server 2003 and Windows XP can still limit throughput because it is a fixed maximum size for all TCP connections (unless specified per application using **SO\_RCVBUF**), which can enhance throughput for some connections and decrease throughput for others.</span></span>
<span data-ttu-id="98e03-252">En outre, la taille de fenêtre de réception maximale fixe pour une connexion TCP ne varie pas en fonction des conditions de réseau modifiées.</span><span class="sxs-lookup"><span data-stu-id="98e03-252">Additionally, the fixed maximum receive window size for a TCP connection does not vary with changing network conditions.</span></span>

<span data-ttu-id="98e03-253">Pour résoudre le problème consistant à déterminer correctement la valeur de la taille maximale de la fenêtre de réception pour une connexion TCP en fonction des conditions actuelles du réseau, la pile TCP/IP de Windows Vista prend en charge une fonctionnalité de réglage automatique de la fenêtre de réception.</span><span class="sxs-lookup"><span data-stu-id="98e03-253">To solve the problem of correctly determining the value of the maximum receive window size for a TCP connection based on the current conditions of the network, the TCP/IP stack in Windows Vista supports a receive window auto-tuning feature.</span></span>
<span data-ttu-id="98e03-254">Lorsque cette fonctionnalité est activée, le réglage automatique de la fenêtre de réception détermine continuellement la taille optimale de la fenêtre de réception en mesurant le produit Bandwidth-Delay et le taux de récupération de l’application, et ajuste la taille maximale réelle de la fenêtre de réception en fonction des conditions de réseau modifiées.</span><span class="sxs-lookup"><span data-stu-id="98e03-254">When this feature is enabled, receive window auto-tuning continually determines the optimal true receive window size by measuring the bandwidth-delay product and the application retrieve rate, and adjusts the true maximum receive window size based on changing network conditions.</span></span>
<span data-ttu-id="98e03-255">Le réglage automatique de la fenêtre de réception active l’extension TCP WSopt par défaut, ce qui autorise jusqu’à 16 776 960 octets pour la taille réelle de la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="98e03-255">Receive window auto-tuning enables the TCP WSopt extension by default, allowing up to 16,776,960 bytes for the true window size.</span></span>
<span data-ttu-id="98e03-256">À mesure que les données circulent sur la connexion, la pile TCP/IP surveille la connexion, mesure le produit de délai de bande passante actuel pour la connexion et la vitesse de réception de l’application, et ajuste la taille réelle de la fenêtre de réception pour optimiser le débit.</span><span class="sxs-lookup"><span data-stu-id="98e03-256">As the data flows over the connection, the TCP/IP stack monitors the connection, measures the current bandwidth-delay product for the connection and the application receive rate, and adjusts the actual receive window size to optimize throughput.</span></span>
<span data-ttu-id="98e03-257">La pile TCP/IP modifie la valeur du champ fenêtre dans l’en-tête TCP en fonction des conditions du réseau, puisque le facteur d’échelle WSopt est fixe lorsque la connexion est établie pour la première fois.</span><span class="sxs-lookup"><span data-stu-id="98e03-257">The TCP/IP stack changes the value of the Window field in the TCP header based on network conditions, since the WSopt scale factor is fixed when the connection is first established.</span></span>

<span data-ttu-id="98e03-258">La pile TCP/IP dans Windows Vista n’utilise plus les valeurs de Registre **TcpWindowSize** .</span><span class="sxs-lookup"><span data-stu-id="98e03-258">The TCP/IP stack in Windows Vista no longer uses the **TCPWindowSize** registry values.</span></span>
<span data-ttu-id="98e03-259">Avec un meilleur débit entre les homologues TCP, l’utilisation de la bande passante réseau augmente pendant le transfert de données.</span><span class="sxs-lookup"><span data-stu-id="98e03-259">With better throughput between TCP peers, the utilization of network bandwidth increases during data transfer.</span></span>
<span data-ttu-id="98e03-260">Si toutes les applications sont optimisées pour recevoir des données TCP, l’utilisation globale du réseau peut augmenter considérablement, ce qui rend l’utilisation de la qualité de service (QoS) plus importante sur les réseaux qui fonctionnent à la capacité ou à une approche proche.</span><span class="sxs-lookup"><span data-stu-id="98e03-260">If all the applications are optimized to receive TCP data, then the overall utilization of the network can increase substantially, making the use of Quality of Service (QoS) more important on networks that are operating at or near capacity.</span></span>

<span data-ttu-id="98e03-261">Le comportement par défaut de Windows Vista pour la mise en mémoire tampon de réception lorsque le **mode de \_ \_ compatibilité \_ SIO Set** n’est pas spécifié à l’aide de **WsaBehaviorReceiveBuffering** est qu’aucune réduction de la taille de la fenêtre de réception à l’aide de l’option **\_ RCVBUF** socket n’est autorisée après l’établissement d’une connexion.</span><span class="sxs-lookup"><span data-stu-id="98e03-261">The default behavior on Windows Vista for receive buffering when **SIO\_SET\_COMPATIBILITY\_MODE** is not specified using **WsaBehaviorReceiveBuffering** is that no receive window size reductions using **SO\_RCVBUF** socket option are allowed after a connection is established.</span></span>

<span data-ttu-id="98e03-262">Le comportement par défaut de Windows Vista pour le réglage automatique **lorsque \_ SIO \_ Set \_ mode de compatibilité** n’est pas spécifié à l’aide de **WsaBehaviorAutoTuning** est que la pile reçoit le réglage automatique de la fenêtre à l’aide d’un facteur d’échelle de fenêtre de 8.</span><span class="sxs-lookup"><span data-stu-id="98e03-262">The default behavior on Windows Vista for auto-tuning when **SIO\_SET\_COMPATIBILITY\_MODE** is not specified using **WsaBehaviorAutoTuning** is that the stack will do receive window auto-tuning using a window scale factor of 8.</span></span>
<span data-ttu-id="98e03-263">Notez que si une application définit une taille de fenêtre de réception valide avec l’option de socket **so \_ RCVBUF** , la pile utilise la taille spécifiée et le réglage automatique de la réception de fenêtre est désactivé.</span><span class="sxs-lookup"><span data-stu-id="98e03-263">Note that if an application sets a valid receive window size with the **SO\_RCVBUF** socket option, the stack will use the size specified and window receive auto-tuning will disabled.</span></span>
<span data-ttu-id="98e03-264">Le réglage automatique de Windows peut également être désactivé entièrement à l’aide de la commande suivante, `netsh interface tcp set global autotuninglevel=disabled` , auquel cas la spécification de **WsaBehaviorAutoTuning** n’a aucun effet.</span><span class="sxs-lookup"><span data-stu-id="98e03-264">Windows autotuning may also be disabled completely using the following command, `netsh interface tcp set global autotuninglevel=disabled`, in which case specifying **WsaBehaviorAutoTuning** will have no affect.</span></span>
<span data-ttu-id="98e03-265">Le réglage automatique de la réception de fenêtre peut également être désactivé en fonction de la stratégie de groupe définie sur Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="98e03-265">Window receive autotuning can also be disabled based on group policy set on Windows Server 2008.</span></span>

<span data-ttu-id="98e03-266">L’option **WsaBehaviorAutoTuning** est nécessaire sur Windows Vista pour certains pare-feu et périphériques de passerelle Internet qui ne prennent pas correctement en charge les flux de données pour les connexions TCP qui utilisent l’extension WSopt et un facteur d’échelle Windows.</span><span class="sxs-lookup"><span data-stu-id="98e03-266">The **WsaBehaviorAutoTuning** option is needed on Windows Vista for some Internet gateway devices and firewalls that do not correctly support data flows for TCP connections that use the WSopt extension and a windows scale factor.</span></span>
<span data-ttu-id="98e03-267">Sur Windows Vista, un récepteur négocie par défaut un facteur d’échelle de fenêtre de 8 pour une taille de fenêtre réelle maximale de 16 776 960 octets.</span><span class="sxs-lookup"><span data-stu-id="98e03-267">On Windows Vista, a receiver by default negotiates a window scale factor of 8 for a maximum true window size of 16,776,960 bytes.</span></span>
<span data-ttu-id="98e03-268">Lorsque les données commencent à circuler sur une liaison rapide, Windows commence par utiliser une taille de fenêtre de 64 kilo-octets en affectant au champ de la fenêtre de l’en-tête TCP la valeur 256 et en définissant le facteur d’échelle de la fenêtre sur 8 dans les options TCP (256 \* 2 ^ 8 = 64 Ko).</span><span class="sxs-lookup"><span data-stu-id="98e03-268">When data begins to flow on a fast link, Windows initially starts with a 64 Kilobyte true window size by setting the Window field of the TCP header to 256 and setting the window scale factor to 8 in the TCP options (256\*2^8=64KB).</span></span>
<span data-ttu-id="98e03-269">Certains pare-feu et périphériques de passerelle Internet ignorent le facteur d’échelle de la fenêtre et examinent uniquement le champ de fenêtre publié dans l’en-tête TCP spécifié comme 256, et suppriment les paquets entrants pour la connexion contenant plus de 256 octets de données TCP.</span><span class="sxs-lookup"><span data-stu-id="98e03-269">Some Internet gateway devices and firewalls ignore the window scale factor and only look at the advertised Window field in the TCP header specified as 256, and drop incoming packets for the connection that contain more than 256 bytes of TCP data.</span></span>
<span data-ttu-id="98e03-270">Pour prendre en charge la mise à l’échelle de la fenêtre de réception TCP, un pare-feu ou un périphérique de passerelle doit surveiller le protocole de transfert TCP et suivre le facteur d’échelle de la fenêtre négociée dans le cadre des données de connexion TCP.</span><span class="sxs-lookup"><span data-stu-id="98e03-270">To support TCP receive window scaling, a gateway device or firewall must monitor the TCP handshake and track the negotiated window scale factor as part of the TCP connection data.</span></span>
<span data-ttu-id="98e03-271">Certaines applications et implémentations de pile TCP sur d’autres plateformes ignorent également l’extension WSopt TCP et le facteur d’échelle de la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="98e03-271">Also some applications and TCP stack implementations on other platforms ignore the TCP WSopt extension and the window scaling factor.</span></span>
<span data-ttu-id="98e03-272">L’hôte distant qui envoie les données peut donc envoyer des données à la fréquence annoncée dans le champ de la fenêtre de l’en-tête TCP (256 octets).</span><span class="sxs-lookup"><span data-stu-id="98e03-272">So the remote host sending the data may send data at the rate advertised in the Window field of the TCP header (256 bytes).</span></span>
<span data-ttu-id="98e03-273">Cela peut entraîner un ralentissement de la réception des données par le récepteur.</span><span class="sxs-lookup"><span data-stu-id="98e03-273">This can result in data being received very slowly by the receiver.</span></span>

<span data-ttu-id="98e03-274">Le fait de définir le membre **BehaviorId** sur **WsaBehaviorAutoTuning** et le **TargetOsVersion** sur Windows Vista réduit le facteur d’échelle de la fenêtre à 2. par conséquent, le champ de la fenêtre de l’en-tête TCP est initialement défini à 16 384 octets et le facteur d’échelle de la fenêtre est défini sur 2 pour une taille initiale réelle de la réception de 64 octets.</span><span class="sxs-lookup"><span data-stu-id="98e03-274">Setting the **BehaviorId** member to **WsaBehaviorAutoTuning** and the **TargetOsVersion** to Windows Vista reduces the window scale factor to 2, so the Window field in the TCP header is initially set to 16,384 bytes and the window scale factor is set to 2 for an initial true window receive size of 64K bytes.</span></span>
<span data-ttu-id="98e03-275">La fonctionnalité de réglage automatique de la fenêtre peut ensuite augmenter la taille réelle de la réception de la fenêtre, jusqu’à 262 140 octets, en affectant au champ de la fenêtre de l’en-tête TCP la valeur 65 535 octets.</span><span class="sxs-lookup"><span data-stu-id="98e03-275">The window auto-tuning feature can then increase the true window receive size up to 262,140 bytes by setting the Window field in the TCP header to 65,535 bytes.</span></span>
<span data-ttu-id="98e03-276">Une application doit définir l’IOCTL du **\_ \_ \_ mode de compatibilité Set SIO** dès qu’un socket est créé, car cette option n’a aucun sens ou s’applique après l’envoi d’un SYN.</span><span class="sxs-lookup"><span data-stu-id="98e03-276">An application should set the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL as soon as a socket is created, since this option doesn't make sense or apply after a SYN is sent.</span></span>
<span data-ttu-id="98e03-277">La définition de cette option a le même impact que la commande suivante : `netsh interface tcp set global autotuninglevel=highlyrestricted`</span><span class="sxs-lookup"><span data-stu-id="98e03-277">Setting this option has the same impact as the following command: `netsh interface tcp set global autotuninglevel=highlyrestricted`</span></span>

<span data-ttu-id="98e03-278">Notez que le fichier d’en-tête *Mswsockdef. h* est automatiquement inclus dans *mswsock. h* ou *Netiodef. h* et qu’il ne doit pas être utilisé directement.</span><span class="sxs-lookup"><span data-stu-id="98e03-278">Note that the *Mswsockdef.h* header file is automatically included in *Mswsock.h* or *Netiodef.h*, and should not be used directly.</span></span>

## <a name="see-also"></a><span data-ttu-id="98e03-279">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="98e03-279">See also</span></span>

[<span data-ttu-id="98e03-280">**socle**</span><span class="sxs-lookup"><span data-stu-id="98e03-280">**socket**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-socket)

[<span data-ttu-id="98e03-281">**WSAGetLastError**</span><span class="sxs-lookup"><span data-stu-id="98e03-281">**WSAGetLastError**</span></span>](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror)

[<span data-ttu-id="98e03-282">**WSAGetOverlappedResult**</span><span class="sxs-lookup"><span data-stu-id="98e03-282">**WSAGetOverlappedResult**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsagetoverlappedresult)

[<span data-ttu-id="98e03-283">**WSAIoctl**</span><span class="sxs-lookup"><span data-stu-id="98e03-283">**WSAIoctl**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl)

[<span data-ttu-id="98e03-284">**WSAOVERLAPPED**</span><span class="sxs-lookup"><span data-stu-id="98e03-284">**WSAOVERLAPPED**</span></span>](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped)

[<span data-ttu-id="98e03-285">**WSASocketA**</span><span class="sxs-lookup"><span data-stu-id="98e03-285">**WSASocketA**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsasocketa)

[<span data-ttu-id="98e03-286">**WSASocketW**</span><span class="sxs-lookup"><span data-stu-id="98e03-286">**WSASocketW**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsasocketw)
