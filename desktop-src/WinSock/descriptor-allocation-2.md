---
description: Alors que les fournisseurs de services Windows Sockets sont encouragés à implémenter des sockets en tant qu’objets IFS (Installable File System), l’architecture Winsock prend également en charge les fournisseurs de services dont les handles de socket ne sont pas des objets IFS.
ms.assetid: ed5e10f4-fa17-4a07-9cac-43767915b8e9
title: Allocation du descripteur
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 095301798eb850fc4eb63e1939712379b5ead85e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106514180"
---
# <a name="descriptor-allocation"></a><span data-ttu-id="3a587-103">Allocation du descripteur</span><span class="sxs-lookup"><span data-stu-id="3a587-103">Descriptor Allocation</span></span>

<span data-ttu-id="3a587-104">Alors que les fournisseurs de services Windows Sockets sont encouragés à implémenter des sockets en tant qu’objets IFS (Installable File System), l’architecture Winsock prend également en charge les fournisseurs de services dont les handles de socket ne sont pas des objets IFS.</span><span class="sxs-lookup"><span data-stu-id="3a587-104">While Windows Sockets service providers are encouraged to implement sockets as installable file system (IFS) objects, the Winsock architecture also accommodates service providers whose socket handles are not IFS objects.</span></span> <span data-ttu-id="3a587-105">Les fournisseurs avec des handles IFS l’indiquent par le biais du \_ \_ bit de l’attribut XP1 IFS handles dans la structure [**WSAPROTOCOL \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) .</span><span class="sxs-lookup"><span data-stu-id="3a587-105">Providers with IFS handles indicate this through the XP1\_IFS\_HANDLES attribute bit in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure.</span></span> <span data-ttu-id="3a587-106">(Remarque : XP1 \_ IFS \_ gère le bit d’attribut n’a pas été inclus dans la version 2.0.8 de la spécification de l’API, mais a été ajouté par le biais du mécanisme errata.) Les clients Winsock SPI peuvent tirer parti des fournisseurs dont les descripteurs de socket sont des descripteurs IFS en utilisant ces descripteurs avec les fonctionnalités d’e/s Windows standard, telles que [ReadFile](/windows/win32/api/fileapi/nf-fileapi-readfile) et [WriteFile](/windows/win32/api/fileapi/nf-fileapi-writefile).</span><span class="sxs-lookup"><span data-stu-id="3a587-106">(Note: the XP1\_IFS\_HANDLES attribute bit was not included in release 2.0.8 of the API specification, but has since been added through the errata mechanism.) Winsock SPI clients may take advantage of providers whose socket descriptors are IFS handles by using these descriptors with standard Windows I/O facilities, such as [ReadFile](/windows/win32/api/fileapi/nf-fileapi-readfile) and [WriteFile](/windows/win32/api/fileapi/nf-fileapi-writefile).</span></span>

<span data-ttu-id="3a587-107">Chaque fois qu’un fournisseur IFS crée un descripteur de socket, il est obligatoire que le fournisseur appelle [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) avant de fournir le nouveau descripteur à un client SPI Windows Sockets.</span><span class="sxs-lookup"><span data-stu-id="3a587-107">Whenever an IFS provider creates a new socket descriptor, it is mandatory that the provider call [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) prior to supplying the new handle to a Windows Sockets SPI client.</span></span> <span data-ttu-id="3a587-108">Cette fonction prend un identificateur de fournisseur et un handle IFS proposé du fournisseur comme entrée et retourne un handle (éventuellement) modifié.</span><span class="sxs-lookup"><span data-stu-id="3a587-108">This function takes a provider identifier and a proposed IFS handle from the provider as input and returns a (possibly) modified handle.</span></span> <span data-ttu-id="3a587-109">Le fournisseur IFS ne doit fournir que le descripteur modifié à son client, et toutes les demandes du client référencent uniquement ce handle modifié.</span><span class="sxs-lookup"><span data-stu-id="3a587-109">The IFS provider must supply only the modified handle to its client, and all requests from the client will reference only this modified handle.</span></span> <span data-ttu-id="3a587-110">Il est garanti que le descripteur modifié ne peut pas être distingué du handle proposé en ce qui concerne le système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="3a587-110">The modified handle is guaranteed to be indistinguishable from the proposed handle as far as the operating system is concerned.</span></span> <span data-ttu-id="3a587-111">Par conséquent, dans la plupart des cas, le fournisseur de services choisira simplement d’utiliser uniquement le descripteur modifié dans tout son traitement interne.</span><span class="sxs-lookup"><span data-stu-id="3a587-111">Thus in most instances, the service provider will simply choose to use only the modified handle in all of its internal processing.</span></span> <span data-ttu-id="3a587-112">L’objectif de cette fonction de modification est de permettre à l'32.dll Ws2 de \_ simplifier considérablement le processus d’identification du fournisseur de services associé à un socket donné.</span><span class="sxs-lookup"><span data-stu-id="3a587-112">The purpose of this modification function is to allow the Ws2\_32.dll to greatly streamline the process of identifying the service provider associated with a given socket.</span></span>

<span data-ttu-id="3a587-113">Les fournisseurs qui ne retournent pas de handles IFS doivent obtenir un handle valide de la \_32.dll Ws2 via l’appel [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) .</span><span class="sxs-lookup"><span data-stu-id="3a587-113">Providers that do not return IFS handles must obtain a valid handle from the Ws2\_32.dll via the [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) call.</span></span> <span data-ttu-id="3a587-114">Le fournisseur nonIFS doit proposer uniquement un handle Windows Sockets fourni par 2.DLL à son client, et toutes les demandes du client référencent uniquement ces handles.</span><span class="sxs-lookup"><span data-stu-id="3a587-114">The nonIFS provider must offer only a Windows Sockets 2.DLL-supplied handle to its client, and all requests from the client will reference only these handles.</span></span> <span data-ttu-id="3a587-115">Pour faciliter l’implémentation des fournisseurs de services, l’un des paramètres d’entrée fournis par un fournisseur dans **WPUCreateSocketHandle** est une valeur de contexte DWORD.</span><span class="sxs-lookup"><span data-stu-id="3a587-115">As a convenience to service provider implementers, one of the input parameters supplied by a provider in **WPUCreateSocketHandle** is a DWORD context value.</span></span> <span data-ttu-id="3a587-116">Le \_32.dll Ws2 associe cette valeur de contexte au handle de socket alloué et permet à un fournisseur de services de récupérer la valeur de contexte à tout moment via l’appel [**WPUQuerySocketHandleContext**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuquerysockethandlecontext) .</span><span class="sxs-lookup"><span data-stu-id="3a587-116">The Ws2\_32.dll associates this context value with the allocated socket handle and allows a service provider to retrieve the context value at any time through the [**WPUQuerySocketHandleContext**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuquerysockethandlecontext) call.</span></span> <span data-ttu-id="3a587-117">Une utilisation courante de cette valeur de contexte serait de stocker un pointeur vers une structure de données gérée par le fournisseur de services utilisée pour stocker les informations d’État du Socket.</span><span class="sxs-lookup"><span data-stu-id="3a587-117">A typical use for this context value would be to store a pointer to a service provider maintained data structure used to store socket state information.</span></span>

 

 
