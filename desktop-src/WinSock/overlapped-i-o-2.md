---
description: Windows Sockets 2 introduit des e/s avec chevauchement et requiert que tous les fournisseurs de transport prennent en charge cette fonctionnalité.
ms.assetid: 90d49171-e211-4426-aa56-88aaeac7c578
title: Entrée/sortie avec chevauchement
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0d8caa13dd3d50e4f0fdaa1b92fa8e99afd8e2e1
ms.sourcegitcommit: 3d9dce1bd6c84e2b51759e940aa95aa9b459cd20
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/04/2021
ms.locfileid: "103869621"
---
# <a name="overlapped-inputoutput"></a><span data-ttu-id="2d03c-103">Entrée/sortie avec chevauchement</span><span class="sxs-lookup"><span data-stu-id="2d03c-103">Overlapped Input/Output</span></span>

<span data-ttu-id="2d03c-104">Windows Sockets 2 introduit des e/s avec chevauchement et requiert que tous les fournisseurs de transport prennent en charge cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="2d03c-104">Windows Sockets 2 introduces overlapped I/O and requires that all transport providers support this capability.</span></span> <span data-ttu-id="2d03c-105">Les e/s avec chevauchement peuvent être effectuées uniquement sur les sockets créés à l’aide de la fonction [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) avec l' \_ indicateur de chevauchement d’indicateur WSA \_ défini, et suivre le modèle établi dans Windows.</span><span class="sxs-lookup"><span data-stu-id="2d03c-105">Overlapped I/O can be performed only on sockets that were created through the [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) function with the WSA\_FLAG\_OVERLAPPED flag set, and follow the model established in Windows.</span></span>

<span data-ttu-id="2d03c-106">Pour la réception, un client utilise [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) ou [**WSPRecvFrom**](/previous-versions/windows/desktop/legacy/ms742287(v=vs.85)) pour fournir des mémoires tampons dans lesquelles les données doivent être reçues.</span><span class="sxs-lookup"><span data-stu-id="2d03c-106">For receiving, a client uses [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) or [**WSPRecvFrom**](/previous-versions/windows/desktop/legacy/ms742287(v=vs.85)) to supply buffers into which data is to be received.</span></span> <span data-ttu-id="2d03c-107">Si une ou plusieurs mémoires tampons sont publiées avant le moment où les données ont été reçues par le réseau, il est possible que les données soient placées dans les mémoires tampons de l’utilisateur immédiatement à mesure qu’elles arrivent et, par conséquent, éviter l’opération de copie qui se produirait autrement.</span><span class="sxs-lookup"><span data-stu-id="2d03c-107">If one or more buffers are posted prior to the time when data has been received by the network, it is possible that data will be placed into the user's buffers immediately as it arrives and thereby avoid the copy operation that would otherwise occur.</span></span> <span data-ttu-id="2d03c-108">Si des données arrivent lorsque des mémoires tampons de réception ont déjà été publiées, elles sont copiées immédiatement dans les tampons de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2d03c-108">If data arrives when receive buffers have already been posted, it is copied immediately into the user's buffers.</span></span> <span data-ttu-id="2d03c-109">Si des données arrivent quand aucune mémoire tampon de réception n’a été publiée par l’application, le fournisseur de services accède au style synchrone de l’opération dans lequel les données entrantes sont mises en mémoire tampon jusqu’à ce que le client envoie un appel de réception et fournit ainsi une mémoire tampon dans laquelle les données peuvent être copiées.</span><span class="sxs-lookup"><span data-stu-id="2d03c-109">If data arrives when no receive buffers have been posted by the application, the service provider resorts to the synchronous style of operation where the incoming data is buffered internally until such time as the client issues a receive call and thereby supplies a buffer into which the data may be copied.</span></span> <span data-ttu-id="2d03c-110">Une exception est si l’application a utilisé [**WSPSetSockOpt**](/previous-versions/windows/hardware/network/ff566318(v=vs.85)) pour définir la taille de la mémoire tampon de réception sur zéro.</span><span class="sxs-lookup"><span data-stu-id="2d03c-110">An exception to this would be if the application used [**WSPSetSockOpt**](/previous-versions/windows/hardware/network/ff566318(v=vs.85)) to set the size of the receive buffer to zero.</span></span> <span data-ttu-id="2d03c-111">Dans ce cas, les protocoles Reliable autorisent uniquement la réception des données lorsque les tampons d’application ont été publiés, et les données sur les protocoles non fiables sont perdues.</span><span class="sxs-lookup"><span data-stu-id="2d03c-111">In this instance, reliable protocols would only allow data to be received when application buffers had been posted, and data on unreliable protocols would be lost.</span></span>

<span data-ttu-id="2d03c-112">Du côté de l’envoi, les clients utilisent [**WSPSend**](/previous-versions/windows/hardware/network/ff566316(v=vs.85)) ou [**WSPSendTo**](/previous-versions/windows/desktop/legacy/ms742291(v=vs.85)) pour fournir des pointeurs aux mémoires tampons remplies, puis décident de ne pas perturber les tampons jusqu’à ce que le réseau ait consommé le contenu de la mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="2d03c-112">On the sending side, clients use [**WSPSend**](/previous-versions/windows/hardware/network/ff566316(v=vs.85)) or [**WSPSendTo**](/previous-versions/windows/desktop/legacy/ms742291(v=vs.85)) to supply pointers to filled buffers and then agree not to disturb the buffers in any way until the network has consumed the buffer's contents.</span></span>

<span data-ttu-id="2d03c-113">Les appels d’envoi et de réception superposés sont retournés immédiatement.</span><span class="sxs-lookup"><span data-stu-id="2d03c-113">Overlapped send and receive calls return immediately.</span></span> <span data-ttu-id="2d03c-114">Une valeur de retour égale à zéro indique que l’opération d’e/s s’est terminée immédiatement et que l’indication d’achèvement correspondante s’est déjà produite.</span><span class="sxs-lookup"><span data-stu-id="2d03c-114">A return value of zero indicates that the I/O operation completed immediately and that the corresponding completion indication has already occurred.</span></span> <span data-ttu-id="2d03c-115">Autrement dit, l’objet événement associé a été signalé ou la routine d’achèvement a été mise en file d’attente via [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span><span class="sxs-lookup"><span data-stu-id="2d03c-115">That is, the associated event object has been signaled, or the completion routine has been queued through [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span></span> <span data-ttu-id="2d03c-116">Une valeur de retour de \_ l’erreur de socket couplée avec un code d’erreur d' \_ e/s de WSA \_ en attente indique que l’opération avec chevauchement a été correctement lancée et qu’une indication suivante sera fournie lorsque les mémoires tampons d’envoi ont été consommées ou lorsque les tampons de réception sont remplis.</span><span class="sxs-lookup"><span data-stu-id="2d03c-116">A return value of SOCKET\_ERROR coupled with an error code of WSA\_IO\_PENDING indicates that the overlapped operation has been successfully initiated and that a subsequent indication will be provided when send buffers have been consumed or when receive buffers are filled.</span></span> <span data-ttu-id="2d03c-117">Tout autre code d’erreur indique que l’opération avec chevauchement n’a pas été lancée avec succès et qu’aucune indication d’achèvement n’est à venir.</span><span class="sxs-lookup"><span data-stu-id="2d03c-117">Any other error code indicates that the overlapped operation was not successfully initiated and that no completion indication will be forthcoming.</span></span>

<span data-ttu-id="2d03c-118">Les opérations d’envoi et de réception peuvent être superposées.</span><span class="sxs-lookup"><span data-stu-id="2d03c-118">Both send and receive operations can be overlapped.</span></span> <span data-ttu-id="2d03c-119">Les fonctions de réception peuvent être appelées plusieurs fois pour envoyer des tampons de réception en vue de la préparation des données entrantes, et les fonctions d’envoi peuvent être appelées plusieurs fois pour mettre en file d’attente l’envoi de plusieurs mémoires tampons.</span><span class="sxs-lookup"><span data-stu-id="2d03c-119">The receive functions may be invoked multiple times to post receive buffers in preparation for incoming data, and the send functions may be invoked multiple times to queue up multiple buffers to be sent.</span></span> <span data-ttu-id="2d03c-120">Notez que lorsqu’une série de mémoires tampons d’envoi avec chevauchement sera envoyée dans l’ordre indiqué, les indications d’achèvement correspondantes peuvent se produire dans un ordre différent.</span><span class="sxs-lookup"><span data-stu-id="2d03c-120">Note that while a series of overlapped send buffers will be sent in the order supplied, the corresponding completion indications may occur in a different order.</span></span> <span data-ttu-id="2d03c-121">De même, du côté de la réception, les tampons sont remplis dans l’ordre dans lequel ils sont fournis, mais les indications de saisie semi-automatique peuvent se produire dans un ordre différent.</span><span class="sxs-lookup"><span data-stu-id="2d03c-121">Likewise, on the receiving side, buffers will be filled in the order they are supplied, but completion indications may occur in a different order.</span></span>

<span data-ttu-id="2d03c-122">La fonctionnalité d’achèvement différé des e/s avec chevauchement est également disponible pour [**WSPIoctl**](/previous-versions/windows/hardware/network/ff566296(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="2d03c-122">The deferred completion feature of overlapped I/O is also available for [**WSPIoctl**](/previous-versions/windows/hardware/network/ff566296(v=vs.85)).</span></span>

## <a name="delivering-completion-indications"></a><span data-ttu-id="2d03c-123">Envoi d’indications d’achèvement</span><span class="sxs-lookup"><span data-stu-id="2d03c-123">Delivering Completion Indications</span></span>

<span data-ttu-id="2d03c-124">Les fournisseurs de services ont deux façons d’indiquer l’achèvement avec chevauchement : la définition d’un objet d’événement spécifié par le client ou l’appel d’une routine de saisie semi-automatique spécifiée par le client.</span><span class="sxs-lookup"><span data-stu-id="2d03c-124">Service providers have two ways to indicate overlapped completion: setting a client-specified event object, or invoking a client-specified completion routine.</span></span> <span data-ttu-id="2d03c-125">Dans les deux cas, une structure de données, [**WSAOVERLAPPED**](/windows/desktop/api/Winsock2/ns-winsock2-wsaoverlapped), est associée à chaque opération avec chevauchement.</span><span class="sxs-lookup"><span data-stu-id="2d03c-125">In both cases a data structure, [**WSAOVERLAPPED**](/windows/desktop/api/Winsock2/ns-winsock2-wsaoverlapped), is associated with each overlapped operation.</span></span> <span data-ttu-id="2d03c-126">Cette structure est allouée par le client et utilisée par elle pour indiquer l’objet d’événement (le cas échéant) à définir lorsque l’achèvement se produit.</span><span class="sxs-lookup"><span data-stu-id="2d03c-126">This structure is allocated by the client and used by it to indicate which event object (if any) is to be set when completion occurs.</span></span> <span data-ttu-id="2d03c-127">La structure **WSAOVERLAPPED** peut être utilisée par le fournisseur de services comme un emplacement pour stocker un handle vers les résultats (par exemple, le nombre d’octets transférés, les indicateurs mis à jour, les codes d’erreur, etc.) pour une opération Overlapped particulière.</span><span class="sxs-lookup"><span data-stu-id="2d03c-127">The **WSAOVERLAPPED** structure may be used by the service provider as a place to store a handle to the results (for example, number of bytes transferred, updated flags, error codes, etc.) for a particular overlapped operation.</span></span> <span data-ttu-id="2d03c-128">Pour obtenir ces résultats, les clients doivent appeler [**WSPGetOverlappedResult**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspgetoverlappedresult), en passant un pointeur vers la structure OVERLAPPED correspondante.</span><span class="sxs-lookup"><span data-stu-id="2d03c-128">To obtain these results clients must invoke [**WSPGetOverlappedResult**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspgetoverlappedresult), passing in a pointer to the corresponding overlapped structure.</span></span>

<span data-ttu-id="2d03c-129">Si l’indication de saisie semi-automatique basée sur les événements est sélectionnée pour une requête d’e/s avec chevauchement particulière, la routine [**WSPGetOverlappedResult**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspgetoverlappedresult) peut elle-même être utilisée par les clients pour interroger ou attendre la fin de l’opération Overlapped.</span><span class="sxs-lookup"><span data-stu-id="2d03c-129">If event based completion indication is selected for a particular overlapped I/O request, the [**WSPGetOverlappedResult**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspgetoverlappedresult) routine may itself be used by clients to either poll or wait for completion of the overlapped operation.</span></span> <span data-ttu-id="2d03c-130">Si la saisie semi-automatique est sélectionnée pour une requête d’e/s avec chevauchement particulière, seule l’option d’interrogation de **WSPGetOverlappedResult** est disponible.</span><span class="sxs-lookup"><span data-stu-id="2d03c-130">If completion-routine-based completion indication is selected for a particular overlapped I/O request, only the polling option of **WSPGetOverlappedResult** is available.</span></span> <span data-ttu-id="2d03c-131">Un client peut également utiliser d’autres moyens d’attendre (comme l’utilisation de [**WSAWaitForMultipleEvents**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents)) jusqu’à ce que l’objet d’événement correspondant soit signalé ou que la routine de saisie semi-automatique spécifiée ait été appelée par le fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="2d03c-131">A client may also use other means to wait (such as using [**WSAWaitForMultipleEvents**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents)) until the corresponding event object has been signaled or the specified completion routine has been invoked by the service provider.</span></span> <span data-ttu-id="2d03c-132">Une fois la saisie semi-automatique indiquée, le client peut appeler **WSPGetOverlappedResult**, dans l’attente que l’appel se termine immédiatement.</span><span class="sxs-lookup"><span data-stu-id="2d03c-132">Once completion has been indicated, the client may invoke **WSPGetOverlappedResult**, with the expectation that the call will complete immediately.</span></span>

## <a name="invoking-socket-io-completion-routines"></a><span data-ttu-id="2d03c-133">Appel des routines de fin d’exécution d’e/s de socket</span><span class="sxs-lookup"><span data-stu-id="2d03c-133">Invoking Socket I/O Completion Routines</span></span>

<span data-ttu-id="2d03c-134">Si le paramètre *lpCompletionRoutine* d’une opération avec chevauchement n’a pas la **valeur null**, il incombe au fournisseur de services d’organiser l’appel de la routine de saisie semi-automatique spécifiée par le client lorsque l’opération avec chevauchement se termine.</span><span class="sxs-lookup"><span data-stu-id="2d03c-134">If the *lpCompletionRoutine* parameter to an overlapped operation is not **NULL**, it is the service provider's responsibility to arrange for invocation of the client-specified completion routine when the overlapped operation completes.</span></span> <span data-ttu-id="2d03c-135">Étant donné que la routine de saisie semi-automatique doit être exécutée dans le contexte du thread qui a initié l’opération Overlapped, elle ne peut pas être appelée directement à partir du fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="2d03c-135">Since the completion routine must be executed in the context of the same thread that initiated the overlapped operation, it cannot be invoked directly from the service provider.</span></span> <span data-ttu-id="2d03c-136">Le \_32.DLL Ws2 offre un mécanisme d’appel de procédure asynchrone (APC) pour faciliter l’appel des routines de saisie semi-automatique.</span><span class="sxs-lookup"><span data-stu-id="2d03c-136">The Ws2\_32.DLL offers an asynchronous procedure call (APC) mechanism to facilitate invocation of completion routines.</span></span>

<span data-ttu-id="2d03c-137">Un fournisseur de services s’arrange pour qu’une fonction soit exécutée dans le thread approprié en appelant [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span><span class="sxs-lookup"><span data-stu-id="2d03c-137">A service provider arranges for a function to be executed in the proper thread by calling [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span></span> <span data-ttu-id="2d03c-138">Cette fonction peut être appelée à partir de n’importe quel processus et contexte de thread, même un contexte différent du thread et du processus qui a été utilisé pour initier l’opération avec chevauchement.</span><span class="sxs-lookup"><span data-stu-id="2d03c-138">This function can be called from any process and thread context, even a context different from the thread and process that was used to initiate the overlapped operation.</span></span>

<span data-ttu-id="2d03c-139">[**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) prend comme paramètres d’entrée un pointeur vers une structure [**WSATHREADID**](/windows/desktop/api/Ws2spi/ns-ws2spi-wsathreadid) , un pointeur vers une fonction APC à appeler et une valeur de contexte 32 bits qui est ensuite transmise à la fonction APC.</span><span class="sxs-lookup"><span data-stu-id="2d03c-139">[**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) takes as input parameters a pointer to a [**WSATHREADID**](/windows/desktop/api/Ws2spi/ns-ws2spi-wsathreadid) structure, a pointer to an APC function to be invoked, and a 32-bit context value that is subsequently passed to the APC function.</span></span> <span data-ttu-id="2d03c-140">Les fournisseurs de services sont toujours fournis avec un pointeur vers la structure **WSATHREADID** appropriée via le paramètre *lpThreadId* de la fonction Overlapped.</span><span class="sxs-lookup"><span data-stu-id="2d03c-140">Service providers are always supplied with a pointer to the proper **WSATHREADID** structure through the *lpThreadId* parameter to the overlapped function.</span></span> <span data-ttu-id="2d03c-141">Le fournisseur doit stocker la structure **WSATHREADID** localement et fournir un pointeur vers cette copie de la structure **WSATHREADID** en tant que paramètre d’entrée à **WPUQueueApc**.</span><span class="sxs-lookup"><span data-stu-id="2d03c-141">The provider should store the **WSATHREADID** structure locally and supply a pointer to this copy of the **WSATHREADID** structure as an input parameter to **WPUQueueApc**.</span></span> <span data-ttu-id="2d03c-142">Une fois la fonction **WPUQueueApc** retournée, le fournisseur peut supprimer sa copie du **WSATHREADID**.</span><span class="sxs-lookup"><span data-stu-id="2d03c-142">Once the **WPUQueueApc** function returns, the provider can dispose of its copy of the **WSATHREADID**.</span></span>

<span data-ttu-id="2d03c-143">La procédure [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) met simplement en file d’attente des informations suffisantes pour appeler la fonction APC indiquée avec les paramètres donnés, mais ne l’appelle pas.</span><span class="sxs-lookup"><span data-stu-id="2d03c-143">The procedure [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) simply enqueues sufficient information to call the indicated APC function with the given parameters, but does not call it.</span></span> <span data-ttu-id="2d03c-144">Lorsque le thread cible entre dans un état d’attente alerté, ces informations sont déplacées dans la file d’attente et un appel est effectué vers la fonction APC dans ce thread cible et le contexte de processus.</span><span class="sxs-lookup"><span data-stu-id="2d03c-144">When the target thread enters an alertable wait state, this information is dequeued and a call is made to the APC function in that target thread and process context.</span></span> <span data-ttu-id="2d03c-145">Étant donné que le mécanisme APC ne prend en charge qu’une seule valeur de contexte 32 bits, la fonction APC ne peut pas être la routine de saisie semi-automatique spécifiée par le client, ce qui implique davantage de paramètres.</span><span class="sxs-lookup"><span data-stu-id="2d03c-145">Because the APC mechanism supports only a single 32-bit context value, the APC function cannot itself be the client-specified completion routine, which involves more parameters.</span></span> <span data-ttu-id="2d03c-146">Le fournisseur de services doit à la place fournir un pointeur vers sa propre fonction APC qui utilise la valeur de contexte fournie pour accéder aux informations de résultat nécessaires à l’opération Overlapped, puis appelle la routine de saisie semi-automatique spécifiée par le client.</span><span class="sxs-lookup"><span data-stu-id="2d03c-146">The service provider must instead supply a pointer to its own APC function which uses the supplied context value to access the needed result information for the overlapped operation, and then invokes the client-specified completion routine.</span></span>

<span data-ttu-id="2d03c-147">Pour les fournisseurs de services dans lesquels un composant en mode utilisateur implémente des e/s avec chevauchement, une utilisation classique du mécanisme APC est la suivante :</span><span class="sxs-lookup"><span data-stu-id="2d03c-147">For service providers where a user-mode component implements overlapped I/O, a typical usage of the APC mechanism is as follows:</span></span>

-   <span data-ttu-id="2d03c-148">Lorsque l’opération d’e/s se termine, le fournisseur alloue une petite mémoire tampon et la compresse à l’aide d’un pointeur désignant la procédure de saisie semi-automatique fournie par le client et les valeurs de paramètre à passer à la procédure.</span><span class="sxs-lookup"><span data-stu-id="2d03c-148">When the I/O operation completes, the provider allocates a small buffer and packs it with a pointer to the client-supplied completion procedure and parameter values to pass to the procedure.</span></span>
-   <span data-ttu-id="2d03c-149">Il met en file d’attente un APC, en spécifiant le pointeur vers la mémoire tampon comme valeur de contexte et sa propre procédure intermédiaire comme procédure cible.</span><span class="sxs-lookup"><span data-stu-id="2d03c-149">It queues an APC, specifying the pointer to the buffer as the context value and its own intermediate procedure as the target procedure.</span></span>
-   <span data-ttu-id="2d03c-150">Lorsque le thread cible entre finalement en état d’attente d’alerte, la procédure intermédiaire du fournisseur de services est appelée dans le contexte de thread approprié.</span><span class="sxs-lookup"><span data-stu-id="2d03c-150">When the target thread eventually enters alertable wait state, the service provider's intermediate procedure is called in the proper thread context.</span></span>
-   <span data-ttu-id="2d03c-151">La procédure intermédiaire décompresse simplement les paramètres, libère la mémoire tampon et appelle la procédure de saisie semi-automatique fournie par le client.</span><span class="sxs-lookup"><span data-stu-id="2d03c-151">The intermediate procedure simply unpacks parameters, deallocates the buffer, and calls the client-supplied completion procedure.</span></span>
-   <span data-ttu-id="2d03c-152">Pour les fournisseurs de services dans lesquels un composant en mode noyau implémente des e/s avec chevauchement, une implémentation classique est similaire, à ceci près que l’implémentation utilise des interfaces de noyau standard pour mettre l’APC en file d’attente.</span><span class="sxs-lookup"><span data-stu-id="2d03c-152">For service providers where a kernel-mode component implements overlapped I/O, a typical implementation is similar, except that the implementation would use standard kernel interfaces to enqueue the APC.</span></span>

<span data-ttu-id="2d03c-153">La description des interfaces de noyau appropriées est en dehors de la portée de la spécification Windows Sockets 2.</span><span class="sxs-lookup"><span data-stu-id="2d03c-153">Description of the relevant kernel interfaces is outside the scope of the Windows Sockets 2 specification.</span></span>

> [!Note]  
> <span data-ttu-id="2d03c-154">Les fournisseurs de services doivent autoriser les clients Windows Sockets 2 à appeler des opérations d’envoi et de réception à partir du contexte de la routine d’exécution d’e/s de socket et garantissent que, pour un socket donné, les routines d’exécution d’e/s ne sont pas imbriquées.</span><span class="sxs-lookup"><span data-stu-id="2d03c-154">Service providers must allow Windows Sockets 2 clients to invoke send and receive operations from within the context of the socket I/O completion routine and guarantee that for a given socket, I/O completion routines will not be nested.</span></span>

 

<span data-ttu-id="2d03c-155">Dans certains cas, un fournisseur de services en couche peut avoir besoin de lancer et d’effectuer des opérations avec chevauchement à partir d’un thread de travail interne.</span><span class="sxs-lookup"><span data-stu-id="2d03c-155">Under some circumstances, a layered service provider may need to initiate and complete overlapped operations from within an internal worker thread.</span></span> <span data-ttu-id="2d03c-156">Dans ce cas, un [**WSATHREADID**](/windows/desktop/api/Ws2spi/ns-ws2spi-wsathreadid) n’est pas disponible à partir d’un appel de fonction entrant.</span><span class="sxs-lookup"><span data-stu-id="2d03c-156">In this case, a [**WSATHREADID**](/windows/desktop/api/Ws2spi/ns-ws2spi-wsathreadid) would not be available from an incoming function call.</span></span> <span data-ttu-id="2d03c-157">L’interface du fournisseur de services fournit un appel de [**WPUOpenCurrentThread**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuopencurrentthread)pour obtenir un **WSATHREADID** pour le thread actuel.</span><span class="sxs-lookup"><span data-stu-id="2d03c-157">The service provider interface provides an upcall, [**WPUOpenCurrentThread**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuopencurrentthread), to obtain a **WSATHREADID** for the current thread.</span></span> <span data-ttu-id="2d03c-158">Quand ce **WSATHREADID** n’est plus nécessaire, ses ressources doivent être retournées en appelant [**WPUCloseThread**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuclosethread).</span><span class="sxs-lookup"><span data-stu-id="2d03c-158">When this **WSATHREADID** is no longer needed, its resources should be returned by calling [**WPUCloseThread**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuclosethread).</span></span>

 

 
