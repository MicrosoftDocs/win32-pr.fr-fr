---
description: Notions de base sur les protocoles de WSPListen, WSPAccept et WSPConnect pour l’établissement d’une connexion de socket avec Windows Sockets (Winsock).
ms.assetid: b1b4d6b9-36db-4000-9c6b-662765b6d091
title: 'Notions de base sur les protocoles : écouter, se connecter, accepter'
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d62ef290d71e571154b4d022c24c7e21f8fffa1c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104113018"
---
# <a name="protocol-basics-listen-connect-accept"></a><span data-ttu-id="2a1c6-103">Notions de base sur les protocoles : écouter, se connecter, accepter</span><span class="sxs-lookup"><span data-stu-id="2a1c6-103">Protocol Basics: Listen, Connect, Accept</span></span>

<span data-ttu-id="2a1c6-104">Les opérations de base nécessaires à l’établissement d’une connexion de socket peuvent être expliquées plus facilement en termes de paradigme client-serveur.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-104">The basic operations involved with establishing a socket connection can be most conveniently explained in terms of the client-server paradigm.</span></span>

<span data-ttu-id="2a1c6-105">Le côté serveur crée tout d’abord un socket, le lie à une adresse locale connue (afin que le client puisse le trouver) et met le socket en mode d’écoute, par le biais de [**WSPListen**](/previous-versions/windows/hardware/network/ff566297(v=vs.85)), afin de se préparer aux demandes de connexion entrantes et de spécifier la longueur de la file d’attente de la connexion.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-105">The server side will first create a socket, bind it to a well known local address (so that the client can find it), and put the socket in listening mode, through [**WSPListen**](/previous-versions/windows/hardware/network/ff566297(v=vs.85)), in order to prepare for any incoming connection requests and to specify the length of the connection backlog queue.</span></span> <span data-ttu-id="2a1c6-106">Les fournisseurs de services conservent les demandes de connexion en attente dans une file d’attente de travaux en souffrance jusqu’à ce qu’ils soient traités par le serveur ou soient retirés (en raison d’un délai d’expiration) par le client.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-106">Service providers hold pending connection requests in a backlog queue until they are acted upon by the server or are withdrawn (due to a time-out) by the client.</span></span> <span data-ttu-id="2a1c6-107">Un fournisseur de services peut ignorer silencieusement les demandes d’extension de la taille de la file d’attente des travaux en souffrance au-delà d’une limite supérieure définie par le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-107">A service provider may silently ignore requests to extend the size of the backlog queue beyond a provider-defined upper limit.</span></span>

<span data-ttu-id="2a1c6-108">À ce stade, si un socket bloquant est utilisé, le côté serveur peut appeler immédiatement [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) , qui se bloque jusqu’à ce qu’une demande de connexion soit en attente.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-108">At this point, if a blocking socket is being used, the server side may immediately call [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) which will block until a connection request is pending.</span></span> <span data-ttu-id="2a1c6-109">Inversement, le serveur peut également utiliser l’un des mécanismes d’indication d’événement réseau abordé précédemment pour organiser la notification des demandes de connexion entrantes.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-109">Conversely, the server may also use one of the network event indication mechanisms discussed previously to arrange for notification of incoming connection requests.</span></span> <span data-ttu-id="2a1c6-110">Selon le mécanisme de notification sélectionné, le fournisseur émet un message Windows ou signale un objet d’événement lors de l’arrivée des demandes de connexion.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-110">Depending on the notification mechanism selected, the provider will either issue a Windows message or signal an event object when connection requests arrive.</span></span> <span data-ttu-id="2a1c6-111">Consultez [notification des événements réseau](notification-of-network-events-2.md) pour savoir comment s’inscrire à l' \_ événement réseau d’acceptation FD.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-111">See [Notification of Network Events](notification-of-network-events-2.md) for how to register for the FD\_ACCEPT network event.</span></span>

<span data-ttu-id="2a1c6-112">Le côté client crée un socket approprié et initie la connexion en appelant [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85)), en spécifiant l’adresse de serveur connue.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-112">The client side will create an appropriate socket, and initiate the connection by calling [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85)), specifying the known server address.</span></span> <span data-ttu-id="2a1c6-113">Les clients n’exécutent généralement pas d’opération de [**liaison**](/windows/desktop/api/winsock/nf-winsock-bind) explicite avant d’initialiser une connexion, ce qui permet au fournisseur de services d’effectuer une liaison implicite en son nom.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-113">Clients usually do not perform an explicit [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) operation prior to initiating a connection, allowing the service provider to perform an implicit bind on their behalf.</span></span> <span data-ttu-id="2a1c6-114">Si le socket est en mode blocage, **WSPConnect** se bloque jusqu’à ce que le serveur ait reçu et agi sur la demande de connexion (ou jusqu’à ce qu’un délai d’attente se produise).</span><span class="sxs-lookup"><span data-stu-id="2a1c6-114">If the socket is in blocking mode, **WSPConnect** will block until the server has received and acted upon the connection request (or until a time-out occurs).</span></span> <span data-ttu-id="2a1c6-115">Dans le cas contraire, le client doit utiliser l’un des mécanismes d’indication d’événement réseau abordé précédemment pour organiser la notification d’une nouvelle connexion établie.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-115">Otherwise, the client should use one of the network event indication mechanisms discussed previously to arrange for notification of a new connection being established.</span></span> <span data-ttu-id="2a1c6-116">Selon le mécanisme de notification sélectionné, le fournisseur l’indique à l’aide d’un message Windows ou en signalant un objet d’événement.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-116">Depending on the notification mechanism selected, the provider will indicate this either through a Windows message or by signaling an event object.</span></span>

<span data-ttu-id="2a1c6-117">Lorsque le côté serveur appelle [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept), le fournisseur de services appelle la fonction de condition fournie par l’application, à l’aide des paramètres de fonction pour transmettre les informations du serveur à partir de l’entrée supérieure de la file d’attente des demandes de connexion.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-117">When the server side invokes [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept), the service provider calls the application-supplied condition function, using function parameters to pass into the server information from the top entry in the connection request backlog queue.</span></span> <span data-ttu-id="2a1c6-118">Ces informations comprennent notamment l’adresse de connexion de l’hôte, les données utilisateur disponibles et les informations de QoS disponibles.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-118">This information includes such things as address of connecting host, any available user data, and any available QoS information.</span></span> <span data-ttu-id="2a1c6-119">À l’aide de ces informations, la fonction condition du serveur détermine s’il faut accepter la demande, rejeter la demande ou retarder la prise d’une décision jusqu’à une date ultérieure.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-119">Using this information the server's condition function determines whether to accept the request, reject the request, or defer making a decision until later.</span></span> <span data-ttu-id="2a1c6-120">Cette décision est indiquée par la valeur de retour de la fonction condition.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-120">This decision is indicated through the return value of the condition function.</span></span> <span data-ttu-id="2a1c6-121">Consultez [notification des événements réseau](notification-of-network-events-2.md) pour savoir comment s’inscrire à l' \_ événement réseau FD Connect.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-121">See [Notification of Network Events](notification-of-network-events-2.md) for how to register for the FD\_CONNECT network event.</span></span>

<span data-ttu-id="2a1c6-122">Si le serveur décide d’accepter la demande, le fournisseur doit créer un nouveau socket avec les mêmes attributs et inscriptions d’événements que le socket d’écoute.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-122">If the server decides to accept the request, the provider must create a new socket with all of the same attributes and event registrations as the listening socket.</span></span> <span data-ttu-id="2a1c6-123">Le socket d’origine reste à l’état d’écoute afin que les demandes de connexion suivantes puissent être reçues.</span><span class="sxs-lookup"><span data-stu-id="2a1c6-123">The original socket remains in the listening state so that subsequent connection requests can be received.</span></span> <span data-ttu-id="2a1c6-124">Grâce aux paramètres de sortie de la fonction condition, le serveur peut également fournir des données utilisateur de réponse et affecter des paramètres de qualité de service (en supposant que ces opérations sont prises en charge par le fournisseur de services).</span><span class="sxs-lookup"><span data-stu-id="2a1c6-124">Through output parameters of the condition function, the server may also supply any response user data and assign QoS parameters (assuming that these operations are supported by the service provider).</span></span>

 

 
