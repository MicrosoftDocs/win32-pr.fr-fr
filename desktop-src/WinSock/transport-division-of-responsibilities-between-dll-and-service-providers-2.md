---
description: Cette section fournit une vue d’ensemble de la répartition des responsabilités entre les \_32.dll Ws2 et les fournisseurs de services de transport.
ms.assetid: e1ea1e99-a2bc-4e76-91f6-e388c39dfbbb
title: Division de transport des responsabilités entre la DLL et les fournisseurs de services
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 142ac98c95e95c310c2eefb7bfdaf1f70a03bf28
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106534022"
---
# <a name="transport-division-of-responsibilities-between-dll-and-service-providers"></a><span data-ttu-id="eaf22-103">Division de transport des responsabilités entre la DLL et les fournisseurs de services</span><span class="sxs-lookup"><span data-stu-id="eaf22-103">Transport Division of Responsibilities Between DLL and Service Providers</span></span>

<span data-ttu-id="eaf22-104">Cette section fournit une vue d’ensemble de la répartition des responsabilités entre les \_32.dll Ws2 et les fournisseurs de services de transport.</span><span class="sxs-lookup"><span data-stu-id="eaf22-104">This section provides an overview of the division of responsibility between the Ws2\_32.dll and transport service providers.</span></span>

## <a name="ws2_32dll-functionality-for-transport"></a><span data-ttu-id="eaf22-105">La \_ fonctionnalité Ws232.dll pour le transport</span><span class="sxs-lookup"><span data-stu-id="eaf22-105">Ws2\_32.dll Functionality for Transport</span></span>

<span data-ttu-id="eaf22-106">La principale tâche de la partie transport de données de la \_32.dll Ws2 est de servir de Traffic Manager entre les fournisseurs de services et les applications.</span><span class="sxs-lookup"><span data-stu-id="eaf22-106">The major task of the data transport portion of the Ws2\_32.dll is to serve as traffic manager between service providers and applications.</span></span> <span data-ttu-id="eaf22-107">Avec plusieurs fournisseurs de services différents qui interagissent avec la même application, chaque fournisseur de services interagit strictement avec la \_32.dll Ws2.</span><span class="sxs-lookup"><span data-stu-id="eaf22-107">With several different service providers interacting with the same application, each service provider interacts strictly with the Ws2\_32.dll.</span></span> <span data-ttu-id="eaf22-108">La DLL s’occupe des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="eaf22-108">The DLL takes care of:</span></span>

-   <span data-ttu-id="eaf22-109">Sélection d’un fournisseur de services approprié pour la création de sockets en fonction d’une description de protocole.</span><span class="sxs-lookup"><span data-stu-id="eaf22-109">Selecting an appropriate service provider for creating sockets based on a protocol description.</span></span>
-   <span data-ttu-id="eaf22-110">Transfert des appels de procédure d’application impliquant un socket au fournisseur de services approprié qui a créé ou contrôle ce Socket.</span><span class="sxs-lookup"><span data-stu-id="eaf22-110">Forwarding application procedure calls involving a socket to the appropriate service provider that created or controls that socket.</span></span> <span data-ttu-id="eaf22-111">Les fournisseurs de services ignorent ce qui se passe.</span><span class="sxs-lookup"><span data-stu-id="eaf22-111">Service providers are unaware that any of this is happening.</span></span>

<span data-ttu-id="eaf22-112">Ils n’ont pas besoin de se préoccuper des détails de l’interopérabilité entre eux, et même de l’existence d’autres fournisseurs de services.</span><span class="sxs-lookup"><span data-stu-id="eaf22-112">They do not need to be concerned about the details of cooperating with one another or even the existence of other service providers.</span></span> <span data-ttu-id="eaf22-113">En faisant abstraction des fournisseurs de services dans une interface DLL cohérente et en exécutant cette fonction automatique de routage du trafic, la \_32.dll Ws2 permet aux applications d’interagir avec un grand nombre de fournisseurs sans que les applications aient besoin de connaître les divisions entre les fournisseurs, où les différents fournisseurs sont installés.</span><span class="sxs-lookup"><span data-stu-id="eaf22-113">By abstracting the service providers into a consistent DLL interface and performing this automatic traffic routing function, the Ws2\_32.dll allows applications to interact with a variety of providers without requiring the applications to be aware of the divisions between providers, where different providers are installed.</span></span>

<span data-ttu-id="eaf22-114">Le \_32.dll Ws2 s’appuie sur les paramètres des fonctions de création de sockets API ( [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) et [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)) pour déterminer quel fournisseur de service utiliser.</span><span class="sxs-lookup"><span data-stu-id="eaf22-114">The Ws2\_32.dll relies on the parameters of the API socket creation functions ( [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) and [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)) to determine which service provider to utilize.</span></span> <span data-ttu-id="eaf22-115">Le fournisseur de services de transport sélectionné sera appelé via la fonction [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) .</span><span class="sxs-lookup"><span data-stu-id="eaf22-115">The selected transport service provider will be invoked through the [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) function.</span></span> <span data-ttu-id="eaf22-116">Dans le cas de la fonction **Socket** , le \_32.dll Ws2 recherche la première entrée dans le jeu de structures [**WSAPROTOCOL \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) installées qui correspond aux valeurs fournies dans le tuple formé par les paramètres (*famille d’adresses*, type de *Socket*, *protocole*).</span><span class="sxs-lookup"><span data-stu-id="eaf22-116">In the case of the **socket** function, the Ws2\_32.dll finds the first entry in the set of installed [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures that matches the values supplied in the tuple formed by the (*address family*, *socket type*, *protocol*) parameters.</span></span> <span data-ttu-id="eaf22-117">Pour préserver la compatibilité descendante, l' \_32.dll Ws2 traite la valeur de zéro pour la *famille d’adresses* ou le type de *Socket* comme une valeur générique.</span><span class="sxs-lookup"><span data-stu-id="eaf22-117">To preserve backward compatibility, the Ws2\_32.dll treats the value of zero for either *address family* or *socket type* as a wildcard value.</span></span> <span data-ttu-id="eaf22-118">La valeur zéro pour le protocole n’est pas considérée comme une valeur générique par l' \_32.dll Ws2, sauf si un tel comportement est indiqué pour un protocole particulier en faisant en sorte que le PFL \_ corresponde à l’indicateur de \_ protocole \_ Zero défini dans la structure **WSAPROTOCOL \_ info** .</span><span class="sxs-lookup"><span data-stu-id="eaf22-118">The value of zero for protocol is not considered a wildcard value by the Ws2\_32.dll unless such behavior is indicated for a particular protocol by having the PFL\_MATCHES\_PROTOCOL\_ZERO flag set in the **WSAPROTOCOL\_INFO** structure.</span></span>

<span data-ttu-id="eaf22-119">Pour la fonction [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) , si null est fourni pour *lpProtocolInfo*, le comportement est exactement le même que celui décrit pour [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket).</span><span class="sxs-lookup"><span data-stu-id="eaf22-119">For the [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function, if null is supplied for *lpProtocolInfo*, the behavior is exactly as just described for [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket).</span></span> <span data-ttu-id="eaf22-120">Toutefois, si une structure [**WSAPROTOCOL \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) est référencée, le \_32.dll Ws2 n’exécute aucune fonction correspondante mais relaie immédiatement la demande de création de socket au fournisseur de services de transport associé à la structure d' **\_ informations WSAPROTOCOL** indiquée.</span><span class="sxs-lookup"><span data-stu-id="eaf22-120">If a [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure is referenced, however, the Ws2\_32.dll does not perform any matching function but immediately relays the socket creation request to the transport service provider associated with the indicated **WSAPROTOCOL\_INFO** structure.</span></span> <span data-ttu-id="eaf22-121">Les valeurs du tuple (*famille d’adresses,* *type de socket,*) sont fournies intactes au fournisseur de services dans la fonction [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) .</span><span class="sxs-lookup"><span data-stu-id="eaf22-121">The values for the (*address family,* *socket type,*) tuple are supplied intact to the service provider in the [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) function.</span></span> <span data-ttu-id="eaf22-122">Les fournisseurs de services sont libres d’ignorer ou de prêter attention aux valeurs des paramètres (*famille d’adresses,* *type de socket,*) comme il convient, mais ils ne doivent pas indiquer une condition d’erreur lorsque la valeur de la *famille d’adresses* ou du type de *Socket* est égale à zéro.</span><span class="sxs-lookup"><span data-stu-id="eaf22-122">Service providers are free to ignore or pay attention to the values of the (*address family,* *socket type,*) parameters as is appropriate, but they must not indicate an error condition when the value of either *address family* or *socket type* is zero.</span></span> <span data-ttu-id="eaf22-123">En outre, les fournisseurs de services ne doivent pas indiquer une condition d’erreur lorsque la constante de manifeste des \_ informations de protocole \_ est contenue dans l’un des paramètres (*famille d’adresses,* *type de socket,*).</span><span class="sxs-lookup"><span data-stu-id="eaf22-123">In addition, service providers must not indicate an error condition when the manifest constant FROM\_PROTOCOL\_INFO is contained in any of the (*address family,* *socket type,*) parameters.</span></span> <span data-ttu-id="eaf22-124">Cette valeur indique simplement que l’application souhaite utiliser les valeurs trouvées dans les paramètres correspondants de la structure **WSAPROTOCOL \_ info** : (**iAddressFamily**, **iSocketType**, **iProtocol**).</span><span class="sxs-lookup"><span data-stu-id="eaf22-124">This value simply indicates that the application wishes to use the values found in the corresponding parameters of the **WSAPROTOCOL\_INFO** structure: (**iAddressFamily**, **iSocketType**, **iProtocol**).</span></span>

<span data-ttu-id="eaf22-125">Dans le cadre de la création de sockets, un fournisseur de services informe le Ws2 \_32.dll sur l’association entre lui-même et le nouveau socket à l’aide de paramètres passés à [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) ou [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle).</span><span class="sxs-lookup"><span data-stu-id="eaf22-125">As part of socket creation, a service provider informs the Ws2\_32.dll about the association between itself and the new socket by means of parameters passed to [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) or [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle).</span></span> <span data-ttu-id="eaf22-126">La \_32.dll Ws2 effectue le suivi de cette association entre les descripteurs de socket et les fournisseurs de services particuliers.</span><span class="sxs-lookup"><span data-stu-id="eaf22-126">The Ws2\_32.dll keeps track of this association between socket handles and particular service providers.</span></span> <span data-ttu-id="eaf22-127">Chaque fois qu’une fonction d’interface d’application qui fait référence à un handle de socket est appelée, le Ws2 \_32.dll recherche l’Association et appelle la fonction d’interface du fournisseur de services correspondante du fournisseur de services approprié.</span><span class="sxs-lookup"><span data-stu-id="eaf22-127">Whenever an application interface function that refers to a socket handle is called, the Ws2\_32.dll looks up the association and calls the corresponding service provider interface function of the appropriate service provider.</span></span>

<span data-ttu-id="eaf22-128">En plus de son service de routage de trafic majeur, le \_32.dll Ws2 fournit un certain nombre d’autres services, tels que l’énumération de protocole, la gestion du descripteur de socket (allocation). désallocation et Association de valeur de contexte pour les fournisseurs de services de système non-fichier, blocage de \_ la gestion des raccordements par thread, utilitaires de permutation d’octets, mise en file d’attente d’appels de procédure asynchrone (APC) pour faciliter l’appel de routines de saisie semi-automatique d’e32.dll32.dll \_</span><span class="sxs-lookup"><span data-stu-id="eaf22-128">In addition to its major traffic routing service, the Ws2\_32.dll provides a number of other services such as protocol enumeration, socket descriptor management (allocation, deallocation, and context value association) for nonfile-system service providers, blocking hook management on a per-thread basis, byte-swapping utilities, queuing of asynchronous procedure calls (APCs) to facilitate invocation of I/O completion routines, and version negotiation between applications and the Ws2\_32.dll, as well as between the Ws2\_32.dll and service providers.</span></span>

## <a name="transport-service-provider-functionality"></a><span data-ttu-id="eaf22-129">Fonctionnalités du fournisseur de services de transport</span><span class="sxs-lookup"><span data-stu-id="eaf22-129">Transport Service Provider Functionality</span></span>

<span data-ttu-id="eaf22-130">Les fournisseurs de services implémentent le protocole de transport réel, qui comprend des fonctions telles que la configuration des connexions, le transfert de données, l’exercice du contrôle de workflow et du contrôle des erreurs, etc. Le32.dll Ws2 n' \_ a aucune connaissance de la façon dont les demandes aux fournisseurs de services sont réalisées. il s’agit de l’implémentation du fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="eaf22-130">Service providers implement the actual transport protocol which includes such functions as setting up connections, transferring data, exercising flow control and error control, etc. The Ws2\_32.dll has no knowledge about how requests to service providers are realized; this is up to the service provider implementation.</span></span> <span data-ttu-id="eaf22-131">L’implémentation de telles fonctions peut varier d’un fournisseur à l’autre.</span><span class="sxs-lookup"><span data-stu-id="eaf22-131">The implementation of such functions may differ greatly from one provider to another.</span></span> <span data-ttu-id="eaf22-132">Les fournisseurs de services masquent les détails spécifiques à l’implémentation de la façon dont les opérations réseau sont effectuées.</span><span class="sxs-lookup"><span data-stu-id="eaf22-132">Service providers hide the implementation-specific details of how network operations are accomplished.</span></span>

<span data-ttu-id="eaf22-133">Les fournisseurs de services de transport peuvent être divisés en deux catégories : ceux dont les descripteurs de socket sont des handles de système de fichiers réels (et sont ci-après appelés fournisseurs IFS). les autres sont appelés fournisseurs non-IFS.</span><span class="sxs-lookup"><span data-stu-id="eaf22-133">Transport service providers can be broadly divided into two categories: those whose socket descriptors are real file system handles (and are hereafter referred to as Installable File System (IFS) providers; the remainder are referred to as non-IFS providers.</span></span> <span data-ttu-id="eaf22-134">L' \_32.dll Ws2 transmet toujours le descripteur de socket du fournisseur de services de transport à l’application Windows Sockets, de sorte que les applications sont libres de tirer parti des descripteurs de socket qui sont des handles de système de fichiers, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="eaf22-134">The Ws2\_32.dll always passes the transport service provider's socket descriptor on up to the Windows Sockets application, so applications are free to take advantage of socket descriptors that are file system handles if they so choose.</span></span>

<span data-ttu-id="eaf22-135">Pour résumer : les fournisseurs de services implémentent les protocoles de bas niveau spécifiques au réseau.</span><span class="sxs-lookup"><span data-stu-id="eaf22-135">To summarize: service providers implement the low-level network-specific protocols.</span></span> <span data-ttu-id="eaf22-136">Le \_32.dll Ws2 fournit la gestion du trafic de niveau moyen qui interconnecte ces protocoles de transport avec les applications.</span><span class="sxs-lookup"><span data-stu-id="eaf22-136">The Ws2\_32.dll provides the medium-level traffic management that interconnects these transport protocols with applications.</span></span> <span data-ttu-id="eaf22-137">Les applications fournissent à leur tour la stratégie quant à la façon dont ces flux de trafic et les opérations spécifiques au réseau sont utilisés pour accomplir les fonctions souhaitées par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="eaf22-137">Applications in turn provide the policy of how these traffic streams and network-specific operations are used to accomplish the functions desired by the user.</span></span>

 

 
