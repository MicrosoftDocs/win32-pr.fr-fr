---
description: La rubrique suivante décrit les opérations qui aboutissent à l’arrêt d’une connexion de socket établie.
ms.assetid: 052e04a4-5290-4dca-af7a-cd590ebfbe15
title: Arrêt de la connexion
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bbde0cfe4c3a97435c2412d28970107f830308fd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103862581"
---
# <a name="connection-shutdown"></a><span data-ttu-id="533dc-103">Arrêt de la connexion</span><span class="sxs-lookup"><span data-stu-id="533dc-103">Connection Shutdown</span></span>

<span data-ttu-id="533dc-104">La rubrique suivante décrit les opérations qui aboutissent à l’arrêt d’une connexion de socket établie.</span><span class="sxs-lookup"><span data-stu-id="533dc-104">The following describes operations incident to shutting down an established socket connection.</span></span>

## <a name="initiating-shutdown-sequence"></a><span data-ttu-id="533dc-105">Lancement de la séquence d’arrêt</span><span class="sxs-lookup"><span data-stu-id="533dc-105">Initiating Shutdown Sequence</span></span>

<span data-ttu-id="533dc-106">Une connexion de socket peut être retirée de plusieurs façons.</span><span class="sxs-lookup"><span data-stu-id="533dc-106">A socket connection can be taken down in one of several ways.</span></span> <span data-ttu-id="533dc-107">[**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) (avec *l'* équivalent de SD \_ Send ou SD \_ ) et [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) peut être utilisé pour initier un arrêt de connexion normal.</span><span class="sxs-lookup"><span data-stu-id="533dc-107">[**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) (with *how* equal to SD\_SEND or SD\_BOTH), and [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) may be used to initiate a graceful connection shutdown.</span></span> <span data-ttu-id="533dc-108">[**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) peut être utilisé pour initier un arrêt normal ou d’abandon, en fonction des options de Lingo appelées par le socket fermant.</span><span class="sxs-lookup"><span data-stu-id="533dc-108">[**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) can be used to initiate either a graceful or abortive shutdown, depending on the linger options invoked by the closing a socket.</span></span> <span data-ttu-id="533dc-109">Consultez la section ci-dessous pour plus d’informations sur les arrêts normaux et d’abandon, et les options de maintien.</span><span class="sxs-lookup"><span data-stu-id="533dc-109">See below for more information about graceful and abortive shutdowns, and linger options.</span></span>

## <a name="indicating-remote-shutdown"></a><span data-ttu-id="533dc-110">Indication de l’arrêt à distance</span><span class="sxs-lookup"><span data-stu-id="533dc-110">Indicating Remote Shutdown</span></span>

<span data-ttu-id="533dc-111">Les fournisseurs de services indiquent la suppression de connexion lancée par le tiers distant via l' \_ événement réseau FD Close.</span><span class="sxs-lookup"><span data-stu-id="533dc-111">Service providers indicate connection teardown that is initiated by the remote party through the FD\_CLOSE network event.</span></span> <span data-ttu-id="533dc-112">L’arrêt progressif est également indiqué par le biais de [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) lorsque le nombre d’octets lus est 0 pour les protocoles de flux d’octets, ou par le biais d’un code d’erreur de retour de WSAEDISCON pour les protocoles orientés message.</span><span class="sxs-lookup"><span data-stu-id="533dc-112">Graceful shutdown is also be indicated through [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) when the number of bytes read is 0 for byte-stream protocols, or through a return error code of WSAEDISCON for message-oriented protocols.</span></span> <span data-ttu-id="533dc-113">Dans tous les cas, un code d’erreur de retour **WSPRecv** de WSAECONNRESET indique un arrêt d’abandon.</span><span class="sxs-lookup"><span data-stu-id="533dc-113">In any case, a **WSPRecv** return error code of WSAECONNRESET indicates an abortive shutdown.</span></span>

## <a name="exchanging-user-data-at-shutdown-time"></a><span data-ttu-id="533dc-114">Échange des données utilisateur au moment de l’arrêt</span><span class="sxs-lookup"><span data-stu-id="533dc-114">Exchanging User Data at Shutdown Time</span></span>

<span data-ttu-id="533dc-115">Au moment de la destruction de la connexion, il est également possible (pour les protocoles qui le prennent en charge) d’échanger des données utilisateur entre les points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="533dc-115">At connection teardown time, it is also possible (for protocols that support this) to exchange user data between the endpoints.</span></span> <span data-ttu-id="533dc-116">La fin qui initie la destruction peut appeler [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) pour indiquer qu’il n’y a plus de données à envoyer et que la séquence de destruction de la connexion est lancée.</span><span class="sxs-lookup"><span data-stu-id="533dc-116">The end that initiates the teardown can call [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to indicate that no more data is to be sent and cause the connection teardown sequence to be initiated.</span></span> <span data-ttu-id="533dc-117">Pour certains protocoles, une partie de cette séquence de destruction est la remise de données déconnectées de l’initiateur de destruction.</span><span class="sxs-lookup"><span data-stu-id="533dc-117">For certain protocols, part of this teardown sequence is the delivery of disconnect data from the teardown initiator.</span></span> <span data-ttu-id="533dc-118">Après avoir reçu une notification indiquant que l’extrémité distante a initié la séquence de destruction (généralement via l' \_ indication FD Close), la fonction [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) peut être appelée pour recevoir les données de déconnexion (le cas échéant).</span><span class="sxs-lookup"><span data-stu-id="533dc-118">After receiving notice that the remote end has initiated the teardown sequence (typically through the FD\_CLOSE indication), the [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) function may be called to receive the disconnect data (if any).</span></span>

<span data-ttu-id="533dc-119">Pour illustrer la façon dont les données de déconnexion peuvent être utilisées, examinez le scénario suivant.</span><span class="sxs-lookup"><span data-stu-id="533dc-119">To illustrate how disconnect data might be used, consider the following scenario.</span></span> <span data-ttu-id="533dc-120">La moitié du client d’une application client/serveur est responsable de l’arrêt d’une connexion de Socket.</span><span class="sxs-lookup"><span data-stu-id="533dc-120">The client half of a client/server application is responsible for terminating a socket connection.</span></span> <span data-ttu-id="533dc-121">Coïncide avec l’arrêt qu’il fournit (via la déconnexion des données) le nombre total de transactions qu’il a traitées avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="533dc-121">Coincident with the termination it provides (through disconnect data) the total number of transactions it processed with the server.</span></span> <span data-ttu-id="533dc-122">Le serveur répond ensuite avec le total cumulé des transactions qu’il a traitées avec tous les clients.</span><span class="sxs-lookup"><span data-stu-id="533dc-122">The server in turn responds with the cumulative grand total of transactions that it has processed with all clients.</span></span> <span data-ttu-id="533dc-123">La séquence d’appels et d’indications peut se produire comme indiqué dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="533dc-123">The sequence of calls and indications might occur as shown in the following table.</span></span>

| <span data-ttu-id="533dc-124">Côté client</span><span class="sxs-lookup"><span data-stu-id="533dc-124">Client side</span></span>                                                                                                               | <span data-ttu-id="533dc-125">Côté serveur</span><span class="sxs-lookup"><span data-stu-id="533dc-125">Server side</span></span>                                                                                                                             |
|---------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="533dc-126">(1) appelle [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) pour conclure la session et fournir le total de la transaction.</span><span class="sxs-lookup"><span data-stu-id="533dc-126">(1) Invokes [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to conclude session and supply transaction total.</span></span>            |                                                                                                                                         |
|                                                                                                                           | <span data-ttu-id="533dc-127">(2) obtient FD \_ Close, ou [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) avec une valeur de retour égale à zéro ou WSAEDISCON indiquant un arrêt correct en cours.</span><span class="sxs-lookup"><span data-stu-id="533dc-127">(2) Gets FD\_CLOSE, or [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) with a return value of zero or WSAEDISCON indicating graceful shutdown in progress.</span></span> |
|                                                                                                                           | <span data-ttu-id="533dc-128">(3) appelle [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) pour connaître le total de la transaction du client.</span><span class="sxs-lookup"><span data-stu-id="533dc-128">(3) Invokes [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) to get client's transaction total.</span></span>                                         |
|                                                                                                                           | <span data-ttu-id="533dc-129">(4) calcule le total général cumulé de toutes les transactions.</span><span class="sxs-lookup"><span data-stu-id="533dc-129">(4) Computes cumulative grand total of all transactions.</span></span>                                                                                |
|                                                                                                                           | <span data-ttu-id="533dc-130">(5) appelle [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) pour transmettre le total général.</span><span class="sxs-lookup"><span data-stu-id="533dc-130">(5) Invokes [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to transmit grand total.</span></span>                                                   |
| <span data-ttu-id="533dc-131">(6) reçoit l' \_ indication FD Close.</span><span class="sxs-lookup"><span data-stu-id="533dc-131">(6) Receives FD\_CLOSE indication.</span></span>                                                                                        | <span data-ttu-id="533dc-132">(5 ') appelle [ **WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="533dc-132">(5') Invokes [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                 |
| <span data-ttu-id="533dc-133">(7) appelle [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) pour recevoir et stocker le total cumulé des transactions.</span><span class="sxs-lookup"><span data-stu-id="533dc-133">(7) Invokes [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) to receive and store cumulative grand total of transactions.</span></span> |                                                                                                                                         |
|                                                                                                                           | <span data-ttu-id="533dc-134">(8) appelle [ **WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="533dc-134">(8) Invokes [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                  |



 

<span data-ttu-id="533dc-135">L’étape (5 ') doit suivre l’étape (5), mais elle n’a pas de relation de minutage avec les étapes (6), (7) ou (8).</span><span class="sxs-lookup"><span data-stu-id="533dc-135">Step (5') must follow step (5), but has no timing relationship with steps (6), (7), or (8).</span></span>

 

 
