---
description: Cette rubrique identifie les instructions à suivre lorsque vous effectuez des opérations d’agent de Windows Update asynchrones (WUA).
ms.assetid: 1fb16904-732d-4341-8267-ab8896fc0f7c
title: Instructions pour les opérations WUA asynchrones
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c1a4b2198a235d9a03e3730e5d6dce2cd54c0e1f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106524120"
---
# <a name="guidelines-for-asynchronous-wua-operations"></a><span data-ttu-id="4418c-103">Instructions pour les opérations WUA asynchrones</span><span class="sxs-lookup"><span data-stu-id="4418c-103">Guidelines for Asynchronous WUA Operations</span></span>

<span data-ttu-id="4418c-104">Cette rubrique identifie les instructions à suivre lorsque vous effectuez des opérations d’agent de Windows Update asynchrones (WUA).</span><span class="sxs-lookup"><span data-stu-id="4418c-104">This topic identifies guidelines for you to the follow when you perform asynchronous Windows Update Agent (WUA) operations.</span></span>

-   <span data-ttu-id="4418c-105">Les opérations WUA asynchrones ne garantissent aucune vitesse d’achèvement particulière.</span><span class="sxs-lookup"><span data-stu-id="4418c-105">The asynchronous WUA operations do not guarantee any particular completion speed.</span></span> <span data-ttu-id="4418c-106">La durée d’exécution d’une opération WUA asynchrone peut varier considérablement en fonction du matériel informatique, de la version du système d’exploitation et de la configuration du réseau.</span><span class="sxs-lookup"><span data-stu-id="4418c-106">The completion time for an asynchronous WUA operation can vary widely depending on computer hardware, version of the operating system, and network configuration.</span></span> <span data-ttu-id="4418c-107">Comme pour les autres API Windows qui ont des dépendances réseau et qui ne contiennent pas de paramètre de délai d’attente ou de délai d’attente documenté, nous vous recommandons d’implémenter vos propres mécanismes de délai d’attente si vous avez besoin de temps de réponse garantis.</span><span class="sxs-lookup"><span data-stu-id="4418c-107">As with other Windows APIs that have network dependencies and that do not contain a time-out parameter or a documented time-out duration, we recommend that you consider implementing your own time-out mechanisms if you need guaranteed response times.</span></span> <span data-ttu-id="4418c-108">Par exemple, vous pouvez créer un thread de travail qui appelle une méthode WUA asynchrone et définit un événement ou un autre objet de synchronisation lorsque l’opération WUA asynchrone se termine ; le thread principal peut ensuite utiliser la fonction [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject) ou [**WaitForMultipleObjects**](/windows/desktop/api/synchapi/nf-synchapi-waitformultipleobjects) , qui vous permet de spécifier une valeur de délai d’attente.</span><span class="sxs-lookup"><span data-stu-id="4418c-108">For example, you can create a worker thread that calls an asynchronous WUA method and that sets an event or other synchronization object when the asynchronous WUA operation completes; the main thread can then use the [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject) or [**WaitForMultipleObjects**](/windows/desktop/api/synchapi/nf-synchapi-waitformultipleobjects) function, which allows you to specify a time-out value.</span></span>
-   <span data-ttu-id="4418c-109">Lorsque vous terminez une recherche, le téléchargement, l’installation ou la désinstallation de mises à jour, vous pouvez utiliser [**IUpdateSearcher :: EndSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-endsearch), [**IUpdateDowloader :: car EndDownload**](/windows/desktop/api/Wuapi/nn-wuapi-iupdatedownloader), [**IUpdateInstaller :: EndInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-endinstall) et [**IUpdateInstaller :: EndUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-enduninstall) à partir de n’importe quel thread.</span><span class="sxs-lookup"><span data-stu-id="4418c-109">When you end a search, download, installation, or uninstallation of updates, you can use [**IUpdateSearcher::EndSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-endsearch), [**IUpdateDowloader::EndDownload**](/windows/desktop/api/Wuapi/nn-wuapi-iupdatedownloader), [**IUpdateInstaller::EndInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-endinstall) and [**IUpdateInstaller::EndUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-enduninstall) from any thread.</span></span>
-   <span data-ttu-id="4418c-110">Lorsque vous lancez une recherche, un téléchargement, une installation ou une désinstallation de mises à jour à l’aide de [**IUpdateSearcher :: BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader :: BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller :: BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall)et [**IUpdateInstaller :: BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall), veillez à conserver suffisamment de autorisations d’accès lorsque vous publiez des références aux objets API WUA.</span><span class="sxs-lookup"><span data-stu-id="4418c-110">When you start a search, download, installation, or uninstallation of updates by using [**IUpdateSearcher::BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader::BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller::BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall), and [**IUpdateInstaller::BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall), ensure that you maintain sufficient access permisssions when you release references to WUA API objects.</span></span>
    -   <span data-ttu-id="4418c-111">Assurez-vous que tous les objets de rappel utilisés dans l’opération asynchrone ne sont pas référencés avant de les détruire.</span><span class="sxs-lookup"><span data-stu-id="4418c-111">Make sure any callback objects that are used in the asynchronous operation are unreferenced before you destroy them.</span></span> <span data-ttu-id="4418c-112">Attendez que le décompte de références d’un objet de rappel retourne à la valeur initiale avant de le détruire.</span><span class="sxs-lookup"><span data-stu-id="4418c-112">Wait for the reference count of a callback object to return to the initial value before you destroy it.</span></span>
    -   <span data-ttu-id="4418c-113">La référence à l’objet de traitement retourné par la méthode **Begin** correspondante doit être contrôlée par un objet qui diffère des objets de rappel.</span><span class="sxs-lookup"><span data-stu-id="4418c-113">The reference to the job object that is returned from the corresponding **Begin** method should be controlled by an object that differs from the callback objects.</span></span> <span data-ttu-id="4418c-114">Utilisez un objet qui diffère des objets de rappel pour éviter les références circulaires.</span><span class="sxs-lookup"><span data-stu-id="4418c-114">Use an object that differs from the callback objects to avoid circular references.</span></span>
    -   <span data-ttu-id="4418c-115">Si vous tentez de contrôler la référence à l’objet de traitement à l’aide d’un objet de rappel, vous devez appeler la méthode [**IDownloadJob :: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob :: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup)ou [**ISearchJob :: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) en dehors de la fonction de rappel pour déconnecter l’objet de traitement de l’objet de rappel.</span><span class="sxs-lookup"><span data-stu-id="4418c-115">If you attempt to control the reference to the job object by using a callback object, you must call the [**IDownloadJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup), or [**ISearchJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) method outside the callback function to disconnect the job object from the callback object.</span></span> <span data-ttu-id="4418c-116">Vous devez effectuer cette opération avant de libérer la référence à l’objet de traitement retourné par la méthode **Begin** .</span><span class="sxs-lookup"><span data-stu-id="4418c-116">You must do this before you release the reference to the job object that is returned by the **Begin** method.</span></span>
-   <span data-ttu-id="4418c-117">Assurez-vous que les opérations WUA asynchrones sont terminées.</span><span class="sxs-lookup"><span data-stu-id="4418c-117">Make sure that asynchronous WUA operations are complete.</span></span> <span data-ttu-id="4418c-118">L’environnement d’exécution de scripts Windows peut mettre fin à un script lorsque toutes les commandes en dehors de toute fonction sont terminées, même si l’API WUA fait encore référence à l’objet de rappel.</span><span class="sxs-lookup"><span data-stu-id="4418c-118">Windows Script Host can terminate a script when all the commands outside of any function are complete, even if the WUA API still has references to the callback object.</span></span>
    -   <span data-ttu-id="4418c-119">Utilisez l’une des méthodes de **nettoyage** ou faites en sorte que la fonction de rappel définisse une variable globale partagée après l’achèvement.</span><span class="sxs-lookup"><span data-stu-id="4418c-119">Use one of the **CleanUp** methods or have the callback function set a shared global variable upon completion.</span></span>
    -   <span data-ttu-id="4418c-120">N’appelez jamais [**IDownloadJob :: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob :: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup)ou [**ISearchJob :: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) sur un objet de traitement dans sa fonction de rappel.</span><span class="sxs-lookup"><span data-stu-id="4418c-120">Never call [**IDownloadJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup), or [**ISearchJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) on a job object in its callback function.</span></span>
    -   <span data-ttu-id="4418c-121">Pour garantir la séquence de nettoyage correcte dans un script qui s’exécute sur Windows Internet Explorer, appelez la méthode **Cleanup** sur tous les objets de tâche lors du traitement de Window. onbeforeunload.</span><span class="sxs-lookup"><span data-stu-id="4418c-121">To ensure the correct clean-up sequence in a script that is running on Windows Internet Explorer, call the **CleanUp** method on all the job objects when processing window.onbeforeunload.</span></span>
-   <span data-ttu-id="4418c-122">N’utilisez pas de types de données définis par l’utilisateur (UDT) pour les opérations WUA asynchrones.</span><span class="sxs-lookup"><span data-stu-id="4418c-122">Do not use user-defined data types (UDT) for asynchronous WUA operations.</span></span> <span data-ttu-id="4418c-123">Le type n’est pas pris en charge par [**IUpdateSearcher :: BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader :: BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller :: BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall)ou [**IUpdateInstaller :: BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall).</span><span class="sxs-lookup"><span data-stu-id="4418c-123">The type is not supported by [**IUpdateSearcher::BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader::BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller::BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall), or [**IUpdateInstaller::BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall).</span></span>

 

 
