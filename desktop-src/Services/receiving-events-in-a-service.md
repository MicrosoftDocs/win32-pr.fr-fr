---
description: Un service qui est une application console peut inscrire un gestionnaire de contrôle de console pour recevoir une notification lorsqu’un utilisateur se déconnecte.
ms.assetid: 86ace8b8-c1cb-4646-bc92-86bd578a82c5
title: Réception d’événements dans un service
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b95f7329383ffc8aea08102a2fe8cf8b49e0ef9d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104530081"
---
# <a name="receiving-events-in-a-service"></a><span data-ttu-id="998c1-103">Réception d’événements dans un service</span><span class="sxs-lookup"><span data-stu-id="998c1-103">Receiving Events in a Service</span></span>

<span data-ttu-id="998c1-104">Un service qui est une application console peut inscrire un [Gestionnaire de contrôle de console](/windows/console/console-control-handlers) pour recevoir une notification lorsqu’un utilisateur se déconnecte.</span><span class="sxs-lookup"><span data-stu-id="998c1-104">A service that is a console application can register a [console control handler](/windows/console/console-control-handlers) to receive notification when a user logs off.</span></span> <span data-ttu-id="998c1-105">Toutefois, aucun événement de console n’est envoyé lorsqu’un utilisateur interactif ouvre une session.</span><span class="sxs-lookup"><span data-stu-id="998c1-105">However, there is no console event sent when an interactive user logs on.</span></span> <span data-ttu-id="998c1-106">Pour plus d’informations sur la réception d’une notification lorsqu’un utilisateur ouvre une session, consultez [création d’un package de notifications Winlogon](/windows/desktop/SecAuthN/creating-a-winlogon-notification-package).</span><span class="sxs-lookup"><span data-stu-id="998c1-106">For information on receiving notification when a user logs on, see [Creating a Winlogon Notification Package](/windows/desktop/SecAuthN/creating-a-winlogon-notification-package).</span></span>

<span data-ttu-id="998c1-107">Le système diffuse les événements de changement d’appareil à tous les services.</span><span class="sxs-lookup"><span data-stu-id="998c1-107">The system broadcasts device change events to all services.</span></span> <span data-ttu-id="998c1-108">Ces événements peuvent être reçus par un service dans une procédure de fenêtre ou dans son gestionnaire de contrôle de service.</span><span class="sxs-lookup"><span data-stu-id="998c1-108">These events can be received by a service in a window procedure or in its service control handler.</span></span> <span data-ttu-id="998c1-109">Pour spécifier les événements que votre service doit recevoir, utilisez la fonction [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) .</span><span class="sxs-lookup"><span data-stu-id="998c1-109">To specify which events your service should receive, use the [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) function.</span></span>

<span data-ttu-id="998c1-110">Veillez à gérer Plug-and-Play événements d’appareil aussi rapidement que possible.</span><span class="sxs-lookup"><span data-stu-id="998c1-110">Be sure to handle Plug and Play device events as quickly as possible.</span></span> <span data-ttu-id="998c1-111">Dans le cas contraire, le système risque de ne plus répondre.</span><span class="sxs-lookup"><span data-stu-id="998c1-111">Otherwise, the system may become unresponsive.</span></span> <span data-ttu-id="998c1-112">Si votre gestionnaire d’événements doit effectuer une opération qui peut bloquer l’exécution (par exemple, les e/s), il est préférable de démarrer un autre thread pour effectuer l’opération de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="998c1-112">If your event handler is to perform an operation that may block execution (such as I/O), it is best to start another thread to perform the operation asynchronously.</span></span>

<span data-ttu-id="998c1-113">Lorsqu’un service appelle [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa), le service spécifie également un handle de fenêtre ou un handle d’état de service.</span><span class="sxs-lookup"><span data-stu-id="998c1-113">When a service calls [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa), the service also specifies either a window handle or a service status handle.</span></span> <span data-ttu-id="998c1-114">Si un service spécifie un handle de fenêtre, la procédure de fenêtre reçoit les événements de notification.</span><span class="sxs-lookup"><span data-stu-id="998c1-114">If a service specifies a window handle, the window procedure receives the notification events.</span></span> <span data-ttu-id="998c1-115">Si un service spécifie son descripteur d’État du service, son gestionnaire de contrôle des services reçoit les événements de notification.</span><span class="sxs-lookup"><span data-stu-id="998c1-115">If a service specifies its service status handle, its service control handler receives the notification events.</span></span> <span data-ttu-id="998c1-116">Pour plus d’informations, consultez [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex).</span><span class="sxs-lookup"><span data-stu-id="998c1-116">For more information, see [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex).</span></span>

<span data-ttu-id="998c1-117">Les descripteurs de notification de périphérique retournés par [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) doivent être fermés en appelant la fonction [**UnregisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-unregisterdevicenotification) lorsqu’ils ne sont plus nécessaires.</span><span class="sxs-lookup"><span data-stu-id="998c1-117">Device notification handles returned by [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) must be closed by calling the [**UnregisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-unregisterdevicenotification) function when they are no longer needed.</span></span>

 

 
