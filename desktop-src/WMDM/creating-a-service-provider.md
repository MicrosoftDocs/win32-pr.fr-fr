---
title: Création d’un fournisseur de services
description: Création d’un fournisseur de services
ms.assetid: 7da27fe2-8a57-4adb-94b2-448b6362dc33
keywords:
- Gestionnaire de périphériques Windows Media, création de fournisseurs de services
- Gestionnaire de périphériques, création de fournisseurs de services
- Gestionnaire de périphériques Windows Media, Guide de programmation
- Gestionnaire de périphériques, Guide de programmation
- Guide de programmation, fournisseurs de services
- Guide de programmation, Windows Media Gestionnaire de périphériques
- Guide de programmation, création de fournisseurs de services
- Gestionnaire de périphériques Windows Media, fournisseurs de services
- Gestionnaire de périphériques, fournisseurs de services
- fournisseurs de services, création
- créer des fournisseurs de services, à propos de
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8469c3d656d151457ed818ea6b4192a3c79ed061
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "106510686"
---
# <a name="creating-a-service-provider"></a><span data-ttu-id="172e2-114">Création d’un fournisseur de services</span><span class="sxs-lookup"><span data-stu-id="172e2-114">Creating a Service Provider</span></span>

<span data-ttu-id="172e2-115">Un fournisseur de services est un composant qui sert de intermédiaire entre une application et un appareil.</span><span class="sxs-lookup"><span data-stu-id="172e2-115">A service provider is component that serves as a middleman between an application and a device.</span></span> <span data-ttu-id="172e2-116">Windows Media Gestionnaire de périphériques achemine les demandes de l’application vers le fournisseur de services, qui est ensuite responsable de la communication avec l’appareil ou de l’exécution de l’action demandée.</span><span class="sxs-lookup"><span data-stu-id="172e2-116">Windows Media Device Manager routes requests from the application to the service provider, which is then responsible for communicating with the device or performing the requested action.</span></span> <span data-ttu-id="172e2-117">Un fournisseur de services communique généralement avec un pilote pour permettre la communication avec l’appareil.</span><span class="sxs-lookup"><span data-stu-id="172e2-117">A service provider usually communicates with a driver to enable communication with the device.</span></span> <span data-ttu-id="172e2-118">Un fournisseur de services est un composant COM qui implémente les interfaces appelées par les Gestionnaire de périphériques Windows Media.</span><span class="sxs-lookup"><span data-stu-id="172e2-118">A service provider is a COM component that implements the interfaces called by Windows Media Device Manager.</span></span> <span data-ttu-id="172e2-119">L’interface racine de l’objet fournisseur de services est [**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span><span class="sxs-lookup"><span data-stu-id="172e2-119">The root interface of the service provider object is [**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span></span> <span data-ttu-id="172e2-120">Après avoir obtenu cette interface, les Gestionnaire de périphériques Windows Media peuvent obtenir d’autres interfaces via l’implémentation du fournisseur de services de différentes méthodes.</span><span class="sxs-lookup"><span data-stu-id="172e2-120">After obtaining this interface, Windows Media Device Manager can obtain other interfaces through the service provider's implementation of various methods.</span></span> <span data-ttu-id="172e2-121">Les interfaces qu’un fournisseur de services doit implémenter sont répertoriées dans [interfaces obligatoires et facultatives](mandatory-and-optional-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="172e2-121">The interfaces that a service provider must implement are listed in [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md).</span></span> <span data-ttu-id="172e2-122">La hiérarchie des interfaces est indiquée dans [interfaces pour les fournisseurs de services](interfaces-for-service-providers.md).</span><span class="sxs-lookup"><span data-stu-id="172e2-122">The hierarchy of interfaces is shown in [Interfaces for Service Providers](interfaces-for-service-providers.md).</span></span>

> [!Note]  
> <span data-ttu-id="172e2-123">Vous ne devez pas essayer de créer un fournisseur de services MTP. au lieu de cela, vous devez utiliser le fournisseur de services MTP et les pilotes fournis par Microsoft.</span><span class="sxs-lookup"><span data-stu-id="172e2-123">You should not try to create an MTP service provider; instead, you should use the MTP service provider and drivers provided by Microsoft.</span></span>

 

<span data-ttu-id="172e2-124">Avant d’essayer de créer un fournisseur de services, vous devez comprendre soigneusement les appels effectués par une application sur un fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="172e2-124">Before trying to create a service provider, you should thoroughly understand what calls an application will make on a service provider.</span></span> <span data-ttu-id="172e2-125">Lisez [création d’une application Windows Media gestionnaire de périphériques](creating-a-windows-media-device-manager-application.md) pour obtenir une idée des tâches de base et des appels qu’une application fera sur un fournisseur de services lorsqu’il tente de communiquer avec un appareil.</span><span class="sxs-lookup"><span data-stu-id="172e2-125">Read [Creating a Windows Media Device Manager Application](creating-a-windows-media-device-manager-application.md) to get some idea of the basic tasks and calls that an application will make on a service provider when it is attempting to communicate with a device.</span></span>

<span data-ttu-id="172e2-126">La liste suivante présente les principales étapes du développement d’un fournisseur de services :</span><span class="sxs-lookup"><span data-stu-id="172e2-126">The following list shows the key steps in developing a service provider:</span></span>

1.  <span data-ttu-id="172e2-127">Incluez (et éventuellement compilez) l’en-tête et les fichiers de bibliothèque requis pour votre projet.</span><span class="sxs-lookup"><span data-stu-id="172e2-127">Include (and optionally compile) the required header and library files for your project.</span></span> <span data-ttu-id="172e2-128">Consultez les [bibliothèques et en-têtes requis pour un fournisseur de services](required-libraries-and-headers-for-a-service-provider.md) pour obtenir la liste des fichiers requis.</span><span class="sxs-lookup"><span data-stu-id="172e2-128">See [Required Libraries and Headers for a Service Provider](required-libraries-and-headers-for-a-service-provider.md) for the list of required files.</span></span>
2.  <span data-ttu-id="172e2-129">Implémentez toutes les autres interfaces requises ou facultatives du fournisseur de services (consultez [interfaces obligatoires et facultatives](mandatory-and-optional-interfaces.md)).</span><span class="sxs-lookup"><span data-stu-id="172e2-129">Implement all the other required or optional service provider interfaces (see [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md)).</span></span> <span data-ttu-id="172e2-130">En règle générale, les interfaces sont appelées dans cet ordre :</span><span class="sxs-lookup"><span data-stu-id="172e2-130">Typically, interfaces will be called in this order:</span></span>
    -   [<span data-ttu-id="172e2-131">**IComponentAuthenticate**</span><span class="sxs-lookup"><span data-stu-id="172e2-131">**IComponentAuthenticate**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate)
    -   <span data-ttu-id="172e2-132">[**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span><span class="sxs-lookup"><span data-stu-id="172e2-132">[**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span></span>
    -   [<span data-ttu-id="172e2-133">**IMDSPEnumDevice**</span><span class="sxs-lookup"><span data-stu-id="172e2-133">**IMDSPEnumDevice**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumdevice)
    -   <span data-ttu-id="172e2-134">[**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span><span class="sxs-lookup"><span data-stu-id="172e2-134">[**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span></span>
    -   [<span data-ttu-id="172e2-135">**IMDSPEnumStorage**</span><span class="sxs-lookup"><span data-stu-id="172e2-135">**IMDSPEnumStorage**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumstorage)
    -   <span data-ttu-id="172e2-136">[**IMDSPStorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span><span class="sxs-lookup"><span data-stu-id="172e2-136">[**IMDSPStorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span></span>
3.  <span data-ttu-id="172e2-137">Vérifiez que votre fournisseur de services ou appareil installe les clés de Registre appropriées lors de l’installation.</span><span class="sxs-lookup"><span data-stu-id="172e2-137">Be sure your service provider or device installs the proper registry keys during installation.</span></span> <span data-ttu-id="172e2-138">Ces clés spécifient les paramètres de l’appareil, inscrivent le fournisseur de services en tant que plug-in et activent Plug-and-Play notifications pour l’arrivée et la suppression de l’appareil.</span><span class="sxs-lookup"><span data-stu-id="172e2-138">These keys specify device parameters, register the service provider as a plug-in, and enable Plug and Play notifications for device arrival and removal.</span></span> <span data-ttu-id="172e2-139">Consultez [paramètres](device-parameters.md)de l’appareil, [inscription du fournisseur de services](registering-the-service-provider.md)et [activation de PNP pour les appareils](enabling-pnp-for-devices.md).</span><span class="sxs-lookup"><span data-stu-id="172e2-139">See [Device Parameters](device-parameters.md), [Registering the Service Provider](registering-the-service-provider.md), and [Enabling PnP for Devices](enabling-pnp-for-devices.md).</span></span>
4.  <span data-ttu-id="172e2-140">Sur l’instanciation de votre classe, authentifiez le fournisseur de services dans le constructeur.</span><span class="sxs-lookup"><span data-stu-id="172e2-140">On instantiation of your class, authenticate the service provider in the constructor.</span></span> <span data-ttu-id="172e2-141">Pour ce faire, créez une classe [CSecureChannelServer](csecurechannelserver-class.md) et définissez le certificat.</span><span class="sxs-lookup"><span data-stu-id="172e2-141">To do this, create a [CSecureChannelServer](csecurechannelserver-class.md) class and set the certificate.</span></span> <span data-ttu-id="172e2-142">Implémentez l’interface [**IComponentAuthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) et appelez les méthodes de la classe CSecureChannelServer instanciées précédemment.</span><span class="sxs-lookup"><span data-stu-id="172e2-142">Implement the [**IComponentAuthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) interface and call the methods of the CSecureChannelServer class instantiated previously.</span></span> <span data-ttu-id="172e2-143">Consultez [authentification du fournisseur de services](authenticating-the-service-provider.md) pour savoir comment instancier la classe CSecureChannelServer et implémenter les méthodes IComponentAuthenticate.</span><span class="sxs-lookup"><span data-stu-id="172e2-143">See [Authenticating the Service Provider](authenticating-the-service-provider.md) to learn how to instantiate the CSecureChannelServer class and implement the IComponentAuthenticate methods.</span></span>
5.  <span data-ttu-id="172e2-144">Windows Media Gestionnaire de périphériques interroge votre fournisseur de services pour obtenir la liste des appareils connectés en appelant [**IMDServiceProvider2 :: CreateDevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) ou [**IMDServiceProvider :: EnumDevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices), selon que le fournisseur de services gère plug-and-Play appareils.</span><span class="sxs-lookup"><span data-stu-id="172e2-144">Windows Media Device Manager will query your service provider for a list of connected devices by calling [**IMDServiceProvider2::CreateDevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) or [**IMDServiceProvider::EnumDevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices), depending on whether the service provider handles Plug and Play devices.</span></span> <span data-ttu-id="172e2-145">Le fournisseur de services doit retourner une liste d’objets [**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) représentant des appareils connectés.</span><span class="sxs-lookup"><span data-stu-id="172e2-145">The service provider must return a list of [**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) objects representing connected devices.</span></span> <span data-ttu-id="172e2-146">Pour plus d’informations, consultez [énumération des appareils](enumerating-devices-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="172e2-146">See [Enumerating Devices](enumerating-devices-service-provider.md) for more details.</span></span>
6.  <span data-ttu-id="172e2-147">Avant de gérer un appel, vérifiez qu’un canal sécurisé a été établi.</span><span class="sxs-lookup"><span data-stu-id="172e2-147">Before handling any call, verify that a secure channel has been established.</span></span> <span data-ttu-id="172e2-148">Appelez [**CSecureChannelServer :: fIsAuthenticated**](/previous-versions/bb231600(v=vs.85)) avant d’effectuer des actions.</span><span class="sxs-lookup"><span data-stu-id="172e2-148">Call [**CSecureChannelServer::fIsAuthenticated**](/previous-versions/bb231600(v=vs.85)) before performing any actions.</span></span> <span data-ttu-id="172e2-149">Si cet appel échoue, retournez WMDM \_ E \_ NOTCERTIFIED.</span><span class="sxs-lookup"><span data-stu-id="172e2-149">If this call fails, return WMDM\_E\_NOTCERTIFIED.</span></span>
7.  <span data-ttu-id="172e2-150">Vous aurez besoin d’une paire certificat/clé émise par Microsoft pour être en mesure de gérer les documents DRM protégés.</span><span class="sxs-lookup"><span data-stu-id="172e2-150">You will need a certificate/key pair issued by Microsoft to be able to handle DRM-protected material.</span></span> <span data-ttu-id="172e2-151">Pour plus d’informations, consultez [gestion du contenu protégé dans le fournisseur de services](handling-protected-content-in-the-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="172e2-151">See [Handling Protected Content in the Service Provider](handling-protected-content-in-the-service-provider.md) for more information.</span></span>
8.  <span data-ttu-id="172e2-152">Pour permettre à votre appareil de se synchroniser automatiquement avec le lecteur Windows Media, il doit respecter les conditions requises indiquées dans activation de la [synchronisation avec le lecteur Windows Media](enabling-synchronization-with-windows-media-player.md).</span><span class="sxs-lookup"><span data-stu-id="172e2-152">To enable your device to synchronize automatically with Windows Media Player, it must fulfill the requirements listed in [Enabling Synchronization with Windows Media Player](enabling-synchronization-with-windows-media-player.md).</span></span>
9.  <span data-ttu-id="172e2-153">Pour que votre appareil s’affiche dans l’Explorateur Windows, vous devez effectuer quelques étapes spéciales, détaillées dans [Configuration requise pour que les lecteurs audio portables s’affichent dans l’Explorateur Windows](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span><span class="sxs-lookup"><span data-stu-id="172e2-153">To enable your device to appear in Windows Explorer, you must take a few special steps, detailed in [Requirements for Portable Audio Players to Appear in Windows Explorer](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="172e2-154">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="172e2-154">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="172e2-155">**Guide de programmation**</span><span class="sxs-lookup"><span data-stu-id="172e2-155">**Programming Guide**</span></span>](programming-guide.md)
</dt> </dl>

 

 