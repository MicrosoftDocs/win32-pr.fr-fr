---
title: Architecture Windows Media Gestionnaire de périphériques
description: Architecture Windows Media Gestionnaire de périphériques
ms.assetid: 3c1b2da4-559d-427b-b502-5ef8dc055a8e
keywords:
- Gestionnaire de périphériques Windows Media, architecture
- Gestionnaire de périphériques, architecture
- architecture pour Windows Media Gestionnaire de périphériques
- Windows Media Gestionnaire de périphériques, applications de bureau
- Gestionnaire de périphériques, applications de bureau
- Gestionnaire de périphériques Windows Media, fournisseurs de services
- Gestionnaire de périphériques, fournisseurs de services
- Gestionnaire de périphériques Windows Media, plug-ins
- Gestionnaire de périphériques, plug-ins
- applications de bureau, architecture Windows Media Gestionnaire de périphériques
- fournisseurs de services, architecture Windows Media Gestionnaire de périphériques
- plug-ins, architecture Windows Media Gestionnaire de périphériques
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9fda87e4ed4bce2c82bbb9c0863c119851965940
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104196503"
---
# <a name="windows-media-device-manager-architecture"></a><span data-ttu-id="15195-115">Architecture Windows Media Gestionnaire de périphériques</span><span class="sxs-lookup"><span data-stu-id="15195-115">Windows Media Device Manager Architecture</span></span>

<span data-ttu-id="15195-116">Windows Media Gestionnaire de périphériques permet à une application ou à un plug-in de communiquer avec un appareil.</span><span class="sxs-lookup"><span data-stu-id="15195-116">Windows Media Device Manager enables an application or plug-in to communicate with a device.</span></span> <span data-ttu-id="15195-117">Les applications peuvent demander des métadonnées d’appareil, énumérer et explorer des appareils attachés, et envoyer ou recevoir des objets (dossiers, fichiers, sélections, etc.).</span><span class="sxs-lookup"><span data-stu-id="15195-117">Applications can request device metadata, enumerate and explore attached devices, and send or receive objects (folders, files, playlists, and so on).</span></span> <span data-ttu-id="15195-118">Windows Media Gestionnaire de périphériques fournit une API unique à l’application appelante, quel que soit le type d’appareil appelé (classe de stockage de masse ou MTP, fournisseurs de services basés sur la version 10 ou les fournisseurs de services basés sur les versions antérieures de Windows Media Gestionnaire de périphériques).</span><span class="sxs-lookup"><span data-stu-id="15195-118">Windows Media Device Manager provides a single API to the calling application, no matter what type of device is being called (MTP or Mass Storage Class, service providers built on version 10 or service providers built on earlier versions of Windows Media Device Manager).</span></span>

<span data-ttu-id="15195-119">Windows Media Gestionnaire de périphériques agit comme un passage pour les trois principaux composants du système : l’application, qui effectue des demandes (pour obtenir des informations, lire ou écrire des données, etc.); un fournisseur de contenu sécurisé, qui est un composant qui gère les communications avec les fichiers protégés par DRM ; et un fournisseur de services, qui reçoit les demandes de l’application et communique avec l’appareil pour effectuer ces requêtes.</span><span class="sxs-lookup"><span data-stu-id="15195-119">Windows Media Device Manager acts as a go-between for the three major components of the system: the application, which makes requests (for information, to read or write data, and so on); a secure content provider, which is a component that handles communication with DRM-protected files; and a service provider, which receives requests from the application and communicates with the device to perform these requests.</span></span> <span data-ttu-id="15195-120">L’application et le fournisseur de services sont générés sur le kit de développement logiciel (SDK) Gestionnaire de périphériques Windows Media.</span><span class="sxs-lookup"><span data-stu-id="15195-120">Both the application and the service provider are built on the Windows Media Device Manager SDK.</span></span>

<span data-ttu-id="15195-121">Le diagramme suivant montre comment une application de bureau communique avec un appareil à l’aide de Windows Media Gestionnaire de périphériques 11.</span><span class="sxs-lookup"><span data-stu-id="15195-121">The following diagram shows how a desktop application communicates with a device using Windows Media Device Manager 11.</span></span>

![Diagramme montrant une application communiquant avec quatre types différents d’appareils.](images/wmdm-device-communication.gif)

<span data-ttu-id="15195-123">Le diagramme précédent illustre une application communiquant avec quatre types différents d’appareils, chacun avec son propre fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="15195-123">The preceding diagram shows an application communicating with four different types of devices, each with its own service provider.</span></span> <span data-ttu-id="15195-124">Chaque fournisseur de services est conçu pour communiquer avec un type spécifique d’appareil. ce diagramme illustre les trois fournisseurs de services fournis par Microsoft (pilotes de classes génériques pour les périphériques de classe de stockage de masse, les périphériques RAPI et les appareils MTP), ainsi qu’un fournisseur de services personnalisé pour un appareil propriétaire créé par un tiers.</span><span class="sxs-lookup"><span data-stu-id="15195-124">Every service provider is designed to communicate with a specific type of device; this diagram shows the three Microsoft-provided service providers (generic class drivers for Mass Storage Class devices, RAPI devices, and MTP devices), as well as a custom service provider for a proprietary device built by a third party.</span></span> <span data-ttu-id="15195-125">Quand un appareil se connecte, Windows Media Gestionnaire de périphériques instancie une instance du fournisseur de services inscrite pour cet appareil.</span><span class="sxs-lookup"><span data-stu-id="15195-125">When a device connects, Windows Media Device Manager instantiates an instance of the service provider registered for that device.</span></span> <span data-ttu-id="15195-126">Les fournisseurs de services obtiennent les demandes de l’application via les interfaces Windows Media Gestionnaire de périphériques qu’elles implémentent, utilisent les pilotes appropriés pour communiquer avec l’appareil et retournent les résultats appropriés.</span><span class="sxs-lookup"><span data-stu-id="15195-126">The service providers get requests from the application through Windows Media Device Manager interfaces that they implement, use appropriate drivers to communicate with the device, and return appropriate results.</span></span> <span data-ttu-id="15195-127">La communication entre le fournisseur de services et l’appareil se trouve en dehors du domaine de Windows Media Gestionnaire de périphériques.</span><span class="sxs-lookup"><span data-stu-id="15195-127">Communication between the service provider and the device is outside the domain of Windows Media Device Manager.</span></span>

<span data-ttu-id="15195-128">Les fournisseurs de services sont invisibles pour l’application ; une application ne voit qu’une liste de « périphériques », car Windows Media Gestionnaire de périphériques expose un ensemble standard de méthodes et d’interfaces pour tous les appareils.</span><span class="sxs-lookup"><span data-stu-id="15195-128">Service providers are invisible to the application; an application sees only a list of "devices" because Windows Media Device Manager exposes a standard set of methods and interfaces for all devices.</span></span> <span data-ttu-id="15195-129">Si un fabricant crée un fournisseur de services personnalisé, il doit gérer toutes les méthodes de Gestionnaire de périphériques Windows Media standard si les applications doivent être en mesure d’utiliser l’appareil.</span><span class="sxs-lookup"><span data-stu-id="15195-129">If a manufacturer creates a custom service provider, it must handle all the standard Windows Media Device Manager methods if applications are to be able to use the device.</span></span>

<span data-ttu-id="15195-130">Ce diagramme montre également un module SCP (Secure Content Provider).</span><span class="sxs-lookup"><span data-stu-id="15195-130">This diagram also shows a secure content provider (SCP) module.</span></span> <span data-ttu-id="15195-131">Ce module est responsable de la gestion du contenu protégé par la gestion des droits numériques (DRM).</span><span class="sxs-lookup"><span data-stu-id="15195-131">This module is responsible for handling digital rights management (DRM) protected content.</span></span> <span data-ttu-id="15195-132">Microsoft fournit un module SCP qui peut gérer des fichiers WMA et WMV protégés par DRM.</span><span class="sxs-lookup"><span data-stu-id="15195-132">Microsoft provides an SCP module that can handle DRM-protected WMA and WMV files.</span></span> <span data-ttu-id="15195-133">Si une application ou un appareil envisage de gérer d’autres formats protégés, elle doit fournir son propre module SCP.</span><span class="sxs-lookup"><span data-stu-id="15195-133">If an application or device intends to handle other protected formats, it must provide its own SCP module.</span></span> <span data-ttu-id="15195-134">L’application et le fournisseur de services ne traitent pas directement le SCP.</span><span class="sxs-lookup"><span data-stu-id="15195-134">Neither the application nor the service provider deals with the SCP directly.</span></span>

<span data-ttu-id="15195-135">L’application et le fournisseur de services reposent sur les Gestionnaire de périphériques Windows Media, qui acheminent les appels entre l’application et le fournisseur de services approprié pour un appareil. le fournisseur de services est responsable de la communication directe avec l’appareil.</span><span class="sxs-lookup"><span data-stu-id="15195-135">Both the application and the service provider are built on Windows Media Device Manager, which routes calls between the application and the appropriate service provider for a device; the service provider is responsible for communicating directly with the device.</span></span> <span data-ttu-id="15195-136">Windows Media Gestionnaire de périphériques effectue certaines actions, telles que l’énumération des appareils connectés, le routage des appels et la vérification des composants. Toutefois, la majeure partie du travail est effectuée par le fournisseur de services, qui reçoit les demandes de l’application et communique avec l’appareil.</span><span class="sxs-lookup"><span data-stu-id="15195-136">Windows Media Device Manager does perform some actions itself (such as enumerating connected devices, routing calls, and handling component verification); however, most of the work is done by the service provider, which receives requests from the application and communicates with the device.</span></span>

<span data-ttu-id="15195-137">Une application basée sur Windows Media Gestionnaire de périphériques peut communiquer avec des appareils et des fournisseurs de services basés sur des versions antérieures de Windows Media Gestionnaire de périphériques ; Toutefois, ces appareils plus anciens seront exécutés jusqu’à la série de 9 composants (non illustrés) et ne prendront pas en charge les fonctionnalités les plus récentes, en particulier la technologie de gestion des droits numériques plus avancée.</span><span class="sxs-lookup"><span data-stu-id="15195-137">An application built on Windows Media Device Manager can communicate with devices and service providers built on earlier versions of Windows Media Device Manager; however, these older devices will be run through 9 Series components (not shown), and will not support the newest features, particularly the more advanced digital rights management technology.</span></span>

<span data-ttu-id="15195-138">Architecture d’un appareil</span><span class="sxs-lookup"><span data-stu-id="15195-138">Architecture of a Device</span></span>

<span data-ttu-id="15195-139">Le diagramme suivant montre une hiérarchie simplifiée d’appareils et de stockage, telle qu’elle est affichée par une application utilisant Windows Media Gestionnaire de périphériques.</span><span class="sxs-lookup"><span data-stu-id="15195-139">The following diagram shows a simplified hierarchy of devices and storages as seen by an application using Windows Media Device Manager.</span></span>

![Diagramme montrant les stockages sur un appareil.](images/wmdm-basic-device-layout.gif)

<span data-ttu-id="15195-141">Le diagramme précédent illustre une version simplifiée d’un lecteur flash connecté, tel qu’il est vu par une application Windows Media Gestionnaire de périphériques.</span><span class="sxs-lookup"><span data-stu-id="15195-141">The preceding diagram shows a simplified version of a connected flash drive, as seen by a Windows Media Device Manager application.</span></span> <span data-ttu-id="15195-142">Le lecteur flash possède des attributs et des propriétés, tels qu’un numéro de série et des configurations de format prises en charge.</span><span class="sxs-lookup"><span data-stu-id="15195-142">The flash drive has attributes and properties, such as a serial number and supported format configurations.</span></span> <span data-ttu-id="15195-143">Un enfant immédiat du périphérique flash est l’objet de stockage racine, qui contient un dossier, qui contient lui-même une image et une chanson.</span><span class="sxs-lookup"><span data-stu-id="15195-143">An immediate child of the flash device is the root storage object, which contains a folder, which itself contains an image and a song.</span></span>

<span data-ttu-id="15195-144">Une application énumère la liste des périphériques attachés en appelant une méthode d’énumération exposée par l’interface [**IWMDeviceManager**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdevicemanager) racine.</span><span class="sxs-lookup"><span data-stu-id="15195-144">An application enumerates the list of attached devices by calling an enumeration method exposed by the root [**IWMDeviceManager**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdevicemanager) interface.</span></span> <span data-ttu-id="15195-145">Les appareils sont représentés par une interface [**IWMDMDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmdevice) (ou dérivée).</span><span class="sxs-lookup"><span data-stu-id="15195-145">Devices are represented by an [**IWMDMDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmdevice) (or a derived) interface.</span></span> <span data-ttu-id="15195-146">Cette interface expose des méthodes pour récupérer le nom de l’appareil, les fonctionnalités de format, le numéro de série, etc., ainsi qu’une méthode qui énumère les *stockages* sur l’appareil.</span><span class="sxs-lookup"><span data-stu-id="15195-146">This interface exposes methods to retrieve the device name, format capabilities, serial number, and so on, as well as a method that enumerates *storages* on the device.</span></span> <span data-ttu-id="15195-147">Dans Windows Media Gestionnaire de périphériques, un stockage est tout type d’objet sur l’appareil, qu’il s’agisse ou non d’un blob de données réel.</span><span class="sxs-lookup"><span data-stu-id="15195-147">In Windows Media Device Manager, a storage is any kind of object on the device, whether or not it is an actual blob of data.</span></span> <span data-ttu-id="15195-148">Par exemple : les fichiers audio, les fichiers texte, les dossiers, les sélections stockés en tant que fichiers et les sélections stockées en tant que métadonnées sont tous considérés comme des stockages, même si les dossiers et les éléments de métadonnées ne représentent probablement pas un fichier physique.</span><span class="sxs-lookup"><span data-stu-id="15195-148">For example: audio files, text files, folders, playlists stored as files, and playlists stored as metadata are all considered storages, even though folders and metadata items probably do not represent a physical file.</span></span> <span data-ttu-id="15195-149">Le type (ou le format) d’un stockage peut être récupéré en appelant [**GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) (ou [**GetMetadata**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage3-getmetadata), en demandant le format du stockage).</span><span class="sxs-lookup"><span data-stu-id="15195-149">The type (or format) of a storage can be retrieved by calling [**GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) (or [**GetMetadata**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage3-getmetadata), requesting the format of the storage).</span></span>

<span data-ttu-id="15195-150">Les stockages sur un appareil sont stockés hiérarchiquement et tous les appareils ont un stockage racine.</span><span class="sxs-lookup"><span data-stu-id="15195-150">Storages on a device are stored hierarchically, and all devices have a root storage.</span></span> <span data-ttu-id="15195-151">Chaque stockage peut contenir zéro ou plusieurs objets enfants, énumérés en appelant la méthode [**IWMDMStorage :: EnumStorage**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-enumstorage) de ce stockage.</span><span class="sxs-lookup"><span data-stu-id="15195-151">Each storage can hold zero or more child objects, enumerated by calling that storage's [**IWMDMStorage::EnumStorage**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-enumstorage) method.</span></span>

<span data-ttu-id="15195-152">Notez que chaque stockage dans le diagramme possède des attributs et des métadonnées qui lui sont associés (toutes les valeurs ne sont pas affichées).</span><span class="sxs-lookup"><span data-stu-id="15195-152">Note that each storage in the diagram has attributes and metadata associated with it (not all values are shown).</span></span> <span data-ttu-id="15195-153">Les attributs sont des informations booléennes simples qui décrivent souvent des informations de gestion ou de navigation (telles que « has Folders » ou « Delete »), tandis que les métadonnées peuvent être des valeurs de chaîne, des nombres ou des informations complexes (telles que des fonctionnalités de rendu).</span><span class="sxs-lookup"><span data-stu-id="15195-153">Attributes are simple, Boolean information often describing management or navigational information (such as "has folders" or "can delete"), whereas metadata can be string values, numbers, or complex information (such as rendering capabilities).</span></span> <span data-ttu-id="15195-154">Les attributs sont décrits par un ensemble d’indicateurs assez limité défini par le kit de développement logiciel (SDK) et récupérés par l’appel de [**IWMDMStorage :: GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) ou [**IWMDMStorage2 :: GetAttributes2**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage2-getattributes2).</span><span class="sxs-lookup"><span data-stu-id="15195-154">Attributes are described by a fairly limited set of flags defined by the SDK and retrieved by calling [**IWMDMStorage::GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) or [**IWMDMStorage2::GetAttributes2**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage2-getattributes2).</span></span> <span data-ttu-id="15195-155">Les valeurs de métadonnées sont extraites par un nom unique ; le kit de développement logiciel (SDK) définit un certain nombre de valeurs de métadonnées que les appareils doivent prendre en charge, mais les appareils peuvent définir leurs propres [constantes de métadonnées](metadata-constants.md).</span><span class="sxs-lookup"><span data-stu-id="15195-155">Metadata values are retrieved by a unique name; the SDK defines a number of metadata values that devices should support, but devices can define their own [metadata constants](metadata-constants.md).</span></span> <span data-ttu-id="15195-156">Toutefois, si un appareil ou un fournisseur de services définit une nouvelle constante de métadonnées, les applications ne sont pas en mesure de demander ou de définir cette valeur, sauf si les développeurs d’applications ont pris connaissance de cette nouvelle constante.</span><span class="sxs-lookup"><span data-stu-id="15195-156">However, if a device or service provider defines a new metadata constant, applications won't be able to request or set this value unless the application developers were aware of this new constant.</span></span> <span data-ttu-id="15195-157">Un fournisseur de services doit prendre en charge [**IWMDMStorage3**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage3) ou version ultérieure pour prendre en charge la récupération ou la définition des métadonnées.</span><span class="sxs-lookup"><span data-stu-id="15195-157">A service provider must support [**IWMDMStorage3**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage3) or later to support retrieving or setting metadata.</span></span> <span data-ttu-id="15195-158">Pour plus d’informations, consultez [obtention et définition des métadonnées et des attributs](getting-and-setting-metadata-and-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="15195-158">For more information, see [Getting and Setting Metadata and Attributes](getting-and-setting-metadata-and-attributes.md).</span></span>

<span data-ttu-id="15195-159">Fournisseurs de services</span><span class="sxs-lookup"><span data-stu-id="15195-159">Service Providers</span></span>

<span data-ttu-id="15195-160">Le fournisseur de services joue le rôle d’intermédiaire entre l’application et l’appareil.</span><span class="sxs-lookup"><span data-stu-id="15195-160">The service provider acts as a middleman between the application and the device.</span></span> <span data-ttu-id="15195-161">Le fournisseur de services est invisible pour le développeur de l’application, de sorte qu’un développeur d’applications n’a pas besoin de tout savoir sur le développement d’un fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="15195-161">The service provider is invisible to the application developer, so an application developer does not need to know anything about developing a service provider.</span></span> <span data-ttu-id="15195-162">Toutefois, il s’agit du fournisseur de services qui effectue le travail de communication avec un appareil.</span><span class="sxs-lookup"><span data-stu-id="15195-162">However, it is the service provider that does the work of communicating with a device.</span></span>

<span data-ttu-id="15195-163">Un fournisseur de services est une DLL COM basée sur Windows Media Gestionnaire de périphériques qui reçoit les demandes d’une application et communique avec l’appareil pour les exécuter.</span><span class="sxs-lookup"><span data-stu-id="15195-163">A service provider is a COM DLL built on Windows Media Device Manager that receives requests from an application and communicates with the device to perform them.</span></span> <span data-ttu-id="15195-164">La communication avec l’application de bureau est médiation par Windows Media Gestionnaire de périphériques ; la communication avec l’appareil est sous le contrôle du fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="15195-164">Communication with the desktop application is mediated by Windows Media Device Manager; communication with the device is under the control of the service provider.</span></span>

<span data-ttu-id="15195-165">Un fournisseur de services reçoit les demandes de l’application pour énumérer le contenu de l’appareil, les demandes de fonctionnalités de l’appareil, les demandes de lecture ou d’écriture de données, etc.</span><span class="sxs-lookup"><span data-stu-id="15195-165">A service provider receives requests from the application to enumerate device content, requests for device capabilities, requests to read or write data, and so on.</span></span> <span data-ttu-id="15195-166">Il doit connaître la conception d’un appareil suffisamment bien qu’il puisse envoyer des commandes dans le format et le protocole appropriés.</span><span class="sxs-lookup"><span data-stu-id="15195-166">It must know the design of a device well enough that it can send commands in the proper format and protocol.</span></span> <span data-ttu-id="15195-167">Il doit également être en mesure de masquer les exigences spécifiques aux appareils, telles qu’une extension de fichier requise pour les sélections, afin que les applications n’aient pas besoin de connaître ces exigences pour pouvoir utiliser l’appareil.</span><span class="sxs-lookup"><span data-stu-id="15195-167">It should also be able to hide device-specific requirements, such as a required file extension for playlists, so that applications do not need to know these requirements in order to use the device.</span></span>

<span data-ttu-id="15195-168">Microsoft fournit un certain nombre de fournisseurs de services pour les types d’appareils standard, notamment les appareils MTP génériques, les périphériques de classe de stockage de masse et les appareils RAPI.</span><span class="sxs-lookup"><span data-stu-id="15195-168">Microsoft provides a number of service providers for standard device types, including generic MTP devices, Mass Storage Class devices, and RAPI devices.</span></span> <span data-ttu-id="15195-169">La seule raison pour laquelle un concepteur d’appareils doit créer un fournisseur de services personnalisé est si un appareil a des exigences de stockage de données spécifiques ou inhabituelles qui ne sont pas gérées par les fournisseurs de services standard (par exemple, si les fichiers doivent être stockés dans des emplacements spécifiques et que le système d’exploitation de l’appareil ne les gère pas automatiquement).</span><span class="sxs-lookup"><span data-stu-id="15195-169">The only reason a device designer should need to create a custom service provider is if a device has some specific or unusual data storage requirements that the standard service providers do not handle—for instance, if files must be stored in specific locations and the device operating system does not handle this automatically.</span></span>

<span data-ttu-id="15195-170">Quand un appareil est connecté à l’ordinateur, le système d’exploitation crée une instance du fournisseur de services approprié pour chaque application Windows Media Gestionnaire de périphériques.</span><span class="sxs-lookup"><span data-stu-id="15195-170">When a device is connected to the computer, the operating system creates one instance of the appropriate service provider for each Windows Media Device Manager application.</span></span> <span data-ttu-id="15195-171">Si une deuxième application Windows Media Gestionnaire de périphériques démarre, une deuxième instance du fournisseur de services est chargée.</span><span class="sxs-lookup"><span data-stu-id="15195-171">If a second Windows Media Device Manager application starts, a second instance of the service provider will be loaded.</span></span> <span data-ttu-id="15195-172">Toutefois, chaque fournisseur de services peut gérer plusieurs appareils.</span><span class="sxs-lookup"><span data-stu-id="15195-172">However, each service provider can handle multiple devices.</span></span> <span data-ttu-id="15195-173">Le diagramme suivant illustre ce point.</span><span class="sxs-lookup"><span data-stu-id="15195-173">The following diagram illustrates this.</span></span>

![Diagramme montrant deux appareils MTP communiquant avec deux applications.](images/wmdm-sp-to-device.gif)

<span data-ttu-id="15195-175">Le diagramme précédent montre deux applications différentes communiquant avec deux appareils MTP.</span><span class="sxs-lookup"><span data-stu-id="15195-175">The preceding diagram shows two different applications communicating with two MTP devices.</span></span> <span data-ttu-id="15195-176">Les appareils utilisent la même classe de fournisseur de service, mais chaque application possède sa propre instance du même fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="15195-176">The devices use the same service provider class, but each application has its own instance of the same service provider.</span></span> <span data-ttu-id="15195-177">Chaque instance du fournisseur de services communique avec les appareils.</span><span class="sxs-lookup"><span data-stu-id="15195-177">Each service provider instance is communicating with devices.</span></span> <span data-ttu-id="15195-178">Les différentes instances du fournisseur de services ne sont pas conscientes les unes des autres.</span><span class="sxs-lookup"><span data-stu-id="15195-178">The different instances of the service provider are not aware of each other.</span></span>

<span data-ttu-id="15195-179">De nombreuses méthodes d’application ont une méthode de fournisseur de service nommée correspondante.</span><span class="sxs-lookup"><span data-stu-id="15195-179">Many application methods have a correspondingly named service provider method.</span></span> <span data-ttu-id="15195-180">Lorsque l’application appelle une méthode, Windows Media Gestionnaire de périphériques achemine l’appel vers la méthode correspondante sur le fournisseur de services (bien qu’il puisse d’abord effectuer des actions internes supplémentaires).</span><span class="sxs-lookup"><span data-stu-id="15195-180">When the application calls a method, Windows Media Device Manager routes the call to the corresponding method on the service provider (though it might perform some additional internal actions first).</span></span> <span data-ttu-id="15195-181">Par exemple, quand l’application appelle [**IWMDMDevice3 :: GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-getproperty), Windows Media gestionnaire de périphériques achemine cet appel vers l’implémentation du fournisseur de services de [**IMDSPDevice3 :: GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-imdspdevice3-getproperty).</span><span class="sxs-lookup"><span data-stu-id="15195-181">For example, when the application calls [**IWMDMDevice3::GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-getproperty), Windows Media Device Manager routes this call to the service provider's implementation of [**IMDSPDevice3::GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-imdspdevice3-getproperty).</span></span> <span data-ttu-id="15195-182">(La plupart des interfaces d’application commencent par IWMDM, et l’interface du fournisseur de services correspondante commence par IMDSP).</span><span class="sxs-lookup"><span data-stu-id="15195-182">(Most application interfaces begin with IWMDM, and the corresponding service provider interface begins with IMDSP).</span></span> <span data-ttu-id="15195-183">Le fournisseur de services est censé gérer cet appel de méthode et retourner un résultat approprié.</span><span class="sxs-lookup"><span data-stu-id="15195-183">The service provider is expected to handle this method call and return an appropriate result.</span></span>

<span data-ttu-id="15195-184">Une application n’explore jamais ou ne communique pas directement avec un appareil (sauf si elle appelle [**IWMDMDevice3 ::D eviceiocontrol**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-deviceiocontrol) ou [**IWMDMStorage :: SendOpaqueCommand**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-sendopaquecommand)); l’application communique avec le fournisseur de services, qui doit représenter un appareil de la manière la plus logique et la plus simple possible.</span><span class="sxs-lookup"><span data-stu-id="15195-184">An application never explores or communicates with a device directly (unless it calls [**IWMDMDevice3::DeviceIoControl**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-deviceiocontrol) or [**IWMDMStorage::SendOpaqueCommand**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-sendopaquecommand)); the application communicates with the service provider, which must represent a device in the most logical and simple manner possible.</span></span> <span data-ttu-id="15195-185">Lorsque l’application demande des informations sur l’appareil ou énumère des objets sur l’appareil, le fournisseur de services interroge l’appareil de manière appropriée et acquiert et retourne les informations appropriées.</span><span class="sxs-lookup"><span data-stu-id="15195-185">When the application requests information about the device, or enumerates objects on the device, the service provider queries the device in an appropriate manner and acquires and returns the appropriate information.</span></span> <span data-ttu-id="15195-186">Il peut exposer l’Organisation des fichiers sur l’appareil différemment de la façon dont il est stocké physiquement sur l’appareil, si cela est approprié.</span><span class="sxs-lookup"><span data-stu-id="15195-186">It may expose the file organization on the device differently from how it is physically stored on the device, if that is appropriate.</span></span> <span data-ttu-id="15195-187">Toutefois, il expose l’appareil, il doit être de manière cohérente et logique, afin de permettre à l’application de trouver ce dont elle a besoin et de gérer les commandes qu’elle envoie.</span><span class="sxs-lookup"><span data-stu-id="15195-187">However it exposes the device, it should be in a consistent, logical manner, to enable the application to find what it needs and handle the commands it sends.</span></span> <span data-ttu-id="15195-188">Un bon fournisseur de services masquera les particularités propres à l’appareil : par exemple, si l’appareil stocke physiquement une sélection dans un fichier avec une extension de fichier personnalisée, le fournisseur de services doit ajouter cette extension automatiquement quand l’application crée une sélection sur l’appareil. il ne doit pas s’attendre à ce que l’application connaisse l’extension appropriée lors de la création d’un objet playlist.</span><span class="sxs-lookup"><span data-stu-id="15195-188">A good service provider will hide device-specific peculiarities—for example, if the device physically stores a playlist as a file with a custom file extension, the service provider should add that extension automatically when the application creates a playlist on the device; it should not expect the application to know the proper extension when creating a playlist object.</span></span>

<span data-ttu-id="15195-189">Les fournisseurs de services s’exécutent dans le processus de l’application appelante.</span><span class="sxs-lookup"><span data-stu-id="15195-189">Service providers run inside the process of the calling application.</span></span> <span data-ttu-id="15195-190">La seule exception est le fournisseur de services MTP, qui s’exécute dans son propre processus.</span><span class="sxs-lookup"><span data-stu-id="15195-190">The only exception to this is the MTP service provider, which runs in its own process.</span></span> <span data-ttu-id="15195-191">Pour cette raison, il existe un risque qu’un fournisseur de services bloqué entraîne le blocage de l’application appelante.</span><span class="sxs-lookup"><span data-stu-id="15195-191">Because of this, there is some risk that a blocked service provider will cause the calling application to block.</span></span> <span data-ttu-id="15195-192">Par conséquent, les fournisseurs de services doivent être conçus pour être robustes et empêcher le blocage, et les applications doivent être conçues pour éviter les blocages si un appel de méthode particulier ne retourne pas rapidement.</span><span class="sxs-lookup"><span data-stu-id="15195-192">Therefore, service providers should be designed to be robust and prevent blocking, and applications should be designed to avoid stalling if a particular method call does not return quickly.</span></span>

## <a name="related-topics"></a><span data-ttu-id="15195-193">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="15195-193">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="15195-194">**Prise en main**</span><span class="sxs-lookup"><span data-stu-id="15195-194">**Getting Started**</span></span>](getting-started.md)
</dt> </dl>

 

 




