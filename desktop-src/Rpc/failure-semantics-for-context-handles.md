---
title: Sémantique d’échec pour les handles de contexte
description: Cette rubrique décrit la sémantique d’échec pour les descripteurs de contexte.
ms.assetid: fcf28519-39ad-4823-bc27-f3502e4d540c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c4528b3f5160b92a4e6f10dbcf877e9fec59f81b
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104029273"
---
# <a name="failure-semantics-for-context-handles"></a><span data-ttu-id="f47ac-103">Sémantique d’échec pour les handles de contexte</span><span class="sxs-lookup"><span data-stu-id="f47ac-103">Failure Semantics for Context Handles</span></span>

<span data-ttu-id="f47ac-104">Cette rubrique décrit la sémantique d’échec pour les descripteurs de contexte.</span><span class="sxs-lookup"><span data-stu-id="f47ac-104">This topic discusses failure semantics for context handles.</span></span>

## <a name="failure-semantics-when-closing-the-context-handle-fails"></a><span data-ttu-id="f47ac-105">La sémantique d’échec lors de la fermeture du handle de contexte échoue</span><span class="sxs-lookup"><span data-stu-id="f47ac-105">Failure Semantics when Closing the Context Handle Fails</span></span>

<span data-ttu-id="f47ac-106">Imaginez qu’une application cliente tente de fermer un handle de contexte ouvert sur le serveur, sans arrêter le processus client.</span><span class="sxs-lookup"><span data-stu-id="f47ac-106">Imagine a client application is attempting to close a context handle it opened on the server, without shutting down the client process.</span></span> <span data-ttu-id="f47ac-107">Par ailleurs, supposons que l’appel au serveur pour fermer le descripteur de contexte échoue (par exemple, la mémoire du client est insuffisante).</span><span class="sxs-lookup"><span data-stu-id="f47ac-107">Also, assume the call to the server to close the context handle fails (for example, the client is out of memory).</span></span> <span data-ttu-id="f47ac-108">La méthode appropriée pour gérer cette situation consiste à appeler la fonction [**RpcSsDestroyClientContext**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssdestroyclientcontext) .</span><span class="sxs-lookup"><span data-stu-id="f47ac-108">The proper way to handle this situation is to call the [**RpcSsDestroyClientContext**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssdestroyclientcontext) function.</span></span> <span data-ttu-id="f47ac-109">Dans ce cas, le client nettoie son côté du handle de contexte et abortively ferme la connexion au serveur.</span><span class="sxs-lookup"><span data-stu-id="f47ac-109">In such a case the client cleans up its side of the context handle, and abortively closes the connection to the server.</span></span> <span data-ttu-id="f47ac-110">Étant donné que la connexion est en fait un pool de connexions (voir [RPC et le réseau](rpc-and-the-network.md)), qui est un compte de référence avec une référence pour chaque liaison ou handle de contexte ouvert, la destruction du descripteur de contexte en appelant la fonction **RpcSsDestroyClientContext** ne détruit pas réellement la connexion.</span><span class="sxs-lookup"><span data-stu-id="f47ac-110">Since the connection is really a connection pool (see [RPC and the Network](rpc-and-the-network.md)), which is reference-counted with one reference for each opened binding or context handle, destroying the context handle by calling the **RpcSsDestroyClientContext** function does not actually destroy the connection.</span></span> <span data-ttu-id="f47ac-111">Au lieu de cela, il décrémente le nombre de références pour le pool de connexions.</span><span class="sxs-lookup"><span data-stu-id="f47ac-111">Rather, it decrements the reference count for the connection pool.</span></span> <span data-ttu-id="f47ac-112">Pour les connexions dans le pool à fermer, le client doit fermer tous les descripteurs de liaison et les handles de contexte sur ce serveur à partir du processus client.</span><span class="sxs-lookup"><span data-stu-id="f47ac-112">For connections in the pool to be closed, the client needs to close all binding handles and context handles to that server from the client process.</span></span> <span data-ttu-id="f47ac-113">Ensuite, toutes les connexions du pool sont fermées et le mécanisme d’exécution du serveur est lancé et nettoyé.</span><span class="sxs-lookup"><span data-stu-id="f47ac-113">Then all connections in the pool are closed, and the server run-down mechanism is initiated and cleans up.</span></span>

## <a name="failure-semantics-during-change-of-state-of-the-context-handle"></a><span data-ttu-id="f47ac-114">Sémantique d’échec lors du changement d’État du handle de contexte</span><span class="sxs-lookup"><span data-stu-id="f47ac-114">Failure Semantics During Change of State of the Context Handle</span></span>

<span data-ttu-id="f47ac-115">Les informations contenues dans cette section font référence aux plateformes Windows XP et versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="f47ac-115">The information in this section refers to Windows XP and later platforms.</span></span>

<span data-ttu-id="f47ac-116">Les handles de contexte sont simplement des paramètres d’une fonction.</span><span class="sxs-lookup"><span data-stu-id="f47ac-116">Context handles are simply parameters to a function.</span></span> <span data-ttu-id="f47ac-117">Toutes les modifications de l’état d’un handle de contexte se produisent lorsque les paramètres sont marshalés ou démarshalés.</span><span class="sxs-lookup"><span data-stu-id="f47ac-117">All changes in the state of a context handle happen when parameters are marshaled or unmarshaled.</span></span> <span data-ttu-id="f47ac-118">Par exemple, si un client ouvre un handle de contexte (le remplace de **null** par une valeur non **null**), le runtime RPC n’ouvre pas en fait la partie RPC du handle tant que les arguments ne sont pas marshalés pour l’envoi au client.</span><span class="sxs-lookup"><span data-stu-id="f47ac-118">For example, if a client opens a context handle (changes it from **NULL** to non-**NULL**), the RPC run-time does not actually open the RPC portion of the handle until the arguments are marshaled for sending to the client.</span></span> <span data-ttu-id="f47ac-119">Des échecs peuvent se produire pendant l’intervalle de temps.</span><span class="sxs-lookup"><span data-stu-id="f47ac-119">Failures can occur during the interim.</span></span> <span data-ttu-id="f47ac-120">En raison d’une variété de conditions réseau ou de ressources insuffisantes, la transmission du paquet au client peut échouer.</span><span class="sxs-lookup"><span data-stu-id="f47ac-120">Due to a variety of possible network or low resource conditions, transmission of the packet to the client could fail.</span></span> <span data-ttu-id="f47ac-121">Ou la routine du serveur peut lever une exception lors de la tentative de modification d’un handle de contexte.</span><span class="sxs-lookup"><span data-stu-id="f47ac-121">Or the server routine may throw an exception while attempting to change a context handle.</span></span> <span data-ttu-id="f47ac-122">Dans ces cas de défaillance ou dans d’autres situations, le client et le serveur peuvent avoir des vues incohérentes du descripteur de contexte.</span><span class="sxs-lookup"><span data-stu-id="f47ac-122">In these or other failure situations, the client and server may get inconsistent views of the context handle.</span></span> <span data-ttu-id="f47ac-123">Cette section décrit la règle pour l’état du descripteur de contexte et la responsabilité du code du client et du serveur pendant les différentes conditions d’échec.</span><span class="sxs-lookup"><span data-stu-id="f47ac-123">This section explains the rule for the state of the context handle, and the responsibility of client and server code during various failure conditions.</span></span>

-   <span data-ttu-id="f47ac-124">Un descripteur de contexte **null** arrive, mais la routine du serveur rencontre un échec et lève une exception.</span><span class="sxs-lookup"><span data-stu-id="f47ac-124">A **NULL** context handle arrives, but the server routine encounters a failure and throws an exception.</span></span>

    <span data-ttu-id="f47ac-125">Il est de la responsabilité de la routine de serveur de nettoyer tout État lié à un handle de contexte, qu’elle a peut-être créée.</span><span class="sxs-lookup"><span data-stu-id="f47ac-125">It is the responsibility of the server routine to clean up any context handle–related state it may have created.</span></span> <span data-ttu-id="f47ac-126">L’heure d’exécution RPC nettoie son état.</span><span class="sxs-lookup"><span data-stu-id="f47ac-126">The RPC run time cleans up its state.</span></span>

-   <span data-ttu-id="f47ac-127">Un descripteur de contexte non **null** arrive, mais la routine de serveur rencontre un échec et lève une exception.</span><span class="sxs-lookup"><span data-stu-id="f47ac-127">A non-**NULL** context handles arrives, but the server routine encounters a failure and throws an exception.</span></span>

    <span data-ttu-id="f47ac-128">Si la routine de serveur a fermé le descripteur de contexte, le client ne le connaîtra pas, car l’appel échouera. une utilisation plus poussée du handle de contexte entraîne une erreur de non- \_ \_ correspondance du contexte SS RPC X \_ \_ sur le client.</span><span class="sxs-lookup"><span data-stu-id="f47ac-128">If the server routine closed the context handle, the client will not know about it, since the call will not succeed; further use of the context handle will result in an RPC\_X\_SS\_CONTEXT\_MISMATCH error on the client.</span></span> <span data-ttu-id="f47ac-129">Si la routine de serveur ne modifie pas le descripteur de contexte, le client peut toujours l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="f47ac-129">If the server routine does not modify the context handle, the client can still use it.</span></span> <span data-ttu-id="f47ac-130">Si la routine du serveur modifie les informations stockées dans le contexte du serveur, les nouveaux appels du client utiliseront ces informations.</span><span class="sxs-lookup"><span data-stu-id="f47ac-130">If the server routine changes the information stored in the server context, new calls from the client will use that information.</span></span>

-   <span data-ttu-id="f47ac-131">Un descripteur de contexte non **null** arrive, et la routine serveur ferme le descripteur, mais le marshaling après l’échec de marshaling du handle de contexte ou du traitement après l’échec du marshaling.</span><span class="sxs-lookup"><span data-stu-id="f47ac-131">A non-**NULL** context handle arrives, and the server routine closes the handle, but either marshaling after the context handle was marshaled failed, or processing after marshaling failed.</span></span>

    <span data-ttu-id="f47ac-132">Le descripteur de contexte est fermé, et les appels ultérieurs de ce client à l’aide de ce handle de contexte entraînent une erreur de non- \_ \_ \_ concordance du contexte de la sécurité RPC X \_ sur le client.</span><span class="sxs-lookup"><span data-stu-id="f47ac-132">The context handle is closed, and further calls by this client using this context handle result in an RPC\_X\_SS\_CONTEXT\_MISMATCH error on the client.</span></span>

-   <span data-ttu-id="f47ac-133">Un handle de contexte **null** arrive, et le serveur crée son contexte pour ce descripteur, mais l’un ou l’autre après le marshaling du handle de contexte a échoué, ou le traitement après l’échec du marshaling.</span><span class="sxs-lookup"><span data-stu-id="f47ac-133">A **NULL** context handle arrives, and the server creates its context for this handle, but either marshaling after the context handle was marshaled failed, or processing after marshaling failed.</span></span>

    <span data-ttu-id="f47ac-134">Dans ce cas, le runtime RPC appelle la méthode d’exécution pour ce handle de contexte et nettoie l’état RPC pour ce handle de contexte.</span><span class="sxs-lookup"><span data-stu-id="f47ac-134">In this case, the RPC run time invokes the run down for this context handle, and cleans up the RPC state for this context handle.</span></span> <span data-ttu-id="f47ac-135">Le descripteur de contexte n’est pas créé côté client.</span><span class="sxs-lookup"><span data-stu-id="f47ac-135">The context handle will not be created on the client side.</span></span>

-   <span data-ttu-id="f47ac-136">Un descripteur de contexte non **null** arrive, et le serveur ne modifie pas le descripteur de contexte, ou modifie les informations stockées dans le contexte du serveur, et le marshaling échoue après le marshaling du handle de contexte.</span><span class="sxs-lookup"><span data-stu-id="f47ac-136">A non-**NULL** context handle arrives, and the server either does not change the context handle, or it changes the information stored in the server context, and marshaling fails after the context handle is marshaled.</span></span>

    <span data-ttu-id="f47ac-137">Les nouveaux appels du client utiliseront le descripteur de contexte du serveur.</span><span class="sxs-lookup"><span data-stu-id="f47ac-137">New calls from the client will use the context handle that the server has.</span></span>

-   <span data-ttu-id="f47ac-138">Un handle de contexte **null** arrive, et le serveur ne lui affecte pas la valeur **null**, mais l’appel échoue avant que le handle de contexte ne soit marshalé.</span><span class="sxs-lookup"><span data-stu-id="f47ac-138">A **NULL** context handle arrives, and the server does not set it to anything other than **NULL**, but the call fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="f47ac-139">Dans ce cas, aucun descripteur de contexte n’est créé sur le client.</span><span class="sxs-lookup"><span data-stu-id="f47ac-139">In this case, no context handle is created on the client.</span></span>

-   <span data-ttu-id="f47ac-140">Un descripteur de contexte non **null** arrive, et le serveur lui affecte la **valeur null**, mais le marshaling échoue avant que le handle de contexte ne soit marshalé.</span><span class="sxs-lookup"><span data-stu-id="f47ac-140">A non-**NULL** context handle arrives, and the server sets it to **NULL**, but marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="f47ac-141">Dans ce cas, le handle de contexte reste fermé sur le serveur et le client reçoit des \_ Erreurs de non-correspondance de contexte RPC X \_ SS \_ \_ lorsqu’il tente d’utiliser le handle de contexte.</span><span class="sxs-lookup"><span data-stu-id="f47ac-141">In this case, the context handle remains closed on the server, and the client gets RPC\_X\_SS\_CONTEXT\_MISMATCH errors when it tries to use the context handle.</span></span>

-   <span data-ttu-id="f47ac-142">Un descripteur de contexte **null** arrive sur le serveur et le serveur lui affecte la **valeur non null**, mais le marshaling échoue avant que le handle de contexte ne soit marshalé.</span><span class="sxs-lookup"><span data-stu-id="f47ac-142">A **NULL** context handle arrives on the server, and the server sets it to non-**NULL**, but marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="f47ac-143">L’exécution du descripteur de contexte doit être appelée pour que le serveur puisse être nettoyé, et aucun handle de contexte ne sera créé sur le client.</span><span class="sxs-lookup"><span data-stu-id="f47ac-143">The context handle run down is to be invoked so that the server can clean up, and no context handle will be created on the client.</span></span>

-   <span data-ttu-id="f47ac-144">Un descripteur de contexte non **null** arrive, et le serveur ne modifie pas le descripteur de contexte, ou modifie les informations stockées dans le contexte du serveur, et le marshaling échoue avant le marshaling du handle de contexte.</span><span class="sxs-lookup"><span data-stu-id="f47ac-144">A non-**NULL** context handle arrives, and the server either does not change the context handle, or it changes the information stored in the server context, and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="f47ac-145">Les nouveaux appels du client utiliseront l’État sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="f47ac-145">New calls from the client will use the state on the server.</span></span>

-   <span data-ttu-id="f47ac-146">Un handle de contexte est déclaré en tant que valeur de retour, et la routine de serveur retourne la valeur **null** pour le handle de contexte et le marshaling échoue avant que le handle de contexte ne soit marshalé.</span><span class="sxs-lookup"><span data-stu-id="f47ac-146">A context handle is declared as a return value, and the server routine returns **NULL** for the context handle and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="f47ac-147">Dans ce cas, aucun nouveau contexte n’est créé sur le client.</span><span class="sxs-lookup"><span data-stu-id="f47ac-147">In this case, no new context is created on the client.</span></span>

-   <span data-ttu-id="f47ac-148">Un handle de contexte est déclaré en tant que valeur de retour, et la routine de serveur retourne une valeur non **null** pour le handle de contexte et le marshaling échoue avant que le handle de contexte ne soit marshalé.</span><span class="sxs-lookup"><span data-stu-id="f47ac-148">A context handle is declared as a return value, and the server routine returns non-**NULL** for the context handle and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="f47ac-149">Le runtime RPC appelle la routine de la routine d’exécution du handle de contexte pour lui permettre de le nettoyer, et aucun nouveau contexte n’est créé sur le client.</span><span class="sxs-lookup"><span data-stu-id="f47ac-149">The RPC run time calls the context handle run-down routine to give it a chance to clean up, and no new context is created on the client.</span></span>

 

 




