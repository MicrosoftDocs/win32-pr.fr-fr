---
title: Latence et débit du réseau
description: Latence du réseau et débit avec appel de procédure distante (RPC).
ms.assetid: 8285fd73-eb54-4c06-b01a-1bffafb7e675
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c5c51c4db75b904ac5feae8c4a1cc5965fc2b06e
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104197261"
---
# <a name="network-latency-and-throughput"></a><span data-ttu-id="260bd-103">Latence et débit du réseau</span><span class="sxs-lookup"><span data-stu-id="260bd-103">Network Latency and Throughput</span></span>

<span data-ttu-id="260bd-104">Trois problèmes majeurs se rapportent à une utilisation optimale du réseau :</span><span class="sxs-lookup"><span data-stu-id="260bd-104">Three major issues relate to optimal use of the network:</span></span>

-   <span data-ttu-id="260bd-105">Latence du réseau</span><span class="sxs-lookup"><span data-stu-id="260bd-105">Network latency</span></span>
-   <span data-ttu-id="260bd-106">Saturation du réseau</span><span class="sxs-lookup"><span data-stu-id="260bd-106">Network saturation</span></span>
-   <span data-ttu-id="260bd-107">Implications en matière de traitement des paquets</span><span class="sxs-lookup"><span data-stu-id="260bd-107">Packet processing implications</span></span>

<span data-ttu-id="260bd-108">Cette section présente une tâche de programmation nécessitant l’utilisation d’un RPC, puis conçoit deux solutions : une mauvaise écriture et une bonne écriture.</span><span class="sxs-lookup"><span data-stu-id="260bd-108">This section introduces a programming task requiring use of RPC, then designs two solutions: one poorly written and one well written.</span></span> <span data-ttu-id="260bd-109">Les deux solutions sont ensuite examinées et leur impact sur les performances du réseau est abordé.</span><span class="sxs-lookup"><span data-stu-id="260bd-109">Both solutions are then scrutinized, and their affect on network performance is discussed.</span></span>

<span data-ttu-id="260bd-110">Avant de discuter des deux solutions, les sections suivantes décrivent et clarifient les problèmes de performances liés au réseau.</span><span class="sxs-lookup"><span data-stu-id="260bd-110">Before discussing the two solutions, the next few sections discuss and clarify network related performance issues.</span></span>

## <a name="network-latency"></a><span data-ttu-id="260bd-111">Latence du réseau</span><span class="sxs-lookup"><span data-stu-id="260bd-111">Network Latency</span></span>

<span data-ttu-id="260bd-112">La bande passante réseau et la latence du réseau sont des termes distincts.</span><span class="sxs-lookup"><span data-stu-id="260bd-112">Network bandwidth and network latency are separate terms.</span></span> <span data-ttu-id="260bd-113">Les réseaux à bande passante élevée ne garantissent pas une faible latence.</span><span class="sxs-lookup"><span data-stu-id="260bd-113">Networks with high bandwidth do not guarantee low latency.</span></span> <span data-ttu-id="260bd-114">Par exemple, un chemin d’accès réseau qui traverse une liaison satellite a souvent une latence élevée, même si le débit est très élevé.</span><span class="sxs-lookup"><span data-stu-id="260bd-114">For example, a network path traversing a satellite link often has high latency, even though throughput is very high.</span></span> <span data-ttu-id="260bd-115">Il n’est pas rare qu’une boucle de réseau traverse un lien satellite pour avoir cinq secondes ou plus de latence.</span><span class="sxs-lookup"><span data-stu-id="260bd-115">It is not uncommon for a network round trip traversing a satellite link to have five or more seconds of latency.</span></span> <span data-ttu-id="260bd-116">L’implication d’un tel délai est la suivante : une application conçue pour envoyer une demande, attendre une réponse, envoyer une autre demande, attendre une autre réponse, etc., attendra au moins cinq secondes pour chaque échange de paquets, quelle que soit la vitesse du serveur.</span><span class="sxs-lookup"><span data-stu-id="260bd-116">The implication of such a delay is this: an application designed to send a request, wait for a reply, send another request, wait for another reply, and so on, will wait at least five seconds for each packet exchange, regardless of how fast the server is.</span></span> <span data-ttu-id="260bd-117">Malgré la rapidité accrue des ordinateurs, les transmissions par satellite et les supports réseau sont basés sur la vitesse de la lumière, qui reste généralement constante.</span><span class="sxs-lookup"><span data-stu-id="260bd-117">Despite the increasing speed of computers, satellite transmissions and network media are based on the speed of light, which generally stays constant.</span></span> <span data-ttu-id="260bd-118">Par conséquent, il est peu probable que des améliorations de la latence des réseaux satellites existants se produisent.</span><span class="sxs-lookup"><span data-stu-id="260bd-118">As such, improvements in latency for existing satellite networks is unlikely to occur.</span></span>

## <a name="network-saturation"></a><span data-ttu-id="260bd-119">Saturation du réseau</span><span class="sxs-lookup"><span data-stu-id="260bd-119">Network Saturation</span></span>

<span data-ttu-id="260bd-120">Une certaine saturation se produit dans de nombreux réseaux.</span><span class="sxs-lookup"><span data-stu-id="260bd-120">Some saturation occurs in many networks.</span></span> <span data-ttu-id="260bd-121">Les réseaux les plus faciles à saturer sont des liens de modem lents, tels que des modems analogiques 56k standard.</span><span class="sxs-lookup"><span data-stu-id="260bd-121">The easiest networks to saturate are slow modem links, such as standard 56k analog modems.</span></span> <span data-ttu-id="260bd-122">Toutefois, les liaisons Ethernet avec de nombreux ordinateurs sur un seul segment peuvent également être saturées.</span><span class="sxs-lookup"><span data-stu-id="260bd-122">However, Ethernet links with many computers on a single segment can also become saturated.</span></span> <span data-ttu-id="260bd-123">Il en va de même pour les réseaux étendus avec une faible bande passante ou un lien surchargé, tel qu’un routeur ou un commutateur qui peut gérer une quantité limitée de trafic.</span><span class="sxs-lookup"><span data-stu-id="260bd-123">The same is true about wide area networks with a low-bandwidth or otherwise overburdened link, such as a router or switch that can handle a limited amount of traffic.</span></span> <span data-ttu-id="260bd-124">Dans ce cas, si le réseau envoie plus de paquets que son lien le plus faible peut gérer, il supprime des paquets.</span><span class="sxs-lookup"><span data-stu-id="260bd-124">In such these cases, if the network sends more packets than its weakest link can handle, it drops packets.</span></span> <span data-ttu-id="260bd-125">Pour éviter toute congestion, la pile TCP Windows revient en arrière lorsque des paquets supprimés sont détectés, ce qui peut entraîner des retards importants.</span><span class="sxs-lookup"><span data-stu-id="260bd-125">To avoid congestion the Windows TCP stack scales back when dropped packets are detected which can result in significant delays.</span></span>

## <a name="packet-processing-implications"></a><span data-ttu-id="260bd-126">Implications en matière de traitement des paquets</span><span class="sxs-lookup"><span data-stu-id="260bd-126">Packet Processing Implications</span></span>

<span data-ttu-id="260bd-127">Lorsque des programmes sont développés pour des environnements de niveau supérieur tels que RPC, COM et même Windows Sockets, les développeurs ont tendance à oublier la quantité de travail qui se produit en arrière-plan pour chaque paquet envoyé ou reçu.</span><span class="sxs-lookup"><span data-stu-id="260bd-127">When programs are developed for higher level environments like RPC, COM, and even Windows Sockets, developers tend to forget how much work takes place behind the scenes for each sent or received packet.</span></span> <span data-ttu-id="260bd-128">Lorsqu’un paquet arrive à partir du réseau, une interruption de la carte réseau est servie par l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="260bd-128">When a packet arrives from the network, an interrupt from the network card is serviced by the computer.</span></span> <span data-ttu-id="260bd-129">Un appel de procédure différé (DPC) est alors mis en file d’attente et doit être effectué via les pilotes.</span><span class="sxs-lookup"><span data-stu-id="260bd-129">Then a Deferred Procedure Call (DPC) is queued, and must make its way through the drivers.</span></span> <span data-ttu-id="260bd-130">Si une forme de sécurité est utilisée, il peut être nécessaire de déchiffrer le paquet ou le hachage de chiffrement vérifié.</span><span class="sxs-lookup"><span data-stu-id="260bd-130">If any form of security is used, the packet may have to be decrypted, or the cryptographic hash verified.</span></span> <span data-ttu-id="260bd-131">Un certain nombre de contrôles de validité doivent également être effectués à chaque État.</span><span class="sxs-lookup"><span data-stu-id="260bd-131">A number of validity checks must also be performed at each state.</span></span> <span data-ttu-id="260bd-132">Le paquet arrive uniquement à la destination finale : le code du serveur.</span><span class="sxs-lookup"><span data-stu-id="260bd-132">Only then does the packet arrive at the final destination: the server code.</span></span> <span data-ttu-id="260bd-133">L’envoi de plusieurs petits segments de données entraîne une surcharge de traitement des paquets pour chaque petit segment de données.</span><span class="sxs-lookup"><span data-stu-id="260bd-133">Sending many small chunks of data results in packet processing overhead for each small chunk of data.</span></span> <span data-ttu-id="260bd-134">L’envoi d’un grand segment de données tend à consommer beaucoup moins de temps processeur dans le système, même si le coût d’exécution de nombreux petits fragments par rapport à un grand segment peut être le même pour l’application serveur.</span><span class="sxs-lookup"><span data-stu-id="260bd-134">Sending one big chunk of data tends to consume significantly less CPU time throughout the system, even though the cost of execution for many small chunks compared to one large chunk may be the same for the server application.</span></span>

## <a name="example-1-a-poorly-designed-rpc-server"></a><span data-ttu-id="260bd-135">Exemple 1 : serveur RPC mal conçu</span><span class="sxs-lookup"><span data-stu-id="260bd-135">Example 1: A Poorly Designed RPC Server</span></span>

<span data-ttu-id="260bd-136">Imaginez une application qui doit accéder à des fichiers distants, et la tâche en cours consiste à concevoir une interface RPC pour manipuler le fichier distant.</span><span class="sxs-lookup"><span data-stu-id="260bd-136">Imagine an application that must access remote files, and the task at hand is to design an RPC interface for manipulating the remote file.</span></span> <span data-ttu-id="260bd-137">La solution la plus simple consiste à mettre en miroir les routines de fichier Studio pour les fichiers locaux.</span><span class="sxs-lookup"><span data-stu-id="260bd-137">The simplest solution is to mirror the studio file routines for local files.</span></span> <span data-ttu-id="260bd-138">Cela peut entraîner un nettoyage et une interface familière trompeur.</span><span class="sxs-lookup"><span data-stu-id="260bd-138">Doing so may result in a deceptively clean and familiar interface.</span></span> <span data-ttu-id="260bd-139">Voici un fichier. idl abrégé :</span><span class="sxs-lookup"><span data-stu-id="260bd-139">Here is an abbreviated .idl file:</span></span>

``` syntax
typedef [context_handle] void *remote_file;
... .
interface remote_file
{
    remote_file remote_fopen(file_name);
    void remote_fclose(remote_file ...);
    size_t remote_fread(void *, size_t, size_t, remote_file ...);
    size_t remote_fwrite(const void *, size_t, size_t, remote_file ...);
    size_t remote_fseek(remote_file ..., long, int);
}
```

<span data-ttu-id="260bd-140">Cela semble assez élégant, mais en fait, il s’agit d’une recette à temps pour les sinistres de performances.</span><span class="sxs-lookup"><span data-stu-id="260bd-140">This seems elegant enough, but actually, this is a time-honored recipe for performance disaster.</span></span> <span data-ttu-id="260bd-141">Contrairement à l’opinion populaire, l’appel de procédure distante n’est pas simplement un appel de procédure locale avec un câble entre l’appelant et l’appelé.</span><span class="sxs-lookup"><span data-stu-id="260bd-141">Contrary to popular opinion, remote procedure call is not simply a local procedure call with a wire between the caller and callee.</span></span>

<span data-ttu-id="260bd-142">Pour voir comment cette recette grave les performances, envisagez un fichier de 2K, où 20 octets sont lus depuis le début, puis 20 octets à partir de la fin, et voyez comment cela s’effectue.</span><span class="sxs-lookup"><span data-stu-id="260bd-142">To see how this recipe burns performance, consider a 2K file, where 20 bytes are read from the beginning, and then 20 bytes from the end, and see how this performs.</span></span> <span data-ttu-id="260bd-143">Côté client, les appels suivants sont effectués (de nombreux chemins de code sont omis par souci de concision) :</span><span class="sxs-lookup"><span data-stu-id="260bd-143">On the client side, the following calls are made (many code paths are omitted for brevity):</span></span>

``` syntax
rfp = remote_fopen("c:\\sample.txt");
remote_read(...);
remote_fseek(...);
remote_read(...);
remote_fclose(rfp);
```

<span data-ttu-id="260bd-144">Imaginez maintenant que le serveur est séparé du client par un lien satellite avec un temps d’aller-retour de cinq secondes.</span><span class="sxs-lookup"><span data-stu-id="260bd-144">Now imagine that the server is separated from the client by a satellite link with a five-second round-trip time.</span></span> <span data-ttu-id="260bd-145">Chacun de ces appels doit attendre une réponse avant de pouvoir continuer, ce qui signifie un minimum absolu pour l’exécution de cette séquence de 25 secondes.</span><span class="sxs-lookup"><span data-stu-id="260bd-145">Each of those calls must wait for a response before it can proceed, which means an absolute minimum for executing this sequence of 25 seconds.</span></span> <span data-ttu-id="260bd-146">En considérant que nous récupérons uniquement 40 octets, il s’agit d’un ralentissement des performances Outrageously.</span><span class="sxs-lookup"><span data-stu-id="260bd-146">Considering we are retrieving only 40 bytes, this is outrageously slow performance.</span></span> <span data-ttu-id="260bd-147">Les clients de cette application seraient furieux.</span><span class="sxs-lookup"><span data-stu-id="260bd-147">Customers of this application would be furious.</span></span>

<span data-ttu-id="260bd-148">Imaginez maintenant que le réseau est saturé, car la capacité d’un routeur quelque part dans le chemin d’accès réseau est trop lourde.</span><span class="sxs-lookup"><span data-stu-id="260bd-148">Now imagine the network is saturated, because a router's capacity somewhere in the network path is overburdened.</span></span> <span data-ttu-id="260bd-149">Cette conception force le routeur à gérer au moins 10 paquets si nous n’avons pas de sécurité (une pour chaque demande et une pour chaque réponse).</span><span class="sxs-lookup"><span data-stu-id="260bd-149">This design forces the router to handle at least 10 packets if we do not have security (one for each request, and one for each reply).</span></span> <span data-ttu-id="260bd-150">Cela ne constitue pas une bonne chose.</span><span class="sxs-lookup"><span data-stu-id="260bd-150">That, too, is not good.</span></span>

<span data-ttu-id="260bd-151">Cette conception force également le serveur à recevoir cinq paquets et à envoyer cinq paquets.</span><span class="sxs-lookup"><span data-stu-id="260bd-151">This design also forces the server to receive five packets and send five packets.</span></span> <span data-ttu-id="260bd-152">Là encore, l’implémentation n’est pas très bonne.</span><span class="sxs-lookup"><span data-stu-id="260bd-152">Again, not a very good implementation.</span></span>

## <a name="example-2-a-better-designed-rpc-server"></a><span data-ttu-id="260bd-153">Exemple 2 : serveur RPC mieux conçu</span><span class="sxs-lookup"><span data-stu-id="260bd-153">Example 2: A Better Designed RPC Server</span></span>

<span data-ttu-id="260bd-154">Nous allons modifier la conception de l’interface décrite dans l’exemple 1 et voir si nous pouvons la rendre plus efficace.</span><span class="sxs-lookup"><span data-stu-id="260bd-154">Let's redesign the interface discussed in Example 1, and see whether we can make it better.</span></span> <span data-ttu-id="260bd-155">Il est important de noter que le fait de rendre ce serveur vraiment correct nécessite une connaissance du modèle d’utilisation pour les fichiers donnés : cette connaissance n’est pas prise en compte pour cet exemple.</span><span class="sxs-lookup"><span data-stu-id="260bd-155">It is important to note that making this server really good requires knowledge of the usage pattern for the given files: such knowledge is not assumed for this example.</span></span> <span data-ttu-id="260bd-156">Par conséquent, il s’agit d’un serveur RPC mieux conçu, mais pas d’un serveur RPC conçu de manière optimale.</span><span class="sxs-lookup"><span data-stu-id="260bd-156">Therefore, this is a better designed RPC server, but not an optimally designed RPC server.</span></span>

<span data-ttu-id="260bd-157">L’idée de cet exemple est de réduire autant d’opérations distantes que possible en une seule opération.</span><span class="sxs-lookup"><span data-stu-id="260bd-157">The idea in this example is to collapse as many remote operations into one operation as possible.</span></span> <span data-ttu-id="260bd-158">La première tentative est la suivante :</span><span class="sxs-lookup"><span data-stu-id="260bd-158">The first attempt is the following:</span></span>

``` syntax
typedef [context_handle] void *remote_file;
typedef struct
{
    long position;
    int origin;
} remote_seek_instruction;
... .
interface remote_file
{
    remote_fread(file_name, void *, size_t, size_t, [in, out] remote_file ..., BOOL CloseWhenDone, remote_seek_instruction *...);
    size_t remote_fwrite(file_name, const void *, size_t, size_t, [in, out] remote_file ..., BOOL CloseWhenDone, remote_seek_instruction *...);
}
```

<span data-ttu-id="260bd-159">Dans cet exemple, toutes les opérations sont réduites en lecture et en écriture, ce qui permet un Open facultatif sur la même opération, ainsi qu’une fermeture et une recherche facultatives.</span><span class="sxs-lookup"><span data-stu-id="260bd-159">This example collapses all operations to a read and write, which allows for an optional open on the same operation, as well as an optional close and seek.</span></span>

<span data-ttu-id="260bd-160">Cette même séquence d’opérations, lorsqu’elle est écrite sous une forme abrégée, ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="260bd-160">This same sequence of operation, when written in abbreviated form, looks like this:</span></span>

``` syntax
remote_read("c:\\sample.txt", ..., &rfp, FALSE, NULL);
remote_read(NULL, ..., &rfp, TRUE, seek_to_20_bytes_before_end);
```

<span data-ttu-id="260bd-161">Lors de l’examen du serveur RPC le mieux conçu, le deuxième appel du serveur vérifie que le *\_ nom de fichier* est **null** et utilise le fichier ouvert stocké dans l’appel d’offres.</span><span class="sxs-lookup"><span data-stu-id="260bd-161">When considering the better designed RPC server, on the second call the server checks that the *file\_name* is **NULL**, and uses the stored open file in rfp.</span></span> <span data-ttu-id="260bd-162">Il voit ensuite les instructions de recherche et place le pointeur de fichier 20 octets avant la fin avant de lire.</span><span class="sxs-lookup"><span data-stu-id="260bd-162">Then it sees there are seek instructions, and will position the file pointer 20 bytes before the end before it reads.</span></span> <span data-ttu-id="260bd-163">Une fois terminé, il reconnaît que l’indicateur **CloseWhenDone** est défini sur **true** et ferme le fichier, puis ferme l’appel d’offres.</span><span class="sxs-lookup"><span data-stu-id="260bd-163">When done, it will recognize the **CloseWhenDone** flag is set to **TRUE**, and will close the file, and close rfp.</span></span>

<span data-ttu-id="260bd-164">Sur le réseau à latence élevée, cette version améliorée prend 10 secondes pour s’exécuter (2,5 fois plus vite) et nécessite le traitement de seulement quatre paquets. deux réceptions du serveur et deux envois à partir du serveur.</span><span class="sxs-lookup"><span data-stu-id="260bd-164">On the high latency network, this better version takes 10 seconds to complete (2.5 times faster) and requires processing of only four packets; two receives from the server, and two sends from the server.</span></span> <span data-ttu-id="260bd-165">Le *IFS* supplémentaire et le démarshaling du serveur sont négligeables par rapport à tout le reste.</span><span class="sxs-lookup"><span data-stu-id="260bd-165">The extra *ifs* and unmarshaling the server performs are negligible compared to everything else.</span></span>

<span data-ttu-id="260bd-166">Si le classement de causalité est correctement spécifié, l’interface peut même être rendue asynchrone et les deux appels peuvent être envoyés en parallèle.</span><span class="sxs-lookup"><span data-stu-id="260bd-166">If causal ordering is specified properly, the interface can even be made asynchronous, and the two calls can be sent in parallel.</span></span> <span data-ttu-id="260bd-167">Lorsque le classement de causalité est utilisé, les appels sont toujours distribués dans l’ordre, ce qui signifie que sur le réseau à latence élevée, seul un délai de cinq secondes est écoulé, même si le nombre de paquets envoyés et reçus est le même.</span><span class="sxs-lookup"><span data-stu-id="260bd-167">When causal ordering is used calls are still dispatched in order, which means on the high latency network only a five-second delay is endured, even though the number of packets sent and received is the same.</span></span>

<span data-ttu-id="260bd-168">Nous pouvons le réduire encore plus loin en créant une méthode qui prend un tableau de structures, chaque membre du tableau décrivant une opération de fichier particulière ; variation distante des e/s de ventilation/regroupement.</span><span class="sxs-lookup"><span data-stu-id="260bd-168">We can collapse this even further by creating one method that takes an array of structures, each member of the array describing a particular file operation; a remote variation of scatter/gather I/O.</span></span> <span data-ttu-id="260bd-169">L’approche s’acquitte du fait que le résultat de chaque opération ne nécessite pas de traitement supplémentaire sur le client ; en d’autres termes, l’application va lire les 20 octets à la fin, quel que soit le niveau de lecture des 20 premiers octets.</span><span class="sxs-lookup"><span data-stu-id="260bd-169">The approach pays off as long as the result of each operation does not require further processing on the client; in other words the application is going to read the 20 bytes at the end regardless of what the first 20 bytes read are.</span></span>

<span data-ttu-id="260bd-170">Toutefois, si un traitement doit être effectué sur les 20 premiers octets après les avoir lus pour déterminer l’opération suivante, la réduction de tout en une opération ne fonctionne pas (au moins dans tous les cas).</span><span class="sxs-lookup"><span data-stu-id="260bd-170">However, if some processing must be performed on the first 20 bytes after reading them to determine the next operation, collapsing everything into one operation does not work (at least not in all cases).</span></span> <span data-ttu-id="260bd-171">L’élégance du RPC est qu’une application peut avoir les deux méthodes dans l’interface et appeler l’une ou l’autre des méthodes en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="260bd-171">The elegance of RPC is that an application can have both methods in the interface, and call either method depending on need.</span></span>

<span data-ttu-id="260bd-172">En général, lorsque le réseau est impliqué, il est préférable de combiner autant d’appels que possible dans un appel unique.</span><span class="sxs-lookup"><span data-stu-id="260bd-172">In general, when the network is involved it is best to combine as many calls onto a single call as possible.</span></span> <span data-ttu-id="260bd-173">Si une application a deux activités indépendantes, utilisez des opérations asynchrones et laissez-les s’exécuter en parallèle.</span><span class="sxs-lookup"><span data-stu-id="260bd-173">If an application has two independent activities, use asynchronous operations and let them run in parallel.</span></span> <span data-ttu-id="260bd-174">Pour l’essentiel, gardez le pipeline complet.</span><span class="sxs-lookup"><span data-stu-id="260bd-174">Essentially, keep the pipeline full.</span></span>

 

 




