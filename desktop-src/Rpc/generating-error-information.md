---
title: Génération des informations d’erreur
description: Si un serveur ou une application rencontre une erreur irrécupérable lors de son appel via RPC, elle doit indiquer à l’exécution RPC qu’elle a rencontré un échec, et idéalement, doit ajouter des informations sur l’échec pour faciliter le dépannage.
ms.assetid: 6658c387-94df-4d85-9749-53858f9e0f5f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1b06a13e932034e6840479443e0b78f4c322c0b3
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "106509383"
---
# <a name="generating-error-information"></a><span data-ttu-id="52932-103">Génération des informations d’erreur</span><span class="sxs-lookup"><span data-stu-id="52932-103">Generating Error Information</span></span>

<span data-ttu-id="52932-104">Si un serveur ou une application rencontre une erreur irrécupérable lors de son appel via RPC, elle doit indiquer à l’exécution RPC qu’elle a rencontré un échec, et idéalement, doit ajouter des informations sur l’échec pour faciliter le dépannage.</span><span class="sxs-lookup"><span data-stu-id="52932-104">If a server or application encounters a fatal error while being called through RPC, it should indicate to the RPC run time that it has encountered a failure, and ideally, should add information about the failure to facilitate troubleshooting.</span></span>

## <a name="indicating-fatal-errors-to-the-rpc-run-time"></a><span data-ttu-id="52932-105">Indication des erreurs irrécupérables au moment de l’exécution RPC</span><span class="sxs-lookup"><span data-stu-id="52932-105">Indicating Fatal Errors to the RPC Run Time</span></span>

<span data-ttu-id="52932-106">Pour indiquer un échec au moment de l’exécution RPC, appelez la fonction [**RpcRaiseException**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) sur le thread RPC sur lequel l’exception a été appelée, ou [**RpcAsyncAbortCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) si le traitement de l’appel est asynchrone sur un autre thread.</span><span class="sxs-lookup"><span data-stu-id="52932-106">To indicate a failure to the RPC run time, call the [**RpcRaiseException**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) function while on the RPC thread the exception was called on, or [**RpcAsyncAbortCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) if processing the call asynchronously on another thread.</span></span> <span data-ttu-id="52932-107">Le renvoi d’un code d’erreur à partir de la routine du serveur, tel que la routine du gestionnaire, n’est pas suffisant, conformément à la spécification RPC, la valeur de retour de la fonction n’a aucune sémantique d’erreur sur le serveur, quels que soient les paramètres de fichier IDL/ACF.</span><span class="sxs-lookup"><span data-stu-id="52932-107">Returning an error code from the server routine, such as the manager routine, is not sufficient—according to the RPC specification, the return value of the function has no error semantics on the server, regardless of the idl/acf file settings.</span></span>

<span data-ttu-id="52932-108">Lorsqu’une erreur irrécupérable se produit dans votre composant, effectuez tout nettoyage jugé nécessaire, puis appelez la fonction [**RpcRaiseException**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) avec le code d’erreur.</span><span class="sxs-lookup"><span data-stu-id="52932-108">When a fatal error occurs in your component, perform any cleanup deemed necessary and then call the [**RpcRaiseException**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) function with the error code.</span></span> <span data-ttu-id="52932-109">La seule différence entre **RpcRaiseException** et le renvoi d’un code d’erreur est lorsque le **RpcRaiseException** est appelé, les paramètres out ne sont pas marshalés.</span><span class="sxs-lookup"><span data-stu-id="52932-109">The only difference between **RpcRaiseException** and returning an error code is when the **RpcRaiseException** is called, the out parameters are not marshaled.</span></span> <span data-ttu-id="52932-110">C’est généralement un avantage, puisque l’évitement des paramètres non initialisés n’est pas nécessaire.</span><span class="sxs-lookup"><span data-stu-id="52932-110">This is usually an advantage, since avoiding uninitialized out parameters becomes unnecessary.</span></span>

## <a name="generating-additional-extended-error-information"></a><span data-ttu-id="52932-111">Génération d’informations d’erreur étendues supplémentaires</span><span class="sxs-lookup"><span data-stu-id="52932-111">Generating Additional Extended Error Information</span></span>

<span data-ttu-id="52932-112">Tout comme l’exécution RPC génère une chaîne d’enregistrements d’erreur, votre serveur ou votre application peut ajouter ses propres enregistrements à la chaîne.</span><span class="sxs-lookup"><span data-stu-id="52932-112">Just as the RPC run time builds a chain of error records, your server or application can add its own records to the chain.</span></span> <span data-ttu-id="52932-113">Cette approche est souvent utile dans le processus de résolution des problèmes.</span><span class="sxs-lookup"><span data-stu-id="52932-113">This approach often helps in the troubleshooting process.</span></span> <span data-ttu-id="52932-114">Par exemple, un serveur peut tenter d’ouvrir un fichier donné et de recevoir une erreur fichier introuvable.</span><span class="sxs-lookup"><span data-stu-id="52932-114">For example, a server may attempt to open a given file and receive a file not found error.</span></span> <span data-ttu-id="52932-115">Il n’est pas utile de renvoyer simplement l’erreur 2 pour déterminer quel fichier est manquant.</span><span class="sxs-lookup"><span data-stu-id="52932-115">Simply returning error 2 would not be helpful in determining which file is missing.</span></span>

<span data-ttu-id="52932-116">Au lieu de cela, votre serveur peut appeler la fonction [**RpcErrorAddRecord**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) et fournir un paramètre de chaîne, ANSI ou Unicode, dans l’enregistrement d’erreur indiquant le chemin d’accès complet au fichier qu’il recherchait.</span><span class="sxs-lookup"><span data-stu-id="52932-116">Instead, your server could call the [**RpcErrorAddRecord**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) function and provide a string parameter, either ANSI or Unicode, in the error record indicating the full path of the file it was looking for.</span></span> <span data-ttu-id="52932-117">Lorsque toutes ces informations s’affichent sur l’écran de l’utilisateur sur un ordinateur distant, le dépannage devient trivial. une vérification simple de l’existence du fichier peut être effectuée, en particulier dans la mesure où le nom de l’ordinateur en question est déjà fourni par l’exécution RPC.</span><span class="sxs-lookup"><span data-stu-id="52932-117">When all this information appears on the user screen on a remote computer, troubleshooting becomes trivial; a simple check of whether the file exists can be done, especially since the name of the computer in question is already provided by the RPC run time.</span></span>

<span data-ttu-id="52932-118">L’appel de fonction [**RpcErrorAddRecord**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) peut échouer si la mémoire disponible n’est pas suffisante, même s’il ne nécessite que quelques octets d’espace de tas.</span><span class="sxs-lookup"><span data-stu-id="52932-118">The [**RpcErrorAddRecord**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) function call may fail if enough memory is not available, even though it requires only a few bytes of heap space.</span></span> <span data-ttu-id="52932-119">En outre, les enregistrements ajoutés par **RpcErrorAddRecord** s’accumulent dans un thread donné.</span><span class="sxs-lookup"><span data-stu-id="52932-119">Also, records added by **RpcErrorAddRecord** accumulate in a given thread.</span></span> <span data-ttu-id="52932-120">Le runtime nettoie normalement ces enregistrements avant d’appeler votre routine de serveur. Toutefois, si des informations d’erreur étendues sont utilisées en dehors de RPC, effectuez le nettoyage de l’erreur étendue accumulée dans le thread en appelant [**RpcErrorClearInformation**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerrorclearinformation).</span><span class="sxs-lookup"><span data-stu-id="52932-120">The runtime normally cleans those records up before it calls your server routine, but if extended error information is used outside RPC, take care of cleaning up the accumulated extended error in the thread by calling [**RpcErrorClearInformation**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerrorclearinformation).</span></span>

 

 




