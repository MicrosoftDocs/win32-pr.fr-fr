---
title: Gestion des erreurs (RPC)
description: Dans RPC synchrone, un client effectue un appel distant qui retourne avec un code de réussite ou d’échec.
ms.assetid: 7dfc9f84-ce3c-49f3-8f72-b212095133fd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 017892b94438cc73f88cbfe60c03c088bf3ebcc9
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/10/2020
ms.locfileid: "104032264"
---
# <a name="error-handling-rpc"></a><span data-ttu-id="f57ed-103">Gestion des erreurs (RPC)</span><span class="sxs-lookup"><span data-stu-id="f57ed-103">Error Handling (RPC)</span></span>

<span data-ttu-id="f57ed-104">Dans RPC synchrone, un client effectue un appel distant qui retourne avec un code de réussite ou d’échec.</span><span class="sxs-lookup"><span data-stu-id="f57ed-104">In synchronous RPC, a client makes a remote call that returns with either a success or failure code.</span></span> <span data-ttu-id="f57ed-105">Le RPC asynchrone offre davantage d’opportunités d’échec de l’appel, et ces échecs sont gérés différemment, en fonction de l’endroit et du moment où ils se produisent.</span><span class="sxs-lookup"><span data-stu-id="f57ed-105">Asynchronous RPC provides more opportunities for a call to fail, and these failures are handled differently, depending on where and when they occur.</span></span> <span data-ttu-id="f57ed-106">Le tableau suivant décrit les manières dont un appel peut échouer et comment il est géré.</span><span class="sxs-lookup"><span data-stu-id="f57ed-106">The following table describes the ways in which a call can fail, and how it is handled.</span></span>

## <a name="client-side-cleanup"></a><span data-ttu-id="f57ed-107">Nettoyage côté client</span><span class="sxs-lookup"><span data-stu-id="f57ed-107">Client-side Cleanup</span></span>



| <span data-ttu-id="f57ed-108">Symptôme de l’échec</span><span class="sxs-lookup"><span data-stu-id="f57ed-108">Failure symptom</span></span>                                                                                                                                  | <span data-ttu-id="f57ed-109">Nettoyage</span><span class="sxs-lookup"><span data-stu-id="f57ed-109">Cleanup</span></span>                                                                                                                         |
|--------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="f57ed-110">Le client intercepte une exception lorsqu’il appelle la procédure distante.</span><span class="sxs-lookup"><span data-stu-id="f57ed-110">Client catches an exception when it calls the remote procedure.</span></span>                                                                                  | <span data-ttu-id="f57ed-111">Aucun appel d’API RPC n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="f57ed-111">No RPC API calls are necessary.</span></span> <span data-ttu-id="f57ed-112">Tous les États RPC ont été nettoyés.</span><span class="sxs-lookup"><span data-stu-id="f57ed-112">All RPC state has been cleaned up.</span></span>                                                              |
| <span data-ttu-id="f57ed-113">Le client reçoit une notification d’appel terminé, mais lorsqu’il appelle [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall), il reçoit un code d’erreur.</span><span class="sxs-lookup"><span data-stu-id="f57ed-113">Client receives a call complete notification, but when it calls [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall), it receives an error code.</span></span> | <span data-ttu-id="f57ed-114">Aucun appel d’API RPC n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="f57ed-114">No RPC API calls are necessary.</span></span> <span data-ttu-id="f57ed-115">Tous les États RPC ont été nettoyés.</span><span class="sxs-lookup"><span data-stu-id="f57ed-115">All RPC state has been cleaned up.</span></span>                                                              |
| <span data-ttu-id="f57ed-116">Le client émet des problèmes de non-abandon ou d’annulation abandonnée.</span><span class="sxs-lookup"><span data-stu-id="f57ed-116">Client issues non-abortive or abortive cancel.</span></span>                                                                                                   | <span data-ttu-id="f57ed-117">Le client doit attendre la notification et appeler [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) quand la notification arrive.</span><span class="sxs-lookup"><span data-stu-id="f57ed-117">Client must wait for notification, and call [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) when the notification arrives.</span></span> |



 

<span data-ttu-id="f57ed-118">Dans le nettoyage côté serveur, un concept clé est le point de déconnexion.</span><span class="sxs-lookup"><span data-stu-id="f57ed-118">In server side cleanup, a key concept is the hand-off point.</span></span> <span data-ttu-id="f57ed-119">Pendant le traitement côté serveur d’un appel asynchrone, un traitement est généralement effectué sur le thread qui a reçu l’appel (également appelé *thread de répartiteur*), puis, éventuellement, le thread de répartiteur place un état suffisant dans un bloc de mémoire et signale un autre thread (également appelé thread de *travail*) pour poursuivre le traitement de l’appel.</span><span class="sxs-lookup"><span data-stu-id="f57ed-119">During the server side processing of an asynchronous call, some processing is usually performed on the thread that received the call (also known as the *dispatcher thread*), and then, optionally, the dispatcher thread puts enough state into a memory block and signals another thread (also known as *worker thread*) to continue processing for the call.</span></span> <span data-ttu-id="f57ed-120">Moment auquel le thread du répartiteur signale correctement que le thread de travail est appelé *point de déconnexion*.</span><span class="sxs-lookup"><span data-stu-id="f57ed-120">The moment at which the dispatcher thread successfully signals that the worker thread is called the *hand-off point*.</span></span>

## <a name="server-side-cleanup"></a><span data-ttu-id="f57ed-121">Nettoyage côté serveur</span><span class="sxs-lookup"><span data-stu-id="f57ed-121">Server Side Cleanup</span></span>



| <span data-ttu-id="f57ed-122">Erreur rencontrée</span><span class="sxs-lookup"><span data-stu-id="f57ed-122">Error encountered</span></span>      | <span data-ttu-id="f57ed-123">Nettoyage</span><span class="sxs-lookup"><span data-stu-id="f57ed-123">Cleanup</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="f57ed-124">Avant le point d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="f57ed-124">Before hand-off point.</span></span> | <span data-ttu-id="f57ed-125">Lever une exception.</span><span class="sxs-lookup"><span data-stu-id="f57ed-125">Throw exception.</span></span> <span data-ttu-id="f57ed-126">Aucun appel à [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="f57ed-126">No call to [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) is necessary.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="f57ed-127">Après le point d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="f57ed-127">After hand-off point.</span></span>  | <span data-ttu-id="f57ed-128">Appelez [**RpcAsyncAbortCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) ou, si l’erreur n’est pas fatale et que les résultats peuvent toujours être retournés au client, [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall).</span><span class="sxs-lookup"><span data-stu-id="f57ed-128">Call [**RpcAsyncAbortCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) or, if the error is not fatal and results can still be returned to the client, [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall).</span></span> <span data-ttu-id="f57ed-129">Si l’appel de fonction **RpcAsyncCompleteCall** échoue, le runtime RPC libère les paramètres.</span><span class="sxs-lookup"><span data-stu-id="f57ed-129">If the **RpcAsyncCompleteCall** function call fails, the RPC runtime frees the parameters.</span></span> <span data-ttu-id="f57ed-130">L’utilisateur ne doit pas accéder à ces paramètres.</span><span class="sxs-lookup"><span data-stu-id="f57ed-130">The user must not access those parameters.</span></span> <span data-ttu-id="f57ed-131">Le thread du répartiteur ne doit pas effectuer de traitement substantiel qui peut échouer après le point de déconnexion, car il ne peut plus abandonner l’appel en toute sécurité.</span><span class="sxs-lookup"><span data-stu-id="f57ed-131">The dispatcher thread must not perform any substantial processing that may fail after the hand off point, because it no longer can safely abort the call.</span></span> <span data-ttu-id="f57ed-132">Plus précisément, il ne doit pas lever d’exception après le point de désactivation de la main, ou le serveur peut se bloquer.</span><span class="sxs-lookup"><span data-stu-id="f57ed-132">Specifically, it must not throw an exception after the hand off point, or the server may crash.</span></span> |



 

## <a name="special-error-handling-cases-for-pipes"></a><span data-ttu-id="f57ed-133">Cas spéciaux de gestion des erreurs pour les canaux</span><span class="sxs-lookup"><span data-stu-id="f57ed-133">Special Error Handling Cases for Pipes</span></span>

<span data-ttu-id="f57ed-134">Il existe des cas spéciaux pour la gestion des erreurs lors de l’utilisation de canaux.</span><span class="sxs-lookup"><span data-stu-id="f57ed-134">There are special cases for error handling when using pipes.</span></span> <span data-ttu-id="f57ed-135">La liste suivante explique la source de l’échec et comment gérer l’erreur.</span><span class="sxs-lookup"><span data-stu-id="f57ed-135">The following list explains the source of the failure, and how to handle the error.</span></span>



| <span data-ttu-id="f57ed-136">Source de l’échec</span><span class="sxs-lookup"><span data-stu-id="f57ed-136">Source of failure</span></span>                                                                                                 | <span data-ttu-id="f57ed-137">Mode de traitement</span><span class="sxs-lookup"><span data-stu-id="f57ed-137">How handled</span></span>                                                                                                |
|-------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="f57ed-138">Le client appelle push et l’appel échoue.</span><span class="sxs-lookup"><span data-stu-id="f57ed-138">Client calls push and the call fails.</span></span>                                                                             | <span data-ttu-id="f57ed-139">Aucun appel d’API RPC n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="f57ed-139">No RPC API calls are necessary.</span></span> <span data-ttu-id="f57ed-140">Tous les États RPC ont été nettoyés.</span><span class="sxs-lookup"><span data-stu-id="f57ed-140">All RPC state has been cleaned up.</span></span>                                         |
| <span data-ttu-id="f57ed-141">Le client appelle [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) avant le [**drainage des canaux**](/windows/desktop/Midl/in) .</span><span class="sxs-lookup"><span data-stu-id="f57ed-141">Client calls [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) before the [**in**](/windows/desktop/Midl/in) pipes are drained.</span></span> | <span data-ttu-id="f57ed-142">L’appel échoue avec le code d’erreur de remplissage de canal approprié.</span><span class="sxs-lookup"><span data-stu-id="f57ed-142">Call fails with the appropriate pipe-filling error code.</span></span>                                                   |
| <span data-ttu-id="f57ed-143">Les appels clients sont extraits et l’appel échoue.</span><span class="sxs-lookup"><span data-stu-id="f57ed-143">Client calls pull and the call fails.</span></span>                                                                             | <span data-ttu-id="f57ed-144">Aucun appel d’API RPC n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="f57ed-144">No RPC API calls are necessary.</span></span> <span data-ttu-id="f57ed-145">Tous les États RPC ont été nettoyés.</span><span class="sxs-lookup"><span data-stu-id="f57ed-145">All RPC state has been cleaned up.</span></span>                                         |
| <span data-ttu-id="f57ed-146">Le client ou le serveur appelle une commande Push ou pull dans le mauvais ordre.</span><span class="sxs-lookup"><span data-stu-id="f57ed-146">Either client or server calls push or pull in the wrong order.</span></span>                                                    | <span data-ttu-id="f57ed-147">Le runtime retourne l’état de l’erreur de remplissage du canal.</span><span class="sxs-lookup"><span data-stu-id="f57ed-147">Run-time returns pipe-filling error status.</span></span>                                                                |
| <span data-ttu-id="f57ed-148">Le serveur appelle push ou pull et l’appel échoue.</span><span class="sxs-lookup"><span data-stu-id="f57ed-148">Server calls push or pull and the call fails.</span></span>                                                                     | <span data-ttu-id="f57ed-149">Push retourne un code d’échec.</span><span class="sxs-lookup"><span data-stu-id="f57ed-149">Push returns a failure code.</span></span> <span data-ttu-id="f57ed-150">Aucun appel à [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="f57ed-150">No call to [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) is necessary.</span></span> |
| <span data-ttu-id="f57ed-151">Le serveur appelle **RpcAsyncCompleteCall** avant que les canaux n’aient été drainés.</span><span class="sxs-lookup"><span data-stu-id="f57ed-151">Server calls **RpcAsyncCompleteCall** before the pipes have been drained.</span></span>                                         | <span data-ttu-id="f57ed-152">L’appel de canal retourne un état d’erreur de remplissage de canal.</span><span class="sxs-lookup"><span data-stu-id="f57ed-152">The pipe call returns a pipe filling error status.</span></span>                                                         |
| <span data-ttu-id="f57ed-153">Après la distribution, une opération de réception échoue.</span><span class="sxs-lookup"><span data-stu-id="f57ed-153">After the dispatch, a receive operation fails.</span></span>                                                                    | <span data-ttu-id="f57ed-154">La prochaine fois que le serveur appelle pull pour recevoir les données de canal, une erreur est retournée.</span><span class="sxs-lookup"><span data-stu-id="f57ed-154">The next time the server calls pull to receive pipe data, an error is returned.</span></span>                            |



 

 

 
