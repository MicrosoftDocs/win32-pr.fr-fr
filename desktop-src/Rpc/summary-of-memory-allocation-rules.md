---
title: Résumé des règles d’allocation de mémoire
description: Le tableau suivant récapitule les principales règles relatives à l’allocation de mémoire.
ms.assetid: 0c1f8398-75e6-45ec-a9f9-9dcdbe21c24d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6f9403bb5057b2004d966c0634bc101a3282fe92
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104102008"
---
# <a name="summary-of-memory-allocation-rules"></a><span data-ttu-id="cb04c-103">Résumé des règles d’allocation de mémoire</span><span class="sxs-lookup"><span data-stu-id="cb04c-103">Summary of Memory Allocation Rules</span></span>

<span data-ttu-id="cb04c-104">Le tableau suivant récapitule les principales règles relatives à l’allocation de mémoire.</span><span class="sxs-lookup"><span data-stu-id="cb04c-104">The following table summarizes key rules regarding memory allocation.</span></span>



| <span data-ttu-id="cb04c-105">Élément MIDL</span><span class="sxs-lookup"><span data-stu-id="cb04c-105">MIDL element</span></span>                                                                                                                                           | <span data-ttu-id="cb04c-106">Description</span><span class="sxs-lookup"><span data-stu-id="cb04c-106">Description</span></span>                                                                                                                                                           |
|--------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="cb04c-107">Pointeurs de \[ [référence](/windows/desktop/Midl/ref) de niveau supérieur \]</span><span class="sxs-lookup"><span data-stu-id="cb04c-107">Top-level \[ [ref](/windows/desktop/Midl/ref)\] pointers</span></span>                                                                                                                | <span data-ttu-id="cb04c-108">Il doit s’agir de pointeurs non null.</span><span class="sxs-lookup"><span data-stu-id="cb04c-108">Must be non-null pointers.</span></span>                                                                                                                                            |
| <span data-ttu-id="cb04c-109">Valeur de retour de la fonction</span><span class="sxs-lookup"><span data-stu-id="cb04c-109">Function return value</span></span>                                                                                                                                  | <span data-ttu-id="cb04c-110">La nouvelle mémoire est toujours allouée pour les valeurs de retour de pointeur.</span><span class="sxs-lookup"><span data-stu-id="cb04c-110">New memory is always allocated for pointer return values.</span></span>                                                                                                             |
| <span data-ttu-id="cb04c-111">\[pointeur [unique](/windows/desktop/Midl/unique), de [sortie](/windows/desktop/Midl/out-idl) \] ou \[ [ptr](/windows/desktop/Midl/ptr), point de sortie \]</span><span class="sxs-lookup"><span data-stu-id="cb04c-111">\[ [unique](/windows/desktop/Midl/unique), [out](/windows/desktop/Midl/out-idl)\] or \[ [ptr](/windows/desktop/Midl/ptr), out\] pointer</span></span>                                                                   | <span data-ttu-id="cb04c-112">Non autorisé par MIDL.</span><span class="sxs-lookup"><span data-stu-id="cb04c-112">Not allowed by MIDL.</span></span>                                                                                                                                                  |
| <span data-ttu-id="cb04c-113">Pointeur non-de niveau \[ [supérieur](/windows/desktop/Midl/unique), [in](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl) \] ou \[ [ptr](/windows/desktop/Midl/ptr), in, out \] qui passe de null à non null</span><span class="sxs-lookup"><span data-stu-id="cb04c-113">Non-top-level \[[unique](/windows/desktop/Midl/unique), [in](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl)\] or \[[ptr](/windows/desktop/Midl/ptr), in, out\] pointer that changes from null to non-null</span></span> | <span data-ttu-id="cb04c-114">Les stubs client allouent une nouvelle mémoire sur le client au retour.</span><span class="sxs-lookup"><span data-stu-id="cb04c-114">Client stubs allocate new memory on client on return.</span></span>                                                                                                                 |
| <span data-ttu-id="cb04c-115">\[Pointeur de [sortie](/windows/desktop/Midl/out-idl) [unique](/windows/desktop/Midl/unique), [de](/windows/desktop/Midl/in)niveau non supérieur, \] qui change de non null en null</span><span class="sxs-lookup"><span data-stu-id="cb04c-115">Non-top-level \[[unique](/windows/desktop/Midl/unique), [in](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl)\] pointer that changes from non-null to null</span></span>                                 | <span data-ttu-id="cb04c-116">La mémoire est orpheline sur le client ; l’application cliente est chargée de libérer de la mémoire et d’éviter les fuites.</span><span class="sxs-lookup"><span data-stu-id="cb04c-116">Memory is orphaned on client; client application is responsible for freeing memory and preventing leaks.</span></span>                                                              |
| <span data-ttu-id="cb04c-117">\[Pointeur de sortie [ptr](/windows/desktop/Midl/ptr), [in](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl) de niveau supérieur \] qui passe de non null à null</span><span class="sxs-lookup"><span data-stu-id="cb04c-117">Non-top-level \[[ptr](/windows/desktop/Midl/ptr), [in](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl)\] pointer that changes from non-null to null</span></span>                                       | <span data-ttu-id="cb04c-118">La mémoire sera orpheline sur le client s’il n’a pas d’alias ; dans ce cas, l’application cliente est chargée de libérer et d’éviter les fuites de mémoire.</span><span class="sxs-lookup"><span data-stu-id="cb04c-118">Memory will be orphaned on client if not aliased; client application is responsible for freeing and preventing memory leaks in this case.</span></span>                             |
| <span data-ttu-id="cb04c-119">\[[référence](/windows/desktop/Midl/ref) \] pointeurs</span><span class="sxs-lookup"><span data-stu-id="cb04c-119">\[[ref](/windows/desktop/Midl/ref)\] pointers</span></span>                                                                                                                           | <span data-ttu-id="cb04c-120">Client-la couche application est généralement allouée.</span><span class="sxs-lookup"><span data-stu-id="cb04c-120">Client-application layer usually allocates.</span></span>                                                                                                                           |
| <span data-ttu-id="cb04c-121">Pointeur non null \[ [dans](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl) \]</span><span class="sxs-lookup"><span data-stu-id="cb04c-121">Non-null \[[in](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl)\] pointer</span></span>                                                                                                | <span data-ttu-id="cb04c-122">Les stubs essaient d’écrire dans le stockage existant sur le client.</span><span class="sxs-lookup"><span data-stu-id="cb04c-122">Stubs attempt to write into existing storage on client.</span></span> <span data-ttu-id="cb04c-123">Si la taille de **\[ chaîne \]** et de taille augmente au-delà de la taille allouée sur le client, elle provoque une erreur GP au retour.</span><span class="sxs-lookup"><span data-stu-id="cb04c-123">If **\[string\]** and size increases beyond size allocated on the client, it will cause a GP-fault on return.</span></span> |



 

<span data-ttu-id="cb04c-124">Le tableau suivant récapitule les effets des attributs IDL de clé et ACF sur la gestion de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="cb04c-124">The following table summarizes the effects of key IDL and ACF attributes on memory management.</span></span>



| <span data-ttu-id="cb04c-125">Fonctionnalité MIDL</span><span class="sxs-lookup"><span data-stu-id="cb04c-125">MIDL feature</span></span>                                                                   | <span data-ttu-id="cb04c-126">Problèmes de clients</span><span class="sxs-lookup"><span data-stu-id="cb04c-126">Client issues</span></span>                                                                                                                                  | <span data-ttu-id="cb04c-127">Problèmes de serveur</span><span class="sxs-lookup"><span data-stu-id="cb04c-127">Server issues</span></span>                                                                                                                 |
|--------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="cb04c-128">\[[allocate](/windows/desktop/Midl/allocate)( \_ nœud unique) \] , \[ allocate (tous les \_ nœuds)\]</span><span class="sxs-lookup"><span data-stu-id="cb04c-128">\[ [allocate](/windows/desktop/Midl/allocate)(single\_node)\], \[allocate(all\_nodes)\]</span></span>         | <span data-ttu-id="cb04c-129">Détermine si un ou plusieurs appels sont effectués aux fonctions de mémoire.</span><span class="sxs-lookup"><span data-stu-id="cb04c-129">Determines whether one or many calls are made to the memory functions.</span></span>                                                                         | <span data-ttu-id="cb04c-130">Identique au client, à la différence que la mémoire privée peut souvent être utilisée pour l’allocation ( \_ nœud unique) \[ dans \] et \[ dans, les données de sortie \] .</span><span class="sxs-lookup"><span data-stu-id="cb04c-130">Same as client, except private memory can often be used for allocate (single\_node) \[in\] and \[in,out\] data.</span></span>               |
| <span data-ttu-id="cb04c-131">\[allouer (gratuit) \] ou \[ allouer (ne pas \_ libérer)\]</span><span class="sxs-lookup"><span data-stu-id="cb04c-131">\[allocate(free)\] or \[allocate(dont\_free)\]</span></span>                                 | <span data-ttu-id="cb04c-132">(Aucune ; affecte le serveur.)</span><span class="sxs-lookup"><span data-stu-id="cb04c-132">(None; affects server.)</span></span>                                                                                                                        | <span data-ttu-id="cb04c-133">Détermine si la mémoire sur le serveur est libérée après chaque appel de procédure distante.</span><span class="sxs-lookup"><span data-stu-id="cb04c-133">Determines whether memory on the server is freed after each remote procedure call.</span></span>                                            |
| <span data-ttu-id="cb04c-134">les attributs \[ de tableau [Max \_ sont](/windows/desktop/Midl/max-is) \] et \[ [size \_ est](/windows/desktop/Midl/size-is)\]</span><span class="sxs-lookup"><span data-stu-id="cb04c-134">array attributes \[ [max\_is](/windows/desktop/Midl/max-is)\] and \[ [size\_is](/windows/desktop/Midl/size-is)\]</span></span> | <span data-ttu-id="cb04c-135">(Aucune ; affecte le serveur.)</span><span class="sxs-lookup"><span data-stu-id="cb04c-135">(None; affects server.)</span></span>                                                                                                                        | <span data-ttu-id="cb04c-136">Détermine la taille de la mémoire à allouer.</span><span class="sxs-lookup"><span data-stu-id="cb04c-136">Determines size of memory to be allocated.</span></span>                                                                                    |
| <span data-ttu-id="cb04c-137">\[[ \_ nombre d’octets](/windows/desktop/Midl/byte-count)\]</span><span class="sxs-lookup"><span data-stu-id="cb04c-137">\[ [byte\_count](/windows/desktop/Midl/byte-count)\]</span></span>                                            | <span data-ttu-id="cb04c-138">Le client doit allouer la mémoire tampon ; non alloué ou libéré par les stubs client.</span><span class="sxs-lookup"><span data-stu-id="cb04c-138">Client must allocate buffer; not allocated or freed by client stubs.</span></span>                                                                           | <span data-ttu-id="cb04c-139">L’attribut de paramètre ACF détermine la taille de la mémoire tampon allouée sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="cb04c-139">ACF parameter attribute determines size of buffer allocated on server.</span></span>                                                        |
| <span data-ttu-id="cb04c-140">\[[activer l' \_ allocation](/windows/desktop/Midl/enable-allocate)\]</span><span class="sxs-lookup"><span data-stu-id="cb04c-140">\[ [enable\_allocate](/windows/desktop/Midl/enable-allocate)\]</span></span>                                  | <span data-ttu-id="cb04c-141">En général, aucun.</span><span class="sxs-lookup"><span data-stu-id="cb04c-141">Usually, none.</span></span> <span data-ttu-id="cb04c-142">Toutefois, le client peut utiliser un autre environnement de gestion de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="cb04c-142">However, the client may be using a different memory management environment.</span></span>                                                     | <span data-ttu-id="cb04c-143">Le serveur utilise un autre environnement de gestion de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="cb04c-143">Server uses a different memory management environment.</span></span> <span data-ttu-id="cb04c-144">[**RpcSmAllocate**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcsmallocate) doit être utilisé pour les allocations.</span><span class="sxs-lookup"><span data-stu-id="cb04c-144">[**RpcSmAllocate**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcsmallocate) should be used for allocations.</span></span> |
| <span data-ttu-id="cb04c-145">\[[dans](/windows/desktop/Midl/in) \] attribut</span><span class="sxs-lookup"><span data-stu-id="cb04c-145">\[ [in](/windows/desktop/Midl/in)\]attribute</span></span>                                                    | <span data-ttu-id="cb04c-146">Application cliente chargée d’allouer de la mémoire pour les données.</span><span class="sxs-lookup"><span data-stu-id="cb04c-146">Client application responsible for allocating memory for data.</span></span>                                                                                 | <span data-ttu-id="cb04c-147">Alloué sur le serveur par stubs.</span><span class="sxs-lookup"><span data-stu-id="cb04c-147">Allocated on server by stubs.</span></span>                                                                                                 |
| <span data-ttu-id="cb04c-148">\[en [sortie](/windows/desktop/Midl/out-idl) \] attribut</span><span class="sxs-lookup"><span data-stu-id="cb04c-148">\[ [out](/windows/desktop/Midl/out-idl)\] attribute</span></span>                                             | <span data-ttu-id="cb04c-149">Alloué sur le client par stubs.</span><span class="sxs-lookup"><span data-stu-id="cb04c-149">Allocated on client by stubs.</span></span>                                                                                                                  | <span data-ttu-id="cb04c-150">\[en [sortie](/windows/desktop/Midl/out-idl) \] -seul le pointeur doit être un \[ [](/windows/desktop/Midl/ref) \] pointeur Ref ; alloué sur le serveur par stubs.</span><span class="sxs-lookup"><span data-stu-id="cb04c-150">\[[out](/windows/desktop/Midl/out-idl)\]-only pointer must be \[[ref](/windows/desktop/Midl/ref)\] pointer; allocated on server by stubs.</span></span>                       |
| <span data-ttu-id="cb04c-151">\[[référence](/windows/desktop/Midl/ref) \] attribut</span><span class="sxs-lookup"><span data-stu-id="cb04c-151">\[ [ref](/windows/desktop/Midl/ref)\] attribute</span></span>                                                 | <span data-ttu-id="cb04c-152">La mémoire référencée par le pointeur doit être allouée par l’application cliente.</span><span class="sxs-lookup"><span data-stu-id="cb04c-152">Memory referenced by pointer must be allocated by client application.</span></span>                                                                          | <span data-ttu-id="cb04c-153">Pointeurs de référence de niveau supérieur et de premier niveau gérés par des stubs.</span><span class="sxs-lookup"><span data-stu-id="cb04c-153">Top-level and first-level reference pointers managed by stubs.</span></span>                                                                |
| <span data-ttu-id="cb04c-154">\[[unique](/windows/desktop/Midl/unique) \] attribut</span><span class="sxs-lookup"><span data-stu-id="cb04c-154">\[ [unique](/windows/desktop/Midl/unique)\] attribute</span></span>                                           | <span data-ttu-id="cb04c-155">Une valeur non null pour null peut entraîner une mémoire orpheline ; NULL avec une valeur non null provoque l’appel par le stub client pour appeler l' [ \_ \_ allocation d’utilisateur MIDL](/windows/desktop/Midl/midl-user-allocate-1).</span><span class="sxs-lookup"><span data-stu-id="cb04c-155">Non-null to null can result in orphaned memory; null to non-null causes client stub to call [midl\_user\_allocate](/windows/desktop/Midl/midl-user-allocate-1).</span></span> | <span data-ttu-id="cb04c-156">(Affecte le client.)</span><span class="sxs-lookup"><span data-stu-id="cb04c-156">(Affects client.)</span></span>                                                                                                             |
| <span data-ttu-id="cb04c-157">\[[pointeur](/windows/desktop/Midl/ptr) \] attribut</span><span class="sxs-lookup"><span data-stu-id="cb04c-157">\[ [ptr](/windows/desktop/Midl/ptr)\] attribute</span></span>                                                 | <span data-ttu-id="cb04c-158">(Voir \[ [unique](/windows/desktop/Midl/unique) \] .)</span><span class="sxs-lookup"><span data-stu-id="cb04c-158">(See \[ [unique](/windows/desktop/Midl/unique)\].)</span></span>                                                                                                              | <span data-ttu-id="cb04c-159">(Voir \[ [unique](/windows/desktop/Midl/unique) \] .)</span><span class="sxs-lookup"><span data-stu-id="cb04c-159">(See \[ [unique](/windows/desktop/Midl/unique)\].)</span></span>                                                                                             |



 

 

 