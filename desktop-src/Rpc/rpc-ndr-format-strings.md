---
title: Chaînes de format de NDR RPC
description: Chaînes de format de NDR de l’appel de procédure distante (RPC).
ms.assetid: 9c83a039-49d3-491d-8110-29d1548730de
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cf0569a913d6c5a4b19b342cc288d6a8682dfc4a
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103842662"
---
# <a name="rpc-ndr-format-strings"></a><span data-ttu-id="3cb42-103">Chaînes de format de NDR RPC</span><span class="sxs-lookup"><span data-stu-id="3cb42-103">RPC NDR Format Strings</span></span>

## <a name="ndr-engine-32-bit-interpreter"></a><span data-ttu-id="3cb42-104">Moteur de NDR : interprète 32 bits</span><span class="sxs-lookup"><span data-stu-id="3cb42-104">NDR Engine: 32-bit Interpreter</span></span>

<span data-ttu-id="3cb42-105">Ce document décrit les descripteurs de chaîne de format, parfois appelés éléments MOP, pour le moteur de NDR 32 bits.</span><span class="sxs-lookup"><span data-stu-id="3cb42-105">This document describes the format string descriptors, sometimes referred to as MOPs, for the 32-bit NDR engine.</span></span> <span data-ttu-id="3cb42-106">Cette section décrit les modifications associées à l’évolution de l’interpréteur [**– OI**](/windows/desktop/Midl/-oi) à la couche d’interpréteur de la couche d' **interfaces** , ainsi que les ajouts liés aux canaux et à la prise en charge asynchrone.</span><span class="sxs-lookup"><span data-stu-id="3cb42-106">This section describes changes associated with the evolution from the [**–Oi**](/windows/desktop/Midl/-oi) interpreter to the **–Oif** interpreter layer, as well as additions related to pipes and asynchronous support.</span></span>

<span data-ttu-id="3cb42-107">Ce document décrit la technologie MIDL (Current Microsoft Interface Definition Language) du point de vue du moteur, ainsi que le moteur de NDR actuel.</span><span class="sxs-lookup"><span data-stu-id="3cb42-107">This document describes current Microsoft Interface Definition Language (MIDL) technology from the engine perspective, and the current NDR engine.</span></span>

## <a name="overview"></a><span data-ttu-id="3cb42-108">Vue d’ensemble</span><span class="sxs-lookup"><span data-stu-id="3cb42-108">Overview</span></span>

<span data-ttu-id="3cb42-109">Le moteur de NDR est le moteur de marshaling des composants RPC (Remote Procedure Call) et DCOM.</span><span class="sxs-lookup"><span data-stu-id="3cb42-109">The NDR engine is the marshaling engine of the Remote Procedure Call (RPC) and DCOM components.</span></span> <span data-ttu-id="3cb42-110">Il gère tous les problèmes liés au stub d’un appel distant.</span><span class="sxs-lookup"><span data-stu-id="3cb42-110">It handles all stub-related issues of a remote call.</span></span> <span data-ttu-id="3cb42-111">En tant que processus, le marshaling de NDR est piloté par le code C des stubs générés par MIDL, un générateur de type JIT MIDL, ou par les stubs générés par d’autres outils ou écrits manuellement.</span><span class="sxs-lookup"><span data-stu-id="3cb42-111">As a process, NDR marshaling is driven by the C code from MIDL-generated stubs, a MIDL JIT-type generator, or by stubs generated by other tools or written manually.</span></span> <span data-ttu-id="3cb42-112">À son tour, le moteur de rapport de non-remise pilote le temps d’exécution sous-jacent (DCOM ou RPC) qui communique avec des transports spécifiques.</span><span class="sxs-lookup"><span data-stu-id="3cb42-112">In turn, the NDR engine drives the underlying run time (DCOM or RPC) that communicates with specific transports.</span></span>

<span data-ttu-id="3cb42-113">L’objectif initial de la conception était de fournir un outil pour un marshaling efficace des données arbitraires, en fonction des informations fournies par le compilateur MIDL.</span><span class="sxs-lookup"><span data-stu-id="3cb42-113">The original goal of the design had been to provide a tool for effective marshaling for arbitrary data, based on information provided by the MIDL compiler.</span></span> <span data-ttu-id="3cb42-114">Les chaînes de format décrites dans ce document (et, en effet, toutes les informations générées par le compilateur pour la consommation du moteur de NDR) ont toujours été considérées comme une interface interne entre le compilateur et le moteur.</span><span class="sxs-lookup"><span data-stu-id="3cb42-114">The format strings described in this document—and indeed all information generated by the compiler for NDR engine consumption—have always been considered an internal interface between the compiler and the engine.</span></span> <span data-ttu-id="3cb42-115">De même, les interfaces disponibles au moteur pour gérer les problèmes d’exécution sont également principalement internes (certaines exceptions existent au niveau de l’exécution RPC et certaines interfaces DCOM utilisées par le moteur sont externes).</span><span class="sxs-lookup"><span data-stu-id="3cb42-115">Similarly, interfaces available to the engine to handle run-time issues are also mostly internal (some exceptions exist on the RPC run-time side, and some DCOM interfaces used by the engine are external).</span></span>

<span data-ttu-id="3cb42-116">Deux approches typiques du marshaling ont toujours été des technologies inline et pilotées par les données (interprétées).</span><span class="sxs-lookup"><span data-stu-id="3cb42-116">Two typical approaches to marshaling have always been inline and data-driven (interpreted) technology.</span></span> <span data-ttu-id="3cb42-117">MIDL prend en charge les commutateurs [**– OS**](/windows/desktop/Midl/-os) et [**-OI \***](/windows/desktop/Midl/-oi) dans ses stubs générés en C.</span><span class="sxs-lookup"><span data-stu-id="3cb42-117">MIDL supports both through its [**–Os**](/windows/desktop/Midl/-os) and [**–Oi\***](/windows/desktop/Midl/-oi) switches in its C-generated stubs.</span></span> <span data-ttu-id="3cb42-118">En outre, MIDL peut générer les bibliothèques TLB utilisées par le package oleautomation.</span><span class="sxs-lookup"><span data-stu-id="3cb42-118">In addition, MIDL can generate the TLB libraries used by the oleautomation package.</span></span> <span data-ttu-id="3cb42-119">En conséquence, une perspective des éléments internes du moteur est qu’elle se compose de deux parties.</span><span class="sxs-lookup"><span data-stu-id="3cb42-119">Accordingly, one perspective of the engine's internals is that it consists of two parts.</span></span>

<span data-ttu-id="3cb42-120">La première est un ensemble de routines qui gèrent le dimensionnement, le marshaling, etc., correspondant aux objets de type de données typiques comme une structure ou un tableau.</span><span class="sxs-lookup"><span data-stu-id="3cb42-120">The first is a set of routines that handle sizing, marshaling, and so on, corresponding to typical data type objects like a structure or an array.</span></span> <span data-ttu-id="3cb42-121">Ces routines sont ajustées pour des performances optimales. par exemple, ils essaient généralement de bloquer-copier des données dans la mesure du possible.</span><span class="sxs-lookup"><span data-stu-id="3cb42-121">These routines are fine-tuned for performance; for example, they typically attempt to block-copy data wherever possible.</span></span> <span data-ttu-id="3cb42-122">Cette partie est souvent appelée moteur de rapport de rapport principal.</span><span class="sxs-lookup"><span data-stu-id="3cb42-122">This part is often referred to as the core NDR engine.</span></span>

<span data-ttu-id="3cb42-123">La deuxième partie se compose d’un interpréteur et de ses éléments associés.</span><span class="sxs-lookup"><span data-stu-id="3cb42-123">The second part consists of an interpreter and its related pieces.</span></span> <span data-ttu-id="3cb42-124">L’interpréteur utilise des routines du moteur de rapport de rapport principal, comme s’il s’agissait d’une bibliothèque interne, afin d’exécuter un appel distant avec tous ses arguments marshalés et démarshalés, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="3cb42-124">The interpreter uses routines from the core NDR engine, as if from an internal library, in order to execute a remote call with all its arguments marshaled and unmarshaled, as appropriate.</span></span>

<span data-ttu-id="3cb42-125">Le moteur de détourage de la clé principale est utilisé de la même manière que celui utilisé à partir de stubs inline ou de l’interpréteur.</span><span class="sxs-lookup"><span data-stu-id="3cb42-125">The core NDR engine is used in a similar manner whether used from inline stubs or from the interpreter.</span></span> <span data-ttu-id="3cb42-126">Toutes les routines de moteur principales dépendent de l’état passé par une structure de message stub.</span><span class="sxs-lookup"><span data-stu-id="3cb42-126">All core engine routines depend on the state passed in by a stub message structure.</span></span> <span data-ttu-id="3cb42-127">La structure est correctement configurée par le stub inclus ou par l’interpréteur.</span><span class="sxs-lookup"><span data-stu-id="3cb42-127">The structure is set up appropriately by the inline stub or by the interpreter.</span></span> <span data-ttu-id="3cb42-128">Au fil des années, le moteur principal avait été utilisé dans un contexte différent ; actuellement, l’interpréteur est en fait un ensemble de plusieurs boucles d’interpréteurs distinctes.</span><span class="sxs-lookup"><span data-stu-id="3cb42-128">Over the years the core engine had been used in a different context; currently the interpreter is actually a set of several distinct interpreter loops.</span></span> <span data-ttu-id="3cb42-129">Celles-ci sont liées aux interpréteurs anciens et nouveaux ([**– OI**](/windows/desktop/Midl/-oi) et **-** b), ainsi qu’aux boucles relatives à la sérialisation des données (récupération), à la prise en charge asynchrone par RPC et à la prise en charge asynchrone DCOM (RPC et DCOM ont des modèles de programmation asynchrone différents).</span><span class="sxs-lookup"><span data-stu-id="3cb42-129">These are related to the old and new ([**–Oi**](/windows/desktop/Midl/-oi) versus **–Oif**) interpreters, as well as to loops related to data serialization (pickling), RPC async support and DCOM async support (RPC and DCOM have different asynchronous programming models).</span></span>

<span data-ttu-id="3cb42-130">Au-delà de l’ajout de nouvelles fonctionnalités, un aspect important de l’évolution du moteur de NDR est un changement général de l’approche des interpréteurs.</span><span class="sxs-lookup"><span data-stu-id="3cb42-130">Beyond the addition of new features, an important aspect of the NDR engine evolution is a general shift in the approach to interpreters.</span></span> <span data-ttu-id="3cb42-131">NDR version 1.1 a commencé dans le cadre d’une nouvelle approche MIDL 2,0 du marshaling, avec les stubs Inline préférés pour les considérations relatives aux performances.</span><span class="sxs-lookup"><span data-stu-id="3cb42-131">NDR version1.1 began as part of a new MIDL 2.0 approach to marshaling, with the inline stubs being preferred for performance considerations.</span></span> <span data-ttu-id="3cb42-132">Avec la version la plus récente du rapport de non-remise, – la norme d' [**interfaces**](/windows/desktop/Midl/-oi) est devenue le mode le plus largement utilisé du compilateur, presque à l’exclusion des stubs Inline.</span><span class="sxs-lookup"><span data-stu-id="3cb42-132">With the most recent version of NDR, [**–Oif**](/windows/desktop/Midl/-oi) has become the most widely used mode of the compiler, almost to the exclusion of inline stubs.</span></span>

<span data-ttu-id="3cb42-133">Les descripteurs de chaîne de format du moteur de rapport de non-remise RPC sont décrits plus en détail dans les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="3cb42-133">RPC NDR Engine format string descriptors are described in more detail in the following topics:</span></span>

-   [<span data-ttu-id="3cb42-134">Chaînes de format</span><span class="sxs-lookup"><span data-stu-id="3cb42-134">Format Strings</span></span>](format-strings.md)
-   [<span data-ttu-id="3cb42-135">Chaînes de format de procédure</span><span class="sxs-lookup"><span data-stu-id="3cb42-135">Procedure Format Strings</span></span>](procedure-format-strings.md)
-   [<span data-ttu-id="3cb42-136">Descripteur d’en-tête de procédure</span><span class="sxs-lookup"><span data-stu-id="3cb42-136">Procedure Header Descriptor</span></span>](procedure-header-descriptor.md)
-   [<span data-ttu-id="3cb42-137">Poignées</span><span class="sxs-lookup"><span data-stu-id="3cb42-137">Handles</span></span>](handles.md)
-   [<span data-ttu-id="3cb42-138">L’en-tête</span><span class="sxs-lookup"><span data-stu-id="3cb42-138">The Header</span></span>](the-header.md)
-   [<span data-ttu-id="3cb42-139">Descripteurs de paramètre</span><span class="sxs-lookup"><span data-stu-id="3cb42-139">Parameter Descriptors</span></span>](parameter-descriptors.md)
-   [<span data-ttu-id="3cb42-140">Chaînes de format de type</span><span class="sxs-lookup"><span data-stu-id="3cb42-140">Type Format Strings</span></span>](type-format-strings.md)

 

 