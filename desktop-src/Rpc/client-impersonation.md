---
title: Emprunt d’identité du client (RPC)
description: L’emprunt d’identité est utile dans un environnement informatique distribué lorsque les serveurs doivent transmettre les demandes des clients à d’autres processus serveur ou au système d’exploitation.
ms.assetid: 49d833d8-c61c-4746-91cf-c0753847cd3d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d03ad3b4d9e2984708e8b274ab9bc57c3235808b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104102125"
---
# <a name="client-impersonation"></a><span data-ttu-id="c05ca-103">Emprunt d'identité de client</span><span class="sxs-lookup"><span data-stu-id="c05ca-103">Client Impersonation</span></span>

<span data-ttu-id="c05ca-104">L’emprunt d’identité est utile dans un environnement informatique distribué lorsque les serveurs doivent transmettre les demandes des clients à d’autres processus serveur ou au système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="c05ca-104">Impersonation is useful in a distributed computing environment when servers must pass client requests to other server processes or to the operating system.</span></span> <span data-ttu-id="c05ca-105">Dans ce cas, un serveur emprunte l’identité du contexte de sécurité du client.</span><span class="sxs-lookup"><span data-stu-id="c05ca-105">In this case, a server impersonates the client's security context.</span></span> <span data-ttu-id="c05ca-106">D’autres processus serveur peuvent ensuite traiter la demande comme si le client d’origine l’a effectuée.</span><span class="sxs-lookup"><span data-stu-id="c05ca-106">Other server processes can then handle the request as if the original client made it.</span></span>

![le serveur emprunte l’identité d’un client appelant lors des appels suivants au nom du client](images/impr.png)

<span data-ttu-id="c05ca-108">Par exemple, un client envoie une demande au serveur A. Si le serveur A doit interroger le serveur B pour terminer la demande, le serveur A emprunte l’identité du contexte de sécurité du client et effectue la demande au serveur B pour le compte du client.</span><span class="sxs-lookup"><span data-stu-id="c05ca-108">For example, a client makes a request to Server A. If Server A must query Server B to complete the request, Server A impersonates the client security context and makes the request to Server B on behalf of the client.</span></span> <span data-ttu-id="c05ca-109">Le serveur B utilise le contexte de sécurité du client d’origine, au lieu de l’identité de sécurité du serveur A, pour déterminer s’il faut terminer la tâche.</span><span class="sxs-lookup"><span data-stu-id="c05ca-109">Server B uses the original client's security context, instead of the security identity for Server A, to determine whether to complete the task.</span></span>

<span data-ttu-id="c05ca-110">Le serveur appelle [**RpcImpersonateClient**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcimpersonateclient) pour remplacer la sécurité du thread de serveur par le contexte de sécurité du client.</span><span class="sxs-lookup"><span data-stu-id="c05ca-110">The server calls [**RpcImpersonateClient**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcimpersonateclient) to overwrite the security for the server thread with the client security context.</span></span> <span data-ttu-id="c05ca-111">Une fois la tâche terminée, le serveur appelle [**RpcRevertToSelf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoself) ou [**RpcRevertToSelfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoselfex) pour restaurer le contexte de sécurité défini pour le thread serveur.</span><span class="sxs-lookup"><span data-stu-id="c05ca-111">After the task is completed, the server calls [**RpcRevertToSelf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoself) or [**RpcRevertToSelfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoselfex) to restore the security context defined for the server thread.</span></span>

<span data-ttu-id="c05ca-112">Lors de la liaison, le client peut spécifier des informations de qualité de service sur la sécurité, qui spécifie comment le serveur peut emprunter l’identité du client.</span><span class="sxs-lookup"><span data-stu-id="c05ca-112">When binding, the client can specify quality-of-service information about security which specifies how the server can impersonate the client.</span></span> <span data-ttu-id="c05ca-113">Par exemple, l’un des paramètres permet au client de spécifier que le serveur n’est pas autorisé à emprunter l’identité du serveur.</span><span class="sxs-lookup"><span data-stu-id="c05ca-113">For example, one of the settings lets the client specify that the server is not allowed to impersonate it.</span></span> <span data-ttu-id="c05ca-114">Pour plus d’informations, consultez [qualité de service](quality-of-service.md).</span><span class="sxs-lookup"><span data-stu-id="c05ca-114">For more information, see [Quality of Service](quality-of-service.md).</span></span>

<span data-ttu-id="c05ca-115">La possibilité d’appeler d’autres serveurs tout en empruntant l’identité du client d’origine est appelée *délégation*.</span><span class="sxs-lookup"><span data-stu-id="c05ca-115">The capability to call other servers while impersonating the original client is called *delegation*.</span></span> <span data-ttu-id="c05ca-116">Quand la délégation est utilisée, un serveur qui emprunte l’identité d’un client peut appeler un autre serveur et peut effectuer des appels réseau avec les informations d’identification du client.</span><span class="sxs-lookup"><span data-stu-id="c05ca-116">When delegation is used, a server impersonating a client can call another server, and can make network calls with the credentials of the client.</span></span> <span data-ttu-id="c05ca-117">Autrement dit, du point de vue du deuxième serveur, les demandes provenant du premier serveur ne sont pas différenciées des demandes provenant du client.</span><span class="sxs-lookup"><span data-stu-id="c05ca-117">That is, from the perspective of the second server, requests coming from the first server are indistinguishable from requests coming from the client.</span></span> <span data-ttu-id="c05ca-118">Tous les fournisseurs de sécurité ne prennent pas en charge la délégation.</span><span class="sxs-lookup"><span data-stu-id="c05ca-118">Not all security providers support delegation.</span></span> <span data-ttu-id="c05ca-119">Microsoft ne fournit qu’un seul fournisseur de sécurité qui prend en charge la délégation : Kerberos.</span><span class="sxs-lookup"><span data-stu-id="c05ca-119">Microsoft ships only one security provider that supports delegation: Kerberos.</span></span>

<span data-ttu-id="c05ca-120">La délégation peut être une fonctionnalité dangereuse en raison des privilèges que le client donne au serveur lors d’un appel de procédure distante.</span><span class="sxs-lookup"><span data-stu-id="c05ca-120">Delegation can be a dangerous capability due to the privileges the client gives the server during a remote procedure call.</span></span> <span data-ttu-id="c05ca-121">C’est la raison pour laquelle Kerberos autorise les appels avec le niveau d’emprunt d’identité de délégation uniquement si une authentification mutuelle est demandée.</span><span class="sxs-lookup"><span data-stu-id="c05ca-121">This is why Kerberos allows calls with the impersonation level of delegation only if mutual authentication is requested.</span></span> <span data-ttu-id="c05ca-122">Les administrateurs de domaine peuvent limiter les ordinateurs auxquels des appels avec un niveau d’emprunt d’identité de délégation sont effectués pour empêcher les clients insoupçonnés d’effectuer des appels à des serveurs qui pourraient abuser de leurs informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="c05ca-122">Domain administrators can limit the computers to which calls with delegation impersonation level are made to prevent unsuspecting clients from making calls to servers that could abuse their credentials.</span></span>

<span data-ttu-id="c05ca-123">Il existe une exception à la règle de délégation : appels à l’aide de [**Ncalrpc**](/windows/desktop/Midl/ncalrpc).</span><span class="sxs-lookup"><span data-stu-id="c05ca-123">One exception to the delegation rule exists: calls using [**ncalrpc**](/windows/desktop/Midl/ncalrpc).</span></span> <span data-ttu-id="c05ca-124">Lorsque ces appels sont rendus, le serveur obtient des droits de délégation, même si un niveau d’emprunt d’identité d’emprunt d’identité est spécifié.</span><span class="sxs-lookup"><span data-stu-id="c05ca-124">When these calls are made the server gets delegation rights, even if an impersonation level of impersonate is specified.</span></span> <span data-ttu-id="c05ca-125">Autrement dit, un serveur peut appeler d’autres serveurs pour le compte du client.</span><span class="sxs-lookup"><span data-stu-id="c05ca-125">That is, a server can call other servers on behalf of the client.</span></span> <span data-ttu-id="c05ca-126">Cela fonctionne pour un seul appel à distance.</span><span class="sxs-lookup"><span data-stu-id="c05ca-126">This works for one remote call only.</span></span> <span data-ttu-id="c05ca-127">Par exemple, si le client A appelle le serveur local LB à l’aide de **Ncalrpc** local, le serveur local lb peut emprunter l’identité et appeler le serveur distant RB.</span><span class="sxs-lookup"><span data-stu-id="c05ca-127">For example, if client A calls local server LB using **ncalrpc** local server LB can impersonate and call remote server RB.</span></span> <span data-ttu-id="c05ca-128">Le RB peut agir pour le compte du client A, mais uniquement sur l’ordinateur distant sur lequel le RB s’exécute.</span><span class="sxs-lookup"><span data-stu-id="c05ca-128">RB will be able to act on behalf of client A, but only on the remote computer that RB is running on.</span></span> <span data-ttu-id="c05ca-129">Il ne peut pas effectuer un autre appel réseau vers l’ordinateur distant C à moins que LB ne spécifie un niveau d’emprunt d’identité de délégué lorsqu’il a appelé RB.</span><span class="sxs-lookup"><span data-stu-id="c05ca-129">It cannot make another network call to remote computer C unless LB specified an impersonation level of delegate when it called RB.</span></span>

> [!Note]  
> <span data-ttu-id="c05ca-130">Le terme *emprunt d’identité* représente deux significations qui se chevauchent.</span><span class="sxs-lookup"><span data-stu-id="c05ca-130">The term *impersonation* represents two overlapping meanings.</span></span> <span data-ttu-id="c05ca-131">La première signification de l’emprunt d’identité est le processus général d’action pour le compte d’un client.</span><span class="sxs-lookup"><span data-stu-id="c05ca-131">The first meaning of impersonation is the general process of acting on behalf of a client.</span></span> <span data-ttu-id="c05ca-132">La deuxième signification est le niveau d’emprunt d’identité spécifique appelé emprunt d’identité.</span><span class="sxs-lookup"><span data-stu-id="c05ca-132">The second meaning is the specific impersonation level called impersonation.</span></span> <span data-ttu-id="c05ca-133">Le contexte du texte clarifie généralement la signification.</span><span class="sxs-lookup"><span data-stu-id="c05ca-133">The context of the text generally clarifies the meaning.</span></span>

 

 

 