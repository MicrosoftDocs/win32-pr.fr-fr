---
title: Sécurité RPC sur HTTP
description: RPC sur HTTP offre trois types de sécurité en plus de la sécurité RPC standard, ce qui entraîne la protection du trafic RPC sur HTTP une seule fois par RPC, puis la protection par le mécanisme de tunneling fourni par RPC sur HTTP.
ms.assetid: 3a44c72b-b74c-433a-8826-1f76ca019f40
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 527cf5ff74120c41606d83a248e355a6ea46d9d5
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/12/2021
ms.locfileid: "104211197"
---
# <a name="rpc-over-http-security"></a><span data-ttu-id="e6b2d-103">Sécurité RPC sur HTTP</span><span class="sxs-lookup"><span data-stu-id="e6b2d-103">RPC over HTTP Security</span></span>

<span data-ttu-id="e6b2d-104">RPC sur HTTP offre trois types de sécurité en plus de la sécurité RPC standard, ce qui entraîne la protection du trafic RPC sur HTTP une seule fois par RPC, puis la protection par le mécanisme de tunneling fourni par RPC sur HTTP.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-104">RPC over HTTP provides three types of security in addition to standard RPC security, which results in RPC over HTTP traffic being protected once by RPC, and then doubly protected by the tunneling mechanism provided by RPC over HTTP.</span></span> <span data-ttu-id="e6b2d-105">Pour obtenir une description des mécanismes de sécurité RPC standard, consultez [sécurité](security.md).</span><span class="sxs-lookup"><span data-stu-id="e6b2d-105">For a description of standard RPC security mechanisms, see [Security](security.md).</span></span> <span data-ttu-id="e6b2d-106">Le mécanisme de tunneling RPC sur HTTP s’ajoute à la sécurité RPC normale de la manière suivante :</span><span class="sxs-lookup"><span data-stu-id="e6b2d-106">The RPC over HTTP tunneling mechanism adds to normal RPC security in the following manner:</span></span>

-   <span data-ttu-id="e6b2d-107">Fournit la sécurité via IIS (disponible pour RPC sur HTTP v2 uniquement).</span><span class="sxs-lookup"><span data-stu-id="e6b2d-107">Provides security through the IIS (available for RPC over HTTP v2 only).</span></span>
-   <span data-ttu-id="e6b2d-108">Fournit le chiffrement SSL et la vérification du proxy RPC (authentification mutuelle).</span><span class="sxs-lookup"><span data-stu-id="e6b2d-108">Provides SSL encryption and RPC Proxy verification (mutual authentication).</span></span> <span data-ttu-id="e6b2d-109">Également disponible dans RPC sur HTTP v2 uniquement.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-109">Also available in RPC over HTTP v2 only.</span></span>
-   <span data-ttu-id="e6b2d-110">Fournit des restrictions sur le niveau de proxy RPC qui dicte les ordinateurs sur le réseau serveur autorisés à recevoir des appels RPC sur HTTP.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-110">Provides restrictions on the RPC Proxy level dictating which machines on the server network are allowed to receive RPC over HTTP calls.</span></span>

<span data-ttu-id="e6b2d-111">Chacune de ces trois fonctionnalités de sécurité est décrite plus en détail dans les sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-111">Each of these three security features is described in more detail in following sections.</span></span>

## <a name="iis-authentication"></a><span data-ttu-id="e6b2d-112">Authentification IIS</span><span class="sxs-lookup"><span data-stu-id="e6b2d-112">IIS Authentication</span></span>

<span data-ttu-id="e6b2d-113">RPC sur HTTP peut tirer parti du mécanisme d’authentification normal d’IIS.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-113">RPC over HTTP can leverage the normal authentication mechanism of IIS.</span></span> <span data-ttu-id="e6b2d-114">Le répertoire virtuel pour le proxy RPC peut être configuré à l’aide du nœud RPC sous le site Web par défaut dans le composant logiciel enfichable MMC IIS :</span><span class="sxs-lookup"><span data-stu-id="e6b2d-114">The virtual directory for RPC Proxy can be configured using the Rpc node under the Default Web Site in the IIS MMC snap-in:</span></span>

![Capture d’écran montrant le nœud RPC sous le site Web par défaut dans le composant logiciel enfichable MMC IIS.](images/rpc-http-1.png)

<span data-ttu-id="e6b2d-116">IIS peut être configuré pour désactiver l’accès anonyme et exiger l’authentification du répertoire virtuel pour le proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-116">IIS can be configured to disable anonymous access and require authentication to the virtual directory for the RPC Proxy.</span></span> <span data-ttu-id="e6b2d-117">Pour ce faire, cliquez avec le bouton droit sur le nœud RPC et sélectionnez **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-117">To do this, right click the Rpc node and select **Properties**.</span></span> <span data-ttu-id="e6b2d-118">Sélectionnez l’onglet **sécurité de répertoire** , puis cliquez sur le bouton **modifier** dans le groupe **authentification et Access Control** , comme illustré ici :</span><span class="sxs-lookup"><span data-stu-id="e6b2d-118">Select the **Directory Security** tab and click the **Edit** button in the **Authentication and Access Control** group, as illustrated here:</span></span>

![Capture d’écran montrant la boîte de dialogue Propriétés RPC.](images/rpc-http-2.png)

<span data-ttu-id="e6b2d-120">Bien que vous puissiez utiliser RPC sur HTTP même lorsque le répertoire virtuel RPC proxy autorise l’accès anonyme, Microsoft recommande vivement de désactiver l’accès anonyme à ce répertoire virtuel pour des raisons de sécurité.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-120">Although you can use RPC over HTTP even when the RPC Proxy virtual directory allows anonymous access, Microsoft strongly recommends disabling anonymous access to that virtual directory for security reasons.</span></span> <span data-ttu-id="e6b2d-121">Au lieu de cela, pour RPC sur HTTP, vous activez l’authentification de base, l’authentification intégrée de Windows ou les deux.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-121">Rather, for RPC over HTTP enable Basic Authentication, Windows Integrated Authentication or both.</span></span> <span data-ttu-id="e6b2d-122">N’oubliez pas que seul RPC sur HTTP v2 peut s’authentifier auprès du proxy RPC nécessitant une authentification de base ou intégrée à Windows. RPC sur HTTP v1 ne sera pas en mesure de se connecter si **l’interdiction de l’accès anonyme** est désactivée.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-122">Remember that only RPC over HTTP v2 is able to authenticate against RPC Proxy requiring Basic or Windows-integrated authentication; RPC over HTTP v1 will not be able to connect if **Disallow Anonymous Access** is disabled.</span></span> <span data-ttu-id="e6b2d-123">Étant donné que RPC sur HTTP v2 est l’implémentation la plus sûre et la plus robuste, l’utilisation d’une version de Windows qui la prend en charge améliore la sécurité de vos installations.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-123">Since RPC over HTTP v2 is the more secure and robust implementation, using a version of Windows that supports it will improve the security of your installations.</span></span>

> [!Note]  
> <span data-ttu-id="e6b2d-124">Par défaut, le répertoire virtuel du proxy RPC est marqué pour autoriser l’accès anonyme.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-124">By default, the RPC proxy virtual directory is marked to allow anonymous access.</span></span> <span data-ttu-id="e6b2d-125">Toutefois, le proxy RPC pour RPC sur HTTP v2 rejette les requêtes qui ne sont pas authentifiées par défaut.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-125">However, the RPC proxy for RPC over HTTP v2 rejects requests that are not authenticated by default.</span></span>

 

## <a name="traffic-encryption"></a><span data-ttu-id="e6b2d-126">Chiffrement du trafic</span><span class="sxs-lookup"><span data-stu-id="e6b2d-126">Traffic Encryption</span></span>

<span data-ttu-id="e6b2d-127">RPC sur HTTP peut chiffrer le trafic entre le client RPC sur HTTP et le proxy RPC avec SSL.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-127">RPC over HTTP can encrypt traffic between the RPC over HTTP client and the RPC proxy with SSL.</span></span> <span data-ttu-id="e6b2d-128">Le trafic entre le proxy RPC et le serveur RPC sur HTTP est chiffré à l’aide de mécanismes de sécurité RPC normaux et n’utilise pas SSL (même si SSL entre le client et le proxy RPC est choisi).</span><span class="sxs-lookup"><span data-stu-id="e6b2d-128">The traffic between the RPC proxy and RPC over HTTP server is encrypted using normal RPC security mechanisms and does not use SSL (even if SSL between the client and the RPC proxy is chosen).</span></span> <span data-ttu-id="e6b2d-129">Cela est dû au fait que cette partie du trafic transite au sein du réseau d’une organisation et derrière un pare-feu.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-129">This is because that portion of the traffic travels within an organization's network and behind a firewall.</span></span>

<span data-ttu-id="e6b2d-130">Le trafic entre le client RPC sur HTTP et le proxy RPC, qui transite généralement via Internet, peut être chiffré avec SSL en plus du mécanisme de chiffrement choisi pour RPC.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-130">Traffic between the RPC over HTTP client and the RPC proxy, which generally travels over the Internet, can be encrypted with SSL in addition to which encryption mechanism was chosen for RPC.</span></span> <span data-ttu-id="e6b2d-131">Dans ce cas, le trafic sur la partie Internet de l’itinéraire est doublement chiffré.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-131">In this case, traffic on the Internet portion of the route becomes doubly encrypted.</span></span> <span data-ttu-id="e6b2d-132">Le chiffrement du trafic via le proxy RPC fournit une défense secondaire, si le proxy RPC ou d’autres ordinateurs du réseau de périmètre sont compromis.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-132">Encrypting traffic through the RPC proxy provides a secondary defense, in case the RPC proxy or other machines in the perimeter network are compromised.</span></span> <span data-ttu-id="e6b2d-133">Étant donné que le proxy RPC ne peut pas déchiffrer la couche de chiffrement secondaire, le proxy RPC n’a pas accès aux données envoyées.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-133">Since the RPC proxy cannot decrypt the secondary encryption layer, the RPC proxy does not have access to the data being sent.</span></span> <span data-ttu-id="e6b2d-134">Pour plus d’informations, consultez [recommandations relatives au déploiement de RPC sur http](rpc-over-http-deployment-recommendations.md) .</span><span class="sxs-lookup"><span data-stu-id="e6b2d-134">See [RPC over HTTP Deployment Recommendations](rpc-over-http-deployment-recommendations.md) for more information.</span></span> <span data-ttu-id="e6b2d-135">Le chiffrement SSL est disponible uniquement avec RPC sur HTTP v2.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-135">SSL encryption is available only with RPC over HTTP v2.</span></span>

## <a name="restricting-rpc-over-http-calls-to-certain-computers"></a><span data-ttu-id="e6b2d-136">Restriction des appels RPC sur HTTP à certains ordinateurs</span><span class="sxs-lookup"><span data-stu-id="e6b2d-136">Restricting RPC over HTTP Calls to Certain Computers</span></span>

<span data-ttu-id="e6b2d-137">La configuration de la sécurité IIS est basée sur les plages de ports et les ordinateurs autorisés.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-137">The IIS security configuration is based on allowed computer and port ranges.</span></span> <span data-ttu-id="e6b2d-138">La possibilité d’utiliser RPC sur HTTP est contrôlée par deux entrées de Registre sur l’ordinateur exécutant IIS et le proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-138">The capability to use RPC over HTTP is controlled by two registry entries on the computer running IIS and the RPC proxy.</span></span> <span data-ttu-id="e6b2d-139">La première entrée est un indicateur qui active la fonctionnalité de proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-139">The first entry is a flag that toggles RPC proxy functionality.</span></span> <span data-ttu-id="e6b2d-140">La seconde est une liste facultative d’ordinateurs sur lesquels le proxy peut transférer les appels RPC.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-140">The second is an optional list of computers to which the proxy can forward RPC calls.</span></span>

<span data-ttu-id="e6b2d-141">Par défaut, un client qui contacte le proxy RPC pour tunnel RPC sur les appels HTTP ne peut pas accéder aux processus du serveur RPC, à l’exception des processus du serveur RPC sur HTTP qui s’exécutent sur le même ordinateur que le proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-141">By default, a client that contacts the RPC proxy to tunnel RPC over HTTP calls cannot access any RPC server processes except the RPC over HTTP server processes running on the same machine as the RPC proxy.</span></span> <span data-ttu-id="e6b2d-142">Si l’indicateur activé n’est pas défini ou est défini sur une valeur zéro, IIS désactive le proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-142">If the ENABLED flag is not defined or set to a zero value, IIS disables the RPC proxy.</span></span> <span data-ttu-id="e6b2d-143">Si l’indicateur activé est défini et défini sur une valeur différente de zéro, un client peut se connecter aux serveurs RPC sur HTTP sur l’ordinateur exécutant IIS.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-143">If the ENABLED flag is defined and set to a nonzero value, a client can connect to RPC over HTTP servers on the computer running IIS.</span></span> <span data-ttu-id="e6b2d-144">Pour permettre au client d’effectuer un tunnel vers un processus serveur RPC sur un autre ordinateur, vous devez ajouter une entrée de Registre à la liste des serveurs RPC sur HTTP de l’ordinateur IIS.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-144">To enable the client to tunnel to an RPC over HTTP server process on another computer, you must add a registry entry to the IIS computer's list of RPC over HTTP servers.</span></span>

<span data-ttu-id="e6b2d-145">Les serveurs RPC ne peuvent pas accepter RPC sur les appels HTTP à moins qu’ils n’aient spécifiquement demandé à l’écoute RPC sur HTTP.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-145">RPC servers cannot accept RPC over HTTP calls unless they specifically requested RPC to listen on RPC over HTTP.</span></span>

<span data-ttu-id="e6b2d-146">L’exemple suivant montre comment configurer le registre pour permettre aux clients de se connecter à des serveurs via Internet :</span><span class="sxs-lookup"><span data-stu-id="e6b2d-146">The following example demonstrates how to configure the registry to allow clients to connect to servers across the Internet:</span></span>

```
HKEY_LOCAL_MACHINE\
   Software\Microsoft\Rpc\RpcProxy\Enabled:REG_DWORD
   Software\Microsoft\Rpc\RpcProxy\ValidPorts:REG_SZ
```

<span data-ttu-id="e6b2d-147">L’entrée **ValidPorts** est une \_ entrée reg SZ contenant la liste des ordinateurs auxquels le proxy RPC IIS est autorisé à transférer les appels RPC, ainsi que les ports qu’il doit utiliser pour se connecter aux serveurs RPC.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-147">The **ValidPorts** entry is a REG\_SZ entry containing a list of computers to which the IIS RPC proxy is allowed to forward RPC calls, and the ports it should use to connect to the RPC servers.</span></span> <span data-ttu-id="e6b2d-148">L' \_ entrée reg SZ prend la forme suivante : Rosco : 593 ; Rosco : 2000-8000 ; données \* : 4000-8000.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-148">The REG\_SZ entry takes the following form: Rosco:593;Rosco:2000-8000;Data\*:4000-8000.</span></span>

<span data-ttu-id="e6b2d-149">Dans cet exemple, IIS peut transférer RPC sur les appels HTTP vers le serveur « Rosco » sur les ports 593 et 2000 à 8000.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-149">In this example, IIS can forward RPC over HTTP calls to the server "Rosco" on ports 593 and 2000 through 8000.</span></span> <span data-ttu-id="e6b2d-150">Il peut également envoyer des appels à n’importe quel serveur dont le nom commence par « Data ».</span><span class="sxs-lookup"><span data-stu-id="e6b2d-150">It can also send calls to any server whose name begins with "Data".</span></span> <span data-ttu-id="e6b2d-151">Il se connecte sur les ports 4000 à 8000.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-151">It will connect on ports 4000 through 8000.</span></span> <span data-ttu-id="e6b2d-152">En outre, avant de transférer le trafic vers un port donné sur le serveur RPC sur HTTP, le proxy RPC effectue un échange de paquets spécial avec le service RPC qui écoute sur ce port afin de vérifier qu’il est disposé à accepter les demandes sur HTTP.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-152">In addition, before forwarding traffic to a given port on the RPC over HTTP server, the RPC proxy performs a special packet exchange with the RPC service listening on that port to verify it is willing to accept requests over HTTP.</span></span>

<span data-ttu-id="e6b2d-153">Pour obtenir un exemple basé sur ces exemples de paramètres, si un service RPC écoute le port 4500 sur le serveur « données1 », mais n’a pas appelé l’une des fonctions [ \* *RpcServerUseProtseq \** _](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq) avec _ \* ncacn \_ http \* \*, il rejette la requête.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-153">For an example based on these example settings, if an RPC service listens on port 4500 on server "Data1" but has not called one of the [\**RpcServerUseProtseq\** _](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq) functions with _\*ncacn\_http\*\*, it will reject the request.</span></span> <span data-ttu-id="e6b2d-154">Ce comportement offre une protection supplémentaire pour les serveurs qui écoutent sur un port ouvert en raison d’une erreur de configuration. à moins que le serveur n’ait spécifiquement demandé à écouter sur le protocole RPC sur HTTP, il ne recevra pas les appels provenant de l’extérieur du pare-feu.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-154">This behavior provides additional protection for servers that listen on an opened port due to configuration error; unless the server specifically requested to listen on RPC over HTTP, it will not receive calls originating from outside the firewall.</span></span>

<span data-ttu-id="e6b2d-155">Les entrées de la clé **ValidPorts** doivent correspondre exactement au serveur RPC sur http demandé par le client (il ne respecte pas la casse).</span><span class="sxs-lookup"><span data-stu-id="e6b2d-155">Entries in the **ValidPorts** key must be an exact match of the RPC over HTTP server asked for by the client (it is not case-sensitive).</span></span> <span data-ttu-id="e6b2d-156">Pour simplifier le traitement, le proxy RPC n’effectue pas la canonisation du nom fourni par le client RPC sur HTTP.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-156">To streamline processing, the RPC proxy does not perform canonicalization of the name provided by the RPC over HTTP client.</span></span> <span data-ttu-id="e6b2d-157">Par conséquent, si le client demande rosco.microsoft.com et que dans **ValidPorts** contient Rosco uniquement, le proxy RPC ne correspondra pas aux noms, même si les deux noms peuvent faire référence au même ordinateur.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-157">Therefore, if the client asks for rosco.microsoft.com, and in **ValidPorts** contain Rosco only, the RPC proxy will not match the names, even though both names may refer to the same machine.</span></span> <span data-ttu-id="e6b2d-158">En outre, si l’adresse IP de Rosco est 66.77.88.99, et que le client demande 66.77.88.99, mais que la clé **ValidPorts** contient Rosco uniquement, le proxy RPC refuse la connexion.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-158">Additionally, if the IP address of Rosco is 66.77.88.99, and the client asks for 66.77.88.99 but the **ValidPorts** key contains Rosco only, the RPC proxy will refuse the connection.</span></span> <span data-ttu-id="e6b2d-159">Si un client peut demander le serveur RPC sur HTTP par son nom ou par une adresse IP, insérez-le dans la clé **ValidPorts** .</span><span class="sxs-lookup"><span data-stu-id="e6b2d-159">If a client may ask for the RPC over HTTP server by name, or by IP address, insert both in the **ValidPorts** key.</span></span>

> [!Note]  
> <span data-ttu-id="e6b2d-160">Bien que RPC soit activé pour IPv6, le proxy RPC ne prend pas en charge les adresses IPv6 dans la clé **ValidPorts** .</span><span class="sxs-lookup"><span data-stu-id="e6b2d-160">Although RPC is IPv6 enabled, the RPC proxy does not support IPv6 addresses in the **ValidPorts** key.</span></span> <span data-ttu-id="e6b2d-161">Si IPv6 est utilisé pour connecter le proxy RPC et le serveur RPC sur HTTP, seuls les noms DNS peuvent être utilisés.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-161">If IPv6 is used to connect the RPC proxy and the RPC over HTTP server, only DNS names can be used.</span></span>

 

<span data-ttu-id="e6b2d-162">IIS lit les entrées de Registre **Enabled** et **ValidPorts** au démarrage.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-162">IIS reads the **Enabled** and **ValidPorts** registry entries on startup.</span></span> <span data-ttu-id="e6b2d-163">En outre, RPC sur HTTP relit le contenu de la clé **ValidPorts** environ toutes les 5 minutes.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-163">In addition, RPC over HTTP rereads the contents of the **ValidPorts** key approximately every 5 minutes.</span></span> <span data-ttu-id="e6b2d-164">Si l’entrée **ValidPorts** est modifiée, les modifications sont implémentées dans un délai de 5 minutes.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-164">If the **ValidPorts** entry is changed, the changes are implemented within 5 minutes.</span></span>

<span data-ttu-id="e6b2d-165">**RPC sur http v1 :** Le service WEB doit être arrêté et redémarré à l’aide d’Internet Service Manager pour connaître les nouvelles valeurs des entrées de Registre à implémenter.</span><span class="sxs-lookup"><span data-stu-id="e6b2d-165">**RPC over HTTP v1:** The WEB service must be stopped and restarted using the Internet Service Manager for new values in the registry entries to be implemented.</span></span>

 

 




