---
title: Sérialisation de type
description: Le compilateur MIDL génère jusqu’à trois fonctions pour chaque type auquel l’attribut \ encode \ ou \ Decode \ est appliqué.
ms.assetid: 948f1dd7-c8b0-4fa0-88d8-9d122de52ba1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4674617bc98c92dbc684a29d1a3c91ac6a7429e1
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104101944"
---
# <a name="type-serialization"></a><span data-ttu-id="bb51c-103">Sérialisation de type</span><span class="sxs-lookup"><span data-stu-id="bb51c-103">Type Serialization</span></span>

<span data-ttu-id="bb51c-104">Le compilateur MIDL génère jusqu’à trois fonctions pour chaque type auquel l’attribut \[ [encode](/windows/desktop/Midl/encode) \] ou \[ [Decode](/windows/desktop/Midl/decode) \] est appliqué.</span><span class="sxs-lookup"><span data-stu-id="bb51c-104">The MIDL compiler generates up to three functions for each type to which the \[ [encode](/windows/desktop/Midl/encode)\] or \[ [decode](/windows/desktop/Midl/decode)\] attribute is applied.</span></span> <span data-ttu-id="bb51c-105">Par exemple, pour un type défini par l’utilisateur nommé *MyType*, le compilateur génère du code pour les \_ fonctions de décodage MyType, MyType \_ et MyType \_ AlignSize.</span><span class="sxs-lookup"><span data-stu-id="bb51c-105">For example, for a user-defined type named *MyType*, the compiler generates code for the MyType\_Encode, MyType\_Decode, and MyType\_AlignSize functions.</span></span> <span data-ttu-id="bb51c-106">Pour ces fonctions, le compilateur écrit les prototypes dans stub. h et le code source dans le stub \_ c.c.</span><span class="sxs-lookup"><span data-stu-id="bb51c-106">For these functions, the compiler writes prototypes to Stub.h and source code to Stub\_c.c.</span></span> <span data-ttu-id="bb51c-107">En général, vous pouvez encoder un objet *MyType* avec MyType \_ encode et décoder un objet à partir de la mémoire tampon à l’aide du \_ décodage MyType.</span><span class="sxs-lookup"><span data-stu-id="bb51c-107">Generally, you can encode a *MyType* object with MyType\_Encode and decode an object from the buffer using MyType\_Decode.</span></span> <span data-ttu-id="bb51c-108">MyType \_ AlignSize est utilisé si vous avez besoin de connaître la taille de la mémoire tampon de marshaling avant de l’allouer.</span><span class="sxs-lookup"><span data-stu-id="bb51c-108">MyType\_AlignSize is used if you need to know the size of the marshaling buffer before allocating it.</span></span>

<span data-ttu-id="bb51c-109">La fonction d’encodage suivante est générée par le compilateur MIDL.</span><span class="sxs-lookup"><span data-stu-id="bb51c-109">The following encoding function is generated by the MIDL compiler.</span></span> <span data-ttu-id="bb51c-110">Cette fonction sérialise les données pour l’objet pointé par pObject, et la mémoire tampon est obtenue en fonction de la méthode spécifiée dans le handle.</span><span class="sxs-lookup"><span data-stu-id="bb51c-110">This function serializes the data for the object pointed to by pObject, and the buffer is obtained according to the method specified in the handle.</span></span> <span data-ttu-id="bb51c-111">Après avoir écrit les données sérialisées dans la mémoire tampon, vous contrôlez la mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="bb51c-111">After writing the serialized data to the buffer, you control the buffer.</span></span> <span data-ttu-id="bb51c-112">Notez que le handle hérite de l’état des appels précédents et que les mémoires tampons doivent être alignées sur 8.</span><span class="sxs-lookup"><span data-stu-id="bb51c-112">Note that the handle inherits the status from the previous calls, and the buffers must be aligned at 8.</span></span>

<span data-ttu-id="bb51c-113">Pour un handle implicite :</span><span class="sxs-lookup"><span data-stu-id="bb51c-113">For an implicit handle:</span></span>

``` syntax
void MyType_Encode (MyType __RPC_FAR * pObject);
```

<span data-ttu-id="bb51c-114">Pour un handle explicite :</span><span class="sxs-lookup"><span data-stu-id="bb51c-114">For an explicit handle:</span></span>

``` syntax
void MyType_Encode (handle_t Handle, MyType __RPC_FAR * pObject);
```

<span data-ttu-id="bb51c-115">La fonction suivante désérialise les données du stockage de l’application dans l’objet désigné par pObject.</span><span class="sxs-lookup"><span data-stu-id="bb51c-115">The following function deserializes the data from the application's storage into the object pointed to by pObject.</span></span> <span data-ttu-id="bb51c-116">Vous fournissez une mémoire tampon marshalée en fonction de la méthode spécifiée dans le handle.</span><span class="sxs-lookup"><span data-stu-id="bb51c-116">You supply a marshaled buffer according to the method specified in the handle.</span></span> <span data-ttu-id="bb51c-117">Notez que le handle peut hériter de l’état des appels précédents et que les mémoires tampons doivent être alignées sur 8.</span><span class="sxs-lookup"><span data-stu-id="bb51c-117">Note that the handle can inherit the status from the previous calls and the buffers must be aligned at 8.</span></span>

<span data-ttu-id="bb51c-118">Pour un handle implicite :</span><span class="sxs-lookup"><span data-stu-id="bb51c-118">For an implicit handle:</span></span>

``` syntax
void MyType_Decode (MyType __RPC_FAR * pObject);
```

<span data-ttu-id="bb51c-119">Pour un handle explicite :</span><span class="sxs-lookup"><span data-stu-id="bb51c-119">For an explicit handle:</span></span>

``` syntax
void MyType_Decode (handle_t Handle, MyType __RPC_FAR * pObject);
```

<span data-ttu-id="bb51c-120">La fonction suivante retourne une taille, en octets, qui comprend l’instance de type plus les octets de remplissage nécessaires à l’alignement des données.</span><span class="sxs-lookup"><span data-stu-id="bb51c-120">The following function returns a size, in bytes, that includes the type instance plus any padding bytes needed to align the data.</span></span> <span data-ttu-id="bb51c-121">Cela permet de sérialiser un jeu d’instances de types identiques ou différents dans une mémoire tampon tout en veillant à ce que les données de chaque objet soient correctement alignées.</span><span class="sxs-lookup"><span data-stu-id="bb51c-121">This enables serializing a set of instances of the same or different types into a buffer while ensuring that the data for each object is appropriately aligned.</span></span> <span data-ttu-id="bb51c-122">MyType \_ AlignSize suppose que l’instance vers laquelle pointe pObject est marshalée dans une mémoire tampon en commençant au décalage aligné à 8.</span><span class="sxs-lookup"><span data-stu-id="bb51c-122">MyType\_AlignSize assumes that the instance pointed to by pObject will be marshaled into a buffer beginning at the offset aligned at 8.</span></span>

<span data-ttu-id="bb51c-123">Pour un handle implicite :</span><span class="sxs-lookup"><span data-stu-id="bb51c-123">For an implicit handle:</span></span>

``` syntax
size_t MyType_AlignSize (MyType __RPC_FAR * pObject);
```

<span data-ttu-id="bb51c-124">Pour un handle explicite :</span><span class="sxs-lookup"><span data-stu-id="bb51c-124">For an explicit handle:</span></span>

``` syntax
size_t MyType_AlignSize (handle_t Handle, MyType __RPC_FAR * pObject);
```

<span data-ttu-id="bb51c-125">Notez que les procédures distantes avec des handles de liaison implicites et des types sérialisés avec des handles de sérialisation implicites utilisent la même variable de handle globale.</span><span class="sxs-lookup"><span data-stu-id="bb51c-125">Note that both remote procedures with implicit binding handles and serialized types with implicit serialization handles use the same global handle variable.</span></span> <span data-ttu-id="bb51c-126">Par conséquent, il est recommandé de ne pas mélanger la sérialisation de type et les procédures distantes dans une interface avec des handles implicites.</span><span class="sxs-lookup"><span data-stu-id="bb51c-126">Therefore, it is advisable not to mix type serialization and remote procedures in an interface with implicit handles.</span></span> <span data-ttu-id="bb51c-127">Pour plus d’informations, consultez [Handles implicites et Handles explicites](implicit-versus-explicit-handles.md).</span><span class="sxs-lookup"><span data-stu-id="bb51c-127">For details, see [Implicit Versus Explicit Handles](implicit-versus-explicit-handles.md).</span></span>

 

 