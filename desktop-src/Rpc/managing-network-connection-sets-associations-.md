---
title: Gestion des groupes de connexions réseau (associations)
description: À partir de Windows 2000, le temps d’exécution RPC peut gérer plusieurs connexions entre le client et le serveur.
ms.assetid: 9b9c42e9-8ed5-46a6-b6ec-4093ce0128bb
keywords:
- Gestion des ensembles de connexions réseau
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 81e99afe23d90e44d85dc7a2ec9301b45e1f20b1
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104197129"
---
# <a name="managing-network-connection-sets-associations"></a><span data-ttu-id="958cf-104">Gestion des groupes de connexions réseau (associations)</span><span class="sxs-lookup"><span data-stu-id="958cf-104">Managing Network Connection Sets (Associations)</span></span>

<span data-ttu-id="958cf-105">À partir de Windows 2000, le temps d’exécution RPC peut gérer plusieurs connexions entre le client et le serveur.</span><span class="sxs-lookup"><span data-stu-id="958cf-105">Starting with Windows 2000, the RPC run time may maintain more than one connection between the client and the server.</span></span> <span data-ttu-id="958cf-106">Cela facilite l’opération sur les transports qui ne prennent pas en charge la modification de l’identité du client sans rétablir la connexion, les clients multithread et les clients asynchrones.</span><span class="sxs-lookup"><span data-stu-id="958cf-106">This facilitates operation on transports that do not support changing the client identity without reestablishing the connection, multithreaded clients, and asynchronous clients.</span></span> <span data-ttu-id="958cf-107">L’ensemble de connexions entre un processus client et un point de terminaison de serveur est appelé *Association* dans la terminologie RPC.</span><span class="sxs-lookup"><span data-stu-id="958cf-107">The set of connections between a client process and a server endpoint is called an *association* in RPC terminology.</span></span> <span data-ttu-id="958cf-108">La compréhension des associations peut améliorer l’implémentation de RPC.</span><span class="sxs-lookup"><span data-stu-id="958cf-108">Understanding associations can improve the implementation of RPC.</span></span>

<span data-ttu-id="958cf-109">Dans un scénario d’identité à un seul client et à un seul thread, RPC ouvre une connexion entre un processus client et un point de terminaison de serveur pour effectuer des appels RPC.</span><span class="sxs-lookup"><span data-stu-id="958cf-109">In a single-thread, single-client identity scenario, RPC opens one connection between a client process and a server endpoint to make RPC calls.</span></span> <span data-ttu-id="958cf-110">Lorsqu’un appel RPC synchrone est effectué, le client envoie la demande au serveur sur cette connexion et reçoit également la réponse.</span><span class="sxs-lookup"><span data-stu-id="958cf-110">When a synchronous RPC call is made, the client sends the request to the server on this connection, and receives the reply on it as well.</span></span> <span data-ttu-id="958cf-111">Lorsque le nombre de threads qui effectuent des appels RPC dans le processus client augmente, l’identité de sécurité du client peut changer.</span><span class="sxs-lookup"><span data-stu-id="958cf-111">When the number of threads making RPC calls in the client process grows, the security identity of the client can change.</span></span> <span data-ttu-id="958cf-112">Lorsque les appels asynchrones/de canaux sont mélangés à des appels synchrones sur le client, RPC peut nécessiter plusieurs connexions réseau.</span><span class="sxs-lookup"><span data-stu-id="958cf-112">When asynchronous/pipe calls are mixed with synchronous calls on the client, RPC may need more than one network connection.</span></span> <span data-ttu-id="958cf-113">Toutes les connexions dans le jeu sont placées dans un pool de connexions appelé Association.</span><span class="sxs-lookup"><span data-stu-id="958cf-113">All connections in the set are put in a connection pool called an association.</span></span>

<span data-ttu-id="958cf-114">Un appel de procédure distante synchrone utilise exclusivement une connexion donnée pour se conformer aux normes RPC.</span><span class="sxs-lookup"><span data-stu-id="958cf-114">A synchronous remote procedure call exclusively uses a given connection to conform with RPC standards.</span></span> <span data-ttu-id="958cf-115">Une connexion utilisée par un appel RPC synchrone est considérée comme occupée si une demande a été envoyée, mais qu’aucune réponse n’a été reçue.</span><span class="sxs-lookup"><span data-stu-id="958cf-115">A connection used by a synchronous RPC call is considered busy if a request has been sent, but a response has not been received.</span></span> <span data-ttu-id="958cf-116">Aucun autre trafic n’est autorisé sur cette connexion tant que la réponse n’est pas reçue.</span><span class="sxs-lookup"><span data-stu-id="958cf-116">No other traffic is allowed on that connection until the response is received.</span></span> <span data-ttu-id="958cf-117">Le temps d’exécution RPC tente de multiplexer les appels RPC asynchrones et de canal sur la même connexion.</span><span class="sxs-lookup"><span data-stu-id="958cf-117">The RPC run time attempts to multiplex asynchronous and pipe RPC calls on the same connection.</span></span> <span data-ttu-id="958cf-118">Les appels synchrones/asynchrones/de canal ne peuvent pas être mélangés sur la même connexion, ce qui signifie qu’une connexion donnée peut être utilisée pour les appels RPC synchrones ou pour les appels RPC/de canal asynchrone.</span><span class="sxs-lookup"><span data-stu-id="958cf-118">Synchronous and asynchronous/pipe calls cannot be mixed on the same connection, which means that a given connection can be used for either synchronous RPC calls or for asynchronous/pipe RPC calls.</span></span>

<span data-ttu-id="958cf-119">RPC tente de réutiliser les connexions à partir du pool de manière agressive.</span><span class="sxs-lookup"><span data-stu-id="958cf-119">RPC aggressively tries to reuse connections from the pool.</span></span> <span data-ttu-id="958cf-120">Lorsqu’un nouvel appel RPC est effectué, RPC tente de trouver une connexion appropriée à partir du pool et crée une nouvelle connexion uniquement si une connexion appropriée est introuvable.</span><span class="sxs-lookup"><span data-stu-id="958cf-120">When a new RPC call is made, RPC attempts to find a suitable connection from the pool, and creates a new connection only if a suitable connection cannot be found.</span></span> <span data-ttu-id="958cf-121">Pour qu’une connexion soit considérée comme appropriée, elle doit :</span><span class="sxs-lookup"><span data-stu-id="958cf-121">For a connection to be considered suitable, it must:</span></span>

-   <span data-ttu-id="958cf-122">Être du type approprié (synchrone ou asynchrone/de canal).</span><span class="sxs-lookup"><span data-stu-id="958cf-122">Be of the appropriate type (synchronous, or asynchronous/pipe).</span></span>
-   <span data-ttu-id="958cf-123">Soyez gratuit.</span><span class="sxs-lookup"><span data-stu-id="958cf-123">Be free.</span></span>
-   <span data-ttu-id="958cf-124">Avoir la même identité de sécurité que le handle de liaison sur lequel l’appel est effectué.</span><span class="sxs-lookup"><span data-stu-id="958cf-124">Have the same security identity as the binding handle on which the call is made.</span></span> <span data-ttu-id="958cf-125">Si le suivi dynamique des identités est utilisé, l’identité du descripteur de liaison est actualisée à partir du jeton de thread au début de l’appel.</span><span class="sxs-lookup"><span data-stu-id="958cf-125">If dynamic identity tracking is used, the identity of the binding handle is refreshed from the thread token at the beginning of the call.</span></span> <span data-ttu-id="958cf-126">Si le suivi d’identité statique est utilisé, l’identité du client marquée sur le handle de liaison est utilisée.</span><span class="sxs-lookup"><span data-stu-id="958cf-126">If static identity tracking is used, the client identity stamped on the binding handle is used.</span></span>

<span data-ttu-id="958cf-127">Lorsque l’appel est terminé, une fois la réponse reçue, la connexion est marquée comme étant libre et peut être utilisée pour d’autres appels RPC.</span><span class="sxs-lookup"><span data-stu-id="958cf-127">When the call is complete, once the response is received, the connection is marked as free and can be used for other RPC calls.</span></span>

<span data-ttu-id="958cf-128">Impossible de modifier l’identité de sécurité sur une connexion.</span><span class="sxs-lookup"><span data-stu-id="958cf-128">The security identity on a connection cannot change.</span></span> <span data-ttu-id="958cf-129">Par exemple, si un grand nombre d’appels au même serveur sont effectués sous différentes identités de sécurité, le nombre de connexions dans le pool de threads augmente.</span><span class="sxs-lookup"><span data-stu-id="958cf-129">For example, if a large number of calls to the same server are made under different security identities, the number of connections in the thread pool grows.</span></span> <span data-ttu-id="958cf-130">L’Association est comptée comme une référence, et lorsque toutes les références ont disparu, elle arrête et ferme toutes les connexions.</span><span class="sxs-lookup"><span data-stu-id="958cf-130">The association itself is reference-counted, and when all references are gone, it stops and closes all connections.</span></span> <span data-ttu-id="958cf-131">Chaque handle de liaison et chaque handle de contexte contiennent une référence sur l’Association.</span><span class="sxs-lookup"><span data-stu-id="958cf-131">Every binding handle and every context handle hold a reference on the association.</span></span> <span data-ttu-id="958cf-132">Lorsque tous les sont fermés, l’Association disparaît.</span><span class="sxs-lookup"><span data-stu-id="958cf-132">When all are closed, the association disappears.</span></span> <span data-ttu-id="958cf-133">Sur Windows XP, les associations ne disparaissent pas nécessairement immédiatement ; ils peuvent rester pendant une brève période (la période cible est de 20 secondes, mais le temps d’exécution RPC peut choisir de différer la destruction de l’Association si aucun thread n’est disponible pour l’exécution de la tâche).</span><span class="sxs-lookup"><span data-stu-id="958cf-133">On Windows XP, associations do not necessarily disappear immediately; they may remain for a short period (the target period is 20 seconds, but the RPC run time may choose to delay destroying the association if no threads are available to execute the task).</span></span> <span data-ttu-id="958cf-134">Si vous ne souhaitez pas que l’Association reste active après la fermeture du dernier handle de contexte/handle de liaison, utilisez l’option de désactivation de l’appel de procédure distante RPC \_ C \_ \_ \_ pour forcer le runtime RPC à fermer immédiatement la connexion.</span><span class="sxs-lookup"><span data-stu-id="958cf-134">If you do not want the association to stay alive after the last context handle/binding handle is closed, use the RPC\_C\_OPT\_DONT\_LINGER option to force the RPC Runtime to immediately close the connection.</span></span>

 

 




