---
title: Choix des options de QOS de sécurité
description: Les options QOS de sécurité sont transmises dans le cadre du paramètre SecurityQOS donné à la fonction RpcBindingSetAuthInfoEx. Utilisez les meilleures pratiques suivantes.
ms.assetid: 43befe3d-079a-4389-a1ff-6bda90935769
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8c286b516438eae78117ef8d73939c3b4bed396d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "106510090"
---
# <a name="choosing-security-qos-options"></a><span data-ttu-id="fec5a-104">Choix des options de QOS de sécurité</span><span class="sxs-lookup"><span data-stu-id="fec5a-104">Choosing Security QOS Options</span></span>

<span data-ttu-id="fec5a-105">Les options QOS de sécurité sont transmises dans le cadre du paramètre *SecurityQOS* donné à la fonction [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) .</span><span class="sxs-lookup"><span data-stu-id="fec5a-105">The security QOS options are passed as part of the *SecurityQOS* parameter given to the [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) function.</span></span> <span data-ttu-id="fec5a-106">Utilisez les meilleures pratiques suivantes.</span><span class="sxs-lookup"><span data-stu-id="fec5a-106">Use the following best practices.</span></span>

## <a name="use-mutual-authentication"></a><span data-ttu-id="fec5a-107">Utiliser l’authentification mutuelle</span><span class="sxs-lookup"><span data-stu-id="fec5a-107">Use Mutual Authentication</span></span>

<span data-ttu-id="fec5a-108">La véritable authentification mutuelle est disponible uniquement pour certains fournisseurs de sécurité : Negotiate (quand elle négocie Kerberos), Kerberos et Schannel.</span><span class="sxs-lookup"><span data-stu-id="fec5a-108">True mutual authentication is available only for certain security providers: Negotiate (when it negotiates Kerberos), Kerberos, and Schannel.</span></span> <span data-ttu-id="fec5a-109">NTLM ne prend pas en charge l’authentification mutuelle.</span><span class="sxs-lookup"><span data-stu-id="fec5a-109">NTLM does not support mutual authentication.</span></span> <span data-ttu-id="fec5a-110">L’authentification mutuelle requiert qu’un nom principal de serveur bien formé soit fourni.</span><span class="sxs-lookup"><span data-stu-id="fec5a-110">Using mutual authentication requires that a well formed server principal name be provided.</span></span> <span data-ttu-id="fec5a-111">De nombreux développeurs utilisent la pratique de sécurité défectueuse suivante : le serveur est appelé pour demander son nom principal ([**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)), puis il demande une authentification mutuelle à l’aide de ce nom principal.</span><span class="sxs-lookup"><span data-stu-id="fec5a-111">Many developers use the following faulty security practice: The server is called to ask for its principal name ([**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)), and then they blindly ask for mutual authentication using that principal name.</span></span> <span data-ttu-id="fec5a-112">Cette approche rompt l’idée entière de l’authentification mutuelle. l’idée de l’authentification mutuelle est que seuls certains serveurs sont appelés, car ils sont approuvés pour analyser et gérer vos données.</span><span class="sxs-lookup"><span data-stu-id="fec5a-112">This approach breaks the whole idea of mutual authentication; the idea of mutual authentication is that only certain servers are called because they are trusted to parse and handle your data.</span></span> <span data-ttu-id="fec5a-113">À l’aide de la pratique de sécurité défectueuse qui vient d’être décrite, les développeurs donnent leurs données à toute personne suffisamment intelligente pour retourner leur nom.</span><span class="sxs-lookup"><span data-stu-id="fec5a-113">Using the faulty security practice just described, developers give their data to anyone smart enough to return their name.</span></span>

<span data-ttu-id="fec5a-114">Par exemple, si le logiciel client doit appeler uniquement un serveur s’exécutant sous Joe, Pete ou les comptes d’Alice, la fonction [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname) doit être appelée et le nom renvoyé doit être vérifié.</span><span class="sxs-lookup"><span data-stu-id="fec5a-114">As an example, if the client software should call only a server running under Joe, Pete, or Alice's accounts, the [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname) function should be called, and the name sent back should be checked.</span></span> <span data-ttu-id="fec5a-115">S’il s’agit de Joe, Pete ou Alice, l’authentification mutuelle doit être demandée à l’aide de son nom principal de serveur.</span><span class="sxs-lookup"><span data-stu-id="fec5a-115">If it is Joe, Pete or Alice, mutual authentication should be requested using their server principal name.</span></span> <span data-ttu-id="fec5a-116">Cela permet de s’assurer que les deux moitiés de la conversation sont dirigées vers le même principal.</span><span class="sxs-lookup"><span data-stu-id="fec5a-116">This ensures both halves of the conversation go to the same principal.</span></span>

<span data-ttu-id="fec5a-117">Si le logiciel client doit appeler un service s’exécutant uniquement sous le compte de Jean, rédigez directement le nom principal du serveur de Joe et effectuez l’appel.</span><span class="sxs-lookup"><span data-stu-id="fec5a-117">If client software should call a service running under Joe's account only, directly compose Joe's server principal name and make the call.</span></span> <span data-ttu-id="fec5a-118">Si le serveur n’est pas Joe, l’appel échoue tout simplement.</span><span class="sxs-lookup"><span data-stu-id="fec5a-118">If the server is not Joe, the call will simply fail.</span></span>

<span data-ttu-id="fec5a-119">De nombreuses fois, les services s’exécutent en tant que services système Windows, ce qui signifie qu’ils s’exécutent sous le compte de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="fec5a-119">Many times, services run as Windows system services, which means they run under the machine account.</span></span> <span data-ttu-id="fec5a-120">L’authentification mutuelle et la création d’un nom principal de serveur sont toujours recommandées.</span><span class="sxs-lookup"><span data-stu-id="fec5a-120">Mutual authentication and creation of a server principal name is still recommended.</span></span>

## <a name="use-the-lowest-impersonationtype-that-allows-the-call-to-go-through"></a><span data-ttu-id="fec5a-121">Utiliser le ImpersonationType le plus bas qui autorise l’appel à passer</span><span class="sxs-lookup"><span data-stu-id="fec5a-121">Use the Lowest ImpersonationType that Allows the Call to Go Through</span></span>

<span data-ttu-id="fec5a-122">Cette meilleure pratique est assez explicite.</span><span class="sxs-lookup"><span data-stu-id="fec5a-122">This Best Practice is fairly self explanatory.</span></span> <span data-ttu-id="fec5a-123">Même si l’authentification mutuelle est utilisée, ne donnez pas au serveur plus de droits que nécessaire. un serveur légitime a peut-être été compromis, et même si les données que vous envoyez tombent dans de mauvaises mains, au moins le serveur ne pourra pas accéder à d’autres données sur le réseau à votre place.</span><span class="sxs-lookup"><span data-stu-id="fec5a-123">Even if mutual authentication is used, do not give the server more rights than necessary; a legitimate server may have been compromised, and even though the data you send falls into the wrong hands in such cases, at least the server will not be able to access other data on the network on your behalf.</span></span> <span data-ttu-id="fec5a-124">Certains serveurs rejetteront un appel qui ne dispose pas d’informations suffisantes pour déterminer et éventuellement emprunter l’identité de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="fec5a-124">Some servers will reject a call that does not have sufficient information to determine, and possibly impersonate, the caller.</span></span> <span data-ttu-id="fec5a-125">Sachez également que certaines séquences de protocole prennent en charge la sécurité au niveau du transport ([**ncacn \_ NP**](/windows/desktop/Midl/ncacn-np) et [**Ncalrpc**](/windows/desktop/Midl/ncalrpc)).</span><span class="sxs-lookup"><span data-stu-id="fec5a-125">Also, be aware that some protocol sequences support transport level security ([**ncacn\_np**](/windows/desktop/Midl/ncacn-np) and [**ncalrpc**](/windows/desktop/Midl/ncalrpc)).</span></span> <span data-ttu-id="fec5a-126">Dans ce cas, le serveur peut toujours emprunter l’identité si vous spécifiez un niveau d’emprunt d’identité suffisamment élevé par le biais du paramètre *NetworkOptions* lorsque vous créez le handle de liaison.</span><span class="sxs-lookup"><span data-stu-id="fec5a-126">In such cases, the server can always impersonate you if you specify a sufficiently high impersonation level through the *NetworkOptions* parameter when you create the binding handle.</span></span>

<span data-ttu-id="fec5a-127">Enfin, certains fournisseurs de sécurité ou transports peuvent enbosser de manière transparente ImpersonationType à un niveau supérieur à celui spécifié.</span><span class="sxs-lookup"><span data-stu-id="fec5a-127">Finally, some security providers or transports may transparently bump ImpersonationType to a higher level than that specified.</span></span> <span data-ttu-id="fec5a-128">Lors du développement d’un programme, assurez-vous d’effectuer des appels avec le ImpersonationType prévu et vérifiez si vous obtenez une ImpersonationType supérieure sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="fec5a-128">When developing a program, make sure you try to make calls with the intended ImpersonationType and check whether you are getting higher ImpersonationType on the server.</span></span>

 

 