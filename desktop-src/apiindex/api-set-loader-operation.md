---
description: Décrit comment Windows 10 utilise des ensembles d’API dans les opérations du chargeur.
title: Opération du chargeur de l’ensemble d’API
ms.topic: article
ms.date: 10/14/2020
ms.openlocfilehash: 701409c0d8dac2c275add06d2502c8764d502aba
ms.sourcegitcommit: bf526e267d3991892733bdd229c66d5365cf244a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/05/2021
ms.locfileid: "106525776"
---
# <a name="api-set-loader-operation"></a><span data-ttu-id="a7bb6-103">Opération du chargeur de l’ensemble d’API</span><span class="sxs-lookup"><span data-stu-id="a7bb6-103">API set loader operation</span></span>

<span data-ttu-id="a7bb6-104">Les [ensembles d’API](windows-apisets.md) s’appuient sur la prise en charge du système d’exploitation dans le chargeur de bibliothèque pour introduire efficacement une redirection d’espace de noms de module dans le processus de liaison de bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-104">[API sets](windows-apisets.md) rely on OS support in the library loader to effectively introduce a module namespace redirection into the library binding process.</span></span> <span data-ttu-id="a7bb6-105">Le [nom de contrat](windows-apisets.md#api-set-contract-names) de l’ensemble d’API est utilisé par le chargeur de bibliothèque pour effectuer une redirection du runtime de la référence à un fichier binaire hôte cible qui héberge l’implémentation appropriée de l’ensemble d’API.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-105">The [API set contract name](windows-apisets.md#api-set-contract-names) is used by library loader to perform a runtime redirection of the reference to a target host binary that houses the appropriate implementation of the API set.</span></span>

<span data-ttu-id="a7bb6-106">Lorsque le chargeur rencontre une dépendance sur un ensemble d’API au moment de l’exécution, le chargeur consulte les données de configuration dans l’image pour identifier le binaire de l’hôte pour un ensemble d’API.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-106">When the loader encounters a dependency on an API set at run time, the loader consults configuration data in the image to identify the host binary for an API set.</span></span> <span data-ttu-id="a7bb6-107">Ces données de configuration sont appelées le schéma de l' **ensemble d’API**.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-107">This configuration data is called the **API set schema**.</span></span> <span data-ttu-id="a7bb6-108">Le schéma est assemblé en tant que propriété du système d’exploitation, et le mappage entre les jeux d’API et les binaires peut varier en fonction des fichiers binaires inclus dans un appareil donné.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-108">The schema is assembled as a property of the OS, and the mapping between API sets and binaries may differ depending on which binaries are included in a given device.</span></span> <span data-ttu-id="a7bb6-109">Le schéma permet de router correctement une fonction importée dans un fichier binaire unique sur différents appareils, même si les noms des modules de l’hôte binaire ont été renommés ou complètement refactorisés sur des appareils Windows différents.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-109">The schema enables an imported function in a single binary to be routed correctly on different devices, even if the module names of the binary host have been renamed or completely refactored on different Windows devices.</span></span>

<span data-ttu-id="a7bb6-110">Windows 10 prend en charge deux techniques standard pour consommer et interagir avec les ensembles d’API : le **transfert direct** et le **transfert inverse**.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-110">Windows 10 supports two standard techniques to consume and interface with API sets: **direct forwarding** and **reverse forwarding**.</span></span>

### <a name="direct-forwarding"></a><span data-ttu-id="a7bb6-111">Transfert direct</span><span class="sxs-lookup"><span data-stu-id="a7bb6-111">Direct forwarding</span></span>

<span data-ttu-id="a7bb6-112">Dans cette configuration, le code de consommation importe directement un nom de module d’ensemble d’API.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-112">In this configuration, the consuming code imports an API set module name directly.</span></span> <span data-ttu-id="a7bb6-113">Cette importation est résolue en une seule opération et constitue la méthode la plus efficace avec la surcharge la plus faible.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-113">This import is resolved in a single operation, and is the most efficient method with the least overhead.</span></span> <span data-ttu-id="a7bb6-114">D’un point de vue conceptuel, cette solution peut pointer vers différents binaires sur différents appareils Windows 10, comme indiqué dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="a7bb6-114">Conceptually, this resolution may point to different binaries on different Windows 10 devices, as is shown in the following example:</span></span>

<span data-ttu-id="a7bb6-115">Ensemble d’API importé : **api-feature1-l1-1-0.dll**</span><span class="sxs-lookup"><span data-stu-id="a7bb6-115">Imported API set: **api-feature1-l1-1-0.dll**</span></span>
-  <span data-ttu-id="a7bb6-116">PC Windows-> **feature1.dll**</span><span class="sxs-lookup"><span data-stu-id="a7bb6-116">Windows PC -> **feature1.dll**</span></span>
-  <span data-ttu-id="a7bb6-117">HoloLens-> **feature1_holo.dll**</span><span class="sxs-lookup"><span data-stu-id="a7bb6-117">HoloLens -> **feature1_holo.dll**</span></span>
-  <span data-ttu-id="a7bb6-118">IoT-> **feature1_iot.dll**</span><span class="sxs-lookup"><span data-stu-id="a7bb6-118">IoT -> **feature1_iot.dll**</span></span>

<span data-ttu-id="a7bb6-119">Étant donné que les mappages sont conservés dans un référentiel de données de schéma personnalisé, cela signifie qu’un nom d’ensemble d’API qui se termine par **. dll** ne fait pas directement référence à un fichier sur le disque.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-119">Because the mappings are kept in a custom schema data repository, it means that an API set name that ends with **.dll** does not directly refer to a file on disk.</span></span> <span data-ttu-id="a7bb6-120">La partie **. dll** du nom de l’ensemble d’API est uniquement une convention requise par le chargeur.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-120">The **.dll** part of the API set name is only a convention required by the loader.</span></span> <span data-ttu-id="a7bb6-121">Le nom de l’ensemble d’API est plus similaire à un alias ou un nom virtuel pour un fichier DLL physique.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-121">The API set name is more like an alias or a virtual name for a physical DLL file.</span></span> <span data-ttu-id="a7bb6-122">Cela rend le nom portable sur la totalité de la plage d’appareils Windows 10.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-122">This makes the name portable across the entire range of Windows 10 devices.</span></span>

### <a name="reverse-forwarding"></a><span data-ttu-id="a7bb6-123">Transfert inversé</span><span class="sxs-lookup"><span data-stu-id="a7bb6-123">Reverse forwarding</span></span>

<span data-ttu-id="a7bb6-124">Bien que les noms des ensembles d’API fournissent un espace de noms stable pour les modules sur plusieurs appareils, il n’est pas toujours pratique de convertir chaque binaire en ce nouveau système.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-124">While API set names provide a stable namespace for modules across devices, it is not always practical to convert every binary to this new system.</span></span> <span data-ttu-id="a7bb6-125">Par exemple, une application peut avoir été couramment utilisée depuis de nombreuses années, et la recompilation des binaires de l’application peut ne pas être possible.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-125">For example, an application may have been in common use for many years, and recompiling the application's binaries may not be feasible.</span></span> <span data-ttu-id="a7bb6-126">En outre, il se peut que certaines applications doivent continuer à s’exécuter sur des systèmes générés avant l’introduction de jeux d’API spécifiques.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-126">Additionally, some applications may need to continue to run on systems built before specific API sets were introduced.</span></span>

<span data-ttu-id="a7bb6-127">Pour prendre en charge ce niveau de compatibilité, un système de *redirecteurs* est fourni sur tous les appareils Windows 10 qui couvrent un sous-ensemble de la surface de l’API Win32.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-127">To accommodate this level of compatibility, a system of *forwarders* are provided on all Windows 10 devices that cover a subset of the Win32 API surface.</span></span> <span data-ttu-id="a7bb6-128">Ces redirecteurs utilisent les noms des modules qui ont été introduits sur les PC Windows et exploitent le système d’ensemble d’API pour assurer la compatibilité sur tous les appareils Windows 10.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-128">These forwarders use the module names that were introduced on Windows PCs, and leverage the API Set system to provide compatibility across all Windows 10 devices.</span></span>

<span data-ttu-id="a7bb6-129">L’opération de chargeur se comporte comme suit :</span><span class="sxs-lookup"><span data-stu-id="a7bb6-129">The loader operation behaves like this:</span></span>

1.  <span data-ttu-id="a7bb6-130">Sur un appareil autre qu’un PC Windows, le chargeur affiche une dépendance de nom de module Windows PC héritée qui n’est pas présente sur l’appareil.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-130">On a device other than a Windows PC, the loader is presented a legacy Windows PC module name dependency that is not present on the device.</span></span>
2.  <span data-ttu-id="a7bb6-131">Le chargeur localise un redirecteur d’ensemble d’API pour ce module et le charge en mémoire.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-131">The loader locates an API set forwarder for this module and loads it into memory.</span></span>
3.  <span data-ttu-id="a7bb6-132">Le redirecteur a un mappage pour l’API définie pour la fonction donnée appelée.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-132">The forwarder has a mapping for the API set for the given function being called.</span></span>
4.  <span data-ttu-id="a7bb6-133">Le chargeur trouve le fichier binaire d’hôte approprié pour l’appareil donné.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-133">The loader finds the proper host binary for the given device.</span></span>

<span data-ttu-id="a7bb6-134">D’un plan conceptuel, le mappage ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="a7bb6-134">Conceptually, the mapping looks like:</span></span>

<span data-ttu-id="a7bb6-135">DLL importée : **feature1.dll**</span><span class="sxs-lookup"><span data-stu-id="a7bb6-135">Imported DLL: **feature1.dll**</span></span>
- <span data-ttu-id="a7bb6-136">PC Windows-> **feature1.dll**</span><span class="sxs-lookup"><span data-stu-id="a7bb6-136">Windows PC -> **feature1.dll**</span></span>
- <span data-ttu-id="a7bb6-137">HoloLens-> **feature1.dll** redirecteur-> **api-feature1-l1-1-0.dll**  ->  **feature1_holo.dll**</span><span class="sxs-lookup"><span data-stu-id="a7bb6-137">HoloLens -> **feature1.dll** forwarder -> **api-feature1-l1-1-0.dll** -> **feature1_holo.dll**</span></span>
- <span data-ttu-id="a7bb6-138">Redirecteur IOT-> **feature1.dll** > **api-feature1-l1-1-0.dll**  ->  **feature1_iot.dll**</span><span class="sxs-lookup"><span data-stu-id="a7bb6-138">IoT -> **feature1.dll** forwarder -> **api-feature1-l1-1-0.dll** -> **feature1_iot.dll**</span></span>

<span data-ttu-id="a7bb6-139">Le résultat final est le même que le [transfert direct](#direct-forwarding), mais il le remplit d’une manière qui optimise la compatibilité des applications.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-139">The end result is functionally the same as [direct forwarding](#direct-forwarding), but it accomplishes it in a way that maximizes application compatibility.</span></span>

> [!NOTE]
> <span data-ttu-id="a7bb6-140">Le transfert inverse fournit une couverture uniquement pour un sous-ensemble de la surface de l’API Win32.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-140">Reverse forwarding provides coverage only for a subset of the Win32 API surface.</span></span> <span data-ttu-id="a7bb6-141">Elle n’autorise pas les applications qui ciblent les versions de bureau de Windows 10 à s’exécuter sur tous les appareils Windows 10.</span><span class="sxs-lookup"><span data-stu-id="a7bb6-141">It does not allow applications that target desktop versions of Windows 10 to run on all Windows 10 devices.</span></span>
