---
description: Les objets regroupables doivent répondre à certaines exigences pour permettre l’utilisation d’une instance d’objet unique par plusieurs clients.
ms.assetid: 2cd4211e-be12-4197-8b43-5cb9f2321016
title: Conditions requises pour les objets regroupables
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78d6834210f180ad8b514b51b6926b5cd30714fd
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103950602"
---
# <a name="requirements-for-poolable-objects"></a><span data-ttu-id="d817f-103">Conditions requises pour les objets regroupables</span><span class="sxs-lookup"><span data-stu-id="d817f-103">Requirements for Poolable Objects</span></span>

<span data-ttu-id="d817f-104">Les objets regroupables doivent répondre à certaines exigences pour permettre l’utilisation d’une instance d’objet unique par plusieurs clients.</span><span class="sxs-lookup"><span data-stu-id="d817f-104">Poolable objects must meet certain requirements to enable a single object instance to be used by multiple clients.</span></span>

## <a name="stateless"></a><span data-ttu-id="d817f-105">Sans état</span><span class="sxs-lookup"><span data-stu-id="d817f-105">Stateless</span></span>

<span data-ttu-id="d817f-106">Pour assurer la sécurité, la cohérence et l’isolation, les objets regroupables ne doivent pas conserver un état spécifique au client du client au client.</span><span class="sxs-lookup"><span data-stu-id="d817f-106">To maintain security, consistency, and isolation, poolable objects should hold no client-specific state from client to client.</span></span> <span data-ttu-id="d817f-107">Vous pouvez gérer n’importe quel état par client à l’aide de [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), en effectuant une initialisation spécifique au contexte avec [**IObjectControl :: Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) et en nettoyant tout état du client avec [**IObjectControl ::D eactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate).</span><span class="sxs-lookup"><span data-stu-id="d817f-107">You can manage any per-client state by using [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), performing context-specific initialization with [**IObjectControl::Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) and cleaning up any client state with [**IObjectControl::Deactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate).</span></span> <span data-ttu-id="d817f-108">Pour plus d’informations, consultez contrôle de la [durée de vie et](controlling-object-lifetime-and-state.md)de l’état d’un objet.</span><span class="sxs-lookup"><span data-stu-id="d817f-108">For more detail, see [Controlling Object Lifetime and State](controlling-object-lifetime-and-state.md).</span></span>

## <a name="no-thread-affinity"></a><span data-ttu-id="d817f-109">Aucune affinité de thread</span><span class="sxs-lookup"><span data-stu-id="d817f-109">No Thread Affinity</span></span>

<span data-ttu-id="d817f-110">Les objets regroupables ne peuvent pas être liés à un thread particulier ; dans le cas contraire, les performances peuvent être désastreuses.</span><span class="sxs-lookup"><span data-stu-id="d817f-110">Poolable objects cannot be bound to a particular thread; otherwise, performance could be potentially disastrous.</span></span> <span data-ttu-id="d817f-111">Pour cette raison, les objets regroupables ne peuvent pas être marqués pour s’exécuter dans le modèle cloisonné ; ils doivent s’exécuter dans le cloisonnement multithread ou le cloisonnement neutre.</span><span class="sxs-lookup"><span data-stu-id="d817f-111">For this reason, poolable objects cannot be marked to run in the apartment model; they must run in the multithreaded apartment or the neutral apartment.</span></span> <span data-ttu-id="d817f-112">En outre, les objets regroupables ne doivent pas utiliser le stockage local des threads et ne doivent pas agréger le marshaleur libre de threads.</span><span class="sxs-lookup"><span data-stu-id="d817f-112">In addition, poolable objects should not use thread local storage nor should they aggregate the free-threaded marshaler.</span></span> <span data-ttu-id="d817f-113">Pour plus d’informations sur les threads dans COM+, consultez [modèles de thread com+](com--threading-models.md).</span><span class="sxs-lookup"><span data-stu-id="d817f-113">For more detail about threading in COM+, see [COM+ Threading Models](com--threading-models.md).</span></span>

> [!Note]  
> <span data-ttu-id="d817f-114">Les environnements de développement Microsoft Visual Basic 6,0 et versions antérieures peuvent créer uniquement des composants de modèle cloisonné.</span><span class="sxs-lookup"><span data-stu-id="d817f-114">The Microsoft Visual Basic 6.0 and earlier development environments can create only apartment model components.</span></span> <span data-ttu-id="d817f-115">Toutefois, dans Visual Basic .NET, les composants peuvent être regroupés.</span><span class="sxs-lookup"><span data-stu-id="d817f-115">However, in Visual Basic .NET, components can be pooled.</span></span>

 

## <a name="aggregatable"></a><span data-ttu-id="d817f-116">Aggregatable</span><span class="sxs-lookup"><span data-stu-id="d817f-116">Aggregatable</span></span>

<span data-ttu-id="d817f-117">Les objets regroupables doivent prendre en charge l’agrégation, autrement dit, ils doivent prendre en charge la création en appelant [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) avec un argument *pUnkOuter* non null.</span><span class="sxs-lookup"><span data-stu-id="d817f-117">Poolable objects must support aggregation—that is, they must support being created by invoking [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) with a non-NULL *pUnkOuter* argument.</span></span> <span data-ttu-id="d817f-118">Lorsque COM+ active un objet mis en pool, il crée un agrégat pour gérer la durée de vie de l’objet regroupé et pour appeler des méthodes sur [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol).</span><span class="sxs-lookup"><span data-stu-id="d817f-118">When COM+ activates a pooled object, it creates an aggregate to manage the lifetime of the pooled object and to call methods on [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol).</span></span> <span data-ttu-id="d817f-119">Pour plus d’informations sur l’écriture d’objets agrégés, consultez [agrégation](/windows/desktop/com/aggregation).</span><span class="sxs-lookup"><span data-stu-id="d817f-119">For details on writing aggregatable objects, see [Aggregation](/windows/desktop/com/aggregation).</span></span>

## <a name="transactional-components"></a><span data-ttu-id="d817f-120">Composants transactionnels</span><span class="sxs-lookup"><span data-stu-id="d817f-120">Transactional Components</span></span>

<span data-ttu-id="d817f-121">Les objets regroupables qui participent à des transactions doivent inscrire manuellement les ressources managées.</span><span class="sxs-lookup"><span data-stu-id="d817f-121">Poolable objects that participate in transactions must manually enlist managed resources.</span></span> <span data-ttu-id="d817f-122">Lorsqu’il est mis en pool, si votre objet contient une ressource managée telle qu’une connexion de base de données, il n’est pas possible que le gestionnaire de ressources s’inscrive automatiquement dans une transaction lorsque l’objet est activé dans le contexte donné.</span><span class="sxs-lookup"><span data-stu-id="d817f-122">While it is pooled, if your object holds a managed resource such as a database connection, there will be no way for the resource manager to automatically enlist in a transaction when the object is activated in given context.</span></span> <span data-ttu-id="d817f-123">Par conséquent, l’objet lui-même doit gérer la logique de la détection de la transaction, la désactivation de l’inscription automatique de Resource Manager et l’inscription manuelle des ressources qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="d817f-123">Therefore, the object itself must handle the logic of detecting the transaction, turning off the resource manager's auto-enlistment and manually enlisting any resources that it holds.</span></span> <span data-ttu-id="d817f-124">En outre, un objet mis en pool transactionnel doit refléter l’état actuel de ses ressources dans les valeurs de paramètre de [**IObjectControl :: CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled).</span><span class="sxs-lookup"><span data-stu-id="d817f-124">In addition, a transactional pooled object should reflect the current state of its resources in the parameter values of [**IObjectControl::CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled).</span></span> <span data-ttu-id="d817f-125">Pour plus d’informations, consultez [regroupement d’objets transactionnels](pooling-transactional-objects.md).</span><span class="sxs-lookup"><span data-stu-id="d817f-125">For more detail, see [Pooling Transactional Objects](pooling-transactional-objects.md).</span></span>

## <a name="implement-iobjectcontrol-to-manage-the-object-lifetime"></a><span data-ttu-id="d817f-126">Implémentez IObjectControl pour gérer la durée de vie des objets</span><span class="sxs-lookup"><span data-stu-id="d817f-126">Implement IObjectControl to Manage the Object Lifetime</span></span>

<span data-ttu-id="d817f-127">Les objets regroupables doivent implémenter [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), bien qu’il ne soit pas strictement nécessaire de le faire.</span><span class="sxs-lookup"><span data-stu-id="d817f-127">Poolable objects should implement [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), although it is not strictly necessary to do so.</span></span> <span data-ttu-id="d817f-128">Toutefois, les composants transactionnels regroupés doivent implémenter **IObjectControl**.</span><span class="sxs-lookup"><span data-stu-id="d817f-128">Transactional components that are pooled, however, must implement **IObjectControl**.</span></span> <span data-ttu-id="d817f-129">Ces composants doivent surveiller l’état des ressources qu’ils contiennent et indiquer quand ils ne peuvent pas être réutilisés. Lorsque [**IObjectControl :: CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) retourne false, une transaction est arrête.</span><span class="sxs-lookup"><span data-stu-id="d817f-129">These components should monitor the state of the resources they hold and indicate when they can't be reused; when [**IObjectControl::CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) returns false, it will doom a transaction.</span></span> <span data-ttu-id="d817f-130">Pour plus d’informations, consultez contrôle de la [durée de vie et](controlling-object-lifetime-and-state.md)de l’état d’un objet.</span><span class="sxs-lookup"><span data-stu-id="d817f-130">For more detail, see [Controlling Object Lifetime and State](controlling-object-lifetime-and-state.md).</span></span>

## <a name="language-restrictions"></a><span data-ttu-id="d817f-131">Restrictions de langue</span><span class="sxs-lookup"><span data-stu-id="d817f-131">Language Restrictions</span></span>

<span data-ttu-id="d817f-132">Les composants développés à l’aide de Microsoft Visual Basic 6,0 et versions antérieures ne peuvent pas être mis en pool, car ces composants sont des threads cloisonnés.</span><span class="sxs-lookup"><span data-stu-id="d817f-132">Components developed using Microsoft Visual Basic 6.0 and earlier cannot be pooled because these components will be apartment-model threaded.</span></span> <span data-ttu-id="d817f-133">Toutefois, dans Visual Basic .NET, les composants peuvent être regroupés.</span><span class="sxs-lookup"><span data-stu-id="d817f-133">However, in Visual Basic .NET, components can be pooled.</span></span>

## <a name="legacy-components"></a><span data-ttu-id="d817f-134">Composants hérités</span><span class="sxs-lookup"><span data-stu-id="d817f-134">Legacy Components</span></span>

<span data-ttu-id="d817f-135">Tant qu’elles ne sont pas transactionnelles et conformes aux exigences précédentes appropriées, les composants peuvent être regroupés même s’ils n’ont pas été spécifiquement écrits avec la fonctionnalité de regroupement à l’esprit.</span><span class="sxs-lookup"><span data-stu-id="d817f-135">As long as they are non-transactional and conform to the appropriate preceding requirements, components can be pooled even if they were not specifically written with pooling capability in mind.</span></span> <span data-ttu-id="d817f-136">Il n’est pas nécessaire d’implémenter [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol); un composant qui ne le fait pas ne participe pas tout simplement à la gestion de sa durée de vie.</span><span class="sxs-lookup"><span data-stu-id="d817f-136">It is not necessary to implement [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol); a component that does not do so simply won't participate in managing its lifetime.</span></span> <span data-ttu-id="d817f-137">Si [**IObjectControl :: CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) n’est pas implémenté, l’objet continuera à être réutilisé jusqu’à ce que le pool atteigne la taille maximale.</span><span class="sxs-lookup"><span data-stu-id="d817f-137">If [**IObjectControl::CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) is not implemented, the object will continue to be reused until the pool attains maximum size.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d817f-138">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="d817f-138">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d817f-139">Chaînes du constructeur d’objet COM+</span><span class="sxs-lookup"><span data-stu-id="d817f-139">COM+ Object Constructor Strings</span></span>](com--object-constructor-strings.md)
</dt> <dt>

[<span data-ttu-id="d817f-140">Contrôle de la durée de vie et de l’état des objets</span><span class="sxs-lookup"><span data-stu-id="d817f-140">Controlling Object Lifetime and State</span></span>](controlling-object-lifetime-and-state.md)
</dt> <dt>

[<span data-ttu-id="d817f-141">Fonctionnement du regroupement d’objets</span><span class="sxs-lookup"><span data-stu-id="d817f-141">How Object Pooling Works</span></span>](how-object-pooling-works.md)
</dt> <dt>

[<span data-ttu-id="d817f-142">Amélioration des performances avec la mise en pool d’objets</span><span class="sxs-lookup"><span data-stu-id="d817f-142">Improving Performance with Object Pooling</span></span>](improving-performance-with-object-pooling.md)
</dt> <dt>

[<span data-ttu-id="d817f-143">Regroupement d’objets transactionnels</span><span class="sxs-lookup"><span data-stu-id="d817f-143">Pooling Transactional Objects</span></span>](pooling-transactional-objects.md)
</dt> </dl>

 

 
