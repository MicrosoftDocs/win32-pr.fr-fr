---
description: Dans COM+, chaque objet COM est créé avec un contexte associé.
ms.assetid: e5602af2-5852-4c34-a792-6742e90b7d41
title: Activation du contexte
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a652615d6c1288887085c857817e32e3a3b4081c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104111034"
---
# <a name="context-activation"></a><span data-ttu-id="a1577-103">Activation du contexte</span><span class="sxs-lookup"><span data-stu-id="a1577-103">Context Activation</span></span>

<span data-ttu-id="a1577-104">Dans COM+, chaque objet COM est créé avec un contexte associé.</span><span class="sxs-lookup"><span data-stu-id="a1577-104">In COM+, every COM object is created with an associated context.</span></span> <span data-ttu-id="a1577-105">Cela signifie qu’un nouveau contexte doit être créé et initialisé ou qu’un contexte existant approprié est utilisé.</span><span class="sxs-lookup"><span data-stu-id="a1577-105">This means that either a new context must be created and initialized or an appropriate existing context is used.</span></span> <span data-ttu-id="a1577-106">Ce processus est appelé *activation*.</span><span class="sxs-lookup"><span data-stu-id="a1577-106">This process is known as *activation*.</span></span> <span data-ttu-id="a1577-107">Dans COM+, un objet est activé dans son propre contexte ou dans celui de son créateur (un objet qui a demandé l’activation de l’objet, par exemple, en appelant [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance)).</span><span class="sxs-lookup"><span data-stu-id="a1577-107">In COM+, an object is activated either in its own context or in that of its creator (an object that has requested that the object be activated—for example, by calling [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance)).</span></span>

<span data-ttu-id="a1577-108">Dans certains cas, par exemple avec le [regroupement d’objets](com--object-pooling.md), un objet est activé sans être créé à partir de zéro.</span><span class="sxs-lookup"><span data-stu-id="a1577-108">In some circumstances, such as with [object pooling](com--object-pooling.md), an object is activated without being created from scratch.</span></span> <span data-ttu-id="a1577-109">Dans ce cas, une instance en cours d’exécution est activée dans un contexte.</span><span class="sxs-lookup"><span data-stu-id="a1577-109">In this case, a running instance is activated within a context.</span></span> <span data-ttu-id="a1577-110">Pendant sa durée de vie, il peut être activé à plusieurs reprises dans différents contextes.</span><span class="sxs-lookup"><span data-stu-id="a1577-110">Over its lifetime, it may be repeatedly activated in different contexts.</span></span>

<span data-ttu-id="a1577-111">Le mécanisme de base est le même dans les deux cas : un objet est associé à un contexte et ce contexte est correctement initialisé pour représenter les besoins de l’objet au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="a1577-111">The basic mechanism is the same in either case—an object is associated with a context and that context is properly initialized to represent the run-time needs of the object.</span></span>

## <a name="flowing-of-context-properties"></a><span data-ttu-id="a1577-112">Déplacement des propriétés de contexte</span><span class="sxs-lookup"><span data-stu-id="a1577-112">Flowing of Context Properties</span></span>

<span data-ttu-id="a1577-113">Lorsqu’un objet est activé en réponse à une demande de création d’un autre objet, COM+ doit effectuer un médiateur entre eux pour activer correctement l’objet en aval.</span><span class="sxs-lookup"><span data-stu-id="a1577-113">When an object is being activated in response to a creation request from another object, COM+ needs to mediate between them to properly activate the downstream object.</span></span> <span data-ttu-id="a1577-114">COM+ doit comparer le contexte de l’appelant avec la configuration du composant appelé, puis décider où activer le composant en aval et comment initialiser ses propriétés de contexte.</span><span class="sxs-lookup"><span data-stu-id="a1577-114">COM+ has to compare the context of the caller with the configuration of the called component and then decide where to activate the downstream component and how to initialize its context properties.</span></span>

<span data-ttu-id="a1577-115">Pour découvrir la configuration du composant, COM+ le recherche dans la base de données d’inscription de classe COM+, qui est optimisée pour les recherches à temps d’exécution extrêmement rapides.</span><span class="sxs-lookup"><span data-stu-id="a1577-115">To discover the component's configuration, COM+ looks it up in the COM+ class registration database, which is optimized for extremely fast run-time lookups.</span></span> <span data-ttu-id="a1577-116">(Cela est déterminé par la façon dont vous avez configuré un composant lors de son installation dans une application COM+.) La configuration du composant est ensuite examinée par rapport à l’état des propriétés de contexte de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="a1577-116">(This is determined by how you configured a component when installing it into a COM+ application.) The component's configuration is then examined against the state of the caller's context properties.</span></span>

<span data-ttu-id="a1577-117">Dans certains cas, la configuration est cohérente avec le contexte de l’appelant et le composant peut être activé dans le contexte de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="a1577-117">In some cases, the configuration is consistent with the context of the caller and the component can be activated within the caller's context.</span></span> <span data-ttu-id="a1577-118">Cela peut se produire uniquement si le contexte de l’appelant remplit toutes les conditions d’exécution du nouvel objet.</span><span class="sxs-lookup"><span data-stu-id="a1577-118">This can happen only if the caller's context satisfies all the run-time requirements of the new object.</span></span>

<span data-ttu-id="a1577-119">Lorsque le composant en aval ne peut pas être activé dans le contexte de l’appelant, il est activé dans son propre contexte dans un cloisonnement approprié.</span><span class="sxs-lookup"><span data-stu-id="a1577-119">When the downstream component cannot be activated within the caller's context, it is activated in its own context in an appropriate apartment.</span></span> <span data-ttu-id="a1577-120">Lorsque cela se produit, certaines propriétés de contexte peuvent être acheminées de l’appelant vers l’appelé.</span><span class="sxs-lookup"><span data-stu-id="a1577-120">When this occurs, certain context properties may flow from caller to callee.</span></span> <span data-ttu-id="a1577-121">Par exemple, si l’appelant est associé à une transaction et que l’appelé prend en charge les transactions, le nouvel objet obtient son propre contexte (pour voter dans la transaction, il doit avoir son propre indicateur cohérent) et hérite de l’ID de transaction et de l’ID d’activité de l’appelant (qui se trouvent dans la même transaction et le même domaine de synchronisation).</span><span class="sxs-lookup"><span data-stu-id="a1577-121">For example, if the caller is associated with a transaction and the callee supports transactions, the new object gets its own context (to vote in the transaction, it needs to have its own consistent flag) and inherits the caller's transaction ID and activity ID (which reside within the same transaction and synchronization domain).</span></span>

## <a name="ignored-context-properties"></a><span data-ttu-id="a1577-122">Propriétés de contexte ignorées</span><span class="sxs-lookup"><span data-stu-id="a1577-122">Ignored Context Properties</span></span>

<span data-ttu-id="a1577-123">En fonction du mode de configuration d’un composant, certaines propriétés de contexte peuvent ne jouer aucun rôle pour déterminer si elles sont activées dans le contexte du créateur ou dans son propre contexte.</span><span class="sxs-lookup"><span data-stu-id="a1577-123">Depending on how a component is configured, some context properties may play no role in determining whether it is activated in the creator's context or its own context.</span></span> <span data-ttu-id="a1577-124">Par exemple, les paramètres transactions désactivées et synchronisation désactivée, indiquant la présence d’une transaction ou d’un domaine de synchronisation, ne joueront aucun rôle dans l’activation du composant.</span><span class="sxs-lookup"><span data-stu-id="a1577-124">For example, the Transactions Disabled and Synchronization Disabled settings, indicating the presence of a transaction or a synchronization domain, will play no role whatsoever in the component's activation.</span></span> <span data-ttu-id="a1577-125">Ces propriétés sont ignorées de façon fondamentale lorsque le contexte est transmis.</span><span class="sxs-lookup"><span data-stu-id="a1577-125">These properties are fundamentally ignored when context is flowed.</span></span> <span data-ttu-id="a1577-126">Si un composant utilise uniquement la vérification de l’accès au niveau du processus, sa propriété de contexte de sécurité est ignorée ; la configuration de sécurité du composant ne joue jamais un rôle dans son activation.</span><span class="sxs-lookup"><span data-stu-id="a1577-126">Or if a component uses only process-level access checking, its security context property is ignored—the component's security configuration will never play a role in its activation.</span></span>

## <a name="forcing-activation-in-the-callers-context"></a><span data-ttu-id="a1577-127">Forcer l’activation dans le contexte de l’appelant</span><span class="sxs-lookup"><span data-stu-id="a1577-127">Forcing Activation in the Caller's Context</span></span>

<span data-ttu-id="a1577-128">Dans certains cas, vous souhaiterez peut-être activer un objet uniquement dans le contexte de son appelant, autrement dit, jamais activé dans son propre contexte.</span><span class="sxs-lookup"><span data-stu-id="a1577-128">In some circumstances, you might want an object to be activated only in its caller's context—that is, never activated in its own context.</span></span> <span data-ttu-id="a1577-129">Par exemple, vous souhaiterez peut-être contrôler le comportement de l’objet lorsqu’il est appelé sur une limite de contexte.</span><span class="sxs-lookup"><span data-stu-id="a1577-129">For example, you might want to control the object's behavior when it's called across a context boundary.</span></span>

<span data-ttu-id="a1577-130">Vous pouvez vous assurer qu’un objet ne peut pas être activé dans son propre contexte en sélectionnant l’option **doit être activé dans le contexte des appelants** sous l’onglet **activation** de la page **Propriétés** du composant, à l’aide de l’outil d’administration Services de composants.</span><span class="sxs-lookup"><span data-stu-id="a1577-130">You can ensure that an object cannot be activated in its own context by selecting the **Must be activated in callers context** option on the **Activation** tab of the component **Properties** page, using the Component Services administrative tool.</span></span> <span data-ttu-id="a1577-131">(Pour obtenir des instructions pas à pas, consultez [application de l’activation dans le contexte de l’appelant](enforcing-activation-in-the-caller-s-context.md) .) Lorsque vous sélectionnez cette option, si l’objet ne peut pas être activé dans le contexte de l’appelant, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) échoue et retourne co \_ E \_ tentative \_ de création d’un \_ \_ \_ contexte client extérieur \_ .</span><span class="sxs-lookup"><span data-stu-id="a1577-131">(See [Enforcing Activation in the Caller's Context](enforcing-activation-in-the-caller-s-context.md) for step-by-step instructions.) When you select this option, if the object cannot be activated in the caller's context, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) fails, returning CO\_E\_ATTEMPT\_TO\_CREATE\_OUTSIDE\_CLIENT\_CONTEXT.</span></span>

## <a name="default-context"></a><span data-ttu-id="a1577-132">Contexte par défaut</span><span class="sxs-lookup"><span data-stu-id="a1577-132">Default Context</span></span>

<span data-ttu-id="a1577-133">Les contextes par défaut existent pour prendre en charge les composants non configurés, c’est-à-dire les composants COM qui ne sont pas installés dans les applications COM+ et qui ne sont pas enregistrés dans la base de données d’inscription de classe COM+.</span><span class="sxs-lookup"><span data-stu-id="a1577-133">Default contexts exist to support unconfigured components—that is, COM components not installed in COM+ applications and not registered in the COM+ class registration database.</span></span> <span data-ttu-id="a1577-134">Si les composants non configurés ont un modèle de thread compatible, ils sont activés dans le contexte de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="a1577-134">If unconfigured components have a compatible threading model, they are activated in the caller's context.</span></span> <span data-ttu-id="a1577-135">Dans le cas contraire, ils sont activés dans un contexte par défaut dans le cloisonnement approprié.</span><span class="sxs-lookup"><span data-stu-id="a1577-135">Otherwise, they are activated in a default context in the appropriate apartment.</span></span> <span data-ttu-id="a1577-136">Chaque cloisonnement a un contexte par défaut pour prendre en charge les objets COM qui n’utilisent pas les services COM+.</span><span class="sxs-lookup"><span data-stu-id="a1577-136">Each apartment has a default context to support COM objects that do not use COM+ services.</span></span>

## <a name="hooking-activation"></a><span data-ttu-id="a1577-137">Activation du raccordement</span><span class="sxs-lookup"><span data-stu-id="a1577-137">Hooking Activation</span></span>

<span data-ttu-id="a1577-138">En implémentant [**IObjectControl :: Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) et [**IObjectControl ::D eactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate), vous pouvez raccorder l’activation et la désactivation ensemble pour effectuer une initialisation spéciale dans le nouveau contexte.</span><span class="sxs-lookup"><span data-stu-id="a1577-138">By implementing [**IObjectControl::Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) and [**IObjectControl::Deactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate), you can hook activation and deactivation together to perform special initialization in the new context.</span></span> <span data-ttu-id="a1577-139">Ces méthodes sont appelées par COM+ à certains stades du cycle de vie d’un objet, lorsque l’objet est configuré pour utiliser l’activation JIT ou le regroupement d’objets.</span><span class="sxs-lookup"><span data-stu-id="a1577-139">These methods are called by COM+ at certain points in an object's lifecycle, when the object is configured to use JIT-activation or object pooling.</span></span> <span data-ttu-id="a1577-140">Pour plus d’informations, consultez [activation juste-à-temps de com+](com--just-in-time-activation.md) et mise en [pool d’objets com+](com--object-pooling.md) .</span><span class="sxs-lookup"><span data-stu-id="a1577-140">See [COM+ Just-in-Time Activation](com--just-in-time-activation.md) and [COM+ Object Pooling](com--object-pooling.md) for more detail.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a1577-141">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="a1577-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a1577-142">Interception d’appels entre les contextes</span><span class="sxs-lookup"><span data-stu-id="a1577-142">Interception of Cross-Context Calls</span></span>](interception-of-cross-context-calls.md)
</dt> </dl>

 

 
