---
description: Cette rubrique identifie plusieurs stratégies de gestion des erreurs à garder à l’esprit lorsque vous développez des composants pour COM+.
ms.assetid: 1ae5875b-8085-44f2-9071-c2a5d7543ac1
title: Stratégies de gestion des erreurs dans COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91ca64546683fa45ac8df3bcb47534d8de482798
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106516568"
---
# <a name="strategies-for-handling-errors-in-com"></a><span data-ttu-id="f97e1-103">Stratégies de gestion des erreurs dans COM+</span><span class="sxs-lookup"><span data-stu-id="f97e1-103">Strategies for Handling Errors in COM+</span></span>

<span data-ttu-id="f97e1-104">Cette rubrique identifie plusieurs stratégies de gestion des erreurs à garder à l’esprit lorsque vous développez des composants pour COM+.</span><span class="sxs-lookup"><span data-stu-id="f97e1-104">This topic identifies several error-handling strategies to keep in mind as you develop components for COM+.</span></span>

-   <span data-ttu-id="f97e1-105">**Retourne une valeur HRESULT pour toutes les méthodes dans toutes les interfaces de composant.**</span><span class="sxs-lookup"><span data-stu-id="f97e1-105">**Return an HRESULT value for all methods in all component interfaces.**</span></span>  <span data-ttu-id="f97e1-106">COM+ utilise des valeurs **HRESULT** pour signaler les erreurs lors de l’exécution d’appels de fonction ou d’appels de méthode d’interface.</span><span class="sxs-lookup"><span data-stu-id="f97e1-106">COM+ uses **HRESULT** values to report on any errors in making function calls or interface method calls.</span></span> <span data-ttu-id="f97e1-107">Un **HRESULT** indique si une méthode a réussi ou échoué et identifie la fonction associée à l’erreur, telle que RPC, Win32 ou ITF pour les erreurs spécifiques à l’interface.</span><span class="sxs-lookup"><span data-stu-id="f97e1-107">An **HRESULT** indicates whether a method succeeded or failed and identifies the facility associated with the error, such as RPC, WIN32, or ITF for interface-specific errors.</span></span> <span data-ttu-id="f97e1-108">En outre, les API système fournissent une recherche d’une valeur **HRESULT** à une chaîne qui décrit la condition d’erreur.</span><span class="sxs-lookup"><span data-stu-id="f97e1-108">Also, system APIs provide a lookup from an **HRESULT** to a string that describes the error condition.</span></span> <span data-ttu-id="f97e1-109">L’utilisation de méthodes qui retournent des valeurs **HRESULT** est fondamentale pour les composants bien écrits et est essentielle au processus de débogage.</span><span class="sxs-lookup"><span data-stu-id="f97e1-109">Using methods that return **HRESULT** values are fundamental to well-written components and are essential to the debugging process.</span></span> <span data-ttu-id="f97e1-110">Microsoft Visual Basic définit automatiquement chaque méthode avec un **HRESULT** comme retour.</span><span class="sxs-lookup"><span data-stu-id="f97e1-110">Microsoft Visual Basic automatically defines each method with an **HRESULT** as a return.</span></span> <span data-ttu-id="f97e1-111">Dans Microsoft Visual C++, vous devez retourner explicitement un **HRESULT**.</span><span class="sxs-lookup"><span data-stu-id="f97e1-111">In Microsoft Visual C++, you must explicitly return an **HRESULT**.</span></span> <span data-ttu-id="f97e1-112">Pour plus d’informations sur les valeurs HRESULT, consultez [structure des codes d’erreur com](/windows/desktop/com/structure-of-com-error-codes).</span><span class="sxs-lookup"><span data-stu-id="f97e1-112">For additional information on HRESULTs, see [Structure of COM Error Codes](/windows/desktop/com/structure-of-com-error-codes).</span></span>
-   <span data-ttu-id="f97e1-113">**Lancez l’objet de collection ErrorInfo en fonction de ce que fournit votre outil de développement.**</span><span class="sxs-lookup"><span data-stu-id="f97e1-113">**Initiate the ErrorInfo collection object by whatever means your development tool provides.**</span></span> <span data-ttu-id="f97e1-114">Les objets de collection [**errorInfo**](errorinfo.md) sont souvent appelés exceptions com, car ils permettent à un objet de passer (ou d’envoyer) des informations d’erreur riches à son appelant, même au-delà des limites de cloisonnement.</span><span class="sxs-lookup"><span data-stu-id="f97e1-114">[**ErrorInfo**](errorinfo.md) collection objects are often called COM exceptions because they allow an object to pass (or throw) rich error information to its caller, even across apartment boundaries.</span></span> <span data-ttu-id="f97e1-115">La valeur de cet objet d’erreur générique est qu’il complète un HRESULT, en étendant le type d’informations d’erreur que vous pouvez retourner à un appelant.</span><span class="sxs-lookup"><span data-stu-id="f97e1-115">The value of this generic error object is that it supplements an HRESULT, extending the type of error information that you can return to a caller.</span></span> <span data-ttu-id="f97e1-116">Chaque objet de collection **errorInfo** retourne une description contextuelle, la source de l’erreur et l’identificateur d’interface de la méthode à l’origine de l’erreur.</span><span class="sxs-lookup"><span data-stu-id="f97e1-116">Each **ErrorInfo** collection object returns a contextual description, the source of the error, and the interface identifier of the method that originated the error.</span></span> <span data-ttu-id="f97e1-117">Vous pouvez également inclure des pointeurs vers une entrée dans un fichier d’aide.</span><span class="sxs-lookup"><span data-stu-id="f97e1-117">You can also include pointers to an entry in a help file.</span></span> <span data-ttu-id="f97e1-118">Automation fournit trois interfaces pour gérer l’objet d’erreur.</span><span class="sxs-lookup"><span data-stu-id="f97e1-118">Automation provides three interfaces to manage the error object.</span></span> <span data-ttu-id="f97e1-119">Votre composant doit implémenter l’interface d’automatisation **ISupportErrorInfo** pour annoncer sa prise en charge pour la collection **errorInfo** .</span><span class="sxs-lookup"><span data-stu-id="f97e1-119">Your component must implement the **ISupportErrorInfo** Automation interface to advertise its support for the **ErrorInfo** collection.</span></span> <span data-ttu-id="f97e1-120">Lorsqu’une erreur se produit, le composant utilise l’interface d’automatisation **ICreateErrorInfo** pour initialiser un objet d’erreur.</span><span class="sxs-lookup"><span data-stu-id="f97e1-120">When an error occurs, the component uses the **ICreateErrorInfo** Automation interface to initialize an error object.</span></span> <span data-ttu-id="f97e1-121">Une fois que l’appelant a inspecté la valeur HRESULT et a détecté que l’appel de la méthode a échoué, il interroge l’objet pour voir s’il prend en charge la collection **errorInfo** .</span><span class="sxs-lookup"><span data-stu-id="f97e1-121">After the caller inspects the HRESULT and finds that the method call failed, it queries the object to see whether it supports the **ErrorInfo** collection.</span></span> <span data-ttu-id="f97e1-122">Si c’est le cas, l’appelant utilise l’interface d’automatisation **IErrorInfo** pour récupérer les informations sur l’erreur.</span><span class="sxs-lookup"><span data-stu-id="f97e1-122">If it does, the caller uses the **IErrorInfo** Automation interface to retrieve the error information.</span></span> <span data-ttu-id="f97e1-123">Visual Basic programmeurs ont un accès facile à l’objet de collection **errorInfo** , qui est exposé via l’objet Err.</span><span class="sxs-lookup"><span data-stu-id="f97e1-123">Visual Basic programmers have easy access to the **ErrorInfo** collection object, which is exposed through the Err object.</span></span> <span data-ttu-id="f97e1-124">Vous pouvez déclencher des erreurs avec la fonction Err Raise et intercepter les erreurs avec l’instruction **On Error** .</span><span class="sxs-lookup"><span data-stu-id="f97e1-124">You can raise errors with the Err Raise function and catch errors with the **On Error** statement.</span></span> <span data-ttu-id="f97e1-125">La couche d’exécution Visual Basic prend en charge le mappage pour vous.</span><span class="sxs-lookup"><span data-stu-id="f97e1-125">The Visual Basic run-time layer takes care of the mapping for you.</span></span> <span data-ttu-id="f97e1-126">Si vous utilisez la prise en charge du compilateur COM Visual C++, vous pouvez utiliser la \_ \_ \_ classe d’erreur com Raise pour signaler une erreur et la \_ \_ classe d’erreur com pour récupérer les informations d’erreur.</span><span class="sxs-lookup"><span data-stu-id="f97e1-126">If you are using the Visual C++ COM compiler support, you can use the \_com\_raise\_error class to report an error and the \_com\_error class to retrieve error information.</span></span> <span data-ttu-id="f97e1-127">COM+ ne propage pas les exceptions C++ traditionnelles en tant qu’informations **IErrorInfo** étendues.</span><span class="sxs-lookup"><span data-stu-id="f97e1-127">COM+ will not propagate traditional C++ exceptions as extended **IErrorInfo** information.</span></span> <span data-ttu-id="f97e1-128">Pour plus d’informations sur l’objet de collection **errorInfo** , consultez « Gestion des erreurs » dans le Guide d’automatisation.</span><span class="sxs-lookup"><span data-stu-id="f97e1-128">For additional information on the **ErrorInfo** collection object, see "Error Handling" in the Automation guide.</span></span>
    > [!Note]  
    > <span data-ttu-id="f97e1-129">COM requiert que tous les objets de collection [**errorInfo**](errorinfo.md) soient marshalés par valeur, ce qui implique que les composants qui implémentent l’interface d’automatisation **IErrorInfo** doivent également implémenter et prendre en charge l’interface [**IMarshal**](/windows/desktop/api/objidl/nn-objidl-imarshal) .</span><span class="sxs-lookup"><span data-stu-id="f97e1-129">COM requires that all [**ErrorInfo**](errorinfo.md) collection objects marshal by value, implying that components that implement the **IErrorInfo** Automation interface must also implement and support the [**IMarshal**](/windows/desktop/api/objidl/nn-objidl-imarshal) interface.</span></span> <span data-ttu-id="f97e1-130">L’implémentation de l’interface **IMarshal** doit prendre en charge Marshal by value pour le composant.</span><span class="sxs-lookup"><span data-stu-id="f97e1-130">The **IMarshal** interface implementation must support marshal by value for the component.</span></span>

     

-   <span data-ttu-id="f97e1-131">**Utilisez des transactions pour gérer les échecs de ressources partagées.**</span><span class="sxs-lookup"><span data-stu-id="f97e1-131">**Use transactions to manage shared resource failures.**</span></span> <span data-ttu-id="f97e1-132">Les transactions automatiques peuvent réduire considérablement la quantité de code de gestion des erreurs que vous devez écrire lors de l’utilisation de gestionnaires de ressources gérés par État.</span><span class="sxs-lookup"><span data-stu-id="f97e1-132">Automatic transactions can significantly reduce the amount of error-handling code you must write when using state-managed resource managers.</span></span> <span data-ttu-id="f97e1-133">Toutefois, les transactions n’éliminent pas complètement la nécessité de gérer les erreurs.</span><span class="sxs-lookup"><span data-stu-id="f97e1-133">However, transactions do not eliminate the need for error handling altogether.</span></span> <span data-ttu-id="f97e1-134">Vous devez toujours retourner des codes d’erreur à partir de vos méthodes d’interface et vérifier ces codes d’erreur dans l’appelant pour éviter tout travail inutile pour une transaction vouée.</span><span class="sxs-lookup"><span data-stu-id="f97e1-134">You still need to return error codes from your interface methods and check those error codes within the caller to avoid doing unnecessary work for a doomed transaction.</span></span> <span data-ttu-id="f97e1-135">Pour plus d’informations sur la combinaison de la gestion des erreurs avec le traitement des transactions, consultez [accélération des transactions en avertissant l’objet racine](speeding-transactions-by-notifying-the-root-object.md).</span><span class="sxs-lookup"><span data-stu-id="f97e1-135">For additional information about combining error handling with transaction processing, see [Speeding Transactions by Notifying the Root Object](speeding-transactions-by-notifying-the-root-object.md).</span></span>
-   <span data-ttu-id="f97e1-136">**Déclencher des erreurs explicitement.**</span><span class="sxs-lookup"><span data-stu-id="f97e1-136">**Raise errors explicitly.**</span></span> <span data-ttu-id="f97e1-137">Évitez de laisser les informations d’erreur laisser un objet, sauf si l’objet déclenche explicitement l’erreur.</span><span class="sxs-lookup"><span data-stu-id="f97e1-137">Avoid letting error information leave an object unless the object explicitly raises the error.</span></span> <span data-ttu-id="f97e1-138">Interceptez toutes les erreurs générées par l’outil et gérez-les dans le code de votre composant.</span><span class="sxs-lookup"><span data-stu-id="f97e1-138">Catch all tool-generated errors and handle them in your component code.</span></span> <span data-ttu-id="f97e1-139">Au minimum, incluez un gestionnaire standard pour signaler les erreurs inattendues de manière cohérente.</span><span class="sxs-lookup"><span data-stu-id="f97e1-139">At the very least, include a standard handler to report unexpected errors in a consistent manner.</span></span>
-   <span data-ttu-id="f97e1-140">**Utilisez la \_ plage d’erreurs ITF pour signaler des erreurs spécifiques à l’interface.**</span><span class="sxs-lookup"><span data-stu-id="f97e1-140">**Use the FACILITY\_ITF range of errors to report interface-specific errors.**</span></span> <span data-ttu-id="f97e1-141">Les erreurs spécifiques à l’interface doivent se trouver dans la \_ plage d’erreurs ITF, entre 0x0200 et 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="f97e1-141">Interface-specific errors should be in the FACILITY\_ITF range of errors, between 0x0200 and 0xFFFF.</span></span> <span data-ttu-id="f97e1-142">Vous pouvez définir un code d’erreur personnalisé dans Visual Basic en tant que décalage à partir de vbObjectError.</span><span class="sxs-lookup"><span data-stu-id="f97e1-142">You can define a custom error code in Visual Basic as an offset from vbObjectError.</span></span> <span data-ttu-id="f97e1-143">Utilisez la \_ macro make HRESULT en C++ pour introduire un code d’erreur spécifique à l’interface, comme indiqué dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="f97e1-143">Use the MAKE\_HRESULT macro in C++ to introduce an interface-specific error code, as shown in the following example:</span></span>

    ``` syntax
    const HRESULT ERROR_NUMBER = MAKE_HRESULT (SEVERITY_ERROR, FACILITY_ITF, 10);
    ```

## <a name="related-topics"></a><span data-ttu-id="f97e1-144">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="f97e1-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f97e1-145">Isolation des erreurs et stratégie FailFast</span><span class="sxs-lookup"><span data-stu-id="f97e1-145">Fault Isolation and Failfast Policy</span></span>](fault-isolation-and-failfast-policy.md)
</dt> <dt>

[<span data-ttu-id="f97e1-146">Recherche de la source d’une erreur</span><span class="sxs-lookup"><span data-stu-id="f97e1-146">Finding the Source of an Error</span></span>](finding-the-source-of-an-error.md)
</dt> <dt>

[<span data-ttu-id="f97e1-147">Modification des valeurs de retour par COM+</span><span class="sxs-lookup"><span data-stu-id="f97e1-147">How COM+ Modifies Return Values</span></span>](how-com--modifies-return-values.md)
</dt> <dt>

[<span data-ttu-id="f97e1-148">Interprétation des codes d’erreur</span><span class="sxs-lookup"><span data-stu-id="f97e1-148">Interpreting Error Codes</span></span>](interpreting-error-codes.md)
</dt> <dt>

[<span data-ttu-id="f97e1-149">Dépannage</span><span class="sxs-lookup"><span data-stu-id="f97e1-149">Troubleshooting</span></span>](troubleshooting.md)
</dt> </dl>

 

 
