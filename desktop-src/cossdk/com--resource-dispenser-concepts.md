---
description: Les composants d’application utilisent le distributeur de ressources COM+ pour accéder et gérer les informations d’État partagées non durables, telles que les connexions entre les composants et un gestionnaire de ressources donné.
ms.assetid: 252c7180-61b1-485d-883d-36bf77357a29
title: Concepts du distributeur de ressources COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f0fcf281d6d7b8ed0e087b6d77e4d686e28e1fa
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103748068"
---
# <a name="com-resource-dispenser-concepts"></a><span data-ttu-id="28315-103">Concepts du distributeur de ressources COM+</span><span class="sxs-lookup"><span data-stu-id="28315-103">COM+ Resource Dispenser Concepts</span></span>

<span data-ttu-id="28315-104">Les composants d’application utilisent le distributeur de ressources COM+ pour accéder et gérer les informations d’État partagées non durables, telles que les connexions entre les composants et un gestionnaire de ressources donné.</span><span class="sxs-lookup"><span data-stu-id="28315-104">Application components use the COM+ resource dispenser to access and manage shared, nondurable state information, such as connections between components and a given resource manager.</span></span> <span data-ttu-id="28315-105">Lors de l’exécution, les pools dynamiques de ressources, tels que les connexions de base de données, les connexions réseau, les connexions aux files d’attente, les threads, les objets et les blocs de mémoire, sont mis à la disposition du distributeur de ressources.</span><span class="sxs-lookup"><span data-stu-id="28315-105">At runtime, dynamic pools of resources, such as database connections, network connections, connections to queues, threads, objects, and memory blocks, are made available to the resource dispenser.</span></span> <span data-ttu-id="28315-106">Le processus d’application atteint des performances élevées en utilisant un nombre minimal de ressources fréquemment utilisées.</span><span class="sxs-lookup"><span data-stu-id="28315-106">The application process achieves high performance by using a minimum number of frequently used resources.</span></span> <span data-ttu-id="28315-107">Le distributeur de ressources peut également automatiser les transactions et la récupération.</span><span class="sxs-lookup"><span data-stu-id="28315-107">The resource dispenser can also automate transactions and reclamation.</span></span> <span data-ttu-id="28315-108">(Pour plus d’informations sur cette fonctionnalité, consultez [récupération automatique des ressources](automatic-resource-reclamation.md) .)</span><span class="sxs-lookup"><span data-stu-id="28315-108">(See [Automatic Resource Reclamation](automatic-resource-reclamation.md) for more information about this feature.)</span></span>

> [!Note]  
> <span data-ttu-id="28315-109">Une *ressource* est un tout ce que crée un distributeur de ressources.</span><span class="sxs-lookup"><span data-stu-id="28315-109">A *resource* is anything a resource dispenser creates.</span></span> <span data-ttu-id="28315-110">Par exemple, une connexion à un gestionnaire de ressources est une ressource commune.</span><span class="sxs-lookup"><span data-stu-id="28315-110">For example, a connection to a resource manager is a common resource.</span></span> <span data-ttu-id="28315-111">Les ressources résident dans la mémoire du distributeur de ressources et ne sont jamais copiées dans le gestionnaire de distribution.</span><span class="sxs-lookup"><span data-stu-id="28315-111">Resources reside in the resource dispenser's memory and are never copied to the dispenser manager.</span></span> <span data-ttu-id="28315-112">Une ressource est connue uniquement par un handle opaque (**RESID**) et peut ou ne peut pas être en capacité à effectuer des transactions.</span><span class="sxs-lookup"><span data-stu-id="28315-112">A resource is known only by an opaque handle (**RESID**) and may or may not be capable of performing transactions.</span></span> <span data-ttu-id="28315-113">Bien que les ressources gérées soient souvent des connexions à un composant gérant un État durable, les connexions elles-mêmes ne sont pas durables.</span><span class="sxs-lookup"><span data-stu-id="28315-113">Although the resources managed might often be connections to a component managing a durable state, the connections themselves are not durable.</span></span> <span data-ttu-id="28315-114">Un distributeur de ressources utilise souvent un gestionnaire de ressources associé pour conserver l’État durable.</span><span class="sxs-lookup"><span data-stu-id="28315-114">A resource dispenser often uses a related resource manager to retain the durable state.</span></span>

 

<span data-ttu-id="28315-115">Architecturale, le système de distribution de ressources COM+ est constitué de dispenseurs de ressources et d’un gestionnaire de distributeur.</span><span class="sxs-lookup"><span data-stu-id="28315-115">Architecturally, the COM+ resource dispenser system consists of resource dispensers and a dispenser manager.</span></span> <span data-ttu-id="28315-116">Les distributeurs de ressources sont des composants fournis par l’utilisateur qui fournissent aux applications des interfaces simples aux ressources partagées.</span><span class="sxs-lookup"><span data-stu-id="28315-116">Resource dispensers are user-supplied components that provide applications with simple interfaces to shared resources.</span></span> <span data-ttu-id="28315-117">Le gestionnaire du distributeur est un composant fourni par COM+ qui coordonne les activités des différents distributeurs de ressources.</span><span class="sxs-lookup"><span data-stu-id="28315-117">The dispenser manager is a component provided by COM+ that coordinates the activities of the various resource dispensers.</span></span>

<span data-ttu-id="28315-118">Un distributeur de ressources est un composant de bibliothèque de liens dynamiques (DLL) qui fournit au moins deux interfaces.</span><span class="sxs-lookup"><span data-stu-id="28315-118">A resource dispenser is a dynamic-link library (DLL) component that provides at least two interfaces.</span></span> <span data-ttu-id="28315-119">La première, [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver), fournit au gestionnaire de distribution des informations de base sur la création, la destruction et l’inscription des ressources qu’il gère.</span><span class="sxs-lookup"><span data-stu-id="28315-119">The first, [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver), provides the dispenser manager with basic information on how to create, destroy, and enlist the resources it manages.</span></span> <span data-ttu-id="28315-120">Le deuxième est exposé aux applications et peut être une interface COM ou un ensemble d’interfaces ou peut être une interface de programmation d’applications (API) à laquelle un composant est lié via une bibliothèque d’importation.</span><span class="sxs-lookup"><span data-stu-id="28315-120">The second is exposed to the applications and can be a COM interface or set of interfaces or can be an application programming interface (API) to which a component is linked via an import library.</span></span> <span data-ttu-id="28315-121">Une application peut appeler n’importe quel distributeur de ressources, qui peut, à son tour, proposer toute API à l’application.</span><span class="sxs-lookup"><span data-stu-id="28315-121">An application can call any resource dispenser, which in turn may offer any API to the application.</span></span> <span data-ttu-id="28315-122">Si le distributeur de ressources est un composant Automation, il est accessible à partir de Microsoft Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="28315-122">If the resource dispenser is an Automation component, it can be accessed from Microsoft Visual Basic.</span></span> <span data-ttu-id="28315-123">Un distributeur de ressources est instancié lorsqu’un composant d’application y fait référence.</span><span class="sxs-lookup"><span data-stu-id="28315-123">A resource dispenser is instantiated when an application component refers to it.</span></span>

<span data-ttu-id="28315-124">Le gestionnaire de distribution fourni par COM+ effectue le suivi des distributions et des coordonnées des ressources entre eux.</span><span class="sxs-lookup"><span data-stu-id="28315-124">The dispenser manager provided by COM+ tracks resource dispensers and coordinates among them.</span></span> <span data-ttu-id="28315-125">Il implémente deux interfaces : [**IDispenserManager**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispensermanager) et [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span><span class="sxs-lookup"><span data-stu-id="28315-125">It implements two interfaces: [**IDispenserManager**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispensermanager) and [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span></span> <span data-ttu-id="28315-126">les distributeurs de ressources s’inscrivent à l’aide de l’interface **IDispenserManager** .</span><span class="sxs-lookup"><span data-stu-id="28315-126">resource dispensers register themselves using the **IDispenserManager** interface.</span></span> <span data-ttu-id="28315-127">Le gestionnaire de distribution lui donne ensuite un pointeur vers un **IHolder** qu’il utilise pour notifier le responsable du distributeur de ses activités.</span><span class="sxs-lookup"><span data-stu-id="28315-127">The dispenser manager then gives them a pointer to an **IHolder** that they use to notify the dispenser manager of their activities.</span></span>

<span data-ttu-id="28315-128">Un distributeur de ressources transactionnel doit s’inscrire dans une transaction Distributed Transaction Coordinator (DTC).</span><span class="sxs-lookup"><span data-stu-id="28315-128">A transactional resource dispenser must enlist in a Distributed Transaction Coordinator (DTC) transaction.</span></span> <span data-ttu-id="28315-129">Cela implique l’utilisation d’un gestionnaire de ressources interne ou externe (pour le distributeur de ressources) qui est compatible avec les transactions OLE.</span><span class="sxs-lookup"><span data-stu-id="28315-129">This implies use of either an internal or an external (to the resource dispenser) resource manager that is OLE transactions-compliant.</span></span>

> [!Note]  
> <span data-ttu-id="28315-130">Le modèle de programmation COM+ comprend des *transactions déclaratives*, qui permettent de protéger le travail effectué par un objet d’application pendant sa durée de vie.</span><span class="sxs-lookup"><span data-stu-id="28315-130">The COM+ programming model includes *declarative transactions*, which help protect the work performed by an application object during its lifetime.</span></span> <span data-ttu-id="28315-131">Lorsqu’un objet d’application utilise un distributeur de ressources COM+, le travail qu’il effectue est automatiquement transactionnel ; autrement dit, le composant n’a pas besoin de déclarer explicitement des transactions.</span><span class="sxs-lookup"><span data-stu-id="28315-131">When an application object uses a COM+ resource dispenser, the work it performs is automatically transactional; that is, the component doesn't have to explicitly declare transactions.</span></span> <span data-ttu-id="28315-132">Ces transactions sont définies dans la spécification OLE Transactions, implémentée par le DTC et lancées pour le compte de l’objet d’application par COM+.</span><span class="sxs-lookup"><span data-stu-id="28315-132">These transactions are defined in the OLE Transactions specification, implemented by the DTC, and initiated on behalf of the application object by COM+.</span></span> <span data-ttu-id="28315-133">Pour plus d’informations, consultez le Guide de développement DTC.</span><span class="sxs-lookup"><span data-stu-id="28315-133">See the DTC Development Guide for more information.</span></span>

 

<span data-ttu-id="28315-134">Les ressources n’ont pas besoin d’être transactionnelles.</span><span class="sxs-lookup"><span data-stu-id="28315-134">Resources need not be transactional.</span></span> <span data-ttu-id="28315-135">Un distributeur de ressources qui regroupe des ressources non transactionnelles peut toujours atteindre des performances élevées en permettant aux objets d’application d’accéder à un pool partagé de ces ressources.</span><span class="sxs-lookup"><span data-stu-id="28315-135">A resource dispenser that pools non-transactional resources can still achieve high performance by allowing application objects to access a shared pool of these resources.</span></span> <span data-ttu-id="28315-136">Ce type de distributeur de ressources retourne S \_ false à partir de la méthode [**IDispenserDriver :: EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) , ce qui signifie que le distributeur de ressources n’a pas inscrit la ressource, car la ressource n’est pas transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="28315-136">This type of resource dispenser returns S\_FALSE from the [**IDispenserDriver::EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) method, which means that the resource dispenser did not enlist the resource because the resource is not transactional.</span></span>

<span data-ttu-id="28315-137">Le distributeur de ressources peut également fonctionner indépendamment de COM+, en fournissant uniquement des fonctionnalités de mise en pool de ressources.</span><span class="sxs-lookup"><span data-stu-id="28315-137">The resource dispenser can also function independently of COM+, providing only resource pooling capabilities.</span></span> <span data-ttu-id="28315-138">Par exemple, si un distributeur de ressources expose une API (par exemple, ODBC), le distributeur de ressources peut être une DLL accessible par l’application via une bibliothèque d’importation (ou à l’aide des fonctions [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) et [**GetProcAddress**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress) ).</span><span class="sxs-lookup"><span data-stu-id="28315-138">For example, if a resource dispenser exposes an API (such as ODBC), the resource dispenser might be a DLL that is accessed by the application through an import library (or using the [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) and [**GetProcAddress**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress) functions).</span></span> <span data-ttu-id="28315-139">Un distributeur de ressources peut également être un composant COM auquel une application accède en appelant [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span><span class="sxs-lookup"><span data-stu-id="28315-139">A resource dispenser might also be a COM component that an application accesses by calling [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span></span> <span data-ttu-id="28315-140">Sans COM+, la méthode [**EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) d’un distributeur de ressources ne peut jamais être appelée, car le gestionnaire du distributeur n’a aucune connaissance de la transaction du composant en cours.</span><span class="sxs-lookup"><span data-stu-id="28315-140">Without COM+, a resource dispenser's [**EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) method can never be called because the dispenser manager has no knowledge of the current component transaction.</span></span>

<span data-ttu-id="28315-141">Au démarrage, une DLL de distributeur de ressources doit s’inscrire auprès du gestionnaire du distributeur.</span><span class="sxs-lookup"><span data-stu-id="28315-141">On startup, a resource dispenser DLL must register itself with the dispenser manager.</span></span> <span data-ttu-id="28315-142">Le gestionnaire du distributeur est le cadre de contrôle qui gère le chargement et le déchargement des distributeurs de ressources, fournit le contexte COM+ et contrôle le gestionnaire des statistiques d’inventaire.</span><span class="sxs-lookup"><span data-stu-id="28315-142">The dispenser manager is the controlling executive that manages the loading and unloading of resource dispensers, provides the COM+ context, and controls the inventory statistics manager.</span></span> <span data-ttu-id="28315-143">(Pour plus d’informations, consultez [Gestionnaire du distributeur com+](com--dispenser-manager.md).) Le distributeur de ressources appelle d’abord la fonction [**GetDispenserManager**](/windows/desktop/api/MtxDM/nf-mtxdm-getdispensermanager) , puis appelle la méthode [**IDispenserManager :: RegisterDispenser**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispensermanager-registerdispenser) , en passant le pointeur [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver) implémenté par le distributeur de ressources.</span><span class="sxs-lookup"><span data-stu-id="28315-143">(For more information, see [COM+ Dispenser Manager](com--dispenser-manager.md).) The resource dispenser first calls the [**GetDispenserManager**](/windows/desktop/api/MtxDM/nf-mtxdm-getdispensermanager) function and then calls the [**IDispenserManager::RegisterDispenser**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispensermanager-registerdispenser) method, passing the [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver) pointer that the resource dispenser implements.</span></span> <span data-ttu-id="28315-144">Cet appel retourne une référence à [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span><span class="sxs-lookup"><span data-stu-id="28315-144">This call returns a reference to [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span></span>

<span data-ttu-id="28315-145">Pour arrêter, un distributeur de ressources appelle [**IHolder :: Close**](/windows/desktop/api/ComSvcs/nf-comsvcs-iholder-close).</span><span class="sxs-lookup"><span data-stu-id="28315-145">To shut down, a resource dispenser calls [**IHolder::Close**](/windows/desktop/api/ComSvcs/nf-comsvcs-iholder-close).</span></span> <span data-ttu-id="28315-146">Pour garantir un arrêt correct du package, un distributeur de ressources doit être en mesure de gérer la situation dans laquelle les appels continuent d’arriver à partir des objets métier après que COM+ a demandé l’arrêt du distributeur.</span><span class="sxs-lookup"><span data-stu-id="28315-146">To ensure a clean package shutdown, a resource dispenser must be able to handle the situation when calls continue to arrive from business objects after COM+ has asked the dispenser to shut down.</span></span>

<span data-ttu-id="28315-147">Les rubriques suivantes de cette section fournissent des informations plus détaillées sur le service de distribution de ressources COM+ :</span><span class="sxs-lookup"><span data-stu-id="28315-147">The following topics in this section provide more detailed information about the COM+ resource dispenser service:</span></span>

-   [<span data-ttu-id="28315-148">Gestionnaire de distributeur COM+</span><span class="sxs-lookup"><span data-stu-id="28315-148">COM+ Dispenser Manager</span></span>](com--dispenser-manager.md)
-   [<span data-ttu-id="28315-149">Types de threads du distributeur de ressources COM+</span><span class="sxs-lookup"><span data-stu-id="28315-149">COM+ Resource Dispenser Thread Types</span></span>](com--resource-dispenser-thread-types.md)
-   [<span data-ttu-id="28315-150">États des ressources regroupées accessibles au distributeur de ressources COM+</span><span class="sxs-lookup"><span data-stu-id="28315-150">Pooled Resource States Available to COM+ Resource Dispenser</span></span>](pooled-resource-states-available-to-com--resource-dispenser.md)
-   [<span data-ttu-id="28315-151">Inscription d’une ressource dans une transaction</span><span class="sxs-lookup"><span data-stu-id="28315-151">Enlisting a Resource in a Transaction</span></span>](enlisting-a-resource-in-a-transaction.md)
-   [<span data-ttu-id="28315-152">Processus d’allocation des ressources du distributeur de ressources</span><span class="sxs-lookup"><span data-stu-id="28315-152">Resource Dispenser Resource Allocation Process</span></span>](resource-dispenser-resource-allocation-process.md)
-   [<span data-ttu-id="28315-153">Suivi des ressources non allouées</span><span class="sxs-lookup"><span data-stu-id="28315-153">Tracking Non-Allocated Resources</span></span>](tracking-non-allocated-resources.md)
-   [<span data-ttu-id="28315-154">Récupération automatique des ressources</span><span class="sxs-lookup"><span data-stu-id="28315-154">Automatic Resource Reclamation</span></span>](automatic-resource-reclamation.md)
-   [<span data-ttu-id="28315-155">Types utilisés dans les interfaces de distributeur de ressources COM+</span><span class="sxs-lookup"><span data-stu-id="28315-155">Types Used in COM+ Resource Dispenser Interfaces</span></span>](types-used-in-com--resource-dispenser-interfaces.md)
-   [<span data-ttu-id="28315-156">Interfaces du distributeur de ressources COM+</span><span class="sxs-lookup"><span data-stu-id="28315-156">COM+ Resource Dispenser Interfaces</span></span>](com--resource-dispenser-interfaces.md)

## <a name="related-topics"></a><span data-ttu-id="28315-157">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="28315-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="28315-158">Tâches du distributeur de ressources COM+</span><span class="sxs-lookup"><span data-stu-id="28315-158">COM+ Resource Dispenser Tasks</span></span>](com--resource-dispenser-tasks.md)
</dt> </dl>

 

 
