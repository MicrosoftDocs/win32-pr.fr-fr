---
description: Échecs de Client-Side persistant
ms.assetid: f991db71-8319-414d-8a25-2d02bc7c8b51
title: Échecs de Client-Side persistant
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25d303e712257d62e4ae42497cb4463e782cfbb8
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104393107"
---
# <a name="persistent-client-side-failures"></a><span data-ttu-id="47b3a-103">Échecs de Client-Side persistant</span><span class="sxs-lookup"><span data-stu-id="47b3a-103">Persistent Client-Side Failures</span></span>

<span data-ttu-id="47b3a-104">Dans certains cas, [Message Queuing](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) pouvez déplacer un message vers la file d’attente de destination.</span><span class="sxs-lookup"><span data-stu-id="47b3a-104">In some cases, [Message Queuing](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) can move a message to the destination queue.</span></span> <span data-ttu-id="47b3a-105">Par exemple, si les contrôles d’accès à la file d’attente n’autorisent pas le déplacement du message du client vers le serveur, le message incriminé est déplacé vers la file d’attente de lettres mortes côté client.</span><span class="sxs-lookup"><span data-stu-id="47b3a-105">For example, if the queue access controls do not permit the message to be moved from client to server, the offending message is moved to the client-side dead letter queue.</span></span> <span data-ttu-id="47b3a-106">Dans ce cas, le service de composants en file d’attente COM+ autorise l’Association d’une classe d’exception à un composant.</span><span class="sxs-lookup"><span data-stu-id="47b3a-106">When this occurs, the COM+ queued components service allows an exception class to be associated with a component.</span></span> <span data-ttu-id="47b3a-107">Pour associer la classe d’exception au composant, utilisez l’onglet **avancé** de la page Propriétés du composant de l’outil d’administration Services de composants.</span><span class="sxs-lookup"><span data-stu-id="47b3a-107">To associate the exception class with the component, use the **Advanced** tab in the component properties page of the Component Services administration tool.</span></span> <span data-ttu-id="47b3a-108">Vous pouvez également associer la classe d’exception par programme, à l’aide de l’attribut de composant de catalogue ExceptionClass des fonctions d’administration COM+.</span><span class="sxs-lookup"><span data-stu-id="47b3a-108">You can also associate the exception class programmatically, by using the ExceptionClass catalog component attribute of the COM+ Administrative functions.</span></span>

<span data-ttu-id="47b3a-109">La classe d’exception est définie en tant que ProgID ou CLSID d’un composant qui implémente [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol).</span><span class="sxs-lookup"><span data-stu-id="47b3a-109">The exception class is defined as either the ProgID or the CLSID of a component implementing [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol).</span></span> <span data-ttu-id="47b3a-110">Le service Queued Components a un moniteur de file d’attente de lettres mortes qui analyse la file d’attente de lettres mortes Xact.</span><span class="sxs-lookup"><span data-stu-id="47b3a-110">The queued components service has a dead letter queue monitor that scans the Xact dead letter queue.</span></span> <span data-ttu-id="47b3a-111">S’il y a un message dans la file d’attente, le moniteur de file d’attente de lettres mortes instancie le gestionnaire d’exceptions associé au composant cible et appelle [**IPlaybackControl :: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), ce qui indique qu’il y a eu une erreur côté client irrécupérable.</span><span class="sxs-lookup"><span data-stu-id="47b3a-111">If there is a message on the queue, the dead letter queue monitor instantiates the exception handler associated with the target component and calls [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), indicating that there has been a client-side, unrecoverable error.</span></span>

<span data-ttu-id="47b3a-112">En plus de [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), le gestionnaire d’exceptions doit implémenter le même jeu d’interfaces que le composant serveur pour lequel il gère les exceptions.</span><span class="sxs-lookup"><span data-stu-id="47b3a-112">In addition to [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), the exception handler should implement the same set of interfaces as the server component for which it is handling exceptions.</span></span> <span data-ttu-id="47b3a-113">Quand [**IPlaybackControl :: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) est appelé, le temps d’exécution des composants en file d’attente lit le message ayant échoué dans le gestionnaire d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="47b3a-113">When [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) is called, the queued components run-time plays back the failing message to the exception handler.</span></span> <span data-ttu-id="47b3a-114">Cela permet au gestionnaire d’exceptions d’implémenter un autre comportement pour les messages qui ne peuvent pas être déplacés vers le serveur, par exemple en générant une transaction de compensation.</span><span class="sxs-lookup"><span data-stu-id="47b3a-114">This allows the exception handler to implement an alternative behavior for messages that cannot be moved to the server—for example, by generating a compensating transaction.</span></span>

<span data-ttu-id="47b3a-115">Si le gestionnaire d’exceptions termine tous les appels de méthode lus, le message est supprimé de la file d’attente de lettres mortes Xact et est fermé.</span><span class="sxs-lookup"><span data-stu-id="47b3a-115">If the exception handler completes all the method calls played back, the message is removed from the Xact dead letter queue and is dismissed.</span></span> <span data-ttu-id="47b3a-116">Toutefois, si le gestionnaire d’exceptions abandonne le message en retournant un état d’échec de l’un des appels de méthode, le message est retourné à la file d’attente de lettres mortes Xact.</span><span class="sxs-lookup"><span data-stu-id="47b3a-116">If, however, the exception handler aborts the message by returning a failure status from one of the method calls, the message is returned to the Xact dead letter queue.</span></span> <span data-ttu-id="47b3a-117">La séquence d’événements suivante montre comment les exceptions côté client sont gérées :</span><span class="sxs-lookup"><span data-stu-id="47b3a-117">The following sequence of events shows how client-side exceptions are handled:</span></span>

1.  <span data-ttu-id="47b3a-118">Message Queuing ne parvient pas à remettre un message au serveur et place le message dans la file d’attente de lettres mortes Xact.</span><span class="sxs-lookup"><span data-stu-id="47b3a-118">Message Queuing fails to deliver a message to the server and puts the message onto the Xact dead letter queue.</span></span>
2.  <span data-ttu-id="47b3a-119">L’écouteur de file d’attente de lettres mortes (DLQL) recherche un message dans la file d’attente de lettres mortes Xact.</span><span class="sxs-lookup"><span data-stu-id="47b3a-119">The dead letter queue listener (DLQL) finds a message on the Xact dead letter queue.</span></span>
3.  <span data-ttu-id="47b3a-120">Le DLQL récupère le CLSID du composant cible à partir du message et recherche une classe d’exception.</span><span class="sxs-lookup"><span data-stu-id="47b3a-120">The DLQL retrieves the target component CLSID from the message and checks for an exception class.</span></span>
4.  <span data-ttu-id="47b3a-121">Le DLQL instancie la classe d’exception.</span><span class="sxs-lookup"><span data-stu-id="47b3a-121">The DLQL instantiates the exception class.</span></span>
5.  <span data-ttu-id="47b3a-122">DLQL interroge [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) pour la classe d’exception.</span><span class="sxs-lookup"><span data-stu-id="47b3a-122">The DLQL queries for [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) for the exception class.</span></span>
6.  <span data-ttu-id="47b3a-123">DLQL appelle la méthode [**IPlaybackControl :: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) dans la classe d’exception.</span><span class="sxs-lookup"><span data-stu-id="47b3a-123">The DLQL calls the [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) method in the exception class.</span></span>
7.  <span data-ttu-id="47b3a-124">DLQL lit tous les appels de méthode et de propriété du message à la classe d’exception.</span><span class="sxs-lookup"><span data-stu-id="47b3a-124">The DLQL plays back all property and method calls from the message to the exception class.</span></span>
8.  <span data-ttu-id="47b3a-125">Le DLQL supprime le message si le gestionnaire d’exceptions termine la transaction avec succès.</span><span class="sxs-lookup"><span data-stu-id="47b3a-125">The DLQL deletes the message if the exception handler completes the transaction successfully.</span></span> <span data-ttu-id="47b3a-126">Le gestionnaire d’exceptions peut émettre [**IObjectContext :: SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort), et le message reste dans la file d’attente de lettres mortes.</span><span class="sxs-lookup"><span data-stu-id="47b3a-126">The exception handler may issue [**IObjectContext::SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort), and the message will remain on the dead letter queue.</span></span>

<span data-ttu-id="47b3a-127">Si l’une des étapes précédentes échoue, le message est conservé dans la file d’attente de lettres mortes Xact.</span><span class="sxs-lookup"><span data-stu-id="47b3a-127">If any of the preceding steps fail, the message is left on the Xact dead letter queue.</span></span>

<span data-ttu-id="47b3a-128">Au démarrage, DLQL lit chaque message sur la file d’attente de lettres mortes transactionnelle Message Queuing et instancie la classe d’exception pour chaque message Queued Components.</span><span class="sxs-lookup"><span data-stu-id="47b3a-128">When started, the DLQL reads each message on the Message Queuing transactional dead letter queue and instantiates the exception class for each queued components message.</span></span> <span data-ttu-id="47b3a-129">Après une seule passe dans la file d’attente, elle attend de nouveaux messages.</span><span class="sxs-lookup"><span data-stu-id="47b3a-129">After one pass through the queue, it waits for new messages.</span></span> <span data-ttu-id="47b3a-130">Il traite ensuite chaque nouveau message de la file d’attente de lettres mortes à son arrivée.</span><span class="sxs-lookup"><span data-stu-id="47b3a-130">It then processes each new dead letter queue message as it arrives.</span></span>

<span data-ttu-id="47b3a-131">Si vous devez intervenir dans le processus décrit ici ou si vous devez déplacer un message incohérent hors de sa file d’attente Rest finale, utilisez l’utilitaire de déplacement de messages.</span><span class="sxs-lookup"><span data-stu-id="47b3a-131">If you need to intervene in the process described here or if you need to move a poison message out of its final resting queue, use the message mover utility.</span></span> <span data-ttu-id="47b3a-132">Pour plus d’informations sur l’utilitaire de déplacement de messages, consultez [gestion des erreurs](handling-errors-in-queued-components.md).</span><span class="sxs-lookup"><span data-stu-id="47b3a-132">For more information on the message mover utility, see [Handling Errors](handling-errors-in-queued-components.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="47b3a-133">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="47b3a-133">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="47b3a-134">Erreurs côté client</span><span class="sxs-lookup"><span data-stu-id="47b3a-134">Client-Side Errors</span></span>](client-side-errors.md)
</dt> <dt>

[<span data-ttu-id="47b3a-135">Erreurs côté serveur</span><span class="sxs-lookup"><span data-stu-id="47b3a-135">Server-Side Errors</span></span>](server-side-errors.md)
</dt> </dl>

 

 



