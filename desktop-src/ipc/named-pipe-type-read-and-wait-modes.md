---
description: Le serveur de canaux spécifie le mode de type de canal, le mode lecture et le mode Wait dans le paramètre dwPipeMode de la fonction CreateNamedPipe. Les clients de canal peuvent spécifier ces modes de canal pour leurs handles de canal à l’aide de la fonction CreateFile.
ms.assetid: 07cf9d06-6265-47f4-a9f1-c19c06cc5f9f
title: Modes de type canal nommé, lecture et attente
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b116e5ca9357a65a6d63549b96065843b046d479
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103861921"
---
# <a name="named-pipe-type-read-and-wait-modes"></a><span data-ttu-id="b0afe-104">Modes de type canal nommé, lecture et attente</span><span class="sxs-lookup"><span data-stu-id="b0afe-104">Named Pipe Type, Read, and Wait Modes</span></span>

<span data-ttu-id="b0afe-105">Le serveur de canaux spécifie le mode de type de canal, le mode lecture et le mode Wait dans le paramètre *dwPipeMode* de la fonction [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) .</span><span class="sxs-lookup"><span data-stu-id="b0afe-105">The pipe server specifies the pipe type mode, read mode, and wait mode in the *dwPipeMode* parameter of the [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) function.</span></span> <span data-ttu-id="b0afe-106">Les clients de canal peuvent spécifier ces modes de canal pour leurs handles de canal à l’aide de la fonction [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="b0afe-106">Pipe clients can specify these pipe modes for their pipe handles using the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function.</span></span>

## <a name="type-mode"></a><span data-ttu-id="b0afe-107">Mode de type</span><span class="sxs-lookup"><span data-stu-id="b0afe-107">Type Mode</span></span>

<span data-ttu-id="b0afe-108">Le mode de type d’un canal détermine la façon dont les données sont écrites dans un canal nommé.</span><span class="sxs-lookup"><span data-stu-id="b0afe-108">The type mode of a pipe determines how data is written to a named pipe.</span></span> <span data-ttu-id="b0afe-109">Les données peuvent être transmises via un canal nommé en tant que flux d’octets ou en tant que flux de messages.</span><span class="sxs-lookup"><span data-stu-id="b0afe-109">Data can be transmitted through a named pipe as either a stream of bytes or as a stream of messages.</span></span> <span data-ttu-id="b0afe-110">Le serveur de canaux spécifie le type de canal lors de l’appel de [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) pour créer une instance d’un canal nommé.</span><span class="sxs-lookup"><span data-stu-id="b0afe-110">The pipe server specifies the pipe type when calling [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) to create an instance of a named pipe.</span></span> <span data-ttu-id="b0afe-111">Les modes de type doivent être les mêmes pour toutes les instances d’un canal.</span><span class="sxs-lookup"><span data-stu-id="b0afe-111">The type modes must be the same for all instances of a pipe.</span></span>

<span data-ttu-id="b0afe-112">Pour créer un canal de type octet, spécifiez \_ octet type de canal \_ ou utilisez la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="b0afe-112">To create a byte-type pipe, specify PIPE\_TYPE\_BYTE or use the default value.</span></span> <span data-ttu-id="b0afe-113">Les données sont écrites dans le canal sous la forme d’un flux d’octets et le système ne fait pas la différence entre les octets écrits dans des opérations d’écriture différentes.</span><span class="sxs-lookup"><span data-stu-id="b0afe-113">The data is written to the pipe as a stream of bytes, and the system does not differentiate between the bytes written in different write operations.</span></span>

<span data-ttu-id="b0afe-114">Pour créer un canal de type de message, spécifiez le message de type de canal \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="b0afe-114">To create a message-type pipe, specify PIPE\_TYPE\_MESSAGE.</span></span> <span data-ttu-id="b0afe-115">Le système traite les octets écrits dans chaque opération d’écriture sur le canal en tant qu’unité de message.</span><span class="sxs-lookup"><span data-stu-id="b0afe-115">The system treats the bytes written in each write operation to the pipe as a message unit.</span></span> <span data-ttu-id="b0afe-116">Le système effectue toujours des opérations d’écriture sur les canaux de type message comme si le mode d’écriture directe était activé.</span><span class="sxs-lookup"><span data-stu-id="b0afe-116">The system always performs write operations on message-type pipes as if write-through mode were enabled.</span></span>

## <a name="read-mode"></a><span data-ttu-id="b0afe-117">Mode lecture</span><span class="sxs-lookup"><span data-stu-id="b0afe-117">Read Mode</span></span>

<span data-ttu-id="b0afe-118">Le mode de lecture d’un canal détermine la façon dont les données sont lues à partir d’un canal nommé.</span><span class="sxs-lookup"><span data-stu-id="b0afe-118">The read mode of a pipe determines how data is read from a named pipe.</span></span> <span data-ttu-id="b0afe-119">Le serveur de canal spécifie le mode de lecture initial pour un handle de canal lors de l’appel de [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea).</span><span class="sxs-lookup"><span data-stu-id="b0afe-119">The pipe server specifies the initial read mode for a pipe handle when calling [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea).</span></span> <span data-ttu-id="b0afe-120">Les données peuvent être lues en mode lecture en octets ou en mode lecture de message.</span><span class="sxs-lookup"><span data-stu-id="b0afe-120">Data can be read in byte-read mode or message-read mode.</span></span> <span data-ttu-id="b0afe-121">Un handle vers un canal de type octet peut être en mode lecture octet uniquement.</span><span class="sxs-lookup"><span data-stu-id="b0afe-121">A handle to a byte-type pipe can be in byte-read mode only.</span></span> <span data-ttu-id="b0afe-122">Un handle vers un canal de type de message peut être en lecture octet ou en mode de lecture de message.</span><span class="sxs-lookup"><span data-stu-id="b0afe-122">A handle to a message-type pipe can be in either byte-read or message-read mode.</span></span> <span data-ttu-id="b0afe-123">Pour un canal de type de message, le mode de lecture peut être différent pour les handles de serveur et de client vers la même instance de canal.</span><span class="sxs-lookup"><span data-stu-id="b0afe-123">For a message-type pipe, the read mode can be different for server and client handles to the same pipe instance.</span></span>

<span data-ttu-id="b0afe-124">Pour créer le descripteur de canal en mode lecture octet, spécifiez canal \_ READMODE \_ octet ou utilisez la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="b0afe-124">To create the pipe handle in byte-read mode, specify PIPE\_READMODE\_BYTE or use the default value.</span></span> <span data-ttu-id="b0afe-125">Les données sont lues à partir du canal sous la forme d’un flux d’octets.</span><span class="sxs-lookup"><span data-stu-id="b0afe-125">Data is read from the pipe as a stream of bytes.</span></span> <span data-ttu-id="b0afe-126">Une opération de lecture s’est terminée correctement lorsque tous les octets disponibles dans le canal sont lus ou lorsque le nombre d’octets spécifié est lu.</span><span class="sxs-lookup"><span data-stu-id="b0afe-126">A read operation is completed successfully when all available bytes in the pipe are read or when the specified number of bytes is read.</span></span>

<span data-ttu-id="b0afe-127">Pour créer le descripteur de canal en mode de lecture de message, spécifiez le \_ message READMODE du canal \_ .</span><span class="sxs-lookup"><span data-stu-id="b0afe-127">To create the pipe handle in message-read mode, specify PIPE\_READMODE\_MESSAGE.</span></span> <span data-ttu-id="b0afe-128">Les données sont lues à partir du canal sous la forme d’un flux de messages.</span><span class="sxs-lookup"><span data-stu-id="b0afe-128">Data is read from the pipe as a stream of messages.</span></span> <span data-ttu-id="b0afe-129">Une opération de lecture ne se termine correctement que lorsque le message entier est lu.</span><span class="sxs-lookup"><span data-stu-id="b0afe-129">A read operation is completed successfully only when the entire message is read.</span></span> <span data-ttu-id="b0afe-130">Si le nombre d’octets spécifié à lire est inférieur à la taille du message suivant, la fonction lit la plus grande partie possible du message avant de retourner zéro (la fonction [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) retourne l’erreur \_ plus de \_ données).</span><span class="sxs-lookup"><span data-stu-id="b0afe-130">If the specified number of bytes to read is less than the size of the next message, the function reads as much of the message as possible before returning zero (the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns ERROR\_MORE\_DATA).</span></span> <span data-ttu-id="b0afe-131">Le reste du message peut être lu à l’aide d’une autre opération de lecture.</span><span class="sxs-lookup"><span data-stu-id="b0afe-131">The remainder of the message can be read using another read operation.</span></span>

<span data-ttu-id="b0afe-132">Pour un client de canal, un handle de canal retourné par [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) est toujours en mode lecture octet initialement.</span><span class="sxs-lookup"><span data-stu-id="b0afe-132">For a pipe client, a pipe handle returned by [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) is always in byte-read mode initially.</span></span> <span data-ttu-id="b0afe-133">Les clients de canal et les serveurs de canaux peuvent utiliser la fonction [**SetNamedPipeHandleState**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) pour modifier le mode de lecture d’un handle de canal.</span><span class="sxs-lookup"><span data-stu-id="b0afe-133">Both pipe clients and pipe servers can use the [**SetNamedPipeHandleState**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) function to change the read mode of a pipe handle.</span></span> <span data-ttu-id="b0afe-134">Le handle de canal doit avoir le \_ droit d’accès écriture de fichier \_ .</span><span class="sxs-lookup"><span data-stu-id="b0afe-134">The pipe handle must have the FILE\_WRITE\_ATTRIBUTES access right.</span></span>

## <a name="wait-mode"></a><span data-ttu-id="b0afe-135">Mode attente</span><span class="sxs-lookup"><span data-stu-id="b0afe-135">Wait Mode</span></span>

<span data-ttu-id="b0afe-136">Le mode d’attente d’un descripteur de canal détermine la façon dont les fonctions [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile)et [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) gèrent les opérations de longue durée.</span><span class="sxs-lookup"><span data-stu-id="b0afe-136">The wait mode of a pipe handle determines how the [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) functions handle lengthy operations.</span></span> <span data-ttu-id="b0afe-137">En mode d’attente de blocage, les fonctions attendent indéfiniment un processus à l’autre extrémité du canal pour terminer une opération.</span><span class="sxs-lookup"><span data-stu-id="b0afe-137">In blocking-wait mode, the functions wait indefinitely for a process on the other end of the pipe to complete an operation.</span></span> <span data-ttu-id="b0afe-138">En mode attente sans blocage, les fonctions retournent immédiatement dans les situations qui nécessiteraient normalement une attente indéterminée.</span><span class="sxs-lookup"><span data-stu-id="b0afe-138">In nonblocking-wait mode, the functions return immediately in situations that would otherwise require an indefinite wait.</span></span>

<span data-ttu-id="b0afe-139">Une opération [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) est affectée par le mode d’attente d’un handle de canal quand le canal est vide.</span><span class="sxs-lookup"><span data-stu-id="b0afe-139">A [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) operation is affected by the wait mode of a pipe handle when the pipe is empty.</span></span> <span data-ttu-id="b0afe-140">Avec un handle d’attente de blocage, l’opération ne se termine pas correctement tant que les données ne sont pas disponibles à partir d’un thread qui écrit à l’autre extrémité du canal.</span><span class="sxs-lookup"><span data-stu-id="b0afe-140">With a blocking-wait handle, the operation is not completed successfully until data is available from a thread writing to the other end of the pipe.</span></span> <span data-ttu-id="b0afe-141">À l’aide d’un handle d’attente sans blocage, la fonction retourne immédiatement zéro, et la fonction [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) retourne l’erreur \_ aucune \_ donnée.</span><span class="sxs-lookup"><span data-stu-id="b0afe-141">Using a nonblocking-wait handle, the function returns zero immediately, and the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns ERROR\_NO\_DATA.</span></span>

<span data-ttu-id="b0afe-142">Une opération [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) est affectée par le mode d’attente d’un handle de canal quand l’espace est insuffisant dans la mémoire tampon du canal.</span><span class="sxs-lookup"><span data-stu-id="b0afe-142">A [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) operation is affected by the wait mode of a pipe handle when there is insufficient space in the pipe's buffer.</span></span> <span data-ttu-id="b0afe-143">Avec un handle d’attente de blocage, l’opération d’écriture ne peut pas être effectuée tant qu’un espace suffisant n’a pas été créé dans la mémoire tampon par un thread lisant à l’autre extrémité du canal.</span><span class="sxs-lookup"><span data-stu-id="b0afe-143">With a blocking-wait handle, the write operation cannot succeed until sufficient space is created in the buffer by a thread reading from the other end of the pipe.</span></span> <span data-ttu-id="b0afe-144">Avec un handle d’attente sans blocage, l’opération d’écriture retourne immédiatement une valeur différente de zéro, sans écrire d’octets (pour un canal de type de message) ou après avoir écrit autant d’octets que la mémoire tampon contient (pour un canal de type octet).</span><span class="sxs-lookup"><span data-stu-id="b0afe-144">With a nonblocking-wait handle, the write operation returns a nonzero value immediately, without writing any bytes (for a message-type pipe) or after writing as many bytes as the buffer holds (for a byte-type pipe).</span></span>

<span data-ttu-id="b0afe-145">Une opération [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) est affectée par le mode d’attente d’un handle de canal quand aucun client n’est connecté ou en attente de connexion à l’instance de canal.</span><span class="sxs-lookup"><span data-stu-id="b0afe-145">A [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) operation is affected by the wait mode of a pipe handle when there is no client connected or waiting to connect to the pipe instance.</span></span> <span data-ttu-id="b0afe-146">Avec un handle d’attente de blocage, l’opération de connexion ne fonctionne pas tant qu’un client de canal ne se connecte pas à l’instance de canal en appelant la fonction [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) ou [**CallNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) .</span><span class="sxs-lookup"><span data-stu-id="b0afe-146">With a blocking-wait handle, the connect operation does not succeed until a pipe client connects to the pipe instance by calling either the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) or [**CallNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) function.</span></span> <span data-ttu-id="b0afe-147">Avec un handle d’attente sans blocage, l’opération de connexion retourne immédiatement zéro, et la fonction [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) retourne le canal d’erreur à l' \_ \_ écoute.</span><span class="sxs-lookup"><span data-stu-id="b0afe-147">With a nonblocking-wait handle, the connect operation returns zero immediately, and the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns ERROR\_PIPE\_LISTENING.</span></span>

<span data-ttu-id="b0afe-148">Par défaut, tous les descripteurs de canaux nommés retournés par la fonction [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) ou [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) sont créés avec le mode d’attente de blocage activé.</span><span class="sxs-lookup"><span data-stu-id="b0afe-148">By default, all named pipe handles returned by the [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) or [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function are created with blocking-wait mode enabled.</span></span> <span data-ttu-id="b0afe-149">Pour créer le canal en mode de non-blocage-Wait, le serveur de canaux spécifie la valeur de la barre d’attente de canal lors de l' \_ appel de **CreateNamedPipe**.</span><span class="sxs-lookup"><span data-stu-id="b0afe-149">To create the pipe in nonblocking-wait mode, the pipe server specifies PIPE\_NOWAIT when calling **CreateNamedPipe**.</span></span>

<span data-ttu-id="b0afe-150">Les clients de canal et les serveurs de canal peuvent modifier le mode d’attente d’un handle de canal en spécifiant l’attente de canal \_ ou la valeur de canal \_ d’attente dans un appel à la fonction [**SetNamedPipeHandleState**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) .</span><span class="sxs-lookup"><span data-stu-id="b0afe-150">Both pipe clients and pipe servers can change a pipe handle's wait mode by specifying either PIPE\_WAIT or PIPE\_NOWAIT in a call to the [**SetNamedPipeHandleState**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) function.</span></span>

> [!Note]  
> <span data-ttu-id="b0afe-151">Le mode d’attente sans blocage est pris en charge pour la compatibilité avec Microsoft LAN Manager version 2,0.</span><span class="sxs-lookup"><span data-stu-id="b0afe-151">The nonblocking-wait mode is supported for compatibility with Microsoft LAN Manager version 2.0.</span></span> <span data-ttu-id="b0afe-152">Ce mode ne doit pas être utilisé pour obtenir une entrée et une sortie (e/s) avec des canaux nommés.</span><span class="sxs-lookup"><span data-stu-id="b0afe-152">This mode should not be used to achieve overlapped input and output (I/O) with named pipes.</span></span> <span data-ttu-id="b0afe-153">Les e/s avec chevauchement doivent être utilisées à la place, car elles permettent aux opérations de longue durée de s’exécuter en arrière-plan après le retour de la fonction.</span><span class="sxs-lookup"><span data-stu-id="b0afe-153">Overlapped I/O should be used instead, because it enables time-consuming operations to run in the background after the function returns.</span></span> <span data-ttu-id="b0afe-154">Pour plus d’informations sur les e/s avec chevauchement, consultez [entrées et sorties synchrones et avec chevauchement](synchronous-and-overlapped-input-and-output.md).</span><span class="sxs-lookup"><span data-stu-id="b0afe-154">For more information about overlapped I/O, see [Synchronous and Overlapped Input and Output](synchronous-and-overlapped-input-and-output.md).</span></span>

 

 

 
