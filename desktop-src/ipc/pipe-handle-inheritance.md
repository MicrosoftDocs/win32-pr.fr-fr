---
description: Le serveur de canaux contrôle si ses Handles peuvent être hérités des manières suivantes.
ms.assetid: 72302f8b-f3a2-4efc-aab1-e596b8323984
title: Héritage de handle de canal
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 21cf91d4393b43011a2df632806f96da1e713b96
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103749669"
---
# <a name="pipe-handle-inheritance"></a><span data-ttu-id="64998-103">Héritage de handle de canal</span><span class="sxs-lookup"><span data-stu-id="64998-103">Pipe Handle Inheritance</span></span>

<span data-ttu-id="64998-104">Le serveur de canaux contrôle si ses Handles peuvent être hérités des manières suivantes :</span><span class="sxs-lookup"><span data-stu-id="64998-104">The pipe server controls whether its handles can be inherited in the following ways:</span></span>

-   <span data-ttu-id="64998-105">La fonction [**CreatePipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-createpipe) reçoit une structure d' [**\_ attributs de sécurité**](/previous-versions/windows/desktop/legacy/aa379560(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="64998-105">The [**CreatePipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-createpipe) function receives a [**SECURITY\_ATTRIBUTES**](/previous-versions/windows/desktop/legacy/aa379560(v=vs.85)) structure.</span></span> <span data-ttu-id="64998-106">Si le serveur de canal affecte la **valeur true** au membre **bInheritHandle** de cette structure, les descripteurs créés par **CreatePipe** peuvent être hérités.</span><span class="sxs-lookup"><span data-stu-id="64998-106">If the pipe server sets the **bInheritHandle** member of this structure to **TRUE**, the handles created by **CreatePipe** can be inherited.</span></span>
-   <span data-ttu-id="64998-107">Le serveur de canal peut utiliser la fonction [**DuplicateHandle**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) pour modifier l’héritage d’un handle de canal.</span><span class="sxs-lookup"><span data-stu-id="64998-107">The pipe server can use the [**DuplicateHandle**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) function to change the inheritance of a pipe handle.</span></span> <span data-ttu-id="64998-108">Le serveur de canaux peut créer un doublon non héritable d’un handle de canal héritable ou un doublon pouvant être hérité d’un handle de canal non héritable.</span><span class="sxs-lookup"><span data-stu-id="64998-108">The pipe server can create a noninheritable duplicate of an inheritable pipe handle or an inheritable duplicate of a noninheritable pipe handle.</span></span>
-   <span data-ttu-id="64998-109">La fonction [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) permet au serveur de canal de spécifier si un processus enfant hérite de tout ou partie de ses Handles pouvant être hérités.</span><span class="sxs-lookup"><span data-stu-id="64998-109">The [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) function enables the pipe server to specify whether a child process inherits all or none of its inheritable handles.</span></span>

<span data-ttu-id="64998-110">Lorsqu’un processus enfant hérite d’un handle de canal, le système permet au processus d’accéder au canal.</span><span class="sxs-lookup"><span data-stu-id="64998-110">When a child process inherits a pipe handle, the system enables the process to access the pipe.</span></span> <span data-ttu-id="64998-111">Toutefois, le processus parent doit communiquer la valeur du handle au processus enfant.</span><span class="sxs-lookup"><span data-stu-id="64998-111">However, the parent process must communicate the handle value to the child process.</span></span> <span data-ttu-id="64998-112">Le processus parent effectue généralement cette opération en redirigeant le descripteur de sortie standard vers le processus enfant, comme indiqué dans les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="64998-112">The parent process typically does this by redirecting the standard output handle to the child process, as shown in the following steps:</span></span>

1.  <span data-ttu-id="64998-113">Appelez la fonction [**GetStdHandle**](/windows/console/getstdhandle) pour récupérer le handle de sortie standard actuel ; Enregistrez ce handle pour pouvoir restaurer le descripteur de sortie standard d’origine après la création du processus enfant.</span><span class="sxs-lookup"><span data-stu-id="64998-113">Call the [**GetStdHandle**](/windows/console/getstdhandle) function to get the current standard output handle; save this handle so you can restore the original standard output handle after the child process has been created.</span></span>
2.  <span data-ttu-id="64998-114">Appelez la fonction [**SetStdHandle**](/windows/console/setstdhandle) pour définir le handle de sortie standard du handle d’écriture sur le canal.</span><span class="sxs-lookup"><span data-stu-id="64998-114">Call the [**SetStdHandle**](/windows/console/setstdhandle) function to set the standard output handle to the write handle to the pipe.</span></span> <span data-ttu-id="64998-115">Désormais, le processus parent peut créer le processus enfant.</span><span class="sxs-lookup"><span data-stu-id="64998-115">Now the parent process can create the child process.</span></span>
3.  <span data-ttu-id="64998-116">Appelez la fonction [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) pour fermer le handle d’écriture sur le canal.</span><span class="sxs-lookup"><span data-stu-id="64998-116">Call the [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) function to close the write handle to the pipe.</span></span> <span data-ttu-id="64998-117">Une fois que le processus enfant hérite du handle d’écriture, le processus parent n’a plus besoin de sa copie.</span><span class="sxs-lookup"><span data-stu-id="64998-117">After the child process inherits the write handle, the parent process no longer needs its copy.</span></span>
4.  <span data-ttu-id="64998-118">Appelez [**SetStdHandle**](/windows/console/setstdhandle) pour restaurer le descripteur de sortie standard d’origine.</span><span class="sxs-lookup"><span data-stu-id="64998-118">Call [**SetStdHandle**](/windows/console/setstdhandle) to restore the original standard output handle.</span></span>

<span data-ttu-id="64998-119">Le processus enfant utilise la fonction [**GetStdHandle**](/windows/console/getstdhandle) pour obtenir son descripteur de sortie standard, qui est maintenant un handle vers la fin d’écriture d’un canal.</span><span class="sxs-lookup"><span data-stu-id="64998-119">The child process uses the [**GetStdHandle**](/windows/console/getstdhandle) function to get its standard output handle, which is now a handle to the write end of a pipe.</span></span> <span data-ttu-id="64998-120">Le processus enfant utilise ensuite la fonction [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) pour envoyer sa sortie vers le canal.</span><span class="sxs-lookup"><span data-stu-id="64998-120">The child process then uses the [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) function to send its output to the pipe.</span></span> <span data-ttu-id="64998-121">Lorsque l’enfant a terminé avec le canal, il doit fermer le handle de canal en appelant [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) ou en terminant, ce qui ferme automatiquement le handle.</span><span class="sxs-lookup"><span data-stu-id="64998-121">When the child has finished with the pipe, it should close the pipe handle by calling [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) or by terminating, which automatically closes the handle.</span></span>

<span data-ttu-id="64998-122">Le processus parent utilise la fonction [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) pour recevoir l’entrée du canal.</span><span class="sxs-lookup"><span data-stu-id="64998-122">The parent process uses the [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) function to receive input from the pipe.</span></span> <span data-ttu-id="64998-123">Les données sont écrites dans un canal anonyme en tant que flux d’octets.</span><span class="sxs-lookup"><span data-stu-id="64998-123">Data is written to an anonymous pipe as a stream of bytes.</span></span> <span data-ttu-id="64998-124">Cela signifie que le processus parent lisant à partir d’un canal ne peut pas faire la distinction entre les octets écrits dans des opérations d’écriture distinctes, à moins que les processus parent et enfant utilisent un protocole pour indiquer l’emplacement de fin de l’opération d’écriture.</span><span class="sxs-lookup"><span data-stu-id="64998-124">This means that the parent process reading from a pipe cannot distinguish between the bytes written in separate write operations, unless both the parent and child processes use a protocol to indicate where the write operation ends.</span></span> <span data-ttu-id="64998-125">Lorsque tous les descripteurs d’écriture du canal sont fermés, la fonction **ReadFile** retourne la valeur zéro.</span><span class="sxs-lookup"><span data-stu-id="64998-125">When all write handles to the pipe are closed, the **ReadFile** function returns zero.</span></span> <span data-ttu-id="64998-126">Il est important que le processus parent ferme son handle à la fin d’écriture du canal avant d’appeler **ReadFile**.</span><span class="sxs-lookup"><span data-stu-id="64998-126">It is important for the parent process to close its handle to the write end of the pipe before calling **ReadFile**.</span></span> <span data-ttu-id="64998-127">Si ce n’est pas le cas, l’opération **ReadFile** ne peut pas retourner la valeur zéro, car le processus parent a un handle ouvert à la fin d’écriture du canal.</span><span class="sxs-lookup"><span data-stu-id="64998-127">If this is not done, the **ReadFile** operation cannot return zero because the parent process has an open handle to the write end of the pipe.</span></span>

<span data-ttu-id="64998-128">La procédure de redirection du handle d’entrée standard est semblable à celle utilisée pour rediriger le descripteur de sortie standard, à la différence près que le handle de lecture du canal est utilisé comme handle d’entrée standard de l’enfant.</span><span class="sxs-lookup"><span data-stu-id="64998-128">The procedure for redirecting the standard input handle is similar to that for redirecting the standard output handle, except that the pipe's read handle is used as the child's standard input handle.</span></span> <span data-ttu-id="64998-129">Dans ce cas, le processus parent doit s’assurer que le processus enfant n’hérite pas du handle d’écriture du canal.</span><span class="sxs-lookup"><span data-stu-id="64998-129">In this case, the parent process must ensure that the child process does not inherit the pipe's write handle.</span></span> <span data-ttu-id="64998-130">Si ce n’est pas le cas, l’opération [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) effectuée par le processus enfant ne peut pas retourner la valeur zéro, car le processus enfant a un handle ouvert à la fin d’écriture du canal.</span><span class="sxs-lookup"><span data-stu-id="64998-130">If this is not done, the [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) operation performed by the child process cannot return zero because the child process has an open handle to the write end of the pipe.</span></span>

<span data-ttu-id="64998-131">Pour obtenir un exemple de programme qui utilise des canaux anonymes pour rediriger les handles standard d’un processus enfant, consultez [création d’un processus enfant avec une entrée et une sortie redirigées](/windows/desktop/ProcThread/creating-a-child-process-with-redirected-input-and-output).</span><span class="sxs-lookup"><span data-stu-id="64998-131">For an example program that uses anonymous pipes to redirect the standard handles of a child process, see [Creating a Child Process with Redirected Input and Output](/windows/desktop/ProcThread/creating-a-child-process-with-redirected-input-and-output).</span></span>

 

 
