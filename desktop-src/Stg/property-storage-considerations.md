---
title: Considérations sur le stockage des propriétés
description: IPropertyStorage ReadMultiple lit autant de propriétés spécifiées dans le tableau rgpspec que dans le jeu de propriétés.
ms.assetid: 7540966f-a3b2-46c9-9e04-b15133a517eb
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2aad6aabf8b22a7c01f91a090136e6cc8156c791
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "106510885"
---
# <a name="property-storage-considerations"></a><span data-ttu-id="214f5-103">Considérations sur le stockage des propriétés</span><span class="sxs-lookup"><span data-stu-id="214f5-103">Property Storage Considerations</span></span>

<span data-ttu-id="214f5-104">[**IPropertyStorage :: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) lit autant de propriétés spécifiées dans le tableau *rgpspec* que dans le jeu de propriétés.</span><span class="sxs-lookup"><span data-stu-id="214f5-104">[**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) reads as many of the properties specified in the *rgpspec* array as are found in the property set.</span></span> <span data-ttu-id="214f5-105">Tant que l’une des propriétés demandées est lue, une demande de récupération d’une propriété qui n’existe pas n’est pas une erreur.</span><span class="sxs-lookup"><span data-stu-id="214f5-105">As long as any of the properties requested is read, a request to retrieve a property that does not exist is not an error.</span></span> <span data-ttu-id="214f5-106">Au lieu de cela, elle doit entraîner \_ l’écriture de VT vide pour cette propriété dans le tableau *rgvar* \[ \] lors du retour.</span><span class="sxs-lookup"><span data-stu-id="214f5-106">Instead, this must cause VT\_EMPTY to be written for that property to the *rgvar*\[\] array on return.</span></span> <span data-ttu-id="214f5-107">Si aucune des propriétés demandées n’existe, la méthode doit retourner S \_ false et définir VT \_ vide dans chaque [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span><span class="sxs-lookup"><span data-stu-id="214f5-107">When none of the requested properties exist, the method should return S\_FALSE, and set VT\_EMPTY in each [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span></span> <span data-ttu-id="214f5-108">Si une autre erreur est retournée, aucune valeur de propriété n’est récupérée et l’appelant n’a pas besoin de se préoccuper de la libération.</span><span class="sxs-lookup"><span data-stu-id="214f5-108">If any other error is returned, no property values are retrieved, and the caller need not worry about releasing them.</span></span>

<span data-ttu-id="214f5-109">Le paramètre *rgpspec* est un tableau de structures [**PROPSPEC**](/windows/win32/api/propidlbase/ns-propidlbase-propspec) , qui spécifient pour chaque propriété son identificateur de propriété ou, le cas échéant, un identificateur de chaîne.</span><span class="sxs-lookup"><span data-stu-id="214f5-109">The *rgpspec* parameter is an array of [**PROPSPEC**](/windows/win32/api/propidlbase/ns-propidlbase-propspec) structures, which specify for each property either its property identifier or, if one is assigned, a string identifier.</span></span> <span data-ttu-id="214f5-110">Vous pouvez mapper une chaîne à un identificateur de propriété en appelant [**IPropertyStorage :: WritePropertyNames**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames).</span><span class="sxs-lookup"><span data-stu-id="214f5-110">You can map a string to a property identifier by calling [**IPropertyStorage::WritePropertyNames**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames).</span></span> <span data-ttu-id="214f5-111">Toutefois, l’utilisation d’identificateurs de propriété est susceptible d’être beaucoup plus efficace que l’utilisation de chaînes.</span><span class="sxs-lookup"><span data-stu-id="214f5-111">The use of property identifiers is, however, likely to be significantly more efficient than the use of strings.</span></span>

<span data-ttu-id="214f5-112">Les propriétés qui sont demandées par le nom de chaîne (PRSPEC \_ LPWStr) sont mappées sans respect de la casse aux identificateurs de propriété (ID), car ils sont spécifiés dans le jeu de propriétés actuel (et en fonction des paramètres régionaux système actuels).</span><span class="sxs-lookup"><span data-stu-id="214f5-112">Properties that are requested by string name (PRSPEC\_LPWSTR) are mapped case-insensitively to property identifiers (IDs) as they are specified in the current property set (and according to the current system locale).</span></span>

<span data-ttu-id="214f5-113">Lorsque le type de propriété est VT \_ LPSTR et que la propriété est lue à partir d’un jeu de propriétés ANSI, autrement dit, la page de codes pour le jeu de propriétés est définie sur une valeur autre que Unicode, la valeur de la propriété utilise la même page de codes que le jeu de propriétés.</span><span class="sxs-lookup"><span data-stu-id="214f5-113">When the property type is VT\_LPSTR and the property is read from an ANSI property set, that is, the code page for the property set is set to something other than Unicode, the value of the property uses the same code page as the property set.</span></span> <span data-ttu-id="214f5-114">Lorsqu’une \_ propriété VT LPSTR est lue à partir d’un jeu de propriétés Unicode, la valeur de la propriété utilise la page de codes ANSI par défaut du système, autrement dit, la page de codes retournée par la fonction **GetACP** .</span><span class="sxs-lookup"><span data-stu-id="214f5-114">When a VT\_LPSTR property is read from a Unicode property set, the value of the property uses the system's current default ANSI code page, that is, the code page returned from the **GetACP** function.</span></span>

<span data-ttu-id="214f5-115">Un [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant), à l’exception de ceux qui sont des pointeurs vers des flux et des stockages, est appelé un **PROPVARIANT** simple.</span><span class="sxs-lookup"><span data-stu-id="214f5-115">A [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant), except for those that are pointers to streams and storages, is called a simple **PROPVARIANT**.</span></span> <span data-ttu-id="214f5-116">Ces **PROPVARIANT** simples reçoivent des données par valeur, donc un appel à [**IPropertyStorage :: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) fournit une copie des données que l’appelant possède.</span><span class="sxs-lookup"><span data-stu-id="214f5-116">These simple **PROPVARIANT** s receive data by value, so a call to [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) supplies a copy of the data that the caller then owns.</span></span> <span data-ttu-id="214f5-117">Pour créer ou mettre à jour ces propriétés, appelez [**IPropertyStorage :: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="214f5-117">To create or update these properties, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span>

<span data-ttu-id="214f5-118">En revanche, les types variant VT \_ Stream, VT \_ streaming \_ Object, VT \_ Storage et VT \_ stocked \_ Object sont des propriétés non simples, car au lieu de fournir une valeur, la méthode récupère un pointeur vers l’interface indiquée, à partir de laquelle les données peuvent ensuite être lues.</span><span class="sxs-lookup"><span data-stu-id="214f5-118">In contrast, the variant types VT\_STREAM, VT\_STREAMED\_OBJECT, VT\_STORAGE, and VT\_STORED\_OBJECT are non-simple properties, because rather than supplying a value, the method retrieves a pointer to the indicated interface, from which the data can then be read.</span></span> <span data-ttu-id="214f5-119">Ces types autorisent le stockage de grandes quantités d’informations par le biais d’une seule propriété.</span><span class="sxs-lookup"><span data-stu-id="214f5-119">These types permit the storage of large amounts of information through a single property.</span></span> <span data-ttu-id="214f5-120">Il existe plusieurs problèmes qui surviennent lors de l’utilisation de propriétés qui ne sont pas simples.</span><span class="sxs-lookup"><span data-stu-id="214f5-120">There are several issues that arise in using nonsimple properties.</span></span>

<span data-ttu-id="214f5-121">Pour créer ces propriétés, comme pour les autres propriétés, appelez [**IPropertyStorage :: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="214f5-121">To create these properties, as for the other properties, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span> <span data-ttu-id="214f5-122">Au lieu d’appeler la même méthode pour mettre à jour, toutefois, il est plus efficace d’appeler [**IPropertyStorage :: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) pour obtenir le pointeur d’interface vers le flux ou le stockage, puis d’écrire des données à l’aide des méthodes [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) ou [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="214f5-122">Rather than calling the same method to update, however, it is more efficient to first call [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to get the interface pointer to the stream or storage, then write data using the [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) or [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) methods.</span></span> <span data-ttu-id="214f5-123">Un flux ou un stockage ouvert via une propriété est toujours ouvert en mode direct, donc un niveau supplémentaire de transaction imbriquée n’est pas introduit.</span><span class="sxs-lookup"><span data-stu-id="214f5-123">A stream or storage opened through a property is always opened in direct mode, so an additional level of nested transaction is not introduced.</span></span> <span data-ttu-id="214f5-124">Toutefois, il peut toujours s’agir d’une transaction sur la propriété définie dans son ensemble, en fonction de son mode d’ouverture ou de création par le biais de [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage).</span><span class="sxs-lookup"><span data-stu-id="214f5-124">There may, however, still be a transaction on the property set as a whole, depending on how it was opened or created through [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage).</span></span> <span data-ttu-id="214f5-125">En outre, les balises d’accès et de mode de partage spécifiées lors de l’ouverture ou de la création du jeu de propriétés sont passées aux flux de propriétés ou aux stockages.</span><span class="sxs-lookup"><span data-stu-id="214f5-125">Further, the access and share mode tags specified when the property set is opened or created, are passed to property-based streams or storages.</span></span>

<span data-ttu-id="214f5-126">Les durées de vie des pointeurs de stockage ou de flux basés sur des propriétés, bien que théoriquement indépendantes des pointeurs [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) et [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) associés, en fait, dépendent effectivement de ces derniers.</span><span class="sxs-lookup"><span data-stu-id="214f5-126">The lifetimes of property-based stream or storage pointers, although theoretically independent of their associated [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) and [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) pointers, in fact, effectively depend on them.</span></span> <span data-ttu-id="214f5-127">Les données visibles via le flux ou le stockage sont liées à la transaction sur l’objet de stockage de propriétés à partir duquel elles sont récupérées, tout comme pour un objet de stockage (qui prend en charge [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)) avec un flux de données et des sous-objets de stockage contenus.</span><span class="sxs-lookup"><span data-stu-id="214f5-127">The data visible through the stream or storage is related to the transaction on the property storage object from which it is retrieved, just as for a storage object (supporting [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)) with contained stream and storage sub-objects.</span></span> <span data-ttu-id="214f5-128">Si la transaction sur l’objet parent est abandonnée, les pointeurs [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) et **IStorage** existants subordonnés à cet objet ne sont plus accessibles.</span><span class="sxs-lookup"><span data-stu-id="214f5-128">If the transaction on the parent object is aborted, existing [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) and **IStorage** pointers subordinate to that object are no longer accessible.</span></span> <span data-ttu-id="214f5-129">Étant donné que **IPropertyStorage** est la seule interface sur l’objet de stockage de propriété, la durée de vie utile des pointeurs **IStream** et **IStorage** contenus est limitée par la durée de vie de l’interface **IPropertyStorage** .</span><span class="sxs-lookup"><span data-stu-id="214f5-129">Because **IPropertyStorage** is the only interface on the property storage object, the useful lifetime of the contained **IStream** and **IStorage** pointers is bounded by the lifetime of the **IPropertyStorage** interface.</span></span>

<span data-ttu-id="214f5-130">L’implémentation doit également gérer la situation dans laquelle la même propriété de flux ou de valeur de stockage est demandée plusieurs fois via la même instance d’interface [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) .</span><span class="sxs-lookup"><span data-stu-id="214f5-130">The implementation must also deal with the situation where the same stream- or storage-valued property is requested multiple times through the same [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) interface instance.</span></span> <span data-ttu-id="214f5-131">Par exemple, dans l’implémentation du fichier composé COM, l’ouverture réussit ou échoue selon que la propriété est déjà ouverte ou non.</span><span class="sxs-lookup"><span data-stu-id="214f5-131">For example, in the COM compound file implementation, the open will succeed or fail depending on whether or not the property is already open.</span></span>

<span data-ttu-id="214f5-132">Un autre problème est que plusieurs s’ouvrent en mode traité.</span><span class="sxs-lookup"><span data-stu-id="214f5-132">Another issue is multiple opens in transacted mode.</span></span> <span data-ttu-id="214f5-133">Le résultat dépend du niveau d’isolement spécifié par un appel aux méthodes [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) (méthode [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) ou [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) , via les indicateurs STGM) au moment de l’ouverture du stockage des propriétés.</span><span class="sxs-lookup"><span data-stu-id="214f5-133">The result depends on the isolation level that was specified through a call to [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) methods, (either the [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) or [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) method, through the STGM flags) at the time that the property storage was opened.</span></span>

<span data-ttu-id="214f5-134">Si l’appel permettant d’ouvrir le jeu de propriétés spécifie l’accès en lecture-écriture, les propriétés [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) et [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)sont toujours ouvertes avec un accès en lecture-écriture.</span><span class="sxs-lookup"><span data-stu-id="214f5-134">If the call to open the property set specifies read-write access, [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) and [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)-valued properties are always opened with read-write access.</span></span> <span data-ttu-id="214f5-135">Les données peuvent ensuite être écrites à l’aide de ces interfaces, en modifiant la valeur de la propriété, qui est la méthode la plus efficace pour mettre à jour ces propriétés.</span><span class="sxs-lookup"><span data-stu-id="214f5-135">Data can then be written through these interfaces, changing the value of the property, which is the most efficient way to update these properties.</span></span> <span data-ttu-id="214f5-136">La valeur de propriété elle-même n’a pas de niveau supplémentaire d’imbrication de transactions, de sorte que les modifications sont délimitées sous la transaction (le cas échéant) sur l’objet de stockage de propriété.</span><span class="sxs-lookup"><span data-stu-id="214f5-136">The property value itself does not have an additional level of transaction nesting, so changes are scoped under the transaction (if any) on the property storage object.</span></span>

## <a name="storage-and-stream-properties"></a><span data-ttu-id="214f5-137">Propriétés de stockage et de flux</span><span class="sxs-lookup"><span data-stu-id="214f5-137">Storage and Stream Properties</span></span>

<span data-ttu-id="214f5-138">Pour écrire un flux ou un objet de stockage dans un jeu de propriétés, le jeu de propriétés doit avoir été créé comme étant insimple.</span><span class="sxs-lookup"><span data-stu-id="214f5-138">To write a stream or storage object to a property set, the property set must have been created as nonsimple.</span></span> <span data-ttu-id="214f5-139">Pour plus d’informations sur les jeux de propriétés simples et simples, consultez la section intitulée [stockage et objets de flux pour un jeu de propriétés](storage-vs--stream-for-a-property-set.md).</span><span class="sxs-lookup"><span data-stu-id="214f5-139">For more information on simple and nonsimple property sets, see the section titled [Storage and Stream Objects for a Property Set](storage-vs--stream-for-a-property-set.md).</span></span> <span data-ttu-id="214f5-140">Les types de propriétés suivants, tels qu’ils sont spécifiés dans le champ *VT* des éléments du tableau *rgvar* , sont les types de flux ou de stockage : VT \_ Stream, VT \_ Storage, VT \_ streamingd \_ Object, VT \_ stocked \_ Object.</span><span class="sxs-lookup"><span data-stu-id="214f5-140">The following property types, as specified in the *vt* field of the *rgvar* array elements, are stream or storage types: VT\_STREAM, VT\_STORAGE, VT\_STREAMED\_OBJECT, VT\_STORED\_OBJECT.</span></span>

<span data-ttu-id="214f5-141">Pour écrire un flux ou un objet de stockage en tant que propriété dans un jeu de propriétés non-simple, appelez [**IPropertyStorage :: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="214f5-141">To write a stream or storage object as a property in a non-simple property set, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span> <span data-ttu-id="214f5-142">Bien que vous appeliez également cette méthode pour mettre à jour des propriétés simples, il ne s’agit pas d’un moyen efficace de mettre à jour les objets de flux et de stockage dans un jeu de propriétés.</span><span class="sxs-lookup"><span data-stu-id="214f5-142">While you would also call this method to update simple properties, it is not an efficient way to update stream and storage objects in a property set.</span></span> <span data-ttu-id="214f5-143">Cela est dû au fait que la mise à jour de l’une de ces propriétés via un appel à **WriteMultiple** crée dans l’objet de stockage des propriétés une copie des données transmises, et les pointeurs [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) ou [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) ne sont pas conservés au-delà de la durée de cet appel.</span><span class="sxs-lookup"><span data-stu-id="214f5-143">This is because updating one of these properties through a call to **WriteMultiple** creates in the property storage object a copy of the passed-in data, and the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) or [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) pointers are not retained beyond the duration of this call.</span></span> <span data-ttu-id="214f5-144">Il est généralement plus efficace de mettre à jour les objets de flux ou de stockage directement en appelant d’abord [**IPropertyStorage :: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) pour obtenir le pointeur d’interface vers le flux ou le stockage, puis en écrivant des données via les méthodes **IStream** ou **IStorage** .</span><span class="sxs-lookup"><span data-stu-id="214f5-144">It is usually more efficient to update stream or storage objects directly by first calling [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to get the interface pointer to the stream or storage, then writing data through the **IStream** or **IStorage** methods.</span></span>

<span data-ttu-id="214f5-145">Par exemple, vous pouvez appeler [**IPropertyStorage :: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) pour écrire un flux ou un objet de stockage **null** .</span><span class="sxs-lookup"><span data-stu-id="214f5-145">For example, you can call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) to write a **NULL** stream or storage object.</span></span> <span data-ttu-id="214f5-146">L’implémentation créera ensuite un objet vide dans le jeu de propriétés.</span><span class="sxs-lookup"><span data-stu-id="214f5-146">The implementation will then create an empty object in the property set.</span></span> <span data-ttu-id="214f5-147">Vous pouvez ensuite accéder à cet objet en appelant [**IPropertyStorage :: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple).</span><span class="sxs-lookup"><span data-stu-id="214f5-147">You can then get access to this object by calling [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple).</span></span> <span data-ttu-id="214f5-148">Lorsque vous avez terminé la mise à jour de cet objet, vous n’avez pas besoin de l’écrire dans le jeu de propriétés, car vos mises à jour se trouvent directement dans le jeu de propriétés.</span><span class="sxs-lookup"><span data-stu-id="214f5-148">When you finish updating this object you need not write it to the property set, as your updates were going directly into the property set.</span></span>

<span data-ttu-id="214f5-149">Un flux ou un stockage ouvert via une propriété est toujours ouvert en mode direct, donc un niveau supplémentaire de transaction imbriquée n’est pas introduit.</span><span class="sxs-lookup"><span data-stu-id="214f5-149">A stream or storage opened through a property is always opened in direct mode, so an additional level of nested transaction is not introduced.</span></span> <span data-ttu-id="214f5-150">Il peut toujours y avoir une transaction sur la propriété définie dans son ensemble.</span><span class="sxs-lookup"><span data-stu-id="214f5-150">There still may be a transaction on the property set as a whole.</span></span> <span data-ttu-id="214f5-151">(Par exemple, si l' [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) a été obtenu en appelant [**IPropertySetStorage :: Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) avec STGM \_ Indicateur traité défini dans le paramètre *grfMode* .) En outre, un flux ou un flux de données basé sur les propriétés est ouvert en mode lecture-écriture, si possible, étant donné le mode sur le jeu de propriétés ; Sinon, le mode de lecture est utilisé.</span><span class="sxs-lookup"><span data-stu-id="214f5-151">(For example, if the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) was obtained by calling [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) with the STGM\_TRANSACTED flag set in the *grfmode* parameter.) Further, a property-based stream or storage is opened in read-write mode, if possible, given the mode on the property set; otherwise, read mode is used.</span></span>

<span data-ttu-id="214f5-152">Comme mentionné précédemment, lorsqu’un objet Stream ou Storage est écrit dans une propriété définie avec la méthode [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) , une copie de l’objet est effectuée.</span><span class="sxs-lookup"><span data-stu-id="214f5-152">As mentioned earlier, when a stream or storage object is written to a property set with the [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) method, a copy of the object is made.</span></span> <span data-ttu-id="214f5-153">Lorsqu’une telle copie est effectuée sur un objet de flux, l’opération de copie commence à la position de recherche actuelle de la source.</span><span class="sxs-lookup"><span data-stu-id="214f5-153">When such a copy is made on a stream object, the copy operation starts at the current seek position of the source.</span></span> <span data-ttu-id="214f5-154">La position de recherche n’est pas définie en cas d’échec, mais en cas de réussite, elle se trouve à la fin du flux. le pointeur de recherche n’est pas restauré à sa position d’origine.</span><span class="sxs-lookup"><span data-stu-id="214f5-154">The seek position is undefined on failure, but on success it is at the end of the stream; the seek pointer is not restored to its original position.</span></span>

<span data-ttu-id="214f5-155">Si une propriété de flux ou de stockage a été lue à partir d’un jeu de propriétés avec [**ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple), est toujours ouverte et un appel ultérieur à [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) pour la même propriété est effectué, l’opération **WriteMultiple** réussit.</span><span class="sxs-lookup"><span data-stu-id="214f5-155">If a stream or storage property has been read from a property set with [**ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple), is still held open, and a subsequent call to [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) for the same property is made, the **WriteMultiple** operation will succeed.</span></span> <span data-ttu-id="214f5-156">Le flux ou la propriété de stockage précédemment ouverts est placé dans l’État rétabli (tous les appels à ce dernier retourneront l' \_ erreur STG E \_ revertd Error).</span><span class="sxs-lookup"><span data-stu-id="214f5-156">The previously opened stream or storage property is placed in the reverted state (all calls to it will return STG\_E\_REVERTED error).</span></span>

<span data-ttu-id="214f5-157">Si la méthode [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) retourne une erreur lors de l’écriture d’un tableau de propriétés, ou même des propriétés individuelles non simples, la quantité de données réellement écrites n’est pas définie.</span><span class="sxs-lookup"><span data-stu-id="214f5-157">If the [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) method returns an error when writing an array of properties, or even individual non-simple properties, the amount of data actually written is undefined.</span></span>

## <a name="reference-properties"></a><span data-ttu-id="214f5-158">Propriétés de référence</span><span class="sxs-lookup"><span data-stu-id="214f5-158">Reference Properties</span></span>

<span data-ttu-id="214f5-159">Si une structure [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) spécifiée comprend l' \_ indicateur VT ByRef dans son membre **VT** , la propriété associée est une propriété de référence.</span><span class="sxs-lookup"><span data-stu-id="214f5-159">If a specified [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) structure includes the VT\_BYREF flag in its **vt** member, the associated property is a reference property.</span></span> <span data-ttu-id="214f5-160">Une propriété de référence est automatiquement déréférencée avant l’écriture de la valeur dans le jeu de propriétés.</span><span class="sxs-lookup"><span data-stu-id="214f5-160">A reference property is automatically dereferenced before writing the value to the property set.</span></span> <span data-ttu-id="214f5-161">Par exemple, si le membre **VT** de la structure **PROPVARIANT** spécifie une valeur de type VT VT \_ \| VT \_ i4, la valeur réelle écrite est un \_ type VT I4.</span><span class="sxs-lookup"><span data-stu-id="214f5-161">For example, if the **vt** member of the **PROPVARIANT** structure specifies a value of type VT\_BYREF \| VT\_I4, the actual value written is a VT\_I4 type.</span></span> <span data-ttu-id="214f5-162">Un appel ultérieur à la méthode [**IPropertyStorage :: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) retourne une valeur en tant que VT \_ I4.</span><span class="sxs-lookup"><span data-stu-id="214f5-162">A subsequent call to the [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) method returns a value as VT\_I4.</span></span> <span data-ttu-id="214f5-163">L’utilisation des propriétés de référence est semblable à l’appel de la fonction [VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) .</span><span class="sxs-lookup"><span data-stu-id="214f5-163">Using reference properties is similar to calling the [VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) function.</span></span> <span data-ttu-id="214f5-164">[VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) libère la variante de destination et effectue une copie de la VARIANTARG source, en effectuant l’indirection nécessaire si la source est spécifiée comme étant VT \_ ByRef.</span><span class="sxs-lookup"><span data-stu-id="214f5-164">[VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) frees the destination variant and makes a copy of the source VARIANTARG, performing the necessary indirection if the source is specified to be VT\_BYREF.</span></span> <span data-ttu-id="214f5-165">Cette fonction est utile quand une copie d’une variante est nécessaire et pour garantir qu’elle n’est pas VT \_ ByRef, par exemple lors de la gestion des arguments dans une implémentation de [**IDispatch :: Invoke**](/windows/win32/api/oaidl/nf-oaidl-idispatch-invoke).</span><span class="sxs-lookup"><span data-stu-id="214f5-165">This function is useful when a copy of a variant is needed, and to guarantee that it is not VT\_BYREF, for example when handling arguments in an implementation of [**IDispatch::Invoke**](/windows/win32/api/oaidl/nf-oaidl-idispatch-invoke).</span></span>

## <a name="notes-to-callers"></a><span data-ttu-id="214f5-166">Notes pour les appelants</span><span class="sxs-lookup"><span data-stu-id="214f5-166">Notes to Callers</span></span>

<span data-ttu-id="214f5-167">Il est recommandé de créer les jeux de propriétés au format Unicode, en ne définissant pas l' \_ indicateur ANSI PROPSETFLAG dans le paramètre *GrfFlags* de [**IPropertySetStorage :: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span><span class="sxs-lookup"><span data-stu-id="214f5-167">It is recommended that property sets be created as Unicode, by not setting the PROPSETFLAG\_ANSI flag in the *grfFlags* parameter of [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span></span> <span data-ttu-id="214f5-168">Il est également recommandé d’éviter d’utiliser \_ des valeurs VT LPSTR et d’utiliser à la \_ place des valeurs VT LPWStr.</span><span class="sxs-lookup"><span data-stu-id="214f5-168">It is also recommended that you avoid using VT\_LPSTR values, and use VT\_LPWSTR values instead.</span></span> <span data-ttu-id="214f5-169">Lorsque la page de codes du jeu de propriétés est Unicode, les \_ valeurs de chaîne de VT LPSTR sont converties au format Unicode lorsqu’elles sont stockées, et reviennent aux valeurs de chaîne multioctets lors de leur récupération.</span><span class="sxs-lookup"><span data-stu-id="214f5-169">When the property set code page is Unicode, VT\_LPSTR string values are converted to Unicode when stored, and back to multibyte string values when retrieved.</span></span> <span data-ttu-id="214f5-170">Lorsque la page de codes du jeu de propriétés n’est pas Unicode, les noms de propriétés, les \_ Chaînes VT BSTR et les valeurs de propriété non simples sont convertis en chaînes multioctets lorsqu’elles sont stockées, puis reconvertis en Unicode lors de leur récupération, le tout à l’aide de la page de codes ANSI du système actuelle.</span><span class="sxs-lookup"><span data-stu-id="214f5-170">When the code page of the property set is not Unicode, property names, VT\_BSTR strings, and non-simple property values are converted to multibyte strings when stored, and converted back to Unicode when retrieved, all using the current system ANSI code page.</span></span>

## <a name="notes-to-implementers"></a><span data-ttu-id="214f5-171">Notes pour les responsables de l’implémentation</span><span class="sxs-lookup"><span data-stu-id="214f5-171">Notes to Implementers</span></span>

<span data-ttu-id="214f5-172">Lors de l’allocation d’un identificateur de propriété, l’implémentation peut choisir n’importe quelle valeur qui n’est pas actuellement utilisée dans le jeu de propriétés pour un identificateur de propriété, à condition qu’il ne soit pas égal à 0 ou 1 ou supérieur à 0x80000000, qui sont toutes des valeurs réservées.</span><span class="sxs-lookup"><span data-stu-id="214f5-172">When allocating a property identifier, the implementation can choose any value not currently in use in the property set for a property identifier, as long as it is not 0 or 1 or greater than 0x80000000, all of which are reserved values.</span></span> <span data-ttu-id="214f5-173">Le paramètre *propidNameFirst* établit une valeur minimale pour les identificateurs de propriété dans le jeu et doit être supérieure à 1 et inférieure à 0x80000000.</span><span class="sxs-lookup"><span data-stu-id="214f5-173">The *propidNameFirst* parameter establishes a minimum value for property identifiers within the set, and must be greater than 1 and less than 0x80000000.</span></span> <span data-ttu-id="214f5-174">Consultez la section Notes ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="214f5-174">See Remarks section above.</span></span>

## <a name="related-topics"></a><span data-ttu-id="214f5-175">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="214f5-175">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="214f5-176">IPropertyStorage-implémentation de fichier composé</span><span class="sxs-lookup"><span data-stu-id="214f5-176">IPropertyStorage-Compound File Implementation</span></span>](ipropertystorage-compound-file-implementation.md)
</dt> <dt>

[<span data-ttu-id="214f5-177">IPropertyStorage-implémentation du système de fichiers NTFS</span><span class="sxs-lookup"><span data-stu-id="214f5-177">IPropertyStorage-NTFS File System Implementation</span></span>](ipropertystorage-ntfs-file-system-implementation.md)
</dt> <dt>

[<span data-ttu-id="214f5-178">IPropertyStorage-implémentation autonome</span><span class="sxs-lookup"><span data-stu-id="214f5-178">IPropertyStorage-Stand-alone Implementation</span></span>](ipropertystorage-stand-alone-implementation.md)
</dt> </dl>

 

 