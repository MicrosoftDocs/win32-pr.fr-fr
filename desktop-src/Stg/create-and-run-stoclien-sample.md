---
title: Créer et exécuter un exemple StoClien
description: StoClien travaille en collaboration avec un objet codocument dans un serveur COM pour obtenir un stockage persistant des dessins dans les fichiers composés COM.
ms.assetid: bf622104-10dd-4649-88f0-e2bfb15289b1
keywords:
- Créer et exécuter un exemple StoClien
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6f00274293c05e21e660dc8e9448ca95946cab8a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "106509586"
---
# <a name="create-and-run-stoclien-sample"></a><span data-ttu-id="797f6-104">Créer et exécuter un exemple StoClien</span><span class="sxs-lookup"><span data-stu-id="797f6-104">Create and Run StoClien Sample</span></span>

<span data-ttu-id="797f6-105">**StoClien** travaille en collaboration avec un objet codocument dans un serveur com pour obtenir un stockage persistant des dessins dans les fichiers composés com.</span><span class="sxs-lookup"><span data-stu-id="797f6-105">**StoClien** works in cooperation with a COPaper object in a COM server to achieve persistent storage of drawings in COM compound files.</span></span> <span data-ttu-id="797f6-106">Pour plus d’informations sur l’utilisation par le biais de flux de données dans le fichier composé fourni au **StoClien**, consultez l’exemple [**StoServe**](structured-storage-server-sample--stoserve-.md) et STOSERVE.HTM.</span><span class="sxs-lookup"><span data-stu-id="797f6-106">For more information about COPaper's use of streams in the compound file provided to COPaper by **StoClien**, see [**StoServe**](structured-storage-server-sample--stoserve-.md) sample and STOSERVE.HTM.</span></span> <span data-ttu-id="797f6-107">La construction du copapier et son interface IPaper sont également abordées dans l’exemple **StoServe** .</span><span class="sxs-lookup"><span data-stu-id="797f6-107">COPaper's construction and its IPaper interface are also covered in the **StoServe** sample.</span></span>

## <a name="code-tour"></a><span data-ttu-id="797f6-108">Visite guidée du code</span><span class="sxs-lookup"><span data-stu-id="797f6-108">Code Tour</span></span>

<span data-ttu-id="797f6-109">Les principales rubriques traitées dans cette présentation du code sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="797f6-109">The major topics covered in this code tour are:</span></span>

-   <span data-ttu-id="797f6-110">Comment **CGuiPaper** encapsule le comportement de l’interface graphique du papier de dessin électronique de **StoClien**</span><span class="sxs-lookup"><span data-stu-id="797f6-110">How **CGuiPaper** encapsulates the GUI behavior of **StoClien**'s electronic drawing paper</span></span>
-   <span data-ttu-id="797f6-111">Comment **StoClien** capture et affiche l’activité de dessin interactif</span><span class="sxs-lookup"><span data-stu-id="797f6-111">How **StoClien** captures and displays interactive drawing activity</span></span>
-   <span data-ttu-id="797f6-112">Comment l’objet **CGuiPaper** utilise le codocument pour enregistrer les données de dessin</span><span class="sxs-lookup"><span data-stu-id="797f6-112">How the **CGuiPaper** object uses COPaper to record drawing data</span></span>
-   <span data-ttu-id="797f6-113">Utilisation d’une connexion IPaperSink pour le redessin</span><span class="sxs-lookup"><span data-stu-id="797f6-113">How an IPaperSink connection is used in repainting</span></span>
-   <span data-ttu-id="797f6-114">Comment les méthodes **Load** et **Save** de CPapFile utilisent le stockage structuré dans des fichiers composés</span><span class="sxs-lookup"><span data-stu-id="797f6-114">How the CPapFile **Load** and **Save** methods use the structured storage in compound files</span></span>

<span data-ttu-id="797f6-115">Comme la classe **CGuiBall** utilisée dans les exemples FRECLIEN et CONCLIEN a encapsulé le comportement d’une balle rebondissante, **StoClien** utilise une classe **CGuiPaper** C++ pour encapsuler les données et le comportement de l’interface graphique utilisateur du papier de dessin électronique.</span><span class="sxs-lookup"><span data-stu-id="797f6-115">As the **CGuiBall** class used in the FRECLIEN and CONCLIEN samples encapsulated the behavior of a bouncing ball, **StoClien** uses a **CGuiPaper** C++ class to encapsulate the data and GUI behavior of electronic drawing paper.</span></span>

<span data-ttu-id="797f6-116">Le tableau suivant répertorie les fichiers pertinents pour l’exemple **StoClien** .</span><span class="sxs-lookup"><span data-stu-id="797f6-116">The following table lists the files pertinent to the **StoClien** sample.</span></span>



| <span data-ttu-id="797f6-117">Fichiers</span><span class="sxs-lookup"><span data-stu-id="797f6-117">Files</span></span>        | <span data-ttu-id="797f6-118">Description</span><span class="sxs-lookup"><span data-stu-id="797f6-118">Description</span></span>                                                                                                                      |
|--------------|----------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="797f6-119">STOCLIEN.TXT</span><span class="sxs-lookup"><span data-stu-id="797f6-119">STOCLIEN.TXT</span></span> | <span data-ttu-id="797f6-120">Brève description de l’exemple.</span><span class="sxs-lookup"><span data-stu-id="797f6-120">Short sample description.</span></span>                                                                                                        |
| <span data-ttu-id="797f6-121">ADOPTE</span><span class="sxs-lookup"><span data-stu-id="797f6-121">MAKEFILE</span></span>     | <span data-ttu-id="797f6-122">Makefile générique pour la génération de l’exemple de code.</span><span class="sxs-lookup"><span data-stu-id="797f6-122">The generic makefile for building the code sample.</span></span>                                                                               |
| <span data-ttu-id="797f6-123">STOCLIEN. Manutention</span><span class="sxs-lookup"><span data-stu-id="797f6-123">STOCLIEN.H</span></span>   | <span data-ttu-id="797f6-124">Fichier include pour l’application **StoClien** .</span><span class="sxs-lookup"><span data-stu-id="797f6-124">The include file for the **StoClien** application.</span></span> <span data-ttu-id="797f6-125">Contient des déclarations de classe, des prototypes de fonction et des identificateurs de ressource.</span><span class="sxs-lookup"><span data-stu-id="797f6-125">Contains class declarations, function prototypes, and resource identifiers.</span></span>   |
| <span data-ttu-id="797f6-126">STOCLIEN. COTISATIONS</span><span class="sxs-lookup"><span data-stu-id="797f6-126">STOCLIEN.CPP</span></span> | <span data-ttu-id="797f6-127">Fichier d’implémentation principal pour STOCLIEN.EXE.</span><span class="sxs-lookup"><span data-stu-id="797f6-127">The main implementation file for STOCLIEN.EXE.</span></span> <span data-ttu-id="797f6-128">A une implémentation de WinMain et CMainWindow, ainsi que la distribution du menu principal.</span><span class="sxs-lookup"><span data-stu-id="797f6-128">Has WinMain and CMainWindow implementation, as well as the main menu dispatching.</span></span> |
| <span data-ttu-id="797f6-129">STOCLIEN. Release</span><span class="sxs-lookup"><span data-stu-id="797f6-129">STOCLIEN.RC</span></span>  | <span data-ttu-id="797f6-130">Fichier de définition de ressource d’application.</span><span class="sxs-lookup"><span data-stu-id="797f6-130">The application resource definition file.</span></span>                                                                                        |
| <span data-ttu-id="797f6-131">STOCLIEN. ICO</span><span class="sxs-lookup"><span data-stu-id="797f6-131">STOCLIEN.ICO</span></span> | <span data-ttu-id="797f6-132">Ressource icône d’application.</span><span class="sxs-lookup"><span data-stu-id="797f6-132">The application icon resource.</span></span>                                                                                                   |
| <span data-ttu-id="797f6-133">STOCLIEN. Protocole</span><span class="sxs-lookup"><span data-stu-id="797f6-133">STOCLIEN.PAP</span></span> | <span data-ttu-id="797f6-134">Fichier de dessin papier par défaut pour l’application.</span><span class="sxs-lookup"><span data-stu-id="797f6-134">A default paper drawing file for the application.</span></span>                                                                                |
| <span data-ttu-id="797f6-135">Crayon. Tabs</span><span class="sxs-lookup"><span data-stu-id="797f6-135">PENCIL.CUR</span></span>   | <span data-ttu-id="797f6-136">Image de crayon pour le curseur de la fenêtre cliente.</span><span class="sxs-lookup"><span data-stu-id="797f6-136">A pencil image for the client window cursor.</span></span>                                                                                     |
| <span data-ttu-id="797f6-137">Puits. Manutention</span><span class="sxs-lookup"><span data-stu-id="797f6-137">SINK.H</span></span>       | <span data-ttu-id="797f6-138">Déclaration de classe pour la classe d’objets COM COPaperSink.</span><span class="sxs-lookup"><span data-stu-id="797f6-138">The class declaration for the COPaperSink COM object class.</span></span>                                                                      |
| <span data-ttu-id="797f6-139">Puits. COTISATIONS</span><span class="sxs-lookup"><span data-stu-id="797f6-139">SINK.CPP</span></span>     | <span data-ttu-id="797f6-140">Fichier d’implémentation pour la classe d’objets COM COPaperSink.</span><span class="sxs-lookup"><span data-stu-id="797f6-140">Implementation file for the COPaperSink COM object class.</span></span>                                                                        |
| <span data-ttu-id="797f6-141">PAPFILE. Manutention</span><span class="sxs-lookup"><span data-stu-id="797f6-141">PAPFILE.H</span></span>    | <span data-ttu-id="797f6-142">Déclaration de classe pour la classe C++ **CPapFile** .</span><span class="sxs-lookup"><span data-stu-id="797f6-142">The class declaration for the **CPapFile** C++ class.</span></span>                                                                            |
| <span data-ttu-id="797f6-143">PAPFILE. COTISATIONS</span><span class="sxs-lookup"><span data-stu-id="797f6-143">PAPFILE.CPP</span></span>  | <span data-ttu-id="797f6-144">Fichier d’implémentation pour la classe C++ **CPapFile** .</span><span class="sxs-lookup"><span data-stu-id="797f6-144">Implementation file for the **CPapFile** C++ class.</span></span>                                                                              |
| <span data-ttu-id="797f6-145">GUIPAPER. Manutention</span><span class="sxs-lookup"><span data-stu-id="797f6-145">GUIPAPER.H</span></span>   | <span data-ttu-id="797f6-146">Déclaration de classe pour la classe C++ **CGuiPaper** .</span><span class="sxs-lookup"><span data-stu-id="797f6-146">The class declaration for the **CGuiPaper** C++ class.</span></span>                                                                           |
| <span data-ttu-id="797f6-147">GUIPAPER. COTISATIONS</span><span class="sxs-lookup"><span data-stu-id="797f6-147">GUIPAPER.CPP</span></span> | <span data-ttu-id="797f6-148">Fichier d’implémentation pour la classe C++ **CGuiPaper** .</span><span class="sxs-lookup"><span data-stu-id="797f6-148">Implementation file for the **CGuiPaper** C++ class.</span></span>                                                                             |
| <span data-ttu-id="797f6-149">STOCLIEN. DSP</span><span class="sxs-lookup"><span data-stu-id="797f6-149">STOCLIEN.DSP</span></span> | <span data-ttu-id="797f6-150">Microsoft Visual Studio fichier projet.</span><span class="sxs-lookup"><span data-stu-id="797f6-150">Microsoft Visual Studio Project file.</span></span>                                                                                            |



 

## <a name="compound-files"></a><span data-ttu-id="797f6-151">Fichiers composés</span><span class="sxs-lookup"><span data-stu-id="797f6-151">Compound Files</span></span>

<span data-ttu-id="797f6-152">**StoClien** s’appuie sur le codocument pour enregistrer les données de dessin.</span><span class="sxs-lookup"><span data-stu-id="797f6-152">**StoClien** relies on COPaper to record drawing data.</span></span> <span data-ttu-id="797f6-153">Il s’appuie également sur le copapier pour stocker les données dans un fichier composé.</span><span class="sxs-lookup"><span data-stu-id="797f6-153">It also relies on COPaper to store the data in a compound file.</span></span> <span data-ttu-id="797f6-154">Toutefois, dans une division classique du travail entre le client et le serveur COM, **StoClien** partage une partie de la responsabilité pour le stockage de fichiers.</span><span class="sxs-lookup"><span data-stu-id="797f6-154">However, in a typical division of labor between COM client and server, **StoClien** shares part of the responsibility for file storage.</span></span> <span data-ttu-id="797f6-155">Cette division de main-d’œuvre est importante dans les applications COM où le client est un conteneur et le serveur est un objet incorporé.</span><span class="sxs-lookup"><span data-stu-id="797f6-155">This division of labor is important in COM applications where the client is a container and the server is an embedded object.</span></span> <span data-ttu-id="797f6-156">Dans cette organisation, le client est responsable de la création ou de l’ouverture d’un fichier de stockage structuré, tandis que l’objet serveur est chargé d’utiliser ce stockage pour ses propres fonctions de stockage de données.</span><span class="sxs-lookup"><span data-stu-id="797f6-156">In this arrangement, the client is responsible for creating or opening a structured storage file, while the server object is responsible for using that storage for its own data storage purposes.</span></span> <span data-ttu-id="797f6-157">Cela peut impliquer l’objet serveur qui crée des sous-stockages dans le stockage qui lui est donné.</span><span class="sxs-lookup"><span data-stu-id="797f6-157">This may involve the server object creating substorages in the storage that is given to it.</span></span> <span data-ttu-id="797f6-158">Il implique généralement l’objet serveur qui crée des objets de flux dans le stockage.</span><span class="sxs-lookup"><span data-stu-id="797f6-158">It usually involves the server object creating stream objects in the storage.</span></span> <span data-ttu-id="797f6-159">L’utilisation par le biais de flux de stockage est détaillée dans l’exemple **StoClien** .</span><span class="sxs-lookup"><span data-stu-id="797f6-159">COPaper's use of storage streams is detailed in the **StoClien** sample.</span></span>

<span data-ttu-id="797f6-160">L’interface [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) est utilisée par l’objet client et le serveur pour effectuer des opérations sur les fichiers.</span><span class="sxs-lookup"><span data-stu-id="797f6-160">The [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) interface is used by both client and server object to perform file operations.</span></span> <span data-ttu-id="797f6-161">L’implémentation des fichiers composés de l’architecture de stockage structuré est utilisée.</span><span class="sxs-lookup"><span data-stu-id="797f6-161">The compound files implementation of the Structured Storage architecture is used.</span></span> <span data-ttu-id="797f6-162">Les fonctions de service standard sont utilisées pour les opérations sur les fichiers composés.</span><span class="sxs-lookup"><span data-stu-id="797f6-162">Standard service functions are used for operations on compound files.</span></span> <span data-ttu-id="797f6-163">Par exemple, la fonction [**StgCreateDocFile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) crée initialement un fichier composé et transmet un pointeur **IStorage** qui peut être utilisé pour manipuler le fichier.</span><span class="sxs-lookup"><span data-stu-id="797f6-163">For example, the [**StgCreateDocfile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) function initially creates a compound file and passes back an **IStorage** pointer that can be used to manipulate the file.</span></span> <span data-ttu-id="797f6-164">Cette fonction particulière est appelée dans **StoClien**.</span><span class="sxs-lookup"><span data-stu-id="797f6-164">This particular function is called in **StoClien**.</span></span> <span data-ttu-id="797f6-165">L’interface **IStorage** qu’elle obtient est transmise en tant que paramètre au codocument pour son utilisation.</span><span class="sxs-lookup"><span data-stu-id="797f6-165">The **IStorage** interface it obtains is passed as a parameter to COPaper for its use.</span></span> <span data-ttu-id="797f6-166">L’objet codocument ne crée pas ou n’ouvre pas les fichiers composés de manière autonome : il utilise les interfaces **IStorage** et [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) pour travailler dans des fichiers composés qui lui sont attribués.</span><span class="sxs-lookup"><span data-stu-id="797f6-166">The COPaper object does not create or open compound files on its own: It uses the **IStorage** and [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) interfaces to work in compound files that are given to it.</span></span>

<span data-ttu-id="797f6-167">Ces interfaces [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) et [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) ne sont pas implémentées dans **StoClien** ou **StoServe**.</span><span class="sxs-lookup"><span data-stu-id="797f6-167">These [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) and [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) interfaces are not implemented within **StoClien** or **StoServe**.</span></span> <span data-ttu-id="797f6-168">Elles sont implémentées dans les bibliothèques COM.</span><span class="sxs-lookup"><span data-stu-id="797f6-168">They are implemented within the COM libraries.</span></span> <span data-ttu-id="797f6-169">Lorsqu’un pointeur vers l’une de ces interfaces est obtenu, leurs méthodes sont essentiellement utilisées comme un ensemble de services pour opérer sur un fichier composé.</span><span class="sxs-lookup"><span data-stu-id="797f6-169">When a pointer to one of these interfaces is obtained, their methods are essentially used as a set of services to operate on a compound file.</span></span>

 

 




