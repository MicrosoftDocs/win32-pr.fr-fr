---
title: Implémentation de fichiers IPropertySetStorage-Compound
description: L’implémentation d’objet de stockage de fichiers composés COM comprend une implémentation de IPropertyStorage, l’interface qui gère un jeu de propriétés persistantes unique et IPropertySetStorage, l’interface qui gère les groupes de jeux de propriétés persistantes.
ms.assetid: de2cb778-c6eb-4487-996b-87405674f603
keywords:
- IPropertySetStorage Strctd STG, implémentations, fichier composé
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9053a7cf6bf1ae7e4230b15eb0117c428acb08da
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103729084"
---
# <a name="ipropertysetstorage-compound-file-implementation"></a><span data-ttu-id="996d9-104">Implémentation de fichiers IPropertySetStorage-Compound</span><span class="sxs-lookup"><span data-stu-id="996d9-104">IPropertySetStorage-Compound File Implementation</span></span>

<span data-ttu-id="996d9-105">L' [implémentation d’objet de stockage de fichiers composés com](ipropertystorage-compound-file-implementation.md) comprend une implémentation de [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage), l’interface qui gère un jeu de propriétés persistantes unique et [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), l’interface qui gère les groupes de jeux de propriétés persistantes.</span><span class="sxs-lookup"><span data-stu-id="996d9-105">The [COM compound file storage object implementation](ipropertystorage-compound-file-implementation.md) includes an implementation of both [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage), the interface that manages a single persistent property set, and [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), the interface that manages groups of persistent property sets.</span></span>

<span data-ttu-id="996d9-106">Pour obtenir un pointeur vers l’implémentation de fichier composé de [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), spécifiez le nom défini par l’en-tête de l’ID d’IID \_ IStorage comme paramètre *riid* , ou utilisez les fonctions [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) ou [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) .</span><span class="sxs-lookup"><span data-stu-id="996d9-106">To get a pointer to the compound file implementation of [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), specify the header-defined name for the identifier IID\_IStorage as the *riid* parameter, or use the [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) or [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) functions.</span></span> <span data-ttu-id="996d9-107">Dans les deux cas, spécifiez \_ le stockage STGFMT comme paramètre *STGFMT* .</span><span class="sxs-lookup"><span data-stu-id="996d9-107">In both cases, specify STGFMT\_STORAGE as the *stgfmt* parameter.</span></span> <span data-ttu-id="996d9-108">(STGFMT \_ TOUT peut également être spécifié dans le cas de **StgOpenStorageEx**.) Spécifiez également le nom défini d’en-tête pour l’IID (ID d’interface) \_ IPropertySetStorage IID comme paramètre *riid* .</span><span class="sxs-lookup"><span data-stu-id="996d9-108">(STGFMT\_ANY can alternatively be specified in the case of **StgOpenStorageEx**.) Also, specify the header-defined name for the interface identifier (IID) IID\_IPropertySetStorage as the *riid* parameter.</span></span> <span data-ttu-id="996d9-109">Les deux fonctions fournissent un pointeur vers l’interface de l’objet **IPropertySetStorage** .</span><span class="sxs-lookup"><span data-stu-id="996d9-109">Both functions supply a pointer to the object **IPropertySetStorage** interface.</span></span>

<span data-ttu-id="996d9-110">Une autre façon d’obtenir un pointeur vers l’implémentation de fichier composé consiste à spécifier le nom défini d’en-tête pour l’IID d’identificateur \_ IStorage comme paramètre *riid* , ou à utiliser les fonctions [**StgCreateDocFile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) ou [**StgOpenStorage**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage) .</span><span class="sxs-lookup"><span data-stu-id="996d9-110">Another way to get a pointer to the compound file implementation is to specify the header-defined name for the identifier IID\_IStorage as the *riid* parameter, or to use the [**StgCreateDocfile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) or [**StgOpenStorage**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage) functions.</span></span> <span data-ttu-id="996d9-111">Un pointeur vers l’interface de l’objet [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) est alors fourni.</span><span class="sxs-lookup"><span data-stu-id="996d9-111">This will supply a pointer to the object [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="996d9-112">Lorsque vous souhaitez gérer les jeux de propriétés persistants, appelez [**IStorage :: QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) pour l’interface [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) .</span><span class="sxs-lookup"><span data-stu-id="996d9-112">When you want to deal with persistent property sets, call [**IStorage::QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) for the [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) interface.</span></span>

## <a name="when-to-use-ipropertysetstorage"></a><span data-ttu-id="996d9-113">Quand utiliser IPropertySetStorage</span><span class="sxs-lookup"><span data-stu-id="996d9-113">When to Use IPropertySetStorage</span></span>

<span data-ttu-id="996d9-114">Appelez les méthodes de [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) pour créer, ouvrir ou supprimer des jeux de propriétés dans le stockage de jeux de propriétés de fichier composé actuel.</span><span class="sxs-lookup"><span data-stu-id="996d9-114">Call the methods of [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) to create, open, or delete property sets in the current compound-file property set storage.</span></span> <span data-ttu-id="996d9-115">Il existe également une méthode, [**IPropertySetStorage :: enum**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-enum), qui fournit un pointeur vers un énumérateur qui peut être utilisé pour énumérer les jeux de propriétés dans le stockage.</span><span class="sxs-lookup"><span data-stu-id="996d9-115">There is also a method, [**IPropertySetStorage::Enum**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-enum), that supplies a pointer to an enumerator that can be used to enumerate the property sets in the storage.</span></span>

## <a name="methods"></a><span data-ttu-id="996d9-116">Méthodes</span><span class="sxs-lookup"><span data-stu-id="996d9-116">Methods</span></span>

[<span data-ttu-id="996d9-117">**IPropertySetStorage :: Create**</span><span class="sxs-lookup"><span data-stu-id="996d9-117">**IPropertySetStorage::Create**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create)

<span data-ttu-id="996d9-118">Crée un nouveau jeu de propriétés dans le stockage de fichiers composés actuel et fournit un pointeur d’interface vers l’implémentation de fichier composé [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) .</span><span class="sxs-lookup"><span data-stu-id="996d9-118">Creates a new property set in the current compound file storage and, on return, supplies an interface pointer to the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) compound-file implementation.</span></span> <span data-ttu-id="996d9-119">Dans cette implémentation, les jeux de propriétés peuvent être traités uniquement si PROPSETFLAG non \_ simple est spécifié.</span><span class="sxs-lookup"><span data-stu-id="996d9-119">In this implementation, property sets may be transacted only if PROPSETFLAG\_NONSIMPLE is specified.</span></span> <span data-ttu-id="996d9-120">Cette méthode exige que le mode de partage spécifié dans le paramètre *grfMode* soit STGM \_ share \_ exclusive, et que le mode d’accès soit STGM \_ Read ou STGM \_ ReadWrite (le mode d’écriture STGM \_ n’est pas pris en charge).</span><span class="sxs-lookup"><span data-stu-id="996d9-120">This method requires that the sharing mode specified in the *grfMode* parameter be STGM\_SHARE\_EXCLUSIVE, and that the access mode be either STGM\_READ or STGM\_READWRITE (STGM\_WRITE mode is not supported).</span></span>

[<span data-ttu-id="996d9-121">**IPropertySetStorage :: Open**</span><span class="sxs-lookup"><span data-stu-id="996d9-121">**IPropertySetStorage::Open**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open)

<span data-ttu-id="996d9-122">Ouvre un jeu de propriétés existant dans le stockage de propriétés actuel.</span><span class="sxs-lookup"><span data-stu-id="996d9-122">Opens an existing property set in the current property storage.</span></span> <span data-ttu-id="996d9-123">Au retour, elle fournit un pointeur d’interface vers l’implémentation de fichier composé de [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage).</span><span class="sxs-lookup"><span data-stu-id="996d9-123">On return, it supplies an interface pointer to the compound file implementation of [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage).</span></span> <span data-ttu-id="996d9-124">Cette méthode exige que le mode de partage spécifié dans le paramètre *grfMode* soit STGM \_ share \_ exclusive et que le mode d’accès soit STGM \_ Read ou STGM \_ ReadWrite (STGM \_ Write n’est pas pris en charge).</span><span class="sxs-lookup"><span data-stu-id="996d9-124">This method requires that the sharing mode specified in the *grfMode* parameter be STGM\_SHARE\_EXCLUSIVE, and that the access mode be either STGM\_READ or STGM\_READWRITE (STGM\_WRITE is not supported).</span></span>

[<span data-ttu-id="996d9-125">**IPropertySetStorage ::D supprim**</span><span class="sxs-lookup"><span data-stu-id="996d9-125">**IPropertySetStorage::Delete**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-delete)

<span data-ttu-id="996d9-126">Supprime un jeu de propriétés dans ce stockage de propriétés.</span><span class="sxs-lookup"><span data-stu-id="996d9-126">Deletes a property set in this property storage.</span></span>

[<span data-ttu-id="996d9-127">**IPropertySetStorage :: enum**</span><span class="sxs-lookup"><span data-stu-id="996d9-127">**IPropertySetStorage::Enum**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-enum)

<span data-ttu-id="996d9-128">Crée un objet utilisé pour énumérer les structures [**STATPROPSETSTG**](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropsetstg) .</span><span class="sxs-lookup"><span data-stu-id="996d9-128">Creates an object used to enumerate [**STATPROPSETSTG**](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropsetstg) structures.</span></span> <span data-ttu-id="996d9-129">Chaque structure **STATPROPSETSTG** fournit des données relatives à un jeu de propriétés unique.</span><span class="sxs-lookup"><span data-stu-id="996d9-129">Each **STATPROPSETSTG** structure provides data about a single property set.</span></span>

## <a name="remarks"></a><span data-ttu-id="996d9-130">Notes</span><span class="sxs-lookup"><span data-stu-id="996d9-130">Remarks</span></span>

<span data-ttu-id="996d9-131">À compter de Windows 2000, l’implémentation de fichier composé de [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) prend en charge le mode simple.</span><span class="sxs-lookup"><span data-stu-id="996d9-131">Starting with Windows 2000, the compound-file implementation of [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) supports simple mode.</span></span> <span data-ttu-id="996d9-132">Le mode simple est indiqué en spécifiant l' \_ indicateur simple STGM pour les fonctions [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) et [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) .</span><span class="sxs-lookup"><span data-stu-id="996d9-132">Simple mode is indicated by specifying the STGM\_SIMPLE flag for the [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) and [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) functions.</span></span> <span data-ttu-id="996d9-133">Si le fichier composé est ouvert en mode simple, l’implémentation de **IPropertySetStorage** associée est limitée comme suit :</span><span class="sxs-lookup"><span data-stu-id="996d9-133">If the compound file is opened in simple mode, the associated **IPropertySetStorage** implementation is limited as follows:</span></span>

-   <span data-ttu-id="996d9-134">Seuls les jeux de propriétés simples peuvent être créés.</span><span class="sxs-lookup"><span data-stu-id="996d9-134">Only simple property sets can be created.</span></span> <span data-ttu-id="996d9-135">Autrement dit, la spécification de la \_ valeur non simple PROPSETFLAG dans le paramètre *grfFlags* de la méthode [**IPropertySetStorage :: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) génère une erreur.</span><span class="sxs-lookup"><span data-stu-id="996d9-135">That is, specifying the PROPSETFLAG\_NONSIMPLE value in the *grfFlags* parameter for the [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) method results in an error.</span></span>
-   <span data-ttu-id="996d9-136">Une fois que vous avez créé un fichier composé avec [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) à l’aide \_ de STGM simple et que vous interrogez l’interface [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) , vous ne pouvez appeler [**IPropertySetStorage :: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) qu’une seule fois.</span><span class="sxs-lookup"><span data-stu-id="996d9-136">After you create a compound file with [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) using STGM\_SIMPLE and query for the [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) interface, you can only call [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) once.</span></span> <span data-ttu-id="996d9-137">Vous devez ensuite libérer l’interface [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) avant d’appeler à nouveau la méthode **Create** .</span><span class="sxs-lookup"><span data-stu-id="996d9-137">Then you must release the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) interface before calling the **Create** method again.</span></span> <span data-ttu-id="996d9-138">Pour plus d’informations sur le mode simple, consultez [**constantes STGM**](stgm-constants.md).</span><span class="sxs-lookup"><span data-stu-id="996d9-138">For more information about simple mode, see [**STGM Constants**](stgm-constants.md).</span></span>
-   <span data-ttu-id="996d9-139">Vous ne pouvez pas utiliser la méthode [**IPropertySetStorage :: Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) pour ouvrir une propriété définie après l’utilisation de [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) pour créer l’objet de stockage.</span><span class="sxs-lookup"><span data-stu-id="996d9-139">You cannot use the [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) method to open a property set after using [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) to create the storage object.</span></span> <span data-ttu-id="996d9-140">Au lieu de cela, vous devez utiliser [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) avant d’interroger [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) et d’appeler la méthode **Open** .</span><span class="sxs-lookup"><span data-stu-id="996d9-140">Instead you must use [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) before querying for [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) and calling the **Open** method.</span></span>
-   <span data-ttu-id="996d9-141">Après avoir ouvert un fichier composé avec [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) à l’aide de l' \_ indicateur simple STGM et de la requête de l’interface [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) , vous pouvez ouvrir une propriété définie à la fois à l’aide de [**IPropertySetStorage :: Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open).</span><span class="sxs-lookup"><span data-stu-id="996d9-141">After you open a compound file with [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) using the STGM\_SIMPLE flag and query for the [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) interface, you can open one property set at a time using [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open).</span></span> <span data-ttu-id="996d9-142">En outre, il n’est pas possible que la taille totale de la propriété définie soit augmentée alors que le jeu de propriétés est ouvert.</span><span class="sxs-lookup"><span data-stu-id="996d9-142">Also, it may not be possible for the total size of the property set to be increased while the property set is open.</span></span>

<span data-ttu-id="996d9-143">Les jeux de propriétés simples ne peuvent pas être traités.</span><span class="sxs-lookup"><span data-stu-id="996d9-143">Simple property sets cannot be transacted.</span></span> <span data-ttu-id="996d9-144">Vous ne pouvez pas spécifier STGM \_ avec transaction dans le paramètre *grfMode* des méthodes [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) et [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) , sauf si vous spécifiez également PROPSETFLAG \_ unsimple dans le paramètre *grfFlags* .</span><span class="sxs-lookup"><span data-stu-id="996d9-144">You cannot specify STGM\_TRANSACTED in the *grfmode* parameter of the [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) and [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) methods unless you also specify PROPSETFLAG\_NONSIMPLE in the *grfFlags* parameter.</span></span> <span data-ttu-id="996d9-145">N’oubliez pas que les jeux de propriétés simples et non simples ne sont pas liés aux jeux de propriétés en mode simple décrits ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="996d9-145">Be aware that simple and non-simple property sets are unrelated to the simple-mode property sets described above.</span></span> <span data-ttu-id="996d9-146">Pour plus d’informations sur les jeux de propriétés simples et simples, consultez [stockage et objets de flux pour un jeu de propriétés](storage-vs--stream-for-a-property-set.md).</span><span class="sxs-lookup"><span data-stu-id="996d9-146">For more information about simple and nonsimple property sets, see [Storage and Stream Objects for a Property Set](storage-vs--stream-for-a-property-set.md).</span></span>

> [!Note]  
> <span data-ttu-id="996d9-147">Les jeux de propriétés DocumentSummaryInformation et UserDefined sont uniques en ce qu’ils peuvent avoir deux sections de jeu de propriétés.</span><span class="sxs-lookup"><span data-stu-id="996d9-147">The DocumentSummaryInformation and UserDefined property sets are unique in that they may have two property set sections.</span></span> <span data-ttu-id="996d9-148">Pour plus d’informations, consultez [les jeux de propriétés DocumentSummaryInformation et UserDefined](the-documentsummaryinformation-and-userdefined-property-sets.md).</span><span class="sxs-lookup"><span data-stu-id="996d9-148">For more information, see [The DocumentSummaryInformation and UserDefined Property Sets](the-documentsummaryinformation-and-userdefined-property-sets.md).</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="996d9-149">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="996d9-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="996d9-150">IPropertyStorage-implémentation de fichier composé</span><span class="sxs-lookup"><span data-stu-id="996d9-150">IPropertyStorage - Compound File Implementation</span></span>](ipropertystorage-compound-file-implementation.md)
</dt> <dt>

[<span data-ttu-id="996d9-151">**IPropertySetStorage**</span><span class="sxs-lookup"><span data-stu-id="996d9-151">**IPropertySetStorage**</span></span>](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage)
</dt> <dt>

[<span data-ttu-id="996d9-152">**IPropertyStorage**</span><span class="sxs-lookup"><span data-stu-id="996d9-152">**IPropertyStorage**</span></span>](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage)
</dt> <dt>

[<span data-ttu-id="996d9-153">**IStorage :: EnumElements**</span><span class="sxs-lookup"><span data-stu-id="996d9-153">**IStorage::EnumElements**</span></span>](/windows/desktop/api/Objidl/nf-objidl-istorage-enumelements)
</dt> <dt>

[<span data-ttu-id="996d9-154">**Constantes PROPSETFLAG**</span><span class="sxs-lookup"><span data-stu-id="996d9-154">**PROPSETFLAG Constants**</span></span>](propsetflag-constants.md)
</dt> <dt>

[<span data-ttu-id="996d9-155">**STATPROPSETSTG**</span><span class="sxs-lookup"><span data-stu-id="996d9-155">**STATPROPSETSTG**</span></span>](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropsetstg)
</dt> </dl>

 

 