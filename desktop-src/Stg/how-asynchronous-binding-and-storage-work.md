---
title: Fonctionnement de la liaison asynchrone et du stockage
description: Le stockage asynchrone améliore la spécification de stockage structuré COM afin de prendre en charge le téléchargement d’objets de stockage sur des réseaux à latence élevée et de liaison lente tels qu’Internet.
ms.assetid: 891152c3-5abd-45e4-a7bb-0aac23262b03
keywords:
- Fonctionnement de la liaison asynchrone et du stockage
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 626e8c7a55b667e158de42b3c88a17315b5e41ad
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104382126"
---
# <a name="how-asynchronous-binding-and-storage-work"></a><span data-ttu-id="ab0aa-104">Fonctionnement de la liaison asynchrone et du stockage</span><span class="sxs-lookup"><span data-stu-id="ab0aa-104">How Asynchronous Binding and Storage Work</span></span>

<span data-ttu-id="ab0aa-105">Le stockage asynchrone améliore la spécification de stockage structuré COM afin de prendre en charge le téléchargement d’objets de stockage sur des réseaux à latence élevée et de liaison lente tels qu’Internet.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-105">Asynchronous storage enhances the COM structured storage specification to support downloading of storage objects on high-latency, slow-link networks such as the Internet.</span></span> <span data-ttu-id="ab0aa-106">Le stockage asynchrone fonctionne avec les monikers asynchrones pour fournir un comportement de liaison asynchrone complet.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-106">Asynchronous storage works together with asynchronous monikers to provide complete asynchronous binding behavior.</span></span>

## <a name="document-object-embedded-in-a-web-page"></a><span data-ttu-id="ab0aa-107">Objet document incorporé dans une page Web</span><span class="sxs-lookup"><span data-stu-id="ab0aa-107">Document object embedded in a Web page</span></span>

<span data-ttu-id="ab0aa-108">Lorsqu’un utilisateur clique sur un lien représentant un document incorporé dans une page Web, les événements suivants se produisent :</span><span class="sxs-lookup"><span data-stu-id="ab0aa-108">When a user clicks a link representing a document embedded in a Web page, the following events occur:</span></span>

1.  <span data-ttu-id="ab0aa-109">Le navigateur appelle la fonction [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) , en passant l’URL du lien.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-109">The browser calls the [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) function, passing the link URL.</span></span>
2.  <span data-ttu-id="ab0aa-110">[**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) analyse l’URL, crée un moniker asynchrone correspondant et retourne un pointeur vers l’interface [**IMoniker**](/windows/win32/api/objidl/nn-objidl-imoniker) du moniker.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-110">[**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) parses the URL, creates a corresponding asynchronous moniker, and returns a pointer to the moniker's [**IMoniker**](/windows/win32/api/objidl/nn-objidl-imoniker) interface.</span></span>
3.  <span data-ttu-id="ab0aa-111">Le navigateur appelle [**IsAsyncMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775110(v=vs.85)) pour déterminer si le moniker est asynchrone, crée un contexte de liaison, inscrit l’interface [**IBindStatusCallback**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775060(v=vs.85)) avec le contexte de liaison, uniquement si le moniker est asynchrone et appelle [**IMoniker :: BindToObject**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject), en passant le contexte de liaison.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-111">The browser calls [**IsAsyncMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775110(v=vs.85)) to determine if the moniker is asynchronous, creates a bind context, registers the [**IBindStatusCallback**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775060(v=vs.85)) interface with the bind context, only if the moniker is asynchronous, and calls [**IMoniker::BindToObject**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject), passing the bind context.</span></span>
4.  <span data-ttu-id="ab0aa-112">Le moniker est lié à l’objet et le interroge pour l’interface [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)) , qui indique si l’objet prend en charge la liaison asynchrone et le stockage.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-112">The moniker binds to the object and queries it for the [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)) interface, which indicates whether the object supports asynchronous binding and storage.</span></span> <span data-ttu-id="ab0aa-113">Si l’objet retourne un pointeur vers **IPersistMoniker**:</span><span class="sxs-lookup"><span data-stu-id="ab0aa-113">If the object returns a pointer to **IPersistMoniker**:</span></span>

    1.  <span data-ttu-id="ab0aa-114">Le moniker d’URL appelle [**IPersistMoniker :: Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)), en passant son propre pointeur [**IMoniker**](/windows/win32/api/objidl/nn-objidl-imoniker) à l’objet.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-114">The URL moniker calls [**IPersistMoniker::Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)), passing its own [**IMoniker**](/windows/win32/api/objidl/nn-objidl-imoniker) pointer to the object.</span></span>
    2.  <span data-ttu-id="ab0aa-115">L’objet modifie le contexte de liaison, choisit s’il souhaite un stockage bloquant ou non bloquant, inscrit son propre [**IBindStatusCallback**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775060(v=vs.85)) et appelle [**IMoniker :: BindToStorage**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) sur le pointeur qu’il a reçu via [**IPersistMoniker :: Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="ab0aa-115">The object modifies the bind context, chooses whether it wants a blocking or nonblocking storage, registers its own [**IBindStatusCallback**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775060(v=vs.85)) and calls [**IMoniker::BindToStorage**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) on the pointer it received through [**IPersistMoniker::Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)).</span></span>
    3.  <span data-ttu-id="ab0aa-116">Le moniker crée un stockage asynchrone, conserve une référence à l’interface [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) de l’objet wrapper, inscrit l’interface [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify) sur le stockage racine et appelle [**IPersistStorage :: Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load), en passant le pointeur [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) du stockage asynchrone.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-116">The moniker creates an asynchronous storage, keeps a reference to the wrapper object's [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) interface, registers the [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify) interface on the root storage, and calls [**IPersistStorage::Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load), passing the asynchronous storage's [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer.</span></span> <span data-ttu-id="ab0aa-117">À mesure que les données arrivent (sur un thread d’arrière-plan), le moniker appelle **IFillLockBytes** pour remplir l' [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes) sur le fichier temporaire.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-117">As data arrives (on a background thread) the moniker calls **IFillLockBytes** to fill the [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes) on the temp file.</span></span>
    4.  <span data-ttu-id="ab0aa-118">L’objet lit les données à partir du stockage et retourne à partir de [**IPersistMoniker :: Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)) lorsqu’il a reçu suffisamment de données pour s’en tenir initialisé.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-118">The object reads data from the storage and returns from [**IPersistMoniker::Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)) when it has received sufficient data to consider itself initialized.</span></span> <span data-ttu-id="ab0aa-119">Si l’objet tente de lire des données qui n’ont pas encore été téléchargées, le téléchargeur reçoit une notification sur [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify).</span><span class="sxs-lookup"><span data-stu-id="ab0aa-119">If the object attempts to read data that has not yet been downloaded, the downloader receives a notification on [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify).</span></span> <span data-ttu-id="ab0aa-120">À l’intérieur de la méthode [**IProgressNotify :: OnProgress**](/windows/win32/api/objidl/nf-objidl-iprogressnotify-onprogress) , le thread de téléchargement bloque une boucle de messages modale ou fait en sorte que le stockage asynchrone retourne E \_ en attente, selon que l’objet a demandé ou non un stockage de blocage ou de non-blocage.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-120">Inside the [**IProgressNotify::OnProgress**](/windows/win32/api/objidl/nf-objidl-iprogressnotify-onprogress) method, the downloading thread either blocks in a modal message loop, or causes the asynchronous storage to return E\_PENDING, depending on whether the object has requested a blocking or nonblocking storage.</span></span>

5.  <span data-ttu-id="ab0aa-121">Si l’objet n’implémente pas [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)), le moniker interroge la pour [**IPersistStorage**](/windows/win32/api/objidl/nn-objidl-ipersiststorage), qui indique que l’état persistant de l’objet est stocké dans un objet de stockage.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-121">If the object does not implement [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)), the moniker queries for [**IPersistStorage**](/windows/win32/api/objidl/nn-objidl-ipersiststorage), which indicates that the object's persistent state is stored in a storage object.</span></span> <span data-ttu-id="ab0aa-122">Si l’objet retourne un pointeur vers **IPersistStorage**:</span><span class="sxs-lookup"><span data-stu-id="ab0aa-122">If the object returns a pointer to **IPersistStorage**:</span></span>

    1.  <span data-ttu-id="ab0aa-123">Le moniker appelle [**IMoniker :: BindToStorage**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) sur lui-même, en demandant un blocage [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) (car l’objet ne prend pas en charge asynchrone), crée un stockage asynchrone, conserve une référence à l’interface [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) de l’objet wrapper, inscrit l’interface [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify) sur le stockage racine et appelle [**IPersistStorage :: Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load), en passant le pointeur **IStorage** de stockage asynchrone.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-123">The Moniker calls [**IMoniker::BindToStorage**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) on itself, requesting a blocking [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) (because the object is not asynchronous-aware), creates an asynchronous storage, keeps a reference to the wrapper object's [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) interface, registers the [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify) interface on the root storage, and calls [**IPersistStorage::Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load), passing the asynchronous storage's **IStorage** pointer.</span></span> <span data-ttu-id="ab0aa-124">À mesure que les données arrivent (sur un thread d’arrière-plan), le moniker appelle [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) pour remplir l' [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes) sur le fichier temporaire.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-124">As data arrives (on a background thread) the moniker calls [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) to fill the [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes) on the temporary file.</span></span>
    2.  <span data-ttu-id="ab0aa-125">L’objet lit les données à partir du stockage et retourne de [**IPersistStorage :: Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) lorsqu’il a reçu suffisamment de données pour être initialisées.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-125">The object reads data from storage and returns from [**IPersistStorage::Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) when it has received sufficient data to consider itself initialized.</span></span> <span data-ttu-id="ab0aa-126">Si l’objet tente de lire des données qui n’ont pas encore été téléchargées, il reçoit une notification sur [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify).</span><span class="sxs-lookup"><span data-stu-id="ab0aa-126">If the object attempts to read data that has not yet been downloaded, it receives a notification on [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify).</span></span> <span data-ttu-id="ab0aa-127">À l’intérieur de la méthode [**IProgressNotify :: OnProgress**](/windows/win32/api/objidl/nf-objidl-iprogressnotify-onprogress) , le thread de téléchargement se bloque toujours dans une boucle de messages modale.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-127">Inside the [**IProgressNotify::OnProgress**](/windows/win32/api/objidl/nf-objidl-iprogressnotify-onprogress) method, the downloading thread always blocks in a modal message loop.</span></span>

6.  <span data-ttu-id="ab0aa-128">Que le téléchargement soit synchrone ou asynchrone, le moniker retourne de [**IMoniker :: BindToObject**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject), et le navigateur reçoit l’objet initialisé qu’il a demandé.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-128">Regardless of whether the download is synchronous or asynchronous, the moniker returns from [**IMoniker::BindToObject**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject), and the browser receives the initialized object it requested.</span></span>
7.  <span data-ttu-id="ab0aa-129">Le navigateur interroge [**IOleObject**](/windows/win32/api/oleidl/nn-oleidl-ioleobject) et héberge l’objet sous la forme d’un objet document.</span><span class="sxs-lookup"><span data-stu-id="ab0aa-129">The browser queries for [**IOleObject**](/windows/win32/api/oleidl/nn-oleidl-ioleobject) and hosts the object as a Document Object.</span></span> <span data-ttu-id="ab0aa-130">(À ce stade, l’objet ne peut pas être initialisé complètement, mais suffisant pour afficher un résultat utile, auquel cas le téléchargement se poursuit en arrière-plan.)</span><span class="sxs-lookup"><span data-stu-id="ab0aa-130">(At this point the object may not be initialized completely, but enough to display something useful, in which case downloading continues in the background.)</span></span>

 

 