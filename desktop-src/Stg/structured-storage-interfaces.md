---
title: Interfaces de stockage structuré
description: Les services de stockage structuré sont organisés en trois catégories d’interfaces.
ms.assetid: a4281f07-eae4-4bcb-8d16-b6c0bd3c5b21
keywords:
- Interfaces de stockage structuré
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0010a0d4dec4908111c8a5bb939f795f0a2b2eb3
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "106509861"
---
# <a name="structured-storage-interfaces"></a><span data-ttu-id="37b29-104">Interfaces de stockage structuré</span><span class="sxs-lookup"><span data-stu-id="37b29-104">Structured Storage Interfaces</span></span>

<span data-ttu-id="37b29-105">Les services de stockage structuré sont organisés en trois catégories d' [interfaces](interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="37b29-105">Structured Storage services are organized into three categories of [interfaces](interfaces.md).</span></span> <span data-ttu-id="37b29-106">Chaque ensemble représente un niveau d’indirection ou d’abstraction successif entre un fichier composé, les objets qu’il contient et le support physique dans lequel ces composants individuels sont stockés.</span><span class="sxs-lookup"><span data-stu-id="37b29-106">Each set represents a successive level of indirection or abstraction between a compound file, the objects it contains, and the physical media in which these individual components are stored.</span></span>

<span data-ttu-id="37b29-107">La première catégorie d’interfaces se compose de [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage), [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)et [**IRootStorage**](/windows/desktop/api/Objidl/nn-objidl-irootstorage).</span><span class="sxs-lookup"><span data-stu-id="37b29-107">The first category of interfaces consists of [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage), [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream), and [**IRootStorage**](/windows/desktop/api/Objidl/nn-objidl-irootstorage).</span></span> <span data-ttu-id="37b29-108">Les deux premières interfaces définissent la façon dont les objets sont stockés dans un fichier composé.</span><span class="sxs-lookup"><span data-stu-id="37b29-108">The first two interfaces define how objects are stored within a compound file.</span></span> <span data-ttu-id="37b29-109">Ces interfaces fournissent des méthodes permettant d’ouvrir des éléments de stockage, de valider et de rétablir des modifications, de copier et de déplacer des éléments, ainsi que de lire et d’écrire des flux.</span><span class="sxs-lookup"><span data-stu-id="37b29-109">These interfaces provide methods for opening storage elements, committing and reverting changes, copying and moving elements, and reading and writing streams.</span></span> <span data-ttu-id="37b29-110">Ces interfaces ne reconnaissent pas les formats de données natifs des objets individuels et, par conséquent, n’ont aucune méthode pour enregistrer ces objets dans un stockage persistant.</span><span class="sxs-lookup"><span data-stu-id="37b29-110">These interfaces do not recognize the native data formats of the individual objects and therefore have no methods for saving those objects to persistent storage.</span></span> <span data-ttu-id="37b29-111">L’interface **IRootStorage** dispose d’une méthode unique pour associer un document composé à un nom de système de fichiers sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="37b29-111">The **IRootStorage** interface has a single method for associating a compound document with an underlying file system name.</span></span> <span data-ttu-id="37b29-112">Les clients doivent implémenter ces interfaces pour leurs fichiers composés.</span><span class="sxs-lookup"><span data-stu-id="37b29-112">Clients must implement these interfaces for their compound files.</span></span>

<span data-ttu-id="37b29-113">La deuxième catégorie d’interfaces se compose des interfaces [**IPersist**](/windows/win32/api/objidl/nn-objidl-ipersist) , que les objets implémentent pour gérer leurs données persistantes.</span><span class="sxs-lookup"><span data-stu-id="37b29-113">The second category of interfaces consists of the [**IPersist**](/windows/win32/api/objidl/nn-objidl-ipersist) interfaces, which objects implement to manage their persistent data.</span></span> <span data-ttu-id="37b29-114">Ces interfaces fournissent des méthodes pour lire les formats de données d’objets individuels et savent donc comment les stocker.</span><span class="sxs-lookup"><span data-stu-id="37b29-114">These interfaces provide methods to read the data formats of individual objects and therefore know how to store them.</span></span> <span data-ttu-id="37b29-115">Les objets sont responsables de l’implémentation de ces interfaces, car les clients ne connaissent pas les formats de données natifs de leurs objets imbriqués.</span><span class="sxs-lookup"><span data-stu-id="37b29-115">Objects are responsible for implementing these interfaces because clients do not know the native data formats of their nested objects.</span></span> <span data-ttu-id="37b29-116">Ces interfaces n’ont toutefois aucune connaissance d’un support de stockage physique spécifique.</span><span class="sxs-lookup"><span data-stu-id="37b29-116">These interfaces, however, have no knowledge of specific physical storage media.</span></span>

<span data-ttu-id="37b29-117">Une troisième catégorie se compose d’une seule interface, [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes), qui fournit des méthodes pour écrire des fichiers sur un support physique spécifique, tel qu’un disque dur ou un lecteur de bande.</span><span class="sxs-lookup"><span data-stu-id="37b29-117">A third category consists of a single interface, [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes), which provides methods for writing files to specific physical media, such as a hard disk or tape drive.</span></span> <span data-ttu-id="37b29-118">Toutefois, la plupart des applications n’implémentent pas l’interface **ILockBytes** , car com fournit déjà des implémentations pour les deux situations les plus courantes, qui sont l’implémentation basée sur des fichiers et l’implémentation basée sur la mémoire.</span><span class="sxs-lookup"><span data-stu-id="37b29-118">However, most applications will not implement the **ILockBytes** interface because COM already provides implementations for the two most common situations, which are File-based implementation and Memory-based implementation.</span></span> <span data-ttu-id="37b29-119">L’objet de stockage de fichiers composés appelle les méthodes **ILockBytes** que vous ne les appelez pas directement dans l’implémentation.</span><span class="sxs-lookup"><span data-stu-id="37b29-119">The compound file storage object calls the **ILockBytes** methods you do not call them directly in the implementation.</span></span>

## <a name="compound-file-implementation-limits"></a><span data-ttu-id="37b29-120">Limites d’implémentation des fichiers composés</span><span class="sxs-lookup"><span data-stu-id="37b29-120">Compound File Implementation Limits</span></span>

<span data-ttu-id="37b29-121">L’implémentation COM de l’architecture de stockage structuré est appelée *fichiers composés*.</span><span class="sxs-lookup"><span data-stu-id="37b29-121">The COM implementation of Structured Storage architecture is called *compound files*.</span></span> <span data-ttu-id="37b29-122">Les objets de stockage, tels qu’implémentés dans les fichiers composés, incluent une implémentation des interfaces [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) et [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) .</span><span class="sxs-lookup"><span data-stu-id="37b29-122">Storage objects, as implemented in compound files, include an implementation of the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) and [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) interfaces.</span></span>

<span data-ttu-id="37b29-123">Les pointeurs vers l’implémentation de fichier composé de ces interfaces sont acquis en appelant la fonction [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) pour créer un objet de fichier composé, ou [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) pour ouvrir un fichier composé créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="37b29-123">Pointers to the compound file implementation of these interfaces are acquired by calling the [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) function to create a new compound file object, or [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) to open a previously created compound file.</span></span>

<span data-ttu-id="37b29-124">Une autre méthode pour acquérir un pointeur vers l’implémentation de fichier composé de ces interfaces consiste à appeler la fonction [**StgCreateDocFile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) ou [**StgOpenStorage**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage) plus ancienne et plus limitée.</span><span class="sxs-lookup"><span data-stu-id="37b29-124">An alternative method for acquiring a pointer to the compound file implementation of these interfaces is by calling the older and more limited [**StgCreateDocfile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) or [**StgOpenStorage**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage) function.</span></span> <span data-ttu-id="37b29-125">Les quatre fonctions sont traitées comme des implémentations de fichiers composés.</span><span class="sxs-lookup"><span data-stu-id="37b29-125">All four functions are treated as compound file implementations.</span></span>

<span data-ttu-id="37b29-126">L’implémentation de fichier composé peut être configurée pour utiliser des secteurs d’octets 512 ou 4096, comme défini dans la structure [**STGOPTIONS**](/windows/win32/api/coml2api/ns-coml2api-stgoptions) .</span><span class="sxs-lookup"><span data-stu-id="37b29-126">The compound file implementation can be configured to use 512 or 4096 byte sectors, as defined in the [**STGOPTIONS**](/windows/win32/api/coml2api/ns-coml2api-stgoptions) structure.</span></span>

<span data-ttu-id="37b29-127">L’implémentation de fichier composé de fichiers composés est soumise aux contraintes d’implémentation suivantes.</span><span class="sxs-lookup"><span data-stu-id="37b29-127">The compound file implementation of compound files is subject to the following implementation constraints.</span></span>



| <span data-ttu-id="37b29-128">Limite</span><span class="sxs-lookup"><span data-stu-id="37b29-128">Limit</span></span>                                           | <span data-ttu-id="37b29-129">Fichier composé</span><span class="sxs-lookup"><span data-stu-id="37b29-129">Compound file</span></span>                                                                                                                                                                      |
|-------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="37b29-130">Limites de taille de fichier :</span><span class="sxs-lookup"><span data-stu-id="37b29-130">File size limits:</span></span>                               | <span data-ttu-id="37b29-131">512:2 gigaoctets (Go) 4096 : limites maximales du système de fichiers</span><span class="sxs-lookup"><span data-stu-id="37b29-131">512: 2 gigabytes (GB) 4096: Up to file system limits</span></span><br/>                                                                                                                    |
| <span data-ttu-id="37b29-132">Taille maximale du tas requise pour les éléments ouverts :</span><span class="sxs-lookup"><span data-stu-id="37b29-132">Maximum heap size required for open elements:</span></span>   | <span data-ttu-id="37b29-133">512:4 mégaoctets (Mo) 4096 : limites de la mémoire virtuelle maximale</span><span class="sxs-lookup"><span data-stu-id="37b29-133">512: 4 megabytes (MB) 4096: Up to virtual memory limits</span></span><br/>                                                                                                                 |
| <span data-ttu-id="37b29-134">La racine simultanée s’ouvre (ouvre le même fichier) :</span><span class="sxs-lookup"><span data-stu-id="37b29-134">Concurrent root opens (opens of the same file):</span></span> | <span data-ttu-id="37b29-135">Si \_ les STGM lecture et STGM \_ partage \_ refuser \_ l’écriture sont spécifiées, les limites sont dictées par les limites du système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="37b29-135">If STGM\_READ and STGM\_SHARE\_DENY\_WRITE are specified, limits are dictated by the file-system limits.</span></span> <span data-ttu-id="37b29-136">Dans le cas contraire, il y a une limite de 20 ouvertures de racine simultanées du même fichier.</span><span class="sxs-lookup"><span data-stu-id="37b29-136">Otherwise, there is a limit of 20 concurrent root opens of the same file.</span></span> |
| <span data-ttu-id="37b29-137">Nombre d’éléments dans un fichier :</span><span class="sxs-lookup"><span data-stu-id="37b29-137">Number of elements in a file:</span></span>                   | <span data-ttu-id="37b29-138">512 : illimité, mais les performances peuvent se dégrader si le nombre d’éléments dans les milliers 4096 : illimité</span><span class="sxs-lookup"><span data-stu-id="37b29-138">512: Unlimited, but performance may degrade if elements number in the thousands 4096: Unlimited</span></span><br/>                                                                         |



 

<span data-ttu-id="37b29-139">En raison de la limite de taille de tas de 4 Mo, le nombre d’éléments ouverts en mode traité est généralement limité à plusieurs milliers d’éléments.</span><span class="sxs-lookup"><span data-stu-id="37b29-139">Due to the 4-MB heap-size limit, the number of open elements in transacted mode is typically limited to several thousand elements.</span></span>

 

