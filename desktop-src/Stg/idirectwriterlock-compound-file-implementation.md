---
title: IDirectWriterLock-implémentation de fichier composé
description: L’implémentation de fichier composé de IDirectWriterLock offre un moyen d’ouvrir un fichier composé en mode direct avec un seul Writer et plusieurs lecteurs.
ms.assetid: 4b247dae-d937-430a-bdb7-c47fa3c026b6
keywords:
- IDirectWriterLock Strctd STG, implémentation de fichier composé
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 861935a4c373ce03408c0e633e581e56d39623da
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103671834"
---
# <a name="idirectwriterlock---compound-file-implementation"></a><span data-ttu-id="aa7c5-104">IDirectWriterLock-implémentation de fichier composé</span><span class="sxs-lookup"><span data-stu-id="aa7c5-104">IDirectWriterLock - Compound File Implementation</span></span>

<span data-ttu-id="aa7c5-105">L’implémentation de fichier composé de [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) offre un moyen d’ouvrir un fichier composé en mode direct avec un seul Writer et plusieurs lecteurs.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-105">The compound file implementation of [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) provides a way to open a compound file in direct mode with a single writer and multiple readers.</span></span>

<span data-ttu-id="aa7c5-106">Les fichiers composés peuvent être ouverts en mode direct à l’aide de l' \_ indicateur direct STGM.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-106">Compound files can be opened in direct mode using the STGM\_DIRECT flag.</span></span> <span data-ttu-id="aa7c5-107">L’interface [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) définit l' \_ \| \_ \_ indicateur d’écriture Deny STGM share STGM ReadWrite \_ comme valide en mode direct sans nécessiter la surcharge d’une copie d’instantané.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-107">The [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) interface sets the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flag as valid in direct mode without requiring the overhead of a snapshot copy.</span></span>

<span data-ttu-id="aa7c5-108">Lorsqu’un fichier composé est ouvert en mode traité à l’aide de l' \_ indicateur STGM traité, vous pouvez également avoir plusieurs lecteurs et un seul enregistreur à l’aide de l' \_ indicateur d’écriture STGM ReadWrite \| STGM \_ share \_ Deny \_ .</span><span class="sxs-lookup"><span data-stu-id="aa7c5-108">When a compound file is opened in transacted mode using the STGM\_TRANSACTED flag, you can also have multiple readers and a single writer using the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flag.</span></span> <span data-ttu-id="aa7c5-109">Toutefois, dans ce cas, une copie d’instantané du fichier est effectuée pour les lecteurs.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-109">However, in this case, a snapshot copy of the file is made for the readers.</span></span> <span data-ttu-id="aa7c5-110">Il existe souvent une surcharge d’une copie Scratch.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-110">There is often overhead of a scratch copy.</span></span>

## <a name="when-to-use"></a><span data-ttu-id="aa7c5-111">Quand l’utiliser</span><span class="sxs-lookup"><span data-stu-id="aa7c5-111">When to Use</span></span>

<span data-ttu-id="aa7c5-112">Utilisez l’implémentation fournie par le système de [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) lorsque vous ouvrez un stockage en mode direct (STGM \_ direct) avec les \_ indicateurs de partage STGM ReadWrite \| STGM \_ share \_ Deny \_ .</span><span class="sxs-lookup"><span data-stu-id="aa7c5-112">Use the system-supplied implementation of [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) when you open a storage in direct mode (STGM\_DIRECT) with the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flags.</span></span>

<span data-ttu-id="aa7c5-113">Pour obtenir un pointeur vers [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock), appelez **QueryInterface** sur [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pour obtenir l’objet de stockage racine pour le fichier composé.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-113">To obtain a pointer to [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock), call **QueryInterface** on [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) to get the root storage object for the compound file.</span></span>

<span data-ttu-id="aa7c5-114">Appelez [**IDirectWriterLock :: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) pour obtenir un accès en écriture exclusif à un fichier composé.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-114">Call [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) to obtain exclusive write access to a compound file.</span></span> <span data-ttu-id="aa7c5-115">Appelez [**IDirectWriterLock :: ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) pour libérer l’accès en écriture exclusif.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-115">Call [**IDirectWriterLock::ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) to release exclusive write access.</span></span>

<span data-ttu-id="aa7c5-116">[**IDirectWriterLock :: HaveWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-havewriteaccess) indique si le fichier est actuellement verrouillé.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-116">[**IDirectWriterLock::HaveWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-havewriteaccess) indicates whether the file is currently locked.</span></span>

## <a name="remarks"></a><span data-ttu-id="aa7c5-117">Notes</span><span class="sxs-lookup"><span data-stu-id="aa7c5-117">Remarks</span></span>

<span data-ttu-id="aa7c5-118">L’implémentation de fichier composé de la fonctionnalité à un seul Writer et à plusieurs lecteurs est basée sur le verrouillage de plage.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-118">The compound file implementation of the single-writer, multiple-reader feature is based on range locking.</span></span> <span data-ttu-id="aa7c5-119">L’enregistreur obtient un accès exclusif au stockage à écrire une fois que tous les lecteurs actuels ont fermé le stockage.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-119">The writer obtains exclusive access to the storage to write after all current readers have closed the storage.</span></span> <span data-ttu-id="aa7c5-120">Lorsque le writer est actif, les lecteurs suivants ne peuvent pas ouvrir le stockage.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-120">While the writer is active, subsequent readers cannot open the storage.</span></span> <span data-ttu-id="aa7c5-121">Le writer appelle [**IDirectWriterLock :: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) pour obtenir un accès en écriture exclusif.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-121">The writer calls [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) to obtain exclusive write access.</span></span> <span data-ttu-id="aa7c5-122">Le writer doit ensuite appeler [**IDirectWriterLock :: ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) pour libérer le stockage.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-122">The writer must then call [**IDirectWriterLock::ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) to release the storage.</span></span>

<span data-ttu-id="aa7c5-123">L’appel à [**IDirectWriterLock :: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) est requis avant l’écriture dans ce mode à lecteur unique et à Writer multiple.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-123">The call to [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) is required before writing in this single-reader, multiple-writer mode.</span></span> <span data-ttu-id="aa7c5-124">Les tentatives d’écriture dans le fichier sans appeler **IDirectWriterLock :: WaitForWriteAccess** génèrent d’abord STG \_ E \_ ACCESSDENIED.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-124">Attempts to write to the file without calling **IDirectWriterLock::WaitForWriteAccess** first result in STG\_E\_ACCESSDENIED.</span></span> <span data-ttu-id="aa7c5-125">Cette erreur est retournée même si le writer a ouvert le fichier initialement et qu’aucun lecteur n’est actuellement ouvert dans ce fichier.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-125">This error is returned even if the writer opened the file initially, and no readers currently have the file open.</span></span>

## <a name="marshaling-considerations"></a><span data-ttu-id="aa7c5-126">Considérations relatives au marshaling</span><span class="sxs-lookup"><span data-stu-id="aa7c5-126">Marshaling Considerations</span></span>

<span data-ttu-id="aa7c5-127">Le marshaling personnalisé est généralement utilisé lorsqu’un fichier composé est marshalé vers un autre processus sur le même ordinateur.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-127">Custom marshaling is typically used when a compound file is marshaled to another process on the same machine.</span></span> <span data-ttu-id="aa7c5-128">Lors du marshaling des stockages, les droits d’accès ne sont pas pris en compte et le pointeur [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) est passé au nouveau processus avec les mêmes modes d’accès et droits que le processus de marshaling d’origine.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-128">When marshaling storages, access rights are not considered, and the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer is passed to the new process with the same access modes and rights as the original marshaling process.</span></span> <span data-ttu-id="aa7c5-129">Pour plus d’informations sur les modes d’accès, consultez [**constantes STGM**](stgm-constants.md).</span><span class="sxs-lookup"><span data-stu-id="aa7c5-129">For more information about access modes, see [**STGM Constants**](stgm-constants.md).</span></span> <span data-ttu-id="aa7c5-130">Pendant le marshaling, aucun verrou n’est pris ou vérifié pour garantir un accès en écriture exclusif.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-130">During marshaling, no locks are taken or verified to ensure exclusive write access.</span></span> <span data-ttu-id="aa7c5-131">Dans ce cas, il n’y a pas d’application de la stratégie de rédacteur unique pour les fichiers composés ouverts dans le mode à un seul Writer et à lecteur multiple.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-131">In this case, there is no enforcement of the single-writer policy for compound files opened in the single-writer, multiple-reader mode.</span></span> <span data-ttu-id="aa7c5-132">Au lieu de cela, la mise en œuvre est gérée en interne par l’implémentation du fichier composé.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-132">Instead, enforcement is handled internally by the compound file implementation.</span></span>

<span data-ttu-id="aa7c5-133">Étant donné que le pointeur [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) est passé à un autre processus pendant le marshaling, deux processus peuvent accéder simultanément au même fichier composé.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-133">Because the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer is passed to another process during marshaling, it is possible for two processes to have simultaneous access to the same compound file.</span></span> <span data-ttu-id="aa7c5-134">Même si un appelant peut avoir obtenu un accès en écriture exclusif au stockage en appelant [**IDirectWriterLock :: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), la version marshalée peut également avoir un accès simultané.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-134">Even though a caller may have obtained exclusive write access to the storage by calling [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), the marshaled version can also have access simultaneously.</span></span> <span data-ttu-id="aa7c5-135">Les versions marshalées ne sont pas obligées de se fermer lorsque le seul rédacteur accède au fichier.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-135">The marshaled versions are not forced to close while the single writer accesses the file.</span></span> <span data-ttu-id="aa7c5-136">Dans ce cas, l’implémentation de fichier composé synchronise les écritures en interne.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-136">In this case, the compound file implementation synchronizes the writes internally.</span></span>

<span data-ttu-id="aa7c5-137">Si un writer unique obtient l’accès exclusif en appelant, [**IDirectWriterLock :: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), le stockage marshalé dispose également d’un accès en écriture et n’a pas besoin d’appeler **IDirectWriterLock :: WaitForWriteAccess**.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-137">If a single writer obtains exclusive access by calling, [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), the marshaled storage also has write access and does not have to call **IDirectWriterLock::WaitForWriteAccess**.</span></span> <span data-ttu-id="aa7c5-138">Les deux processus ont un accès en écriture et la synchronisation est contrôlée par l’implémentation de fichier composé interne.</span><span class="sxs-lookup"><span data-stu-id="aa7c5-138">Both processes have write access and synchronization is controlled by the internal compound file implementation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="aa7c5-139">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="aa7c5-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="aa7c5-140">**IDirectWriterLock**</span><span class="sxs-lookup"><span data-stu-id="aa7c5-140">**IDirectWriterLock**</span></span>](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock)
</dt> </dl>

 

 




