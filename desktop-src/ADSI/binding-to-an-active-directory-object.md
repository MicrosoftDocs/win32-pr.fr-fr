---
title: Liaison à un objet Active Directory
description: La méthode la plus courante pour effectuer une liaison à un objet Active Directory consiste à utiliser la fonction GetObject entre un client ADSI et un fournisseur ADSI.
ms.assetid: d278ea26-2fd5-4343-8d87-ff85515325fb
ms.tgt_platform: multiple
keywords:
- Liaison à un objet Active Directory ADSI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 59992dbc88c00be6306dec24523ec4e030d4a516
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/21/2020
ms.locfileid: "103842718"
---
# <a name="binding-to-an-active-directory-object"></a><span data-ttu-id="776ef-104">Liaison à un objet Active Directory</span><span class="sxs-lookup"><span data-stu-id="776ef-104">Binding to an Active Directory Object</span></span>

<span data-ttu-id="776ef-105">La méthode la plus courante pour effectuer une liaison à un objet Active Directory consiste à utiliser la fonction **GetObject** entre un client ADSI et un fournisseur ADSI.</span><span class="sxs-lookup"><span data-stu-id="776ef-105">The most common way to bind to an Active Directory object is to use the **GetObject** function between an ADSI client and an ADSI provider.</span></span> <span data-ttu-id="776ef-106">Il s’agit également du moyen le plus simple pour montrer comment le composant fournisseur reçoit les requêtes et les services.</span><span class="sxs-lookup"><span data-stu-id="776ef-106">This is also the easiest way to show how the provider component receives and services requests.</span></span> <span data-ttu-id="776ef-107">La fonction d’API ADSI [**ADsGetObject**](/windows/desktop/api/Adshlp/nf-adshlp-adsgetobject) ou la fonction Visual Basic **GetObject** suivent les mêmes étapes pour la liaison.</span><span class="sxs-lookup"><span data-stu-id="776ef-107">Both the ADSI API function [**ADsGetObject**](/windows/desktop/api/Adshlp/nf-adshlp-adsgetobject) or the Visual Basic function **GetObject** follow the same steps for binding.</span></span>

<span data-ttu-id="776ef-108">Pour cet exemple, supposons que le client ADSI est une application de la visionneuse ADSI qui a reçu l’ADsPath « Sample://Seattle/Redmond/Shelly » de son interface utilisateur (1).</span><span class="sxs-lookup"><span data-stu-id="776ef-108">For this example, assume the ADSI client is an ADSI viewer application that has received the ADsPath "Sample://Seattle/Redmond/Shelly" from its user interface (1).</span></span> <span data-ttu-id="776ef-109">La figure suivante détaille la séquence d’événements en numérotant les flèches de Flow.</span><span class="sxs-lookup"><span data-stu-id="776ef-109">The following figure details the sequence of events by numbering the flow arrows.</span></span>

![vue détaillée des composants ADSI](images/dscsex.png)

<span data-ttu-id="776ef-111">Dans l’illustration précédente, le client lance la demande d’un pointeur d’interface sur l’objet Active Directory représenté par l’ADsPath « Sample://Seattle/Redmond/Shelly » à partir des services ADSI (2).</span><span class="sxs-lookup"><span data-stu-id="776ef-111">In the preceding figure, the client initiates the request for an interface pointer on the Active Directory object represented by the ADsPath "Sample://Seattle/Redmond/Shelly" from ADSI services (2).</span></span> <span data-ttu-id="776ef-112">Pendant l’initialisation, le logiciel de services a rempli une table des identificateurs programmatiques (ProgID) du fournisseur installés à partir du Registre (« LDAP : », « Sample : », « Winnt : », etc.) et les a associés au **CLSID** correspondant qui identifient le module logiciel approprié.</span><span class="sxs-lookup"><span data-stu-id="776ef-112">During initialization, the services software populated a table of installed provider programmatic identifiers (ProgIDs) from the registry ("LDAP:","Sample:", "WinNT:", and so on) and paired them with the matching **CLSID** s which identify the appropriate software module.</span></span>

<span data-ttu-id="776ef-113">Le serveur ADSI vérifie que le ProgID, dans le cas présent « Sample : », existe dans le ADsPath.</span><span class="sxs-lookup"><span data-stu-id="776ef-113">The ADSI server verifies that the ProgID, in this case "Sample:", exists in the ADsPath.</span></span> <span data-ttu-id="776ef-114">Il crée ensuite un contexte de liaison pour optimiser les références supplémentaires à cet objet, et appelle la fonction COM standard [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) pour créer un moniker com qui peut être utilisé pour rechercher et effectuer une liaison à l’objet qui représente l’utilisateur « Shelly ».</span><span class="sxs-lookup"><span data-stu-id="776ef-114">It then creates a bind context to optimize further references to this object, and calls the standard COM function [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) to create a COM moniker that can be used to find and bind to the object that represents the user "Shelly".</span></span>

<span data-ttu-id="776ef-115">Dans la section suivante, les noms de fichiers de l’exemple de code source du composant fournisseur sont inclus entre parenthèses, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="776ef-115">In the following section, the file names of the example provider component source code are included in parentheses where appropriate.</span></span>

<span data-ttu-id="776ef-116">Comme dans d’autres implémentations de serveur COM, [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) examine le ProgID et recherche le **CLSID** approprié dans le registre (3) pour rechercher le code de fabrique de classe (Cprovcf. cpp) fourni par le fournisseur correspondant dans l’implémentation de fournisseur appropriée (4).</span><span class="sxs-lookup"><span data-stu-id="776ef-116">As in other COM server implementations, [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) examines the ProgID, and looks up the proper **CLSID** in the registry (3) to find the corresponding provider-supplied class factory code (Cprovcf.cpp) in the appropriate provider implementation (4).</span></span> <span data-ttu-id="776ef-117">Ce code crée un objet de niveau supérieur initial qui implémente la méthode [**IParseDisplayName ::P arsedisplayname**](/windows/win32/api/oleidl/nf-oleidl-iparsedisplayname-parsedisplayname) (Cprov. cpp).</span><span class="sxs-lookup"><span data-stu-id="776ef-117">This code creates an initial top-level object that implements the [**IParseDisplayName::ParseDisplayName**](/windows/win32/api/oleidl/nf-oleidl-iparsedisplayname-parsedisplayname) method (Cprov.cpp).</span></span> <span data-ttu-id="776ef-118">L’implémentation du fournisseur de **ParseDisplayName** résout le chemin d’accès dans le propre espace de noms du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="776ef-118">The provider's implementation of **ParseDisplayName** resolves the path in the provider's own namespace.</span></span> <span data-ttu-id="776ef-119">Cela appelle ensuite ADsObject et appelle l’analyseur fourni avec le composant fournisseur (Parse. cpp) pour vérifier que l’ADsPath est syntaxiquement correct pour cet espace de noms.</span><span class="sxs-lookup"><span data-stu-id="776ef-119">This eventually calls ADsObject and invokes the parser supplied with the provider component (Parse.cpp) to verify that the ADsPath is syntactically correct for this namespace.</span></span>

<span data-ttu-id="776ef-120">**GetObject**, qui est défini dans Getobj. cpp, détermine si l’objet demandé est un objet d’espace de noms, un objet de schéma ou un autre type d’objet.</span><span class="sxs-lookup"><span data-stu-id="776ef-120">**GetObject**, that is defined in Getobj.cpp, then determines if the object requested is a namespace object, a schema object, or some other type of object.</span></span> <span data-ttu-id="776ef-121">Si l’un des deux premiers, ce type d’objet de classe de schéma est créé et le pointeur d’interface approprié a été récupéré.</span><span class="sxs-lookup"><span data-stu-id="776ef-121">If either of the first two, that type of schema class object is created and the appropriate interface pointer retrieved.</span></span> <span data-ttu-id="776ef-122">Dans le cas contraire, le chemin d’accès de l’exemple de répertoire est créé à partir de l’ADsPath (par exemple, « \\ Seattle \\ Redmond \\ Shelly », mais dans un autre service d’annuaire, il peut s’agir de « \\ ou = Seattle \\ ou = Redmond \\ CN = Shelly ») et le contrôle passe à SampleDSOpenObject qui ouvre l’objet dans l’exemple de stockage de données et récupère également son type d’objet</span><span class="sxs-lookup"><span data-stu-id="776ef-122">Otherwise the Sample directory path is created from the ADsPath (for example, "\\Seattle\\Redmond\\Shelly", but in a different directory service it might have had to be "\\OU=Seattle\\OU=Redmond\\CN=Shelly") and control passes to SampleDSOpenObject which opens the object in the example data storage and also retrieves its object type (in this case, "User") (5).</span></span>

<span data-ttu-id="776ef-123">Une fois les données collectées, un nouvel objet est créé (6) pour représenter l’élément décrit par l’ADsPath, et un pointeur vers l’interface [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) sur cet objet est récupéré.</span><span class="sxs-lookup"><span data-stu-id="776ef-123">With the data gathered, a new object is created (6) to represent the item described by the ADsPath, and a pointer to the [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) interface on that object is retrieved.</span></span> <span data-ttu-id="776ef-124">Dans ce cas, un objet Active Directory générique est créé et prend en charge les méthodes **IUnknown** et [**IADs**](/windows/desktop/api/Iads/nn-iads-iads) (Cgenobj. cpp, Core. cpp).</span><span class="sxs-lookup"><span data-stu-id="776ef-124">In this case, a generic Active Directory object is created that supports the **IUnknown** and [**IADs**](/windows/desktop/api/Iads/nn-iads-iads) methods (Cgenobj.cpp, Core.cpp).</span></span> <span data-ttu-id="776ef-125">La routine CSampleDSGenObject :: AllocateGenObject lit les données de la bibliothèque de types pour créer les entrées de dispatch appropriées pour ces nouveaux objets afin de prendre en charge [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch).</span><span class="sxs-lookup"><span data-stu-id="776ef-125">The CSampleDSGenObject::AllocateGenObject routine reads the type library data to create the proper dispatch entries for these new objects in order to support [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch).</span></span>

<span data-ttu-id="776ef-126">L’encapsulation de ce pointeur d’interface dans un moniker termine la fonction ResolvePathName (Cprov. cpp) et analyse le nom complet.</span><span class="sxs-lookup"><span data-stu-id="776ef-126">Wrapping this interface pointer into a moniker completes the ResolvePathName (Cprov.cpp) function and parses the display name.</span></span>

<span data-ttu-id="776ef-127">Tous les objets COM créés pendant ce processus sont mis en cache pour des raisons de performances et gérés par le contexte de liaison.</span><span class="sxs-lookup"><span data-stu-id="776ef-127">All the COM objects created during this process are cached for performance reasons and managed through the binding context.</span></span> <span data-ttu-id="776ef-128">Cela améliore les performances d’autres opérations sur le même objet qui suit immédiatement la liaison de moniker.</span><span class="sxs-lookup"><span data-stu-id="776ef-128">This improves performance for other operations on the same object that immediately follows the moniker binding.</span></span>

<span data-ttu-id="776ef-129">Cet objet Active Directory correctement construit est désormais interrogé pour l’identificateur d’interface demandé pour l’appel initial [**ADsGetObject**](/windows/desktop/api/Adshlp/nf-adshlp-adsgetobject) et un pointeur vers cette interface est récupéré (7) et transmis par le serveur ADSI au client (8&9).</span><span class="sxs-lookup"><span data-stu-id="776ef-129">This well-formed Active Directory object is now queried for the interface identifier requested for the initial [**ADsGetObject**](/windows/desktop/api/Adshlp/nf-adshlp-adsgetobject) call and a pointer to that interface is retrieved (7) and passed back through the ADSI server to the client (8&9).</span></span> <span data-ttu-id="776ef-130">À partir de là, le client fonctionne directement avec le composant fournisseur via les méthodes d’interface jusqu’à ce que la demande initiale soit satisfaite (10).</span><span class="sxs-lookup"><span data-stu-id="776ef-130">From then on, the client works directly with the provider component through the interface methods until the initial request is satisfied (10).</span></span>

<span data-ttu-id="776ef-131">En outre, les demandes de données d’objet provenant du client prennent généralement la forme de requêtes pour les acquisitions et les acquisitions de propriétés, toutes optimisées par le biais de l’implémentation du fournisseur d’un cache de propriétés (cProps. cpp).</span><span class="sxs-lookup"><span data-stu-id="776ef-131">Furthermore, requests for object data from the client usually take the form of requests for property gets and puts, all of which are optimized through the provider implementation of a property cache (Cprops.cpp).</span></span> <span data-ttu-id="776ef-132">La compression et la décompression intelligentes des données, notamment la copie et la libération de structures et de chaînes, entre les types de données natifs sur le système d’exploitation de l’exemple de composant fournisseur et le type [**Variant**](/windows/win32/api/oaidl/ns-oaidl-variant) Automation pris en charge par ADSI ont lieu avant le chargement des propriétés dans le cache (Smpoper. cpp).</span><span class="sxs-lookup"><span data-stu-id="776ef-132">Intelligently packing and unpacking data, often including copying and freeing structures and strings, between the native data types on the example provider component's operating system and the Automation [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) type supported by ADSI takes place before the properties are loaded into the cache (Smpoper.cpp).</span></span>

<span data-ttu-id="776ef-133">L’exemple de composant fournisseur est conçu de sorte que les appels réels au système d’exploitation soient logiquement isolés du composant fournisseur, créant ainsi un logiciel portable pour plusieurs systèmes d’exploitation (RegDSAPI. cpp).</span><span class="sxs-lookup"><span data-stu-id="776ef-133">The example provider component is designed so that the actual calls to the operating system are logically isolated from the provider component, creating software portable to more than one operating system (RegDSAPI.cpp).</span></span>

 

 