---
title: Comment effectuer une recherche à l’aide de VLV
description: Active Directory prend en charge les recherches de listes virtuelles (VLV, Virtual List View). Ce style de recherche est spécifiquement conçu pour les grands jeux de résultats et permet à une application d’afficher un sous-ensemble de milliers d’entrées sans avoir à récupérer chaque entrée.
ms.assetid: fea04190-0846-4b62-99f4-7d8fb35fd510
ms.tgt_platform: multiple
keywords:
- Comment effectuer une recherche à l’aide de VLV
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f4a24250c8e54ccb7917f86b193152c62810b93
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/21/2020
ms.locfileid: "103941369"
---
# <a name="how-to-search-using-vlv"></a><span data-ttu-id="fbb1b-105">Comment effectuer une recherche à l’aide de VLV</span><span class="sxs-lookup"><span data-stu-id="fbb1b-105">How to Search Using VLV</span></span>

<span data-ttu-id="fbb1b-106">Active Directory prend en charge les recherches de listes virtuelles (VLV, Virtual List View).</span><span class="sxs-lookup"><span data-stu-id="fbb1b-106">Active Directory supports virtual list view (VLV) searches.</span></span> <span data-ttu-id="fbb1b-107">Ce style de recherche est spécifiquement conçu pour les grands jeux de résultats et permet à une application d’afficher un sous-ensemble de milliers d’entrées sans avoir à récupérer chaque entrée.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-107">This style of search is specifically designed for large result sets and enables an application to display a subset of thousands of entries without actually having to retrieve every entry.</span></span>

<span data-ttu-id="fbb1b-108">Une recherche VLV peut être utilisée de deux façons distinctes.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-108">There are two distinct ways that a VLV search can be used.</span></span> <span data-ttu-id="fbb1b-109">La première consiste à récupérer les attributs pour des entrées particulières en fonction d’un décalage numérique.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-109">The first is to retrieve the attributes for particular entries based on a numeric offset.</span></span> <span data-ttu-id="fbb1b-110">Cette méthode est utile lors de la récupération des résultats de la recherche en réponse à une opération de défilement.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-110">This method is useful when retrieving search results in response to a scrolling operation.</span></span>

<span data-ttu-id="fbb1b-111">La deuxième façon d’utiliser les recherches VLV consiste à rechercher tout ou partie d’un attribut textuel et à afficher uniquement les résultats de la recherche.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-111">The second way to use VLV searches is to search for part or all of a textual attribute and only display the results of the search.</span></span> <span data-ttu-id="fbb1b-112">Voici un exemple d’utilisation de ce carnet d’adresses.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-112">An example usage of this is an address book.</span></span> <span data-ttu-id="fbb1b-113">Si l’utilisateur tape un « s », l’application peut utiliser une recherche VLV pour rechercher les entrées dont le nom commun commence par « s ».</span><span class="sxs-lookup"><span data-stu-id="fbb1b-113">If the user types an "s", then the application can use a VLV search to search for entries that have a common-name that begins with "s".</span></span> <span data-ttu-id="fbb1b-114">Si l’utilisateur ajoute ensuite un « m » à la « s », l’application peut utiliser une autre recherche VLV pour rechercher les entrées dont le nom commun commence par « SM ».</span><span class="sxs-lookup"><span data-stu-id="fbb1b-114">If the user then adds an "m" to the "s", the application can use another VLV search to search for entries that have a common-name that begins with "sm".</span></span>

<span data-ttu-id="fbb1b-115">Pour effectuer une recherche VLV, demandez à ADSI d’utiliser le contrôle VLV.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-115">To perform a VLV search, instruct ADSI to use the VLV control.</span></span> <span data-ttu-id="fbb1b-116">Pour ce faire, appelez la méthode [**IDirectorySearch :: SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) avec une option de recherche **\_ \_ VLV ADS SEARCHPREF** avec une valeur de **\_ preuve \_ spécifique ADSTYPE** .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-116">To do this, call the [**IDirectorySearch::SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) method with an **ADS\_SEARCHPREF\_VLV** search option with an **ADSTYPE\_PROV\_SPECIFIC** value.</span></span> <span data-ttu-id="fbb1b-117">La **valeur \_ \_ spécifique de la preuve ADSTYPE** est un pointeur vers une structure [**\_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) qui contient les données relatives à la recherche.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-117">The **ADSTYPE\_PROV\_SPECIFIC** value is a pointer to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure that contains data about the search.</span></span> <span data-ttu-id="fbb1b-118">La fonction exemple [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) montre comment définir ces deux préférences de recherche.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-118">The [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) example function shows how to set both of these search preferences.</span></span>

<span data-ttu-id="fbb1b-119">Toutes les recherches VLV doivent utiliser le tri des résultats côté serveur, qui est effectué en définissant le **\_ \_ Tri SEARCHPREF des publicités \_ sur** la préférence de recherche.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-119">All VLV searches must use server-side result sorting, which is performed by setting the **ADS\_SEARCHPREF\_SORT\_ON** search preference.</span></span> <span data-ttu-id="fbb1b-120">Pour plus d’informations sur les préférences de recherche **\_ SEARCHPREF \_ \_ des publicités** , consultez [Tri des résultats de recherche avec IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span><span class="sxs-lookup"><span data-stu-id="fbb1b-120">For more information about the **ADS\_SEARCHPREF\_SORT\_ON** search preference, see [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span></span>

<span data-ttu-id="fbb1b-121">Lorsqu’une recherche VLV est effectuée, une certaine quantité de métadonnées sur la recherche est retournée dans une colonne qui est extraite en appelant [**IDirectorySearch :: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) avec l’identificateur de **\_ \_ réponse VLV ADS** .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-121">When a VLV search is performed, a certain amount of metadata about the search is returned in a column that is retrieved by calling [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the **ADS\_VLV\_RESPONSE** identifier.</span></span> <span data-ttu-id="fbb1b-122">Ces données sont contenues dans une structure [**\_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-122">This data is contained in an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span> <span data-ttu-id="fbb1b-123">Les membres **dwContentCount** et **lpContextID** sont particulièrement importants.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-123">Of particular importance are the **dwContentCount** and **lpContextID** members.</span></span> <span data-ttu-id="fbb1b-124">Le membre **dwContentCount** contient le nombre de résultats qui répondent aux critères de recherche VLV.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-124">The **dwContentCount** member will contain the number of results that meet the VLV search criteria.</span></span> <span data-ttu-id="fbb1b-125">Cette valeur peut être utilisée comme une estimation du nombre total d’éléments qui seraient renvoyés pour une recherche de ce type.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-125">This value can be used as an estimate of the total number of items that would be returned for a search of that type.</span></span> <span data-ttu-id="fbb1b-126">Le membre **lpContextID** contient une valeur définie par le serveur qui peut être transmise à la recherche suivante pour identifier la recherche.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-126">The **lpContextID** member contains a server-defined value that can be passed to the next search to identify the search.</span></span> <span data-ttu-id="fbb1b-127">L’utilisation de **lpContextID** peut améliorer les performances de recherche.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-127">Using the **lpContextID** can enhance the search performance.</span></span> <span data-ttu-id="fbb1b-128">Sachez que le **lpContextID** est une valeur définie par le serveur et que sa longueur est contenue dans le membre **dwContextIDLength** .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-128">Be aware that the **lpContextID** is a server-defined value and its length is contained in the **dwContextIDLength** member.</span></span> <span data-ttu-id="fbb1b-129">Cette mémoire tampon est libérée quand la méthode [**IDirectorySearch :: FreeColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-freecolumn) est appelée, de sorte que l’appelant doit allouer une mémoire tampon de la taille appropriée et copier et enregistrer le contenu de la mémoire tampon entre les recherches.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-129">This buffer is freed when the [**IDirectorySearch::FreeColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-freecolumn) method is called, so the caller must allocate a buffer of the appropriate size and copy and save the contents of the buffer between searches.</span></span>

<span data-ttu-id="fbb1b-130">Pour plus d’informations sur le contrôle VLV LDAP, consultez [recherche à l’aide du contrôle VLV LDAP](/previous-versions/windows/desktop/ldap/searching-with-the-ldap-vlv-control).</span><span class="sxs-lookup"><span data-stu-id="fbb1b-130">For more information about the LDAP VLV control, see [Searching with the LDAP VLV Control](/previous-versions/windows/desktop/ldap/searching-with-the-ldap-vlv-control).</span></span>

<span data-ttu-id="fbb1b-131">Pour plus d’informations, consultez :</span><span class="sxs-lookup"><span data-stu-id="fbb1b-131">For more information, see:</span></span>

-   <span data-ttu-id="fbb1b-132">Obtention du nombre d’éléments</span><span class="sxs-lookup"><span data-stu-id="fbb1b-132">Obtaining the Number of Items</span></span>
-   <span data-ttu-id="fbb1b-133">Recherche par décalage</span><span class="sxs-lookup"><span data-stu-id="fbb1b-133">Searching by Offset</span></span>
-   <span data-ttu-id="fbb1b-134">Recherche par chaîne</span><span class="sxs-lookup"><span data-stu-id="fbb1b-134">Searching by String</span></span>
-   [<span data-ttu-id="fbb1b-135">Exemple de code pour l’utilisation d’une recherche VLV</span><span class="sxs-lookup"><span data-stu-id="fbb1b-135">Example Code for Using a VLV Search</span></span>](example-code-for-using-a-vlv-search.md)

## <a name="obtaining-the-number-of-items"></a><span data-ttu-id="fbb1b-136">Obtention du nombre d’éléments</span><span class="sxs-lookup"><span data-stu-id="fbb1b-136">Obtaining the Number of Items</span></span>

<span data-ttu-id="fbb1b-137">**Pour obtenir une estimation du nombre d’éléments qui seront retournés pour une recherche particulière, procédez comme suit.**</span><span class="sxs-lookup"><span data-stu-id="fbb1b-137">**To obtain an estimate of the number of items that will be returned for a particular search, perform the following steps.**</span></span>

1.  <span data-ttu-id="fbb1b-138">Remplir une [**structure \_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) avec toutes les valeurs zéro ou **null** .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-138">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with all zero or **NULL** values.</span></span>
2.  <span data-ttu-id="fbb1b-139">Remplissez les [**\_ \_ informations de SEARCHPREF ADS**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) avec les valeurs suivantes.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-139">Fill an [**ADS\_SEARCHPREF\_INFO**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) with the following values.</span></span>

    -   <span data-ttu-id="fbb1b-140">Définissez le membre **dwSearchPref** sur **ADS \_ SEARCHPREF \_ VLV**.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-140">Set the **dwSearchPref** member to **ADS\_SEARCHPREF\_VLV**.</span></span>
    -   <span data-ttu-id="fbb1b-141">Définissez le membre **vValue. dwType** sur **ADSTYPE \_ \_ specific**.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-141">Set the **vValue.dwType** member to **ADSTYPE\_PROV\_SPECIFIC**.</span></span>
    -   <span data-ttu-id="fbb1b-142">Définissez le membre **vValue. providerspecific. dwLength** sur la taille de la [**structure \_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-142">Set the **vValue.ProviderSpecific.dwLength** member to the size of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span>
    -   <span data-ttu-id="fbb1b-143">Définissez le membre **vValue. providerspecific. lpValue** sur l’adresse de la [**structure \_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) de l’étape 1.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-143">Set the **vValue.ProviderSpecific.lpValue** member to the address of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure from Step 1.</span></span>

3.  <span data-ttu-id="fbb1b-144">Remplissez une [**structure \_ SortKey ADS**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) comme indiqué dans [Tri des résultats de recherche avec IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md) pour effectuer un tri sur l’attribut souhaité.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-144">Fill an [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure as shown in [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md) to sort on the desired attribute.</span></span>
4.  <span data-ttu-id="fbb1b-145">Remplissez d' [**autres \_ \_ informations SEARCHPREF ADS**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) pour ajouter la structure de valeurs de tri [**ADS \_**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) aux préférences de recherche, comme indiqué dans [Tri des résultats de recherche avec IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span><span class="sxs-lookup"><span data-stu-id="fbb1b-145">Fill another [**ADS\_SEARCHPREF\_INFO**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) to add the [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure to the search preferences as shown in [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span></span>
5.  <span data-ttu-id="fbb1b-146">Ajoutez les autres préférences de recherche souhaitées et appelez [**IDirectorySearch :: SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) pour définir les préférences de recherche.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-146">Add any other desired search preferences and call [**IDirectorySearch::SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) to set the search preferences.</span></span>
6.  <span data-ttu-id="fbb1b-147">Effectuez la recherche avec [**IDirectorySearch :: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="fbb1b-147">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
7.  <span data-ttu-id="fbb1b-148">Récupérez la première ligne de résultats en appelant [**IDirectorySearch :: GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="fbb1b-148">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
8.  <span data-ttu-id="fbb1b-149">Appelez [**IDirectorySearch :: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) avec **la \_ \_ réponse VLV ADS** pour obtenir les métadonnées de recherche VLV.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-149">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
9.  <span data-ttu-id="fbb1b-150">Cast du **pADsValues->providerspecific. lpValue** de la structure de [**\_ \_ colonne de recherche ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) en pointeur de structure [**\_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-150">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span> <span data-ttu-id="fbb1b-151">Le membre **dwContentCount** de cette **structure \_ VLV ADS** contient le nombre approximatif d’éléments qui seraient renvoyés par une recherche de ce type.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-151">The **dwContentCount** member of this **ADS\_VLV** structure contains the approximate number of items that would be returned by a search of that type.</span></span>
10. <span data-ttu-id="fbb1b-152">Si d’autres recherches VLV du même type sont effectuées, effectuez une copie des données **lpContextID** et conservez-les pour la recherche VLV suivante.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-152">If other VLV searches of the same type will be performed, make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span>

<span data-ttu-id="fbb1b-153">La fonction exemple [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) montre comment procéder.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-153">The [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

## <a name="searching-by-offset"></a><span data-ttu-id="fbb1b-154">Recherche par décalage</span><span class="sxs-lookup"><span data-stu-id="fbb1b-154">Searching by Offset</span></span>

<span data-ttu-id="fbb1b-155">Une chose qui effectue des recherches de VLV si rapide est qu’il est possible de rechercher un résultat spécifique à l’aide d’un décalage numérique.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-155">One thing that makes VLV searches so quick is that it is possible to search for a specific result by a numerical offset.</span></span> <span data-ttu-id="fbb1b-156">Par exemple, si une recherche se traduirait par 10 000 éléments retournés, une recherche VLV permet d’obtenir les informations d’environ l’élément 4072nd sans avoir à récupérer tous les éléments avant l’élément en question.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-156">For example, if a search would result in 10,000 items being returned, a VLV search makes it possible to obtain the information for approximately the 4072nd item without having to retrieve all of the items before the item in question.</span></span>

<span data-ttu-id="fbb1b-157">Les décalages sont spécifiés sous la forme d’un rapport entre le décalage et le nombre de contenu.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-157">Offsets are specified as a ratio between the offset and the content count.</span></span> <span data-ttu-id="fbb1b-158">Les ratios sont utiles, car le serveur n’a peut-être pas une estimation précise du nombre d’entrées qui existent dans la liste ou la taille de la liste peut être modifiée au moment où l’utilisateur la parcourt.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-158">Ratios are useful because the server may not have an accurate estimate of the number of entries that exist in the list or the list size may be changing during the time the user is browsing it.</span></span> <span data-ttu-id="fbb1b-159">Étant donné que vous devez indiquer le début et la fin de la liste, vous pouvez utiliser une valeur estimée pour le nombre de contenu dans la première demande de recherche, ainsi qu’une valeur de décalage.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-159">Because you must indicate the beginning and end of the list, you can use an estimated value for the content count in the first search request, along with an offset value.</span></span> <span data-ttu-id="fbb1b-160">Le serveur utilise ces données pour calculer les décalages correspondants dans la liste, en fonction de son idée du nombre de contenu, qui est envoyé dans sa réponse au client via le membre **dwContentCount** de la [**structure \_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-160">The server uses this data to compute the corresponding offsets within the list, based on its idea of content count, which is sent in its response to the client through the **dwContentCount** member of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span> <span data-ttu-id="fbb1b-161">Par exemple, si vous estimez que la taille de la liste est de 3000, et que vous souhaitez que le décalage soit la liste d’entrée 1500, vous devez définir **dwContentCount** sur 3000 et **dwOffset** sur 1500.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-161">For example, if you estimate the list size to be 3000, and you want the offset to be list entry 1500, you would set **dwContentCount** to 3000 and **dwOffset** to 1500.</span></span> <span data-ttu-id="fbb1b-162">Si le serveur estime que la taille réelle de la liste est de 4500, il recalcule le décalage à 2250 et retourne les nouvelles estimations dans **dwContentCount** et **dwOffset**.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-162">If the server estimates the actual list size to be 4500, it will recalculate the offset to 2250, and return the new estimates in **dwContentCount** and **dwOffset**.</span></span>

> [!Note]
>
> <span data-ttu-id="fbb1b-163">Toutes les valeurs numériques d’une recherche VLV sont des approximations et ne doivent pas être utilisées pour les valeurs absolues.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-163">All of the numeric values in a VLV search are approximations and should not be used for absolute values.</span></span> <span data-ttu-id="fbb1b-164">Par exemple, si vous émettez une recherche VLV pour le 50e élément dans un ratio de 100, il n’est pas garanti que vous obteniez l’élément intermédiaire exact.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-164">For example, if you issue a VLV search for the 50th item in a ration of 100, you are not guaranteed to get the exact middle item.</span></span>
>
> <span data-ttu-id="fbb1b-165">**Pour rechercher un élément particulier par décalage, procédez comme suit.**</span><span class="sxs-lookup"><span data-stu-id="fbb1b-165">**To search for a particular item by offset, perform the following steps.**</span></span>
>
> 1.  <span data-ttu-id="fbb1b-166">Remplissez une [**structure \_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) avec les valeurs suivantes.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-166">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with the following values.</span></span> <span data-ttu-id="fbb1b-167">Les membres supplémentaires de la structure doivent être définis sur zéro ou **null**.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-167">Additional members of the structure should be set to zero or **NULL**.</span></span>
>
>     -   <span data-ttu-id="fbb1b-168">Définissez le membre **dwContentCount** sur la valeur maximale du rapport des éléments à récupérer.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-168">Set the **dwContentCount** member to the maximum value of the ratio of items to retrieve.</span></span>
>     -   <span data-ttu-id="fbb1b-169">Affectez au membre **dwOffset** le ratio, par rapport à **dwContentCount**, de l’élément ou des éléments à récupérer.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-169">Set the **dwOffset** member to the ratio, relative to **dwContentCount**, of the item or items to retrieve.</span></span>
>     -   <span data-ttu-id="fbb1b-170">Définissez le membre **lpContextID** sur l’adresse de la copie de la mémoire tampon de l’ID de contexte et **dwContextIDLength** sur la longueur, en octets, de la mémoire tampon de l’ID de contexte.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-170">Set the **lpContextID** member to the address of the copy of the context ID buffer and the **dwContextIDLength** to the length, in bytes, of the context ID buffer.</span></span> <span data-ttu-id="fbb1b-171">Si aucun ID de contexte n’a été enregistré, les deux membres doivent avoir la valeur zéro ou avoir la **valeur null**.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-171">If no context ID has been saved, both of the these members should be zero or **NULL**.</span></span>
>
> 2.  <span data-ttu-id="fbb1b-172">Définissez les préférences de recherche comme indiqué dans les étapes 2 à 5 de la procédure obtention du nombre d’éléments.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-172">Set the search preferences as shown in Steps 2 through 5 of the Obtaining the Number of Items procedure.</span></span>
> 3.  <span data-ttu-id="fbb1b-173">Effectuez la recherche avec [**IDirectorySearch :: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="fbb1b-173">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
> 4.  <span data-ttu-id="fbb1b-174">Récupérez la première ligne de résultats en appelant [**IDirectorySearch :: GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="fbb1b-174">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
> 5.  <span data-ttu-id="fbb1b-175">Appelez [**IDirectorySearch :: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) avec le nom de l’attribut à récupérer pour obtenir les données réelles de l’élément demandé.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-175">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the name of the attribute to retrieve to get the actual data for the requested item.</span></span>
> 6.  <span data-ttu-id="fbb1b-176">Appelez [**IDirectorySearch :: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) avec **la \_ \_ réponse VLV ADS** pour obtenir les métadonnées de recherche VLV.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-176">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
> 7.  <span data-ttu-id="fbb1b-177">Cast du **pADsValues->providerspecific. lpValue** de la structure de [**\_ \_ colonne de recherche ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) en pointeur de structure [**\_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-177">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span>
> 8.  <span data-ttu-id="fbb1b-178">Effectuez une copie des données **lpContextID** et conservez-les pour la prochaine recherche VLV.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-178">Make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span>

 

<span data-ttu-id="fbb1b-179">La fonction exemple [**GetVLVItemText**](example-code-for-using-a-vlv-search.md) montre comment procéder.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-179">The [**GetVLVItemText**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

<span data-ttu-id="fbb1b-180">Il est également possible de récupérer plusieurs lignes de données à l’aide d’un seul appel de recherche.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-180">It is also possible to retrieve more than one row of data with a single search call.</span></span> <span data-ttu-id="fbb1b-181">Cette opération est effectuée à l’étape 1 en définissant les membres **dwBeforeCount** et **dwAfterCount** de la structure [**\_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) de manière appropriée.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-181">This is done in Step 1 by setting the **dwBeforeCount** and **dwAfterCount** members of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure appropriately.</span></span> <span data-ttu-id="fbb1b-182">Le membre **dwBeforeCount** contient le nombre d’éléments qui apparaissent dans la liste avant l’élément en question et le membre **dwAfterCount** contient le nombre d’éléments qui s’affichent dans la liste après à l’élément en question.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-182">The **dwBeforeCount** member contains the number of items that appear in the list prior to the item in question and the **dwAfterCount** member contains the number of items that appear in the list after to the item in question.</span></span> <span data-ttu-id="fbb1b-183">Ces deux comptes excluent l’élément lui-même. par conséquent, la définition de **dwBeforeCount** sur 10 et **dwAfterCount** sur 10 entraîne un total de 21 éléments retournés.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-183">Both of these counts exclude the item itself, so setting **dwBeforeCount** to 10 and **dwAfterCount** to 10 will result in a total of 21 items returned.</span></span> <span data-ttu-id="fbb1b-184">Cette option permet de mettre en cache les résultats de la recherche côté client.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-184">This option enables caching the search results on the client side.</span></span>

## <a name="searching-by-string"></a><span data-ttu-id="fbb1b-185">Recherche par chaîne</span><span class="sxs-lookup"><span data-stu-id="fbb1b-185">Searching by String</span></span>

<span data-ttu-id="fbb1b-186">Il est également possible d’utiliser une recherche VLV pour rechercher des éléments qui ont un attribut de chaîne dont la valeur correspond à tout ou partie d’une chaîne sans avoir à récupérer tous les éléments.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-186">It is also possible to use a VLV search to find items that have a string attribute whose value matches all or part of a string without having to retrieve all items.</span></span> <span data-ttu-id="fbb1b-187">La correspondance de chaînes est exécutée par rapport à l’attribut spécifié dans [**la structure de \_ Tri des publicités de**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) la préférence de recherche **\_ SEARCHPREF \_ \_ de publicités** .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-187">The string matching is performed against the attribute specified in the [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure of the **ADS\_SEARCHPREF\_SORT\_ON** search preference.</span></span>

<span data-ttu-id="fbb1b-188">**Pour rechercher un élément particulier par chaîne, procédez comme suit.**</span><span class="sxs-lookup"><span data-stu-id="fbb1b-188">**To search for a particular item by string, perform the following steps.**</span></span>

1.  <span data-ttu-id="fbb1b-189">Remplissez une [**structure \_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) avec les valeurs suivantes.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-189">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with the following values.</span></span> <span data-ttu-id="fbb1b-190">Les membres supplémentaires de la structure doivent être définis sur zéro ou **null**.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-190">Additional members of the structure should be set to zero or **NULL**.</span></span>

    -   <span data-ttu-id="fbb1b-191">Définissez le membre **pszTarget** sur un pointeur désignant une chaîne terminée par le caractère null qui contient la chaîne à rechercher.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-191">Set the **pszTarget** member to a pointer to a NULL-terminated string that contains the string to search for.</span></span>
    -   <span data-ttu-id="fbb1b-192">Définissez le membre **lpContextID** sur l’adresse de la copie de la mémoire tampon de l’ID de contexte et **dwContextIDLength** sur la longueur, en octets, de la mémoire tampon de l’ID de contexte.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-192">Set the **lpContextID** member to the address of the copy of the context ID buffer and the **dwContextIDLength** to the length, in bytes, of the context ID buffer.</span></span> <span data-ttu-id="fbb1b-193">Si aucun ID de contexte n’a été enregistré, les deux membres doivent avoir la valeur zéro ou avoir la **valeur null**.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-193">If no context ID has been saved, both of the these members should be zero or **NULL**.</span></span>

2.  <span data-ttu-id="fbb1b-194">Définissez les préférences de recherche comme indiqué dans les étapes 2 à 5 de la procédure obtention du nombre d’éléments.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-194">Set the search preferences as shown in Steps 2 through 5 of the Obtaining the Number of Items procedure.</span></span>
3.  <span data-ttu-id="fbb1b-195">Effectuez la recherche avec [**IDirectorySearch :: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="fbb1b-195">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
4.  <span data-ttu-id="fbb1b-196">Récupérez la première ligne de résultats en appelant [**IDirectorySearch :: GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="fbb1b-196">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
5.  <span data-ttu-id="fbb1b-197">Appelez [**IDirectorySearch :: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) avec le nom de l’attribut à récupérer pour obtenir les données réelles de l’élément demandé.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-197">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the name of the attribute to retrieve to get the actual data for the requested item.</span></span>
6.  <span data-ttu-id="fbb1b-198">Appelez [**IDirectorySearch :: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) avec **la \_ \_ réponse VLV ADS** pour obtenir les métadonnées de recherche VLV.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-198">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
7.  <span data-ttu-id="fbb1b-199">Cast du **pADsValues->providerspecific. lpValue** de la structure de [**\_ \_ colonne de recherche ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) en pointeur de structure [**\_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="fbb1b-199">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span>
8.  <span data-ttu-id="fbb1b-200">Effectuez une copie des données **lpContextID** et conservez-les pour la prochaine recherche VLV.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-200">Make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span> <span data-ttu-id="fbb1b-201">Si nécessaire, le membre **dwOffset** contient l’index de base un du premier élément dont l’attribut de chaîne commence par la valeur spécifiée dans **pszTarget**.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-201">If required, the **dwOffset** member contains the one-based index of the first item whose string attribute begins with the value specified in **pszTarget**.</span></span>

<span data-ttu-id="fbb1b-202">La fonction exemple [**GetVLVItemsByString**](example-code-for-using-a-vlv-search.md) montre comment procéder.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-202">The [**GetVLVItemsByString**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

<span data-ttu-id="fbb1b-203">De même que la recherche par index, il est également possible de récupérer plusieurs lignes de données à l’aide d’un seul appel de recherche.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-203">Similarly to searching by index, it is also possible to retrieve more than one row of data with a single search call.</span></span> <span data-ttu-id="fbb1b-204">Cela s’effectue de la même manière en définissant les membres **dwBeforeCount** et **dwAfterCount** de la structure [**\_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) de manière appropriée.</span><span class="sxs-lookup"><span data-stu-id="fbb1b-204">This is accomplished in the same manner by setting the **dwBeforeCount** and **dwAfterCount** members of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure appropriately.</span></span>

 

 