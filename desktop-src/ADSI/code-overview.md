---
title: Vue d’ensemble du code
description: La figure suivante est une représentation conceptuelle des blocs de code nécessaires pour implémenter le composant fournisseur d’exemples ADSI.
ms.assetid: b353c2d9-ef86-4e4c-ac00-4756fc9ec57d
ms.tgt_platform: multiple
keywords:
- Vue d’ensemble du code AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e99a4974ac97488fc051ea80dbde7a8a83fa329e
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/21/2020
ms.locfileid: "104031860"
---
# <a name="code-overview"></a><span data-ttu-id="6c942-104">Vue d’ensemble du code</span><span class="sxs-lookup"><span data-stu-id="6c942-104">Code Overview</span></span>

<span data-ttu-id="6c942-105">La figure suivante est une représentation conceptuelle des blocs de code nécessaires pour implémenter le composant fournisseur d’exemples ADSI.</span><span class="sxs-lookup"><span data-stu-id="6c942-105">The following figure is a conceptual representation of the blocks of code necessary to implement the ADSI example provider component.</span></span> <span data-ttu-id="6c942-106">Chaque section est décrite dans la figure suivante.</span><span class="sxs-lookup"><span data-stu-id="6c942-106">Each section is described in the following figure.</span></span> <span data-ttu-id="6c942-107">Les programmeurs COM expérimentés peuvent trouver qu’il s’agit d’une vue d’ensemble appropriée du composant de l’exemple de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="6c942-107">Experienced COM programmers may find this is to be a suitable overview of the example provider component.</span></span> <span data-ttu-id="6c942-108">Pour plus d’informations, consultez [Détails du code](code-details.md).</span><span class="sxs-lookup"><span data-stu-id="6c942-108">For more information, see [Code Details](code-details.md).</span></span>

![exemple d’implémentation de fournisseur](images/dssmco.png)

<span data-ttu-id="6c942-110">Les éléments numérotés suivants correspondent à des éléments de bloc dans la figure.</span><span class="sxs-lookup"><span data-stu-id="6c942-110">The following numbered items correspond to block elements in the figure.</span></span>

1.  <span data-ttu-id="6c942-111">Chargement de la DLL (LibMain. cpp, Guid. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-111">Loading the DLL (Libmain.cpp, Guid.cpp).</span></span> <span data-ttu-id="6c942-112">Point d’entrée de la DLL.</span><span class="sxs-lookup"><span data-stu-id="6c942-112">The entry point for the DLL.</span></span> <span data-ttu-id="6c942-113">Définitions d’objets statiques de fabrique de classes pour les deux objets de fournisseur : GUID. cpp contient les définitions CLSID pour les implémentations des différents objets de composant de fournisseur d’exemple.</span><span class="sxs-lookup"><span data-stu-id="6c942-113">Class factory static object definitions for the two provider objects: Guid.cpp contains the CLSID definitions for the implementations of the various Example provider component objects.</span></span>
2.  <span data-ttu-id="6c942-114">Code de création et de fabrique de classe de l’objet fournisseur (Cprovcf. cpp, Cprov. cpp, stdfact. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-114">Provider object class factory and creation code (Cprovcf.cpp, Cprov.cpp, Stdfact.cpp).</span></span> <span data-ttu-id="6c942-115">L’objet fournisseur est l’objet qui prend en charge [**IParseDisplayName**](/windows/win32/api/oleidl/nn-oleidl-iparsedisplayname) pendant les opérations de liaison de moniker, comme indiqué dans recherche et liaison dans le composant de fournisseur d’exemple.</span><span class="sxs-lookup"><span data-stu-id="6c942-115">The provider object is the object that supports [**IParseDisplayName**](/windows/win32/api/oleidl/nn-oleidl-iparsedisplayname) during the moniker binding operations as discussed in Finding and Binding in the Example Provider Component.</span></span>
3.  <span data-ttu-id="6c942-116">Liaison à un objet (Getobj. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-116">Binding to an object (Getobj.cpp).</span></span> <span data-ttu-id="6c942-117">Ce code appelle l’analyseur pour vérifier que l’ADsPath donné est syntaxiquement correct, puis effectue tout mappage nécessaire à partir de l’ADsPath vers le chemin d’accès du service d’annuaire natif pour l’élément en cours de création en tant qu’objet Active Directory.</span><span class="sxs-lookup"><span data-stu-id="6c942-117">This code calls the parser to check that the given ADsPath is syntactically correct, and then performs any necessary mapping from the ADsPath to the native directory service path for the item being created as an Active Directory object.</span></span> <span data-ttu-id="6c942-118">Il recherche la définition de schéma pour ce type d’objet et remplit les propriétés obligatoires.</span><span class="sxs-lookup"><span data-stu-id="6c942-118">It looks up the schema definition for this type of object and fills in the mandatory properties.</span></span> <span data-ttu-id="6c942-119">Après la création de l’objet Active Directory, un pointeur d’interface vers [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) est récupéré pour l’appelant.</span><span class="sxs-lookup"><span data-stu-id="6c942-119">After creating the Active Directory object, an interface pointer to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) is retrieved for the caller.</span></span>
4.  <span data-ttu-id="6c942-120">Analyseur pour l’espace de noms du fournisseur (Parse. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-120">Parser for the provider namespace (Parse.cpp).</span></span> <span data-ttu-id="6c942-121">Il s’agit du code appelé par l’élément 3.</span><span class="sxs-lookup"><span data-stu-id="6c942-121">This is the code invoked by item 3.</span></span> <span data-ttu-id="6c942-122">L’analyseur vérifie que la chaîne ADsPath transmise est correcte syntaxiquement pour son propre espace de noms.</span><span class="sxs-lookup"><span data-stu-id="6c942-122">The parser verifies that the ADsPath string passed in is syntactically correct for its own namespace.</span></span>
5.  <span data-ttu-id="6c942-123">Fabrique de classe, création et énumération pour l’objet espace de noms (Cnamcf. cpp, Cnamesp. cpp, Cenumns. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-123">Class factory, creation, and enumeration for the namespace object (Cnamcf.cpp, Cnamesp.cpp, Cenumns.cpp).</span></span> <span data-ttu-id="6c942-124">L’objet Namespace est un objet conteneur qui peut être énuméré pour rechercher tous les objets de nœud racine pour cet espace de noms.</span><span class="sxs-lookup"><span data-stu-id="6c942-124">The namespace object is a container object that can be enumerated to find all the root node objects for this namespace.</span></span>
6.  <span data-ttu-id="6c942-125">La fabrique de classe et le code de création pour un objet Active Directory générique, et la fabrique de classe, le code de création et d’énumération pour un objet conteneur ADs générique (Cgenobj. cpp, Cenumobj. cpp, Common. cpp, Core. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-125">Class factory and creation code for a generic Active Directory object, and class factory, creation and enumeration code for a generic ADs container object (Cgenobj.cpp, Cenumobj.cpp, Common.cpp, Core.cpp).</span></span> <span data-ttu-id="6c942-126">Ce code est exécuté lorsqu’un objet Active Directory est créé.</span><span class="sxs-lookup"><span data-stu-id="6c942-126">This code is executed when an Active Directory object is created.</span></span>
7.  <span data-ttu-id="6c942-127">Filtrage et énumération des VARIANTs (Cenumvar. cpp, Object. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-127">Filtering and enumerating VARIANTs (Cenumvar.cpp, Object.cpp).</span></span> <span data-ttu-id="6c942-128">Quand une collection d’éléments VARIANT d’un même type est gérée dans ADSI, ce code est utilisé.</span><span class="sxs-lookup"><span data-stu-id="6c942-128">When a collection of VARIANT elements of a single type are managed in within ADSI, this code is used.</span></span>
8.  <span data-ttu-id="6c942-129">Globals (Globals. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-129">Globals (Globals.cpp).</span></span> <span data-ttu-id="6c942-130">Les mots clés d’espace de noms, les structures de mappage de syntaxe des formats de données natifs au type VARIANT Automation ADs sont tous définis ici.</span><span class="sxs-lookup"><span data-stu-id="6c942-130">Namespace keywords, syntax mapping structures from native data formats to the ADs Automation VARIANT type are all defined here.</span></span>
9.  <span data-ttu-id="6c942-131">Marshaling/démarshaling de données (Pack. cpp, Property. cpp, Smpoper. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-131">Marshaling/unmarshaling data (Pack.cpp, Property.cpp, Smpoper.cpp).</span></span> <span data-ttu-id="6c942-132">La conversion des formats de données natifs vers l’ensemble pris en charge de types VARIANT Automation se produit lorsque les propriétés d’un objet sont chargées dans le cache de propriétés.</span><span class="sxs-lookup"><span data-stu-id="6c942-132">Conversion from native data formats to the supported set of Automation VARIANT types occurs when properties of an object are loaded into the property cache.</span></span> <span data-ttu-id="6c942-133">Une autre gestion spéciale des données doit être effectuée lorsque des structures avec des pointeurs sont copiées, supprimées ou déplacées en mémoire.</span><span class="sxs-lookup"><span data-stu-id="6c942-133">Other special handling for data must be performed when structures with pointers are copied, deleted, or moved in memory.</span></span>
10. <span data-ttu-id="6c942-134">Cache de propriétés (cProps. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-134">Property cache (Cprops.cpp).</span></span> <span data-ttu-id="6c942-135">La mise en cache des propriétés est une fonctionnalité de l’environnement ADSI.</span><span class="sxs-lookup"><span data-stu-id="6c942-135">Caching properties is a feature of the ADSI environment.</span></span> <span data-ttu-id="6c942-136">Les méthodes [**IADs :: GetInfo**](/windows/desktop/api/Iads/nf-iads-iads-getinfo), [**IADs :: GetInfoEx**](/windows/desktop/api/Iads/nf-iads-iads-getinfoex)et [**IADs :: setinfo**](/windows/desktop/api/Iads/nf-iads-iads-setinfo) agissent sur le cache de propriétés.</span><span class="sxs-lookup"><span data-stu-id="6c942-136">The [**IADs::GetInfo**](/windows/desktop/api/Iads/nf-iads-iads-getinfo), [**IADs::GetInfoEx**](/windows/desktop/api/Iads/nf-iads-iads-getinfoex), and [**IADs::SetInfo**](/windows/desktop/api/Iads/nf-iads-iads-setinfo) methods act on the property cache.</span></span>
11. <span data-ttu-id="6c942-137">Gestion de la mémoire (Memory. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-137">Memory management (Memory.cpp).</span></span> <span data-ttu-id="6c942-138">L’utilisation d’un ensemble de fonctions mémoire pour allouer et libérer de la mémoire permet à l’exemple de composant fournisseur d’effectuer le suivi de l’utilisation de la mémoire et d’arrêter les fuites de mémoire.</span><span class="sxs-lookup"><span data-stu-id="6c942-138">Using one set of memory functions to allocate and free memory allows the example provider component to track memory use and stop memory leaks.</span></span>
12. <span data-ttu-id="6c942-139">Objets de schéma et gestion (Cschobj. cpp, Cprpobj. cpp, Cclsobj. cpp, Cenumsch. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-139">Schema objects and management (Cschobj.cpp, Cprpobj.cpp, Cclsobj.cpp, Cenumsch.cpp).</span></span> <span data-ttu-id="6c942-140">Cela comprend des routines pour créer, gérer et énumérer les objets de schéma.</span><span class="sxs-lookup"><span data-stu-id="6c942-140">This includes routines to create, manage, and enumerate the schema objects.</span></span> <span data-ttu-id="6c942-141">Cela comprend les objets de classe de schéma, les objets de propriété et les objets de syntaxe, en plus de pouvoir énumérer l’objet conteneur de classe de schéma.</span><span class="sxs-lookup"><span data-stu-id="6c942-141">This includes schema class objects, property objects, and syntax objects, in addition to being able to enumerate the schema class container object.</span></span>
13. <span data-ttu-id="6c942-142">Appels spécifiques au système d’exploitation (RegDSAPI. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-142">Operating-system specific calls (RegDSAPI.cpp).</span></span> <span data-ttu-id="6c942-143">Cela comprend tous les appels qui font référence au système d’exploitation natif.</span><span class="sxs-lookup"><span data-stu-id="6c942-143">This includes all calls that reference the native operating system.</span></span> <span data-ttu-id="6c942-144">Parmi d’autres fonctions, elles incluent des fonctions d’ouverture, de fermeture, de lecture et de modification d’objets, ainsi que ceux qui accèdent au schéma et aux données de propriété.</span><span class="sxs-lookup"><span data-stu-id="6c942-144">Among other functions, they include functions opening, closing, reading, and modifying objects as well as those accessing the schema and property data.</span></span> <span data-ttu-id="6c942-145">L’exemple de composant fournisseur s’est produit pour simuler une hiérarchie de répertoires à l’aide du Registre.</span><span class="sxs-lookup"><span data-stu-id="6c942-145">The example provider component happened to simulate a directory hierarchy by using the registry.</span></span> <span data-ttu-id="6c942-146">Seuls les noms de fonctions doivent être très intéressants pour un writer de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="6c942-146">Only function names should be of much interest to a provider writer.</span></span>
14. <span data-ttu-id="6c942-147">Implémentation [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) (Cdispmgr. cpp).</span><span class="sxs-lookup"><span data-stu-id="6c942-147">[**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) implementation (Cdispmgr.cpp).</span></span> <span data-ttu-id="6c942-148">Ce code accède aux données de la bibliothèque de types pour permettre aux méthodes d’interface d’être appelées de manière compatible Automation.</span><span class="sxs-lookup"><span data-stu-id="6c942-148">This code accesses the type library data to allow interface methods to be invoked in an Automation-compatible way.</span></span>

 

 