---
title: Interaction avec IMAPi
description: Les étapes suivantes décrivent une interaction classique entre une application et IMAPi.
ms.assetid: e57a86c4-7e27-40cf-a9c1-081b3f20d9d9
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3e68bee24cfe0724ed14d439b0789f5023338853
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103940035"
---
# <a name="interacting-with-imapi"></a><span data-ttu-id="d49d6-103">Interaction avec IMAPi</span><span class="sxs-lookup"><span data-stu-id="d49d6-103">Interacting with IMAPI</span></span>

<span data-ttu-id="d49d6-104">Les étapes suivantes décrivent une interaction classique entre une application et IMAPi.</span><span class="sxs-lookup"><span data-stu-id="d49d6-104">The following steps describe a typical interaction between an application and IMAPI.</span></span>

1.  <span data-ttu-id="d49d6-105">Créez une instance de **MSDiscMasterObj** (à l’aide de **CoCreateInstance**, de pointeurs intelligents d’une importation, etc.) et demandez l’interface [**IDiscMaster**](/windows/desktop/api/Imapi/nn-imapi-idiscmaster) .</span><span class="sxs-lookup"><span data-stu-id="d49d6-105">Create an instance of the **MSDiscMasterObj** (using **CoCreateInstance**, smart pointers from an import, and so on) and request the [**IDiscMaster**](/windows/desktop/api/Imapi/nn-imapi-idiscmaster) interface.</span></span>
2.  <span data-ttu-id="d49d6-106">Pour obtenir l’accès à IMAPi, appelez [**IDiscMaster :: Open**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-open).</span><span class="sxs-lookup"><span data-stu-id="d49d6-106">Acquire access to IMAPI by calling [**IDiscMaster::Open**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-open).</span></span> <span data-ttu-id="d49d6-107">Si cet appel a échoué, l’application dispose d’un accès complet à toutes les interfaces et méthodes implémentées dans **MSDiscMasterObj**.</span><span class="sxs-lookup"><span data-stu-id="d49d6-107">If this call succeeds, the application has full access to all the interfaces and methods implemented in **MSDiscMasterObj**.</span></span>
3.  <span data-ttu-id="d49d6-108">Récupérez l’énumérateur de format de disque maître à l’aide de [**EnumDiscMasterFormats**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-enumdiscmasterformats).</span><span class="sxs-lookup"><span data-stu-id="d49d6-108">Retrieve the disc master format enumerator using [**EnumDiscMasterFormats**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-enumdiscmasterformats).</span></span> <span data-ttu-id="d49d6-109">Énumérez l’ensemble de formats pris en charge par l’objet maître Disc, puis sélectionnez le format actif.</span><span class="sxs-lookup"><span data-stu-id="d49d6-109">Enumerate the set of formats that the disc master object supports, then select the active format.</span></span> <span data-ttu-id="d49d6-110">Les formats retournés à partir de l’énumérateur sont les IID des interfaces pour [**IJolietDiscMaster**](/windows/desktop/api/Imapi/nn-imapi-ijolietdiscmaster) et [**IRedbookDiscMaster**](/windows/desktop/api/Imapi/nn-imapi-iredbookdiscmaster).</span><span class="sxs-lookup"><span data-stu-id="d49d6-110">The formats returned from the enumerator are the IIDs of the interfaces for [**IJolietDiscMaster**](/windows/desktop/api/Imapi/nn-imapi-ijolietdiscmaster) and [**IRedbookDiscMaster**](/windows/desktop/api/Imapi/nn-imapi-iredbookdiscmaster).</span></span>
4.  <span data-ttu-id="d49d6-111">Récupérez l’énumérateur de l’enregistreur de disque à l’aide de [**EnumDiscRecorders**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-enumdiscrecorders).</span><span class="sxs-lookup"><span data-stu-id="d49d6-111">Retrieve the disc recorder enumerator using [**EnumDiscRecorders**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-enumdiscrecorders).</span></span> <span data-ttu-id="d49d6-112">Énumérez la liste des enregistreurs de disques pris en charge (spécifiques au format actif), puis sélectionnez l’enregistreur actif.</span><span class="sxs-lookup"><span data-stu-id="d49d6-112">Enumerate the list of supported disc recorders (specific to the active format), then select the active recorder.</span></span> <span data-ttu-id="d49d6-113">L’interface [**IDiscRecorder**](/windows/desktop/api/Imapi/nn-imapi-idiscrecorder) représente un appareil physique.</span><span class="sxs-lookup"><span data-stu-id="d49d6-113">The [**IDiscRecorder**](/windows/desktop/api/Imapi/nn-imapi-idiscrecorder) interface represents a physical device.</span></span>
5.  <span data-ttu-id="d49d6-114">Utilisez [**IDiscMaster ::P rogressadvise**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-progressadvise) pour vous inscrire pour les rappels de progression.</span><span class="sxs-lookup"><span data-stu-id="d49d6-114">Use [**IDiscMaster::ProgressAdvise**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-progressadvise) to register for progress callbacks.</span></span>
6.  <span data-ttu-id="d49d6-115">Utilisez l’interface pour le format sélectionné pour générer le contenu.</span><span class="sxs-lookup"><span data-stu-id="d49d6-115">Use the interface for the selected format to build up content.</span></span> <span data-ttu-id="d49d6-116">Les builds de contenu sont incrémentielles, de sorte que les pistes ou le contenu du dossier peuvent être ajoutés à un disque par morceau.</span><span class="sxs-lookup"><span data-stu-id="d49d6-116">Content builds incrementally, so tracks or folder contents can be added to a disc piece by piece.</span></span> <span data-ttu-id="d49d6-117">La création de ce contenu est appelée *intermédiaire d’une image*.</span><span class="sxs-lookup"><span data-stu-id="d49d6-117">Building up this content is called *staging an image*.</span></span> <span data-ttu-id="d49d6-118">Le contenu de l’image intermédiaire ne peut pas être supprimé de façon incrémentielle (vous ne pouvez pas supprimer une piste qui a été ajoutée), mais il est possible de supprimer le contenu d’une image intermédiaire pour que la mise en lots puisse recommencer.</span><span class="sxs-lookup"><span data-stu-id="d49d6-118">The contents of the staged image cannot be incrementally deleted (you cannot remove a track that has been added), but it is possible to clear the contents of a staged image so that staging can start again.</span></span> <span data-ttu-id="d49d6-119">Utilisez [**IDiscMaster :: ClearFormatContent**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-clearformatcontent) pour redémarrer la mise en lots.</span><span class="sxs-lookup"><span data-stu-id="d49d6-119">Use [**IDiscMaster::ClearFormatContent**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-clearformatcontent) to restart staging.</span></span>

<span data-ttu-id="d49d6-120">**Pour l’audio :  **</span><span class="sxs-lookup"><span data-stu-id="d49d6-120">**For Audio:  **</span></span>

1.  <span data-ttu-id="d49d6-121">Utilisez [**IRedbookDiscMaster :: CreateAudioTrack**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-createaudiotrack) pour indiquer qu’une nouvelle piste audio est démarrée sur le disque.</span><span class="sxs-lookup"><span data-stu-id="d49d6-121">Use [**IRedbookDiscMaster::CreateAudioTrack**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-createaudiotrack) to indicate a new audio track is being started on the disc.</span></span>
2.  <span data-ttu-id="d49d6-122">Utilisez [**IRedbookDiscMaster :: AddAudioTrackBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-addaudiotrackblocks) pour ajouter des données audio brutes à une piste. L’application peut utiliser [**GetAvailableAudioTrackBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-getavailableaudiotrackblocks), [**GetTotalAudioBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-gettotalaudioblocks)et [**GetUsedAudioBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-getusedaudioblocks) pour récupérer des informations statistiques.</span><span class="sxs-lookup"><span data-stu-id="d49d6-122">Use [**IRedbookDiscMaster::AddAudioTrackBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-addaudiotrackblocks) to add raw audio data to a track. The application can use [**GetAvailableAudioTrackBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-getavailableaudiotrackblocks), [**GetTotalAudioBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-gettotalaudioblocks), and [**GetUsedAudioBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-getusedaudioblocks) to retrieve statistical information.</span></span>
3.  <span data-ttu-id="d49d6-123">Utilisez [**IRedbookDiscMaster :: CloseAudioTrack**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-closeaudiotrack) pour fermer une piste audio.</span><span class="sxs-lookup"><span data-stu-id="d49d6-123">Use [**IRedbookDiscMaster::CloseAudioTrack**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-closeaudiotrack) to close an audio track.</span></span>
4.  <span data-ttu-id="d49d6-124">Répétez les étapes 1-3 jusqu’à ce que l’espace soit insuffisant ou que toutes les pistes audio aient été écrites.</span><span class="sxs-lookup"><span data-stu-id="d49d6-124">Repeat steps 1-3 until out of space or all audio tracks have been written.</span></span>

<span data-ttu-id="d49d6-125">**Pour les données :  **</span><span class="sxs-lookup"><span data-stu-id="d49d6-125">**For Data:  **</span></span>

1.  <span data-ttu-id="d49d6-126">Utilisez [**IJolietDiscMaster :: AddData**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-adddata) pour ajouter le contenu d’un dossier à l’image.</span><span class="sxs-lookup"><span data-stu-id="d49d6-126">Use [**IJolietDiscMaster::AddData**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-adddata) to add the contents of a folder to the image.</span></span> <span data-ttu-id="d49d6-127">Les éléments d’un dossier sont placés à la racine du fichier image.</span><span class="sxs-lookup"><span data-stu-id="d49d6-127">The items within a folder are placed in the root of the image file.</span></span> <span data-ttu-id="d49d6-128">Utilisez [**GetTotalDataBlocks**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-gettotaldatablocks) et [**GetUsedDataBlocks**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-getuseddatablocks) pour récupérer des informations statistiques.</span><span class="sxs-lookup"><span data-stu-id="d49d6-128">Use [**GetTotalDataBlocks**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-gettotaldatablocks) and [**GetUsedDataBlocks**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-getuseddatablocks) to retrieve statistical information.</span></span>
2.  <span data-ttu-id="d49d6-129">Répétez l’étape ci-dessus jusqu’à ce que l’espace soit insuffisant ou que toutes les données aient été ajoutées.</span><span class="sxs-lookup"><span data-stu-id="d49d6-129">Repeat the above step until out of space or all data has been added.</span></span>

<span data-ttu-id="d49d6-130">**Pour tous les disques :  **</span><span class="sxs-lookup"><span data-stu-id="d49d6-130">**For All Discs:  **</span></span>

1.  <span data-ttu-id="d49d6-131">Utilisez [**IDiscMaster :: RecordDisc**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-recorddisc) pour enregistrer le disque.</span><span class="sxs-lookup"><span data-stu-id="d49d6-131">Use [**IDiscMaster::RecordDisc**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-recorddisc) to record the disc.</span></span>
2.  <span data-ttu-id="d49d6-132">Fermez la session IMAPi à l’aide de [**IDiscMaster :: Close**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-close).</span><span class="sxs-lookup"><span data-stu-id="d49d6-132">Close the IMAPI session using [**IDiscMaster::Close**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-close).</span></span> <span data-ttu-id="d49d6-133">La fermeture de la session efface le contenu de la dissimulation de disque.</span><span class="sxs-lookup"><span data-stu-id="d49d6-133">Closing the session clears the contents of the disc stash.</span></span>

 

 




