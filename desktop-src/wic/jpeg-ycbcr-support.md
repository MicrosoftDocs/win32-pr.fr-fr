---
description: À partir de Windows 8.1, le codec Windows Imaging Component (WIC) JPEG prend en charge la lecture et l’écriture des données d’image dans sa forme YCbCr native.
ms.assetid: 50B89A96-72E8-4771-9109-207F4CDD06CB
title: Prise en charge d’JPEG YCbCr
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b6a8f05fe55e724a12513f24fc7401d277ebf097
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103952064"
---
# <a name="jpeg-ycbcr-support"></a><span data-ttu-id="3445d-103">Prise en charge d’JPEG YCbCr</span><span class="sxs-lookup"><span data-stu-id="3445d-103">JPEG YCbCr Support</span></span>

<span data-ttu-id="3445d-104">À partir de Windows 8.1, le codec [Windows Imaging Component (WIC)](-wic-about-windows-imaging-codec.md) JPEG prend en charge la lecture et l’écriture des données d’image dans son format natif YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-104">Starting with Windows 8.1, the [Windows Imaging Component (WIC)](-wic-about-windows-imaging-codec.md) JPEG codec supports reading and writing image data in its native YC<sub>b</sub>C<sub>r</sub> form.</span></span> <span data-ttu-id="3445d-105">La prise en charge de WIC YC<sub>b</sub>c<sub>r</sub> peut être utilisée conjointement avec [Direct2D](../direct2d/direct2d-portal.md) pour restituer les données de pixels YC<sub>b</sub>c<sub>r</sub> avec un effet d’image.</span><span class="sxs-lookup"><span data-stu-id="3445d-105">WIC YC<sub>b</sub>C<sub>r</sub> support can be used in conjunction with [Direct2D](../direct2d/direct2d-portal.md) to render YC<sub>b</sub>C<sub>r</sub> pixel data with an image effect.</span></span> <span data-ttu-id="3445d-106">En outre, le codec WIC JPEG peut consommer des données de pixels YC<sub>b</sub>C<sub>r</sub> produites par certains pilotes d’appareil photo via Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="3445d-106">In addition, the WIC JPEG codec can consume YC<sub>b</sub>C<sub>r</sub> pixel data produced by certain camera drivers via Media Foundation.</span></span>

<span data-ttu-id="3445d-107">Les données de pixels YC<sub>b</sub>C<sub>r</sub> consomment beaucoup moins de mémoire que les formats de pixel standard BGRA.</span><span class="sxs-lookup"><span data-stu-id="3445d-107">YC<sub>b</sub>C<sub>r</sub> pixel data consumes significantly less memory than standard BGRA pixel formats.</span></span> <span data-ttu-id="3445d-108">En outre, l’accès aux données YC<sub>b</sub>C<sub>r</sub> vous permet de décharger certaines étapes du pipeline de décodage/codage JPEG vers Direct2D, ce qui accélère l’accélération du GPU.</span><span class="sxs-lookup"><span data-stu-id="3445d-108">In addition, accessing YC<sub>b</sub>C<sub>r</sub> data allows you to offload some stages of the JPEG decode/encode pipeline to Direct2D which is GPU accelerated.</span></span> <span data-ttu-id="3445d-109">En utilisant YC<sub>b</sub>C<sub>r</sub>, votre application peut réduire la consommation de mémoire JPEG et les temps de chargement pour les mêmes images de taille et de qualité.</span><span class="sxs-lookup"><span data-stu-id="3445d-109">By using YC<sub>b</sub>C<sub>r</sub>, your app can reduce JPEG memory consumption and load times for the same size and quality images.</span></span> <span data-ttu-id="3445d-110">Ou bien, votre application peut utiliser plus de images JPEG de résolution plus élevée sans subir de pénalités en matière de performances.</span><span class="sxs-lookup"><span data-stu-id="3445d-110">Or, your app can use more, higher resolution JPEG images without suffering from performance penalties.</span></span>

<span data-ttu-id="3445d-111">Cette rubrique décrit le fonctionnement<sub>des données de</sub> l’YC<sub>b</sub>C et comment l’utiliser dans WIC et Direct2D.</span><span class="sxs-lookup"><span data-stu-id="3445d-111">This topic describes how YC<sub>b</sub>C<sub>r</sub> data works and how to use it in WIC and Direct2D.</span></span>

-   [<span data-ttu-id="3445d-112">À propos des données JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-112">About JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>](#about-jpeg-ycbcr-data)
    -   [<span data-ttu-id="3445d-113">Modèle de couleurs YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-113">YC<sub>b</sub>C<sub>r</sub> Color Model</span></span>](#ycbcr-color-model)
    -   [<span data-ttu-id="3445d-114">Dispositions de mémoire planaires et entrelacées</span><span class="sxs-lookup"><span data-stu-id="3445d-114">Planar Versus Interleaved Memory Layouts</span></span>](#planar-versus-interleaved-memory-layouts)
    -   [<span data-ttu-id="3445d-115">Sous-échantillonnage de chrominance</span><span class="sxs-lookup"><span data-stu-id="3445d-115">Chroma Subsampling</span></span>](#chroma-subsampling)
    -   [<span data-ttu-id="3445d-116">Utilisation JPEG de YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-116">JPEG Usage of YC<sub>b</sub>C<sub>r</sub></span></span>](#jpeg-usage-of-ycbcr)
-   [<span data-ttu-id="3445d-117">Utilisation de données JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-117">Using JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>](#using-jpeg-ycbcr-data)
    -   [<span data-ttu-id="3445d-118">Utilisation d’images JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-118">Using YC<sub>b</sub>C<sub>r</sub> JPEG images</span></span>](#using-ycbcr-jpeg-images)
    -   [<span data-ttu-id="3445d-119">API du composant de création d’images Windows</span><span class="sxs-lookup"><span data-stu-id="3445d-119">Windows Imaging Component APIs</span></span>](#windows-imaging-component-apis)
    -   [<span data-ttu-id="3445d-120">API Direct2D</span><span class="sxs-lookup"><span data-stu-id="3445d-120">Direct2D APIs</span></span>](#direct2d-apis)
    -   [<span data-ttu-id="3445d-121">Détermination de la prise en charge de la configuration YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-121">Determining if the YC<sub>b</sub>C<sub>r</sub> Configuration is Supported</span></span>](#determining-if-the-ycbcr-configuration-is-supported)
    -   [<span data-ttu-id="3445d-122">Décodage des données de pixels YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-122">Decoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>](#decoding-ycbcr-pixel-data)
    -   [<span data-ttu-id="3445d-123">Transformation des données de pixels YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-123">Transforming YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>](#transforming-ycbcr-pixel-data)
    -   [<span data-ttu-id="3445d-124">Encodage de données de pixels YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-124">Encoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>](#encoding-ycbcr-pixel-data)
    -   [<span data-ttu-id="3445d-125">Décodage des données de pixels YC<sub>b</sub>C<sub>r</sub> dans Windows 10</span><span class="sxs-lookup"><span data-stu-id="3445d-125">Decoding YC<sub>b</sub>C<sub>r</sub> pixel data in Windows 10</span></span>](#decoding-ycbcr-pixel-data-in-windows-10)
-   [<span data-ttu-id="3445d-126">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="3445d-126">Related topics</span></span>](#related-topics)

## <a name="about-jpeg-ycsubbsubcsubrsub-data"></a><span data-ttu-id="3445d-127">À propos des données JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-127">About JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>

<span data-ttu-id="3445d-128">Cette section explique quelques concepts clés nécessaires pour comprendre le fonctionnement de la prise en charge de l’YC<sub>b</sub>C<sub>r</sub> dans WIC et ses principaux avantages.</span><span class="sxs-lookup"><span data-stu-id="3445d-128">This section explains some key concepts necessary to understand how YC<sub>b</sub>C<sub>r</sub> support in WIC works and its key benefits.</span></span>

### <a name="ycsubbsubcsubrsub-color-model"></a><span data-ttu-id="3445d-129">Modèle de couleurs YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-129">YC<sub>b</sub>C<sub>r</sub> Color Model</span></span>

<span data-ttu-id="3445d-130">Dans Windows 8 et les versions antérieures, WIC prend en charge quatre [modèles de couleurs](-wic-codec-native-pixel-formats.md)différents, les plus courants étant RVB/BGR.</span><span class="sxs-lookup"><span data-stu-id="3445d-130">WIC in Windows 8 and earlier supports four different [color models](-wic-codec-native-pixel-formats.md), the most common of which is RGB/BGR.</span></span> <span data-ttu-id="3445d-131">Ce modèle de couleurs définit les données de couleur à l’aide des composants rouge, vert et bleu. un quatrième composant alpha peut également être utilisé.</span><span class="sxs-lookup"><span data-stu-id="3445d-131">This color model defines color data using red, green and blue components; a fourth alpha component may also be used.</span></span>

<span data-ttu-id="3445d-132">L’image ci-dessous est décomposée en ses composants rouge, vert et bleu.</span><span class="sxs-lookup"><span data-stu-id="3445d-132">Here is an image decomposed into its red, green and blue components.</span></span>

![une image décomposée en ses composants rouge, vert et bleu.](graphics/ycbcr1.png)

<span data-ttu-id="3445d-134">YC<sub>b</sub>C<sub>r</sub> est un autre modèle de couleurs qui définit les données de couleur à l’aide d’un composant de luminance (Y) et de deux composants de chrominance (c<sub>b</sub> et c<sub>r</sub>).</span><span class="sxs-lookup"><span data-stu-id="3445d-134">YC<sub>b</sub>C<sub>r</sub> is an alternate color model that defines color data using a luminance component (Y) and two chrominance components (C<sub>b</sub> and C<sub>r</sub>).</span></span> <span data-ttu-id="3445d-135">Il est couramment utilisé dans les scénarios de création d’images numériques et de vidéo.</span><span class="sxs-lookup"><span data-stu-id="3445d-135">It is commonly used in digital imaging and video scenarios.</span></span> <span data-ttu-id="3445d-136">Le terme YC<sub>b</sub>C<sub>r</sub> est souvent utilisé de façon interchangeable avec YUV, bien que les deux soient techniquement distincts.</span><span class="sxs-lookup"><span data-stu-id="3445d-136">The term YC<sub>b</sub>C<sub>r</sub> is often used interchangeably with YUV, although the two are technically distinct.</span></span>

<span data-ttu-id="3445d-137">Il existe plusieurs variantes de YC<sub>b</sub>C<sub>r</sub> qui diffèrent dans l’espace de couleurs et les définitions de plages dynamiques : WIC prend en charge spécifiquement les données JPEG JFIF YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-137">There are several variations of YC<sub>b</sub>C<sub>r</sub> which differ in color space and dynamic range definitions – WIC specifically supports JPEG JFIF YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="3445d-138">Pour plus d’informations, reportez-vous à la [spécification ITU-T81 JPEG](https://www.w3.org/Graphics/JPEG/itu-t81.pdf).</span><span class="sxs-lookup"><span data-stu-id="3445d-138">For more information, refer to the [JPEG ITU-T81 specification](https://www.w3.org/Graphics/JPEG/itu-t81.pdf).</span></span>

<span data-ttu-id="3445d-139">Voici une image décomposée de ses composants Y, C<sub>b</sub>et c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-139">Here is an image decomposed into its Y, C<sub>b</sub>, and C<sub>r</sub> components.</span></span>

![une image décomposée en ses composants y, CB et CR.](graphics/ycbcr2.png)

### <a name="planar-versus-interleaved-memory-layouts"></a><span data-ttu-id="3445d-141">Dispositions de mémoire planaires et entrelacées</span><span class="sxs-lookup"><span data-stu-id="3445d-141">Planar Versus Interleaved Memory Layouts</span></span>

<span data-ttu-id="3445d-142">Cette section décrit certaines différences entre l’accès et le stockage des données de pixels RVB en<sub></sub>mémoire par rapport aux données<sub>r C r</sub> YC.</span><span class="sxs-lookup"><span data-stu-id="3445d-142">This section describes some differences between accessing and storing RGB pixel data in memory versus YC<sub>b</sub>C<sub>r</sub> data.</span></span>

<span data-ttu-id="3445d-143">Les données de pixels RVB sont généralement stockées à l’aide d’une disposition de mémoire entrelacée.</span><span class="sxs-lookup"><span data-stu-id="3445d-143">RGB pixel data is typically stored using an interleaved memory layout.</span></span> <span data-ttu-id="3445d-144">Cela signifie que les données pour un composant de couleur unique sont entrelacées entre les pixels, et chaque pixel est stocké de façon contiguë en mémoire.</span><span class="sxs-lookup"><span data-stu-id="3445d-144">This means that data for a single color component is interleaved between pixels, and each pixel is stored contiguously in memory.</span></span>

<span data-ttu-id="3445d-145">Voici une figure qui montre les données de pixels RVBA stockées dans une disposition de mémoire entrelacée.</span><span class="sxs-lookup"><span data-stu-id="3445d-145">Here is a figure showing RGBA pixel data stored in an interleaved memory layout.</span></span>

![figure qui montre les données de pixels RVBA stockées dans une disposition de mémoire entrelacée.](graphics/ycbcr3.png)

<span data-ttu-id="3445d-147">Les données YC<sub>b</sub>C<sub>r</sub> sont généralement stockées à l’aide d’une disposition de mémoire planaire.</span><span class="sxs-lookup"><span data-stu-id="3445d-147">YC<sub>b</sub>C<sub>r</sub> data is typically stored using a planar memory layout.</span></span> <span data-ttu-id="3445d-148">Cela signifie que chaque composant de couleur est stocké séparément dans son propre plan contigu, pour un total de trois plans.</span><span class="sxs-lookup"><span data-stu-id="3445d-148">This means that each color component is stored separately in its own contiguous plane, for a total of three planes.</span></span> <span data-ttu-id="3445d-149">Dans une autre configuration courante, les composants C<sub>b</sub> et c<sub>r</sub> sont entrelacés et stockés ensemble, tandis que le composant Y reste dans son propre plan, pour un total de deux plans.</span><span class="sxs-lookup"><span data-stu-id="3445d-149">In another common configuration, the C<sub>b</sub> and C<sub>r</sub> components are interleaved and stored together, while the Y component remains in its own plane, for a total of two planes.</span></span>

<span data-ttu-id="3445d-150">Voici une figure présentant les données<sub>de pixels planaires</sub> Y et entrelacées c<sub>b</sub>c, une disposition courante de<sub></sub>mémoire<sub>r c r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-150">Here is a figure showing planar Y and interleaved C<sub>b</sub>C<sub>r</sub> pixel data, a common YC<sub>b</sub>C<sub>r</sub> memory layout.</span></span>

![Figure présentant les données de pixels planaires y et entrelacées CbCr, une disposition de mémoire YCbCr courante.](graphics/ycbcr4.png)

<span data-ttu-id="3445d-152">Dans WIC et Direct2D, chaque plan de couleur est traité comme son propre objet distinct ( [IWICBitmapSource](-wic-imp-iwicbitmapsource.md) ou [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap)), et collectivement ces plans forment les données de stockage pour une image YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-152">In both WIC and Direct2D, each color plane is treated as its own distinct object (either an [IWICBitmapSource](-wic-imp-iwicbitmapsource.md) or [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap)), and collectively these planes form the backing data for a YC<sub>b</sub>C<sub>r</sub> image.</span></span>

<span data-ttu-id="3445d-153">Alors que WIC prend en charge l’accès aux données YC<sub>b</sub>C<sub>r</sub> dans les configurations à 2 et 3 plans, Direct2D ne prend en charge que le premier (Y et c<sub>b</sub>c<sub>r</sub>).</span><span class="sxs-lookup"><span data-stu-id="3445d-153">While WIC supports accessing YC<sub>b</sub>C<sub>r</sub> data in both the 2 and 3 plane configurations, Direct2D only supports the former (Y and C<sub>b</sub>C<sub>r</sub>).</span></span> <span data-ttu-id="3445d-154">Par conséquent, lors de l’utilisation conjointe de WIC et de Direct2D, vous devez toujours utiliser la configuration à 2 plans YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-154">Therefore, when using WIC and Direct2D together you should always use the 2 plane YC<sub>b</sub>C<sub>r</sub> configuration.</span></span>

### <a name="chroma-subsampling"></a><span data-ttu-id="3445d-155">Sous-échantillonnage de chrominance</span><span class="sxs-lookup"><span data-stu-id="3445d-155">Chroma Subsampling</span></span>

<span data-ttu-id="3445d-156">Le modèle de couleurs YC<sub>b</sub>C<sub>r</sub> est bien adapté aux scénarios de création d’images numériques, car il peut tirer parti de certains aspects du système visuel humain.</span><span class="sxs-lookup"><span data-stu-id="3445d-156">The YC<sub>b</sub>C<sub>r</sub> color model is well suited for digital imaging scenarios because it can take advantage of certain aspects of the human visual system.</span></span> <span data-ttu-id="3445d-157">En particulier, les êtres humains sont plus sensibles aux modifications de luminance (luminosité) d’une image et moins sensibles à la chrominance (couleur).</span><span class="sxs-lookup"><span data-stu-id="3445d-157">In particular, humans are more sensitive to changes in the luminance (brightness) of an image and less sensitive to chrominance (color).</span></span> <span data-ttu-id="3445d-158">En fractionnant les données de couleur en composants de luminance et de chrominance distincts, nous pouvons compresser de manière sélective uniquement les composants de chrominance pour réaliser des économies d’espace avec une perte de qualité minimale.</span><span class="sxs-lookup"><span data-stu-id="3445d-158">By splitting the color data into separate luminance and chrominance components, we can selectively compress just the chrominance components to achieve space savings with a minimal loss in quality.</span></span>

<span data-ttu-id="3445d-159">Une technique pour ce faire est appelée « sous-échantillonnage Chroma ».</span><span class="sxs-lookup"><span data-stu-id="3445d-159">One technique for doing this is called chroma subsampling.</span></span> <span data-ttu-id="3445d-160">Les plans C<sub>b</sub> et c<sub>r</sub> sont sous-échantillonnés (downscaled) dans l’une des dimensions horizontales et verticales (ou les deux).</span><span class="sxs-lookup"><span data-stu-id="3445d-160">The C<sub>b</sub> and C<sub>r</sub> planes are subsampled (downscaled) in one or both of the horizontal and vertical dimensions.</span></span> <span data-ttu-id="3445d-161">Pour des raisons historiques, chaque mode de sous-échantillonnage Chroma est généralement appelé à l’aide d’un ratio J :a: b en trois parties.</span><span class="sxs-lookup"><span data-stu-id="3445d-161">For historical reasons, each chroma subsampling mode is commonly referred to using a three part J:a:b ratio.</span></span>



| <span data-ttu-id="3445d-162">Mode de sous-échantillonnage</span><span class="sxs-lookup"><span data-stu-id="3445d-162">Subsampling mode</span></span> | <span data-ttu-id="3445d-163">Réduire horizontal</span><span class="sxs-lookup"><span data-stu-id="3445d-163">Horizontal downscale</span></span> | <span data-ttu-id="3445d-164">Réduire vertical</span><span class="sxs-lookup"><span data-stu-id="3445d-164">Vertical downscale</span></span> | <span data-ttu-id="3445d-165">Bits par pixel\*</span><span class="sxs-lookup"><span data-stu-id="3445d-165">Bits per pixel\*</span></span> |
|------------------|----------------------|--------------------|------------------|
| <span data-ttu-id="3445d-166">4:4:4</span><span class="sxs-lookup"><span data-stu-id="3445d-166">4:4:4</span></span>            | <span data-ttu-id="3445d-167">1x</span><span class="sxs-lookup"><span data-stu-id="3445d-167">1x</span></span>                   | <span data-ttu-id="3445d-168">1x</span><span class="sxs-lookup"><span data-stu-id="3445d-168">1x</span></span>                 | <span data-ttu-id="3445d-169">24</span><span class="sxs-lookup"><span data-stu-id="3445d-169">24</span></span>               |
| <span data-ttu-id="3445d-170">4:2:2</span><span class="sxs-lookup"><span data-stu-id="3445d-170">4:2:2</span></span>            | <span data-ttu-id="3445d-171">x 2</span><span class="sxs-lookup"><span data-stu-id="3445d-171">2x</span></span>                   | <span data-ttu-id="3445d-172">1x</span><span class="sxs-lookup"><span data-stu-id="3445d-172">1x</span></span>                 | <span data-ttu-id="3445d-173">16</span><span class="sxs-lookup"><span data-stu-id="3445d-173">16</span></span>               |
| <span data-ttu-id="3445d-174">4:4:0</span><span class="sxs-lookup"><span data-stu-id="3445d-174">4:4:0</span></span>            | <span data-ttu-id="3445d-175">1x</span><span class="sxs-lookup"><span data-stu-id="3445d-175">1x</span></span>                   | <span data-ttu-id="3445d-176">x 2</span><span class="sxs-lookup"><span data-stu-id="3445d-176">2x</span></span>                 | <span data-ttu-id="3445d-177">16</span><span class="sxs-lookup"><span data-stu-id="3445d-177">16</span></span>               |
| <span data-ttu-id="3445d-178">4:2:0</span><span class="sxs-lookup"><span data-stu-id="3445d-178">4:2:0</span></span>            | <span data-ttu-id="3445d-179">x 2</span><span class="sxs-lookup"><span data-stu-id="3445d-179">2x</span></span>                   | <span data-ttu-id="3445d-180">x 2</span><span class="sxs-lookup"><span data-stu-id="3445d-180">2x</span></span>                 | <span data-ttu-id="3445d-181">12</span><span class="sxs-lookup"><span data-stu-id="3445d-181">12</span></span>               |



 

<span data-ttu-id="3445d-182">\* Comprend des données Y.</span><span class="sxs-lookup"><span data-stu-id="3445d-182">\* Includes Y data.</span></span>

<span data-ttu-id="3445d-183">Dans le tableau ci-dessus, si vous utilisez YC<sub>b</sub>C<sub>r</sub> pour stocker des données d’image non compressées, vous pouvez réaliser des économies de mémoire de 25 à 62,5% par rapport aux données de 32 bits par pixel RVBA, en fonction du mode de sous-échantillonnage de chrominance utilisé.</span><span class="sxs-lookup"><span data-stu-id="3445d-183">From the above table, if you use YC<sub>b</sub>C<sub>r</sub> to store uncompressed image data you can achieve a memory savings of 25% to 62.5% versus 32 bit per pixel RGBA data, depending on which chroma subsampling mode is used.</span></span>

### <a name="jpeg-usage-of-ycsubbsubcsubrsub"></a><span data-ttu-id="3445d-184">Utilisation JPEG de YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-184">JPEG Usage of YC<sub>b</sub>C<sub>r</sub></span></span>

<span data-ttu-id="3445d-185">À un niveau élevé, le pipeline de décompression JPEG se compose des étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="3445d-185">At a high level, the JPEG decompression pipeline consists of the following stages:</span></span>

1.  <span data-ttu-id="3445d-186">Effectuer une décompression d’entropie (par exemple, Huffman)</span><span class="sxs-lookup"><span data-stu-id="3445d-186">Perform entropy (e.g. Huffman) decompression</span></span>
2.  <span data-ttu-id="3445d-187">Effectuer une DÉQUANTIFICATION</span><span class="sxs-lookup"><span data-stu-id="3445d-187">Perform dequantization</span></span>
3.  <span data-ttu-id="3445d-188">Effectuer une transformation cosinus discrète inverse</span><span class="sxs-lookup"><span data-stu-id="3445d-188">Perform inverse discrete cosine transform</span></span>
4.  <span data-ttu-id="3445d-189">Effectuer un échantillonnage Chroma sur les données C<sub>b</sub>c<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-189">Perform chroma upsampling on C<sub>b</sub>C<sub>r</sub> data</span></span>
5.  <span data-ttu-id="3445d-190">Convertir les données YC<sub>b</sub>C<sub>r</sub> en RVBA (si nécessaire)</span><span class="sxs-lookup"><span data-stu-id="3445d-190">Convert YC<sub>b</sub>C<sub>r</sub> data to RGBA (if needed)</span></span>

<span data-ttu-id="3445d-191">En faisant en sorte que le codec JPEG produise des données YC<sub>b</sub>C<sub>r</sub> , nous pouvons éviter les deux dernières étapes du processus de décodage, ou les reporter au GPU.</span><span class="sxs-lookup"><span data-stu-id="3445d-191">By having the JPEG codec produce YC<sub>b</sub>C<sub>r</sub> data, we can avoid the final two steps of the decode process, or defer them to the GPU.</span></span> <span data-ttu-id="3445d-192">Outre les économies de mémoire indiquées dans la section précédente, cela réduit considérablement le temps total nécessaire pour décoder l’image.</span><span class="sxs-lookup"><span data-stu-id="3445d-192">In addition to the memory savings listed in the previous section, this significantly reduces overall time needed to decode the image.</span></span> <span data-ttu-id="3445d-193">Les mêmes économies s’appliquent lors de l’encodage des données YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-193">The same savings apply when encoding YC<sub>b</sub>C<sub>r</sub> data.</span></span>

## <a name="using-jpeg-ycsubbsubcsubrsub-data"></a><span data-ttu-id="3445d-194">Utilisation de données JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-194">Using JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>

<span data-ttu-id="3445d-195">Cette section explique comment utiliser WIC et Direct2D pour fonctionner sur des données YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-195">This section explains how to use WIC and Direct2D to operate on YC<sub>b</sub>C<sub>r</sub> data.</span></span>

<span data-ttu-id="3445d-196">Pour consulter les instructions de ce document utilisées dans la pratique, consultez l' [exemple optimisations JPEG d’images JPEG dans Direct2D et WIC](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample) , qui illustre toutes les étapes nécessaires au décodage<sub></sub>et au rendu du contenu<sub>r C r</sub> YC dans une application Direct2D.</span><span class="sxs-lookup"><span data-stu-id="3445d-196">To see the guidance from this document used in practice, see the [JPEG YCbCr optimizations in Direct2D and WIC sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample) which demonstrates all of the steps needed to decode and render YC<sub>b</sub>C<sub>r</sub> content in a Direct2D app.</span></span>

### <a name="using-ycsubbsubcsubrsub-jpeg-images"></a><span data-ttu-id="3445d-197">Utilisation d’images JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-197">Using YC<sub>b</sub>C<sub>r</sub> JPEG images</span></span>

<span data-ttu-id="3445d-198">La grande majorité des images JPEG sont stockées sous la forme YC<sub>b</sub>C<sub>r</sub>.</span><span class="sxs-lookup"><span data-stu-id="3445d-198">The vast majority of JPEG images are stored as YC<sub>b</sub>C<sub>r</sub>.</span></span> <span data-ttu-id="3445d-199">Certains JPEG contiennent des données CMJN ou nuances de gris et n’utilisent pas YC<sub>b</sub>C<sub>r</sub>.</span><span class="sxs-lookup"><span data-stu-id="3445d-199">Some JPEGs contain CMYK or grayscale data and do not use YC<sub>b</sub>C<sub>r</sub>.</span></span> <span data-ttu-id="3445d-200">Cela signifie que vous pouvez généralement, mais pas toujours, utiliser directement du contenu JPEG préexistant sans aucune modification.</span><span class="sxs-lookup"><span data-stu-id="3445d-200">This means that you typically, but not always, can directly use pre-existing JPEG content without any modifications.</span></span>

<span data-ttu-id="3445d-201">WIC et Direct2D ne prennent pas en charge toutes les configurations possibles de YC<sub>b</sub>c<sub>r</sub> , et la prise en charge de YC<sub>b</sub>c<sub>r</sub> dans Direct2D dépend du matériel et du pilote graphiques sous-jacents.</span><span class="sxs-lookup"><span data-stu-id="3445d-201">WIC and Direct2D do not support every possible YC<sub>b</sub>C<sub>r</sub> configuration, and YC<sub>b</sub>C<sub>r</sub> support in Direct2D is dependent upon the underlying graphics hardware and driver.</span></span> <span data-ttu-id="3445d-202">Pour cette raison, un pipeline d’imagerie à usage général doit être robuste pour les images qui n’utilisent pas YC<sub>b</sub>c<sub>r</sub> (y compris les autres formats d’image courants tels que png ou BMP) ou dans les cas où la prise en charge de l’YC<sub>b</sub>c<sub>r</sub> n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="3445d-202">Because of this, a general purpose imaging pipeline needs to be robust to images that do not use YC<sub>b</sub>C<sub>r</sub> (including other common image formats such as PNG or BMP) or to cases where YC<sub>b</sub>C<sub>r</sub> support is not available.</span></span> <span data-ttu-id="3445d-203">Nous vous recommandons de conserver votre pipeline d’images BGRA existant et d’activer YC<sub>b</sub>C<sub>r</sub> comme optimisation des performances lorsqu’il est disponible.</span><span class="sxs-lookup"><span data-stu-id="3445d-203">We recommend that you keep your existing BGRA based imaging pipeline and enable YC<sub>b</sub>C<sub>r</sub> as a performance optimization when available.</span></span>

### <a name="windows-imaging-component-apis"></a><span data-ttu-id="3445d-204">API du composant de création d’images Windows</span><span class="sxs-lookup"><span data-stu-id="3445d-204">Windows Imaging Component APIs</span></span>

<span data-ttu-id="3445d-205">Le WIC dans Windows 8.1 ajoute trois nouvelles interfaces pour fournir l’accès aux données JPEG YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-205">WIC in Windows 8.1 adds three new interfaces to provide access to JPEG YC<sub>b</sub>C<sub>r</sub> data.</span></span>

### <a name="iwicplanarbitmapsourcetransform"></a><span data-ttu-id="3445d-206">IWICPlanarBitmapSourceTransform</span><span class="sxs-lookup"><span data-stu-id="3445d-206">IWICPlanarBitmapSourceTransform</span></span>

<span data-ttu-id="3445d-207">[**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) est analogue à [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), à ceci près qu’il produit des pixels dans une configuration planaire, y compris les données r <sub>C</sub><sub>r</sub> YC.</span><span class="sxs-lookup"><span data-stu-id="3445d-207">[**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) is analogous to [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), except that it produces pixels in a planar configuration, including YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="3445d-208">Vous pouvez obtenir cette interface en appelant QueryInterface sur une implémentation de [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) qui prend en charge l’accès Planar.</span><span class="sxs-lookup"><span data-stu-id="3445d-208">You can obtain this interface by calling QueryInterface on an implementation of [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) that supports planar access.</span></span> <span data-ttu-id="3445d-209">Cela comprend l’implémentation du codec JPEG de [**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode) , ainsi que [**IWICBitmapScaler**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapscaler), [**IWICBitmapFlipRotator**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapfliprotator)et [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform).</span><span class="sxs-lookup"><span data-stu-id="3445d-209">This includes the JPEG codec’s implementation of [**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode) as well as [**IWICBitmapScaler**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapscaler), [**IWICBitmapFlipRotator**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapfliprotator), and [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform).</span></span>

### <a name="iwicplanarbitmapframeencode"></a><span data-ttu-id="3445d-210">IWICPlanarBitmapFrameEncode</span><span class="sxs-lookup"><span data-stu-id="3445d-210">IWICPlanarBitmapFrameEncode</span></span>

<span data-ttu-id="3445d-211">[**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) offre la possibilité d’encoder des données de pixels planaires, y compris les données <sub>r C r</sub> <sub>Yc.</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-211">[**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) provides the ability to encode planar pixel data, including YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="3445d-212">Vous pouvez obtenir cette interface en appelant QueryInterface sur l’implémentation de [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)du codec JPEG.</span><span class="sxs-lookup"><span data-stu-id="3445d-212">You can obtain this interface by calling QueryInterface on the JPEG codec’s implementation of [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span></span>

### <a name="iwicplanarformatconverter"></a><span data-ttu-id="3445d-213">IWICPlanarFormatConverter</span><span class="sxs-lookup"><span data-stu-id="3445d-213">IWICPlanarFormatConverter</span></span>

<span data-ttu-id="3445d-214">[**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) permet à [**IWICFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicformatconverter) de consommer des données de pixels planaires, y compris YC <sub>b</sub>C <sub>r</sub>, et de les convertir au format de pixel entrelacé.</span><span class="sxs-lookup"><span data-stu-id="3445d-214">[**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) allows [**IWICFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicformatconverter) to consume planar pixel data, including YC<sub>b</sub>C<sub>r</sub>, and convert it to an interleaved pixel format.</span></span> <span data-ttu-id="3445d-215">Elle n’expose pas la possibilité de convertir des données de pixels entrelacées en un format Planar.</span><span class="sxs-lookup"><span data-stu-id="3445d-215">It does not expose the ability to convert interleaved pixel data to a planar format.</span></span> <span data-ttu-id="3445d-216">Vous pouvez obtenir cette interface en appelant QueryInterface sur l’implémentation de **IWICFormatConverter** fournie par Windows.</span><span class="sxs-lookup"><span data-stu-id="3445d-216">You can obtain this interface by calling QueryInterface on the Windows provided implementation of **IWICFormatConverter**.</span></span>

### <a name="direct2d-apis"></a><span data-ttu-id="3445d-217">API Direct2D</span><span class="sxs-lookup"><span data-stu-id="3445d-217">Direct2D APIs</span></span>

<span data-ttu-id="3445d-218">Direct2D dans Windows 8.1 prend en charge les données de pixels planaires c c<sub>r</sub> YC avec le nouvel effet d'<sub>image c</sub><sub>r</sub> YC<sub>b</sub>.</span><span class="sxs-lookup"><span data-stu-id="3445d-218">Direct2D in Windows 8.1 supports YC<sub>b</sub>C<sub>r</sub> planar pixel data with the new YC<sub>b</sub>C<sub>r</sub> image effect .</span></span> <span data-ttu-id="3445d-219">Cet effet offre la possibilité de restituer les données<sub>r</sub> YC<sub>b</sub>C.</span><span class="sxs-lookup"><span data-stu-id="3445d-219">This effect provides the ability to render YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="3445d-220">L’effet prend comme entrée deux interfaces [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) : l’une contenant les données planaires Y au format dxgi \_ \_ R8 \_ UNORM et l’autre contenant les données CbCr entrelacées au format dxgi \_ R8G8 \_ \_ UNORM.</span><span class="sxs-lookup"><span data-stu-id="3445d-220">The effect takes as input two [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) interfaces: one containing planar Y data in the DXGI\_FORMAT\_R8\_UNORM format, and one containing interleaved CbCr data in the DXGI\_FORMAT\_R8G8\_UNORM format.</span></span> <span data-ttu-id="3445d-221">En général, vous utilisez cet effet à la place des **ID2D1Bitmap** qui contenaient des données de pixels BGRA.</span><span class="sxs-lookup"><span data-stu-id="3445d-221">You typically use this effect in place of the **ID2D1Bitmap** that would have contained BGRA pixel data.</span></span>

<span data-ttu-id="3445d-222">L’effet de l’image<sub>r</sub> YC<sub>b</sub>c est destiné à être utilisé conjointement avec les API WIC YC<sub>b</sub>c<sub>r</sub> qui fournissent les données YC<sub>b</sub>c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-222">The YC<sub>b</sub>C<sub>r</sub> image effect is intended to be used in conjunction with the WIC YC<sub>b</sub>C<sub>r</sub> APIs which provide the YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="3445d-223">Cela permet de décharger une partie du travail de décodage de l’UC vers le GPU, où il peut être traité plus rapidement et en parallèle.</span><span class="sxs-lookup"><span data-stu-id="3445d-223">This effectively acts to offload some of the decode work from the CPU to the GPU, where it can be processed much quicker and in parallel.</span></span>

### <a name="determining-if-the-ycsubbsubcsubrsub-configuration-is-supported"></a><span data-ttu-id="3445d-224">Détermination de la prise en charge de la configuration YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-224">Determining if the YC<sub>b</sub>C<sub>r</sub> Configuration is Supported</span></span>

<span data-ttu-id="3445d-225">Comme indiqué précédemment, votre application doit être fiable dans les cas où la prise en charge de YC<sub>b</sub>C<sub>r</sub> n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="3445d-225">As noted before, your app should be robust to cases where YC<sub>b</sub>C<sub>r</sub> support is not available.</span></span> <span data-ttu-id="3445d-226">Cette section décrit les conditions que votre application doit vérifier.</span><span class="sxs-lookup"><span data-stu-id="3445d-226">This section discusses the conditions that your app should check for.</span></span> <span data-ttu-id="3445d-227">Si l’une des vérifications suivantes échoue, votre application doit revenir à un pipeline BGRA standard.</span><span class="sxs-lookup"><span data-stu-id="3445d-227">If any of the following checks fail, your app should fall back to a standard BGRA-based pipeline.</span></span>

### <a name="does-the-wic-component-support-ycsubbsubcsubrsub-data-access"></a><span data-ttu-id="3445d-228">Le composant WIC prend-il en charge l’accès aux données YC<sub>b</sub>C<sub>r</sub> ?</span><span class="sxs-lookup"><span data-stu-id="3445d-228">Does the WIC component support YC<sub>b</sub>C<sub>r</sub> data access?</span></span>

<span data-ttu-id="3445d-229">Seul le codec JPEG fourni par Windows et certaines transformations WIC prennent en charge l’accès aux données YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-229">Only the Windows provided JPEG codec and certain WIC transforms support YC<sub>b</sub>C<sub>r</sub> data access.</span></span> <span data-ttu-id="3445d-230">Pour obtenir une liste complète, reportez-vous à la section [API du composant de création d’images Windows](#windows-imaging-component-apis) .</span><span class="sxs-lookup"><span data-stu-id="3445d-230">For a complete list, refer to the [Windows Imaging Component APIs](#windows-imaging-component-apis) section.</span></span>

<span data-ttu-id="3445d-231">Pour obtenir l’une des interfaces c++<sub></sub>YC b<sub>r</sub> planaires, appelez QueryInterface sur l’interface d’origine.</span><span class="sxs-lookup"><span data-stu-id="3445d-231">To obtain one of the planar YC<sub>b</sub>C<sub>r</sub> interfaces, call QueryInterface on the original interface.</span></span> <span data-ttu-id="3445d-232">Cela échoue si le composant ne prend pas en charge l’accès aux données YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-232">This will fail if the component does not support YC<sub>b</sub>C<sub>r</sub> data access.</span></span>

### <a name="is-the-requested-wic-transform-supported-for-ycsubbsubcsubrsub"></a><span data-ttu-id="3445d-233">La transformation WIC demandée est-elle prise en charge pour YC<sub>b</sub>C<sub>r</sub>?</span><span class="sxs-lookup"><span data-stu-id="3445d-233">Is the requested WIC transform supported for YC<sub>b</sub>C<sub>r</sub>?</span></span>

<span data-ttu-id="3445d-234">Après avoir obtenu un [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform), vous devez d’abord appeler [**DoesSupportTransform**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-doessupporttransform).</span><span class="sxs-lookup"><span data-stu-id="3445d-234">After obtaining an [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform), you should first call [**DoesSupportTransform**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-doessupporttransform).</span></span> <span data-ttu-id="3445d-235">Cette méthode prend comme paramètres d’entrée l’ensemble complet des transformations que vous souhaitez appliquer aux données planaires<sub>b</sub>C<sub>r</sub> planes, et retourne une valeur booléenne indiquant la prise en charge, ainsi que les dimensions les plus proches de la taille demandée qui peut être retournée.</span><span class="sxs-lookup"><span data-stu-id="3445d-235">This method takes as input parameters the complete set of transforms that you want to be applied to the planar YC<sub>b</sub>C<sub>r</sub> data, and returns a Boolean indicating support, as well as the closest dimensions to the requested size that can be returned.</span></span> <span data-ttu-id="3445d-236">Vous devez vérifier les trois valeurs avant d’accéder aux données de pixels avec [**IWICPlanarBitmapSourceTransform :: CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span><span class="sxs-lookup"><span data-stu-id="3445d-236">You should check all three values before accessing the pixel data with [**IWICPlanarBitmapSourceTransform::CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span></span>

<span data-ttu-id="3445d-237">Ce modèle est similaire à la façon dont [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform) est utilisé.</span><span class="sxs-lookup"><span data-stu-id="3445d-237">This pattern is similar to how [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform) is used.</span></span>

### <a name="does-the-graphics-driver-support-the-features-necessary-to-use-ycsubbsubcsubrsub-with-direct2d"></a><span data-ttu-id="3445d-238">Le pilote Graphics prend-il en charge les fonctionnalités nécessaires à l’utilisation de YC<sub>b</sub>C<sub>r</sub> avec Direct2D ?</span><span class="sxs-lookup"><span data-stu-id="3445d-238">Does the graphics driver support the features necessary to use YC<sub>b</sub>C<sub>r</sub> with Direct2D?</span></span>

<span data-ttu-id="3445d-239">Cette vérification n’est nécessaire que si vous utilisez l’effet Direct2D YC<sub>b</sub>c<sub>r</sub> pour restituer le contenu<sub>r</sub> YC<sub>b</sub>c.</span><span class="sxs-lookup"><span data-stu-id="3445d-239">This check is only necessary if you are using the Direct2D YC<sub>b</sub>C<sub>r</sub> effect to render YC<sub>b</sub>C<sub>r</sub> content.</span></span> <span data-ttu-id="3445d-240">Direct2D stocke les données YC<sub>b</sub>C<sub>r</sub> à l’aide du \_ format dxgi \_ R8 \_ UNORM et dxgi \_ format \_ R8G8 \_ UNORM pixel formats, qui ne sont pas disponibles à partir de tous les pilotes graphiques.</span><span class="sxs-lookup"><span data-stu-id="3445d-240">Direct2D stores YC<sub>b</sub>C<sub>r</sub> data using the DXGI\_FORMAT\_R8\_UNORM and DXGI\_FORMAT\_R8G8\_UNORM pixel formats, which are not available from all graphics drivers.</span></span>

<span data-ttu-id="3445d-241">Avant d’utiliser l’effet de l’image C <sub>r</sub> YC <sub>b</sub>, vous devez appeler [**ID2D1DeviceContext :: IsDxgiFormatSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isdxgiformatsupported) pour vous assurer que les deux formats sont pris en charge par le pilote.</span><span class="sxs-lookup"><span data-stu-id="3445d-241">Before using the YC <sub>b</sub>C <sub>r</sub> image effect, you should call [**ID2D1DeviceContext::IsDxgiFormatSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isdxgiformatsupported) to ensure that both formats are supported by the driver.</span></span>

### <a name="sample-code"></a><span data-ttu-id="3445d-242">Exemple de code</span><span class="sxs-lookup"><span data-stu-id="3445d-242">Sample code</span></span>

<span data-ttu-id="3445d-243">Vous trouverez ci-dessous un exemple de code illustrant les vérifications recommandées.</span><span class="sxs-lookup"><span data-stu-id="3445d-243">Below is a code example demonstrating the recommended checks.</span></span> <span data-ttu-id="3445d-244">Cet exemple a été extrait des [optimisations JPEG YCbCr dans Direct2D et WIC Sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span><span class="sxs-lookup"><span data-stu-id="3445d-244">This example was taken from the [JPEG YCbCr optimizations in Direct2D and WIC sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span></span>


```C++
bool DirectXSampleRenderer::DoesWicSupportRequestedYCbCr()
{
    ComPtr<IWICPlanarBitmapSourceTransform> wicPlanarSource;
    HRESULT hr = m_wicScaler.As(&wicPlanarSource);
    if (SUCCEEDED(hr))
    {
        BOOL isTransformSupported;
        uint32 supportedWidth = m_cachedBitmapPixelWidth;
        uint32 supportedHeight = m_cachedBitmapPixelHeight;
        DX::ThrowIfFailed(
            wicPlanarSource->DoesSupportTransform(
                &supportedWidth,
                &supportedHeight,
                WICBitmapTransformRotate0,
                WICPlanarOptionsDefault,
                SampleConstants::WicYCbCrFormats,
                m_planeDescriptions,
                SampleConstants::NumPlanes,
                &isTransformSupported
                )
            );

        // The returned width and height may be larger if IWICPlanarBitmapSourceTransform does not
        // exactly support what is requested.
        if ((isTransformSupported == TRUE) &&
            (supportedWidth == m_cachedBitmapPixelWidth) &&
            (supportedHeight == m_cachedBitmapPixelHeight))
        {
            return true;
        }
    }

    return false;
}

bool DirectXSampleRenderer::DoesDriverSupportYCbCr()
{
    auto d2dContext = m_deviceResources->GetD2DDeviceContext();

    return (d2dContext->IsDxgiFormatSupported(DXGI_FORMAT_R8_UNORM)) &&
        (d2dContext->IsDxgiFormatSupported(DXGI_FORMAT_R8G8_UNORM));
}
```



### <a name="decoding-ycsubbsubcsubrsub-pixel-data"></a><span data-ttu-id="3445d-245">Décodage des données de pixels YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-245">Decoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>

<span data-ttu-id="3445d-246">Si vous souhaitez obtenir des données de pixels YC <sub>b</sub>C <sub>r</sub> , vous devez appeler [**IWICPlanarBitmapSourceTransform :: CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span><span class="sxs-lookup"><span data-stu-id="3445d-246">If you want to obtain YC <sub>b</sub>C <sub>r</sub> pixel data you should call [**IWICPlanarBitmapSourceTransform::CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span></span> <span data-ttu-id="3445d-247">Cette méthode copie les données de pixels dans un tableau de structures [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) remplies, une pour chaque plan de données souhaité (par exemple, Y et c <sub>b</sub>c <sub>r</sub>).</span><span class="sxs-lookup"><span data-stu-id="3445d-247">This method copies pixel data into an array of filled-out [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) structures, one for each plane of data you want (for example, Y and C<sub>b</sub>C<sub>r</sub>).</span></span> <span data-ttu-id="3445d-248">Un **WICBitmapPlane** contient des informations sur les données de pixels et pointe vers la mémoire tampon qui recevra les données.</span><span class="sxs-lookup"><span data-stu-id="3445d-248">A **WICBitmapPlane** contains info about the pixel data and points to the memory buffer that will receive the data.</span></span>

<span data-ttu-id="3445d-249">Si vous souhaitez utiliser les données de pixels YC <sub>b</sub>C <sub>r</sub> avec d’autres API WIC, vous devez créer un [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap)correctement configuré, appeler [**Lock**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmap-lock) pour obtenir la mémoire tampon sous-jacente et associer la mémoire tampon au [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) utilisé pour recevoir les données de pixels YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-249">If you want to use the YC <sub>b</sub>C <sub>r</sub> pixel data with other WIC APIs you should create an appropriately configured [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap), call [**Lock**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmap-lock) to obtain the underlying memory buffer, and associate the buffer with the [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) used to receive the YC<sub>b</sub>C<sub>r</sub> pixel data.</span></span> <span data-ttu-id="3445d-250">Vous pouvez ensuite utiliser le [IWICBitmap](-wic-imp-iwicbitmapdecoder.md) normalement.</span><span class="sxs-lookup"><span data-stu-id="3445d-250">You can then use the [IWICBitmap](-wic-imp-iwicbitmapdecoder.md) normally.</span></span>

<span data-ttu-id="3445d-251">Enfin, si vous souhaitez restituer les données YC <sub>b</sub>c <sub>r</sub> dans Direct2D, vous devez créer un [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) à partir de chaque [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap) et les utiliser en tant que source pour l’effet de l’image C <sub>r</sub> YC <sub>b</sub>.</span><span class="sxs-lookup"><span data-stu-id="3445d-251">Finally, if you want to render the YC <sub>b</sub>C <sub>r</sub> data in Direct2D, you should create an [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) from each [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap) and use them as source for the YC<sub>b</sub>C<sub>r</sub> image effect.</span></span> <span data-ttu-id="3445d-252">WIC vous permet de demander plusieurs configurations planaires.</span><span class="sxs-lookup"><span data-stu-id="3445d-252">WIC allows you to request multiple planar configurations.</span></span> <span data-ttu-id="3445d-253">En cas d’interopérabilité avec Direct2D, vous devez demander deux plans, l’un utilisant le GUID \_ WICPixelFormat8bppY et l’autre à l’aide du GUID \_ WICPixelFormat16bppCbCr, car il s’agit de la configuration attendue par Direct2D.</span><span class="sxs-lookup"><span data-stu-id="3445d-253">When interoperating with Direct2D you should request two planes, one using GUID\_WICPixelFormat8bppY and the other using GUID\_WICPixelFormat16bppCbCr, as this is the configuration expected by Direct2D.</span></span>

### <a name="code-sample"></a><span data-ttu-id="3445d-254">Exemple de code</span><span class="sxs-lookup"><span data-stu-id="3445d-254">Code Sample</span></span>

<span data-ttu-id="3445d-255">Vous trouverez ci-dessous un exemple de code illustrant les étapes de décodage et de rendu des données YC<sub>b</sub>C<sub>r</sub> dans Direct2D.</span><span class="sxs-lookup"><span data-stu-id="3445d-255">Below is a code example demonstrating the steps to decode and render YC<sub>b</sub>C<sub>r</sub> data in Direct2D.</span></span> <span data-ttu-id="3445d-256">Cet exemple a été extrait des [optimisations JPEG YCbCr dans Direct2D et WIC Sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span><span class="sxs-lookup"><span data-stu-id="3445d-256">This example was taken from the [JPEG YCbCr optimizations in Direct2D and WIC sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span></span>


```C++
void DirectXSampleRenderer::CreateYCbCrDeviceResources()
{
    auto wicFactory = m_deviceResources->GetWicImagingFactory();
    auto d2dContext = m_deviceResources->GetD2DDeviceContext();

    ComPtr<IWICPlanarBitmapSourceTransform> wicPlanarSource;
    DX::ThrowIfFailed(
        m_wicScaler.As(&wicPlanarSource)
        );

    ComPtr<IWICBitmap> bitmaps[SampleConstants::NumPlanes];
    ComPtr<IWICBitmapLock> locks[SampleConstants::NumPlanes];
    WICBitmapPlane planes[SampleConstants::NumPlanes];

    for (uint32 i = 0; i < SampleConstants::NumPlanes; i++)
    {
        DX::ThrowIfFailed(
            wicFactory->CreateBitmap(
                m_planeDescriptions[i].Width,
                m_planeDescriptions[i].Height,
                m_planeDescriptions[i].Format,
                WICBitmapCacheOnLoad,
                &bitmaps[i]
                )
            );

        LockBitmap(bitmaps[i].Get(), WICBitmapLockWrite, nullptr, &locks[i], &planes[i]);
    }

    DX::ThrowIfFailed(
        wicPlanarSource->CopyPixels(
            nullptr, // Copy the entire source region.
            m_cachedBitmapPixelWidth,
            m_cachedBitmapPixelHeight,
            WICBitmapTransformRotate0,
            WICPlanarOptionsDefault,
            planes,
            SampleConstants::NumPlanes
            )
        );

    DX::ThrowIfFailed(d2dContext->CreateEffect(CLSID_D2D1YCbCr, &m_d2dYCbCrEffect));

    ComPtr<ID2D1Bitmap1> d2dBitmaps[SampleConstants::NumPlanes];
    for (uint32 i = 0; i < SampleConstants::NumPlanes; i++)
    {
        // IWICBitmapLock must be released before using the IWICBitmap.
        locks[i] = nullptr;

        // First ID2D1Bitmap1 is DXGI_FORMAT_R8 (Y), second is DXGI_FORMAT_R8G8 (CbCr).
        DX::ThrowIfFailed(d2dContext->CreateBitmapFromWicBitmap(bitmaps[i].Get(), &d2dBitmaps[i]));
        m_d2dYCbCrEffect->SetInput(i, d2dBitmaps[i].Get());
    }
}

void DirectXSampleRenderer::LockBitmap(
    _In_ IWICBitmap *pBitmap,
    DWORD bitmapLockFlags,
    _In_opt_ const WICRect *prcSource,
    _Outptr_ IWICBitmapLock **ppBitmapLock,
    _Out_ WICBitmapPlane *pPlane
    )
{
    // ComPtr guarantees the IWICBitmapLock is released if an exception is thrown.
    ComPtr<IWICBitmapLock> lock;
    DX::ThrowIfFailed(pBitmap->Lock(prcSource, bitmapLockFlags, &lock));
    DX::ThrowIfFailed(lock->GetStride(&pPlane->cbStride));
    DX::ThrowIfFailed(lock->GetDataPointer(&pPlane->cbBufferSize, &pPlane->pbBuffer));
    DX::ThrowIfFailed(lock->GetPixelFormat(&pPlane->Format));
    *ppBitmapLock = lock.Detach();
}
```



### <a name="transforming-ycsubbsubcsubrsub-pixel-data"></a><span data-ttu-id="3445d-257">Transformation des données de pixels YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-257">Transforming YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>

<span data-ttu-id="3445d-258">La transformation des données YC <sub>b</sub>C <sub>r</sub> est quasiment identique au décodage, car les deux impliquent [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span><span class="sxs-lookup"><span data-stu-id="3445d-258">Transforming YC <sub>b</sub>C <sub>r</sub> data is nearly identical to decoding, as both involve [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span></span> <span data-ttu-id="3445d-259">La seule différence est l’objet WIC à partir duquel vous avez obtenu l’interface.</span><span class="sxs-lookup"><span data-stu-id="3445d-259">The only difference is which WIC object you obtained the interface from.</span></span> <span data-ttu-id="3445d-260">La mise à l’échelle, le pivot et la transformation de couleurs fournis par Windows prennent tous en charge l’accès YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-260">The Windows provided scaler, flip rotator and color transform all support YC<sub>b</sub>C<sub>r</sub> access.</span></span>

### <a name="chaining-transforms-together"></a><span data-ttu-id="3445d-261">Chaînage des transformations</span><span class="sxs-lookup"><span data-stu-id="3445d-261">Chaining Transforms Together</span></span>

<span data-ttu-id="3445d-262">WIC prend en charge la notion de chaînage de plusieurs transformations.</span><span class="sxs-lookup"><span data-stu-id="3445d-262">WIC supports the notion of chaining together multiple transforms.</span></span> <span data-ttu-id="3445d-263">Par exemple, vous pouvez créer le pipeline WIC suivant :</span><span class="sxs-lookup"><span data-stu-id="3445d-263">For example, you can create the following WIC pipeline:</span></span>

![diagramme d’un pipeline WIC à partir d’un décodeur JPEG.](graphics/ycbcr5.png)

<span data-ttu-id="3445d-265">Vous pouvez ensuite appeler QueryInterface sur [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform) pour obtenir [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span><span class="sxs-lookup"><span data-stu-id="3445d-265">You can then call QueryInterface on the [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform) to obtain [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span></span> <span data-ttu-id="3445d-266">La transformation de couleur peut communiquer avec les transformations précédentes et peut exposer les fonctionnalités d’agrégation de chaque étape dans le pipeline.</span><span class="sxs-lookup"><span data-stu-id="3445d-266">The color transform can communicate with the preceding transforms and can expose the aggregate capabilities of every stage in the pipeline.</span></span> <span data-ttu-id="3445d-267">Le WIC permet de garantir que les données C<sub>r</sub> YC<sub>b</sub>sont conservées tout au long du processus.</span><span class="sxs-lookup"><span data-stu-id="3445d-267">WIC ensures that the YC<sub>b</sub>C<sub>r</sub> data is preserved through the entire process.</span></span> <span data-ttu-id="3445d-268">Ce chaînage fonctionne uniquement lorsque vous utilisez des composants qui prennent en charge l’accès à YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-268">This chaining only works when using components that support YC<sub>b</sub>C<sub>r</sub> access.</span></span>

### <a name="jpeg-codec-optimizations"></a><span data-ttu-id="3445d-269">Optimisations du codec JPEG</span><span class="sxs-lookup"><span data-stu-id="3445d-269">JPEG Codec Optimizations</span></span>

<span data-ttu-id="3445d-270">À l’instar de l’implémentation du décodage de cadre JPEG de [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), l’implémentation du décodage de cadre JPEG de [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) prend en charge la mise à l’échelle et la rotation de domaine.</span><span class="sxs-lookup"><span data-stu-id="3445d-270">Similar to the JPEG frame decode implementation of [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), the JPEG frame decode implementation of [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) supports native JPEG DCT domain scaling and rotation.</span></span> <span data-ttu-id="3445d-271">Vous pouvez demander une puissance de deux réduire ou une rotation directement à partir du décodeur JPEG.</span><span class="sxs-lookup"><span data-stu-id="3445d-271">You can request a power of two downscale or a rotation directly from the JPEG decoder.</span></span> <span data-ttu-id="3445d-272">Cela entraîne généralement une meilleure qualité et des performances supérieures à celles des transformations discrètes.</span><span class="sxs-lookup"><span data-stu-id="3445d-272">This typically results in higher quality and performance than using the discrete transforms.</span></span>

<span data-ttu-id="3445d-273">En outre, lorsque vous chaînez une ou plusieurs transformations WIC après le décodeur JPEG, elle peut tirer parti de la mise à l’échelle et de la rotation JPEG natives pour répondre à l’opération d’agrégation demandée.</span><span class="sxs-lookup"><span data-stu-id="3445d-273">In addition, when you chain one or more WIC transforms after the JPEG decoder, it can leverage native JPEG scaling and rotation to satisfy the aggregate requested operation.</span></span>

### <a name="format-conversions"></a><span data-ttu-id="3445d-274">Conversions de format</span><span class="sxs-lookup"><span data-stu-id="3445d-274">Format Conversions</span></span>

<span data-ttu-id="3445d-275">Utilisez [**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) pour convertir les données de pixels YC <sub>b</sub>C <sub>r</sub> planaires en un format de pixel entrelacé, tel que le GUID \_ WICPixelFormat32bppPBGRA.</span><span class="sxs-lookup"><span data-stu-id="3445d-275">Use [**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) to convert planar YC<sub>b</sub>C<sub>r</sub> pixel data to an interleaved pixel format such as GUID\_WICPixelFormat32bppPBGRA.</span></span> <span data-ttu-id="3445d-276">Le WIC dans Windows 8.1 ne permet pas de convertir un format de pixel YC<sub>b</sub>C<sub>r</sub> planaire.</span><span class="sxs-lookup"><span data-stu-id="3445d-276">WIC in Windows 8.1 does not provide the ability to convert to a planar YC<sub>b</sub>C<sub>r</sub> pixel format.</span></span>

### <a name="encoding-ycsubbsubcsubrsub-pixel-data"></a><span data-ttu-id="3445d-277">Encodage de données de pixels YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="3445d-277">Encoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>

<span data-ttu-id="3445d-278">Utilisez [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) pour encoder les données de pixels YC <sub>b</sub>C <sub>r</sub> sur l’encodeur JPEG.</span><span class="sxs-lookup"><span data-stu-id="3445d-278">Use [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) to encode YC<sub>b</sub>C<sub>r</sub> pixel data to the JPEG encoder.</span></span> <span data-ttu-id="3445d-279">L’encodage des données YC <sub>b</sub>C <sub>r</sub> **IWICPlanarBitmapFrameEncode** est similaire, mais pas identique à l’encodage des données entrelacées à l’aide de [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span><span class="sxs-lookup"><span data-stu-id="3445d-279">Encoding YC <sub>b</sub>C <sub>r</sub> data **IWICPlanarBitmapFrameEncode** is similar but not identical to encoding interleaved data using [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span></span> <span data-ttu-id="3445d-280">L’interface planaire expose uniquement la possibilité d’écrire des données d’image planaire. vous devez continuer à utiliser l’interface de codage de frames pour définir des métadonnées ou une miniature et pour valider à la fin de l’opération.</span><span class="sxs-lookup"><span data-stu-id="3445d-280">The planar interface only exposes the ability to write planar frame image data, and you should continue to use the frame encode interface to set metadata or a thumbnail and to commit at the end of the operation.</span></span>

<span data-ttu-id="3445d-281">Pour les cas typiques, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="3445d-281">For the typical case, you should follow these steps:</span></span>

1.  <span data-ttu-id="3445d-282">Obtenez le [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) comme d’habitude.</span><span class="sxs-lookup"><span data-stu-id="3445d-282">Obtain the [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) as normal.</span></span> <span data-ttu-id="3445d-283">Si vous souhaitez configurer le sous-échantillonnage Chroma, définissez l’option encodeur [**JpegYCrCbSubsampling**](/windows/desktop/api/Wincodec/ne-wincodec-wicjpegycrcbsubsamplingoption) lors de la création du frame.</span><span class="sxs-lookup"><span data-stu-id="3445d-283">If you want to configure chroma subsampling, set the [**JpegYCrCbSubsampling**](/windows/desktop/api/Wincodec/ne-wincodec-wicjpegycrcbsubsamplingoption) encoder option when creating the frame.</span></span>
2.  <span data-ttu-id="3445d-284">Si vous avez besoin de définir des métadonnées ou une miniature, utilisez [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) comme normal.</span><span class="sxs-lookup"><span data-stu-id="3445d-284">If you need to set metadata or a thumbnail, do this using [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) as normal.</span></span>
3.  <span data-ttu-id="3445d-285">QueryInterface pour [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode).</span><span class="sxs-lookup"><span data-stu-id="3445d-285">QueryInterface for the [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode).</span></span>
4.  <span data-ttu-id="3445d-286">Définissez les données de pixels YC <sub>b</sub>C <sub>r</sub> à l’aide de [**IWICPlanarBitmapFrameEncode :: WriteSource**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writesource) ou [**IWICPlanarBitmapFrameEncode :: WritePixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writepixels).</span><span class="sxs-lookup"><span data-stu-id="3445d-286">Set the YC <sub>b</sub>C <sub>r</sub> pixel data using [**IWICPlanarBitmapFrameEncode::WriteSource**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writesource) or [**IWICPlanarBitmapFrameEncode::WritePixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writepixels).</span></span> <span data-ttu-id="3445d-287">Contrairement à leurs équivalents [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) , vous fournissez ces méthodes avec un tableau de [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) ou [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) qui contient les plans de pixels YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-287">Unlike with their [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) counterparts, you provide these methods with an array of [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) or [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) which contain the YC<sub>b</sub>C<sub>r</sub> pixel planes.</span></span>
5.  <span data-ttu-id="3445d-288">Lorsque vous avez terminé, appelez [**IWICBitmapFrameEncode :: Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapframeencode-commit).</span><span class="sxs-lookup"><span data-stu-id="3445d-288">When you are finished, call [**IWICBitmapFrameEncode::Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapframeencode-commit).</span></span>

### <a name="decoding-ycsubbsubcsubrsub-pixel-data-in-windows-10"></a><span data-ttu-id="3445d-289">Décodage des données de pixels YC<sub>b</sub>C<sub>r</sub> dans Windows 10</span><span class="sxs-lookup"><span data-stu-id="3445d-289">Decoding YC<sub>b</sub>C<sub>r</sub> pixel data in Windows 10</span></span>

<span data-ttu-id="3445d-290">À compter de la version 1507 de Windows 10, Direct2D fournit [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), un moyen plus simple de décoder les fichiers JPEG en Direct2D tout en tirant parti des optimisations de YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="3445d-290">Starting in Windows 10 build 1507, Direct2D provides [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), a simpler way to decode JPEGs into Direct2D while leveraging YC<sub>b</sub>C<sub>r</sub> optimizations.</span></span> <span data-ttu-id="3445d-291">**ID2D1ImageSourceFromWic** effectue automatiquement toutes les vérifications de la <sub>capacité</sub>C <sub>r</sub> YC nécessaires. elle utilise les codePath optimisés lorsque cela est possible et utilise un secours dans le cas contraire.</span><span class="sxs-lookup"><span data-stu-id="3445d-291">**ID2D1ImageSourceFromWic** automatically performs all of the necessary YC<sub>b</sub>C<sub>r</sub> capability checks for you; it uses the optimized codepath when possible, and uses a fallback otherwise.</span></span> <span data-ttu-id="3445d-292">Il permet également de nouvelles optimisations, telles que la mise en cache des sous-régions de l’image qui sont nécessaires à la fois.</span><span class="sxs-lookup"><span data-stu-id="3445d-292">It also enables new optimizations such as only caching subregions of the image that are needed at a time.</span></span>

<span data-ttu-id="3445d-293">Pour plus d’informations sur l’utilisation de [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), reportez-vous à l' [exemple](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/D2DPhotoAdjustment)du kit de développement logiciel (SDK) Direct2D.</span><span class="sxs-lookup"><span data-stu-id="3445d-293">For more information about using [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), refer to the Direct2D Photo Adjustment SDK [sample](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/D2DPhotoAdjustment).</span></span>

## <a name="related-topics"></a><span data-ttu-id="3445d-294">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="3445d-294">Related topics</span></span>

* [<span data-ttu-id="3445d-295">Optimisations JPEG YCbCr dans Direct2D et WIC, exemple</span><span class="sxs-lookup"><span data-stu-id="3445d-295">JPEG YCbCr optimizations in Direct2D and WIC sample</span></span>](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample)
