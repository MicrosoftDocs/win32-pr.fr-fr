---
description: En savoir plus sur le fonctionnement du composant de création d’images Windows
ms.assetid: c233e25b-bec6-4e67-8fbf-2bf9b70c7522
title: Fonctionnement du composant de création d’images Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9bc9fe31ae4346f2c2d1f0b273e78ed10a0ec7e6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103757834"
---
# <a name="how-the-windows-imaging-component-works"></a><span data-ttu-id="cc1a6-103">Fonctionnement du composant de création d’images Windows</span><span class="sxs-lookup"><span data-stu-id="cc1a6-103">How the Windows Imaging Component Works</span></span>

<span data-ttu-id="cc1a6-104">Cette rubrique contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="cc1a6-104">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="cc1a6-105">Découverte et arbitrage</span><span class="sxs-lookup"><span data-stu-id="cc1a6-105">Discovery and Arbitration</span></span>](#discovery-and-arbitration)
-   [<span data-ttu-id="cc1a6-106">Décodage</span><span class="sxs-lookup"><span data-stu-id="cc1a6-106">Decoding</span></span>](#decoding)
-   [<span data-ttu-id="cc1a6-107">Encodage</span><span class="sxs-lookup"><span data-stu-id="cc1a6-107">Encoding</span></span>](#encoding)
-   [<span data-ttu-id="cc1a6-108">Durée de vie d’un codec</span><span class="sxs-lookup"><span data-stu-id="cc1a6-108">The Lifetime of a Codec</span></span>](#the-lifetime-of-a-codec)
-   [<span data-ttu-id="cc1a6-109">Comment activer un codec avec WIC</span><span class="sxs-lookup"><span data-stu-id="cc1a6-109">How to WIC-enabled a Codec</span></span>](#how-to-wic-enabled-a-codec)
-   [<span data-ttu-id="cc1a6-110">Prise en charge du cloisonnement multithread dans WIC</span><span class="sxs-lookup"><span data-stu-id="cc1a6-110">Multi-Threaded Apartment Support in WIC</span></span>](#multi-threaded-apartment-support-in-wic)
-   [<span data-ttu-id="cc1a6-111">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="cc1a6-111">Related topics</span></span>](#related-topics)

## <a name="discovery-and-arbitration"></a><span data-ttu-id="cc1a6-112">Découverte et arbitrage</span><span class="sxs-lookup"><span data-stu-id="cc1a6-112">Discovery and Arbitration</span></span>

<span data-ttu-id="cc1a6-113">Avant de pouvoir décoder une image, vous devez trouver un codec approprié qui peut décoder ce format d’image.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-113">Before an image can be decoded, an appropriate codec must be found that can decode that image format.</span></span> <span data-ttu-id="cc1a6-114">Dans la plupart des systèmes, étant donné que les formats d’images pris en charge sont codés en dur, aucun processus de découverte n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-114">In most systems, because the supported image formats are hard-coded, no discovery process is required.</span></span> <span data-ttu-id="cc1a6-115">Étant donné que la plateforme WIC (Windows Imaging Component) est extensible, il est nécessaire de pouvoir identifier le format d’une image et de la faire correspondre à un codec approprié.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-115">Because the Windows Imaging Component (WIC) platform is extensible, it’s necessary to be able to identify the format of an image and match it with an appropriate codec.</span></span>

<span data-ttu-id="cc1a6-116">Pour prendre en charge la découverte au moment de l’exécution, chaque format d’image doit avoir un modèle d’identification qui peut être utilisé pour identifier le décodeur approprié pour ce format.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-116">To support run-time discovery, each image format must have an identifying pattern that can be used to identify the appropriate decoder for that format.</span></span> <span data-ttu-id="cc1a6-117">(Il est fortement recommandé, pour les nouveaux formats de fichier, d’utiliser un GUID pour le modèle d’identification, car il est garanti qu’il est unique.) Le modèle d’identification doit être incorporé dans chaque fichier image conforme à ce format d’image.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-117">(It is strongly recommended that, for new file formats, you use a GUID for the identifying pattern, because it is guaranteed to be unique.) The identifying pattern must be embedded in each image file that conforms to that image format.</span></span> <span data-ttu-id="cc1a6-118">Chaque décodeur a une entrée de Registre qui spécifie le ou les modèles d’identification des formats d’image qu’il peut décoder.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-118">Each decoder has a registry entry that specifies the identifying pattern or patterns of the image formats it can decode.</span></span> <span data-ttu-id="cc1a6-119">Lorsqu’une application doit ouvrir une image, elle demande un décodeur à partir de WIC.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-119">When an application needs to open an image, it requests a decoder from WIC.</span></span> <span data-ttu-id="cc1a6-120">WIC recherche les décodeurs disponibles dans le registre et vérifie chaque entrée du Registre pour un modèle d’identification qui correspond au modèle incorporé dans le fichier image.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-120">WIC looks up the available decoders in the registry, and checks each registry entry for an identifying pattern that matches the pattern embedded in the image file.</span></span> <span data-ttu-id="cc1a6-121">Pour plus d’informations sur les entrées de Registre du décodeur, consultez [entrées de Registre spécifiques au codeur](-wic-decoderregentries.md)</span><span class="sxs-lookup"><span data-stu-id="cc1a6-121">For more information on decoder registry entries, see [Encoder-Specific Registry Entries](-wic-decoderregentries.md)</span></span>

<span data-ttu-id="cc1a6-122">Quand WIC trouve un décodeur unique qui correspond au modèle d’identification dans l’image, il crée une instance du décodeur et lui transmet le fichier image.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-122">When WIC finds a single decoder that matches the identifying pattern in the image, it creates an instance of the decoder and passes the image file to it.</span></span> <span data-ttu-id="cc1a6-123">Si le WIC trouve plusieurs correspondances, il appelle une méthode appelée [**QueryCapability**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-querycapability) sur chaque décodeur correspondant pour arbitrer les deux et rechercher la meilleure correspondance.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-123">If WIC finds more than one match, it invokes a method called [**QueryCapability**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-querycapability) on each matching decoder to arbitrate among them and find the best match.</span></span> <span data-ttu-id="cc1a6-124">Pour plus d’informations, consultez la section [QueryCapabilities](-wic-imp-iwicbitmapdecoder.md) dans [implémentation de IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md).</span><span class="sxs-lookup"><span data-stu-id="cc1a6-124">For more information, see the [QueryCapabilities](-wic-imp-iwicbitmapdecoder.md) section in the [Implementing IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md).</span></span>

## <a name="decoding"></a><span data-ttu-id="cc1a6-125">Décodage</span><span class="sxs-lookup"><span data-stu-id="cc1a6-125">Decoding</span></span>

<span data-ttu-id="cc1a6-126">Une fois que le décodeur approprié a été sélectionné et instancié, l’application communique directement avec le décodeur.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-126">After the appropriate decoder has been selected and instantiated, the application talks directly to the decoder.</span></span> <span data-ttu-id="cc1a6-127">Le décodeur a plusieurs responsabilités, qu’il implémente par le biais de différentes interfaces.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-127">The decoder has several responsibilities, which it implements through various interfaces.</span></span> <span data-ttu-id="cc1a6-128">Ces services peuvent être classés comme suit :</span><span class="sxs-lookup"><span data-stu-id="cc1a6-128">These services can be classified as:</span></span>

-   <span data-ttu-id="cc1a6-129">Services au niveau du conteneur</span><span class="sxs-lookup"><span data-stu-id="cc1a6-129">Container-level services</span></span>
-   <span data-ttu-id="cc1a6-130">Services au niveau de la trame</span><span class="sxs-lookup"><span data-stu-id="cc1a6-130">Frame-level services</span></span>
-   <span data-ttu-id="cc1a6-131">Services d’énumération des métadonnées</span><span class="sxs-lookup"><span data-stu-id="cc1a6-131">Metadata enumeration services</span></span>
-   <span data-ttu-id="cc1a6-132">Transformations du décodeur natif</span><span class="sxs-lookup"><span data-stu-id="cc1a6-132">Native decoder transforms</span></span>
-   <span data-ttu-id="cc1a6-133">Notifications de progression et prise en charge de l’annulation</span><span class="sxs-lookup"><span data-stu-id="cc1a6-133">Progress notifications and cancellation support</span></span>
-   <span data-ttu-id="cc1a6-134">Services de traitement brut</span><span class="sxs-lookup"><span data-stu-id="cc1a6-134">Raw processing services</span></span>

<span data-ttu-id="cc1a6-135">Les services au niveau du conteneur incluent la récupération des miniatures de niveau supérieur (si elles sont prises en charge), de l’aperçu, des contextes de couleur, de la palette (le cas échéant) et du format de conteneur, ainsi que l’accès aux trames d’image individuelles dans le conteneur.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-135">Container-level services include retrieving the top-level thumbnail (if supported), preview, color contexts, palette (if applicable), and container format, as well as providing access to the individual image frames within the container.</span></span> <span data-ttu-id="cc1a6-136">(Certains conteneurs ne contiennent qu’une seule image, tandis que d’autres, tels que TIFF (Tagged Image File Format), peuvent contenir plusieurs frames.) Cet ensemble de services comprend également des informations sur le décodeur lui-même et ses fonctionnalités par rapport à un fichier image spécifique.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-136">(Some containers contain only a single frame while others, such as Tagged Image File Format (TIFF), can contain multiple frames.) This set of services also includes providing information about the decoder itself, and its capabilities with respect to a specific image file.</span></span>

<span data-ttu-id="cc1a6-137">Les frames individuels ont leurs propres miniatures et peuvent également avoir leurs propres contextes de couleur, palettes et autres propriétés, qui sont exposées au niveau du frame.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-137">Individual frames have their own thumbnails, and may also have their own color contexts, palettes, and other properties, which are exposed at the frame level.</span></span> <span data-ttu-id="cc1a6-138">Toutefois, l’opération la plus importante effectuée au niveau de la trame est le décodage réel des bits d’image de ce frame.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-138">The most important operation performed at the frame level, though, is the actual decoding of the image bits for that frame.</span></span>

<span data-ttu-id="cc1a6-139">WIC fournit des lecteurs de métadonnées pour les formats de métadonnées les plus courants (IFD, EXIF, IPTC, XMP, APP0, APP1 et d’autres formats) et prend également en charge l’extensibilité pour les formats de métadonnées tiers.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-139">WIC provides metadata readers for the most common metadata formats (IFD, EXIF, IPTC, XMP, APP0, APP1, and other formats), and also supports extensibility for third-party metadata formats.</span></span> <span data-ttu-id="cc1a6-140">Cela libère le codec de la responsabilité pour l’analyse des métadonnées.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-140">This frees the codec of the responsibility for parsing metadata.</span></span> <span data-ttu-id="cc1a6-141">Toutefois, le codec est responsable de l’énumération des blocs de métadonnées et de la demande d’un lecteur de métadonnées pour chaque bloc.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-141">However, the codec is responsible for enumerating the metadata blocks and requesting a metadata reader for each block.</span></span> <span data-ttu-id="cc1a6-142">WIC effectue la détection pour les gestionnaires de métadonnées de la même façon que pour les codecs, en fonction d’un modèle dans l’en-tête de bloc qui correspond à un modèle dans l’entrée de Registre du gestionnaire de métadonnées.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-142">WIC performs discovery for metadata handlers the same way it does for codecs, based on a pattern in the block header matching a pattern in the metadata handler’s registry entry.</span></span> <span data-ttu-id="cc1a6-143">Pour plus d’informations, consultez les [entrées de Registre spécifiques à l’encodeur](-wic-decoderregentries.md)</span><span class="sxs-lookup"><span data-stu-id="cc1a6-143">For more information, see the [Encoder-Specific Registry Entries](-wic-decoderregentries.md)</span></span>

<span data-ttu-id="cc1a6-144">Les décodeurs ne sont pas requis pour prendre en charge en mode natif les opérations de transformation, mais cela permet des optimisations de performances significatives qui améliorent l’expérience de l’utilisateur final.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-144">Decoders are not required to natively support transform operations, but doing so enables significant performance optimizations that provide a better end-user experience.</span></span> <span data-ttu-id="cc1a6-145">Par exemple, une application peut créer un pipeline de diverses transformations (mise à l’échelle, rognage, rotation et conversion de format de pixel) pour effectuer une réalisation sur une image avant le rendu de l’image.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-145">For example, an application can create a pipeline of various transforms (scaling, cropping, rotation, and pixel format conversion) to perform on an image before the image is rendered.</span></span> <span data-ttu-id="cc1a6-146">Pour plus d’informations sur les pipelines de transformation, consultez [IWICBitmapSource](-wic-imp-iwicbitmapsource.md).</span><span class="sxs-lookup"><span data-stu-id="cc1a6-146">For more information on transform pipelines, see [IWICBitmapSource](-wic-imp-iwicbitmapsource.md).</span></span> <span data-ttu-id="cc1a6-147">Après la création d’un pipeline de transformation, l’application demande la transformation finale dans le pipeline pour produire la bitmap qui résulte de l’application de toutes les transformations à la source de l’image.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-147">After creating a transform pipeline, the application requests the final transform in the pipeline to produce the bitmap that results from applying all the transforms to the image source.</span></span> <span data-ttu-id="cc1a6-148">À ce stade, si le décodeur lui-même peut effectuer des opérations de transformation, WIC demande les transformations demandées qu’il peut effectuer.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-148">At that point, if the decoder itself is able to perform transform operations, WIC asks which of the requested transforms it can perform.</span></span> <span data-ttu-id="cc1a6-149">Les transformations demandées que le décodeur ne peut pas effectuer seront exécutées par WIC sur l’image décodée avant d’être renvoyée à l’appelant.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-149">Any requested transforms the decoder cannot perform will be performed by WIC on the decoded image before returning it to the caller.</span></span> <span data-ttu-id="cc1a6-150">Ce pipeline de transformation optimisé offre de meilleures performances que l’exécution de chaque transformation de manière séquentielle dans la mémoire, en particulier quand une partie ou la totalité des transformations peut être accomplie pendant le processus de décodage.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-150">This optimized transform pipeline provides better performance than performing each transform sequentially in memory, particularly when some or all of the transforms can be accomplished during the decoding process.</span></span>

<span data-ttu-id="cc1a6-151">Les notifications de progression et la prise en charge de l’annulation permettent à une application de demander des notifications de progression pour les opérations de longue durée, et permettent également à l’application de donner à l’utilisateur la possibilité d’annuler une opération qui prend trop de temps.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-151">Progress notifications and cancellation support enable an application to request progress notifications for lengthy operations, and also enable the application to give the user an opportunity to cancel an operation that is taking too long.</span></span> <span data-ttu-id="cc1a6-152">Cela est important, car si un utilisateur ne peut pas annuler une opération, il peut penser que le processus a été suspendu et essayer de l’annuler en fermant l’application.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-152">This is important because if a user cannot cancel an operation, he or she may feel the process has hung, and try to cancel it by closing the application.</span></span>

<span data-ttu-id="cc1a6-153">Ces interfaces sont décrites en détail dans la section relative à l' [implémentation d’un décodeur de WIC-Enabled](-wic-implementingwicdecoder.md).</span><span class="sxs-lookup"><span data-stu-id="cc1a6-153">These interfaces are described in detail in the section on [Implementing a WIC-Enabled Decoder](-wic-implementingwicdecoder.md).</span></span>

<span data-ttu-id="cc1a6-154">Les services de traitement bruts incluent l’ajustement des paramètres de l’appareil photo, tels que l’exposition, le contraste et la netteté, ou la modification de l’espace colorimétrique avant le traitement des bits bruts.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-154">Raw processing services include adjusting camera settings, such as exposure, contrast, and sharpening, or changing the color space before processing the raw bits.</span></span>

## <a name="encoding"></a><span data-ttu-id="cc1a6-155">Encodage</span><span class="sxs-lookup"><span data-stu-id="cc1a6-155">Encoding</span></span>

<span data-ttu-id="cc1a6-156">Comme les décodeurs, les encodeurs ont des responsabilités qu’ils implémentent via des interfaces.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-156">Like decoders, encoders have responsibilities that they implement through interfaces.</span></span> <span data-ttu-id="cc1a6-157">Les services fournis par les encodeurs sont complémentaires aux services fournis par les décodeurs, sauf qu’ils écrivent des données d’image plutôt que de les lire.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-157">The services that encoders provide are complementary to the services provided by decoders, except they write out image data rather than reading it.</span></span> <span data-ttu-id="cc1a6-158">Les encodeurs fournissent également des services dans les catégories suivantes :</span><span class="sxs-lookup"><span data-stu-id="cc1a6-158">Encoders also provide services in the following categories:</span></span>

-   <span data-ttu-id="cc1a6-159">Services au niveau du conteneur</span><span class="sxs-lookup"><span data-stu-id="cc1a6-159">Container-level services</span></span>
-   <span data-ttu-id="cc1a6-160">Services au niveau de la trame</span><span class="sxs-lookup"><span data-stu-id="cc1a6-160">Frame-level services</span></span>
-   <span data-ttu-id="cc1a6-161">Énumération des métadonnées et services de mise à jour</span><span class="sxs-lookup"><span data-stu-id="cc1a6-161">Metadata enumeration and update services</span></span>
-   <span data-ttu-id="cc1a6-162">Notification de progression et prise en charge de l’annulation</span><span class="sxs-lookup"><span data-stu-id="cc1a6-162">Progress notification and cancellation support</span></span>

<span data-ttu-id="cc1a6-163">Les services au niveau du conteneur pour un encodeur incluent la définition de la miniature de niveau supérieur (si prise en charge), de l’aperçu et de la palette (le cas échéant), et l’itération au sein des trames d’image individuelles afin qu’elles puissent être sérialisées dans le conteneur.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-163">Container-level services for an encoder include setting the top-level thumbnail (if supported), preview, and palette (if applicable), and iterating through the individual image frames so they can be serialized into the container.</span></span>

<span data-ttu-id="cc1a6-164">Les services au niveau de la trame pour un encodeur reflètent ceux du décodeur, sauf qu’ils écrivent les données de l’image, la miniature et toute palette associée ou autre composant, plutôt que de les lire.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-164">Frame-level services for an encoder mirror those for the decoder, except that they write out the image data, thumbnail, and any associated palette or other component, rather than reading them.</span></span>

<span data-ttu-id="cc1a6-165">En outre, les services d’énumération des métadonnées pour un encodeur incluent l’itération au sein des blocs de métadonnées à écrire, et l’appel des enregistreurs de métadonnées appropriés pour sérialiser les métadonnées sur le disque.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-165">Also, metadata enumeration services for an encoder include iterating through the metadata blocks to be written, and invoking the appropriate metadata writers to serialize the metadata to disk.</span></span>

<span data-ttu-id="cc1a6-166">Ces interfaces sont décrites en détail dans la section relative à l' [implémentation d’un Encodeur WIC-Enabled](-wic-implementingwicencoder.md).</span><span class="sxs-lookup"><span data-stu-id="cc1a6-166">These interfaces are described in detail in the section on [Implementing a WIC-Enabled Encoder](-wic-implementingwicencoder.md).</span></span>

## <a name="the-lifetime-of-a-codec"></a><span data-ttu-id="cc1a6-167">Durée de vie d’un codec</span><span class="sxs-lookup"><span data-stu-id="cc1a6-167">The Lifetime of a Codec</span></span>

<span data-ttu-id="cc1a6-168">Un codec WIC est instancié pour gérer une seule image et a généralement une durée de vie réduite.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-168">A WIC codec is instantiated to handle a single image, and usually has a short lifetime.</span></span> <span data-ttu-id="cc1a6-169">Elle est créée lorsqu’une image est chargée et libérée lorsque l’image est fermée.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-169">It’s created when an image is loaded and is released when the image is closed.</span></span> <span data-ttu-id="cc1a6-170">Une application peut utiliser un grand nombre de codecs simultanément avec des durées de vie qui se chevauchent (le fait de faire défiler un répertoire contenant des centaines d’images) et plusieurs applications peuvent le faire en même temps.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-170">An application may use a large number of codecs simultaneously with overlapping lifetimes (think of scrolling through a directory containing hundreds of images), and multiple applications may be doing this at the same time.</span></span>

<span data-ttu-id="cc1a6-171">Bien que certains codecs aient une durée de vie limitée à la durée de vie du processus dans lequel ils vivent, ce n’est pas le cas avec les codecs WIC.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-171">Although some codecs have a lifetime that is scoped to the lifetime of the process in which they live, this is not the case with WIC codecs.</span></span> <span data-ttu-id="cc1a6-172">La Galerie de photos Windows Vista, l’Explorateur Windows et la visionneuse de photos, ainsi que de nombreuses autres applications, s’appuient sur WIC et utiliseront votre codec pour afficher des images et des miniatures.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-172">The Windows Vista Photo Gallery, Windows Explorer, and Photo Viewer, as well as numerous other applications, are built on WIC and will be using your codec to display images and thumbnails.</span></span> <span data-ttu-id="cc1a6-173">Si la durée de vie de votre codec est limitée à la durée de vie du processus, chaque fois qu’une image ou une miniature était affichée dans l’Explorateur Windows Vista, le codec instancié pour décoder cette image restera en mémoire jusqu’à ce que l’utilisateur redémarre son ordinateur.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-173">If the lifetime of your codec were scoped to the lifetime of the process, every time an image or thumbnail was displayed in the Windows Vista Explorer, the codec instantiated to decode that image would remain in memory until the next time the user restarted his or her computer.</span></span> <span data-ttu-id="cc1a6-174">Si votre CODEC n’est jamais déchargé, ses ressources sont en fait « divulguées », car elles ne peuvent pas être utilisées par un autre composant du système.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-174">If your codec is never unloaded, its resources are, in effect, "leaked" because they can't be used by any other component in the system.</span></span>

## <a name="how-to-wic-enabled-a-codec"></a><span data-ttu-id="cc1a6-175">Comment activer un codec avec WIC</span><span class="sxs-lookup"><span data-stu-id="cc1a6-175">How to WIC-enabled a Codec</span></span>

1.  <span data-ttu-id="cc1a6-176">Implémentez une classe de décodeur au niveau du conteneur et une classe de décodeur au niveau de la trame qui expose les interfaces WIC requises pour décoder les images et itérer au sein des blocs de métadonnées.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-176">Implement a container-level decoder class and a frame-level decoder class that exposes the required WIC interfaces for decoding images and iterating through blocks of metadata.</span></span> <span data-ttu-id="cc1a6-177">Cela permet à toutes les applications WIC d’interagir avec votre codec de la même façon qu’elles interagissent avec les formats d’image standard.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-177">This enables all WIC-based applications to interact with your codec the same way they interact with standard image formats.</span></span>
2.  <span data-ttu-id="cc1a6-178">Implémentez une classe de codeur au niveau du conteneur et une classe de codeur au niveau de la trame qui expose les interfaces WIC requises pour encoder des images et sérialiser des blocs de métadonnées dans un fichier image.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-178">Implement a container-level encoder class and a frame-level encoder class that exposes the required WIC interfaces for encoding images and serializing blocks of metadata into an image file.</span></span>
3.  <span data-ttu-id="cc1a6-179">Si votre format de conteneur n’est pas basé sur un conteneur TIFF ou JPEG, vous devrez peut-être écrire des gestionnaires de métadonnées pour les formats de métadonnées courants (EXIF, XMP).</span><span class="sxs-lookup"><span data-stu-id="cc1a6-179">If your container format is not based on a TIFF or JPEG container, you may need to write metadata handlers for the common metadata formats (EXIF, XMP).</span></span> <span data-ttu-id="cc1a6-180">Toutefois, si vous utilisez un format de conteneur basé sur TIFF ou JPEG, cela n’est pas nécessaire, car vous pouvez déléguer aux gestionnaires de métadonnées fournis par le système.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-180">However, if you use a TIFF-based or JPEG-based container format, this is not necessary because you can delegate to the system-provided metadata handlers.</span></span>
4.  <span data-ttu-id="cc1a6-181">Incorporez un modèle d’identification unique (nous vous recommandons d’utiliser un GUID) dans tous vos fichiers image.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-181">Embed a unique identifying pattern (we recommend a GUID) in all your image files.</span></span> <span data-ttu-id="cc1a6-182">Cela permet à votre format d’image d’être mis en correspondance avec votre codec pendant la découverte.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-182">This enables your image format to be matched against your codec during the discovery.</span></span> <span data-ttu-id="cc1a6-183">Si vous écrivez un wrapper de WIC pour un format d’image existant, vous devez trouver un modèle de bits que l’encodeur écrit toujours dans ses fichiers image qui est propre à ce format d’image, et l’utiliser comme modèle d’identification.)</span><span class="sxs-lookup"><span data-stu-id="cc1a6-183">If you are writing a WIC wrapper for an existing image format, you must find a pattern of bits that the encoder always writes into its image files that’s unique to that image format, and use this as the identifying pattern.)</span></span>
5.  <span data-ttu-id="cc1a6-184">Inscrivez votre codec au moment de l’installation.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-184">Register your codec at installation time.</span></span> <span data-ttu-id="cc1a6-185">Cela permet à votre codec d’être découvert au moment de l’exécution en faisant correspondre le modèle d’identification dans le Registre avec le modèle incorporé dans le fichier image.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-185">This enables your codec to be discovered at run time by matching the identifying pattern in the registry with the pattern embedded in the image file.</span></span>
6.  <span data-ttu-id="cc1a6-186">À compter de Windows 7, WIC exige que les codecs soient de type cloisonnement COM « both ».</span><span class="sxs-lookup"><span data-stu-id="cc1a6-186">As of Windows 7, WIC requires that codecs be of COM apartment type "Both".</span></span> <span data-ttu-id="cc1a6-187">Cela signifie que vous devez effectuer le verrouillage approprié pour gérer les appelants inter-cloisonnement et les appelants dans les scénarios multithread.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-187">This means that you must do the appropriate locking to handle cross-apartment callers and callers in multi-threaded scenarios.</span></span> <span data-ttu-id="cc1a6-188">Pour plus d’informations, consultez la section suivante sur la prise en charge de Multi-Threaded Apartment.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-188">For more information, see the next section on multi-threaded apartment support.</span></span>
7.  <span data-ttu-id="cc1a6-189">Prise en charge des plateformes 64 bits : pour Windows 7, WIC exige que les codecs WIC tiers soient fournis comme fichiers binaires natifs 32 bits et 64 bits.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-189">Support for 64-bit platforms: For Windows 7, WIC will require that third-party WIC codecs be delivered as both 32-bit and 64-bit native binaries.</span></span> <span data-ttu-id="cc1a6-190">En outre, la forme 32 bits doit être installée et exécutée sur les systèmes 64 bits, et le programme d’installation du codec Windows 7 tiers doit installer à la fois les binaires 32 bits et 64 bits sur les systèmes 64 bits.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-190">Further, the 32-bit form must install and run on 64-bit systems, and the third party Windows 7 codec installer must install both the 32-bit and 64-bit binaries on 64-bit systems.</span></span>

## <a name="multi-threaded-apartment-support-in-wic"></a><span data-ttu-id="cc1a6-191">Prise en charge du cloisonnement multithread dans WIC</span><span class="sxs-lookup"><span data-stu-id="cc1a6-191">Multi-Threaded Apartment Support in WIC</span></span>

<span data-ttu-id="cc1a6-192">Les objets d’un cloisonnement multithread (MTA) peuvent être appelés simultanément par n’importe quel nombre de threads dans le MTA.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-192">Objects within a Multi-Threaded Apartment (MTA) may be called concurrently by any number of threads within the MTA.</span></span> <span data-ttu-id="cc1a6-193">Cela permet d’améliorer les performances sur les systèmes à plusieurs cœurs et certains scénarios de serveur.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-193">This allows for better performance on multi-core systems and certain server scenarios.</span></span> <span data-ttu-id="cc1a6-194">En outre, les codecs WIC dans un MTA peuvent appeler d’autres objets dans le MTA sans le coût de marshaling associé à l’appel entre les threads dans différents Apartments STA.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-194">In addition, WIC codecs in an MTA can call other objects in the MTA without the marshalling cost associated with calling between threads in different STA apartments.</span></span> <span data-ttu-id="cc1a6-195">Dans Windows 7, tous les codecs WIC intégrés ont été mis à jour pour prendre en charge les MTA, y compris JPEG, TIFF, PNG, GIF, ICO et BMP.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-195">In Windows 7, all in-box WIC codecs have been updated to support MTAs, including JPEG, TIFF, PNG, GIF, ICO, and BMP.</span></span> <span data-ttu-id="cc1a6-196">Il est fortement recommandé d’écrire des codecs tiers pour prendre en charge les MTA.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-196">It is highly recommended that third-party codecs be written to support MTAs.</span></span> <span data-ttu-id="cc1a6-197">Les codecs tiers qui ne prennent pas en charge les MTA entraînent des coûts de performances significatifs dans les applications multithread en raison du marshaling.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-197">Third-party codecs that do not to support MTAs cause significant performance costs in multi-threaded applications because of marshaling.</span></span> <span data-ttu-id="cc1a6-198">L’activation de la prise en charge de MTA nécessite une synchronisation appropriée à implémenter dans le codec tiers.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-198">Enabling MTA support requires proper synchronization to be implemented in the third-party codec.</span></span> <span data-ttu-id="cc1a6-199">L’implémentation exacte de ces techniques de synchronisation dépasse le cadre de ce document.</span><span class="sxs-lookup"><span data-stu-id="cc1a6-199">Exact implementation of these synchronization techniques is beyond the scope of this paper.</span></span> <span data-ttu-id="cc1a6-200">Pour plus d’informations sur la synchronisation des objets COM, consultez [comprendre et utiliser les modèles de threads com](/previous-versions/ms809971(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="cc1a6-200">For more information on synchronizing COM objects, see [Understanding and Using COM Threading Models](/previous-versions/ms809971(v=msdn.10)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="cc1a6-201">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="cc1a6-201">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="cc1a6-202">**Méthodologique**</span><span class="sxs-lookup"><span data-stu-id="cc1a6-202">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="cc1a6-203">Introduction (écriture d’un CODEC WIC-Enabled)</span><span class="sxs-lookup"><span data-stu-id="cc1a6-203">Introduction (How to Write a WIC-Enabled CODEC)</span></span>](-wic-howtowriteacodec-intro.md)
</dt> <dt>

[<span data-ttu-id="cc1a6-204">Implémentation d’un décodeur WIC-Enabled</span><span class="sxs-lookup"><span data-stu-id="cc1a6-204">Implementing a WIC-Enabled Decoder</span></span>](-wic-implementingwicdecoder.md)
</dt> <dt>

[<span data-ttu-id="cc1a6-205">Comment écrire un CODEC WIC-Enabled</span><span class="sxs-lookup"><span data-stu-id="cc1a6-205">How to Write a WIC-Enabled CODEC</span></span>](-wic-howtowriteacodec.md)
</dt> <dt>

[<span data-ttu-id="cc1a6-206">Vue d’ensemble du composant Windows Imaging</span><span class="sxs-lookup"><span data-stu-id="cc1a6-206">Windows Imaging Component Overview</span></span>](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[<span data-ttu-id="cc1a6-207">Vue d’ensemble des métadonnées WIC</span><span class="sxs-lookup"><span data-stu-id="cc1a6-207">WIC Metadata Overview</span></span>](-wic-about-metadata.md)
</dt> </dl>

 

 



