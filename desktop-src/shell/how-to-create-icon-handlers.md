---
description: Décrit comment créer un gestionnaire pour les affectations d’icônes personnalisées.
ms.assetid: 23ed3a21-cf62-4440-b983-fae23aa56890
title: Comment créer des gestionnaires d’icône
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e2c620b6f6a4c05f8996a26c8365e4f4201ee0b4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104973171"
---
# <a name="how-to-create-icon-handlers"></a><span data-ttu-id="b5fbe-103">Comment créer des gestionnaires d’icône</span><span class="sxs-lookup"><span data-stu-id="b5fbe-103">How to Create Icon Handlers</span></span>

<span data-ttu-id="b5fbe-104">Un [type de fichier](fa-file-types.md) est souvent associé à une icône personnalisée, afin de rendre ses membres facilement identifiables dans l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-104">A [file type](fa-file-types.md) often has a custom icon associated with it, to make its members easily recognizable in Windows Explorer.</span></span> <span data-ttu-id="b5fbe-105">La méthode la plus simple pour assigner une icône personnalisée à un type de fichier consiste à enregistrer le fichier de l’icône.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-105">The simplest way to assign a custom icon to a file type is to register the icon's file.</span></span> <span data-ttu-id="b5fbe-106">Toutefois, une icône inscrite de cette façon sera la même pour tous les membres du type de fichier.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-106">However, an icon registered in this way will be the same for all members of the file type.</span></span> <span data-ttu-id="b5fbe-107">Vous pouvez disposer d’une plus grande flexibilité pour assigner des icônes aux membres du type de fichier en implémentant un *Gestionnaire d’icône*.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-107">You can have much more flexibility in assigning icons to the members of the file type by implementing an *icon handler*.</span></span>

<span data-ttu-id="b5fbe-108">Un gestionnaire d’icônes est un type de gestionnaire d’extensions de Shell qui vous permet d’affecter dynamiquement des icônes aux membres d’un type de fichier.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-108">An icon handler is a type of Shell extension handler that allows you to dynamically assign icons to the members of a file type.</span></span> <span data-ttu-id="b5fbe-109">Chaque fois qu’un fichier du type est affiché, l’interpréteur de commandes interroge le gestionnaire pour obtenir l’icône appropriée.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-109">Every time a file of the type is displayed, the Shell queries the handler for the appropriate icon.</span></span> <span data-ttu-id="b5fbe-110">Par exemple, un gestionnaire d’icône peut assigner des icônes différentes à différents membres du type de fichier, ou faire varier l’icône en fonction de l’état actuel du fichier.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-110">For instance, an icon handler can assign different icons to different members of the file type, or vary the icon based on the current state of the file.</span></span>

<span data-ttu-id="b5fbe-111">Les procédures générales d’implémentation et d’inscription d’un gestionnaire d’extensions de Shell sont décrites dans [création de gestionnaires d’extensions de Shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="b5fbe-111">The general procedures for implementing and registering a Shell extension handler are discussed in [Creating Shell Extension Handlers](handlers.md).</span></span> <span data-ttu-id="b5fbe-112">Ce document se concentre sur les aspects de l’implémentation qui sont spécifiques aux gestionnaires d’icônes.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-112">This document focuses on those aspects of implementation that are specific to icon handlers.</span></span>

-   [<span data-ttu-id="b5fbe-113">Implémentation de gestionnaires d’icône</span><span class="sxs-lookup"><span data-stu-id="b5fbe-113">Implementing Icon Handlers</span></span>](#step-1-implementing-icon-handlers)
-   [<span data-ttu-id="b5fbe-114">Implémentation de l’interface IExtractIcon</span><span class="sxs-lookup"><span data-stu-id="b5fbe-114">Implementing the IExtractIcon Interface</span></span>](#step-2-implementing-the-iextracticon-interface)
-   [<span data-ttu-id="b5fbe-115">Inscription des gestionnaires d’icône</span><span class="sxs-lookup"><span data-stu-id="b5fbe-115">Registering Icon Handlers</span></span>](#step-3-registering-icon-handlers)
-   [<span data-ttu-id="b5fbe-116">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="b5fbe-116">Related topics</span></span>](#related-topics)

## <a name="instructions"></a><span data-ttu-id="b5fbe-117">Instructions</span><span class="sxs-lookup"><span data-stu-id="b5fbe-117">Instructions</span></span>

### <a name="step-1-implementing-icon-handlers"></a><span data-ttu-id="b5fbe-118">Étape 1 : implémentation des gestionnaires d’icône</span><span class="sxs-lookup"><span data-stu-id="b5fbe-118">Step 1: Implementing Icon Handlers</span></span>

<span data-ttu-id="b5fbe-119">Comme tous les gestionnaires d’extensions de Shell, les gestionnaires d’icônes sont des objets COM (Component Object Model) in-process implémentés en tant que dll.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-119">Like all Shell extension handlers, icon handlers are in-process Component Object Model (COM) objects implemented as DLLs.</span></span> <span data-ttu-id="b5fbe-120">Ils doivent exporter deux interfaces en plus de [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) et [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona).</span><span class="sxs-lookup"><span data-stu-id="b5fbe-120">They must export two interfaces in addition to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) and [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona).</span></span>

<span data-ttu-id="b5fbe-121">L’interpréteur de commandes Initialise le gestionnaire via son interface [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="b5fbe-121">The Shell initializes the handler through its [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="b5fbe-122">Elle utilise cette interface pour demander l’identificateur de classe du gestionnaire (CLSID) et lui fournit le nom du fichier.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-122">It uses this interface to request the handler's class identifier (CLSID) and provides it with the file's name.</span></span> <span data-ttu-id="b5fbe-123">Le reste de l’opération a lieu par le biais de l’interface [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) .</span><span class="sxs-lookup"><span data-stu-id="b5fbe-123">The rest of the operation takes place through the [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) interface.</span></span> <span data-ttu-id="b5fbe-124">Pour obtenir une description générale de l’implémentation des gestionnaires d’extensions de Shell, y compris l’interface **IPersistFile** , consultez [création de gestionnaires d’extension de Shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="b5fbe-124">For a general discussion of how to implement Shell extension handlers, including the **IPersistFile** interface, see [Creating Shell Extension Handlers](handlers.md).</span></span> <span data-ttu-id="b5fbe-125">Le reste de ce document explique comment implémenter l’interface **IExtractIcon** .</span><span class="sxs-lookup"><span data-stu-id="b5fbe-125">The remainder of this document discusses how to implement the **IExtractIcon** interface.</span></span>

### <a name="step-2-implementing-the-iextracticon-interface"></a><span data-ttu-id="b5fbe-126">Étape 2 : implémentation de l’interface IExtractIcon</span><span class="sxs-lookup"><span data-stu-id="b5fbe-126">Step 2: Implementing the IExtractIcon Interface</span></span>

<span data-ttu-id="b5fbe-127">Une fois l’interface initialisée, l’interpréteur de commandes utilise l’interface [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) du gestionnaire pour demander l’icône appropriée.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-127">After the interface is initialized, the Shell uses the handler's [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) interface to request the appropriate icon.</span></span> <span data-ttu-id="b5fbe-128">L’interface possède deux méthodes : [**IExtractIcon :: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) et [**IExtractIcon :: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span><span class="sxs-lookup"><span data-stu-id="b5fbe-128">The interface has two methods: [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) and [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span></span>

<span data-ttu-id="b5fbe-129">Les icônes sont identifiées par leur emplacement dans le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-129">Icons are identified by their location in the file system.</span></span> <span data-ttu-id="b5fbe-130">La méthode [**IExtractIcon :: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) est appelée pour demander ces informations.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-130">The [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) method is called to request this information.</span></span> <span data-ttu-id="b5fbe-131">Définissez le paramètre *szIconFile* sur le nom de fichier.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-131">Set the *szIconFile* parameter to the file name.</span></span> <span data-ttu-id="b5fbe-132">Si le fichier contient plusieurs icônes, définissez *piIndex* sur l’index de l’icône.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-132">If there is more than one icon in the file, set *piIndex* to the icon's index.</span></span> <span data-ttu-id="b5fbe-133">Assignez les valeurs appropriées aux deux variables de l’indicateur.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-133">Assign appropriate values to the two flag variables.</span></span> <span data-ttu-id="b5fbe-134">Si vous ne souhaitez pas spécifier de nom de fichier ou si vous ne souhaitez pas que le shell extraie l’icône, définissez l’indicateur **Gil \_ NOTFILENAME** dans le paramètre *pwFlags* .</span><span class="sxs-lookup"><span data-stu-id="b5fbe-134">If you do not want to specify a file name, or if you do not want the Shell to extract the icon, set the **GIL\_NOTFILENAME** flag in the *pwFlags* parameter.</span></span> <span data-ttu-id="b5fbe-135">Vous n’avez pas besoin d’affecter une valeur à *szIconFile*, mais le gestionnaire doit fournir des handles d’icône lorsque l’interpréteur de commandes appelle [**IExtractIcon :: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span><span class="sxs-lookup"><span data-stu-id="b5fbe-135">You do not need to assign a value to *szIconFile*, but the handler must provide icon handles when the Shell calls [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span></span>

<span data-ttu-id="b5fbe-136">Si vous retournez un nom de fichier, le shell tente normalement de charger l’icône à partir de son cache.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-136">If you return a file name, the Shell normally attempts to load the icon from its cache.</span></span> <span data-ttu-id="b5fbe-137">Pour empêcher le chargement d’une icône mise en cache, définissez l’indicateur **Gil \_ DONTCACHE** dans le paramètre *pwFlags* .</span><span class="sxs-lookup"><span data-stu-id="b5fbe-137">To prevent the loading of a cached icon, set the **GIL\_DONTCACHE** flag in the *pwFlags* parameter.</span></span> <span data-ttu-id="b5fbe-138">Si une icône mise en cache n’est pas chargée, l’interpréteur de commandes appelle [**IExtractIcon :: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) pour demander le handle d’icône.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-138">If a cached icon is not loaded, the Shell then calls [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) to request the icon handle.</span></span>

<span data-ttu-id="b5fbe-139">Si un fichier et un index ont été spécifiés par [**IExtractIcon :: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation), ils sont passés à [**IExtractIcon :: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) dans les paramètres *pszFile* et *nIconIndex* , respectivement.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-139">If a file and index were specified by [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation), they are passed to [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) in the *pszFile* and *nIconIndex* parameters, respectively.</span></span> <span data-ttu-id="b5fbe-140">Si un nom de fichier est fourni, votre gestionnaire peut retourner \_ la valeur S false pour que le shell extraie l’icône.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-140">If a file name is provided, your handler can return S\_FALSE to have the Shell extract the icon.</span></span> <span data-ttu-id="b5fbe-141">Dans le cas contraire, votre gestionnaire doit extraire ou créer des icônes de grande taille et de petite taille, et assigner leurs descripteurs HICON aux paramètres *phiconLarge* et *phiconSmall* .</span><span class="sxs-lookup"><span data-stu-id="b5fbe-141">Otherwise, your handler must extract or otherwise produce large and small icons, and assign their HICON handles to the *phiconLarge* and *phiconSmall* parameters.</span></span> <span data-ttu-id="b5fbe-142">L’interpréteur de commandes ajoute les icônes à son cache pour accélérer les appels suivants au gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-142">The Shell adds the icons to its cache to expedite subsequent calls to the handler.</span></span>

### <a name="step-3-registering-icon-handlers"></a><span data-ttu-id="b5fbe-143">Étape 3 : enregistrement des gestionnaires d’icône</span><span class="sxs-lookup"><span data-stu-id="b5fbe-143">Step 3: Registering Icon Handlers</span></span>

<span data-ttu-id="b5fbe-144">Lorsque vous [Enregistrez de manière statique une icône](icon.md) pour un [type de fichier](fa-file-types.md), vous créez une sous-clé **DefaultIcon** sous le ProgID pour le type de fichier.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-144">When you [statically register an icon](icon.md) for a [file type](fa-file-types.md), you create a **DefaultIcon** subkey under the ProgID for the file type.</span></span> <span data-ttu-id="b5fbe-145">Sa valeur par défaut est le fichier qui contient l’icône.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-145">Its default value is set to the file that contains the icon.</span></span> <span data-ttu-id="b5fbe-146">Pour inscrire un gestionnaire d’icône, vous devez toujours disposer de la sous-clé **DefaultIcon** , mais sa valeur par défaut doit être définie sur « %1 ».</span><span class="sxs-lookup"><span data-stu-id="b5fbe-146">To register an icon handler, you must still have the **DefaultIcon** subkey, but its default value must be set to "%1".</span></span> <span data-ttu-id="b5fbe-147">Ajoutez une sous-clé **IconHandler** à la sous-clé **shellex** de la sous-clé ProgID et définissez sa valeur par défaut sur la forme de chaîne du GUID CLSID du gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-147">Add an **IconHandler** subkey to the **Shellex** subkey of the ProgID subkey, and set its default value to the string form of the handler's CLSID GUID.</span></span> <span data-ttu-id="b5fbe-148">Pour obtenir une présentation générale de l’inscription des gestionnaires d’extensions de Shell, consultez [création de gestionnaires d’extensions de Shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="b5fbe-148">For a general discussion of how to register Shell extension handlers, see [Creating Shell Extension Handlers](handlers.md).</span></span>

<span data-ttu-id="b5fbe-149">L’exemple suivant modifie l’entrée de Registre à partir de [Personnalisation des icônes](icon.md) afin que le type de fichier. MYP utilise désormais un gestionnaire de menu contextuel au lieu d’une icône définie statiquement.</span><span class="sxs-lookup"><span data-stu-id="b5fbe-149">The following example modifies the registry entry from [Customizing Icons](icon.md) so that the .myp file type now uses a shortcut menu handler instead of a statically defined icon.</span></span>

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
   MyProgram.1
      (Default) = MyProgram Application
      DefaultIcon
         (Default) = %1
      Shellex
         IconHandler
            (Default) = {The handler's CLSID GUID}
```

## <a name="related-topics"></a><span data-ttu-id="b5fbe-150">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="b5fbe-150">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b5fbe-151">Création de gestionnaires d’extensions d’environnement</span><span class="sxs-lookup"><span data-stu-id="b5fbe-151">Creating Shell Extension Handlers</span></span>](handlers.md)
</dt> <dt>

[<span data-ttu-id="b5fbe-152">**IPersistFile**</span><span class="sxs-lookup"><span data-stu-id="b5fbe-152">**IPersistFile**</span></span>](/windows/win32/api/objidl/nn-objidl-ipersistfile)
</dt> <dt>

[<span data-ttu-id="b5fbe-153">**IExtractIcon**</span><span class="sxs-lookup"><span data-stu-id="b5fbe-153">**IExtractIcon**</span></span>](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona)
</dt> </dl>

 

 
