---
description: Les gestionnaires de superposition d’icône sont des objets COM (Component Object Model) in-process, implémentés en tant que dll.
ms.assetid: ADF27BFD-CC96-43F9-9EBB-DEBE0DEA7B92
title: Comment implémenter des gestionnaires de superposition d’icône
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e22c1057f65c50b31c6627846ec77103827a0283
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104973139"
---
# <a name="how-to-implement-icon-overlay-handlers"></a><span data-ttu-id="80aef-103">Comment implémenter des gestionnaires de superposition d’icône</span><span class="sxs-lookup"><span data-stu-id="80aef-103">How to Implement Icon Overlay Handlers</span></span>

<span data-ttu-id="80aef-104">Les gestionnaires de superposition d’icône sont des objets COM (Component Object Model) in-process, implémentés en tant que dll.</span><span class="sxs-lookup"><span data-stu-id="80aef-104">Icon overlay handlers are in-process Component Object Model (COM) objects, implemented as DLLs.</span></span> <span data-ttu-id="80aef-105">Ils exportent une interface en plus de [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IShellIconOverlayIdentifier**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishelliconoverlayidentifier).</span><span class="sxs-lookup"><span data-stu-id="80aef-105">They export one interface in addition to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IShellIconOverlayIdentifier**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishelliconoverlayidentifier).</span></span> <span data-ttu-id="80aef-106">Cette interface a trois méthodes : [**IShellIconOverlayIdentifier :: GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo), [**IShellIconOverlayIdentifier :: getPriority,**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority)et [**IShellIconOverlayIdentifier :: IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof).</span><span class="sxs-lookup"><span data-stu-id="80aef-106">This interface has three methods: [**IShellIconOverlayIdentifier::GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo), [**IShellIconOverlayIdentifier::GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority), and [**IShellIconOverlayIdentifier::IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof).</span></span>

## <a name="instructions"></a><span data-ttu-id="80aef-107">Instructions</span><span class="sxs-lookup"><span data-stu-id="80aef-107">Instructions</span></span>

### <a name="step-1-implementing-getoverlayinfo"></a><span data-ttu-id="80aef-108">Étape 1 : implémentation de GetOverlayInfo</span><span class="sxs-lookup"><span data-stu-id="80aef-108">Step 1: Implementing GetOverlayInfo</span></span>

<span data-ttu-id="80aef-109">La méthode [**GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) est d’abord appelée pendant l’initialisation.</span><span class="sxs-lookup"><span data-stu-id="80aef-109">The [**GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) method is first called during initialization.</span></span> <span data-ttu-id="80aef-110">La méthode retourne le chemin d’accès qualifié complet du fichier qui contient l’image de superposition d’icône et son index de base zéro dans le fichier.</span><span class="sxs-lookup"><span data-stu-id="80aef-110">The method returns the fully qualified path of the file that contains the icon overlay image, and its zero-based index within the file.</span></span> <span data-ttu-id="80aef-111">L’interpréteur de commandes ajoute ensuite l’image à la liste d’images système.</span><span class="sxs-lookup"><span data-stu-id="80aef-111">The Shell then adds the image to the system image list.</span></span> <span data-ttu-id="80aef-112">Les superpositions d’icône peuvent être contenues dans n’importe quel type de fichier standard, y compris. exe,. dll et. ico.</span><span class="sxs-lookup"><span data-stu-id="80aef-112">Icon overlays can be contained in any of the standard file types, including .exe, .dll, and .ico.</span></span>

<span data-ttu-id="80aef-113">Une fois l’initialisation terminée, l’interpréteur de commandes appelle [**GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) lorsqu’il doit afficher la superposition d’icône du gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="80aef-113">After initialization is complete, the Shell calls [**GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) when it needs to display the handler's icon overlay.</span></span> <span data-ttu-id="80aef-114">La méthode doit retourner le même nom de fichier et le même index qu’au cours de l’initialisation.</span><span class="sxs-lookup"><span data-stu-id="80aef-114">The method should return the same file name and index that it did during initialization.</span></span> <span data-ttu-id="80aef-115">Bien que l’interpréteur de commandes utilise l’image mise en cache dans la liste d’images système au lieu de charger l’image à partir du fichier, une superposition d’icône est toujours identifiée par son nom de fichier et son index.</span><span class="sxs-lookup"><span data-stu-id="80aef-115">Although the Shell uses the image that is cached in the system image list rather than loading the image from the file, an icon overlay is still identified by its file name and index.</span></span>

### <a name="step-2-implementing-getpriority"></a><span data-ttu-id="80aef-116">Étape 2 : implémentation de getPriority,</span><span class="sxs-lookup"><span data-stu-id="80aef-116">Step 2: Implementing GetPriority</span></span>

<span data-ttu-id="80aef-117">La méthode [**getPriority,**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) est appelée uniquement pendant l’initialisation.</span><span class="sxs-lookup"><span data-stu-id="80aef-117">The [**GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) method is called only during initialization.</span></span> <span data-ttu-id="80aef-118">Elle attribue une valeur de priorité à la superposition d’icône du gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="80aef-118">It assigns a priority value to the handler's icon overlay.</span></span> <span data-ttu-id="80aef-119">La valeur peut être comprise entre zéro et 100, où 100 est la priorité la plus basse.</span><span class="sxs-lookup"><span data-stu-id="80aef-119">The value can range from zero to 100, where 100 is the lowest priority.</span></span> <span data-ttu-id="80aef-120">L’objectif de cette valeur de priorité est d’aider l’interpréteur de commandes à résoudre le conflit qui se produit lorsque plusieurs superpositions d’icône sont spécifiées pour un seul objet.</span><span class="sxs-lookup"><span data-stu-id="80aef-120">The purpose of this priority value is to help the Shell resolve the conflict that arises when multiple icon overlays are specified for a single object.</span></span> <span data-ttu-id="80aef-121">Le Shell utilise d’abord un ensemble interne de règles pour déterminer la superposition d’icône de priorité la plus élevée.</span><span class="sxs-lookup"><span data-stu-id="80aef-121">The Shell first uses an internal set of rules to determine the highest-priority icon overlay.</span></span> <span data-ttu-id="80aef-122">Si ces règles ne résolvent pas le conflit, les valeurs affectées à l’icône se chevauchent par **getPriority,** déterminer la priorité.</span><span class="sxs-lookup"><span data-stu-id="80aef-122">If these rules do not resolve the conflict, the values assigned to the icon overlays by **GetPriority** determine priority.</span></span>

<span data-ttu-id="80aef-123">La valeur de priorité définie par [**getPriority,**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) n’est pas un moyen fiable de résoudre les conflits entre les gestionnaires de superposition d’icône sans relation.</span><span class="sxs-lookup"><span data-stu-id="80aef-123">The priority value set by [**GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) is not a reliable way to resolve conflicts between unrelated icon overlay handlers.</span></span> <span data-ttu-id="80aef-124">Il n’existe aucun moyen pour votre gestionnaire de déterminer les valeurs de priorité que les autres gestionnaires utilisent.</span><span class="sxs-lookup"><span data-stu-id="80aef-124">There is no way for your handler to determine what priority values other handlers are using.</span></span> <span data-ttu-id="80aef-125">Normalement, vous devez définir la valeur sur zéro.</span><span class="sxs-lookup"><span data-stu-id="80aef-125">Normally, you should set the value to zero.</span></span> <span data-ttu-id="80aef-126">Toutefois, la valeur de priorité est utile lorsque vous avez implémenté deux ou plusieurs gestionnaires de superposition d’icône qui peuvent demander des icônes de superposition d’icône pour le même objet.</span><span class="sxs-lookup"><span data-stu-id="80aef-126">However, the priority value is useful when you have implemented two or more icon overlay handlers that can request icon overlay icons for the same object.</span></span> <span data-ttu-id="80aef-127">En définissant les valeurs de priorité de manière appropriée, vous pouvez spécifier les superpositions d’icône requises qui seront affichées.</span><span class="sxs-lookup"><span data-stu-id="80aef-127">By setting the priority values appropriately, you can specify which of the requested icon overlays will be displayed.</span></span>

### <a name="step-3-implementing-ismemberof"></a><span data-ttu-id="80aef-128">Étape 3 : implémentation de IsMemberOf</span><span class="sxs-lookup"><span data-stu-id="80aef-128">Step 3: Implementing IsMemberOf</span></span>

<span data-ttu-id="80aef-129">L’interpréteur de commandes appelle la méthode [**IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof) pour déterminer s’il doit afficher la superposition d’icône d’un gestionnaire pour un objet particulier.</span><span class="sxs-lookup"><span data-stu-id="80aef-129">The Shell calls the [**IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof) method to determine whether it should display a handler's icon overlay for a particular object.</span></span> <span data-ttu-id="80aef-130">L’interpréteur de commandes spécifie l’objet en passant son nom à la méthode.</span><span class="sxs-lookup"><span data-stu-id="80aef-130">The Shell specifies the object by passing its name to the method.</span></span> <span data-ttu-id="80aef-131">Si un gestionnaire souhaite afficher la superposition de son icône, **IsMemberOf** retourne la valeur S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="80aef-131">If a handler wants to have its icon overlay displayed, **IsMemberOf** returns S\_OK.</span></span> <span data-ttu-id="80aef-132">Si ce n’est pas le cas, elle retourne S \_ false.</span><span class="sxs-lookup"><span data-stu-id="80aef-132">If not, it returns S\_FALSE.</span></span>

<span data-ttu-id="80aef-133">Les gestionnaires de superposition d’icône sont normalement conçus pour fonctionner avec un groupe de fichiers particulier.</span><span class="sxs-lookup"><span data-stu-id="80aef-133">Icon overlay handlers are normally intended to work with a particular group of files.</span></span> <span data-ttu-id="80aef-134">Un [type de fichier](fa-file-types.md), identifié par une extension de nom de fichier spécifique, en est un exemple classique.</span><span class="sxs-lookup"><span data-stu-id="80aef-134">A typical example is a [file type](fa-file-types.md), identified by a specific file name extension.</span></span> <span data-ttu-id="80aef-135">Un gestionnaire de superposition d’icône peut demander une superposition d’icône pour tous les fichiers du type de fichier.</span><span class="sxs-lookup"><span data-stu-id="80aef-135">An icon overlay handler can request an icon overlay for all files of the file type.</span></span> <span data-ttu-id="80aef-136">Certains gestionnaires demandent une superposition d’icône uniquement si un fichier du type de fichier est dans un état particulier.</span><span class="sxs-lookup"><span data-stu-id="80aef-136">Some handlers request an icon overlay only if a file of the file type is in a particular state.</span></span> <span data-ttu-id="80aef-137">Toutefois, les gestionnaires de superposition d’icône sont libres de demander leur superposition d’icône pour tout objet qu’ils choisissent.</span><span class="sxs-lookup"><span data-stu-id="80aef-137">However, icon overlay handlers are free to request their icon overlay for any object that they choose.</span></span>

 

 
