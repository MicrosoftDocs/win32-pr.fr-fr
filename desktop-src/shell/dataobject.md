---
description: L’objet de données est central pour tous les transferts de données de Shell.
ms.assetid: c63d339e-ac62-4da1-b5ce-22d45a6a3413
title: Objet de données de Shell
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 69a6c411310b6c9e9f28df4de048d3b6909c44b9
ms.sourcegitcommit: 822413efb4a70dd464e5db4d9e8693ef74f8132f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/09/2021
ms.locfileid: "113581627"
---
# <a name="shell-data-object"></a><span data-ttu-id="4b656-103">Objet de données de Shell</span><span class="sxs-lookup"><span data-stu-id="4b656-103">Shell Data Object</span></span>

<span data-ttu-id="4b656-104">L’objet de données est central pour tous les transferts de données de Shell.</span><span class="sxs-lookup"><span data-stu-id="4b656-104">The data object is central to all Shell data transfers.</span></span> <span data-ttu-id="4b656-105">Il s’agit principalement d’un conteneur pour stocker les données transférées.</span><span class="sxs-lookup"><span data-stu-id="4b656-105">It is primarily a container to hold the transferred data.</span></span> <span data-ttu-id="4b656-106">Toutefois, la cible peut également communiquer avec l’objet de données pour faciliter certains types spécialisés de transfert de données de Shell, tels que les déplacements optimisés.</span><span class="sxs-lookup"><span data-stu-id="4b656-106">However, the target can also communicate with the data object to facilitate some specialized types of Shell data transfer such as optimized moves.</span></span> <span data-ttu-id="4b656-107">Cette rubrique fournit une présentation générale de la façon dont les objets de données de Shell fonctionnent, de la façon dont ils sont construits par une source et de la façon dont ils sont gérés par une cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-107">This topic provides a general discussion of how Shell data objects work, how they are constructed by a source, and how they are handled by a target.</span></span> <span data-ttu-id="4b656-108">Pour plus d’informations sur l’utilisation des objets de données pour transférer différents types de données de Shell, consultez Gestion des scénarios de Transfert de données de l' [interpréteur](datascenarios.md)de commandes.</span><span class="sxs-lookup"><span data-stu-id="4b656-108">For a detailed discussion of how to use data objects to transfer different types of Shell data, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

-   [<span data-ttu-id="4b656-109">Fonctionnement des objets de données</span><span class="sxs-lookup"><span data-stu-id="4b656-109">How Data Objects Work</span></span>](#how-data-objects-work)
    -   [<span data-ttu-id="4b656-110">Formats du presse-papiers</span><span class="sxs-lookup"><span data-stu-id="4b656-110">Clipboard Formats</span></span>](#clipboard-formats)
    -   [<span data-ttu-id="4b656-111">FORMATETC, structure</span><span class="sxs-lookup"><span data-stu-id="4b656-111">FORMATETC Structure</span></span>](#formatetc-structure)
    -   [<span data-ttu-id="4b656-112">STGMEDIUM, structure</span><span class="sxs-lookup"><span data-stu-id="4b656-112">STGMEDIUM structure</span></span>](#stgmedium-structure)
-   [<span data-ttu-id="4b656-113">Comment une source crée un objet de données</span><span class="sxs-lookup"><span data-stu-id="4b656-113">How a Source Creates a Data Object</span></span>](#how-a-source-creates-a-data-object)
    -   [<span data-ttu-id="4b656-114">Comment ajouter un objet de mémoire global à un objet de données</span><span class="sxs-lookup"><span data-stu-id="4b656-114">How to Add a Global Memory Object to a Data Object</span></span>](#how-to-add-a-global-memory-object-to-a-data-object)
    -   [<span data-ttu-id="4b656-115">Implémentation de IDataObject</span><span class="sxs-lookup"><span data-stu-id="4b656-115">Implementing IDataObject</span></span>](#implementing-idataobject)
    -   [<span data-ttu-id="4b656-116">Implémentation de IDropSource</span><span class="sxs-lookup"><span data-stu-id="4b656-116">Implementing IDropSource</span></span>](#implementing-idropsource)
-   [<span data-ttu-id="4b656-117">Comment une cible gère un objet de données</span><span class="sxs-lookup"><span data-stu-id="4b656-117">How a Target Handles a Data Object</span></span>](#how-a-target-handles-a-data-object)
    -   [<span data-ttu-id="4b656-118">Extraction des données de l’interpréteur de commandes à partir d’un objet de données</span><span class="sxs-lookup"><span data-stu-id="4b656-118">Extracting Shell Data from a Data Object</span></span>](#extracting-shell-data-from-a-data-object)
    -   [<span data-ttu-id="4b656-119">Implémentation de IDropTarget</span><span class="sxs-lookup"><span data-stu-id="4b656-119">Implementing IDropTarget</span></span>](#implementing-idroptarget)
-   [<span data-ttu-id="4b656-120">Utilisation de l’objet d’assistance par glisser-déplacer</span><span class="sxs-lookup"><span data-stu-id="4b656-120">Using the Drag-and-Drop Helper Object</span></span>](#using-the-drag-and-drop-helper-object)
    -   [<span data-ttu-id="4b656-121">Utilisation de l’interface IDragSourceHelper</span><span class="sxs-lookup"><span data-stu-id="4b656-121">Using the IDragSourceHelper Interface</span></span>](#using-the-idragsourcehelper-interface)
    -   [<span data-ttu-id="4b656-122">Utilisation de l’interface IDropTargetHelper</span><span class="sxs-lookup"><span data-stu-id="4b656-122">Using the IDropTargetHelper Interface</span></span>](#using-the-idroptargethelper-interface)

## <a name="how-data-objects-work"></a><span data-ttu-id="4b656-123">Fonctionnement des objets de données</span><span class="sxs-lookup"><span data-stu-id="4b656-123">How Data Objects Work</span></span>

<span data-ttu-id="4b656-124">Les objets de données sont des objets COM (Component Object Model), créés par la source de données pour transférer des données vers une cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-124">Data objects are Component Object Model (COM) objects, created by the data source to transfer data to a target.</span></span> <span data-ttu-id="4b656-125">Ils contiennent généralement plus d’un élément de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-125">They typically carry more than one item of data.</span></span> <span data-ttu-id="4b656-126">Il existe deux raisons pour cette pratique :</span><span class="sxs-lookup"><span data-stu-id="4b656-126">There are two reasons for this practice:</span></span>

-   <span data-ttu-id="4b656-127">Bien que presque n’importe quel type de données puisse être transféré avec un objet de données, la source ne connaît généralement pas le type de données que la cible peut accepter.</span><span class="sxs-lookup"><span data-stu-id="4b656-127">While almost any type of data can be transferred with a data object, the source typically does not know what kind of data the target can accept.</span></span> <span data-ttu-id="4b656-128">Par exemple, les données peuvent être une partie d’un document texte mis en forme.</span><span class="sxs-lookup"><span data-stu-id="4b656-128">For instance, the data might be a portion of a formatted text document.</span></span> <span data-ttu-id="4b656-129">Alors que la cible peut être en mesure de gérer des informations de mise en forme complexes, elle peut également être en mesure d’accepter uniquement du texte ANSI.</span><span class="sxs-lookup"><span data-stu-id="4b656-129">While the target might be able to handle complex formatting information, it might also be able to accept only ANSI text.</span></span> <span data-ttu-id="4b656-130">Pour cette raison, les objets de données incluent souvent les mêmes données dans différents formats.</span><span class="sxs-lookup"><span data-stu-id="4b656-130">For this reason, data objects often include the same data in several different formats.</span></span> <span data-ttu-id="4b656-131">La cible peut ensuite extraire les données dans un format qu’elle peut gérer.</span><span class="sxs-lookup"><span data-stu-id="4b656-131">The target can then extract the data in a format that it can handle.</span></span>
-   <span data-ttu-id="4b656-132">Les objets de données peuvent également contenir des éléments de données auxiliaires qui ne sont pas des versions de données sources.</span><span class="sxs-lookup"><span data-stu-id="4b656-132">Data objects can also contain auxiliary data items that are not versions of source data.</span></span> <span data-ttu-id="4b656-133">Ce type d’élément de données fournit généralement des informations supplémentaires sur l’opération de transfert de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-133">This type of data item typically provides additional information about the data transfer operation.</span></span> <span data-ttu-id="4b656-134">Par exemple, l’interpréteur de commandes utilise des éléments de données auxiliaires pour indiquer si un fichier doit être copié ou déplacé.</span><span class="sxs-lookup"><span data-stu-id="4b656-134">For instance, the Shell uses auxiliary data items to indicate whether a file is to be copied or moved.</span></span>

### <a name="clipboard-formats"></a><span data-ttu-id="4b656-135">Formats du presse-papiers</span><span class="sxs-lookup"><span data-stu-id="4b656-135">Clipboard Formats</span></span>

<span data-ttu-id="4b656-136">Chaque élément de données dans un objet de données est associé à un format, généralement appelé *format de presse-papiers*.</span><span class="sxs-lookup"><span data-stu-id="4b656-136">Each item of data in a data object has an associated format, usually called a *clipboard format*.</span></span> <span data-ttu-id="4b656-137">Il existe un certain nombre de formats de presse-papiers standard, déclarés dans winuser. h, qui correspondent aux types de données couramment utilisés.</span><span class="sxs-lookup"><span data-stu-id="4b656-137">There are a number of standard clipboard formats, declared in Winuser.h, that correspond to commonly used types of data.</span></span> <span data-ttu-id="4b656-138">Les formats de presse-papiers sont des entiers, mais ils sont normalement désignés par leur nom équivalent, qui se présente sous la forme CF \_ *xxx*.</span><span class="sxs-lookup"><span data-stu-id="4b656-138">Clipboard formats are integers, but they are normally referred to by their equivalent name, which has the form CF\_*XXX*.</span></span> <span data-ttu-id="4b656-139">Par exemple, le format de presse-papiers pour le texte ANSI est \_ texte cf.</span><span class="sxs-lookup"><span data-stu-id="4b656-139">For instance, the clipboard format for ANSI text is CF\_TEXT.</span></span>

<span data-ttu-id="4b656-140">Les applications peuvent étendre la plage des formats de presse-papiers disponibles en définissant des formats privés.</span><span class="sxs-lookup"><span data-stu-id="4b656-140">Applications can extend the range of available clipboard formats by defining private formats.</span></span> <span data-ttu-id="4b656-141">Pour définir un format privé, une application appelle [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) avec une chaîne qui identifie le format.</span><span class="sxs-lookup"><span data-stu-id="4b656-141">To define a private format, an application calls [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) with a string that identifies the format.</span></span> <span data-ttu-id="4b656-142">L’entier non signé retourné par la fonction est une valeur de format valide qui peut être utilisée comme un format de presse-papiers standard.</span><span class="sxs-lookup"><span data-stu-id="4b656-142">The unsigned integer that the function returns is a valid format value that can be used just like a standard clipboard format.</span></span> <span data-ttu-id="4b656-143">Toutefois, la source et la cible doivent inscrire le format pour pouvoir l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="4b656-143">However, both source and target must register the format in order to use it.</span></span> <span data-ttu-id="4b656-144">À une exception près :[CF \_ HDROP](clipboard.md): les formats de presse-papiers utilisés pour transférer les données de l’interpréteur de commandes sont définis en tant que formats privés.</span><span class="sxs-lookup"><span data-stu-id="4b656-144">With one exception—[CF\_HDROP](clipboard.md)—the clipboard formats used to transfer Shell data are defined as private formats.</span></span> <span data-ttu-id="4b656-145">Ils doivent être inscrits par la source et la cible avant de pouvoir être utilisés.</span><span class="sxs-lookup"><span data-stu-id="4b656-145">They must be registered by the source and target before they can be used.</span></span> <span data-ttu-id="4b656-146">Pour obtenir une description des formats de presse-papiers de l’interpréteur de commandes disponibles, consultez formats du presse-papiers de Shell.</span><span class="sxs-lookup"><span data-stu-id="4b656-146">For a description of the available Shell clipboard formats, see Shell Clipboard Formats.</span></span>

<span data-ttu-id="4b656-147">Bien qu’il existe quelques exceptions, les objets de données contiennent normalement un seul élément de données pour chaque format de presse-papiers qu’ils prennent en charge.</span><span class="sxs-lookup"><span data-stu-id="4b656-147">Although there are some exceptions, data objects normally contain only one item of data for each clipboard format they support.</span></span> <span data-ttu-id="4b656-148">Cette corrélation un-à-un entre le format et les données permet d’utiliser la valeur de format comme identificateur pour l’élément de données associé.</span><span class="sxs-lookup"><span data-stu-id="4b656-148">This one-to-one correlation between format and data allows the format value to be used as an identifier for the associated data item.</span></span> <span data-ttu-id="4b656-149">En fait, lorsque vous discutez du contenu d’un objet de données, un élément de données particulier est généralement appelé « format » et est référencé par son nom de format.</span><span class="sxs-lookup"><span data-stu-id="4b656-149">In fact, when discussing the contents of a data object, a particular item of data is typically called a "format" and is referred to by its format name.</span></span> <span data-ttu-id="4b656-150">Par exemple, les expressions telles que « extraire le \_ format de texte cf... » sont généralement utilisés lors de l’étude d’un élément de données texte ANSI d’un objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-150">For example, phrases such as "Extract the CF\_TEXT format..." are typically used when discussing a data object's ANSI text data item.</span></span>

<span data-ttu-id="4b656-151">Lorsque la cible de déplacement reçoit le pointeur vers l’objet de données, la cible de déplacement énumère les formats disponibles afin de déterminer quels types de données sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="4b656-151">When the drop target receives the pointer to the data object, the drop target enumerates the available formats to determine what types of data are available.</span></span> <span data-ttu-id="4b656-152">Il demande ensuite un ou plusieurs des formats disponibles et extrait les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-152">It then requests one or more of the available formats and extracts the data.</span></span> <span data-ttu-id="4b656-153">La façon dont la cible extrait les données de l’interpréteur de commandes à partir d’un objet de données varie en fonction du format ; ce sujet est abordé en détail dans [la manière dont une cible gère un objet de données](#how-a-target-handles-a-data-object).</span><span class="sxs-lookup"><span data-stu-id="4b656-153">The specific way that the target extracts Shell data from a data object varies with the format; this is discussed in detail in [How a Target Handles a Data Object](#how-a-target-handles-a-data-object).</span></span>

<span data-ttu-id="4b656-154">Avec les transferts de données du presse-papiers simples, les données sont placées dans un objet mémoire global.</span><span class="sxs-lookup"><span data-stu-id="4b656-154">With simple clipboard data transfers, the data is placed in a global memory object.</span></span> <span data-ttu-id="4b656-155">L’adresse de cet objet est placée dans le presse-papiers, en même temps que son format.</span><span class="sxs-lookup"><span data-stu-id="4b656-155">The address of that object is placed on the Clipboard, along with its format.</span></span> <span data-ttu-id="4b656-156">Le format du presse-papiers indique à la cible le type de données qu’elle trouvera à l’adresse associée.</span><span class="sxs-lookup"><span data-stu-id="4b656-156">The clipboard format tells the target what kind of data it will find at the associated address.</span></span> <span data-ttu-id="4b656-157">Bien que les transferts de presse-papiers simples soient faciles à implémenter :</span><span class="sxs-lookup"><span data-stu-id="4b656-157">While simple clipboard transfers are easy to implement:</span></span>

-   <span data-ttu-id="4b656-158">Les objets de données offrent un moyen bien plus souple de transférer des données.</span><span class="sxs-lookup"><span data-stu-id="4b656-158">Data objects provide a much more flexible way to transfer data.</span></span>
-   <span data-ttu-id="4b656-159">Les objets de données sont mieux adaptés au transfert de grandes quantités de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-159">Data objects are better suited for transferring large amounts of data.</span></span>
-   <span data-ttu-id="4b656-160">Les objets de données doivent être utilisés pour transférer des données à l’aide d’une opération de glisser-déplacer.</span><span class="sxs-lookup"><span data-stu-id="4b656-160">Data objects must be used to transfer data with a drag-and-drop operation.</span></span>

<span data-ttu-id="4b656-161">Pour ces raisons, tous les transferts de données de Shell utilisent des objets de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-161">For these reasons, all Shell data transfers use data objects.</span></span> <span data-ttu-id="4b656-162">Avec les objets de données, les formats de presse-papiers ne sont pas utilisés directement.</span><span class="sxs-lookup"><span data-stu-id="4b656-162">With data objects, clipboard formats are not used directly.</span></span> <span data-ttu-id="4b656-163">Au lieu de cela, les éléments de données sont identifiés avec une généralisation du format du presse-papiers, une structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="4b656-163">Instead, data items are identified with a generalization of the clipboard format, a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span>

### <a name="formatetc-structure"></a><span data-ttu-id="4b656-164">FORMATETC, structure</span><span class="sxs-lookup"><span data-stu-id="4b656-164">FORMATETC Structure</span></span>

<span data-ttu-id="4b656-165">La structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) est une version étendue d’un format de presse-papiers.</span><span class="sxs-lookup"><span data-stu-id="4b656-165">The [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is an extended version of a clipboard format.</span></span> <span data-ttu-id="4b656-166">Utilisé pour les transferts de données de Shell, la structure **FORMATETC** présente les caractéristiques suivantes :</span><span class="sxs-lookup"><span data-stu-id="4b656-166">As used for Shell data transfers, the **FORMATETC** structure has the following characteristics:</span></span>

-   <span data-ttu-id="4b656-167">Un élément de données est toujours identifié par son format de presse-papiers, dans le membre **cfFormat** .</span><span class="sxs-lookup"><span data-stu-id="4b656-167">A data item is still identified by its clipboard format, in the **cfFormat** member.</span></span>
-   <span data-ttu-id="4b656-168">Le transfert de données n’est pas limité aux objets mémoire globaux.</span><span class="sxs-lookup"><span data-stu-id="4b656-168">Data transfer is not limited to global memory objects.</span></span> <span data-ttu-id="4b656-169">Le membre **TYMED** est utilisé pour indiquer le mécanisme de transfert de données contenu dans la structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) associée.</span><span class="sxs-lookup"><span data-stu-id="4b656-169">The **tymed** member is used to indicate the data transfer mechanism contained in the associated [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="4b656-170">Elle est définie sur l’une des valeurs [**TYMED \_ xxx**](/windows/win32/api/objidl/ne-objidl-tymed) .</span><span class="sxs-lookup"><span data-stu-id="4b656-170">It is set to one of the [**TYMED\_XXX**](/windows/win32/api/objidl/ne-objidl-tymed) values.</span></span>
-   <span data-ttu-id="4b656-171">L’interpréteur de commandes utilise le membre **Lindex** avec son format [CFSTR \_ FILECONTENTS](clipboard.md) pour permettre à un objet de données de contenir plus d’un élément de données par format.</span><span class="sxs-lookup"><span data-stu-id="4b656-171">The Shell uses the **lIndex** member with its [CFSTR\_FILECONTENTS](clipboard.md) format to allow a data object to contain more than one data item per format.</span></span> <span data-ttu-id="4b656-172">Pour plus d’informations sur l’utilisation de ce format, consultez la section *utilisation du \_ format CFSTR FILECONTENTS pour extraire des données d’un fichier dans* [gestion des scénarios de Shell transfert de données](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="4b656-172">For a discussion of how to use this format, see the *Using the CFSTR\_FILECONTENTS Format to Extract Data from a File* section of [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>
-   <span data-ttu-id="4b656-173">Le membre **dwAspect** est généralement défini sur le \_ contenu DVASPECT.</span><span class="sxs-lookup"><span data-stu-id="4b656-173">The **dwAspect** member is typically set to DVASPECT\_CONTENT.</span></span> <span data-ttu-id="4b656-174">Toutefois, il existe trois valeurs définies dans shlobj. h qui peuvent être utilisées pour le transfert de données d’interpréteur de commandes.</span><span class="sxs-lookup"><span data-stu-id="4b656-174">However, there are three values defined in Shlobj.h that can be used for Shell data transfer.</span></span> 

    | <span data-ttu-id="4b656-175">Valeur</span><span class="sxs-lookup"><span data-stu-id="4b656-175">Value</span></span>               | <span data-ttu-id="4b656-176">Description</span><span class="sxs-lookup"><span data-stu-id="4b656-176">Description</span></span>                                                                                       |
    |---------------------|---------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="4b656-177">\_copie DVASPECT</span><span class="sxs-lookup"><span data-stu-id="4b656-177">DVASPECT\_COPY</span></span>      | <span data-ttu-id="4b656-178">Permet d’indiquer que le format représente une copie des données.</span><span class="sxs-lookup"><span data-stu-id="4b656-178">Used to indicate that the format represents a copy of the data.</span></span>                                   |
    | <span data-ttu-id="4b656-179">\_lien DVASPECT</span><span class="sxs-lookup"><span data-stu-id="4b656-179">DVASPECT\_LINK</span></span>      | <span data-ttu-id="4b656-180">Permet d’indiquer que le format représente un raccourci vers les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-180">Used to indicate that the format represents a shortcut to the data.</span></span>                               |
    | <span data-ttu-id="4b656-181">DVASPECT \_ ShortName</span><span class="sxs-lookup"><span data-stu-id="4b656-181">DVASPECT\_SHORTNAME</span></span> | <span data-ttu-id="4b656-182">Utilisé avec le \_ format CF HDROP pour demander un chemin d’accès de fichier dont les noms sont abrégés au format 8,3.</span><span class="sxs-lookup"><span data-stu-id="4b656-182">Used with the CF\_HDROP format to request a file path with the names shortened to the 8.3 format.</span></span> |

    

     

-   <span data-ttu-id="4b656-183">Le membre **PTD** n’est pas utilisé pour les transferts de données Shell et prend normalement la valeur **null**.</span><span class="sxs-lookup"><span data-stu-id="4b656-183">The **ptd** member is not used for Shell data transfers and is normally set to **NULL**.</span></span>

### <a name="stgmedium-structure"></a><span data-ttu-id="4b656-184">STGMEDIUM, structure</span><span class="sxs-lookup"><span data-stu-id="4b656-184">STGMEDIUM structure</span></span>

<span data-ttu-id="4b656-185">La structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) donne accès aux données en cours de transfert.</span><span class="sxs-lookup"><span data-stu-id="4b656-185">The [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure provides access to the data being transferred.</span></span> <span data-ttu-id="4b656-186">Trois mécanismes de transfert de données sont pris en charge pour les données de l’interpréteur de commandes :</span><span class="sxs-lookup"><span data-stu-id="4b656-186">Three data transfer mechanisms are supported for Shell data:</span></span>

-   <span data-ttu-id="4b656-187">Objet de mémoire global.</span><span class="sxs-lookup"><span data-stu-id="4b656-187">A global memory object.</span></span>
-   <span data-ttu-id="4b656-188">Une interface [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="4b656-188">An [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span>
-   <span data-ttu-id="4b656-189">Interface [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="4b656-189">An [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span>

<span data-ttu-id="4b656-190">Le membre **TYMED** de la structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) est une valeur [**TYMED \_ xxx**](/windows/win32/api/objidl/ne-objidl-tymed) qui identifie le mécanisme de transfert de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-190">The **tymed** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure is a [**TYMED\_XXX**](/windows/win32/api/objidl/ne-objidl-tymed) value that identifies the data transfer mechanism.</span></span> <span data-ttu-id="4b656-191">Le deuxième membre est un pointeur qui est utilisé par la cible pour extraire les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-191">The second member is a pointer that is used by the target to extract the data.</span></span> <span data-ttu-id="4b656-192">Le pointeur peut être l’un des différents types, en fonction de la valeur **TYMED** .</span><span class="sxs-lookup"><span data-stu-id="4b656-192">The pointer can be one of a variety of types, depending on the **tymed** value.</span></span> <span data-ttu-id="4b656-193">Les trois valeurs **TYMED** utilisées pour les transferts de données de Shell sont résumées dans le tableau ci-dessous, avec le nom de membre **STGMEDIUM** correspondant.</span><span class="sxs-lookup"><span data-stu-id="4b656-193">The three **tymed** values that are used for Shell data transfers are summarized in the following table, along with their corresponding **STGMEDIUM** member name.</span></span>



| <span data-ttu-id="4b656-194">Valeur TYMED</span><span class="sxs-lookup"><span data-stu-id="4b656-194">tymed Value</span></span>     | <span data-ttu-id="4b656-195">Nom du membre</span><span class="sxs-lookup"><span data-stu-id="4b656-195">Member name</span></span> | <span data-ttu-id="4b656-196">Description</span><span class="sxs-lookup"><span data-stu-id="4b656-196">Description</span></span>                                                                                                                                                                                                                                                                                                       |
|-----------------|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="4b656-197">TYMED \_ HGLOBAL</span><span class="sxs-lookup"><span data-stu-id="4b656-197">TYMED\_HGLOBAL</span></span>  | <span data-ttu-id="4b656-198">**hGlobal**</span><span class="sxs-lookup"><span data-stu-id="4b656-198">**hGlobal**</span></span> | <span data-ttu-id="4b656-199">Pointeur vers un objet de mémoire global.</span><span class="sxs-lookup"><span data-stu-id="4b656-199">A pointer to a global memory object.</span></span> <span data-ttu-id="4b656-200">Ce type de pointeur est généralement utilisé pour transférer de petites quantités de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-200">This pointer type is typically used for transferring small amounts of data.</span></span> <span data-ttu-id="4b656-201">Par exemple, l’interpréteur de commandes utilise des objets mémoire globaux pour transférer des chaînes de texte courtes, telles que des noms de fichiers ou des URL.</span><span class="sxs-lookup"><span data-stu-id="4b656-201">For instance, the Shell uses global memory objects to transfer short text strings such as file names or URLs.</span></span>                                                                                    |
| <span data-ttu-id="4b656-202">TYMED \_ ISTREAM</span><span class="sxs-lookup"><span data-stu-id="4b656-202">TYMED\_ISTREAM</span></span>  | <span data-ttu-id="4b656-203">**pstm**</span><span class="sxs-lookup"><span data-stu-id="4b656-203">**pstm**</span></span>    | <span data-ttu-id="4b656-204">Pointeur vers une interface [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="4b656-204">A pointer to an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="4b656-205">Ce type de pointeur est recommandé pour la plupart des transferts de données Shell, car il requiert relativement peu de mémoire par rapport à TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="4b656-205">This pointer type is preferred for most Shell data transfers because it requires relatively little memory compared to TYMED\_HGLOBAL.</span></span> <span data-ttu-id="4b656-206">En outre, le \_ mécanisme de transfert de données TYMED ISTREAM ne requiert pas que la source stocke ses données d’une manière particulière.</span><span class="sxs-lookup"><span data-stu-id="4b656-206">Also, the TYMED\_ISTREAM data transfer mechanism does not require the source to store its data in any particular way.</span></span> |
| <span data-ttu-id="4b656-207">TYMED, \_ ISTORAGE</span><span class="sxs-lookup"><span data-stu-id="4b656-207">TYMED\_ISTORAGE</span></span> | <span data-ttu-id="4b656-208">**pstg**</span><span class="sxs-lookup"><span data-stu-id="4b656-208">**pstg**</span></span>    | <span data-ttu-id="4b656-209">Pointeur vers une interface [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="4b656-209">A pointer to an [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="4b656-210">La cible appelle les méthodes d’interface pour extraire les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-210">The target calls the interface methods to extract the data.</span></span> <span data-ttu-id="4b656-211">Comme TYMED \_ ISTREAM, ce type de pointeur requiert relativement peu de mémoire.</span><span class="sxs-lookup"><span data-stu-id="4b656-211">Like TYMED\_ISTREAM, this pointer type requires relatively little memory.</span></span> <span data-ttu-id="4b656-212">Toutefois, étant donné que TYMED \_ ISTORAGE est moins souple que TYMED \_ ISTREAM, ce n’est pas aussi souvent utilisé.</span><span class="sxs-lookup"><span data-stu-id="4b656-212">However, because TYMED\_ISTORAGE is less flexible than TYMED\_ISTREAM, it is not as commonly used.</span></span>                  |



 

## <a name="how-a-source-creates-a-data-object"></a><span data-ttu-id="4b656-213">Comment une source crée un objet de données</span><span class="sxs-lookup"><span data-stu-id="4b656-213">How a Source Creates a Data Object</span></span>

<span data-ttu-id="4b656-214">Lorsqu’un utilisateur lance un transfert de données de Shell, la source est chargée de créer un objet de données et de le charger avec des données.</span><span class="sxs-lookup"><span data-stu-id="4b656-214">When a user initiates a Shell data transfer, the source is responsible for creating a data object and loading it with data.</span></span> <span data-ttu-id="4b656-215">La procédure suivante résume le processus :</span><span class="sxs-lookup"><span data-stu-id="4b656-215">The following procedure summarizes the process:</span></span>

1.  <span data-ttu-id="4b656-216">Appelez [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) pour obtenir une valeur de format de presse-papiers valide pour chaque format de Shell qui sera inclus dans l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-216">Call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to obtain a valid clipboard format value for each Shell format that will be included in the data object.</span></span> <span data-ttu-id="4b656-217">N’oubliez pas que [CF \_ HDROP](clipboard.md) est déjà un format de presse-papiers valide et qu’il n’est pas nécessaire de l’inscrire.</span><span class="sxs-lookup"><span data-stu-id="4b656-217">Remember that [CF\_HDROP](clipboard.md) is already a valid clipboard format and does not need to be registered.</span></span>
2.  <span data-ttu-id="4b656-218">Pour chaque format à transférer, vous pouvez placer les données associées dans un objet de mémoire global ou créer un objet qui fournit l’accès à ces données via une interface [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) ou [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="4b656-218">For each format to be transferred, either put the associated data into a global memory object or create an object that provides access to that data through an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="4b656-219">Les interfaces **IStream** et **IStorage** sont créées à l’aide de techniques com standard.</span><span class="sxs-lookup"><span data-stu-id="4b656-219">The **IStream** and **IStorage** interfaces are created using standard COM techniques.</span></span> <span data-ttu-id="4b656-220">Pour plus d’informations sur la gestion des objets mémoire globaux, consultez [Ajout d’un objet mémoire global à un objet de données](#how-to-add-a-global-memory-object-to-a-data-object).</span><span class="sxs-lookup"><span data-stu-id="4b656-220">For a discussion of how to handle global memory objects, see [How to Add a Global Memory Object to a Data Object](#how-to-add-a-global-memory-object-to-a-data-object).</span></span>
3.  <span data-ttu-id="4b656-221">Créez des structures [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) et [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) pour chaque format.</span><span class="sxs-lookup"><span data-stu-id="4b656-221">Create [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures for each format.</span></span>
4.  <span data-ttu-id="4b656-222">Instanciez un objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-222">Instantiate a data object.</span></span>
5.  <span data-ttu-id="4b656-223">Chargez les données dans l’objet de données en appelant la méthode [**IDataObject :: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) pour chaque format pris en charge et en passant les structures [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) et [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) du format.</span><span class="sxs-lookup"><span data-stu-id="4b656-223">Load the data into the data object by calling the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method for each supported format and passing in the format's [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures.</span></span>
6.  <span data-ttu-id="4b656-224">Avec les transferts de données du presse-papiers, appelez [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) pour placer un pointeur vers l’interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) de l’objet de données dans le presse-papiers.</span><span class="sxs-lookup"><span data-stu-id="4b656-224">With clipboard data transfers, call [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) to place a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface on the Clipboard.</span></span> <span data-ttu-id="4b656-225">Pour les transferts par glisser-déplacer, lancez une *boucle de glissement* en appelant [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span><span class="sxs-lookup"><span data-stu-id="4b656-225">For drag-and-drop transfers, initiate a *drag loop* by calling [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span></span> <span data-ttu-id="4b656-226">Le pointeur **IDataObject** est passé à la cible de déplacement lorsque les données sont supprimées, ce qui met fin à la boucle de glissement.</span><span class="sxs-lookup"><span data-stu-id="4b656-226">The **IDataObject** pointer will be passed to the drop target when the data is dropped, ending the drag loop.</span></span>

<span data-ttu-id="4b656-227">L’objet de données est maintenant prêt à être transféré à la cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-227">The data object is now ready to be transferred to the target.</span></span> <span data-ttu-id="4b656-228">Pour les transferts de données du presse-papiers, l’objet est simplement maintenu jusqu’à ce que la cible le demande en appelant [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span><span class="sxs-lookup"><span data-stu-id="4b656-228">For clipboard data transfers, the object is simply held until the target requests it by calling [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span> <span data-ttu-id="4b656-229">Pour les transferts de données par glisser-déplacer, l’objet de données est chargé de créer une icône pour représenter les données et de les déplacer lorsque l’utilisateur déplace le curseur.</span><span class="sxs-lookup"><span data-stu-id="4b656-229">For drag-and-drop data transfers, the data object is responsible for creating an icon to represent the data and moving it as the user moves the cursor.</span></span> <span data-ttu-id="4b656-230">Lorsque l’objet se trouve dans la boucle de glissement, la source reçoit les informations d’état via son interface [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) .</span><span class="sxs-lookup"><span data-stu-id="4b656-230">While the object is in the drag loop, the source receives status information through its [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="4b656-231">Pour plus d’informations, consultez [implémentation de IDropSource](#implementing-idropsource).</span><span class="sxs-lookup"><span data-stu-id="4b656-231">For further discussion, see [Implementing IDropSource](#implementing-idropsource).</span></span>

<span data-ttu-id="4b656-232">La source ne reçoit aucune notification si l’objet de données est récupéré à partir du presse-papiers par une cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-232">The source receives no notification if the data object is retrieved from the Clipboard by a target.</span></span> <span data-ttu-id="4b656-233">Lorsqu’un objet est supprimé sur une cible par une opération de glisser-déplacer, la fonction [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) qui a été appelée pour initier la boucle de glissement retourne.</span><span class="sxs-lookup"><span data-stu-id="4b656-233">When an object is dropped on a target by a drag-and-drop operation, the [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) function that was called to initiate the drag loop will return.</span></span>

### <a name="how-to-add-a-global-memory-object-to-a-data-object"></a><span data-ttu-id="4b656-234">Comment ajouter un objet de mémoire global à un objet de données</span><span class="sxs-lookup"><span data-stu-id="4b656-234">How to Add a Global Memory Object to a Data Object</span></span>

<span data-ttu-id="4b656-235">La plupart des formats de données de Shell se présentent sous la forme d’un objet de mémoire globale.</span><span class="sxs-lookup"><span data-stu-id="4b656-235">Many of the Shell data formats are in the form of a global memory object.</span></span> <span data-ttu-id="4b656-236">Utilisez la procédure suivante pour créer un format contenant un objet mémoire global et le charger dans l’objet de données :</span><span class="sxs-lookup"><span data-stu-id="4b656-236">Use the following procedure to create a format containing a global memory object and load it into the data object:</span></span>

1.  <span data-ttu-id="4b656-237">Créer une structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="4b656-237">Create a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="4b656-238">Définissez le membre **cfFormat** sur la valeur de format du presse-papiers appropriée et le membre **TYMED** sur TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="4b656-238">Set the **cfFormat** member to the appropriate clipboard format value and the **tymed** member to TYMED\_HGLOBAL.</span></span>
2.  <span data-ttu-id="4b656-239">Créer une structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="4b656-239">Create an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="4b656-240">Définissez le membre **TYMED** sur TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="4b656-240">Set the **tymed** member to TYMED\_HGLOBAL.</span></span>
3.  <span data-ttu-id="4b656-241">Créez un objet de mémoire globale en appelant [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) pour allouer un bloc de mémoire de taille appropriée.</span><span class="sxs-lookup"><span data-stu-id="4b656-241">Create a global memory object by calling [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) to allocate a suitably sized block of memory.</span></span>
4.  <span data-ttu-id="4b656-242">Affectez le bloc de données à transférer à l’adresse renvoyée par [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc).</span><span class="sxs-lookup"><span data-stu-id="4b656-242">Assign the block of data to be transferred to the address returned by [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc).</span></span>
5.  <span data-ttu-id="4b656-243">Assignez l’adresse de l’objet mémoire globale au membre **hGlobal** de la structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="4b656-243">Assign the global memory object's address to the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
6.  <span data-ttu-id="4b656-244">Chargez le format dans l’objet de données en appelant [**IDataObject :: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) et en passant les structures [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) et [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) créées dans les étapes précédentes.</span><span class="sxs-lookup"><span data-stu-id="4b656-244">Load the format into the data object by calling [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) and passing in the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures created in the previous steps.</span></span>

<span data-ttu-id="4b656-245">L’exemple de fonction suivant crée un objet mémoire global contenant une valeur **DWORD** et le charge dans un objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-245">The following sample function creates a global memory object containing a **DWORD** value and loads it into a data object.</span></span> <span data-ttu-id="4b656-246">Le paramètre **pdtobj** est un pointeur vers l’interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) de l’objet de données, **CF** correspond à la valeur du format du presse-papiers et **DW** à la valeur des données.</span><span class="sxs-lookup"><span data-stu-id="4b656-246">The **pdtobj** parameter is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, **cf** is the clipboard format value, and **dw** is the data value.</span></span>


```C++
STDAPI DataObj_SetDWORD(IDataObject *pdtobj, UINT cf, DWORD dw)
{
    FORMATETC fmte = {(CLIPFORMAT) cf, 
                      NULL, 
                      DVASPECT_CONTENT, 
                      -1, 
                      TYMED_HGLOBAL};
    STGMEDIUM medium;

    HRESULT hres = E_OUTOFMEMORY;
    DWORD *pdw = (DWORD *)GlobalAlloc(GPTR, sizeof(DWORD));
    
    if (pdw)
    {
        *pdw = dw;       
        medium.tymed = TYMED_HGLOBAL;
        medium.hGlobal = pdw;
        medium.pUnkForRelease = NULL;

        hres = pdtobj->SetData(&fmte, &medium, TRUE);
 
        if (FAILED(hres))
            GlobalFree((HGLOBAL)pdw);
    }
    return hres;
}
```



### <a name="implementing-idataobject"></a><span data-ttu-id="4b656-247">Implémentation de IDataObject</span><span class="sxs-lookup"><span data-stu-id="4b656-247">Implementing IDataObject</span></span>

<span data-ttu-id="4b656-248">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) est l’interface principale d’un objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-248">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) is a data object's primary interface.</span></span> <span data-ttu-id="4b656-249">Elle doit être implémentée par tous les objets de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-249">It must be implemented by all data objects.</span></span> <span data-ttu-id="4b656-250">Elle est utilisée à la fois par la source et la cible à diverses fins, notamment :</span><span class="sxs-lookup"><span data-stu-id="4b656-250">It is used by both source and target for a variety of purposes, including:</span></span>

-   <span data-ttu-id="4b656-251">Chargement des données dans l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-251">Loading data into the data object.</span></span>
-   <span data-ttu-id="4b656-252">Extraction des données de l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-252">Extracting data from the data object.</span></span>
-   <span data-ttu-id="4b656-253">Détermination des types de données dans l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-253">Determining what types of data are in the data object.</span></span>
-   <span data-ttu-id="4b656-254">Fournir des commentaires à l’objet de données au résultat du transfert de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-254">Providing feedback to the data object on outcome of the data transfer.</span></span>

<span data-ttu-id="4b656-255">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) prend en charge un certain nombre de méthodes.</span><span class="sxs-lookup"><span data-stu-id="4b656-255">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) supports a number of methods.</span></span> <span data-ttu-id="4b656-256">Cette section explique comment implémenter les trois méthodes les plus importantes pour les objets de données Shell, [SetData](#setdata-method), [EnumFormatEtc](#enumformatetc-method)et [GetData](#getdata-method).</span><span class="sxs-lookup"><span data-stu-id="4b656-256">This section discusses how to implement the three most important methods for Shell data objects, [SetData](#setdata-method), [EnumFormatEtc](#enumformatetc-method), and [GetData](#getdata-method).</span></span> <span data-ttu-id="4b656-257">Pour plus d’informations sur les autres méthodes, consultez la référence **IDataObject** .</span><span class="sxs-lookup"><span data-stu-id="4b656-257">For a discussion of the other methods, see the **IDataObject** reference.</span></span>

### <a name="setdata-method"></a><span data-ttu-id="4b656-258">SetData (méthode)</span><span class="sxs-lookup"><span data-stu-id="4b656-258">SetData method</span></span>

<span data-ttu-id="4b656-259">La fonction principale de la méthode [**IDataObject :: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) est de permettre à la source de charger des données dans l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-259">The primary function of the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method is to allow the source to load data into the data object.</span></span> <span data-ttu-id="4b656-260">Pour chaque format à inclure, la source crée une structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) pour identifier le format et une structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) pour contenir un pointeur vers les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-260">For each format to be included, the source creates a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to identify the format and an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure to hold a pointer to the data.</span></span> <span data-ttu-id="4b656-261">La source appelle ensuite la méthode **IDataObject :: SetData** de l’objet et passe dans les structures **FORMATETC** et **STGMEDIUM** du format.</span><span class="sxs-lookup"><span data-stu-id="4b656-261">The source then calls the object's **IDataObject::SetData** method and passes in the format's **FORMATETC** and **STGMEDIUM** structures.</span></span> <span data-ttu-id="4b656-262">La méthode doit stocker ces informations afin qu’elles soient disponibles lorsque la cible appelle [**IDataObject :: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) pour extraire les données de l’objet.</span><span class="sxs-lookup"><span data-stu-id="4b656-262">The method must store this information so that it is available when the target calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to extract data from the object.</span></span>

<span data-ttu-id="4b656-263">Toutefois, lors du transfert de fichiers, l’interpréteur de commandes place souvent les informations de chaque fichier à transférer dans un format [CFSTR \_ FILECONTENTS](clipboard.md) distinct.</span><span class="sxs-lookup"><span data-stu-id="4b656-263">However, when transferring files, the Shell often puts the information for each file to be transferred into a separate [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="4b656-264">Pour distinguer les différents fichiers, le membre **Lindex** de la structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) de chaque fichier est défini sur une valeur d’index qui identifie le fichier particulier.</span><span class="sxs-lookup"><span data-stu-id="4b656-264">To distinguish the different files, the **lIndex** member of each file's [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is set to an index value that identifies the particular file.</span></span> <span data-ttu-id="4b656-265">Votre implémentation de [**IDataObject :: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) doit être capable de stocker plusieurs \_ formats CFSTR FILECONTENTS qui diffèrent uniquement par leurs membres **Lindex** .</span><span class="sxs-lookup"><span data-stu-id="4b656-265">Your [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) implementation must be capable of storing multiple CFSTR\_FILECONTENTS formats that differ only by their **lIndex** members.</span></span>

<span data-ttu-id="4b656-266">Lorsque le curseur se trouve sur la fenêtre cible, la cible peut utiliser l' [objet d’assistance glisser-déplacer](#using-the-drag-and-drop-helper-object) pour spécifier l’image de glissement.</span><span class="sxs-lookup"><span data-stu-id="4b656-266">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to specify the drag image.</span></span> <span data-ttu-id="4b656-267">L’objet d’assistance par glisser-déplacer appelle [**IDataObject :: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) pour charger des formats privés dans l’objet de données utilisé pour la prise en charge inter-processus.</span><span class="sxs-lookup"><span data-stu-id="4b656-267">The drag-and-drop helper object calls [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to load private formats into the data object that are used for cross-process support.</span></span> <span data-ttu-id="4b656-268">Pour prendre en charge l’objet d’assistance par glisser-déplacer, votre implémentation de **IDataObject :: SetData** doit être en mesure d’accepter et de stocker des formats privés arbitraires.</span><span class="sxs-lookup"><span data-stu-id="4b656-268">To support the drag-and-drop helper object, your **IDataObject::SetData** implementation must be able to accept and store arbitrary private formats.</span></span>

<span data-ttu-id="4b656-269">Une fois que les données ont été supprimées, certains types de transferts de données de Shell requièrent que la cible appelle [**IDataObject :: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) pour fournir à l’objet de données des informations sur le résultat de l’opération de déplacement.</span><span class="sxs-lookup"><span data-stu-id="4b656-269">After the data has been dropped, some types of Shell data transfer require the target to call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to provide the data object with information about the outcome of the drop operation.</span></span> <span data-ttu-id="4b656-270">Par exemple, lors du déplacement de fichiers avec une opération de déplacement optimisée, la cible supprime normalement les fichiers d’origine, mais cela n’est pas obligatoire.</span><span class="sxs-lookup"><span data-stu-id="4b656-270">For example, when moving files with an optimized move operation, the target normally deletes the original files, but it is not required to do so.</span></span> <span data-ttu-id="4b656-271">La cible informe l’objet de données s’il a supprimé les fichiers en appelant **IDataObject :: SetData** avec un format [CFSTR \_ LOGICALPERFORMEDDROPEFFECT](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="4b656-271">The target informs the data object whether it deleted the files by calling **IDataObject::SetData** with a [CFSTR\_LOGICALPERFORMEDDROPEFFECT](clipboard.md) format.</span></span> <span data-ttu-id="4b656-272">Plusieurs autres formats de l' [interpréteur](clipboard.md) de commandes sont également utilisés par la cible pour transmettre des informations à l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-272">There are several other [Shell Clipboard Formats](clipboard.md) that are also used by the target to pass information to the data object.</span></span> <span data-ttu-id="4b656-273">Votre implémentation de **IDataObject :: SetData** doit être en mesure de reconnaître ces formats et de répondre de manière appropriée.</span><span class="sxs-lookup"><span data-stu-id="4b656-273">Your **IDataObject::SetData** implementation must be able to recognize these formats and respond appropriately.</span></span> <span data-ttu-id="4b656-274">Pour plus d’informations, consultez [gestion des scénarios de transfert de données de l’interpréteur](datascenarios.md)de commandes.</span><span class="sxs-lookup"><span data-stu-id="4b656-274">For further discussion, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

### <a name="enumformatetc-method"></a><span data-ttu-id="4b656-275">Méthode EnumFormatEtc</span><span class="sxs-lookup"><span data-stu-id="4b656-275">EnumFormatEtc method</span></span>

<span data-ttu-id="4b656-276">Lorsque la cible reçoit un objet de données, il appelle généralement [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) pour déterminer les formats que l’objet contient.</span><span class="sxs-lookup"><span data-stu-id="4b656-276">When the target receives a data object, it commonly calls [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) to determine what formats the object contains.</span></span> <span data-ttu-id="4b656-277">La méthode crée un objet d’énumération OLE et retourne un pointeur vers l’interface [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) de l’objet.</span><span class="sxs-lookup"><span data-stu-id="4b656-277">The method creates an OLE enumeration object and returns a pointer to the object's [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface.</span></span> <span data-ttu-id="4b656-278">La cible utilise ensuite l’interface pour énumérer les formats disponibles.</span><span class="sxs-lookup"><span data-stu-id="4b656-278">The target then uses the interface to enumerate the available formats.</span></span>

<span data-ttu-id="4b656-279">Un objet d’énumération doit toujours énumérer les formats disponibles par ordre de qualité, en commençant par le meilleur.</span><span class="sxs-lookup"><span data-stu-id="4b656-279">An enumeration object should always enumerate the available formats in order of quality, starting with the best.</span></span> <span data-ttu-id="4b656-280">La qualité relative des formats est définie par la source de déplacement.</span><span class="sxs-lookup"><span data-stu-id="4b656-280">The relative quality of formats is defined by the drop source.</span></span> <span data-ttu-id="4b656-281">En général, les formats de qualité supérieure contiennent les données les plus riches et les plus complètes.</span><span class="sxs-lookup"><span data-stu-id="4b656-281">In general, the highest-quality formats contain the richest and most complete data.</span></span> <span data-ttu-id="4b656-282">Par exemple, une image de couleur de 24 bits est normalement considérée comme une qualité supérieure à celle d’une version à échelle grise de cette image.</span><span class="sxs-lookup"><span data-stu-id="4b656-282">For instance, a 24-bit color image would normally be considered higher quality than a gray-scale version of that image.</span></span> <span data-ttu-id="4b656-283">La raison de l’énumération des formats dans l’ordre de leur qualité est que les cibles sont généralement énumérées jusqu’à ce qu’elles accèdent à un format pris en charge, puis utilisent ce format pour extraire les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-283">The reason for enumerating formats in order of their quality is that targets typically enumerate until they get to a format that they support, and then they use that format to extract the data.</span></span> <span data-ttu-id="4b656-284">Pour que cette procédure produise le meilleur format disponible que la cible peut prendre en charge, les formats doivent être énumérés dans l’ordre de leur qualité.</span><span class="sxs-lookup"><span data-stu-id="4b656-284">For this procedure to produce the best available format that the target can support, the formats must be enumerated in order of their quality.</span></span>

<span data-ttu-id="4b656-285">Un objet d’énumération pour les données de l’interpréteur de commandes est implémenté à peu près de la même façon que pour d’autres types de transferts de données, avec une exception notable.</span><span class="sxs-lookup"><span data-stu-id="4b656-285">An enumeration object for Shell data is implemented in much the same way as for other types of data transfer, with one notable exception.</span></span> <span data-ttu-id="4b656-286">Étant donné que les objets de données ne contiennent généralement qu’un seul élément de données par format, ils énumèrent normalement chaque format passé à [**IDataObject :: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span><span class="sxs-lookup"><span data-stu-id="4b656-286">Because data objects typically contain only one data item per format, they normally enumerate every format that is passed to [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span></span> <span data-ttu-id="4b656-287">Toutefois, comme indiqué dans la section [méthode SetData](#setdata-method) , les objets de données Shell peuvent contenir plusieurs formats [CFSTR \_ FILECONTENTS](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="4b656-287">However, as discussed in the [SetData method](#setdata-method) section, Shell data objects can contain multiple [CFSTR\_FILECONTENTS](clipboard.md) formats.</span></span>

<span data-ttu-id="4b656-288">Étant donné que l’objectif de [**IDataObject :: EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) est de permettre à la cible de déterminer quels types de données sont présents, il n’est pas nécessaire d’énumérer plus d’un format [CFSTR \_ FILECONTENTS](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="4b656-288">Because the purpose of [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) is to allow the target to determine what types of data are present, there is no need to enumerate more than one [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="4b656-289">Si la cible doit connaître le nombre de ces formats que contient l’objet de données, la cible peut récupérer ces informations à partir du \_ format CFSTR FILEDESCRIPTOR associé.</span><span class="sxs-lookup"><span data-stu-id="4b656-289">If the target needs to know how many of these formats the data object contains, the target can retrieve that information from the accompanying CFSTR\_FILEDESCRIPTOR format.</span></span> <span data-ttu-id="4b656-290">Pour plus d’informations sur la façon d’implémenter **IDataObject :: EnumFormatEtc**, consultez la documentation de référence de la méthode.</span><span class="sxs-lookup"><span data-stu-id="4b656-290">For further discussion of how to implement **IDataObject::EnumFormatEtc**, see the method's reference documentation.</span></span>

### <a name="getdata-method"></a><span data-ttu-id="4b656-291">GetData, méthode</span><span class="sxs-lookup"><span data-stu-id="4b656-291">GetData method</span></span>

<span data-ttu-id="4b656-292">La cible appelle [**IDataObject :: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) pour extraire un format de données particulier.</span><span class="sxs-lookup"><span data-stu-id="4b656-292">The target calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to extract a particular data format.</span></span> <span data-ttu-id="4b656-293">La cible spécifie le format en passant la structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) appropriée.</span><span class="sxs-lookup"><span data-stu-id="4b656-293">The target specifies the format by passing in the appropriate [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="4b656-294">**IDataObject :: GetData** retourne la structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) du format.</span><span class="sxs-lookup"><span data-stu-id="4b656-294">**IDataObject::GetData** returns the format's [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>

<span data-ttu-id="4b656-295">La cible peut définir le membre **TYMED** de la structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) sur une valeur TYMED \_ *xxx* spécifique afin de spécifier le mécanisme de transfert de données qu’il utilisera pour extraire les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-295">The target can set the **tymed** member of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to a specific TYMED\_*XXX* value to specify which data transfer mechanism it will use to extract the data.</span></span> <span data-ttu-id="4b656-296">Toutefois, la cible peut également effectuer une demande plus générique et laisser l’objet de données décider.</span><span class="sxs-lookup"><span data-stu-id="4b656-296">However, the target can also make a more generic request and let the data object decide.</span></span> <span data-ttu-id="4b656-297">Pour demander à l’objet de données de sélectionner le mécanisme de transfert de données, la cible définit toutes les valeurs TYMED \_ *xxx* qu’elle prend en charge.</span><span class="sxs-lookup"><span data-stu-id="4b656-297">To ask the data object to select the data transfer mechanism, the target sets all the TYMED\_*XXX* values that it supports.</span></span> <span data-ttu-id="4b656-298">[**IDataObject :: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) sélectionne l’un de ces mécanismes de transfert de données et retourne la structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) appropriée.</span><span class="sxs-lookup"><span data-stu-id="4b656-298">[**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) selects one of these data transfer mechanisms and returns the appropriate [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="4b656-299">Par exemple, **TYMED** est généralement défini sur TYMED \_ HGLOBAL \| TYMED \_ ISTREAM \| TYMED \_ ISTORAGE pour demander l’un des trois mécanismes de transfert de données de Shell.</span><span class="sxs-lookup"><span data-stu-id="4b656-299">For instance, **tymed** is commonly set to TYMED\_HGLOBAL \| TYMED\_ISTREAM \| TYMED\_ISTORAGE to request any of the three Shell data transfer mechanisms.</span></span>

> [!Note]  
> <span data-ttu-id="4b656-300">Étant donné qu’il peut y avoir plusieurs formats [CFSTR \_ FILECONTENTS](clipboard.md) , les membres **cfFormat** et **TYMED** de la structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) ne sont pas suffisants pour indiquer la structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) que [**IDataObject :: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) doit retourner.</span><span class="sxs-lookup"><span data-stu-id="4b656-300">Because there can be multiple [CFSTR\_FILECONTENTS](clipboard.md) formats, the **cfFormat** and **tymed** members of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure are not sufficient to indicate which [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) should return.</span></span> <span data-ttu-id="4b656-301">Pour le \_ format CFSTR FILECONTENTS, **IDataObject :: GetData** doit également examiner le membre **Lindex** de la structure **FORMATETC** afin de retourner la structure **STGMEDIUM** correcte.</span><span class="sxs-lookup"><span data-stu-id="4b656-301">For the CFSTR\_FILECONTENTS format, **IDataObject::GetData** must also examine the **FORMATETC** structure's **lIndex** member in order to return the correct **STGMEDIUM** structure.</span></span>

 

<span data-ttu-id="4b656-302">Le format [CFSTR \_ INDRAGLOOP](clipboard.md) est placé dans les objets de données pour permettre aux cibles de vérifier l’état de la boucle de glisser-déplacer tout en évitant le rendu gourmand en mémoire des données de l’objet.</span><span class="sxs-lookup"><span data-stu-id="4b656-302">The [CFSTR\_INDRAGLOOP](clipboard.md) format is placed in data objects to allow targets to check the status of the drag-and-drop loop while avoiding memory intensive rendering of the object's data.</span></span> <span data-ttu-id="4b656-303">Les données du format sont une valeur **DWORD** qui est définie sur une valeur différente de zéro si l’objet de données se trouve dans une boucle de glissement.</span><span class="sxs-lookup"><span data-stu-id="4b656-303">The format's data is a **DWORD** value that is set to a nonzero value if the data object is within a drag loop.</span></span> <span data-ttu-id="4b656-304">La valeur de données du format est définie sur zéro si les données ont été supprimées.</span><span class="sxs-lookup"><span data-stu-id="4b656-304">The format's data value is set to zero if the data has been dropped.</span></span> <span data-ttu-id="4b656-305">Si une cible demande ce format et qu’elle n’a pas été chargée par la source, [**IDataObject :: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) doit répondre comme si la source avait chargé le format avec une valeur de zéro.</span><span class="sxs-lookup"><span data-stu-id="4b656-305">If a target requests this format and it has not been loaded by the source, [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) should respond as if the source had loaded the format with a value of zero.</span></span>

<span data-ttu-id="4b656-306">Lorsque le curseur se trouve sur la fenêtre cible, la cible peut utiliser l' [objet d’assistance glisser-déplacer](#using-the-drag-and-drop-helper-object) pour spécifier l’image de glissement.</span><span class="sxs-lookup"><span data-stu-id="4b656-306">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to specify the drag image.</span></span> <span data-ttu-id="4b656-307">L’objet d’assistance par glisser-déplacer appelle [**IDataObject :: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) pour charger des formats privés dans l’objet de données utilisé pour la prise en charge inter-processus.</span><span class="sxs-lookup"><span data-stu-id="4b656-307">The drag-and-drop helper object calls [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to load private formats into the data object that are used for cross-process support.</span></span> <span data-ttu-id="4b656-308">Il appelle ensuite [**IDataObject :: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) pour les récupérer.</span><span class="sxs-lookup"><span data-stu-id="4b656-308">It later calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to retrieve them.</span></span> <span data-ttu-id="4b656-309">Pour prendre en charge l’objet d’assistance par glisser-déplacer, votre implémentation d’objet de données Shell doit pouvoir retourner des formats privés arbitraires lorsqu’ils sont demandés.</span><span class="sxs-lookup"><span data-stu-id="4b656-309">To support the drag-and-drop helper object, your Shell Data Object implementation must be able to return arbitrary private formats when they are requested.</span></span>

### <a name="implementing-idropsource"></a><span data-ttu-id="4b656-310">Implémentation de IDropSource</span><span class="sxs-lookup"><span data-stu-id="4b656-310">Implementing IDropSource</span></span>

<span data-ttu-id="4b656-311">La source doit créer un objet qui expose une interface [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) .</span><span class="sxs-lookup"><span data-stu-id="4b656-311">The source must create an object that exposes an [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="4b656-312">Cette interface permet à la source de mettre à jour l' *image de glissement* qui indique la position actuelle du curseur et de fournir des commentaires au système sur la manière de mettre fin à une opération de glisser-déplacer.</span><span class="sxs-lookup"><span data-stu-id="4b656-312">This interface allows the source to update the *drag image* that indicates the current position of the cursor and to provide feedback to the system on how to terminate a drag-and-drop operation.</span></span> <span data-ttu-id="4b656-313">**IDropSource** a deux méthodes : [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) et [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).</span><span class="sxs-lookup"><span data-stu-id="4b656-313">**IDropSource** has two methods: [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) and [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).</span></span>

### <a name="givefeedback-method"></a><span data-ttu-id="4b656-314">GiveFeedback (méthode)</span><span class="sxs-lookup"><span data-stu-id="4b656-314">GiveFeedback method</span></span>

<span data-ttu-id="4b656-315">Pendant la boucle de glissement, une source de déplacement est chargée d’assurer le suivi de la position du curseur et d’afficher une image de glissement appropriée.</span><span class="sxs-lookup"><span data-stu-id="4b656-315">While in the drag loop, a drop source is responsible for keeping track of the cursor position and displaying an appropriate drag image.</span></span> <span data-ttu-id="4b656-316">Toutefois, dans certains cas, vous souhaiterez peut-être modifier l’apparence de l’image de glissement lorsqu’elle se trouve sur la fenêtre de la cible de déplacement.</span><span class="sxs-lookup"><span data-stu-id="4b656-316">However, in some cases you might want to change the appearance of the drag image when it is over the drop target's window.</span></span>

<span data-ttu-id="4b656-317">Lorsque le curseur entre dans la fenêtre cible ou en sort, et Pendant qu’il se déplace au-dessus de la fenêtre cible, le système appelle régulièrement l’interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) de la cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-317">When the cursor enters or leaves the target window and while it is moving over the target window, the system periodically calls the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span> <span data-ttu-id="4b656-318">La cible répond avec une valeur [**DROPEFFECT**](../com/dropeffect-constants.md) qui est transférée à la source via la méthode [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) .</span><span class="sxs-lookup"><span data-stu-id="4b656-318">The target responds with a [**DROPEFFECT**](../com/dropeffect-constants.md) value that is forwarded to the source through the [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) method.</span></span> <span data-ttu-id="4b656-319">Le cas échéant, la source peut modifier l’apparence du curseur en fonction de la valeur **DROPEFFECT** .</span><span class="sxs-lookup"><span data-stu-id="4b656-319">If appropriate, the source can modify the appearance of the cursor based on the **DROPEFFECT** value.</span></span> <span data-ttu-id="4b656-320">Pour plus d’informations, consultez les références **GiveFeedback** et [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) .</span><span class="sxs-lookup"><span data-stu-id="4b656-320">For further details, see the **GiveFeedback** and [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) references.</span></span>

### <a name="querycontinuedrag-method"></a><span data-ttu-id="4b656-321">QueryContinueDrag (méthode)</span><span class="sxs-lookup"><span data-stu-id="4b656-321">QueryContinueDrag method</span></span>

<span data-ttu-id="4b656-322">Cette méthode est appelée si le bouton de la souris ou l’état du clavier change alors que l’objet de données se trouve dans la boucle de glissement.</span><span class="sxs-lookup"><span data-stu-id="4b656-322">This method is called if the mouse button or keyboard state changes while the data object is in the drag loop.</span></span> <span data-ttu-id="4b656-323">Elle indique à la source si la touche ÉCHAP a été enfoncée et fournit l’état actuel des touches de modification du clavier, telles que CTRL ou Maj.</span><span class="sxs-lookup"><span data-stu-id="4b656-323">It notifies the source whether the ESC key has been pressed and provides the current state of the keyboard modifier keys, such as CTRL or SHIFT.</span></span> <span data-ttu-id="4b656-324">La valeur de retour de la méthode [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) spécifie l’une des trois actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="4b656-324">The [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) method's return value specifies one of three actions:</span></span>

-   <span data-ttu-id="4b656-325">\_OK.</span><span class="sxs-lookup"><span data-stu-id="4b656-325">S\_OK.</span></span> <span data-ttu-id="4b656-326">Continuer l’opération glisser</span><span class="sxs-lookup"><span data-stu-id="4b656-326">Continue the drag operation</span></span>
-   <span data-ttu-id="4b656-327">suppression d’DRAGDROP \_ S \_ .</span><span class="sxs-lookup"><span data-stu-id="4b656-327">DRAGDROP\_S\_DROP.</span></span> <span data-ttu-id="4b656-328">Supprimez les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-328">Drop the data.</span></span> <span data-ttu-id="4b656-329">Le système appelle ensuite la méthode [**IDropTarget ::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) de la cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-329">The system then calls the target's [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method.</span></span>
-   <span data-ttu-id="4b656-330">DRAGDROP \_ S \_ Annuler.</span><span class="sxs-lookup"><span data-stu-id="4b656-330">DRAGDROP\_S\_CANCEL.</span></span> <span data-ttu-id="4b656-331">Met fin à la boucle de glissement sans supprimer les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-331">Terminate the drag loop without dropping the data.</span></span> <span data-ttu-id="4b656-332">Cette valeur est généralement retournée si la touche ÉCHAP a été enfoncée.</span><span class="sxs-lookup"><span data-stu-id="4b656-332">This value is normally returned if the ESCAPE key was pressed.</span></span>

<span data-ttu-id="4b656-333">Pour plus d’informations, consultez les références [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) et [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) .</span><span class="sxs-lookup"><span data-stu-id="4b656-333">For further discussion, see the [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) and [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) references.</span></span>

## <a name="how-a-target-handles-a-data-object"></a><span data-ttu-id="4b656-334">Comment une cible gère un objet de données</span><span class="sxs-lookup"><span data-stu-id="4b656-334">How a Target Handles a Data Object</span></span>

<span data-ttu-id="4b656-335">La cible reçoit un objet de données lorsqu’il récupère l’objet de données du presse-papiers ou l’a supprimée de la fenêtre cible par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4b656-335">The target receives a data object when it either retrieves the data object from the Clipboard or has it dropped on the target window by the user.</span></span> <span data-ttu-id="4b656-336">La cible peut ensuite extraire des données de l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-336">The target can then extract data from the data object.</span></span> <span data-ttu-id="4b656-337">Si nécessaire, la cible peut également notifier l’objet de données du résultat de l’opération.</span><span class="sxs-lookup"><span data-stu-id="4b656-337">If necessary, the target can also notify the data object of the outcome of the operation.</span></span> <span data-ttu-id="4b656-338">Avant un transfert de données Shell, une cible de déplacement doit se préparer pour l’opération :</span><span class="sxs-lookup"><span data-stu-id="4b656-338">Prior to a Shell data transfer, a drop target must prepare itself for the operation:</span></span>

1.  <span data-ttu-id="4b656-339">La cible doit appeler [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) pour obtenir une valeur de format de presse-papiers valide pour tous les formats de Shell, à l’exception de [CF \_ HDROP](clipboard.md), qui peut être incluse dans l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-339">The target must call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to obtain a valid clipboard format value for all Shell formats, other than [CF\_HDROP](clipboard.md), that might be included in the data object.</span></span> <span data-ttu-id="4b656-340">CF \_ HDROP est déjà un format de presse-papiers valide et n’a pas besoin d’être inscrit.</span><span class="sxs-lookup"><span data-stu-id="4b656-340">CF\_HDROP is already a valid clipboard format and does not need to be registered.</span></span>
2.  <span data-ttu-id="4b656-341">Pour prendre en charge une opération de glisser-déplacer, la cible doit implémenter une interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) et inscrire une fenêtre cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-341">To support a drag-and-drop operation, the target must implement an [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface and register a target window.</span></span> <span data-ttu-id="4b656-342">Pour inscrire une fenêtre cible, la cible appelle [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) et passe le handle de la fenêtre et le pointeur d’interface **IDropTarget** .</span><span class="sxs-lookup"><span data-stu-id="4b656-342">To register a target window, the target calls [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) and passes in the window's handle and the **IDropTarget** interface pointer.</span></span>

<span data-ttu-id="4b656-343">Pour les transferts du presse-papiers, la cible ne reçoit aucune notification indiquant qu’un objet de données a été placé dans le presse-papiers.</span><span class="sxs-lookup"><span data-stu-id="4b656-343">For clipboard transfers, the target does not receive any notification that a data object has been placed on the Clipboard.</span></span> <span data-ttu-id="4b656-344">En règle générale, une application est avertie qu’un objet se trouve dans le presse-papiers par une action de l’utilisateur, par exemple en cliquant sur le bouton coller dans la barre d’outils de l’application.</span><span class="sxs-lookup"><span data-stu-id="4b656-344">Typically, an application is notified that an object is on the Clipboard by a user action, such as clicking the Paste button on the application's toolbar.</span></span> <span data-ttu-id="4b656-345">La cible récupère ensuite le pointeur [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) de l’objet de données à partir du presse-papiers en appelant [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span><span class="sxs-lookup"><span data-stu-id="4b656-345">The target then retrieves the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer from the Clipboard by calling [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span> <span data-ttu-id="4b656-346">Pour les transferts de données par glisser-déplacer, le système utilise l’interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) de la cible pour fournir à la cible des informations sur la progression du transfert de données :</span><span class="sxs-lookup"><span data-stu-id="4b656-346">For drag-and-drop data transfers, the system uses the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface to provide the target with information about the progress of the data transfer:</span></span>

-   <span data-ttu-id="4b656-347">Le système appelle [**IDropTarget ::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) lorsque le curseur entre dans la fenêtre cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-347">The system calls [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) when the cursor enters the target window.</span></span>
-   <span data-ttu-id="4b656-348">Le système appelle ensuite [**IDropTarget ::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) lorsque le curseur passe sur la fenêtre cible, pour attribuer à la cible la position actuelle du curseur.</span><span class="sxs-lookup"><span data-stu-id="4b656-348">The system periodically calls [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) as the cursor passes over the target window, to give the target the current cursor position.</span></span>
-   <span data-ttu-id="4b656-349">Le système appelle [**IDropTarget ::D ragleave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) lorsque le curseur quitte la fenêtre cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-349">The system calls [**IDropTarget::DragLeave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) when the cursor leaves the target window.</span></span>
-   <span data-ttu-id="4b656-350">Le système appelle [**IDropTarget ::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) lorsque l’utilisateur dépose l’objet de données dans la fenêtre cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-350">The system calls [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) when the user drops the data object on the target window.</span></span>

<span data-ttu-id="4b656-351">Pour plus d’informations sur l’implémentation de ces méthodes, consultez [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).</span><span class="sxs-lookup"><span data-stu-id="4b656-351">For a discussion of how to implement these methods, see [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).</span></span>

<span data-ttu-id="4b656-352">Lorsque les données sont supprimées, [**IDropTarget ::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) fournit la cible avec un pointeur vers l’interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) de l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-352">When the data is dropped, [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) provides the target with a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="4b656-353">La cible utilise ensuite cette interface pour extraire des données de l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-353">The target then uses this interface to extract data from the data object.</span></span>

### <a name="extracting-shell-data-from-a-data-object"></a><span data-ttu-id="4b656-354">Extraction des données de l’interpréteur de commandes à partir d’un objet de données</span><span class="sxs-lookup"><span data-stu-id="4b656-354">Extracting Shell Data from a Data Object</span></span>

<span data-ttu-id="4b656-355">Une fois qu’un objet de données a été supprimé ou récupéré du presse-papiers, la cible peut extraire les données dont il a besoin.</span><span class="sxs-lookup"><span data-stu-id="4b656-355">Once a data object has been dropped or retrieved from the Clipboard, the target can extract the data it needs.</span></span> <span data-ttu-id="4b656-356">La première étape du processus d’extraction consiste généralement à énumérer les formats contenus dans l’objet de données :</span><span class="sxs-lookup"><span data-stu-id="4b656-356">The first step in the extraction process is typically to enumerate the formats contained by the data object:</span></span>

-   <span data-ttu-id="4b656-357">Appelez [**IDataObject :: EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc).</span><span class="sxs-lookup"><span data-stu-id="4b656-357">Call [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc).</span></span> <span data-ttu-id="4b656-358">L’objet de données crée un objet énumération OLE standard et retourne un pointeur vers son interface [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) .</span><span class="sxs-lookup"><span data-stu-id="4b656-358">The data object creates a standard OLE enumeration object and returns a pointer to its [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface.</span></span>
-   <span data-ttu-id="4b656-359">Utilisez les méthodes [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) pour énumérer les formats contenus dans l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-359">Use the [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) methods to enumerate the formats contained by the data object.</span></span> <span data-ttu-id="4b656-360">Cette opération récupère généralement une structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) pour chaque format que l’objet contient.</span><span class="sxs-lookup"><span data-stu-id="4b656-360">This operation usually retrieves one [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure for each format that the object contains.</span></span> <span data-ttu-id="4b656-361">Toutefois, l’objet d’énumération ne retourne normalement qu’une seule structure **FORMATETC** pour le format [CFSTR \_ FILECONTENTS](clipboard.md) , quel que soit le nombre de ces formats contenus dans l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-361">However, the enumeration object normally returns only a single **FORMATETC** structure for the [CFSTR\_FILECONTENTS](clipboard.md) format, regardless of how many such formats are contained by the data object.</span></span>
-   <span data-ttu-id="4b656-362">Sélectionnez un ou plusieurs formats à extraire et stockez leurs structures [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="4b656-362">Select one or more formats to be extracted, and store their [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structures.</span></span>

<span data-ttu-id="4b656-363">Pour récupérer un format particulier, transmettez la structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) associée à [**IDataObject :: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span><span class="sxs-lookup"><span data-stu-id="4b656-363">To retrieve a particular format, pass the associated [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span></span> <span data-ttu-id="4b656-364">Cette méthode retourne une structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) qui fournit l’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="4b656-364">This method returns an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure that provides access to the data.</span></span> <span data-ttu-id="4b656-365">Pour spécifier un mécanisme de transfert de données particulier, définissez la valeur **TYMED** de la structure **FORMATETC** sur la \_ valeur TYMED *xxx* correspondante.</span><span class="sxs-lookup"><span data-stu-id="4b656-365">To specify a particular data transfer mechanism, set the **tymed** value of the **FORMATETC** structure to the corresponding TYMED\_*XXX* value.</span></span> <span data-ttu-id="4b656-366">Pour demander à l’objet de données de sélectionner un mécanisme de transfert de données, la cible définit les valeurs TYMED \_ *xxx* pour chaque mécanisme de transfert de données que la cible peut gérer.</span><span class="sxs-lookup"><span data-stu-id="4b656-366">To ask the data object to select a data transfer mechanism, the target sets the TYMED\_*XXX* values for every data transfer mechanism that the target can handle.</span></span> <span data-ttu-id="4b656-367">L’objet de données sélectionne l’un de ces mécanismes de transfert de données et retourne la structure **STGMEDIUM** appropriée.</span><span class="sxs-lookup"><span data-stu-id="4b656-367">The data object selects one of these data transfer mechanisms and returns the appropriate **STGMEDIUM** structure.</span></span>

<span data-ttu-id="4b656-368">Pour la plupart des formats, la cible peut récupérer les données en passant la structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) qu’elle a reçue lors de l’énumération des formats disponibles.</span><span class="sxs-lookup"><span data-stu-id="4b656-368">For most formats, the target can retrieve the data by passing the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure that it received when it enumerated the available formats.</span></span> <span data-ttu-id="4b656-369">Une exception à cette règle est [CFSTR \_ FILECONTENTS](clipboard.md).</span><span class="sxs-lookup"><span data-stu-id="4b656-369">One exception to this rule is [CFSTR\_FILECONTENTS](clipboard.md).</span></span> <span data-ttu-id="4b656-370">Comme un objet de données peut contenir plusieurs instances de ce format, la structure **FORMATETC** retournée par l’énumérateur peut ne pas correspondre au format particulier que vous souhaitez extraire.</span><span class="sxs-lookup"><span data-stu-id="4b656-370">Because a data object can contain multiple instances of this format, the **FORMATETC** structure returned by the enumerator might not correspond to the particular format you want to extract.</span></span> <span data-ttu-id="4b656-371">En plus de spécifier les membres **cfFormat** et **TYMED** , vous devez également définir le membre **Lindex** sur la valeur d’index du fichier.</span><span class="sxs-lookup"><span data-stu-id="4b656-371">In addition to specifying the **cfFormat** and **tymed** members, you must also set the **lIndex** member to the file's index value.</span></span> <span data-ttu-id="4b656-372">Pour plus d’informations, consultez la section *utilisation du \_ format CFSTR FILECONTENTS pour extraire des données à partir d’un fichier dans* gestion des scénarios de l' [interpréteur](datascenarios.md) de commandes transfert de données</span><span class="sxs-lookup"><span data-stu-id="4b656-372">For further discussion, see the *Using the CFSTR\_FILECONTENTS Format to Extract Data from a File* section of [Handling Shell Data Transfer Scenarios](datascenarios.md)</span></span>

<span data-ttu-id="4b656-373">Le processus d’extraction de données dépend du type de pointeur contenu dans la structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) retournée.</span><span class="sxs-lookup"><span data-stu-id="4b656-373">The data extraction process depends on the type of pointer contained by the returned [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="4b656-374">Si la structure contient un pointeur vers une interface [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) ou [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) , utilisez les méthodes d’interface pour extraire les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-374">If the structure contains a pointer to an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface, use the interface methods to extract the data.</span></span> <span data-ttu-id="4b656-375">Le processus d’extraction de données à partir d’un objet mémoire global est abordé dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="4b656-375">The process of extracting data from a global memory object is discussed in the next section.</span></span>

### <a name="extracting-a-global-memory-object-from-a-data-object"></a><span data-ttu-id="4b656-376">Extraction d’un objet de mémoire globale à partir d’un objet de données</span><span class="sxs-lookup"><span data-stu-id="4b656-376">Extracting a global memory object from a data object</span></span>

<span data-ttu-id="4b656-377">La plupart des formats de données de Shell se présentent sous la forme d’un objet de mémoire globale.</span><span class="sxs-lookup"><span data-stu-id="4b656-377">Many of the Shell data formats are in the form of a global memory object.</span></span> <span data-ttu-id="4b656-378">Utilisez la procédure suivante pour extraire un format contenant un objet de mémoire globale à partir d’un objet de données et assigner ses données à une variable locale :</span><span class="sxs-lookup"><span data-stu-id="4b656-378">Use the following procedure to extract a format containing a global memory object from a data object and assign its data to a local variable:</span></span>

1.  <span data-ttu-id="4b656-379">Créer une structure [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="4b656-379">Create a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="4b656-380">Définissez le membre **cfFormat** sur la valeur de format du presse-papiers appropriée et le membre **TYMED** sur TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="4b656-380">Set the **cfFormat** member to the appropriate clipboard format value and the **tymed** member to TYMED\_HGLOBAL.</span></span>
2.  <span data-ttu-id="4b656-381">Créez une structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) vide.</span><span class="sxs-lookup"><span data-stu-id="4b656-381">Create an empty [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
3.  <span data-ttu-id="4b656-382">Appelez [**IDataObject :: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata)et transmettez des pointeurs aux structures [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) et [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="4b656-382">Call [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata), and pass in pointers to the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures.</span></span>

    <span data-ttu-id="4b656-383">Quand [**IDataObject :: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) est retourné, la structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) contient un pointeur vers l’objet de mémoire globale qui contient les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-383">When [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) returns, the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure will contain a pointer to the global memory object that contains the data.</span></span>

4.  <span data-ttu-id="4b656-384">Assignez les données à une variable locale en appelant [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) et en passant le membre **hGlobal** de la structure [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="4b656-384">Assign the data to a local variable by calling [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) and passing in the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
5.  <span data-ttu-id="4b656-385">Appelez [**GlobalUnlock**](/windows/win32/api/winbase/nf-winbase-globalunlock) pour libérer le verrou sur l’objet de mémoire globale.</span><span class="sxs-lookup"><span data-stu-id="4b656-385">Call [**GlobalUnlock**](/windows/win32/api/winbase/nf-winbase-globalunlock) to release the lock on the global memory object.</span></span>
6.  <span data-ttu-id="4b656-386">Appelez [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) pour libérer l’objet mémoire global.</span><span class="sxs-lookup"><span data-stu-id="4b656-386">Call [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) to release the global memory object.</span></span>

> [!Note]  
> <span data-ttu-id="4b656-387">Vous devez utiliser [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) pour libérer l’objet mémoire global, et non [**GlobalFree**](/windows/win32/api/winbase/nf-winbase-globalfree).</span><span class="sxs-lookup"><span data-stu-id="4b656-387">You must use [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) to release the global memory object, not [**GlobalFree**](/windows/win32/api/winbase/nf-winbase-globalfree).</span></span>

 

<span data-ttu-id="4b656-388">L’exemple suivant montre comment extraire une valeur **DWORD** stockée en tant qu’objet de mémoire globale à partir d’un objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-388">The following example shows how to extract a **DWORD** value stored as a global memory object from a data object.</span></span> <span data-ttu-id="4b656-389">Le paramètre **pdtobj** est un pointeur vers l’interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) de l’objet de données, **CF** est le format de presse-papiers qui identifie les données souhaitées, et **pdwOut** est utilisé pour retourner la valeur de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-389">The **pdtobj** parameter is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, **cf** is the clipboard format that identifies the desired data, and **pdwOut** is used to return the data value.</span></span>


```C++
STDAPI DataObj_GetDWORD(IDataObject *pdtobj, UINT cf, DWORD *pdwOut)
{    STGMEDIUM medium;
   FORMATETC fmte = {(CLIPFORMAT) cf, NULL, DVASPECT_CONTENT, -1, 
       TYMED_HGLOBAL};
    HRESULT hres = pdtobj->GetData(&fmte, &medium);
    if (SUCCEEDED(hres))
   {
       DWORD *pdw = (DWORD *)GlobalLock(medium.hGlobal);
       if (pdw)
       {
           *pdwOut = *pdw;
           GlobalUnlock(medium.hGlobal);
       }
       else
       {
           hres = E_UNEXPECTED;
       }
       ReleaseStgMedium(&medium);
   }
   return hres;
}
```



### <a name="implementing-idroptarget"></a><span data-ttu-id="4b656-390">Implémentation de IDropTarget</span><span class="sxs-lookup"><span data-stu-id="4b656-390">Implementing IDropTarget</span></span>

<span data-ttu-id="4b656-391">Le système utilise l’interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) pour communiquer avec la cible lorsque le curseur se trouve sur la fenêtre cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-391">The system uses the [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface to communicate with the target while the cursor is over the target window.</span></span> <span data-ttu-id="4b656-392">Les réponses de la cible sont transférées à la source via son interface [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) .</span><span class="sxs-lookup"><span data-stu-id="4b656-392">The target's responses are forwarded to the source through its [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="4b656-393">En fonction de la réponse, la source peut modifier l’icône qui représente les données.</span><span class="sxs-lookup"><span data-stu-id="4b656-393">Depending on the response, the source can modify the icon that represents the data.</span></span> <span data-ttu-id="4b656-394">Si la cible de déplacement doit spécifier l’icône de données, elle peut le faire en créant un [objet d’assistance par glisser-déplacer](#using-the-drag-and-drop-helper-object).</span><span class="sxs-lookup"><span data-stu-id="4b656-394">If the drop target needs to specify the data icon, it can do so by creating a [drag-and-drop helper object](#using-the-drag-and-drop-helper-object).</span></span>

<span data-ttu-id="4b656-395">Avec les opérations de glisser-déplacer conventionnelles, la cible informe l’objet de données du résultat de l’opération en définissant le paramètre *pdwEffect* de [**IDropTarget ::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) à la valeur [**DROPEFFECT**](../com/dropeffect-constants.md) appropriée.</span><span class="sxs-lookup"><span data-stu-id="4b656-395">With conventional drag-and-drop operations, the target informs the data object of the outcome of the operation by setting the *pdwEffect* parameter of [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) to the appropriate [**DROPEFFECT**](../com/dropeffect-constants.md) value.</span></span> <span data-ttu-id="4b656-396">Avec les objets de données de l’interpréteur de commandes, la cible peut également avoir besoin d’appeler [**IDataObject :: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span><span class="sxs-lookup"><span data-stu-id="4b656-396">With Shell data objects, the target might also need to call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span></span> <span data-ttu-id="4b656-397">Pour plus d’informations sur la façon dont les cibles doivent répondre à différents scénarios de transfert de données, consultez [gestion des scénarios de transfert de données de l’interpréteur](datascenarios.md)de commandes.</span><span class="sxs-lookup"><span data-stu-id="4b656-397">For a discussion of how targets should respond for different data transfer scenarios, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

<span data-ttu-id="4b656-398">Les sections suivantes décrivent brièvement comment implémenter les méthodes de l’exemple [**IDropTarget ::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**IDropTarget ::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover)et [**IDropTarget ::D**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) .</span><span class="sxs-lookup"><span data-stu-id="4b656-398">The following sections briefly discuss how to implement the [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover), and [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) methods.</span></span> <span data-ttu-id="4b656-399">Pour plus d’informations, consultez la documentation de référence.</span><span class="sxs-lookup"><span data-stu-id="4b656-399">For further details, see the reference documentation.</span></span>

### <a name="dragenter-method"></a><span data-ttu-id="4b656-400">DragEnter, méthode</span><span class="sxs-lookup"><span data-stu-id="4b656-400">DragEnter method</span></span>

<span data-ttu-id="4b656-401">Le système appelle la méthode [**IDropTarget ::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) lorsque le curseur entre dans la fenêtre cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-401">The system calls the [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) method when the cursor enters the target window.</span></span> <span data-ttu-id="4b656-402">Ses paramètres fournissent la cible avec l’emplacement du curseur, l’état des touches de modification du clavier, telles que la touche CTRL, et un pointeur vers l’interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) de l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-402">Its parameters provide the target with the location of the cursor, the state of keyboard modifier keys such as the CTRL key, and a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="4b656-403">La cible est chargée d’utiliser cette interface pour déterminer si elle peut accepter n’importe quel format contenu dans l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-403">The target is responsible for using that interface to determine whether it can accept any of the formats contained by the data object.</span></span> <span data-ttu-id="4b656-404">Si tel est le cas, la valeur de *pdwEffect* reste inchangée.</span><span class="sxs-lookup"><span data-stu-id="4b656-404">If it can, it normally leaves the value of *pdwEffect* unchanged.</span></span> <span data-ttu-id="4b656-405">S’il ne peut pas accepter de données de l’objet de données, il définit le paramètre *pdwEffect* sur DROPEFFECT \_ None.</span><span class="sxs-lookup"><span data-stu-id="4b656-405">If it cannot accept any data from the data object, it sets the *pdwEffect* parameter to DROPEFFECT\_NONE.</span></span> <span data-ttu-id="4b656-406">Le système passe la valeur de ce paramètre à l’interface [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) de l’objet de données pour lui permettre d’afficher l’image de glissement appropriée.</span><span class="sxs-lookup"><span data-stu-id="4b656-406">The system passes the value of this parameter to the data object's [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface to allow it to display the appropriate drag image.</span></span>

<span data-ttu-id="4b656-407">Les cibles ne doivent pas utiliser la méthode [**IDataObject :: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) pour restituer les données de l’interpréteur de commandes avant qu’elles aient été supprimées.</span><span class="sxs-lookup"><span data-stu-id="4b656-407">Targets should not use the [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) method to render Shell data before it has been dropped.</span></span> <span data-ttu-id="4b656-408">Le rendu complet des données de l’objet pour chaque occurrence peut entraîner le blocage du curseur de glissement.</span><span class="sxs-lookup"><span data-stu-id="4b656-408">Fully rendering the object's data for each such occurrence might cause the drag cursor to stall.</span></span> <span data-ttu-id="4b656-409">Pour éviter ce problème, certains objets Shell contiennent un format [CFSTR \_ INDRAGLOOP](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="4b656-409">To avoid this problem, some Shell objects contain a [CFSTR\_INDRAGLOOP](clipboard.md) format.</span></span> <span data-ttu-id="4b656-410">En extrayant ce format, les cibles peuvent vérifier l’état de la boucle de glissement tout en évitant le rendu gourmand en mémoire des données de l’objet.</span><span class="sxs-lookup"><span data-stu-id="4b656-410">By extracting this format, targets can check the status of the drag loop while avoiding memory intensive rendering of the object's data.</span></span> <span data-ttu-id="4b656-411">La valeur de données du format est une valeur **DWORD** qui est définie sur une valeur différente de zéro si l’objet de données se trouve dans une boucle de glissement.</span><span class="sxs-lookup"><span data-stu-id="4b656-411">The format's data value is a **DWORD** that is set to a nonzero value if the data object is within a drag loop.</span></span> <span data-ttu-id="4b656-412">La valeur de données du format est définie sur zéro si les données ont été supprimées.</span><span class="sxs-lookup"><span data-stu-id="4b656-412">The format's data value is set to zero if the data has been dropped.</span></span>

<span data-ttu-id="4b656-413">Si la cible peut accepter des données de l’objet de données, elle doit examiner **grfKeyState** pour déterminer si des touches de modification ont été enfoncées pour modifier le comportement de suppression normal.</span><span class="sxs-lookup"><span data-stu-id="4b656-413">If the target can accept data from the data object, it should examine **grfKeyState** to determine whether any modifier keys have been pressed to modify the normal drop behavior.</span></span> <span data-ttu-id="4b656-414">Par exemple, l’opération par défaut est généralement un déplacement, mais la pression sur la touche CTRL indique généralement une opération de copie.</span><span class="sxs-lookup"><span data-stu-id="4b656-414">For instance, the default operation is typically a move, but depressing the CTRL key usually indicates a copy operation.</span></span>

<span data-ttu-id="4b656-415">Lorsque le curseur se trouve sur la fenêtre cible, la cible peut utiliser l' [objet d’assistance par glisser-déplacer](#using-the-drag-and-drop-helper-object) pour remplacer l’image de glissement de l’objet de données par son propre.</span><span class="sxs-lookup"><span data-stu-id="4b656-415">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to replace the data object's drag image with its own.</span></span> <span data-ttu-id="4b656-416">Si c’est le cas, [**IDropTarget ::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) doit appeler [**IDropTargetHelper ::D ragenter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) pour passer les informations contenues dans les paramètres *DragEnter* à l’objet d’assistance de glisser-déplacer.</span><span class="sxs-lookup"><span data-stu-id="4b656-416">If so, [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) should call [**IDropTargetHelper::DragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) to pass the information contained in the *DragEnter* parameters to the drag-and-drop helper object.</span></span>

### <a name="dragover-method"></a><span data-ttu-id="4b656-417">DragOver, méthode</span><span class="sxs-lookup"><span data-stu-id="4b656-417">DragOver method</span></span>

<span data-ttu-id="4b656-418">Au fur et à mesure que le curseur se déplace dans la fenêtre cible, le système appelle périodiquement la méthode [**IDropTarget ::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) .</span><span class="sxs-lookup"><span data-stu-id="4b656-418">As the cursor moves within the target window, the system periodically calls the [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) method.</span></span> <span data-ttu-id="4b656-419">Ses paramètres fournissent la cible avec l’emplacement du curseur et l’état des touches de modification du clavier, telles que la touche CTRL.</span><span class="sxs-lookup"><span data-stu-id="4b656-419">Its parameters provide the target with the location of the cursor and the state of keyboard modifier keys such as the CTRL key.</span></span> <span data-ttu-id="4b656-420">**IDropTarget ::D ragover** a les mêmes responsabilités que [**IDropTarget ::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), et les implémentations sont généralement très similaires.</span><span class="sxs-lookup"><span data-stu-id="4b656-420">**IDropTarget::DragOver** has much the same responsibilities as [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), and the implementations are usually very similar.</span></span>

<span data-ttu-id="4b656-421">Si la cible utilise l’objet d’assistance par glisser-déplacer, [**IDropTarget ::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) doit appeler [**IDropTargetHelper ::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) pour transférer les informations contenues dans les paramètres *DragOver* à l’objet d’assistance de glisser-déplacer.</span><span class="sxs-lookup"><span data-stu-id="4b656-421">If the target is using the drag-and-drop helper object, [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) should call [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) to forward the information contained in the *DragOver* parameters to the drag-and-drop helper object.</span></span>

### <a name="drop-method"></a><span data-ttu-id="4b656-422">Drop, méthode</span><span class="sxs-lookup"><span data-stu-id="4b656-422">Drop method</span></span>

<span data-ttu-id="4b656-423">Le système appelle la méthode [**IDropTarget ::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) pour notifier à la cible que l’utilisateur a supprimé les données, en général en relâchant le bouton de la souris.</span><span class="sxs-lookup"><span data-stu-id="4b656-423">The system calls the [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method to notify the target that the user has dropped the data, typically by releasing the mouse button.</span></span> <span data-ttu-id="4b656-424">**IDropTarget ::D ROP** a les mêmes paramètres que [**IDropTarget ::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span><span class="sxs-lookup"><span data-stu-id="4b656-424">**IDropTarget::Drop** has the same parameters as [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span></span> <span data-ttu-id="4b656-425">La cible répond normalement en extrayant un ou plusieurs formats de l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-425">The target normally responds by extracting one or more formats from the data object.</span></span> <span data-ttu-id="4b656-426">Lorsque vous avez terminé, la cible doit définir le paramètre *pdwEffect* sur une valeur [**DROPEFFECT**](../com/dropeffect-constants.md) qui indique le résultat de l’opération.</span><span class="sxs-lookup"><span data-stu-id="4b656-426">When finished, the target should set the *pdwEffect* parameter to a [**DROPEFFECT**](../com/dropeffect-constants.md) value that indicates the outcome of the operation.</span></span> <span data-ttu-id="4b656-427">Pour certains types de transferts de données de Shell, la cible doit également appeler [**IDataObject :: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) pour passer un format avec des informations supplémentaires sur le résultat de l’opération à l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-427">For some types of Shell data transfer, the target must also call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to pass a format with additional information on the outcome of the operation to the data object.</span></span> <span data-ttu-id="4b656-428">Pour une présentation détaillée, consultez [gestion des scénarios de transfert de données de l’interpréteur](datascenarios.md)de commandes.</span><span class="sxs-lookup"><span data-stu-id="4b656-428">For a detailed discussion, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

<span data-ttu-id="4b656-429">Si la cible utilise l’objet d’assistance par glisser-déplacer, [**IDropTarget ::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) doit appeler [**IDropTargetHelper ::D ROP**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) pour transférer les informations contenues dans les paramètres [**IDropTargetHelper ::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) à l’objet d’assistance de glisser-déplacer.</span><span class="sxs-lookup"><span data-stu-id="4b656-429">If the target is using the drag-and-drop helper object, [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) should call [**IDropTargetHelper::Drop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) to forward the information contained in the [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) parameters to the drag-and-drop helper object.</span></span>

## <a name="using-the-drag-and-drop-helper-object"></a><span data-ttu-id="4b656-430">Utilisation de l’objet d’assistance par glisser-déplacer</span><span class="sxs-lookup"><span data-stu-id="4b656-430">Using the Drag-and-Drop Helper Object</span></span>

<span data-ttu-id="4b656-431">L’objet d’assistance par glisser-déplacer (CLSID \_ DragDropHelper) est exporté par l’interpréteur de commandes pour permettre aux cibles de spécifier l’image du glissement pendant qu’elle se trouve sur la fenêtre cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-431">The drag-and-drop helper object (CLSID\_DragDropHelper) is exported by the Shell to allow targets to specify the drag image while it is over the target window.</span></span> <span data-ttu-id="4b656-432">Pour utiliser l’objet d’assistance par glisser-déplacer, créez un objet serveur in-process en appelant [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) avec un identificateur de classe (CLSID) de CLSID \_ DragDropHelper.</span><span class="sxs-lookup"><span data-stu-id="4b656-432">To use the drag-and-drop helper object, create an in-process server object by calling [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) with a class identifier (CLSID) of CLSID\_DragDropHelper.</span></span> <span data-ttu-id="4b656-433">L’objet d’assistance par glisser-déplacer expose deux interfaces qui sont utilisées de la façon suivante :</span><span class="sxs-lookup"><span data-stu-id="4b656-433">The drag-and-drop helper object exposes two interfaces that are used in the following way:</span></span>

-   <span data-ttu-id="4b656-434">L’interface [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) permet à la cible de déplacement de spécifier une icône pour représenter l’objet de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-434">The [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) interface allows the drop target to specify an icon to represent the data object.</span></span>
-   <span data-ttu-id="4b656-435">L’interface [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) permet à la cible de déplacement d’informer l’objet d’assistance du glisser-déplacer de l’emplacement du curseur, et d’afficher ou de masquer l’icône de données.</span><span class="sxs-lookup"><span data-stu-id="4b656-435">The [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) interface allows the drop target to inform the drag-and-drop helper object of the cursor location, and to show or hide the data icon.</span></span>

### <a name="using-the-idragsourcehelper-interface"></a><span data-ttu-id="4b656-436">Utilisation de l’interface IDragSourceHelper</span><span class="sxs-lookup"><span data-stu-id="4b656-436">Using the IDragSourceHelper Interface</span></span>

<span data-ttu-id="4b656-437">L’interface [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) est exposée par l’objet d’assistance par glisser-déplacer pour permettre à une cible de déplacement de fournir l’image qui sera affichée lorsque le curseur se trouve sur la fenêtre cible.</span><span class="sxs-lookup"><span data-stu-id="4b656-437">The [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) interface is exposed by the drag-and-drop helper object to allow a drop target to provide the image that will be displayed while the cursor is over the target window.</span></span> <span data-ttu-id="4b656-438">**IDragSourceHelper** fournit deux autres méthodes pour spécifier l’image bitmap à utiliser comme image de glissement :</span><span class="sxs-lookup"><span data-stu-id="4b656-438">**IDragSourceHelper** provides two alternative ways to specify the bitmap to be used as a drag image:</span></span>

-   <span data-ttu-id="4b656-439">Les cibles de dépôt qui ont une fenêtre peuvent enregistrer un \_ message de fenêtre di GETDRAGIMAGE pour celle-ci en initialisant l’objet d’assistance glisser-déplacer avec [**IDragSourceHelper :: InitializeFromWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow).</span><span class="sxs-lookup"><span data-stu-id="4b656-439">Drop targets that have a window can register a DI\_GETDRAGIMAGE window message for it by initializing the drag-and-drop helper object with [**IDragSourceHelper::InitializeFromWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow).</span></span> <span data-ttu-id="4b656-440">Lorsque la cible reçoit un \_ message di GETDRAGIMAGE, le gestionnaire place les informations de bitmap de l’image de glissement dans la structure [**SHDRAGIMAGE**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) qui est passée comme valeur *lParam* du message.</span><span class="sxs-lookup"><span data-stu-id="4b656-440">When the target receives a DI\_GETDRAGIMAGE message, the handler puts the drag image bitmap information in the [**SHDRAGIMAGE**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) structure that is passed as the message's *lParam* value.</span></span>
-   <span data-ttu-id="4b656-441">Les cibles de déplacement sans fenêtre spécifient une image bitmap lorsqu’elles initialisent l’objet d’assistance glisser-déplacer avec [**IDragSourceHelper :: InitializeFromBitmap**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap).</span><span class="sxs-lookup"><span data-stu-id="4b656-441">Windowless drop targets specify a bitmap when they initialize the drag-and-drop helper object with [**IDragSourceHelper::InitializeFromBitmap**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap).</span></span>

### <a name="using-the-idroptargethelper-interface"></a><span data-ttu-id="4b656-442">Utilisation de l’interface IDropTargetHelper</span><span class="sxs-lookup"><span data-stu-id="4b656-442">Using the IDropTargetHelper Interface</span></span>

<span data-ttu-id="4b656-443">Cette interface permet à la cible de déplacement de notifier l’objet d’assistance de glisser-déplacer lorsque le curseur entre dans la cible ou en sort.</span><span class="sxs-lookup"><span data-stu-id="4b656-443">This interface allows the drop target to notify the drag-and-drop helper object when the cursor enters or leaves the target.</span></span> <span data-ttu-id="4b656-444">Lorsque le curseur se trouve sur la fenêtre cible, [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) permet à la cible de fournir à l’objet d’assistance glisser-déplacer les informations que la cible reçoit via son interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) .</span><span class="sxs-lookup"><span data-stu-id="4b656-444">While the cursor is over the target window, [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) allows the target to give the drag-and-drop helper object the information that the target receives through its [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span>

<span data-ttu-id="4b656-445">Quatre des méthodes [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) ,[**IDropTargetHelper ::D ragenter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**IDropTargetHelper ::D Ragleave**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave), [**IDropTargetHelper ::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover)et [**IDropTargetHelper ::D ROP**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop), sont associées à la méthode [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) du même nom.</span><span class="sxs-lookup"><span data-stu-id="4b656-445">Four of the [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) methods—[**IDropTargetHelper::DragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**IDropTargetHelper::DragLeave**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave), [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover), and [**IDropTargetHelper::Drop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop)—are associated with the [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) method of the same name.</span></span> <span data-ttu-id="4b656-446">Pour utiliser l’objet d’assistance par glisser-déplacer, chacune des méthodes **IDropTarget** doit appeler la méthode **IDropTargetHelper** correspondante pour transférer les informations à l’objet d’assistance de glisser-déplacer.</span><span class="sxs-lookup"><span data-stu-id="4b656-446">To use the drag-and-drop helper object, each of the **IDropTarget** methods should call the corresponding **IDropTargetHelper** method to forward the information to the drag-and-drop helper object.</span></span> <span data-ttu-id="4b656-447">La cinquième méthode **IDropTargetHelper** , [**IDropTargetHelper :: Show**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show), notifie l’objet d’assistance glisser-déplacer pour afficher ou masquer l’image de glissement.</span><span class="sxs-lookup"><span data-stu-id="4b656-447">The fifth **IDropTargetHelper** method, [**IDropTargetHelper::Show**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show), notifies the drag-and-drop helper object to show or hide the drag image.</span></span> <span data-ttu-id="4b656-448">Cette méthode est utilisée lors d’un glissement sur une fenêtre cible dans un mode vidéo de faible profondeur de couleur.</span><span class="sxs-lookup"><span data-stu-id="4b656-448">This method is used when dragging over a target window in a low color-depth video mode.</span></span> <span data-ttu-id="4b656-449">Elle permet à la cible de masquer l’image glisser tout en peignant la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="4b656-449">It allows the target to hide the drag image while it is painting the window.</span></span>

 

 
