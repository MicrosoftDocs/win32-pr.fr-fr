---
description: 'Cette rubrique est organisée comme suit :'
title: Meilleures pratiques pour les gestionnaires de menus contextuels et les verbes multiples
ms.topic: article
ms.date: 05/31/2018
ms.assetid: 4D352ECB-6214-4f6e-A3E5-F79E154D090A
api_name: ''
api_type: ''
api_location: ''
topic_type:
- kbArticle
ms.openlocfilehash: f8b47807c4647aec274e64dbcd137833d13e23cb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104973479"
---
# <a name="best-practices-for-shortcut-menu-handlers-and-multiple-verbs"></a><span data-ttu-id="600d0-103">Meilleures pratiques pour les gestionnaires de menus contextuels et les verbes multiples</span><span class="sxs-lookup"><span data-stu-id="600d0-103">Best Practices for Shortcut Menu Handlers and Multiple Verbs</span></span>

<span data-ttu-id="600d0-104">Cette rubrique est organisée comme suit :</span><span class="sxs-lookup"><span data-stu-id="600d0-104">This topic is organized as follows:</span></span>

-   [<span data-ttu-id="600d0-105">Bonnes pratiques</span><span class="sxs-lookup"><span data-stu-id="600d0-105">Best Practices</span></span>](#best-practices-for-shortcut-menu-handlers-and-multiple-verbs)
    -   [<span data-ttu-id="600d0-106">Meilleures pratiques pour les implémentations de verbes</span><span class="sxs-lookup"><span data-stu-id="600d0-106">Best Practices for Verb Implementations</span></span>](#best-practices-for-verb-implementations)
-   [<span data-ttu-id="600d0-107">Meilleures pratiques pour les verbes de sélection multiple</span><span class="sxs-lookup"><span data-stu-id="600d0-107">Best Practices for Multiple Selection Verbs</span></span>](#best-practices-for-multiple-selection-verbs)
    -   [<span data-ttu-id="600d0-108">Sélections hétérogènes</span><span class="sxs-lookup"><span data-stu-id="600d0-108">Heterogenous Selections</span></span>](#heterogenous-selections)
-   [<span data-ttu-id="600d0-109">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="600d0-109">Related topics</span></span>](#related-topics)

## <a name="best-practices"></a><span data-ttu-id="600d0-110">Bonnes pratiques</span><span class="sxs-lookup"><span data-stu-id="600d0-110">Best Practices</span></span>

<span data-ttu-id="600d0-111">Les verbes statiques sont les verbes les plus simples à implémenter et offrent des fonctionnalités riches.</span><span class="sxs-lookup"><span data-stu-id="600d0-111">Static verb are simplest verbs to implement, and provide rich functionality.</span></span> <span data-ttu-id="600d0-112">Nous vous encourageons fortement à implémenter un verbe à l’aide de l’une des méthodes de verbe statiques.</span><span class="sxs-lookup"><span data-stu-id="600d0-112">We strongly encourage you to implement a verb using one of the static verb methods.</span></span>

### <a name="best-practices-for-verb-implementations"></a><span data-ttu-id="600d0-113">Meilleures pratiques pour les implémentations de verbes</span><span class="sxs-lookup"><span data-stu-id="600d0-113">Best Practices for Verb Implementations</span></span>

<span data-ttu-id="600d0-114">La liste suivante représente les meilleures pratiques pour les implémentations de verbe :</span><span class="sxs-lookup"><span data-stu-id="600d0-114">The following list represents best practices for verb implementations:</span></span>

-   <span data-ttu-id="600d0-115">Choisissez toujours la méthode Verb la plus simple qui répond à vos besoins.</span><span class="sxs-lookup"><span data-stu-id="600d0-115">Always chose the simplest verb method that meets your needs.</span></span>
-   <span data-ttu-id="600d0-116">Utilisez une méthode Verb statique, si possible.</span><span class="sxs-lookup"><span data-stu-id="600d0-116">Use a static verb method, if possible.</span></span>
-   <span data-ttu-id="600d0-117">N’effectuez pas d’opérations gourmandes en ressources ou d’e/s sur le thread d’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="600d0-117">Do not perform resource-intensive operations or I/O on the UI thread.</span></span> <span data-ttu-id="600d0-118">[**IShellExtInit :: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) et [**IContextMenu :: QueryContextMenu**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) doivent être très prudents dans le travail qu’ils effectuent.</span><span class="sxs-lookup"><span data-stu-id="600d0-118">Both [**IShellExtInit::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) and [**IContextMenu::QueryContextMenu**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) need to be very conservative in the work they perform.</span></span> <span data-ttu-id="600d0-119">[**IContextMenu :: commande InvokeCommand**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) doit être exécuté dans un autre processus, ou vous devez créer un nouveau thread pour éviter de bloquer l’appelant.</span><span class="sxs-lookup"><span data-stu-id="600d0-119">[**IContextMenu::InvokeCommand**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) must be performed in another process, or you must create a new thread to avoid blocking the caller.</span></span>
-   <span data-ttu-id="600d0-120">Préfixez les verbes avec le nom de l’éditeur de logiciels indépendant (ISV) comme suit, `ISVName.verb` .</span><span class="sxs-lookup"><span data-stu-id="600d0-120">Prefix verbs with the independent software vendor (ISV) name as follows, `ISVName.verb`.</span></span> <span data-ttu-id="600d0-121">L’utilisation de noms non qualifiés peut entraîner des collisions avec plusieurs éditeurs de logiciels indépendants qui choisissent le même nom de verbe.</span><span class="sxs-lookup"><span data-stu-id="600d0-121">Using unqualified names can result in collisions with multiple ISVs that chose the same verb name.</span></span>
-   <span data-ttu-id="600d0-122">Utilisez toujours un ProgID propre à l’application.</span><span class="sxs-lookup"><span data-stu-id="600d0-122">Always use an application-specific ProgID.</span></span> <span data-ttu-id="600d0-123">Étant donné que certains types d’éléments n’utilisent pas ce mappage, il est nécessaire de nommer les noms uniques des fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="600d0-123">Because some item types do not use this mapping, there is a need for vendor-unique names.</span></span>
-   <span data-ttu-id="600d0-124">Positionnez l’interface utilisateur par rapport à la méthode d’appel, mais ne l’exécutez pas sur un thread appelant.</span><span class="sxs-lookup"><span data-stu-id="600d0-124">Position the UI relative to the invoking method, but do not run on an invoker thread.</span></span>
-   <span data-ttu-id="600d0-125">N’acceptez pas la valeur de **retour \_ OK** pour les verbes canoniques passés à la méthode [**IContextMenu :: commande InvokeCommand**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) .</span><span class="sxs-lookup"><span data-stu-id="600d0-125">Do not accept the return value **S\_OK** for canonical verbs passed to the [**IContextMenu::InvokeCommand**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) method.</span></span> <span data-ttu-id="600d0-126">Cela entraîne l’échec de l’implémentation du verbe réel et retourne un code d’erreur pour les verbes canoniques.</span><span class="sxs-lookup"><span data-stu-id="600d0-126">Doing so causes a failure for the real verb implementation to be invoked, and returns a failure code for canonical verbs.</span></span> <span data-ttu-id="600d0-127">Si vous ne prenez pas en charge les verbes canoniques, retournez l’erreur lorsqu’une valeur HIWORD (lpVerb) différente de zéro est rencontrée.</span><span class="sxs-lookup"><span data-stu-id="600d0-127">If you do not support canonical verbs, then return failure when a nonzero HIWORD(lpVerb) value is encountered.</span></span>
-   <span data-ttu-id="600d0-128">Évitez l’utilisation de **rundll32.exe** comme hôte pour votre verbe.</span><span class="sxs-lookup"><span data-stu-id="600d0-128">Avoid the use of **rundll32.exe** as the host for your verb.</span></span>
-   <span data-ttu-id="600d0-129">Lors de l’implémentation de [**IContextMenu :: QueryContextMenu**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) , veillez à retourner le nombre de verbes qui ont été ajoutés au menu par le biais de la valeur **HRESULT** à l’aide de la macro ResultFromShort.</span><span class="sxs-lookup"><span data-stu-id="600d0-129">When implementing [**IContextMenu::QueryContextMenu**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) be sure to return the number of verbs that have been added to the menu through the **HRESULT** value using the ResultFromShort macro.</span></span>
-   <span data-ttu-id="600d0-130">Si vous vous inscrivez sur l’une des entrées de clé de Registre suivantes, soyez prudent et veillez à inscrire votre gestionnaire sur le type le plus spécifique pour réduire les conséquences éventuellement inattendues :</span><span class="sxs-lookup"><span data-stu-id="600d0-130">If you register on one of the following registry key entries, then exercise caution and be sure to register your handler on the most specific type to reduce the possibly unintended consequences:</span></span>
    -   <span data-ttu-id="600d0-131">\**HKEY \_ CLASSES \_ \\ racine \** _</span><span class="sxs-lookup"><span data-stu-id="600d0-131">\**HKEY\_CLASSES\_ROOT\\\** _</span></span>
    -   <span data-ttu-id="600d0-132">_ *\_ \_ \\ AllFileSystemObjects racine des classes HKEY*\*</span><span class="sxs-lookup"><span data-stu-id="600d0-132">_ *HKEY\_CLASSES\_ROOT\\AllFileSystemObjects*\*</span></span>
    -   <span data-ttu-id="600d0-133">**\_ \_ Dossier racine des classes HKEY \\**</span><span class="sxs-lookup"><span data-stu-id="600d0-133">**HKEY\_CLASSES\_ROOT\\Folder**</span></span>
    -   <span data-ttu-id="600d0-134">**\_ \_ Répertoire racine des classes HKEY \\**</span><span class="sxs-lookup"><span data-stu-id="600d0-134">**HKEY\_CLASSES\_ROOT\\Directory**</span></span>
-   <span data-ttu-id="600d0-135">Définissez la clé **MayChangeDefaultMenu** uniquement si vous pensez que vous devrez peut-être modifier le verbe par défaut dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="600d0-135">Set the **MayChangeDefaultMenu** key only if you anticipate that you might need to change the default verb in the shortcut menu.</span></span> <span data-ttu-id="600d0-136">Si votre gestionnaire ne modifie pas le verbe par défaut, vous ne devez pas définir cette clé, car cela amène le système à charger votre DLL inutilement.</span><span class="sxs-lookup"><span data-stu-id="600d0-136">If your handler does not change the default verb, then you should not set this key because doing so causes the system to load your DLL unnecessarily.</span></span>
-   <span data-ttu-id="600d0-137">Réduisez le travail que vous effectuez dans [**IShellExtInit :: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span><span class="sxs-lookup"><span data-stu-id="600d0-137">Minimize the work you perform in [**IShellExtInit::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span></span> <span data-ttu-id="600d0-138">Pour les gestionnaires de menus contextuels, capturez l’objet de données passé à **IShellExtInit :: Initialize**, puis traitez-le dans [**IContextMenu :: QueryContextMenu**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu)ou [**IContextMenu :: commande InvokeCommand**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand).</span><span class="sxs-lookup"><span data-stu-id="600d0-138">For shortcut menu handlers, capture the data object passed to **IShellExtInit::Initialize**, and then process it in [**IContextMenu::QueryContextMenu**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu), or [**IContextMenu::InvokeCommand**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand).</span></span>

## <a name="best-practices-for-multiple-selection-verbs"></a><span data-ttu-id="600d0-139">Meilleures pratiques pour les verbes de sélection multiple</span><span class="sxs-lookup"><span data-stu-id="600d0-139">Best Practices for Multiple Selection Verbs</span></span>

<span data-ttu-id="600d0-140">Étant donné que le nombre d’éléments dans un scénario de verbe à sélection multiple peut être important, il est important de prendre en compte les implications en matière de performances de vos implémentations de verbe.</span><span class="sxs-lookup"><span data-stu-id="600d0-140">Because the number of items in a multi-selection verb scenario can be large, it is important that you consider the performance implications of your verb implementations.</span></span> <span data-ttu-id="600d0-141">Par exemple, lorsqu’un utilisateur recherche « \* » sur une étendue qui comprend un grand nombre d’éléments, puis clique sur **Sélectionner tout** et clique avec le bouton droit, une sélection pouvant contenir des milliers d’éléments est présentée au verbe.</span><span class="sxs-lookup"><span data-stu-id="600d0-141">For example, when a user searches for "\*" over a scope that includes large numbers of items, and then clicks **Select All** and right-clicks, the verb is presented with a selection that can have thousands of items in it.</span></span> <span data-ttu-id="600d0-142">Par conséquent, les verbes doivent uniquement prendre en compte le premier élément de la sélection et le nombre total d’éléments.</span><span class="sxs-lookup"><span data-stu-id="600d0-142">As a result, verbs should only consider the first item in the selection, and the overall item count.</span></span> <span data-ttu-id="600d0-143">Le premier élément est défini comme l’élément en haut de la vue, ou l’élément sur lequel l’utilisateur a cliqué pour la première fois avec le bouton droit.</span><span class="sxs-lookup"><span data-stu-id="600d0-143">The first item is defined as either the item at the top of the view, or the item that the user first right-clicked.</span></span>

<span data-ttu-id="600d0-144">Dans Windows 7 et versions ultérieures, le nombre d’éléments passés à un verbe est limité à 16 quand un menu contextuel est interrogé.</span><span class="sxs-lookup"><span data-stu-id="600d0-144">In Windows 7 and later, the number of items passed to a verb is limited to 16 when a shortcut menu is queried.</span></span> <span data-ttu-id="600d0-145">Le verbe est ensuite recréé et réinitialisé avec la sélection complète lorsque ce verbe est appelé.</span><span class="sxs-lookup"><span data-stu-id="600d0-145">The verb is then re-created and re-initialized with the full selection when that verb is invoked.</span></span>

<span data-ttu-id="600d0-146">Dans certains cas, il convient de prendre en compte un petit nombre d’éléments fixes.</span><span class="sxs-lookup"><span data-stu-id="600d0-146">It is appropriate in some cases to consider a small number of fixed items.</span></span> <span data-ttu-id="600d0-147">Par exemple, il est approprié pour un verbe « diff » de considérer uniquement les deux premiers éléments.</span><span class="sxs-lookup"><span data-stu-id="600d0-147">For example, it is appropriate for a "diff" verb to consider only the first two items.</span></span> <span data-ttu-id="600d0-148">En règle générale, vous n’avez pas besoin de tester chaque élément de la sélection pour voir s’il s’agit d’un certain type, ou d’interroger chaque élément de la sélection pour ses propriétés.</span><span class="sxs-lookup"><span data-stu-id="600d0-148">Generally, you need not test every item in the selection to see if it is a certain type, or query every item in the selection for its properties.</span></span> <span data-ttu-id="600d0-149">Regardez plutôt le premier élément et déterminez s’il convient d’ajouter votre verbe.</span><span class="sxs-lookup"><span data-stu-id="600d0-149">Look rather at the first item and decide if it is appropriate to add your verb.</span></span>

### <a name="heterogenous-selections"></a><span data-ttu-id="600d0-150">Sélections hétérogènes</span><span class="sxs-lookup"><span data-stu-id="600d0-150">Heterogenous Selections</span></span>

<span data-ttu-id="600d0-151">Les verbes optimistes sont automatiquement ajoutés dans le cas de sélection multiple, en supposant que les éléments non inspectés peuvent être gérés par le verbe.</span><span class="sxs-lookup"><span data-stu-id="600d0-151">Optimistic verbs are automatically added in the multi-selection case, assuming that uninspected items can be handled by the verb.</span></span> <span data-ttu-id="600d0-152">En revanche, les verbes pessimistes ne sont pas ajoutés lorsque la sélection contient des éléments non inspectés et sont uniquement ajoutés dans les cas où le nombre d’éléments est petit.</span><span class="sxs-lookup"><span data-stu-id="600d0-152">In contrast, pessimistic verbs are not added when the selection contains uninspected items, and are only added in cases where the number of items is small.</span></span>

<span data-ttu-id="600d0-153">Les verbes de style de joueur doivent être optimistes et ignorer silencieusement les éléments qui ne sont pas gérés.</span><span class="sxs-lookup"><span data-stu-id="600d0-153">Player style verbs should be optimistic, and silently skip the items that are not handled.</span></span> <span data-ttu-id="600d0-154">Si un échec d’action sur des éléments peut entraîner une perte de données ou une confusion, le verbe doit avertir les utilisateurs des éléments qui ne peuvent pas être traités.</span><span class="sxs-lookup"><span data-stu-id="600d0-154">If a failure to act on items can cause data loss or confusion, then the verb should warn users about items that cannot be processed.</span></span> <span data-ttu-id="600d0-155">Par exemple, un verbe « Backup » doit indiquer que certains éléments n’ont pas pu être sauvegardés.</span><span class="sxs-lookup"><span data-stu-id="600d0-155">For example a "backup" verb should indicate that some items could not be backed up.</span></span>

## <a name="related-topics"></a><span data-ttu-id="600d0-156">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="600d0-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="600d0-157">Choix d’un verbe statique ou dynamique pour votre menu contextuel</span><span class="sxs-lookup"><span data-stu-id="600d0-157">Choosing a Static or Dynamic Verb for your Shortcut Menu</span></span>](shortcut-choose-method.md)
</dt> <dt>

[<span data-ttu-id="600d0-158">Création de gestionnaires de menu contextuel</span><span class="sxs-lookup"><span data-stu-id="600d0-158">Creating Shortcut Menu Handlers</span></span>](context-menu-handlers.md)
</dt> <dt>

[<span data-ttu-id="600d0-159">Personnalisation d’un menu contextuel à l’aide de verbes dynamiques</span><span class="sxs-lookup"><span data-stu-id="600d0-159">Customizing a Shortcut Menu Using Dynamic Verbs</span></span>](shortcut-menu-using-dynamic-verbs.md)
</dt> <dt>

[<span data-ttu-id="600d0-160">Menus contextuels (menu contextuel) et gestionnaires de menus contextuels</span><span class="sxs-lookup"><span data-stu-id="600d0-160">Shortcut (Context) Menus and Shortcut Menu Handlers</span></span>](context-menu.md)
</dt> <dt>

[<span data-ttu-id="600d0-161">Verbes et associations de fichiers</span><span class="sxs-lookup"><span data-stu-id="600d0-161">Verbs and File Associations</span></span>](fa-verbs.md)
</dt> <dt>

[<span data-ttu-id="600d0-162">Référence du menu contextuel</span><span class="sxs-lookup"><span data-stu-id="600d0-162">Shortcut Menu Reference</span></span>](context-menu-reference.md)
</dt> </dl>

 

 



