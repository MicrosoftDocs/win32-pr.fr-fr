---
description: La procédure d’implémentation d’une extension d’espace de noms est semblable à celle de tout autre objet COM (Component Object Model) in-process.
title: Implémentation des interfaces d’objets de dossier de base
ms.topic: article
ms.date: 05/31/2018
ms.assetid: a45b8011-5355-429b-8935-4a7bdb5d2316
api_name: ''
api_type: ''
api_location: ''
topic_type:
- kbArticle
ms.openlocfilehash: c05f5d2e4c21a923856c7324ad2d407230fa7595
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104973374"
---
# <a name="implementing-the-basic-folder-object-interfaces"></a><span data-ttu-id="f3c64-103">Implémentation des interfaces d’objets de dossier de base</span><span class="sxs-lookup"><span data-stu-id="f3c64-103">Implementing the Basic Folder Object Interfaces</span></span>

<span data-ttu-id="f3c64-104">La procédure d’implémentation d’une extension d’espace de noms est semblable à celle de tout autre objet COM (Component Object Model) in-process.</span><span class="sxs-lookup"><span data-stu-id="f3c64-104">The procedure for implementing a namespace extension is similar to that for any other in-process Component Object Model (COM) object.</span></span> <span data-ttu-id="f3c64-105">Toutes les extensions doivent prendre en charge trois interfaces principales qui fournissent à l’Explorateur Windows les informations de base nécessaires à l’affichage des dossiers de l’extension dans l’arborescence.</span><span class="sxs-lookup"><span data-stu-id="f3c64-105">All extensions must support three primary interfaces that provide Windows Explorer with the basic information needed to display the extension's folders in the tree view.</span></span> <span data-ttu-id="f3c64-106">Toutefois, pour tirer pleinement parti des fonctionnalités de l’Explorateur Windows, votre extension doit également exposer une ou plusieurs interfaces facultatives qui prennent en charge des fonctionnalités plus sophistiquées, telles que des menus contextuels ou des opérations de glisser-déplacer, et fournissent un affichage des dossiers.</span><span class="sxs-lookup"><span data-stu-id="f3c64-106">However, to make full use of the capabilities of Windows Explorer, your extension must also expose one or more optional interfaces that support more sophisticated features, such as shortcut menus or drag-and-drop, and provide a folder view.</span></span>

<span data-ttu-id="f3c64-107">Ce document explique comment implémenter les interfaces principales et facultatives que l’Explorateur Windows appelle pour obtenir des informations sur le contenu de votre extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-107">This document discusses how to implement the primary and optional interfaces that Windows Explorer calls for information about the contents of your extension.</span></span> <span data-ttu-id="f3c64-108">Pour plus d’informations sur l’implémentation d’un affichage des dossiers et sur la personnalisation de l’Explorateur Windows, consultez [implémentation d’un affichage des dossiers](../lwef/nse-folderview.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-108">For a discussion of how to implement a folder view and how to customize Windows Explorer, see [Implementing a Folder View](../lwef/nse-folderview.md).</span></span>

-   [<span data-ttu-id="f3c64-109">Implémentation et inscription de base</span><span class="sxs-lookup"><span data-stu-id="f3c64-109">Basic Implementation and Registration</span></span>](#basic-implementation-and-registration)
    -   [<span data-ttu-id="f3c64-110">Inscription d’une extension</span><span class="sxs-lookup"><span data-stu-id="f3c64-110">Registering an Extension</span></span>](#registering-an-extension)
-   [<span data-ttu-id="f3c64-111">Gestion de PIDL</span><span class="sxs-lookup"><span data-stu-id="f3c64-111">Handling PIDLs</span></span>](#handling-pidls)
    -   [<span data-ttu-id="f3c64-112">Création d’une structure SHITEMID</span><span class="sxs-lookup"><span data-stu-id="f3c64-112">Creating an SHITEMID Structure</span></span>](#creating-an-shitemid-structure)
    -   [<span data-ttu-id="f3c64-113">Construction d’un PIDL</span><span class="sxs-lookup"><span data-stu-id="f3c64-113">Constructing a PIDL</span></span>](#constructing-a-pidl)
    -   [<span data-ttu-id="f3c64-114">Interprétation des PIDL</span><span class="sxs-lookup"><span data-stu-id="f3c64-114">Interpreting PIDLs</span></span>](#interpreting-pidls)
-   [<span data-ttu-id="f3c64-115">Implémentation des interfaces principales</span><span class="sxs-lookup"><span data-stu-id="f3c64-115">Implementing the Primary Interfaces</span></span>](#implementing-the-primary-interfaces)
    -   [<span data-ttu-id="f3c64-116">Interface IPersistFolder</span><span class="sxs-lookup"><span data-stu-id="f3c64-116">IPersistFolder Interface</span></span>](#ipersistfolder-interface)
    -   [<span data-ttu-id="f3c64-117">Interface IShellFolder</span><span class="sxs-lookup"><span data-stu-id="f3c64-117">IShellFolder Interface</span></span>](#ishellfolder-interface)
    -   [<span data-ttu-id="f3c64-118">Interface IEnumIDList</span><span class="sxs-lookup"><span data-stu-id="f3c64-118">IEnumIDList Interface</span></span>](#ienumidlist-interface)
-   [<span data-ttu-id="f3c64-119">Implémentation des interfaces facultatives</span><span class="sxs-lookup"><span data-stu-id="f3c64-119">Implementing the Optional Interfaces</span></span>](#implementing-the-optional-interfaces)
    -   [<span data-ttu-id="f3c64-120">IExtractIcon</span><span class="sxs-lookup"><span data-stu-id="f3c64-120">IExtractIcon</span></span>](#iextracticon)
    -   [<span data-ttu-id="f3c64-121">IContextMenu</span><span class="sxs-lookup"><span data-stu-id="f3c64-121">IContextMenu</span></span>](#icontextmenu)
    -   [<span data-ttu-id="f3c64-122">IQueryInfo</span><span class="sxs-lookup"><span data-stu-id="f3c64-122">IQueryInfo</span></span>](#iqueryinfo)
    -   [<span data-ttu-id="f3c64-123">IDataObject et IDropTarget</span><span class="sxs-lookup"><span data-stu-id="f3c64-123">IDataObject and IDropTarget</span></span>](#idataobject-and-idroptarget)
-   [<span data-ttu-id="f3c64-124">Utilisation de l’implémentation de l’affichage des dossiers shell par défaut</span><span class="sxs-lookup"><span data-stu-id="f3c64-124">Working With the Default Shell Folder View Implementation</span></span>](#working-with-the-default-shell-folder-view-implementation)

## <a name="basic-implementation-and-registration"></a><span data-ttu-id="f3c64-125">Implémentation et inscription de base</span><span class="sxs-lookup"><span data-stu-id="f3c64-125">Basic Implementation and Registration</span></span>

<span data-ttu-id="f3c64-126">En tant que serveur COM in-process, votre DLL doit exposer plusieurs fonctions et interfaces standard :</span><span class="sxs-lookup"><span data-stu-id="f3c64-126">As an in-process COM server, your DLL must expose several standard functions and interfaces:</span></span>

-   [<span data-ttu-id="f3c64-127">**DllCanUnloadNow**</span><span class="sxs-lookup"><span data-stu-id="f3c64-127">**DllCanUnloadNow**</span></span>](/windows/win32/api/combaseapi/nf-combaseapi-dllcanunloadnow)
-   [<span data-ttu-id="f3c64-128">**DllGetClassObject**</span><span class="sxs-lookup"><span data-stu-id="f3c64-128">**DllGetClassObject**</span></span>](/windows/win32/api/combaseapi/nf-combaseapi-dllgetclassobject)
-   [<span data-ttu-id="f3c64-129">**IClassFactory**</span><span class="sxs-lookup"><span data-stu-id="f3c64-129">**IClassFactory**</span></span>](/windows/win32/api/unknwn/nn-unknwn-iclassfactory)
-   [<span data-ttu-id="f3c64-130">**IUnknown**</span><span class="sxs-lookup"><span data-stu-id="f3c64-130">**IUnknown**</span></span>](/windows/win32/api/unknwn/nn-unknwn-iunknown)

<span data-ttu-id="f3c64-131">Ces fonctions et interfaces sont implémentées de la même façon que pour la plupart des autres objets COM.</span><span class="sxs-lookup"><span data-stu-id="f3c64-131">These functions and interfaces are implemented in the same way as they are for most other COM objects.</span></span> <span data-ttu-id="f3c64-132">Pour plus d’informations, consultez la [documentation com](../com/the-component-object-model.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-132">For details, see the [COM documentation](../com/the-component-object-model.md).</span></span>

### <a name="registering-an-extension"></a><span data-ttu-id="f3c64-133">Inscription d’une extension</span><span class="sxs-lookup"><span data-stu-id="f3c64-133">Registering an Extension</span></span>

<span data-ttu-id="f3c64-134">Comme pour tous les objets COM, vous devez créer un GUID de l’identificateur de classe (CLSID) pour votre extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-134">As with all COM objects, you must create a class identifier (CLSID) GUID for your extension.</span></span> <span data-ttu-id="f3c64-135">Inscrivez l’objet en créant une sous-clé du CLSID **\_ \_ racine de la classe HKEY** \\  nommée pour le CLSID de votre extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-135">Register the object by creating a subkey of **HKEY\_CLASSES\_ROOT**\\**CLSID** named for the CLSID of your extension.</span></span> <span data-ttu-id="f3c64-136">La DLL doit être inscrite en tant que serveur in-process et doit spécifier le modèle de thread cloisonné.</span><span class="sxs-lookup"><span data-stu-id="f3c64-136">The DLL should be registered as an in-process server and should specify the apartment threading model.</span></span> <span data-ttu-id="f3c64-137">Vous pouvez personnaliser le comportement du dossier racine d’une extension en ajoutant une série de sous-clés et de valeurs à la clé CLSID de l’extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-137">You can customize the behavior of an extension's root folder by adding a variety of subkeys and values to the extension's CLSID key.</span></span>

<span data-ttu-id="f3c64-138">Plusieurs de ces valeurs s’appliquent uniquement aux extensions avec des points de jonction virtuels.</span><span class="sxs-lookup"><span data-stu-id="f3c64-138">Several of these values apply only to extensions with virtual junction points.</span></span> <span data-ttu-id="f3c64-139">Ces valeurs ne s’appliquent pas aux extensions dont les points de jonction sont des dossiers du système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="f3c64-139">These values do not apply to extensions whose junction points are file system folders.</span></span> <span data-ttu-id="f3c64-140">Pour plus d’informations, consultez [spécification de l’emplacement d’une extension d’espace de noms](nse-junction.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-140">For further discussion, see [Specifying a Namespace Extension's Location](nse-junction.md).</span></span> <span data-ttu-id="f3c64-141">Pour modifier le comportement d’une extension avec un point de jonction virtuel, ajoutez une ou plusieurs des valeurs suivantes à la clé CLSID de l’extension :</span><span class="sxs-lookup"><span data-stu-id="f3c64-141">To modify the behavior of an extension with a virtual junction point, add one or more of the following values to the extension's CLSID key:</span></span>

-   <span data-ttu-id="f3c64-142">WantsFORPARSING.</span><span class="sxs-lookup"><span data-stu-id="f3c64-142">WantsFORPARSING.</span></span> <span data-ttu-id="f3c64-143">Le nom d’analyse d’une extension avec un point de jonction virtuel aura normalement la forme :: {*GUID*}.</span><span class="sxs-lookup"><span data-stu-id="f3c64-143">The parsing name for an extension with a virtual junction point will normally have the form ::{*GUID*}.</span></span> <span data-ttu-id="f3c64-144">Les extensions de ce type contiennent normalement des éléments virtuels.</span><span class="sxs-lookup"><span data-stu-id="f3c64-144">Extensions of this type normally contain virtual items.</span></span> <span data-ttu-id="f3c64-145">Toutefois, certaines extensions, telles que mes documents, correspondent en fait à des dossiers du système de fichiers, même si elles ont des points de jonction virtuels.</span><span class="sxs-lookup"><span data-stu-id="f3c64-145">However, some extensions, such as My Documents, actually correspond to file system folders, even though they have virtual junction points.</span></span> <span data-ttu-id="f3c64-146">Si votre extension représente des objets de système de fichiers de cette façon, vous pouvez définir la valeur WantsFORPARSING.</span><span class="sxs-lookup"><span data-stu-id="f3c64-146">If your extension represents file system objects in this way, you can set the WantsFORPARSING value.</span></span> <span data-ttu-id="f3c64-147">L’Explorateur Windows demande ensuite le nom d’analyse de votre dossier racine en appelant la méthode [**IShellFolder :: GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) de l’objet Folder avec *UFlags* défini sur **SHGDN \_ FORPARSING** et *PIDL* défini sur un seul pointeur vide vers une liste d’identificateurs d’éléments (PIDL).</span><span class="sxs-lookup"><span data-stu-id="f3c64-147">Windows Explorer will then request your root folder's parsing name by calling the folder object's [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) method with *uFlags* set to **SHGDN\_FORPARSING** and *pidl* set to a single empty pointer to an item identifier list (PIDL).</span></span> <span data-ttu-id="f3c64-148">Un PIDL vide contient uniquement un terminateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-148">An empty PIDL contains only a terminator.</span></span> <span data-ttu-id="f3c64-149">Votre méthode doit ensuite retourner le nom de l’analyse du dossier racine :: {*GUID*}.</span><span class="sxs-lookup"><span data-stu-id="f3c64-149">Your method should then return the root folder's ::{*GUID*} parsing name.</span></span>
-   <span data-ttu-id="f3c64-150">HideFolderVerbs.</span><span class="sxs-lookup"><span data-stu-id="f3c64-150">HideFolderVerbs.</span></span> <span data-ttu-id="f3c64-151">Les verbes inscrits sous le dossier **\_ \_ racine de la classe HKEY** \\  sont normalement associés à toutes les extensions.</span><span class="sxs-lookup"><span data-stu-id="f3c64-151">The verbs registered under **HKEY\_CLASSES\_ROOT**\\**Folder** normally are associated with all extensions.</span></span> <span data-ttu-id="f3c64-152">Elles s’affichent dans le menu contextuel de l’extension et peuvent être appelées par [**ShellExecute**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecutea).</span><span class="sxs-lookup"><span data-stu-id="f3c64-152">They appear on the extension's shortcut menu and can be invoked by [**ShellExecute**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecutea).</span></span> <span data-ttu-id="f3c64-153">Pour empêcher l’Association de ces verbes à votre extension, définissez la valeur HideFolderVerbs.</span><span class="sxs-lookup"><span data-stu-id="f3c64-153">To prevent any of these verbs from being associated with your extension, set the HideFolderVerbs value.</span></span>
-   <span data-ttu-id="f3c64-154">HideAsDelete.</span><span class="sxs-lookup"><span data-stu-id="f3c64-154">HideAsDelete.</span></span> <span data-ttu-id="f3c64-155">Si un utilisateur tente de supprimer votre extension, l’Explorateur Windows masquera à la place l’extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-155">If a user attempts to delete your extension, Windows Explorer will instead hide the extension.</span></span>
-   <span data-ttu-id="f3c64-156">HideAsDeletePerUser.</span><span class="sxs-lookup"><span data-stu-id="f3c64-156">HideAsDeletePerUser.</span></span> <span data-ttu-id="f3c64-157">Cette valeur a le même effet que HideAsDelete, mais pour chaque utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-157">This value has the same effect as HideAsDelete but on a per-user basis.</span></span> <span data-ttu-id="f3c64-158">L’extension est masquée uniquement pour les utilisateurs qui ont tenté de la supprimer.</span><span class="sxs-lookup"><span data-stu-id="f3c64-158">The extension is hidden only for those users who have attempted to delete it.</span></span> <span data-ttu-id="f3c64-159">L’extension est visible par tous les autres utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="f3c64-159">The extension is visible to all other users.</span></span>
-   <span data-ttu-id="f3c64-160">QueryForOverlay.</span><span class="sxs-lookup"><span data-stu-id="f3c64-160">QueryForOverlay.</span></span> <span data-ttu-id="f3c64-161">Définissez cette valeur pour indiquer que l’icône du dossier racine peut avoir une icône de superposition.</span><span class="sxs-lookup"><span data-stu-id="f3c64-161">Set this value to indicate that the root folder's icon can have an icon overlay.</span></span> <span data-ttu-id="f3c64-162">L’objet Folder doit prendre en charge l’interface [**IShellIconOverlay**](/windows/win32/api/shlobj_core/nn-shlobj_core-ishelliconoverlay) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-162">The folder object must support the [**IShellIconOverlay**](/windows/win32/api/shlobj_core/nn-shlobj_core-ishelliconoverlay) interface.</span></span> <span data-ttu-id="f3c64-163">Avant que l’Explorateur Windows n’affiche l’icône du dossier racine, il demande une icône de recouvrement en appelant l’une des deux méthodes **IShellIconOverlay** avec *pidlItem* défini sur un PIDL vide.</span><span class="sxs-lookup"><span data-stu-id="f3c64-163">Before Windows Explorer displays the root folder's icon, it will request an overlay icon by calling one of the two **IShellIconOverlay** methods with *pidlItem* set to an empty PIDL.</span></span>

<span data-ttu-id="f3c64-164">Les valeurs restantes et les sous-clés s’appliquent à toutes les extensions :</span><span class="sxs-lookup"><span data-stu-id="f3c64-164">The remaining values and subkeys apply to all extensions:</span></span>

-   <span data-ttu-id="f3c64-165">Pour spécifier le nom d’affichage du dossier du point de jonction de l’extension, définissez la valeur par défaut de la sous-clé CLSID de l’extension sur une chaîne appropriée.</span><span class="sxs-lookup"><span data-stu-id="f3c64-165">To specify the display name of the extension's junction point folder, set the default value of the extension's CLSID subkey to an appropriate string.</span></span>
-   <span data-ttu-id="f3c64-166">Quand le curseur pointe sur un dossier, une info-bulle s’affiche généralement pour décrire le contenu du dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-166">When the cursor hovers over a folder, an infotip is typically displayed that describes the contents of the folder.</span></span> <span data-ttu-id="f3c64-167">Pour fournir une info-bulle pour le dossier racine de votre extension, créez une valeur de **Registre \_** de l’info-bulle pour la clé CLSID de l’extension et affectez-lui une chaîne appropriée.</span><span class="sxs-lookup"><span data-stu-id="f3c64-167">To provide an infotip for your extension's root folder, create an InfoTip **REG\_SZ** value for the extension's CLSID key, and set it to an appropriate string.</span></span>
-   <span data-ttu-id="f3c64-168">Pour spécifier une icône personnalisée pour le dossier racine de votre extension, créez une sous-clé de la sous-clé CLSID de l’extension nommée **DefaultIcon**.</span><span class="sxs-lookup"><span data-stu-id="f3c64-168">To specify a custom icon for your extension's root folder, create a subkey of the extension's CLSID subkey named **DefaultIcon**.</span></span> <span data-ttu-id="f3c64-169">Définissez la valeur par défaut de **DefaultIcon** sur une valeur **reg \_ SZ** contenant le nom du fichier qui contient l’icône, suivi d’une virgule, suivi d’un signe moins, suivi de l’index de l’icône dans ce fichier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-169">Set the default value of **DefaultIcon** to a **REG\_SZ** value containing the name of the file that contains the icon, followed by a comma, followed by a minus sign, followed by the index of the icon in that file.</span></span>
-   <span data-ttu-id="f3c64-170">Par défaut, le menu contextuel du dossier racine de votre extension contient les éléments définis sous **le \_ \_ \\ dossier racine** de la section HKEY classes.</span><span class="sxs-lookup"><span data-stu-id="f3c64-170">By default, the shortcut menu of your extension's root folder will contain the items defined under **HKEY\_CLASSES\_ROOT\\Folder**.</span></span> <span data-ttu-id="f3c64-171">Les éléments **supprimer**, **Renommer** et **Propriétés** sont ajoutés si vous avez défini les \_ indicateurs SFGAO xxx appropriés.</span><span class="sxs-lookup"><span data-stu-id="f3c64-171">The **Delete**, **Rename**, and **Properties** items are added if you have set the appropriate SFGAO\_XXX flags.</span></span> <span data-ttu-id="f3c64-172">Vous pouvez ajouter d’autres éléments dans le menu contextuel du dossier racine ou remplacer les éléments existants, comme vous le feriez pour un [type de fichier](fa-file-types.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-172">You can add other items to the root folder's shortcut menu, or override existing items, much as you would for a [file type](fa-file-types.md).</span></span> <span data-ttu-id="f3c64-173">Créez une sous-clé **Shell** sous la clé CLSID de l’extension et définissez les commandes comme indiqué dans [extension des menus contextuels](context.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-173">Create a **Shell** subkey under the extension's CLSID key, and define commands as discussed in [Extending Shortcut Menus](context.md).</span></span>
-   <span data-ttu-id="f3c64-174">Si vous avez besoin d’une méthode plus flexible pour gérer le menu contextuel du dossier racine, vous pouvez implémenter un [Gestionnaire de menu contextuel](context-menu-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-174">If you need a more flexible way to handle the root folder's shortcut menu, you can implement a [shortcut menu handler](context-menu-handlers.md).</span></span> <span data-ttu-id="f3c64-175">Pour inscrire le gestionnaire de menu contextuel, créez une clé **shellex** sous la clé CLSID de l’extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-175">To register the shortcut menu handler, create a **ShellEx** key under the extension's CLSID key.</span></span> <span data-ttu-id="f3c64-176">Enregistrez le CLSID du gestionnaire comme vous le feriez pour un gestionnaire d' [extension de Shell de création](handlers.md)conventionnel.</span><span class="sxs-lookup"><span data-stu-id="f3c64-176">Register the handler's CLSID as you would for a conventional [Creating Shell Extension Handlers](handlers.md).</span></span>
-   <span data-ttu-id="f3c64-177">Pour ajouter une page à la feuille de propriétés propriétés du dossier racine, attribuez le dossier à l’attribut **SFGAO \_ HASPROPSHEET** et implémentez un [Gestionnaire de feuille de propriétés](propsheet-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-177">To add a page to the root folder's Properties property sheet, give the folder the **SFGAO\_HASPROPSHEET** attribute and implement a [property sheet handler](propsheet-handlers.md).</span></span> <span data-ttu-id="f3c64-178">Pour inscrire le gestionnaire de la feuille de propriétés, créez une clé **shellex** sous la clé CLSID de l’extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-178">To register the property sheet handler, create a **ShellEx** key under the extension's CLSID key.</span></span> <span data-ttu-id="f3c64-179">Enregistrez le CLSID du gestionnaire comme vous le feriez pour un gestionnaire d' [extension de Shell de création](handlers.md)conventionnel.</span><span class="sxs-lookup"><span data-stu-id="f3c64-179">Register the handler's CLSID as you would for a conventional [Creating Shell Extension Handlers](handlers.md).</span></span>
-   <span data-ttu-id="f3c64-180">Pour spécifier les attributs du dossier racine, ajoutez une sous-clé **ShellFolder** à la sous-clé CLSID de l’extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-180">To specify the attributes of the root folder, add a **ShellFolder** subkey to the extension's CLSID subkey.</span></span> <span data-ttu-id="f3c64-181">Créez une valeur d’attributs et affectez-lui la combinaison appropriée d’indicateurs [**SFGAO \_ xxx**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-181">Create an Attributes value, and set it to the appropriate combination of [**SFGAO\_XXX**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) flags.</span></span>

<span data-ttu-id="f3c64-182">Le tableau suivant répertorie certains attributs couramment utilisés pour les dossiers racine.</span><span class="sxs-lookup"><span data-stu-id="f3c64-182">The following table lists some commonly used attributes for root folders.</span></span>



| <span data-ttu-id="f3c64-183">Indicateur</span><span class="sxs-lookup"><span data-stu-id="f3c64-183">Flag</span></span>                | <span data-ttu-id="f3c64-184">Valeur</span><span class="sxs-lookup"><span data-stu-id="f3c64-184">Value</span></span>      | <span data-ttu-id="f3c64-185">Description</span><span class="sxs-lookup"><span data-stu-id="f3c64-185">Description</span></span>                                                                                                                                                                                                                                                                                                       |
|---------------------|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="f3c64-186">\_dossier SFGAO</span><span class="sxs-lookup"><span data-stu-id="f3c64-186">SFGAO\_FOLDER</span></span>       | <span data-ttu-id="f3c64-187">0x20000000</span><span class="sxs-lookup"><span data-stu-id="f3c64-187">0x20000000</span></span> | <span data-ttu-id="f3c64-188">Le dossier racine de l’extension contient un ou plusieurs éléments.</span><span class="sxs-lookup"><span data-stu-id="f3c64-188">The extension's root folder contains one or more items.</span></span>                                                                                                                                                                                                                                                           |
| <span data-ttu-id="f3c64-189">SFGAO \_ HASSUBFOLDER</span><span class="sxs-lookup"><span data-stu-id="f3c64-189">SFGAO\_HASSUBFOLDER</span></span> | <span data-ttu-id="f3c64-190">0x80000000</span><span class="sxs-lookup"><span data-stu-id="f3c64-190">0x80000000</span></span> | <span data-ttu-id="f3c64-191">Le dossier racine de l’extension contient un ou plusieurs sous-dossiers.</span><span class="sxs-lookup"><span data-stu-id="f3c64-191">The extension's root folder contains one or more subfolders.</span></span> <span data-ttu-id="f3c64-192">L’Explorateur Windows place un signe plus (+) en regard de l’icône de dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-192">Windows Explorer will place a plus sign ( + ) next to the folder icon.</span></span>                                                                                                                                                                               |
| <span data-ttu-id="f3c64-193">SFGAO \_ CANDELETE</span><span class="sxs-lookup"><span data-stu-id="f3c64-193">SFGAO\_CANDELETE</span></span>    | <span data-ttu-id="f3c64-194">0x00000020</span><span class="sxs-lookup"><span data-stu-id="f3c64-194">0x00000020</span></span> | <span data-ttu-id="f3c64-195">Le dossier racine de l’extension peut être supprimé par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-195">The extension's root folder can be deleted by the user.</span></span> <span data-ttu-id="f3c64-196">Le menu contextuel du dossier comportera un élément **supprimer** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-196">The folder's shortcut menu will have a **Delete** item.</span></span> <span data-ttu-id="f3c64-197">Cet indicateur doit être défini pour les points de jonction placés sous l’un des [dossiers virtuels](nse-junction.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-197">This flag should be set for junction points that are placed under one of the [virtual folders](nse-junction.md).</span></span>                                                                                 |
| <span data-ttu-id="f3c64-198">SFGAO \_ CANRENAME</span><span class="sxs-lookup"><span data-stu-id="f3c64-198">SFGAO\_CANRENAME</span></span>    | <span data-ttu-id="f3c64-199">0x00000010</span><span class="sxs-lookup"><span data-stu-id="f3c64-199">0x00000010</span></span> | <span data-ttu-id="f3c64-200">Le dossier racine de l’extension peut être renommé par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-200">The extension's root folder can be renamed by the user.</span></span> <span data-ttu-id="f3c64-201">Le menu contextuel du dossier aura un élément **Renommer** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-201">The folder's shortcut menu will have a **Rename** item.</span></span>                                                                                                                                                                                                   |
| <span data-ttu-id="f3c64-202">SFGAO \_ HASPROPSHEET</span><span class="sxs-lookup"><span data-stu-id="f3c64-202">SFGAO\_HASPROPSHEET</span></span> | <span data-ttu-id="f3c64-203">0x00000040</span><span class="sxs-lookup"><span data-stu-id="f3c64-203">0x00000040</span></span> | <span data-ttu-id="f3c64-204">Le dossier racine de l’extension contient une feuille de propriétés **Propriétés** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-204">The extension's root folder has a **Properties** property sheet.</span></span> <span data-ttu-id="f3c64-205">Le menu contextuel du dossier comporte un élément **Propriétés** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-205">The folder's shortcut menu will have a **Properties** item.</span></span> <span data-ttu-id="f3c64-206">Pour fournir la feuille de propriétés, vous devez implémenter un [Gestionnaire de feuille de propriétés](propsheet-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-206">To provide the property sheet, you must implement a [property sheet handler](propsheet-handlers.md).</span></span> <span data-ttu-id="f3c64-207">Inscrivez le gestionnaire sous la clé CLSID de l’extension, comme indiqué précédemment.</span><span class="sxs-lookup"><span data-stu-id="f3c64-207">Register the handler under the extension's CLSID key, as discussed previously.</span></span> |



 

<span data-ttu-id="f3c64-208">L’exemple suivant illustre l’entrée de Registre CLSID pour une extension avec un nom d’affichage MyExtension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-208">The following example shows the CLSID registry entry for an extension with a display name of MyExtension.</span></span> <span data-ttu-id="f3c64-209">L’extension a une icône personnalisée qui est contenue dans la DLL de l’extension avec un index de 1.</span><span class="sxs-lookup"><span data-stu-id="f3c64-209">The extension has a custom icon that is contained in the extension's DLL with an index of 1.</span></span> <span data-ttu-id="f3c64-210">Les **attributs \_ SFGAO**, **SFGAO \_ HASSUBFOLDER** et **SFGAO \_ CANDELETE** sont définis.</span><span class="sxs-lookup"><span data-stu-id="f3c64-210">The **SFGAO\_FOLDER**, **SFGAO\_HASSUBFOLDER**, and **SFGAO\_CANDELETE** attributes are set.</span></span>

```
HKEY_CLASSES_ROOT
   CLSID
      {Extension CLSID}
         (Default) = MyExtension
         InfoTip = Some appropriate text
      DefaultIcon
         (Default) = c:\MyDir\MyExtension.dll,-1
      InProcServer32
         (Default) = c:\MyDir\MyExtension.dll
         ThreadingModel = Apartment
      ShellFolder
         Attributes = 0xA00000020
```

## <a name="handling-pidls"></a><span data-ttu-id="f3c64-211">Gestion de PIDL</span><span class="sxs-lookup"><span data-stu-id="f3c64-211">Handling PIDLs</span></span>

<span data-ttu-id="f3c64-212">Chaque élément de l’espace de noms Shell doit avoir un PIDL unique.</span><span class="sxs-lookup"><span data-stu-id="f3c64-212">Every item in the Shell namespace must have a unique PIDL.</span></span> <span data-ttu-id="f3c64-213">L’Explorateur Windows affecte un PIDL à votre dossier racine et passe la valeur à votre extension pendant l’initialisation.</span><span class="sxs-lookup"><span data-stu-id="f3c64-213">Windows Explorer assigns a PIDL to your root folder and passes the value to your extension during initialization.</span></span> <span data-ttu-id="f3c64-214">Votre extension est alors chargée d’attribuer un PIDL correctement construit à chacun de ses objets et de fournir ces PIDL à l’Explorateur Windows à la demande.</span><span class="sxs-lookup"><span data-stu-id="f3c64-214">Your extension is then responsible for assigning a properly constructed PIDL to each of its objects and providing those PIDLs to Windows Explorer on request.</span></span> <span data-ttu-id="f3c64-215">Lorsque l’interpréteur de commandes utilise un PIDL pour identifier l’un des objets de votre extension, votre extension doit être en mesure d’interpréter le PIDL et d’identifier l’objet particulier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-215">When the Shell uses a PIDL to identify one of your extension's objects, your extension must be able to interpret the PIDL and identify the particular object.</span></span> <span data-ttu-id="f3c64-216">Votre extension doit également assigner un [**nom complet**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-setnameof) et un *nom d’analyse* à chaque objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-216">Your extension must also assign a [**display name**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-setnameof) and a *parsing name* to each object.</span></span> <span data-ttu-id="f3c64-217">Étant donné que les PIDL sont utilisés par pratiquement toutes les interfaces de dossiers, les extensions implémentent généralement un *Gestionnaire PIDL* unique pour gérer toutes ces tâches.</span><span class="sxs-lookup"><span data-stu-id="f3c64-217">Because PIDLs are used by virtually every folder interface, extensions commonly implement a single *PIDL manager* to handle all these tasks.</span></span>

<span data-ttu-id="f3c64-218">Le terme PIDL est concis pour une structure [**ITEMIDLIST**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) ou un pointeur vers une telle structure, selon le contexte.</span><span class="sxs-lookup"><span data-stu-id="f3c64-218">The term PIDL is short for an [**ITEMIDLIST**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) structure or a pointer to such a structure, depending on context.</span></span> <span data-ttu-id="f3c64-219">Comme déclaré, une structure **ITEMIDLIST** a un seul membre, une structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-219">As declared, an **ITEMIDLIST** structure has a single member, an [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure.</span></span> <span data-ttu-id="f3c64-220">La structure **ITEMIDLIST** d’un objet est en fait un tableau condensé de deux structures **SHITEMID** ou plus.</span><span class="sxs-lookup"><span data-stu-id="f3c64-220">An object's **ITEMIDLIST** structure is actually a packed array of two or more **SHITEMID** structures.</span></span> <span data-ttu-id="f3c64-221">L’ordre de ces structures définit un chemin d’accès à l’aide de l’espace de noms, à peu près de la même façon que c : \\ mydirectory \\ MyFile définit un chemin d’accès via le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="f3c64-221">The order of these structures defines a path through the namespace, in much the same way that c:\\MyDirectory\\MyFile defines a path through the file system.</span></span> <span data-ttu-id="f3c64-222">En règle générale, le PIDL d’un objet se compose d’une série de structures **SHITEMID** qui correspondent aux dossiers qui définissent le chemin d’accès de l’espace de noms, suivis de la structure **SHITEMID** de l’objet, suivie d’un terminateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-222">Typically, an object's PIDL will consist of a series of **SHITEMID** structures that correspond to the folders that define the namespace path, followed by the object's **SHITEMID** structure, followed by a terminator.</span></span>

<span data-ttu-id="f3c64-223">Le terminateur est une structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) , avec le membre *CB* ayant la valeur **null**.</span><span class="sxs-lookup"><span data-stu-id="f3c64-223">The terminator is an [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure, with the *cb* member set to **NULL**.</span></span> <span data-ttu-id="f3c64-224">Le terminateur est nécessaire car le nombre de structures **SHITEMID** dans le PIDL d’un objet dépend de l’emplacement de l’objet dans l’espace de noms de l’interpréteur de commandes et du point de départ du chemin d’accès.</span><span class="sxs-lookup"><span data-stu-id="f3c64-224">The terminator is necessary because the number of **SHITEMID** structures in an object's PIDL depends on the location of the object in the Shell namespace, and the starting point of the path.</span></span> <span data-ttu-id="f3c64-225">En outre, la taille des différentes structures **SHITEMID** peut varier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-225">In addition, the size of the various **SHITEMID** structures can vary.</span></span> <span data-ttu-id="f3c64-226">Quand vous recevez un PIDL, vous n’avez aucun moyen simple de déterminer sa taille, voire le nombre total de structures **SHITEMID** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-226">When you receive a PIDL, you have no simple way of determining its size or even the total number of **SHITEMID** structures.</span></span> <span data-ttu-id="f3c64-227">Au lieu de cela, vous devez « parcourir » le tableau condensé, structure par structure, jusqu’à ce que vous atteigniez le terminateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-227">Instead, you must "walk" the packed array, structure by structure, until you reach the terminator.</span></span>

<span data-ttu-id="f3c64-228">Pour créer un PIDL, votre application doit :</span><span class="sxs-lookup"><span data-stu-id="f3c64-228">To create a PIDL, your application needs to:</span></span>

1.  <span data-ttu-id="f3c64-229">Créez une structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) pour chacun de ses objets.</span><span class="sxs-lookup"><span data-stu-id="f3c64-229">Create an [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure for each of its objects.</span></span>
2.  <span data-ttu-id="f3c64-230">Assemblez les structures [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) pertinentes dans un PIDL.</span><span class="sxs-lookup"><span data-stu-id="f3c64-230">Assemble the relevant [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures into a PIDL.</span></span>

### <a name="creating-an-shitemid-structure"></a><span data-ttu-id="f3c64-231">Création d’une structure SHITEMID</span><span class="sxs-lookup"><span data-stu-id="f3c64-231">Creating an SHITEMID Structure</span></span>

<span data-ttu-id="f3c64-232">La structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) d’un objet identifie l’objet de manière unique dans son dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-232">An object's [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure uniquely identifies the object within its folder.</span></span> <span data-ttu-id="f3c64-233">En fait, un type de PIDL utilisé par la plupart des méthodes [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) se compose uniquement de la structure **SHITEMID** de l’objet, suivie d’un terminateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-233">In fact, a type of PIDL used by many of the [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) methods consists of just the object's **SHITEMID** structure, followed by a terminator.</span></span> <span data-ttu-id="f3c64-234">La définition d’une structure **SHITEMID** est la suivante :</span><span class="sxs-lookup"><span data-stu-id="f3c64-234">The definition of an **SHITEMID** structure is:</span></span>


```C++
typedef struct _SHITEMID { 
    USHORT cb; 
    BYTE   abID[1]; 
} SHITEMID, * LPSHITEMID;
```



<span data-ttu-id="f3c64-235">Le membre *abID* est l’identificateur de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-235">The *abID* member is the object's identifier.</span></span> <span data-ttu-id="f3c64-236">Étant donné que la longueur de *abID* n’est pas définie et peut varier, le membre *CB* est défini sur la taille de la structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) , en octets.</span><span class="sxs-lookup"><span data-stu-id="f3c64-236">Because the length of *abID* is not defined and can vary, the *cb* member is set to the size of the [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure, in bytes.</span></span>

<span data-ttu-id="f3c64-237">Étant donné que la longueur et le contenu de *abID* ne sont pas normalisés, vous pouvez utiliser n’importe quel schéma pour assigner des valeurs *abID* à vos objets.</span><span class="sxs-lookup"><span data-stu-id="f3c64-237">Because neither the length nor the content of *abID* is standardized, you can use any scheme you want to assign *abID* values to your objects.</span></span> <span data-ttu-id="f3c64-238">La seule exigence est que vous ne pouvez pas avoir deux objets dans le même dossier avec des valeurs identiques.</span><span class="sxs-lookup"><span data-stu-id="f3c64-238">The only requirement is that you cannot have two objects in the same folder with identical values.</span></span> <span data-ttu-id="f3c64-239">Toutefois, pour des raisons de performances, votre structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) doit être alignée sur les **DWORD**.</span><span class="sxs-lookup"><span data-stu-id="f3c64-239">However, for performance reasons, your [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure should be **DWORD**-aligned.</span></span> <span data-ttu-id="f3c64-240">En d’autres termes, vous devez construire vos valeurs *abID* de sorte que *CB* soit un multiple entier de 4.</span><span class="sxs-lookup"><span data-stu-id="f3c64-240">In other words, you should construct your *abID* values such that *cb* is an integral multiple of 4.</span></span>

<span data-ttu-id="f3c64-241">En général, *abID* pointe vers une structure définie par l’extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-241">Typically, *abID* points to an extension-defined structure.</span></span> <span data-ttu-id="f3c64-242">En plus de l’ID de l’objet, cette structure est souvent utilisée pour contenir diverses informations connexes, telles que le type ou les attributs de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-242">In addition to the object's ID, this structure is often used to hold a variety of related information, such as the object's type or attributes.</span></span> <span data-ttu-id="f3c64-243">Les objets de dossier de votre extension peuvent ensuite extraire rapidement les informations du PIDL au lieu de devoir les interroger.</span><span class="sxs-lookup"><span data-stu-id="f3c64-243">Your extension's folder objects can then quickly extract the information from the PIDL instead of having to query for it.</span></span>

> [!Note]  
> <span data-ttu-id="f3c64-244">L’un des aspects les plus importants de la conception d’une structure de données pour un PIDL est de rendre la structure persistante et transportable.</span><span class="sxs-lookup"><span data-stu-id="f3c64-244">One of the most important aspects of designing a data structure for a PIDL is to make the structure persistable and transportable.</span></span> <span data-ttu-id="f3c64-245">Dans le contexte de PIDL, la signification de ces termes est la suivante :</span><span class="sxs-lookup"><span data-stu-id="f3c64-245">In the context of PIDLs, the meaning of these terms is:</span></span>
>
> -   <span data-ttu-id="f3c64-246">Persistant.</span><span class="sxs-lookup"><span data-stu-id="f3c64-246">Persistable.</span></span> <span data-ttu-id="f3c64-247">Le système place souvent PIDL dans différents types de stockage à long terme, tels que des fichiers de raccourcis.</span><span class="sxs-lookup"><span data-stu-id="f3c64-247">The system frequently places PIDLs in various types of long-term storage, such as shortcut files.</span></span> <span data-ttu-id="f3c64-248">Il peut ensuite récupérer ces PIDL à partir du stockage ultérieurement, éventuellement après le redémarrage du système.</span><span class="sxs-lookup"><span data-stu-id="f3c64-248">It can then recover these PIDLs from storage later, possibly after the system has been rebooted.</span></span> <span data-ttu-id="f3c64-249">Un PIDL récupéré à partir du stockage doit toujours être valide et explicite pour votre extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-249">A PIDL that has been recovered from storage must still be valid and meaningful to your extension.</span></span> <span data-ttu-id="f3c64-250">Cette exigence signifie, par exemple, que vous ne devez pas utiliser de pointeurs ou de handles dans votre structure PIDL.</span><span class="sxs-lookup"><span data-stu-id="f3c64-250">This requirement means, for instance, that you should not use pointers or handles in your PIDL structure.</span></span> <span data-ttu-id="f3c64-251">Les PIDL contenant ce type de données ne sont normalement pas sensées lorsque le système les récupère ultérieurement à partir du stockage.</span><span class="sxs-lookup"><span data-stu-id="f3c64-251">PIDLs containing this type of data will normally be meaningless when the system later recovers them from storage.</span></span>
> -   <span data-ttu-id="f3c64-252">Transportables.</span><span class="sxs-lookup"><span data-stu-id="f3c64-252">Transportable.</span></span> <span data-ttu-id="f3c64-253">Un PIDL doit rester explicite lorsqu’il est transporté d’un ordinateur à un autre.</span><span class="sxs-lookup"><span data-stu-id="f3c64-253">A PIDL must remain meaningful when transported from one computer to another.</span></span> <span data-ttu-id="f3c64-254">Par exemple, un PIDL peut être écrit dans un fichier de raccourci, copié sur une disquette et transporté vers un autre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-254">For example, a PIDL can be written to a shortcut file, copied to a floppy disk, and transported to another computer.</span></span> <span data-ttu-id="f3c64-255">Cette PIDL doit toujours être significative pour votre extension s’exécutant sur le deuxième ordinateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-255">That PIDL should still be meaningful to your extension running on the second computer.</span></span> <span data-ttu-id="f3c64-256">Par exemple, pour vous assurer que vos PIDL sont transportables, utilisez explicitement des caractères ANSI ou Unicode.</span><span class="sxs-lookup"><span data-stu-id="f3c64-256">For instance, to ensure that your PIDLs are transportable, use either ANSI or Unicode characters explicitly.</span></span> <span data-ttu-id="f3c64-257">Évitez les types de données tels que **TCHAR** ou **LPTStr**.</span><span class="sxs-lookup"><span data-stu-id="f3c64-257">Avoid data types such as **TCHAR** or **LPTSTR**.</span></span> <span data-ttu-id="f3c64-258">Si vous utilisez ces types de données, un PIDL créé sur un ordinateur exécutant une version Unicode de votre extension ne sera pas lisible par une version ANSI de cette extension s’exécutant sur un autre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-258">If you use those data types, a PIDL created on a computer running a Unicode version of your extension will not be readable by an ANSI version of that extension running on a different computer.</span></span>

 

<span data-ttu-id="f3c64-259">La déclaration suivante montre un exemple simple d’une structure de données.</span><span class="sxs-lookup"><span data-stu-id="f3c64-259">The following declaration shows a simple example of a data structure.</span></span>


```C++
typedef struct tagMYPIDLDATA {
  USHORT cb;
  DWORD dwType;
  WCHAR wszDisplayName[40];
} MYPIDLDATA, *LPMYPIDLDATA;
```



<span data-ttu-id="f3c64-260">Le membre **CB** est défini sur la taille de la structure **MYPIDLDATA** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-260">The **cb** member is set to the size of the **MYPIDLDATA** structure.</span></span> <span data-ttu-id="f3c64-261">Ce membre fait de **MYPIDLDATA** une structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) valide, dans et de lui-même.</span><span class="sxs-lookup"><span data-stu-id="f3c64-261">This member makes **MYPIDLDATA** a valid [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure, in and of itself.</span></span> <span data-ttu-id="f3c64-262">Les autres membres sont équivalents au membre **abID** d’une structure **SHITEMID** et contiennent des données privées.</span><span class="sxs-lookup"><span data-stu-id="f3c64-262">The rest of the members are equivalent to the **abID** member of an **SHITEMID** structure and hold private data.</span></span> <span data-ttu-id="f3c64-263">Le membre **dwType** est une valeur définie par une extension qui indique le type d’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-263">The **dwType** member is an extension-defined value that indicates the type of object.</span></span> <span data-ttu-id="f3c64-264">Pour cet exemple, **dwType** est défini sur **true** pour les dossiers et **false** dans le cas contraire.</span><span class="sxs-lookup"><span data-stu-id="f3c64-264">For this example, **dwType** is set to **TRUE** for folders and **FALSE** otherwise.</span></span> <span data-ttu-id="f3c64-265">Ce membre vous permet, par exemple, de déterminer rapidement si l’objet est un dossier ou non.</span><span class="sxs-lookup"><span data-stu-id="f3c64-265">This member allows you, for instance, to quickly determine whether the object is a folder or not.</span></span> <span data-ttu-id="f3c64-266">Le membre **wszDisplayName** contient le nom complet de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-266">The **wszDisplayName** member contains the object's display name.</span></span> <span data-ttu-id="f3c64-267">Étant donné que vous n’affectez pas le même nom d’affichage à deux objets différents dans le même dossier, le nom complet sert également d’ID d’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-267">Since you would not assign the same display name to two different objects in the same folder, the display name also serves as the object ID.</span></span> <span data-ttu-id="f3c64-268">Dans cet exemple, **wszDisplayName** est défini sur 40 caractères pour garantir que la structure **SHITEMID** sera alignée sur la valeur **DWORD**.</span><span class="sxs-lookup"><span data-stu-id="f3c64-268">In this example, **wszDisplayName** is set to 40 characters to guarantee that the **SHITEMID** structure will be **DWORD**-aligned.</span></span> <span data-ttu-id="f3c64-269">Pour limiter la taille de votre PIDL, vous pouvez utiliser à la place un tableau de caractères de longueur variable et ajuster la valeur de CB en conséquence.</span><span class="sxs-lookup"><span data-stu-id="f3c64-269">To limit the size of your PIDLs, you can instead use a variable-length character array and adjust the value of cb accordingly.</span></span> <span data-ttu-id="f3c64-270">Remplissez la chaîne d’affichage avec suffisamment de \\ caractères « 0 » pour conserver l’alignement **DWORD** de la structure.</span><span class="sxs-lookup"><span data-stu-id="f3c64-270">Pad the display string with enough '\\0' characters to maintain the structure's **DWORD** alignment.</span></span> <span data-ttu-id="f3c64-271">Les autres membres qui peuvent être utiles pour la mise en place de la structure incluent la taille, les attributs ou le nom de l’analyse de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-271">Other members that might be useful to put in the structure include the object's size, attributes, or parsing name.</span></span>

### <a name="constructing-a-pidl"></a><span data-ttu-id="f3c64-272">Construction d’un PIDL</span><span class="sxs-lookup"><span data-stu-id="f3c64-272">Constructing a PIDL</span></span>

<span data-ttu-id="f3c64-273">Une fois que vous avez défini les structures [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) pour vos objets, vous pouvez les utiliser pour construire un PIDL.</span><span class="sxs-lookup"><span data-stu-id="f3c64-273">Once you have defined [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures for your objects, you can then use them to construct a PIDL.</span></span> <span data-ttu-id="f3c64-274">Les PIDL peuvent être construits à diverses fins, mais la plupart des tâches utilisent l’un des deux types de PIDL.</span><span class="sxs-lookup"><span data-stu-id="f3c64-274">PIDLs can be constructed for a variety of purposes, but most tasks use one of two types of PIDL.</span></span> <span data-ttu-id="f3c64-275">Le plus simple, un PIDL à un seul niveau, identifie l’objet par rapport à son dossier parent.</span><span class="sxs-lookup"><span data-stu-id="f3c64-275">The simplest, a single-level PIDL, identifies the object relative to its parent folder.</span></span> <span data-ttu-id="f3c64-276">Ce type de PIDL est utilisé par la plupart des méthodes [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-276">This type of PIDL is used by many of the [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) methods.</span></span> <span data-ttu-id="f3c64-277">Un PIDL à un seul niveau contient la structure **SHITEMID** de l’objet, suivie d’un terminateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-277">A single-level PIDL contains the object's **SHITEMID** structure, followed by a terminator.</span></span> <span data-ttu-id="f3c64-278">Un PIDL qualifié complet définit un chemin d’accès via la hiérarchie d’espaces de noms à partir du bureau vers l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-278">A fully qualified PIDL defines a path through the namespace hierarchy from the desktop to the object.</span></span> <span data-ttu-id="f3c64-279">Ce type de PIDL démarre sur le bureau et contient une structure **SHITEMID** pour chaque dossier du chemin d’accès, suivi de l’objet et du terminateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-279">This type of PIDL starts at the desktop and contains one **SHITEMID** structure for each folder in the path, followed by the object and the terminator.</span></span> <span data-ttu-id="f3c64-280">Un PIDL complet identifie de façon unique l’objet dans l’intégralité de l’espace de noms de l’interpréteur de commandes.</span><span class="sxs-lookup"><span data-stu-id="f3c64-280">A fully qualified PIDL uniquely identifies the object within the entire Shell namespace.</span></span>

<span data-ttu-id="f3c64-281">La façon la plus simple de construire un PIDL consiste à travailler directement avec la structure [**ITEMIDLIST**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) elle-même.</span><span class="sxs-lookup"><span data-stu-id="f3c64-281">The simplest way to construct a PIDL is to work directly with the [**ITEMIDLIST**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) structure itself.</span></span> <span data-ttu-id="f3c64-282">Créez une structure **ITEMIDLIST** , mais allouez suffisamment de mémoire pour contenir toutes les structures [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-282">Create an **ITEMIDLIST** structure, but allocate enough memory to hold all the [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures.</span></span> <span data-ttu-id="f3c64-283">L’adresse de cette structure pointera vers la structure **SHITEMID** initiale.</span><span class="sxs-lookup"><span data-stu-id="f3c64-283">The address of this structure will point to the initial **SHITEMID** structure.</span></span> <span data-ttu-id="f3c64-284">Définissez les valeurs des membres de cette structure initiale, puis ajoutez autant de structures **SHITEMID** supplémentaires que nécessaire, dans l’ordre approprié.</span><span class="sxs-lookup"><span data-stu-id="f3c64-284">Define values for the members of this initial structure, and then append as many additional **SHITEMID** structures as you need, in the appropriate order.</span></span> <span data-ttu-id="f3c64-285">La procédure suivante décrit comment créer un PIDL à un seul niveau.</span><span class="sxs-lookup"><span data-stu-id="f3c64-285">The following procedure outlines how to create a single-level PIDL.</span></span> <span data-ttu-id="f3c64-286">Il contient deux structures **SHITEMID** , une structure **MYPIDLDATA** suivie d’un terminateur :</span><span class="sxs-lookup"><span data-stu-id="f3c64-286">It contains two **SHITEMID** structures—a **MYPIDLDATA** structure followed by a terminator:</span></span>

1.  <span data-ttu-id="f3c64-287">Utilisez la fonction [**CoTaskMemAlloc**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemalloc) pour allouer de la mémoire pour le PIDL.</span><span class="sxs-lookup"><span data-stu-id="f3c64-287">Use the [**CoTaskMemAlloc**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemalloc) function to allocate memory for the PIDL.</span></span> <span data-ttu-id="f3c64-288">Allouez suffisamment de mémoire pour vos données privées plus un **UShort** (deux octets) pour le terminateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-288">Allocate enough memory for your private data plus a **USHORT** (two bytes) for the terminator.</span></span> <span data-ttu-id="f3c64-289">Effectuez un cast du résultat en LPMYPIDLDATA.</span><span class="sxs-lookup"><span data-stu-id="f3c64-289">Cast the result to LPMYPIDLDATA.</span></span>
2.  <span data-ttu-id="f3c64-290">Définissez le membre CB de la première structure **MYPIDLDATA** sur la taille de cette structure.</span><span class="sxs-lookup"><span data-stu-id="f3c64-290">Set the cb member of the first **MYPIDLDATA** structure to the size of that structure.</span></span> <span data-ttu-id="f3c64-291">Pour cet exemple, vous devez affecter à **CB** la valeur sizeof (MYPIDLDATA).</span><span class="sxs-lookup"><span data-stu-id="f3c64-291">For this example, you would set **cb** to sizeof(MYPIDLDATA).</span></span> <span data-ttu-id="f3c64-292">Si vous souhaitez utiliser une structure de longueur variable, vous devez calculer la valeur de **CB**.</span><span class="sxs-lookup"><span data-stu-id="f3c64-292">If you want to use a variable-length structure, you will have to calculate the value of **cb**.</span></span>
3.  <span data-ttu-id="f3c64-293">Assignez des valeurs appropriées aux membres de données privés.</span><span class="sxs-lookup"><span data-stu-id="f3c64-293">Assign appropriate values to the private data members.</span></span>
4.  <span data-ttu-id="f3c64-294">Calcule l’adresse de la structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) suivante.</span><span class="sxs-lookup"><span data-stu-id="f3c64-294">Calculate the address of the next [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure.</span></span> <span data-ttu-id="f3c64-295">Effectuez un cast de l’adresse de la structure MYPIDLDATA actuelle en LPBYTE, puis ajoutez cette valeur à la valeur de **CB** déterminée à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="f3c64-295">Cast the address of the current MYPIDLDATA structure to LPBYTE, and add that value to the value of **cb** determined in step 3.</span></span>
5.  <span data-ttu-id="f3c64-296">Dans ce cas, la prochaine structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) est le terminateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-296">In this case, the next [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure is the terminator.</span></span> <span data-ttu-id="f3c64-297">Affectez la valeur zéro au membre **CB** de la structure.</span><span class="sxs-lookup"><span data-stu-id="f3c64-297">Set the structure's **cb** member to zero.</span></span>

<span data-ttu-id="f3c64-298">Pour les PIDL plus longues, allouez suffisamment de mémoire et répétez les étapes 3-5 pour chaque structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="f3c64-298">For longer PIDLs, allocate sufficient memory and repeat steps 3-5 for each additional [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure.</span></span>

<span data-ttu-id="f3c64-299">L’exemple de fonction suivant prend le type et le nom d’affichage d’un objet et retourne le PIDL à un seul niveau de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-299">The following sample function takes an object's type and display name and returns the object's single-level PIDL.</span></span> <span data-ttu-id="f3c64-300">La fonction suppose que le nom d’affichage, y compris son caractère **null** de fin, ne dépasse pas le nombre de caractères déclarés pour la structure **MYPIDLDATA** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-300">The function assumes that the display name, including its terminating **null** character, does not exceed the number of characters declared for the **MYPIDLDATA** structure.</span></span> <span data-ttu-id="f3c64-301">Si cette supposition s’avère incorrecte, la fonction [**StringCbCopyW**](/windows/win32/api/strsafe/nf-strsafe-stringcbcopya) tronque le nom complet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-301">If that assumption turns out to be erroneous, the [**StringCbCopyW**](/windows/win32/api/strsafe/nf-strsafe-stringcbcopya) function will truncate the display name.</span></span> <span data-ttu-id="f3c64-302">La variable **g \_ pMalloc** est un pointeur [**IMalloc**](/windows/win32/api/objidlbase/nn-objidlbase-imalloc) créé ailleurs et stocké dans une variable globale.</span><span class="sxs-lookup"><span data-stu-id="f3c64-302">The **g\_pMalloc** variable is an [**IMalloc**](/windows/win32/api/objidlbase/nn-objidlbase-imalloc) pointer created elsewhere and stored in a global variable.</span></span>


```C++
LPITEMIDLIST CreatePIDL(DWORD dwType, LPCWSTR pwszDisplayName)
{
    LPMYPIDLDATA   pidlOut;
    USHORT         uSize;

    pidlOut = NULL;

    //Calculate the size of the MYPIDLDATA structure.
    uSize = sizeof(MYPIDLDATA);

    // Allocate enough memory for the PIDL to hold a MYPIDLDATA structure 
    // plus the terminator
    pidlOut = (LPMYPIDLDATA)m_pMalloc->Alloc(uSize + sizeof(USHORT));

    if(pidlOut)
    {
       //Assign values to the members of the MYPIDLDATA structure
       //that is the PIDL's first SHITEMID structure
       pidlOut->cb = uSize;
       pidlOut->dwType = dwType;
       hr = StringCbCopyW(pidlOut->wszDisplayName, 
                          sizeof(pidlOut->wszDisplayName), pwszDisplayName);
       
       // TODO: Add error handling here to verify the HRESULT returned 
       // by StringCbCopyW.

       //Advance the pointer to the start of the next SHITEMID structure.
       pidlOut = (LPMYPIDLDATA)((LPBYTE)pidlOut + pidlOut->cb);

       //Create the terminating null character by setting cb to 0.
       pidlOut->cb = 0;
    }

    return pidlOut;
```



<span data-ttu-id="f3c64-303">Un PIDL complet doit avoir des structures [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) pour chaque objet du bureau vers votre objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-303">A fully qualified PIDL must have [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures for every object from the desktop to your object.</span></span> <span data-ttu-id="f3c64-304">Votre extension reçoit un PIDL complet pour votre dossier racine lorsque l’interpréteur de commandes appelle [**IPersistFolder :: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize).</span><span class="sxs-lookup"><span data-stu-id="f3c64-304">Your extension receives a fully qualified PIDL for your root folder when the Shell calls [**IPersistFolder::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize).</span></span> <span data-ttu-id="f3c64-305">Pour construire un PIDL qualifié complet pour un objet, prenez le PIDL que l’interpréteur de commandes a affecté à votre dossier racine et ajoutez les structures **SHITEMID** nécessaires pour vous faire passer du dossier racine à l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-305">To construct a fully qualified PIDL for an object, take the PIDL that the Shell has assigned to your root folder, and append the **SHITEMID** structures that are needed to take you from the root folder to the object.</span></span>

### <a name="interpreting-pidls"></a><span data-ttu-id="f3c64-306">Interprétation des PIDL</span><span class="sxs-lookup"><span data-stu-id="f3c64-306">Interpreting PIDLs</span></span>

<span data-ttu-id="f3c64-307">Lorsque l’interpréteur de commandes ou une application appelle l’une des interfaces de votre extension pour demander des informations sur un objet, il identifie généralement l’objet par un PIDL.</span><span class="sxs-lookup"><span data-stu-id="f3c64-307">When the Shell or an application calls one of your extension's interfaces to request information about an object, it will usually identify the object by a PIDL.</span></span> <span data-ttu-id="f3c64-308">Certaines méthodes, telles que [**IShellFolder :: GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof), utilisent des PIDL relatives au dossier parent et sont faciles à interpréter.</span><span class="sxs-lookup"><span data-stu-id="f3c64-308">Some methods, such as [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof), use PIDLs that are relative to the parent folder and are straightforward to interpret.</span></span> <span data-ttu-id="f3c64-309">Toutefois, votre extension recevra probablement également des PIDL qualifiés complets.</span><span class="sxs-lookup"><span data-stu-id="f3c64-309">However, your extension will probably also receive fully qualified PIDLs.</span></span> <span data-ttu-id="f3c64-310">Votre gestionnaire PIDL doit ensuite déterminer à quel objet PIDL fait référence.</span><span class="sxs-lookup"><span data-stu-id="f3c64-310">Your PIDL manager must then determine which of your objects that PIDL is referring to.</span></span>

<span data-ttu-id="f3c64-311">Ce qui complique la tâche d’association d’un objet à un PIDL qualifié complet, c’est qu’une ou plusieurs des structures [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) initiales dans le PIDL peuvent appartenir à des objets qui se trouvent en dehors de votre extension dans l’espace de noms Shell.</span><span class="sxs-lookup"><span data-stu-id="f3c64-311">What complicates the task of associating an object with a fully qualified PIDL is that one or more of the initial [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures in the PIDL might belong to objects that lie outside your extension in the Shell namespace.</span></span> <span data-ttu-id="f3c64-312">Vous n’avez aucun moyen d’interpréter la signification du membre *abID* de ces structures.</span><span class="sxs-lookup"><span data-stu-id="f3c64-312">You have no way of interpreting the meaning of the *abID* member of those structures.</span></span> <span data-ttu-id="f3c64-313">Ce que votre extension doit faire consiste à « parcourir » la liste des structures **SHITEMID** , jusqu’à ce que vous atteigniez la structure qui correspond à votre dossier racine.</span><span class="sxs-lookup"><span data-stu-id="f3c64-313">What your extension must do is to "walk" the list of **SHITEMID** structures, until you reach the structure that corresponds to your root folder.</span></span> <span data-ttu-id="f3c64-314">À partir de là, vous saurez comment interpréter les informations dans les structures **SHITEMID** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-314">From then on, you will know how to interpret the information in the **SHITEMID** structures.</span></span>

<span data-ttu-id="f3c64-315">Pour parcourir le PIDL, prenez la première valeur *CB* et ajoutez-la à l’adresse du PIDL pour avancer le pointeur vers le début de la structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) suivante.</span><span class="sxs-lookup"><span data-stu-id="f3c64-315">To walk the PIDL, take the first *cb* value and add it to the address of the PIDL to advance the pointer to the start of the next [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure.</span></span> <span data-ttu-id="f3c64-316">Il pointe ensuite vers le membre *CB* de cette structure, que vous pouvez utiliser pour avancer le pointeur vers le début de la structure **SHITEMID** suivante, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="f3c64-316">It then will be pointing to that structure's *cb* member, which you can use to advance the pointer to the start of the next **SHITEMID** structure, and so on.</span></span> <span data-ttu-id="f3c64-317">Chaque fois que vous avancez le pointeur, examinez la structure **SHITEMID** pour déterminer si vous avez atteint la racine de l’espace de noms de votre extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-317">Each time you advance the pointer, examine the **SHITEMID** structure to determine whether you have reached the root of your extension's namespace.</span></span>

## <a name="implementing-the-primary-interfaces"></a><span data-ttu-id="f3c64-318">Implémentation des interfaces principales</span><span class="sxs-lookup"><span data-stu-id="f3c64-318">Implementing the Primary Interfaces</span></span>

<span data-ttu-id="f3c64-319">Comme avec tous les objets COM, l’implémentation d’une extension consiste principalement à implémenter une collection d’interfaces.</span><span class="sxs-lookup"><span data-stu-id="f3c64-319">As with all COM objects, implementing an extension is largely a matter of implementing a collection of interfaces.</span></span> <span data-ttu-id="f3c64-320">Cette section présente les trois interfaces principales qui doivent être implémentées par toutes les extensions.</span><span class="sxs-lookup"><span data-stu-id="f3c64-320">This section discusses the three primary interfaces that must be implemented by all extensions.</span></span> <span data-ttu-id="f3c64-321">Elles sont utilisées pour l’initialisation et pour fournir à l’Explorateur Windows des informations de base sur le contenu de l’extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-321">They are used for initialization and to provide Windows Explorer with basic information about the contents of the extension.</span></span> <span data-ttu-id="f3c64-322">Ces interfaces, ainsi qu’une [vue de dossier](../lwef/nse-folderview.md), sont toutes nécessaires pour une extension fonctionnelle.</span><span class="sxs-lookup"><span data-stu-id="f3c64-322">These interfaces, plus a [folder view](../lwef/nse-folderview.md), are all that is required for a functional extension.</span></span> <span data-ttu-id="f3c64-323">Toutefois, pour exploiter pleinement les fonctionnalités de l’Explorateur Windows, la plupart des extensions implémentent également une ou plusieurs des interfaces facultatives.</span><span class="sxs-lookup"><span data-stu-id="f3c64-323">However, to fully exploit the features of Windows Explorer, most extensions also implement one or more of the optional interfaces.</span></span>

### <a name="ipersistfolder-interface"></a><span data-ttu-id="f3c64-324">Interface IPersistFolder</span><span class="sxs-lookup"><span data-stu-id="f3c64-324">IPersistFolder Interface</span></span>

<span data-ttu-id="f3c64-325">L’interface [**IPersistFolder**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder) est appelée pour initialiser un nouvel objet dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-325">The [**IPersistFolder**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder) interface is called to initialize a new folder object.</span></span> <span data-ttu-id="f3c64-326">La méthode [**IPersistFolder :: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize) assigne un PIDL qualifié complet au nouvel objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-326">The [**IPersistFolder::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize) method assigns a fully qualified PIDL to the new object.</span></span> <span data-ttu-id="f3c64-327">Stockez ce PIDL pour une utilisation ultérieure.</span><span class="sxs-lookup"><span data-stu-id="f3c64-327">Store this PIDL for later use.</span></span> <span data-ttu-id="f3c64-328">Par exemple, un objet dossier doit utiliser ce PIDL pour construire des PIDL qualifiés complets pour les enfants de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-328">For instance, a folder object must use this PIDL to construct fully qualified PIDLs for the object's children.</span></span> <span data-ttu-id="f3c64-329">Le créateur de l’objet Folder peut également appeler [**IPersist :: GetClassID**](/windows/win32/api/objidl/nf-objidl-ipersist-getclassid) pour demander le CLSID de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-329">The folder object's creator can also call [**IPersist::GetClassID**](/windows/win32/api/objidl/nf-objidl-ipersist-getclassid) to request the object's CLSID.</span></span>

<span data-ttu-id="f3c64-330">En règle générale, un objet dossier est créé et initialisé par la méthode [**IShellFolder :: BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) de son dossier parent.</span><span class="sxs-lookup"><span data-stu-id="f3c64-330">Typically, a folder object is created and initialized by its parent folder's [**IShellFolder::BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) method.</span></span> <span data-ttu-id="f3c64-331">Toutefois, lorsqu’un utilisateur accède à votre extension, l’Explorateur Windows crée et initialise l’objet dossier racine de l’extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-331">However, when a user browses into your extension, Windows Explorer creates and initializes the extension's root folder object.</span></span> <span data-ttu-id="f3c64-332">Le PIDL que l’objet dossier racine reçoit via [**IPersistFolder :: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize) contient le chemin d’accès du bureau au dossier racine dont vous aurez besoin pour construire un PIDL complet pour votre extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-332">The PIDL that the root folder object receives through [**IPersistFolder::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize) contains the path from the desktop to the root folder that you will need to construct fully qualified PIDLs for your extension.</span></span>

### <a name="ishellfolder-interface"></a><span data-ttu-id="f3c64-333">Interface IShellFolder</span><span class="sxs-lookup"><span data-stu-id="f3c64-333">IShellFolder Interface</span></span>

<span data-ttu-id="f3c64-334">L’interpréteur de commandes traite une extension comme une collection hiérarchique d’objets Folder.</span><span class="sxs-lookup"><span data-stu-id="f3c64-334">The Shell treats an extension as a hierarchically ordered collection of folder objects.</span></span> <span data-ttu-id="f3c64-335">L’interface [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) est le cœur de toute implémentation d’extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-335">The [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface is the core of any extension implementation.</span></span> <span data-ttu-id="f3c64-336">Il représente un objet dossier et fournit à l’Explorateur Windows une grande partie des informations nécessaires pour afficher le contenu du dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-336">It represents a folder object and provides Windows Explorer with much of the information needed to display the contents of the folder.</span></span>

<span data-ttu-id="f3c64-337">[**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) est généralement la seule interface de dossier autre que [**IPersistFolder**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder) qui est directement exposée par un objet Folder.</span><span class="sxs-lookup"><span data-stu-id="f3c64-337">[**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) is typically the only folder interface other than [**IPersistFolder**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder) that is directly exposed by a folder object.</span></span> <span data-ttu-id="f3c64-338">Alors que l’Explorateur Windows utilise une variété d’interfaces obligatoires et facultatives pour obtenir des informations sur le contenu du dossier, il obtient des pointeurs vers ces interfaces via **IShellFolder**.</span><span class="sxs-lookup"><span data-stu-id="f3c64-338">While Windows Explorer uses a variety of required and optional interfaces to obtain information about the contents of the folder, it obtains pointers to those interfaces through **IShellFolder**.</span></span>

<span data-ttu-id="f3c64-339">L’Explorateur Windows obtient le CLSID du dossier racine de votre extension de différentes façons.</span><span class="sxs-lookup"><span data-stu-id="f3c64-339">Windows Explorer obtains the CLSID of your extension's root folder in a variety of ways.</span></span> <span data-ttu-id="f3c64-340">Pour plus d’informations, consultez [spécification de l’emplacement d’une extension d’espace de noms](nse-junction.md) ou affichage [d’un Self-Contained vue d’une extension d’espace de noms](nse-view.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-340">For details, see [Specifying a Namespace Extension's Location](nse-junction.md) or [Displaying a Self-Contained View of a Namespace Extension](nse-view.md).</span></span> <span data-ttu-id="f3c64-341">L’Explorateur Windows utilise ensuite ce CLSID pour créer et initialiser une instance du dossier racine et pour effectuer une requête pour une interface [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-341">Windows Explorer then uses that CLSID to create and initialize an instance of the root folder and query for an [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span> <span data-ttu-id="f3c64-342">Votre extension crée un objet dossier pour représenter le dossier racine et retourne l’interface **IShellFolder** de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-342">Your extension creates a folder object to represent the root folder and returns the object's **IShellFolder** interface.</span></span> <span data-ttu-id="f3c64-343">Une grande partie du reste de l’interaction entre votre extension et l’Explorateur Windows s’effectue alors via **IShellFolder**.</span><span class="sxs-lookup"><span data-stu-id="f3c64-343">Much of the remainder of the interaction between your extension and Windows Explorer then takes place through **IShellFolder**.</span></span> <span data-ttu-id="f3c64-344">L’Explorateur Windows appelle **IShellFolder** pour effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="f3c64-344">Windows Explorer calls **IShellFolder** to:</span></span>

-   <span data-ttu-id="f3c64-345">Demandez un objet qui peut énumérer le contenu du dossier racine.</span><span class="sxs-lookup"><span data-stu-id="f3c64-345">Request an object that can enumerate the contents of the root folder.</span></span>
-   <span data-ttu-id="f3c64-346">Obtenez différents types d’informations sur le contenu du dossier racine.</span><span class="sxs-lookup"><span data-stu-id="f3c64-346">Obtain various types of information about the contents of the root folder.</span></span>
-   <span data-ttu-id="f3c64-347">Demandez un objet qui expose l’une des interfaces facultatives.</span><span class="sxs-lookup"><span data-stu-id="f3c64-347">Request an object that exposes one of the optional interfaces.</span></span> <span data-ttu-id="f3c64-348">Ces interfaces peuvent ensuite être interrogées pour obtenir des informations supplémentaires, telles que des icônes ou des menus contextuels.</span><span class="sxs-lookup"><span data-stu-id="f3c64-348">Those interfaces can then be queried for additional information, such as icons or shortcut menus.</span></span>
-   <span data-ttu-id="f3c64-349">Demandez un objet dossier qui représente un sous-dossier du dossier racine.</span><span class="sxs-lookup"><span data-stu-id="f3c64-349">Request a folder object that represents a subfolder of the root folder.</span></span>

<span data-ttu-id="f3c64-350">Lorsqu’un utilisateur ouvre un sous-dossier du dossier racine, l’Explorateur Windows appelle [**IShellFolder :: BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject).</span><span class="sxs-lookup"><span data-stu-id="f3c64-350">When a user opens a subfolder of the root folder, Windows Explorer calls [**IShellFolder::BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject).</span></span> <span data-ttu-id="f3c64-351">Votre extension crée et initialise un nouvel objet dossier pour représenter le sous-dossier et retourne son interface [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-351">Your extension creates and initializes a new folder object to represent the subfolder and returns its [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span> <span data-ttu-id="f3c64-352">L’Explorateur Windows appelle ensuite cette interface pour différents types d’informations, et ainsi de suite jusqu’à ce que l’utilisateur décide de naviguer ailleurs dans l’espace de noms de l’interpréteur de commandes ou de fermer l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="f3c64-352">Windows Explorer then calls this interface for various types of information, and so on until the user decides to navigate elsewhere in the Shell namespace or close Windows Explorer.</span></span>

<span data-ttu-id="f3c64-353">Le reste de cette section décrit brièvement les méthodes [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) les plus importantes et comment les implémenter.</span><span class="sxs-lookup"><span data-stu-id="f3c64-353">The remainder of this section briefly discusses the more important [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) methods and how to implement them.</span></span>

### <a name="enumobjects"></a><span data-ttu-id="f3c64-354">EnumObjects</span><span class="sxs-lookup"><span data-stu-id="f3c64-354">EnumObjects</span></span>

<span data-ttu-id="f3c64-355">Avant d’afficher le contenu d’un dossier dans l’arborescence, l’Explorateur Windows doit d’abord déterminer ce que contient le dossier en appelant la méthode [**IShellFolder :: EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-355">Before displaying the contents of a folder in the tree view, Windows Explorer must first determine what the folder contains by calling the [**IShellFolder::EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) method.</span></span> <span data-ttu-id="f3c64-356">Cette méthode crée un objet énumération OLE standard qui expose une interface [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) et retourne ce pointeur d’interface.</span><span class="sxs-lookup"><span data-stu-id="f3c64-356">This method creates a standard OLE enumeration object that exposes an [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) interface and returns that interface pointer.</span></span> <span data-ttu-id="f3c64-357">L’interface **IEnumIDList** permet à l’Explorateur Windows d’obtenir le PIDL de tous les objets contenus dans le dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-357">The **IEnumIDList** interface allows Windows Explorer to obtain the PIDLs of all the objects contained by the folder.</span></span> <span data-ttu-id="f3c64-358">Ces PIDL sont ensuite utilisés pour obtenir des informations sur les objets contenus dans le dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-358">These PIDLs are then used to obtain information about the objects contained by the folder.</span></span> <span data-ttu-id="f3c64-359">Pour plus d’informations, consultez [IEnumIDList interface](#ienumidlist-interface).</span><span class="sxs-lookup"><span data-stu-id="f3c64-359">For further details, see [IEnumIDList Interface](#ienumidlist-interface).</span></span>

> [!Note]  
> <span data-ttu-id="f3c64-360">La méthode [**IEnumIDList :: Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next) ne doit retourner que les PIDL relatifs au dossier parent.</span><span class="sxs-lookup"><span data-stu-id="f3c64-360">The [**IEnumIDList::Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next) method should only return PIDLs that are relative to the parent folder.</span></span> <span data-ttu-id="f3c64-361">Le PIDL doit contenir uniquement la structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) de l’objet, suivie d’un terminateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-361">The PIDL should contain only the object's [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure, followed by a terminator.</span></span>

 

### <a name="createviewobject"></a><span data-ttu-id="f3c64-362">CreateViewObject</span><span class="sxs-lookup"><span data-stu-id="f3c64-362">CreateViewObject</span></span>

<span data-ttu-id="f3c64-363">Avant d’afficher le contenu d’un dossier, l’Explorateur Windows appelle cette méthode pour demander un pointeur vers une interface [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-363">Before the contents of a folder are displayed, Windows Explorer calls this method to request a pointer to an [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="f3c64-364">Cette interface est utilisée par l’Explorateur Windows pour gérer l’affichage des dossiers.</span><span class="sxs-lookup"><span data-stu-id="f3c64-364">This interface is used by Windows Explorer to manage the folder view.</span></span> <span data-ttu-id="f3c64-365">Créez un objet de vue de dossier et retournez son interface **IShellView** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-365">Create a folder view object and return its **IShellView** interface.</span></span>

<span data-ttu-id="f3c64-366">La méthode [**IShellFolder :: CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) est également appelée pour demander l’une des interfaces facultatives, telles que [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu), pour le dossier lui-même.</span><span class="sxs-lookup"><span data-stu-id="f3c64-366">The [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) method is also called to request one of the optional interfaces, such as [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu), for the folder itself.</span></span> <span data-ttu-id="f3c64-367">Votre implémentation de cette méthode doit créer un objet qui expose l’interface demandée et retourne le pointeur d’interface.</span><span class="sxs-lookup"><span data-stu-id="f3c64-367">Your implementation of this method should create an object that exposes the requested interface and returns the interface pointer.</span></span> <span data-ttu-id="f3c64-368">Si l’Explorateur Windows a besoin d’une interface facultative pour l’un des objets contenus dans le dossier, il appellera [**IShellFolder :: GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof).</span><span class="sxs-lookup"><span data-stu-id="f3c64-368">If Windows Explorer needs an optional interface for one of the objects contained by the folder, it will call [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof).</span></span>

### <a name="getuiobjectof"></a><span data-ttu-id="f3c64-369">GetUIObjectOf</span><span class="sxs-lookup"><span data-stu-id="f3c64-369">GetUIObjectOf</span></span>

<span data-ttu-id="f3c64-370">Si les informations de base sur le contenu d’un dossier sont disponibles par le biais des méthodes [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) , votre extension peut également fournir à l’Explorateur Windows différents types d’informations supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="f3c64-370">While basic information about the contents of a folder is available through the [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) methods, your extension can also provide Windows Explorer with various kinds of additional information.</span></span> <span data-ttu-id="f3c64-371">Par exemple, vous pouvez spécifier des icônes pour le contenu d’un dossier ou le menu contextuel d’un objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-371">For instance, you can specify icons for the contents of a folder or an object's shortcut menu.</span></span> <span data-ttu-id="f3c64-372">L’Explorateur Windows appelle la méthode [**IShellFolder :: GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) pour tenter de récupérer des informations supplémentaires sur un objet contenu dans un dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-372">Windows Explorer calls the [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) method to attempt to retrieve additional information about an object that is contained by a folder.</span></span> <span data-ttu-id="f3c64-373">L’Explorateur Windows spécifie l’objet pour lequel il souhaite obtenir des informations, ainsi que l’IID de l’interface appropriée.</span><span class="sxs-lookup"><span data-stu-id="f3c64-373">Windows Explorer specifies which object it wants the information for, and the IID of the relevant interface.</span></span> <span data-ttu-id="f3c64-374">L’objet Folder crée ensuite un objet qui expose l’interface demandée et retourne le pointeur d’interface.</span><span class="sxs-lookup"><span data-stu-id="f3c64-374">The folder object then creates an object that exposes the requested interface and returns the interface pointer.</span></span>

<span data-ttu-id="f3c64-375">Si votre extension permet aux utilisateurs de transférer des objets avec le glisser-déplacer ou le presse-papiers, l’Explorateur Windows appelle [**IShellFolder :: GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) pour demander une interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) ou [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-375">If your extension allows users to transfer objects with drag-and-drop or the clipboard, Windows Explorer will call [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) to request an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) or [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span> <span data-ttu-id="f3c64-376">Pour plus d’informations, consultez [transfert d’objets Shell avec glisser-déplacer et le presse-papiers](dragdrop.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-376">For details, see [Transferring Shell Objects with Drag-and-Drop and the Clipboard](dragdrop.md).</span></span>

<span data-ttu-id="f3c64-377">L’Explorateur Windows appelle [**IShellFolder :: CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) lorsqu’il souhaite obtenir le même type d’informations sur le dossier lui-même.</span><span class="sxs-lookup"><span data-stu-id="f3c64-377">Windows Explorer calls [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) when it wants the same sort of information about the folder itself.</span></span>

### <a name="bindtoobject"></a><span data-ttu-id="f3c64-378">BindToObject</span><span class="sxs-lookup"><span data-stu-id="f3c64-378">BindToObject</span></span>

<span data-ttu-id="f3c64-379">L’Explorateur Windows appelle la méthode [**IShellFolder :: BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) lorsqu’un utilisateur tente d’ouvrir l’un des sous-dossiers de votre extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-379">Windows Explorer calls the [**IShellFolder::BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) method when a user attempts to open one of your extension's subfolders.</span></span> <span data-ttu-id="f3c64-380">Si *riid* a la valeur IID \_ IShellFolder, vous devez créer et initialiser un objet Folder qui représente le sous-dossier et retourner l’interface [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-380">If *riid* is set to IID\_IShellFolder, you should create and initialize a folder object that represents the subfolder and return the object's [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span>

> [!Note]  
> <span data-ttu-id="f3c64-381">À l’heure actuelle, l’Explorateur Windows appelle cette méthode uniquement pour demander une interface [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-381">At present, Windows Explorer calls this method only to request an [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span> <span data-ttu-id="f3c64-382">Toutefois, ne supposez pas que cela sera toujours le cas.</span><span class="sxs-lookup"><span data-stu-id="f3c64-382">However, do not assume that this will always be the case.</span></span> <span data-ttu-id="f3c64-383">Vous devez toujours vérifier la valeur de *riid* avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="f3c64-383">You should always check the value of *riid* before proceeding.</span></span>

 

### <a name="getdisplaynameof"></a><span data-ttu-id="f3c64-384">GetDisplayNameOf</span><span class="sxs-lookup"><span data-stu-id="f3c64-384">GetDisplayNameOf</span></span>

<span data-ttu-id="f3c64-385">L’Explorateur Windows appelle la méthode [**IShellFolder :: GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) pour convertir le PIDL de l’un des objets du dossier en un nom.</span><span class="sxs-lookup"><span data-stu-id="f3c64-385">Windows Explorer calls the [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) method to convert the PIDL of one of the folder's objects into a name.</span></span> <span data-ttu-id="f3c64-386">Ce PIDL doit être relatif au dossier parent de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-386">That PIDL must be relative to the object's parent folder.</span></span> <span data-ttu-id="f3c64-387">En d’autres termes, il doit contenir une seule structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) non null.</span><span class="sxs-lookup"><span data-stu-id="f3c64-387">In other words, it must contain a single non-**NULL** [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure.</span></span> <span data-ttu-id="f3c64-388">Comme il existe plusieurs façons de nommer des objets, l’Explorateur Windows spécifie le type de nom en définissant un ou plusieurs indicateurs [**SHGDNF**](/windows/win32/api/shobjidl_core/ne-shobjidl_core-_shgdnf) dans le paramètre *uFlags* .</span><span class="sxs-lookup"><span data-stu-id="f3c64-388">Because there is more than one possible way to name objects, Windows Explorer specifies the type of name by setting one or more [**SHGDNF**](/windows/win32/api/shobjidl_core/ne-shobjidl_core-_shgdnf) flags in the *uFlags* parameter.</span></span> <span data-ttu-id="f3c64-389">L’une des deux valeurs, **SHGDN \_ normal** ou **SHGDN \_ InFolder**, sera définie pour spécifier si le nom doit être relatif au dossier ou relatif au bureau.</span><span class="sxs-lookup"><span data-stu-id="f3c64-389">One of two values, **SHGDN\_NORMAL** or **SHGDN\_INFOLDER**, will be set to specify whether the name should be relative to the folder or relative to the desktop.</span></span> <span data-ttu-id="f3c64-390">L’une des trois autres valeurs, **SHGDN \_ FOREDITING**, **SHGDN \_ FORADDRESSBAR** ou **SHGDN \_ FORPARSING**, peut être définie pour spécifier ce à quoi le nom sera utilisé.</span><span class="sxs-lookup"><span data-stu-id="f3c64-390">One of the other three values, **SHGDN\_FOREDITING**, **SHGDN\_FORADDRESSBAR**, or **SHGDN\_FORPARSING**, can be set to specify what the name will be used for.</span></span>

<span data-ttu-id="f3c64-391">Vous devez retourner le nom sous la forme d’une structure [**STRRET**](/windows/desktop/api/Shtypes/ns-shtypes-strret) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-391">You must return the name in the form of an [**STRRET**](/windows/desktop/api/Shtypes/ns-shtypes-strret) structure.</span></span> <span data-ttu-id="f3c64-392">Si **SHGDN \_ FOREDITING**, **SHGDN \_ FORADDRESSBAR** et **SHGDN \_ FORPARSING** ne sont pas définis, retourne le nom complet de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-392">If **SHGDN\_FOREDITING**, **SHGDN\_FORADDRESSBAR**, and **SHGDN\_FORPARSING** are not set, return the object's display name.</span></span> <span data-ttu-id="f3c64-393">Si l’indicateur **SHGDN \_ FORPARSING** est défini, l’Explorateur Windows demande un nom d’analyse.</span><span class="sxs-lookup"><span data-stu-id="f3c64-393">If the **SHGDN\_FORPARSING** flag is set, Windows Explorer is requesting a parsing name.</span></span> <span data-ttu-id="f3c64-394">Les noms d’analyse sont passés à [**IShellFolder ::P arsedisplayname**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) pour obtenir le PIDL d’un objet, même s’il peut être localisé un ou plusieurs niveaux sous le dossier actif dans la hiérarchie d’espaces de noms.</span><span class="sxs-lookup"><span data-stu-id="f3c64-394">Parsing names are passed to [**IShellFolder::ParseDisplayName**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) to obtain an object's PIDL, even though it might be located one or more levels below the current folder in the namespace hierarchy.</span></span> <span data-ttu-id="f3c64-395">Par exemple, le nom d’analyse d’un objet de système de fichiers est son chemin d’accès.</span><span class="sxs-lookup"><span data-stu-id="f3c64-395">For example, the parsing name of a file system object is its path.</span></span> <span data-ttu-id="f3c64-396">Vous pouvez transmettre le chemin d’accès complet d’un objet du système de fichiers à la méthode **IShellFolder ::P arsedisplayname** du bureau, et il retourne le PIDL complet de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-396">You can pass the fully qualified path of any object in the file system to the desktop's **IShellFolder::ParseDisplayName** method, and it will return the object's fully qualified PIDL.</span></span>

<span data-ttu-id="f3c64-397">Tandis que les noms d’analyse sont des chaînes de texte, ils n’ont pas nécessairement besoin d’inclure le nom complet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-397">While parsing names are text strings, they do not necessarily have to include the display name.</span></span> <span data-ttu-id="f3c64-398">Vous devez assigner des noms d’analyse en fonction de ce qui fonctionne le plus efficacement quand [**IShellFolder ::P arsedisplayname**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) est appelée.</span><span class="sxs-lookup"><span data-stu-id="f3c64-398">You should assign parsing names based on what will work most efficiently when [**IShellFolder::ParseDisplayName**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) is called.</span></span> <span data-ttu-id="f3c64-399">Par exemple, la plupart des dossiers virtuels de l’interpréteur de commandes ne font pas partie du système de fichiers et n’ont pas de chemin d’accès complet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-399">For instance, many of the Shell's virtual folders are not part of the file system and do not have a fully qualified path.</span></span> <span data-ttu-id="f3c64-400">Au lieu de cela, un GUID est attribué à chaque dossier et le nom d’analyse prend la forme suivante :: {GUID}.</span><span class="sxs-lookup"><span data-stu-id="f3c64-400">Instead, each folder is assigned a GUID and the parsing name takes the form ::{GUID}.</span></span> <span data-ttu-id="f3c64-401">Quel que soit le modèle que vous utilisez, il doit pouvoir « aller-retour » de manière fiable.</span><span class="sxs-lookup"><span data-stu-id="f3c64-401">Regardless of what scheme you use, it should be able to reliably "round trip."</span></span> <span data-ttu-id="f3c64-402">Par exemple, si un appelant passe un nom d’analyse à **IShellFolder ::P arsedisplayname** pour récupérer le PIDL d’un objet, puis passe ce PIDL à [**IShellFolder :: GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) avec l’indicateur **SHGDN \_ FORPARSING** défini, l’appelant doit récupérer le nom d’analyse d’origine.</span><span class="sxs-lookup"><span data-stu-id="f3c64-402">For instance, if a caller passes a parsing name to **IShellFolder::ParseDisplayName** to retrieve an object's PIDL, and then passes that PIDL to [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) with the **SHGDN\_FORPARSING** flag set, the caller should recover the original parsing name.</span></span>

### <a name="getattributesof"></a><span data-ttu-id="f3c64-403">GetAttributesOf</span><span class="sxs-lookup"><span data-stu-id="f3c64-403">GetAttributesOf</span></span>

<span data-ttu-id="f3c64-404">L’Explorateur Windows appelle la méthode [**IShellFolder :: GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) pour déterminer les attributs d’un ou plusieurs éléments contenus dans un objet Folder.</span><span class="sxs-lookup"><span data-stu-id="f3c64-404">Windows Explorer calls the [**IShellFolder::GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) method to determine the attributes of one or more items contained by a folder object.</span></span> <span data-ttu-id="f3c64-405">La valeur de *cidl* indique le nombre d’éléments dans la requête et *aPidl* pointe vers une liste de ses PIDL.</span><span class="sxs-lookup"><span data-stu-id="f3c64-405">The value of *cidl* gives the number of items in the query, and *aPidl* points to a list of their PIDLs.</span></span>

<span data-ttu-id="f3c64-406">Étant donné que le test de certains attributs peut prendre du temps, l’Explorateur Windows limite généralement la requête à un sous-ensemble des indicateurs disponibles en définissant leurs valeurs dans *rfgInOut*.</span><span class="sxs-lookup"><span data-stu-id="f3c64-406">Because testing for some attributes can be time consuming, Windows Explorer typically restricts the query to a subset of the available flags by setting their values in *rfgInOut*.</span></span> <span data-ttu-id="f3c64-407">Votre méthode doit tester uniquement les attributs dont les indicateurs sont définis dans *rfgInOut*.</span><span class="sxs-lookup"><span data-stu-id="f3c64-407">Your method should test for only those attributes whose flags are set in *rfgInOut*.</span></span> <span data-ttu-id="f3c64-408">Laissez les indicateurs valides définis et effacez le reste.</span><span class="sxs-lookup"><span data-stu-id="f3c64-408">Leave the valid flags set and clear the remainder.</span></span> <span data-ttu-id="f3c64-409">Si plusieurs éléments sont inclus dans la requête, définissez uniquement les indicateurs qui s’appliquent à tous les éléments.</span><span class="sxs-lookup"><span data-stu-id="f3c64-409">If more than one item is included in the query, set only those flags that apply to all items.</span></span>

> [!Note]  
> <span data-ttu-id="f3c64-410">Les attributs doivent être correctement définis pour qu’un élément s’affiche correctement.</span><span class="sxs-lookup"><span data-stu-id="f3c64-410">The attributes must be properly set for an item to be correctly displayed.</span></span> <span data-ttu-id="f3c64-411">Par exemple, si un élément est un dossier qui contient des sous-dossiers, vous devez définir l’indicateur **SFGAO \_ HASSUBFOLDER** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-411">For instance, if an item is a folder that contains subfolders, you must set the **SFGAO\_HASSUBFOLDER** flag.</span></span> <span data-ttu-id="f3c64-412">Dans le cas contraire, l’Explorateur Windows n’affichera pas de signe + en regard de l’icône de l’élément dans l’arborescence.</span><span class="sxs-lookup"><span data-stu-id="f3c64-412">Otherwise, Windows Explorer will not display a + next to the item's icon in the tree view.</span></span>

 

### <a name="parsedisplayname"></a><span data-ttu-id="f3c64-413">ParseDisplayName</span><span class="sxs-lookup"><span data-stu-id="f3c64-413">ParseDisplayName</span></span>

<span data-ttu-id="f3c64-414">La méthode [**IShellFolder ::P arsedisplayname**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) est dans une certaine mesure une image miroir de [**IShellFolder :: GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof).</span><span class="sxs-lookup"><span data-stu-id="f3c64-414">The [**IShellFolder::ParseDisplayName**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) method is in some sense a mirror image of [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof).</span></span> <span data-ttu-id="f3c64-415">L’utilisation la plus courante de cette méthode consiste à convertir le nom d’analyse d’un objet en PIDL associé.</span><span class="sxs-lookup"><span data-stu-id="f3c64-415">The most common use of this method is to convert an object's parsing name into the associated PIDL.</span></span> <span data-ttu-id="f3c64-416">Le nom d’analyse peut faire référence à n’importe quel objet qui se trouve sous le dossier dans la hiérarchie d’espaces de noms.</span><span class="sxs-lookup"><span data-stu-id="f3c64-416">The parsing name can refer to any object that lies below the folder in the namespace hierarchy.</span></span> <span data-ttu-id="f3c64-417">Le PIDL retourné est relatif à l’objet Folder qui expose la méthode et n’est généralement pas complet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-417">The returned PIDL is relative to the folder object that exposes the method and is usually not fully qualified.</span></span> <span data-ttu-id="f3c64-418">En d’autres termes, bien que le PIDL puisse contenir plusieurs structures [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) , la première est soit celle de l’objet lui-même, soit le premier sous-dossier du chemin d’accès du dossier à l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-418">In other words, although the PIDL can contain several [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures, the first will either be that of the object itself or the first subfolder in the path from the folder to the object.</span></span> <span data-ttu-id="f3c64-419">L’appelant devra ajouter ce PIDL au PIDL complet du dossier pour obtenir un PIDL qualifié complet pour l’objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-419">The caller will have to append this PIDL to the folder's fully qualified PIDL to obtain a fully qualified PIDL for the object.</span></span>

<span data-ttu-id="f3c64-420">[**IShellFolder ::P arsedisplayname**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) peut également être appelée pour demander les attributs d’un objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-420">[**IShellFolder::ParseDisplayName**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) can also be called to request an object's attributes.</span></span> <span data-ttu-id="f3c64-421">Étant donné que la détermination de tous les attributs applicables peut prendre du temps, l’appelant ne définit que les indicateurs [**SFGAO \_ xxx**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) qui représentent les informations qui intéressent l’appelant.</span><span class="sxs-lookup"><span data-stu-id="f3c64-421">Because determining all the applicable attributes can be time consuming, the caller will set only those [**SFGAO\_XXX**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) flags that represent information that the caller is interested in.</span></span> <span data-ttu-id="f3c64-422">Vous devez déterminer lequel de ces attributs est vrai pour l’objet et effacer les indicateurs restants.</span><span class="sxs-lookup"><span data-stu-id="f3c64-422">You should determine which of those attributes are true for the object, and clear the remaining flags.</span></span>

### <a name="ienumidlist-interface"></a><span data-ttu-id="f3c64-423">Interface IEnumIDList</span><span class="sxs-lookup"><span data-stu-id="f3c64-423">IEnumIDList Interface</span></span>

<span data-ttu-id="f3c64-424">Lorsque l’Explorateur Windows doit énumérer les objets contenus dans un dossier, il appelle [**IShellFolder :: EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects).</span><span class="sxs-lookup"><span data-stu-id="f3c64-424">When Windows Explorer needs to enumerate the objects that are contained by a folder, it calls [**IShellFolder::EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects).</span></span> <span data-ttu-id="f3c64-425">L’objet Folder doit créer un objet d’énumération qui expose l’interface [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) et retourner ce pointeur d’interface.</span><span class="sxs-lookup"><span data-stu-id="f3c64-425">The folder object must create an enumeration object that exposes the [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) interface and return that interface pointer.</span></span> <span data-ttu-id="f3c64-426">L’Explorateur Windows utilise généralement **IEnumIDList** pour énumérer les PIDL de tous les objets contenus dans le dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-426">Windows Explorer will then typically use **IEnumIDList** to enumerate the PIDLs of all the objects contained by the folder.</span></span>

<span data-ttu-id="f3c64-427">[**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) est une interface d’énumération OLE standard et est implémentée de manière habituelle.</span><span class="sxs-lookup"><span data-stu-id="f3c64-427">[**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) is a standard OLE enumeration interface and is implemented in the usual way.</span></span> <span data-ttu-id="f3c64-428">N’oubliez pas, cependant, que le PIDL que vous retournez doit être relatif au dossier et contenir uniquement la structure [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) de l’objet et un terminateur.</span><span class="sxs-lookup"><span data-stu-id="f3c64-428">Remember, however, that the PIDLs that you return must be relative to the folder and contain only the object's [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure and a terminator.</span></span>

## <a name="implementing-the-optional-interfaces"></a><span data-ttu-id="f3c64-429">Implémentation des interfaces facultatives</span><span class="sxs-lookup"><span data-stu-id="f3c64-429">Implementing the Optional Interfaces</span></span>

<span data-ttu-id="f3c64-430">Il existe un certain nombre d’interfaces de Shell facultatives que les objets de dossiers de votre extension peuvent prendre en charge.</span><span class="sxs-lookup"><span data-stu-id="f3c64-430">There are a number of optional Shell interfaces that your extension's folder objects can support.</span></span> <span data-ttu-id="f3c64-431">La plupart d’entre eux, tels que [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona), vous permettent de personnaliser différents aspects de la façon dont l’utilisateur affiche votre extension.</span><span class="sxs-lookup"><span data-stu-id="f3c64-431">Many of them, such as [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona), allow you to customize various aspects of the way the user views your extension.</span></span> <span data-ttu-id="f3c64-432">D’autres, telles que [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject), permettent à votre extension de prendre en charge des fonctionnalités telles que le glisser-déplacer.</span><span class="sxs-lookup"><span data-stu-id="f3c64-432">Others, such as [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject), allow your extension to support features such as drag-and-drop.</span></span>

<span data-ttu-id="f3c64-433">Aucune des interfaces facultatives n’est exposée directement par un objet Folder.</span><span class="sxs-lookup"><span data-stu-id="f3c64-433">None of the optional interfaces are exposed directly by a folder object.</span></span> <span data-ttu-id="f3c64-434">Au lieu de cela, l’Explorateur Windows appelle l’une des deux méthodes [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) pour demander une interface :</span><span class="sxs-lookup"><span data-stu-id="f3c64-434">Instead, Windows Explorer calls one of two [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) methods to request an interface:</span></span>

-   <span data-ttu-id="f3c64-435">L’Explorateur Windows appelle le [**IShellFolder :: GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) d’un objet Folder pour demander une interface pour l’un des objets contenus dans le dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-435">Windows Explorer calls a folder object's [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) to request an interface for one of the objects contained by the folder.</span></span>
-   <span data-ttu-id="f3c64-436">L’Explorateur Windows appelle le [**IShellFolder :: CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) d’un objet Folder pour demander une interface pour le dossier lui-même.</span><span class="sxs-lookup"><span data-stu-id="f3c64-436">Windows Explorer calls a folder object's [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) to request an interface for the folder itself.</span></span>

<span data-ttu-id="f3c64-437">Pour fournir les informations, l’objet Folder crée un objet qui expose l’interface demandée et retourne le pointeur d’interface.</span><span class="sxs-lookup"><span data-stu-id="f3c64-437">To provide the information, the folder object creates an object that exposes the requested interface and returns the interface pointer.</span></span> <span data-ttu-id="f3c64-438">L’Explorateur Windows appelle ensuite cette interface pour récupérer les informations nécessaires.</span><span class="sxs-lookup"><span data-stu-id="f3c64-438">Windows Explorer then calls that interface to retrieve the needed information.</span></span> <span data-ttu-id="f3c64-439">Cette section décrit les interfaces facultatives les plus couramment utilisées.</span><span class="sxs-lookup"><span data-stu-id="f3c64-439">This section discusses the most commonly used optional interfaces.</span></span>

### <a name="iextracticon"></a><span data-ttu-id="f3c64-440">IExtractIcon</span><span class="sxs-lookup"><span data-stu-id="f3c64-440">IExtractIcon</span></span>

<span data-ttu-id="f3c64-441">L’Explorateur Windows demande une interface [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) avant d’afficher le contenu d’un dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-441">Windows Explorer requests an [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) interface before it displays the contents of a folder.</span></span> <span data-ttu-id="f3c64-442">L’interface permet à votre extension de spécifier des icônes personnalisées pour les objets contenus dans le dossier.</span><span class="sxs-lookup"><span data-stu-id="f3c64-442">The interface allows your extension to specify custom icons for the objects that are contained by the folder.</span></span> <span data-ttu-id="f3c64-443">Dans le cas contraire, les icônes de fichier et de dossier standard seront utilisées.</span><span class="sxs-lookup"><span data-stu-id="f3c64-443">Otherwise, the standard file and folder icons will be used.</span></span> <span data-ttu-id="f3c64-444">Pour fournir une icône personnalisée, créez un objet d’extraction d’icône qui expose **IExtractIcon** et retournez un pointeur vers cette interface.</span><span class="sxs-lookup"><span data-stu-id="f3c64-444">To provide a custom icon, create an icon extraction object that exposes **IExtractIcon** and return a pointer to that interface.</span></span> <span data-ttu-id="f3c64-445">Pour plus d’informations, consultez la documentation de référence **IExtractIcon** ou [création de gestionnaires d’icône](./how-to-create-icon-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-445">For further discussion, see the **IExtractIcon** reference documentation or [Creating Icon Handlers](./how-to-create-icon-handlers.md).</span></span>

### <a name="icontextmenu"></a><span data-ttu-id="f3c64-446">IContextMenu</span><span class="sxs-lookup"><span data-stu-id="f3c64-446">IContextMenu</span></span>

<span data-ttu-id="f3c64-447">Quand un utilisateur clique avec le bouton droit sur un objet, l’Explorateur Windows demande une interface [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-447">When a user right-clicks an object, Windows Explorer requests an [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) interface.</span></span> <span data-ttu-id="f3c64-448">Pour fournir des menus contextuels pour vos objets, créez un objet gestionnaire de menus et retournez son interface **IContextMenu** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-448">To provide shortcut menus for your objects, create a menu handler object and return its **IContextMenu** interface.</span></span>

<span data-ttu-id="f3c64-449">Les procédures de création d’un objet gestionnaire de menus sont très similaires à celles utilisées pour créer une extension de Shell de gestionnaire de menu.</span><span class="sxs-lookup"><span data-stu-id="f3c64-449">The procedures for creating a menu handler object are very similar to those used to create a menu handler Shell extension.</span></span> <span data-ttu-id="f3c64-450">Pour plus d’informations, consultez [création de gestionnaires de menus contextuels](context-menu-handlers.md) ou référence [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu), [**IContextMenu2**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icontextmenu2)ou [**IContextMenu3**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icontextmenu3) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-450">For details, see [Creating Context Menu Handlers](context-menu-handlers.md) or the [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu), [**IContextMenu2**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icontextmenu2), or [**IContextMenu3**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icontextmenu3) reference.</span></span>

### <a name="iqueryinfo"></a><span data-ttu-id="f3c64-451">IQueryInfo</span><span class="sxs-lookup"><span data-stu-id="f3c64-451">IQueryInfo</span></span>

<span data-ttu-id="f3c64-452">L’Explorateur Windows appelle l’interface [**IQueryInfo**](/windows/win32/api/shlobj_core/nn-shlobj_core-iqueryinfo) pour récupérer une chaîne de texte info-bulle.</span><span class="sxs-lookup"><span data-stu-id="f3c64-452">Windows Explorer calls the [**IQueryInfo**](/windows/win32/api/shlobj_core/nn-shlobj_core-iqueryinfo) interface to retrieve an infotip text string.</span></span>

### <a name="idataobject-and-idroptarget"></a><span data-ttu-id="f3c64-453">IDataObject et IDropTarget</span><span class="sxs-lookup"><span data-stu-id="f3c64-453">IDataObject and IDropTarget</span></span>

<span data-ttu-id="f3c64-454">Lorsque vos objets sont affichés par l’Explorateur Windows, un objet dossier n’a aucune façon directe de savoir quand un utilisateur tente de couper, copier ou faire glisser un objet.</span><span class="sxs-lookup"><span data-stu-id="f3c64-454">When your objects are displayed by Windows Explorer, a folder object has no direct way to know when a user is attempting to cut, copy, or drag an object.</span></span> <span data-ttu-id="f3c64-455">Au lieu de cela, l’Explorateur Windows demande une interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-455">Instead, Windows Explorer requests an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="f3c64-456">Pour autoriser le transfert de l’objet, créez un objet de données et retournez un pointeur vers son interface **IDataObject** .</span><span class="sxs-lookup"><span data-stu-id="f3c64-456">To allow the object to be transferred, create a data object and return a pointer to its **IDataObject** interface.</span></span>

<span data-ttu-id="f3c64-457">De même, un utilisateur peut tenter de supprimer un objet de données dans une représentation de l’Explorateur Windows de l’un de vos objets, par exemple une icône ou un chemin d’accès à la barre d’adresses.</span><span class="sxs-lookup"><span data-stu-id="f3c64-457">Similarly, a user might attempt to drop a data object on a Windows Explorer representation of one of your objects, such as an icon or address bar path.</span></span> <span data-ttu-id="f3c64-458">L’Explorateur Windows demande ensuite une interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) .</span><span class="sxs-lookup"><span data-stu-id="f3c64-458">Windows Explorer then requests an [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span> <span data-ttu-id="f3c64-459">Pour autoriser la suppression de l’objet de données, créez un objet qui expose une interface **IDropTarget** et retournez le pointeur d’interface.</span><span class="sxs-lookup"><span data-stu-id="f3c64-459">To allow the data object to be dropped, create an object that exposes an **IDropTarget** interface and return the interface pointer.</span></span>

<span data-ttu-id="f3c64-460">Le traitement du transfert de données est l’un des aspects les plus délicats de l’écriture d’extensions d’espace de noms.</span><span class="sxs-lookup"><span data-stu-id="f3c64-460">Handling data transfer is one of the trickier aspects of writing namespace extensions.</span></span> <span data-ttu-id="f3c64-461">Pour une présentation détaillée, consultez [transfert d’objets Shell avec glisser-déplacer et le presse-papiers](dragdrop.md).</span><span class="sxs-lookup"><span data-stu-id="f3c64-461">For a detailed discussion, see [Transferring Shell Objects with Drag-and-Drop and the Clipboard](dragdrop.md).</span></span>

## <a name="working-with-the-default-shell-folder-view-implementation"></a><span data-ttu-id="f3c64-462">Utilisation de l’implémentation de l’affichage des dossiers shell par défaut</span><span class="sxs-lookup"><span data-stu-id="f3c64-462">Working With the Default Shell Folder View Implementation</span></span>

<span data-ttu-id="f3c64-463">Les sources de données qui utilisent l’objet DefView (Shell Folder View) par défaut doivent implémenter les interfaces suivantes :</span><span class="sxs-lookup"><span data-stu-id="f3c64-463">Data sources that use the default Shell folder view object (DefView) must implement these interfaces:</span></span>

-   [<span data-ttu-id="f3c64-464">**IShellFolder**</span><span class="sxs-lookup"><span data-stu-id="f3c64-464">**IShellFolder**</span></span>](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder)
-   [<span data-ttu-id="f3c64-465">**IShellFolder2**</span><span class="sxs-lookup"><span data-stu-id="f3c64-465">**IShellFolder2**</span></span>](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellfolder2)
-   [<span data-ttu-id="f3c64-466">**IPersistFolder**</span><span class="sxs-lookup"><span data-stu-id="f3c64-466">**IPersistFolder**</span></span>](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder)
-   [<span data-ttu-id="f3c64-467">**IPersistFolder2**</span><span class="sxs-lookup"><span data-stu-id="f3c64-467">**IPersistFolder2**</span></span>](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder2)

<span data-ttu-id="f3c64-468">Si vous le souhaitez, ils peuvent également implémenter [**IPersistFolder3**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder3).</span><span class="sxs-lookup"><span data-stu-id="f3c64-468">Optionally, they can also implement [**IPersistFolder3**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder3).</span></span>

 

 
