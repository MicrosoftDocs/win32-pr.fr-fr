---
description: La fonction de rappel CPlApplet traite tous les messages envoyés à un élément du panneau de configuration par Windows. Les messages envoyés à la fonction sont dans un ordre spécifique. Par le même jeton, l’élément. cpl exige que les messages soient traités de manière spécifique.
ms.assetid: 70302698-f9d5-4de4-a662-4815002eea52
title: Traitement des messages du panneau de configuration
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0b8b43c6e265030279a6644547f41e3630208325
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103952539"
---
# <a name="control-panel-message-processing"></a><span data-ttu-id="f2bb0-105">Traitement des messages du panneau de configuration</span><span class="sxs-lookup"><span data-stu-id="f2bb0-105">Control Panel Message Processing</span></span>

<span data-ttu-id="f2bb0-106">La fonction de rappel [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) traite tous les messages envoyés à un élément du panneau de configuration par Windows.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-106">The [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) callback function processes all messages sent to a Control Panel item by Windows.</span></span> <span data-ttu-id="f2bb0-107">Les messages envoyés à la fonction sont dans un ordre spécifique.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-107">Messages sent to the function are in a specific order.</span></span> <span data-ttu-id="f2bb0-108">Par le même jeton, l’élément. cpl exige que les messages soient traités de manière spécifique.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-108">By the same token, the .cpl item requires the messages to be processed in a specific way.</span></span>

<span data-ttu-id="f2bb0-109">Tout d’abord, la fonction [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) reçoit le message d’initialisation de cpl \_ lorsque Windows charge pour la première fois l’élément du panneau de configuration.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-109">First, the [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function receives the CPL\_INIT message when Windows first loads the Control Panel item.</span></span> <span data-ttu-id="f2bb0-110">La fonction doit effectuer toute initialisation, telle que l’allocation de mémoire, et retourner une valeur différente de zéro.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-110">The function should carry out any initialization, such as allocating memory, and return nonzero.</span></span> <span data-ttu-id="f2bb0-111">Si **CPlApplet** ne peut pas terminer l’initialisation, il doit retourner zéro, en dirigeant les fenêtres pour terminer la communication et libérer la dll.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-111">If **CPlApplet** cannot complete the initialization, it must return zero, directing Windows to terminate communication and release the DLL.</span></span>

<span data-ttu-id="f2bb0-112">Ensuite, si le message d’initialisation de CPL \_ a réussi, Windows envoie le \_ message Cpl GETCOUNT.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-112">Next, if the CPL\_INIT message succeeded, Windows sends the CPL\_GETCOUNT message.</span></span> <span data-ttu-id="f2bb0-113">La fonction doit ensuite retourner le nombre d’éléments du panneau de configuration pris en charge par le fichier. dll.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-113">The function must then return the number of Control Panel items supported by the .dll file.</span></span>

<span data-ttu-id="f2bb0-114">La fonction [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) reçoit alors un message \_ de recherche cpl et un \_ message NEWINQUIRE CPL pour chaque élément du panneau de configuration pris en charge par le fichier. dll.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-114">The [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function then receives one CPL\_INQUIRE message and one CPL\_NEWINQUIRE message for each Control Panel item supported by the .dll file.</span></span> <span data-ttu-id="f2bb0-115">La fonction remplit une structure [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) ou [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) avec des informations sur votre élément, telles que son nom, son icône et une chaîne descriptive.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-115">The function fills in a [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure with information about your item, such as its name, icon, and a descriptive string.</span></span> <span data-ttu-id="f2bb0-116">La plupart des applications doivent traiter le message de recherche de CPL \_ et ignorer le \_ message NEWINQUIRE cpl.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-116">Most applications should process the CPL\_INQUIRE message and ignore the CPL\_NEWINQUIRE message.</span></span> <span data-ttu-id="f2bb0-117">Le \_ message de recherche de cpl fournit des informations dans un format que Windows peut mettre en cache, ce qui améliore considérablement les performances.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-117">The CPL\_INQUIRE message provides information in a form that Windows can cache, which results in much better performance.</span></span> <span data-ttu-id="f2bb0-118">Le \_ message NEWINQUIRE cpl est utilisé uniquement si vous devez modifier l’icône de l’élément ou afficher des chaînes en fonction de l’état de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-118">The CPL\_NEWINQUIRE message is used only if you need to change your item's icon or display strings based on the state of the computer.</span></span> <span data-ttu-id="f2bb0-119">Les éléments du panneau de configuration qui utilisent CPL \_ NEWINQUIRE sont introuvables par une recherche dans le menu **Démarrer** dans Windows Vista, car ils s’appuient sur la mise en cache.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-119">Control Panel items that use CPL\_NEWINQUIRE cannot be found by a **Start** menu search in Windows Vista because it relies on caching.</span></span>

<span data-ttu-id="f2bb0-120">La fonction [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) reçoit ensuite un \_ message DBLCLK Cpl comme une notification indiquant que l’utilisateur a choisi l’icône qui représente l’élément du panneau de configuration.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-120">The [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function next receives a CPL\_DBLCLK message as a notification that the user has chosen the icon that represents the Control Panel item.</span></span> <span data-ttu-id="f2bb0-121">La fonction peut recevoir ce message autant de fois que vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-121">The function might receive this message any number of times.</span></span> <span data-ttu-id="f2bb0-122">Le message comprend l’identificateur d’élément et le pointeur **lpData** retourné dans la [**structure CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) ou [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) lors de l’appel à [**Cpl \_ inquire**](cpl-inquire.md) ou [**Cpl \_ NEWINQUIRE**](cpl-newinquire.md).</span><span class="sxs-lookup"><span data-stu-id="f2bb0-122">The message includes the item identifier and the **lpData** pointer returned in the [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure in the call to [**CPL\_INQUIRE**](cpl-inquire.md) or [**CPL\_NEWINQUIRE**](cpl-newinquire.md).</span></span> <span data-ttu-id="f2bb0-123">La fonction doit afficher la boîte de dialogue correspondante et traiter l’entrée d’utilisateur suivante.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-123">The function should display the corresponding dialog box and process subsequent user input.</span></span>

<span data-ttu-id="f2bb0-124">Outre CPL \_ DBLCLK, le \_ message Cpl STARTWPARMS peut être envoyé si un élément du panneau de configuration est appelé avec des paramètres d’entrée, par exemple à partir d’une invite de commandes ou d’un autre programme.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-124">Besides CPL\_DBLCLK, the CPL\_STARTWPARMS message can be sent if a Control Panel item is invoked with input parameters, such as from a command prompt or from another program.</span></span> <span data-ttu-id="f2bb0-125">Le message comprend l’identificateur d’élément avec la chaîne de paramètre supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-125">The message includes the item identifier along with the additional parameter string.</span></span>

<span data-ttu-id="f2bb0-126">Avant la fin de l’application de contrôle, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) reçoit le \_ message d’arrêt Cpl une fois pour chaque élément du panneau de configuration pris en charge par le fichier. dll.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-126">Before the controlling application terminates, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) receives the CPL\_STOP message once for each Control Panel item supported by the .dll file.</span></span> <span data-ttu-id="f2bb0-127">Le message comprend l’identificateur de l’élément du panneau de configuration et le pointeur **lpData** retournés dans la structure [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) ou [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) dans l’appel à [**Cpl \_ inquire**](cpl-inquire.md) ou [**Cpl \_ NEWINQUIRE**](cpl-newinquire.md).</span><span class="sxs-lookup"><span data-stu-id="f2bb0-127">The message includes the identifier for the Control Panel item and the **lpData** pointer returned in the [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure in the call to [**CPL\_INQUIRE**](cpl-inquire.md) or [**CPL\_NEWINQUIRE**](cpl-newinquire.md).</span></span> <span data-ttu-id="f2bb0-128">La fonction doit libérer la mémoire qu’elle a allouée pour la boîte de dialogue spécifiée.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-128">The function should free any memory that it allocated for the specified dialog box.</span></span>

<span data-ttu-id="f2bb0-129">Après le dernier \_ message d’arrêt de cpl, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) reçoit un message de \_ sortie cpl.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-129">After the last CPL\_STOP message, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) receives a CPL\_EXIT message.</span></span> <span data-ttu-id="f2bb0-130">La fonction doit libérer toute la mémoire allouée restante et annuler l’inscription des classes de fenêtres privées qu’elle peut avoir inscrites.</span><span class="sxs-lookup"><span data-stu-id="f2bb0-130">The function should free all remaining allocated memory and unregister any private window classes that it might have registered.</span></span> <span data-ttu-id="f2bb0-131">Immédiatement après le retour de la fonction à partir de ce message, Windows libère l’élément du panneau de configuration en appelant la fonction [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) .</span><span class="sxs-lookup"><span data-stu-id="f2bb0-131">Immediately after the function returns from this message, Windows releases the Control Panel item by calling the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f2bb0-132">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="f2bb0-132">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f2bb0-133">Éléments du panneau de configuration</span><span class="sxs-lookup"><span data-stu-id="f2bb0-133">Control Panel Items</span></span>](control-panel-applications.md)
</dt> <dt>

[<span data-ttu-id="f2bb0-134">Conseils sur l’expérience utilisateur</span><span class="sxs-lookup"><span data-stu-id="f2bb0-134">User Experience Guidelines</span></span>](user-experience-guidelines.md)
</dt> <dt>

[<span data-ttu-id="f2bb0-135">Inscription des éléments du panneau de configuration</span><span class="sxs-lookup"><span data-stu-id="f2bb0-135">Registering Control Panel Items</span></span>](registering-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="f2bb0-136">Utilisation de CPLApplet</span><span class="sxs-lookup"><span data-stu-id="f2bb0-136">Using CPLApplet</span></span>](using-cplapplet.md)
</dt> <dt>

[<span data-ttu-id="f2bb0-137">Exécution des éléments du panneau de configuration</span><span class="sxs-lookup"><span data-stu-id="f2bb0-137">Executing Control Panel Items</span></span>](executing-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="f2bb0-138">Extension des éléments du panneau de configuration système</span><span class="sxs-lookup"><span data-stu-id="f2bb0-138">Extending System Control Panel Items</span></span>](extending-system-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="f2bb0-139">Affectation des catégories du panneau de configuration</span><span class="sxs-lookup"><span data-stu-id="f2bb0-139">Assigning Control Panel Categories</span></span>](assigning-control-panel-categories.md)
</dt> <dt>

[<span data-ttu-id="f2bb0-140">Création de liens de tâches pouvant faire l’objet d’une recherche pour un élément du panneau de configuration</span><span class="sxs-lookup"><span data-stu-id="f2bb0-140">Creating Searchable Task Links for a Control Panel Item</span></span>](creating-searchable-task-links.md)
</dt> <dt>

[<span data-ttu-id="f2bb0-141">Accès au panneau de configuration en mode sans échec sous Windows Vista</span><span class="sxs-lookup"><span data-stu-id="f2bb0-141">Accessing the Control Panel in Safe Mode under Windows Vista</span></span>](accessing-the-cp-in-safe-mode-under-vista.md)
</dt> </dl>

 

 
