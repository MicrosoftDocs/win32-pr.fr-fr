---
description: Cette rubrique décrit les interfaces et les méthodes spécifiques requises pour créer un gestionnaire d’aperçus.
ms.assetid: 6c240a63-c184-4b65-9483-794f5de4d695
title: Génération de gestionnaires d’aperçus
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a309873cf082071d5f426ce0ba6d039107c59665
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104318117"
---
# <a name="building-preview-handlers"></a><span data-ttu-id="14d58-103">Génération de gestionnaires d’aperçus</span><span class="sxs-lookup"><span data-stu-id="14d58-103">Building Preview Handlers</span></span>

<span data-ttu-id="14d58-104">Cette rubrique décrit les interfaces et les méthodes spécifiques requises pour créer un gestionnaire d’aperçus.</span><span class="sxs-lookup"><span data-stu-id="14d58-104">This topic discusses the specific interfaces and methods required to create a preview handler.</span></span>

<span data-ttu-id="14d58-105">Un gestionnaire d’aperçus doit implémenter les interfaces suivantes :</span><span class="sxs-lookup"><span data-stu-id="14d58-105">A preview handler must implement the following interfaces:</span></span>

-   <span data-ttu-id="14d58-106">[IInitializeWithStream :: Initialize](#iinitializewithstreaminitialize) (fortement préféré), [**IInitializeWithFile**](/windows/desktop/api/Propsys/nn-propsys-iinitializewithfile)ou [**IInitializeWithItem**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iinitializewithitem)</span><span class="sxs-lookup"><span data-stu-id="14d58-106">[IInitializeWithStream::Initialize](#iinitializewithstreaminitialize) (strongly preferred), [**IInitializeWithFile**](/windows/desktop/api/Propsys/nn-propsys-iinitializewithfile), or [**IInitializeWithItem**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iinitializewithitem)</span></span>
-   [<span data-ttu-id="14d58-107">IObjectWithSite</span><span class="sxs-lookup"><span data-stu-id="14d58-107">IObjectWithSite</span></span>](#iobjectwithsite)
-   [<span data-ttu-id="14d58-108">IOleWindow</span><span class="sxs-lookup"><span data-stu-id="14d58-108">IOleWindow</span></span>](#iolewindow)
-   [<span data-ttu-id="14d58-109">IPreviewHandler</span><span class="sxs-lookup"><span data-stu-id="14d58-109">IPreviewHandler</span></span>](#ipreviewhandler)

<span data-ttu-id="14d58-110">Si votre gestionnaire d’aperçus prend en charge les paramètres visuels fournis par l’hôte, tels que la couleur d’arrière-plan et la police, il doit également implémenter l’interface suivante :</span><span class="sxs-lookup"><span data-stu-id="14d58-110">If your preview handler supports visual settings provided by the host such as background color and font, it must also implement the following interface:</span></span>

-   [<span data-ttu-id="14d58-111">IPreviewHandlerVisuals</span><span class="sxs-lookup"><span data-stu-id="14d58-111">IPreviewHandlerVisuals</span></span>](#ipreviewhandlervisuals)

<span data-ttu-id="14d58-112">Cette rubrique suppose que le gestionnaire d’aperçus est initialisé avec un flux et qu’il est inscrit pour une extension de nom de fichier particulière.</span><span class="sxs-lookup"><span data-stu-id="14d58-112">This topic assumes that the preview handler is initialized with a stream and is registered for a particular file name extension.</span></span>

## <a name="iinitializewithstreaminitialize"></a><span data-ttu-id="14d58-113">IInitializeWithStream :: Initialize</span><span class="sxs-lookup"><span data-stu-id="14d58-113">IInitializeWithStream::Initialize</span></span>

<span data-ttu-id="14d58-114">Stockez les paramètres [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) et mode afin de pouvoir lire les données de l’élément lorsque vous êtes prêt à afficher un aperçu de l’élément.</span><span class="sxs-lookup"><span data-stu-id="14d58-114">Store the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) and mode parameters so that you can read the item's data when you are ready to preview the item.</span></span> <span data-ttu-id="14d58-115">Ne chargez pas les données dans [**Initialize**](/windows/desktop/api/Propsys/nf-propsys-iinitializewithstream-initialize).</span><span class="sxs-lookup"><span data-stu-id="14d58-115">Do not load the data in [**Initialize**](/windows/desktop/api/Propsys/nf-propsys-iinitializewithstream-initialize).</span></span> <span data-ttu-id="14d58-116">Chargez les données dans [**IPreviewHandler ::D opreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) juste avant le rendu.</span><span class="sxs-lookup"><span data-stu-id="14d58-116">Load the data in [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) just before you render.</span></span>

## <a name="iobjectwithsite"></a><span data-ttu-id="14d58-117">IObjectWithSite</span><span class="sxs-lookup"><span data-stu-id="14d58-117">IObjectWithSite</span></span>

-   [<span data-ttu-id="14d58-118">IObjectWithSite :: SetSite</span><span class="sxs-lookup"><span data-stu-id="14d58-118">IObjectWithSite::SetSite</span></span>](#iobjectwithsitesetsite)
-   [<span data-ttu-id="14d58-119">IObjectWithSite :: GetSite</span><span class="sxs-lookup"><span data-stu-id="14d58-119">IObjectWithSite::GetSite</span></span>](#iobjectwithsitegetsite)

### <a name="iobjectwithsitesetsite"></a><span data-ttu-id="14d58-120">IObjectWithSite :: SetSite</span><span class="sxs-lookup"><span data-stu-id="14d58-120">IObjectWithSite::SetSite</span></span>

<span data-ttu-id="14d58-121">Stocke le pointeur [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pour un accès ultérieur.</span><span class="sxs-lookup"><span data-stu-id="14d58-121">Store the [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer for later access.</span></span>

<span data-ttu-id="14d58-122">Si vous avez actuellement une référence à un objet [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) , libérez-le.</span><span class="sxs-lookup"><span data-stu-id="14d58-122">If you currently have a reference to an [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) object, release it.</span></span> <span data-ttu-id="14d58-123">Utilisez le pointeur [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) stocké pour appeler [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) sur le site pour une nouvelle référence **IPreviewHandlerFrame** .</span><span class="sxs-lookup"><span data-stu-id="14d58-123">Use the stored [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer to call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on the site for a new **IPreviewHandlerFrame** reference.</span></span>

<span data-ttu-id="14d58-124">Si vous disposez actuellement d’une table d’accélérateurs, détruisez-la.</span><span class="sxs-lookup"><span data-stu-id="14d58-124">If you currently have an accelerator table, destroy it.</span></span> <span data-ttu-id="14d58-125">Appelez [**IPreviewHandlerFrame :: GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext) pour obtenir une nouvelle table d’accélérateurs.</span><span class="sxs-lookup"><span data-stu-id="14d58-125">Call [**IPreviewHandlerFrame::GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext) to get a new accelerator table.</span></span> <span data-ttu-id="14d58-126">Stockez cette table.</span><span class="sxs-lookup"><span data-stu-id="14d58-126">Store this table.</span></span> <span data-ttu-id="14d58-127">Notez qu’il est utilisé uniquement comme une liste de touches accélérateur prises en charge par le frame.</span><span class="sxs-lookup"><span data-stu-id="14d58-127">Note that it is used only as a list of accelerator keys that the frame supports.</span></span> <span data-ttu-id="14d58-128">Les commandes dans les entrées d’accélérateur sont ignorées.</span><span class="sxs-lookup"><span data-stu-id="14d58-128">Commands in the accelerator entries are ignored.</span></span>

### <a name="iobjectwithsitegetsite"></a><span data-ttu-id="14d58-129">IObjectWithSite :: GetSite</span><span class="sxs-lookup"><span data-stu-id="14d58-129">IObjectWithSite::GetSite</span></span>

<span data-ttu-id="14d58-130">Retourne le pointeur de site, quelle que soit la façon dont il est.</span><span class="sxs-lookup"><span data-stu-id="14d58-130">Return the site pointer, whatever it is.</span></span>

## <a name="iolewindow"></a><span data-ttu-id="14d58-131">IOleWindow</span><span class="sxs-lookup"><span data-stu-id="14d58-131">IOleWindow</span></span>

-   [<span data-ttu-id="14d58-132">IOleWindow::ContextSensitiveHelp</span><span class="sxs-lookup"><span data-stu-id="14d58-132">IOleWindow::ContextSensitiveHelp</span></span>](#iolewindowcontextsensitivehelp)
-   [<span data-ttu-id="14d58-133">IOleWindow::GetWindow</span><span class="sxs-lookup"><span data-stu-id="14d58-133">IOleWindow::GetWindow</span></span>](#iolewindowgetwindow)

### <a name="iolewindowcontextsensitivehelp"></a><span data-ttu-id="14d58-134">IOleWindow::ContextSensitiveHelp</span><span class="sxs-lookup"><span data-stu-id="14d58-134">IOleWindow::ContextSensitiveHelp</span></span>

<span data-ttu-id="14d58-135">Retournez E \_ NOTIMPL pour cette méthode.</span><span class="sxs-lookup"><span data-stu-id="14d58-135">Return E\_NOTIMPL for this method.</span></span>

### <a name="iolewindowgetwindow"></a><span data-ttu-id="14d58-136">IOleWindow::GetWindow</span><span class="sxs-lookup"><span data-stu-id="14d58-136">IOleWindow::GetWindow</span></span>

<span data-ttu-id="14d58-137">Si la fenêtre du gestionnaire d’aperçus existe actuellement, retournez le **HWND** de cette fenêtre et s \_ OK.</span><span class="sxs-lookup"><span data-stu-id="14d58-137">If the preview handler's window currently exists, return the **HWND** of that window and S\_OK.</span></span> <span data-ttu-id="14d58-138">Si la fenêtre n’existe pas, retournez E \_ Fail.</span><span class="sxs-lookup"><span data-stu-id="14d58-138">If the window does not exist, return E\_FAIL.</span></span>

## <a name="ipreviewhandler"></a><span data-ttu-id="14d58-139">IPreviewHandler</span><span class="sxs-lookup"><span data-stu-id="14d58-139">IPreviewHandler</span></span>

-   [<span data-ttu-id="14d58-140">IPreviewHandler :: SetWindow</span><span class="sxs-lookup"><span data-stu-id="14d58-140">IPreviewHandler::SetWindow</span></span>](#ipreviewhandlersetwindow)
-   [<span data-ttu-id="14d58-141">IPreviewHandler :: SetRect</span><span class="sxs-lookup"><span data-stu-id="14d58-141">IPreviewHandler::SetRect</span></span>](#ipreviewhandlersetrect)
-   [<span data-ttu-id="14d58-142">IPreviewHandler ::D oPreview</span><span class="sxs-lookup"><span data-stu-id="14d58-142">IPreviewHandler::DoPreview</span></span>](#ipreviewhandlerdopreview)
-   [<span data-ttu-id="14d58-143">IPreviewHandler :: SetFocus</span><span class="sxs-lookup"><span data-stu-id="14d58-143">IPreviewHandler::SetFocus</span></span>](#ipreviewhandlersetfocus)
-   [<span data-ttu-id="14d58-144">IPreviewHandler :: QueryFocus</span><span class="sxs-lookup"><span data-stu-id="14d58-144">IPreviewHandler::QueryFocus</span></span>](#ipreviewhandlerqueryfocus)
-   [<span data-ttu-id="14d58-145">IPreviewHandler :: TranslateAccelerator</span><span class="sxs-lookup"><span data-stu-id="14d58-145">IPreviewHandler::TranslateAccelerator</span></span>](#ipreviewhandlertranslateaccelerator)
-   [<span data-ttu-id="14d58-146">IPreviewHandler :: Unload</span><span class="sxs-lookup"><span data-stu-id="14d58-146">IPreviewHandler::Unload</span></span>](#ipreviewhandlerunload)

### <a name="ipreviewhandlersetwindow"></a><span data-ttu-id="14d58-147">IPreviewHandler :: SetWindow</span><span class="sxs-lookup"><span data-stu-id="14d58-147">IPreviewHandler::SetWindow</span></span>

<span data-ttu-id="14d58-148">Définissez le paramètre *HWND* de cette méthode sur le parent du **HWND** du gestionnaire d’aperçus.</span><span class="sxs-lookup"><span data-stu-id="14d58-148">Set the *hwnd* parameter of this method to the parent of your preview handler's **HWND**.</span></span> <span data-ttu-id="14d58-149">Cette méthode peut être appelée plusieurs fois.</span><span class="sxs-lookup"><span data-stu-id="14d58-149">This method can be called multiple times.</span></span> <span data-ttu-id="14d58-150">Redimensionnez votre Aperçu afin qu’il s’affiche uniquement dans la zone décrite par le paramètre *PRC* .</span><span class="sxs-lookup"><span data-stu-id="14d58-150">Resize your preview so that it renders only in the area described by the *prc* parameter.</span></span>

<span data-ttu-id="14d58-151">Si le générateur d’aperçu est en cours de rendu, utilisez la méthode [**IPreviewHandler :: SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) pour modifier le parent du générateur d’aperçu.</span><span class="sxs-lookup"><span data-stu-id="14d58-151">If the previewer is in the process of rendering, use the [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) method to change the parent of the previewer.</span></span> <span data-ttu-id="14d58-152">Modifiez également la zone de rendu du générateur d’aperçu.</span><span class="sxs-lookup"><span data-stu-id="14d58-152">Also change the area in which the previewer is rendering.</span></span>

### <a name="ipreviewhandlersetrect"></a><span data-ttu-id="14d58-153">IPreviewHandler :: SetRect</span><span class="sxs-lookup"><span data-stu-id="14d58-153">IPreviewHandler::SetRect</span></span>

<span data-ttu-id="14d58-154">Redimensionnez votre Aperçu afin qu’il s’affiche uniquement dans la zone décrite par la *PRC* de cette méthode.</span><span class="sxs-lookup"><span data-stu-id="14d58-154">Resize your preview so that it only renders in the area described by this method's *prc*.</span></span>

<span data-ttu-id="14d58-155">Si le générateur d’aperçu est en cours de rendu, modifiez la zone dans laquelle votre générateur d’aperçu effectue le rendu.</span><span class="sxs-lookup"><span data-stu-id="14d58-155">If the previewer is in the process of rendering, change the area in which your previewer renders.</span></span>

### <a name="ipreviewhandlerdopreview"></a><span data-ttu-id="14d58-156">IPreviewHandler ::D oPreview</span><span class="sxs-lookup"><span data-stu-id="14d58-156">IPreviewHandler::DoPreview</span></span>

<span data-ttu-id="14d58-157">C’est là que le véritable travail est effectué.</span><span class="sxs-lookup"><span data-stu-id="14d58-157">This is where the real work is done.</span></span> <span data-ttu-id="14d58-158">Dans la mesure où un aperçu est dynamique, le contenu de l’aperçu doit être chargé uniquement lorsque cela est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="14d58-158">Since a preview is dynamic, the preview content should only be loaded when it is needed.</span></span> <span data-ttu-id="14d58-159">Ne chargez pas le contenu dans l’initialisation.</span><span class="sxs-lookup"><span data-stu-id="14d58-159">Do not load content in the initialization.</span></span>

<span data-ttu-id="14d58-160">Si la fenêtre du gestionnaire d’aperçus n’existe pas, créez-la.</span><span class="sxs-lookup"><span data-stu-id="14d58-160">If the preview handler window does not exist, create it.</span></span> <span data-ttu-id="14d58-161">Les fenêtres de votre gestionnaire d’aperçus doivent être les enfants de la fenêtre fournie par [**IPreviewHandler :: SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow).</span><span class="sxs-lookup"><span data-stu-id="14d58-161">Your preview handler's windows should be children of the window provided by [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow).</span></span> <span data-ttu-id="14d58-162">Ils doivent correspondre à la taille fournie par **IPreviewHandler :: SetWindow** et [**IPreviewHandler :: SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect) (selon la valeur la plus récente étant appelée).</span><span class="sxs-lookup"><span data-stu-id="14d58-162">They should be the size provided by **IPreviewHandler::SetWindow** and [**IPreviewHandler::SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect) (whichever was called most recently).</span></span>

<span data-ttu-id="14d58-163">Une fois que vous disposez d’une fenêtre, chargez les données à partir de l' [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) avec lequel le gestionnaire d’aperçus a été initialisé et affichez ces données dans la fenêtre de votre gestionnaire d’aperçus.</span><span class="sxs-lookup"><span data-stu-id="14d58-163">Once you have a window, load the data from the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) that the preview handler was initialized with, and render that data to your preview handler's window.</span></span>

### <a name="ipreviewhandlersetfocus"></a><span data-ttu-id="14d58-164">IPreviewHandler :: SetFocus</span><span class="sxs-lookup"><span data-stu-id="14d58-164">IPreviewHandler::SetFocus</span></span>

<span data-ttu-id="14d58-165">Cette méthode est appelée lorsque le focus entre dans le volet de lecture via une action de tabulation.</span><span class="sxs-lookup"><span data-stu-id="14d58-165">This method is called when the focus enters the reading pane through a tab action.</span></span> <span data-ttu-id="14d58-166">Dans la mesure où elle peut être entrée sous la forme d’un onglet suivant ou d’un onglet inverse, utilisez l’état actuel de la touche Maj pour décider si le premier ou le dernier taquet de tabulation dans le volet de lecture doit recevoir le focus.</span><span class="sxs-lookup"><span data-stu-id="14d58-166">Since it can be entered as a forward tab or reverse tab, use the current state of the SHIFT key to decide whether the first or last tab stop in the reading pane should receive the focus.</span></span>

### <a name="ipreviewhandlerqueryfocus"></a><span data-ttu-id="14d58-167">IPreviewHandler :: QueryFocus</span><span class="sxs-lookup"><span data-stu-id="14d58-167">IPreviewHandler::QueryFocus</span></span>

<span data-ttu-id="14d58-168">Cette méthode doit appeler la fonction [**getFocus**](/windows/win32/api/winuser/nf-winuser-getfocus) et retourner le résultat de cet appel dans le paramètre *phwnd* .</span><span class="sxs-lookup"><span data-stu-id="14d58-168">This method should call the [**GetFocus**](/windows/win32/api/winuser/nf-winuser-getfocus) function and return the result of that call in the *phwnd* parameter.</span></span>

### <a name="ipreviewhandlertranslateaccelerator"></a><span data-ttu-id="14d58-169">IPreviewHandler :: TranslateAccelerator</span><span class="sxs-lookup"><span data-stu-id="14d58-169">IPreviewHandler::TranslateAccelerator</span></span>

<span data-ttu-id="14d58-170">Cette méthode est appelée par la pompe de messages du processus du gestionnaire d’aperçus (qu’il s’agisse prevhost.exe ou d’un serveur local personnalisé) en réponse aux séquences de touches de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="14d58-170">This method is called by the message pump of the preview handler's process (whether prevhost.exe or a custom local server) in response to user keystrokes.</span></span> <span data-ttu-id="14d58-171">Les gestionnaires d’aperçus doivent gérer ces séquences de touches ou les transférer à leur hôte en fonction de l’algorithme détaillé ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="14d58-171">Preview handlers should handle these keystrokes or forward them to their host according to the algorithm detailed below.</span></span>

<span data-ttu-id="14d58-172">Toutefois, étant donné que les préversions sont en lecture seule, l’entrée au clavier doit être minime et les optimisations telles que celles-ci ne sont pas nécessaires dans de nombreux cas.</span><span class="sxs-lookup"><span data-stu-id="14d58-172">However, because previews are read-only, keyboard input should be minimal and optimizations such as this are not needed in many cases.</span></span>

<span data-ttu-id="14d58-173">Si l’accélérateur clavier passé à cette méthode par le biais de la pompe de messages est un accélérateur accepté par votre gestionnaire d’aperçus, traitez-le et renvoyez-le \_ OK.</span><span class="sxs-lookup"><span data-stu-id="14d58-173">If the keyboard accelerator passed to this method through the message pump is an accelerator that your preview handler accepts, then process it and return S\_OK.</span></span> <span data-ttu-id="14d58-174">Si votre gestionnaire n’accepte pas cet accélérateur, le message d’accélérateur peut être renvoyé jusqu’au frame à gérer.</span><span class="sxs-lookup"><span data-stu-id="14d58-174">If your handler does not accept that accelerator, the accelerator message can be sent back as far as the frame to be handled.</span></span>

<span data-ttu-id="14d58-175">Il existe deux options pour transférer les accélérateurs de clavier vers le frame :</span><span class="sxs-lookup"><span data-stu-id="14d58-175">There are two options for forwarding keyboard accelerators back to the frame:</span></span>

<span data-ttu-id="14d58-176">Le modèle le plus simple consiste à transférer toutes les séquences de touches à l’hôte à l’aide de [**IPreviewHandlerFrame :: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator).</span><span class="sxs-lookup"><span data-stu-id="14d58-176">The simplest model is to forward all keystrokes to the host using [**IPreviewHandlerFrame::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator).</span></span> <span data-ttu-id="14d58-177">Cette opération s’effectue dans l’exemple de gestionnaire d’aperçus fourni avec le kit de développement logiciel (SDK) Windows.</span><span class="sxs-lookup"><span data-stu-id="14d58-177">This is done in the preview handler sample provided with the Windows Software Development Kit (SDK).</span></span> <span data-ttu-id="14d58-178">Tous les gestionnaires d’aperçus de faible intégrité doivent utiliser ce modèle.</span><span class="sxs-lookup"><span data-stu-id="14d58-178">All low-integrity preview handlers must use this model.</span></span> <span data-ttu-id="14d58-179">Si l’accélérateur n’est pas géré par votre gestionnaire d’aperçus, appelez **IPreviewHandlerFrame :: TranslateAccelerator** et retournez son résultat.</span><span class="sxs-lookup"><span data-stu-id="14d58-179">If the accelerator is not handled by your preview handler, call **IPreviewHandlerFrame::TranslateAccelerator** and return its result.</span></span>

<span data-ttu-id="14d58-180">L’autre modèle consiste à utiliser une table d’accélérateurs comme optimisation pour éviter d’envoyer un trop grand nombre de frappes de touches entre les limites de processus :</span><span class="sxs-lookup"><span data-stu-id="14d58-180">The other model is to use an accelerator table as an optimization to avoid sending too many keystrokes across process boundaries:</span></span>

1.  <span data-ttu-id="14d58-181">Quand [**IObjectWithSite :: SetSite**](/windows/win32/api/ocidl/nf-ocidl-iobjectwithsite-setsite) est appelé sur votre gestionnaire d’aperçus, vous obtenez la table d’accélérateurs via [**IPreviewHandlerFrame :: GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext).</span><span class="sxs-lookup"><span data-stu-id="14d58-181">When [**IObjectWithSite::SetSite**](/windows/win32/api/ocidl/nf-ocidl-iobjectwithsite-setsite) is called on your preview handler, acquire the accelerator table through [**IPreviewHandlerFrame::GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext).</span></span> <span data-ttu-id="14d58-182">(Veillez à libérer le descripteur de la table d’accélérateurs lorsque votre générateur d’aperçu est détruit.)</span><span class="sxs-lookup"><span data-stu-id="14d58-182">(Be sure to free the handle to the accelerator table when your previewer is destroyed.)</span></span>
2.  <span data-ttu-id="14d58-183">Si l’accélérateur est géré par votre gestionnaire d’aperçus, gérez-le et renvoyez \_ OK.</span><span class="sxs-lookup"><span data-stu-id="14d58-183">If the accelerator is handled by your preview handler, handle it and return S\_OK.</span></span>
3.  <span data-ttu-id="14d58-184">Si l’accélérateur n’est pas géré par votre gestionnaire d’aperçus, comparez le message à l’aide de [**IsAccelerator**](/windows/win32/api/ole2/nf-ole2-isaccelerator) à la table d’accélérateurs acquise.</span><span class="sxs-lookup"><span data-stu-id="14d58-184">If the accelerator is not handled by your preview handler, compare the message using [**IsAccelerator**](/windows/win32/api/ole2/nf-ole2-isaccelerator) against the accelerator table acquired.</span></span>
4.  <span data-ttu-id="14d58-185">Si l’accélérateur correspond à une entrée dans cette table d’accélérateurs, appelez [**IPreviewHandlerFrame :: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator) et retournez son résultat.</span><span class="sxs-lookup"><span data-stu-id="14d58-185">If the accelerator matches an entry in that accelerator table, call [**IPreviewHandlerFrame::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator) and return its result.</span></span>
5.  <span data-ttu-id="14d58-186">Si l’accélérateur ne correspond à aucune entrée dans la table d’accélérateurs, retourne la \_ valeur false.</span><span class="sxs-lookup"><span data-stu-id="14d58-186">If the accelerator does not match any entry in the accelerator table, return S\_FALSE.</span></span>

### <a name="ipreviewhandlerunload"></a><span data-ttu-id="14d58-187">IPreviewHandler :: Unload</span><span class="sxs-lookup"><span data-stu-id="14d58-187">IPreviewHandler::Unload</span></span>

<span data-ttu-id="14d58-188">Lorsque cette méthode est appelée, arrêtez tout rendu, libérez toutes les ressources allouées en lisant les données du flux, puis libérez le [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) lui-même.</span><span class="sxs-lookup"><span data-stu-id="14d58-188">When this method is called, stop any rendering, release any resources allocated by reading data from the stream, and release the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) itself.</span></span>

<span data-ttu-id="14d58-189">Une fois cette méthode appelée, le gestionnaire doit être réinitialisé avant toute tentative d’appel de [**IPreviewHandler ::D opreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) .</span><span class="sxs-lookup"><span data-stu-id="14d58-189">Once this method is called, the handler must be reinitialized before any attempt to call [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) again.</span></span>

## <a name="ipreviewhandlervisuals"></a><span data-ttu-id="14d58-190">IPreviewHandlerVisuals</span><span class="sxs-lookup"><span data-stu-id="14d58-190">IPreviewHandlerVisuals</span></span>

-   [<span data-ttu-id="14d58-191">IPreviewHandlerVisuals::SetBackgroundColor</span><span class="sxs-lookup"><span data-stu-id="14d58-191">IPreviewHandlerVisuals::SetBackgroundColor</span></span>](#ipreviewhandlervisualssetbackgroundcolor)
-   [<span data-ttu-id="14d58-192">IPreviewHandlerVisuals::SetFont</span><span class="sxs-lookup"><span data-stu-id="14d58-192">IPreviewHandlerVisuals::SetFont</span></span>](#ipreviewhandlervisualssetfont)
-   [<span data-ttu-id="14d58-193">IPreviewHandlerVisuals::SetTextColor</span><span class="sxs-lookup"><span data-stu-id="14d58-193">IPreviewHandlerVisuals::SetTextColor</span></span>](#ipreviewhandlervisualssettextcolor)

<span data-ttu-id="14d58-194">Ces méthodes doivent être implémentées lors de la direction du gestionnaire d’aperçu pour répondre aux jeux de couleurs et de polices de l’hôte.</span><span class="sxs-lookup"><span data-stu-id="14d58-194">These methods should be implemented when directing the preview handler to respond to the host's color and font schemes.</span></span> <span data-ttu-id="14d58-195">L’hôte interroge le gestionnaire pour [**IPreviewHandlerVisuals**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlervisuals).</span><span class="sxs-lookup"><span data-stu-id="14d58-195">The host queries the handler for [**IPreviewHandlerVisuals**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlervisuals).</span></span> <span data-ttu-id="14d58-196">S’il est jugé pris en charge, l’hôte lui fournit la couleur, la police et la couleur de texte.</span><span class="sxs-lookup"><span data-stu-id="14d58-196">If found to be supported, the host provides it with color, font, and text color.</span></span>

### <a name="ipreviewhandlervisualssetbackgroundcolor"></a><span data-ttu-id="14d58-197">IPreviewHandlerVisuals::SetBackgroundColor</span><span class="sxs-lookup"><span data-stu-id="14d58-197">IPreviewHandlerVisuals::SetBackgroundColor</span></span>

<span data-ttu-id="14d58-198">Stockez cette couleur et utilisez-la pendant le rendu lorsque vous souhaitez fournir une couleur d’arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="14d58-198">Store this color and use it during rendering when you want to provide a background color.</span></span> <span data-ttu-id="14d58-199">Par exemple, pour remplir la fenêtre lorsque le gestionnaire est rendu à une zone plus petite que la zone fournie par [**IPreviewHandler :: SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) et [**IPreviewHandler :: SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span><span class="sxs-lookup"><span data-stu-id="14d58-199">For instance, to fill the window when the handler renders to an area smaller than the area provided by [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) and [**IPreviewHandler::SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span></span> <span data-ttu-id="14d58-200">Notez, toutefois, que vous ne devez pas dessiner en dehors de la zone fournie par ces méthodes.</span><span class="sxs-lookup"><span data-stu-id="14d58-200">Note, however, that you should not draw outside the area provided by those methods.</span></span>

<span data-ttu-id="14d58-201">Si cette méthode est appelée alors que l’aperçu est déjà en cours de restitution, le rendu doit être redémarré à l’aide de cette couleur d’arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="14d58-201">If this method is called while the preview is already being rendered, the rendering should be restarted using this background color.</span></span>

### <a name="ipreviewhandlervisualssetfont"></a><span data-ttu-id="14d58-202">IPreviewHandlerVisuals::SetFont</span><span class="sxs-lookup"><span data-stu-id="14d58-202">IPreviewHandlerVisuals::SetFont</span></span>

<span data-ttu-id="14d58-203">Stockez ces informations de police et utilisez-les lors du rendu lorsque vous souhaitez afficher du texte cohérent avec les paramètres Windows Vista actuels.</span><span class="sxs-lookup"><span data-stu-id="14d58-203">Store this font information and use it during rendering when you want to display text consistent with the current Windows Vista settings.</span></span>

### <a name="ipreviewhandlervisualssettextcolor"></a><span data-ttu-id="14d58-204">IPreviewHandlerVisuals::SetTextColor</span><span class="sxs-lookup"><span data-stu-id="14d58-204">IPreviewHandlerVisuals::SetTextColor</span></span>

<span data-ttu-id="14d58-205">Stockez ces informations de couleur de texte et utilisez-les lors du rendu lorsque vous souhaitez afficher du texte cohérent avec les paramètres Windows Vista actuels.</span><span class="sxs-lookup"><span data-stu-id="14d58-205">Store this text color information and use it during rendering when you want to display text consistent with the current Windows Vista settings.</span></span>

## <a name="related-topics"></a><span data-ttu-id="14d58-206">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="14d58-206">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="14d58-207">Gestionnaires d’aperçus et hôte de l’interpréteur de commandes</span><span class="sxs-lookup"><span data-stu-id="14d58-207">Preview Handlers and Shell Preview Host</span></span>](preview-handlers.md)
</dt> <dt>

[<span data-ttu-id="14d58-208">Comment inscrire un gestionnaire d’aperçus</span><span class="sxs-lookup"><span data-stu-id="14d58-208">How to Register a Preview Handler</span></span>](how-to-register-a-preview-handler.md)
</dt> <dt>

[<span data-ttu-id="14d58-209">Instructions du gestionnaire d’aperçus</span><span class="sxs-lookup"><span data-stu-id="14d58-209">Preview Handler Guidelines</span></span>](preview-handler-guidelines.md)
</dt> </dl>

 

 
