---
description: Lorsque vous créez vos propres assemblys côte à côte, suivez les instructions pour créer des assemblys côte à côte et créer n’importe quelle DLL à inclure dans l’assembly conformément aux instructions de création d’une DLL pour un assembly côte à côte.
ms.assetid: 0e98bbcd-7e23-4a33-b0fa-1f936d0ef96b
title: Création d’un stockage d’État pour des assemblys côte à côte
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eee388cf680ee3a186a225ca7e3bde8b6eae625d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103757311"
---
# <a name="authoring-state-storage-for-side-by-side-assemblies"></a><span data-ttu-id="86d6f-103">Création d’un stockage d’État pour des assemblys côte à côte</span><span class="sxs-lookup"><span data-stu-id="86d6f-103">Authoring State Storage for Side-by-side Assemblies</span></span>

<span data-ttu-id="86d6f-104">Lorsque vous créez vos propres assemblys côte à côte, suivez les [instructions pour créer des assemblys côte à côte](guidelines-for-creating-side-by-side-assemblies.md) et créer n’importe quelle dll à inclure dans l’assembly conformément aux instructions de [création d’une dll pour un assembly côte à côte](authoring-a-dll-for-a-side-by-side-assembly.md).</span><span class="sxs-lookup"><span data-stu-id="86d6f-104">When creating your own side-by-side assemblies, follow the [Guidelines for Creating Side-by-side Assemblies](guidelines-for-creating-side-by-side-assemblies.md) and author any DLL to be included in the assembly according to the guidelines in [Authoring a DLL for a Side-by-Side Assembly](authoring-a-dll-for-a-side-by-side-assembly.md).</span></span>

<span data-ttu-id="86d6f-105">Respectez les instructions suivantes pour le stockage de l’État :</span><span class="sxs-lookup"><span data-stu-id="86d6f-105">Adhere to the following guidelines for the storage of the state:</span></span>

-   <span data-ttu-id="86d6f-106">Concevez le stockage de l’État pour une compatibilité ascendante et descendante.</span><span class="sxs-lookup"><span data-stu-id="86d6f-106">Design state storage to be forward and backward compatible.</span></span> <span data-ttu-id="86d6f-107">Attendez-vous à ce que les versions soient utilisées dans n’importe quel ordre : par exemple, v1, puis v3, puis v2.</span><span class="sxs-lookup"><span data-stu-id="86d6f-107">Expect the versions to be used in any order: for example, v1, then v3, then v2.</span></span>
-   <span data-ttu-id="86d6f-108">Initialisez et définissez les paramètres par défaut de l’assembly dans le code de l’assembly.</span><span class="sxs-lookup"><span data-stu-id="86d6f-108">Initialize and set the default settings for the assembly in the assembly code.</span></span> <span data-ttu-id="86d6f-109">N’enregistrez pas les paramètres par défaut dans le registre.</span><span class="sxs-lookup"><span data-stu-id="86d6f-109">Do not save the defaults settings in the registry.</span></span>
-   <span data-ttu-id="86d6f-110">Les paramètres du Registre doivent être écrits sur la base d’une version individuelle pour isoler plusieurs versions d’assembly qui peuvent être exécutées en même temps.</span><span class="sxs-lookup"><span data-stu-id="86d6f-110">Registry settings must be written on an individual-version basis to isolate multiple assembly versions that may be run at the same time.</span></span> <span data-ttu-id="86d6f-111">Concevez votre assembly côte à côte pour stocker et gérer correctement l’état de l’assembly pendant les scénarios de partage côte à côte.</span><span class="sxs-lookup"><span data-stu-id="86d6f-111">Design your side-by-side assembly to correctly store and handle the state of the assembly during side-by-side sharing scenarios.</span></span>
-   <span data-ttu-id="86d6f-112">Les assemblys stockent généralement les informations d’État dans les clés de registre.</span><span class="sxs-lookup"><span data-stu-id="86d6f-112">Assemblies commonly store state information in registry keys.</span></span> <span data-ttu-id="86d6f-113">Créez un ensemble de fichiers d’en-tête et de fonctions d’assistance pour fournir un moyen simple aux clés de registre de version contenant l’état de l’assembly.</span><span class="sxs-lookup"><span data-stu-id="86d6f-113">Author a set of header files and helper functions to provide an easy way to version registry keys containing the assembly state.</span></span>
-   <span data-ttu-id="86d6f-114">Toutes les informations sur l’état de l’assembly enregistrées dans le registre doivent être isolées des autres versions de l’assembly.</span><span class="sxs-lookup"><span data-stu-id="86d6f-114">Any assembly state information saved in the registry must be isolated from other versions of the assembly.</span></span> <span data-ttu-id="86d6f-115">Les paramètres d’État stockés dans le registre doivent être enregistrés dans des sections de la version individuelle du Registre.</span><span class="sxs-lookup"><span data-stu-id="86d6f-115">State settings stored in the registry must be saved in individual version sections of the registry.</span></span> <span data-ttu-id="86d6f-116">Cela est requis dans les parties HKLM et HKCU du Registre.</span><span class="sxs-lookup"><span data-stu-id="86d6f-116">This is required in both the HKLM and HKCU parts of the registry.</span></span> <span data-ttu-id="86d6f-117">Par exemple, stockez les paramètres d’État HKCU de la version d’assembly XXXX sous la clé de Registre suivante :</span><span class="sxs-lookup"><span data-stu-id="86d6f-117">For example, store HKCU state settings for assembly version XXXX under the following registry key:</span></span>

    <span data-ttu-id="86d6f-118">**HKCU** \\ **Société** \\ **MyComponent** \\ **VersionXXXX**</span><span class="sxs-lookup"><span data-stu-id="86d6f-118">**HKCU**\\**MyCompany**\\**MyComponent**\\**VersionXXXX**</span></span>

-   <span data-ttu-id="86d6f-119">Toutes les informations d’État stockées dans le registre par les assemblys partagés doivent être enregistrées dans des sections de version individuelles du Registre.</span><span class="sxs-lookup"><span data-stu-id="86d6f-119">Any state information stored in the registry by shared assemblies must be saved in individual version sections of the registry.</span></span> <span data-ttu-id="86d6f-120">Par exemple, un paramètre d’état appelé EnableSuperCoolFeature peut avoir la valeur **true** ou **false**.</span><span class="sxs-lookup"><span data-stu-id="86d6f-120">For example, a state setting called EnableSuperCoolFeature might have a value of **TRUE** or **FALSE**.</span></span> <span data-ttu-id="86d6f-121">Stockez la valeur d’un [*assembly côte à côte partagé*](s-sbscs-gly.md) comme suit :</span><span class="sxs-lookup"><span data-stu-id="86d6f-121">Store the value for a [*shared side-by-side assembly*](s-sbscs-gly.md) as follows:</span></span>

    <span data-ttu-id="86d6f-122">**HKEY \_ CurrentUser** \\ **Software** \\ **MyCompany** \\ **MyComponent** \\ **version 01.01** \\ **EnableSuperCoolFeature = true**</span><span class="sxs-lookup"><span data-stu-id="86d6f-122">**HKEY\_CurrentUser**\\**Software**\\**MyCompany**\\**MyComponent**\\**Version01.01**\\**EnableSuperCoolFeature = TRUE**</span></span>

-   <span data-ttu-id="86d6f-123">Toutes les informations d’État stockées dans le registre par des assemblys privés doivent être enregistrées dans les sections d’application individuelles du Registre.</span><span class="sxs-lookup"><span data-stu-id="86d6f-123">Any state information stored in the registry by private assemblies must be saved in individual application sections of the registry.</span></span> <span data-ttu-id="86d6f-124">Cela isole les paramètres d’état de l’assembly de l’application.</span><span class="sxs-lookup"><span data-stu-id="86d6f-124">This isolates the assembly's state settings to the application.</span></span> <span data-ttu-id="86d6f-125">Vous pouvez utiliser la fonction [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) pour configurer une racine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="86d6f-125">You can use the [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function to set up a virtual root.</span></span> <span data-ttu-id="86d6f-126">Par exemple, si la version d’assembly XXYY est un assembly privé de « SomeApplication », un appel à **GetModuleFileName** retourne « SomeApplication » et tous les paramètres d’État privé de l’assembly doivent être écrits sous la clé suivante :</span><span class="sxs-lookup"><span data-stu-id="86d6f-126">For example, if assembly version XXYY is a private assembly of "SomeApplication," a call to **GetModuleFileName** returns "SomeApplication" and any private state settings for the assembly should be written under the following key:</span></span>

    <span data-ttu-id="86d6f-127">**HKCU** \\ **Société** \\ **MyComponent** \\ **VersionXXYY** \\ **SomeApplication**</span><span class="sxs-lookup"><span data-stu-id="86d6f-127">**HKCU**\\**MyCompany**\\**MyComponent**\\**VersionXXYY**\\**SomeApplication**</span></span>

-   <span data-ttu-id="86d6f-128">Rendez les paramètres d’état partagé stockés dans le registre privés dans le contexte de l’assembly qui s’exécute.</span><span class="sxs-lookup"><span data-stu-id="86d6f-128">Make shared state settings stored in the registry private to the assembly context that runs.</span></span> <span data-ttu-id="86d6f-129">Vous pouvez utiliser la fonction [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) pour configurer une racine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="86d6f-129">You can use the [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function to set up a virtual root.</span></span> <span data-ttu-id="86d6f-130">Cela doit être fait pour les branches HKLM et HKCU.</span><span class="sxs-lookup"><span data-stu-id="86d6f-130">This should be done for HKLM and HKCU branches.</span></span>
-   <span data-ttu-id="86d6f-131">Idéalement, vous devez adopter un modèle de persistance dans lequel l’application conserve l’État et ne modifie pas le registre.</span><span class="sxs-lookup"><span data-stu-id="86d6f-131">Ideally, you should adopt a persistence model in which the application persists the state and does not alter the registry.</span></span> <span data-ttu-id="86d6f-132">Une application ne doit pas avoir à toucher directement les entrées de Registre du composant.</span><span class="sxs-lookup"><span data-stu-id="86d6f-132">An application should not need to directly touch the component's registry entries.</span></span> <span data-ttu-id="86d6f-133">Au lieu de cela, l’assembly doit proposer des fonctions API qui enregistrent ou restaurent les paramètres qui sont compatibles côte à côte.</span><span class="sxs-lookup"><span data-stu-id="86d6f-133">Instead, the assembly should offer API functions that save or restore settings that are side-by-side compatible.</span></span>
-   <span data-ttu-id="86d6f-134">Les assemblys peuvent enregistrer les paramètres d’État dans les magasins en dehors du Registre pour permettre à l’assembly d’interagir avec l’état global.</span><span class="sxs-lookup"><span data-stu-id="86d6f-134">Assemblies may save state settings in stores outside the registry to enable the assembly to interact with the global state.</span></span> <span data-ttu-id="86d6f-135">Les assemblys côte à côte peuvent utiliser les magasins compatibles côte à côte suivants :</span><span class="sxs-lookup"><span data-stu-id="86d6f-135">Side-by-side assemblies may use the following side-by-side compatible stores:</span></span>
    -   <span data-ttu-id="86d6f-136">Un magasin protégé (*Pstore*)</span><span class="sxs-lookup"><span data-stu-id="86d6f-136">A protected store (*pstore*)</span></span>
    -   <span data-ttu-id="86d6f-137">Un cache WinInet</span><span class="sxs-lookup"><span data-stu-id="86d6f-137">A WinInet cache</span></span>
    -   <span data-ttu-id="86d6f-138">Microsoft SQL Server</span><span class="sxs-lookup"><span data-stu-id="86d6f-138">A Microsoft SQL Server</span></span>

 

 
