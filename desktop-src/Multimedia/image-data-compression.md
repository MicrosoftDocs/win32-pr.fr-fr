---
title: Compression Image-Data
description: Compression Image-Data
ms.assetid: 689cf403-cbb5-4ccb-a05b-0caa617430ed
keywords:
- Video Compression Manager (VCM), compression des données d’image
- VCM (gestionnaire de compression vidéo), compression des données d’image
- ICCompress fonction)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8b8f59a163a9b5a74d2d2fe984417069985fa86a
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104381838"
---
# <a name="image-data-compression"></a><span data-ttu-id="6db57-106">Compression Image-Data</span><span class="sxs-lookup"><span data-stu-id="6db57-106">Image-Data Compression</span></span>

<span data-ttu-id="6db57-107">Votre application peut utiliser une série de fonctions et de macros [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) pour compresser les données.</span><span class="sxs-lookup"><span data-stu-id="6db57-107">Your application can use a series of [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) functions and macros to compress data.</span></span> <span data-ttu-id="6db57-108">Les fonctions et les macros peuvent vous aider à effectuer les tâches suivantes :</span><span class="sxs-lookup"><span data-stu-id="6db57-108">The functions and macros can help you perform the following tasks:</span></span>

-   <span data-ttu-id="6db57-109">Déterminez le format de compression à utiliser pour un format d’entrée spécifié.</span><span class="sxs-lookup"><span data-stu-id="6db57-109">Determine the compression format to use for a specified input format.</span></span>
-   <span data-ttu-id="6db57-110">Préparez le compresseur.</span><span class="sxs-lookup"><span data-stu-id="6db57-110">Prepare the compressor.</span></span>
-   <span data-ttu-id="6db57-111">Compressez les données.</span><span class="sxs-lookup"><span data-stu-id="6db57-111">Compress the data.</span></span>
-   <span data-ttu-id="6db57-112">Fin de la compression.</span><span class="sxs-lookup"><span data-stu-id="6db57-112">End compression.</span></span>

<span data-ttu-id="6db57-113">Votre application peut augmenter le contrôle du processus de compression à l’aide des fonctions et macros [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) .</span><span class="sxs-lookup"><span data-stu-id="6db57-113">Your application can increase control over the compression process by using the [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) functions and macros.</span></span> <span data-ttu-id="6db57-114">Ce groupe de fonctions et de macros gère des frames individuels, plutôt que l’ensemble de la séquence.</span><span class="sxs-lookup"><span data-stu-id="6db57-114">This group of functions and macros handles individual frames, rather than the sequence as a whole.</span></span> <span data-ttu-id="6db57-115">Par exemple, votre application peut identifier les frames à compresser en tant qu’images clés à l’aide de la fonction **ICCompress** .</span><span class="sxs-lookup"><span data-stu-id="6db57-115">For example, your application can identify the frames to compress as key frames by using the **ICCompress** function.</span></span>

<span data-ttu-id="6db57-116">Un compresseur reçoit des données dans un format, compresse les données et retourne une version compressée des données à l’aide d’un format spécifié.</span><span class="sxs-lookup"><span data-stu-id="6db57-116">A compressor receives data in one format, compresses the data, and returns a compressed version of the data using a specified format.</span></span> <span data-ttu-id="6db57-117">Le format d’entrée standard spécifie les DIB à l’aide de la structure [**BITMAPINFO,**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) .</span><span class="sxs-lookup"><span data-stu-id="6db57-117">The typical input format specifies DIBs using the [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) structure.</span></span> <span data-ttu-id="6db57-118">Le format de sortie standard spécifie les DIB compressés, également à l’aide de la structure **BITMAPINFO,** .</span><span class="sxs-lookup"><span data-stu-id="6db57-118">The typical output format specifies compressed DIBs, also using the **BITMAPINFO** structure.</span></span>

> [!Note]  
> <span data-ttu-id="6db57-119">Pour réduire la dégradation de l’image et du son lors de la lecture, évitez de compresser un fichier AVI plusieurs fois.</span><span class="sxs-lookup"><span data-stu-id="6db57-119">To minimize image and audio degradation during playback, avoid compressing an AVI file more than once.</span></span> <span data-ttu-id="6db57-120">Combinez des éléments vidéo non compressés dans votre système de montage, puis compressez le produit final.</span><span class="sxs-lookup"><span data-stu-id="6db57-120">Combine uncompressed pieces of video in your editing system and then compress the final product.</span></span>

 

## <a name="compressor-and-compression-format-selection"></a><span data-ttu-id="6db57-121">Sélection du format de compression et du compresseur</span><span class="sxs-lookup"><span data-stu-id="6db57-121">Compressor and Compression Format Selection</span></span>

<span data-ttu-id="6db57-122">Si vous souhaitez compresser des données et que votre application requiert un format de sortie spécifique, envoyez le message de [**\_ \_ requête de compression ICM**](icm-compress-query.md) (ou utilisez la macro [**ICCompressQuery**](/windows/desktop/api/Vfw/nf-vfw-iccompressquery) ) pour interroger le compresseur afin de déterminer s’il prend en charge les formats d’entrée et de sortie.</span><span class="sxs-lookup"><span data-stu-id="6db57-122">If you want to compress data and your application requires a specific output format, send the [**ICM\_COMPRESS\_QUERY**](icm-compress-query.md) message (or use the [**ICCompressQuery**](/windows/desktop/api/Vfw/nf-vfw-iccompressquery) macro) to query the compressor to determine if it supports the input and output formats.</span></span>

<span data-ttu-id="6db57-123">Si le format de sortie n’est pas important pour votre application, il vous suffit de trouver un compresseur pouvant gérer le format d’entrée.</span><span class="sxs-lookup"><span data-stu-id="6db57-123">If the output format is not important to your application, you need only find a compressor that can handle the input format.</span></span> <span data-ttu-id="6db57-124">Pour déterminer si un compresseur peut gérer le format d’entrée, vous pouvez envoyer une **\_ \_ requête de compression ICM**, en spécifiant la **valeur null** pour le paramètre *lParam* .</span><span class="sxs-lookup"><span data-stu-id="6db57-124">To determine if a compressor can handle the input format, you can send **ICM\_COMPRESS\_QUERY**, specifying **NULL** for the *lParam* parameter.</span></span> <span data-ttu-id="6db57-125">Ce message ne retourne pas le format de sortie de votre application.</span><span class="sxs-lookup"><span data-stu-id="6db57-125">This message does not return the output format to your application.</span></span> <span data-ttu-id="6db57-126">Votre application peut déterminer la taille de mémoire tampon nécessaire pour les données qui spécifient le format de compression en envoyant le message de format d’extraction de la [**\_ compression \_ \_ ICM**](icm-compress-get-format.md) (ou en utilisant la macro [**ICCompressGetFormatSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformatsize) ).</span><span class="sxs-lookup"><span data-stu-id="6db57-126">Your application can determine the buffer size needed for the data specifying the compression format by sending the [**ICM\_COMPRESS\_GET\_FORMAT**](icm-compress-get-format.md) message (or use the [**ICCompressGetFormatSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformatsize) macro).</span></span> <span data-ttu-id="6db57-127">Vous pouvez également récupérer les données de format en envoyant le \_ format d’extraction de compression ICM \_ \_ (ou la macro [**ICCompressGetFormat**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformat) ).</span><span class="sxs-lookup"><span data-stu-id="6db57-127">You can also retrieve the format data by sending ICM\_COMPRESS\_GET\_FORMAT (or the [**ICCompressGetFormat**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformat) macro).</span></span>

<span data-ttu-id="6db57-128">Si vous souhaitez déterminer la plus grande mémoire tampon que le compresseur peut exiger pour la compression, envoyez le message de taille d’extraction de la [**\_ compression \_ \_ ICM**](icm-compress-get-size.md) (ou utilisez la macro [**ICCompressGetSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetsize) ).</span><span class="sxs-lookup"><span data-stu-id="6db57-128">If you want to determine the largest buffer that the compressor could require for compression, send the [**ICM\_COMPRESS\_GET\_SIZE**](icm-compress-get-size.md) message (or use the [**ICCompressGetSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetsize) macro).</span></span> <span data-ttu-id="6db57-129">Vous pouvez utiliser le nombre d’octets retournés par la fonction [**ICSendMessage**](/windows/desktop/api/Vfw/nf-vfw-icsendmessage) pour allouer une mémoire tampon pour les compressions d’image ultérieures.</span><span class="sxs-lookup"><span data-stu-id="6db57-129">You can use the number of bytes returned by the [**ICSendMessage**](/windows/desktop/api/Vfw/nf-vfw-icsendmessage) function to allocate a buffer for subsequent image compressions.</span></span>

## <a name="compressor-initialization"></a><span data-ttu-id="6db57-130">Initialisation du compresseur</span><span class="sxs-lookup"><span data-stu-id="6db57-130">Compressor Initialization</span></span>

<span data-ttu-id="6db57-131">Une fois que votre application a sélectionné un compresseur capable de gérer les formats d’entrée et de sortie dont elle a besoin, vous pouvez initialiser le compresseur à l’aide du message de début de la [**\_ compression \_ ICM**](icm-compress-begin.md) (ou en utilisant la macro [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) ).</span><span class="sxs-lookup"><span data-stu-id="6db57-131">After your application selects a compressor that can handle the input and output formats it needs, you can initialize the compressor by using the [**ICM\_COMPRESS\_BEGIN**](icm-compress-begin.md) message (or use the [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) macro).</span></span> <span data-ttu-id="6db57-132">Ce message requiert le descripteur de compresseur et les formats d’entrée et de sortie.</span><span class="sxs-lookup"><span data-stu-id="6db57-132">This message requires the compressor handle and the input and output formats.</span></span>

## <a name="data-compression"></a><span data-ttu-id="6db57-133">Data Compression</span><span class="sxs-lookup"><span data-stu-id="6db57-133">Data Compression</span></span>

<span data-ttu-id="6db57-134">Vous pouvez utiliser la fonction [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) pour compresser un frame.</span><span class="sxs-lookup"><span data-stu-id="6db57-134">You can use the [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) function to compress a frame.</span></span> <span data-ttu-id="6db57-135">Votre application doit utiliser cette fonction à plusieurs reprises jusqu’à ce que tous les frames d’une séquence soient compressés.</span><span class="sxs-lookup"><span data-stu-id="6db57-135">Your application must use this function repeatedly until all the frames in a sequence are compressed.</span></span> <span data-ttu-id="6db57-136">Votre application doit également suivre et incrémenter le nombre de chaque frame compressé avec **ICCompress**.</span><span class="sxs-lookup"><span data-stu-id="6db57-136">Your application must also track and increment the number of each frame compressed with **ICCompress**.</span></span> <span data-ttu-id="6db57-137">Le compresseur utilise cette valeur pour vérifier si les trames sont envoyées dans le désordre pendant la compression temporelle rapide (stockage des différences entre les images consécutives).</span><span class="sxs-lookup"><span data-stu-id="6db57-137">The compressor uses this value to check if frames are sent out of order during fast temporal compression (storing differences between successive frames).</span></span> <span data-ttu-id="6db57-138">Si votre application recompresse un frame, elle doit utiliser le même numéro de frame que lorsque le frame a été compressé pour la première fois.</span><span class="sxs-lookup"><span data-stu-id="6db57-138">If your application recompresses a frame, it should use the same frame number as when the frame was first compressed.</span></span> <span data-ttu-id="6db57-139">Si votre application compresse une image de cadre continu, elle peut spécifier un nombre d’images égal à zéro.</span><span class="sxs-lookup"><span data-stu-id="6db57-139">If your application compresses a still-frame image, it can specify a frame number of zero.</span></span>

<span data-ttu-id="6db57-140">Votre application peut utiliser l' **indicateur \_ KeyFrame ICCOMPRESS** pour que le frame compressé par [**ICCOMPRESS**](/windows/desktop/api/Vfw/nf-vfw-iccompress) une image clé.</span><span class="sxs-lookup"><span data-stu-id="6db57-140">Your application can use the **ICCOMPRESS\_KEYFRAME** flag to make the frame compressed by [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) a key frame.</span></span>

<span data-ttu-id="6db57-141">Lorsque VCM renvoie le contrôle à votre application après la compression d’un frame, VCM stocke les données compressées dans les structures référencées par les paramètres *lpbiOutput* et *lpData* .</span><span class="sxs-lookup"><span data-stu-id="6db57-141">When VCM returns control to your application after compressing a frame, VCM stores the compressed data in the structures referenced by the *lpbiOutput* and *lpData* parameters.</span></span> <span data-ttu-id="6db57-142">Si votre application a besoin de déplacer les données compressées, elle peut trouver sa taille dans le membre *biSizeImage* de la structure [**BITMAPINFO,**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) spécifiée dans *lpbiOutput*.</span><span class="sxs-lookup"><span data-stu-id="6db57-142">If your application needs to move the compressed data, it can find its size in the *biSizeImage* member of the [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) structure specified in *lpbiOutput*.</span></span>

> [!Note]  
> <span data-ttu-id="6db57-143">Votre application doit allouer les structures et les tampons qui stockent les données non compressées et compressées.</span><span class="sxs-lookup"><span data-stu-id="6db57-143">Your application must allocate the structures and buffers that store the uncompressed and compressed data.</span></span> <span data-ttu-id="6db57-144">Si le compresseur prend en charge la compression temporelle, votre application doit également allouer une structure et une mémoire tampon pour stocker le format et les données de la trame d’informations précédente.</span><span class="sxs-lookup"><span data-stu-id="6db57-144">If the compressor supports temporal compression, your application must also allocate a structure and buffer to hold the format and data for the previous frame of information.</span></span>

 

## <a name="ending-compression"></a><span data-ttu-id="6db57-145">Compression de fin</span><span class="sxs-lookup"><span data-stu-id="6db57-145">Ending Compression</span></span>

<span data-ttu-id="6db57-146">Une fois que votre application a compressé les données, elle peut utiliser la macro [**ICCompressEnd**](/windows/desktop/api/Vfw/nf-vfw-iccompressend) pour informer le compresseur qu’elle est terminée.</span><span class="sxs-lookup"><span data-stu-id="6db57-146">After your application has compressed the data, it can use the [**ICCompressEnd**](/windows/desktop/api/Vfw/nf-vfw-iccompressend) macro to notify the compressor that it has finished.</span></span> <span data-ttu-id="6db57-147">Si vous souhaitez redémarrer la compression après avoir utilisé cette fonction, votre application doit réinitialiser le compresseur en envoyant le message [**de \_ \_ début de la compression ICM**](icm-compress-begin.md) (ou en utilisant la macro [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) ).</span><span class="sxs-lookup"><span data-stu-id="6db57-147">If you want to restart compression after using this function, your application must reinitialize the compressor by sending the [**ICM\_COMPRESS\_BEGIN**](icm-compress-begin.md) message (or use the [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) macro).</span></span>

 

 