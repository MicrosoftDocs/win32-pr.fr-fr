---
title: Instances de pilote
description: Instances de pilote
ms.assetid: 93dba9e8-bfb3-4714-9466-cf5c78babcf2
keywords:
- pilotes installables, instances
- pilotes installables, instances multiples
- plusieurs instances de pilote
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 37148dcb12fbfa2984d4e55424102b5985165d9d
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103672593"
---
# <a name="driver-instances"></a><span data-ttu-id="aa826-106">Instances de pilote</span><span class="sxs-lookup"><span data-stu-id="aa826-106">Driver Instances</span></span>

<span data-ttu-id="aa826-107">Windows autorise l’installation de plusieurs instances d’un pilote.</span><span class="sxs-lookup"><span data-stu-id="aa826-107">Windows allows for multiples instances of an installable driver.</span></span> <span data-ttu-id="aa826-108">Le système crée une instance du pilote à chaque ouverture du pilote et détruit l’instance lorsque le pilote est fermé.</span><span class="sxs-lookup"><span data-stu-id="aa826-108">The system creates an instance of the driver each time the driver is opened and destroys the instance when the driver is closed.</span></span> <span data-ttu-id="aa826-109">Les instances de pilote sont particulièrement utiles pour les pilotes installables qui prennent en charge plusieurs appareils ou qui sont ouverts par plusieurs applications ou par la même application plusieurs fois.</span><span class="sxs-lookup"><span data-stu-id="aa826-109">Driver instances are especially useful for installable drivers that support multiple devices or that are opened by multiple applications or by the same application multiple times.</span></span>

<span data-ttu-id="aa826-110">Pour aider le pilote à effectuer le suivi des instances, le système envoie un descripteur d’instance de pilote à chaque message de pilote une fois l’instance créée.</span><span class="sxs-lookup"><span data-stu-id="aa826-110">To help the driver keep track of the instances, the system sends a driver instance handle with each driver message after the instance has been created.</span></span> <span data-ttu-id="aa826-111">Étant donné que ce handle identifie l’instance de façon unique, les pilotes installables associent souvent le handle à la mémoire et à d’autres ressources qu’ils ont spécifiquement allouées pour l’instance.</span><span class="sxs-lookup"><span data-stu-id="aa826-111">Because this handle uniquely identifies the instance, installable drivers often associate the handle with memory and other resources that they have specifically allocated for the instance.</span></span>

<span data-ttu-id="aa826-112">Lorsque la première instance est ouverte, le système envoie les messages de [**\_ chargement du DRV**](drv-load.md), [**DRV \_ Enable**](drv-enable.md)et [**DRV \_ Open**](drv-open.md) au pilote dans cet ordre.</span><span class="sxs-lookup"><span data-stu-id="aa826-112">When the first instance is opened, the system sends the [**DRV\_LOAD**](drv-load.md), [**DRV\_ENABLE**](drv-enable.md), and [**DRV\_OPEN**](drv-open.md) messages to the driver in that order.</span></span> <span data-ttu-id="aa826-113">Le DRV \_ Load et le DRV \_ activent les messages informent le pilote qu’il est désormais en mémoire et qu’il est activé pour l’opération.</span><span class="sxs-lookup"><span data-stu-id="aa826-113">The DRV\_LOAD and DRV\_ENABLE messages notify the driver that it is now in memory and is enabled for operation.</span></span> <span data-ttu-id="aa826-114">Le \_ message DRV Open identifie le descripteur d’instance et peut inclure des informations de configuration pour l’instance.</span><span class="sxs-lookup"><span data-stu-id="aa826-114">The DRV\_OPEN message identifies the instance handle and may include configuration information for the instance.</span></span> <span data-ttu-id="aa826-115">À chaque ouverture suivante d’une instance du même pilote, le système envoie uniquement un message DRV \_ Open.</span><span class="sxs-lookup"><span data-stu-id="aa826-115">On each subsequent opening of an instance of the same driver, the system sends only a DRV\_OPEN message.</span></span>

<span data-ttu-id="aa826-116">Lors du traitement d’un message de chargement du DRV \_ , un pilote lit généralement les paramètres de configuration à partir du Registre, configure le pilote et tout matériel associé et alloue de la mémoire pour une utilisation par toutes les instances du pilote.</span><span class="sxs-lookup"><span data-stu-id="aa826-116">When processing a DRV\_LOAD message, a driver typically reads configuration settings from the registry, configures the driver and any associated hardware, and allocates memory for use by all instances of the driver.</span></span> <span data-ttu-id="aa826-117">Si un pilote ne peut pas terminer la configuration ou allouer de la mémoire, il retourne zéro pour demander au système de supprimer immédiatement le pilote de la mémoire et d’empêcher l’envoi des messages suivants.</span><span class="sxs-lookup"><span data-stu-id="aa826-117">If a driver cannot complete the configuration or allocate memory, it returns zero to direct the system to immediately remove the driver from memory and prevent any subsequent messages from being sent.</span></span> <span data-ttu-id="aa826-118">Lors du traitement du \_ message d’activation du DRV, le pilote prépare le matériel à la réception et au traitement des demandes d’entrée et de sortie (e/s).</span><span class="sxs-lookup"><span data-stu-id="aa826-118">When processing the DRV\_ENABLE message, the driver prepares the hardware to receive and process input and output (I/O) requests.</span></span> <span data-ttu-id="aa826-119">La préparation peut inclure l’installation de gestionnaires d’interruptions.</span><span class="sxs-lookup"><span data-stu-id="aa826-119">The preparation may include installing interrupt handlers.</span></span>

<span data-ttu-id="aa826-120">Lors du traitement du \_ message d’ouverture du DRV, le pilote alloue la mémoire ou les ressources requises par l’instance donnée du pilote, puis retourne une valeur différente de zéro.</span><span class="sxs-lookup"><span data-stu-id="aa826-120">When processing the DRV\_OPEN message, the driver allocates memory or resources required by the given instance of the driver and then returns a nonzero value.</span></span> <span data-ttu-id="aa826-121">Le système utilise cette valeur différente de zéro comme *identificateur de pilote* dans les messages de pilote suivants pour l’instance.</span><span class="sxs-lookup"><span data-stu-id="aa826-121">The system uses this nonzero value as the *driver identifier* in subsequent driver messages for the instance.</span></span> <span data-ttu-id="aa826-122">Le pilote peut utiliser cet identificateur à n’importe quel motif.</span><span class="sxs-lookup"><span data-stu-id="aa826-122">The driver can use this identifier for any purpose.</span></span> <span data-ttu-id="aa826-123">Par exemple, certains pilotes utilisent un handle de mémoire pour l’identificateur pour accéder rapidement à la mémoire contenant des informations sur l’instance donnée.</span><span class="sxs-lookup"><span data-stu-id="aa826-123">For example, some drivers use a memory handle for the identifier to gain quick access to memory containing information about the given instance.</span></span>

<span data-ttu-id="aa826-124">De nombreux pilotes installables traitent le deuxième paramètre du DRV \_ Open message, ce qui donne au système et aux applications le moyen d’envoyer des informations supplémentaires au pilote lors de l’ouverture d’une instance.</span><span class="sxs-lookup"><span data-stu-id="aa826-124">Many installable drivers process the second parameter of the DRV\_OPEN message, giving the system and applications the means to send additional information to the driver when opening an instance.</span></span> <span data-ttu-id="aa826-125">Le paramètre peut être une valeur unique ou une adresse d’une structure contenant un ensemble de valeurs.</span><span class="sxs-lookup"><span data-stu-id="aa826-125">The parameter can be a single value or an address of a structure containing a set of values.</span></span> <span data-ttu-id="aa826-126">Lorsque le traitement \_ de DRV est ouvert, le pilote vérifie le paramètre pour déterminer s’il s’agit d’une valeur et utilise les valeurs données, le cas échéant, pour terminer la création de l’instance.</span><span class="sxs-lookup"><span data-stu-id="aa826-126">When processing DRV\_OPEN, the driver checks the parameter to determine whether it is a value and uses the given values, if any, to complete the creation of the instance.</span></span>

<span data-ttu-id="aa826-127">Le système envoie un message de [**\_ fermeture du DRV**](drv-close.md) chaque fois qu’une instance est fermée.</span><span class="sxs-lookup"><span data-stu-id="aa826-127">The system sends a [**DRV\_CLOSE**](drv-close.md) message each time an instance is closed.</span></span> <span data-ttu-id="aa826-128">Le handle d’instance envoyé avec le message identifie l’instance à fermer.</span><span class="sxs-lookup"><span data-stu-id="aa826-128">The instance handle sent with the message identifies which instance to close.</span></span> <span data-ttu-id="aa826-129">Lorsque la dernière instance restante est fermée, le système envoie les \_ messages DRV Close, [**DRV \_ Disable**](drv-disable.md)et [**DRV \_ Free**](drv-free.md) dans cet ordre.</span><span class="sxs-lookup"><span data-stu-id="aa826-129">When the last remaining instance is closed, the system sends the DRV\_CLOSE, [**DRV\_DISABLE**](drv-disable.md), and [**DRV\_FREE**](drv-free.md) messages in that order.</span></span> <span data-ttu-id="aa826-130">Le \_ message de fermeture du DRV indique au pilote de fermer l’instance, et les \_ messages DRV Disable et DRV \_ Free informent le pilote qu’il est désormais désactivé et qu’il sera immédiatement libéré de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="aa826-130">The DRV\_CLOSE message directs the driver to close the instance, and the DRV\_DISABLE and DRV\_FREE messages notify the driver that it is now disabled and will be immediately freed from memory.</span></span>

<span data-ttu-id="aa826-131">Lors du traitement du \_ message de fermeture du DRV, le pilote libère généralement la mémoire ou les ressources allouées pour l’instance.</span><span class="sxs-lookup"><span data-stu-id="aa826-131">When processing the DRV\_CLOSE message, the driver typically frees any memory or resources allocated for the instance.</span></span> <span data-ttu-id="aa826-132">Lors du traitement du \_ message de désactivation du DRV, le pilote place tout le matériel dans un état inactif, ce qui peut inclure la suppression des gestionnaires d’interruptions.</span><span class="sxs-lookup"><span data-stu-id="aa826-132">When processing the DRV\_DISABLE message, the driver places any hardware in an inactive state, which may include the removal of interrupt handlers.</span></span> <span data-ttu-id="aa826-133">Lors du traitement du \_ message du DRV Free, le pilote libère la mémoire ou les ressources qui sont toujours allouées.</span><span class="sxs-lookup"><span data-stu-id="aa826-133">When processing the DRV\_FREE message, the driver frees any memory or resources that are still allocated.</span></span>

<span data-ttu-id="aa826-134">Les pilotes installables ne sont pas requis pour prendre en charge plusieurs instances.</span><span class="sxs-lookup"><span data-stu-id="aa826-134">Installable drivers are not required to support multiple instances.</span></span> <span data-ttu-id="aa826-135">Un pilote peut empêcher la création d’une instance en retournant zéro pour le [**DRV \_ Open**](drv-open.md) message.</span><span class="sxs-lookup"><span data-stu-id="aa826-135">A driver can prevent any instance from being created by returning zero for the [**DRV\_OPEN**](drv-open.md) message.</span></span>

 

 




