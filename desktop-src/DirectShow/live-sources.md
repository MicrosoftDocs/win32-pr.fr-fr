---
description: Sources en direct
ms.assetid: 571fe5e5-9616-463b-837c-f8dbb8adf1be
title: Sources en direct
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 43486cf3db797f493c9446bf782989b8beaae829
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104481752"
---
# <a name="live-sources"></a><span data-ttu-id="40931-103">Sources en direct</span><span class="sxs-lookup"><span data-stu-id="40931-103">Live Sources</span></span>

<span data-ttu-id="40931-104">Une source dynamique, également appelée *source Push*, reçoit des données en temps réel.</span><span class="sxs-lookup"><span data-stu-id="40931-104">A live source, also called a *push source*, receives data in real time.</span></span> <span data-ttu-id="40931-105">Les exemples incluent la capture vidéo et les diffusions réseau.</span><span class="sxs-lookup"><span data-stu-id="40931-105">Examples include video capture and network broadcasts.</span></span> <span data-ttu-id="40931-106">En général, une source dynamique ne peut pas contrôler la vitesse à laquelle les données arrivent.</span><span class="sxs-lookup"><span data-stu-id="40931-106">In general, a live source cannot control the rate at which data arrives.</span></span>

<span data-ttu-id="40931-107">Un filtre est considéré comme une source dynamique si l’une des conditions suivantes est vraie :</span><span class="sxs-lookup"><span data-stu-id="40931-107">A filter is considered to be a live source if either of the following are true:</span></span>

-   <span data-ttu-id="40931-108">Le filtre retourne le filtre AM les \_ \_ \_ indicateurs divers est un \_ \_ indicateur de source de la méthode [**IAMFilterMiscFlags :: GetMiscFlags**](/windows/desktop/api/Strmif/nf-strmif-iamfiltermiscflags-getmiscflags) , et au moins l’une de ses broches de sortie expose l’interface [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) .</span><span class="sxs-lookup"><span data-stu-id="40931-108">The filter returns the AM\_FILTER\_MISC\_FLAGS\_IS\_SOURCE flag from the [**IAMFilterMiscFlags::GetMiscFlags**](/windows/desktop/api/Strmif/nf-strmif-iamfiltermiscflags-getmiscflags) method, AND at least one of its output pins exposes the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface.</span></span>
-   <span data-ttu-id="40931-109">Le filtre expose l’interface [**IKsPropertySet**](ikspropertyset.md) et a une broche de capture ( \_ capture de catégorie pin \_ ).</span><span class="sxs-lookup"><span data-stu-id="40931-109">The filter exposes the [**IKsPropertySet**](ikspropertyset.md) interface and has a capture pin (PIN\_CATEGORY\_CAPTURE).</span></span> <span data-ttu-id="40931-110">Pour plus d’informations, consultez la [propriété épingle définie](pin-property-set.md) .</span><span class="sxs-lookup"><span data-stu-id="40931-110">See [Pin Property Set](pin-property-set.md) for more information.</span></span>

<span data-ttu-id="40931-111">Si un filtre de source dynamique fournit une horloge, le gestionnaire de graphique de filtre préfèrera cette horloge lorsqu’il choisit l’horloge de référence du graphique.</span><span class="sxs-lookup"><span data-stu-id="40931-111">If a live source filter provides a clock, the Filter Graph Manager will prefer that clock when it chooses the graph reference clock.</span></span> <span data-ttu-id="40931-112">Pour plus d’informations, consultez [horloges de référence](reference-clocks.md) .</span><span class="sxs-lookup"><span data-stu-id="40931-112">See [Reference Clocks](reference-clocks.md) for more information.</span></span>

<span data-ttu-id="40931-113">**Latence**</span><span class="sxs-lookup"><span data-stu-id="40931-113">**Latency**</span></span>

<span data-ttu-id="40931-114">La latence d’un filtre correspond à la durée pendant laquelle il prend le filtre pour traiter un exemple.</span><span class="sxs-lookup"><span data-stu-id="40931-114">A filter's latency is the amount of time it takes the filter to process a sample.</span></span> <span data-ttu-id="40931-115">Pour les sources en direct, la latence est déterminée par la taille de la mémoire tampon utilisée pour contenir des échantillons.</span><span class="sxs-lookup"><span data-stu-id="40931-115">For live sources, the latency is determined by the size of the buffer used to hold samples.</span></span> <span data-ttu-id="40931-116">Par exemple, supposons que le graphique de filtre ait une source vidéo avec une latence de 33 millisecondes (MS) et une source audio avec une latence de 500 ms.</span><span class="sxs-lookup"><span data-stu-id="40931-116">For example, suppose the filter graph has a video source with a latency of 33 milliseconds (ms) and an audio source with a latency of 500 ms.</span></span> <span data-ttu-id="40931-117">Chaque image vidéo arrive au convertisseur vidéo environ 470 ms avant que l’exemple audio correspondant n’atteigne le convertisseur audio.</span><span class="sxs-lookup"><span data-stu-id="40931-117">Each video frame arrives at the video renderer about 470 ms before the matching audio sample reaches the audio renderer.</span></span> <span data-ttu-id="40931-118">À moins que le graphique compense la différence, le son et la vidéo ne sont pas synchronisés.</span><span class="sxs-lookup"><span data-stu-id="40931-118">Unless the graph compensates for the difference, the audio and video will not be synchronized.</span></span>

<span data-ttu-id="40931-119">Les sources dynamiques peuvent être synchronisées par le biais de l’interface [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) .</span><span class="sxs-lookup"><span data-stu-id="40931-119">Live sources can be synchronized through the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface.</span></span> <span data-ttu-id="40931-120">Le gestionnaire de graphes de filtre ne synchronise pas les sources dynamiques, sauf si l’application active la synchronisation en appelant la méthode [**IAMGraphStreams :: SyncUsingStreamOffset**](/windows/desktop/api/Strmif/nf-strmif-iamgraphstreams-syncusingstreamoffset) .</span><span class="sxs-lookup"><span data-stu-id="40931-120">The Filter Graph Manager does not synchronize live sources unless the application enables synchronization by calling the [**IAMGraphStreams::SyncUsingStreamOffset**](/windows/desktop/api/Strmif/nf-strmif-iamgraphstreams-syncusingstreamoffset) method.</span></span> <span data-ttu-id="40931-121">Si la synchronisation est activée, le gestionnaire de graphes de filtres interroge chaque filtre source pour **IAMPushSource**.</span><span class="sxs-lookup"><span data-stu-id="40931-121">If synchronization is enabled, the Filter Graph Manager queries each source filter for **IAMPushSource**.</span></span> <span data-ttu-id="40931-122">Si le filtre prend en charge **IAMPushSource**, le gestionnaire de graphique de filtre appelle [**IAMLatency :: GetLatency**](/windows/desktop/api/Strmif/nf-strmif-iamlatency-getlatency) pour récupérer la latence attendue du filtre.</span><span class="sxs-lookup"><span data-stu-id="40931-122">If the filter supports **IAMPushSource**, the Filter Graph Manager calls [**IAMLatency::GetLatency**](/windows/desktop/api/Strmif/nf-strmif-iamlatency-getlatency) to retrieve the filter's expected latency.</span></span> <span data-ttu-id="40931-123">(L’interface **IAMPushSource** hérite de [**IAMLatency**](/windows/desktop/api/Strmif/nn-strmif-iamlatency).) À partir des valeurs de latence combinées, le gestionnaire de graphes de filtre détermine la latence maximale attendue dans le graphique.</span><span class="sxs-lookup"><span data-stu-id="40931-123">(The **IAMPushSource** interface inherits [**IAMLatency**](/windows/desktop/api/Strmif/nn-strmif-iamlatency).) From the combined latency values, the Filter Graph Manager determines the maximum expected latency in the graph.</span></span> <span data-ttu-id="40931-124">Il appelle ensuite [**IAMPushSource :: SetStreamOffset**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-setstreamoffset) pour attribuer à chaque filtre source un décalage de flux, que le filtre ajoute aux horodatages qu’il génère.</span><span class="sxs-lookup"><span data-stu-id="40931-124">It then calls [**IAMPushSource::SetStreamOffset**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-setstreamoffset) to give each source filter a stream offset, which that filter adds to the time stamps that it generates.</span></span>

<span data-ttu-id="40931-125">Cette méthode est principalement destinée à l’aperçu instantané.</span><span class="sxs-lookup"><span data-stu-id="40931-125">This method is intended primarily for live preview.</span></span> <span data-ttu-id="40931-126">Toutefois, Notez qu’un code PIN sur un appareil de capture dynamique (par exemple, un appareil photo) ne définit pas d’horodatage sur les échantillons qu’il livre.</span><span class="sxs-lookup"><span data-stu-id="40931-126">However, note that a preview pin on a live capture device (such as a camera) does not set time stamps on the samples it delivers.</span></span> <span data-ttu-id="40931-127">Par conséquent, pour utiliser cette méthode avec un appareil de capture dynamique, vous devez afficher un aperçu à partir du code confidentiel de capture.</span><span class="sxs-lookup"><span data-stu-id="40931-127">Therefore, to use this method with a live capture device, you must preview from the capture pin.</span></span> <span data-ttu-id="40931-128">Pour plus d’informations, consultez [filtres de capture vidéo DirectShow](directshow-video-capture-filters.md).</span><span class="sxs-lookup"><span data-stu-id="40931-128">For more information, see [DirectShow Video Capture Filters](directshow-video-capture-filters.md).</span></span>

<span data-ttu-id="40931-129">Actuellement, l’interface [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) est prise en charge par le filtre de [capture VFW](vfw-capture-filter.md) et le filtre de [capture audio](audio-capture-filter.md) .</span><span class="sxs-lookup"><span data-stu-id="40931-129">Currently the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface is supported by the [VFW Capture](vfw-capture-filter.md) filter and the [Audio Capture](audio-capture-filter.md) filter.</span></span>

<span data-ttu-id="40931-130">**Correspondance des taux**</span><span class="sxs-lookup"><span data-stu-id="40931-130">**Rate Matching**</span></span>

<span data-ttu-id="40931-131">Si un filtre de convertisseur planifie des exemples à l’aide d’une horloge de référence, mais que le filtre source les produit à l’aide d’une horloge différente, des problèmes peuvent se produire lors de la lecture.</span><span class="sxs-lookup"><span data-stu-id="40931-131">If a renderer filter schedules samples using one reference clock, but the source filter produces them using a different clock, glitches can occur in playback.</span></span> <span data-ttu-id="40931-132">Le convertisseur peut s’exécuter plus rapidement que la source, provoquant ainsi des écarts dans les données.</span><span class="sxs-lookup"><span data-stu-id="40931-132">The renderer might run faster than the source, causing gaps in the data.</span></span> <span data-ttu-id="40931-133">Ou elle peut s’exécuter plus lentement que la source, provoquant ainsi des échantillons « bottes » jusqu’à un moment où le graphique dépose des exemples.</span><span class="sxs-lookup"><span data-stu-id="40931-133">Or it might run slower than the source, causing samples to "bunch up," until at some point the graph will drop samples.</span></span> <span data-ttu-id="40931-134">En règle générale, une source dynamique ne peut pas contrôler son taux de production. au lieu de cela, le convertisseur doit faire correspondre les tarifs avec la source.</span><span class="sxs-lookup"><span data-stu-id="40931-134">Typically, a live source cannot control its production rate, so instead the renderer should match rates with the source.</span></span>

<span data-ttu-id="40931-135">Actuellement, seul le convertisseur audio effectue la correspondance des taux, car les problèmes de lecture audio sont plus perceptibles que les problèmes dans la vidéo.</span><span class="sxs-lookup"><span data-stu-id="40931-135">Currently, only the audio renderer performs rate matching, because glitches in audio playback are more noticeable than glitches in video.</span></span> <span data-ttu-id="40931-136">Pour effectuer la mise en correspondance des taux, le convertisseur audio doit sélectionner un texte sur lequel il correspondra aux tarifs.</span><span class="sxs-lookup"><span data-stu-id="40931-136">To perform rate-matching, the audio renderer must select something against which it will match rates.</span></span> <span data-ttu-id="40931-137">Il utilise l’algorithme suivant :</span><span class="sxs-lookup"><span data-stu-id="40931-137">It uses the following algorithm:</span></span>

-   <span data-ttu-id="40931-138">Si le graphique n’utilise pas une horloge de référence, le convertisseur audio ne tente pas de faire correspondre les taux.</span><span class="sxs-lookup"><span data-stu-id="40931-138">If the graph is not using a reference clock, the audio renderer does not try to match rates.</span></span> <span data-ttu-id="40931-139">(Chaque fois que le graphique n’a aucune horloge de référence, les échantillons sont toujours restitués immédiatement à mesure qu’ils arrivent.)</span><span class="sxs-lookup"><span data-stu-id="40931-139">(Whenever the graph has no reference clock, samples are always rendered immediately as they arrive.)</span></span>
-   <span data-ttu-id="40931-140">Sinon, s’il existe une horloge de référence pour le graphique, le convertisseur audio vérifie s’il existe une source dynamique en direct, à l’aide des critères décrits précédemment.</span><span class="sxs-lookup"><span data-stu-id="40931-140">Otherwise, if there is a reference clock for the graph, the audio renderer checks whether there is a live source upstream, using the criteria described previously.</span></span> <span data-ttu-id="40931-141">Si ce n’est pas le cas, le convertisseur audio ne correspond pas aux tarifs.</span><span class="sxs-lookup"><span data-stu-id="40931-141">If not, the audio renderer does not match rates.</span></span>
-   <span data-ttu-id="40931-142">S’il existe une source dynamique en amont et que cette source expose l’interface [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) sur sa broche de sortie, le convertisseur audio appelle [**IAMPushSource :: GetPushSourceFlags**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags).</span><span class="sxs-lookup"><span data-stu-id="40931-142">If there is a live source upstream, and that source exposes the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface on its output pin, the audio renderer calls [**IAMPushSource::GetPushSourceFlags**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags).</span></span> <span data-ttu-id="40931-143">Il recherche l’un des indicateurs suivants :</span><span class="sxs-lookup"><span data-stu-id="40931-143">It looks for one of the following flags:</span></span>
    -   <span data-ttu-id="40931-144">\_RM PUSHSOURCECAPS \_ interne \_ .</span><span class="sxs-lookup"><span data-stu-id="40931-144">AM\_PUSHSOURCECAPS\_INTERNAL\_RM.</span></span> <span data-ttu-id="40931-145">Cet indicateur signifie que le filtre source a son propre mécanisme de correspondance des taux, de sorte que le convertisseur audio ne correspond pas aux tarifs.</span><span class="sxs-lookup"><span data-stu-id="40931-145">This flag means the source filter has its own rate-matching mechanism, so the audio renderer does not match rates.</span></span>
    -   <span data-ttu-id="40931-146">AM \_ PUSHSOURCECAPS \_ pas en \_ ligne.</span><span class="sxs-lookup"><span data-stu-id="40931-146">AM\_PUSHSOURCECAPS\_NOT\_LIVE.</span></span> <span data-ttu-id="40931-147">Cet indicateur signifie que le filtre source n’est pas vraiment une source dynamique, même s’il expose l’interface [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) .</span><span class="sxs-lookup"><span data-stu-id="40931-147">This flag means the source filter is not really a live source, even though it exposes the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface.</span></span> <span data-ttu-id="40931-148">Par conséquent, le convertisseur audio ne correspond pas aux tarifs.</span><span class="sxs-lookup"><span data-stu-id="40931-148">Therefore, the audio renderer does not match rates.</span></span>
    -   <span data-ttu-id="40931-149">\_ \_ heure privée am PUSHSOURCECAPS \_ .</span><span class="sxs-lookup"><span data-stu-id="40931-149">AM\_PUSHSOURCECAPS\_PRIVATE\_CLOCK.</span></span> <span data-ttu-id="40931-150">Cet indicateur signifie que le filtre source utilise une horloge privée pour générer des horodatages.</span><span class="sxs-lookup"><span data-stu-id="40931-150">This flag means the source filter is using a private clock to generate time stamps.</span></span> <span data-ttu-id="40931-151">Dans ce cas, le convertisseur audio correspond aux tarifs par rapport aux horodatages.</span><span class="sxs-lookup"><span data-stu-id="40931-151">In this case, the audio renderer matches rates against the time stamps.</span></span> <span data-ttu-id="40931-152">(Si les exemples n’ont pas de datage, toutefois, le convertisseur ignore cet indicateur.)</span><span class="sxs-lookup"><span data-stu-id="40931-152">(If the samples have no time stamps, however, the renderer ignores this flag.)</span></span>
-   <span data-ttu-id="40931-153">Si [**GetPushSourceFlags**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags) ne retourne aucun indicateur (zéro), le comportement du convertisseur audio dépend de l’horloge du graphique et si les exemples ont des horodatages :</span><span class="sxs-lookup"><span data-stu-id="40931-153">If [**GetPushSourceFlags**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags) returns no flags (zero), the audio renderer's behavior depends on the graph clock and whether the samples have time stamps:</span></span>
    -   <span data-ttu-id="40931-154">Si le convertisseur audio n’est pas l’horloge graphique et que les échantillons ont des horodateurs, le convertisseur audio fait correspondre les taux aux horodatages.</span><span class="sxs-lookup"><span data-stu-id="40931-154">If the audio renderer is not the graph clock, AND the samples have time stamps, the audio renderer matches rates against the time stamps.</span></span>
    -   <span data-ttu-id="40931-155">Si les exemples n’ont pas de datage, le convertisseur audio tente de faire correspondre le taux de données audio entrantes.</span><span class="sxs-lookup"><span data-stu-id="40931-155">If the samples do not have time stamps, the audio renderer tries to match the rate of incoming audio data.</span></span>
    -   <span data-ttu-id="40931-156">Si le convertisseur audio est l’horloge graphique, il tente de faire correspondre le débit des données entrantes.</span><span class="sxs-lookup"><span data-stu-id="40931-156">If the audio renderer is the graph clock, it tries to match the incoming data rate.</span></span>

<span data-ttu-id="40931-157">La raison du dernier cas est la suivante : si le convertisseur audio est l’horloge de référence et que le filtre source utilise la même horloge pour générer des horodatages, le convertisseur audio ne peut pas faire correspondre les taux aux horodatages.</span><span class="sxs-lookup"><span data-stu-id="40931-157">The reason for the last case is the following: If the audio renderer is the reference clock, and the source filter is using the same clock to generate time stamps, then the audio renderer cannot match rates against the time stamps.</span></span> <span data-ttu-id="40931-158">Si c’est le cas, il tenterait de faire correspondre les vitesses avec lui-même, ce qui pourrait entraîner la dérive de l’horloge.</span><span class="sxs-lookup"><span data-stu-id="40931-158">If it did, in effect it would be trying to match rates with itself, which could cause the clock to drift.</span></span> <span data-ttu-id="40931-159">Par conséquent, dans ce cas, le convertisseur correspond au taux de données audio entrantes.</span><span class="sxs-lookup"><span data-stu-id="40931-159">Therefore, in this case the renderer matches the rate of incoming audio data.</span></span>

## <a name="related-topics"></a><span data-ttu-id="40931-160">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="40931-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="40931-161">Temps et horloges dans DirectShow</span><span class="sxs-lookup"><span data-stu-id="40931-161">Time and Clocks in DirectShow</span></span>](time-and-clocks-in-directshow.md)
</dt> </dl>

 

 



