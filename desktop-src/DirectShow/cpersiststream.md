---
description: CPersistStream est la classe de base pour les propriétés persistantes des filtres (c’est-à-dire les propriétés de filtre dans les graphiques enregistrés).
ms.assetid: 8073e2be-aaf9-4b01-a7d5-bab5c1dcc19b
title: CPersistStream, classe
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- CPersistStream
api_type:
- COM
api_location: ''
ms.openlocfilehash: 690a0f45fab7c3612d215a859798460abc81728e
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104520783"
---
# <a name="cpersiststream-class"></a><span data-ttu-id="c51ba-103">CPersistStream, classe</span><span class="sxs-lookup"><span data-stu-id="c51ba-103">CPersistStream class</span></span>

![hiérarchie de la classe cpersiststream](images/pstrm01.png)

<span data-ttu-id="c51ba-105">`CPersistStream` est la classe de base pour les propriétés persistantes des filtres (c’est-à-dire les propriétés de filtre dans les graphiques enregistrés).</span><span class="sxs-lookup"><span data-stu-id="c51ba-105">`CPersistStream` is the base class for persistent properties of filters (that is, filter properties in saved graphs).</span></span>

<span data-ttu-id="c51ba-106">La façon la plus simple d’utiliser `CPersistStream` consiste à :</span><span class="sxs-lookup"><span data-stu-id="c51ba-106">The simplest way to use `CPersistStream` is to:</span></span>

1.  <span data-ttu-id="c51ba-107">Organisez votre filtre pour qu’il hérite de cette classe.</span><span class="sxs-lookup"><span data-stu-id="c51ba-107">Arrange for your filter to inherit this class.</span></span>
2.  <span data-ttu-id="c51ba-108">Implémentez [**WriteToStream**](cpersiststream-writetostream.md) et [**readFromStream**](cpersiststream-readfromstream.md) dans votre classe.</span><span class="sxs-lookup"><span data-stu-id="c51ba-108">Implement [**WriteToStream**](cpersiststream-writetostream.md) and [**ReadFromStream**](cpersiststream-readfromstream.md) in your class.</span></span> <span data-ttu-id="c51ba-109">Celles-ci remplacent les fonctions ici, qui ne font rien, mais agissent comme des espaces réservés.</span><span class="sxs-lookup"><span data-stu-id="c51ba-109">These will override the functions here, which do nothing but act as placeholders.</span></span>
3.  <span data-ttu-id="c51ba-110">Modifiez votre **NonDelegatingQueryInterface** pour gérer **IPersistStream**.</span><span class="sxs-lookup"><span data-stu-id="c51ba-110">Change your **NonDelegatingQueryInterface** to handle **IPersistStream**.</span></span>
4.  <span data-ttu-id="c51ba-111">Implémentez [**SizeMax**](cpersiststream-sizemax.md) pour retourner une limite supérieure au nombre d’octets de données que vous enregistrez.</span><span class="sxs-lookup"><span data-stu-id="c51ba-111">Implement [**SizeMax**](cpersiststream-sizemax.md) to return an upper bound on the number of bytes of data you save.</span></span>

    <span data-ttu-id="c51ba-112">Si vous enregistrez des données Unicode™, n’oubliez pas qu’un WCHAR est de 2 octets.</span><span class="sxs-lookup"><span data-stu-id="c51ba-112">If you save Unicode™ data, remember that a WCHAR is 2 bytes.</span></span>

5.  <span data-ttu-id="c51ba-113">Lorsque vos données changent, appelez [**SetDirty**](cpersiststream-setdirty.md).</span><span class="sxs-lookup"><span data-stu-id="c51ba-113">When your data changes, call [**SetDirty**](cpersiststream-setdirty.md).</span></span>

## <a name="version-numbers"></a><span data-ttu-id="c51ba-114">Numéros de versions</span><span class="sxs-lookup"><span data-stu-id="c51ba-114">Version Numbers</span></span>

<span data-ttu-id="c51ba-115">À un moment donné, vous pouvez décider de modifier ou d’étendre le format de vos données.</span><span class="sxs-lookup"><span data-stu-id="c51ba-115">At some point you might decide to alter or extend the format of your data.</span></span> <span data-ttu-id="c51ba-116">Vous souhaiterez alors avoir un numéro de version dans tous les anciens flux enregistrés, ce qui vous permettra de savoir, quand vous les lisez, s’ils représentent l’ancien ou le nouveau formulaire.</span><span class="sxs-lookup"><span data-stu-id="c51ba-116">You will then wish you had a version number in all the old saved streams so you can tell, when you read them, whether they represent the old or new form.</span></span> <span data-ttu-id="c51ba-117">Pour vous aider, cette classe écrit et lit un numéro de version.</span><span class="sxs-lookup"><span data-stu-id="c51ba-117">To assist you, this class writes and reads a version number.</span></span> <span data-ttu-id="c51ba-118">Lorsqu’il écrit, il appelle [**GetSoftwareVersion**](cpersiststream-getsoftwareversion.md) pour se renseigner sur la version du logiciel actuellement utilisée.</span><span class="sxs-lookup"><span data-stu-id="c51ba-118">When it writes, it calls [**GetSoftwareVersion**](cpersiststream-getsoftwareversion.md) to inquire as to the version of the software being used at the moment.</span></span> <span data-ttu-id="c51ba-119">(En fait, il s’agit d’un numéro de version de la disposition des données dans le fichier.) Il écrit ceci comme première chose dans les données.</span><span class="sxs-lookup"><span data-stu-id="c51ba-119">(In effect, this is a version number of the data layout in the file.) It writes this as the first thing in the data.</span></span> <span data-ttu-id="c51ba-120">Si vous souhaitez modifier la version, implémentez (override) **GetSoftwareVersion**.</span><span class="sxs-lookup"><span data-stu-id="c51ba-120">If you want to change the version, implement (override) **GetSoftwareVersion**.</span></span> <span data-ttu-id="c51ba-121">Il lit le numéro de version du fichier dans **MPS \_ dwFileVersion** avant d’appeler [**readFromStream**](cpersiststream-readfromstream.md). ainsi, dans **readFromStream** , vous pouvez vérifier les **\_ dwFileVersion MPS** pour voir si vous lisez un ancien fichier de version.</span><span class="sxs-lookup"><span data-stu-id="c51ba-121">It reads the version number from the file into **mPS\_dwFileVersion** before calling [**ReadFromStream**](cpersiststream-readfromstream.md), so in **ReadFromStream** you can check **mPS\_dwFileVersion** to see if you are reading an old version file.</span></span> <span data-ttu-id="c51ba-122">En général, vous devez accepter les fichiers dont la version n’est pas plus récente que la version du logiciel qui les lit.</span><span class="sxs-lookup"><span data-stu-id="c51ba-122">Usually you should accept files whose version is no newer than the software version that is reading them.</span></span>

<span data-ttu-id="c51ba-123">**CPersistStream** implémente [**IPersistStream**](/windows/desktop/api/objidl/nn-objidl-ipersiststream).</span><span class="sxs-lookup"><span data-stu-id="c51ba-123">**CPersistStream** implements [**IPersistStream**](/windows/desktop/api/objidl/nn-objidl-ipersiststream).</span></span> <span data-ttu-id="c51ba-124">Pour plus d’informations sur l’implémentation, consultez la référence COM dans le kit de développement logiciel (SDK) Microsoft Platform.</span><span class="sxs-lookup"><span data-stu-id="c51ba-124">For more implementation information, see the COM Reference in the Microsoft Platform SDK.</span></span>



| <span data-ttu-id="c51ba-125">Membres de données protégés</span><span class="sxs-lookup"><span data-stu-id="c51ba-125">Protected Data Members</span></span>                                          | <span data-ttu-id="c51ba-126">Description</span><span class="sxs-lookup"><span data-stu-id="c51ba-126">Description</span></span>                                                                   |
|-----------------------------------------------------------------|-------------------------------------------------------------------------------|
| <span data-ttu-id="c51ba-127">\_DwFileVersion mPS</span><span class="sxs-lookup"><span data-stu-id="c51ba-127">mPS\_dwFileVersion</span></span>                                              | <span data-ttu-id="c51ba-128">Numéro de version du fichier.</span><span class="sxs-lookup"><span data-stu-id="c51ba-128">Version number of the file.</span></span>                                                   |
| <span data-ttu-id="c51ba-129">\_FDirty mPS</span><span class="sxs-lookup"><span data-stu-id="c51ba-129">mPS\_fDirty</span></span>                                                     | <span data-ttu-id="c51ba-130">Les données de ce flux doivent être enregistrées.</span><span class="sxs-lookup"><span data-stu-id="c51ba-130">Data for this stream must be saved.</span></span>                                           |
| <span data-ttu-id="c51ba-131">Fonctions de membre</span><span class="sxs-lookup"><span data-stu-id="c51ba-131">Member Functions</span></span>                                                | <span data-ttu-id="c51ba-132">Description</span><span class="sxs-lookup"><span data-stu-id="c51ba-132">Description</span></span>                                                                   |
| [<span data-ttu-id="c51ba-133">**CPersistStream**</span><span class="sxs-lookup"><span data-stu-id="c51ba-133">**CPersistStream**</span></span>](cpersiststream-cpersiststream.md)         | <span data-ttu-id="c51ba-134">Construit un objet **CPersistStream** .</span><span class="sxs-lookup"><span data-stu-id="c51ba-134">Constructs a **CPersistStream** object.</span></span>                                       |
| [<span data-ttu-id="c51ba-135">**SetDirty**</span><span class="sxs-lookup"><span data-stu-id="c51ba-135">**SetDirty**</span></span>](cpersiststream-setdirty.md)                     | <span data-ttu-id="c51ba-136">Indique que l’objet doit être enregistré dans le flux.</span><span class="sxs-lookup"><span data-stu-id="c51ba-136">Indicates that the object must be saved to the stream.</span></span>                        |
| <span data-ttu-id="c51ba-137">Fonctions membres substituables</span><span class="sxs-lookup"><span data-stu-id="c51ba-137">Overridable Member Functions</span></span>                                    | <span data-ttu-id="c51ba-138">Description</span><span class="sxs-lookup"><span data-stu-id="c51ba-138">Description</span></span>                                                                   |
| [<span data-ttu-id="c51ba-139">**GetClassID**</span><span class="sxs-lookup"><span data-stu-id="c51ba-139">**GetClassID**</span></span>](cpersiststream-getclassid.md)                 | <span data-ttu-id="c51ba-140">Récupère l’identificateur de classe de ce flux.</span><span class="sxs-lookup"><span data-stu-id="c51ba-140">Retrieves the class identifier of this stream.</span></span>                                |
| [<span data-ttu-id="c51ba-141">**GetSoftwareVersion**</span><span class="sxs-lookup"><span data-stu-id="c51ba-141">**GetSoftwareVersion**</span></span>](cpersiststream-getsoftwareversion.md) | <span data-ttu-id="c51ba-142">Récupère le numéro de version pour ce format de fichier.</span><span class="sxs-lookup"><span data-stu-id="c51ba-142">Retrieves the version number for this file format.</span></span>                            |
| [<span data-ttu-id="c51ba-143">**ReadFromStream**</span><span class="sxs-lookup"><span data-stu-id="c51ba-143">**ReadFromStream**</span></span>](cpersiststream-readfromstream.md)         | <span data-ttu-id="c51ba-144">Lit les données du filtre à partir du flux.</span><span class="sxs-lookup"><span data-stu-id="c51ba-144">Reads the filter's data from the stream.</span></span>                                      |
| [<span data-ttu-id="c51ba-145">**SizeMax**</span><span class="sxs-lookup"><span data-stu-id="c51ba-145">**SizeMax**</span></span>](cpersiststream-sizemax.md)                       | <span data-ttu-id="c51ba-146">Récupère le nombre d’octets nécessaires pour les données (à l’exclusion du numéro de version).</span><span class="sxs-lookup"><span data-stu-id="c51ba-146">Retrieves the number of bytes needed for data (not including version number).</span></span> |
| [<span data-ttu-id="c51ba-147">**WriteToStream**</span><span class="sxs-lookup"><span data-stu-id="c51ba-147">**WriteToStream**</span></span>](cpersiststream-writetostream.md)           | <span data-ttu-id="c51ba-148">Écrit les données du filtre dans le flux.</span><span class="sxs-lookup"><span data-stu-id="c51ba-148">Writes the filter's data to the stream.</span></span>                                       |
| <span data-ttu-id="c51ba-149">IPersistStream, méthodes</span><span class="sxs-lookup"><span data-stu-id="c51ba-149">IPersistStream Methods</span></span>                                          | <span data-ttu-id="c51ba-150">Description</span><span class="sxs-lookup"><span data-stu-id="c51ba-150">Description</span></span>                                                                   |
| [<span data-ttu-id="c51ba-151">**GetSizeMax**</span><span class="sxs-lookup"><span data-stu-id="c51ba-151">**GetSizeMax**</span></span>](cpersiststream-getsizemax.md)                 | <span data-ttu-id="c51ba-152">Récupère le nombre d’octets nécessaires pour les données (y compris le numéro de version).</span><span class="sxs-lookup"><span data-stu-id="c51ba-152">Retrieves the number of bytes needed for data (including version number).</span></span>     |
| [<span data-ttu-id="c51ba-153">**IsDirty**</span><span class="sxs-lookup"><span data-stu-id="c51ba-153">**IsDirty**</span></span>](cpersiststream-isdirty.md)                       | <span data-ttu-id="c51ba-154">Vérifie si l’objet doit être enregistré.</span><span class="sxs-lookup"><span data-stu-id="c51ba-154">Checks if the object must be saved.</span></span>                                           |
| [<span data-ttu-id="c51ba-155">**Load**</span><span class="sxs-lookup"><span data-stu-id="c51ba-155">**Load**</span></span>](cpersiststream-load.md)                             | <span data-ttu-id="c51ba-156">Charge les données du flux en mémoire.</span><span class="sxs-lookup"><span data-stu-id="c51ba-156">Loads the data from the stream into memory.</span></span>                                   |
| [<span data-ttu-id="c51ba-157">**Enregistrer**</span><span class="sxs-lookup"><span data-stu-id="c51ba-157">**Save**</span></span>](cpersiststream-save.md)                             | <span data-ttu-id="c51ba-158">Enregistre les données de la mémoire dans le flux.</span><span class="sxs-lookup"><span data-stu-id="c51ba-158">Saves the data from memory to the stream.</span></span>                                     |



 

 

 
