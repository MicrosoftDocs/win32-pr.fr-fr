---
description: Spécification opérationnelle DirectX Video Acceleration IAMVideoAccelerator
ms.assetid: 25ee05d5-8554-4739-9122-e3c0255bf965
title: Spécification opérationnelle DirectX Video Acceleration IAMVideoAccelerator
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3360e18e91197f2a15a36fb112f0419b6382e915
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "103949977"
---
# <a name="directx-video-acceleration-iamvideoaccelerator-operational-specification"></a><span data-ttu-id="30277-103">Spécification opérationnelle DirectX Video Acceleration IAMVideoAccelerator</span><span class="sxs-lookup"><span data-stu-id="30277-103">DirectX Video Acceleration IAMVideoAccelerator Operational Specification</span></span>

<span data-ttu-id="30277-104">Le mécanisme de fonctionnement précis est le suivant :</span><span class="sxs-lookup"><span data-stu-id="30277-104">The precise mechanism of operation is as follows:</span></span>

1.  <span data-ttu-id="30277-105">Chaque profil de mode restreint défini dans le présentateur est associé à un GUID DirectX VA qui peut être pris en charge par les [**IPIN :: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) et [**IPIN :: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) d’une broche d’entrée en aval et est listé dans [**IAMVideoAccelerator :: GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span><span class="sxs-lookup"><span data-stu-id="30277-105">Each restricted mode profile defined herein has an associated DirectX VA GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in [**IAMVideoAccelerator::GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span></span>
2.  <span data-ttu-id="30277-106">De même, chaque type de protocole de chiffrement à utiliser avec DirectX VA doit avoir un GUID de type de protocole de chiffrement associé qui peut être pris en charge par les [**IPIN :: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) et [**IPIN :: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) d’une broche d’entrée en aval, et est listé dans **IAMVideoAccelerator :: GetVideoAcceleratorGUIDs**.</span><span class="sxs-lookup"><span data-stu-id="30277-106">Similarly, each encryption protocol type for use with DirectX VA shall have an associated encryption protocol type GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in **IAMVideoAccelerator::GetVideoAcceleratorGUIDs**.</span></span> <span data-ttu-id="30277-107">Le GUID « aucun chiffrement » DXVA \_ Noencrypt ne doit pas être envoyé dans cette liste, car sa prise en charge est requise et par conséquent implicite.</span><span class="sxs-lookup"><span data-stu-id="30277-107">The "no encryption" GUID DXVA\_NoEncrypt shall not be sent in this list, as support for it is required and therefore implicit.</span></span>
3.  <span data-ttu-id="30277-108">Après l’appel de [**IPIN :: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) pour tenter une connexion à la broche d’entrée en aval, le décodeur [**IAMVideoAcceleratorNotify :: GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) doit retourner un pointeur vers une \_ structure de données DXVA connectMode contenant les informations relatives au mode de connexion pour la connexion.</span><span class="sxs-lookup"><span data-stu-id="30277-108">After calling [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) to attempt a connection to the downstream input pin, the decoder's [**IAMVideoAcceleratorNotify::GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) shall return a pointer to a DXVA\_ConnectMode data structure containing the connection mode information for the connection.</span></span> <span data-ttu-id="30277-109">[**IAMVideoAccelerator :: GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) est appelé avec \* pdwNumTypesCompBuffers = 16 et retourne des informations sur la mémoire tampon compressées en fonction de la Convention selon laquelle le numéro de type de chaque mémoire tampon (tel que défini dans la section 3,4 de la spécification DirectX va) peut être utilisé directement comme index de base zéro dans le tableau de structures de données **AMVACompBufferInfo** qui est retourné.</span><span class="sxs-lookup"><span data-stu-id="30277-109">[**IAMVideoAccelerator::GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) shall be called with \*pdwNumTypesCompBuffers = 16 and shall return compressed buffer information based on the convention that the type number of each buffer (as defined in Section 3.4 of the DirectX VA specification) can be used directly as the zero-based index into the array of **AMVACompBufferInfo** data structures that is returned.</span></span> <span data-ttu-id="30277-110">Cela requiert que pour tous les types de mémoire tampon qui ne seront pas utilisés (y compris le type de mémoire tampon 0, étant donné qu’il n’y a aucune utilisation définie de ce type de tampon), le pilote d’accélérateur fournira des structures de données AMVACompBufferInfo avec une forme de valeurs de paramètre « factices » (par exemple, dwNumCompBuffers = 0, dwWidthToCreate = 0, dwHeightToCreate = 0 et</span><span class="sxs-lookup"><span data-stu-id="30277-110">This requires that for any buffer types that will not be used (including buffer type 0, since there is no defined use of that buffer type), the accelerator driver will provide AMVACompBufferInfo data structures with some form of "dummy" parameter values (such as dwNumCompBuffers=0, dwWidthToCreate=0, dwHeightToCreate=0, and dwBytesToAllocate=0).</span></span>
4.  <span data-ttu-id="30277-111">Les indications de fonction DXVA et les mémoires tampons de données associées sont envoyées à l’aide de [**IAMVideoAccelerator :: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span><span class="sxs-lookup"><span data-stu-id="30277-111">DXVA function indications and associated data buffers are sent using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="30277-112">La fonction DXVA est indiquée dans le paramètre dwFunction de l’appel.</span><span class="sxs-lookup"><span data-stu-id="30277-112">The DXVA function is indicated in the dwFunction parameter of the call.</span></span> <span data-ttu-id="30277-113">Les seules fonctions DXVA pertinentes pour l’initialisation sont DXVA \_ ConfigQueryOrReplyFunc et DXVA \_ EncryptProtocolFunc.</span><span class="sxs-lookup"><span data-stu-id="30277-113">The only DXVA functions that are relevant for initialization are DXVA\_ConfigQueryOrReplyFunc and DXVA\_EncryptProtocolFunc.</span></span>
    -   <span data-ttu-id="30277-114">Si dwFunction contient un \_ CONFIGQUERYORREPLYFUNC DXVA, le pointeur lpPrivateInputData pour passer des données à l’accélérateur dans cet appel doit pointer vers une structure de données de configuration, le pointeur lpPrivateOutputData pour la réception d’informations à partir de l’accélérateur pointera vers une zone dans laquelle une autre structure ou une structure de données de configuration dupliquée peut être placée</span><span class="sxs-lookup"><span data-stu-id="30277-114">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="30277-115">Le HRESULT retourné contient l' \_ indication s OK ou s \_ false, ou e \_ Fail ou e \_ INVALIDARG ou une autre indication d’erreur HRESULT en cas de problème grave dans l’exécution du protocole (par exemple, un paramètre de configuration non valide).</span><span class="sxs-lookup"><span data-stu-id="30277-115">The returned HRESULT contains the S\_OK or S\_FALSE indication, or E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid configuration parameter).</span></span> <span data-ttu-id="30277-116">Tous les appels à **IAMVideoAccelerator :: Execute** pour toutes les utilisations de DXVA \_ ConfigQueryOrReplyFunc doivent précéder tous les autres appels à **IAMVideoAccelerator :: Execute**.</span><span class="sxs-lookup"><span data-stu-id="30277-116">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="30277-117">Si dwFunction contient un \_ ENCRYPTPROTOCOLFUNC DXVA, le pointeur lpPrivateInputData pour passer des données à l’accélérateur dans cet appel doit pointer vers une structure de données de protocole de chiffrement qui commence par DXVA \_ EncryptProtocolHeader, le pointeur lpPrivateOutputData pour la réception d’informations à partir de l’accélérateur doit pointer vers une zone où les données à retourner (par exemple, un certificat) par le protocole de chiffrement (qui commence par DXVA \_ EncryptProtocolHeader) peuvent être placées, le pointeur pamvaBufferInfo pour un tableau de AMVABUFFERINFO doit avoir la **valeur null**, et dwNumBuffers doit être égal à zéro.</span><span class="sxs-lookup"><span data-stu-id="30277-117">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="30277-118">Le HRESULT retourné contient la \_ valeur S tant que le protocole de chiffrement fonctionne normalement et contient e \_ Fail ou e \_ INVALIDARG ou une autre indication d’erreur HRESULT en cas de problème grave dans l’exécution du protocole.</span><span class="sxs-lookup"><span data-stu-id="30277-118">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>

        <span data-ttu-id="30277-119">Après l’initialisation de l’opération de la manière décrite ci-dessus, le fonctionnement réel du décodeur se déroule comme suit :</span><span class="sxs-lookup"><span data-stu-id="30277-119">After initialization of operation in the above fashion, the actual operation of the decoder proceeds as follows:</span></span>

5.  <span data-ttu-id="30277-120">**IAMVideoAccelerator :: BeginFrame** doit être appelé avant l’envoi d’une \_ fonction bDXVA avec des paramètres de mémoire tampon compressés, ce qui entraîne des écritures sur une surface de destination non compressée.</span><span class="sxs-lookup"><span data-stu-id="30277-120">**IAMVideoAccelerator::BeginFrame** shall be called prior to sending any bDXVA\_Func with compressed buffer parameters which cause writes to an uncompressed destination surface.</span></span> <span data-ttu-id="30277-121">L’objectif de [**IAMVideoAccelerator :: BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) dans DirectX va est d’associer des surfaces de destination à des valeurs d’index et de notifier le pilote d’accélérateur vidéo de l’intention de lancer l’écriture d’une surface afin que le pilote puisse répondre en indiquant si la surface est prête à être remplacée.</span><span class="sxs-lookup"><span data-stu-id="30277-121">The purpose of [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) in DirectX VA is to associate destination surfaces with index values and to notify the video accelerator driver of the intent to initiate writes a surface so that the driver can respond with an indication of whether the surface is ready to be overwritten.</span></span> <span data-ttu-id="30277-122">La structure **AMVABeginFrameInfo** transmise dans **IAMVideoAccelerator :: BeginFrame** doit contenir un pointeur pInputData vers un paramètre de mot wBeginPictureIndex unique correspondant à l’index de frame passé dans **IAMVideoAccelerator :: BeginFrame** (et dwSizeInputData doit avoir la valeur 2).</span><span class="sxs-lookup"><span data-stu-id="30277-122">The **AMVABeginFrameInfo** structure passed in **IAMVideoAccelerator::BeginFrame** shall contain a pInputData pointer to single WORD wBeginPictureIndex parameter matching the frame index passed into **IAMVideoAccelerator::BeginFrame** (and dwSizeInputData shall be 2).</span></span> <span data-ttu-id="30277-123">Il s’agit de l’index à utiliser dans une mémoire tampon compressée pour commander une écriture sur la surface (par exemple, pour être utilisé en tant que wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex ou wPicResampleDestPicIndex).</span><span class="sxs-lookup"><span data-stu-id="30277-123">This is the index to be used in a compressed buffer to command a write to the surface (for example, to be used as wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="30277-124">Chaque appel à **IAMVideoAccelerator :: BeginFrame** doit être associé à un appel correspondant à [**IAMVideoAccelerator :: EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) , comme décrit ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="30277-124">Each call to **IAMVideoAccelerator::BeginFrame** shall be paired with a corresponding call to [**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) as described below.</span></span> <span data-ttu-id="30277-125">Par exemple, si une image compressée doit être décodée, puis fusionnée à l’aide de la fusion d’une mémoire tampon vers une mémoire tampon frontale vers une image graphique, un appel à **IAMVideoAccelerator :: BeginFrame** avant de décoder l’image compressée dans une surface spécifiée dans wDecodedPictureIndex, ensuite, un appel à **IAMVideoAccelerator :: EndFrame** après avoir passé toutes les mémoires tampons compressées utilisées pour décoder l’image, puis un deuxième appel à **IAMVideoAccelerator :: BeginFrame** avant d’effectuer le contrôle de la combinaison alpha de la source graphique avec l’image décodée dans une surface spécifiée dans wBlendedDestinationIndex, puis un deuxième appel à **IAMVideoAccelerator :: EndFrame** après l’opération de combinaison alpha Blend Le pointeur pOutputData dans AMVABeginFrameInfo doit avoir la **valeur null** (et dwSizeOutputData doit être « 0 »).</span><span class="sxs-lookup"><span data-stu-id="30277-125">For example, if a compressed picture is to be decoded and then alpha blended using front-end buffer-to-buffer blending with a graphic image, there would be a call to **IAMVideoAccelerator::BeginFrame** prior to decoding the compressed picture into a surface specified in wDecodedPictureIndex, then a call to **IAMVideoAccelerator::EndFrame** after passing all compressed buffers used to decode the picture, then a second call to **IAMVideoAccelerator::BeginFrame** prior to commanding alpha blending combination of the graphic source with the decoded picture into a surface specified in wBlendedDestinationIndex, and then a second call to **IAMVideoAccelerator::EndFrame** after the alpha blend combination operation.The pointer pOutputData in AMVABeginFrameInfo shall be **NULL** (and dwSizeOutputData shall be "0").</span></span> <span data-ttu-id="30277-126">Le HRESULT retourné par **IAMVideoAccelerator :: BeginFrame** doit être :</span><span class="sxs-lookup"><span data-stu-id="30277-126">The HRESULT that is returned by **IAMVideoAccelerator::BeginFrame** shall be:</span></span>
    -   <span data-ttu-id="30277-127">\_OK si l’aire non compressée est disponible et prête à l’emploi.</span><span class="sxs-lookup"><span data-stu-id="30277-127">S\_OK if the uncompressed surface is available and ready for use.</span></span>
    -   <span data-ttu-id="30277-128">E \_ en attente si la surface non compressée n’est pas encore disponible pour une utilisation mais sera bientôt disponible (si la surface non compressée est lue pour l’affichage et que la lecture/l’affichage de la surface n’est pas encore terminé).</span><span class="sxs-lookup"><span data-stu-id="30277-128">E\_PENDING if the uncompressed surface is not yet available for use but will become available soon (if the uncompressed surface is being read for display and the reading/display of the surface has not yet been completed).</span></span>
    -   <span data-ttu-id="30277-129">E \_ échoue ou e \_ INVALIDARG une autre indication d’erreur uniquement si un format de données ou une erreur de protocole est détecté (par exemple, une valeur incorrecte de dwSizeInputData ou un POutputData non **null** ).</span><span class="sxs-lookup"><span data-stu-id="30277-129">E\_FAIL or E\_INVALIDARG some other error indication only if a data format or protocol error is detected (such as an incorrect value of dwSizeInputData or a non-**NULL** pOutputData).</span></span>
6.  <span data-ttu-id="30277-130">Les indications de fonction DXVA et les mémoires tampons de données associées sont envoyées à l’aide de **IAMVideoAccelerator :: Execute**.</span><span class="sxs-lookup"><span data-stu-id="30277-130">DXVA function indications and associated data buffers are sent using **IAMVideoAccelerator::Execute**.</span></span> <span data-ttu-id="30277-131">Plusieurs \_ valeurs Func bDXVA peuvent être indiquées dans le même appel à [**IAMVideoAccelerator :: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span><span class="sxs-lookup"><span data-stu-id="30277-131">More than one bDXVA\_Func value may be indicated in the same call to [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="30277-132">Les \_ valeurs Func bDXVA doivent être empaquetées dans le paramètre dwFunction de l’appel, avec la première commande de fonction dans les huit MSBS, la commande suivante dans les huit bits suivants, et ainsi de suite, avec les bits restants complétés par des zéros.</span><span class="sxs-lookup"><span data-stu-id="30277-132">The bDXVA\_Func values shall be packed into the dwFunction parameter of the call, with the first function command in the eight MSBs, the next command in the next eight bits, and so on, with any remaining bits padded out with zeros.</span></span> <span data-ttu-id="30277-133">La valeur 0xFF pour bDXVA \_ Func indique que la \_ Func bDXVA est étendue à deux ou quatre octets.</span><span class="sxs-lookup"><span data-stu-id="30277-133">The value 0xFF for bDXVA\_Func indicates that the bDXVA\_Func is extended to two or four bytes.</span></span> <span data-ttu-id="30277-134">Si le deuxième octet est également 0xFF, cela indique que la fonction bDXVA \_ Func est étendue à quatre octets.</span><span class="sxs-lookup"><span data-stu-id="30277-134">If the second byte is also 0xFF, this indicates that bDXVA\_Func is extended to four bytes.</span></span> <span data-ttu-id="30277-135">Si les quatre bits supérieurs du troisième octet sont 0xF ou 0x0, cela indique que bDXVA \_ Func contient un CONFIGQUERYORREPLYFUNC DXVA \_ ou un \_ EncryptProtocolFunc DXVA.</span><span class="sxs-lookup"><span data-stu-id="30277-135">If the upper four bits of the third byte are 0xF or 0x0, this indicates that bDXVA\_Func contains a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc.</span></span> <span data-ttu-id="30277-136">Les commandes multi-octets ne doivent pas indiquer la continuation au-delà de la fin de dwFunction.</span><span class="sxs-lookup"><span data-stu-id="30277-136">Multi-byte commands shall not indicate continuation past the end of dwFunction.</span></span> <span data-ttu-id="30277-137">Le décodeur doit veiller à ce qu’aucune dépendance séquentielle ne soit présente entre différentes \_ valeurs Func bDXVA spécifiées dans le même appel à **IAMVideoAccelerator :: exécutez** et que toutes les conditions de concurrence potentielles (telles que le décodage d’image et la fusion de sous-image, entre le chargement de sous-image et la fusion de sous-image, etc.) sont évitées par les appels appropriés à **IAMVideoAccelerator :: BeginFrame** et [**IAMVideoAccelerator :: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) avant les appels suivants à **IAMVideoAccelerator :: Execute**.</span><span class="sxs-lookup"><span data-stu-id="30277-137">Care must be taken by the decoder to ensure that no sequential dependencies are present between different bDXVA\_Func values specified in the same call to **IAMVideoAccelerator::Execute** and that all potential race conditions (such as between picture decoding and sub-picture blending, between sub-picture loading and sub-picture blending, and so on) are prevented by appropriate calls to **IAMVideoAccelerator::BeginFrame** and [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) before subsequent calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="30277-138">Si dwFunction contient un \_ CONFIGQUERYORREPLYFUNC DXVA, le pointeur lpPrivateInputData pour passer des données à l’accélérateur dans cet appel doit pointer vers une structure de données de configuration, le pointeur lpPrivateOutputData pour la réception d’informations à partir de l’accélérateur pointera vers une zone dans laquelle une autre structure ou une structure de données de configuration dupliquée peut être placée</span><span class="sxs-lookup"><span data-stu-id="30277-138">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="30277-139">Le HRESULT retourné contient l' \_ indication s OK ou s \_ false en réponse à la requête, ou e \_ échoue ou e \_ INVALIDARG une autre indication d’erreur HRESULT en cas de problème grave dans l’exécution du protocole (par exemple, un paramètre invalid.configfiguration).</span><span class="sxs-lookup"><span data-stu-id="30277-139">The returned HRESULT contains the S\_OK or S\_FALSE indication in response to the query, or E\_FAIL or E\_INVALIDARG some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid.configuration parameter).</span></span> <span data-ttu-id="30277-140">Tous les appels à **IAMVideoAccelerator :: Execute** pour toutes les utilisations de DXVA \_ ConfigQueryOrReplyFunc doivent précéder tous les autres appels à **IAMVideoAccelerator :: Execute**.</span><span class="sxs-lookup"><span data-stu-id="30277-140">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="30277-141">Si dwFunction contient un \_ ENCRYPTPROTOCOLFUNC DXVA, le pointeur lpPrivateInputData pour passer des données à l’accélérateur dans cet appel doit pointer vers une structure de données de protocole de chiffrement qui commence par DXVA \_ EncryptProtocolHeader, le pointeur lpPrivateOutputData pour la réception d’informations à partir de l’accélérateur doit pointer vers une zone où les données à retourner (par exemple, un certificat) par le protocole de chiffrement (qui commence par DXVA \_ EncryptProtocolHeader) peuvent être placées, le pointeur pamvaBufferInfo pour un tableau de AMVABUFFERINFO doit avoir la **valeur null**, et dwNumBuffers doit être égal à zéro.</span><span class="sxs-lookup"><span data-stu-id="30277-141">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="30277-142">Le HRESULT retourné contient la \_ valeur S tant que le protocole de chiffrement fonctionne normalement et contient e \_ Fail ou e \_ INVALIDARG ou une autre indication d’erreur HRESULT en cas de problème grave dans l’exécution du protocole.</span><span class="sxs-lookup"><span data-stu-id="30277-142">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>
    -   <span data-ttu-id="30277-143">Si dwFunction ne contient pas de \_ ENCRYPTPROTOCOLFUNC DXVA ConfigQueryOrReplyFunc ou DXVA \_ , le pointeur lpPrivateInputData pour passer des données à l’accélérateur doit pointer vers une liste de descriptions de mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="30277-143">If dwFunction does not contain a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator shall point to a buffer description list.</span></span> <span data-ttu-id="30277-144">Les quatre premières entrées de la structure de la liste de description de la mémoire tampon pour chaque mémoire tampon (dwTypeIndex, dwBufferIndex, dwDataOffset et dwDataSize) doivent être égales à celles de la structure de données AMVABUFFERINFO pour la même mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="30277-144">The first four entries in the buffer description list structure for each buffer (dwTypeIndex, dwBufferIndex, dwDataOffset, and dwDataSize) shall be equal to those in the AMVABUFFERINFO data structure for the same buffer.</span></span> <span data-ttu-id="30277-145">Si la fonction bDXVA \_ Func est égale à « 1 » est spécifiée dans dwFunction et que bPicReadbackRequests a la valeur « 1 », le pointeur lpPrivateOutputData pour la réception d’informations à partir de l’accélérateur doit pointer vers une zone de mémoire persistante (par exemple, le tas) à remplir avec les données bloc macro en lecture à partir de l’accélérateur (ces données ne sont pas garanties comme étant présentes jusqu’à ce que **IAMVideoAccelerator :: QueryRenderStatus** pour l’écriture dans la même mémoire tampon des paramètres d’image indique le paramètre \_ OK comme décrit dans</span><span class="sxs-lookup"><span data-stu-id="30277-145">If bDXVA\_Func is equal to "1" is specified within dwFunction and bPicReadbackRequests is "1", the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area of persistent memory (for example heap) to be filled in with read-back macroblock data from the accelerator (such data not guaranteed to be present until **IAMVideoAccelerator::QueryRenderStatus** for writing to the same picture parameters buffer indicates S\_OK as described in item 10 below).</span></span> <span data-ttu-id="30277-146">Dans le cas contraire, le pointeur lpPrivateOutputData pour la réception d’informations à partir de l’accélérateur doit pointer vers une valeur DWORD unique pour être définie sur l’une des valeurs d’indication suivantes (particulièrement utile pour signaler des erreurs de flux binaire dans une opération de VLD hors hôte).</span><span class="sxs-lookup"><span data-stu-id="30277-146">Otherwise, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to a single DWORD to be set to one of the following indication values (particularly useful for reporting bitstream errors in off-host VLD operation).</span></span>

        | <span data-ttu-id="30277-147">Valeur</span><span class="sxs-lookup"><span data-stu-id="30277-147">Value</span></span> | <span data-ttu-id="30277-148">Description</span><span class="sxs-lookup"><span data-stu-id="30277-148">Description</span></span>                                     |
        |-------|-------------------------------------------------|
        | <span data-ttu-id="30277-149">0</span><span class="sxs-lookup"><span data-stu-id="30277-149">0</span></span>     | <span data-ttu-id="30277-150">Exécution OK.</span><span class="sxs-lookup"><span data-stu-id="30277-150">Execution OK.</span></span>                                   |
        | <span data-ttu-id="30277-151">1</span><span class="sxs-lookup"><span data-stu-id="30277-151">1</span></span>     | <span data-ttu-id="30277-152">Problème mineur au format de données rencontré.</span><span class="sxs-lookup"><span data-stu-id="30277-152">Minor problem in data format encountered.</span></span>       |
        | <span data-ttu-id="30277-153">2</span><span class="sxs-lookup"><span data-stu-id="30277-153">2</span></span>     | <span data-ttu-id="30277-154">Problème significatif au format de données rencontré.</span><span class="sxs-lookup"><span data-stu-id="30277-154">Significant problem in data format encountered.</span></span> |
        | <span data-ttu-id="30277-155">3</span><span class="sxs-lookup"><span data-stu-id="30277-155">3</span></span>     | <span data-ttu-id="30277-156">Un problème grave s’est produit au format de données.</span><span class="sxs-lookup"><span data-stu-id="30277-156">Severe problem in data format encountered.</span></span>      |
        | <span data-ttu-id="30277-157">4</span><span class="sxs-lookup"><span data-stu-id="30277-157">4</span></span>     | <span data-ttu-id="30277-158">Autre problème grave rencontré.</span><span class="sxs-lookup"><span data-stu-id="30277-158">Other severe problem encountered.</span></span>               |

        

         

        <span data-ttu-id="30277-159">Si l’un des types de problèmes « sérieux » est indiqué, le décodeur logiciel doit cesser d’utiliser la ou les fonctions à moins que des mesures correctives puissent être prises.</span><span class="sxs-lookup"><span data-stu-id="30277-159">If either type of "severe" problem is indicated, the software decoder should cease to operate the function(s) unless corrective action can be taken.</span></span> <span data-ttu-id="30277-160">Les données retournées par l’accélérateur ne seront pas lues par l’hôte tant que le rendu de la mémoire tampon de l’image n’est pas terminé, comme il peut être testé par [**IAMVideoAccelerator :: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span><span class="sxs-lookup"><span data-stu-id="30277-160">This data returned from the accelerator shall not be read by the host until after the buffer rendering for the picture has completed, as can be tested by [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span></span> <span data-ttu-id="30277-161">La valeur HRESULT retournée contient des S \_ OK tant que l’opération d’interface fonctionne normalement et peut retourner e \_ Fail ou e \_ INVALIDARG ou une autre indication d’erreur HRESULT en cas de problème grave.</span><span class="sxs-lookup"><span data-stu-id="30277-161">The returned HRESULT contains S\_OK as long as the interface operation is functioning normally and may return E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem.</span></span>

7.  <span data-ttu-id="30277-162">La mémoire tampon des paramètres de décodage d’image doit figurer parmi les premières mémoires tampons envoyées pour le décodage de chaque image lors de l’utilisation de [**IAMVideoAccelerator :: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) avec bDXVA \_ Func égal à « 1 », et toutes les mémoires tampons pour le décodage d’une image dans un flux binaire doivent être envoyées avant les mémoires tampons pour décoder les images suivantes.</span><span class="sxs-lookup"><span data-stu-id="30277-162">The picture decoding parameters buffer shall be among the first buffers sent for the decoding of each picture when using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) with bDXVA\_Func equal to "1", and all the buffers for decoding a picture in a bitstream shall be sent before any buffers for decoding subsequent pictures.</span></span> <span data-ttu-id="30277-163">Si une mémoire tampon de commande de contrôle bloc macro est envoyée, une mémoire tampon de données de différence résiduelle correspondante doit être envoyée (contenant les données du même blocs macros) avec le même appel **IAMVideoAccelerator :: Execute** .</span><span class="sxs-lookup"><span data-stu-id="30277-163">If a macroblock control command buffer is sent, a corresponding residual difference data buffer shall be sent (containing data for the same macroblocks) with the same **IAMVideoAccelerator::Execute** call.</span></span>
8.  <span data-ttu-id="30277-164">[**IAMVideoAccelerator :: EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) doit être appelé après l’envoi de toutes les mémoires tampons compressées qui provoqueront la création du contenu de sortie dans une surface non compressée spécifiée (résultat d’opérations spécifiées pour WDecodedPictureIndex, WDeblockedPictureIndex, WBlendedDestinationIndex ou wPicResampleDestPicIndex).</span><span class="sxs-lookup"><span data-stu-id="30277-164">[**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) shall be called after all compressed buffers have been sent that will cause the creation of the output content in a specified uncompressed surface (a result of operations specified for wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="30277-165">L’objectif de cet appel à **IAMVideoAccelerator :: EndFrame** est d’informer le matériel de l’accélérateur vidéo que toutes les données nécessaires pour l’opération spécifiée ont été envoyées.</span><span class="sxs-lookup"><span data-stu-id="30277-165">The purpose of this call to **IAMVideoAccelerator::EndFrame** is to notify the video accelerator hardware that all data needed for the specified operation has been sent.</span></span> <span data-ttu-id="30277-166">Le pointeur vers les données à envoyer en aval via **IAMVideoAccelerator :: EndFrame** doit pointer vers un mot unique wEndPictureIndex contenant l’index du cadre qui se termine.</span><span class="sxs-lookup"><span data-stu-id="30277-166">The pointer to data to send downstream through **IAMVideoAccelerator::EndFrame** shall point to a single WORD wEndPictureIndex containing the index of the frame that is ending.</span></span> <span data-ttu-id="30277-167">Ce paramètre doit correspondre à la valeur wBeginPictureIndex spécifiée dans l’appel précédent à [**IAMVideoAccelerator :: BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) avant l’envoi des mémoires tampons compressées pertinentes.</span><span class="sxs-lookup"><span data-stu-id="30277-167">This parameter shall match the wBeginPictureIndex value specified in the prior call to [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) before the sending of the relevant compressed buffers.</span></span> <span data-ttu-id="30277-168">À la suite d’un appel à **IAMVideoAccelerator :: EndFrame**, la surface non compressée avec l’index wEndPictureIndex ne sera trouvée dans aucune WDecodedPictureIndex, WDeblockedPictureIndex, WBlendedDestinationIndex ou wPicResampleDestPicIndex d’image tant qu’un autre appel à **IAMVideoAccelerator :: BeginFrame** n’aura pas été émis pour annoncer que cela se produira et \_ qu’une valeur OK a été retournée en tant que résultat.</span><span class="sxs-lookup"><span data-stu-id="30277-168">Subsequent to a call to **IAMVideoAccelerator::EndFrame**, the uncompressed surface with index wEndPictureIndex shall not be found in any picture's wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex until after another call to **IAMVideoAccelerator::BeginFrame** is issued to announce that this will occur and an S\_OK has been returned as a result.</span></span> <span data-ttu-id="30277-169">Toutefois, cet index de surface de destination peut apparaître dans les commandes d’accès en lecture suivantes, telles que wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex ou bRefPicSelect \[ i \] .</span><span class="sxs-lookup"><span data-stu-id="30277-169">However, that destination surface index may occur in subsequent read access commands such as wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex, or bRefPicSelect\[i\].</span></span> <span data-ttu-id="30277-170">Le HRESULT retourné par **IAMVideoAccelerator :: EndFrame** doit être \_ OK, sauf s’il existe un type de données ou une erreur de protocole, auquel cas il peut s’agir de E \_ Fail ou e \_ INVALIDARG ou d’une autre indication d’erreur.</span><span class="sxs-lookup"><span data-stu-id="30277-170">The HRESULT returned by **IAMVideoAccelerator::EndFrame** shall be S\_OK unless there is some kind of data format or protocol error, in which case it can be E\_FAIL or E\_INVALIDARG or some other error indication.</span></span>
9.  <span data-ttu-id="30277-171">Dans le cas du décodage basé sur les champs (par exemple, dans les flux de bits MPEG-2), il n’y aura pas de mappage un-à-un des images fonctionnelles dans le flux binaire aux surfaces non compressées dans l’interface d’accélérateur.</span><span class="sxs-lookup"><span data-stu-id="30277-171">In the case of field based decoding (for example, in MPEG-2 bitstreams) there will not be a one-to-one mapping of functional pictures in the bitstream to uncompressed surfaces in the accelerator interface.</span></span> <span data-ttu-id="30277-172">Lors du décodage d’images de champ dans un flux de bits MPEG-2, deux « images » sont décodées pour produire une surface de sortie non compressée complète.</span><span class="sxs-lookup"><span data-stu-id="30277-172">When decoding field pictures in an MPEG-2 bitstream, there will be two "pictures" decoded to produce one complete output uncompressed surface.</span></span> <span data-ttu-id="30277-173">Dans la définition de l’interface DirectX VA, chaque frame correspond à chaque utilisation de wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex ou wPicResampleDestPicIndex.</span><span class="sxs-lookup"><span data-stu-id="30277-173">In the DirectX VA interface definition, each frame corresponds to each use of wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex.</span></span> <span data-ttu-id="30277-174">Par conséquent, deux paires d’appels à **IAMVideoAccelerator :: BeginFrame** et **IAMVideoAccelerator :: EndFrame** sont requises pour le décodage des images de champ dans les surfaces non compressées de sortie.</span><span class="sxs-lookup"><span data-stu-id="30277-174">Thus two pairs of calls to **IAMVideoAccelerator::BeginFrame** and **IAMVideoAccelerator::EndFrame** are required for the decoding of field pictures into output uncompressed surfaces.</span></span>
10. <span data-ttu-id="30277-175">Un appel à [**IAMVideoAccelerator :: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) avec dwFlags égal à zéro qui se produit quelque temps après un appel à **IAMVideoAccelerator :: EndFrame** avec un wEndPictureIndex particulier et vérifie l’état d’une mémoire tampon qui a été envoyée qui contenait le WEndPictureIndex dans WDecodedPictureIndex, WDeblockedPictureIndex, wBlendedDestinationIndex ou WPicResampleDestPicIndex retourne une \_ indication S OK si toutes les opérations d’écriture des données sur la surface non compressée sont terminées et retournent E \_ en attente si l’opération n’est pas encore terminée.</span><span class="sxs-lookup"><span data-stu-id="30277-175">A call to [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) with dwFlags equal to zero which occurs sometime after a call to **IAMVideoAccelerator::EndFrame** with a particular wEndPictureIndex and checks the status of a buffer that was sent that contained the wEndPictureIndex in wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex will return an S\_OK indication if all of the operations to write the data to the uncompressed surface have completed and will return E\_PENDING if the operation has not yet completed.</span></span> <span data-ttu-id="30277-176">E \_ Fail ou e \_ INVALIDARG ou une autre indication d’erreur peut être retournée en cas d’erreur de protocole.</span><span class="sxs-lookup"><span data-stu-id="30277-176">E\_FAIL or E\_INVALIDARG or some other error indication may be returned in the event of a protocol error.</span></span>

## <a name="related-topics"></a><span data-ttu-id="30277-177">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="30277-177">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="30277-178">Mappage de l’accélération vidéo DirectX sur IAMVideoAccelerator</span><span class="sxs-lookup"><span data-stu-id="30277-178">Mapping DirectX Video Acceleration to IAMVideoAccelerator</span></span>](mapping-directx-video-acceleration-to-iamvideoaccelerator.md)
</dt> </dl>

 

 



