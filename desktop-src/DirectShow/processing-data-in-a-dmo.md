---
description: Traitement des données dans une DMO
ms.assetid: 715482d9-23f4-40d0-9c09-7a81e148c543
title: Traitement des données dans une DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ea9f5d5d820dc1467c25f9d411d46a9c66935e8b
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "103846425"
---
# <a name="processing-data-in-a-dmo"></a><span data-ttu-id="dfe84-103">Traitement des données dans une DMO</span><span class="sxs-lookup"><span data-stu-id="dfe84-103">Processing Data in a DMO</span></span>

<span data-ttu-id="dfe84-104">Cette section explique comment traiter un flux de données à l’aide d’un DMO.</span><span class="sxs-lookup"><span data-stu-id="dfe84-104">This section explains how to process a stream of data using a DMO.</span></span> <span data-ttu-id="dfe84-105">Les étapes répertoriées dans cette section sont le comportement par défaut. toutes les DMOs doivent prendre en charge les méthodes décrites ici.</span><span class="sxs-lookup"><span data-stu-id="dfe84-105">The steps listed in this section are the default behavior; all DMOs must support the methods described here.</span></span> <span data-ttu-id="dfe84-106">Ces méthodes utilisent des mémoires tampons distinctes pour l’entrée et la sortie.</span><span class="sxs-lookup"><span data-stu-id="dfe84-106">These methods use separate buffers for input and output.</span></span> <span data-ttu-id="dfe84-107">Certains DMOs prennent également en charge le traitement sur place, à l’aide d’une seule mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="dfe84-107">Some DMOs also support in-place processing, using a single buffer.</span></span> <span data-ttu-id="dfe84-108">Pour plus d’informations sur le traitement sur place, consultez [traitement sur place](in-place-processing.md).</span><span class="sxs-lookup"><span data-stu-id="dfe84-108">For more information about in-place processing, see [In-Place Processing](in-place-processing.md).</span></span>

<span data-ttu-id="dfe84-109">**Allouer des tampons**</span><span class="sxs-lookup"><span data-stu-id="dfe84-109">**Allocating Buffers**</span></span>

<span data-ttu-id="dfe84-110">Le client est responsable de toutes les allocations de mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="dfe84-110">The client is responsible for all buffer allocation.</span></span> <span data-ttu-id="dfe84-111">Une fois que vous avez défini les types de médias sur le DMO, interrogez DMO pour obtenir les exigences de mémoire tampon de chaque flux.</span><span class="sxs-lookup"><span data-stu-id="dfe84-111">After you set the media types on the DMO, query the DMO for each stream's buffer requirements.</span></span> <span data-ttu-id="dfe84-112">Celles-ci peuvent changer en fonction du type de média.</span><span class="sxs-lookup"><span data-stu-id="dfe84-112">These can change depending on the media type.</span></span> <span data-ttu-id="dfe84-113">Pour chaque flux, appelez la méthode [**IMediaObject :: GetInputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputsizeinfo) ou [**IMediaObject :: GetOutputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputsizeinfo) .</span><span class="sxs-lookup"><span data-stu-id="dfe84-113">For each stream, call the [**IMediaObject::GetInputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputsizeinfo) or [**IMediaObject::GetOutputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputsizeinfo) method.</span></span> <span data-ttu-id="dfe84-114">Ces méthodes retournent les informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="dfe84-114">These methods return the following information:</span></span>

-   <span data-ttu-id="dfe84-115">Taille minimale de la mémoire tampon, en octets.</span><span class="sxs-lookup"><span data-stu-id="dfe84-115">Minimum buffer size, in bytes.</span></span>
-   <span data-ttu-id="dfe84-116">Exigences d’alignement, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="dfe84-116">Alignment requirements, if any.</span></span> <span data-ttu-id="dfe84-117">Une mémoire tampon est alignée si l’adresse de début est un multiple d’un entier spécifié.</span><span class="sxs-lookup"><span data-stu-id="dfe84-117">A buffer is aligned if the start address is a multiple of some specified integer.</span></span>
-   <span data-ttu-id="dfe84-118">Quantité maximale de données que le DMO contiendra pour la préanalyse.</span><span class="sxs-lookup"><span data-stu-id="dfe84-118">The maximum amount of data the DMO will hold for lookahead.</span></span> <span data-ttu-id="dfe84-119">Ce nombre s’applique uniquement aux flux d’entrée.</span><span class="sxs-lookup"><span data-stu-id="dfe84-119">This number applies only to input streams.</span></span> <span data-ttu-id="dfe84-120">Pour certains types de données (par exemple, l’encodage MPEG), un DMO devra peut-être effectuer une recherche dans le flux.</span><span class="sxs-lookup"><span data-stu-id="dfe84-120">For some kinds of data (for example, MPEG encoding), a DMO might need to look forward in the stream.</span></span> <span data-ttu-id="dfe84-121">La valeur de préanalyse indique la quantité de données d’entrée requises par DMO avant de pouvoir produire une sortie.</span><span class="sxs-lookup"><span data-stu-id="dfe84-121">The lookahead value indicates how much input data the DMO will require before it can produce output.</span></span>

<span data-ttu-id="dfe84-122">Le client doit allouer des tampons qui répondent à ces exigences.</span><span class="sxs-lookup"><span data-stu-id="dfe84-122">The client must allocate buffers that match these requirements.</span></span> <span data-ttu-id="dfe84-123">En outre, DMO peut avoir des exigences quant à la façon dont le client conditionne les données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="dfe84-123">In addition, the DMO might have requirements about how the client packages the input data.</span></span> <span data-ttu-id="dfe84-124">Par exemple, DMO peut exiger que chaque mémoire tampon contienne exactement un échantillon (ou image vidéo).</span><span class="sxs-lookup"><span data-stu-id="dfe84-124">For example, the DMO might require each buffer to contain exactly one sample (or video frame).</span></span> <span data-ttu-id="dfe84-125">Pour déterminer ces exigences, appelez la méthode [**IMediaObject :: GetInputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstreaminfo) .</span><span class="sxs-lookup"><span data-stu-id="dfe84-125">To determine these requirements, call the [**IMediaObject::GetInputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstreaminfo) method.</span></span> <span data-ttu-id="dfe84-126">La méthode [**IMediaObject :: GetOutputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputstreaminfo) retourne des informations similaires sur un flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="dfe84-126">The [**IMediaObject::GetOutputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputstreaminfo) method returns similar information about an output stream.</span></span>

<span data-ttu-id="dfe84-127">Dans le modèle de diffusion en continu par défaut, le client ne transmet pas de pointeurs de tampon brut à DMO.</span><span class="sxs-lookup"><span data-stu-id="dfe84-127">In the default streaming model, the client does not pass raw buffer pointers to the DMO.</span></span> <span data-ttu-id="dfe84-128">Au lieu de cela, il utilise un objet COM léger qui expose l’interface [**IMediaBuffer**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediabuffer) .</span><span class="sxs-lookup"><span data-stu-id="dfe84-128">Instead, it uses a lightweight COM object that exposes the [**IMediaBuffer**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediabuffer) interface.</span></span> <span data-ttu-id="dfe84-129">L’interface **IMediaBuffer** joue le rôle de wrapper com pour un bloc de mémoire.</span><span class="sxs-lookup"><span data-stu-id="dfe84-129">The **IMediaBuffer** interface acts as a COM wrapper for a block of memory.</span></span> <span data-ttu-id="dfe84-130">Étant donné qu’il s’agit d’un objet COM, il prend en charge le décompte de références, qui permet de s’assurer que les tampons ne sont pas libérés quand ils sont en cours d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="dfe84-130">Because it is a COM object, it supports reference counting, which helps to ensure that buffers are not released while still in use.</span></span>

> [!Note]  
> <span data-ttu-id="dfe84-131">L’interface **IMediaBuffer** sert de fonction similaire à l’interface **IMediaSample** dans DirectShow.</span><span class="sxs-lookup"><span data-stu-id="dfe84-131">The **IMediaBuffer** interface serves a function similar to the **IMediaSample** interface in DirectShow.</span></span>

 

<span data-ttu-id="dfe84-132">Le client doit implémenter l’objet **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="dfe84-132">The client must implement the **IMediaBuffer** object.</span></span> <span data-ttu-id="dfe84-133">Pour plus d’informations, consultez [implémentation de IMediaBuffer](implementing-imediabuffer.md).</span><span class="sxs-lookup"><span data-stu-id="dfe84-133">For more information, see [Implementing IMediaBuffer](implementing-imediabuffer.md).</span></span>

<span data-ttu-id="dfe84-134">**Traitement des données**</span><span class="sxs-lookup"><span data-stu-id="dfe84-134">**Processing the Data**</span></span>

<span data-ttu-id="dfe84-135">Pour traiter les données, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="dfe84-135">To process data, do the following:</span></span>

1.  <span data-ttu-id="dfe84-136">Pour chaque flux d’entrée, remplissez une mémoire tampon avec des données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="dfe84-136">For each input stream, fill a buffer with input data.</span></span>
2.  <span data-ttu-id="dfe84-137">Appelez [**IMediaObject ::P rocessinput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processinput) pour fournir chaque mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="dfe84-137">Call [**IMediaObject::ProcessInput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processinput) to deliver each buffer.</span></span>
3.  <span data-ttu-id="dfe84-138">Appelez [**IMediaObject ::P rocessoutput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processoutput) pour traiter les données.</span><span class="sxs-lookup"><span data-stu-id="dfe84-138">Call [**IMediaObject::ProcessOutput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processoutput) to process the data.</span></span> <span data-ttu-id="dfe84-139">Cette méthode prend un tableau de mémoires tampons, un pour chaque flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="dfe84-139">This method takes an array of buffers, one for each output stream.</span></span>
4.  <span data-ttu-id="dfe84-140">Répétez l’opération jusqu’à ce qu’il n’y ait plus de données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="dfe84-140">Repeat until there is no more input data.</span></span>

<span data-ttu-id="dfe84-141">La méthode **ProcessInput** accepte l’entrée d’un flux à la fois.</span><span class="sxs-lookup"><span data-stu-id="dfe84-141">The **ProcessInput** method accepts input for one stream at a time.</span></span> <span data-ttu-id="dfe84-142">En général, la méthode est retournée immédiatement, et la méthode DMO contient un décompte de références sur l’objet **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="dfe84-142">Typically the method returns immediately, and the DMO holds a reference count on the **IMediaBuffer** object.</span></span> <span data-ttu-id="dfe84-143">Il libère l’objet après avoir traité toutes les données de la mémoire tampon, ou lorsque l’application vide la DMO.</span><span class="sxs-lookup"><span data-stu-id="dfe84-143">It releases the object after it processes all of the data in the buffer, or when the application flushes the DMO.</span></span> <span data-ttu-id="dfe84-144">Ne réutilisez pas une mémoire tampon tant que DMO ne l’a pas libérée.</span><span class="sxs-lookup"><span data-stu-id="dfe84-144">Do not re-use a buffer until the DMO has released it.</span></span> <span data-ttu-id="dfe84-145">Pour déterminer si un flux d’entrée peut accepter plus de données, appelez la méthode [**IMediaObject :: GetInputStatus**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstatus) .</span><span class="sxs-lookup"><span data-stu-id="dfe84-145">To determine whether an input stream can accept more data, call the [**IMediaObject::GetInputStatus**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstatus) method.</span></span> <span data-ttu-id="dfe84-146">Cette méthode retourne l' \_ indicateur d' \_ \_ acceptation STATUSF Accept Data de DMO \_ si le flux peut accepter davantage d’entrées.</span><span class="sxs-lookup"><span data-stu-id="dfe84-146">This method returns the DMO\_INPUT\_STATUSF\_ACCEPT\_DATA flag if the stream can accept more input.</span></span>

<span data-ttu-id="dfe84-147">La méthode **ProcessOutput** génère une sortie pour tous les flux de sortie en même temps.</span><span class="sxs-lookup"><span data-stu-id="dfe84-147">The **ProcessOutput** method generates output for all of the output streams at once.</span></span> <span data-ttu-id="dfe84-148">L’application passe dans un tableau de structures de [**\_ \_ \_ tampons de données de sortie DMO**](/previous-versions/windows/desktop/api/Mediaobj/ns-mediaobj-dmo_output_data_buffer) , une pour chaque flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="dfe84-148">The application passes in an array of [**DMO\_OUTPUT\_DATA\_BUFFER**](/previous-versions/windows/desktop/api/Mediaobj/ns-mediaobj-dmo_output_data_buffer) structures, one for each output stream.</span></span> <span data-ttu-id="dfe84-149">Chaque structure du tableau a un pointeur vers un objet **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="dfe84-149">Each structure in the array has a pointer to an **IMediaBuffer** object.</span></span> <span data-ttu-id="dfe84-150">Le DMO écrit autant de données de sortie que possible dans les tampons.</span><span class="sxs-lookup"><span data-stu-id="dfe84-150">The DMO writes as much output data as it can into the buffers.</span></span> <span data-ttu-id="dfe84-151">Il définit également différents indicateurs pour signaler l’état de l’opération.</span><span class="sxs-lookup"><span data-stu-id="dfe84-151">It also sets various flags to report the status of the operation.</span></span> <span data-ttu-id="dfe84-152">L' \_ \_ \_ \_ indicateur BUFFERF Incomplete des données de sortie DMO indique que DMO peut produire plus de sortie à partir de l’entrée existante.</span><span class="sxs-lookup"><span data-stu-id="dfe84-152">The DMO\_OUTPUT\_DATA\_BUFFERF\_INCOMPLETE flag indicates the DMO can produce more output from the existing input.</span></span> <span data-ttu-id="dfe84-153">Dans ce cas, le client peut appeler de nouveau **ProcessOutput** .</span><span class="sxs-lookup"><span data-stu-id="dfe84-153">In that case, the client can call **ProcessOutput** again.</span></span> <span data-ttu-id="dfe84-154">Dans le cas contraire, elle doit appeler **ProcessInput** avec davantage de données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="dfe84-154">Otherwise, it should call **ProcessInput** with more input data.</span></span> <span data-ttu-id="dfe84-155">Le DMO ne modifie jamais les données dans les mémoires tampons d’entrée ; Il écrit uniquement dans les mémoires tampons de sortie.</span><span class="sxs-lookup"><span data-stu-id="dfe84-155">The DMO never modifies the data in the input buffers; it writes only to the output buffers.</span></span>

<span data-ttu-id="dfe84-156">Une fois que vous avez remis toutes les données à un flux d’entrée, appelez la méthode [**IMediaObject ::D iscontinuity**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-discontinuity) .</span><span class="sxs-lookup"><span data-stu-id="dfe84-156">After you have delivered all of the data to an input stream, call the [**IMediaObject::Discontinuity**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-discontinuity) method.</span></span> <span data-ttu-id="dfe84-157">DMO n’accepte pas d’entrée supplémentaire dans ce flux tant que vous n’avez pas traité la sortie restante (ou vidé le DMO).</span><span class="sxs-lookup"><span data-stu-id="dfe84-157">The DMO does not accept further input to that stream until you process the remaining output (or flush the DMO).</span></span>

<span data-ttu-id="dfe84-158">À tout moment après le début de la diffusion en continu, DMO est en mesure de recevoir une sortie d’entrée ou de production, ou les deux.</span><span class="sxs-lookup"><span data-stu-id="dfe84-158">At any point after streaming begins, the DMO is able to receive input or produce output, or both.</span></span> <span data-ttu-id="dfe84-159">Par conséquent, **GetInputStatus** retourne DMO \_ entrée \_ STATUSF \_ Accept \_ Data, ou **ProcessOutput** retourne DMO \_ Output \_ Data \_ BUFFERF \_ Incomplete.</span><span class="sxs-lookup"><span data-stu-id="dfe84-159">Therefore, either **GetInputStatus** returns DMO\_INPUT\_STATUSF\_ACCEPT\_DATA, or **ProcessOutput** returns DMO\_OUTPUT\_DATA\_BUFFERF\_INCOMPLETE.</span></span> <span data-ttu-id="dfe84-160">L’application maintient les données transmises en testant ces indicateurs et en appelant **ProcessInput** ou **ProcessOutput** en conséquence.</span><span class="sxs-lookup"><span data-stu-id="dfe84-160">The application keeps data flowing by testing for these flags and calling **ProcessInput** or **ProcessOutput** accordingly.</span></span> <span data-ttu-id="dfe84-161">Pour interrompre le workflow, appelez la méthode [**IMediaObject :: Flush**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-flush) .</span><span class="sxs-lookup"><span data-stu-id="dfe84-161">To interrupt the data flow, call the [**IMediaObject::Flush**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-flush) method.</span></span> <span data-ttu-id="dfe84-162">Avec cette méthode, DMO rejette les tampons qu’elle détient en interne.</span><span class="sxs-lookup"><span data-stu-id="dfe84-162">This method causes the DMO to discard any buffers it is holding internally.</span></span>

## <a name="related-topics"></a><span data-ttu-id="dfe84-163">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="dfe84-163">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="dfe84-164">Hébergement direct d’un DMO</span><span class="sxs-lookup"><span data-stu-id="dfe84-164">Directly Hosting a DMO</span></span>](directly-hosting-a-dmo.md)
</dt> <dt>

[<span data-ttu-id="dfe84-165">Traitement sur place</span><span class="sxs-lookup"><span data-stu-id="dfe84-165">In-Place Processing</span></span>](in-place-processing.md)
</dt> </dl>

 

 



