---
description: Processus de connexion CBasePin
ms.assetid: 4b3a9023-0267-4caa-9d89-88237009df05
title: Processus de connexion CBasePin
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1441b0daba58857e00da0139d3312fb277287fc2
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "103950139"
---
# <a name="cbasepin-connection-process"></a><span data-ttu-id="b009b-103">Processus de connexion CBasePin</span><span class="sxs-lookup"><span data-stu-id="b009b-103">CBasePin Connection Process</span></span>

<span data-ttu-id="b009b-104">Cette section décrit comment la classe [**CBasePin**](cbasepin.md) implémente le processus de connexion de code confidentiel.</span><span class="sxs-lookup"><span data-stu-id="b009b-104">This section describes how the [**CBasePin**](cbasepin.md) class implements the pin connection process.</span></span>

<span data-ttu-id="b009b-105">Le gestionnaire de graphes de filtre initie toutes les connexions de code confidentiel.</span><span class="sxs-lookup"><span data-stu-id="b009b-105">The Filter Graph Manager initiates all pin connections.</span></span> <span data-ttu-id="b009b-106">Elle appelle la méthode [**IPIN :: Connect**](/windows/desktop/api/Strmif/nf-strmif-ipin-connect) du code confidentiel de sortie, en spécifiant la broche d’entrée.</span><span class="sxs-lookup"><span data-stu-id="b009b-106">It calls the output pin's [**IPin::Connect**](/windows/desktop/api/Strmif/nf-strmif-ipin-connect) method, specifying the input pin.</span></span> <span data-ttu-id="b009b-107">La broche de sortie termine la connexion en appelant la méthode [**IPIN :: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) du code confidentiel d’entrée.</span><span class="sxs-lookup"><span data-stu-id="b009b-107">The output pin completes the connection by calling the input pin's [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) method.</span></span> <span data-ttu-id="b009b-108">La broche d’entrée peut accepter ou refuser la connexion.</span><span class="sxs-lookup"><span data-stu-id="b009b-108">The input pin can accept or reject the connection.</span></span>

<span data-ttu-id="b009b-109">Le gestionnaire de graphes de filtre peut également spécifier un type de média pour la connexion.</span><span class="sxs-lookup"><span data-stu-id="b009b-109">The Filter Graph Manager can also specify a media type for the connection.</span></span> <span data-ttu-id="b009b-110">Si c’est le cas, les broches essaient de se connecter avec ce type.</span><span class="sxs-lookup"><span data-stu-id="b009b-110">If so, the pins try to connect with that type.</span></span> <span data-ttu-id="b009b-111">Si ce n’est pas le cas, les broches doivent négocier le type.</span><span class="sxs-lookup"><span data-stu-id="b009b-111">If not, the pins must negotiate the type.</span></span> <span data-ttu-id="b009b-112">Le gestionnaire de graphes de filtres peut également spécifier un type de média *partiel* , qui a la valeur Guid \_ null pour le type, le sous-type ou le type de format principal.</span><span class="sxs-lookup"><span data-stu-id="b009b-112">The Filter Graph Manager may also specify a *partial* media type, which has the value GUID\_NULL for either the major type, subtype, or format type.</span></span> <span data-ttu-id="b009b-113">Dans ce cas, les broches essaient de correspondre aux parties du type de média spécifiées ; la valeur du GUID \_ null agit comme un caractère générique.</span><span class="sxs-lookup"><span data-stu-id="b009b-113">In that case, the pins try to match whichever portions of the media type were specified; the value GUID\_NULL acts as a wildcard.</span></span>

<span data-ttu-id="b009b-114">La méthode [**CBasePin :: Connect**](cbasepin-connect.md) commence par vérifier que le code confidentiel peut accepter une connexion.</span><span class="sxs-lookup"><span data-stu-id="b009b-114">The [**CBasePin::Connect**](cbasepin-connect.md) method starts by verifying that the pin can accept a connection.</span></span> <span data-ttu-id="b009b-115">Par exemple, il vérifie que le pin n’est pas déjà connecté.</span><span class="sxs-lookup"><span data-stu-id="b009b-115">For example, it checks that the pin is not already connected.</span></span> <span data-ttu-id="b009b-116">Elle délègue le reste du processus de connexion à la méthode [**CBasePin :: AgreeMediaType**](cbasepin-agreemediatype.md) .</span><span class="sxs-lookup"><span data-stu-id="b009b-116">It delegates the rest of the connection process to the [**CBasePin::AgreeMediaType**](cbasepin-agreemediatype.md) method.</span></span> <span data-ttu-id="b009b-117">Tout ce qui suit est effectué par **AgreeMediaType**.</span><span class="sxs-lookup"><span data-stu-id="b009b-117">Everything that follows is performed by **AgreeMediaType**.</span></span>

<span data-ttu-id="b009b-118">Si le type de média est entièrement spécifié, le code PIN appelle la méthode [**CBasePin :: AttemptConnection**](cbasepin-attemptconnection.md) pour tenter la connexion.</span><span class="sxs-lookup"><span data-stu-id="b009b-118">If the media type is fully specified, the pin calls the [**CBasePin::AttemptConnection**](cbasepin-attemptconnection.md) method to attempt the connection.</span></span> <span data-ttu-id="b009b-119">Dans le cas contraire, il tente des types de médias dans l’ordre suivant :</span><span class="sxs-lookup"><span data-stu-id="b009b-119">Otherwise, it tries media types in the following order:</span></span>

1.  <span data-ttu-id="b009b-120">Types préférés de la broche d’entrée.</span><span class="sxs-lookup"><span data-stu-id="b009b-120">The input pin's preferred types.</span></span>
2.  <span data-ttu-id="b009b-121">Types préférés de la broche de sortie.</span><span class="sxs-lookup"><span data-stu-id="b009b-121">The output pin's preferred types.</span></span>

<span data-ttu-id="b009b-122">Vous pouvez inverser cet ordre en affectant à l’indicateur [**CBasePin :: m \_ BTryMyTypesFirst**](cbasepin-m-btrymytypesfirst.md) la **valeur true**.</span><span class="sxs-lookup"><span data-stu-id="b009b-122">You can reverse this order by setting the [**CBasePin::m\_bTryMyTypesFirst**](cbasepin-m-btrymytypesfirst.md) flag to **TRUE**.</span></span>

<span data-ttu-id="b009b-123">Dans chaque cas, le code PIN appelle [**IPIN :: EnumMediaTypes**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) pour énumérer les types de médias.</span><span class="sxs-lookup"><span data-stu-id="b009b-123">In each case, the pin calls [**IPin::EnumMediaTypes**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) to enumerate the media types.</span></span> <span data-ttu-id="b009b-124">Cette méthode récupère un objet énumérateur, qui est passé à la méthode [**CBasePin :: TryMediaTypes**](cbasepin-trymediatypes.md) .</span><span class="sxs-lookup"><span data-stu-id="b009b-124">This method retrieves an enumerator object, which is passed to the [**CBasePin::TryMediaTypes**](cbasepin-trymediatypes.md) method.</span></span> <span data-ttu-id="b009b-125">La méthode **TryMediaTypes** parcourt chaque type de média et appelle [**AttemptConnection**](cbasepin-attemptconnection.md) pour chaque type.</span><span class="sxs-lookup"><span data-stu-id="b009b-125">The **TryMediaTypes** method loops through each media type and calls [**AttemptConnection**](cbasepin-attemptconnection.md) for each type.</span></span>

<span data-ttu-id="b009b-126">Dans la méthode [**AttemptConnection**](cbasepin-attemptconnection.md) , la broche de sortie appelle les méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="b009b-126">Within the [**AttemptConnection**](cbasepin-attemptconnection.md) method, the output pin calls the following methods:</span></span>

-   <span data-ttu-id="b009b-127">Il appelle [**CBasePin :: CheckConnect**](cbasepin-checkconnect.md) sur lui-même pour vérifier si la broche d’entrée est appropriée.</span><span class="sxs-lookup"><span data-stu-id="b009b-127">It calls [**CBasePin::CheckConnect**](cbasepin-checkconnect.md) on itself, to check whether the input pin is suitable.</span></span>
-   <span data-ttu-id="b009b-128">Il appelle [**CBasePin :: CheckMediaType**](cbasepin-checkmediatype.md) sur lui-même pour valider le type de média.</span><span class="sxs-lookup"><span data-stu-id="b009b-128">It calls [**CBasePin::CheckMediaType**](cbasepin-checkmediatype.md) on itself, to validate the media type.</span></span>
-   <span data-ttu-id="b009b-129">Elle appelle [**IPIN :: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) sur la broche d’entrée.</span><span class="sxs-lookup"><span data-stu-id="b009b-129">It calls [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) on the input pin.</span></span> <span data-ttu-id="b009b-130">La broche d’entrée utilise cette méthode pour déterminer si elle doit accepter la connexion.</span><span class="sxs-lookup"><span data-stu-id="b009b-130">The input pin uses this method to determine whether it should accept the connection.</span></span>
-   <span data-ttu-id="b009b-131">Il appelle [**CBasePin :: CompleteConnect**](cbasepin-completeconnect.md) sur lui-même pour terminer la connexion.</span><span class="sxs-lookup"><span data-stu-id="b009b-131">It calls [**CBasePin::CompleteConnect**](cbasepin-completeconnect.md) on itself to completes the connection.</span></span>

<span data-ttu-id="b009b-132">Notez les points suivants :</span><span class="sxs-lookup"><span data-stu-id="b009b-132">Note the following:</span></span>

-   <span data-ttu-id="b009b-133">[**CheckConnect**](cbasepin-checkconnect.md) est une méthode virtuelle.</span><span class="sxs-lookup"><span data-stu-id="b009b-133">[**CheckConnect**](cbasepin-checkconnect.md) is a virtual method.</span></span> <span data-ttu-id="b009b-134">Dans la classe de base, cette méthode vérifie si les directions de code confidentiel sont compatibles.</span><span class="sxs-lookup"><span data-stu-id="b009b-134">In the base class, this method checks whether the pin directions are compatible.</span></span> <span data-ttu-id="b009b-135">Les broches de sortie doivent se connecter aux broches d’entrée, et vice versa.</span><span class="sxs-lookup"><span data-stu-id="b009b-135">Output pins must connect to input pins, and vice versa.</span></span> <span data-ttu-id="b009b-136">La classe pin dérivée se substitue généralement à cette méthode pour effectuer d’autres vérifications.</span><span class="sxs-lookup"><span data-stu-id="b009b-136">The derived pin class will typically override this method to perform other checks.</span></span> <span data-ttu-id="b009b-137">Par exemple, il peut interroger l’autre code confidentiel pour une interface requise pour la connexion.</span><span class="sxs-lookup"><span data-stu-id="b009b-137">For example, it might query the other pin for an interface that is required for the connection.</span></span> <span data-ttu-id="b009b-138">Si la classe dérivée se substitue à **CheckConnect**, elle doit également appeler la méthode [**CBasePin**](cbasepin.md) .</span><span class="sxs-lookup"><span data-stu-id="b009b-138">If the derived class overrides **CheckConnect**, it should also call the [**CBasePin**](cbasepin.md) method.</span></span>
-   <span data-ttu-id="b009b-139">[**CheckMediaType**](cbasepin-checkmediatype.md) est une méthode virtuelle pure, que la classe dérivée doit implémenter.</span><span class="sxs-lookup"><span data-stu-id="b009b-139">[**CheckMediaType**](cbasepin-checkmediatype.md) is a pure virtual method, which the derived class must implement.</span></span>
-   <span data-ttu-id="b009b-140">[**CompleteConnect**](cbasepin-completeconnect.md) est une méthode virtuelle qui ne fait rien dans la classe de base.</span><span class="sxs-lookup"><span data-stu-id="b009b-140">[**CompleteConnect**](cbasepin-completeconnect.md) is a virtual method that does nothing in the base class.</span></span> <span data-ttu-id="b009b-141">Les classes dérivées peuvent substituer cette méthode pour exécuter tout travail supplémentaire nécessaire pour terminer la connexion, par exemple pour choisir un allocateur de mémoire.</span><span class="sxs-lookup"><span data-stu-id="b009b-141">Derived classes can override this method to perform any additional work needed to complete the connection, such as deciding a memory allocator.</span></span>

<span data-ttu-id="b009b-142">Si l’une de ces étapes échoue, la broche de sortie appelle la méthode [**CBasePin :: BreakConnect**](cbasepin-breakconnect.md) pour annuler toutes les étapes effectuées par [**CheckConnect**](cbasepin-checkconnect.md).</span><span class="sxs-lookup"><span data-stu-id="b009b-142">If any of these steps fails, the output pin calls the [**CBasePin::BreakConnect**](cbasepin-breakconnect.md) method to undo whatever steps were taken by [**CheckConnect**](cbasepin-checkconnect.md).</span></span>

<span data-ttu-id="b009b-143">La méthode [**ReceiveConnection**](cbasepin-receiveconnection.md) de la broche d’entrée appelle les méthodes [**CheckConnect**](cbasepin-checkconnect.md), [**CheckMediaType**](cbasepin-checkmediatype.md)et [**CompleteConnect**](cbasepin-completeconnect.md) du code confidentiel d’entrée.</span><span class="sxs-lookup"><span data-stu-id="b009b-143">The input pin's [**ReceiveConnection**](cbasepin-receiveconnection.md) method calls the input pin's [**CheckConnect**](cbasepin-checkconnect.md), [**CheckMediaType**](cbasepin-checkmediatype.md), and [**CompleteConnect**](cbasepin-completeconnect.md) methods.</span></span> <span data-ttu-id="b009b-144">Si l’une de ces erreurs échoue, la tentative de connexion échoue également.</span><span class="sxs-lookup"><span data-stu-id="b009b-144">If any of these fail, the connection attempt also fails.</span></span>

<span data-ttu-id="b009b-145">Le diagramme suivant illustre le processus de connexion dans [**CBasePin**](cbasepin.md):</span><span class="sxs-lookup"><span data-stu-id="b009b-145">The following diagram shows the connection process in [**CBasePin**](cbasepin.md):</span></span>

![processus de connexion cbasepin](images/cbasepin-connect.png)

## <a name="related-topics"></a><span data-ttu-id="b009b-147">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="b009b-147">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b009b-148">**CBasePin**</span><span class="sxs-lookup"><span data-stu-id="b009b-148">**CBasePin**</span></span>](cbasepin.md)
</dt> </dl>

 

 



