---
description: Cette rubrique explique comment implémenter une DLL pour un filtre DirectShow, à l’aide des classes de base DirectShow.
ms.assetid: d47980d1-6d0c-4b0d-a875-7b072562944a
title: Fabriques de classes et modèles de fabrique
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e02699a8ff0740ddcf1d86b8514fd45dac9e32ed
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104553192"
---
# <a name="class-factories-and-factory-templates"></a><span data-ttu-id="51252-103">Fabriques de classes et modèles de fabrique</span><span class="sxs-lookup"><span data-stu-id="51252-103">Class Factories and Factory Templates</span></span>

<span data-ttu-id="51252-104">Cette rubrique explique comment implémenter une DLL pour un filtre DirectShow, à l’aide des [classes de base DirectShow](directshow-base-classes.md).</span><span class="sxs-lookup"><span data-stu-id="51252-104">This topic describes how to implement a DLL for a DirectShow filter, using the [DirectShow Base Classes](directshow-base-classes.md).</span></span>

<span data-ttu-id="51252-105">Avant qu’un client crée une instance d’un objet COM, il crée une instance de la fabrique de classe de l’objet, à l’aide d’un appel à la fonction [**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) .</span><span class="sxs-lookup"><span data-stu-id="51252-105">Before a client creates an instance of a COM object, it creates an instance of the object's class factory, using a call to the [**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) function.</span></span> <span data-ttu-id="51252-106">Le client appelle ensuite la méthode **IClassFactory :: CreateInstance** de la fabrique de classes.</span><span class="sxs-lookup"><span data-stu-id="51252-106">The client then calls the class factory's **IClassFactory::CreateInstance** method.</span></span> <span data-ttu-id="51252-107">Il s’agit de la fabrique de classes qui crée réellement le composant et retourne un pointeur vers l’interface demandée.</span><span class="sxs-lookup"><span data-stu-id="51252-107">It is the class factory that actually creates the component and returns a pointer to the requested interface.</span></span> <span data-ttu-id="51252-108">(La fonction [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) combine ces étapes, à l’intérieur de l’appel de fonction.)</span><span class="sxs-lookup"><span data-stu-id="51252-108">(The [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) function combines these steps, inside the function call.)</span></span>

<span data-ttu-id="51252-109">L’illustration suivante montre la séquence d’appels de méthode.</span><span class="sxs-lookup"><span data-stu-id="51252-109">The following illustration shows the sequence of method calls.</span></span>

![appels de méthode pour créer une fabrique de classes](images/classfactory.png)

<span data-ttu-id="51252-111">[**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) appelle la fonction [**DllGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-dllgetclassobject) , qui est définie dans la dll.</span><span class="sxs-lookup"><span data-stu-id="51252-111">[**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) calls the [**DllGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-dllgetclassobject) function, which is defined in the DLL.</span></span> <span data-ttu-id="51252-112">Cette fonction crée la fabrique de classe et retourne un pointeur vers une interface de la fabrique de classe.</span><span class="sxs-lookup"><span data-stu-id="51252-112">This function creates the class factory and returns a pointer to an interface on the class factory.</span></span> <span data-ttu-id="51252-113">DirectShow implémente **DllGetClassObject** pour vous, mais la fonction s’appuie sur votre code d’une façon spécifique.</span><span class="sxs-lookup"><span data-stu-id="51252-113">DirectShow implements **DllGetClassObject** for you, but the function relies on your code in a specific way.</span></span> <span data-ttu-id="51252-114">Pour comprendre comment cela fonctionne, vous devez comprendre comment DirectShow implémente les fabriques de classes.</span><span class="sxs-lookup"><span data-stu-id="51252-114">To understand how it works, you must understand how DirectShow implements class factories.</span></span>

<span data-ttu-id="51252-115">Une fabrique de classe est un objet COM dédié à la création d’un autre objet COM.</span><span class="sxs-lookup"><span data-stu-id="51252-115">A class factory is a COM object dedicated to creating another COM object.</span></span> <span data-ttu-id="51252-116">Chaque fabrique de classe a un type d’objet qu’il crée.</span><span class="sxs-lookup"><span data-stu-id="51252-116">Each class factory has one type of object that it creates.</span></span> <span data-ttu-id="51252-117">Dans DirectShow, chaque fabrique de classes est une instance de la même classe C++, **CClassFactory**.</span><span class="sxs-lookup"><span data-stu-id="51252-117">In DirectShow, every class factory is an instance of the same C++ class, **CClassFactory**.</span></span> <span data-ttu-id="51252-118">Les fabriques de classes sont spécialisées au moyen d’une autre classe, [**CFactoryTemplate**](cfactorytemplate.md), également appelée *modèle de fabrique*.</span><span class="sxs-lookup"><span data-stu-id="51252-118">Class factories are specialized by means of another class, [**CFactoryTemplate**](cfactorytemplate.md), also called the *factory template*.</span></span> <span data-ttu-id="51252-119">Chaque fabrique de classe contient un pointeur vers un modèle de fabrique.</span><span class="sxs-lookup"><span data-stu-id="51252-119">Each class factory holds a pointer to a factory template.</span></span> <span data-ttu-id="51252-120">Le modèle de fabrique contient des informations sur un composant spécifique, telles que l’identificateur de classe (CLSID) du composant, et un pointeur vers une fonction qui crée le composant.</span><span class="sxs-lookup"><span data-stu-id="51252-120">The factory template contains information about a specific component, such as the component's class identifier (CLSID), and a pointer to a function that creates the component.</span></span>

<span data-ttu-id="51252-121">La DLL déclare un tableau global de modèles de fabrique, un pour chaque composant dans la DLL.</span><span class="sxs-lookup"><span data-stu-id="51252-121">The DLL declares a global array of factory templates, one for each component in the DLL.</span></span> <span data-ttu-id="51252-122">Quand [**DllGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-dllgetclassobject) crée une nouvelle fabrique de classes, il recherche un modèle avec un CLSID correspondant dans le tableau.</span><span class="sxs-lookup"><span data-stu-id="51252-122">When [**DllGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-dllgetclassobject) makes a new class factory, it searches the array for a template with a matching CLSID.</span></span> <span data-ttu-id="51252-123">En supposant qu’il en trouve un, il crée une fabrique de classe qui contient un pointeur vers le modèle correspondant.</span><span class="sxs-lookup"><span data-stu-id="51252-123">Assuming it finds one, it creates a class factory that holds a pointer to the matching template.</span></span> <span data-ttu-id="51252-124">Lorsque le client appelle **IClassFactory :: CreateInstance**, la fabrique de classe appelle la fonction d’instanciation définie dans le modèle.</span><span class="sxs-lookup"><span data-stu-id="51252-124">When the client calls **IClassFactory::CreateInstance**, the class factory calls the instantiation function defined in the template.</span></span>

<span data-ttu-id="51252-125">L’illustration suivante montre la séquence d’appels de méthode.</span><span class="sxs-lookup"><span data-stu-id="51252-125">The following illustration shows the sequence of method calls.</span></span>

![modèles de fabrique de classes dans une dll](images/classfactory2.png)

<span data-ttu-id="51252-127">L’avantage de cette architecture est que vous pouvez définir uniquement quelques éléments spécifiques à votre composant, tels que la fonction d’instanciation, sans implémenter l’ensemble de la fabrique de classes.</span><span class="sxs-lookup"><span data-stu-id="51252-127">The benefit of this architecture is that you can define just a few things that are specific to your component, such as the instantiation function, without implementing the entire class factory.</span></span>

## <a name="related-topics"></a><span data-ttu-id="51252-128">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="51252-128">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="51252-129">Comment créer une DLL de filtre DirectShow</span><span class="sxs-lookup"><span data-stu-id="51252-129">How to Create a DirectShow Filter DLL</span></span>](how-to-create-a-dll.md)
</dt> </dl>

 

 
