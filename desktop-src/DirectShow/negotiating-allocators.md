---
description: Négociation des allocateurs
ms.assetid: fe13477c-1a7b-4098-9d0f-c54783102bc9
title: Négociation des allocateurs
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2faa393ba9fcd8585d68947cec172d4cfca6decf
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "106513091"
---
# <a name="negotiating-allocators"></a><span data-ttu-id="11fcc-103">Négociation des allocateurs</span><span class="sxs-lookup"><span data-stu-id="11fcc-103">Negotiating Allocators</span></span>

<span data-ttu-id="11fcc-104">Lorsque deux codes confidentiels se connectent, ils ont besoin d’un mécanisme d’échange de données multimédias.</span><span class="sxs-lookup"><span data-stu-id="11fcc-104">When two pins connect, they need a mechanism for exchanging media data.</span></span> <span data-ttu-id="11fcc-105">Ce mécanisme est appelé le *transport*.</span><span class="sxs-lookup"><span data-stu-id="11fcc-105">This mechanism is called the *transport*.</span></span> <span data-ttu-id="11fcc-106">En général, l’architecture DirectShow est neutre sur les transports.</span><span class="sxs-lookup"><span data-stu-id="11fcc-106">In general, the DirectShow architecture is neutral about transports.</span></span> <span data-ttu-id="11fcc-107">Deux filtres peuvent accepter de se connecter à l’aide des transports pris en charge par les deux.</span><span class="sxs-lookup"><span data-stu-id="11fcc-107">Two filters can agree to connect using any transport that both support.</span></span>

<span data-ttu-id="11fcc-108">Le transport le plus courant est le transport de *mémoire local* , dans lequel les données multimédias résident dans la mémoire principale.</span><span class="sxs-lookup"><span data-stu-id="11fcc-108">The most common transport is the *local memory* transport, in which the media data resides in main memory.</span></span> <span data-ttu-id="11fcc-109">Il existe deux versions de transport de mémoire locale, le *modèle push* et le *modèle pull*.</span><span class="sxs-lookup"><span data-stu-id="11fcc-109">Two flavors of local memory transport exist, the *push model* and the *pull model*.</span></span> <span data-ttu-id="11fcc-110">Dans le modèle push, le filtre source transmet les données au filtre en aval, à l’aide de l’interface [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) sur la broche d’entrée du filtre en aval.</span><span class="sxs-lookup"><span data-stu-id="11fcc-110">In the push model, the source filter pushes data to the downstream filter, using the [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) interface on the downstream filter's input pin.</span></span> <span data-ttu-id="11fcc-111">Dans le modèle d’extraction, le filtre en aval demande des données à partir du filtre source, à l’aide de l’interface [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader) sur la broche de sortie du filtre source.</span><span class="sxs-lookup"><span data-stu-id="11fcc-111">In the pull model, the downstream filter requests data from the source filter, using the [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader) interface on the source filter's output pin.</span></span> <span data-ttu-id="11fcc-112">Pour plus d’informations sur ces deux modèles de transmission de données, consultez [Data Flow dans le graphique de filtre](data-flow-in-the-filter-graph.md).</span><span class="sxs-lookup"><span data-stu-id="11fcc-112">For more information on these two data-flow models, see [Data Flow in the Filter Graph](data-flow-in-the-filter-graph.md).</span></span>

<span data-ttu-id="11fcc-113">Dans le transport de mémoire locale, l’objet chargé d’allouer des mémoires tampons est appelé *Allocator*.</span><span class="sxs-lookup"><span data-stu-id="11fcc-113">In local memory transport, the object responsible for allocating memory buffers is called the *allocator*.</span></span> <span data-ttu-id="11fcc-114">Un allocateur prend en charge l’interface [**IMemAllocator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) .</span><span class="sxs-lookup"><span data-stu-id="11fcc-114">An allocator supports the [**IMemAllocator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) interface.</span></span> <span data-ttu-id="11fcc-115">Les deux broches partagent un seul allocateur.</span><span class="sxs-lookup"><span data-stu-id="11fcc-115">Both pins share a single allocator.</span></span> <span data-ttu-id="11fcc-116">L’un ou l’autre des codes confidentiels peut fournir un allocateur, mais la broche de sortie sélectionne l’allocation à utiliser.</span><span class="sxs-lookup"><span data-stu-id="11fcc-116">Either pin can provide an allocator, but the output pin selects which allocator to use.</span></span>

<span data-ttu-id="11fcc-117">La broche de sortie définit également les propriétés Allocator, qui déterminent le nombre de mémoires tampons créées par l’allocateur, la taille de chaque mémoire tampon et l’alignement de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="11fcc-117">The output pin also sets the allocator properties, which determine how many buffers are created by the allocator, the size of each buffer, and the memory alignment.</span></span> <span data-ttu-id="11fcc-118">La broche de sortie peut déférer à la broche d’entrée pour les exigences de mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="11fcc-118">The output pin might defer to the input pin for the buffer requirements.</span></span>

<span data-ttu-id="11fcc-119">Dans une connexion **IMemInputPin** , la négociation d’allocateur fonctionne comme suit :</span><span class="sxs-lookup"><span data-stu-id="11fcc-119">In an **IMemInputPin** connection, allocator negotiation works as follows:</span></span>

1.  <span data-ttu-id="11fcc-120">Le cas échéant, la broche de sortie appelle [**IMemInputPin :: GetAllocatorRequirements**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocatorrequirements).</span><span class="sxs-lookup"><span data-stu-id="11fcc-120">Optionally, the output pin calls [**IMemInputPin::GetAllocatorRequirements**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocatorrequirements).</span></span> <span data-ttu-id="11fcc-121">Cette méthode récupère les exigences de mémoire tampon du code confidentiel d’entrée, telles que l’alignement de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="11fcc-121">This method retrieves the input pin's buffer requirements, such as memory alignment.</span></span> <span data-ttu-id="11fcc-122">En général, la broche de sortie doit honorer la demande du code confidentiel d’entrée, à moins qu’il y ait une bonne raison de ne pas le faire.</span><span class="sxs-lookup"><span data-stu-id="11fcc-122">In general, the output pin should honor the input pin's request, unless there is a good reason not to.</span></span>
2.  <span data-ttu-id="11fcc-123">Le cas échéant, la broche de sortie appelle [**IMemInputPin :: GetAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocator).</span><span class="sxs-lookup"><span data-stu-id="11fcc-123">Optionally, the output pin calls [**IMemInputPin::GetAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocator).</span></span> <span data-ttu-id="11fcc-124">Cette méthode demande un allocateur à partir de la broche d’entrée.</span><span class="sxs-lookup"><span data-stu-id="11fcc-124">This method requests an allocator from the input pin.</span></span> <span data-ttu-id="11fcc-125">La broche d’entrée en fournit une ou retourne un code d’erreur.</span><span class="sxs-lookup"><span data-stu-id="11fcc-125">The input pin provides one, or returns an error code.</span></span>
3.  <span data-ttu-id="11fcc-126">La broche de sortie sélectionne un allocateur.</span><span class="sxs-lookup"><span data-stu-id="11fcc-126">The output pin selects an allocator.</span></span> <span data-ttu-id="11fcc-127">Il peut en utiliser un fourni par la broche d’entrée ou créer son propre code.</span><span class="sxs-lookup"><span data-stu-id="11fcc-127">It can use one provided by the input pin, or create its own.</span></span>
4.  <span data-ttu-id="11fcc-128">La broche de sortie appelle [**IMemAllocator :: SetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-setproperties) pour définir les propriétés Allocator.</span><span class="sxs-lookup"><span data-stu-id="11fcc-128">The output pin calls [**IMemAllocator::SetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-setproperties) to set the allocator properties.</span></span> <span data-ttu-id="11fcc-129">Toutefois, l’allocateur peut ne pas honorer les propriétés demandées.</span><span class="sxs-lookup"><span data-stu-id="11fcc-129">However, the allocator might not honor the requested properties.</span></span> <span data-ttu-id="11fcc-130">(Par exemple, cela peut se produire si la broche d’entrée fournit l’allocateur.) L’allocateur retourne les propriétés réelles sous la forme d’un paramètre de sortie dans la méthode **SetProperties** .</span><span class="sxs-lookup"><span data-stu-id="11fcc-130">(For example, this can happen if the input pin provides the allocator.) The allocator returns the actual properties as an output parameter in the **SetProperties** method.</span></span>
5.  <span data-ttu-id="11fcc-131">Outpin appelle [**IMemInputPin :: NotifyAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-notifyallocator) pour informer la broche d’entrée de la sélection.</span><span class="sxs-lookup"><span data-stu-id="11fcc-131">The outpin calls [**IMemInputPin::NotifyAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-notifyallocator) to inform the input pin of the selection.</span></span>
6.  <span data-ttu-id="11fcc-132">La broche d’entrée doit appeler [**IMemAllocator :: GetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getproperties) pour vérifier si les propriétés Allocator sont acceptables.</span><span class="sxs-lookup"><span data-stu-id="11fcc-132">The input pin should call [**IMemAllocator::GetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getproperties) to verify whether the allocator properties are acceptable.</span></span>
7.  <span data-ttu-id="11fcc-133">La broche de sortie est chargée de la validation et de la désactivation de l’allocateur.</span><span class="sxs-lookup"><span data-stu-id="11fcc-133">The output pin is responsible for committing and decommitting the allocator.</span></span> <span data-ttu-id="11fcc-134">Cela se produit lorsque la diffusion en continu démarre et s’arrête.</span><span class="sxs-lookup"><span data-stu-id="11fcc-134">This occurs when streaming starts and stops.</span></span>

<span data-ttu-id="11fcc-135">Dans une connexion **IAsyncReader** , la négociation d’allocateur fonctionne comme suit :</span><span class="sxs-lookup"><span data-stu-id="11fcc-135">In an **IAsyncReader** connection, allocator negotiation works as follows:</span></span>

1.  <span data-ttu-id="11fcc-136">La broche d’entrée appelle [**IAsyncReader :: RequestAllocator**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-requestallocator) sur la broche de sortie.</span><span class="sxs-lookup"><span data-stu-id="11fcc-136">The input pin calls [**IAsyncReader::RequestAllocator**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-requestallocator) on the output pin.</span></span> <span data-ttu-id="11fcc-137">La broche d’entrée spécifie ses exigences en matière de mémoire tampon et, éventuellement, fournit un allocateur.</span><span class="sxs-lookup"><span data-stu-id="11fcc-137">The input pin specifies its buffer requirements and, optionally, provides an allocator.</span></span>
2.  <span data-ttu-id="11fcc-138">La broche de sortie sélectionne un allocateur.</span><span class="sxs-lookup"><span data-stu-id="11fcc-138">The output pin selects an allocator.</span></span> <span data-ttu-id="11fcc-139">Il peut utiliser celui fourni par la broche d’entrée, le cas échéant, ou créer son propre code.</span><span class="sxs-lookup"><span data-stu-id="11fcc-139">It can use the one provided by the input pin, if any, or create its own.</span></span>
3.  <span data-ttu-id="11fcc-140">La broche de sortie retourne l’allocateur en tant que paramètre sortant dans la méthode **RequestAllocator** .</span><span class="sxs-lookup"><span data-stu-id="11fcc-140">The output pin returns the allocator as an outgoing parameter in the **RequestAllocator** method.</span></span> <span data-ttu-id="11fcc-141">La broche d’entrée doit vérifier les propriétés de l’allocateur.</span><span class="sxs-lookup"><span data-stu-id="11fcc-141">The input pin should check the allocator properties.</span></span>
4.  <span data-ttu-id="11fcc-142">La broche d’entrée est chargée de la validation et de la désactivation de l’allocateur.</span><span class="sxs-lookup"><span data-stu-id="11fcc-142">The input pin is responsible for committing and decommitting the allocator.</span></span>
5.  <span data-ttu-id="11fcc-143">À tout moment pendant le processus de négociation de l’allocateur, le code pin peut faire échouer la connexion.</span><span class="sxs-lookup"><span data-stu-id="11fcc-143">At any time during the allocator negotiation process, either pin can fail the connection.</span></span>
6.  <span data-ttu-id="11fcc-144">Si la broche de sortie utilise l’allocateur de la broche d’entrée, elle peut utiliser cet allocateur uniquement pour fournir des échantillons à cette broche d’entrée.</span><span class="sxs-lookup"><span data-stu-id="11fcc-144">If the output pin uses the input pin's allocator, it can use that allocator only to deliver samples to that input pin.</span></span> <span data-ttu-id="11fcc-145">Le filtre propriétaire ne doit pas utiliser l’allocateur pour remettre des échantillons à d’autres broches.</span><span class="sxs-lookup"><span data-stu-id="11fcc-145">The owning filter must not use the allocator to deliver samples to other pins.</span></span>

## <a name="related-topics"></a><span data-ttu-id="11fcc-146">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="11fcc-146">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="11fcc-147">Fourniture d’un allocateur personnalisé</span><span class="sxs-lookup"><span data-stu-id="11fcc-147">Providing a Custom Allocator</span></span>](providing-a-custom-allocator.md)
</dt> </dl>

 

 



