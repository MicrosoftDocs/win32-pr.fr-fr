---
description: Fourniture d’un Allocator-Presenter personnalisé pour VMR-7
ms.assetid: 19b43c9b-2578-418f-b03b-af7c7a3a46e4
title: Fourniture d’un Allocator-Presenter personnalisé pour VMR-7
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1e79f191401f990214b2551f9210fab4dfe4d43b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104564241"
---
# <a name="supplying-a-custom-allocator-presenter-for-vmr-7"></a><span data-ttu-id="eb76f-103">Fourniture d’un Allocator-Presenter personnalisé pour VMR-7</span><span class="sxs-lookup"><span data-stu-id="eb76f-103">Supplying a Custom Allocator-Presenter for VMR-7</span></span>

<span data-ttu-id="eb76f-104">L’Allocator-Presenter est chargé d’allouer des surfaces DirectDraw et de présenter les images vidéo pour le rendu.</span><span class="sxs-lookup"><span data-stu-id="eb76f-104">The allocator-presenter is responsible for allocating DirectDraw surfaces and presenting the video frames for rendering.</span></span> <span data-ttu-id="eb76f-105">Dans la grande majorité des scénarios, les fonctionnalités de l’allocateur par défaut-Presenter sont plus que suffisantes pour les besoins d’une application.</span><span class="sxs-lookup"><span data-stu-id="eb76f-105">In the vast majority of scenarios, the functionality of the default allocator-presenter will be more than sufficient for an application's needs.</span></span> <span data-ttu-id="eb76f-106">Toutefois, en branchant un Allocator-Presenter personnalisé, une application peut obtenir un accès direct aux bits vidéo et contrôler complètement le processus de rendu.</span><span class="sxs-lookup"><span data-stu-id="eb76f-106">But by plugging in a custom allocator-presenter, an application can obtain direct access to the video bits and completely control the rendering process.</span></span> <span data-ttu-id="eb76f-107">Le compromis pour cette puissance accrue est que l’application doit gérer la complexité supplémentaire de la gestion de la surface de DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="eb76f-107">The trade-off for this increased power is that the application must handle the added complexity of DirectDraw surface management.</span></span>

![utilisation d’un allocateur personnalisé-présentateur](images/custom-ap.png)

<span data-ttu-id="eb76f-109">La figure précédente montre les interfaces de communication utilisées par VMR et l’Allocator-presenter.</span><span class="sxs-lookup"><span data-stu-id="eb76f-109">The preceding figure shows the communication interfaces used by the VMR and the allocator-presenter.</span></span> <span data-ttu-id="eb76f-110">Un Allocator-Presenter personnalisé qui remplace toutes les fonctionnalités d’allocation et de présentation par défaut doit implémenter les interfaces [**IVMRImagePresenter**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) et [**IVMRSurfaceAllocator**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocator) , et éventuellement [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol).</span><span class="sxs-lookup"><span data-stu-id="eb76f-110">A custom allocator-presenter that overrides all of the default allocation and presentation functionality must implement the [**IVMRImagePresenter**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) and [**IVMRSurfaceAllocator**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocator) interfaces, and optionally, [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol).</span></span>

<span data-ttu-id="eb76f-111">Pour remplacer l’Allocator-Presenter par défaut, une application appelle la méthode [**IVMRSurfaceAllocatorNotify :: AdviseSurfaceAllocator**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-advisesurfaceallocator) et passe un pointeur vers le nouvel Allocator-presenter.</span><span class="sxs-lookup"><span data-stu-id="eb76f-111">To replace the default allocator-presenter, an application calls the [**IVMRSurfaceAllocatorNotify::AdviseSurfaceAllocator**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-advisesurfaceallocator) method and passes in a pointer to the new allocator-presenter.</span></span> <span data-ttu-id="eb76f-112">En réponse à cet appel, VMR appellera la méthode [**IVMRSurfaceAllocator :: AdviseNotify**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocator-advisenotify) de l’Allocator-Presenter pour fournir le pointeur à l’interface [**IVMRSurfaceAllocatorNotify**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocatornotify) de VMR.</span><span class="sxs-lookup"><span data-stu-id="eb76f-112">In response to this call, the VMR will call the allocator-presenter's [**IVMRSurfaceAllocator::AdviseNotify**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocator-advisenotify) method to provide the pointer to the VMR's [**IVMRSurfaceAllocatorNotify**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocatornotify) interface.</span></span> <span data-ttu-id="eb76f-113">L’Allocator-Presenter utilise ce pointeur d’interface lors du passage des événements à VMR avec la méthode [**IVMRSurfaceAllocatorNotify :: NotifyEvent**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-notifyevent) .</span><span class="sxs-lookup"><span data-stu-id="eb76f-113">The allocator-presenter will use this interface pointer when passing events to the VMR with the [**IVMRSurfaceAllocatorNotify::NotifyEvent**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-notifyevent) method.</span></span>

<span data-ttu-id="eb76f-114">En guise de solution alternative, une application peut utiliser à la fois son propre allocateur-présentateur et l’allocateur par défaut-présentateur.</span><span class="sxs-lookup"><span data-stu-id="eb76f-114">As an alternate solution, an application can use both its own allocator-presenter and the default allocator-presenter.</span></span> <span data-ttu-id="eb76f-115">Dans ce scénario, l’allocateur personnalisé-Presenter gère uniquement les appels où des fonctionnalités personnalisées sont nécessaires et passe le reste des appels de VMR à l’Allocator par défaut-presenter.</span><span class="sxs-lookup"><span data-stu-id="eb76f-115">In this scenario, the custom allocator-presenter handles only those calls where custom functionality is needed, and passes the rest of the calls from the VMR through to the default allocator-presenter.</span></span> <span data-ttu-id="eb76f-116">Dans de nombreux cas, il est seulement nécessaire de remplacer l’interface [**IVMRImagePresenter**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) .</span><span class="sxs-lookup"><span data-stu-id="eb76f-116">In many cases, it is only necessary to override the [**IVMRImagePresenter**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) interface.</span></span>

![utilisation de deux aslocateurs-présentateurs](images/custom-ap2.png)

<span data-ttu-id="eb76f-118">Pour utiliser à la fois un Allocator personnalisé-présentateur et l’Allocator-présentateur par défaut, une application appelle d’abord [**IVMRSurfaceAllocatorNotify :: AdviseSurfaceAllocator**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-advisesurfaceallocator) pour fournir un pointeur vers le nouvel Allocator-présentateur.</span><span class="sxs-lookup"><span data-stu-id="eb76f-118">To use both a custom allocator-presenter and the default allocator-presenter, an application would first call [**IVMRSurfaceAllocatorNotify::AdviseSurfaceAllocator**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-advisesurfaceallocator) to provide a pointer to the new allocator-presenter.</span></span> <span data-ttu-id="eb76f-119">Cela entraîne la destruction de l’Allocator-Presenter par défaut. l’application doit donc créer une autre instance de celle-ci en appelant **QueryInterface** sur VMR et en demandant l’interface [**IVMRSurfaceAllocator**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocator) .</span><span class="sxs-lookup"><span data-stu-id="eb76f-119">This causes the default allocator-presenter to be destroyed, so the application must create another instance of it by calling **QueryInterface** on the VMR and requesting the [**IVMRSurfaceAllocator**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocator) interface.</span></span> <span data-ttu-id="eb76f-120">Comme indiqué dans l’illustration précédente, l’allocateur-présentateur personnalisé remplace les méthodes de l’interface [**IVMRImagePresenter**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) et passe simplement tous les appels à l’interface **IVMRSurfaceAllocator** par le biais de l’implémentation par défaut.</span><span class="sxs-lookup"><span data-stu-id="eb76f-120">As shown in the preceding figure, the custom allocator-presenter overrides the [**IVMRImagePresenter**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) interface methods, and simply passes all calls to the **IVMRSurfaceAllocator** interface through to the default implementation.</span></span> <span data-ttu-id="eb76f-121">La figure montre également l’interface [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) comme étant implémentée sur l’Allocator-presenter.</span><span class="sxs-lookup"><span data-stu-id="eb76f-121">The figure also shows the [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) interface as being implemented on the allocator-presenter.</span></span>

## <a name="related-topics"></a><span data-ttu-id="eb76f-122">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="eb76f-122">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="eb76f-123">Fourniture d’un Allocator-Presenter personnalisé pour VMR-9</span><span class="sxs-lookup"><span data-stu-id="eb76f-123">Supplying a Custom Allocator-Presenter for VMR-9</span></span>](supplying-a-custom-allocator-presenter-for-vmr-9.md)
</dt> <dt>

[<span data-ttu-id="eb76f-124">Mode de lecture non rendu VMR (Allocator personnalisé-présentateur)</span><span class="sxs-lookup"><span data-stu-id="eb76f-124">VMR Renderless Playback Mode (Custom Allocator-Presenters)</span></span>](vmr-renderless-playback-mode--custom-allocator-presenters.md)
</dt> </dl>

 

 



