---
description: Gestion des modifications de format à partir du convertisseur vidéo
ms.assetid: ac7d7b1c-3c9a-4693-87ea-0a10a8ab915c
title: Gestion des modifications de format à partir du convertisseur vidéo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d731ac4b9d6985cf5ad92f642b6d8262209fa91d
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "106519185"
---
# <a name="handling-format-changes-from-the-video-renderer"></a><span data-ttu-id="234c7-103">Gestion des modifications de format à partir du convertisseur vidéo</span><span class="sxs-lookup"><span data-stu-id="234c7-103">Handling Format Changes from the Video Renderer</span></span>

<span data-ttu-id="234c7-104">Cette section décrit comment un filtre de décodeur ou de transformation doit gérer les modifications de format à partir du convertisseur vidéo.</span><span class="sxs-lookup"><span data-stu-id="234c7-104">This section describes how a decoder filter or transform filter should handle format changes from the video renderer.</span></span>

<span data-ttu-id="234c7-105">**Filtre de convertisseur vidéo**</span><span class="sxs-lookup"><span data-stu-id="234c7-105">**Video Renderer Filter**</span></span>

<span data-ttu-id="234c7-106">Lorsque l’ancien filtre de [convertisseur vidéo](video-renderer-filter.md) se connecte, il requiert un format RVB qui correspond au format d’affichage de l’écran principal.</span><span class="sxs-lookup"><span data-stu-id="234c7-106">When the old [Video Renderer](video-renderer-filter.md) filter connects, it requires an RGB format that matches the display format of the primary monitor.</span></span> <span data-ttu-id="234c7-107">Cela lui permet d’utiliser GDI pour le rendu si DirectDraw n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="234c7-107">This enables it to use GDI for rendering if DirectDraw is not available.</span></span> <span data-ttu-id="234c7-108">Lors du démarrage de la lecture, le convertisseur vidéo peut passer à un format compatible DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="234c7-108">When playback starts, the Video Renderer may switch to a DirectDraw-compatible format.</span></span> <span data-ttu-id="234c7-109">Pour verfify si le filtre en amont peut prendre en charge le nouveau format, le convertisseur vidéo appelle [**IPIN :: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) sur la broche de sortie du filtre en amont.</span><span class="sxs-lookup"><span data-stu-id="234c7-109">To verfify whether the upstream filter can support the new format, the Video Renderer calls [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) on the upstream filter's output pin.</span></span> <span data-ttu-id="234c7-110">Si le filtre amont accepte le nouveau format, la méthode **QueryAccept** retourne S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="234c7-110">If the upstream filter accepts the new format, the **QueryAccept** method returns S\_OK.</span></span> <span data-ttu-id="234c7-111">Le convertisseur vidéo change de format en joignant un type de média avec le nouveau format à l’exemple de support suivant retourné par son allocateur.</span><span class="sxs-lookup"><span data-stu-id="234c7-111">The Video Renderer switches formats by attaching a media type with the new format to the next media sample returned by its allocator.</span></span> <span data-ttu-id="234c7-112">Le filtre amont doit vérifier les modifications de format en appelant [**IMediaSample :: GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) sur chaque échantillon.</span><span class="sxs-lookup"><span data-stu-id="234c7-112">The upstream filter should check for format changes by calling [**IMediaSample::GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) on each sample.</span></span> <span data-ttu-id="234c7-113">Le convertisseur vidéo peut basculer entre le format d’origine et le nouveau format à tout moment pendant la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="234c7-113">The Video Renderer may switch back and forth between the original format and new format at any time during streaming.</span></span> <span data-ttu-id="234c7-114">Elle n’appelle pas **QueryAccept** après la première modification de mise en forme.</span><span class="sxs-lookup"><span data-stu-id="234c7-114">It does not call **QueryAccept** after the first format change.</span></span> <span data-ttu-id="234c7-115">Une fois que le filtre en amont a accepté le nouveau format, il doit être en mesure de basculer vers l’arrière.</span><span class="sxs-lookup"><span data-stu-id="234c7-115">Once the upstream filter has accepted the new format, it must be able to switch back and forth.</span></span>

<span data-ttu-id="234c7-116">Le filtre amont peut rejeter le changement de format en renvoyant S \_ false à partir de **QueryAccept**.</span><span class="sxs-lookup"><span data-stu-id="234c7-116">The upstream filter can reject the format change by returning S\_FALSE from **QueryAccept**.</span></span> <span data-ttu-id="234c7-117">Dans ce cas, le convertisseur vidéo continue d’utiliser GDI avec le format d’origine.</span><span class="sxs-lookup"><span data-stu-id="234c7-117">In that case, the Video Renderer continues to use GDI with the original format.</span></span>

<span data-ttu-id="234c7-118">**Filtre de convertisseur de mixage vidéo**</span><span class="sxs-lookup"><span data-stu-id="234c7-118">**Video Mixing Renderer Filter**</span></span>

<span data-ttu-id="234c7-119">Le filtre de convertisseur de mixage vidéo (VMR-7 et VMR-9) se connecte avec n’importe quel format pris en charge par le matériel graphique du système.</span><span class="sxs-lookup"><span data-stu-id="234c7-119">The Video Mixing Renderer filter (VMR-7 and VMR-9) will connect with any format that is supported by the graphics hardware on the system.</span></span> <span data-ttu-id="234c7-120">VMR-7 utilise toujours DirectDraw pour le rendu et alloue les surfaces DirectDraw sous-jacentes lorsque le filtre amont se connecte.</span><span class="sxs-lookup"><span data-stu-id="234c7-120">The VMR-7 always uses DirectDraw for rendering, and allocates the underlying DirectDraw surfaces when the upstream filter connects.</span></span> <span data-ttu-id="234c7-121">VMR-9 utilise toujours Direct3D pour le rendu et alloue les surfaces Direct3D sous-jacentes lorsque le filtre amont se connecte.</span><span class="sxs-lookup"><span data-stu-id="234c7-121">The VMR-9 always uses Direct3D for rendering, and allocates the underlying Direct3D surfaces when the upstream filter connects.</span></span>

<span data-ttu-id="234c7-122">Le matériel graphique peut nécessiter un Stride plus grand que la largeur de l’image.</span><span class="sxs-lookup"><span data-stu-id="234c7-122">The graphics hardware may require a larger surface stride than the image width.</span></span> <span data-ttu-id="234c7-123">Dans ce cas, VMR demande un nouveau format en appelant **QueryAccept**.</span><span class="sxs-lookup"><span data-stu-id="234c7-123">In that case, the VMR requests a new format by calling **QueryAccept**.</span></span> <span data-ttu-id="234c7-124">Il signale le Stride de surface dans le membre à **bichasse** du [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) dans le format vidéo.</span><span class="sxs-lookup"><span data-stu-id="234c7-124">It reports the surface stride in the **biWidth** member of the [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) in the video format.</span></span> <span data-ttu-id="234c7-125">Si le filtre amont ne retourne pas la \_ valeur S dans **QUERYACCEPT**, VMR rejette le format et tente de se connecter en utilisant le format suivant publié par le filtre amont.</span><span class="sxs-lookup"><span data-stu-id="234c7-125">If the upstream filter does not return S\_OK from **QueryAccept**, the VMR rejects the format and tries to connect using the next format advertised by the upstream filter.</span></span> <span data-ttu-id="234c7-126">VMR attache le type de média avec le nouveau format au premier exemple de support.</span><span class="sxs-lookup"><span data-stu-id="234c7-126">The VMR attaches the media type with the new format to the first media sample.</span></span> <span data-ttu-id="234c7-127">Après le premier exemple, le format reste constant. VMR ne change pas les formats lorsque le graphique est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="234c7-127">After the first sample, the format remains constant; the VMR will not switch formats while the graph is running.</span></span>

<span data-ttu-id="234c7-128">**Rendu vidéo amélioré (EVR)**</span><span class="sxs-lookup"><span data-stu-id="234c7-128">**Enhanced Video Render (EVR)**</span></span>

<span data-ttu-id="234c7-129">Le EVR utilise toujours Direct3D pour le rendu.</span><span class="sxs-lookup"><span data-stu-id="234c7-129">The EVR always uses Direct3D for rendering.</span></span> <span data-ttu-id="234c7-130">Si une plus grande surface Stride est nécessaire, EVR utilise le même mécanisme **QueryAccept** que VMR.</span><span class="sxs-lookup"><span data-stu-id="234c7-130">If a larger surface stride is needed, the EVR uses the same **QueryAccept** mechanism as the VMR.</span></span>

## <a name="related-topics"></a><span data-ttu-id="234c7-131">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="234c7-131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="234c7-132">QueryAccept (en amont)</span><span class="sxs-lookup"><span data-stu-id="234c7-132">QueryAccept (Upstream)</span></span>](queryaccept--upstream.md)
</dt> </dl>

 

 



