---
description: Vidage
ms.assetid: 868218c4-3e1a-4da0-89fa-30a9848da0e8
title: Vidage
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 575f311020c2c7a567e544b80ba323a29051cc38
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104522399"
---
# <a name="flushing"></a><span data-ttu-id="d4668-103">Vidage</span><span class="sxs-lookup"><span data-stu-id="d4668-103">Flushing</span></span>

<span data-ttu-id="d4668-104">Pendant l’exécution du graphique de filtre, des quantités arbitraires de données peuvent être déplacées dans le graphique.</span><span class="sxs-lookup"><span data-stu-id="d4668-104">While the filter graph is running, arbitrary amounts of data can be moving through the graph.</span></span> <span data-ttu-id="d4668-105">Certaines d’entre elles peuvent être dans des files d’attente, en attente de remise.</span><span class="sxs-lookup"><span data-stu-id="d4668-105">Some of it might be in queues, waiting to be delivered.</span></span> <span data-ttu-id="d4668-106">Il arrive parfois que le graphique de filtre doive supprimer ces données en attente aussi rapidement que possible et les remplacer par de nouvelles données.</span><span class="sxs-lookup"><span data-stu-id="d4668-106">There are times when the filter graph needs to remove this pending data as quickly as possible and replace it with new data.</span></span> <span data-ttu-id="d4668-107">Après une commande Seek, par exemple, le filtre source génère des échantillons à partir d’une nouvelle position dans la source.</span><span class="sxs-lookup"><span data-stu-id="d4668-107">After a seek command, for example, the source filter generates samples from a new position in the source.</span></span> <span data-ttu-id="d4668-108">Pour réduire la latence, les filtres en aval doivent ignorer les exemples qui ont été créés avant la commande Seek.</span><span class="sxs-lookup"><span data-stu-id="d4668-108">To minimize latency, downstream filters should discard any samples that were created before the seek command.</span></span> <span data-ttu-id="d4668-109">Le processus d’abandon des exemples s’appelle le *vidage*.</span><span class="sxs-lookup"><span data-stu-id="d4668-109">The process of discarding samples is called *flushing*.</span></span> <span data-ttu-id="d4668-110">Cela permet au graphique d’être plus réactif lorsque les événements modifient le workflow de données normal.</span><span class="sxs-lookup"><span data-stu-id="d4668-110">It enables the graph to be more responsive when events alter the normal data flow.</span></span>

<span data-ttu-id="d4668-111">Le vidage est géré légèrement différemment par le modèle d’extraction.</span><span class="sxs-lookup"><span data-stu-id="d4668-111">Flushing is handled slightly differently by the pull model than the push model.</span></span> <span data-ttu-id="d4668-112">Cet article commence par décrire le modèle push. Il décrit ensuite les différences dans le modèle d’extraction.</span><span class="sxs-lookup"><span data-stu-id="d4668-112">This article starts by describing the push model; then it describes the differences in the pull model.</span></span>

<span data-ttu-id="d4668-113">Le vidage se produit en deux étapes.</span><span class="sxs-lookup"><span data-stu-id="d4668-113">Flushing happens in two stages.</span></span>

-   <span data-ttu-id="d4668-114">Tout d’abord, le filtre source appelle [**IPIN :: BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) sur la broche d’entrée du filtre en aval.</span><span class="sxs-lookup"><span data-stu-id="d4668-114">First, the source filter calls [**IPin::BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) on the downstream filter's input pin.</span></span> <span data-ttu-id="d4668-115">Le filtre en aval commence à rejeter les exemples de en amont.</span><span class="sxs-lookup"><span data-stu-id="d4668-115">The downstream filter starts rejecting samples from upstream.</span></span> <span data-ttu-id="d4668-116">Il ignore également tous les exemples qu’il contient et envoie l’appel **BeginFlush** en aval au filtre suivant.</span><span class="sxs-lookup"><span data-stu-id="d4668-116">It also discards any samples it is holding, and sends the **BeginFlush** call downstream to the next filter.</span></span>
-   <span data-ttu-id="d4668-117">Lorsque le filtre source est prêt à envoyer de nouvelles données, il appelle [**IPIN :: EndFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) sur la broche d’entrée.</span><span class="sxs-lookup"><span data-stu-id="d4668-117">When the source filter is ready to send new data, it calls [**IPin::EndFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) on the input pin.</span></span> <span data-ttu-id="d4668-118">Cela indique au filtre en aval qu’il peut recevoir de nouveaux exemples.</span><span class="sxs-lookup"><span data-stu-id="d4668-118">This signals the downstream filter that it can receive new samples.</span></span> <span data-ttu-id="d4668-119">Le filtre en aval envoie l’appel **EndFlush** au filtre suivant.</span><span class="sxs-lookup"><span data-stu-id="d4668-119">The downstream filter sends the **EndFlush** call to the next filter.</span></span>

<span data-ttu-id="d4668-120">Dans la méthode **BeginFlush** , la broche d’entrée effectue les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="d4668-120">In the **BeginFlush** method, the input pin does the following:</span></span>

1.  <span data-ttu-id="d4668-121">Appelle **BeginFlush** sur les broches d’entrée en aval.</span><span class="sxs-lookup"><span data-stu-id="d4668-121">Calls **BeginFlush** on downstream input pins.</span></span>
2.  <span data-ttu-id="d4668-122">Rejette les autres appels qui diffusent des données, notamment **Receive** et **EndOfStream**.</span><span class="sxs-lookup"><span data-stu-id="d4668-122">Rejects any further calls that stream data, including **Receive** and **EndOfStream**.</span></span>
3.  <span data-ttu-id="d4668-123">Débloque tous les filtres en amont qui sont bloqués en attente d’un échantillon à partir de l’allocateur du filtre.</span><span class="sxs-lookup"><span data-stu-id="d4668-123">Unblocks any upstream filters that are blocked waiting for a sample from the filter's allocator.</span></span> <span data-ttu-id="d4668-124">Certains filtres annulent la validation de leurs allocateurs à cet effet.</span><span class="sxs-lookup"><span data-stu-id="d4668-124">Some filters decommit their allocators for this purpose.</span></span>
4.  <span data-ttu-id="d4668-125">Quitte toutes les attentes qui bloquent la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="d4668-125">Exits from any waits that block streaming.</span></span> <span data-ttu-id="d4668-126">Par exemple, les filtres de convertisseur sont bloqués lorsqu’ils sont en pause.</span><span class="sxs-lookup"><span data-stu-id="d4668-126">For example, renderer filters block when paused.</span></span> <span data-ttu-id="d4668-127">Ils sont également bloqués lorsqu’ils sont en attente de rendu d’un exemple au moment du flux correct.</span><span class="sxs-lookup"><span data-stu-id="d4668-127">They also block when they are waiting to render a sample at the correct stream time.</span></span> <span data-ttu-id="d4668-128">Le filtre doit débloquer, de sorte que les exemples en attente en attente peuvent être remis et rejetés.</span><span class="sxs-lookup"><span data-stu-id="d4668-128">The filter must unblock, so that samples queued upstream can be delivered and rejected.</span></span> <span data-ttu-id="d4668-129">Cette étape garantit que tous les filtres en amont finissent par débloquer.</span><span class="sxs-lookup"><span data-stu-id="d4668-129">This step ensures that all upstream filters eventually unblock.</span></span>

<span data-ttu-id="d4668-130">Dans la méthode **EndFlush** , la broche d’entrée effectue les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="d4668-130">In the **EndFlush** method, the input pin does the following:</span></span>

1.  <span data-ttu-id="d4668-131">Attend que tous les échantillons mis en file d’attente soient ignorés.</span><span class="sxs-lookup"><span data-stu-id="d4668-131">Waits for all queued samples to be discarded.</span></span>
2.  <span data-ttu-id="d4668-132">Libère toutes les données mises en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="d4668-132">Frees any buffered data.</span></span> <span data-ttu-id="d4668-133">Cette étape peut parfois être effectuée dans la méthode **BeginFlush** .</span><span class="sxs-lookup"><span data-stu-id="d4668-133">This step can sometimes be performed in the **BeginFlush** method.</span></span> <span data-ttu-id="d4668-134">Toutefois, **BeginFlush** n’est pas synchronisé avec le thread de streaming.</span><span class="sxs-lookup"><span data-stu-id="d4668-134">However, **BeginFlush** is not synchronized with the streaming thread.</span></span> <span data-ttu-id="d4668-135">Le filtre ne doit pas traiter ni mettre en mémoire tampon plus de données entre l’appel à **BeginFlush** et l’appel à **EndFlush**.</span><span class="sxs-lookup"><span data-stu-id="d4668-135">The filter must not process or buffer any more data between the call to **BeginFlush** and the call to **EndFlush**.</span></span>
3.  <span data-ttu-id="d4668-136">Efface toutes les notifications d’achèvement EC en attente \_ .</span><span class="sxs-lookup"><span data-stu-id="d4668-136">Clears any pending EC\_COMPLETE notifications.</span></span>
4.  <span data-ttu-id="d4668-137">Appelle **EndFlush** en aval.</span><span class="sxs-lookup"><span data-stu-id="d4668-137">Calls **EndFlush** downstream.</span></span>

<span data-ttu-id="d4668-138">À ce stade, le filtre peut à nouveau accepter des exemples.</span><span class="sxs-lookup"><span data-stu-id="d4668-138">At this point, the filter can accept samples again.</span></span> <span data-ttu-id="d4668-139">Tous les échantillons sont garantis comme étant plus récents que le vidage.</span><span class="sxs-lookup"><span data-stu-id="d4668-139">All samples are guaranteed to be more recent than the flush.</span></span>

<span data-ttu-id="d4668-140">Dans le modèle d’extraction, le filtre de l’analyseur lance le vidage, plutôt que le filtre source.</span><span class="sxs-lookup"><span data-stu-id="d4668-140">In the pull model, the parser filter initiates flushing, rather than the source filter.</span></span> <span data-ttu-id="d4668-141">Non seulement elle appelle **IPIN :: BeginFlush** et **IPIN :: EndFlush** sur le filtre en aval, mais elle appelle également [**IAsyncReader :: BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-beginflush) et [**IAsyncReader :: EndFlush**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-endflush) sur la broche de *sortie* du filtre source.</span><span class="sxs-lookup"><span data-stu-id="d4668-141">Not only does it call **IPin::BeginFlush** and **IPin::EndFlush** on the downstream filter, it also calls [**IAsyncReader::BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-beginflush) and [**IAsyncReader::EndFlush**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-endflush) on the *output* pin of the source filter.</span></span> <span data-ttu-id="d4668-142">Si le filtre source a des demandes de lecture en attente, il les ignore.</span><span class="sxs-lookup"><span data-stu-id="d4668-142">If the source filter has pending read requests, it will discard them.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d4668-143">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="d4668-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d4668-144">Vidage des données</span><span class="sxs-lookup"><span data-stu-id="d4668-144">Flushing Data</span></span>](flushing-data.md)
</dt> </dl>

 

 



