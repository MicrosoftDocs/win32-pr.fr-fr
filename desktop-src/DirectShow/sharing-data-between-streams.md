---
description: Partage de données entre des flux
ms.assetid: e18eecf8-9475-420a-9a60-4b1b5f8fd43a
title: Partage de données entre des flux
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee0b2f53fe1952bbc16711f7c7e39c3182ba94a7
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104481976"
---
# <a name="sharing-data-between-streams"></a><span data-ttu-id="c87fe-103">Partage de données entre des flux</span><span class="sxs-lookup"><span data-stu-id="c87fe-103">Sharing Data Between Streams</span></span>

> [!Note]  
> <span data-ttu-id="c87fe-104">Ces API sont déconseillées.</span><span class="sxs-lookup"><span data-stu-id="c87fe-104">These APIs are deprecated.</span></span> <span data-ttu-id="c87fe-105">Les applications doivent utiliser le filtre d' [**accrochage d’exemple**](sample-grabber-filter.md) ou implémenter un filtre personnalisé pour obtenir des données à partir d’un graphique de filtre DirectShow.</span><span class="sxs-lookup"><span data-stu-id="c87fe-105">Applications should use the [**Sample Grabber**](sample-grabber-filter.md) filter or implement a custom filter to get data from a DirectShow filter graph.</span></span>

 

<span data-ttu-id="c87fe-106">Le traitement des données multimédias nécessite généralement une grande quantité de ressources système. par conséquent, vous devez éviter de copier les données dans la mesure du possible.</span><span class="sxs-lookup"><span data-stu-id="c87fe-106">Processing multimedia data typically requires a great deal of system resources; therefore, you should avoid copying data whenever possible.</span></span> <span data-ttu-id="c87fe-107">L’architecture de streaming prend en charge les exemples de flux partagés, un mécanisme qui déplace les données d’un flux vers un autre sans les copier.</span><span class="sxs-lookup"><span data-stu-id="c87fe-107">The streaming architecture supports shared stream samples, a mechanism that moves data from one stream to another without copying it.</span></span> <span data-ttu-id="c87fe-108">Cette mémoire tampon permet le transport efficace de données entre deux flux, même si le flux de destination ne prend pas spécifiquement en charge le format de données sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="c87fe-108">This buffer enables the efficient transportation of data between two streams even if the destination stream doesn't specifically support the underlying data format.</span></span>

<span data-ttu-id="c87fe-109">Par exemple, supposons que vous disposez d’un flux multimédia avec trois flux de données : vidéo et audio, et les données d’URL sont horodatées pour correspondre au contenu de la vidéo.</span><span class="sxs-lookup"><span data-stu-id="c87fe-109">For example, assume that you have a multimedia stream with three data streams: video and audio, and URL data time-stamped to match the video content.</span></span> <span data-ttu-id="c87fe-110">Vous souhaitez écrire une application qui ajoute une mention de droits d’auteur sur chaque image vidéo et écrit les données dans un autre flux de données pour le stockage, mais votre application ne comprend aucun format de données à l’exception du flux vidéo.</span><span class="sxs-lookup"><span data-stu-id="c87fe-110">You want to write an application that adds a copyright notice on every video frame and writes the data to another stream for storage, but your application doesn't understand any data formats except the video stream.</span></span> <span data-ttu-id="c87fe-111">Pour le flux vidéo, vous créez un exemple attaché à la surface DirectDraw souhaitée.</span><span class="sxs-lookup"><span data-stu-id="c87fe-111">For the video stream, you create a sample attached to the desired DirectDraw surface.</span></span> <span data-ttu-id="c87fe-112">Vous pouvez ensuite créer un flux de sortie en appelant la méthode [**IDirectDrawMediaStream :: CreateSample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) avec ce pointeur sur la même surface ou [**IMediaStream :: CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span><span class="sxs-lookup"><span data-stu-id="c87fe-112">You can then create an output stream by calling either the [**IDirectDrawMediaStream::CreateSample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) method with that pointer to the same surface, or [**IMediaStream::CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span></span> <span data-ttu-id="c87fe-113">Dans les deux cas, les flux d’entrée et de sortie partagent la surface DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="c87fe-113">In both cases, the input and output streams share the DirectDraw surface.</span></span> <span data-ttu-id="c87fe-114">Étant donné que vous comprenez le format vidéo, vous pouvez accéder à cette surface en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="c87fe-114">Because you understand the video format, you can access this surface as needed.</span></span>

<span data-ttu-id="c87fe-115">Pour récupérer les autres pointeurs de flux source (audio et URL), énumérez le flux de conteneur source et récupérez les pointeurs vers les flux qui ne sont pas des vidéos.</span><span class="sxs-lookup"><span data-stu-id="c87fe-115">To retrieve the other source stream pointers (audio and URL), enumerate the source container stream and grab pointers to the nonvideo streams.</span></span> <span data-ttu-id="c87fe-116">Chacun de ces flux source est associé à un flux de sortie dans le conteneur du flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="c87fe-116">Each of these source streams has an associated output stream in the output stream container.</span></span> <span data-ttu-id="c87fe-117">Récupérez ces pointeurs de sortie en appelant la méthode [**IMultiMediaStream :: GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) sur le conteneur de sortie avec chacun des pointeurs de flux source.</span><span class="sxs-lookup"><span data-stu-id="c87fe-117">Retrieve these output pointers by calling the [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) method on the output container with each of the source stream pointers.</span></span> <span data-ttu-id="c87fe-118">Les étapes de ce processus sont décrites ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="c87fe-118">The following steps describe this process.</span></span>

1.  <span data-ttu-id="c87fe-119">Appelez [**IMultiMediaStream :: EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) pour récupérer un pointeur vers un flux source.</span><span class="sxs-lookup"><span data-stu-id="c87fe-119">Call [**IMultiMediaStream::EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) to retrieve a pointer to a source stream.</span></span> <span data-ttu-id="c87fe-120">Assurez-vous qu’il ne s’agit pas du flux vidéo, car votre application comprend déjà son format.</span><span class="sxs-lookup"><span data-stu-id="c87fe-120">Make sure that it's not the video stream, because your application already understands its format.</span></span>
2.  <span data-ttu-id="c87fe-121">Appelez [**IMultiMediaStream :: GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) sur le flux de conteneur de sortie avec le pointeur de l’étape 1.</span><span class="sxs-lookup"><span data-stu-id="c87fe-121">Call [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) on the output container stream with the pointer from step 1.</span></span> <span data-ttu-id="c87fe-122">Cela retourne un pointeur vers le flux de sortie souhaité.</span><span class="sxs-lookup"><span data-stu-id="c87fe-122">This returns a pointer to the desired output stream.</span></span>
3.  <span data-ttu-id="c87fe-123">Appelez [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) sur le flux source.</span><span class="sxs-lookup"><span data-stu-id="c87fe-123">Call [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) on the source stream.</span></span>
4.  <span data-ttu-id="c87fe-124">Appelez [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) sur le flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="c87fe-124">Call [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) on the output stream.</span></span>
5.  <span data-ttu-id="c87fe-125">Appelez [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) sur le flux source pour lire les données.</span><span class="sxs-lookup"><span data-stu-id="c87fe-125">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the source stream to read the data.</span></span>
6.  <span data-ttu-id="c87fe-126">Appelez [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) sur le flux de sortie pour écrire les données.</span><span class="sxs-lookup"><span data-stu-id="c87fe-126">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the output stream to write the data.</span></span>

<span data-ttu-id="c87fe-127">Répétez ces étapes pour chaque flux dont le format n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="c87fe-127">Repeat these steps for each stream whose format you don't support.</span></span> <span data-ttu-id="c87fe-128">Lorsque les deux exemples terminent la mise à jour, le flux de sortie contient toutes les données du flux source et vous avez terminé.</span><span class="sxs-lookup"><span data-stu-id="c87fe-128">When both samples finish updating, the output stream has all data from the source stream and you are done.</span></span>

 

 



