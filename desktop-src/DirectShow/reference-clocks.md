---
description: Horloges de référence
ms.assetid: 43f1a4d6-dbed-4940-a301-d863ddd34bce
title: Horloges de référence
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9b958787f4dbdb20cd595b10cf486f59222a072
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "106515739"
---
# <a name="reference-clocks"></a><span data-ttu-id="9ee76-103">Horloges de référence</span><span class="sxs-lookup"><span data-stu-id="9ee76-103">Reference Clocks</span></span>

<span data-ttu-id="9ee76-104">L’une des fonctions du gestionnaire de graphique de filtre consiste à synchroniser tous les filtres du graphique avec la même horloge, appelée *horloge de référence*.</span><span class="sxs-lookup"><span data-stu-id="9ee76-104">One function of the Filter Graph Manager is to synchronize all of the filters in the graph to the same clock, called the *reference clock*.</span></span>

<span data-ttu-id="9ee76-105">Tout objet qui expose l’interface [**IReferenceClock**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock) peut agir comme l’horloge de référence.</span><span class="sxs-lookup"><span data-stu-id="9ee76-105">Any object that exposes the [**IReferenceClock**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock) interface can act as the reference clock.</span></span> <span data-ttu-id="9ee76-106">L’horloge de référence peut être fournie par un filtre DirectShow, généralement le convertisseur audio, qui a accès à une horloge matérielle.</span><span class="sxs-lookup"><span data-stu-id="9ee76-106">The reference clock might be provided by a DirectShow filter—typically the audio renderer, which has access to a hardware timer.</span></span> <span data-ttu-id="9ee76-107">En guise de solution de secours, le gestionnaire de graphes de filtres peut utiliser l’heure système.</span><span class="sxs-lookup"><span data-stu-id="9ee76-107">As a fallback, the Filter Graph Manager can use the system time.</span></span>

<span data-ttu-id="9ee76-108">De façon nominale, une horloge de référence mesure le temps en intervalles de 100 nanosecondes, bien que la précision réelle de l’horloge puisse être inférieure.</span><span class="sxs-lookup"><span data-stu-id="9ee76-108">Nominally, a reference clock measures time in 100-nanosecond intervals, although the actual accuracy of the clock might be less.</span></span> <span data-ttu-id="9ee76-109">Pour récupérer l’heure actuelle de l’horloge, appelez la méthode [**IReferenceClock :: getTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) .</span><span class="sxs-lookup"><span data-stu-id="9ee76-109">To retrieve the clock's current time, call the [**IReferenceClock::GetTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) method.</span></span> <span data-ttu-id="9ee76-110">La ligne de base de l’horloge (l’heure à partir de laquelle elle commence le comptage) dépend de l’implémentation. par conséquent, la valeur retournée par **getTime** n’est pas fondamentalement significative.</span><span class="sxs-lookup"><span data-stu-id="9ee76-110">The clock's baseline—the time from which it starts counting—depends on the implementation, so the value returned by **GetTime** is not inherently meaningful.</span></span> <span data-ttu-id="9ee76-111">Ce qui importe est le Delta à partir duquel le graphique commence à s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="9ee76-111">What matters is the delta from when the graph started running.</span></span>

<span data-ttu-id="9ee76-112">Bien que la précision d’une horloge de référence puisse varier, il est garanti que les temps retournés par la méthode [**getTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) augmentent de manière monotone.</span><span class="sxs-lookup"><span data-stu-id="9ee76-112">Although the accuracy of a reference clock can vary, the times returned by the [**GetTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) method are guaranteed to increase monotonically.</span></span> <span data-ttu-id="9ee76-113">En d’autres termes, les temps d’horloge ne seront jamais redirigés vers l’arrière.</span><span class="sxs-lookup"><span data-stu-id="9ee76-113">In other words, clock times will never go backward.</span></span> <span data-ttu-id="9ee76-114">Si une horloge de référence génère des temps d’horloge à partir d’une source matérielle et que l’horloge matérielle passe en arrière (par exemple, s’il y a un ajustement de l’horloge), la méthode **getTime** doit continuer à retourner la dernière heure signalée jusqu’à ce que l’horloge matérielle soit interceptée.</span><span class="sxs-lookup"><span data-stu-id="9ee76-114">If a reference clock is generating clock times from a hardware source and the hardware clock jumps backward (for example, if there is an adjustment to the clock), the **GetTime** method should continue to return the last reported time until the hardware clock catches up.</span></span> <span data-ttu-id="9ee76-115">Pour plus d’informations, consultez [**CBaseReferenceClock, classe**](cbasereferenceclock.md).</span><span class="sxs-lookup"><span data-stu-id="9ee76-115">For more information, see [**CBaseReferenceClock Class**](cbasereferenceclock.md).</span></span>

<span data-ttu-id="9ee76-116">**Horloge de référence par défaut**</span><span class="sxs-lookup"><span data-stu-id="9ee76-116">**Default Reference Clock**</span></span>

<span data-ttu-id="9ee76-117">Le gestionnaire de graphes de filtres sélectionne automatiquement une horloge de référence lorsque le graphique s’exécute.</span><span class="sxs-lookup"><span data-stu-id="9ee76-117">The Filter Graph Manager automatically selects a reference clock when the graph runs.</span></span> <span data-ttu-id="9ee76-118">Il utilise l’algorithme suivant pour sélectionner l’horloge :</span><span class="sxs-lookup"><span data-stu-id="9ee76-118">It uses the following algorithm to select the clock:</span></span>

-   <span data-ttu-id="9ee76-119">Si l’application a sélectionné une horloge (voir ci-dessous), utilisez cette horloge.</span><span class="sxs-lookup"><span data-stu-id="9ee76-119">If the application has selected a clock (see below), use that clock.</span></span>
-   <span data-ttu-id="9ee76-120">Si le graphique contient un filtre de source dynamique qui prend en charge [**IReferenceClock**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock), utilisez ce filtre.</span><span class="sxs-lookup"><span data-stu-id="9ee76-120">If the graph contains a live source filter that supports [**IReferenceClock**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock), use that filter.</span></span> <span data-ttu-id="9ee76-121">Pour obtenir la définition d’une source dynamique, consultez la page [sources dynamiques](live-sources.md).</span><span class="sxs-lookup"><span data-stu-id="9ee76-121">For the definition of a live source, see [Live Sources](live-sources.md).</span></span>
-   <span data-ttu-id="9ee76-122">Si le graphique ne contient aucun filtre de source dynamique, utilisez un filtre dans le graphique qui prend en charge [**IReferenceClock**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock), en commençant par les convertisseurs et en amont.</span><span class="sxs-lookup"><span data-stu-id="9ee76-122">If the graph does NOT contain any live source filters, use any filter in the graph that supports [**IReferenceClock**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock), starting from the renderers and working upstream.</span></span> <span data-ttu-id="9ee76-123">Préférer les filtres connectés aux filtres non connectés.</span><span class="sxs-lookup"><span data-stu-id="9ee76-123">Prefer connected filters over unconnected filters.</span></span> <span data-ttu-id="9ee76-124">(Si le graphique effectue le rendu d’un flux audio, cette étape de l’algorithme sélectionne normalement le filtre de convertisseur audio.)</span><span class="sxs-lookup"><span data-stu-id="9ee76-124">(If the graph is rendering an audio stream, this step in the algorithm will normally select the audio renderer filter.)</span></span>
-   <span data-ttu-id="9ee76-125">Si aucun filtre ne fournit une horloge appropriée, utilisez l' [horloge de référence système](system-reference-clock.md), qui est basée sur l’heure système.</span><span class="sxs-lookup"><span data-stu-id="9ee76-125">If no filter provides a suitable clock, use the [System Reference Clock](system-reference-clock.md), which is based on the system time.</span></span>

<span data-ttu-id="9ee76-126">**Définition de l’horloge de référence**</span><span class="sxs-lookup"><span data-stu-id="9ee76-126">**Setting the Reference Clock**</span></span>

<span data-ttu-id="9ee76-127">Une application peut sélectionner une horloge en appelant la méthode [**IMediaFilter :: SetSyncSource**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) sur le gestionnaire de graphique de filtre.</span><span class="sxs-lookup"><span data-stu-id="9ee76-127">An application can select a clock by calling the [**IMediaFilter::SetSyncSource**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) method on the Filter Graph Manager.</span></span> <span data-ttu-id="9ee76-128">Vous ne devez effectuer cette opération que si vous avez une raison particulière de préférer une autre horloge.</span><span class="sxs-lookup"><span data-stu-id="9ee76-128">You should do this only if you have a particular reason to prefer another clock.</span></span>

<span data-ttu-id="9ee76-129">Vous pouvez demander au gestionnaire de graphique de filtre de ne pas utiliser une horloge de référence en appelant [**SetSyncSource**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) avec la valeur **null**.</span><span class="sxs-lookup"><span data-stu-id="9ee76-129">You can instruct the Filter Graph Manager not to use a reference clock by calling [**SetSyncSource**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) with the value **NULL**.</span></span> <span data-ttu-id="9ee76-130">Par exemple, vous pouvez effectuer cette opération pour traiter les échantillons le plus rapidement possible.</span><span class="sxs-lookup"><span data-stu-id="9ee76-130">For example, you might do this to process samples as quickly as possible.</span></span> <span data-ttu-id="9ee76-131">Pour restaurer l’horloge de référence par défaut, appelez la méthode [**IFilterGraph :: SetDefaultSyncSource**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-setdefaultsyncsource) sur le gestionnaire de graphique de filtre.</span><span class="sxs-lookup"><span data-stu-id="9ee76-131">To restore the default reference clock, call the [**IFilterGraph::SetDefaultSyncSource**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-setdefaultsyncsource) method on the Filter Graph Manager.</span></span>

<span data-ttu-id="9ee76-132">Chaque fois que l’horloge de référence change, le gestionnaire de graphique de filtre notifie chaque filtre en appelant sa méthode [**IMediaFilter :: SetSyncSource**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) .</span><span class="sxs-lookup"><span data-stu-id="9ee76-132">Whenever the reference clock changes, the Filter Graph Manager notifies each filter by calling its [**IMediaFilter::SetSyncSource**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) method.</span></span> <span data-ttu-id="9ee76-133">Les applications ne doivent jamais appeler cette méthode sur les filtres.</span><span class="sxs-lookup"><span data-stu-id="9ee76-133">Applications should never call this method on filters.</span></span>

## <a name="related-topics"></a><span data-ttu-id="9ee76-134">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="9ee76-134">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9ee76-135">Définition de l’horloge du graphique</span><span class="sxs-lookup"><span data-stu-id="9ee76-135">Setting the Graph Clock</span></span>](setting-the-graph-clock.md)
</dt> <dt>

[<span data-ttu-id="9ee76-136">Temps et horloges dans DirectShow</span><span class="sxs-lookup"><span data-stu-id="9ee76-136">Time and Clocks in DirectShow</span></span>](time-and-clocks-in-directshow.md)
</dt> </dl>

 

 



