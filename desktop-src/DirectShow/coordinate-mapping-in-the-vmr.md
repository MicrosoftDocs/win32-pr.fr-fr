---
description: Mappage de coordonnées dans VMR
ms.assetid: f0821b90-51d1-4e77-8aed-04337a3dd623
title: Mappage de coordonnées dans VMR
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c18b38249471e6e68e36f1b9051f51e920f62b31
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "103846009"
---
# <a name="coordinate-mapping-in-the-vmr"></a><span data-ttu-id="26f0e-103">Mappage de coordonnées dans VMR</span><span class="sxs-lookup"><span data-stu-id="26f0e-103">Coordinate Mapping in the VMR</span></span>

<span data-ttu-id="26f0e-104">Cette section décrit les cinq transformations appliquées à une image source avant qu’elle ne soit mappée par VMR sur l’image finale de sortie.</span><span class="sxs-lookup"><span data-stu-id="26f0e-104">This section describes the five transformations that are applied to a source image before it is mapped by the VMR onto the final output image.</span></span>

1.  <span data-ttu-id="26f0e-105">La transformation *T (SRC)* mappe le rectangle source au rectangle de destination.</span><span class="sxs-lookup"><span data-stu-id="26f0e-105">The transformation *T(Src)* maps the source rectangle to the destination rectangle.</span></span> <span data-ttu-id="26f0e-106">Celles-ci sont spécifiées par les membres **rcSource** et **rcTarget** de la structure [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) ou [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2) dans le type de média.</span><span class="sxs-lookup"><span data-stu-id="26f0e-106">These are specified by the **rcSource** and **rcTarget** members of the [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) or [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2) structure in the media type.</span></span> <span data-ttu-id="26f0e-107">Ce mappage prétraite l’image source lorsqu’elle est transmise au VMR.</span><span class="sxs-lookup"><span data-stu-id="26f0e-107">This mapping preprocesses the source image as it passes to the VMR.</span></span>
2.  <span data-ttu-id="26f0e-108">La transformation *T (indicateur)* effectue toute manipulation d’image spécifiée par des indicateurs dans l’exemple de support.</span><span class="sxs-lookup"><span data-stu-id="26f0e-108">The transformation *T(Flag)* performs any image manipulations specified by flags in the media sample.</span></span> <span data-ttu-id="26f0e-109">Ces transformations incluses, telles que la translation verticale et l’échelle, permettent de gérer les indicateurs entrelacés de Bob.</span><span class="sxs-lookup"><span data-stu-id="26f0e-109">These included transformations such as the vertical translation and scale to accommodate the bob interlace flags.</span></span> <span data-ttu-id="26f0e-110">La transformation entrelacée double la hauteur de l’image et éventuellement convertit l’image par la moitié d’une ligne vidéo, si elle se trouve dans le champ impair.</span><span class="sxs-lookup"><span data-stu-id="26f0e-110">The interlace transformation doubles the image height and possibly translates the image by half of a video line if it is in the odd field.</span></span>
3.  <span data-ttu-id="26f0e-111">La transformation *T (AR)* ajuste l’image en pixels carrés, en fonction des proportions de l’image.</span><span class="sxs-lookup"><span data-stu-id="26f0e-111">The transformation *T(AR)* adjusts the image to square pixels, based on the image aspect ratio.</span></span> <span data-ttu-id="26f0e-112">Pour les types de média **VIDEOINFOHEADER** , les proportions sont déterminées par la taille de l’image.</span><span class="sxs-lookup"><span data-stu-id="26f0e-112">For **VIDEOINFOHEADER** media types, the aspect ratio is determined by the image size.</span></span> <span data-ttu-id="26f0e-113">Pour les types **VIDEOINFOHEADER2** , les proportions sont déterminées par les champs **dwPictAspectRatioX** et **dwPictAspectRatioY** , à moins que les indicateurs de remplissage 16 x 9 \_ ou AMCONTROL pour 4x3 \_ \_ \_ \_ \_ soient définis.</span><span class="sxs-lookup"><span data-stu-id="26f0e-113">For **VIDEOINFOHEADER2** types, the aspect ratio is determined by the **dwPictAspectRatioX** and **dwPictAspectRatioY** fields, unless the AMCONTROL\_PAD\_TO\_16x9 or AMCONTROL\_PAD\_TO\_4x3 flags are set.</span></span> <span data-ttu-id="26f0e-114">Cette transformation suppose que le paramètre d’affichage de l’analyse correspond aux proportions physiques de l’analyse.</span><span class="sxs-lookup"><span data-stu-id="26f0e-114">This transformation assumes that the monitor display setting matches the physical aspect ratio of the monitor.</span></span> <span data-ttu-id="26f0e-115">Par exemple, si l’utilisateur a une analyse avec des proportions de 4 x 3, mais définit l’affichage sur 1280 x 768 pixels (5 x 3), l’image n’aura pas les proportions correctes.</span><span class="sxs-lookup"><span data-stu-id="26f0e-115">For example, if the user has a monitor with 4 x 3 aspect ratio, but sets the display to 1280 x 768 pixels (5 x 3), the image will not have the correct aspect ratio.</span></span>
4.  <span data-ttu-id="26f0e-116">Les transformations de transformation *T (Mix)* déplacent l’image dans l’image de destination, à l’aide des rectangles normalisés spécifiés dans les méthodes [**IVMRMixerControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrmixercontrol) .</span><span class="sxs-lookup"><span data-stu-id="26f0e-116">The transformation *T(Mix)* transforms positions the image within the destination image, using the normalized rectangles specified in the [**IVMRMixerControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrmixercontrol) methods.</span></span> <span data-ttu-id="26f0e-117">Les rectangles normalisés permettent à l’application d’organiser le positionnement et la mise à l’échelle des flux sources l’un par rapport à l’autre.</span><span class="sxs-lookup"><span data-stu-id="26f0e-117">The normalized rectangles enable the application to organize how the source streams are positioned and scaled relative to each other.</span></span> <span data-ttu-id="26f0e-118">VMR calcule l’image de destination en calculant les dimensions maximales de toutes les images sources et en les recentrant à l’intérieur d’un rectangle englobant global.</span><span class="sxs-lookup"><span data-stu-id="26f0e-118">The VMR computes the destination image by computing the maximum dimensions of all the source images and centering each inside an overall bounding rectangle.</span></span> <span data-ttu-id="26f0e-119">La plage (0, 0) à (1,1) est assignée aux angles du rectangle englobant.</span><span class="sxs-lookup"><span data-stu-id="26f0e-119">The corners of the bounding rectangle are assigned the range (0,0) to (1,1).</span></span> <span data-ttu-id="26f0e-120">Le rectangle englobant est fixe avant l’exécution du graphique et reste constant même si les flux sont ajoutés ou supprimés.</span><span class="sxs-lookup"><span data-stu-id="26f0e-120">The bounding rectangle is fixed before the graph runs and remains constant even if streams are added or deleted.</span></span> <span data-ttu-id="26f0e-121">Les rectangles de destination de chaque flux peuvent se trouver en dehors de la plage (0,0) à (1,1) et toujours être valides.</span><span class="sxs-lookup"><span data-stu-id="26f0e-121">Destination rectangles for each stream can lie outside of the range (0,0) to (1,1) and still be valid.</span></span>
5.  <span data-ttu-id="26f0e-122">Enfin, une partie de l’image mixte peut être transformée par le mappage *T (DST)*, spécifié par les rectangles source et de destination dans l’interface [**IBasicVideo**](/windows/desktop/api/Control/nn-control-ibasicvideo) sur VMR.</span><span class="sxs-lookup"><span data-stu-id="26f0e-122">Finally, a portion of the mixed image can be transformed by the mapping *T(Dst)*, specified by the source and destination rectangles in the [**IBasicVideo**](/windows/desktop/api/Control/nn-control-ibasicvideo) interface on the VMR.</span></span> <span data-ttu-id="26f0e-123">Si le Allocator-Presenter est remplacé et que l’interface **IBasicVideo** n’est pas utilisée, l’application doit implémenter l’interface [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) et mapper les coordonnées dans un espace linéaire 2D.</span><span class="sxs-lookup"><span data-stu-id="26f0e-123">If the Allocator-Presenter is replaced and the **IBasicVideo** interface is not used, the application must implement the [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) interface and map the coordinates back into a 2D linear space.</span></span> <span data-ttu-id="26f0e-124">Les coordonnées de la souris retournées au navigateur DVD doivent également être dans cet espace.</span><span class="sxs-lookup"><span data-stu-id="26f0e-124">The mouse coordinates returned to the DVD navigator must also be in this space.</span></span> <span data-ttu-id="26f0e-125">Par exemple, si une application effectue le rendu d’une vidéo sur un cube tournant, elle signale l’affichage entier pour le contrôle sans fenêtre et retourne les coordonnées de la souris par rapport à l’affichage.</span><span class="sxs-lookup"><span data-stu-id="26f0e-125">For example, if an application renders video onto a spinning cube, they would report back the entire display for the windowless control and return mouse coordinates relative to the display.</span></span>

<span data-ttu-id="26f0e-126">La transformation d’image globale à partir des données sources vers le convertisseur final est la suivante :</span><span class="sxs-lookup"><span data-stu-id="26f0e-126">The overall image transformation from the source data to the final renderer is:</span></span>

<span data-ttu-id="26f0e-127">T = T (SRC) \* t (indicateur) t (AR) t (Mix) t ( \* DST)\*</span><span class="sxs-lookup"><span data-stu-id="26f0e-127">T = T(Src)\* T(Flag)T(Ar)T(Mix)\* T(Dst)\*</span></span>

<span data-ttu-id="26f0e-128">où \* indique que l’image peut être découpée vers l’image de destination à cette étape.</span><span class="sxs-lookup"><span data-stu-id="26f0e-128">where \* indicates that the image could be clipped to the destination image at that stage.</span></span> <span data-ttu-id="26f0e-129">Notez qu’il s’agit de toutes les transformations affines. par conséquent, VMR peut les combiner en une seule transformation.</span><span class="sxs-lookup"><span data-stu-id="26f0e-129">Note that these are all affine transformations, so the VMR can combine them into a single transformation.</span></span>

<span data-ttu-id="26f0e-130">L’inverse de la transformation est le suivant :</span><span class="sxs-lookup"><span data-stu-id="26f0e-130">The inverse of the transformation is:</span></span>

![transformation inverse](images/vmrmapping-t-1.png)

<span data-ttu-id="26f0e-132">Le facteur T (SRC) T (indicateur) T (AR) est relatif à la résolution de la source.</span><span class="sxs-lookup"><span data-stu-id="26f0e-132">The factor T(Src) T(Flag) T(Ar) is relative to the source resolution.</span></span> <span data-ttu-id="26f0e-133">Dans le facteur T (Mix), le rectangle source normalisé est relatif à l’image corrigée à l’aspect.</span><span class="sxs-lookup"><span data-stu-id="26f0e-133">In the factor T(Mix), the normalized source rectangle is relative to the aspect-corrected image.</span></span> <span data-ttu-id="26f0e-134">Le rectangle de destination normalisé est relatif à la résolution de sortie.</span><span class="sxs-lookup"><span data-stu-id="26f0e-134">The normalized destination rectangle is relative to the output resolution.</span></span> <span data-ttu-id="26f0e-135">Le diagramme suivant illustre ces relations.</span><span class="sxs-lookup"><span data-stu-id="26f0e-135">The following diagram shows these relationships.</span></span>

![étapes de transformation d’image](images/vmrmapping-transform-steps.png)

## <a name="related-topics"></a><span data-ttu-id="26f0e-137">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="26f0e-137">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="26f0e-138">Utilisation de VMR pour les développeurs de filtres DirectShow</span><span class="sxs-lookup"><span data-stu-id="26f0e-138">Using the VMR for DirectShow Filter Developers</span></span>](using-the-vmr-for-directshow-filter-developers.md)
</dt> </dl>

 

 



