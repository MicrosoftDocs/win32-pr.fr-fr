---
description: QueryAccept (en aval)
ms.assetid: 3ca30f62-c320-40ea-9bf5-022abad912c4
title: QueryAccept (en aval)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9015e0a246abb9fb996c0771e4bc935cccda054d
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104568049"
---
# <a name="queryaccept-downstream"></a><span data-ttu-id="20a64-103">QueryAccept (en aval)</span><span class="sxs-lookup"><span data-stu-id="20a64-103">QueryAccept (Downstream)</span></span>

<span data-ttu-id="20a64-104">Ce mécanisme permet à une broche de sortie de proposer un nouveau format à son homologue en aval.</span><span class="sxs-lookup"><span data-stu-id="20a64-104">This mechanism enables an output pin to propose a new format to its downstream peer.</span></span> <span data-ttu-id="20a64-105">Le nouveau format ne doit pas nécessiter une plus grande taille de mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="20a64-105">The new format must not require a larger buffer size.</span></span> <span data-ttu-id="20a64-106">La broche de sortie effectue les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="20a64-106">The output pin does the following:</span></span>

1.  <span data-ttu-id="20a64-107">Appelle [**IPIN :: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) ou [**IPinConnection ::D ynamicqueryaccept**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) sur le code confidentiel en aval, pour vérifier si l’autre code confidentiel peut accepter le nouveau type de média (Voir l’illustration, étape A).</span><span class="sxs-lookup"><span data-stu-id="20a64-107">Calls [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) or [**IPinConnection::DynamicQueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) on the downstream pin, to verify whether the other pin can accept the new media type (see illustration, step A).</span></span>
2.  <span data-ttu-id="20a64-108">Si la valeur de retour de l’étape 1 est \_ OK, le code PIN attache le type de média à l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="20a64-108">If the return value from step 1 is S\_OK, the pin attaches the media type to the next sample.</span></span> <span data-ttu-id="20a64-109">Pour ce faire, il appelle d’abord [**IMemAllocator :: GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) pour obtenir l’exemple (B).</span><span class="sxs-lookup"><span data-stu-id="20a64-109">To do this, first it calls [**IMemAllocator::GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) to obtain the sample (B).</span></span> <span data-ttu-id="20a64-110">Ensuite, il appelle [**IMediaSample :: SetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) pour attacher le type de média à cet exemple (C).</span><span class="sxs-lookup"><span data-stu-id="20a64-110">Then it calls [**IMediaSample::SetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) to attach the media type to that sample (C).</span></span> <span data-ttu-id="20a64-111">En attachant le type de média à l’exemple, le filtre indique que le format a changé, en commençant par cet exemple.</span><span class="sxs-lookup"><span data-stu-id="20a64-111">By attaching the media type to the sample, the filter indicates that the format has changed, starting with that sample.</span></span>
3.  <span data-ttu-id="20a64-112">Le code PIN livre l’exemple (D).</span><span class="sxs-lookup"><span data-stu-id="20a64-112">The pin delivers the sample (D).</span></span>
4.  <span data-ttu-id="20a64-113">Lorsque le filtre en aval reçoit l’exemple, il appelle [**IMediaSample :: GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) pour récupérer le nouveau type de média.</span><span class="sxs-lookup"><span data-stu-id="20a64-113">When the downstream filter receives the sample, it calls [**IMediaSample::GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) to retrieve the new media type.</span></span>

    ![queryaccept (en aval)](images/dynformat3.png)

<span data-ttu-id="20a64-115">Tous les codes PIN prennent en charge la `QueryAccept` méthode.</span><span class="sxs-lookup"><span data-stu-id="20a64-115">All pins support the `QueryAccept` method.</span></span> <span data-ttu-id="20a64-116">Toutefois, cette méthode est légèrement ambiguë, car une valeur de retour de S \_ OK ne garantit pas toujours que vous pouvez modifier le format lorsque le graphique est actif.</span><span class="sxs-lookup"><span data-stu-id="20a64-116">However, this method is slightly ambiguous, because a return value of S\_OK does not always guarantee that you can change the format while the graph is active.</span></span> <span data-ttu-id="20a64-117">Certains filtres peuvent retourner S \_ OK mais rejeter la modification si le graphique est actif.</span><span class="sxs-lookup"><span data-stu-id="20a64-117">Some filters might return S\_OK but reject the change if the graph is active.</span></span> <span data-ttu-id="20a64-118">La méthode **DynamicQueryAccept** , qui est prise en charge par certaines broches d’entrée, définit explicitement \_ les S OK pour signifier que le code confidentiel peut changer de format pendant qu’il est actif.</span><span class="sxs-lookup"><span data-stu-id="20a64-118">The **DynamicQueryAccept** method, which is supported by some input pins, explicitly defines S\_OK to mean the pin can change formats while active.</span></span> <span data-ttu-id="20a64-119">Si une broche d’entrée prend en charge l’interface **IPinConnection** , vous devez appeler **DynamicQueryAccept** plutôt que `QueryAccept` .</span><span class="sxs-lookup"><span data-stu-id="20a64-119">If an input pin supports the **IPinConnection** interface, you should call **DynamicQueryAccept** rather than `QueryAccept`.</span></span>

<span data-ttu-id="20a64-120">Dans la plupart des cas, ce mécanisme n’autorise pas les modifications radicales du format, telles que la modification de la profondeur de bit.</span><span class="sxs-lookup"><span data-stu-id="20a64-120">In most cases, this mechanism does not allow for drastic changes to the format, such as changing the bit depth.</span></span> <span data-ttu-id="20a64-121">Une situation dans laquelle il peut être utilisé est lorsqu’un décodeur vidéo change de palette.</span><span class="sxs-lookup"><span data-stu-id="20a64-121">One situation in which it can be used is when a video decoder switches palettes.</span></span> <span data-ttu-id="20a64-122">Les détails de base du format restent les mêmes, tels que les dimensions d’image et la profondeur de bits, mais le nouveau type de média a un ensemble différent d’entrées de palette.</span><span class="sxs-lookup"><span data-stu-id="20a64-122">The basic details of the format stay the same, such as the image dimensions and the bit depth, but the new media type has a different set of palette entries.</span></span>

<span data-ttu-id="20a64-123">**Note d’implémentation**</span><span class="sxs-lookup"><span data-stu-id="20a64-123">**Implementation Note**</span></span>

<span data-ttu-id="20a64-124">Dans les classes de base DirectShow, [**CBasePin :: QueryAccept**](cbasepin-queryaccept.md) appelle la méthode **CheckMediaType** , qui est également appelée pendant la connexion de code PIN initiale.</span><span class="sxs-lookup"><span data-stu-id="20a64-124">In the DirectShow base classes, [**CBasePin::QueryAccept**](cbasepin-queryaccept.md) calls the **CheckMediaType** method, which is also called during the initial pin connection.</span></span> <span data-ttu-id="20a64-125">Dans le cas d’un filtre de transformation, la méthode **CheckMediaType** du code confidentiel d’entrée doit toujours vérifier si la broche de sortie est connectée, et si tel est le cas, si le type de média d’entrée est compatible avec le type de média de sortie.</span><span class="sxs-lookup"><span data-stu-id="20a64-125">In the case of a transform filter, the input pin's **CheckMediaType** method should always check whether the output pin is connected, and if so, whether the input media type is compatible with the output media type.</span></span> <span data-ttu-id="20a64-126">Par conséquent, cette implémentation sera probablement valide pour `QueryAccept` .</span><span class="sxs-lookup"><span data-stu-id="20a64-126">Therefore, this implementation will likely be valid for `QueryAccept`.</span></span> <span data-ttu-id="20a64-127">Si ce n’est pas le cas, vous devez remplacer afin `QueryAccept` d’effectuer les vérifications supplémentaires nécessaires.</span><span class="sxs-lookup"><span data-stu-id="20a64-127">If not, you should override `QueryAccept` in order to perform any additional checks that are needed.</span></span> <span data-ttu-id="20a64-128">Notez également que la classe [**CTransformFilter**](ctransformfilter.md) encapsule cette logique dans les méthodes **CheckInputType** et **CheckTransform** .</span><span class="sxs-lookup"><span data-stu-id="20a64-128">Also, note that the [**CTransformFilter**](ctransformfilter.md) class encapsulates this logic within the **CheckInputType** and **CheckTransform** methods.</span></span> <span data-ttu-id="20a64-129">En revanche, la classe [**CTransInPlaceFilter**](ctransinplacefilter.md) appelle toujours `QueryAccept` sur le filtre en amont ou en aval suivant.</span><span class="sxs-lookup"><span data-stu-id="20a64-129">The [**CTransInPlaceFilter**](ctransinplacefilter.md) class, on the other hand, always calls `QueryAccept` on the next upstream or downstream filter.</span></span>

<span data-ttu-id="20a64-130">La méthode [**CBaseInputPin :: Receive**](cbaseinputpin-receive.md) vérifie la présence d’un type de média sur l’exemple entrant et, le cas échéant, appelle **CheckMediaType**.</span><span class="sxs-lookup"><span data-stu-id="20a64-130">The [**CBaseInputPin::Receive**](cbaseinputpin-receive.md) method checks for a media type on the incoming sample, and if there is one, calls **CheckMediaType**.</span></span> <span data-ttu-id="20a64-131">Toutefois, il ne met pas à jour le membre **m \_ MT** du pin, qui contient le type de média actuel.</span><span class="sxs-lookup"><span data-stu-id="20a64-131">However, it does not update the pin's **m\_mt** member, which holds the current media type.</span></span> <span data-ttu-id="20a64-132">Lorsque votre filtre traite l’exemple, vous devez vérifier l’exemple pour un type de média.</span><span class="sxs-lookup"><span data-stu-id="20a64-132">When your filter processes the sample, you should check the sample for a media type.</span></span> <span data-ttu-id="20a64-133">S’il existe un nouveau type, vous devrez probablement le stocker en appelant **SetMediaType** sur votre code confidentiel ou en définissant la valeur de **m \_ MT** directement.</span><span class="sxs-lookup"><span data-stu-id="20a64-133">If there is a new type, you will probably need to store it, either by calling **SetMediaType** on your pin or by setting the value of **m\_mt** directly.</span></span> <span data-ttu-id="20a64-134">En revanche, la classe [**CVideoTransformFilter**](cvideotransformfilter.md) , conçue pour les filtres de transformation vidéo, stocke le type de média lorsqu’il change.</span><span class="sxs-lookup"><span data-stu-id="20a64-134">On the other hand, the [**CVideoTransformFilter**](cvideotransformfilter.md) class, which is designed for video transform filters, stores the media type when it changes.</span></span> <span data-ttu-id="20a64-135">Pour plus d’informations, consultez le code source de [**CVideoTransformFilter :: Receive**](cvideotransformfilter-receive.md) dans la bibliothèque de classes de base DirectShow.</span><span class="sxs-lookup"><span data-stu-id="20a64-135">For details, see the source code for [**CVideoTransformFilter::Receive**](cvideotransformfilter-receive.md) in the DirectShow base class library.</span></span>

<span data-ttu-id="20a64-136">Dans certains cas, vous pouvez simplement passer l' `QueryAccept` appel en aval, puis attacher le type de média à l’exemple de sortie et laisser le filtre en aval gérer le changement de format.</span><span class="sxs-lookup"><span data-stu-id="20a64-136">In some cases, you might simply pass the `QueryAccept` call downstream, then attach the media type to the output sample and let the downstream filter handle the format change.</span></span>

 

 



