---
description: Utilisation du modèle de classe DMO
ms.assetid: 5193ad08-aaee-47e3-93eb-a126a66d8f23
title: Utilisation du modèle de classe DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4db80017372f11f6c928e0e6a83b591967a84ee7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104034813"
---
# <a name="using-the-dmo-class-template"></a><span data-ttu-id="9fe8e-103">Utilisation du modèle de classe DMO</span><span class="sxs-lookup"><span data-stu-id="9fe8e-103">Using the DMO Class Template</span></span>

<span data-ttu-id="9fe8e-104">DirectShow comprend un modèle de classe, [**IMediaObjectImpl**](imediaobjectimpl-class-template.md), pour l’implémentation de DMOs.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-104">DirectShow includes a class template, [**IMediaObjectImpl**](imediaobjectimpl-class-template.md), for implementing DMOs.</span></span> <span data-ttu-id="9fe8e-105">Le modèle gère un grand nombre des tâches de « comptabilité », telles que la validation des paramètres d’entrée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-105">The template handles many of the "bookkeeping" tasks, such as validating input parameters.</span></span> <span data-ttu-id="9fe8e-106">À l’aide du modèle, vous pouvez vous concentrer sur les fonctionnalités spécifiques à votre DMO.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-106">By using the template, you can focus on the functionality that is specific to your DMO.</span></span> <span data-ttu-id="9fe8e-107">En outre, le modèle permet de s’assurer que vous créez une implémentation robuste.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-107">In addition, the template helps to ensure that you create a robust implementation.</span></span> <span data-ttu-id="9fe8e-108">Le modèle est défini dans le fichier d’en-tête Dmoimpl. h, situé dans le répertoire include du kit de développement logiciel (SDK).</span><span class="sxs-lookup"><span data-stu-id="9fe8e-108">The template is defined in the header file Dmoimpl.h, located in the Include directory of the SDK.</span></span>

<span data-ttu-id="9fe8e-109">Le modèle **IMediaObjectImpl** hérite de l’interface [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) .</span><span class="sxs-lookup"><span data-stu-id="9fe8e-109">The **IMediaObjectImpl** template inherits the [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) interface.</span></span> <span data-ttu-id="9fe8e-110">Pour créer un DMO à l’aide du modèle, définissez une nouvelle classe qui dérive de **IMediaObjectImpl**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-110">To create a DMO using the template, define a new class that derives from **IMediaObjectImpl**.</span></span> <span data-ttu-id="9fe8e-111">Le modèle implémente toutes les méthodes **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="9fe8e-111">The template implements all of the **IMediaObject** methods.</span></span> <span data-ttu-id="9fe8e-112">Dans la plupart des cas, le modèle appelle une méthode privée correspondante sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-112">In most cases, the template calls a corresponding private method on the derived class.</span></span> <span data-ttu-id="9fe8e-113">Le modèle fournit les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="9fe8e-113">The template provides the following features:</span></span>

-   <span data-ttu-id="9fe8e-114">Vérification de paramètres de base.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-114">Basic parameter checking.</span></span> <span data-ttu-id="9fe8e-115">Les méthodes de modèle vérifient que les paramètres requis ne sont pas **null**, que les index de flux se trouvent dans la plage et que les indicateurs sont valides.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-115">The template methods verify that required parameters are not **NULL**, that stream indexes are within range, and that flags are valid.</span></span>
-   <span data-ttu-id="9fe8e-116">Verr.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-116">Locking.</span></span> <span data-ttu-id="9fe8e-117">Les méthodes de modèle appellent deux méthodes internes, **Lock** et **Unlock**, pour sérialiser des opérations sur DMO.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-117">The template methods call two internal methods, **Lock** and **Unlock**, to serialize operations on the DMO.</span></span> <span data-ttu-id="9fe8e-118">Cette fonctionnalité garantit que la fonctionnalité DMO est thread-safe.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-118">This feature ensures that the DMO is thread-safe.</span></span>
-   <span data-ttu-id="9fe8e-119">Types de médias.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-119">Media types.</span></span> <span data-ttu-id="9fe8e-120">Le modèle stocke les types de médias définis par le client et fournit des méthodes d’accesseur pour les types de média.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-120">The template stores the media types set by the client, and provides accessor methods for the media types.</span></span>
-   <span data-ttu-id="9fe8e-121">Contenu.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-121">Streaming.</span></span> <span data-ttu-id="9fe8e-122">Le modèle empêche la diffusion en continu jusqu’à ce que le client ait défini des types de médias pour tous les flux non facultatifs.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-122">The template prevents streaming until the client has set media types for all non-optional streams.</span></span> <span data-ttu-id="9fe8e-123">Elle garantit également que la méthode [**IMediaObject :: AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) est appelée avant le début de la diffusion en continu, ce qui garantit que les ressources sont allouées.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-123">It also ensures that the [**IMediaObject::AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) method is called before streaming begins, which guarantees that resources are allocated.</span></span>

<span data-ttu-id="9fe8e-124">La classe dérivée doit implémenter l’interface **IUnknown** ; le modèle ne fournit pas cette interface.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-124">The derived class must implement the **IUnknown** interface; the template does not provide this interface.</span></span> <span data-ttu-id="9fe8e-125">Vous pouvez utiliser la Active Template Library (ATL) pour implémenter **IUnknown**, ou vous pouvez fournir une autre implémentation.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-125">You can use the Active Template Library (ATL) to implement **IUnknown**, or you can provide some other implementation.</span></span> <span data-ttu-id="9fe8e-126">Le modèle n’implémente pas non plus le mécanisme de verrouillage.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-126">The template also does not implement the locking mechanism.</span></span> <span data-ttu-id="9fe8e-127">La classe dérivée doit implémenter les méthodes **Lock** et **Unlock** .</span><span class="sxs-lookup"><span data-stu-id="9fe8e-127">The derived class must implement the **Lock** and **Unlock** methods.</span></span> <span data-ttu-id="9fe8e-128">Si vous créez votre classe à l’aide d’ATL, vous pouvez utiliser les implémentations ATL par défaut.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-128">If you create your class using ATL, you can use the default ATL implementations.</span></span>

<span data-ttu-id="9fe8e-129">**Déclaration de la classe dérivée**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-129">**Declaring the Derived Class**</span></span>

<span data-ttu-id="9fe8e-130">Le modèle de classe **IMediaObjectImpl** est déclaré comme suit :</span><span class="sxs-lookup"><span data-stu-id="9fe8e-130">The **IMediaObjectImpl** class template is declared as follows:</span></span>


```C++
template <class _DERIVED_, int NUMBEROFINPUTS, int NUMBEROFOUTPUTS>
class IMediaObjectImpl : public ImediaObject
```



<span data-ttu-id="9fe8e-131">Les trois paramètres de modèle sont \_ dérivés \_ , NUMBEROFINPUTS et NUMBEROFOUTPUTS.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-131">The three template parameters are \_DERIVED\_, NUMBEROFINPUTS, and NUMBEROFOUTPUTS.</span></span> <span data-ttu-id="9fe8e-132">Définissez une valeur \_ dérivée \_ égale au nom de votre classe.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-132">Set \_DERIVED\_ equal to the name of your class.</span></span> <span data-ttu-id="9fe8e-133">Les deux autres paramètres définissent le nombre de flux d’entrée et de flux de sortie sur DMO.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-133">The other two parameters define the number of input streams and output streams on the DMO.</span></span> <span data-ttu-id="9fe8e-134">Par exemple, pour créer une classe DMO nommée CMyDmo qui prend en charge un flux d’entrée et deux flux de sortie, utilisez la déclaration suivante :</span><span class="sxs-lookup"><span data-stu-id="9fe8e-134">For example, to create a DMO class named CMyDmo that supports one input stream and two output streams, use the following declaration:</span></span>


```C++
class CMyDmo : public IMediaObjectImpl<CMyDmo, 1, 2>
```



<span data-ttu-id="9fe8e-135">Le reste de cette section décrit comment le modèle implémente les différentes méthodes dans **IMediaObject**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-135">The remainder of this section describes how the template implements the various methods in **IMediaObject**.</span></span>

<span data-ttu-id="9fe8e-136">**Méthodes de définition des types de média**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-136">**Methods for Setting Media Types**</span></span>

<span data-ttu-id="9fe8e-137">Les méthodes suivantes définissent ou récupèrent des types de médias sur la DMO :</span><span class="sxs-lookup"><span data-stu-id="9fe8e-137">The following methods set or retrieve media types on the DMO:</span></span>

-   <span data-ttu-id="9fe8e-138">**GetInputType**, **GetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-138">**GetInputType**, **GetOutputType**.</span></span> <span data-ttu-id="9fe8e-139">Ces méthodes retournent les types de média préférés, par numéro de flux et index de type.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-139">These methods return preferred media types, by stream number and type index.</span></span> <span data-ttu-id="9fe8e-140">Le modèle appelle **InternalGetInputType** ou **InternalGetOutputType** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-140">The template calls **InternalGetInputType** or **InternalGetOutputType** on the derived class.</span></span>
-   <span data-ttu-id="9fe8e-141">**SetInputType**, **SetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-141">**SetInputType**, **SetOutputType**.</span></span> <span data-ttu-id="9fe8e-142">Ces méthodes définissent le type de média sur un flux, testent un type de média ou effacent un type de média.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-142">These methods set the media type on a stream, test a media type, or clear a media type.</span></span> <span data-ttu-id="9fe8e-143">Pour valider le type de média, le modèle appelle **InternalCheckInputType** ou **InternalCheckOutputType** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-143">To validate the media type, the template calls **InternalCheckInputType** or **InternalCheckOutputType** on the derived class.</span></span> <span data-ttu-id="9fe8e-144">La classe dérivée retourne S \_ OK pour accepter le type ou DMO \_ E \_ INVALIDTYPE pour rejeter le type.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-144">The derived class returns S\_OK to accept the type or DMO\_E\_INVALIDTYPE to reject the type.</span></span> <span data-ttu-id="9fe8e-145">Les handles de modèle déterminent ou effacent le type de média.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-145">The template handles setting or clearing the media type.</span></span>
-   <span data-ttu-id="9fe8e-146">**GetInputCurrentType**, **GetOutputCurrentType**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-146">**GetInputCurrentType**, **GetOutputCurrentType**.</span></span> <span data-ttu-id="9fe8e-147">Ces méthodes retournent le type de média actuel d’un flux, ou le type DMO \_ E \_ \_ n' \_ est pas défini si aucun type n’est défini.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-147">These methods return the current media type for a stream, or DMO\_E\_TYPE\_NOT\_SET if no type is set.</span></span> <span data-ttu-id="9fe8e-148">Le modèle implémente complètement ces méthodes.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-148">The template completely implements these methods.</span></span>

<span data-ttu-id="9fe8e-149">**Méthodes d’information**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-149">**Informational Methods**</span></span>

<span data-ttu-id="9fe8e-150">Les méthodes ci-dessous fournissent des informations sur DMO.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-150">The following methods provide information about the DMO.</span></span>

-   <span data-ttu-id="9fe8e-151">**GetInputMaxLatency**, **SetInputMaxLatency**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-151">**GetInputMaxLatency**, **SetInputMaxLatency**.</span></span> <span data-ttu-id="9fe8e-152">Ces méthodes récupèrent ou définissent la latence maximale.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-152">These methods retrieve or set the maximum latency.</span></span> <span data-ttu-id="9fe8e-153">Le modèle appelle **InternalGetInputMaxLatency** ou **InternalSetInputMaxLatency** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-153">The template calls **InternalGetInputMaxLatency** or **InternalSetInputMaxLatency** on the derived class.</span></span>
-   <span data-ttu-id="9fe8e-154">**GetInputSizeInfo**, **GetOutputSizeInfo**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-154">**GetInputSizeInfo**, **GetOutputSizeInfo**.</span></span> <span data-ttu-id="9fe8e-155">Ces méthodes retournent les exigences de mémoire tampon d’DMO pour un flux spécifié.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-155">These methods return the DMO's buffer requirements for a specified stream.</span></span> <span data-ttu-id="9fe8e-156">Si aucun type de support n’a été défini sur ce flux, le modèle renvoie le \_ type DMO E \_ \_ non \_ défini.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-156">If no media type has been set on that stream, the template returns DMO\_E\_TYPE\_NOT\_SET.</span></span> <span data-ttu-id="9fe8e-157">Sinon, elle appelle **InternalGetInputSizeInfo** ou **InternalGetOutputSizeInfo** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-157">Otherwise, it calls **InternalGetInputSizeInfo** or **InternalGetOutputSizeInfo** on the derived class.</span></span>
-   <span data-ttu-id="9fe8e-158">**GetInputStreamInfo**, **GetOutputStreamInfo**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-158">**GetInputStreamInfo**, **GetOutputStreamInfo**.</span></span> <span data-ttu-id="9fe8e-159">Ces méthodes retournent différents indicateurs qui indiquent comment le client doit mettre en forme les données.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-159">These methods return various flags that indicate how the client should format the data.</span></span> <span data-ttu-id="9fe8e-160">Le modèle appelle **InternalGetInputStreamInfo** ou **InternalGetOutputStreamInfo** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-160">The template calls **InternalGetInputStreamInfo** or **InternalGetOutputStreamInfo** on the derived class.</span></span>
-   <span data-ttu-id="9fe8e-161">**GetStreamCount**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-161">**GetStreamCount**.</span></span> <span data-ttu-id="9fe8e-162">Cette méthode retourne le nombre de flux d’entrée et de sortie.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-162">This method returns the number of input and output streams.</span></span> <span data-ttu-id="9fe8e-163">Le modèle implémente cette méthode, à l’aide des paramètres du modèle.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-163">The template implements this method, using the template parameters.</span></span>

<span data-ttu-id="9fe8e-164">**Méthodes d’allocation des ressources**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-164">**Methods for Resource Allocation**</span></span>

-   <span data-ttu-id="9fe8e-165">La méthode **AllocateStreamingResources** alloue toutes les ressources requises par DMO avant le début de la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-165">The **AllocateStreamingResources** method allocates any resources the DMO needs before streaming begins.</span></span> <span data-ttu-id="9fe8e-166">La méthode **FreeStreamingResources** libère les mêmes ressources.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-166">The **FreeStreamingResources** method releases the same resources.</span></span> <span data-ttu-id="9fe8e-167">Le modèle appelle **InternalAllocateStreamingResources** et **InternalFreeStreamingResources**, respectivement.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-167">The template calls **InternalAllocateStreamingResources** and **InternalFreeStreamingResources**, respectively.</span></span>

<span data-ttu-id="9fe8e-168">Le client de DMO n’est pas obligé d’appeler ces méthodes, mais le modèle appelle automatiquement **AllocateStreamingResources** avant le démarrage de la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-168">The client of the DMO is not required to call these methods, but the template automatically calls **AllocateStreamingResources** before streaming starts.</span></span> <span data-ttu-id="9fe8e-169">Par conséquent, la méthode DMO peut supposer que les ressources ont été allouées correctement lors de l’appel de **ProcessInput** .</span><span class="sxs-lookup"><span data-stu-id="9fe8e-169">Therefore, the DMO can assume that resources are have been allocated correctly by the time **ProcessInput** is called.</span></span> <span data-ttu-id="9fe8e-170">DMO doit appeler **FreeStreamingResources** dans son destructeur.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-170">The DMO should call **FreeStreamingResources** in its destructor.</span></span>

<span data-ttu-id="9fe8e-171">En outre, lorsque le modèle appelle **InternalAllocateStreamingResources**, il définit un indicateur interne, afin qu’il n’appelle pas à nouveau cette méthode avant d’appeler **InternalFreeStreamingResources**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-171">Also, when the template calls **InternalAllocateStreamingResources**, it sets an internal flag, so that it does not call that method again until calling **InternalFreeStreamingResources**.</span></span> <span data-ttu-id="9fe8e-172">Cela permet de s’assurer que les ressources ne sont pas réallouées accidentellement, ce qui peut provoquer des fuites de mémoire.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-172">This ensures that resources are not re-allocated accidentally, which could cause memory leaks.</span></span>

<span data-ttu-id="9fe8e-173">**Méthodes pour la diffusion en continu**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-173">**Methods for Streaming**</span></span>

<span data-ttu-id="9fe8e-174">Les méthodes suivantes sont utilisées pour diffuser des données en continu :</span><span class="sxs-lookup"><span data-stu-id="9fe8e-174">The following methods are used to stream data:</span></span>

-   <span data-ttu-id="9fe8e-175">**GetInputStatus**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-175">**GetInputStatus**.</span></span> <span data-ttu-id="9fe8e-176">Cette méthode indique si DMO peut accepter l’entrée pour l’instant.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-176">This method indicates whether the DMO can accept input at this time.</span></span> <span data-ttu-id="9fe8e-177">Le modèle appelle **InternalAcceptingInput** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-177">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="9fe8e-178">Si la méthode DMO accepte l’entrée, la classe dérivée retourne la valeur S \_ OK et le modèle définit le \_ bit d’entrée \_ STATUSF \_ Accept \_ de données dans le paramètre *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="9fe8e-178">If the DMO can accept input, the derived class returns S\_OK and the template sets the DMO\_INPUT\_STATUSF\_ACCEPT\_DATA bit in the *dwFlags* parameter.</span></span> <span data-ttu-id="9fe8e-179">Sinon, la classe dérivée retourne S \_ false et le modèle affecte la valeur zéro à *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="9fe8e-179">Otherwise, the derived class returns S\_FALSE and the template sets *dwFlags* to zero.</span></span>
-   <span data-ttu-id="9fe8e-180">**ProcessInput**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-180">**ProcessInput**.</span></span> <span data-ttu-id="9fe8e-181">Cette méthode traite une mémoire tampon d’entrée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-181">This method processes an input buffer.</span></span> <span data-ttu-id="9fe8e-182">Le modèle appelle **AllocateStreamingResources**, décrit précédemment.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-182">The template calls **AllocateStreamingResources**, described previously.</span></span> <span data-ttu-id="9fe8e-183">Il appelle ensuite **InternalAcceptingInput** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-183">Then it calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="9fe8e-184">Si la DMO peut accepter une nouvelle entrée, le modèle appelle **InternalProcessInput**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-184">If the DMO can accept new input, the template calls **InternalProcessInput**.</span></span>
-   <span data-ttu-id="9fe8e-185">**ProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-185">**ProcessOutput**.</span></span> <span data-ttu-id="9fe8e-186">Cette méthode traite un jeu de mémoires tampons de sortie, une mémoire tampon pour chaque flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-186">This method processes a set of output buffers, one buffer for each output stream.</span></span> <span data-ttu-id="9fe8e-187">Le modèle appelle **AllocateStreamingResources** , puis **InternalProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-187">The template calls **AllocateStreamingResources** and then **InternalProcessOutput**.</span></span>
-   <span data-ttu-id="9fe8e-188">**Discontinuation**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-188">**Discontinuity**.</span></span> <span data-ttu-id="9fe8e-189">Cette méthode signale une discontinuité dans un flux d’entrée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-189">This method signals a discontinuity in an input stream.</span></span> <span data-ttu-id="9fe8e-190">Le modèle appelle **InternalAcceptingInput** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-190">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="9fe8e-191">Si cette méthode retourne \_ la valeur OK, le modèle appelle **InternalDiscontinuity** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-191">If that method returns S\_OK, the template calls **InternalDiscontinuity** on the derived class.</span></span>
-   <span data-ttu-id="9fe8e-192">**Vidage**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-192">**Flush**.</span></span> <span data-ttu-id="9fe8e-193">Cette méthode vide la méthode DMO.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-193">This method flushes the DMO.</span></span> <span data-ttu-id="9fe8e-194">Le modèle appelle **InternalFlush** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-194">The template calls **InternalFlush** on the derived class.</span></span> <span data-ttu-id="9fe8e-195">Le programme DMO doit abandonner les tampons d’entrée qu’il détient toujours pour être traité.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-195">The DMO should discard any input buffers that it still holds to be processed.</span></span>

<span data-ttu-id="9fe8e-196">Le modèle ne fournit pas de prise en charge directe de l’interface [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) .</span><span class="sxs-lookup"><span data-stu-id="9fe8e-196">The template does not provide any direct support for the [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) interface.</span></span>

<span data-ttu-id="9fe8e-197">**Méthodes de verrouillage**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-197">**Methods for Locking**</span></span>

<span data-ttu-id="9fe8e-198">Le verrouillage est utilisé pour protéger l’état d’DMO dans un environnement multithread.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-198">Locking is used to protect the DMO's state in a multithreaded environment.</span></span> <span data-ttu-id="9fe8e-199">Dans un projet ATL, la méthode [**IMediaObject :: Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) provoque un conflit de nom avec la méthode de **verrouillage** ATL.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-199">In an ATL project, the [**IMediaObject::Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) method causes a name conflict with the ATL **Lock** method.</span></span> <span data-ttu-id="9fe8e-200">Pour résoudre le conflit, le modèle renomme la méthode **IMediaObject** en **DMOLock**.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-200">To resolve the conflict, the template renames the **IMediaObject** method to **DMOLock**.</span></span> <span data-ttu-id="9fe8e-201">Quand vous compilez la classe dérivée, définissez corriger le \_ \_ nom du verrou avant d’inclure le fichier d’en-tête DMO. h :</span><span class="sxs-lookup"><span data-stu-id="9fe8e-201">When you compile the derived class, define FIX\_LOCK\_NAME before including the header file Dmo.h:</span></span>


```C++
#define FIX_LOCK_NAME
#include <dmo.h>
```



<span data-ttu-id="9fe8e-202">Cette directive force le préprocesseur à substituer **DMOLock** pour le **verrou** dans la déclaration de l’interface **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="9fe8e-202">This directive causes the preprocessor to substitute **DMOLock** for **Lock** in the declaration of the **IMediaObject** interface.</span></span> <span data-ttu-id="9fe8e-203">Les applications peuvent toujours appeler la méthode à l’aide du **verrou** de nom, car l’ordre vtable ne change pas.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-203">Applications can still invoke the method using the name **Lock**, because the vtable order does not change.</span></span> <span data-ttu-id="9fe8e-204">La méthode **DMOLock** appelle **Lock** ou **Unlock** sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-204">The **DMOLock** method calls **Lock** or **Unlock** on the derived class.</span></span> <span data-ttu-id="9fe8e-205">Si vous utilisez ATL pour implémenter la classe dérivée, ces méthodes sont déjà définies par ATL, donc aucun code supplémentaire n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-205">If you are using ATL to implement the derived class, these methods are already defined by ATL, so no additional code is necessary.</span></span> <span data-ttu-id="9fe8e-206">Si vous n’utilisez pas ATL, vous devez fournir des méthodes de **verrouillage** et de **déverrouillage** dans votre classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-206">If you are not using ATL, you must provide **Lock** and **Unlock** methods in your derived class.</span></span>

<span data-ttu-id="9fe8e-207">Le modèle verrouille automatiquement la méthode DMO dans chacune des méthodes **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="9fe8e-207">The template automatically locks the DMO in each of the **IMediaObject** methods.</span></span> <span data-ttu-id="9fe8e-208">La classe dérivée peut être amenée à verrouiller la méthode DMO à l’intérieur d’autres méthodes publiques qu’elle implémente (par exemple, si elle prend en charge **IMediaObjectInPlace**).</span><span class="sxs-lookup"><span data-stu-id="9fe8e-208">The derived class might need to lock the DMO inside other public methods that it implements (for example, if it supports **IMediaObjectInPlace**).</span></span> <span data-ttu-id="9fe8e-209">Le modèle de classe fournit également une classe d’assistance interne, [**IMediaObjectImpl :: LockIt**](imediaobjectimpl-lockit.md), qui est utile pour le verrouillage et le déverrouillage de la classe DMO.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-209">The class template also provides an internal helper class, [**IMediaObjectImpl::LockIt**](imediaobjectimpl-lockit.md), which is useful for locking and unlocking the DMO.</span></span>

<span data-ttu-id="9fe8e-210">**Résumé**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-210">**Summary**</span></span>

<span data-ttu-id="9fe8e-211">Pour les méthodes **IMediaObject** suivantes, le modèle appelle une méthode correspondante avec la même signature sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-211">For the following **IMediaObject** methods, the template calls a corresponding method with the same signature on the derived class.</span></span> <span data-ttu-id="9fe8e-212">La classe dérivée doit implémenter chacune des méthodes indiquées dans la deuxième colonne.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-212">The derived class must implement each of the methods shown in the second column.</span></span>



| <span data-ttu-id="9fe8e-213">Méthode IMediaObject</span><span class="sxs-lookup"><span data-stu-id="9fe8e-213">IMediaObject Method</span></span>            | <span data-ttu-id="9fe8e-214">Méthode de classe dérivée</span><span class="sxs-lookup"><span data-stu-id="9fe8e-214">Derived Class Method</span></span>                   |
|--------------------------------|----------------------------------------|
| <span data-ttu-id="9fe8e-215">**AllocateStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-215">**AllocateStreamingResources**</span></span> | <span data-ttu-id="9fe8e-216">**InternalAllocateStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-216">**InternalAllocateStreamingResources**</span></span> |
| <span data-ttu-id="9fe8e-217">**Discontinuité**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-217">**Discontinuity**</span></span>              | <span data-ttu-id="9fe8e-218">**InternalDiscontinuity**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-218">**InternalDiscontinuity**</span></span>              |
| <span data-ttu-id="9fe8e-219">**Purge**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-219">**Flush**</span></span>                      | <span data-ttu-id="9fe8e-220">**InternalFlush**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-220">**InternalFlush**</span></span>                      |
| <span data-ttu-id="9fe8e-221">**FreeStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-221">**FreeStreamingResources**</span></span>     | <span data-ttu-id="9fe8e-222">**InternalFreeStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-222">**InternalFreeStreamingResources**</span></span>     |
| <span data-ttu-id="9fe8e-223">**GetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-223">**GetInputMaxLatency**</span></span>         | <span data-ttu-id="9fe8e-224">**InternalGetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-224">**InternalGetInputMaxLatency**</span></span>         |
| <span data-ttu-id="9fe8e-225">**GetInputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-225">**GetInputSizeInfo**</span></span>           | <span data-ttu-id="9fe8e-226">**InternalGetInputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-226">**InternalGetInputSizeInfo**</span></span>           |
| <span data-ttu-id="9fe8e-227">**GetInputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-227">**GetInputStreamInfo**</span></span>         | <span data-ttu-id="9fe8e-228">**InternalGetInputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-228">**InternalGetInputStreamInfo**</span></span>         |
| <span data-ttu-id="9fe8e-229">**GetInputType**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-229">**GetInputType**</span></span>               | <span data-ttu-id="9fe8e-230">**InternalGetInputType**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-230">**InternalGetInputType**</span></span>               |
| <span data-ttu-id="9fe8e-231">**GetOutputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-231">**GetOutputSizeInfo**</span></span>          | <span data-ttu-id="9fe8e-232">**InternalGetOutputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-232">**InternalGetOutputSizeInfo**</span></span>          |
| <span data-ttu-id="9fe8e-233">**GetOutputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-233">**GetOutputStreamInfo**</span></span>        | <span data-ttu-id="9fe8e-234">**InternalGetOutputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-234">**InternalGetOutputStreamInfo**</span></span>        |
| <span data-ttu-id="9fe8e-235">**GetOutputType**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-235">**GetOutputType**</span></span>              | <span data-ttu-id="9fe8e-236">**InternalGetOutputType**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-236">**InternalGetOutputType**</span></span>              |
| <span data-ttu-id="9fe8e-237">**ProcessInput**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-237">**ProcessInput**</span></span>               | <span data-ttu-id="9fe8e-238">**InternalProcessInput**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-238">**InternalProcessInput**</span></span>               |
| <span data-ttu-id="9fe8e-239">**ProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-239">**ProcessOutput**</span></span>              | <span data-ttu-id="9fe8e-240">**InternalProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-240">**InternalProcessOutput**</span></span>              |
| <span data-ttu-id="9fe8e-241">**SetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-241">**SetInputMaxLatency**</span></span>         | <span data-ttu-id="9fe8e-242">**InternalSetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-242">**InternalSetInputMaxLatency**</span></span>         |



 

<span data-ttu-id="9fe8e-243">Pour les méthodes **IMediaObject** restantes, il n’existe pas de correspondance un-à-un entre les méthodes de modèle et les méthodes de classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-243">For the remaining **IMediaObject** methods, there is not a one-to-one correspondence between template methods and derived-class methods.</span></span> <span data-ttu-id="9fe8e-244">Le tableau suivant résume les méthodes qui sont entièrement implémentées par le modèle, et les méthodes qui appellent d’autres méthodes sur la classe dérivée.</span><span class="sxs-lookup"><span data-stu-id="9fe8e-244">The following table summarizes which methods are fully implemented by the template, and which methods call other methods on the derived class.</span></span>



| <span data-ttu-id="9fe8e-245">Méthode IMediaObject</span><span class="sxs-lookup"><span data-stu-id="9fe8e-245">IMediaObject Method</span></span>                   | <span data-ttu-id="9fe8e-246">Méthode de classe dérivée</span><span class="sxs-lookup"><span data-stu-id="9fe8e-246">Derived Class Method</span></span>                                                             |
|---------------------------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="9fe8e-247">**GetInputCurrentType**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-247">**GetInputCurrentType**</span></span>               | <span data-ttu-id="9fe8e-248">Entièrement implémentée</span><span class="sxs-lookup"><span data-stu-id="9fe8e-248">Fully implemented</span></span>                                                                |
| <span data-ttu-id="9fe8e-249">**GetOutputCurrentType**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-249">**GetOutputCurrentType**</span></span>              | <span data-ttu-id="9fe8e-250">Entièrement implémentée</span><span class="sxs-lookup"><span data-stu-id="9fe8e-250">Fully implemented</span></span>                                                                |
| <span data-ttu-id="9fe8e-251">**GetStreamCount**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-251">**GetStreamCount**</span></span>                    | <span data-ttu-id="9fe8e-252">Entièrement implémentée</span><span class="sxs-lookup"><span data-stu-id="9fe8e-252">Fully implemented</span></span>                                                                |
| <span data-ttu-id="9fe8e-253">**GetInputStatus**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-253">**GetInputStatus**</span></span>                    | <span data-ttu-id="9fe8e-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="9fe8e-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span></span>        |
| <span data-ttu-id="9fe8e-255">**Verrou** (implémenté en tant que **DMOLock**)</span><span class="sxs-lookup"><span data-stu-id="9fe8e-255">**Lock** (implemented as **DMOLock**)</span></span> | <span data-ttu-id="9fe8e-256">[**Verrouillage**](/previous-versions/ms809100(v=msdn.10)), [ **déverrouillage**](/previous-versions/ms809101(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="9fe8e-256">[**Lock**](/previous-versions/ms809100(v=msdn.10)), [**Unlock**](/previous-versions/ms809101(v=msdn.10))</span></span> |
| <span data-ttu-id="9fe8e-257">**SetInputType**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-257">**SetInputType**</span></span>                      | <span data-ttu-id="9fe8e-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="9fe8e-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span></span>        |
| <span data-ttu-id="9fe8e-259">**SetOutputType**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-259">**SetOutputType**</span></span>                     | <span data-ttu-id="9fe8e-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="9fe8e-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span></span>      |



 

## <a name="related-topics"></a><span data-ttu-id="9fe8e-261">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="9fe8e-261">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9fe8e-262">**Modèle de classe IMediaObjectImpl**</span><span class="sxs-lookup"><span data-stu-id="9fe8e-262">**IMediaObjectImpl Class Template**</span></span>](imediaobjectimpl-class-template.md)
</dt> <dt>

[<span data-ttu-id="9fe8e-263">Écriture d’un DMO</span><span class="sxs-lookup"><span data-stu-id="9fe8e-263">Writing a DMO</span></span>](writing-a-dmo.md)
</dt> </dl>

 

 
