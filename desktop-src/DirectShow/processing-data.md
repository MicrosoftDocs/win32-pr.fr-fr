---
description: Traitement des données
ms.assetid: 823615df-ce50-4e20-957a-f83d3be66658
title: Traitement des données
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9bbece449df36c2de88414f313d477b8a16ba896
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "106515314"
---
# <a name="processing-data"></a><span data-ttu-id="f8fec-103">Traitement des données</span><span class="sxs-lookup"><span data-stu-id="f8fec-103">Processing Data</span></span>

<span data-ttu-id="f8fec-104">**Analyse des données multimédias**</span><span class="sxs-lookup"><span data-stu-id="f8fec-104">**Parsing Media Data**</span></span>

<span data-ttu-id="f8fec-105">Si votre filtre analyse les données multimédia, ne faites pas confiance aux en-têtes ou autres données autodescriptives dans le contenu.</span><span class="sxs-lookup"><span data-stu-id="f8fec-105">If your filter parses media data, do not trust headers or other self-describing data in the content.</span></span> <span data-ttu-id="f8fec-106">Par exemple, ne faites pas confiance aux valeurs de taille qui s’affichent dans les paquets AVI ou MPEG.</span><span class="sxs-lookup"><span data-stu-id="f8fec-106">For example, do not trust size values that appear in AVI RIFF chunks or MPEG packets.</span></span> <span data-ttu-id="f8fec-107">Voici des exemples courants de ce type d’erreur :</span><span class="sxs-lookup"><span data-stu-id="f8fec-107">Common examples of this kind of error include:</span></span>

-   <span data-ttu-id="f8fec-108">Lecture de *n* octets de données, où la valeur de *n* provient du contenu, *sans vérifier la* taille réelle de la mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="f8fec-108">Reading *N* bytes of data, where the value of *N* came from the content, without checking *N* against the actual size of your buffer.</span></span>
-   <span data-ttu-id="f8fec-109">Passage à un offset d’octet dans une mémoire tampon, sans vérifier que le décalage se situe dans la mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="f8fec-109">Jumping to a byte offset within a buffer, without verifying that the offset falls within the buffer.</span></span>

<span data-ttu-id="f8fec-110">Une autre classe d’erreurs courante implique de ne pas valider les descriptions de format trouvées dans le contenu.</span><span class="sxs-lookup"><span data-stu-id="f8fec-110">Another common class of errors involves not validating format descriptions that are found in the content.</span></span> <span data-ttu-id="f8fec-111">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="f8fec-111">For example:</span></span>

-   <span data-ttu-id="f8fec-112">Une structure [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) peut être suivie d’une table de couleurs.</span><span class="sxs-lookup"><span data-stu-id="f8fec-112">A [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) structure can be followed by a color table.</span></span> <span data-ttu-id="f8fec-113">La structure **BITMAPINFO,** est définie comme une structure **BITMAPINFOHEADER** suivie d’un tableau de valeurs **RGBQUAD** qui composent la table des couleurs.</span><span class="sxs-lookup"><span data-stu-id="f8fec-113">The **BITMAPINFO** structure is defined as a **BITMAPINFOHEADER** structure followed by an array of **RGBQUAD** values that make up the color table.</span></span> <span data-ttu-id="f8fec-114">La taille du tableau est déterminée par la valeur de **biClrUsed**.</span><span class="sxs-lookup"><span data-stu-id="f8fec-114">The size of the array is determined by the value of **biClrUsed**.</span></span> <span data-ttu-id="f8fec-115">Ne copiez jamais une table des couleurs dans un **BITMAPINFO,** sans vérifier d’abord la taille de la mémoire tampon allouée pour la structure **BITMAPINFO,** .</span><span class="sxs-lookup"><span data-stu-id="f8fec-115">Never copy a color table into a **BITMAPINFO** without first checking the size of the buffer that was allocated for the **BITMAPINFO** structure.</span></span>
-   <span data-ttu-id="f8fec-116">Une structure [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) peut avoir des informations de format supplémentaires ajoutées à la structure.</span><span class="sxs-lookup"><span data-stu-id="f8fec-116">A [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) structure might have extra format information appended to the structure.</span></span> <span data-ttu-id="f8fec-117">Le membre **cbSize** spécifie la taille des informations supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="f8fec-117">The **cbSize** member specifies the size of the extra information.</span></span>

<span data-ttu-id="f8fec-118">Lors de la connexion de code confidentiel, un filtre doit vérifier que toutes les structures de format sont bien formées et contiennent des valeurs raisonnables.</span><span class="sxs-lookup"><span data-stu-id="f8fec-118">During pin connection, a filter should verify that all format structures are well-formed and contain reasonable values.</span></span> <span data-ttu-id="f8fec-119">Si ce n’est pas le cas, refusez la connexion.</span><span class="sxs-lookup"><span data-stu-id="f8fec-119">If not, reject the connection.</span></span> <span data-ttu-id="f8fec-120">Dans le code qui valide la structure de format, soyez particulièrement vigilant avec le débordement arithmétique.</span><span class="sxs-lookup"><span data-stu-id="f8fec-120">In the code that validates the format structure, be especially careful about arithmetic overflow.</span></span> <span data-ttu-id="f8fec-121">Par exemple, dans un **BITMAPINFOHEADER**, la largeur et la hauteur sont des valeurs **longues** de 32 bits, mais la taille de l’image (qui est une fonction du produit des deux) n’est qu’une valeur **DWORD** .</span><span class="sxs-lookup"><span data-stu-id="f8fec-121">For example, in a **BITMAPINFOHEADER**, the width and height are 32-bit **long** values but the image size (which is a function of the product of the two) is only a **DWORD** value.</span></span>

<span data-ttu-id="f8fec-122">Si les données de format de la source sont plus volumineuses que votre mémoire tampon allouée, ne tronquez pas les données sources afin de les copier dans votre mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="f8fec-122">If format data from the source is larger than your allocated buffer, do not truncate the source data in order to copy it into your buffer.</span></span> <span data-ttu-id="f8fec-123">Cela permet de créer une structure dont la taille implicite est supérieure à sa taille réelle.</span><span class="sxs-lookup"><span data-stu-id="f8fec-123">Doing so can create a structure whose implicit size is larger than its actual size.</span></span> <span data-ttu-id="f8fec-124">Par exemple, un en-tête de bitmap peut spécifier une table de palette qui n’existe plus.</span><span class="sxs-lookup"><span data-stu-id="f8fec-124">For example, a bitmap header might specify a palette table which no longer exists.</span></span> <span data-ttu-id="f8fec-125">Au lieu de cela, réallouez la mémoire tampon ou faites simplement échouer la connexion.</span><span class="sxs-lookup"><span data-stu-id="f8fec-125">Instead, reallocate the buffer or simply fail the connection.</span></span>

<span data-ttu-id="f8fec-126">**Erreurs pendant la diffusion en continu**</span><span class="sxs-lookup"><span data-stu-id="f8fec-126">**Errors During Streaming**</span></span>

<span data-ttu-id="f8fec-127">Lorsque le graphique est en cours d’exécution, si votre filtre reçoit du contenu incorrect, il doit mettre fin à la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="f8fec-127">When the graph is running, if your filter receives malformed content, it should terminate streaming.</span></span> <span data-ttu-id="f8fec-128">Effectuez les actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="f8fec-128">Do the following:</span></span>

-   <span data-ttu-id="f8fec-129">Retourne un code d’erreur de la part de **Receive**.</span><span class="sxs-lookup"><span data-stu-id="f8fec-129">Return an error code from **Receive**.</span></span>
-   <span data-ttu-id="f8fec-130">Appelez [**IPIN :: EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream) sur le filtre en aval.</span><span class="sxs-lookup"><span data-stu-id="f8fec-130">Call [**IPin::EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream) on the downstream filter.</span></span>
-   <span data-ttu-id="f8fec-131">Appelez [**CBaseFilter :: NotifyEvent**](cbasefilter-notifyevent.md) pour poster un événement [**EC \_ ERRORABORT**](ec-errorabort.md) .</span><span class="sxs-lookup"><span data-stu-id="f8fec-131">Call [**CBaseFilter::NotifyEvent**](cbasefilter-notifyevent.md) to post an [**EC\_ERRORABORT**](ec-errorabort.md) event.</span></span>

<span data-ttu-id="f8fec-132">**Modifications de format**</span><span class="sxs-lookup"><span data-stu-id="f8fec-132">**Format Changes**</span></span>

<span data-ttu-id="f8fec-133">Plusieurs mécanismes existent pour que les filtres modifient les formats mi-flux.</span><span class="sxs-lookup"><span data-stu-id="f8fec-133">Several mechanisms exist for filters to change formats mid-stream.</span></span> <span data-ttu-id="f8fec-134">Chacune d’elles implique plusieurs étapes, ce qui crée le potentiel pour les fausses acceptations.</span><span class="sxs-lookup"><span data-stu-id="f8fec-134">Each of them involves more than one step, which creates the potential for false acceptances.</span></span> <span data-ttu-id="f8fec-135">Si votre filtre reçoit une demande de modification de format dynamique, il doit soit rejeter la demande, soit honorer le nouveau format à son arrivée.</span><span class="sxs-lookup"><span data-stu-id="f8fec-135">If your filter gets a request for a dynamic format change, then it must either reject the request, or else honor the new format when it arrives.</span></span> <span data-ttu-id="f8fec-136">De même, ne changez jamais de format à moins que l’autre filtre n’accepte.</span><span class="sxs-lookup"><span data-stu-id="f8fec-136">Similarly, never switch formats unless the other filter agrees.</span></span> <span data-ttu-id="f8fec-137">Pour plus d’informations, consultez [modifications de format dynamique](dynamic-format-changes.md).</span><span class="sxs-lookup"><span data-stu-id="f8fec-137">For more information, see [Dynamic Format Changes](dynamic-format-changes.md).</span></span>

 

 
