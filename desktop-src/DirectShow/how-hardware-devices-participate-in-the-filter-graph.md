---
description: Comment les périphériques matériels participent au graphique de filtre
ms.assetid: 27e1c097-9bb4-4f9c-b9f9-0d4225c0d290
title: Comment les périphériques matériels participent au graphique de filtre
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 68794bbc046e633e9a435b2628a20b8ea8aab174
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104480737"
---
# <a name="how-hardware-devices-participate-in-the-filter-graph"></a><span data-ttu-id="e6314-103">Comment les périphériques matériels participent au graphique de filtre</span><span class="sxs-lookup"><span data-stu-id="e6314-103">How Hardware Devices Participate in the Filter Graph</span></span>

<span data-ttu-id="e6314-104">Cet article décrit comment DirectShow interagit avec le matériel audio et vidéo.</span><span class="sxs-lookup"><span data-stu-id="e6314-104">This article describes how DirectShow interacts with audio and video hardware.</span></span>

<span data-ttu-id="e6314-105">**Filtres de wrapper**</span><span class="sxs-lookup"><span data-stu-id="e6314-105">**Wrapper Filters**</span></span>

<span data-ttu-id="e6314-106">Tous les filtres DirectShow sont des composants logiciels en mode utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e6314-106">All DirectShow filters are user mode software components.</span></span> <span data-ttu-id="e6314-107">Pour qu’un périphérique matériel en mode noyau, tel qu’une carte de capture vidéo, puisse joindre un graphique de filtre DirectShow, l’appareil doit être représenté sous la forme d’un filtre en mode utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e6314-107">In order for a kernel mode hardware device, such as a video capture card, to join a DirectShow filter graph, the device must be represented as a user-mode filter.</span></span> <span data-ttu-id="e6314-108">Cette fonction est exécutée par des filtres « Wrapper » spécialisés fournis avec DirectShow.</span><span class="sxs-lookup"><span data-stu-id="e6314-108">This function is performed by specialized "wrapper" filters provided with DirectShow.</span></span> <span data-ttu-id="e6314-109">Ces filtres incluent le filtre de [capture audio](audio-capture.md) , le filtre de [capture VFW](vfw-capture-filter.md) , le filtre de [Tuner TV](tv-tuner-filter.md) , le filtre [audio TV](tv-audio-filter.md) et le filtre de barre [vidéo analogique](analog-video-crossbar-filter.md) .</span><span class="sxs-lookup"><span data-stu-id="e6314-109">These filters include the [Audio Capture](audio-capture.md) filter, the [VFW Capture](vfw-capture-filter.md) filter, the [TV Tuner](tv-tuner-filter.md) filter, the [TV Audio](tv-audio-filter.md) filter, and the [Analog Video Crossbar](analog-video-crossbar-filter.md) filter.</span></span> <span data-ttu-id="e6314-110">DirectShow fournit également un filtre appelé KsProxy, qui peut représenter n’importe quel type de périphérique de streaming Windows Driver Model (WDM).</span><span class="sxs-lookup"><span data-stu-id="e6314-110">DirectShow also provides a filter called KsProxy, which can represent any type of Windows Driver Model (WDM) streaming device.</span></span> <span data-ttu-id="e6314-111">Les fournisseurs de matériel peuvent étendre KsProxy pour prendre en charge des fonctionnalités personnalisées, en fournissant un *plug-in ksproxy*, qui est un objet com agrégé par ksproxy.</span><span class="sxs-lookup"><span data-stu-id="e6314-111">Hardware vendors can extend KsProxy to support custom functionality, by providing a *Ksproxy plug-in*, which is a COM object aggregated by KsProxy.</span></span>

<span data-ttu-id="e6314-112">Les filtres Wrapper exposent les interfaces COM qui représentent les fonctionnalités de l’appareil.</span><span class="sxs-lookup"><span data-stu-id="e6314-112">The wrapper filters expose COM interfaces that represent the capabilities of the device.</span></span> <span data-ttu-id="e6314-113">L’application utilise ces interfaces pour transmettre des informations vers et depuis le filtre.</span><span class="sxs-lookup"><span data-stu-id="e6314-113">The application uses these interfaces to pass information to and from the filter.</span></span> <span data-ttu-id="e6314-114">Le filtre traduit les appels de méthode COM en appels de pilote de périphérique, transmet ces informations au pilote en mode noyau, puis convertit le résultat en application.</span><span class="sxs-lookup"><span data-stu-id="e6314-114">The filter translates the COM method calls into device driver calls, passes that information to the driver in kernel mode, and then translates the result back to the application.</span></span> <span data-ttu-id="e6314-115">Le tuner TV, l’audio TV, le distributeur vidéo analogique et les filtres KsProxy prennent en charge les propriétés de pilote personnalisées via l’interface [**IKsPropertySet**](ikspropertyset.md) .</span><span class="sxs-lookup"><span data-stu-id="e6314-115">The TV Tuner, TV Audio, Analog Video Crossbar, and KsProxy filters support custom driver properties through the [**IKsPropertySet**](ikspropertyset.md) interface.</span></span> <span data-ttu-id="e6314-116">Le filtre de capture VFW et le filtre de capture audio ne sont pas extensibles de cette façon.</span><span class="sxs-lookup"><span data-stu-id="e6314-116">The VFW Capture filter and the Audio Capture filter are not extensible in this way.</span></span>

<span data-ttu-id="e6314-117">Pour les développeurs d’applications, les filtres de wrapper permettent à l’application de contrôler les appareils tout comme ils contrôlent tout autre filtre DirectShow.</span><span class="sxs-lookup"><span data-stu-id="e6314-117">For application developers, wrapper filters enable the application to control devices just as they control any other DirectShow filter.</span></span> <span data-ttu-id="e6314-118">Aucune programmation spéciale n’est requise. les détails de la communication avec l’appareil en mode noyau sont encapsulés dans le filtre.</span><span class="sxs-lookup"><span data-stu-id="e6314-118">No special programming is required; the details of communicating with the kernel-mode device are encapsulated within the filter.</span></span>

<span data-ttu-id="e6314-119">**Vidéo pour les appareils Windows**</span><span class="sxs-lookup"><span data-stu-id="e6314-119">**Video for Windows Devices**</span></span>

<span data-ttu-id="e6314-120">Le filtre de capture VFW prend en charge les cartes de capture vidéo précédentes pour Windows (VfW).</span><span class="sxs-lookup"><span data-stu-id="e6314-120">The VFW Capture filter supports earlier Video for Windows (VfW) capture cards.</span></span> <span data-ttu-id="e6314-121">Lorsqu’une carte VfW est présente sur le système cible, elle peut être découverte et ajoutée au graphique de filtre à l’aide de l' [énumérateur de périphérique système](system-device-enumerator.md)DirectShow.</span><span class="sxs-lookup"><span data-stu-id="e6314-121">When a VfW card is present on the target system, it can be discovered and added to the filter graph using the DirectShow [System Device Enumerator](system-device-enumerator.md).</span></span> <span data-ttu-id="e6314-122">Pour plus d’informations, consultez [énumération des appareils et des filtres](enumerating-devices-and-filters.md).</span><span class="sxs-lookup"><span data-stu-id="e6314-122">For details, see [Enumerating Devices and Filters](enumerating-devices-and-filters.md).</span></span>

<span data-ttu-id="e6314-123">**Capture audio et mixage de périphériques (cartes son)**</span><span class="sxs-lookup"><span data-stu-id="e6314-123">**Audio Capture and Mixing Devices (Sound Cards)**</span></span>

<span data-ttu-id="e6314-124">Les cartes son plus récentes comportent des prises jack d’entrée pour les microphones et d’autres types d’appareils.</span><span class="sxs-lookup"><span data-stu-id="e6314-124">Newer sound cards have input jacks for microphones and other types of devices.</span></span> <span data-ttu-id="e6314-125">En général, ces cartes disposent également de fonctionnalités de mixage intégrées pour contrôler le volume, les aigus et les basses de chaque entrée individuelle.</span><span class="sxs-lookup"><span data-stu-id="e6314-125">Typically these cards also have on-board mixing capabilities for controlling the volume, treble, and bass of each individual input.</span></span> <span data-ttu-id="e6314-126">Dans DirectShow, les entrées et le mixage de la carte son sont encapsulés par le filtre de capture audio.</span><span class="sxs-lookup"><span data-stu-id="e6314-126">In DirectShow, the sound card's inputs and mixer are wrapped by the Audio Capture filter.</span></span> <span data-ttu-id="e6314-127">Chaque carte audio peut être détectée avec l’énumérateur du périphérique système.</span><span class="sxs-lookup"><span data-stu-id="e6314-127">Each sound card can be discovered with the System Device Enumerator.</span></span> <span data-ttu-id="e6314-128">Pour afficher les cartes son dans votre système, exécutez GraphEdit et sélectionnez dans la catégorie sources de capture audio.</span><span class="sxs-lookup"><span data-stu-id="e6314-128">To view the sound cards in your system, run GraphEdit and select from the Audio Capture Sources category.</span></span> <span data-ttu-id="e6314-129">Chaque filtre de cette catégorie est une instance distincte du filtre de capture audio.</span><span class="sxs-lookup"><span data-stu-id="e6314-129">Each filter in that category is a separate instance of the Audio Capture filter.</span></span> <span data-ttu-id="e6314-130">(Consultez [utilisation de GraphEdit](using-graphedit.md).)</span><span class="sxs-lookup"><span data-stu-id="e6314-130">(See [Using GraphEdit](using-graphedit.md).)</span></span>

<span data-ttu-id="e6314-131">**Périphériques de streaming WDM**</span><span class="sxs-lookup"><span data-stu-id="e6314-131">**WDM Streaming Devices**</span></span>

<span data-ttu-id="e6314-132">Les décodeurs matériels et les cartes de capture les plus récents sont conformes à la spécification du Windows Driver Model (WDM).</span><span class="sxs-lookup"><span data-stu-id="e6314-132">Newer hardware decoders and capture cards conform to the Windows Driver Model (WDM) specification.</span></span> <span data-ttu-id="e6314-133">Ces appareils ont des fonctionnalités supérieures à celles des appareils VfW.</span><span class="sxs-lookup"><span data-stu-id="e6314-133">These devices have greater functionality than VfW devices.</span></span> <span data-ttu-id="e6314-134">Les cartes de capture vidéo WDM peuvent prendre en charge des fonctionnalités qui ne sont pas disponibles sous VfW, y compris l’énumération des formats de capture, le contrôle par programmation des paramètres vidéo tels que la teinte et la luminosité, la sélection d’entrée par programmation et la prise en charge du tuner TV.</span><span class="sxs-lookup"><span data-stu-id="e6314-134">WDM video capture cards can support features that are not available under VfW, including the enumeration of capture formats, programmatic control of video parameters such as hue and brightness, programmatic input selection, and TV Tuner support.</span></span>

<span data-ttu-id="e6314-135">Pour prendre en charge les périphériques de streaming WDM, DirectShow fournit le filtre KsProxy (ksproxy.ax).</span><span class="sxs-lookup"><span data-stu-id="e6314-135">To support WDM streaming devices, DirectShow provides the KsProxy filter (ksproxy.ax).</span></span> <span data-ttu-id="e6314-136">KsProxy a été appelé « filtre pour les couteaux suisses », car il fait beaucoup de choses différentes.</span><span class="sxs-lookup"><span data-stu-id="e6314-136">KsProxy has been called the "Swiss Army Knife filter" because it does so many different things.</span></span> <span data-ttu-id="e6314-137">Le nombre de broches sur le filtre et le nombre d’interfaces COM exposées par le filtre dépendent des fonctionnalités du pilote sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="e6314-137">The number of pins on the filter, and the number of COM interfaces exposed by the filter, depend on the capabilities of the underlying driver.</span></span> <span data-ttu-id="e6314-138">KsProxy n’apparaît pas dans le graphique de filtre sous le nom « KsProxy ».</span><span class="sxs-lookup"><span data-stu-id="e6314-138">KsProxy does not appear in the filter graph under the name "KsProxy."</span></span> <span data-ttu-id="e6314-139">Il prend toujours le nom convivial de l’appareil, qui se trouve dans le registre.</span><span class="sxs-lookup"><span data-stu-id="e6314-139">It always takes the friendly name of the device, which is found in the registry.</span></span> <span data-ttu-id="e6314-140">Pour afficher les périphériques WDM sur votre système, exécutez GraphEdit et sélectionnez dans les catégories de streaming WDM.</span><span class="sxs-lookup"><span data-stu-id="e6314-140">To view the WDM devices on your system, run GraphEdit and select from the WDM Streaming categories.</span></span> <span data-ttu-id="e6314-141">Même si votre système ne possède qu’une seule carte WDM, cette carte peut contenir plusieurs appareils.</span><span class="sxs-lookup"><span data-stu-id="e6314-141">Even if you have only one WDM card on your system, that card might contain more than one device.</span></span> <span data-ttu-id="e6314-142">Chaque appareil est représenté sous la forme d’un filtre distinct, et chacun de ces filtres est en fait KsProxy.</span><span class="sxs-lookup"><span data-stu-id="e6314-142">Each device is represented as a separate filter, and each of these filters is actually KsProxy.</span></span>

<span data-ttu-id="e6314-143">Une application utilise l’énumérateur de périphérique système pour rechercher des monikers de périphérique WDM sur le système.</span><span class="sxs-lookup"><span data-stu-id="e6314-143">An application uses the System Device Enumerator to find WDM device monikers on the system.</span></span> <span data-ttu-id="e6314-144">KsProxy est instancié en appelant **BindToObject** sur le moniker.</span><span class="sxs-lookup"><span data-stu-id="e6314-144">KsProxy is instantiated by calling **BindToObject** on the moniker.</span></span> <span data-ttu-id="e6314-145">Comme KsProxy peut représenter tous les types d’appareils WDM, il doit interroger le pilote pour déterminer les jeux de propriétés que le pilote prend en charge.</span><span class="sxs-lookup"><span data-stu-id="e6314-145">Because KsProxy can represent all kinds of WDM devices, it must query the driver to determine which property sets the driver supports.</span></span> <span data-ttu-id="e6314-146">Les jeux de propriétés sont des collections de structures de données utilisées par les pilotes WDM, ainsi que par certains filtres en mode utilisateur, tels que les décodeurs logiciels MPEG-2.</span><span class="sxs-lookup"><span data-stu-id="e6314-146">Property sets are collections of data structures used by WDM drivers, and also by some user mode filters, such as MPEG-2 software decoders.</span></span> <span data-ttu-id="e6314-147">KsProxy configure lui-même pour exposer les interfaces COM qui correspondent à ces jeux de propriétés.</span><span class="sxs-lookup"><span data-stu-id="e6314-147">KsProxy configures itself to expose the COM interfaces that correspond to those property sets.</span></span> <span data-ttu-id="e6314-148">KsProxy convertit les appels de méthode COM en jeux de propriétés et les envoie au pilote.</span><span class="sxs-lookup"><span data-stu-id="e6314-148">KsProxy translates the COM method calls into property sets and sends these to the driver.</span></span> <span data-ttu-id="e6314-149">Les fournisseurs de matériel peuvent étendre KsProxy en fournissant des plug-ins, qui sont des interfaces spécifiques au fournisseur qui exposent les fonctionnalités spéciales d’un appareil.</span><span class="sxs-lookup"><span data-stu-id="e6314-149">Hardware vendors can extend KsProxy by supplying plug-ins, which are vendor-specific interfaces that expose the special capabilities of a device.</span></span> <span data-ttu-id="e6314-150">Tous ces détails sont masqués dans l’application.</span><span class="sxs-lookup"><span data-stu-id="e6314-150">All these details are hidden from application.</span></span> <span data-ttu-id="e6314-151">L’application contrôle l’appareil par le biais de KsProxy, de la même façon que n’importe quel autre filtre DirectShow.</span><span class="sxs-lookup"><span data-stu-id="e6314-151">The application controls the device by way of KsProxy, in the same way as any other DirectShow filter.</span></span>

<span data-ttu-id="e6314-152">**Streaming de noyau**</span><span class="sxs-lookup"><span data-stu-id="e6314-152">**Kernel Streaming**</span></span>

<span data-ttu-id="e6314-153">Les périphériques WDM prennent en charge la diffusion en continu de noyau, dans laquelle les données sont entièrement diffusées en mode noyau, sans jamais passer en mode utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e6314-153">WDM devices support kernel streaming, in which data is streamed entirely in kernel mode without ever switching to user mode.</span></span> <span data-ttu-id="e6314-154">Le basculement entre le mode noyau et le mode utilisateur est gourmand en ressources informatiques. le streaming de noyau permet des vitesses de transmission élevées sans nécessiter le processeur de l’ordinateur hôte.</span><span class="sxs-lookup"><span data-stu-id="e6314-154">Switching between kernel mode and user mode is computationally expensive; kernel streaming allows for high bit rates without burdening the host CPU.</span></span> <span data-ttu-id="e6314-155">Les filtres WDM peuvent utiliser la diffusion en continu du noyau pour transmettre des données multimédias directement d’un périphérique matériel à un autre, sur la même carte ou sur une autre carte, sans copier les données dans la mémoire principale du système.</span><span class="sxs-lookup"><span data-stu-id="e6314-155">WDM-based filters can use kernel streaming to pass multimedia data directly from one hardware device to another, either on the same card or on a different card, without copying the data into the system's main memory.</span></span>

<span data-ttu-id="e6314-156">Du point de vue d’une application, elle apparaît comme si les données se déplacent d’un filtre en mode utilisateur à la suivante.</span><span class="sxs-lookup"><span data-stu-id="e6314-156">From an application's point of view, it appears as if the data moves from one user-mode filter to the next.</span></span> <span data-ttu-id="e6314-157">En réalité, les données risquent de ne jamais passer en mode utilisateur, mais elles peuvent être transmises directement d’un appareil en mode noyau à un autre jusqu’à ce qu’elles soient rendues sur la carte vidéo.</span><span class="sxs-lookup"><span data-stu-id="e6314-157">In reality, the data might never pass into user mode at all, but instead might be streamed directly from one kernel-mode device to another until it is rendered on the video graphics card.</span></span> <span data-ttu-id="e6314-158">Certains scénarios, tels que la capture dans un fichier, requièrent que les données passent du mode noyau au mode utilisateur à un moment donné.</span><span class="sxs-lookup"><span data-stu-id="e6314-158">Some scenarios, such as capture to a file, require that the data pass from kernel mode to user mode at some point.</span></span> <span data-ttu-id="e6314-159">Toutefois, ce commutateur ne requiert pas nécessairement la copie des données vers un nouvel emplacement en mémoire.</span><span class="sxs-lookup"><span data-stu-id="e6314-159">However, this switch does not necessarily require the data to be copied to a new location in memory.</span></span>

<span data-ttu-id="e6314-160">Les développeurs d’applications n’ont généralement pas besoin de se préoccuper des détails de la diffusion en continu du noyau, à l’exception des informations d’arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="e6314-160">Application developers generally do not need to be concerned with the details of kernel streaming, except as background information.</span></span> <span data-ttu-id="e6314-161">Consultez Microsoft DDK pour obtenir des informations plus détaillées sur WDM, Kernel streaming, KsProxy et les rubriques connexes.</span><span class="sxs-lookup"><span data-stu-id="e6314-161">See the Microsoft DDK for more detailed information about WDM, kernel streaming, KsProxy, and related topics.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e6314-162">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="e6314-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e6314-163">Le graphique de filtre et ses composants</span><span class="sxs-lookup"><span data-stu-id="e6314-163">The Filter Graph and Its Components</span></span>](the-filter-graph-and-its-components.md)
</dt> </dl>

 

 



