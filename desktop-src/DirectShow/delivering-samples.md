---
description: Exemples de livrables
ms.assetid: 31aabb6d-dec6-41fa-b24d-35a77b67bc4a
title: Exemples de livrables
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 083bc8c88649c04bdf9f93f86ebcc277ee48e75e
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104392896"
---
# <a name="delivering-samples"></a><span data-ttu-id="e9c43-103">Exemples de livrables</span><span class="sxs-lookup"><span data-stu-id="e9c43-103">Delivering Samples</span></span>

<span data-ttu-id="e9c43-104">Cet article décrit comment un filtre fournit un exemple.</span><span class="sxs-lookup"><span data-stu-id="e9c43-104">This article describes how a filter delivers a sample.</span></span> <span data-ttu-id="e9c43-105">Il décrit à la fois le modèle push, l’utilisation des méthodes [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) et le modèle pull, à l’aide de [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader).</span><span class="sxs-lookup"><span data-stu-id="e9c43-105">It describes both the push model, using [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) methods, and the pull model, using [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader).</span></span>

<span data-ttu-id="e9c43-106">**Modèle push : distribution d’un exemple**</span><span class="sxs-lookup"><span data-stu-id="e9c43-106">**Push Model: Delivering a Sample**</span></span>

<span data-ttu-id="e9c43-107">La broche de sortie fournit un exemple en appelant la méthode [**IMemInputPin :: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) ou la méthode [**IMemInputPin :: ReceiveMultiple**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivemultiple) , qui est équivalente, mais fournit un tableau d’exemples.</span><span class="sxs-lookup"><span data-stu-id="e9c43-107">The output pin delivers a sample by calling the [**IMemInputPin::Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) method or the [**IMemInputPin::ReceiveMultiple**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivemultiple) method, which is equivalent but delivers an array of samples.</span></span> <span data-ttu-id="e9c43-108">La broche d’entrée peut bloquer l’intérieur de **Receive** (ou **ReceiveMultiple**).</span><span class="sxs-lookup"><span data-stu-id="e9c43-108">The input pin can block inside **Receive** (or **ReceiveMultiple**).</span></span> <span data-ttu-id="e9c43-109">Si le code pin peut se bloquer, sa méthode [**IMemInputPin :: ReceiveCanBlock**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivecanblock) doit retourner S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="e9c43-109">If the pin might block, its [**IMemInputPin::ReceiveCanBlock**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivecanblock) method should return S\_OK.</span></span> <span data-ttu-id="e9c43-110">Si le code confidentiel ne peut jamais se bloquer, **ReceiveCanBlock** doit retourner S \_ false.</span><span class="sxs-lookup"><span data-stu-id="e9c43-110">If the pin guarantees never to block, **ReceiveCanBlock** should return S\_FALSE.</span></span> <span data-ttu-id="e9c43-111">La \_ valeur de retour OK ne signifie pas que **Receive** Always se bloque.</span><span class="sxs-lookup"><span data-stu-id="e9c43-111">The S\_OK return value does not mean that **Receive** always blocks, just that it might.</span></span>

<span data-ttu-id="e9c43-112">Bien que la **réception** peut bloquer l’attente de la disponibilité d’une ressource, elle ne doit pas bloquer l’attente d’un plus grand nombre de données à partir du filtre en amont.</span><span class="sxs-lookup"><span data-stu-id="e9c43-112">Although **Receive** can block to wait for a resource to become available, it should not block to wait for more data from the upstream filter.</span></span> <span data-ttu-id="e9c43-113">Cela peut provoquer un blocage où le filtre en amont attend que le filtre en aval libère l’exemple, ce qui ne se produit jamais car le filtre en aval attend sur le filtre amont.</span><span class="sxs-lookup"><span data-stu-id="e9c43-113">Doing so can cause a deadlock where the upstream filter waits for the downstream filter to release the sample, which never happens because the downstream filter is waiting on the upstream filter.</span></span> <span data-ttu-id="e9c43-114">Toutefois, si un filtre a plusieurs broches d’entrée, l’un d’eux peut attendre la réception de données par un autre code PIN.</span><span class="sxs-lookup"><span data-stu-id="e9c43-114">If a filter has multiple input pins, however, one pin can wait for another pin to receive data.</span></span> <span data-ttu-id="e9c43-115">Par exemple, le filtre [multiplex MUX](avi-mux-filter.md) effectue cette opération afin qu’il puisse entrelacer les données audio et vidéo.</span><span class="sxs-lookup"><span data-stu-id="e9c43-115">For example, the [AVI Mux](avi-mux-filter.md) filter does this so that it can interleave audio and video data.</span></span>

<span data-ttu-id="e9c43-116">Un code confidentiel peut rejeter un échantillon pour plusieurs raisons :</span><span class="sxs-lookup"><span data-stu-id="e9c43-116">A pin might reject a sample for a number of reasons:</span></span>

-   <span data-ttu-id="e9c43-117">Le code PIN est vidé (voir [vidage](flushing.md)).</span><span class="sxs-lookup"><span data-stu-id="e9c43-117">The pin is flushing (see [Flushing](flushing.md)).</span></span>
-   <span data-ttu-id="e9c43-118">Le pin n’est pas connecté.</span><span class="sxs-lookup"><span data-stu-id="e9c43-118">The pin is not connected.</span></span>
-   <span data-ttu-id="e9c43-119">Le filtre est arrêté.</span><span class="sxs-lookup"><span data-stu-id="e9c43-119">The filter is stopped.</span></span>
-   <span data-ttu-id="e9c43-120">Une autre erreur s’est produite.</span><span class="sxs-lookup"><span data-stu-id="e9c43-120">Some other error occurred.</span></span>

<span data-ttu-id="e9c43-121">La méthode **Receive** doit retourner S \_ false dans le premier cas, et un code d’échec dans les autres cas.</span><span class="sxs-lookup"><span data-stu-id="e9c43-121">The **Receive** method should return S\_FALSE in the first case, and a failure code in the other cases.</span></span> <span data-ttu-id="e9c43-122">Le filtre amont doit cesser d’envoyer des exemples quand le code de retour est différent de S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="e9c43-122">The upstream filter should stop sending samples when the return code is anything other than S\_OK.</span></span>

<span data-ttu-id="e9c43-123">Vous pouvez considérer les trois premiers cas comme des défaillances « attendues », dans le sens où le filtre était dans un état incorrect pour recevoir des exemples.</span><span class="sxs-lookup"><span data-stu-id="e9c43-123">You can consider the first three cases to be "expected" failures, in the sense that the filter was in the wrong state to receive samples.</span></span> <span data-ttu-id="e9c43-124">Une défaillance inattendue serait une erreur qui amène le code confidentiel à rejeter un échantillon, même si le code PIN est dans un état de réception.</span><span class="sxs-lookup"><span data-stu-id="e9c43-124">An unexpected failure would be one that causes the pin to reject a sample even though the pin is in a receiving state.</span></span> <span data-ttu-id="e9c43-125">Si une erreur de ce type se produit, le code PIN doit envoyer une notification de fin de flux en aval et envoyer un événement [**EC \_ ERRORABORT**](ec-errorabort.md) au gestionnaire de graphique de filtre.</span><span class="sxs-lookup"><span data-stu-id="e9c43-125">If an error of this type occurs, the pin should send an end-of-stream notification downstream, and send an [**EC\_ERRORABORT**](ec-errorabort.md) event to the Filter Graph Manager.</span></span>

<span data-ttu-id="e9c43-126">Dans les classes de base DirectShow, la méthode [**CBaseInputPin :: CheckStreaming**](cbaseinputpin-checkstreaming.md) vérifie les cas d’échec généraux (vidage, arrêt, etc.).</span><span class="sxs-lookup"><span data-stu-id="e9c43-126">In the DirectShow base classes, the [**CBaseInputPin::CheckStreaming**](cbaseinputpin-checkstreaming.md) method checks for the general failure cases—flushing, stopped, and so forth.</span></span> <span data-ttu-id="e9c43-127">La classe dérivée doit vérifier les erreurs qui sont spécifiques au filtre.</span><span class="sxs-lookup"><span data-stu-id="e9c43-127">The derived class will need to check for failures that are specific to the filter.</span></span> <span data-ttu-id="e9c43-128">En cas d’erreur, la méthode [**CBaseInputPin :: Receive**](cbaseinputpin-receive.md) envoie la notification de fin de flux et l' \_ événement EC ERRORABORT.</span><span class="sxs-lookup"><span data-stu-id="e9c43-128">In case of an error, the [**CBaseInputPin::Receive**](cbaseinputpin-receive.md) method sends the end-of-stream notification and the EC\_ERRORABORT event.</span></span>

<span data-ttu-id="e9c43-129">**Modèle d’extraction : demande d’un exemple**</span><span class="sxs-lookup"><span data-stu-id="e9c43-129">**Pull Model: Requesting a Sample**</span></span>

<span data-ttu-id="e9c43-130">Dans l’interface **IAsyncReader** , la broche d’entrée demande des exemples à partir de la broche de sortie en appelant l’une des méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="e9c43-130">In the **IAsyncReader** interface, the input pin requests samples from the output pin by calling one of the following methods:</span></span>

-   [<span data-ttu-id="e9c43-131">**IAsyncReader :: Request**</span><span class="sxs-lookup"><span data-stu-id="e9c43-131">**IAsyncReader::Request**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-request)
-   [<span data-ttu-id="e9c43-132">**IAsyncReader::SyncRead**</span><span class="sxs-lookup"><span data-stu-id="e9c43-132">**IAsyncReader::SyncRead**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-syncread)
-   [<span data-ttu-id="e9c43-133">**IAsyncReader::SyncReadAligned**</span><span class="sxs-lookup"><span data-stu-id="e9c43-133">**IAsyncReader::SyncReadAligned**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-syncreadaligned)

<span data-ttu-id="e9c43-134">La méthode de **demande** est asynchrone ; la broche d’entrée appelle [**IAsyncReader :: WaitForNext**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-waitfornext) pour attendre la fin de la demande.</span><span class="sxs-lookup"><span data-stu-id="e9c43-134">The **Request** method is asynchronous; the input pin calls [**IAsyncReader::WaitForNext**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-waitfornext) to wait for the request to complete.</span></span> <span data-ttu-id="e9c43-135">Les deux autres méthodes sont synchrones.</span><span class="sxs-lookup"><span data-stu-id="e9c43-135">The other two methods are synchronous.</span></span>

<span data-ttu-id="e9c43-136">**Quand fournir des données**</span><span class="sxs-lookup"><span data-stu-id="e9c43-136">**When to Deliver Data**</span></span>

<span data-ttu-id="e9c43-137">Un filtre remet toujours des exemples alors qu’il est à l’État en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="e9c43-137">A filter always delivers samples while it is in the running state.</span></span> <span data-ttu-id="e9c43-138">Dans la plupart des cas, un filtre fournit également des exemples lorsqu’il est suspendu.</span><span class="sxs-lookup"><span data-stu-id="e9c43-138">In most cases, a filter also delivers samples while paused.</span></span> <span data-ttu-id="e9c43-139">Cela permet au graphique d’indiquer les données afin que la lecture démarre immédiatement lorsque l' **exécution** est appelée (voir les [États de filtre](filter-states.md)).</span><span class="sxs-lookup"><span data-stu-id="e9c43-139">This enables the graph to cue up the data so that playback starts immediately when **Run** is called (see [Filter States](filter-states.md)).</span></span> <span data-ttu-id="e9c43-140">Si votre filtre ne remet pas de données pendant qu’il est suspendu, la méthode **IMediaFilter :: GetState** du filtre doit retourner VFW s ne peut pas se mettre \_ \_ \_ en pause.</span><span class="sxs-lookup"><span data-stu-id="e9c43-140">If your filter does not deliver data while paused, the filter's **IMediaFilter::GetState** method should return VFW\_S\_CANT\_CUE in the paused state.</span></span> <span data-ttu-id="e9c43-141">Ce code de retour indique au graphique de filtre de ne pas attendre les données de votre filtre avant de terminer la transition de pause.</span><span class="sxs-lookup"><span data-stu-id="e9c43-141">This return code signals the filter graph not to wait for data from your filter before it completes the pause transition.</span></span> <span data-ttu-id="e9c43-142">Dans le cas contraire, la méthode **Pause** se bloque indéfiniment.</span><span class="sxs-lookup"><span data-stu-id="e9c43-142">Otherwise, the **Pause** method will block indefinitely.</span></span> <span data-ttu-id="e9c43-143">Pour obtenir un exemple de code, consultez [**CBaseFilter :: GetState**](cbasefilter-getstate.md).</span><span class="sxs-lookup"><span data-stu-id="e9c43-143">For example code, see [**CBaseFilter::GetState**](cbasefilter-getstate.md).</span></span>

<span data-ttu-id="e9c43-144">Voici quelques exemples de cas où un filtre peut avoir besoin de retourner VFW S ne peut pas \_ \_ \_ signaler :</span><span class="sxs-lookup"><span data-stu-id="e9c43-144">Here are some examples of when a filter might need to return VFW\_S\_CANT\_CUE:</span></span>

-   <span data-ttu-id="e9c43-145">Les sources en direct, telles que les filtres de capture, ne doivent pas envoyer de données pendant la suspension.</span><span class="sxs-lookup"><span data-stu-id="e9c43-145">Live sources, such as capture filters, should not send data while paused.</span></span> <span data-ttu-id="e9c43-146">Consultez [production de données dans un filtre de capture](producing-data-in-a-capture-filter.md).</span><span class="sxs-lookup"><span data-stu-id="e9c43-146">See [Producing Data in a Capture Filter](producing-data-in-a-capture-filter.md).</span></span>
-   <span data-ttu-id="e9c43-147">Un filtre de fractionnement peut ou non envoyer des données pendant la suspension, en fonction de l’implémentation.</span><span class="sxs-lookup"><span data-stu-id="e9c43-147">A splitter filter might or might not send data while paused, depending on the implementation.</span></span> <span data-ttu-id="e9c43-148">Si le filtre utilise des threads distincts pour mettre en file d’attente des données sur chaque broche de sortie, il peut envoyer des données en pause.</span><span class="sxs-lookup"><span data-stu-id="e9c43-148">If the filter uses separate threads to queue data on each output pin, then it can send data while paused.</span></span> <span data-ttu-id="e9c43-149">Toutefois, si le filtre utilise un seul thread pour chaque broche de sortie, le premier code pin peut bloquer le thread lorsqu’il appelle **Receive**, ce qui empêche les autres broches d’envoyer des données.</span><span class="sxs-lookup"><span data-stu-id="e9c43-149">But if the filter uses a single thread for every output pin, the first pin might block the thread when it calls **Receive**, which will prevent the other pins from sending data.</span></span> <span data-ttu-id="e9c43-150">Dans ce cas, vous devez retourner VFW \_ S \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="e9c43-150">In that case, you should return VFW\_S\_CANT\_CUE.</span></span>
-   <span data-ttu-id="e9c43-151">Un filtre peut fournir des données de façon sporadique.</span><span class="sxs-lookup"><span data-stu-id="e9c43-151">A filter might deliver data sporadically.</span></span> <span data-ttu-id="e9c43-152">Par exemple, il peut analyser un flux de données personnalisé et filtrer certains paquets tout en distribuant d’autres utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="e9c43-152">For example, it might parse a custom data stream and filter out some packets while delivering others.</span></span> <span data-ttu-id="e9c43-153">Dans ce cas, il n’est peut-être pas garanti que le filtre remette les données pendant la suspension.</span><span class="sxs-lookup"><span data-stu-id="e9c43-153">In that case, the filter may not be guaranteed to deliver data while paused.</span></span>

<span data-ttu-id="e9c43-154">Un filtre source (à l’aide du modèle push) ou un filtre d’analyseur (à l’aide du modèle push/pull) crée un ou plusieurs threads de streaming, qui fournissent des échantillons aussi rapidement que possible.</span><span class="sxs-lookup"><span data-stu-id="e9c43-154">A source filter (using the push model) or a parser filter (using the push/pull model) creates one or more streaming threads, which deliver samples as quickly as possible.</span></span> <span data-ttu-id="e9c43-155">Les filtres en aval, tels que les décodeurs et les transformations, envoient généralement des données uniquement lorsque la **réception** est appelée sur leurs broches d’entrée.</span><span class="sxs-lookup"><span data-stu-id="e9c43-155">Downstream filters, such as decoders and transforms, typically send data only when **Receive** is called on their input pins.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e9c43-156">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="e9c43-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e9c43-157">Réception et envoi d’exemples</span><span class="sxs-lookup"><span data-stu-id="e9c43-157">Receiving and Delivering Samples</span></span>](receiving-and-delivering-samples.md)
</dt> </dl>

 

 



