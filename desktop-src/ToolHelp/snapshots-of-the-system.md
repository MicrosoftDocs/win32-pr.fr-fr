---
title: Captures instantanées du système
description: Les instantanés sont au cœur des fonctions d’aide de l’outil. Un instantané est une copie en lecture seule de l’état actuel d’une ou plusieurs des listes suivantes qui résident dans les processus, les threads, les modules et les segments de mémoire système.
ms.assetid: a8122960-f078-4efb-8e01-bf6fb69ee0dd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6ab6f9a45ad2e12eda53d3143e43c9234c20aae3
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103842485"
---
# <a name="snapshots-of-the-system"></a><span data-ttu-id="58cb9-104">Captures instantanées du système</span><span class="sxs-lookup"><span data-stu-id="58cb9-104">Snapshots of the System</span></span>

<span data-ttu-id="58cb9-105">Les instantanés sont au cœur des fonctions d’aide de l’outil.</span><span class="sxs-lookup"><span data-stu-id="58cb9-105">Snapshots are at the core of the tool help functions.</span></span> <span data-ttu-id="58cb9-106">Un instantané est une copie en lecture seule de l’état actuel d’une ou plusieurs des listes suivantes qui résident dans la mémoire système : processus, threads, modules et tas.</span><span class="sxs-lookup"><span data-stu-id="58cb9-106">A snapshot is a read-only copy of the current state of one or more of the following lists that reside in system memory: processes, threads, modules, and heaps.</span></span>

<span data-ttu-id="58cb9-107">Les processus qui utilisent les fonctions de l’aide de l’outil accèdent à ces listes à partir de captures instantanées plutôt que directement depuis le système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="58cb9-107">Processes that use tool help functions access these lists from snapshots instead of directly from the operating system.</span></span> <span data-ttu-id="58cb9-108">Les listes dans la mémoire système changent lorsque les processus sont démarrés et terminés, les threads sont créés et détruits, les modules exécutables sont chargés et déchargés de la mémoire système, et les tas sont créés et détruits.</span><span class="sxs-lookup"><span data-stu-id="58cb9-108">The lists in system memory change when processes are started and ended, threads are created and destroyed, executable modules are loaded and unloaded from system memory, and heaps are created and destroyed.</span></span> <span data-ttu-id="58cb9-109">L’utilisation des informations d’un instantané empêche les incohérences.</span><span class="sxs-lookup"><span data-stu-id="58cb9-109">The use of information from a snapshot prevents inconsistencies.</span></span> <span data-ttu-id="58cb9-110">Dans le cas contraire, les modifications apportées à une liste peuvent éventuellement entraîner un thread à traverser la liste ou provoquer une violation d’accès (une erreur GP).</span><span class="sxs-lookup"><span data-stu-id="58cb9-110">Otherwise, changes to a list could possibly cause a thread to incorrectly traverse the list or cause an access violation (a GP fault).</span></span> <span data-ttu-id="58cb9-111">Par exemple, si une application parcourt la liste des threads pendant que d’autres threads sont créés ou arrêtés, les informations que l’application utilise pour traverser la liste des threads peuvent devenir obsolètes et provoquer une erreur pour l’application qui parcourt la liste.</span><span class="sxs-lookup"><span data-stu-id="58cb9-111">For example, if an application traverses the thread list while other threads are created or terminated, information that the application is using to traverse the thread list might become outdated and could cause an error for the application traversing the list.</span></span>

<span data-ttu-id="58cb9-112">Pour prendre un instantané de la mémoire système, utilisez la fonction [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) .</span><span class="sxs-lookup"><span data-stu-id="58cb9-112">To take a snapshot of the system memory, use the [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) function.</span></span> <span data-ttu-id="58cb9-113">Vous pouvez contrôler le contenu d’un instantané en spécifiant une ou plusieurs des valeurs suivantes lors de l’appel de cette fonction :</span><span class="sxs-lookup"><span data-stu-id="58cb9-113">You can control the content of a snapshot by specifying one or more of the following values when calling this function:</span></span>

-   <span data-ttu-id="58cb9-114">**TH32CS \_ SNAPHEAPLIST**</span><span class="sxs-lookup"><span data-stu-id="58cb9-114">**TH32CS\_SNAPHEAPLIST**</span></span>
-   <span data-ttu-id="58cb9-115">**TH32CS \_ SNAPMODULE**</span><span class="sxs-lookup"><span data-stu-id="58cb9-115">**TH32CS\_SNAPMODULE**</span></span>
-   <span data-ttu-id="58cb9-116">**TH32CS \_ SNAPPROCESS**</span><span class="sxs-lookup"><span data-stu-id="58cb9-116">**TH32CS\_SNAPPROCESS**</span></span>
-   <span data-ttu-id="58cb9-117">**TH32CS \_ SNAPTHREAD**</span><span class="sxs-lookup"><span data-stu-id="58cb9-117">**TH32CS\_SNAPTHREAD**</span></span>

<span data-ttu-id="58cb9-118">Les valeurs de **TH32CS \_ SNAPHEAPLIST** et **TH32CS \_ SNAPMODULE** sont spécifiques au processus.</span><span class="sxs-lookup"><span data-stu-id="58cb9-118">The **TH32CS\_SNAPHEAPLIST** and **TH32CS\_SNAPMODULE** values are process specific.</span></span> <span data-ttu-id="58cb9-119">Lorsque ces valeurs sont spécifiées, le segment de mémoire et les listes de modules du processus spécifié sont inclus dans l’instantané.</span><span class="sxs-lookup"><span data-stu-id="58cb9-119">When these values are specified, the heap and module lists of the specified process are included in the snapshot.</span></span> <span data-ttu-id="58cb9-120">Si vous spécifiez zéro comme identificateur de processus, le processus actuel est utilisé.</span><span class="sxs-lookup"><span data-stu-id="58cb9-120">If you specify zero as the process identifier, the current process is used.</span></span> <span data-ttu-id="58cb9-121">La valeur **TH32CS \_ SNAPTHREAD** crée toujours un instantané à l’ensemble du système même si un identificateur de processus est passé à [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot).</span><span class="sxs-lookup"><span data-stu-id="58cb9-121">The **TH32CS\_SNAPTHREAD** value always creates a system-wide snapshot even if a process identifier is passed to [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot).</span></span>

<span data-ttu-id="58cb9-122">Pour énumérer l’état du segment de mémoire ou du module pour tous les processus, spécifiez la valeur **\_ SNAPALL TH32CS** et l’identificateur de processus du processus actuel.</span><span class="sxs-lookup"><span data-stu-id="58cb9-122">To enumerate the heap or module state for all processes, specify the **TH32CS\_SNAPALL** value and the process identifier of the current process.</span></span> <span data-ttu-id="58cb9-123">Ensuite, pour chaque processus supplémentaire de l’instantané, appelez à nouveau [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) , en spécifiant son identificateur de processus et la valeur **TH32CS \_ SNAPHEAPLIST** ou **TH32CS \_ SNAPMODULE** .</span><span class="sxs-lookup"><span data-stu-id="58cb9-123">Then, for each additional process in the snapshot, call [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) again, specifying its process identifier and the **TH32CS\_SNAPHEAPLIST** or **TH32CS\_SNAPMODULE** value.</span></span>

<span data-ttu-id="58cb9-124">Vous pouvez récupérer un code d’état d’erreur étendu pour [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) à l’aide de la fonction [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) .</span><span class="sxs-lookup"><span data-stu-id="58cb9-124">You can retrieve an extended error status code for [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) by using the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span>

<span data-ttu-id="58cb9-125">Lorsque votre processus se termine à l’aide d’un instantané, détruisez-le à l’aide de la fonction [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) .</span><span class="sxs-lookup"><span data-stu-id="58cb9-125">When your process finishes using a snapshot, destroy it using the [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) function.</span></span> <span data-ttu-id="58cb9-126">Si vous ne détruisez pas un instantané, le processus perd de la mémoire jusqu’à ce qu’il se termine, auquel cas le système récupère la mémoire.</span><span class="sxs-lookup"><span data-stu-id="58cb9-126">If you do not destroy a snapshot, the process will leak memory until the it exits, at which time the system reclaims the memory.</span></span>

> [!Note]  
> <span data-ttu-id="58cb9-127">Le descripteur d’instantané agit comme un descripteur de fichier et est soumis aux mêmes règles concernant les processus et les threads dans lesquels il peut être utilisé.</span><span class="sxs-lookup"><span data-stu-id="58cb9-127">The snapshot handle acts like a file handle and is subject to the same rules regarding the processes and threads in which it can be used.</span></span> <span data-ttu-id="58cb9-128">Pour spécifier que le handle peut être hérité, créez l’instantané à l’aide de la valeur **\_ inherit TH32CS** .</span><span class="sxs-lookup"><span data-stu-id="58cb9-128">To specify that the handle is inheritable, create the snapshot using the **TH32CS\_INHERIT** value.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="58cb9-129">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="58cb9-129">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="58cb9-130">Réalisation d’un instantané et affichage des processus</span><span class="sxs-lookup"><span data-stu-id="58cb9-130">Taking a Snapshot and Viewing Processes</span></span>](taking-a-snapshot-and-viewing-processes.md)
</dt> </dl>

 

 