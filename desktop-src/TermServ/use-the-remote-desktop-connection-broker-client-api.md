---
title: Utilisation de l’API cliente Connexion Bureau à distance Broker
description: L’API cliente Connexion Bureau à distance Broker permet aux fournisseurs de protocoles tiers de tirer parti du répartiteur de connexions pour accélérer la gestion des connexions qui utilisent leur protocole pour se connecter à des ordinateurs virtuels ou à des serveurs Bureau à distance dans une batterie de serveurs.
ms.assetid: 05C2D6CA-C9C5-4783-B196-6A02918046EF
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c931245870cfb72aed54e5aaff24e12d03ddf9e7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104316187"
---
# <a name="how-to-use-the-remote-desktop-connection-broker-client-api"></a><span data-ttu-id="51109-103">Utilisation de l’API cliente Connexion Bureau à distance Broker</span><span class="sxs-lookup"><span data-stu-id="51109-103">How to use the Remote Desktop Connection Broker client API</span></span>

<span data-ttu-id="51109-104">L’API cliente Connexion Bureau à distance Broker permet aux fournisseurs de protocoles tiers de tirer parti du répartiteur de connexions pour accélérer la gestion des connexions qui utilisent leur protocole pour se connecter à des ordinateurs virtuels ou à des serveurs Bureau à distance dans une batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="51109-104">The Remote Desktop Connection Broker client API allows third party protocol vendors to leverage the Connection Broker to expedite the handling of connections that use their protocol to connect to virtual machines or Remote Desktop servers in a farm.</span></span>

## <a name="instructions"></a><span data-ttu-id="51109-105">Instructions</span><span class="sxs-lookup"><span data-stu-id="51109-105">Instructions</span></span>

### <a name="step-1-obtain-the-iconnectionbrokerclient-interface"></a><span data-ttu-id="51109-106">Étape 1 : obtenir l’interface IConnectionBrokerClient</span><span class="sxs-lookup"><span data-stu-id="51109-106">Step 1: Obtain the IConnectionBrokerClient interface</span></span>

<span data-ttu-id="51109-107">Lorsque votre application ou fournisseur de protocole est initialisé, procédez comme suit.</span><span class="sxs-lookup"><span data-stu-id="51109-107">When your application or protocol provider is initialized, perform the following steps.</span></span>

1.  <span data-ttu-id="51109-108">Appelez la fonction [**CBCreateClientInstance**](cbcreateclientinstance.md) pour obtenir l’interface [**IConnectionBrokerClient**](iconnectionbrokerclient.md) .</span><span class="sxs-lookup"><span data-stu-id="51109-108">Call the [**CBCreateClientInstance**](cbcreateclientinstance.md) function to obtain the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface.</span></span>
2.  <span data-ttu-id="51109-109">Conservez l’interface [**IConnectionBrokerClient**](iconnectionbrokerclient.md) tant que vous en avez besoin.</span><span class="sxs-lookup"><span data-stu-id="51109-109">Keep the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface as long as you need it.</span></span>
3.  <span data-ttu-id="51109-110">Lorsque l’interface [**IConnectionBrokerClient**](iconnectionbrokerclient.md) n’est plus nécessaire, appelez la méthode [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) .</span><span class="sxs-lookup"><span data-stu-id="51109-110">When the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface is no longer needed, call the [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) method.</span></span>

### <a name="step-2-request-the-target-information"></a><span data-ttu-id="51109-111">Étape 2 : demander les informations sur la cible</span><span class="sxs-lookup"><span data-stu-id="51109-111">Step 2: Request the target information</span></span>

<span data-ttu-id="51109-112">Lorsque votre fournisseur de protocole reçoit une demande de connexion entrante, procédez comme suit pour appeler la méthode [**IConnectionBrokerClient :: GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="51109-112">When your protocol provider receives an incoming connection request, perform the following steps to call the [**IConnectionBrokerClient::GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method.</span></span> <span data-ttu-id="51109-113">Cette méthode obtient, à partir du répartiteur de connexions, le serveur approprié vers lequel rediriger la connexion.</span><span class="sxs-lookup"><span data-stu-id="51109-113">This method obtains, from the Connection Broker, the appropriate server to redirect the connection to.</span></span>

1.  <span data-ttu-id="51109-114">Créez un événement qui peut être signalé à l’aide de [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), ou d’une fonction similaire, à utiliser pour le paramètre *hStatusEvent* .</span><span class="sxs-lookup"><span data-stu-id="51109-114">Create an event that can be signaled using the [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), or similar function, to use for the *hStatusEvent* parameter.</span></span>
2.  <span data-ttu-id="51109-115">Allouez de la mémoire pour les paramètres *pTargetInfo* et *pResult* .</span><span class="sxs-lookup"><span data-stu-id="51109-115">Allocate memory for the *pTargetInfo* and *pResult* parameters.</span></span> <span data-ttu-id="51109-116">Ces blocs de mémoire doivent rester en place jusqu’à ce que l’intégralité de la séquence soit terminée.</span><span class="sxs-lookup"><span data-stu-id="51109-116">These memory blocks must remain in place until after this entire sequence is complete.</span></span>
3.  <span data-ttu-id="51109-117">Renseignez une structure d' [**\_ \_ informations de connexion CB**](cb-connection-info.md) qui contient toutes les informations relatives à la connexion entrante.</span><span class="sxs-lookup"><span data-stu-id="51109-117">Fill out a [**CB\_CONNECTION\_INFO**](cb-connection-info.md) structure that contains all of the information about the incoming connection.</span></span>
4.  <span data-ttu-id="51109-118">Appelez la méthode [**GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) , en passant tous les paramètres requis.</span><span class="sxs-lookup"><span data-stu-id="51109-118">Call the [**GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method, passing all of the required parameters.</span></span> <span data-ttu-id="51109-119">Il s’agit d’une méthode asynchrone qui retourne une instance de l’interface [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="51109-119">This is an asynchronous method that will return an instance of the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
5.  <span data-ttu-id="51109-120">Attendez que l’événement *hStatusEvent* soit défini.</span><span class="sxs-lookup"><span data-stu-id="51109-120">Wait for the *hStatusEvent* event to become set.</span></span>
6.  <span data-ttu-id="51109-121">Chaque fois que l’événement *hStatusEvent* est défini, appelez la méthode [**IConnectionBrokerRequest :: CheckStatus**](iconnectionbrokerrequest-checkstatus.md) pour déterminer l’état de la demande.</span><span class="sxs-lookup"><span data-stu-id="51109-121">Whenever the *hStatusEvent* event is set, call the [**IConnectionBrokerRequest::CheckStatus**](iconnectionbrokerrequest-checkstatus.md) method to determine the status of the request.</span></span>
7.  <span data-ttu-id="51109-122">Lorsque [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) retourne **la \_ demande d’État CB \_ \_ terminée**, les paramètres *pTargetInfo* et *pResult* contiennent leurs informations.</span><span class="sxs-lookup"><span data-stu-id="51109-122">When [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) returns **CB\_STATUS\_REQUEST\_COMPLETED**, the *pTargetInfo* and *pResult* parameters will contain their information.</span></span> <span data-ttu-id="51109-123">Vous pouvez quitter la boucle d’attente, car le paramètre *hStatusEvent* ne sera plus utilisé.</span><span class="sxs-lookup"><span data-stu-id="51109-123">You can break out of the wait loop because the *hStatusEvent* parameter will no longer be used.</span></span>
8.  <span data-ttu-id="51109-124">Utilisez les informations de la structure d’informations de la [**\_ cible \_ CB**](cb-target-info.md) représentée par le paramètre *pTargetInfo* pour déterminer où rediriger la connexion entrante.</span><span class="sxs-lookup"><span data-stu-id="51109-124">Use the information in the [**CB\_TARGET\_INFO**](cb-target-info.md) structure represented by the *pTargetInfo* parameter to determine where to redirect the incoming connection to.</span></span>
9.  <span data-ttu-id="51109-125">Libérez l’interface [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="51109-125">Release the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
10. <span data-ttu-id="51109-126">Fermez le handle d’événement *hStatusEvent* ou réutilisez-le pour les demandes de connexion suivantes.</span><span class="sxs-lookup"><span data-stu-id="51109-126">Close the *hStatusEvent* event handle, or you can reuse it for subsequent connection requests.</span></span>

 

 