---
title: DLL du client du canal virtuel
description: Le client d’une application de canaux virtuels est une DLL qui est chargée pendant l’initialisation Services Bureau à distance sur l’ordinateur client. La DLL doit être inscrite sur l’ordinateur client.
ms.assetid: fca0505c-c4a9-4230-aeaa-ff3dfa62f581
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cfd7ffccda8b1da7dfc3920b0a47a12e97840e0a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104029271"
---
# <a name="virtual-channel-client-dll"></a><span data-ttu-id="f5c51-104">DLL du client du canal virtuel</span><span class="sxs-lookup"><span data-stu-id="f5c51-104">Virtual Channel Client DLL</span></span>

<span data-ttu-id="f5c51-105">Le client d’une application de canaux virtuels est une DLL qui est chargée pendant l’initialisation Services Bureau à distance sur l’ordinateur client.</span><span class="sxs-lookup"><span data-stu-id="f5c51-105">The client of a virtual channels application is a DLL that is loaded during the Remote Desktop Services initialization on the client computer.</span></span> <span data-ttu-id="f5c51-106">La DLL doit être inscrite sur l’ordinateur client.</span><span class="sxs-lookup"><span data-stu-id="f5c51-106">The DLL must be registered on the client computer.</span></span> <span data-ttu-id="f5c51-107">Pour plus d’informations, consultez [inscription du client du canal virtuel](virtual-channel-client-registration.md).</span><span class="sxs-lookup"><span data-stu-id="f5c51-107">For more information, see [Virtual Channel Client Registration](virtual-channel-client-registration.md).</span></span>

<span data-ttu-id="f5c51-108">La DLL cliente doit exporter une fonction [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) , qui services Bureau à distance des appels pendant l’initialisation.</span><span class="sxs-lookup"><span data-stu-id="f5c51-108">The client DLL must export a [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) function, which Remote Desktop Services calls during initialization.</span></span> <span data-ttu-id="f5c51-109">Le point d’entrée **VirtualChannelEntry** reçoit un pointeur vers une structure de [**points d' \_ entrée \_ de canal**](/windows/win32/api/cchannel/ns-cchannel-channel_entry_points) .</span><span class="sxs-lookup"><span data-stu-id="f5c51-109">The **VirtualChannelEntry** entry point receives a pointer to a [**CHANNEL\_ENTRY\_POINTS**](/windows/win32/api/cchannel/ns-cchannel-channel_entry_points) structure.</span></span> <span data-ttu-id="f5c51-110">Cette structure contient des pointeurs vers les fonctions que la DLL client appelle pour accéder aux canaux virtuels.</span><span class="sxs-lookup"><span data-stu-id="f5c51-110">This structure contains pointers to the functions that the client DLL calls to access virtual channels.</span></span>



| <span data-ttu-id="f5c51-111">Fonction</span><span class="sxs-lookup"><span data-stu-id="f5c51-111">Function</span></span>                                                      | <span data-ttu-id="f5c51-112">Description</span><span class="sxs-lookup"><span data-stu-id="f5c51-112">Description</span></span>                                                                                                                                                                                                                                                                           |
|---------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="f5c51-113">**VirtualChannelInit**</span><span class="sxs-lookup"><span data-stu-id="f5c51-113">**VirtualChannelInit**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit)<br/>   | <span data-ttu-id="f5c51-114">Inscrit les noms des canaux virtuels à utiliser par le client et fournit une fonction de rappel [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) par le biais de laquelle services Bureau à distance notifie au client les événements qui affectent la connexion cliente.</span><span class="sxs-lookup"><span data-stu-id="f5c51-114">Registers the names of the virtual channels to be used by the client and provides a [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) callback function through which Remote Desktop Services notifies the client about events that affect the client connection.</span></span><br/> |
| [<span data-ttu-id="f5c51-115">**VirtualChannelOpen**</span><span class="sxs-lookup"><span data-stu-id="f5c51-115">**VirtualChannelOpen**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen)<br/>   | <span data-ttu-id="f5c51-116">Ouvre l’extrémité client d’un canal virtuel spécifié et fournit une fonction de rappel [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) par le biais de laquelle services Bureau à distance notifie au client les événements qui affectent le canal virtuel.</span><span class="sxs-lookup"><span data-stu-id="f5c51-116">Opens the client end of a specified virtual channel and provides a [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) callback function through which Remote Desktop Services notifies the client about events that affect the virtual channel.</span></span><br/>                    |
| [<span data-ttu-id="f5c51-117">**VirtualChannelWrite**</span><span class="sxs-lookup"><span data-stu-id="f5c51-117">**VirtualChannelWrite**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite)<br/> | <span data-ttu-id="f5c51-118">Écrit des données dans un canal virtuel.</span><span class="sxs-lookup"><span data-stu-id="f5c51-118">Writes data to a virtual channel.</span></span> <span data-ttu-id="f5c51-119">Services Bureau à distance envoie ces données à l’extrémité serveur du canal virtuel.</span><span class="sxs-lookup"><span data-stu-id="f5c51-119">Remote Desktop Services sends this data to the server end of the virtual channel.</span></span> <span data-ttu-id="f5c51-120">Le serveur end appelle la fonction [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) pour lire les données.</span><span class="sxs-lookup"><span data-stu-id="f5c51-120">The server end calls the [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) function to read the data.</span></span><br/>                                             |
| [<span data-ttu-id="f5c51-121">**VirtualChannelClose**</span><span class="sxs-lookup"><span data-stu-id="f5c51-121">**VirtualChannelClose**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose)<br/> | <span data-ttu-id="f5c51-122">Ferme un canal virtuel.</span><span class="sxs-lookup"><span data-stu-id="f5c51-122">Closes a virtual channel.</span></span><br/>                                                                                                                                                                                                                                                  |



 

<span data-ttu-id="f5c51-123">La fonction [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) de votre dll doit appeler la fonction [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) pour initialiser l’accès aux canaux virtuels.</span><span class="sxs-lookup"><span data-stu-id="f5c51-123">Your DLL's [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) function must call the [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) function to initialize access to virtual channels.</span></span> <span data-ttu-id="f5c51-124">Quand vous appelez **VirtualChannelInit**, vous devez passer un pointeur vers la fonction de rappel [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) .</span><span class="sxs-lookup"><span data-stu-id="f5c51-124">When you call **VirtualChannelInit**, you must pass a pointer to the [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) callback function.</span></span> <span data-ttu-id="f5c51-125">Services Bureau à distance appelle cette fonction de rappel lorsque l’initialisation est terminée et de nouveau quand une connexion a été établie avec un serveur d’hôte de session Bureau à distance (hôte de session Bureau à distance).</span><span class="sxs-lookup"><span data-stu-id="f5c51-125">Remote Desktop Services calls this callback function when initialization is complete and again when a connection has been established with a Remote Desktop Session Host (RD Session Host) server.</span></span>

<span data-ttu-id="f5c51-126">Une fois la connexion établie, vous pouvez appeler la fonction [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) pour ouvrir les canaux virtuels enregistrés par l’appel [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) .</span><span class="sxs-lookup"><span data-stu-id="f5c51-126">After the connection is established, you can call the [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) function to open the virtual channels registered by the [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) call.</span></span> <span data-ttu-id="f5c51-127">L’appel **VirtualChannelOpen** spécifie un pointeur vers votre fonction de rappel [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) .</span><span class="sxs-lookup"><span data-stu-id="f5c51-127">The **VirtualChannelOpen** call specifies a pointer to your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) callback function.</span></span>

<span data-ttu-id="f5c51-128">Après le retour de l’appel [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) , vous pouvez appeler la fonction [**VirtualChannelWrite**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite) pour écrire dans le canal virtuel.</span><span class="sxs-lookup"><span data-stu-id="f5c51-128">After the [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) call returns, you can call the [**VirtualChannelWrite**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite) function to write to the virtual channel.</span></span> <span data-ttu-id="f5c51-129">L’opération d’écriture étant asynchrone, vous ne devez pas libérer ou réutiliser la mémoire tampon transmise à **VirtualChannelWrite** tant que services Bureau à distance n’a pas appelé votre fonction [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) pour indiquer que l’opération d’écriture est terminée.</span><span class="sxs-lookup"><span data-stu-id="f5c51-129">The write operation is asynchronous, so you must not free or reuse the buffer passed to **VirtualChannelWrite** until Remote Desktop Services calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function to indicate that the write operation has been completed.</span></span> <span data-ttu-id="f5c51-130">Quand vous appelez **VirtualChannelWrite**, vous pouvez passer un élément de données utilisateur qui identifie l’opération d’écriture.</span><span class="sxs-lookup"><span data-stu-id="f5c51-130">When you call **VirtualChannelWrite**, you can pass a piece of user data that identifies the write operation.</span></span> <span data-ttu-id="f5c51-131">Services Bureau à distance transmet à nouveau ces données utilisateur lorsqu’il appelle **VirtualChannelOpenEvent** pour vous avertir que l’opération est terminée.</span><span class="sxs-lookup"><span data-stu-id="f5c51-131">Remote Desktop Services passes this user data back when it calls **VirtualChannelOpenEvent** to notify you that the operation has completed.</span></span> <span data-ttu-id="f5c51-132">À l’extrémité serveur du canal virtuel, le complément serveur appelle la fonction [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) pour lire les données.</span><span class="sxs-lookup"><span data-stu-id="f5c51-132">At the server end of the virtual channel, the server add-in calls the [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) function to read the data.</span></span>

<span data-ttu-id="f5c51-133">Services Bureau à distance appelle également votre fonction [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) lorsque des données sont écrites sur le canal virtuel par le module de serveur.</span><span class="sxs-lookup"><span data-stu-id="f5c51-133">Remote Desktop Services also calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function when data is written to the virtual channel by the server module.</span></span> <span data-ttu-id="f5c51-134">Le module serveur appelle la fonction [**WTSVirtualChannelWrite**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelwrite) pour écrire des données à l’extrémité serveur du canal virtuel.</span><span class="sxs-lookup"><span data-stu-id="f5c51-134">The server module calls the [**WTSVirtualChannelWrite**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelwrite) function to write data to the server end of the virtual channel.</span></span>

<span data-ttu-id="f5c51-135">Les modules client et serveur peuvent écrire des blocs de données de n’importe quelle taille sur le canal virtuel.</span><span class="sxs-lookup"><span data-stu-id="f5c51-135">The client and server modules can write data blocks of any size to the virtual channel.</span></span> <span data-ttu-id="f5c51-136">Toutefois, avant d’envoyer les données, Services Bureau à distance segmente les données en segments d' \_ octets de longueur de segment de canal \_ .</span><span class="sxs-lookup"><span data-stu-id="f5c51-136">Before sending the data, however, Remote Desktop Services segments the data into chunks of CHANNEL\_CHUNK\_LENGTH bytes.</span></span> <span data-ttu-id="f5c51-137">Services Bureau à distance appelle votre fonction [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) une fois pour chaque segment de données, plutôt que de recréer les données dans un bloc de la taille d’origine.</span><span class="sxs-lookup"><span data-stu-id="f5c51-137">Remote Desktop Services calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function once for each chunk of data, rather than rebuilding the data into a block of the original size.</span></span> <span data-ttu-id="f5c51-138">Chaque appel à **VirtualChannelOpenEvent** indique la taille du segment, la taille totale écrite par le serveur et indique si les données constituent le début, le milieu ou la fin d’un bloc écrit par le serveur.</span><span class="sxs-lookup"><span data-stu-id="f5c51-138">Each call to **VirtualChannelOpenEvent** indicates the size of the chunk, the total size written by the server, and whether the data constitutes the beginning, middle, or end of a block written by the server.</span></span>

<span data-ttu-id="f5c51-139">Vous pouvez appeler la fonction [**VirtualChannelClose**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose) pour fermer un canal.</span><span class="sxs-lookup"><span data-stu-id="f5c51-139">You can call the [**VirtualChannelClose**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose) function to close a channel.</span></span> <span data-ttu-id="f5c51-140">Toutefois, il n’est pas nécessaire de l’appeler, car Services Bureau à distance ferme automatiquement tous les canaux lorsque le client se déconnecte du serveur.</span><span class="sxs-lookup"><span data-stu-id="f5c51-140">However, it is not necessary to call it because Remote Desktop Services closes all channels automatically when the client disconnects from the server.</span></span>

 

 





