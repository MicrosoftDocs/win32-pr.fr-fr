---
title: Instructions pour les applications
description: Les applications qui s’exécutent sur Windows Vista et Windows Server 2008 doivent respecter ces instructions pour s’assurer que le gestionnaire de redémarrage peut arrêter et redémarrer les applications si nécessaire pour installer les mises à jour.
ms.assetid: 97b1df63-65a9-47b4-891b-e4a754882b89
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ebace21e09956c68d34c90775c5ea646a8b2dd0
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103729628"
---
# <a name="guidelines-for-applications"></a><span data-ttu-id="2eafd-103">Instructions pour les applications</span><span class="sxs-lookup"><span data-stu-id="2eafd-103">Guidelines for Applications</span></span>

<span data-ttu-id="2eafd-104">Les applications qui s’exécutent sur Windows Vista et Windows Server 2008 doivent respecter ces instructions pour s’assurer que le gestionnaire de redémarrage peut arrêter et redémarrer les applications si nécessaire pour installer les mises à jour.</span><span class="sxs-lookup"><span data-stu-id="2eafd-104">Applications running on Windows Vista and Windows Server 2008 should adhere to these guidelines to ensure that the Restart Manager can shut down and restart applications if necessary to install updates.</span></span> <span data-ttu-id="2eafd-105">Les services peuvent utiliser les instructions décrites dans [instructions pour les services](guidelines-for-services.md).</span><span class="sxs-lookup"><span data-stu-id="2eafd-105">Services can use the guidelines that are described in [Guidelines for Services](guidelines-for-services.md).</span></span>

-   <span data-ttu-id="2eafd-106">Le gestionnaire de redémarrage interroge les applications GUI en envoyant une notification [**WM \_ QUERYENDSESSION**](/windows/desktop/Shutdown/wm-queryendsession) dont le paramètre *lParam* est défini sur **ENDSESSION \_ CLOSEAPP** (0x1).</span><span class="sxs-lookup"><span data-stu-id="2eafd-106">The Restart Manager queries GUI applications for shutdown by sending a [**WM\_QUERYENDSESSION**](/windows/desktop/Shutdown/wm-queryendsession) notification that has the *lParam* parameter set to **ENDSESSION\_CLOSEAPP** (0x1).</span></span> <span data-ttu-id="2eafd-107">Les applications ne doivent pas s’arrêter lorsqu’elles reçoivent un message **WM \_ QUERYENDSESSION** , car une autre application n’est peut-être pas prête à être arrêtée.</span><span class="sxs-lookup"><span data-stu-id="2eafd-107">Applications should not shut down when they receive a **WM\_QUERYENDSESSION** message because another application may not be ready to shut down.</span></span> <span data-ttu-id="2eafd-108">Les applications GUI doivent écouter le message **WM \_ QUERYENDSESSION** et retourner la valeur **true** si l’arrêt et le redémarrage de l’application sont prêts.</span><span class="sxs-lookup"><span data-stu-id="2eafd-108">GUI applications should listen for the **WM\_QUERYENDSESSION** message and return a value of **TRUE** if the application is prepared to shut down and restart.</span></span> <span data-ttu-id="2eafd-109">Si aucune application ne retourne la valeur **false**, le gestionnaire de redémarrage envoie un message [**WM \_ ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) avec le paramètre *lParam* défini sur **ENDSESSION \_ CLOSEAPP** (0x1) et le paramètre *wParam* défini sur **true**.</span><span class="sxs-lookup"><span data-stu-id="2eafd-109">If no application returns a value of **FALSE**, the Restart Manager sends a [**WM\_ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) message with the *lParam* parameter set to **ENDSESSION\_CLOSEAPP** (0x1) and the *wparam* parameter set to **TRUE**.</span></span> <span data-ttu-id="2eafd-110">Les applications doivent s’arrêter uniquement lorsqu’elles reçoivent le message **WM \_ ENDSESSION** .</span><span class="sxs-lookup"><span data-stu-id="2eafd-110">Applications should shut down only when they receive the **WM\_ENDSESSION** message.</span></span> <span data-ttu-id="2eafd-111">Le gestionnaire de redémarrage envoie également un message [**WM \_ Close**](../winmsg/wm-close.md) pour les applications GUI qui ne s’arrêtent pas lors de la réception de **WM \_ ENDSESSION**.</span><span class="sxs-lookup"><span data-stu-id="2eafd-111">The Restart Manager also sends a [**WM\_CLOSE**](../winmsg/wm-close.md) message for GUI applications that do not shut down on receiving **WM\_ENDSESSION**.</span></span> <span data-ttu-id="2eafd-112">Si une application GUI répond à un message **WM \_ QUERYENDSESSION** en retournant la valeur **false**, l’arrêt est annulé.</span><span class="sxs-lookup"><span data-stu-id="2eafd-112">If any GUI application responds to a **WM\_QUERYENDSESSION** message by returning a value of **FALSE**, the shutdown is canceled.</span></span> <span data-ttu-id="2eafd-113">Toutefois, si l’arrêt est forcé, l’application est arrêtée, quel que soit le cas.</span><span class="sxs-lookup"><span data-stu-id="2eafd-113">However, if the shutdown is forced, the application is terminated regardless.</span></span>
-   <span data-ttu-id="2eafd-114">Quand une application GUI reçoit un message [**WM \_ ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) , l’application doit se préparer à s’arrêter dans le délai imparti.</span><span class="sxs-lookup"><span data-stu-id="2eafd-114">When a GUI application receives a [**WM\_ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) message, the application should prepare itself to shut down within the specified timeout period.</span></span> <span data-ttu-id="2eafd-115">Au minimum, les applications doivent se préparer en enregistrant les données utilisateur et les informations d’État nécessaires après un redémarrage.</span><span class="sxs-lookup"><span data-stu-id="2eafd-115">At a minimum, applications should prepare by saving any user data and state information that is needed after a restart.</span></span> <span data-ttu-id="2eafd-116">Il est recommandé que les applications enregistrent régulièrement les données et l’état utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2eafd-116">It is recommended that applications periodically save the user data and state.</span></span>
-   <span data-ttu-id="2eafd-117">Le gestionnaire de redémarrage envoie une notification d' **\_ \_ événement Ctrl C** aux applications console qui doivent être arrêtées et redémarrées.</span><span class="sxs-lookup"><span data-stu-id="2eafd-117">The Restart Manager sends a **CTRL\_C\_EVENT** notification to console applications that must be shut down and restarted.</span></span> <span data-ttu-id="2eafd-118">Lorsqu’une application console reçoit une notification d' **\_ \_ événement Ctrl C** , l’application doit prendre les mesures nécessaires pour préparer un arrêt dans le délai imparti.</span><span class="sxs-lookup"><span data-stu-id="2eafd-118">When a console application receives a **CTRL\_C\_EVENT** notification, the application should take actions necessary to prepare for a shutdown within the specified timeout period.</span></span> <span data-ttu-id="2eafd-119">Au minimum, les applications de console doivent définir une fonction [*HandlerRoutine*](/windows/console/handlerroutine) pour gérer la notification d' **\_ \_ événement Ctrl C** et doivent enregistrer toutes les données utilisateur et les informations d’État qui seront nécessaires après un redémarrage.</span><span class="sxs-lookup"><span data-stu-id="2eafd-119">At a minimum, console applications should define a [*HandlerRoutine*](/windows/console/handlerroutine) function to handle the **CTRL\_C\_EVENT** notification and should save any user data and state information that is going to be needed after a restart.</span></span> <span data-ttu-id="2eafd-120">Il est recommandé que les applications enregistrent régulièrement les données et l’état utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2eafd-120">It is recommended that applications periodically save the user data and state.</span></span>
-   <span data-ttu-id="2eafd-121">Si des applications ne s’arrêtent pas en réponse aux messages d’arrêt, les programmes d’installation peuvent utiliser l’option **RmForceShutdown** de la fonction [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) pour forcer l’arrêt des applications.</span><span class="sxs-lookup"><span data-stu-id="2eafd-121">If any applications do not shut down in response to the shutdown messages, installers can use the **RmForceShutdown** option of the [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) function to force the applications to shut down.</span></span> <span data-ttu-id="2eafd-122">Quand le programme d’installation spécifie un arrêt forcé, le gestionnaire de redémarrage tente d’arrêter les applications correctement en envoyant les messages d’arrêt, mais les force à s’arrêter en cas d’échec.</span><span class="sxs-lookup"><span data-stu-id="2eafd-122">When the installer specifies a forced shutdown, Restart Manager attempts to shut down the applications cleanly by sending the shutdown messages, but will force them shut if this fails.</span></span> <span data-ttu-id="2eafd-123">Les applications GUI et les applications de console peuvent être forcées à s’arrêter pour permettre l’installation d’une mise à jour de sécurité critique.</span><span class="sxs-lookup"><span data-stu-id="2eafd-123">GUI applications and console applications can be forced to shut down to enable the installation of a critical security update.</span></span> <span data-ttu-id="2eafd-124">Étant donné que cela peut entraîner une perte de données, les applications doivent gérer les messages d’arrêt et s’arrêter correctement quand cela est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="2eafd-124">Because this can result in data loss, applications should handle the shutdown messages and shut down cleanly when required.</span></span>
-   <span data-ttu-id="2eafd-125">Les applications doivent s’inscrire à un redémarrage à l’aide de la fonction [**RegisterApplicationRestart**](/windows/desktop/api/winbase/nf-winbase-registerapplicationrestart) .</span><span class="sxs-lookup"><span data-stu-id="2eafd-125">Applications should register for a restart by using the [**RegisterApplicationRestart**](/windows/desktop/api/winbase/nf-winbase-registerapplicationrestart) function.</span></span> <span data-ttu-id="2eafd-126">Le gestionnaire de redémarrage peut redémarrer uniquement les applications qui ont été inscrites pour le redémarrage.</span><span class="sxs-lookup"><span data-stu-id="2eafd-126">Restart Manager can only restart applications that have been registered for restart.</span></span> <span data-ttu-id="2eafd-127">Il s’agit de la seule façon dont le gestionnaire de redémarrage peut déterminer la commande de ligne de commande à utiliser lors du redémarrage de l’application.</span><span class="sxs-lookup"><span data-stu-id="2eafd-127">This is the only way that the Restart Manager can determine the command-line command to use when restarting the application.</span></span> <span data-ttu-id="2eafd-128">Si l’application doit être rouverte avec un état enregistré ou des données, ces informations doivent être incluses dans la commande de ligne de commande inscrite pour l’application.</span><span class="sxs-lookup"><span data-stu-id="2eafd-128">If the application must reopen with some saved state or data, that information must be included in the command-line command that is registered for the application.</span></span>
    > [!Note]  
    > <span data-ttu-id="2eafd-129">Si l’application redémarrée doit s’exécuter dans le même répertoire que celui dans lequel elle a été exécutée avant d’être arrêtée, l’application doit enregistrer les informations de répertoire, puis passer au répertoire après le redémarrage.</span><span class="sxs-lookup"><span data-stu-id="2eafd-129">If the restarted application must run in the same directory it ran in before being shut down, the application must save the directory information and then change to the directory after restarting.</span></span>

     

    > [!Note]  
    > <span data-ttu-id="2eafd-130">La fonction [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) ne redémarre pas les applications qui ne s’exécutent pas en tant qu’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="2eafd-130">The [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) function does not restart applications that do not run as the currently-logged on user.</span></span> <span data-ttu-id="2eafd-131">Par exemple, la fonction **RmRestart** ne redémarre pas les applications démarrées avec la commande **exécuter en tant** que qui ne s’exécutent pas en tant qu’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="2eafd-131">For example, the **RmRestart** function does not restart applications started with the **Run As** command that do not run as the currently-logged on user.</span></span> <span data-ttu-id="2eafd-132">Ces applications doivent être redémarrées manuellement.</span><span class="sxs-lookup"><span data-stu-id="2eafd-132">These applications must be manually restarted.</span></span>

     

-   <span data-ttu-id="2eafd-133">Lorsque le gestionnaire de redémarrage détermine qu’un redémarrage du système est nécessaire pour installer une mise à jour, il n’arrête pas les applications et les services.</span><span class="sxs-lookup"><span data-stu-id="2eafd-133">When Restart Manager determines that a system restart is required to install an update, it does not shut down any applications and services.</span></span> <span data-ttu-id="2eafd-134">Au lieu de cela, il permet au programme d’installation de décider quand planifier un redémarrage du système et installer la mise à jour.</span><span class="sxs-lookup"><span data-stu-id="2eafd-134">Instead, it leaves this to the installer to decide when to schedule a system restart and install the update.</span></span> <span data-ttu-id="2eafd-135">Les programmes d’installation peuvent réduire l’interruption aux utilisateurs provoqués par des mises à jour nécessitant un redémarrage du système à l’aide de la fonction [**ExitWindowsEx**](/windows/desktop/api/winuser/nf-winuser-exitwindowsex) avec l’indicateur **EWX \_ RESTARTAPPS** ou la fonction [**InitiateShutdown**](/windows/desktop/api/winreg/nf-winreg-initiateshutdowna) avec l’indicateur **Shutdown \_ RESTARTAPPS** .</span><span class="sxs-lookup"><span data-stu-id="2eafd-135">Installers can reduce the disruption to users caused by updates that require a system restart by using the [**ExitWindowsEx**](/windows/desktop/api/winuser/nf-winuser-exitwindowsex) function with the **EWX\_RESTARTAPPS** flag or the [**InitiateShutdown**](/windows/desktop/api/winreg/nf-winreg-initiateshutdowna) function with the **SHUTDOWN\_RESTARTAPPS** flag.</span></span> <span data-ttu-id="2eafd-136">L’utilisation de ces indicateurs permet de s’assurer que les applications inscrites pour le redémarrage sont redémarrées après un redémarrage du système, ce qui réduit l’impact sur l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2eafd-136">Using these flags ensures that applications registered for restart are restarted after a system reboot, which minimizes the impact on the user.</span></span>

 

 