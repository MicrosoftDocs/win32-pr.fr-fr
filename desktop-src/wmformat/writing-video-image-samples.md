---
title: Écriture d’exemples d’images vidéo
description: Écriture d’exemples d’images vidéo
ms.assetid: 1d375186-230a-4a18-a995-b331c72a76e7
keywords:
- ASF (Advanced Systems Format), écriture d’exemples d’images vidéo
- ASF (format des systèmes avancés), écriture d’exemples d’images vidéo
- images vidéo, exemples d’écriture
- flux, écriture d’exemples d’images vidéo
- codecs, écriture d’exemples d’images vidéo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0fbac644d7938477ba3d2e8b21ebb6e631a47708
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/19/2020
ms.locfileid: "104314251"
---
# <a name="writing-video-image-samples"></a><span data-ttu-id="1a942-108">Écriture d’exemples d’images vidéo</span><span class="sxs-lookup"><span data-stu-id="1a942-108">Writing Video Image Samples</span></span>

<span data-ttu-id="1a942-109">Un flux d’image vidéo est une vidéo qui contient une série d’images fixes.</span><span class="sxs-lookup"><span data-stu-id="1a942-109">A Video Image stream is a video that contains a series of still images.</span></span> <span data-ttu-id="1a942-110">Les images peuvent se déplacer dans le frame, et chaque image peut être fusionnée dans la suivante.</span><span class="sxs-lookup"><span data-stu-id="1a942-110">The images can move within the frame, and each image can blend into the next.</span></span> <span data-ttu-id="1a942-111">Les flux d’images vidéo sont encodés à l’aide du codec Windows Media Video 9 image v2.</span><span class="sxs-lookup"><span data-stu-id="1a942-111">Video Image streams are encoded using the Windows Media Video 9 Image v2 codec.</span></span> <span data-ttu-id="1a942-112">La vidéo de sortie est similaire à celle créée par le codec Windows Media Video 9.</span><span class="sxs-lookup"><span data-stu-id="1a942-112">The output video is similar to that created by the Windows Media Video 9 codec.</span></span>

<span data-ttu-id="1a942-113">Pour créer un profil contenant un flux d’image vidéo, commencez par énumérer les codecs vidéo comme décrit dans [obtention d’informations de configuration du flux à partir de codecs](getting-stream-configuration-information-from-codecs.md).</span><span class="sxs-lookup"><span data-stu-id="1a942-113">To create a profile that contains a Video Image stream, start by enumerating the video codecs as described in [Getting Stream Configuration Information from Codecs](getting-stream-configuration-information-from-codecs.md).</span></span> <span data-ttu-id="1a942-114">Recherchez le codec qui prend en charge le \_ sous-type WMMEDIASUBTYPE WVP2.</span><span class="sxs-lookup"><span data-stu-id="1a942-114">Search for the codec that supports the WMMEDIASUBTYPE\_WVP2 subtype.</span></span>

<span data-ttu-id="1a942-115">Après avoir défini le profil sur l’objet Writer, appelez [**IWMWriter :: GetInputProps**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) pour obtenir les propriétés de média pour le flux d’entrée d’image vidéo.</span><span class="sxs-lookup"><span data-stu-id="1a942-115">After you set the profile on the writer object, call [**IWMWriter::GetInputProps**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) to get the media properties for the Video Image input stream.</span></span> <span data-ttu-id="1a942-116">Récupérez le type de média à partir de l’objet de propriétés de média en appelant [**IWMMediaProps :: GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype), puis remplacez le sous-type par WMMEDIASUBTYPE \_ VIDEOIMAGE.</span><span class="sxs-lookup"><span data-stu-id="1a942-116">Get the media type from the media properties object, by calling [**IWMMediaProps::GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype), and change the subtype to WMMEDIASUBTYPE\_VIDEOIMAGE.</span></span> <span data-ttu-id="1a942-117">Vous devez définir la largeur et la hauteur de la vidéo sur les dimensions maximales requises pour englober les images que vous allez ajouter au flux.</span><span class="sxs-lookup"><span data-stu-id="1a942-117">You should set the video width and height to the maximum dimensions needed to encompass the images you will add to the stream.</span></span> <span data-ttu-id="1a942-118">Appelez ensuite [**IWMMediaProps :: SetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) avec le type d’entrée modifié.</span><span class="sxs-lookup"><span data-stu-id="1a942-118">Then call [**IWMMediaProps::SetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) with the modified input type.</span></span> <span data-ttu-id="1a942-119">Vous êtes maintenant prêt à commencer à envoyer des exemples à l’objet Writer.</span><span class="sxs-lookup"><span data-stu-id="1a942-119">Now you are ready to begin sending samples to the writer object.</span></span>

<span data-ttu-id="1a942-120">Chaque échantillon doit commencer par une **structure \_ VIDEOIMAGE \_ SAMPLE2 WMT** .</span><span class="sxs-lookup"><span data-stu-id="1a942-120">Each sample must begin with a **WMT\_VIDEOIMAGE\_SAMPLE2** structure.</span></span> <span data-ttu-id="1a942-121">En outre, les exemples peuvent contenir des images bitmap.</span><span class="sxs-lookup"><span data-stu-id="1a942-121">Additionally, samples may contain bitmap images.</span></span> <span data-ttu-id="1a942-122">Une image est attachée uniquement à un échantillon pour le premier frame dans lequel elle apparaît.</span><span class="sxs-lookup"><span data-stu-id="1a942-122">An image is only attached to a sample for the first frame in which it appears.</span></span> <span data-ttu-id="1a942-123">Tous les frames supplémentaires qui utilisent cette image n’ont besoin que d’informations dans la structure.</span><span class="sxs-lookup"><span data-stu-id="1a942-123">All additional frames using that image need only information in the structure.</span></span> <span data-ttu-id="1a942-124">Les bitmaps d’entrée doivent être au format RVB, 24 bits par pixel.</span><span class="sxs-lookup"><span data-stu-id="1a942-124">Input bitmaps must be formatted as RGB, 24 bits per pixel.</span></span>

<span data-ttu-id="1a942-125">Les fichiers bitmap stockent les données de l’image afin que les données de chaque ligne de l’image prennent un nombre d’octets divisible par quatre.</span><span class="sxs-lookup"><span data-stu-id="1a942-125">Bitmap files store the image data so that the data for each row of the image takes a number of bytes divisible by four.</span></span> <span data-ttu-id="1a942-126">(Il s’agit de la méthode STRIDE de l’image bitmap.) Cela force le début de chaque ligne de vidéo à une limite **DWORD** , ce qui rend la copie plus efficace.</span><span class="sxs-lookup"><span data-stu-id="1a942-126">(This is called the stride of the bitmap.) This forces the beginning of every row of video to a **DWORD** boundary, which makes copying more efficient.</span></span> <span data-ttu-id="1a942-127">Si les lignes de l’image ne sont pas divisibles par quatre, la ligne est remplie au multiple le plus élevé suivant de quatre octets.</span><span class="sxs-lookup"><span data-stu-id="1a942-127">If the image rows are not evenly divisible by four, the row is padded to the next highest multiple of four bytes.</span></span> <span data-ttu-id="1a942-128">Lorsque vous attachez des données image, vous devez supprimer tous les remplissages qui existent à la fin des données pour chaque ligne.</span><span class="sxs-lookup"><span data-stu-id="1a942-128">When you attach image data, you must remove any padding that exists at the end of the data for each row.</span></span>

<span data-ttu-id="1a942-129">Le codec Windows Media Video 9 image v2 gère jusqu’à deux images en mémoire à la fois.</span><span class="sxs-lookup"><span data-stu-id="1a942-129">The Windows Media Video 9 Image v2 codec maintains up to two images in memory at a time.</span></span> <span data-ttu-id="1a942-130">Ces images sont appelées l’image précédente et l’image actuelle.</span><span class="sxs-lookup"><span data-stu-id="1a942-130">These images are called the previous image and the current image.</span></span> <span data-ttu-id="1a942-131">Chaque image possède un ensemble de membres dans la **structure \_ VIDEOIMAGE WMT \_ SAMPLE2** , qui détermine la façon dont l’image est présentée dans le frame.</span><span class="sxs-lookup"><span data-stu-id="1a942-131">Each image has a set of members in the **WMT\_VIDEOIMAGE\_SAMPLE2** structure, which dictate how the image is presented in the frame.</span></span> <span data-ttu-id="1a942-132">Vous pouvez ajouter une image en définissant le membre dwControlFlags de **WMT \_ VIDEOIMAGE \_ SAMPLE2** sur WMT \_ VIDEOIMAGE exemple de \_ \_ Frame d’entrée \_ .</span><span class="sxs-lookup"><span data-stu-id="1a942-132">You can add an image by setting the dwControlFlags member of **WMT\_VIDEOIMAGE\_SAMPLE2** to WMT\_VIDEOIMAGE\_SAMPLE\_INPUT\_FRAME.</span></span> <span data-ttu-id="1a942-133">Lorsque vous transmettez une trame d’entrée au codec, cette image devient l’image actuelle.</span><span class="sxs-lookup"><span data-stu-id="1a942-133">When you pass an input frame to the codec, that image becomes the current image.</span></span> <span data-ttu-id="1a942-134">L’image qui était l’image actuelle dans l’exemple précédent devient généralement l’image précédente, et l’image qui était l’image précédente dans l’exemple précédent est ignorée.</span><span class="sxs-lookup"><span data-stu-id="1a942-134">The image that was the current image in the previous sample usually becomes the previous image, and the image that was the previous image in the previous sample is discarded.</span></span> <span data-ttu-id="1a942-135">Vous pouvez configurer le codec pour conserver l’ancienne image précédente en affectant la **valeur true** au membre **bKeepPrevImage** .</span><span class="sxs-lookup"><span data-stu-id="1a942-135">You can configure the codec to retain the old previous image by setting the **bKeepPrevImage** member to **TRUE**.</span></span> <span data-ttu-id="1a942-136">Dans ce cas, l’image qui était l’image actuelle dans l’exemple précédent est ignorée.</span><span class="sxs-lookup"><span data-stu-id="1a942-136">In that case, the image that was the current image in the previous sample is discarded.</span></span>

<span data-ttu-id="1a942-137">La composition de base d’une image vidéo est déterminée par deux facteurs pour chaque image : la région d’intérêt et le coefficient de fusion.</span><span class="sxs-lookup"><span data-stu-id="1a942-137">The basic composition of a Video Image frame is determined by two factors for each image: region of interest and blend coefficient.</span></span> <span data-ttu-id="1a942-138">La région d’intérêt d’une image est définie par un point d’origine, une largeur et une hauteur.</span><span class="sxs-lookup"><span data-stu-id="1a942-138">The region of interest for an image is defined by an origin point, width, and height.</span></span> <span data-ttu-id="1a942-139">La partie d’une image décrite par la région d’intérêt remplit le frame de sortie.</span><span class="sxs-lookup"><span data-stu-id="1a942-139">The part of an image described by the region of interest fills the output frame.</span></span> <span data-ttu-id="1a942-140">Si la taille de la zone d’intérêt est différente de celle de la trame de sortie, le codec le redimensionne.</span><span class="sxs-lookup"><span data-stu-id="1a942-140">If the region of interest is a different size than the output frame, the codec resizes it.</span></span> <span data-ttu-id="1a942-141">Le coefficient de fusion de l’image détermine la fusion des deux images.</span><span class="sxs-lookup"><span data-stu-id="1a942-141">The blend coefficient of the image determines the blending of the two images.</span></span> <span data-ttu-id="1a942-142">Les coefficients de fusion pour les images actuelles et précédentes doivent être au total de 1,0.</span><span class="sxs-lookup"><span data-stu-id="1a942-142">The blend coefficients for the current and previous images must total 1.0.</span></span> <span data-ttu-id="1a942-143">Par exemple, si **fCurrBlendCoef** est défini sur 0,5 et **fPrevBlendCoef** sur 0,5, alors le frame de sortie est composé d’une fusion égale des régions d’intérêt des deux images.</span><span class="sxs-lookup"><span data-stu-id="1a942-143">For example, if **fCurrBlendCoef** is set to 0.5 and **fPrevBlendCoef** is set to 0.5, then the output frame is composed of an equal blend of the regions of interest from both images.</span></span>

<span data-ttu-id="1a942-144">En manipulant la zone d’intérêt d’une image, vous pouvez créer des effets de panoramique et de zoom.</span><span class="sxs-lookup"><span data-stu-id="1a942-144">By manipulating the region of interest for an image, you can create pan and zoom effects.</span></span> <span data-ttu-id="1a942-145">Les coefficients de fusion vous permettent d’effectuer un fondu croisé (dissoudre) entre les images.</span><span class="sxs-lookup"><span data-stu-id="1a942-145">The blend coefficients enable you to cross-fade (dissolve) between images.</span></span> <span data-ttu-id="1a942-146">En plus de ces effets, vous pouvez utiliser l’une des transitions prédéfinies pour créer des frames plus complexes.</span><span class="sxs-lookup"><span data-stu-id="1a942-146">In addition to these effects, you can use one of the predefined transitions to create more complex frames.</span></span> <span data-ttu-id="1a942-147">Les transitions disponibles sont décrites dans la section [transitions d’images vidéo](video-image-transitions.md) de cette documentation.</span><span class="sxs-lookup"><span data-stu-id="1a942-147">The available transitions are described in the [Video Image Transitions](video-image-transitions.md) section of this documentation.</span></span> <span data-ttu-id="1a942-148">Lorsque vous utilisez une transition, vous devez configurer chaque frame.</span><span class="sxs-lookup"><span data-stu-id="1a942-148">When using a transition, you must configure each frame.</span></span> <span data-ttu-id="1a942-149">Le moyen le plus simple de procéder consiste à créer une fonction qui change de façon incrémentielle les membres de la structure VIDEOIMAGE de la **\_ \_ SAMPLE2 WMT** pour obtenir un effet complet.</span><span class="sxs-lookup"><span data-stu-id="1a942-149">The easiest way to do this is to create a function that incrementally changes members of the **WMT\_VIDEOIMAGE\_SAMPLE2** structure for a complete effect.</span></span>

<span data-ttu-id="1a942-150">Pour plus d’informations sur les valeurs à définir pour les déformations, consultez [**WMT \_ VIDEOIMAGE \_ SAMPLE2**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2).</span><span class="sxs-lookup"><span data-stu-id="1a942-150">For more information about the values to set for deformations, see [**WMT\_VIDEOIMAGE\_SAMPLE2**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2).</span></span>

<span data-ttu-id="1a942-151">**Remarque** Si vous souhaitez inclure des données audio dans un fichier avec un flux d’image vidéo, vous devez utiliser une entrée audio non compressée.</span><span class="sxs-lookup"><span data-stu-id="1a942-151">**Note** If you want to include audio in a file with a Video Image stream, you must use uncompressed audio input.</span></span> <span data-ttu-id="1a942-152">Pour combiner un flux d’image vidéo avec un flux audio compressé existant, vous devez décompresser l’audio et passer les exemples en non compressé.</span><span class="sxs-lookup"><span data-stu-id="1a942-152">To combine a Video Image stream with an existing compressed audio stream, you must decompress the audio and pass the samples in uncompressed.</span></span> <span data-ttu-id="1a942-153">Si vous transmettez des échantillons compressés à l’enregistreur lors de l’écriture d’un flux d’image vidéo, une erreur se produit, ce qui entraîne la suppression des échantillons de la vidéo.</span><span class="sxs-lookup"><span data-stu-id="1a942-153">If you pass compressed samples to the writer when writing a Video Image stream, an error will occur, resulting in samples being dropped from the video.</span></span>

<span data-ttu-id="1a942-154">En outre, les fichiers image vidéo compressés sans flux audio peuvent contenir plusieurs images vidéo très petites et très compressées dans un paquet ASF unique, ce qui peut entraîner une mauvaise expérience de lecture sur les versions précédentes du lecteur Windows Media.</span><span class="sxs-lookup"><span data-stu-id="1a942-154">Also, compressed Video Image files with no audio streams can contain several very small, highly compressed video frames in a single ASF packet, which can result in a poor playback experience on previous versions of Windows Media Player.</span></span> <span data-ttu-id="1a942-155">Pour éviter ce problème, la meilleure solution consiste à insérer un flux audio silencieux dans le fichier, bien que cela augmente également la taille du fichier.</span><span class="sxs-lookup"><span data-stu-id="1a942-155">To avoid this problem, the best solution is to insert a silent audio stream into the file, although this will also increase the file size.</span></span>

## <a name="related-topics"></a><span data-ttu-id="1a942-156">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="1a942-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="1a942-157">**Image vidéo**</span><span class="sxs-lookup"><span data-stu-id="1a942-157">**Video Image**</span></span>](video-image.md)
</dt> <dt>

[<span data-ttu-id="1a942-158">**Écriture de fichiers ASF**</span><span class="sxs-lookup"><span data-stu-id="1a942-158">**Writing ASF Files**</span></span>](writing-asf-files.md)
</dt> </dl>

 

 




