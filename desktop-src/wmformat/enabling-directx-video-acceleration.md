---
title: Activation de l’accélération vidéo DirectX
description: Activation de l’accélération vidéo DirectX
ms.assetid: 5cb2f564-88e3-4b60-bde3-6ccf69c97c48
keywords:
- Windows Media Format SDK, activation de DXVA
- Windows Media Format SDK, DirectX Video Acceleration (DXVA)
- Windows Media Format SDK, accélération vidéo
- ASF (Advanced Systems Format), activation d’DXVA
- ASF (format avancé des systèmes), activer DXVA
- Advanced Systems Format (ASF), DirectX Video Acceleration (DXVA)
- ASF (format des systèmes avancés), accélération vidéo DirectX (DXVA)
- ASF (Advanced Systems Format), accélération vidéo
- ASF (format des systèmes avancés), accélération vidéo
- DirectX Video Acceleration (DXVA), activation
- DXVA (DirectX Video Acceleration), activation
- Accélération vidéo DirectX (DXVA), ordre des opérations
- DXVA (DirectX Video Acceleration), ordre des opérations
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 896147fe11b4b7f5fb91d8dc288e616b643bd5ce
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/19/2020
ms.locfileid: "104381481"
---
# <a name="enabling-directx-video-acceleration"></a><span data-ttu-id="7c8a1-116">Activation de l’accélération vidéo DirectX</span><span class="sxs-lookup"><span data-stu-id="7c8a1-116">Enabling DirectX Video Acceleration</span></span>

<span data-ttu-id="7c8a1-117">Cette section décrit comment activer l’accélération vidéo de Microsoft® DirectX® lors de la lecture de contenu diffusé en continu dans un lecteur personnalisé.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-117">This section describes how to enable Microsoft® DirectX® Video Acceleration when playing streamed content in a custom player.</span></span>

## <a name="background"></a><span data-ttu-id="7c8a1-118">Arrière-plan</span><span class="sxs-lookup"><span data-stu-id="7c8a1-118">Background</span></span>

<span data-ttu-id="7c8a1-119">DirectX Video Acceleration (DirectX VA) est une spécification d’API pour l’accélération matérielle des opérations de décodage 2D.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-119">DirectX Video Acceleration (DirectX VA) is an API specification for hardware acceleration of 2-D decoding operations.</span></span> <span data-ttu-id="7c8a1-120">Il permet aux décodeurs logiciels de décharger certaines opérations gourmandes en ressources du processeur vers la carte graphique en vue de leur traitement.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-120">It enables software decoders to offload certain CPU-intensive operations to the graphics card for processing.</span></span> <span data-ttu-id="7c8a1-121">Pour les utilisateurs finaux, cela rend possible une vidéo à débit élevé, telle que la lecture de DVD plein écran sur des ordinateurs plus anciens équipés de cartes graphiques compatibles DirectX VA.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-121">For end users, this makes possible high-bit-rate video such as full-screen DVD playback on older computers equipped with DirectX VA-compatible graphics cards.</span></span>

<span data-ttu-id="7c8a1-122">À partir du kit de développement logiciel (SDK) Windows Media Format 9 Series, le filtre de wrappers DMO prend en charge DirectX VA.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-122">Beginning with the Windows Media Format 9 Series SDK, the DMO Wrapper filter supports DirectX VA.</span></span> <span data-ttu-id="7c8a1-123">Cela signifie que, pour la lecture locale, les applications peuvent utiliser le filtre de lecteur ASF WM pour lire le contenu Windows Media et l’accélération matérielle DirectX VA sera appelée automatiquement si la carte graphique le prend en charge.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-123">This means that, for local playback, applications can use the WM ASF Reader filter to play Windows Media-based content and DirectX VA hardware acceleration will be invoked automatically if the graphics card supports it.</span></span> <span data-ttu-id="7c8a1-124">Toutefois, le filtre de lecteur ASF WM ne prend pas en charge la lecture de contenu diffusé en continu.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-124">However, the WM ASF Reader filter does not support playback of streamed content.</span></span> <span data-ttu-id="7c8a1-125">Par conséquent, si vous souhaitez prendre en charge DirectX VA lors de la lecture de contenu diffusé dans un lecteur personnalisé, vous devez utiliser un autre mécanisme, qui est celui utilisé par le lecteur Windows Media à partir de la série Windows Media 9.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-125">Therefore, if you want to support DirectX VA when playing streamed content in a custom player, you must use an alternate mechanism, which is the one used by Windows Media Player beginning with the Windows Media 9 Series.</span></span>

<span data-ttu-id="7c8a1-126">Étant donné que le lecteur Windows Media a été conçu avant le développement des filtres QASF, le lecteur Windows Media dispose de son propre filtre source, basé sur le kit de développement logiciel (SDK) Windows Media format, pour la lecture de contenu Windows Media.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-126">Because Windows Media Player was designed before the QASF filters had been developed, Windows Media Player has its own source filter, based on the Windows Media Format SDK, for playing Windows Media-based content.</span></span> <span data-ttu-id="7c8a1-127">Le filtre de source Windows Media WMP fournit des données décompressées en aval directement aux convertisseurs audio et vidéo.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-127">The WMP Windows Media Source Filter delivers decompressed data downstream directly to the audio and video renderers.</span></span> <span data-ttu-id="7c8a1-128">En revanche, le lecteur ASF WM fournit du contenu compressé en aval du décodeur Windows Media DMOs (DirectX Media Objects), qui sont hébergés dans le wrapper DMO.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-128">By contrast, the WM ASF Reader delivers compressed content downstream to the Windows Media Decoder DirectX Media Objects (DMOs), which are hosted inside the DMO Wrapper.</span></span> <span data-ttu-id="7c8a1-129">Les diagrammes suivants illustrent les différences entre le lecteur ASF WM et le filtre de source Windows Media WMP.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-129">The following diagrams illustrate the differences between the WM ASF Reader and the WMP Windows Media Source Filter.</span></span>

![le filtre source personnalisé génère des exemples non compressés](images/wmp-dxva-graph.png)

![exemples de sorties de filtre source qasf compressés](images/qasf-dxva-graph.png)

<span data-ttu-id="7c8a1-132">Pour activer DirectX VA pour le contenu diffusé en continu, vous devez créer un filtre source personnalisé comme celui du diagramme supérieur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-132">To enable DirectX VA for streamed content, you must create a custom source filter like the one in the top diagram.</span></span> <span data-ttu-id="7c8a1-133">En fait, ce filtre utilise le kit de développement logiciel (SDK) Windows Media format pour instancier un objet WM Reader, décompresser les exemples et les envoyer en aval sur ses broches de sortie.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-133">Basically, this filter will use the Windows Media Format SDK to instantiate a WM Reader object, decompress the samples, and send them downstream on its output pins.</span></span> <span data-ttu-id="7c8a1-134">Cette discussion part du principe que vous avez déjà créé le filtre source et que vous êtes maintenant prêt à implémenter la prise en charge DirectX VA.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-134">This discussion assumes that you have created the source filter already and are now ready to implement the DirectX VA support.</span></span>

<span data-ttu-id="7c8a1-135">Pour activer DirectX VA, la tâche de base du filtre source consiste à fournir au convertisseur vidéo et au décodeur WMV DMO les interfaces dont il a besoin pour négocier la connexion DirectX VA.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-135">To enable DirectX VA, the basic task of the source filter is to provide the Video Renderer and the WMV Decoder DMO with the interfaces they will need to negotiate the DirectX VA connection.</span></span> <span data-ttu-id="7c8a1-136">Le filtre source ne participe pas à ces négociations.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-136">The source filter does not participate in those negotiations.</span></span> <span data-ttu-id="7c8a1-137">Après le démarrage de la diffusion en continu, la seule tâche du filtre source que le filtre source peut effectuer est de modifier les horodatages sur les échantillons vidéo avant que le décodeur WMV les remette au convertisseur vidéo.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-137">After streaming starts, the only DirectX VA-related task that the source filter can perform is to modify the time stamps on the video samples before the WMV decoder delivers them to the Video Renderer.</span></span> <span data-ttu-id="7c8a1-138">La raison principale pour cela est de fournir un contrôle de chronologie personnalisé au-delà de ce que les interfaces de® DirectShow standard activent.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-138">The primary reason for doing this is to provide custom timeline control beyond what the standard DirectShow® interfaces enable.</span></span>

<span data-ttu-id="7c8a1-139">Trois interfaces sont définies pour activer les communications nécessaires entre le kit de développement logiciel (SDK) du format Windows Media, le filtre source du lecteur, le Windows Media Video décoder DMO, le mélangeur de superposition ou le convertisseur de mixage vidéo.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-139">Three interfaces are defined to enable the necessary communications between the Windows Media Format SDK, the player's source filter, the Windows Media Video decoder DMO, and the Overlay Mixer or Video Mixing Renderer.</span></span> <span data-ttu-id="7c8a1-140">Ces interfaces sont décrites dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-140">These interfaces are described in the following table.</span></span>



| <span data-ttu-id="7c8a1-141">Interface</span><span class="sxs-lookup"><span data-stu-id="7c8a1-141">Interface</span></span>                                                        | <span data-ttu-id="7c8a1-142">Description</span><span class="sxs-lookup"><span data-stu-id="7c8a1-142">Description</span></span>                                                                                                                                                                                        |
|------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="7c8a1-143">**IWMCodecAMVideoAccelerator**</span><span class="sxs-lookup"><span data-stu-id="7c8a1-143">**IWMCodecAMVideoAccelerator**</span></span>](/previous-versions/windows/desktop/api/wmdxva/nn-wmdxva-iwmcodecamvideoaccelerator) | <span data-ttu-id="7c8a1-144">Exposée par le décodeur Windows Media DMO et appelée par le filtre source d’un lecteur multimédia pour configurer les différentes connexions requises pour activer DirectX VA afin de décoder le contenu de Windows Media Video.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-144">Exposed by the Windows Media Decoder DMO and called by a media player's source filter to set up the various connections required to enable DirectX VA for decoding of Windows Media Video content.</span></span> |
| [<span data-ttu-id="7c8a1-145">**IWMPlayerTimestampHook**</span><span class="sxs-lookup"><span data-stu-id="7c8a1-145">**IWMPlayerTimestampHook**</span></span>](/previous-versions/windows/desktop/api/wmdxva/nn-wmdxva-iwmplayertimestamphook)         | <span data-ttu-id="7c8a1-146">Implémenté sur le filtre source du lecteur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-146">Implemented on the player's source filter.</span></span> <span data-ttu-id="7c8a1-147">Il permet au filtre de modifier les horodatages sur les échantillons vidéo avant de les diffuser en aval.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-147">It enables the filter to modify the time stamps on the video samples before delivering them downstream.</span></span>                                                 |
| [<span data-ttu-id="7c8a1-148">**IWMReaderAccelerator**</span><span class="sxs-lookup"><span data-stu-id="7c8a1-148">**IWMReaderAccelerator**</span></span>](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmreaderaccelerator)             | <span data-ttu-id="7c8a1-149">Implémenté sur l’objet WM Reader.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-149">Implemented on the WM Reader object.</span></span> <span data-ttu-id="7c8a1-150">Elle est appelée par un filtre de source de lecteur pour obtenir des interfaces à partir du décodeur DMO.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-150">It is called by a player source filter to obtain interfaces from the decoder DMO.</span></span>                                                                             |



 

## <a name="order-of-operations-in-directx-vaenabled-playback"></a><span data-ttu-id="7c8a1-151">Ordre des opérations dans DirectX VA-lecture activée</span><span class="sxs-lookup"><span data-stu-id="7c8a1-151">Order of Operations in DirectX VA–enabled Playback</span></span>

<span data-ttu-id="7c8a1-152">Cette section décrit l’ordre général des opérations au moment de l’exécution pour un lecteur prenant en charge DirectX VA et son filtre source.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-152">This section describes the general order of operations at run time for a DirectX VA-enabled player and its source filter.</span></span> <span data-ttu-id="7c8a1-153">Les composants référencés dans cette section sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="7c8a1-153">The components referred to in this section are:</span></span>

-   <span data-ttu-id="7c8a1-154">Un lecteur multimédia tiers, appelé lecteur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-154">A third-party media player, referred to as the player.</span></span>
-   <span data-ttu-id="7c8a1-155">Filtre source personnalisé, instancié par le lecteur, qui utilise le kit de développement logiciel (SDK) Windows Media format pour décompresser le contenu multimédia Windows.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-155">A custom source filter, instantiated by the player, that uses the Windows Media Format SDK to decompress Windows Media-based content.</span></span>
-   <span data-ttu-id="7c8a1-156">Broche de sortie vidéo du filtre source du joueur, appelée broche de sortie.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-156">The video output pin of the player's source filter, referred to as the output pin.</span></span>
-   <span data-ttu-id="7c8a1-157">Le graphique de filtre de lecture vidéo DirectShow, désigné sous le terme de graphique.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-157">The DirectShow video playback filter graph, referred to as the graph.</span></span>
-   <span data-ttu-id="7c8a1-158">Convertisseur de mixage vidéo, appelé VMR.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-158">The Video Mixing Renderer, referred to as the VMR.</span></span>
-   <span data-ttu-id="7c8a1-159">Objet lecteur asynchrone du kit de développement logiciel (SDK) Windows Media format, appelé lecteur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-159">The Windows Media Format SDK Asynchronous Reader object, referred to as the reader.</span></span>
-   <span data-ttu-id="7c8a1-160">Objet média DirectX du décodeur Windows Media Video, appelé décodeur DMO.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-160">The Windows Media Video Decoder DirectX Media Object, referred to as the decoder DMO.</span></span>

<span data-ttu-id="7c8a1-161">L’ordre des opérations est le suivant :</span><span class="sxs-lookup"><span data-stu-id="7c8a1-161">The order of operations is as follows:</span></span>

1.  <span data-ttu-id="7c8a1-162">Le lecteur instancie son filtre source et un objet lecteur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-162">The player instantiates its source filter and a reader object.</span></span> <span data-ttu-id="7c8a1-163">Le lecteur crée un décodeur vidéo DMO et définit le type d’entrée (compressé) sur celui-ci.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-163">The reader creates a video decoder DMO and sets the (compressed) input type on it.</span></span> <span data-ttu-id="7c8a1-164">Cela doit se produire avant que le lecteur ne tente de configurer son graphique de lecture vidéo car le kit de développement logiciel (SDK) et le décodeur DMO doivent être impliqués dans le processus de négociation avec le graphique, et le modèle d’entrée doit connaître le format d’entrée à l’étape 9.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-164">This must happen before the player attempts to configure its video playback graph because the SDK and the decoder DMO must be involved in the negotiation process with the graph, and the DMO must know the input format during step 9.</span></span>
2.  <span data-ttu-id="7c8a1-165">Le lecteur appelle **IGraphBuilder :: Render**, en lui fournissant la broche de sortie du filtre de la source vidéo.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-165">The player calls **IGraphBuilder::Render**, providing it the video source filter's output pin.</span></span> <span data-ttu-id="7c8a1-166">À ce stade, le gestionnaire de graphe de filtre DirectShow tente de connecter VMR au filtre de source vidéo du lecteur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-166">At this point, the DirectShow filter graph manager tries to connect the VMR to the player's video source filter.</span></span>
3.  <span data-ttu-id="7c8a1-167">Le gestionnaire de graphique de filtre appelle **IPIN :: Connect** sur la broche de sortie du filtre de source vidéo du lecteur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-167">The filter graph manager calls **IPin::Connect** on the output pin of the player's video source filter.</span></span>

<span data-ttu-id="7c8a1-168">Les étapes 4 à 10 se produisent à l’intérieur de **IPIN :: Connect**.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-168">Steps 4 through 10 occur inside of **IPin::Connect**.</span></span>

1.  <span data-ttu-id="7c8a1-169">Le filtre source obtient l’interface **IWMCodecAMVideoAccelerator** à partir de la méthode **IWMReaderAccelerator :: GetCodecInterface** du lecteur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-169">The source filter obtains the **IWMCodecAMVideoAccelerator** interface from the reader's **IWMReaderAccelerator::GetCodecInterface** method.</span></span> <span data-ttu-id="7c8a1-170">Si le codec ne prend pas en charge DirectX VA, l’appel à **GetCodecInterface** peut échouer.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-170">If the codec does not support DirectX VA, the call to **GetCodecInterface** may fail.</span></span> <span data-ttu-id="7c8a1-171">Dans ce cas, la négociation se poursuit normalement, sans prise en charge de DirectX VA.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-171">In this case, negotiation proceeds as usual, without DirectX VA support.</span></span>
2.  <span data-ttu-id="7c8a1-172">Le filtre source passe le pointeur **IAMVideoAccelerator** à partir du code confidentiel transmis à la **connexion** au décodeur DMO via **IWMCodecAMVideoAccelerator :: SetAcceleratorInterface**.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-172">The source filter passes the **IAMVideoAccelerator** pointer from the pin passed into **Connect** to the decoder DMO through **IWMCodecAMVideoAccelerator::SetAcceleratorInterface**.</span></span>
3.  <span data-ttu-id="7c8a1-173">Le filtre source délègue ensuite le reste de l’opération **IPIN :: Connect** à la méthode **CBaseOutputPin :: Connect** .</span><span class="sxs-lookup"><span data-stu-id="7c8a1-173">The source filter then delegates the remainder of the **IPin::Connect** operation to the **CBaseOutputPin::Connect** method.</span></span> <span data-ttu-id="7c8a1-174">L’énumération de format avec le kit de développement logiciel (SDK) s’exécute aujourd’hui.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-174">The format enumeration with the SDK proceeds as it does today.</span></span> <span data-ttu-id="7c8a1-175">Si le codec prend en charge DirectX VA pour le contenu en cours de connexion, le codec DMO présente les sous-types DirectX VA en premier, avant les types YUV et RGB pris en charge.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-175">If the codec supports DirectX VA for the content being connected, the codec DMO presents those DirectX VA subtypes first, prior to the YUV and RGB types supported.</span></span> <span data-ttu-id="7c8a1-176">Si la prise en charge de DirectX VA est disponible, les étapes 7 à 11 sont tentées dans le contexte d’un sous-type DirectX VA.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-176">If DirectX VA support is available, steps 7 through 11 are attempted in the context of a DirectX VA subtype.</span></span> <span data-ttu-id="7c8a1-177">L’extrait de code suivant montre comment identifier un sous-type de média DirectX VA.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-177">The following code snippet shows how to identify a DirectX VA media subtype.</span></span>
    ```C++
    bool IsDXVASubtype( AM_MEDIA_TYPE * pmt )
    {
        // All DXVA types have the same last 3 DWORDs.
        // guidDXVA is the base GUID for all DXVA subtypes.

        GUID guidDXVA = { 0x00000000, 0xa0c7, 0x11d3, { 0xb9,0x84,0x00,0xc0,0x4f,0x2e,0x73,0xc5 } };

        unsigned long const * plguid;
        unsigned long const * plguidDXVA;
        plguid = (unsigned long const *)&pmt->subtype;
        plguidDXVA = (unsigned long *)&guidDXVA;

        if( ( plguid[1] == plguidDXVA[1] ) &&
            ( plguid[2] == plguidDXVA[2] ) &&
            ( plguid[3] == plguidDXVA[3] ) )
        {
            return true;
        }

        return false;
    }
    
    ```

    

4.  <span data-ttu-id="7c8a1-178">L’implémentation de **CBaseOutputPin :: Connect** appelle **IPIN :: CompleteConnect** à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-178">The **CBaseOutputPin::Connect** implementation calls **IPin::CompleteConnect** during step 3.</span></span> <span data-ttu-id="7c8a1-179">Si un sous-type DirectX VA est pris en compte, la négociation DirectX VA est tentée.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-179">If a DirectX VA subtype is being considered, the DirectX VA negotiation is attempted.</span></span> <span data-ttu-id="7c8a1-180">La broche de sortie appelle **IWMCodecAMVideoAccelerator :: NegotiateConnection**, en lui transmettant le type de média de sortie actuel.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-180">The output pin calls **IWMCodecAMVideoAccelerator::NegotiateConnection**, passing it the current output media type.</span></span>
5.  <span data-ttu-id="7c8a1-181">Le décodeur DMO effectue la négociation requise avec VMR via l’interface **IAMVideoAccelerator** et retourne le GUID de sous-type de vidéo que les deux ont convenu.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-181">The decoder DMO performs the required negotiation with the VMR through the **IAMVideoAccelerator** interface, and returns the video subtype GUID that the two have agreed on.</span></span> <span data-ttu-id="7c8a1-182">La broche de sortie délègue tous les appels **IAMVideoAcceleratorNotify** reçus au cours de ce processus à l’interface **IAMVideoAcceleratorNotify** du décodeur DMO, qui peut également être obtenue par le biais de la méthode **IWMReaderAccelerator :: GetCodecInterface** .</span><span class="sxs-lookup"><span data-stu-id="7c8a1-182">The output pin delegates all **IAMVideoAcceleratorNotify** calls received during this process to the decoder DMO's **IAMVideoAcceleratorNotify** interface, which can also be obtained through the **IWMReaderAccelerator::GetCodecInterface** method.</span></span>
6.  <span data-ttu-id="7c8a1-183">Si **NegotiateConnection** fonctionne, la broche de sortie appelle **IWMCodecAMVideoAccelerator :: SetPlayerNotify** avec une interface **IWMPlayerTimestampHook** .</span><span class="sxs-lookup"><span data-stu-id="7c8a1-183">If **NegotiateConnection** succeeds, the output pin calls **IWMCodecAMVideoAccelerator::SetPlayerNotify** with an **IWMPlayerTimestampHook** interface.</span></span> <span data-ttu-id="7c8a1-184">Ce hook permet au filtre source de mettre à jour les horodatages sur les échantillons avant qu’ils ne soient transmis au convertisseur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-184">This hook allows the source filter to update the time stamps on the samples before they are handed to the renderer.</span></span>
7.  <span data-ttu-id="7c8a1-185">Le filtre source appelle **IWMReaderAccelerator :: Notify** avec le type de média négocié.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-185">The source filter calls **IWMReaderAccelerator::Notify** with the negotiated media type.</span></span> <span data-ttu-id="7c8a1-186">Cela permet au lecteur de mettre à jour ses variables internes et de la valider sur DirectX VA.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-186">This allows the reader to update its internal variables and commit to DirectX VA.</span></span> <span data-ttu-id="7c8a1-187">Il s’agit du dernier emplacement où le codec ou le lecteur peut échouer.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-187">This is the last place the codec or reader can fail.</span></span> <span data-ttu-id="7c8a1-188">Si l’une des étapes ci-dessus échoue, le filtre source doit revenir à l’étape 3 et essayer le type suivant énuméré par le lecteur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-188">If any of the above steps fail, the source filter should return to step 3 and try the next type enumerated by the reader.</span></span>
8.  <span data-ttu-id="7c8a1-189">La lecture démarre.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-189">Playback starts.</span></span> <span data-ttu-id="7c8a1-190">Le lecteur ignore les mémoires tampons de sortie du décodeur DMO si le type de sortie de la connexion est DirectX VA.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-190">The reader ignores output buffers from the decoder DMO if the connection output type is DirectX VA.</span></span>
9.  <span data-ttu-id="7c8a1-191">Quand **IPIN ::D éconnecter** se produit, le filtre source appelle **IWMCodecAMVideoAccelerator :: SetAcceleratorInterface** avec une **valeur null**.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-191">When **IPin::Disconnect** occurs, the source filter calls **IWMCodecAMVideoAccelerator::SetAcceleratorInterface** with a **NULL**.</span></span> <span data-ttu-id="7c8a1-192">Cela rompt la connexion DirectX VA entre le codec et le convertisseur.</span><span class="sxs-lookup"><span data-stu-id="7c8a1-192">This breaks the DirectX VA connection between the codec and the renderer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="7c8a1-193">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="7c8a1-193">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7c8a1-194">**Lecture des fichiers ASF**</span><span class="sxs-lookup"><span data-stu-id="7c8a1-194">**Reading ASF Files**</span></span>](reading-asf-files.md)
</dt> </dl>

 

 




