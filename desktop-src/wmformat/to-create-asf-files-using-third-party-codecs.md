---
title: Pour créer des fichiers ASF à l’aide de codecs tiers
description: Pour créer des fichiers ASF à l’aide de codecs tiers
ms.assetid: 5cd348ca-1f86-429d-92ee-4eab4ced8571
keywords:
- Windows Media Format SDK, création de fichiers ASF
- Windows Media Format SDK, codecs tiers
- ASF (Advanced Systems Format), création de fichiers
- ASF (format des systèmes avancés), création de fichiers
- Formats ASF (Advanced Systems Format) et codecs tiers
- ASF (format de systèmes avancés), codecs tiers
- codecs tiers
- codecs, tiers
- codecs, création de fichiers ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9d6c057f1785ed50e328ac6094ff7dbe078e98fc
ms.sourcegitcommit: ad672d3a10192c5ccac619ad2524407109266e93
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/25/2020
ms.locfileid: "104314504"
---
# <a name="to-create-asf-files-using-third-party-codecs"></a><span data-ttu-id="31129-112">Pour créer des fichiers ASF à l’aide de codecs tiers</span><span class="sxs-lookup"><span data-stu-id="31129-112">To Create ASF Files Using Third-Party Codecs</span></span>

<span data-ttu-id="31129-113">Vous pouvez utiliser le kit de développement logiciel (SDK) Windows Media format pour créer des fichiers ASF qui contiennent des médias numériques encodés avec n’importe quel codec de votre choix.</span><span class="sxs-lookup"><span data-stu-id="31129-113">You can use the Windows Media Format SDK to create ASF files that contain digital media encoded with any codec you choose.</span></span> <span data-ttu-id="31129-114">Lorsque vous utilisez un codec autre que celui inclus dans ce kit de développement logiciel (SDK), vous devez effectuer les étapes suivantes.</span><span class="sxs-lookup"><span data-stu-id="31129-114">When using a codec other than one included with this SDK, you must perform the following steps.</span></span>

1.  <span data-ttu-id="31129-115">Encodez le contenu avec le codec souhaité.</span><span class="sxs-lookup"><span data-stu-id="31129-115">Encode the content with the desired codec.</span></span>
2.  <span data-ttu-id="31129-116">Recherchez ou créez une valeur GUID pour identifier le contenu encodé avec le codec utilisé à l’étape 1.</span><span class="sxs-lookup"><span data-stu-id="31129-116">Find or create a GUID value to identify content encoded with the codec used in step 1.</span></span>
3.  <span data-ttu-id="31129-117">Créez un nouveau profil ou modifiez un profil existant pour l’utiliser avec le contenu encodé.</span><span class="sxs-lookup"><span data-stu-id="31129-117">Create a new profile, or modify an existing profile for use with the encoded content.</span></span>
    -   <span data-ttu-id="31129-118">Créez un flux pour le contenu encodé avec le type principal approprié.</span><span class="sxs-lookup"><span data-stu-id="31129-118">Create a stream for the encoded content with the appropriate major type.</span></span> <span data-ttu-id="31129-119">Pour plus d’informations sur les principaux types de médias, consultez [types de médias](media-types.md).</span><span class="sxs-lookup"><span data-stu-id="31129-119">For more information about major media types, see [Media Types](media-types.md).</span></span> <span data-ttu-id="31129-120">Utilisez le GUID identifié à l’étape 2 comme sous-type de média.</span><span class="sxs-lookup"><span data-stu-id="31129-120">Use the GUID identified in step 2 as the media subtype.</span></span>
    -   <span data-ttu-id="31129-121">Définissez la vitesse de transmission et la fenêtre de mémoire tampon pour le flux sur des valeurs qui n’entraînent pas un dépassement de mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="31129-121">Set the bit rate and buffer window for the stream to values that will not result in buffer overflow.</span></span> <span data-ttu-id="31129-122">Vous devez être en mesure d’obtenir ces valeurs à partir du codec au moment de l’encodage.</span><span class="sxs-lookup"><span data-stu-id="31129-122">You should be able to obtain these values from the codec at the time of encoding.</span></span> <span data-ttu-id="31129-123">Les composants d’exécution du kit de développement logiciel (SDK) vérifient les valeurs des fenêtres binaires/de mémoire tampon et déposent les échantillons si nécessaire pour que les données spécifiées tiennent compte de ces valeurs.</span><span class="sxs-lookup"><span data-stu-id="31129-123">The SDK runtime components check the bitrate/buffer window values and drop samples if necessary to make the given data fit in with these values.</span></span> <span data-ttu-id="31129-124">Si vous définissez les valeurs de manière incorrecte, le fichier n’est pas correctement diffusé, ce qui entraîne une mauvaise lecture.</span><span class="sxs-lookup"><span data-stu-id="31129-124">If you set the values incorrectly, the file will not stream properly, resulting in poor playback.</span></span>
    -   <span data-ttu-id="31129-125">Pour les flux vidéo, vous devez définir le membre de **bicompression** de la structure **BITMAPINFOHEADER** contenue dans la structure [**WMVIDEOINFOHEADER**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wmvideoinfoheader) sur la valeur FourCC appropriée pour le contenu.</span><span class="sxs-lookup"><span data-stu-id="31129-125">For video streams, you must set the **biCompression** member of the **BITMAPINFOHEADER** structure contained in the [**WMVIDEOINFOHEADER**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wmvideoinfoheader) structure to the appropriate FOURCC value for the content.</span></span> <span data-ttu-id="31129-126">Cette valeur doit être égale aux quatre premiers octets du GUID de sous-type.</span><span class="sxs-lookup"><span data-stu-id="31129-126">This value must be equal to the first four bytes of the subtype GUID.</span></span> <span data-ttu-id="31129-127">Par exemple, si la **compression** est MAKEFOURCC (« t », « E », « t ») = 0x54455354, le GUID de sous-type commencera comme suit : 54455354-XXXX-XXXX-xxxx-xxxxxxxxxxxx.</span><span class="sxs-lookup"><span data-stu-id="31129-127">For example, if **biCompression** is MAKEFOURCC('T','E','S','T')=0x54455354, then the subtype GUID will begin like this: 54455354-XXXX-XXXX-XXXX-XXXXXXXXXXXX.</span></span>
4.  <span data-ttu-id="31129-128">Créez un objet Writer et chargez le profil créé à l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="31129-128">Create a writer object and load the profile created in the previous step.</span></span> <span data-ttu-id="31129-129">Pour plus d’informations sur l’écriture de fichiers, consultez [écriture de fichiers ASF](writing-asf-files.md).</span><span class="sxs-lookup"><span data-stu-id="31129-129">For more information about writing files, see [Writing ASF Files](writing-asf-files.md).</span></span>
5.  <span data-ttu-id="31129-130">Parcourez les entrées du fichier et affectez des propriétés d’entrée pour chaque comme vous le feriez normalement.</span><span class="sxs-lookup"><span data-stu-id="31129-130">Loop through the inputs of the file and assign input properties for each as you normally would.</span></span> <span data-ttu-id="31129-131">Pour plus d’informations sur les entrées, consultez [utilisation des entrées](working-with-inputs.md).</span><span class="sxs-lookup"><span data-stu-id="31129-131">For more information about inputs, see [Working with Inputs](working-with-inputs.md).</span></span> <span data-ttu-id="31129-132">Pour le flux encodé à l’aide d’un codec tiers, définissez le pointeur d’interface [**IWMInputMediaProps**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwminputmediaprops) sur la **valeur null** avant d’appeler [**IWMWriter :: BeginWriting**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-beginwriting).</span><span class="sxs-lookup"><span data-stu-id="31129-132">For the stream encoded with a third-party codec, set the [**IWMInputMediaProps**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwminputmediaprops) interface pointer to **NULL** before calling [**IWMWriter::BeginWriting**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-beginwriting).</span></span>
6.  <span data-ttu-id="31129-133">Utilisez le nouveau profil créé à l’étape précédente pour écrire le fichier.</span><span class="sxs-lookup"><span data-stu-id="31129-133">Use the new profile created in the previous step to write the file.</span></span> <span data-ttu-id="31129-134">Transmettez les exemples compressés à l’aide de [**IWMWriterAdvanced :: WriteStreamSample**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriteradvanced-writestreamsample) au lieu de [**IWMWriter :: WriteSample**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-writesample).</span><span class="sxs-lookup"><span data-stu-id="31129-134">Pass the compressed samples using [**IWMWriterAdvanced::WriteStreamSample**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriteradvanced-writestreamsample) instead of [**IWMWriter::WriteSample**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-writesample).</span></span> <span data-ttu-id="31129-135">Pour la vidéo, vous devez spécifier les exemples qui sont des images clés en passant WM \_ DF \_ CLEANPOINT comme paramètre *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="31129-135">For video, you must specify which samples are key frames by passing WM\_SF\_CLEANPOINT as the *dwFlags* parameter.</span></span>

<span data-ttu-id="31129-136">Pour traiter et décompresser le flux encodé à l’aide d’un codec tiers, vous devez lire les exemples de flux compressés.</span><span class="sxs-lookup"><span data-stu-id="31129-136">To process and decompress the stream encoded with a third-party codec, you must read compressed stream samples.</span></span> <span data-ttu-id="31129-137">Votre application de lecture doit également gérer l’exemple de décompression du flux.</span><span class="sxs-lookup"><span data-stu-id="31129-137">Your reading application must handle sample decompression for the stream as well.</span></span>

## <a name="putting-mpeg-2-streams-into-asf"></a><span data-ttu-id="31129-138">Placer des flux MPEG-2 dans ASF</span><span class="sxs-lookup"><span data-stu-id="31129-138">Putting MPEG-2 streams into ASF</span></span>

> [!Note]  
> <span data-ttu-id="31129-139">Cette rubrique s’applique aux applications qui utilisent le kit de développement logiciel (SDK) Windows Media format pour placer MPEG-2 (ou d’autres formats de compression qui utilisent des frames B) dans le conteneur de fichiers ASF.</span><span class="sxs-lookup"><span data-stu-id="31129-139">This topic applies to applications that use the Windows Media Format SDK to put MPEG-2 (or other compression formats that use B frames) into the ASF file container.</span></span>

 

<span data-ttu-id="31129-140">L’objet Writer requiert que tous les échantillons d’entrée aient des horodatages, et il suppose que chaque exemple d’entrée a une durée de présentation ultérieure à celle qui l’a précédé.</span><span class="sxs-lookup"><span data-stu-id="31129-140">The writer object requires that all input samples have time stamps, and it assumes that each input sample has a presentation time later than the one that preceded it.</span></span> <span data-ttu-id="31129-141">Si pratiquement toutes les vidéos non compressées et même certains flux vidéo compressés remplissent ces conditions, les flux MPEG-2 ne le font pas.</span><span class="sxs-lookup"><span data-stu-id="31129-141">While virtually all uncompressed video and even some compressed video streams meet these conditions, MPEG-2 streams do not.</span></span> <span data-ttu-id="31129-142">Dans MPEG-2, tous les échantillons ne sont pas horodatés et, lorsque les frames B sont présents, l’exemple de décodage est différent de l’ordre de rendu.</span><span class="sxs-lookup"><span data-stu-id="31129-142">In MPEG-2, not all samples are time stamped, and when B frames are present, the sample decoding order is not the same as the rendering order.</span></span> <span data-ttu-id="31129-143">Lorsque l’objet Writer rencontre des exemples non ordonnés, il les réorganise dans l’ordre « correct ».</span><span class="sxs-lookup"><span data-stu-id="31129-143">When the writer object encounters out-of-order samples, it rearranges them into the "correct" order.</span></span> <span data-ttu-id="31129-144">Par conséquent, pour stocker des flux MPEG-2 en mode natif (non décodés) dans un conteneur ASF, vous devez effectuer les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="31129-144">Therefore, to store MPEG-2 streams natively (not decoded) in an ASF container, you must perform the following steps:</span></span>

<span data-ttu-id="31129-145">Lors de l’écriture du fichier :</span><span class="sxs-lookup"><span data-stu-id="31129-145">When writing the file:</span></span>

1.  <span data-ttu-id="31129-146">Ajoutez une extension d’unité de données de taille fixe (DUE) à chaque exemple d’entrée qui contiendra une structure contenant les valeurs de temps et d’heure de début et d’heure de début MPEG réelles de l’exemple.</span><span class="sxs-lookup"><span data-stu-id="31129-146">Add a fixed-size data unit extension (DUE) to each input sample that will hold a structure that contains the actual MPEG time-stamp start-time and stop-time values for the sample.</span></span> <span data-ttu-id="31129-147">Utilisez-1 pour ces valeurs si l’exemple n’a pas d’horodatage.</span><span class="sxs-lookup"><span data-stu-id="31129-147">Use -1 for these values if the sample has no time stamp.</span></span>
2.  <span data-ttu-id="31129-148">Donnez aux objets d’enregistreur des horodateurs d’entrée « factices » qui s’améliorent toujours afin qu’ils écrivent les exemples dans le fichier exactement dans le même ordre que celui dans lequel ils sont reçus.</span><span class="sxs-lookup"><span data-stu-id="31129-148">Give the writer object "dummy" input time stamps that are always increasing so that it will write the samples to the file in exactly the same order as they are received.</span></span> <span data-ttu-id="31129-149">Les horodatages factices doivent correspondre approximativement aux durées de présentation réelles, en moyenne dans le temps.</span><span class="sxs-lookup"><span data-stu-id="31129-149">The dummy time stamps should correspond approximately to the actual presentation times, as averaged over time.</span></span> <span data-ttu-id="31129-150">Les horodatages factices forment la chronologie de recherche. par conséquent, s’ils divergent par rapport aux horodatages en temps réel, les opérations de recherche sur le fichier produisent des résultats inattendus.</span><span class="sxs-lookup"><span data-stu-id="31129-150">The dummy time stamps will form the seeking timeline, so if they diverge relative to the real time stamps, seek operations on the file will produce unexpected results.</span></span> <span data-ttu-id="31129-151">Toutefois, une quantité limitée d’instabilité entre les temps d’échantillonnage n’affectera pas sérieusement les opérations de recherche.</span><span class="sxs-lookup"><span data-stu-id="31129-151">However, a limited amount of jitter between the sample times will not seriously affect seek operations.</span></span>

<span data-ttu-id="31129-152">Lors de la lecture du fichier :</span><span class="sxs-lookup"><span data-stu-id="31129-152">When reading the file:</span></span>

-   <span data-ttu-id="31129-153">Pour chaque exemple lu à partir du fichier, examinez le dû.</span><span class="sxs-lookup"><span data-stu-id="31129-153">For each sample read from the file, examine the DUE.</span></span> <span data-ttu-id="31129-154">S’il contient une heure de début supérieure ou égale à zéro, copiez cette valeur sur l’horodatage de l’échantillon de sortie avant qu’il ne soit remis au décodeur.</span><span class="sxs-lookup"><span data-stu-id="31129-154">If it contains a start time that is greater than or equal to zero, copy that value to the time stamp for the output sample before it is delivered to the decoder.</span></span> <span data-ttu-id="31129-155">Affectez à tous les autres horodatages sur les échantillons de sortie la **valeur null**.</span><span class="sxs-lookup"><span data-stu-id="31129-155">Set all other time stamps on the output samples to **NULL**.</span></span> <span data-ttu-id="31129-156">Dans DirectShow, cette opération est effectuée en appelant **IMediaSample :: setTime**(**null**,**null**).</span><span class="sxs-lookup"><span data-stu-id="31129-156">In DirectShow, this is done by calling **IMediaSample::SetTime**(**NULL**,**NULL**).</span></span>

## <a name="related-topics"></a><span data-ttu-id="31129-157">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="31129-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="31129-158">**Mise en mémoire tampon du contenu**</span><span class="sxs-lookup"><span data-stu-id="31129-158">**Buffering Content**</span></span>](buffering-content.md)
</dt> <dt>

[<span data-ttu-id="31129-159">**Interface IWMWriter**</span><span class="sxs-lookup"><span data-stu-id="31129-159">**IWMWriter Interface**</span></span>](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmwriter)
</dt> <dt>

[<span data-ttu-id="31129-160">**Interface IWMWriterAdvanced**</span><span class="sxs-lookup"><span data-stu-id="31129-160">**IWMWriterAdvanced Interface**</span></span>](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmwriteradvanced)
</dt> <dt>

[<span data-ttu-id="31129-161">**Pour distribuer des exemples compressés avec le lecteur asynchrone**</span><span class="sxs-lookup"><span data-stu-id="31129-161">**To Deliver Compressed Samples with the Asynchronous Reader**</span></span>](to-deliver-compressed-samples-with-the-asynchronous-reader.md)
</dt> <dt>

[<span data-ttu-id="31129-162">**Pour récupérer des exemples de flux avec le lecteur synchrone**</span><span class="sxs-lookup"><span data-stu-id="31129-162">**To Retrieve Stream Samples with the Synchronous Reader**</span></span>](to-retrieve-stream-samples-with-the-synchronous-reader.md)
</dt> <dt>

[<span data-ttu-id="31129-163">**WMVIDEOINFOHEADER**</span><span class="sxs-lookup"><span data-stu-id="31129-163">**WMVIDEOINFOHEADER**</span></span>](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wmvideoinfoheader)
</dt> <dt>

[<span data-ttu-id="31129-164">**Utilisation des profils**</span><span class="sxs-lookup"><span data-stu-id="31129-164">**Working with Profiles**</span></span>](working-with-profiles.md)
</dt> <dt>

[<span data-ttu-id="31129-165">**Écriture de fichiers ASF**</span><span class="sxs-lookup"><span data-stu-id="31129-165">**Writing ASF Files**</span></span>](writing-asf-files.md)
</dt> </dl>

 

 




