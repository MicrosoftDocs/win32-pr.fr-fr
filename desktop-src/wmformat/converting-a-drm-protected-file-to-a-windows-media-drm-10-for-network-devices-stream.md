---
title: Conversion d’un fichier de DRM-Protected en un flux Windows Media DRM 10 pour les périphériques réseau
description: Conversion d’un fichier de DRM-Protected en un flux Windows Media DRM 10 pour les périphériques réseau
ms.assetid: 11aa0cfd-6d87-4ec4-82d8-db2507402911
keywords:
- Windows Media Format SDK, conversion de fichiers protégés par DRM
- Windows Media Format SDK, fichiers protégés par DRM
- ASF (Advanced Systems Format), conversion de fichiers protégés par DRM
- ASF (format de systèmes avancés), conversion de fichiers protégés par DRM
- Fichiers ASF (Advanced Systems Format), fichiers protégés par DRM
- ASF (format des systèmes avancés), fichiers protégés par DRM
- gestion des droits numériques (DRM), conversion de fichiers protégés par DRM
- DRM (gestion des droits numériques), conversion de fichiers protégés par DRM
- gestion des droits numériques (DRM), fichiers protégés par DRM
- DRM (gestion des droits numériques), fichiers protégés par DRM
- Windows Media Format SDK, Windows Media DRM 10 pour les périphériques réseau
- Windows Media Format SDK, DRM 10 pour les périphériques réseau
- ASF (Advanced Systems Format), Windows Media DRM 10 pour les périphériques réseau
- ASF (format avancé des systèmes), Windows Media DRM 10 pour les périphériques réseau
- ASF (Advanced Systems Format), DRM 10 pour les périphériques réseau
- ASF (format de systèmes avancés), DRM 10 pour les périphériques réseau
- gestion des droits numériques (DRM), Windows Media DRM 10 pour les périphériques réseau
- DRM (gestion des droits numériques), Windows Media DRM 10 pour les périphériques réseau
- gestion des droits numériques (DRM), DRM 10 pour les périphériques réseau
- DRM (gestion des droits numériques), DRM 10 pour les périphériques réseau
- Windows Media DRM 10 pour les périphériques réseau, conversion de fichiers protégés par DRM
- DRM 10 pour les périphériques réseau, conversion de fichiers protégés par DRM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 644c1b4f7ede688434fbb1dde11b7051c6f644a5
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/19/2020
ms.locfileid: "103723602"
---
# <a name="converting-a-drm-protected-file-to-a-windows-media-drm-10-for-network-devices-stream"></a><span data-ttu-id="2fe57-125">Conversion d’un fichier de DRM-Protected en un flux Windows Media DRM 10 pour les périphériques réseau</span><span class="sxs-lookup"><span data-stu-id="2fe57-125">Converting a DRM-Protected File to a Windows Media DRM 10 for Network Devices Stream</span></span>

<span data-ttu-id="2fe57-126">Une fois qu’un appareil est inscrit et validé, vous pouvez commencer à traiter les messages de demande de licence à partir de celui-ci.</span><span class="sxs-lookup"><span data-stu-id="2fe57-126">After a device is registered and validated, you can begin processing license request messages from it.</span></span> <span data-ttu-id="2fe57-127">Les messages de demande de licence sont envoyés par les appareils quand l’action à partir de l’application est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="2fe57-127">License request messages are sent by devices when action from the application is needed.</span></span> <span data-ttu-id="2fe57-128">La seule action actuellement prise en charge est « Play », qui est une demande de données sécurisées pour la lecture.</span><span class="sxs-lookup"><span data-stu-id="2fe57-128">The only action currently supported is "Play", which is a request for secure data for playback.</span></span>

<span data-ttu-id="2fe57-129">Lorsque vous recevez un message de demande de licence, vous devez effectuer les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="2fe57-129">When you receive a license request message, you should perform the following steps:</span></span>

1.  <span data-ttu-id="2fe57-130">Analysez le message de demande de licence en appelant la méthode [**IWMDRMMessageParser ::P arselicenserequestmsg**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmmessageparser-parselicenserequestmsg) .</span><span class="sxs-lookup"><span data-stu-id="2fe57-130">Parse the license request message by calling the [**IWMDRMMessageParser::ParseLicenseRequestMsg**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmmessageparser-parselicenserequestmsg) method.</span></span>
2.  <span data-ttu-id="2fe57-131">Obtenez l’interface [**IWMRegisteredDevice**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmregistereddevice) pour l’appareil en appelant la méthode [**IWMDeviceRegistration :: GetRegisteredDeviceByID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdeviceregistration-getregistereddevicebyid) , en passant le certificat et le numéro de série obtenus à l’étape 1.</span><span class="sxs-lookup"><span data-stu-id="2fe57-131">Get the [**IWMRegisteredDevice**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmregistereddevice) interface for the device by calling the [**IWMDeviceRegistration::GetRegisteredDeviceByID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdeviceregistration-getregistereddevicebyid) method, passing in the certificate and serial number obtained in step 1.</span></span>
3.  <span data-ttu-id="2fe57-132">Vérifiez que l’appareil est prêt à recevoir des données sécurisées :</span><span class="sxs-lookup"><span data-stu-id="2fe57-132">Verify that the device is ready to receive secure data:</span></span>
    -   <span data-ttu-id="2fe57-133">Appelez [**IWMRegisteredDevice :: IsApproved**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isapproved) pour vérifier que l’appareil a été approuvé.</span><span class="sxs-lookup"><span data-stu-id="2fe57-133">Call [**IWMRegisteredDevice::IsApproved**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isapproved) to verify that the device has been approved.</span></span> <span data-ttu-id="2fe57-134">L’approbation doit toujours reposer sur la préférence de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2fe57-134">Approval should always be based on user preference.</span></span>
    -   <span data-ttu-id="2fe57-135">Appelez [**IWMRegisteredDevice :: IsValid**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isvalid) pour vérifier que l’appareil a été validé au cours des dernières 48 heures.</span><span class="sxs-lookup"><span data-stu-id="2fe57-135">Call [**IWMRegisteredDevice::IsValid**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isvalid) to verify that the device has been validated within the last 48 hours.</span></span> <span data-ttu-id="2fe57-136">Si l’appareil n’est pas valide, vous devez effectuer la détection de proximité.</span><span class="sxs-lookup"><span data-stu-id="2fe57-136">If the device is not valid, you need to perform proximity detection.</span></span> <span data-ttu-id="2fe57-137">Pour plus d’informations, consultez exécution de la [détection de proximité](performing-proximity-detection.md).</span><span class="sxs-lookup"><span data-stu-id="2fe57-137">For more information, see [Performing Proximity Detection](performing-proximity-detection.md).</span></span>
    -   <span data-ttu-id="2fe57-138">Appelez [**IWMRegisteredDevice :: IsOpened**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isopened) pour vérifier que l’appareil a été ouvert.</span><span class="sxs-lookup"><span data-stu-id="2fe57-138">Call [**IWMRegisteredDevice::IsOpened**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isopened) to verify that the device has been opened.</span></span> <span data-ttu-id="2fe57-139">Si l’appareil n’est pas ouvert, vous pouvez l’ouvrir en appelant [**IWMRegisteredDevice :: Open**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-open).</span><span class="sxs-lookup"><span data-stu-id="2fe57-139">If the device is not open, you can open it by calling [**IWMRegisteredDevice::Open**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-open).</span></span> <span data-ttu-id="2fe57-140">Vous ne pouvez avoir que 10 appareils ouverts à la fois sur l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="2fe57-140">You can only have 10 devices open on the computer at a time.</span></span> <span data-ttu-id="2fe57-141">Il est possible que vous deviez fermer un autre appareil avant de pouvoir ouvrir celui pour lequel vous traitez la demande.</span><span class="sxs-lookup"><span data-stu-id="2fe57-141">It is possible that you may need to close another device before you can open the one for which you are processing the request.</span></span> <span data-ttu-id="2fe57-142">Pour fermer un appareil, appelez la méthode [**IWMRegisteredDevice :: Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-close) .</span><span class="sxs-lookup"><span data-stu-id="2fe57-142">To close a device, call the [**IWMRegisteredDevice::Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-close) method.</span></span>
4.  <span data-ttu-id="2fe57-143">Créez une instance de l’objet de transcrypteur DRM en appelant la fonction [**WMCreateDRMTranscryptor**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatedrmtranscryptor) .</span><span class="sxs-lookup"><span data-stu-id="2fe57-143">Create an instance of the DRM transcryptor object by calling the [**WMCreateDRMTranscryptor**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatedrmtranscryptor) function.</span></span>
5.  <span data-ttu-id="2fe57-144">Appelez la méthode [**IWMDRMTranscryptor :: Initialize**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-initialize) pour initialiser le transchiffreur.</span><span class="sxs-lookup"><span data-stu-id="2fe57-144">Call the [**IWMDRMTranscryptor::Initialize**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-initialize) method to initialize the transcryptor.</span></span> <span data-ttu-id="2fe57-145">Cette méthode prend un pointeur vers votre implémentation de l’interface [**IWMStatusCallback**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstatuscallback) , qu’elle utilise pour remettre des messages d’État.</span><span class="sxs-lookup"><span data-stu-id="2fe57-145">This method takes a pointer to your implementation of the [**IWMStatusCallback**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstatuscallback) interface, which it uses to deliver status messages.</span></span> <span data-ttu-id="2fe57-146">Cette méthode retourne également un message de demande de licence qui doit être envoyé à l’appareil avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="2fe57-146">This method also returns a license request message that must be sent to the device before continuing.</span></span>
6.  <span data-ttu-id="2fe57-147">Lorsque la méthode [**IWMStatusCallback :: OnStatus**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmstatuscallback-onstatus) de votre application reçoit le message d’état d’initialisation de transcryptor WMT \_ \_ , appelez la méthode [**IWMDRMTranscryptor :: Seek**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-seek) pour rechercher la position de départ appropriée dans le fichier.</span><span class="sxs-lookup"><span data-stu-id="2fe57-147">When your application's [**IWMStatusCallback::OnStatus**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmstatuscallback-onstatus) method receives the WMT\_TRANSCRYPTOR\_INIT status message, call the [**IWMDRMTranscryptor::Seek**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-seek) method to seek to the appropriate start position in the file.</span></span> <span data-ttu-id="2fe57-148">Pour commencer au début du fichier, vous devez appeler **Seek** avec l’heure 0.</span><span class="sxs-lookup"><span data-stu-id="2fe57-148">To start at the beginning of the file, you must call **Seek** with time 0.</span></span>
7.  <span data-ttu-id="2fe57-149">Le transchiffreur envoie un message de recherche de transchiffrement WMT \_ \_ lorsqu’il est prêt à fournir des données à partir du fichier au moment de la nouvelle présentation.</span><span class="sxs-lookup"><span data-stu-id="2fe57-149">The transcryptor sends a WMT\_TRANSCRYPTOR\_SEEKED message when it is ready to deliver data from the file at the new presentation time.</span></span> <span data-ttu-id="2fe57-150">Effectuez des appels répétés à la méthode [**IWMDRMTranscryptor :: Read**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-read) pour obtenir des blocs de données multimédias convertis.</span><span class="sxs-lookup"><span data-stu-id="2fe57-150">Make repeated calls to the [**IWMDRMTranscryptor::Read**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-read) method to get converted chunks of media data.</span></span> <span data-ttu-id="2fe57-151">Chaque appel est asynchrone et n’est pas terminé tant qu’un message de lecture de transcryptour WMT n’a pas \_ \_ été reçu.</span><span class="sxs-lookup"><span data-stu-id="2fe57-151">Each call is asynchronous and is not complete until a WMT\_TRANSCRYPTOR\_READ message is received.</span></span> <span data-ttu-id="2fe57-152">Lorsque vous recevez le message, vous pouvez envoyer les données à l’appareil de réception.</span><span class="sxs-lookup"><span data-stu-id="2fe57-152">When you receive the message, you can send the data to the receiving device.</span></span>
8.  <span data-ttu-id="2fe57-153">Lorsque vous recevez un message de lecture de transcryptour WMT \_ \_ avec le paramètre *HR* défini sur le paramètre \_ \_ EOF du transcrypteur NS \_ , le fichier entier a été lu.</span><span class="sxs-lookup"><span data-stu-id="2fe57-153">When you receive a WMT\_TRANSCRYPTOR\_READ message with the *hr* parameter set to NS\_S\_TRANSCRYPTOR\_EOF, the entire file has been read.</span></span> <span data-ttu-id="2fe57-154">À ce stade, appelez la méthode [**IWMDRMTranscryptor :: Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-close) pour fermer le fichier et libérer des ressources.</span><span class="sxs-lookup"><span data-stu-id="2fe57-154">At this point, call the [**IWMDRMTranscryptor::Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-close) method to close the file and free resources.</span></span>
9.  <span data-ttu-id="2fe57-155">Lorsque le message de déchiffrement WMT \_ \_ fermé est reçu, vous pouvez libérer l’interface [**IWMDRMTranscryptor**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmtranscryptor) .</span><span class="sxs-lookup"><span data-stu-id="2fe57-155">When the WMT\_TRANSCRYPTOR\_CLOSED message is received, you can release the [**IWMDRMTranscryptor**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmtranscryptor) interface.</span></span>

> [!Note]  
> <span data-ttu-id="2fe57-156">DRM n’est pas pris en charge par la version x64 de ce kit de développement logiciel (SDK).</span><span class="sxs-lookup"><span data-stu-id="2fe57-156">DRM is not supported by the x64-based version of this SDK.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="2fe57-157">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="2fe57-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2fe57-158">**Utilisation du protocole Windows Media DRM 10 pour les périphériques réseau**</span><span class="sxs-lookup"><span data-stu-id="2fe57-158">**Using the Windows Media DRM 10 for Network Devices Protocol**</span></span>](using-the-windows-media-drm-10-for-network-devices-protocol.md)
</dt> </dl>

 

 




