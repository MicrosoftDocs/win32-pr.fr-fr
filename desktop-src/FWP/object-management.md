---
title: Gestion des objets
description: Cette section décrit l’utilisation correcte des types d’objets de l’API WFP (Windows Filtering Platform).
ms.assetid: 2625ef9a-0e62-4e21-ba93-047965d0d782
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc41560bb85a7e79c0262d77c0b34fe6c1d9bfd6
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104463039"
---
# <a name="object-management"></a><span data-ttu-id="773ab-103">Gestion des objets</span><span class="sxs-lookup"><span data-stu-id="773ab-103">Object Management</span></span>

<span data-ttu-id="773ab-104">Cette section décrit l’utilisation correcte des types d’objets de l’API WFP (Windows Filtering Platform).</span><span class="sxs-lookup"><span data-stu-id="773ab-104">This section covers the correct use of Windows Filtering Platform (WFP) API object types.</span></span>

## <a name="sessions"></a><span data-ttu-id="773ab-105">Sessions</span><span class="sxs-lookup"><span data-stu-id="773ab-105">Sessions</span></span>

<span data-ttu-id="773ab-106">L’API WFP est orientée session, et la plupart des appels de fonction sont effectués dans le contexte d’une session.</span><span class="sxs-lookup"><span data-stu-id="773ab-106">The WFP API is session-oriented, and most function calls are made within the context of a session.</span></span> <span data-ttu-id="773ab-107">Une nouvelle session cliente est créée en appelant [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span><span class="sxs-lookup"><span data-stu-id="773ab-107">A new client session is created by calling [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span></span> <span data-ttu-id="773ab-108">La session se termine lorsque le client appelle [**FwpmEngineClose0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineclose0) ou que le processus client se termine.</span><span class="sxs-lookup"><span data-stu-id="773ab-108">The session ends either when the client calls [**FwpmEngineClose0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineclose0) or the client process terminates.</span></span> <span data-ttu-id="773ab-109">Lorsqu’une session est détruite, soit à des fins, soit par l’arrêt RPC, le moteur de filtrage de base (BFE) abandonne tout d’abord toute transaction existante.</span><span class="sxs-lookup"><span data-stu-id="773ab-109">When a session is destroyed, either on purpose or by the RPC rundown, the Base Filtering Engine (BFE) first aborts any existing transaction.</span></span>

<span data-ttu-id="773ab-110">Lors de la création d’une nouvelle session, l’appelant peut créer une session dynamique en passant l’indicateur dynamique de l' [**\_ \_ indicateur \_ de session FWPM**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) à [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span><span class="sxs-lookup"><span data-stu-id="773ab-110">When creating a new session, the caller can create a dynamic session by passing the [**FWPM\_SESSION\_FLAG\_DYNAMIC**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) flag to [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span></span> <span data-ttu-id="773ab-111">Tout objet ajouté au cours d’une session dynamique est automatiquement supprimé à la fin de la session.</span><span class="sxs-lookup"><span data-stu-id="773ab-111">Any objects added during a dynamic session are automatically deleted when the session ends.</span></span>

## <a name="transactions"></a><span data-ttu-id="773ab-112">Transactions</span><span class="sxs-lookup"><span data-stu-id="773ab-112">Transactions</span></span>

<span data-ttu-id="773ab-113">L’API WFP est transactionnelle, et la plupart des appels de fonction sont effectués dans le contexte d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="773ab-113">The WFP API is transactional, and most function calls are made within the context of a transaction.</span></span> <span data-ttu-id="773ab-114">Les appelants peuvent utiliser [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0), [**FwpmTransactionCommit0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactioncommit0)et [**FwpmTransactionAbort0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionabort0) pour contrôler explicitement les transactions.</span><span class="sxs-lookup"><span data-stu-id="773ab-114">Callers can use [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0), [**FwpmTransactionCommit0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactioncommit0), and [**FwpmTransactionAbort0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionabort0) to explicitly control transactions.</span></span> <span data-ttu-id="773ab-115">Toutefois, si un appel de fonction est effectué en dehors d’une transaction explicite, il est exécuté dans une transaction implicite.</span><span class="sxs-lookup"><span data-stu-id="773ab-115">However, if a function call is made outside of an explicit transaction, it will be executed within an implicit transaction.</span></span> <span data-ttu-id="773ab-116">Si une transaction est en cours, lorsqu’une session se termine, elle est automatiquement abandonnée.</span><span class="sxs-lookup"><span data-stu-id="773ab-116">If a transaction is in progress, when a session terminates, it is automatically aborted.</span></span> <span data-ttu-id="773ab-117">Les transactions implicites ne sont jamais abandonnées de force.</span><span class="sxs-lookup"><span data-stu-id="773ab-117">Implicit transactions are never forcibly aborted.</span></span>

<span data-ttu-id="773ab-118">Les transactions sont en lecture seule ou en lecture/écriture et appliquent une sémantique rigoureusement fiable, à durabilité atomique ([acid](../cossdk/acid-properties.md)).</span><span class="sxs-lookup"><span data-stu-id="773ab-118">Transactions are either read-only or read/write and enforce rigorous Atomic Consistent Isolated Durable ([ACID](../cossdk/acid-properties.md)) semantics.</span></span>

<span data-ttu-id="773ab-119">Chaque session cliente ne peut avoir qu’une seule transaction en cours à la fois.</span><span class="sxs-lookup"><span data-stu-id="773ab-119">Each client session can have only one transaction in progress at a time.</span></span> <span data-ttu-id="773ab-120">Si l’appelant tente de commencer une deuxième transaction avant de valider ou d’abandonner le premier, BFE renvoie une erreur.</span><span class="sxs-lookup"><span data-stu-id="773ab-120">If the caller attempts to begin a second transaction before committing or aborting the first, BFE returns an error.</span></span>

<span data-ttu-id="773ab-121">Si une opération échoue au cours d’une transaction, elle n’affecte pas l’état global de la transaction.</span><span class="sxs-lookup"><span data-stu-id="773ab-121">If an operation fails during the course of a transaction, it does not affect the overall state of the transaction.</span></span> <span data-ttu-id="773ab-122">Par exemple, supposons que le client commence une transaction et appelle [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) trois fois avant l’échec d’un quatrième appel.</span><span class="sxs-lookup"><span data-stu-id="773ab-122">For example, suppose the client begins a transaction and successfully calls [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) three times before a fourth call fails.</span></span> <span data-ttu-id="773ab-123">Le client a désormais la possibilité de :</span><span class="sxs-lookup"><span data-stu-id="773ab-123">The client now has the option of:</span></span>

-   <span data-ttu-id="773ab-124">Abandon de la transaction, auquel cas aucun des filtres ne sera ajouté.</span><span class="sxs-lookup"><span data-stu-id="773ab-124">Aborting the transaction, in which case none of the filters will be added.</span></span>
-   <span data-ttu-id="773ab-125">La validation de la transaction, auquel cas les trois premiers filtres sont ajoutés.</span><span class="sxs-lookup"><span data-stu-id="773ab-125">Committing the transaction, in which case the first three filters will be added.</span></span>
-   <span data-ttu-id="773ab-126">Poursuivre avec davantage d’opérations, y compris une nouvelle tentative potentielle d’échec de [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span><span class="sxs-lookup"><span data-stu-id="773ab-126">Continuing with more operations including potentially retrying the failed [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span></span>

<span data-ttu-id="773ab-127">Au début d’une transaction, BFE attend que le [**txnWaitTimeoutInMSec**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) de la session expire pour acquérir le verrou.</span><span class="sxs-lookup"><span data-stu-id="773ab-127">When beginning a transaction, BFE will wait until the session's [**txnWaitTimeoutInMSec**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) expires to acquire the lock.</span></span> <span data-ttu-id="773ab-128">Si le verrou n’est pas acquis dans ce délai, l’acquisition de verrou (et l’appel [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0) ) échoue.</span><span class="sxs-lookup"><span data-stu-id="773ab-128">If the lock is not acquired within this time, the lock acquisition (and the [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0) call) will fail.</span></span> <span data-ttu-id="773ab-129">Cela évite que les clients ne parviennent pas indéfiniment à répondre.</span><span class="sxs-lookup"><span data-stu-id="773ab-129">This prevents clients from indefinitely failing to respond.</span></span> <span data-ttu-id="773ab-130">Si le client n’a pas spécifié de délai d’attente de verrouillage, sa valeur par défaut est de 15 secondes.</span><span class="sxs-lookup"><span data-stu-id="773ab-130">If the client did not specify a lock timeout, it defaults to 15 seconds.</span></span>

<span data-ttu-id="773ab-131">Chaque transaction a également un délai de verrouillage.</span><span class="sxs-lookup"><span data-stu-id="773ab-131">Each transaction also has a lock timeout.</span></span> <span data-ttu-id="773ab-132">Il s’agit de la durée maximale pendant laquelle il peut être propriétaire du verrou.</span><span class="sxs-lookup"><span data-stu-id="773ab-132">This is the maximum amount of time that it can own the lock.</span></span> <span data-ttu-id="773ab-133">Si le propriétaire ne libère pas le verrou dans ce délai, la transaction est abandonnée de force, ce qui entraîne la libération du verrou.</span><span class="sxs-lookup"><span data-stu-id="773ab-133">If the owner does not release the lock within this time, the transaction is forcibly aborted, causing the lock to be released.</span></span> <span data-ttu-id="773ab-134">Le délai d’attente de verrouillage n’est pas configurable.</span><span class="sxs-lookup"><span data-stu-id="773ab-134">The lock timeout is not configurable.</span></span> <span data-ttu-id="773ab-135">Elle est infinie pour les appelants en mode noyau et une heure pour les appelants en mode utilisateur.</span><span class="sxs-lookup"><span data-stu-id="773ab-135">It is infinite for kernel-mode callers and one hour for user-mode callers.</span></span> <span data-ttu-id="773ab-136">Si une transaction est abandonnée de force, l’appel suivant effectué dans la transaction échoue avec l' **abandon de l' \_ \_ TXN \_ fwp E**.</span><span class="sxs-lookup"><span data-stu-id="773ab-136">If a transaction is forcibly aborted, the next call made within that transaction will fail with **FWP\_E\_TXN\_ABORTED**.</span></span>

## <a name="object-lifetimes"></a><span data-ttu-id="773ab-137">Durées de vie des objets</span><span class="sxs-lookup"><span data-stu-id="773ab-137">Object Lifetimes</span></span>

<span data-ttu-id="773ab-138">Les objets peuvent avoir l’une des quatre durées de vie possibles :</span><span class="sxs-lookup"><span data-stu-id="773ab-138">Objects can have one of four possible lifetimes:</span></span>

-   <span data-ttu-id="773ab-139">Dynamique : un objet est dynamique uniquement s’il est ajouté à l’aide d’un handle de session dynamique.</span><span class="sxs-lookup"><span data-stu-id="773ab-139">Dynamic — An object is dynamic only if it is added using a dynamic session handle.</span></span> <span data-ttu-id="773ab-140">Objets dynamiques en direct jusqu’à ce qu’ils soient supprimés ou que la session propriétaire se termine.</span><span class="sxs-lookup"><span data-stu-id="773ab-140">Dynamic objects live until they are deleted or the owning session terminates.</span></span>
-   <span data-ttu-id="773ab-141">Statiques : les objets sont statiques par défaut.</span><span class="sxs-lookup"><span data-stu-id="773ab-141">Static — Objects are static by default.</span></span> <span data-ttu-id="773ab-142">Objets statiques actifs jusqu’à ce qu’ils soient supprimés, BFE s’arrête ou le système est arrêté.</span><span class="sxs-lookup"><span data-stu-id="773ab-142">Static objects live until they are deleted, BFE stops, or the system is shutdown.</span></span>
-   <span data-ttu-id="773ab-143">Persistants : les objets persistants sont créés en passant l’indicateur **\_ \* \_ \_ persistant de l’indicateur FWPM** approprié à une fonction **FWPM \* Add0** .</span><span class="sxs-lookup"><span data-stu-id="773ab-143">Persistent — Persistent objects are created by passing the appropriate **FWPM\_\*\_FLAG\_PERSISTENT** flag to an **Fwpm\*Add0** function.</span></span> <span data-ttu-id="773ab-144">Objets persistants en direct jusqu’à ce qu’ils soient supprimés.</span><span class="sxs-lookup"><span data-stu-id="773ab-144">Persistent objects live until they are deleted.</span></span>
-   <span data-ttu-id="773ab-145">Intégré : les objets intégrés sont prédéfinis par BFE et ne peuvent pas être ajoutés ou supprimés.</span><span class="sxs-lookup"><span data-stu-id="773ab-145">Built-in — Built-in objects are predefined by BFE and cannot be added or deleted.</span></span> <span data-ttu-id="773ab-146">Ils vivent toujours.</span><span class="sxs-lookup"><span data-stu-id="773ab-146">They live forever.</span></span>

<span data-ttu-id="773ab-147">Les filtres des couches en mode noyau peuvent être marqués comme filtres au moment du démarrage en passant l’indicateur approprié à [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span><span class="sxs-lookup"><span data-stu-id="773ab-147">Filters in kernel-mode layers can be marked as boot-time filters by passing the appropriate flag to [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span></span> <span data-ttu-id="773ab-148">Les filtres au moment du démarrage sont ajoutés au système lorsque le pilote TCP/IP démarre et supprimés lors de la fin de l’initialisation de BFE.</span><span class="sxs-lookup"><span data-stu-id="773ab-148">Boot-time filters are added to the system when the TCP/IP driver starts, and removed when BFE finishes initialization.</span></span> <span data-ttu-id="773ab-149">Les objets persistants sont ajoutés au démarrage de BFE.</span><span class="sxs-lookup"><span data-stu-id="773ab-149">Persistent objects are added when BFE starts.</span></span>

<span data-ttu-id="773ab-150">Dans de nombreux cas, il est possible qu’un fournisseur de stratégie ne souhaite pas que sa stratégie persistante soit appliquée si le fournisseur a été désactivé.</span><span class="sxs-lookup"><span data-stu-id="773ab-150">In many cases, a policy provider may not want its persistent policy enforced if the provider has been disabled.</span></span> <span data-ttu-id="773ab-151">Lorsque vous ajoutez un fournisseur, l’appelant peut spécifier un nom de service Windows facultatif.</span><span class="sxs-lookup"><span data-stu-id="773ab-151">When adding a provider, the caller can specify an optional Windows service name.</span></span> <span data-ttu-id="773ab-152">Lors de l’ajout d’objets persistants, l’appelant peut éventuellement spécifier le fournisseur qui « possède » cet objet.</span><span class="sxs-lookup"><span data-stu-id="773ab-152">When adding persistent objects, the caller can optionally specify the provider that "owns" that object.</span></span> <span data-ttu-id="773ab-153">Au démarrage du service, BFE ajoute uniquement des objets persistants au système s’ils ne sont pas associés à un fournisseur, ou si le fournisseur associé ne possède pas de nom de service Windows, ou si le service Windows associé est configuré pour démarrer automatiquement.</span><span class="sxs-lookup"><span data-stu-id="773ab-153">At service start, BFE only adds persistent objects to the system if they are not associated with a provider, or the associated provider has no Windows service name, or the associated Windows service is set to auto-start.</span></span>

## <a name="object-associations"></a><span data-ttu-id="773ab-154">Associations d’objets</span><span class="sxs-lookup"><span data-stu-id="773ab-154">Object Associations</span></span>

<span data-ttu-id="773ab-155">Certains objets comportent des références à d’autres objets.</span><span class="sxs-lookup"><span data-stu-id="773ab-155">Some objects have references to other objects.</span></span> <span data-ttu-id="773ab-156">Par exemple, un filtre fait toujours référence à une couche et peut faire référence à une légende et à un contexte de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="773ab-156">For example, a filter always references a layer and may reference a callout and a provider context.</span></span> <span data-ttu-id="773ab-157">Les objets ne peuvent pas faire référence à des objets qui peuvent avoir une durée de vie plus réduite.</span><span class="sxs-lookup"><span data-stu-id="773ab-157">Objects cannot refer to objects that may have a shorter lifetime.</span></span> <span data-ttu-id="773ab-158">Ainsi, un objet dynamique ne peut pas faire référence à un objet dynamique à partir d’une autre session.</span><span class="sxs-lookup"><span data-stu-id="773ab-158">Thus, a dynamic object cannot refer to a dynamic object from a different session.</span></span> <span data-ttu-id="773ab-159">Un objet statique ne peut pas faire référence à un objet dynamique.</span><span class="sxs-lookup"><span data-stu-id="773ab-159">A static object cannot refer to a dynamic object.</span></span> <span data-ttu-id="773ab-160">Un objet persistant ne peut pas faire référence à un objet dynamique, à un objet statique ou à un objet persistant appartenant à un autre fournisseur.</span><span class="sxs-lookup"><span data-stu-id="773ab-160">A persistent object cannot refer to a dynamic object, a static object, or a persistent object owned by a different provider.</span></span>

<span data-ttu-id="773ab-161">Un objet ne peut pas être supprimé tant que tous les objets qui y font référence n’ont pas été supprimés.</span><span class="sxs-lookup"><span data-stu-id="773ab-161">An object cannot be deleted until all objects that reference it have first been deleted.</span></span>

## <a name="luids-and-guids"></a><span data-ttu-id="773ab-162">LUID et GUID</span><span class="sxs-lookup"><span data-stu-id="773ab-162">LUIDs and GUIDs</span></span>

<span data-ttu-id="773ab-163">Tous les objets API WFP en mode utilisateur (FWPM) sont identifiés par un identificateur global unique (**GUID**) et font référence à d’autres objets par leur **GUID**.</span><span class="sxs-lookup"><span data-stu-id="773ab-163">All user mode WFP API objects (FWPM) are identified by a globally unique identifier (**GUID**) and reference other objects by their **GUID** s.</span></span> <span data-ttu-id="773ab-164">Le **GUID** doit uniquement être unique dans le type d’objet.</span><span class="sxs-lookup"><span data-stu-id="773ab-164">The **GUID** need only be unique within the object type.</span></span> <span data-ttu-id="773ab-165">Par exemple, un filtre et un contexte de fournisseur peuvent avoir le même **GUID**, mais deux filtres ne le peuvent pas.</span><span class="sxs-lookup"><span data-stu-id="773ab-165">For example, a filter and a provider context can have the same **GUID**, but two filters cannot.</span></span> <span data-ttu-id="773ab-166">Lors de l’ajout d’un nouvel objet, les appelants peuvent assigner le **GUID** de l’objet ou le laisser initialisé à zéro et laisser BFE attribuer le **GUID**.</span><span class="sxs-lookup"><span data-stu-id="773ab-166">When adding a new object, callers can assign the object's **GUID** or leave it zero-initialized and let BFE assign the **GUID**.</span></span>

<span data-ttu-id="773ab-167">Tous les objets API WFP en mode noyau (FWPS) sont identifiés par un identificateur unique local (**LUID**) et référencent d’autres objets par leur LUID.</span><span class="sxs-lookup"><span data-stu-id="773ab-167">All kernel mode WFP API objects (FWPS) are identified by a locally unique identifier (**LUID**) and reference other objects by their LUID.</span></span> <span data-ttu-id="773ab-168">Le passage du **GUID** au **LUID** permet à WFP de conserver les pools non paginés et d’optimiser le traitement au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="773ab-168">The switch from **GUID** to **LUID** enables WFP to conserve non-paged pool and optimize run-time processing.</span></span> <span data-ttu-id="773ab-169">La largeur du **LUID** dépend du type d’objet et des plages d’un **UINT16** à un **UINT64**.</span><span class="sxs-lookup"><span data-stu-id="773ab-169">The width of the **LUID** depends on the object type and ranges from a **UINT16** to a **UINT64**.</span></span> <span data-ttu-id="773ab-170">Les **LUID** s sont toujours attribuées par BFE.</span><span class="sxs-lookup"><span data-stu-id="773ab-170">**LUID** s are always assigned by BFE.</span></span>

 

 