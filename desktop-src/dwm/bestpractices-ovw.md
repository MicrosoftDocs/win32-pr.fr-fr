---
title: Considérations sur les performances et meilleures pratiques
description: Cette rubrique présente un ensemble de meilleures pratiques pour l’utilisation des API Gestionnaire de fenêtrage (DWM).
ms.assetid: 5b1f6ff8-1d3f-4a70-8efd-90f8802e8532
keywords:
- Gestionnaire de fenêtrage (DWM), meilleures pratiques
- DWM (Gestionnaire de fenêtrage), meilleures pratiques
- Gestionnaire de fenêtrage (DWM), applications pratiques
- DWM (Gestionnaire de fenêtrage), applications pratiques
- Gestionnaire de fenêtrage (DWM), pratiques de dessin
- DWM (Gestionnaire de fenêtrage), pratiques de dessin
- Gestionnaire de fenêtrage (DWM), flou derrière l’effet
- DWM (Gestionnaire de fenêtrage), flou derrière l’effet
- applications pratiques
- pratiques de dessin
- flou derrière l’effet
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ec76a4920a91f9502940e866d58641a2550d9354
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "106510898"
---
# <a name="performance-considerations-and-best-practices"></a><span data-ttu-id="82372-114">Considérations sur les performances et meilleures pratiques</span><span class="sxs-lookup"><span data-stu-id="82372-114">Performance Considerations and Best Practices</span></span>

<span data-ttu-id="82372-115">Cette rubrique présente un ensemble de meilleures pratiques pour l’utilisation des API Gestionnaire de fenêtrage (DWM).</span><span class="sxs-lookup"><span data-stu-id="82372-115">This topic presents a set of best practices for using the Desktop Window Manager (DWM) APIs.</span></span>

<span data-ttu-id="82372-116">Cette rubrique contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="82372-116">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="82372-117">Applications pratiques pour DWM</span><span class="sxs-lookup"><span data-stu-id="82372-117">Application Practices for DWM</span></span>](#application-practices-for-dwm)
-   [<span data-ttu-id="82372-118">Pratiques de dessin pour DWM</span><span class="sxs-lookup"><span data-stu-id="82372-118">Drawing Practices for DWM</span></span>](#drawing-practices-for-dwm)
-   [<span data-ttu-id="82372-119">DWM Blur-Behind région cliente</span><span class="sxs-lookup"><span data-stu-id="82372-119">DWM Blur-Behind Client Region</span></span>](#dwm-blur-behind-client-region)

## <a name="application-practices-for-dwm"></a><span data-ttu-id="82372-120">Applications pratiques pour DWM</span><span class="sxs-lookup"><span data-stu-id="82372-120">Application Practices for DWM</span></span>

<span data-ttu-id="82372-121">Si votre application gère la mise à l’échelle en points par pouce (dpi), vous pouvez déclarer une application avec prise en charge DPI et empêcher la mise à l’échelle automatique en définissant l’indicateur de prise en charge DPI dans le manifeste du programme ou en appelant la fonction [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) lors de l’initialisation du programme.</span><span class="sxs-lookup"><span data-stu-id="82372-121">If your application handles dots per inch (dpi) scaling, you can declare an application as dpi-aware and prevent automatic scaling by setting the dpi-aware flag in the program's manifest or by calling the [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) function during program initialization.</span></span>

<span data-ttu-id="82372-122">Avec la composition DWM activée, les applications masquées ne reçoivent plus de messages de [**\_ peinture WM**](/windows/desktop/gdi/wm-paint) et ne sont pas invitées à effectuer un nouveau rendu.</span><span class="sxs-lookup"><span data-stu-id="82372-122">With DWM composition turned on, obscured applications no longer receive [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) messages and are not asked to re-render.</span></span> <span data-ttu-id="82372-123">Le contenu de chaque fenêtre est déjà disponible pour composer l’image de l’écran.</span><span class="sxs-lookup"><span data-stu-id="82372-123">Each window's content is already available to compose the screen image.</span></span>

<span data-ttu-id="82372-124">Les fenêtres de niveau supérieur des fenêtres [**WS \_ ex \_ transparent**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) doivent être combinées avec un style de **couche WS par \_ \_ couche** à des fins de test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="82372-124">Top-level [**WS\_EX\_TRANSPARENT**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) windows should be combined with a **WS\_EX\_LAYERED** style for the purposes of hit testing.</span></span> <span data-ttu-id="82372-125">**WS \_ Par \_ exemple** , le sens classique, sans redirection, est utile pour les fenêtres enfants dans une hiérarchie de fenêtres qui appartiennent au même thread, mais n’est pas destiné aux fenêtres de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="82372-125">**WS\_EX\_TRANSPARENT** in the classic sense, without redirection, is useful for child windows in a hierarchy of windows that belong to the same thread, but is not intended for top-level windows.</span></span>

<span data-ttu-id="82372-126">Utilisez des régions ou des couches pour créer des fenêtres mises en forme ou mélangées.</span><span class="sxs-lookup"><span data-stu-id="82372-126">Use regions or layering to create shaped or blended windows.</span></span> <span data-ttu-id="82372-127">Notez que dans Windows Vista et les versions ultérieures de Windows, le fait de dessiner uniquement une partie d’une fenêtre de niveau supérieur ne fournit pas le contenu obsolète souhaité dans les régions non dessinées.</span><span class="sxs-lookup"><span data-stu-id="82372-127">Note that in Windows Vista and later versions of Windows, custom drawing only part of a top-level window will not provide the desired stale content in undrawn regions.</span></span>

<span data-ttu-id="82372-128">Des API telles que [**GetDCOrgEx**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) peuvent être utilisées pour déterminer certaines valeurs réelles.</span><span class="sxs-lookup"><span data-stu-id="82372-128">APIs such as [**GetDCOrgEx**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) can be used to determine certain actual values.</span></span> <span data-ttu-id="82372-129">Si vous avez un contexte de périphérique (DC) pour une fenêtre redirigée, l’origine retournée par **GetDCOrgEx** ne correspondra pas à l’origine de votre fenêtre à l’écran.</span><span class="sxs-lookup"><span data-stu-id="82372-129">If you have a device context (DC) for a redirected window, the origin returned by **GetDCOrgEx** will not match the origin of your window on the screen.</span></span> <span data-ttu-id="82372-130">L’origine sera à la place l’origine de la surface de la mémoire tampon d’arrière-plan pour votre fenêtre : (0,0).</span><span class="sxs-lookup"><span data-stu-id="82372-130">The origin will instead be the origin of the back-buffer surface for your window: (0, 0).</span></span>

<span data-ttu-id="82372-131">Si tout le reste échoue, désactivez le rendu de fenêtre en appelant la fonction [**DwmSetWindowAttribute**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) .</span><span class="sxs-lookup"><span data-stu-id="82372-131">When all else fails, disable window rendering by calling the [**DwmSetWindowAttribute**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) function.</span></span>

## <a name="drawing-practices-for-dwm"></a><span data-ttu-id="82372-132">Pratiques de dessin pour DWM</span><span class="sxs-lookup"><span data-stu-id="82372-132">Drawing Practices for DWM</span></span>

<span data-ttu-id="82372-133">Évitez de dessiner directement sur la surface d’affichage principale.</span><span class="sxs-lookup"><span data-stu-id="82372-133">Avoid drawing directly to the primary display surface.</span></span> <span data-ttu-id="82372-134">Cela forcera le DWM à désactiver la composition jusqu’à ce que votre application libère la surface de l’appareil principal.</span><span class="sxs-lookup"><span data-stu-id="82372-134">Doing so will force the DWM to disable composition until your application releases the primary device surface.</span></span>

<span data-ttu-id="82372-135">Déterminez si votre application doit fournir sa propre double mise en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="82372-135">Evaluate whether your application must provide its own double buffering.</span></span> <span data-ttu-id="82372-136">Le DWM double effectivement la mémoire tampon du contenu et affiche la fenêtre dans un seul Frame.</span><span class="sxs-lookup"><span data-stu-id="82372-136">The DWM effectively double buffers content and presents the window in a single frame.</span></span>

<span data-ttu-id="82372-137">Évitez de lire ou d’écrire sur un contrôleur de périphérique d’affichage.</span><span class="sxs-lookup"><span data-stu-id="82372-137">Avoid reading from or writing to a display DC.</span></span> <span data-ttu-id="82372-138">Bien qu’il soit pris en charge par DWM, nous ne le recommandons pas en raison de la baisse des performances.</span><span class="sxs-lookup"><span data-stu-id="82372-138">Although supported by DWM, we do not recommend it because of decreased performance.</span></span>

<span data-ttu-id="82372-139">Évitez de dessiner dans la zone non cliente.</span><span class="sxs-lookup"><span data-stu-id="82372-139">Avoid drawing in the non-client area.</span></span> <span data-ttu-id="82372-140">Bien que cette zone soit accessible par l’application et que le dessin soit pris en charge par l’API Microsoft Win32, cela peut entraîner la perte de la bordure de la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="82372-140">Although this area can be accessed by the application, and drawing there is supported by the Microsoft Win32 API, doing this can cause the window to lose any glass border it has.</span></span>

<span data-ttu-id="82372-141">Évitez de mélanger Windows Graphics Device Interface (GDI) et Microsoft DirectX, sauf s’ils ne se chevauchent pas.</span><span class="sxs-lookup"><span data-stu-id="82372-141">Avoid mixing Windows Graphics Device Interface (GDI) and Microsoft DirectX unless they do not overlap.</span></span> <span data-ttu-id="82372-142">Si la combinaison est nécessaire, dessinez le contenu GDI dans une surface DirectX et associez-le avant de le composer, ou bien dessinez-le dans des fenêtres distinctes.</span><span class="sxs-lookup"><span data-stu-id="82372-142">If mixing is necessary, either draw the GDI content into a DirectX software surface and combine them before composing to the screen, or else draw them in separate windows.</span></span>

<span data-ttu-id="82372-143">Utilisez la fonction [**BitBlt**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) ou [**StretchBlt**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) au lieu de Windows GDI+ pour présenter votre dessin en vue d’un rendu.</span><span class="sxs-lookup"><span data-stu-id="82372-143">Use [**BitBlt**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) or [**StretchBlt**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) function instead of Windows GDI+ to present your drawing for rendering.</span></span> <span data-ttu-id="82372-144">GDI+ affiche une ligne d’analyse à la fois avec le rendu logiciel.</span><span class="sxs-lookup"><span data-stu-id="82372-144">GDI+ renders one scan line at a time with software rendering.</span></span> <span data-ttu-id="82372-145">Cela peut entraîner un scintillement dans vos applications.</span><span class="sxs-lookup"><span data-stu-id="82372-145">This can cause flickering in your applications.</span></span>

## <a name="dwm-blur-behind-client-region"></a><span data-ttu-id="82372-146">DWM Blur-Behind région cliente</span><span class="sxs-lookup"><span data-stu-id="82372-146">DWM Blur-Behind Client Region</span></span>

<span data-ttu-id="82372-147">Le rendu de l’effet Flou-behind est une opération gourmande en ressources pour le processeur et l’unité de traitement graphique (GPU).</span><span class="sxs-lookup"><span data-stu-id="82372-147">Rendering the blur-behind effect is a resource-intensive operation for both the CPU and the graphics processing unit (GPU).</span></span> <span data-ttu-id="82372-148">Les développeurs d’applications sont invités à prendre en compte les implications de l’utilisation de l’atténuation de la zone cliente afin qu’elle ne consomme pas de ressources excessives.</span><span class="sxs-lookup"><span data-stu-id="82372-148">Application developers are urged to consider the implications of using client-area blur so that it does not consume excessive resources.</span></span> <span data-ttu-id="82372-149">Vous devez être particulièrement vigilant dans les cas suivants :</span><span class="sxs-lookup"><span data-stu-id="82372-149">You should use particular caution in the following cases:</span></span>

-   <span data-ttu-id="82372-150">Lorsque vous vous attendez à ce que la taille du flou de la zone client soit significative, même si aucune mise à jour ne se produit dans la zone floue elle-même.</span><span class="sxs-lookup"><span data-stu-id="82372-150">When you expect the size of the client-area blur to be significant, even if no updates will occur in the blurred area itself.</span></span> <span data-ttu-id="82372-151">Le flou doit être rendu au cas où des mises à jour se produiront sous la zone floue de la fenêtre, ce qui entraîne des coûts d’UC et de GPU.</span><span class="sxs-lookup"><span data-stu-id="82372-151">The blur has to be rendered in case any updates occur under the blurred area of the window, which incurs CPU and GPU costs.</span></span> <span data-ttu-id="82372-152">En outre, les opérations de fenêtre sur la fenêtre (déplacement/redimensionnement/transitions) entraînent davantage de coûts.</span><span class="sxs-lookup"><span data-stu-id="82372-152">In addition, window operations on the window (move/resize/transitions) will incur more costs.</span></span>
-   <span data-ttu-id="82372-153">Quand vous vous attendez à des mises à jour importantes dans la zone cliente floue.</span><span class="sxs-lookup"><span data-stu-id="82372-153">When you expect significant updates in the blurred client area.</span></span> <span data-ttu-id="82372-154">Cela nécessitera un redessin du flou sur chaque mise à jour et consommera des ressources excessives.</span><span class="sxs-lookup"><span data-stu-id="82372-154">This will require a repaint of the blur on every update and consume excessive resources.</span></span>
-   <span data-ttu-id="82372-155">Si le flou est supposé couvrir une zone importante et que les mises à jour de cette zone sont également prévues, nous vous recommandons vivement de ne pas brouiller la zone cliente.</span><span class="sxs-lookup"><span data-stu-id="82372-155">If the blur is expected to cover a significant area, and updates to that area are also expected, we strongly recommended that you do not blur the client area.</span></span>

 

 