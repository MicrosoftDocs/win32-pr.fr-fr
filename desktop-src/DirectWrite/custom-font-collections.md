---
title: Collections de polices personnalisées (Windows 7/8)
description: DirectWrite permet d’accéder à la collection de polices système à l’aide de la méthode IDWriteFactory GetSystemFontCollection.
ms.assetid: ec892904-6778-4fbd-93b4-62d0db5b82ea
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 39aa764330f27b72051ef682c6ce5f1176c42c7d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103728684"
---
# <a name="custom-font-collections-windows-78"></a><span data-ttu-id="ccafa-103">Collections de polices personnalisées (Windows 7/8)</span><span class="sxs-lookup"><span data-stu-id="ccafa-103">Custom Font Collections (Windows 7/8)</span></span>

<span data-ttu-id="ccafa-104">[DirectWrite](direct-write-portal.md) permet d’accéder à la collection de polices système à l’aide de la méthode [**IDWriteFactory :: GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) .</span><span class="sxs-lookup"><span data-stu-id="ccafa-104">[DirectWrite](direct-write-portal.md) provides access to the system font collection by using the [**IDWriteFactory::GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) method.</span></span> <span data-ttu-id="ccafa-105">Il s’agit de la collection de polices la plus fréquemment utilisée.</span><span class="sxs-lookup"><span data-stu-id="ccafa-105">This is the font collection that is most frequently used.</span></span> <span data-ttu-id="ccafa-106">Toutefois, certaines applications doivent utiliser des polices qui ne sont pas installées sur le système, telles que des fichiers de polices inclus ou des fichiers de police incorporés dans l’application.</span><span class="sxs-lookup"><span data-stu-id="ccafa-106">However some applications have to use fonts that are not installed on the system, such as from included font files or font files embedded in the application.</span></span>

<span data-ttu-id="ccafa-107">Si les polices que vous souhaitez ne sont pas dans la collection de polices système, vous pouvez créer une collection de polices personnalisée dérivée de [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection).</span><span class="sxs-lookup"><span data-stu-id="ccafa-107">If the fonts that you want are not in the system font collection, you can create a custom font collection derived from [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection).</span></span>

<span data-ttu-id="ccafa-108">Cette vue d’ensemble se compose des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="ccafa-108">This overview consists of the following parts:</span></span>

-   [<span data-ttu-id="ccafa-109">Inscription et annulation de l’inscription d’un chargeur de collection de polices</span><span class="sxs-lookup"><span data-stu-id="ccafa-109">Registering and unregistering a Font Collection Loader</span></span>](#registering-and-unregistering-a-font-collection-loader)
-   [<span data-ttu-id="ccafa-110">IDWriteFontCollectionLoader</span><span class="sxs-lookup"><span data-stu-id="ccafa-110">IDWriteFontCollectionLoader</span></span>](#idwritefontcollectionloader)
-   [<span data-ttu-id="ccafa-111">IDWriteFontFileEnumerator</span><span class="sxs-lookup"><span data-stu-id="ccafa-111">IDWriteFontFileEnumerator</span></span>](#idwritefontfileenumerator)
-   [<span data-ttu-id="ccafa-112">CreateCustomFontFileReference</span><span class="sxs-lookup"><span data-stu-id="ccafa-112">CreateCustomFontFileReference</span></span>](#createcustomfontfilereference)
-   [<span data-ttu-id="ccafa-113">IDWriteFontFileLoader</span><span class="sxs-lookup"><span data-stu-id="ccafa-113">IDWriteFontFileLoader</span></span>](#idwritefontfileloader)
-   [<span data-ttu-id="ccafa-114">IDWriteFontFileStream</span><span class="sxs-lookup"><span data-stu-id="ccafa-114">IDWriteFontFileStream</span></span>](#idwritefontfilestream)

## <a name="registering-and-unregistering-a-font-collection-loader"></a><span data-ttu-id="ccafa-115">Inscription et annulation de l’inscription d’un chargeur de collection de polices</span><span class="sxs-lookup"><span data-stu-id="ccafa-115">Registering and unregistering a Font Collection Loader</span></span>

<span data-ttu-id="ccafa-116">Vous inscrivez un chargeur de collection de polices à l’aide de la méthode [**IDWriteFactory :: RegisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontcollectionloader) et en lui transmettant une interface [**IDWriteFontCollectionLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) implémentée par l’application en tant qu’objet singleton.</span><span class="sxs-lookup"><span data-stu-id="ccafa-116">You register a font collection loader by using the [**IDWriteFactory::RegisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontcollectionloader) method and passing it an [**IDWriteFontCollectionLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) interface implemented by the application as a singleton object.</span></span> <span data-ttu-id="ccafa-117">Cet objet chargera les polices lorsque la collection personnalisée sera demandée.</span><span class="sxs-lookup"><span data-stu-id="ccafa-117">This object will load the fonts when the custom collection is requested.</span></span> <span data-ttu-id="ccafa-118">La collection de polices système et les collections de polices personnalisées sont mises en cache, de sorte que les polices ne sont chargées qu’une seule fois.</span><span class="sxs-lookup"><span data-stu-id="ccafa-118">Both the system font collection and custom font collections are cached, so the fonts are only loaded one time.</span></span>

<span data-ttu-id="ccafa-119">Le chargeur de collection de polices doit éventuellement être déchargé à l’aide de [**IDWriteFactory :: UnregisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader).</span><span class="sxs-lookup"><span data-stu-id="ccafa-119">The font collection loader must be unloaded eventually by using the [**IDWriteFactory::UnregisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader).</span></span>

> [!Note]  
> <span data-ttu-id="ccafa-120">L’inscription du chargeur de collection de polices ajoute au décompte de références. n’appelez pas [**UnregisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader) à partir du destructeur ou l’objet chargeur de collection ne sera jamais inscrit.</span><span class="sxs-lookup"><span data-stu-id="ccafa-120">Registering the font collection loader adds to the reference count; do not call [**UnregisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader) from within the destructor or the collection loader object will never be unregistered.</span></span>

 

## <a name="idwritefontcollectionloader"></a><span data-ttu-id="ccafa-121">IDWriteFontCollectionLoader</span><span class="sxs-lookup"><span data-stu-id="ccafa-121">IDWriteFontCollectionLoader</span></span>

<span data-ttu-id="ccafa-122">Vous créez un objet [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) à l’aide de [**IDWriteFactory :: CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) et en lui transmettant une clé définie par l’application.</span><span class="sxs-lookup"><span data-stu-id="ccafa-122">You create an [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) object by using the [**IDWriteFactory::CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) and passing it an application-defined key.</span></span> <span data-ttu-id="ccafa-123">La clé est un pointeur void et le type de données, le format et la signification sont définis par l’application et sont opaques pour le système de polices.</span><span class="sxs-lookup"><span data-stu-id="ccafa-123">The key is a void pointer and the data type, format, and meaning are defined by the application and are opaque to the font system.</span></span>

<span data-ttu-id="ccafa-124">Alors que la clé peut être n’importe quoi, [DirectWrite](direct-write-portal.md) requiert que chaque clé soit à la fois :</span><span class="sxs-lookup"><span data-stu-id="ccafa-124">Whereas the key can be anything, [DirectWrite](direct-write-portal.md) requires that each key is both:</span></span>

-   <span data-ttu-id="ccafa-125">Unique à une collection de polices unique dans l’étendue du chargeur.</span><span class="sxs-lookup"><span data-stu-id="ccafa-125">Unique to a single font collection within the scope of the loader.</span></span>
-   <span data-ttu-id="ccafa-126">Valide jusqu’à ce que le chargeur soit désinscrit à l’aide de la fabrique.</span><span class="sxs-lookup"><span data-stu-id="ccafa-126">Valid until the loader is unregistered using the factory.</span></span>

<span data-ttu-id="ccafa-127">Lorsque la méthode [**CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) est appelée, [DirectWrite](direct-write-portal.md) rappelle une interface [**IDWriteFontCollectionLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) implémentée en tant qu’objet singleton par l’application.</span><span class="sxs-lookup"><span data-stu-id="ccafa-127">When the [**CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) method is called, [DirectWrite](direct-write-portal.md) calls back to an [**IDWriteFontCollectionLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) interface implemented as a singleton object by the application.</span></span> <span data-ttu-id="ccafa-128">La méthode de rappel [**IDWriteFontCollectionLoader :: CreateEnumeratorFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey) est utilisée par DirectWrite pour récupérer un objet [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) implémenté par l’application.</span><span class="sxs-lookup"><span data-stu-id="ccafa-128">The [**IDWriteFontCollectionLoader::CreateEnumeratorFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey) callback method is used by DirectWrite to retrieve an [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) object implemented by the application.</span></span> <span data-ttu-id="ccafa-129">L’objet [**IDWriteFactory**](/windows/win32/api/dwrite/nn-dwrite-idwritefactory) utilisé pour créer la collection est passé à cette méthode et doit être utilisé par l’énumérateur de fichier de police pour créer les objets [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) à inclure dans la collection.</span><span class="sxs-lookup"><span data-stu-id="ccafa-129">The [**IDWriteFactory**](/windows/win32/api/dwrite/nn-dwrite-idwritefactory) object that is being used to create the collection is passed to this method and should be used by the font file enumerator to create the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) objects to be included in the collection.</span></span>

<span data-ttu-id="ccafa-130">La clé passée à cette méthode identifie la collection de polices et est la même clé passée à [**CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection).</span><span class="sxs-lookup"><span data-stu-id="ccafa-130">The key passed to this method identifies the font collection and is the same key passed to [**CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection).</span></span>

## <a name="idwritefontfileenumerator"></a><span data-ttu-id="ccafa-131">IDWriteFontFileEnumerator</span><span class="sxs-lookup"><span data-stu-id="ccafa-131">IDWriteFontFileEnumerator</span></span>

<span data-ttu-id="ccafa-132">L’objet [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) défini par l’application qui a été créé par la méthode [**CreateEnumeratorFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey) est utilisé pour énumérer les fichiers de polices dans une collection, en créant un objet [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) pour chaque fichier.</span><span class="sxs-lookup"><span data-stu-id="ccafa-132">The application-defined [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) object that was created by the [**CreateEnumeratorFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey) method is used to enumerate the font files in a collection, creating an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object for each file.</span></span> <span data-ttu-id="ccafa-133">La méthode [**IDWriteFontFileEnumerator :: MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) remplace la position par le fichier de police suivant.</span><span class="sxs-lookup"><span data-stu-id="ccafa-133">The [**IDWriteFontFileEnumerator::MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) method changes the position to the next font file.</span></span> <span data-ttu-id="ccafa-134">Si un fichier se trouve à la position, il affecte la valeur **true** à *hasCurrentFile* .</span><span class="sxs-lookup"><span data-stu-id="ccafa-134">If there is a file at the position, it will set the *hasCurrentFile* to **TRUE**.</span></span> <span data-ttu-id="ccafa-135">Dans le cas contraire, elle est définie sur **false** et la méthode retourne **S \_ OK**.</span><span class="sxs-lookup"><span data-stu-id="ccafa-135">Otherwise it will be set to **FALSE** and the method will return **S\_OK**.</span></span>

> [!Note]  
> <span data-ttu-id="ccafa-136">L’énumérateur de fichier de police doit commencer par être positionné avant le premier élément et avancé au premier appel de [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext).</span><span class="sxs-lookup"><span data-stu-id="ccafa-136">The font file enumerator must start positioned before the first element and advanced at the first call to [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext).</span></span>

 

<span data-ttu-id="ccafa-137">Un objet [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) est généré par la méthode [**IDWriteFontFileEnumerator :: GetCurrentFontFile**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile) .</span><span class="sxs-lookup"><span data-stu-id="ccafa-137">An [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object is output by the [**IDWriteFontFileEnumerator::GetCurrentFontFile**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile) method.</span></span> <span data-ttu-id="ccafa-138">S’il n’y a aucun fichier de police à la position actuelle, car [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) n’a pas encore été appelé ou hasCurrentFile a été défini sur **false**, **GetCurrentFontFile** retourne alors **E \_ Fail**.</span><span class="sxs-lookup"><span data-stu-id="ccafa-138">If there is no font file at the current position, because [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) has not yet been called or hasCurrentFile was set to **FALSE**, then **GetCurrentFontFile** will return **E\_FAIL**.</span></span>

## <a name="createcustomfontfilereference"></a><span data-ttu-id="ccafa-139">CreateCustomFontFileReference</span><span class="sxs-lookup"><span data-stu-id="ccafa-139">CreateCustomFontFileReference</span></span>

<span data-ttu-id="ccafa-140">La sortie de l’objet [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) par [**GetCurrentFontFile**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile) peut être créée en appelant [**IDWriteFactory :: CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference).</span><span class="sxs-lookup"><span data-stu-id="ccafa-140">The [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object output by [**GetCurrentFontFile**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile) can be created by calling [**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference).</span></span> <span data-ttu-id="ccafa-141">La clé de référence de fichier de police identifie une référence de fichier de police spécifique et doit être unique dans le chargeur de fichier de police qui chargera le fichier.</span><span class="sxs-lookup"><span data-stu-id="ccafa-141">The font file reference key identifies a specific font file reference and must be unique within the font file loader that will load the file.</span></span>

## <a name="idwritefontfileloader"></a><span data-ttu-id="ccafa-142">IDWriteFontFileLoader</span><span class="sxs-lookup"><span data-stu-id="ccafa-142">IDWriteFontFileLoader</span></span>

<span data-ttu-id="ccafa-143">La méthode [**CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) prend un objet [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) implémenté par l’application utilisée pour charger la police.</span><span class="sxs-lookup"><span data-stu-id="ccafa-143">The [**CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method takes an [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) object implemented by the application that is used to load the font.</span></span> <span data-ttu-id="ccafa-144">La méthode de rappel [**IDWriteFontFileLoader :: CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) reçoit la clé et génère un objet [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) .</span><span class="sxs-lookup"><span data-stu-id="ccafa-144">The [**IDWriteFontFileLoader::CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) callback method is passed the key and outputs an [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) object.</span></span>

## <a name="idwritefontfilestream"></a><span data-ttu-id="ccafa-145">IDWriteFontFileStream</span><span class="sxs-lookup"><span data-stu-id="ccafa-145">IDWriteFontFileStream</span></span>

<span data-ttu-id="ccafa-146">L’objet [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) implémenté par l’application fournit les données de fichier de police pour une référence de fichier de police d’un chargeur de fichier de polices personnalisé.</span><span class="sxs-lookup"><span data-stu-id="ccafa-146">The application-implemented [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) object provides the font file data for a font file reference from a custom font file loader.</span></span> <span data-ttu-id="ccafa-147">Avec la taille de fichier et l’heure de la dernière écriture, il fournit une méthode ([**ReadFileFragment**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment)) pour la récupération des fragments de fichier qui doivent être compilés dans un objet [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) .</span><span class="sxs-lookup"><span data-stu-id="ccafa-147">Together with the file size and last write time, it provides a method ([**ReadFileFragment**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment)) for retrieving file fragments that are to be compiled into an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object.</span></span>

> [!Note]  
> <span data-ttu-id="ccafa-148">Les implémentations de [**ReadFileFragment**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment) doivent retourner une erreur si le fragment demandé se trouve en dehors des limites du fichier.</span><span class="sxs-lookup"><span data-stu-id="ccafa-148">[**ReadFileFragment**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment) implementations should return an error if the requested fragment is outside the file bounds.</span></span>

 

<span data-ttu-id="ccafa-149">Un [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) peut récupérer le contenu du fichier de police où que vous soyez, par exemple le lecteur de disque dur local ou les ressources incorporées.</span><span class="sxs-lookup"><span data-stu-id="ccafa-149">An [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) can get the font file contents from anywhere, such as the local hard disk drive, or embedded resources.</span></span>

 

 