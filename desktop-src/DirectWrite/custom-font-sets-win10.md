---
title: Jeux de polices personnalisés
description: Cette rubrique décrit les différentes façons dont vous pouvez utiliser des polices personnalisées dans votre application.
ms.assetid: 50842838-d150-df9a-f1b7-67ce5ea2bc80
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a79f1ccfcb1dadd355c5f582417aacb5041ecf8b
ms.sourcegitcommit: 89f99926f946dc6c5ea600fb7c41f6b19ceac516
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/21/2020
ms.locfileid: "104383239"
---
# <a name="custom-font-sets"></a><span data-ttu-id="348a7-103">Jeux de polices personnalisés</span><span class="sxs-lookup"><span data-stu-id="348a7-103">Custom Font Sets</span></span>

<span data-ttu-id="348a7-104">Cette rubrique décrit les différentes façons dont vous pouvez utiliser des polices personnalisées dans votre application.</span><span class="sxs-lookup"><span data-stu-id="348a7-104">This topic describes various ways in which you can use custom fonts in your app.</span></span>

-   [<span data-ttu-id="348a7-105">Présentation </span><span class="sxs-lookup"><span data-stu-id="348a7-105">Introduction </span></span>](#introduction)
-   [<span data-ttu-id="348a7-106">Résumé des API</span><span class="sxs-lookup"><span data-stu-id="348a7-106">Summary of APIs</span></span>](#summary-of-apis)
-   [<span data-ttu-id="348a7-107">Concepts clés</span><span class="sxs-lookup"><span data-stu-id="348a7-107">Key concepts</span></span>](#key-concepts)
-   [<span data-ttu-id="348a7-108">Polices et formats de fichier de police</span><span class="sxs-lookup"><span data-stu-id="348a7-108">Fonts and font file formats</span></span>](#fonts-and-font-file-formats)
-   [<span data-ttu-id="348a7-109">Jeux de polices et collections de polices</span><span class="sxs-lookup"><span data-stu-id="348a7-109">Font sets and font collections</span></span>](#font-sets-and-font-collections)
-   [<span data-ttu-id="348a7-110">Scénarios courants</span><span class="sxs-lookup"><span data-stu-id="348a7-110">Common scenarios</span></span>](#common-scenarios)
    -   [<span data-ttu-id="348a7-111">Création d’un jeu de polices à l’aide de polices arbitraires dans le système de fichiers local</span><span class="sxs-lookup"><span data-stu-id="348a7-111">Creating a font set using arbitrary fonts in the local file system</span></span>](#creating-a-font-set-using-arbitrary-fonts-in-the-local-file-system)
    -   [<span data-ttu-id="348a7-112">Création d’un jeu de polices à l’aide des polices connues dans le système de fichiers local</span><span class="sxs-lookup"><span data-stu-id="348a7-112">Creating a font set using known fonts in the local file system</span></span>](#creating-a-font-set-using-known-fonts-in-the-local-file-system)
    -   [<span data-ttu-id="348a7-113">Création d’un jeu de polices personnalisé à l’aide de polices distantes connues sur le Web</span><span class="sxs-lookup"><span data-stu-id="348a7-113">Creating a custom font set using known, remote fonts on the Web</span></span>](#creating-a-custom-font-set-using-known-remote-fonts-on-the-web)
    -   [<span data-ttu-id="348a7-114">Création d’un jeu de polices personnalisé à l’aide des données de police chargées en mémoire</span><span class="sxs-lookup"><span data-stu-id="348a7-114">Creating a custom font set using font data loaded into memory</span></span>](#creating-a-custom-font-set-using-font-data-loaded-into-memory)
-   [<span data-ttu-id="348a7-115">Scénarios avancés</span><span class="sxs-lookup"><span data-stu-id="348a7-115">Advanced scenarios</span></span>](#advanced-scenarios)
    -   [<span data-ttu-id="348a7-116">Combinaison de jeux de polices</span><span class="sxs-lookup"><span data-stu-id="348a7-116">Combining font sets</span></span>](#combining-font-sets)
    -   [<span data-ttu-id="348a7-117">Utilisation des données de police WOFF ou WOFF2 locales </span><span class="sxs-lookup"><span data-stu-id="348a7-117">Using local WOFF or WOFF2 font data </span></span>](#using-local-woff-or-woff2-font-data)
    -   [<span data-ttu-id="348a7-118">Utilisation de mécanismes de police à distance DirectWrite avec une implémentation réseau de bas niveau personnalisée </span><span class="sxs-lookup"><span data-stu-id="348a7-118">Using DirectWrite remote font mechanisms with custom low-level network implementation </span></span>](#using-directwrite-remote-font-mechanisms-with-custom-low-level-network-implementation)
    -   [<span data-ttu-id="348a7-119">Scénarios de prise en charge sur les versions antérieures de Windows </span><span class="sxs-lookup"><span data-stu-id="348a7-119">Supporting scenarios on earlier Windows versions </span></span>](#supporting-scenarios-on-earlier-windows-versions)

## <a name="introduction"></a><span data-ttu-id="348a7-120">Introduction</span><span class="sxs-lookup"><span data-stu-id="348a7-120">Introduction</span></span>

<span data-ttu-id="348a7-121">La plupart du temps, les applications utilisent les polices installées localement sur le système.</span><span class="sxs-lookup"><span data-stu-id="348a7-121">Most of the time, apps use the fonts that are installed locally on the system.</span></span> <span data-ttu-id="348a7-122">DirectWrite permet d’accéder à ces polices à l’aide des méthodes [**IDWriteFactory3 :: GetSystemFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontset) ou [**IDWriteFactory :: GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) .</span><span class="sxs-lookup"><span data-stu-id="348a7-122">DirectWrite provides access to these fonts using the [**IDWriteFactory3::GetSystemFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontset) or [**IDWriteFactory::GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) methods.</span></span> <span data-ttu-id="348a7-123">Dans certains cas, les applications peuvent également vouloir utiliser des polices incluses dans Windows 10, mais qui ne sont pas installées actuellement sur le système actuel.</span><span class="sxs-lookup"><span data-stu-id="348a7-123">In some cases, apps may also want to use fonts that are included as part of Windows 10 but that are not currently installed on the current system.</span></span> <span data-ttu-id="348a7-124">Ces polices sont accessibles à partir du service de police Windows à l’aide de la méthode **GetSystemFontSet** , ou en appelant [**IDWriteFactory3 :: GetSystemFontCollection**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontcollection) avec includeDownloadableFonts défini sur true.</span><span class="sxs-lookup"><span data-stu-id="348a7-124">Such fonts can be accessed from the Windows font service by using the **GetSystemFontSet** method, or by calling [**IDWriteFactory3::GetSystemFontCollection**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontcollection) with includeDownloadableFonts set to TRUE.</span></span> 

<span data-ttu-id="348a7-125">Dans certains scénarios d’application, toutefois, les applications doivent utiliser des polices qui ne sont pas installées dans le système et qui ne sont pas fournies par le service de police Windows.</span><span class="sxs-lookup"><span data-stu-id="348a7-125">In some application scenarios, however, apps need to use fonts that are not installed in the system and are not provided by the Windows Font Service.</span></span> <span data-ttu-id="348a7-126">Voici quelques exemples de ces scénarios :</span><span class="sxs-lookup"><span data-stu-id="348a7-126">The following are examples of such scenarios:</span></span>

-   <span data-ttu-id="348a7-127">Les polices sont incorporées en tant que ressources dans un fichier binaire d’application.</span><span class="sxs-lookup"><span data-stu-id="348a7-127">Fonts are embedded as resources within an app binary.</span></span>
-   <span data-ttu-id="348a7-128">Les fichiers de polices sont regroupés dans un package d’application et stockés sur le disque dans le dossier d’installation de l’application.</span><span class="sxs-lookup"><span data-stu-id="348a7-128">Font files are bundled within an app package and stored on disk under the app’s installation folder.</span></span>
-   <span data-ttu-id="348a7-129">L’application est un outil de développement de polices qui doit charger les fichiers de police spécifiés par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="348a7-129">The app is a font-development tool that needs to load user-specified font files.</span></span> 
-   <span data-ttu-id="348a7-130">Les polices sont incorporées dans des fichiers de document qui peuvent être affichés ou modifiés dans l’application.</span><span class="sxs-lookup"><span data-stu-id="348a7-130">Fonts are embedded in document files that can be viewed or edited in the app.</span></span> 
-   <span data-ttu-id="348a7-131">L’application utilise des polices obtenues à partir d’un service de police Web public.</span><span class="sxs-lookup"><span data-stu-id="348a7-131">The app uses fonts obtained from a public Web font service.</span></span> 
-   <span data-ttu-id="348a7-132">L’application utilise les données de police diffusées en continu via un protocole de réseau privé.</span><span class="sxs-lookup"><span data-stu-id="348a7-132">The app uses font data streamed via a private network protocol.</span></span> 

<span data-ttu-id="348a7-133">DirectWrite fournit des API pour l’utilisation de polices personnalisées dans ces scénarios similaires.</span><span class="sxs-lookup"><span data-stu-id="348a7-133">DirectWrite provides APIs for working with custom fonts in these and other similar scenarios.</span></span> <span data-ttu-id="348a7-134">Les données de police personnalisées peuvent provenir de fichiers dans le système de fichiers local ; à partir de sources Cloud accessibles à l’aide de HTTP ; ou à partir de sources arbitraires après avoir été chargées dans une mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="348a7-134">The custom font data might come from files in the local file system; from remote, cloud-based sources accessed using HTTP; or from arbitrary sources after having been loaded into a memory buffer.</span></span> 

> [!Note]  
> <span data-ttu-id="348a7-135">DirectWrite a fourni des API pour travailler avec des polices personnalisées depuis Windows 7. des API plus récentes ont été ajoutées à Windows 10 et de nouveau dans Windows 10 Creators Update (version préliminaire 15021 ou ultérieure) qui facilitent l’implémentation de plusieurs des scénarios mentionnés.</span><span class="sxs-lookup"><span data-stu-id="348a7-135">While DirectWrite has provided APIs for working with custom fonts since Windows 7, newer APIs were added in Windows 10 and again in the Windows 10 Creators Update (preview build 15021 or later) that make it easier to implement several of the scenarios mentioned.</span></span> <span data-ttu-id="348a7-136">Cette rubrique se concentre sur les API disponibles dans Windows 10.</span><span class="sxs-lookup"><span data-stu-id="348a7-136">This topic focuses on APIs available in Window 10.</span></span> <span data-ttu-id="348a7-137">Pour les applications qui doivent travailler sur des versions antérieures de Windows, consultez [collections de polices personnalisées (Windows 7/8)](custom-font-collections.md).</span><span class="sxs-lookup"><span data-stu-id="348a7-137">For applications that need to work on earlier Windows versions, see [Custom Font Collections (Windows 7/8)](custom-font-collections.md).</span></span> 

 

## <a name="summary-of-apis"></a><span data-ttu-id="348a7-138">Résumé des API</span><span class="sxs-lookup"><span data-stu-id="348a7-138">Summary of APIs</span></span>

<span data-ttu-id="348a7-139">Cette rubrique se concentre sur les fonctionnalités fournies par les API suivantes :</span><span class="sxs-lookup"><span data-stu-id="348a7-139">This topic focuses on functionality provided by the following APIs:</span></span> 

-   <span data-ttu-id="348a7-140">Interface [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset)</span><span class="sxs-lookup"><span data-stu-id="348a7-140">[**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) interface</span></span>
-   <span data-ttu-id="348a7-141">Interface [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder)</span><span class="sxs-lookup"><span data-stu-id="348a7-141">[**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface</span></span>
-   <span data-ttu-id="348a7-142">Interface [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1)</span><span class="sxs-lookup"><span data-stu-id="348a7-142">[**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface</span></span> 
-   <span data-ttu-id="348a7-143">Interface [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference)</span><span class="sxs-lookup"><span data-stu-id="348a7-143">[**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) interface</span></span>
-   <span data-ttu-id="348a7-144">Interface [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile)</span><span class="sxs-lookup"><span data-stu-id="348a7-144">[**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) interface</span></span>
-   <span data-ttu-id="348a7-145">[**IDWriteFactory :: CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) , méthode</span><span class="sxs-lookup"><span data-stu-id="348a7-145">[**IDWriteFactory::CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) method</span></span> 
-   <span data-ttu-id="348a7-146">[**IDWriteFactory :: CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) , méthode</span><span class="sxs-lookup"><span data-stu-id="348a7-146">[**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method</span></span> 
-   <span data-ttu-id="348a7-147">[**IDWriteFactory3 :: CreateFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontresource-createfontfacereference) , méthodes</span><span class="sxs-lookup"><span data-stu-id="348a7-147">[**IDWriteFactory3::CreateFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontresource-createfontfacereference) methods</span></span> 
-   <span data-ttu-id="348a7-148">[**DWRITE \_ Structure de la \_ propriété font**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property)</span><span class="sxs-lookup"><span data-stu-id="348a7-148">[**DWRITE\_FONT\_PROPERTY**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) structure</span></span> 
-   <span data-ttu-id="348a7-149">[**DWRITE \_ \_ \_**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) Énumération de l’ID de propriété de police</span><span class="sxs-lookup"><span data-stu-id="348a7-149">[**DWRITE\_FONT\_PROPERTY\_ID**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) enumeration</span></span> 
-   <span data-ttu-id="348a7-150">Interface [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)</span><span class="sxs-lookup"><span data-stu-id="348a7-150">[**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) interface</span></span> 
-   <span data-ttu-id="348a7-151">[**IDWriteFactory :: RegisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontfileloader) , méthode</span><span class="sxs-lookup"><span data-stu-id="348a7-151">[**IDWriteFactory::RegisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontfileloader) method</span></span> 
-   <span data-ttu-id="348a7-152">[**IDWriteFactory :: UnregisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontfileloader) , méthode</span><span class="sxs-lookup"><span data-stu-id="348a7-152">[**IDWriteFactory::UnregisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontfileloader) method</span></span> 
-   <span data-ttu-id="348a7-153">[**IDWriteFactory5 :: CreateInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createinmemoryfontfileloader) , méthode</span><span class="sxs-lookup"><span data-stu-id="348a7-153">[**IDWriteFactory5::CreateInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createinmemoryfontfileloader) method</span></span> 
-   <span data-ttu-id="348a7-154">Interface [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="348a7-154">[**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader) interface</span></span> 
-   <span data-ttu-id="348a7-155">[**IDWriteFactory5 :: CreateHttpFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createhttpfontfileloader) , méthode</span><span class="sxs-lookup"><span data-stu-id="348a7-155">[**IDWriteFactory5::CreateHttpFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createhttpfontfileloader) method</span></span> 
-   <span data-ttu-id="348a7-156">Interface [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader)</span><span class="sxs-lookup"><span data-stu-id="348a7-156">[**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) interface</span></span> 
-   <span data-ttu-id="348a7-157">Interface [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue)</span><span class="sxs-lookup"><span data-stu-id="348a7-157">[**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) interface</span></span> 
-   <span data-ttu-id="348a7-158">Interface [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener)</span><span class="sxs-lookup"><span data-stu-id="348a7-158">[**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface</span></span> 
-   <span data-ttu-id="348a7-159">Interface [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)</span><span class="sxs-lookup"><span data-stu-id="348a7-159">[**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) interface</span></span> 
-   <span data-ttu-id="348a7-160">Interface [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream)</span><span class="sxs-lookup"><span data-stu-id="348a7-160">[**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream) interface</span></span> 
-   <span data-ttu-id="348a7-161">Interface [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult)</span><span class="sxs-lookup"><span data-stu-id="348a7-161">[**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) interface</span></span> 
-   <span data-ttu-id="348a7-162">[**IDWriteFactory5 :: AnalyzeContainerType**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-analyzecontainertype) , méthode</span><span class="sxs-lookup"><span data-stu-id="348a7-162">[**IDWriteFactory5::AnalyzeContainerType**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-analyzecontainertype) method</span></span> 
-   <span data-ttu-id="348a7-163">[**IDWriteFactory5 :: UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile) , méthode</span><span class="sxs-lookup"><span data-stu-id="348a7-163">[**IDWriteFactory5::UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile) method</span></span> 

 

## <a name="key-concepts"></a><span data-ttu-id="348a7-164">Concepts clés</span><span class="sxs-lookup"><span data-stu-id="348a7-164">Key concepts</span></span>

<span data-ttu-id="348a7-165">Pour comprendre les API DirectWrite permettant d’utiliser des polices personnalisées, il peut être utile de comprendre le modèle conceptuel sous-jacent à ces API.</span><span class="sxs-lookup"><span data-stu-id="348a7-165">To understand the DirectWrite APIs for working with custom fonts, it can be helpful to understand the conceptual model that underlies these APIs.</span></span> <span data-ttu-id="348a7-166">Les concepts clés sont décrits ici.</span><span class="sxs-lookup"><span data-stu-id="348a7-166">Key concepts will be described here.</span></span> 

<span data-ttu-id="348a7-167">Lorsque DirectWrite effectue une mise en page ou un rendu de texte réel, il doit accéder aux données de police réelles.</span><span class="sxs-lookup"><span data-stu-id="348a7-167">When DirectWrite does actual text layout or rendering, it needs to access actual font data.</span></span> <span data-ttu-id="348a7-168">Un objet de type de police contient les données de police réelles, qui doivent exister dans le système local.</span><span class="sxs-lookup"><span data-stu-id="348a7-168">A font face object holds actual font data, which must exist in the local system.</span></span> <span data-ttu-id="348a7-169">Toutefois, pour d’autres opérations, telles que la vérification de la disponibilité d’une police particulière ou la présentation d’un choix de polices à un utilisateur, il suffit d’une référence à une police particulière, et non des données de police réelles.</span><span class="sxs-lookup"><span data-stu-id="348a7-169">But for other operations, such as checking availability of a particular font, or presenting font choices to a user, all that is needed is a reference to a particular font, not the actual font data itself.</span></span> <span data-ttu-id="348a7-170">Dans DirectWrite, un objet de référence de type de police contient uniquement les informations nécessaires pour localiser et instancier une police.</span><span class="sxs-lookup"><span data-stu-id="348a7-170">In DirectWrite, a font face reference object holds just the information needed to locate and instantiate a font.</span></span> <span data-ttu-id="348a7-171">Étant donné que la référence de type de police ne contient pas de données réelles, DirectWrite peut gérer les références de type de police pour lesquelles les données réelles se trouvent dans un emplacement réseau distant, ainsi que lorsque les données réelles sont locales.</span><span class="sxs-lookup"><span data-stu-id="348a7-171">Because the font face reference doesn’t hold actual data, DirectWrite can deal with font face references for which actual data is in a remote network location as well as when the actual data is local.</span></span>

<span data-ttu-id="348a7-172">Un jeu de polices est un ensemble de références de type de police, ainsi que certaines propriétés de base et informations qui peuvent être utilisées pour faire référence à la police ou pour la comparer à d’autres polices, telles que le nom de famille ou une valeur de police.</span><span class="sxs-lookup"><span data-stu-id="348a7-172">A font set is a set of font face references, along with certain basic, informational properties that can be used in referring to the font or in comparing it to other fonts, such as the family name, or a font-weight value.</span></span> <span data-ttu-id="348a7-173">Les données réelles des différentes polices peuvent être locales, ou elles peuvent toutes être distantes ou être mélangées.</span><span class="sxs-lookup"><span data-stu-id="348a7-173">The actual data for the various fonts may be local, or it may all be remote, or some mixture.</span></span>

<span data-ttu-id="348a7-174">Un jeu de polices peut être utilisé pour obtenir un objet de collection de polices correspondant.</span><span class="sxs-lookup"><span data-stu-id="348a7-174">A font set can be used to obtain a corresponding font collection object.</span></span> <span data-ttu-id="348a7-175">Pour plus d’informations, consultez Jeux de polices et collections de polices ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="348a7-175">See Font sets and font collections below for more details.</span></span> 

<span data-ttu-id="348a7-176">L’interface IDWriteFontSet fournit des méthodes qui permettent d’interroger des valeurs de propriété telles que le nom de famille ou le poids de police, ou des références de type de police qui correspondent à des valeurs de propriété particulières.</span><span class="sxs-lookup"><span data-stu-id="348a7-176">The IDWriteFontSet interface provides methods that allow querying for property values such as family name or font-weight, or for font face references that match particular property values.</span></span> <span data-ttu-id="348a7-177">Une fois le filtrage effectué vers une sélection particulière, une instance de l’interface [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) peut être obtenue, avec des méthodes de téléchargement (si les données de police réelles sont actuellement à distance), afin d’obtenir l’objet [**IDWriteFontFace3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontface3) correspondant qui peut être utilisé pour la disposition et le rendu.</span><span class="sxs-lookup"><span data-stu-id="348a7-177">After filtering down to a particular selection, an instance of the [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) interface can be obtained, with methods for downloading (if the actual font data is currently remote), for obtaining the corresponding [**IDWriteFontFace3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontface3) object that can be used for layout and rendering.</span></span> 

<span data-ttu-id="348a7-178">L’interface IDWriteFontFile sous-tend chaque type de police ou référence de type de police.</span><span class="sxs-lookup"><span data-stu-id="348a7-178">The IDWriteFontFile interface underlies each font face or font face reference.</span></span> <span data-ttu-id="348a7-179">Cela représente l’emplacement d’un fichier de polices et a deux composants : un chargeur de fichiers de polices et une clé de fichier de police.</span><span class="sxs-lookup"><span data-stu-id="348a7-179">This represents the location of a font file, and has two components: a font file loader, and a font file key.</span></span> <span data-ttu-id="348a7-180">Le chargeur de fichiers de polices ([**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)) est utilisé pour ouvrir un fichier si nécessaire, et retourne un flux avec les données ([**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)).</span><span class="sxs-lookup"><span data-stu-id="348a7-180">The font file loader ([**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)) is used to open a file if needed, and returns a stream with the data ([**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)).</span></span> <span data-ttu-id="348a7-181">Selon le chargeur, les données peuvent se trouver dans un chemin d’accès de fichier local, une URL distante ou dans une mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="348a7-181">Depending on the loader, the data may be located at a local file path, a remote URL, or in a memory buffer.</span></span> <span data-ttu-id="348a7-182">La clé est une valeur définie par le chargeur qui identifie de façon unique le fichier dans le contexte du chargeur, ce qui permet au chargeur de localiser les données et de créer un flux pour celui-ci.</span><span class="sxs-lookup"><span data-stu-id="348a7-182">The key is a loader-defined value that uniquely identifies the file within the loader context, allowing the loader to locate the data and create a stream for it.</span></span> 

<span data-ttu-id="348a7-183">Vous pouvez facilement ajouter des polices personnalisées à un jeu de polices personnalisé, qui peut à son tour être utilisé pour filtrer ou organiser les informations de police à des fins telles que la création d’une interface utilisateur de sélecteur de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-183">Custom fonts can easily be added to a custom font set, which in turn can be used for filtering or organizing font information for purposes such as creating a font-picker user interface.</span></span> <span data-ttu-id="348a7-184">Le jeu de polices peut également être utilisé pour créer une collection de polices à utiliser dans des API de niveau supérieur telles que [**IDWriteTextFormat**](/windows/win32/api/dwrite/nn-dwrite-idwritetextformat) et [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout).</span><span class="sxs-lookup"><span data-stu-id="348a7-184">The font set can also be used to create a font collection for use in higher-level APIs like [**IDWriteTextFormat**](/windows/win32/api/dwrite/nn-dwrite-idwritetextformat) and [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout).</span></span> <span data-ttu-id="348a7-185">L’interface [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) peut être utilisée pour créer un jeu de polices personnalisé qui comprend plusieurs polices personnalisées.</span><span class="sxs-lookup"><span data-stu-id="348a7-185">The [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface can be used to create a custom font set that includes several custom fonts.</span></span> <span data-ttu-id="348a7-186">Il peut également être utilisé pour créer un jeu de polices personnalisé qui mélange des polices personnalisées et des polices fournies par le système. ou qui combine des polices avec des sources différentes pour les données réelles (stockage local, URL distantes et mémoire).</span><span class="sxs-lookup"><span data-stu-id="348a7-186">It can also be used to create a custom font set that mixes custom fonts and system-provided fonts; or that mixes fonts with different sources for the actual data — local storage, remote URLs, and memory.</span></span> 

<span data-ttu-id="348a7-187">Comme mentionné précédemment, une référence de type de police peut faire référence à des données de police sur une source distante, mais les données doivent être locales pour obtenir un objet de type de police qui peut être utilisé pour la mise en page et le rendu.</span><span class="sxs-lookup"><span data-stu-id="348a7-187">As mentioned, a font face reference may refer to font data at a remote source, but the data must be local in order to obtain a font face object that can be used for layout and rendering.</span></span> <span data-ttu-id="348a7-188">Le téléchargement de données distantes est géré par une file d’attente de téléchargement de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-188">Downloading of remote data is handled by a font download queue.</span></span> <span data-ttu-id="348a7-189">Les applications peuvent utiliser l’interface [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) pour mettre en file d’attente les demandes de téléchargement des polices distantes pour initier le processus de téléchargement et inscrire un objet [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) pour prendre des mesures lorsque le processus de téléchargement est terminé.</span><span class="sxs-lookup"><span data-stu-id="348a7-189">Apps can use the [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) interface to enqueue requests to download remote fonts to initiate the download process, and to register an [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) object to take action when the download process has completed.</span></span> 

<span data-ttu-id="348a7-190">Pour la plupart des interfaces décrites ici, DirectWrite fournit des implémentations du système.</span><span class="sxs-lookup"><span data-stu-id="348a7-190">For most of the interfaces described here, DirectWrite provides system implementations.</span></span> <span data-ttu-id="348a7-191">La seule exception est l’interface [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) , qu’une application implémente pour prendre des mesures spécifiques à l’application lorsque les polices distantes ont été téléchargées localement.</span><span class="sxs-lookup"><span data-stu-id="348a7-191">The one exception is the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface, which an app implements to take app-specific actions when remote fonts have been downloaded locally.</span></span> <span data-ttu-id="348a7-192">Les applications peuvent avoir des raisons de fournir leurs propres implémentations personnalisées pour certaines autres interfaces, bien que cela ne soit nécessaire que dans des scénarios plus avancés et spécifiques.</span><span class="sxs-lookup"><span data-stu-id="348a7-192">Apps may have reason to provide their own custom implementations for certain other interfaces, though that would only be needed in specific, more advanced scenarios.</span></span> <span data-ttu-id="348a7-193">Par exemple, une application doit fournir une implémentation personnalisée de l’interface [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) pour gérer les fichiers de polices dans le stockage local qui utilisent le format de conteneur WOFF2.</span><span class="sxs-lookup"><span data-stu-id="348a7-193">For example, an app would need to provide a custom implementation of the [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) interface to handle font files in local storage that use the WOFF2 container format.</span></span> <span data-ttu-id="348a7-194">Des informations supplémentaires sont fournies ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="348a7-194">Additional details will be provided below.</span></span> 

## <a name="fonts-and-font-file-formats"></a><span data-ttu-id="348a7-195">Polices et formats de fichier de police</span><span class="sxs-lookup"><span data-stu-id="348a7-195">Fonts and font file formats</span></span>

<span data-ttu-id="348a7-196">Un autre concept clé qui est utile pour comprendre la relation entre les polices et les fichiers de police qui les contiennent.</span><span class="sxs-lookup"><span data-stu-id="348a7-196">Another key concept that is helpful to understand is the relationship between individual font faces and font files that contain them.</span></span> <span data-ttu-id="348a7-197">L’idée d’un fichier de police OpenType (. ttf ou. OTF) contenant une police unique est familière.</span><span class="sxs-lookup"><span data-stu-id="348a7-197">The idea of an OpenType font file (.ttf or .otf) containing a single font is familiar.</span></span> <span data-ttu-id="348a7-198">Toutefois, le format de police OpenType autorise également une collection de polices OpenType (. TTC ou. OTC), qui est un fichier unique qui contient plusieurs polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-198">But the OpenType font format also allows for an OpenType Font Collection (.ttc or .otc), which is a single file that contains multiple fonts.</span></span> <span data-ttu-id="348a7-199">Les fichiers de collection OpenType sont souvent utilisés pour les grandes polices étroitement liées et ayant des valeurs identiques pour certaines données de police : en combinant les polices dans un fichier unique, les données communes peuvent être dédupliquées.</span><span class="sxs-lookup"><span data-stu-id="348a7-199">OpenType Collection files are often used for large fonts that are closely related and have identical values for certain font data: by combining the fonts in a single file, the common data can be de-duplicated.</span></span> <span data-ttu-id="348a7-200">Pour cette raison, une référence de type police ou de police doit faire référence non seulement à un fichier de police (ou à une source de données équivalente), mais elle doit également spécifier un index de police dans ce fichier, pour le cas général dans lequel le fichier peut être un fichier de collection.</span><span class="sxs-lookup"><span data-stu-id="348a7-200">For this reason, a font face or font face reference needs to refer not only to a font file (or equivalent data source), but it must also specify a font index within that file, for the general case in which the file may be a Collection file.</span></span> 

<span data-ttu-id="348a7-201">Pour les polices utilisées sur le Web, les données de police sont souvent empaquetées dans certains formats de conteneur, WOFF ou WOFF2, qui fournissent une certaine compression des données de police et un certain niveau de protection contre le piratage et la violation des licences de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-201">For fonts used on the Web, font data is often packed into certain container formats, WOFF or WOFF2, which provide some compression of the font data and some level of protection against piracy and violation of font licenses.</span></span> <span data-ttu-id="348a7-202">Fonctionnellement, un fichier WOFF ou WOFF2 est équivalent à une police OpenType ou à un fichier de collection de polices, mais les données sont encodées dans un format différent qui requiert une décompression avant de pouvoir être utilisées.</span><span class="sxs-lookup"><span data-stu-id="348a7-202">Functionally, a WOFF or WOFF2 file is equivalent to an OpenType font or Font Collection file, but the data is encoded in a different format that requires unpacking before it can be used.</span></span> 

<span data-ttu-id="348a7-203">Certaines API DirectWrite peuvent gérer des visages de polices individuelles, tandis que d’autres API peuvent gérer des fichiers qui peuvent inclure des fichiers de collection OpenType qui contiennent plusieurs visages.</span><span class="sxs-lookup"><span data-stu-id="348a7-203">Certain DirectWrite APIs may deal with individual font faces, while other APIs can handle files that might include OpenType Collection files that contain multiple faces.</span></span> <span data-ttu-id="348a7-204">De même, certaines API traitent uniquement les données brutes de format OpenType, tandis que les autres API peuvent gérer les formats de conteneur compressés, WOFF et WOFF2.</span><span class="sxs-lookup"><span data-stu-id="348a7-204">Similarly, certain APIs deal only with raw, OpenType-format data, while other APIs can handle the packed, WOFF and WOFF2 container formats.</span></span> <span data-ttu-id="348a7-205">Ces détails sont fournis dans la discussion ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="348a7-205">These details are provided in the discussion below.</span></span> 

## <a name="font-sets-and-font-collections"></a><span data-ttu-id="348a7-206">Jeux de polices et collections de polices</span><span class="sxs-lookup"><span data-stu-id="348a7-206">Font sets and font collections</span></span>

<span data-ttu-id="348a7-207">Certaines applications peuvent être implémentées pour fonctionner avec les polices à l’aide de l’interface [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection) .</span><span class="sxs-lookup"><span data-stu-id="348a7-207">Some applications may be implemented to work with fonts using the [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection) interface.</span></span> <span data-ttu-id="348a7-208">Il existe une correspondance directe entre une collection de polices et un jeu de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-208">There is a direct correspondence between a font collection and a font set.</span></span> <span data-ttu-id="348a7-209">Chaque peut contenir les mêmes polices, mais elles sont présentées avec une autre organisation.</span><span class="sxs-lookup"><span data-stu-id="348a7-209">Each can hold the same fonts, but they present them with a different organization.</span></span> <span data-ttu-id="348a7-210">À partir de n’importe quelle collection de polices, un jeu de polices correspondant peut être obtenu, et vice versa.</span><span class="sxs-lookup"><span data-stu-id="348a7-210">From any font collection, a corresponding font set can be obtained, and vice versa.</span></span>

<span data-ttu-id="348a7-211">Lorsque vous travaillez avec plusieurs polices personnalisées, il est plus facile d’utiliser une interface de générateur de jeu de polices pour créer un jeu de polices personnalisé, puis d’obtenir une collection de polices après la création du jeu de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-211">When working with a number of custom fonts, it is easiest to use a font set builder interface to create a custom font set, and then obtain a font collection after the font set is created.</span></span> <span data-ttu-id="348a7-212">Le processus de création d’un jeu de polices personnalisé est décrit en détail ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="348a7-212">The process for creating a custom font set will be described in detail below.</span></span> <span data-ttu-id="348a7-213">Pour obtenir une interface [**IDWriteFontCollection1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontcollection1) à partir d’un jeu de polices, la méthode [**IDWriteFactory3 :: CreateFontCollectionFromFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-createfontcollectionfromfontset) est utilisée.</span><span class="sxs-lookup"><span data-stu-id="348a7-213">To obtain an [**IDWriteFontCollection1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontcollection1) interface from a font set, the [**IDWriteFactory3::CreateFontCollectionFromFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-createfontcollectionfromfontset) method is used.</span></span>

<span data-ttu-id="348a7-214">Si l’application possède un objet collection et doit obtenir un jeu de polices correspondant, cette opération peut être effectuée à l’aide de la méthode [**IDWriteFontCollection1 :: GetFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontcollection1-getfontset) .</span><span class="sxs-lookup"><span data-stu-id="348a7-214">If the app has a collection object and needs to obtain a corresponding font set, this can be done using the [**IDWriteFontCollection1::GetFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontcollection1-getfontset) method.</span></span> 

## <a name="common-scenarios"></a><span data-ttu-id="348a7-215">Scénarios courants</span><span class="sxs-lookup"><span data-stu-id="348a7-215">Common scenarios</span></span>

<span data-ttu-id="348a7-216">Cette section décrit certains des scénarios les plus courants impliquant des jeux de polices personnalisés :</span><span class="sxs-lookup"><span data-stu-id="348a7-216">This section describes some of the most common scenarios involving custom font sets:</span></span>

-   <span data-ttu-id="348a7-217">Création d’un jeu de polices personnalisé à l’aide de polices arbitraires dans les chemins d’accès du système de fichiers local.</span><span class="sxs-lookup"><span data-stu-id="348a7-217">Creating a custom font set using arbitrary fonts at paths in the local file system.</span></span>
-   <span data-ttu-id="348a7-218">Création d’un jeu de polices personnalisé à l’aide de polices connues (éventuellement fournies avec l’application) stockées dans le système de fichiers local.</span><span class="sxs-lookup"><span data-stu-id="348a7-218">Creating a custom font set using known fonts (perhaps bundled with the app) that are stored in the local file system.</span></span>
-   <span data-ttu-id="348a7-219">Création d’un jeu de polices personnalisé à l’aide de polices distantes connues sur le Web.</span><span class="sxs-lookup"><span data-stu-id="348a7-219">Creating a custom font set using known, remote fonts on the Web.</span></span>
-   <span data-ttu-id="348a7-220">Création d’un jeu de polices personnalisé à l’aide des données de police chargées en mémoire.</span><span class="sxs-lookup"><span data-stu-id="348a7-220">Creating a custom font set using font data loaded into memory.</span></span>

<span data-ttu-id="348a7-221">Les implémentations complètes pour ces scénarios sont fournies dans l' [exemple de jeux de polices personnalisées DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="348a7-221">Complete implementations for these scenarios are provided in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> <span data-ttu-id="348a7-222">Cet exemple illustre également un scénario plus avancé pour gérer les données de police compressées dans des formats de conteneur WOFF ou WOFF2, qui seront abordés ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="348a7-222">That sample also illustrates one more advanced scenario for handling font data packed in WOFF or WOFF2 container formats, which will be discussed below.</span></span> 

### <a name="creating-a-font-set-using-arbitrary-fonts-in-the-local-file-system"></a><span data-ttu-id="348a7-223">Création d’un jeu de polices à l’aide de polices arbitraires dans le système de fichiers local</span><span class="sxs-lookup"><span data-stu-id="348a7-223">Creating a font set using arbitrary fonts in the local file system</span></span>

<span data-ttu-id="348a7-224">En cas de traitement d’un ensemble arbitraire de fichiers de polices dans le stockage local, la méthode [**IDWriteFontSetBuilder1 :: AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) est pratique, car, dans un seul appel, elle peut gérer toutes les visages de police dans un fichier de collection de polices OpenType, ainsi que toutes les instances pour une police de variable OpenType.</span><span class="sxs-lookup"><span data-stu-id="348a7-224">When dealing with an arbitrary set of font files in local storage, the [**IDWriteFontSetBuilder1::AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method is convenient since, in a single call, it can handle all of the font faces within an OpenType Font Collection file, as well as all instances for an OpenType variable font.</span></span> <span data-ttu-id="348a7-225">Cette mise à jour est disponible dans Windows 10 Creators Update (version préliminaire 15021 ou ultérieure) et est recommandée chaque fois qu’elle est disponible.</span><span class="sxs-lookup"><span data-stu-id="348a7-225">This is available in the Windows 10 Creators Update (preview build 15021 or later), and is recommended whenever available.</span></span> 

<span data-ttu-id="348a7-226">Pour utiliser cette méthode, utilisez le processus suivant.</span><span class="sxs-lookup"><span data-stu-id="348a7-226">To use this method, use the following process.</span></span>

<dl> <span data-ttu-id="348a7-227">1. Commencez par créer l’interface <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5">IDWriteFactory5</a> :</span><span class="sxs-lookup"><span data-stu-id="348a7-227">1. Start by creating the <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5">IDWriteFactory5</a> interface:</span></span> 


```C++
IDWriteFactory5* pDWriteFactory; 
HRESULT hr = DWriteCreateFactory( 
  DWRITE_FACTORY_TYPE_SHARED, 
  __uuidof(IDWriteFactory5), 
  reinterpret_cast<IUnknown**>(&pDWriteFactory) 
); 
```



   
2. <span data-ttu-id="348a7-228">Utilisez la fabrique pour obtenir l' <a href=""></a> interface [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) :</span><span class="sxs-lookup"><span data-stu-id="348a7-228">Use the factory to obtain the <a href=""></a>[**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface:</span></span> 


```C++
IDWriteFontSetBuilder1* pFontSetBuilder; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontSetBuilder(&pFontSetBuilder); 
}  
                
```



  
3. <span data-ttu-id="348a7-229">Pour chaque fichier de police dans le système de fichiers local, créez un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) qui y fait référence :</span><span class="sxs-lookup"><span data-stu-id="348a7-229">For each font file in the local file system, create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) that refers to it:</span></span> 


```C++
IDWriteFontFile* pFontFile; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontFileReference(pFilePath, /* lastWriteTime*/ nullptr, &pFontFile); 
} 
```



   
4. <span data-ttu-id="348a7-230">Ajoutez l’objet [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) au générateur de jeu de polices à l’aide de la méthode [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) :</span><span class="sxs-lookup"><span data-stu-id="348a7-230">Add the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object to the font set builder using the [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method:</span></span> 


```C++
hr = pFontSetBuilder->AddFontFile(pFontFile); 
```

<span data-ttu-id="348a7-231">Si le chemin d’accès au fichier spécifié dans l’appel à [**CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) fait appel à autre chose qu’un fichier OpenType pris en charge, l’appel à [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) RENVERRA une erreur, DWRITE \_ E \_ FILEFORMAT.</span><span class="sxs-lookup"><span data-stu-id="348a7-231">If the file path specified in the call to [**CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) referred to something other than a supported OpenType file, then the call to [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) will return an error, DWRITE\_E\_FILEFORMAT.</span></span>

5. <span data-ttu-id="348a7-232">Une fois que tous les fichiers ont été ajoutés au générateur de jeux de polices, le jeu de polices personnalisé peut être créé :</span><span class="sxs-lookup"><span data-stu-id="348a7-232">After all of the files have been added to the font set builder, the custom font set can be created:</span></span> 


```C++
IDWriteFontSet* pFontSet; 
hr = pFontSetBuilder->CreateFontSet(&pFontSet); 
```



   
</dl>

<span data-ttu-id="348a7-233">Si l’application doit s’exécuter sur des versions de Windows 10 antérieures à Windows 10 Creators Update, la méthode AddFontFile n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="348a7-233">If the app needs to run on Windows 10 versions earlier than the Windows 10 Creators Update, then the AddFontFile method will not be available.</span></span> <span data-ttu-id="348a7-234">La disponibilité peut être détectée en créant une interface [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) , puis en utilisant QueryInterface pour essayer d’obtenir une interface [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) : si cela se déroule correctement, l’interface [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) et la méthode [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) sont également disponibles.</span><span class="sxs-lookup"><span data-stu-id="348a7-234">Availability can be detected by creating an [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) interface and then using QueryInterface to try to obtain an [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) interface: if this succeeds, then the [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface and [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method will also be available.</span></span>

<span data-ttu-id="348a7-235">Si la méthode AddFontFile n’est pas disponible, la méthode [**IDWriteFontSetBuilder :: AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) doit être utilisée pour ajouter des visages de police individuels.</span><span class="sxs-lookup"><span data-stu-id="348a7-235">If the AddFontFile method is not available, then the [**IDWriteFontSetBuilder::AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method must be used to add individual font faces.</span></span> <span data-ttu-id="348a7-236">Pour autoriser les fichiers de collection de polices OpenType qui contiennent plusieurs visages, la méthode [**IDWriteFontFile :: Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) peut être utilisée pour déterminer le nombre de faces contenues dans le fichier.</span><span class="sxs-lookup"><span data-stu-id="348a7-236">To allow for OpenType Font Collection files that contain multiple faces, the [**IDWriteFontFile::Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method can be used to determine the number of faces contained within the file.</span></span> <span data-ttu-id="348a7-237">Le processus est le suivant.</span><span class="sxs-lookup"><span data-stu-id="348a7-237">The process is as follows.</span></span>

<dl> <span data-ttu-id="348a7-238">1. Commencez par créer l’interface <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3">IDWriteFactory3</a> :</span><span class="sxs-lookup"><span data-stu-id="348a7-238">1. Start by creating the <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3">IDWriteFactory3</a> interface:</span></span> 


```C++
IDWriteFactory3* pDWriteFactory; 
HRESULT hr = DWriteCreateFactory( 
DWRITE_FACTORY_TYPE_SHARED, 
  __uuidof(IDWriteFactory5), 
  reinterpret_cast<IUnknown**>(&pDWriteFactory) 
); 
```



  
2. <span data-ttu-id="348a7-239">Utilisez la fabrique pour obtenir l’interface [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) :</span><span class="sxs-lookup"><span data-stu-id="348a7-239">Use the factory to obtain the [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface:</span></span> 


```C++
IDWriteFontSetBuilder* pFontSetBuilder; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontSetBuilder(&pFontSetBuilder); 
} 
```



  
3. <span data-ttu-id="348a7-240">Pour chaque fichier de polices, créez un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), comme indiqué ci-dessus :</span><span class="sxs-lookup"><span data-stu-id="348a7-240">For each font file, create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), as above:</span></span> 


```C++
IDWriteFontFile* pFontFile; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontFileReference(pFilePath, /* lastWriteTime*/ nullptr, &pFontFile); 
} 
```



<span data-ttu-id="348a7-241">Au lieu d’ajouter le fichier directement dans le générateur de jeux de polices, nous devons déterminer le nombre de visages et créer des objets [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) individuels.</span><span class="sxs-lookup"><span data-stu-id="348a7-241">Instead of adding the file directly to the font set builder, we need to determine the number of faces and create individual [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) objects.</span></span>   
4. <span data-ttu-id="348a7-242">Utilisez la méthode [**analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) pour connaître le nombre de visages dans le fichier.</span><span class="sxs-lookup"><span data-stu-id="348a7-242">Use the [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method to get the number of faces in the file.</span></span> 


```C++
BOOL isSupported; 
DWRITE_FONT_FILE_TYPE fileType; 
UINT32 numberOfFonts; 
hr = pFontFile->Analyze(&isSupported, &fileType, /* face type */ nullptr, &numberOfFonts); 
```



<span data-ttu-id="348a7-243">La méthode [**analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) définit également les valeurs des paramètres IsSupported et filetype.</span><span class="sxs-lookup"><span data-stu-id="348a7-243">The [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method will also set values for the isSupported and fileType parameters.</span></span> <span data-ttu-id="348a7-244">Si le fichier n’est pas un format pris en charge, isSupported a la valeur FALSe, et les actions appropriées, telles que l’ignorance du fichier, peuvent être effectuées.</span><span class="sxs-lookup"><span data-stu-id="348a7-244">If the file is not a supported format, then isSupported will be FALSE, and appropriate action, such as ignoring the file, can be taken.</span></span>   
5. <span data-ttu-id="348a7-245">Parcourez le nombre de polices défini dans le paramètre numberOfFonts.</span><span class="sxs-lookup"><span data-stu-id="348a7-245">Loop over the number of fonts set in the numberOfFonts parameter.</span></span> <span data-ttu-id="348a7-246">Dans la boucle, créez un [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) pour chaque paire fichier/index, puis ajoutez-le au générateur de jeu de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-246">Within the loop, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) for each file/index pair, and add that to the font set builder.</span></span> 


```C++
for (uint32_t fontIndex = 0; fontIndex < numberOfFonts; fontIndex++) 
{ 
  IDWriteFontFaceReference* pFontFaceReference;
  hr = pDWriteFactory->CreateFontFaceReference(pFontFile, fontIndex, DWRITE_FONT_SIMULATIONS_NONE, &pFontFaceReference);

  if (SUCCEEDED(hr))
  {
    hr = pFontSetBuilder->AddFontFaceReference(pFontFaceReference);
  }
} 
```



  
6. <span data-ttu-id="348a7-247">Une fois toutes les visages ajoutées au générateur de jeu de polices, créez le jeu de polices personnalisé, comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-247">After all the faces have been added to the font set builder, create the custom font set, as shown above.</span></span>  
</dl>

<span data-ttu-id="348a7-248">Une application peut être conçue pour utiliser la méthode [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) par défaut lors de l’exécution sur Windows 10 Creators Update, mais revenir à l’utilisation de la méthode [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) lors de l’exécution sur des versions antérieures de Windows 10.</span><span class="sxs-lookup"><span data-stu-id="348a7-248">An app can be designed so that it will use the preferred [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method when running on the Windows 10 Creators Update, but fall back to use the [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method when running on earlier Windows 10 versions.</span></span> <span data-ttu-id="348a7-249">Testez la disponibilité de l’interface [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) , comme décrit ci-dessus, puis branchement en conséquence.</span><span class="sxs-lookup"><span data-stu-id="348a7-249">Test for availability of the [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) interface, as described above, and then branch accordingly.</span></span> <span data-ttu-id="348a7-250">Cette approche est illustrée dans l' [exemple de jeux de polices personnalisées DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="348a7-250">This approach is illustrated in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> 

### <a name="creating-a-font-set-using-known-fonts-in-the-local-file-system"></a><span data-ttu-id="348a7-251">Création d’un jeu de polices à l’aide des polices connues dans le système de fichiers local</span><span class="sxs-lookup"><span data-stu-id="348a7-251">Creating a font set using known fonts in the local file system</span></span>

<span data-ttu-id="348a7-252">Comme indiqué ci-dessus, chaque référence de type de police dans un jeu de polices est associée à certaines propriétés d’information, telles que le nom de famille et l’épaisseur de police.</span><span class="sxs-lookup"><span data-stu-id="348a7-252">As mentioned above, each font face reference in a font set is associated with certain informational properties, such as family name and font weight.</span></span> <span data-ttu-id="348a7-253">Lorsque des polices personnalisées sont ajoutées à un générateur de jeux de polices à l’aide des appels d’API répertoriés ci-dessus, ces propriétés d’information sont obtenues directement à partir des données de police réelles, qui sont lues lors de l’ajout de la police.</span><span class="sxs-lookup"><span data-stu-id="348a7-253">When custom fonts are added to a font set builder using the API calls listed above, these informational properties are obtained directly from the actual font data, which is read as the font is added.</span></span> <span data-ttu-id="348a7-254">Toutefois, dans certaines situations, si une application a une autre source d’informations sur une police, elle peut souhaiter fournir ses propres valeurs personnalisées pour ces propriétés.</span><span class="sxs-lookup"><span data-stu-id="348a7-254">In some situations, however, if an app has another source of information about a font, it might wish to provide its own custom values for these properties.</span></span> 

<span data-ttu-id="348a7-255">À titre d’exemple, supposons qu’une application regroupe certaines polices utilisées pour présenter des éléments particuliers de l’interface utilisateur dans l’application.</span><span class="sxs-lookup"><span data-stu-id="348a7-255">As an example of how this might be useful, suppose an app bundles some fonts that are used for presenting particular user-interface elements within the app.</span></span> <span data-ttu-id="348a7-256">Dans certains cas, par exemple avec une nouvelle version de l’application, les polices spécifiques que l’application utilise pour ces éléments devront peut-être être modifiées.</span><span class="sxs-lookup"><span data-stu-id="348a7-256">At times, such as with a new app version, the specific fonts that the app uses for these elements may need to change.</span></span> <span data-ttu-id="348a7-257">Si l’application a encodé des références aux polices spécifiques, le remplacement d’une police par une autre nécessite la modification de l’une de ces références.</span><span class="sxs-lookup"><span data-stu-id="348a7-257">If the app has encoded references to the specific fonts, then replacement of one font with another will require changing every one of those references.</span></span> <span data-ttu-id="348a7-258">Au lieu de cela, si l’application utilise des propriétés personnalisées pour assigner des alias fonctionnels en fonction du type d’élément ou de texte rendu, mappe chaque alias à une police spécifique dans un emplacement, puis utilise les alias dans tous les contextes où les polices sont créées et manipulées, puis le remplacement d’une police par une autre nécessite uniquement la modification de l’emplacement où l'</span><span class="sxs-lookup"><span data-stu-id="348a7-258">Instead, if the app uses custom properties to assign functional aliases based on the type of element or text being rendered, maps each alias to a specific font in one place and then uses the aliases in all the contexts where fonts are created and manipulated, then replacing one font with another requires only changing the one place where the alias is mapped to a specific font.</span></span> 

<span data-ttu-id="348a7-259">Des valeurs personnalisées pour les propriétés d’information peuvent être assignées quand la méthode [**IDWriteFontSetBuilder :: AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) est appelée.</span><span class="sxs-lookup"><span data-stu-id="348a7-259">Custom values for informational properties can be assigned when the [**IDWriteFontSetBuilder::AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method is called.</span></span> <span data-ttu-id="348a7-260">Pour ce faire, procédez comme suit : Il peut être utilisé sur n’importe quelle version de Windows 10.</span><span class="sxs-lookup"><span data-stu-id="348a7-260">The method for doing this is as follows; this can be used on any Windows 10 version.</span></span> 

<span data-ttu-id="348a7-261">Comme indiqué ci-dessus, commencez par obtenir les interfaces [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) et [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) .</span><span class="sxs-lookup"><span data-stu-id="348a7-261">As shown above, start by obtaining the [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) and [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) interfaces.</span></span> <span data-ttu-id="348a7-262">Pour chaque type de police personnalisé à ajouter, créez un [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference), comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-262">For each custom font face to be added, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference), as shown above.</span></span> <span data-ttu-id="348a7-263">Avant que cette opération soit ajoutée au générateur de jeu de polices (dans la boucle à l’étape 5, illustrée ci-dessus), l’application définit les valeurs de propriété personnalisées à utiliser.</span><span class="sxs-lookup"><span data-stu-id="348a7-263">Before this is added to the font set builder (within the loop in step 5, shown above), however, the app defines the custom property values to be used.</span></span> 

<span data-ttu-id="348a7-264">Un ensemble de valeurs de propriétés personnalisées est défini à l’aide d’un tableau de structures de [**\_ \_ propriété de police DWRITE**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) .</span><span class="sxs-lookup"><span data-stu-id="348a7-264">A set of custom property values is defined using an array of [**DWRITE\_FONT\_PROPERTY**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) structures.</span></span> <span data-ttu-id="348a7-265">Chacun d’entre eux identifie une propriété particulière de l’énumération de l' [**\_ ID de \_ propriété \_ de police DWRITE**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) et la valeur de propriété correspondante à utiliser.</span><span class="sxs-lookup"><span data-stu-id="348a7-265">Each of these identifies a particular property from the [**DWRITE\_FONT\_PROPERTY\_ID**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) enum, and the corresponding property value that is to be used.</span></span>  

<span data-ttu-id="348a7-266">Notez que toutes les valeurs de propriété sont affectées en tant que chaînes.</span><span class="sxs-lookup"><span data-stu-id="348a7-266">Note that all property values are assigned as strings.</span></span> <span data-ttu-id="348a7-267">Si ces derniers peuvent être affichés ultérieurement pour les utilisateurs, d’autres valeurs pour une propriété donnée pour différentes langues peuvent être définies, mais cela n’est pas obligatoire.</span><span class="sxs-lookup"><span data-stu-id="348a7-267">If these may later be displayed to users, then alternate values for a given property for different languages may be set, but this is not required.</span></span> <span data-ttu-id="348a7-268">Notez également que si des valeurs de propriété personnalisées sont définies par l’application, seules les valeurs spécifiées seront utilisées dans le jeu de polices. DirectWrite ne dérivera pas de valeurs directement à partir de la police pour les propriétés d’information utilisées dans un jeu de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-268">Also note that if any custom property values are set by the app, then only those values that are specified will be used within the Font set; DirectWrite will not derive any values directly from the font for informational properties used in a font set.</span></span> 

<span data-ttu-id="348a7-269">L’exemple suivant définit des valeurs personnalisées pour trois propriétés d’information : le nom de famille, le nom complet et l’épaisseur de police.</span><span class="sxs-lookup"><span data-stu-id="348a7-269">The following example defines custom values for three informational properties: family name, full name, and font weight.</span></span> 


```C++
DWRITE_FONT_PROPERTY props[] = 
{ 
  { DWRITE_FONT_PROPERTY_ID_FAMILY_NAME, L"My Icon Font", L"en-US" }, 
  { DWRITE_FONT_PROPERTY_ID_FULL_NAME, L"My Icon Font", L"en-US" }, 
  { DWRITE_FONT_PROPERTY_ID_WEIGHT, L"400", nullptr } 
}; 
               
            
```



<span data-ttu-id="348a7-270">Après avoir défini le tableau souhaité de valeurs de propriété pour une police, effectuez un appel à AddFontFaceRefence, en passant le tableau de propriétés ainsi que la référence de type de police.</span><span class="sxs-lookup"><span data-stu-id="348a7-270">After defining the desired array of property values for a font, make a call to AddFontFaceRefence, passing the property array as well as the font face reference.</span></span> 


```C++
hr = pFontSetBuilder->AddFontFaceReference(pFontFaceReference, props, ARRAYSIZE(props)); 
```



 

<span data-ttu-id="348a7-271">Une fois que toutes les polices personnalisées ont été ajoutées au générateur de jeu de polices, avec leurs propriétés personnalisées, créez le jeu de polices personnalisé, comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-271">Once all custom font faces have been added to the font set builder, along with their custom properties, create the custom font set, as shown above.</span></span> 

### <a name="creating-a-custom-font-set-using-known-remote-fonts-on-the-web"></a><span data-ttu-id="348a7-272">Création d’un jeu de polices personnalisé à l’aide de polices distantes connues sur le Web</span><span class="sxs-lookup"><span data-stu-id="348a7-272">Creating a custom font set using known, remote fonts on the Web</span></span>

<span data-ttu-id="348a7-273">Les propriétés personnalisées sont importantes pour l’utilisation des polices distantes.</span><span class="sxs-lookup"><span data-stu-id="348a7-273">Custom properties are important for working with remote fonts.</span></span> <span data-ttu-id="348a7-274">Chaque référence de type de police doit avoir des propriétés d’informations pour caractériser la police et la distinguer des autres polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-274">Each font face reference must have some informational properties to characterize the font and distinguish it from other fonts.</span></span> <span data-ttu-id="348a7-275">Étant donné que les données de police des polices distantes ne sont pas locales, DirectWrite ne peut pas dériver directement les propriétés des données de police.</span><span class="sxs-lookup"><span data-stu-id="348a7-275">Since the font data for remote fonts is not local, DirectWrite cannot derive properties directly from the font data.</span></span> <span data-ttu-id="348a7-276">Par conséquent, les propriétés doivent être fournies explicitement lors de l’ajout d’une police à distance au générateur de jeu de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-276">Hence, properties must be provided explicitly when adding a remote font to the font set builder.</span></span>

<span data-ttu-id="348a7-277">La séquence d’appels d’API permettant d’ajouter des polices distantes à un jeu de polices est semblable à celle décrite dans le scénario précédent.</span><span class="sxs-lookup"><span data-stu-id="348a7-277">The sequence of API calls for adding remote fonts to a font set is similar to the sequence described for the previous scenario.</span></span> <span data-ttu-id="348a7-278">Dans la mesure où les données de police sont distantes, les opérations impliquées dans la lecture des données de police réelles sont différentes de celles que vous utilisez pour travailler avec des fichiers dans le stockage local.</span><span class="sxs-lookup"><span data-stu-id="348a7-278">Since the font data is remote, however, the operations involved for reading the actual font data will be different than when working with files in local storage.</span></span> <span data-ttu-id="348a7-279">Dans ce cas, une nouvelle interface de niveau inférieur, [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader), a été ajoutée dans Windows 10 Creators Update.</span><span class="sxs-lookup"><span data-stu-id="348a7-279">For this situation, a new lower-level interface, [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader), has been added in the Windows 10 Creators Update.</span></span> 

<span data-ttu-id="348a7-280">Pour utiliser le chargeur de fichiers de polices à distance, il doit d’abord être inscrit auprès d’une fabrique DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="348a7-280">To use the remote font file loader, it must first be registered with a DirectWrite factory.</span></span> <span data-ttu-id="348a7-281">Le chargeur doit être détenu par l’application tant que les polices qui lui sont associées sont utilisées.</span><span class="sxs-lookup"><span data-stu-id="348a7-281">The loader will need to be held by the app for as long as the fonts associated with it are being used.</span></span> <span data-ttu-id="348a7-282">Une fois que les polices ne sont plus utilisées, et à un moment donné avant la destruction de la fabrique, le chargeur doit être désinscrit.</span><span class="sxs-lookup"><span data-stu-id="348a7-282">Once the fonts are no longer in use, and at some point before the factory is destroyed, the loader must be unregistered.</span></span> <span data-ttu-id="348a7-283">Cela peut être fait dans le destructeur de la classe qui possède l’objet Loader.</span><span class="sxs-lookup"><span data-stu-id="348a7-283">This can be done in the destructor for the class that owns the loader object.</span></span> <span data-ttu-id="348a7-284">Ces étapes sont présentées ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="348a7-284">These steps will be shown below.</span></span> 

<span data-ttu-id="348a7-285">La méthode de création d’un jeu de polices personnalisé à l’aide de polices distantes est la suivante : Cela nécessite la mise à jour de Windows 10 Creators.</span><span class="sxs-lookup"><span data-stu-id="348a7-285">The method for creating a custom font set using remote fonts is as follows; this requires the Windows 10 Creators Update.</span></span>  

<dl> <span data-ttu-id="348a7-286">1. Créez une interface IDWriteFactory5, comme illustré ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-286">1. Create an IDWriteFactory5 interface, as shown above.</span></span>   
<span data-ttu-id="348a7-287">2. Créez une interface <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder">IDWriteFontSetBuilder</a> , comme illustré ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-287">2. Create an <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder">IDWriteFontSetBuilder</a> interface, as shown above.</span></span>   
<span data-ttu-id="348a7-288">3. Utilisez la fabrique pour obtenir un <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader">IDWriteRemoteFontFileLoader</a>.</span><span class="sxs-lookup"><span data-stu-id="348a7-288">3. Use the factory to obtain an <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader">IDWriteRemoteFontFileLoader</a>.</span></span> 


```C++
IDWriteRemoteFontFileLoader* pRemoteFontFileLoader; 
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->CreateHttpFontFileLoader( 
        /* referrerURL */ nullptr, 
        /* extraHeaders */ nullptr, 
        &pRemoteFontFileLoader 
    ); 
} 
```



<span data-ttu-id="348a7-289">Cela retourne une implémentation fournie par le système de l’interface de chargeur de fichiers de polices distantes qui est en mesure de gérer les interactions HTTP pour le téléchargement des données de police pour le compte de l’application.</span><span class="sxs-lookup"><span data-stu-id="348a7-289">This returns a system-provided implementation of the remote font file loader interface that is able to handle HTTP interactions for downloading font data on behalf of the app.</span></span> <span data-ttu-id="348a7-290">Une URL de point d’accès ou des en-têtes supplémentaires peuvent être spécifiés si requis par le service de police ou les services qui constituent la source des polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-290">A referrer URL or extra headers can be specified if required by the font service or services that are the source for the fonts.</span></span>    

> [!IMPORTANT]
> <span data-ttu-id="348a7-291">Remarque relative à la sécurité : lorsqu’une tentative est effectuée pour extraire une police distante, il est possible qu’une personne malveillante usurpe le serveur prévu qui sera appelé.</span><span class="sxs-lookup"><span data-stu-id="348a7-291">Security note: When an attempt is made to fetch a remote font, the potential exists for an attacker to spoof the intended server that will be called.</span></span> <span data-ttu-id="348a7-292">Dans ce cas, les URL de cible et de référent et les détails d’en-tête sont divulgués à la personne malveillante.</span><span class="sxs-lookup"><span data-stu-id="348a7-292">In that case, the target and referrer URLs and header details would be disclosed to the attacker.</span></span> <span data-ttu-id="348a7-293">Les développeurs d’applications sont responsables de l’atténuation de ce risque.</span><span class="sxs-lookup"><span data-stu-id="348a7-293">App developers are responsible for mitigating this risk.</span></span> <span data-ttu-id="348a7-294">Il est recommandé d’utiliser le protocole HTTPs plutôt que HTTP.</span><span class="sxs-lookup"><span data-stu-id="348a7-294">Use of the HTTPS protocol, rather than HTTP, is recommended.</span></span> 

 

<span data-ttu-id="348a7-295">Un chargeur de fichiers de polices à distance unique peut être utilisé pour plusieurs polices, même si différents chargeurs peuvent être utilisés si des polices sont obtenues à partir de plusieurs services qui ont des exigences différentes pour l’URL de renvoi ou les en-têtes supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="348a7-295">A single remote font file loader can be used for multiple fonts, though different loaders can be used if fonts are obtained from multiple services that have different requirements for referrer URL or extra headers.</span></span>   
4. <span data-ttu-id="348a7-296">Inscrivez le chargeur de fichiers de polices à distance avec la fabrique.</span><span class="sxs-lookup"><span data-stu-id="348a7-296">Register the remote font file loader with the factory.</span></span> 


```C++
 if (SUCCEEDED(hr)) 
 { 
     hr = pDWriteFactory->RegisterFontFileLoader(pRemoteFontFileLoader); 
 } 
```



<span data-ttu-id="348a7-297">À partir de ce point, les étapes de création du jeu de polices personnalisé sont similaires à celles décrites pour les fichiers de polices locales connus, avec deux exceptions importantes.</span><span class="sxs-lookup"><span data-stu-id="348a7-297">From this point, the steps for creating the custom font set are similar to those described for known, local font files, with two important exceptions.</span></span> <span data-ttu-id="348a7-298">Tout d’abord, l’objet [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) est créé à l’aide de l’interface du chargeur de fichiers de polices distantes au lieu d’utiliser la fabrique.</span><span class="sxs-lookup"><span data-stu-id="348a7-298">First, the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object is created using the remote font file loader interface rather than using the factory.</span></span> <span data-ttu-id="348a7-299">Deuxièmement, la méthode Analyze ne peut pas être utilisée, car les données de police ne sont pas locales.</span><span class="sxs-lookup"><span data-stu-id="348a7-299">Second, the Analyze method cannot be used since the font data is not local.</span></span> <span data-ttu-id="348a7-300">Au lieu de cela, l’application doit savoir si le fichier de police à distance est un fichier de collection de polices OpenType et, si tel est le cas, il doit savoir laquelle des polices de la collection sera utilisée et l’index de chaque.</span><span class="sxs-lookup"><span data-stu-id="348a7-300">Instead, the app must know whether the remote font file is an OpenType Font Collection file, and if so, then it must know which of the fonts within the collection it will use, and the index for each.</span></span> <span data-ttu-id="348a7-301">Par conséquent, les étapes restantes sont les suivantes.</span><span class="sxs-lookup"><span data-stu-id="348a7-301">Hence, the remaining steps are as follows.</span></span>   
5. <span data-ttu-id="348a7-302">Pour chaque fichier de polices à distance, utilisez l’interface du chargeur de fichier de police à distance pour créer un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), en spécifiant l’URL requise pour accéder au fichier de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-302">For each remote font file, use the remote font file loader interface to create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), specifying the URL required to access the font file.</span></span> 


```C++
 IDWriteFontFile* pFontFile; 
 hr = pRemoteFontFileLoader->CreateFontFileReferenceFromUrl( 
     pDWriteFactory, 
     /* baseUrl */ L"https://github.com/", 
     /* fontFileUrl */ L"winjs/winjs/blob/master/src/fonts/Symbols.ttf?raw=true", 
     &pFontFile 
 ); 
```



<span data-ttu-id="348a7-303">Notez que l’URL complète peut être spécifiée dans le paramètre fontFileUrl, ou elle peut être fractionnée en portions de base et relatives.</span><span class="sxs-lookup"><span data-stu-id="348a7-303">Note that the complete URL can be specified in the fontFileUrl parameter, or it can be split into base and relative portions.</span></span> <span data-ttu-id="348a7-304">Si une URL de base est spécifiée, la concaténation des valeurs baseUrl et fontFileUrl doit fournir l’URL complète : DirectWrite ne fournit pas de délimiteur supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="348a7-304">If a base URL is specified, then the concatenation of the baseUrl and fontFileUrl values must provide the complete URL — DirectWrite will not supply any additional delimiter.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="348a7-305">Remarque relative à la sécurité et aux performances : lors d’une tentative d’extraction d’une police distante, il n’y a aucune garantie que Windows recevra une réponse du serveur.</span><span class="sxs-lookup"><span data-stu-id="348a7-305">Security / performance note: When an attempt is made to fetch a remote font, there is no guarantee that Windows will receive a response from the server.</span></span> <span data-ttu-id="348a7-306">Dans certains cas, un serveur peut répondre avec une erreur de fichier introuvable pour une URL relative non valide, mais ne plus répondre s’il reçoit plusieurs demandes non valides.</span><span class="sxs-lookup"><span data-stu-id="348a7-306">In some cases, a server may respond with a file-not-found error for an invalid relative URL, but stop responding if it receives multiple invalid requests.</span></span> <span data-ttu-id="348a7-307">Si le serveur ne répond pas, Windows finit par expirer, mais cela peut prendre plusieurs minutes si plusieurs extractions sont lancées.</span><span class="sxs-lookup"><span data-stu-id="348a7-307">If the server does not respond, Windows will eventually time out, though this may take several minutes if multiple fetches are initiated.</span></span> <span data-ttu-id="348a7-308">Vous devez effectuer ce qui vous permet de vous assurer que les URL sont valides lorsque des appels sont effectués.</span><span class="sxs-lookup"><span data-stu-id="348a7-308">You should do what you can to ensure that URLs will be valid when calls are made.</span></span> 

 

<span data-ttu-id="348a7-309">Notez également que l’URL peut pointer vers un fichier de police OpenType brut (. ttf,. otf,. TTC,. OTC), mais elle peut également pointer vers des polices dans un fichier conteneur WOFF ou WOFF2.</span><span class="sxs-lookup"><span data-stu-id="348a7-309">Also note that the URL can point to a raw OpenType font file (.ttf, .otf, .ttc, .otc), but it can also point to fonts in a WOFF or WOFF2 container file.</span></span> <span data-ttu-id="348a7-310">Si un fichier WOFF ou WOFF2 est référencé, l’implémentation DirectWrite du chargeur de fichiers de polices distantes décompresse automatiquement les données de police du fichier conteneur.</span><span class="sxs-lookup"><span data-stu-id="348a7-310">If a WOFF or WOFF2 file is referenced, then the DirectWrite implementation of the remote font file loader will automatically unpack the font data from the container file.</span></span>   
6. <span data-ttu-id="348a7-311">Pour chaque index de type de police dans le fichier de polices à distance à utiliser, créez un [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference).</span><span class="sxs-lookup"><span data-stu-id="348a7-311">For each font face index within the remote font file that is to be used, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference).</span></span> 


```C++
 IDWriteFontFaceReference* pFontFaceReference; 
 hr = pDWriteFactory->CreateFontFaceReference(pFontFile, /* faceIndex */ 0, DWRITE_FONT_SIMULATIONS_NONE, &pFontFaceReference);
```



  
7. <span data-ttu-id="348a7-312">Définissez les propriétés personnalisées du type de police, comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-312">Define custom properties for the font face, as shown above.</span></span>   
8. <span data-ttu-id="348a7-313">Ajoutez la référence de type de police avec les propriétés personnalisées au générateur de jeu de polices, comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-313">Add the font face reference along with custom properties to the font set builder, as shown above.</span></span>   
9. <span data-ttu-id="348a7-314">Une fois que toutes les polices ont été ajoutées au générateur de jeu de polices, créez le jeu de polices, comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-314">After all fonts have been added to the font set builder, create the font set, as shown above.</span></span>   
10. <span data-ttu-id="348a7-315">À un moment donné, lorsque les polices distantes ne sont plus utilisées, annulez l’inscription du chargeur de fichiers de polices distantes.</span><span class="sxs-lookup"><span data-stu-id="348a7-315">At some point when the remote fonts will no longer be used, unregister the remote font file loader.</span></span> 


```C++
hr = pDWriteFactory->UnregisterFontFileLoader(pRemoteFontFileLoader); 
```



  
</dl>

<span data-ttu-id="348a7-316">Une fois qu’un jeu de polices personnalisé avec des polices distantes personnalisées est créé, le jeu de polices contient des références et des propriétés d’informations pour les polices distantes, mais les données réelles sont toujours distantes.</span><span class="sxs-lookup"><span data-stu-id="348a7-316">Once a custom font set with custom remote fonts is created, the font set contains references and informational properties for the remote fonts, but the actual data is still remote.</span></span> <span data-ttu-id="348a7-317">La prise en charge de DirectWrite pour les polices distantes permet de conserver une référence de police de police dans le jeu de polices, et de sélectionner une police à utiliser dans la mise en page et le rendu, mais que les données réelles ne sont pas téléchargées jusqu’à ce qu’il y ait un réel besoin de l’utiliser, par exemple lorsque la disposition du texte sera effectuée.</span><span class="sxs-lookup"><span data-stu-id="348a7-317">DirectWrite support for remote fonts allows a font face reference to be maintained in the font set, and for a font to be selected for use in layout and rendering, but that the actual data is not downloaded until there is an actual need to use it, such as when text layout will be performed.</span></span>  

<span data-ttu-id="348a7-318">Une application peut prendre une approche de premier plan en demandant à DirectWrite de télécharger les données de police, puis d’attendre la confirmation d’un téléchargement réussi avant le début du traitement de la police.</span><span class="sxs-lookup"><span data-stu-id="348a7-318">An app can take an up-front approach by requesting that DirectWrite download the font data and then waiting for confirmation of a successful download before any processing with the font is begun.</span></span> <span data-ttu-id="348a7-319">Toutefois, un téléchargement réseau implique une certaine latence de durée imprévisible, et la réussite est également incertaine.</span><span class="sxs-lookup"><span data-stu-id="348a7-319">But a network download implies some latency of unpredictable duration, and success is also uncertain.</span></span> <span data-ttu-id="348a7-320">Pour cette raison, il est généralement préférable d’adopter une approche différente, ce qui permet d’effectuer la mise en page et le rendu initialement à l’aide de polices alternatives ou de secours déjà locales, tout en demandant le téléchargement de la police distante souhaitée en parallèle, puis en mettant à jour les résultats une fois que la police souhaitée a été téléchargée.</span><span class="sxs-lookup"><span data-stu-id="348a7-320">For this reason, it will usually be better to take a different approach, allowing layout and rendering to be done initially using alternate or fallback fonts that are already local, while requesting download of the desired, remote font in parallel, and then updating the results once the desired font has been downloaded.</span></span> 

<span data-ttu-id="348a7-321">Pour demander que la police entière soit téléchargée avant d’être utilisée, la méthode [**IDWriteFontFaceReference :: EnqueueFontDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuefontdownloadrequest) peut être utilisée.</span><span class="sxs-lookup"><span data-stu-id="348a7-321">To request that the entire font be downloaded before it gets used, the [**IDWriteFontFaceReference::EnqueueFontDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuefontdownloadrequest) method can be used.</span></span> <span data-ttu-id="348a7-322">Si la police est très volumineuse, seule une partie des données peut être nécessaire pour traiter des chaînes particulières.</span><span class="sxs-lookup"><span data-stu-id="348a7-322">If the font is very large, only a portion of the data may be needed for processing particular strings.</span></span> <span data-ttu-id="348a7-323">DirectWrite fournit des méthodes supplémentaires qui peuvent être utilisées pour demander des portions des données de police nécessaires à un contenu particulier, [**EnqueueCharacterDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuecharacterdownloadrequest) et [**EnqueueGlyphDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueueglyphdownloadrequest).</span><span class="sxs-lookup"><span data-stu-id="348a7-323">DirectWrite provides additional methods that can be used to request portions of the font data needed for particular content, [**EnqueueCharacterDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuecharacterdownloadrequest) and [**EnqueueGlyphDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueueglyphdownloadrequest).</span></span>  

<span data-ttu-id="348a7-324">Supposons que l’approche à prendre dans l’application consiste à permettre au traitement d’être effectué initialement à l’aide de polices locales, alternatives ou de secours.</span><span class="sxs-lookup"><span data-stu-id="348a7-324">Suppose the approach to be taken in the app is to allow processing to be done initially using local, alternate or fallback fonts.</span></span> <span data-ttu-id="348a7-325">La méthode IDWriteFontFallback ::[**MapCharacters**](idwritefontfallback-mapcharacters.md) peut être utilisée pour identifier les polices de secours locales et met automatiquement en file d’attente une requête pour télécharger la police par défaut.</span><span class="sxs-lookup"><span data-stu-id="348a7-325">The IDWriteFontFallback::[**MapCharacters**](idwritefontfallback-mapcharacters.md) method can be used to identify local fallback fonts, and it will also automatically enqueue a request to download the preferred font.</span></span> <span data-ttu-id="348a7-326">En outre, si [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) est utilisé et que tout ou partie du texte de la disposition est mis en forme à l’aide d’une référence de police à distance, DirectWrite utilise automatiquement la méthode **MapCharacters** pour obtenir les polices de secours locales et mettre en file d’attente une requête pour télécharger les données de police distantes.</span><span class="sxs-lookup"><span data-stu-id="348a7-326">Also, if [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) is used and some or all of the text in the layout is formatted using a remote font reference, then DirectWrite will automatically use the **MapCharacters** method to get local fallback fonts and to enqueue a request to download the remote font data.</span></span> 

<span data-ttu-id="348a7-327">DirectWrite gère une file d’attente de téléchargement de polices pour chaque fabrique, et les demandes effectuées à l’aide des méthodes mentionnées ci-dessus sont ajoutées à cette file d’attente.</span><span class="sxs-lookup"><span data-stu-id="348a7-327">DirectWrite maintains a font download queue for each factory, and the requests made using the methods mentioned above get added to that queue.</span></span> <span data-ttu-id="348a7-328">La file d’attente de téléchargement de la police peut être obtenue à l’aide de la méthode [**IDWriteFactory3 :: GetFontDownloadQueue**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getfontdownloadqueue) .</span><span class="sxs-lookup"><span data-stu-id="348a7-328">The font download queue can be obtained using the [**IDWriteFactory3::GetFontDownloadQueue**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getfontdownloadqueue) method.</span></span> 

<span data-ttu-id="348a7-329">Si une demande de téléchargement est effectuée alors que les données de police sont déjà locales, cela aboutit à une absence d’opération : rien n’est ajouté à la file d’attente de téléchargement.</span><span class="sxs-lookup"><span data-stu-id="348a7-329">If a download request is made but the font data is already local, this will result in a no-op: Nothing will be added to the download queue.</span></span> <span data-ttu-id="348a7-330">Une application peut vérifier si la file d’attente est vide ou s’il y a des demandes de téléchargement en attente en appelant la méthode [**IDWriteFontDownloadQueue :: IsEmpty**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-isempty) .</span><span class="sxs-lookup"><span data-stu-id="348a7-330">An app can check whether the queue is empty or there are pending download requests by calling the [**IDWriteFontDownloadQueue::IsEmpty**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-isempty) method.</span></span> 

<span data-ttu-id="348a7-331">Une fois que des demandes de polices distantes ont été ajoutées à la file d’attente, le processus de téléchargement doit être initié.</span><span class="sxs-lookup"><span data-stu-id="348a7-331">After remote font requests have been added to the queue, the download process must be initiated.</span></span> <span data-ttu-id="348a7-332">Lorsque des polices distantes sont utilisées dans [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout), le téléchargement est lancé automatiquement quand l’application appelle les méthodes **IDWriteTextLayout** qui forcent les opérations de disposition ou de rendu, telles que les méthodes GetLineMetrics ou Draw.</span><span class="sxs-lookup"><span data-stu-id="348a7-332">When remote fonts are used in [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout), the download will be initiated automatically when the app calls **IDWriteTextLayout** methods that force layout or rendering operations, such as the GetLineMetrics or Draw methods.</span></span> <span data-ttu-id="348a7-333">Dans d’autres scénarios, l’application doit lancer le téléchargement directement en appelant [**IDWriteFontDownloadQueue :: BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload).</span><span class="sxs-lookup"><span data-stu-id="348a7-333">In other scenarios, the app must initiate the download directly by calling [**IDWriteFontDownloadQueue::BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload).</span></span>  

<span data-ttu-id="348a7-334">Une fois le téléchargement terminé, il revient à l’application de prendre les mesures appropriées, en effectuant les opérations en attente ou en répétant les opérations qui ont été effectuées initialement avec les polices de secours.</span><span class="sxs-lookup"><span data-stu-id="348a7-334">When a download is completed, it will be up to the app to take appropriate actions — proceeding with pending operations, or repeating operations that were done initially with fallback fonts.</span></span> <span data-ttu-id="348a7-335">(Si la disposition du texte de DirectWrite est utilisée, [**IDWriteTextLayout3 :: InvalidateLayout**](idwritetextlayout3-invalidatelayout.md) peut être utilisé pour effacer les résultats temporaires calculés à l’aide des polices de secours.) Pour que l’application soit notifiée lorsque le processus de téléchargement est terminé et pour prendre les mesures appropriées, l’application doit fournir une implémentation de l’interface [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) et la transmettre à l’appel BeginDownload.</span><span class="sxs-lookup"><span data-stu-id="348a7-335">(If DirectWrite’s text layout is being used, then [**IDWriteTextLayout3::InvalidateLayout**](idwritetextlayout3-invalidatelayout.md) can be used to clear the temporary results computed using fallback fonts.) In order for the app to be notified when the download process has completed and to take appropriate actions, the app must provide an implementation of the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface, and pass this into the BeginDownload call.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="348a7-336">Remarque relative à la sécurité et aux performances : lors d’une tentative d’extraction d’une police distante, il n’y a aucune garantie que Windows recevra une réponse du serveur.</span><span class="sxs-lookup"><span data-stu-id="348a7-336">Security / performance note: When an attempt is made to fetch a remote font, there is no guarantee that Windows will receive a response from the server.</span></span> <span data-ttu-id="348a7-337">Si le serveur ne répond pas, Windows finit par expirer, mais cela peut prendre plusieurs minutes si plusieurs polices distantes sont récupérées mais échouent.</span><span class="sxs-lookup"><span data-stu-id="348a7-337">If the server does not respond, Windows will eventually time out, though this may take several minutes if multiple remote fonts are being fetched but failing.</span></span> <span data-ttu-id="348a7-338">L’appel BeginDownload est retourné immédiatement.</span><span class="sxs-lookup"><span data-stu-id="348a7-338">The BeginDownload call will return immediately.</span></span> <span data-ttu-id="348a7-339">Les applications ne doivent pas bloquer l’interface utilisateur en attendant l’appel de [**IDWriteFontDownloadListener ::D ownloadcompleted**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadlistener-downloadcompleted) .</span><span class="sxs-lookup"><span data-stu-id="348a7-339">Apps should not block UI while waiting for [**IDWriteFontDownloadListener::DownloadCompleted**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadlistener-downloadcompleted) to be called.</span></span> 

 

<span data-ttu-id="348a7-340">Des exemples d’implémentations de ces interactions avec la file d’attente de téléchargement de polices de DirectWrite et de l’interface [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) peuvent être consultés dans l' [exemple de jeux de polices personnalisées DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/)et également dans l' [exemple de polices téléchargeables DirectWrite](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/DWriteTextLayoutCloudFont).</span><span class="sxs-lookup"><span data-stu-id="348a7-340">Sample implementations of these interactions with DirectWrite’s font download queue and of the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface can be seen in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/), and also in the [DirectWrite Downloadable Fonts sample](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/DWriteTextLayoutCloudFont).</span></span> 

### <a name="creating-a-custom-font-set-using-font-data-loaded-into-memory"></a><span data-ttu-id="348a7-341">Création d’un jeu de polices personnalisé à l’aide des données de police chargées en mémoire</span><span class="sxs-lookup"><span data-stu-id="348a7-341">Creating a custom font set using font data loaded into memory</span></span>

<span data-ttu-id="348a7-342">Tout comme les opérations de bas niveau pour la lecture de données à partir d’un fichier de polices sont différentes pour les fichiers sur un disque local et les fichiers distants sur le Web, il en va de même pour les données de police chargées dans une mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="348a7-342">Just as the low-level operations for reading data from a font file are different for files on a local disk versus remote files on the Web, the same is also true for font data loaded into a memory buffer.</span></span> <span data-ttu-id="348a7-343">Une nouvelle interface de bas niveau pour gérer les données de police en mémoire a été ajoutée dans Windows 10 Creators Update, [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader).</span><span class="sxs-lookup"><span data-stu-id="348a7-343">A new low-level interface for handling in-memory font data has been added in the Windows 10 Creators Update, [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader).</span></span> 

<span data-ttu-id="348a7-344">Comme avec un chargeur de fichiers de polices à distance, un chargeur de fichier de police en mémoire doit d’abord être inscrit auprès d’une fabrique DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="348a7-344">As with a remote font file loader, an in-memory font file loader must first be registered with a DirectWrite factory.</span></span> <span data-ttu-id="348a7-345">Le chargeur doit être détenu par l’application tant que les polices qui lui sont associées sont utilisées.</span><span class="sxs-lookup"><span data-stu-id="348a7-345">The loader will need to be held by the app for as long as the fonts associated with it are being used.</span></span> <span data-ttu-id="348a7-346">Une fois que les polices ne sont plus utilisées, et à un moment donné avant la destruction de la fabrique, le chargeur doit être désinscrit.</span><span class="sxs-lookup"><span data-stu-id="348a7-346">Once the fonts are no longer in use, and at some point before the factory is destroyed, the loader must be unregistered.</span></span> <span data-ttu-id="348a7-347">Cela peut être fait dans le destructeur de la classe qui possède l’objet Loader.</span><span class="sxs-lookup"><span data-stu-id="348a7-347">This can be done in the destructor for the class that owns the loader object.</span></span> <span data-ttu-id="348a7-348">Ces étapes sont présentées ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="348a7-348">These steps will be shown below.</span></span> 

<span data-ttu-id="348a7-349">Si l’application a des informations distinctes sur les visages de police représentées par les données, elle peut ajouter des références de type de police à un générateur de jeu de polices avec des propriétés personnalisées spécifiées.</span><span class="sxs-lookup"><span data-stu-id="348a7-349">If the app has separate information about the font faces represented by the data, it can add individual font face references to a font set builder with custom properties specified.</span></span> <span data-ttu-id="348a7-350">Dans la mesure où les données de police sont dans la mémoire locale, toutefois, cela n’est pas obligatoire. DirectWrite sera en mesure de lire les données directement pour dériver les valeurs de propriété.</span><span class="sxs-lookup"><span data-stu-id="348a7-350">Since the font data is in local memory, however, this is not required; DirectWrite will be able to read the data directly to derive the property values.</span></span> 

<span data-ttu-id="348a7-351">DirectWrite part du principe que les données de police sont au format RAW, OpenType, équivalentes à un fichier OpenType (. ttf,. otf,. TTC,. OTC), mais en mémoire plutôt que sur le disque.</span><span class="sxs-lookup"><span data-stu-id="348a7-351">DirectWrite assumes the font data is in raw, OpenType format, equivalent to an OpenType file (.ttf, .otf, .ttc, .otc), but in memory rather than on disk.</span></span> <span data-ttu-id="348a7-352">Les données ne peuvent pas être dans un format de conteneur WOFF ou WOFF2.</span><span class="sxs-lookup"><span data-stu-id="348a7-352">The data cannot be in a WOFF or WOFF2 container format.</span></span> <span data-ttu-id="348a7-353">Les données peuvent représenter une collection de polices OpenType.</span><span class="sxs-lookup"><span data-stu-id="348a7-353">The data can represent an OpenType Font Collection.</span></span> <span data-ttu-id="348a7-354">Si les propriétés personnalisées ne sont pas utilisées, la méthode [**IDWriteFontSetBuilder1 :: AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) peut être utilisée pour ajouter toutes les faces de police dans les données en un seul appel.</span><span class="sxs-lookup"><span data-stu-id="348a7-354">If custom properties are not being used, then the [**IDWriteFontSetBuilder1::AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method can be used to add all font faces in the data in a single call.</span></span> 

<span data-ttu-id="348a7-355">Un point important à prendre en compte pour le scénario en mémoire est la durée de vie des données.</span><span class="sxs-lookup"><span data-stu-id="348a7-355">An important consideration for the in-memory scenario is the lifetime of the data.</span></span> <span data-ttu-id="348a7-356">Si un pointeur vers la mémoire tampon est fourni à DirectWrite sans indication claire qu’il y a un propriétaire, DirectWrite effectue une copie des données dans une nouvelle mémoire tampon dont il est propriétaire.</span><span class="sxs-lookup"><span data-stu-id="348a7-356">If a pointer to the buffer is provided to DirectWrite without a clear indication that there is an owner, then DirectWrite will make a copy of the data into a new memory buffer that it will own.</span></span> <span data-ttu-id="348a7-357">Pour éviter la copie de données et l’allocation de mémoire supplémentaire, l’application peut passer un objet de propriétaire de données qui implémente IUnknown et qui possède la mémoire tampon contenant les données de police.</span><span class="sxs-lookup"><span data-stu-id="348a7-357">To avoid copying of data and additional memory allocation, the app can pass a data-owner object that implements IUnknown, and that owns the memory buffer containing the font data.</span></span> <span data-ttu-id="348a7-358">En implémentant cette interface, DirectWrite peut ajouter au nombre de références de l’objet, garantissant ainsi la durée de vie des données détenues.</span><span class="sxs-lookup"><span data-stu-id="348a7-358">By implementing this interface, DirectWrite can add to the ref count of the object, thereby ensuring the lifetime of the owned data.</span></span> 

<span data-ttu-id="348a7-359">La méthode de création d’un jeu de polices personnalisé à l’aide des données de police en mémoire est la suivante : Cela nécessite la mise à jour de Windows 10 Creators.</span><span class="sxs-lookup"><span data-stu-id="348a7-359">The method for creating a custom font set using in-memory font data is as follows; this requires the Windows 10 Creators Update.</span></span> <span data-ttu-id="348a7-360">Cela suppose un objet propriétaire de données implémenté par l’application, qui implémente IUnknown et possède également des méthodes qui retournent un pointeur vers la mémoire tampon et la taille de la mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="348a7-360">This will assume an app-implemented data-owner object, that implements IUnknown and also has methods that return a pointer to the memory buffer and the size of the buffer.</span></span> 

<dl> <span data-ttu-id="348a7-361">1. Créez une interface IDWriteFactory5, comme illustré ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-361">1. Create an IDWriteFactory5 interface, as shown above.</span></span>  
<span data-ttu-id="348a7-362">2. Créez une interface [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) , comme illustré ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-362">2. Create an [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface, as shown above.</span></span>  
<span data-ttu-id="348a7-363">3. Utilisez la fabrique pour obtenir un IDWriteInMemoryFontFileLoader.</span><span class="sxs-lookup"><span data-stu-id="348a7-363">3. Use the factory to obtain an IDWriteInMemoryFontFileLoader.</span></span> 


```C++
 IDWriteInMemoryFontFileLoader* pInMemoryFontFileLoader; 
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->CreateInMemoryFontFileLoader(&pInMemoryFontFileLoader); 
}
```



<span data-ttu-id="348a7-364">Cela retourne une implémentation fournie par le système de l’interface de chargeur de fichier de police en mémoire.</span><span class="sxs-lookup"><span data-stu-id="348a7-364">This returns a system-provided implementation of the in-memory font file loader interface.</span></span>   
4. <span data-ttu-id="348a7-365">Enregistrez le chargeur de fichier de police en mémoire avec la fabrique.</span><span class="sxs-lookup"><span data-stu-id="348a7-365">Register the in-memory font file loader with the factory.</span></span> 


```C++
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->RegisterFontFileLoader(pInMemoryFontFileLoader); 
}
```



   
5. <span data-ttu-id="348a7-366">Pour chaque fichier de police en mémoire, utilisez le chargeur de fichier de police en mémoire pour créer un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile).</span><span class="sxs-lookup"><span data-stu-id="348a7-366">For each in-memory font file, use the in-memory font file loader to create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile).</span></span> 


```C++
IDWriteFontFile* pFontFile; 
hr = pInMemoryFontFileLoader->CreateInMemoryFontFileReference( 
    pDWriteFactory, 
    pFontDataOwner->fontData /* returns void* */, 
    pFontDataOwner->fontDataSize /* returns UINT32 */, 
    pFontDataOwner /* ownerObject, owns the memory with font data and implements IUknown */, 
    &pFontFile 
); 
```



   
6. <span data-ttu-id="348a7-367">Ajoutez l’objet [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) au générateur de jeu de polices à l’aide de la méthode [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) , comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-367">Add the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object to the font set builder using the [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method, as shown above.</span></span>  <span data-ttu-id="348a7-368">En cas de besoin, l’application peut créer des objets [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) individuels basés sur le **IDWriteFontFile**, éventuellement définir des propriétés personnalisées pour chaque référence de type de police, puis ajouter la référence de type de police avec des propriétés personnalisées au jeu de polices à l’aide de la méthode [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) , comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-368">If there is a need, the app can instead create individual [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) objects based on the **IDWriteFontFile**, optionally define custom properties for each font face reference, and then add the font face reference with custom properties to the font set using the [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method, as shown above.</span></span>   
7. <span data-ttu-id="348a7-369">Une fois que toutes les polices ont été ajoutées au générateur de jeu de polices, créez le jeu de polices personnalisé, comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-369">After all fonts have been added to the font set builder, create the custom font set, as shown above.</span></span>   
8. <span data-ttu-id="348a7-370">À un moment donné, lorsque les polices en mémoire ne seront plus utilisées, annulez l’inscription du chargeur de fichier de police en mémoire.</span><span class="sxs-lookup"><span data-stu-id="348a7-370">At some point when the in-memory fonts will no longer be used, unregister the in-memory font file loader.</span></span> 


```C++
hr = pDWriteFactory->UnregisterFontFileLoader(pInMemoryFontFileLoader);
```



  
</dl>

 

## <a name="advanced-scenarios"></a><span data-ttu-id="348a7-371">Scénarios avancés</span><span class="sxs-lookup"><span data-stu-id="348a7-371">Advanced scenarios</span></span>

<span data-ttu-id="348a7-372">Certaines applications peuvent avoir des exigences spéciales qui nécessitent un traitement plus avancé que celui décrit ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-372">Some apps may have special requirements that require more advanced processing than is described above.</span></span> 

### <a name="combining-font-sets"></a><span data-ttu-id="348a7-373">Combinaison de jeux de polices</span><span class="sxs-lookup"><span data-stu-id="348a7-373">Combining font sets</span></span>

<span data-ttu-id="348a7-374">Certaines applications peuvent avoir besoin de créer un jeu de polices qui comprend une combinaison d’éléments issus d’autres jeux de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-374">Some apps may need to create a font set that comprises some combination of items from other font sets.</span></span> <span data-ttu-id="348a7-375">Par exemple, une application peut souhaiter créer un jeu de polices qui combine toutes les polices installées sur le système avec une sélection de polices personnalisées, ou qui combine des polices installées correspondant à certains critères avec d’autres polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-375">For example, an app may want to create a font set that combines all the fonts installed on the system with a selection of custom fonts, or that combines installed fonts matching certain criteria with other fonts.</span></span> <span data-ttu-id="348a7-376">DirectWrite possède des API pour prendre en charge la manipulation et la combinaison de jeux de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-376">DirectWrite has APIs to support manipulation and combining of font sets.</span></span> 

<span data-ttu-id="348a7-377">Pour combiner deux jeux de polices ou plus, la méthode [**IDWriteFontSetBuilder :: AddFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontset) ajoute toutes les polices dans un jeu de polices donné à ajouter à un générateur de jeu de polices en un seul appel.</span><span class="sxs-lookup"><span data-stu-id="348a7-377">To combine two or more font sets, the [**IDWriteFontSetBuilder::AddFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontset) method adds all of the fonts in given font set to be added to a font set builder in a single call.</span></span> <span data-ttu-id="348a7-378">Si seules certaines polices d’un jeu de polices existant sont souhaitées dans le nouveau jeu de polices, la méthode [**IDWriteFontSet :: GetMatchingFonts**](idwritefontset-getmatchingfonts-overload.md) peut être utilisée pour dériver un nouvel objet de jeu de polices qui a été filtré pour inclure uniquement les polices correspondant aux propriétés spécifiées.</span><span class="sxs-lookup"><span data-stu-id="348a7-378">If only certain fonts from an existing font set are wanted in the new font set, the [**IDWriteFontSet::GetMatchingFonts**](idwritefontset-getmatchingfonts-overload.md) method can be used to derive a new font set object that has been filtered to include only fonts matching specified properties.</span></span> <span data-ttu-id="348a7-379">Ces méthodes offrent un moyen simple de créer un jeu de polices personnalisé combinant des polices à partir de deux jeux de polices ou plus existants.</span><span class="sxs-lookup"><span data-stu-id="348a7-379">These methods provide an easy way to create a custom font set combining fonts from two or more existing font sets</span></span> 

### <a name="using-local-woff-or-woff2-font-data"></a><span data-ttu-id="348a7-380">Utilisation des données de police WOFF ou WOFF2 locales</span><span class="sxs-lookup"><span data-stu-id="348a7-380">Using local WOFF or WOFF2 font data</span></span>

<span data-ttu-id="348a7-381">Si une application possède des fichiers de polices dans le système de fichiers local ou dans une mémoire tampon, mais qu’elle utilise les formats de conteneur WOFF ou WOFF2, DirectWrite (Windows 10 Creator Update ou version ultérieure) fournit une méthode pour décompresser le format de conteneur, [**IDWriteFactory5 :: UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile), qui retourne un [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream).</span><span class="sxs-lookup"><span data-stu-id="348a7-381">If an app has font files in the local file system or in a memory buffer, but they use the WOFF or WOFF2 container formats, DirectWrite (Windows 10 Creator Update or later) provides a method for unpacking the container format, [**IDWriteFactory5::UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile), which returns an [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream).</span></span> 

<span data-ttu-id="348a7-382">Toutefois, l’application doit disposer d’un moyen d’obtenir le [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) dans un objet de chargeur de fichiers de polices.</span><span class="sxs-lookup"><span data-stu-id="348a7-382">However, the app will need a way to get the [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) into a font file loader object.</span></span> <span data-ttu-id="348a7-383">Une façon de procéder consiste à créer une implémentation personnalisée de [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) qui encapsule le flux.</span><span class="sxs-lookup"><span data-stu-id="348a7-383">One way to do this is to create a custom [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) implementation that wraps the stream.</span></span> <span data-ttu-id="348a7-384">Comme avec les autres chargeurs de fichiers de polices, il doit être inscrit avant son utilisation et désinscrit avant que la fabrique ne soit hors de portée.</span><span class="sxs-lookup"><span data-stu-id="348a7-384">As with other font file loaders, this must be registered before use, and unregistered before the factory goes out of scope.</span></span>  

<span data-ttu-id="348a7-385">Si le chargeur personnalisé est également utilisé avec des fichiers de polices bruts (non compressés), l’application doit également fournir une implémentation personnalisée de l’interface [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) pour la gestion de ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="348a7-385">If the custom loader will also be used with raw (not packed) font files, then the app would also need to provide a custom implementation of the [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) interface for handling those files.</span></span> <span data-ttu-id="348a7-386">Toutefois, il existe des méthodes plus simples pour gérer les fichiers de polices brutes qui utilisent les API abordées ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-386">There are easier ways that use APIs discussed above for handling raw font files, however.</span></span> <span data-ttu-id="348a7-387">La nécessité d’une implémentation de flux personnalisé peut être évitée en utilisant des chemins de code distincts pour les fichiers de polices compressés et les fichiers de polices brutes.</span><span class="sxs-lookup"><span data-stu-id="348a7-387">The need for a custom stream implementation could be avoided by using separate code paths for packed font files versus raw font files.</span></span> 

<span data-ttu-id="348a7-388">Après la création d’un objet de chargeur de fichiers de polices personnalisé, les données compressées du fichier de polices sont ajoutées au chargeur par des moyens spécifiques à l’application.</span><span class="sxs-lookup"><span data-stu-id="348a7-388">After a custom font file loader object is created, the packed font file data is added to the loader by app-specific means.</span></span> <span data-ttu-id="348a7-389">Le chargeur peut gérer plusieurs fichiers de police, chacun d’eux étant identifié à l’aide d’une clé définie par l’application qui est opaque pour DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="348a7-389">The loader can handle multiple font files, each of which is identified using an app-defined key that is opaque to DirectWrite.</span></span> <span data-ttu-id="348a7-390">Une fois qu’un fichier de police compressé a été ajouté au chargeur, la méthode [**IDWriteFactory :: CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) est utilisée pour obtenir un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) basé sur ce chargeur pour les données de police identifiées par une clé donnée.</span><span class="sxs-lookup"><span data-stu-id="348a7-390">After a packed font file has been added to the loader, the [**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method is used to obtain an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) based on that loader for the font data identified by a given key.</span></span>  

<span data-ttu-id="348a7-391">Le décompactage réel des données de police peut être effectué à mesure que des polices sont ajoutées au chargeur, mais elles peuvent également être gérées dans la méthode [**IDWriteFontFileLoader :: CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) , que DirectWrite appellera lorsqu’il doit d’abord lire les données de police.</span><span class="sxs-lookup"><span data-stu-id="348a7-391">The actual unpacking of the font data can be done as fonts are added to the loader, but can also be handled in the [**IDWriteFontFileLoader::CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) method, which DirectWrite will call when it first needs to read the font data.</span></span> 

<span data-ttu-id="348a7-392">Une fois qu’un objet IDWriteFontFile a été créé, les étapes restantes pour ajouter les polices à un jeu de polices personnalisé sont décrites ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="348a7-392">After an IDWriteFontFile object has been created, remaining steps for adding the fonts to a custom font set will be as described above.</span></span> 

<span data-ttu-id="348a7-393">Une implémentation à l’aide de cette approche est illustrée dans l' [exemple de jeux de polices personnalisées DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="348a7-393">An implementation using this approach is illustrated in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> 

### <a name="using-directwrite-remote-font-mechanisms-with-custom-low-level-network-implementation"></a><span data-ttu-id="348a7-394">Utilisation de mécanismes de police à distance DirectWrite avec une implémentation réseau de bas niveau personnalisée</span><span class="sxs-lookup"><span data-stu-id="348a7-394">Using DirectWrite remote font mechanisms with custom low-level network implementation</span></span>

<span data-ttu-id="348a7-395">Les mécanismes DirectWrite pour la gestion des polices distantes peuvent être divisés en mécanismes de niveau supérieur, avec des jeux de polices qui incluent des références de type police pour les polices distantes, la vérification de la localité des données de police et la gestion de la file d’attente pour les demandes de téléchargement de polices, ainsi que les mécanismes de niveau inférieur qui gèrent le téléchargement réel.</span><span class="sxs-lookup"><span data-stu-id="348a7-395">The DirectWrite mechanisms for handling remote fonts can be divided into higher-level mechanisms — having font sets that include font face references for remote fonts, checking locality of the font data, and managing the queue for font download requests — and the lower-level mechanisms that handle actual download.</span></span> <span data-ttu-id="348a7-396">Certaines applications peuvent utiliser les mécanismes de police à distance de niveau supérieur, mais elles nécessitent également des interactions réseau personnalisées, telles que la communication avec les serveurs à l’aide de protocoles autres que HTTP.</span><span class="sxs-lookup"><span data-stu-id="348a7-396">Some apps may want to utilize the higher-level remote font mechanisms, but also require custom network interactions, such as communicating with servers using protocols other than HTTP.</span></span> 

<span data-ttu-id="348a7-397">Dans ce cas, une application doit créer une implémentation personnalisée de l’interface [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) qui interagit avec d’autres interfaces de niveau inférieur de la manière requise.</span><span class="sxs-lookup"><span data-stu-id="348a7-397">For this situation, an app will need to create a custom implementation of the [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) interface that interacts with other lower-level interfaces in the required ways.</span></span> <span data-ttu-id="348a7-398">L’application doit également fournir des implémentations personnalisées de ces interfaces de niveau inférieur : [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream)et [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult).</span><span class="sxs-lookup"><span data-stu-id="348a7-398">The app will also need to provide custom implementations of these lower-level interfaces: [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream), and [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult).</span></span> <span data-ttu-id="348a7-399">Ces trois interfaces ont des méthodes de rappel que DirectWrite appellera pendant les opérations de téléchargement.</span><span class="sxs-lookup"><span data-stu-id="348a7-399">These three interfaces have callback methods that DirectWrite will call during download operations.</span></span> 

<span data-ttu-id="348a7-400">Quand [**IDWriteFontDownloadQueue :: BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload) est appelé, DirectWrite effectue des requêtes au chargeur de fichiers de polices distantes à propos de la localité des données et demande le flux distant.</span><span class="sxs-lookup"><span data-stu-id="348a7-400">When [**IDWriteFontDownloadQueue::BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload) is called, DirectWrite will make queries to the remote font file loader about locality of the data, and will request the remote stream.</span></span> <span data-ttu-id="348a7-401">Si les données ne sont pas locales, elle appellera la méthode BeginDownload du flux.</span><span class="sxs-lookup"><span data-stu-id="348a7-401">If data is not local, then it will call the stream’s BeginDownload method.</span></span> <span data-ttu-id="348a7-402">L’implémentation du flux ne doit pas bloquer sur cet appel, mais doit retourner immédiatement, en retournant un objet [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) qui fournit le handle d’attente DirectWrite utilisé pour attendre l’opération de téléchargement asynchrone.</span><span class="sxs-lookup"><span data-stu-id="348a7-402">The stream implementation should not block on that call, but should immediately return, passing back an [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) object that provides the wait handle DirectWrite will use to wait on the asynchronous download operation.</span></span> <span data-ttu-id="348a7-403">L’implémentation du flux personnalisé est chargée de gérer la communication à distance.</span><span class="sxs-lookup"><span data-stu-id="348a7-403">The custom stream implementation is responsible for handling the remote communication.</span></span> <span data-ttu-id="348a7-404">Lorsque l’événement d’achèvement s’est produit, DirectWrite appellera [**IDWriteAsyncResult :: GetResult**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwriteasyncresult-getresult) pour déterminer le résultat de l’opération.</span><span class="sxs-lookup"><span data-stu-id="348a7-404">When the completion event has occurred, then DirectWrite will call [**IDWriteAsyncResult::GetResult**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwriteasyncresult-getresult) to determine the result of the operation.</span></span> <span data-ttu-id="348a7-405">Si le résultat réussit, il est prévu que les appels ReadFragment suivants au flux pour les plages téléchargées réussiront.</span><span class="sxs-lookup"><span data-stu-id="348a7-405">If the result is successful, then it’s expected that subsequent ReadFragment calls to the stream for the downloaded ranges will succeed.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="348a7-406">Remarque relative à la sécurité et aux performances : lors d’une tentative d’extraction d’une police distante, il est possible qu’un attaquant usurpe l’identité du serveur prévu appelé ou que le serveur ne réponde pas.</span><span class="sxs-lookup"><span data-stu-id="348a7-406">Security / performance note: When an attempt is made to fetch a remote font, the potential exists in general for an attacker to spoof the intended server being called, or that the server may not respond.</span></span> <span data-ttu-id="348a7-407">Si vous implémentez des interactions réseau personnalisées, vous pouvez mieux contrôler les atténuations que lors du traitement des serveurs tiers.</span><span class="sxs-lookup"><span data-stu-id="348a7-407">If you are implementing custom network interactions, you may have greater control over mitigations than when dealing with third-party servers.</span></span> <span data-ttu-id="348a7-408">Toutefois, il vous revient de prendre en compte les mesures d’atténuation appropriées pour éviter la divulgation d’informations ou le déni de service.</span><span class="sxs-lookup"><span data-stu-id="348a7-408">However, it is up to you to consider appropriate mitigations to avoid information disclosure or denial of service.</span></span> <span data-ttu-id="348a7-409">Les protocoles sécurisés, tels que HTTPs, sont recommandés.</span><span class="sxs-lookup"><span data-stu-id="348a7-409">Secure protocols such as HTTPS are recommended.</span></span> <span data-ttu-id="348a7-410">En outre, vous devez créer un délai d’expiration afin que le handle d’événement retourné à DirectWrite soit finalement défini.</span><span class="sxs-lookup"><span data-stu-id="348a7-410">Also, you should build in some timeout so that the event handle returned to DirectWrite does eventually get set.</span></span> 

 

### <a name="supporting-scenarios-on-earlier-windows-versions"></a><span data-ttu-id="348a7-411">Scénarios de prise en charge sur les versions antérieures de Windows</span><span class="sxs-lookup"><span data-stu-id="348a7-411">Supporting scenarios on earlier Windows versions</span></span>

<span data-ttu-id="348a7-412">Les scénarios décrits peuvent être pris en charge dans DirectWrite sur les versions antérieures de Windows, mais nécessitent une implémentation bien plus personnalisée sur la partie de l’application à l’aide des API plus limitées qui étaient disponibles avant Windows 10.</span><span class="sxs-lookup"><span data-stu-id="348a7-412">The scenarios that have been described can be supported in DirectWrite on earlier versions of Windows, but would require much more custom implementation on the part of the app using the more limited APIs that were available prior to Windows 10.</span></span> <span data-ttu-id="348a7-413">Pour plus d’informations, consultez [collections de polices personnalisées (Windows 7/8)](custom-font-collections.md).</span><span class="sxs-lookup"><span data-stu-id="348a7-413">For more information, see [Custom Font Collections (Windows 7/8)](custom-font-collections.md).</span></span>

 

 