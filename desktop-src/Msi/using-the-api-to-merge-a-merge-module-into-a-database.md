---
description: Les modules de fusion fournissent une méthode standard permettant aux développeurs de fournir des composants de Windows Installer partagés et une logique de configuration à leurs applications.
ms.assetid: 3eb087b1-0f44-40d8-a950-67d489f09408
title: Utilisation de l’API pour fusionner un module de fusion dans une base de données
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2e68298671045825dda41ad120896fa22c89f068
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106535457"
---
# <a name="using-the-api-to-merge-a-merge-module-into-a-database"></a><span data-ttu-id="4d5e4-103">Utilisation de l’API pour fusionner un module de fusion dans une base de données</span><span class="sxs-lookup"><span data-stu-id="4d5e4-103">Using the API to Merge a Merge Module into a Database</span></span>

<span data-ttu-id="4d5e4-104">Les [modules de fusion](merge-modules.md) fournissent une méthode standard permettant aux développeurs de fournir des [*composants*](c-gly.md) de Windows Installer partagés et une logique de configuration à leurs applications.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-104">[Merge modules](merge-modules.md) provide a standard method for developers to deliver shared Windows Installer [*components*](c-gly.md) and setup logic to their applications.</span></span> <span data-ttu-id="4d5e4-105">Les modules de fusion doivent être fusionnés dans un package d’installation à l’aide d’un outil de fusion.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-105">Merge modules must be merged into an installation package using a merge tool.</span></span> <span data-ttu-id="4d5e4-106">La meilleure solution consiste à obtenir un outil de fusion distribué librement ou à acheter l’un des outils de fusion disponibles auprès des éditeurs de logiciels indépendants.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-106">The best alternative is to obtain a freely distributed merge tool or purchase one of the merging tools available from independent software vendors.</span></span> <span data-ttu-id="4d5e4-107">Par exemple, vous pouvez utiliser la fonctionnalité fournie par [Mergemod.dll](merge-module-automation.md).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-107">For example you can use the functionality provided by [Mergemod.dll](merge-module-automation.md).</span></span>

<span data-ttu-id="4d5e4-108">Utilisez les étapes suivantes dans l’ordre pour fusionner un module de fusion dans une base de données d’installation Windows Installer par l’API de [Mergemod.dll](merge-module-automation.md).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-108">Use the following steps in sequence to merge a merge module into a Windows Installer installation database by the API of [Mergemod.dll](merge-module-automation.md).</span></span>

<span data-ttu-id="4d5e4-109">**Pour fusionner un module de fusion dans une base de données d’installation Windows Installer**</span><span class="sxs-lookup"><span data-stu-id="4d5e4-109">**To merge a merge module into a Windows Installer installation database**</span></span>

1.  <span data-ttu-id="4d5e4-110">Ouvrez un fichier journal à l’aide de [**OpenLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-110">Open a log file using [**OpenLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog).</span></span> <span data-ttu-id="4d5e4-111">Cette étape est requise uniquement si vous devez créer un fichier journal ou ajouter un fichier journal existant pour le processus de fusion.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-111">This step is required only if you need to create a log file, or append an existing log file, for the merge process.</span></span>
2.  <span data-ttu-id="4d5e4-112">Ouvrez la base de données d’installation, un [fichier. msi](windows-installer-file-extensions.md), qui recevra le module de fusion à l’aide de l’opération [**OpenDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-112">Open the installation database, an [.msi file](windows-installer-file-extensions.md), that will receive the merge module using [**OpenDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase).</span></span> <span data-ttu-id="4d5e4-113">Cette étape est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-113">This step is required.</span></span>
3.  <span data-ttu-id="4d5e4-114">Ouvrez le module de fusion, un [fichier. msm](windows-installer-file-extensions.md), qui est fusionné dans la base de données à l’aide de [**OuvrirModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-114">Open the merge module, an [.msm file](windows-installer-file-extensions.md), that is being merged into the database using [**OpenModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule).</span></span> <span data-ttu-id="4d5e4-115">Vous devez ouvrir un module avant de pouvoir le fusionner avec une base de données d’installation.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-115">A module must be opened before it can be merged with an installation database.</span></span> <span data-ttu-id="4d5e4-116">Cette étape est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-116">This step is required.</span></span>
4.  <span data-ttu-id="4d5e4-117">Fusionnez le module dans la base de données d’installation à l’aide de [**Merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) ou de [**MergeEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-117">Merge the module into the installation database by using [**Merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) or [**MergeEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex).</span></span> <span data-ttu-id="4d5e4-118">Notez que **Merge** ou **MergeEx** ne peut être appelé qu’une seule fois pour fusionner une combinaison particulière de fichiers. msi et. msm.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-118">Note that **Merge** or **MergeEx** can only be called once to merge a particular combination of .msi and .msm files.</span></span> <span data-ttu-id="4d5e4-119">**MergeEx** est disponible uniquement lors de l’utilisation de [Mergemod.dll version 2,0](merge-module-automation.md) ou ultérieure et uniquement lors de l’utilisation de l’interface [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2) .</span><span class="sxs-lookup"><span data-stu-id="4d5e4-119">**MergeEx** is only available when using [Mergemod.dll version 2.0](merge-module-automation.md) or later and only when using the [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2) interface.</span></span> <span data-ttu-id="4d5e4-120">Cette étape est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-120">This step is required.</span></span>
5.  <span data-ttu-id="4d5e4-121">Appelez [**obtenir des \_ Erreurs**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) et examinez la collection d’erreurs Récupérée pour les conflits de fusion ou d’autres erreurs.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-121">Call [**get\_Errors**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) and examine the retrieved collection of errors for merge conflicts or other errors.</span></span> <span data-ttu-id="4d5e4-122">La récupération est non destructrice.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-122">The retrieval is non-destructive.</span></span> <span data-ttu-id="4d5e4-123">Plusieurs instances de la collection d’erreurs peuvent être récupérées en lisant à plusieurs reprises les **\_ Erreurs d’extraction**.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-123">Multiple instances of the error collection may be retrieved by repeatedly reading calling **get\_Errors**.</span></span> <span data-ttu-id="4d5e4-124">Vous devrez résoudre toutes les erreurs en fonction de votre cas.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-124">You will need to resolve any errors as appropriate for your case.</span></span>
6.  <span data-ttu-id="4d5e4-125">Associez les composants du module de fusion à toutes les fonctionnalités supplémentaires qui ont été ou seront fusionnées dans la base de données d’installation à l’aide de [**Connect**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-125">Associate the components of the merge module with any additional features that have been, or will be, merged into the installation database using [**Connect**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect).</span></span> <span data-ttu-id="4d5e4-126">La fonctionnalité doit déjà exister avant d’appeler cette méthode.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-126">The feature must already exist before calling this method.</span></span> <span data-ttu-id="4d5e4-127">Cette étape est requise uniquement si vous disposez de fonctionnalités supplémentaires. pour plus d’informations, consultez [connexion d’un module de fusion à plusieurs fonctionnalités](connecting-a-merge-module-to-multiple-features.md) .</span><span class="sxs-lookup"><span data-stu-id="4d5e4-127">This step is only required if you have additional features, for more information see [Connecting a Merge Module to Multiple Features](connecting-a-merge-module-to-multiple-features.md)</span></span>
7.  <span data-ttu-id="4d5e4-128">Si nécessaire, extrayez les fichiers sources du module en exécutant une ou plusieurs des opérations suivantes.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-128">If necessary, extract source files from the module by doing one or more of the following.</span></span>

    <span data-ttu-id="4d5e4-129">Pour extraire des fichiers d’un fichier. cab incorporé puis les copier dans un répertoire spécifié, utilisez [**ExtractFiles**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) ou [**ExtractFilesEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-129">To extract files from an embedded .cab file and then copy into a specified directory, use [**ExtractFiles**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) or [**ExtractFilesEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex).</span></span> <span data-ttu-id="4d5e4-130">Notez que **ExtractFilesEx** requiert [Mergemod.dll version 2,0](merge-module-automation.md) ou ultérieure.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-130">Note that **ExtractFilesEx** requires [Mergemod.dll version 2.0](merge-module-automation.md) or later.</span></span>

    <span data-ttu-id="4d5e4-131">Pour extraire des fichiers d’un fichier. cab incorporé, puis enregistrer dans un fichier spécifié, utilisez [**ExtractCAB**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-131">To extract files from an embedded .cab file and then save in a specified file, use [**ExtractCAB**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab).</span></span>

    <span data-ttu-id="4d5e4-132">Pour extraire des fichiers d’un module, puis les copier vers une image source sur le disque après la fusion, utilisez [**CreateSourceImage**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-132">To extract files from a module and then copy to a source image on disk after the merge, use [**CreateSourceImage**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage).</span></span> <span data-ttu-id="4d5e4-133">Notez que **CreateSourceImage** est disponible uniquement avec [Mergemod.dll version 2,0](merge-module-automation.md) ou ultérieure.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-133">Note that **CreateSourceImage** is only available with [Mergemod.dll version 2.0](merge-module-automation.md) or later.</span></span>

8.  <span data-ttu-id="4d5e4-134">Fermez le module de fusion ouvert en cours à l’aide de [**CloseModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-134">Close the current open merge module using [**CloseModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule).</span></span> <span data-ttu-id="4d5e4-135">Cette étape est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-135">This step is required.</span></span>
9.  <span data-ttu-id="4d5e4-136">Fermez la base de données d’installation actuellement ouverte à l’aide de [**FermerBase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-136">Close the current open installation database using [**CloseDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase).</span></span> <span data-ttu-id="4d5e4-137">Cette étape est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-137">This step is required.</span></span> <span data-ttu-id="4d5e4-138">La fermeture d’une base de données efface toutes les informations de dépendance, mais n’affecte pas les erreurs qui n’ont pas été récupérées.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-138">Closing a database clears all dependency information but does not affect any errors that have not been retrieved.</span></span>
10. <span data-ttu-id="4d5e4-139">Fermez le fichier journal actuel à l’aide de [**CloseLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog).</span><span class="sxs-lookup"><span data-stu-id="4d5e4-139">Close the current log file using [**CloseLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog).</span></span> <span data-ttu-id="4d5e4-140">Cette étape est requise si vous avez ouvert un fichier journal.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-140">This step is required if you have opened a log file.</span></span>

<span data-ttu-id="4d5e4-141">Une fois le module fusionné dans la base de données à l’aide de [Mergemod.dll](merge-module-automation.md), la [table de supports](media-table.md) doit être mise à jour pour décrire la disposition souhaitée de l’image source.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-141">After the module has been merged into the database using [Mergemod.dll](merge-module-automation.md), the [Media Table](media-table.md) must be updated to describe the desired source image layout.</span></span> <span data-ttu-id="4d5e4-142">Le processus de fusion fourni par Mergemod.dll ne met pas à jour la table multimédia, car l’utilisateur du module de fusion peut sélectionner différentes méthodes pour la disposition de l’image source.</span><span class="sxs-lookup"><span data-stu-id="4d5e4-142">The merge process provided by Mergemod.dll does not update the Media Table because the consumer of the merge module can select various ways to layout the source image.</span></span>

 

 
