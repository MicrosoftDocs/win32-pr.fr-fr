---
description: Les applications qui utilisent Windows Installer 4,0 pour l’installation et la maintenance sur Windows Vista utilisent automatiquement le gestionnaire de redémarrage pour réduire les redémarrages du système.
ms.assetid: 821739ff-f7a7-4192-ad34-254aa7d74d13
title: Utilisation de Windows Installer avec le gestionnaire de redémarrage
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4160b2241c75ec7305accd1ab4d1295a54fa9f65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106518958"
---
# <a name="using-windows-installer-with-restart-manager"></a><span data-ttu-id="01845-103">Utilisation de Windows Installer avec le gestionnaire de redémarrage</span><span class="sxs-lookup"><span data-stu-id="01845-103">Using Windows Installer with Restart Manager</span></span>

<span data-ttu-id="01845-104">Les applications qui utilisent Windows Installer 4,0 pour l’installation et la maintenance sur Windows Vista utilisent automatiquement le [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md) pour réduire les redémarrages du système.</span><span class="sxs-lookup"><span data-stu-id="01845-104">Applications that use Windows Installer 4.0 for installation and servicing on Windows Vista automatically use the [Restart Manager](../rstmgr/restart-manager-portal.md) to reduce system restarts.</span></span> <span data-ttu-id="01845-105">Le comportement par défaut de Windows Vista consiste à arrêter les applications au lieu d’arrêter et de redémarrer le système d’exploitation chaque fois que cela est possible.</span><span class="sxs-lookup"><span data-stu-id="01845-105">The default behavior on Windows Vista is to shut down applications rather than shut down and restart the operating system whenever possible.</span></span> <span data-ttu-id="01845-106">Dans les cas où un redémarrage du système est inévitable, les programmes d’installation peuvent utiliser l’API du [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md) pour planifier les redémarrages de manière à réduire au minimum l’interruption du processus de travail de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="01845-106">In cases where a system restart is unavoidable, installers can use the [Restart Manager](../rstmgr/restart-manager-portal.md) API to schedule restarts in such a way that it minimizes the disruption of the user's work flow.</span></span>

<span data-ttu-id="01845-107">Windows Installer développeurs peuvent effectuer les actions suivantes pour préparer leur package afin qu’il fonctionne avec le [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="01845-107">Windows Installer developers can perform the following actions to prepare their package to work with the [Restart Manager](../rstmgr/restart-manager-portal.md).</span></span>

-   <span data-ttu-id="01845-108">Ajoutez la boîte de dialogue [MsiRMFilesInUse](msirmfilesinuse-dialog.md) à votre package.</span><span class="sxs-lookup"><span data-stu-id="01845-108">Add the [MsiRMFilesInUse](msirmfilesinuse-dialog.md) dialog box to your package.</span></span> <span data-ttu-id="01845-109">Si la boîte de dialogue MsiRMFilesInUse est présente dans le package, l’utilisateur Windows Vista qui exécute une installation au niveau de l' [interface utilisateur](user-interface-levels.md) complète de l’interface utilisateur a la possibilité de fermer et redémarrer automatiquement les applications.</span><span class="sxs-lookup"><span data-stu-id="01845-109">If the MsiRMFilesInUse dialog box is present in the package, the Windows Vista user running an installation at the Full UI [user interface level](user-interface-levels.md) is given the option to automatically close and restart applications.</span></span> <span data-ttu-id="01845-110">Un package d’installation peut contenir des informations pour la boîte de dialogue MsiRMFilesInUse et la boîte de dialogue [FilesInUse](filesinuse-dialog.md) .</span><span class="sxs-lookup"><span data-stu-id="01845-110">An installation package can contain information for both the MsiRMFilesInUse dialog box and the [FilesInUse](filesinuse-dialog.md) dialog box .</span></span> <span data-ttu-id="01845-111">La boîte de dialogue MsiRMFilesInUse s’affiche uniquement si le package est installé avec au moins Windows Installer 4,0 sur Windows Vista, et est ignoré.</span><span class="sxs-lookup"><span data-stu-id="01845-111">The MsiRMFilesInUse dialog box is only displayed if the package is installed with at least Windows Installer 4.0 on Windows Vista, and is otherwise ignored.</span></span> <span data-ttu-id="01845-112">Les packages existants qui ne disposent pas de la boîte de dialogue MsiRMFilesInUse continuent à fonctionner à l’aide de la boîte de dialogue FilesInUse.</span><span class="sxs-lookup"><span data-stu-id="01845-112">Existing packages that do not have the MsiRMFilesInUse dialog box continue to function using the FilesInUse dialog box.</span></span> <span data-ttu-id="01845-113">Une transformation de personnalisation peut être utilisée pour ajouter une boîte de dialogue MsiRMFilesInUse aux packages existants.</span><span class="sxs-lookup"><span data-stu-id="01845-113">A customization transform can be used to add an MsiRMFilesInUse dialog box to existing packages.</span></span>

    <span data-ttu-id="01845-114">Les utilisateurs finaux exécutent généralement des installations au niveau de l' [interface utilisateur](user-interface-levels.md)complète de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="01845-114">End-users typically run installations at the Full UI [user interface level](user-interface-levels.md).</span></span> <span data-ttu-id="01845-115">L’interface utilisateur de base ou les installations de niveau d’interface utilisateur réduites offrent à l’utilisateur la possibilité d’utiliser le [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md) pour réduire les redémarrages du système même si la boîte de dialogue [MsiRMFilesInUse](msirmfilesinuse-dialog.md) n’est pas présente.</span><span class="sxs-lookup"><span data-stu-id="01845-115">Basic UI or Reduced UI level installations give the user the option of using the [Restart Manager](../rstmgr/restart-manager-portal.md) to reduce system restarts even if the [MsiRMFilesInUse](msirmfilesinuse-dialog.md) dialog box is not present.</span></span> <span data-ttu-id="01845-116">Les installations silencieuses au niveau de l’interface utilisateur arrêtent toujours les applications et les services, et sous Windows Vista, utilisent toujours le gestionnaire de redémarrage.</span><span class="sxs-lookup"><span data-stu-id="01845-116">Silent UI level installations always shut down applications and services, and on Windows Vista, always use Restart Manager.</span></span>

-   <span data-ttu-id="01845-117">Inscrire des applications pour un redémarrage à l’aide de la fonction [**RegisterApplicationRestart**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) .</span><span class="sxs-lookup"><span data-stu-id="01845-117">Register applications for a restart using the [**RegisterApplicationRestart**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) function.</span></span> <span data-ttu-id="01845-118">Le gestionnaire de redémarrage peut redémarrer uniquement les applications qui ont été inscrites pour le redémarrage.</span><span class="sxs-lookup"><span data-stu-id="01845-118">Restart Manager can only restart applications that have been registered for restart.</span></span> <span data-ttu-id="01845-119">Le gestionnaire de redémarrage redémarre les applications inscrites après l’installation.</span><span class="sxs-lookup"><span data-stu-id="01845-119">Restart Manager restarts registered applications after the installation.</span></span> <span data-ttu-id="01845-120">Si l’installation nécessite un redémarrage du système, le gestionnaire de redémarrage redémarre l’application inscrite après le redémarrage du système.</span><span class="sxs-lookup"><span data-stu-id="01845-120">If the installation requires a system restart, Restart Manager restarts the registered application after the system restart.</span></span>
-   <span data-ttu-id="01845-121">Spécifiez INSTALLLOGMODE \_ RMFILESINUSE lors de l’activation d’un gestionnaire d’interface utilisateur externe avec les fonctions [**MsiSetExternalUI**](/windows/desktop/api/Msi/nf-msi-msisetexternaluia) et [**MsiSetExternalUIRecord**](/windows/desktop/api/Msi/nf-msi-msisetexternaluirecord) .</span><span class="sxs-lookup"><span data-stu-id="01845-121">Specify INSTALLLOGMODE\_RMFILESINUSE when enabling an external user-interface handler with the [**MsiSetExternalUI**](/windows/desktop/api/Msi/nf-msi-msisetexternaluia) and [**MsiSetExternalUIRecord**](/windows/desktop/api/Msi/nf-msi-msisetexternaluirecord) functions.</span></span> <span data-ttu-id="01845-122">Windows Installer enverra un message INSTALLMESSAGE \_ RMFILESINUSE pour les gestionnaires d’interface utilisateur externes qui prennent en charge le [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="01845-122">Windows Installer will send a INSTALLMESSAGE\_RMFILESINUSE message for external user-interface handlers that support the [Restart Manager](../rstmgr/restart-manager-portal.md).</span></span> <span data-ttu-id="01845-123">Si aucune interface utilisateur inscrite ou interne ne gère le \_ message INSTALLMESSAGE RMFILESINUSE, le programme d’installation envoie un \_ message INSTALLMESSAGE FILESINUSE pour les gestionnaires d’interface utilisateur qui prennent en charge la boîte de dialogue [FILESINUSE](filesinuse-dialog.md) .</span><span class="sxs-lookup"><span data-stu-id="01845-123">If no registered or internal user-interface handles the INSTALLMESSAGE\_RMFILESINUSE message, the installer sends a INSTALLMESSAGE\_FILESINUSE message for user-interface handlers that support the [FilesInUse](filesinuse-dialog.md) dialog box.</span></span> <span data-ttu-id="01845-124">Pour plus d’informations, consultez [utilisation du gestionnaire de redémarrage avec une interface utilisateur externe](using-restart-manager-with-an-external-ui-.md).</span><span class="sxs-lookup"><span data-stu-id="01845-124">For more information, see [Using Restart Manager with an External UI](using-restart-manager-with-an-external-ui-.md).</span></span>
-   <span data-ttu-id="01845-125">Les actions personnalisées peuvent ajouter des ressources appartenant à une session du [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="01845-125">Custom actions can add resources belonging to a [Restart Manager](../rstmgr/restart-manager-portal.md) session.</span></span> <span data-ttu-id="01845-126">L’action personnalisée doit être séquencée avant l’action [InstallValidate](installvalidate-action.md) .</span><span class="sxs-lookup"><span data-stu-id="01845-126">The custom action should be sequenced before the [InstallValidate](installvalidate-action.md) action.</span></span> <span data-ttu-id="01845-127">Les actions personnalisées peuvent utiliser la propriété [**MsiRestartManagerSessionKey**](msirestartmanagersessionkey.md) pour obtenir la clé de session et doivent appeler les fonctions [**RmJoinSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmjoinsession) et [**RmEndSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmendsession) de l’API du gestionnaire de redémarrage.</span><span class="sxs-lookup"><span data-stu-id="01845-127">Custom actions can use the [**MsiRestartManagerSessionKey**](msirestartmanagersessionkey.md) property to obtain the session key, and should call the [**RmJoinSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmjoinsession) and [**RmEndSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmendsession) functions of the Restart Manager API.</span></span> <span data-ttu-id="01845-128">Les actions personnalisées ne peuvent pas supprimer les ressources appartenant à une session du gestionnaire de redémarrage.</span><span class="sxs-lookup"><span data-stu-id="01845-128">Custom actions cannot remove resources belonging to a Restart Manager session.</span></span> <span data-ttu-id="01845-129">Les actions personnalisées ne doivent pas tenter d’arrêter ou de redémarrer les applications à l’aide des fonctions [**RmShutdown**](/windows/win32/api/restartmanager/nf-restartmanager-rmshutdown), [**RmGetList**](/windows/win32/api/restartmanager/nf-restartmanager-rmgetlist) et [**RmRestart**](/windows/win32/api/restartmanager/nf-restartmanager-rmrestart) .</span><span class="sxs-lookup"><span data-stu-id="01845-129">Custom actions should not attempt to shutdown or restart applications using the [**RmShutdown**](/windows/win32/api/restartmanager/nf-restartmanager-rmshutdown), [**RmGetList**](/windows/win32/api/restartmanager/nf-restartmanager-rmgetlist) and [**RmRestart**](/windows/win32/api/restartmanager/nf-restartmanager-rmrestart) functions.</span></span>
-   <span data-ttu-id="01845-130">Les auteurs de package peuvent baser une condition dans la [table LaunchCondition](launchcondition-table.md) sur la propriété [**MsiSystemRebootPending**](msisystemrebootpending.md) pour empêcher l’installation de leur package lorsqu’un redémarrage du système est en attente.</span><span class="sxs-lookup"><span data-stu-id="01845-130">Package authors can base a condition in the [LaunchCondition table](launchcondition-table.md) on the [**MsiSystemRebootPending**](msisystemrebootpending.md) property to prevent the installation of their package when a system restart is pending.</span></span>
-   <span data-ttu-id="01845-131">Les créateurs de packages et les administrateurs peuvent contrôler l’interaction du Windows Installer et redémarrer le gestionnaire à l’aide des propriétés [**MSIRESTARTMANAGERCONTROL**](msirestartmanagercontrol.md), [**MSIDISABLERMRESTART**](msidisablermrestart.md), [**MSIRMSHUTDOWN**](msirmshutdown.md) et de la stratégie [DisableAutomaticApplicationShutdown](disableautomaticapplicationshutdown.md) .</span><span class="sxs-lookup"><span data-stu-id="01845-131">Package authors and administrators can control the interaction of the Windows Installer and Restart Manager by using the [**MSIRESTARTMANAGERCONTROL**](msirestartmanagercontrol.md), [**MSIDISABLERMRESTART**](msidisablermrestart.md), [**MSIRMSHUTDOWN**](msirmshutdown.md) properties and the [DisableAutomaticApplicationShutdown](disableautomaticapplicationshutdown.md) policy.</span></span>
-   <span data-ttu-id="01845-132">Les applications et services doivent suivre les instructions décrites dans la section [utilisation du gestionnaire de redémarrage](../rstmgr/using-restart-manager.md) de la documentation du [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="01845-132">Applications and services should follow the guidelines described in the [Using Restart Manager](../rstmgr/using-restart-manager.md) section of the [Restart Manager](../rstmgr/restart-manager-portal.md) documentation.</span></span>

 

 
