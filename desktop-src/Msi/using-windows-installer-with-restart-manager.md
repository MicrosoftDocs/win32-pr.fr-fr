---
description: Les applications qui utilisent Windows Installer 4,0 pour l’installation et la maintenance sur Windows Vista utilisent automatiquement le gestionnaire de redémarrage pour réduire les redémarrages du système.
ms.assetid: 821739ff-f7a7-4192-ad34-254aa7d74d13
title: Utilisation de Windows Installer avec le gestionnaire de redémarrage
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4160b2241c75ec7305accd1ab4d1295a54fa9f65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106518958"
---
# <a name="using-windows-installer-with-restart-manager"></a>Utilisation de Windows Installer avec le gestionnaire de redémarrage

Les applications qui utilisent Windows Installer 4,0 pour l’installation et la maintenance sur Windows Vista utilisent automatiquement le [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md) pour réduire les redémarrages du système. Le comportement par défaut de Windows Vista consiste à arrêter les applications au lieu d’arrêter et de redémarrer le système d’exploitation chaque fois que cela est possible. Dans les cas où un redémarrage du système est inévitable, les programmes d’installation peuvent utiliser l’API du [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md) pour planifier les redémarrages de manière à réduire au minimum l’interruption du processus de travail de l’utilisateur.

Windows Installer développeurs peuvent effectuer les actions suivantes pour préparer leur package afin qu’il fonctionne avec le [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md).

-   Ajoutez la boîte de dialogue [MsiRMFilesInUse](msirmfilesinuse-dialog.md) à votre package. Si la boîte de dialogue MsiRMFilesInUse est présente dans le package, l’utilisateur Windows Vista qui exécute une installation au niveau de l' [interface utilisateur](user-interface-levels.md) complète de l’interface utilisateur a la possibilité de fermer et redémarrer automatiquement les applications. Un package d’installation peut contenir des informations pour la boîte de dialogue MsiRMFilesInUse et la boîte de dialogue [FilesInUse](filesinuse-dialog.md) . La boîte de dialogue MsiRMFilesInUse s’affiche uniquement si le package est installé avec au moins Windows Installer 4,0 sur Windows Vista, et est ignoré. Les packages existants qui ne disposent pas de la boîte de dialogue MsiRMFilesInUse continuent à fonctionner à l’aide de la boîte de dialogue FilesInUse. Une transformation de personnalisation peut être utilisée pour ajouter une boîte de dialogue MsiRMFilesInUse aux packages existants.

    Les utilisateurs finaux exécutent généralement des installations au niveau de l' [interface utilisateur](user-interface-levels.md)complète de l’interface utilisateur. L’interface utilisateur de base ou les installations de niveau d’interface utilisateur réduites offrent à l’utilisateur la possibilité d’utiliser le [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md) pour réduire les redémarrages du système même si la boîte de dialogue [MsiRMFilesInUse](msirmfilesinuse-dialog.md) n’est pas présente. Les installations silencieuses au niveau de l’interface utilisateur arrêtent toujours les applications et les services, et sous Windows Vista, utilisent toujours le gestionnaire de redémarrage.

-   Inscrire des applications pour un redémarrage à l’aide de la fonction [**RegisterApplicationRestart**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) . Le gestionnaire de redémarrage peut redémarrer uniquement les applications qui ont été inscrites pour le redémarrage. Le gestionnaire de redémarrage redémarre les applications inscrites après l’installation. Si l’installation nécessite un redémarrage du système, le gestionnaire de redémarrage redémarre l’application inscrite après le redémarrage du système.
-   Spécifiez INSTALLLOGMODE \_ RMFILESINUSE lors de l’activation d’un gestionnaire d’interface utilisateur externe avec les fonctions [**MsiSetExternalUI**](/windows/desktop/api/Msi/nf-msi-msisetexternaluia) et [**MsiSetExternalUIRecord**](/windows/desktop/api/Msi/nf-msi-msisetexternaluirecord) . Windows Installer enverra un message INSTALLMESSAGE \_ RMFILESINUSE pour les gestionnaires d’interface utilisateur externes qui prennent en charge le [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md). Si aucune interface utilisateur inscrite ou interne ne gère le \_ message INSTALLMESSAGE RMFILESINUSE, le programme d’installation envoie un \_ message INSTALLMESSAGE FILESINUSE pour les gestionnaires d’interface utilisateur qui prennent en charge la boîte de dialogue [FILESINUSE](filesinuse-dialog.md) . Pour plus d’informations, consultez [utilisation du gestionnaire de redémarrage avec une interface utilisateur externe](using-restart-manager-with-an-external-ui-.md).
-   Les actions personnalisées peuvent ajouter des ressources appartenant à une session du [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md) . L’action personnalisée doit être séquencée avant l’action [InstallValidate](installvalidate-action.md) . Les actions personnalisées peuvent utiliser la propriété [**MsiRestartManagerSessionKey**](msirestartmanagersessionkey.md) pour obtenir la clé de session et doivent appeler les fonctions [**RmJoinSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmjoinsession) et [**RmEndSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmendsession) de l’API du gestionnaire de redémarrage. Les actions personnalisées ne peuvent pas supprimer les ressources appartenant à une session du gestionnaire de redémarrage. Les actions personnalisées ne doivent pas tenter d’arrêter ou de redémarrer les applications à l’aide des fonctions [**RmShutdown**](/windows/win32/api/restartmanager/nf-restartmanager-rmshutdown), [**RmGetList**](/windows/win32/api/restartmanager/nf-restartmanager-rmgetlist) et [**RmRestart**](/windows/win32/api/restartmanager/nf-restartmanager-rmrestart) .
-   Les auteurs de package peuvent baser une condition dans la [table LaunchCondition](launchcondition-table.md) sur la propriété [**MsiSystemRebootPending**](msisystemrebootpending.md) pour empêcher l’installation de leur package lorsqu’un redémarrage du système est en attente.
-   Les créateurs de packages et les administrateurs peuvent contrôler l’interaction du Windows Installer et redémarrer le gestionnaire à l’aide des propriétés [**MSIRESTARTMANAGERCONTROL**](msirestartmanagercontrol.md), [**MSIDISABLERMRESTART**](msidisablermrestart.md), [**MSIRMSHUTDOWN**](msirmshutdown.md) et de la stratégie [DisableAutomaticApplicationShutdown](disableautomaticapplicationshutdown.md) .
-   Les applications et services doivent suivre les instructions décrites dans la section [utilisation du gestionnaire de redémarrage](../rstmgr/using-restart-manager.md) de la documentation du [Gestionnaire de redémarrage](../rstmgr/restart-manager-portal.md) .

 

 
