---
description: Vous pouvez déboguer des actions personnalisées basées sur des bibliothèques de liens dynamiques à l’aide des outils de débogage pour Windows. Il n’est pas possible d’utiliser le débogage dynamique avec des actions personnalisées basées sur des scripts ou des fichiers exécutables.
ms.assetid: 4241a27a-c127-4c65-96a2-1d655b343eba
title: Débogage des actions personnalisées
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ddfbc9952f0dd7fc1b85b5c64fa6a23381ceafe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106544950"
---
# <a name="debugging-custom-actions"></a><span data-ttu-id="b570b-104">Débogage des actions personnalisées</span><span class="sxs-lookup"><span data-stu-id="b570b-104">Debugging Custom Actions</span></span>

<span data-ttu-id="b570b-105">Vous pouvez déboguer des actions personnalisées basées sur des [bibliothèques de liens dynamiques](dynamic-link-libraries.md) à l’aide [des outils de débogage pour Windows](https://www.microsoft.com/?ref=go).</span><span class="sxs-lookup"><span data-stu-id="b570b-105">You can debug custom actions that are based on [dynamic-link libraries](dynamic-link-libraries.md) by using [Debugging Tools for Windows](https://www.microsoft.com/?ref=go).</span></span> <span data-ttu-id="b570b-106">Il n’est pas possible d’utiliser le débogage dynamique avec des actions personnalisées basées sur des [scripts](scripts.md)ou des [fichiers exécutables](executable-files.md) .</span><span class="sxs-lookup"><span data-stu-id="b570b-106">It is not possible to use dynamic debugging with custom actions based on [executable files](executable-files.md) or [scripts](scripts.md).</span></span>

<span data-ttu-id="b570b-107">Les techniques décrites dans cette section peuvent vous aider à déboguer Windows Installer actions personnalisées.</span><span class="sxs-lookup"><span data-stu-id="b570b-107">The techniques described in this section can help you debug Windows Installer custom actions.</span></span> <span data-ttu-id="b570b-108">Pour plus d’informations sur les [outils de débogage pour Windows](https://www.microsoft.com/?ref=go), consultez la section outils de développement de pilotes de Windows Driver Kit (WDK).</span><span class="sxs-lookup"><span data-stu-id="b570b-108">See the Driver Development Tools section of the Windows Driver Kit (WDK) for information about [Debugging Tools for Windows](https://www.microsoft.com/?ref=go).</span></span>

<span data-ttu-id="b570b-109">Windows Installer utilise la variable d’environnement MsiBreak pour déterminer l’action personnalisée à déboguer.</span><span class="sxs-lookup"><span data-stu-id="b570b-109">Windows Installer uses the MsiBreak environment variable to determine which custom action is to be debugged.</span></span> <span data-ttu-id="b570b-110">Si vous avez accès au code source de l’action personnalisée, vous pouvez être en mesure d’utiliser le débogage sans MsiBreak.</span><span class="sxs-lookup"><span data-stu-id="b570b-110">If you have access to the custom action's source code, you may be able to use debugging without MsiBreak.</span></span> <span data-ttu-id="b570b-111">Pour démarrer le débogage sans MsiBreak, placez une boîte de message temporaire au début du code de l’action.</span><span class="sxs-lookup"><span data-stu-id="b570b-111">To start debugging without MsiBreak, put a temporary message box at the beginning of the action's code.</span></span> <span data-ttu-id="b570b-112">Quand la boîte de message s’affiche pendant l’installation, attachez le débogueur au processus qui possède la boîte de message.</span><span class="sxs-lookup"><span data-stu-id="b570b-112">When the message box appears during the installation, attach the debugger to the process owning the message box.</span></span> <span data-ttu-id="b570b-113">Vous pouvez ensuite définir les points d’arrêt nécessaires et ignorer la boîte de message pour reprendre l’exécution.</span><span class="sxs-lookup"><span data-stu-id="b570b-113">You can then set any necessary breakpoints and dismiss the message box to resume execution.</span></span> <span data-ttu-id="b570b-114">Cette méthode ne permet pas de déboguer les parties précédentes de l’action personnalisée.</span><span class="sxs-lookup"><span data-stu-id="b570b-114">It is not possible to debug the earlier portions of the custom action by this method.</span></span>

<span data-ttu-id="b570b-115">Pour utiliser la variable d’environnement MsiBreak pour déboguer l’action personnalisée, définissez MsiBreak sur le nom de l’action personnalisée dans la [table CustomAction](customaction-table.md).</span><span class="sxs-lookup"><span data-stu-id="b570b-115">To use the MsiBreak environment variable to debug the custom action, set MsiBreak to the custom action's name in the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="b570b-116">MsiBreak peut être une variable d’environnement système ou utilisateur.</span><span class="sxs-lookup"><span data-stu-id="b570b-116">MsiBreak can be either a system or a user environment variable.</span></span> <span data-ttu-id="b570b-117">Si la variable est définie en tant que variable système, un redémarrage du système peut être nécessaire lorsque la valeur est modifiée pour détecter la nouvelle valeur.</span><span class="sxs-lookup"><span data-stu-id="b570b-117">If the variable is set as a system variable, a restart of the system may be needed when the value is changed to detect the new value.</span></span>

<span data-ttu-id="b570b-118">Pour utiliser la variable d’environnement MsiBreak pour déboguer une interface utilisateur incorporée, définissez la valeur de MsiBreak sur MsiEmbeddedUI.</span><span class="sxs-lookup"><span data-stu-id="b570b-118">To use the MsiBreak environment variable to debug an embedded user interface, set the value of MsiBreak to MsiEmbeddedUI.</span></span>

<span data-ttu-id="b570b-119">Windows Installer vérifie uniquement la variable d’environnement MsiBreak si l’utilisateur est un administrateur.</span><span class="sxs-lookup"><span data-stu-id="b570b-119">Windows Installer only checks the MsiBreak environment variable if the user is an Administrator.</span></span> <span data-ttu-id="b570b-120">Le programme d’installation ignore la valeur de MsiBreak si l’utilisateur n’est pas un administrateur, même s’il s’agit d’une [*application gérée*](m-gly.md).</span><span class="sxs-lookup"><span data-stu-id="b570b-120">The installer ignores the value of MsiBreak if the user is not an Administrator, even if this is a [*managed application*](m-gly.md).</span></span>

<span data-ttu-id="b570b-121">Si vous déboguez une action personnalisée qui s’exécute avec des privilèges élevés (système) dans la séquence d’exécution, attachez le débogueur au service Windows Installer.</span><span class="sxs-lookup"><span data-stu-id="b570b-121">If you are debugging a custom action that runs with elevated (system) privileges in the execution sequence, attach the debugger to the Windows Installer service.</span></span> <span data-ttu-id="b570b-122">Lors du débogage d’une action personnalisée qui s’exécute avec des privilèges empruntés dans la séquence d’exécution, le système affiche une boîte de dialogue qui indique le processus à déboguer.</span><span class="sxs-lookup"><span data-stu-id="b570b-122">When debugging a custom action that runs with impersonated privileges in the execution sequence, the system prompts with a dialog box that indicates which process should be debugged.</span></span> <span data-ttu-id="b570b-123">L’utilisateur est invité par une boîte de dialogue indiquant le processus à déboguer.</span><span class="sxs-lookup"><span data-stu-id="b570b-123">The user is prompted with a dialog box indicating which process to debug.</span></span> <span data-ttu-id="b570b-124">Pour plus d’informations sur les actions personnalisées avec élévation de privilèges, consultez sécurité des actions [personnalisées](custom-action-security.md).</span><span class="sxs-lookup"><span data-stu-id="b570b-124">For more information about elevated custom actions, see [Custom Action Security](custom-action-security.md).</span></span>

<span data-ttu-id="b570b-125">Une fois que le débogueur a été attaché au processus approprié, le programme d’installation déclenche un point d’arrêt du débogueur immédiatement avant d’appeler le point d’entrée de la DLL.</span><span class="sxs-lookup"><span data-stu-id="b570b-125">Once the debugger has been attached to the correct process, the installer triggers a debugger breakpoint immediately before calling the entry point of the DLL.</span></span> <span data-ttu-id="b570b-126">Au point d’arrêt, votre DLL est déjà chargée dans le processus et l’adresse du point d’entrée est déterminée.</span><span class="sxs-lookup"><span data-stu-id="b570b-126">At the breakpoint, your DLL is already loaded into the process and the entry point address determined.</span></span> <span data-ttu-id="b570b-127">Si votre DLL d’action personnalisée n’a pas pu être chargée ou si le point d’entrée de l’action personnalisée n’existait pas, aucun point d’arrêt n’est déclenché.</span><span class="sxs-lookup"><span data-stu-id="b570b-127">If your custom action DLL could not be loaded or the custom action entry point did not exist, no breakpoint is triggered.</span></span> <span data-ttu-id="b570b-128">Étant donné que le point d’arrêt est déclenché avant l’appel de la fonction DLL, une fois le point d’arrêt déclenché, vous devez utiliser votre débogueur pour effectuer un pas à pas détaillé jusqu’à ce que votre point d’entrée d’action personnalisé soit appelé.</span><span class="sxs-lookup"><span data-stu-id="b570b-128">Because the breakpoint is triggered before calling the DLL function, once the breakpoint has been triggered you should use your debugger to step forward until your custom action entry point is called.</span></span> <span data-ttu-id="b570b-129">Vous pouvez également définir un point d’arrêt n’importe où dans votre action personnalisée et reprendre l’exécution normale.</span><span class="sxs-lookup"><span data-stu-id="b570b-129">Alternately, you can set a breakpoint anywhere in your custom action and resume normal execution.</span></span>

<span data-ttu-id="b570b-130">Le Windows Installer exécute les dll qui ne sont pas stockées dans la [table binaire](binary-table.md) directement à partir de l’emplacement de la dll.</span><span class="sxs-lookup"><span data-stu-id="b570b-130">The Windows Installer executes DLLs not stored in the [Binary table](binary-table.md) directly from the DLL location.</span></span> <span data-ttu-id="b570b-131">Le programme d’installation ne connaît pas le nom d’origine d’une DLL stockée dans la table binaire et exécute l’action personnalisée DLL sous un nom de fichier temporaire.</span><span class="sxs-lookup"><span data-stu-id="b570b-131">The installer does not know the original name of a DLL stored in the Binary table and runs the DLL custom action under a temporary file name.</span></span> <span data-ttu-id="b570b-132">La forme du nom de fichier temporaire est MSI ?????. TMP.</span><span class="sxs-lookup"><span data-stu-id="b570b-132">The form of the temporary file name is MSI?????.TMP.</span></span> <span data-ttu-id="b570b-133">Sur Windows XP, ce fichier temporaire est stocké dans un emplacement sécurisé, généralement le <WindowFolder> \\ programme d’installation.</span><span class="sxs-lookup"><span data-stu-id="b570b-133">On Windows XP, this temporary file is stored in a secure location, commonly <WindowFolder>\\Installer.</span></span>

<span data-ttu-id="b570b-134">Notez que de nombreuses dll créées pour le débogage contiennent le nom et le chemin d’accès du fichier PDB correspondant dans le cadre de la DLL proprement dite.</span><span class="sxs-lookup"><span data-stu-id="b570b-134">Note that many DLLs created for debugging contain the name and path of the corresponding PDB file as part of the DLL itself.</span></span> <span data-ttu-id="b570b-135">Lors du débogage de ce type de DLL sur un système où le fichier PDB se trouve à l’emplacement stocké dans la DLL, les symboles peuvent être chargés automatiquement par l’outil débogueur.</span><span class="sxs-lookup"><span data-stu-id="b570b-135">When debugging this type of DLL on a system where the PDB can be found at the location stored in the DLL, symbols may be loaded automatically by the debugger tool.</span></span> <span data-ttu-id="b570b-136">Dans les situations où le fichier PDB est introuvable à l’emplacement stocké, où le débogueur ne prend pas en charge le chargement de symboles à partir de l’emplacement stocké, ou où la DLL n’a pas été générée avec des informations de débogage, vous devrez peut-être placer vos fichiers de symboles dans le dossier avec le fichier DLL temporaire.</span><span class="sxs-lookup"><span data-stu-id="b570b-136">In situations where the PDB cannot be found at the stored location, where the debugger does not support loading symbols from the stored location, or where the DLL was not built with debugging information, you may need to place your symbol files in the folder with the temporary DLL file.</span></span>

<span data-ttu-id="b570b-137">Le programme d’installation ajoute des informations de débogage pour les scripts d’action personnalisés dans le fichier journal d’installation.</span><span class="sxs-lookup"><span data-stu-id="b570b-137">The installer adds debugging information for custom action scripts to the installation log file.</span></span>

``` syntax
There is a problem with this Windows Installer package. A script 
required for this install to complete could not be run. Contact your 
support personnel or package vendor.  {Custom action [2] script error 
[3], [4]: [5] Line [6], Column [7], [8] }
```

 

 



