---
description: Cette section explique comment envoyer des messages à partir d’actions personnalisées qui effectuent réellement une partie de l’installation en appelant une bibliothèque de liens dynamiques ou un script.
ms.assetid: 637efccf-920d-421d-9183-528cc3515bf8
title: Retour de messages d’erreur à partir d’actions personnalisées
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 480a9e7891680aadc9d8eb4eedba2bad0d2e3dd4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104114554"
---
# <a name="returning-error-messages-from-custom-actions"></a><span data-ttu-id="d8654-103">Retour de messages d’erreur à partir d’actions personnalisées</span><span class="sxs-lookup"><span data-stu-id="d8654-103">Returning Error Messages from Custom Actions</span></span>

<span data-ttu-id="d8654-104">Cette section explique comment envoyer des messages à partir d’actions personnalisées qui effectuent réellement une partie de l’installation en appelant une bibliothèque de liens dynamiques ou un script.</span><span class="sxs-lookup"><span data-stu-id="d8654-104">This section describes how to send messages from custom actions that actually perform a part of the installation by calling a dynamic link library or script.</span></span> <span data-ttu-id="d8654-105">Notez que le [type d’action personnalisé 19](custom-action-type-19.md) envoie uniquement un message d’erreur spécifié, retourne un échec, puis met fin à l’installation.</span><span class="sxs-lookup"><span data-stu-id="d8654-105">Note that [Custom Action Type 19](custom-action-type-19.md) only sends a specified error message, returns failure, and then terminates the installation.</span></span> <span data-ttu-id="d8654-106">Le type d’action personnalisé 19 n’effectue aucune partie de l’installation.</span><span class="sxs-lookup"><span data-stu-id="d8654-106">Custom Action Type 19 does not perform any part of the installation.</span></span>

<span data-ttu-id="d8654-107">Pour envoyer un message d’erreur à partir d’une action personnalisée qui utilise une [bibliothèque de liens dynamiques](dynamic-link-libraries.md) (dll), appelez l’action personnalisée [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage).</span><span class="sxs-lookup"><span data-stu-id="d8654-107">To send an error message from a custom action that uses a [dynamic-link library](dynamic-link-libraries.md) (DLL), have the custom action call [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage).</span></span> <span data-ttu-id="d8654-108">Notez que les actions personnalisées lancées par une [action ControlEvent,](doaction-controlevent.md) peuvent envoyer des messages avec la méthode de [**message**](session-message.md) , mais ne peuvent pas envoyer de message avec **MsiProcessMessage**.</span><span class="sxs-lookup"><span data-stu-id="d8654-108">Note that custom actions launched by a [DoAction ControlEvent](doaction-controlevent.md) can send messages with the [**Message**](session-message.md) method but cannot send a message with **MsiProcessMessage**.</span></span> <span data-ttu-id="d8654-109">Sur les systèmes antérieurs à Windows Server 2003, les actions personnalisées lancées par une action ControlEvent, ne peuvent pas envoyer de messages avec **MsiProcessMessage** ou la méthode de **message** .</span><span class="sxs-lookup"><span data-stu-id="d8654-109">On systems earlier than Windows Server 2003, custom actions launched by a DoAction ControlEvent cannot send messages with **MsiProcessMessage** or **Message** method.</span></span> <span data-ttu-id="d8654-110">Pour plus d’informations, consultez [envoi de messages à Windows Installer à l’aide de MsiProcessMessage](sending-messages-to-windows-installer-using-msiprocessmessage.md).</span><span class="sxs-lookup"><span data-stu-id="d8654-110">For more information, see [Sending Messages to Windows Installer Using MsiProcessMessage](sending-messages-to-windows-installer-using-msiprocessmessage.md).</span></span>

<span data-ttu-id="d8654-111">**Pour afficher un message d’erreur à partir d’une action personnalisée à l’aide d’une DLL**</span><span class="sxs-lookup"><span data-stu-id="d8654-111">**To display an error message from within a custom action using a DLL**</span></span>

1.  <span data-ttu-id="d8654-112">L’action personnalisée doit appeler [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) et transmettre les paramètres *hInstall*, *eMessageType* et *hRecord*.</span><span class="sxs-lookup"><span data-stu-id="d8654-112">The custom action should call [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) and pass in the parameters *hInstall*, *eMessageType*, and *hRecord*.</span></span> <span data-ttu-id="d8654-113">Le descripteur de l’installation, [type d’action personnalisée 19](custom-action-type-19.md), peut être fourni à l’action personnalisée, comme décrit dans [accès à la session de programme d’installation actuelle à partir d’une action personnalisée](accessing-the-current-installer-session-from-inside-a-custom-action.md) ou de [**MsiOpenProduct**](/windows/desktop/api/Msi/nf-msi-msiopenproducta) ou [**MsiOpenPackage**](/windows/desktop/api/Msi/nf-msi-msiopenpackagea).</span><span class="sxs-lookup"><span data-stu-id="d8654-113">The handle to the installation, [Custom Action Type 19](custom-action-type-19.md), may be provided to the custom action as described in [Accessing the Current Installer Session from Inside a Custom Action](accessing-the-current-installer-session-from-inside-a-custom-action.md) or from [**MsiOpenProduct**](/windows/desktop/api/Msi/nf-msi-msiopenproducta) or [**MsiOpenPackage**](/windows/desktop/api/Msi/nf-msi-msiopenpackagea).</span></span>
2.  <span data-ttu-id="d8654-114">Le paramètre *eMessageType* doit spécifier l’un des types de messages comme indiqué dans [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage).</span><span class="sxs-lookup"><span data-stu-id="d8654-114">The parameter *eMessageType* should specify one of the message types as listed in [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage).</span></span>
3.  <span data-ttu-id="d8654-115">Le paramètre *hRecord* de la fonction [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) dépend du type de message.</span><span class="sxs-lookup"><span data-stu-id="d8654-115">The *hRecord* parameter of the [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) function depends upon the message type.</span></span> <span data-ttu-id="d8654-116">Consultez [envoi de messages à Windows Installer à l’aide de MsiProcessMessage](sending-messages-to-windows-installer-using-msiprocessmessage.md).</span><span class="sxs-lookup"><span data-stu-id="d8654-116">See [Sending Messages to Windows Installer Using MsiProcessMessage](sending-messages-to-windows-installer-using-msiprocessmessage.md).</span></span> <span data-ttu-id="d8654-117">Si le message contient des données mises en forme, entrez le message dans la table d' [Erreurs](error-table.md) en utilisant la mise en forme décrite dans [mise en forme](formatted.md).</span><span class="sxs-lookup"><span data-stu-id="d8654-117">If the message contains formatted data, enter the message into the [Error](error-table.md) table using the formatting described in [Formatted](formatted.md).</span></span>

<span data-ttu-id="d8654-118">Pour envoyer un message d’erreur à partir d’une action personnalisée qui utilise des [scripts](scripts.md), l’action personnalisée peut appeler la méthode de [**message**](session-message.md) de l’objet de [**session**](session-object.md) .</span><span class="sxs-lookup"><span data-stu-id="d8654-118">To send an error message from a custom action that uses [Scripts](scripts.md), the custom action may call the [**Message**](session-message.md) method of the [**Session**](session-object.md) object.</span></span>

<span data-ttu-id="d8654-119">**Pour afficher un message d’erreur à partir d’une action personnalisée à l’aide d’un script**</span><span class="sxs-lookup"><span data-stu-id="d8654-119">**To display an error message from within a custom action using script**</span></span>

1.  <span data-ttu-id="d8654-120">L’action personnalisée doit appeler la méthode de [**message**](session-message.md) de l’objet de [**session**](session-object.md) et transmettre les paramètres *Kind* et *Record*.</span><span class="sxs-lookup"><span data-stu-id="d8654-120">The custom action should call the [**Message**](session-message.md) method of the [**Session**](session-object.md) object and pass in the parameters *kind* and *record*.</span></span>
2.  <span data-ttu-id="d8654-121">Le *genre* de paramètre doit spécifier l’un des types de messages listés dans la méthode de [**message**](session-message.md) .</span><span class="sxs-lookup"><span data-stu-id="d8654-121">The parameter *kind* should specify one of the message types listed in the [**Message**](session-message.md) method.</span></span>
3.  <span data-ttu-id="d8654-122">Le paramètre d' *enregistrement* de la méthode de [**message**](session-message.md) dépend du type de message.</span><span class="sxs-lookup"><span data-stu-id="d8654-122">The *record* parameter of the [**Message**](session-message.md) method depends upon the message type.</span></span> <span data-ttu-id="d8654-123">Si le message contient des données mises en forme, entrez le message dans la table d' [Erreurs](error-table.md) en utilisant la mise en forme décrite dans [mise en forme](formatted.md).</span><span class="sxs-lookup"><span data-stu-id="d8654-123">If the message contains formatted data, enter the message into the [Error](error-table.md) table using the formatting described in [Formatted](formatted.md).</span></span>

<span data-ttu-id="d8654-124">Les actions personnalisées utilisant des [fichiers exécutables](executable-files.md) ne peuvent pas envoyer de message en appelant [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) ou la méthode [**message**](session-message.md) , car ils ne peuvent pas obtenir de handle pour l’installation.</span><span class="sxs-lookup"><span data-stu-id="d8654-124">Custom actions using [Executable Files](executable-files.md) cannot send a message by calling [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) or the [**Message**](session-message.md) method because they cannot get a handle to the installation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d8654-125">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="d8654-125">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d8654-126">Valeurs de retour de l’action personnalisée</span><span class="sxs-lookup"><span data-stu-id="d8654-126">Custom Action Return Values</span></span>](custom-action-return-values.md)
</dt> </dl>

 

 



