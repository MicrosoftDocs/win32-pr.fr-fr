---
description: Un package à double usage est un package Windows Installer 5,0 qui a été créé pour pouvoir installer une application dans le contexte d’installation par utilisateur ou par ordinateur.
ms.assetid: b2da9fba-8fdf-48fa-a662-6b3eee1bfe87
title: Création d’un package unique
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 87c22b9be930be2d2178ea4efb7ba1538320823a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106520622"
---
# <a name="single-package-authoring"></a>Création d’un package unique

Un package à double usage est un package Windows Installer 5,0 qui a été créé pour pouvoir installer une application dans le [contexte d’installation](installation-context.md)par utilisateur ou par ordinateur. Les développeurs de programme d’installation qui utilisent un package à double usage pour leur application peuvent fournir à leurs utilisateurs un choix de contexte d’installation lors de l’installation et peuvent supprimer les invites d’informations d’identification UAC des installations par utilisateur sur Windows 7 ou Windows Server 2008 R2. Le développement d’un package Windows Installer 5,0 à double usage pour l’installation sur Windows 7 et Windows Server 2008 R2 est appelé création de package unique.

Vous pouvez commencer à développer des packages à double usage pour Windows 7 et Windows Server 2008 R2 à l’aide de Windows Installer 5,0, de la propriété [**MSIINSTALLPERUSER**](msiinstallperuser.md) , de la propriété [**ALLUSERS**](allusers.md) et des dossiers connus par utilisateur et des inscriptions du [shell Windows](/previous-versions/windows/desktop/legacy/bb773177(v=vs.85)). Lorsque Windows Installer 5,0 installe un package à double usage dans le contexte par utilisateur sur Windows 7 ou Windows Server 2008 R2, le programme d’installation dirige les entrées de Registre et de fichier vers des emplacements par utilisateur et n’affiche pas les invites UAC pour les informations d’identification. Lorsque Windows Installer 5,0 installe un package à double usage dans le contexte par ordinateur, le programme d’installation dirige les fichiers et les entrées de Registre vers des emplacements par ordinateur et demande des informations d’identification UAC pour confirmer que l’utilisateur dispose de privilèges suffisants pour installer des logiciels pour tous les utilisateurs de l’ordinateur. Une fois que Windows Installer 5,0 installe une application, il utilise le même contexte d’installation pour toutes les mises à jour, réparations ou suppressions ultérieures de l’application.

**[Windows Installer 4,5 ou version antérieure](not-supported-in-windows-installer-4-5.md):** la propriété [**MSIINSTALLPERUSER**](msiinstallperuser.md) et les versions par utilisateur des dossiers référencés par les propriétés [**ProgramFilesFolder**](programfilesfolder.md), [**CommonFilesFolder**](commonfilesfolder.md), [**ProgramFiles64Folder**](programfiles64folder.md)et [**CommonFiles64Folder**](commonfiles64folder.md) ne sont pas prises en charge. Les dossiers **FOLDERID \_ UserProgramFiles** et **FOLDERID \_ UserProgramFilesCommon** sont disponibles à partir de windows 7 et de Windows Server 2008 R2. Cela signifie que les installations développées pour les fichiers directs et les entrées de registre de Windows Installer 4,5 ou versions antérieures dans FOLDERID \_ ProgramFiles, FOLDERID \_ PROGRAMFILESCOMMON, FOLDERID \_ ProgramFilesX64 et FOLDERID \_ ProgramFilesCommonX64. Étant donné que ces emplacements sont accessibles à d’autres utilisateurs de l’ordinateur, Windows Vista et les systèmes ultérieurs requièrent l’affichage des invites UAC pour les informations d’identification.

Lorsqu’un utilisateur installe un package à double usage créé pour Windows Installer 5,0 avec Windows Installer 4,5 ou version antérieure, le programme d’installation ignore la propriété [**MSIINSTALLPERUSER**](msiinstallperuser.md) . Dans ce cas, l’installation peut diriger les fichiers et les entrées de Registre vers des emplacements accessibles à d’autres utilisateurs et demander au système d’afficher les invites de contrôle de compte d’utilisateur pour les informations d’identification. Windows Installer 5,0 peut installer un package développé pour Windows Installer 4,5 ou version antérieure, mais l’installation dirige les fichiers et les entrées de Registre vers des emplacements accessibles à d’autres utilisateurs et requiert que le système affiche des invites de contrôle de compte d’utilisateur pour les informations d’identification.

## <a name="development-guidelines"></a>Instructions de développement

Respectez les instructions de création de packages uniques suivantes pour vous assurer que le package peut être installé dans le contexte par utilisateur ou par ordinateur. Suivez ces instructions pour permettre à l’utilisateur de choisir au moment de l’installation une installation par utilisateur ou par ordinateur et pour supprimer les invites UAC des installations par utilisateur.

-   L’installation par utilisateur requiert Windows Installer 5,0 sur Windows 7 ou Windows Server 2008 R2. Vous devez informer l’utilisateur que le package prend en charge l’installation par ordinateur de l’application sur les versions antérieures du système.
-   Initialisez les valeurs des propriétés [**ALLUSERS**](allusers.md) et [**MSIINSTALLPERUSER**](msiinstallperuser.md) dans la [table de propriétés](property-table.md) de votre package à double usage. Utilisez la valeur **ALLUSERS** 2 et la valeur **MSIINSTALLPERUSER** 1 comme valeurs initiales. Cela spécifie l’installation par utilisateur comme valeur par défaut pour le package à double usage.
-   Envisagez de créer une boîte de dialogue pour l' [interface utilisateur](user-interface.md) de votre package à double usage qui permet à l’utilisateur de choisir le contexte au moment de l’installation. Créez les contrôles sur cette boîte de dialogue personnalisée pour définir les valeurs des propriétés [**ALLUSERS**](allusers.md) et [**MSIINSTALLPERUSER**](msiinstallperuser.md) . Pour la valeur **ALLUSERS** 2, affectez la valeur 1 à **MSIINSTALLPERUSER** pour spécifier une installation par utilisateur et définissez **MSIINSTALLPERUSER** sur une chaîne vide ("") pour spécifier une installation par ordinateur. Les utilisateurs peuvent également définir **ALLUSERS** et **MSIINSTALLPERUSER** sur la ligne de commande s’ils installent le package à partir de la ligne de commande.
-   Validez le package à l’aide [des évaluateurs de cohérence internes-ICEs](internal-consistency-evaluators-ices.md). Le package doit être en mesure de réussir la validation par [ICE105](ice-105.md) pour être un package à double usage valide.
-   Utilisez la table de [Registre](registry-table.md) et la [table RemoveRegistry](removeregistry-table.md) pour rediriger les entrées de Registre vers les parties par utilisateur du registre lors des installations par utilisateur. Dans une installation par utilisateur, les entrées de Registre qui ont-1 dans la colonne racine sont redirigées vers **HKEY \_ Current \_ User** et, dans une installation par ordinateur, celles-ci sont dirigées vers **HKEY \_ local \_ machine**. Dans une installation par utilisateur, les entrées de Registre qui ont msidbRegistryRootClassesRoot (0) dans la colonne racine sont redirigées vers les classes de \\ **logiciel** HKCU \\ et, dans une installation par ordinateur, elles sont dirigées vers les classes de  \\ **logiciel** HKLM \\ .
-   Utilisez la propriété [**ProgramFilesFolder**](programfilesfolder.md) dans la [table des répertoires](directory-table.md) des [packages Windows Installers 32 bits](32-bit-windows-installer-packages.md) pour spécifier les emplacements des répertoires contenant des composants 32 bits qui ne sont pas partagés entre les applications. Lorsqu’un utilisateur installe le package à double usage à l’aide du contexte par ordinateur, ces composants sont enregistrés dans le dossier Program Files sur les versions 32 bits de Windows et dans le dossier Program Files (x86) sur les versions 64 bits du système. Tous les utilisateurs peuvent accéder aux composants de ces répertoires. Lorsqu’un utilisateur installe le package à double usage sur Windows 7 ou Windows Server 2008 R2 à l’aide du contexte par utilisateur, ces composants sont enregistrés dans le dossier programmes de l’utilisateur actuel (par exemple, dans% LocalAppData% \\ Programs) et sont accessibles uniquement par cet utilisateur.
-   Utilisez la propriété [**CommonFilesFolder**](commonfilesfolder.md) de la [table des répertoires](directory-table.md) des [packages Windows Installer bits 32](32-bit-windows-installer-packages.md) pour spécifier les emplacements des répertoires contenant des composants 32 bits partagés entre les applications. Lorsqu’un utilisateur installe le package à double usage à l’aide du contexte par ordinateur, ces composants sont enregistrés dans le dossier Fichiers communs et sont accessibles à tous les utilisateurs. Lorsqu’un utilisateur installe le package à double usage sur Windows 7 ou Windows Server 2008 R2 à l’aide du contexte par utilisateur, ces composants sont enregistrés dans le dossier commun de l’utilisateur actuel (par exemple, dans% LocalAppData% \\ Programs \\ Common) et sont accessibles uniquement par cet utilisateur.
-   Utilisez la propriété [**ProgramFiles64Folder**](programfiles64folder.md) dans la [table des répertoires](directory-table.md) des [packages Windows Installers 64 bits](64-bit-windows-installer-packages.md) pour spécifier les emplacements des répertoires contenant des composants 64 bits qui ne sont pas partagés entre les applications. Lorsqu’un utilisateur installe le package à double usage à l’aide du contexte par ordinateur, ces composants sont enregistrés dans le dossier Program Files. Tous les utilisateurs peuvent accéder aux composants de ces répertoires. Lorsqu’un utilisateur installe le package à double usage sur Windows 7 ou Windows Server 2008 R2 à l’aide du contexte par utilisateur, ces composants sont enregistrés dans le dossier programmes de l’utilisateur actuel (par exemple, dans% LocalAppData% \\ Programs) et sont accessibles uniquement par cet utilisateur. Pour plus d’informations sur la création d’un package pour installer une application sur des systèmes d’exploitation 64 bits, consultez [Windows Installer sur les systèmes d’exploitation 64 bits](windows-installer-on-64-bit-operating-systems.md).
-   Utilisez la propriété [**CommonFiles64Folder**](commonfiles64folder.md) de la [table des répertoires](directory-table.md) des [packages Windows Installer bits 64](64-bit-windows-installer-packages.md) pour spécifier les emplacements des répertoires contenant des composants 64 bits partagés entre les applications. Lorsqu’un utilisateur installe le package à double usage à l’aide du contexte par ordinateur, ces composants sont enregistrés dans le dossier Fichiers communs et sont accessibles à tous les utilisateurs. Lorsqu’un utilisateur installe le package à double usage sur Windows 7 ou Windows Server 2008 R2 à l’aide du contexte par utilisateur, ces composants sont enregistrés dans le dossier commun de l’utilisateur actuel (par exemple, dans% LocalAppData% \\ Programs \\ Common) et sont accessibles uniquement par cet utilisateur.
-   Utilisez les propriétés [**ProgramFilesFolder**](programfilesfolder.md) et [**CommonFilesFolder**](commonfilesfolder.md) de la [table Directory](directory-table.md) des [packages Windows Installer bits 64](64-bit-windows-installer-packages.md) pour spécifier l’emplacement des répertoires contenant des composants 32 bits. Utilisez des noms différents pour les versions 32 bits et 64 bits de tous les composants fournis avec le même nom, ou enregistrez les versions dans des dossiers différents. Par exemple, ajoutez des informations à la table Directory pour spécifier l’emplacement du répertoire contenant la version 32 bits sous la forme d’un nom d’application d’un nom d' \[ \] \\  \\ *application d’application* \\ x86 et l’emplacement du répertoire contenant la version 64 bits sous le nom d' \[ application Program64FilesFolder \] \\ *ISV Name* \\  \\ x64. Une installation par ordinateur enregistre ensuite la version 32 bits dans Program Files (x86) nom d’application nom d' \\  \\ *application* \\ x86 et enregistre la version 64 bits dans Program Files nom de l’application de nom \\ *ISV* \\  \\ x64. Une installation par utilisateur enregistre la version 32 bits dans% LocalAppData% \\ Programs \\ *ISV Name* nom d' \\ *application* \\ x86 et installe la version 64 bits dans% LocalAppData% \\ Programs \\ *ISV Name* \\ *application name* \\ x64.
-   Stocke les données de configuration par utilisateur pour l’application sous \\ les utilisateurs \\ *nom_utilisateur* \\ AppData.
-   Stocker les modèles et les fichiers générés par l’application dans des sous-dossiers sous \\ les \\ *noms d’utilisateur nom d’utilisateur*.
-   Si votre application utilise des extensions d’environnement, vous devez utiliser les points d' [extensibilité de Shell](https://msdn.microsoft.com/library/bb762762.aspx) par utilisateur qui sont disponibles à partir de Windows 7 ou windows Server 2008 R2.
-   N’utilisez pas d’actions personnalisées dans votre package qui requièrent des privilèges élevés pour s’exécuter. La table [CustomAction](customaction-table.md) ne doit pas contenir d’actions personnalisées qui ont été marquées pour s’exécuter avec des privilèges élevés. Pour plus d’informations sur les actions personnalisées avec élévation de privilèges, consultez sécurité des actions [personnalisées](custom-action-security.md).
-   N’écrivez pas dans les dossiers système globaux. La table de [répertoire](directory-table.md) ne doit pas contenir de référence à l’une des propriétés de dossier système suivantes.

    <dl>

[**AdminToolsFolder**](admintoolsfolder.md)  
    [**CommonAppDataFolder**](commonappdatafolder.md)  
    [**FontsFolder**](fontsfolder.md)  
    [**System16Folder**](system16folder.md)  
    [**System64Folder**](system64folder.md)  
    [**SystemFolder**](systemfolder.md)  
    [**TempFolder**](tempfolder.md)  
    [**WindowsFolder**](windowsfolder.md)  
    [**WindowsVolume**](windowsvolume.md)  
    </dl>

-   N’installez pas un assembly common language runtime dans le Global Assembly Cache (GAC). Pour plus d’informations sur l’installation d’assemblys dans le Global Assembly Cache, consultez [Ajout d’assemblys à un package](adding-assemblies-to-a-package.md) et [installation d’assemblys CLR (Common Language Runtime](installation-of-common-language-runtime-assemblies.md)).
-   N’installez pas de sources de données ODBC. N’utilisez pas la table [ODBCDataSource](odbcdatasource-table.md) pour installer une source de données.
-   N’installez aucun service. N’utilisez pas la table [ServiceInstall](serviceinstall-table.md) pour installer un service.

## <a name="example"></a>Exemple

Un exemple de package à double usage est fourni dans les [composants SDK Windows pour Windows Installer les développeurs](platform-sdk-components-for-windows-installer-developers.md) comme PUASample1.msi de fichier. Si vous avez le kit de développement logiciel (SDK) actuel, vous avez accès à tous les outils et données nécessaires pour reproduire l’exemple de package d’installation. Pour plus d’informations sur cet exemple, consultez [exemple de création de package unique](single-package-authoring-example.md).

 

 
