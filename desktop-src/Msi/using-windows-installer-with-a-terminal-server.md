---
description: Les éléments suivants peuvent affecter les installations de Windows Installer lors de l’utilisation d’un serveur Terminal Server. Les développeurs du programme d’installation doivent toujours vérifier que leur package Windows Installer s’installe comme prévu quand les utilisateurs utilisent également un serveur Terminal Server.
ms.assetid: deda9efa-a0fc-4b4e-a531-650ac201fd84
title: Utilisation de Windows Installer avec un Terminal Server
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d471fa19b4588a01a2730af44fa5e9d978d18859
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104484657"
---
# <a name="using-windows-installer-with-a-terminal-server"></a><span data-ttu-id="8c87a-104">Utilisation de Windows Installer avec un Terminal Server</span><span class="sxs-lookup"><span data-stu-id="8c87a-104">Using Windows Installer with a Terminal Server</span></span>

<span data-ttu-id="8c87a-105">Les éléments suivants peuvent affecter les installations de Windows Installer lors de l’utilisation d’un serveur Terminal Server.</span><span class="sxs-lookup"><span data-stu-id="8c87a-105">The following may affect Windows Installer installations when using a terminal server.</span></span> <span data-ttu-id="8c87a-106">Les développeurs du programme d’installation doivent toujours vérifier que leur package Windows Installer s’installe comme prévu quand les utilisateurs utilisent également un serveur Terminal Server.</span><span class="sxs-lookup"><span data-stu-id="8c87a-106">Setup developers should always test that their Windows Installer package installs as expected when users are also using a terminal server.</span></span>

-   <span data-ttu-id="8c87a-107">Sur les systèmes d’exploitation antérieurs à Windows Server 2008 et Windows Vista, la stratégie système [EnableAdminTSRemote](enableadmintsremote.md) doit être définie pour permettre aux administrateurs d’effectuer des installations dans la session cliente.</span><span class="sxs-lookup"><span data-stu-id="8c87a-107">On operating systems earlier than Windows Server 2008 and Windows Vista, the [EnableAdminTSRemote](enableadmintsremote.md) system policy must be set to enable administrators to perform installations in the client session.</span></span> <span data-ttu-id="8c87a-108">À partir de Windows Server 2008 et Windows Vista, la stratégie EnableAdminTSRemote n’a plus aucun effet.</span><span class="sxs-lookup"><span data-stu-id="8c87a-108">Beginning with Windows Server 2008 and Windows Vista, the EnableAdminTSRemote policy no longer has any effect.</span></span> <span data-ttu-id="8c87a-109">Quel que soit son paramètre, les administrateurs et les non-administrateurs peuvent effectuer une installation dans la session cliente ou la session de la console.</span><span class="sxs-lookup"><span data-stu-id="8c87a-109">Regardless of its setting, administrators and non-administrators can perform an installation in the client session or the console session.</span></span> <span data-ttu-id="8c87a-110">Les administrateurs et les non-administrateurs peuvent toujours effectuer des installations Windows Installer dans la session de la console.</span><span class="sxs-lookup"><span data-stu-id="8c87a-110">Administrators and non-administrators can always perform Windows Installer installations in the console session.</span></span>
-   <span data-ttu-id="8c87a-111">Le Windows Installer empêche l’installation dans le contexte d' [installation](installation-context.md) par utilisateur si la[stratégie système](system-policy.md) [DisableUserInstalls](disableuserinstalls.md)est définie sur 1.</span><span class="sxs-lookup"><span data-stu-id="8c87a-111">The Windows Installer prevents installation in the per-user [installation context](installation-context.md) if the [DisableUserInstalls](disableuserinstalls.md)[system policy](system-policy.md) is set to 1.</span></span> <span data-ttu-id="8c87a-112">Dans ce cas, le programme d’installation ignore toutes les applications inscrites en tant qu’utilisateur et recherche uniquement les applications inscrites en tant qu’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="8c87a-112">In this case, the installer ignores all applications registered as per-user and searches only for applications registered as per-machine.</span></span>
-   <span data-ttu-id="8c87a-113">Lorsqu’un administrateur effectue une installation dans une session cliente d’un serveur Terminal Server hébergé dans Windows 2000, l’installation doit utiliser un chemin d’accès UNC et non une lettre de lecteur mappée.</span><span class="sxs-lookup"><span data-stu-id="8c87a-113">When an administrator performs an installation in a client session of a terminal server that is hosted in Windows 2000, the installation must use a UNC path and not a mapped drive letter.</span></span>

<span data-ttu-id="8c87a-114">Les développeurs doivent respecter les instructions suivantes lors du développement d’un composant Windows Installer qui peut être utilisé avec un serveur Terminal Server.</span><span class="sxs-lookup"><span data-stu-id="8c87a-114">Developers should adhere to the following guidelines when developing a Windows Installer component that may be used with a terminal server.</span></span>

-   <span data-ttu-id="8c87a-115">Écrire toutes les informations de Registre **HKCU** dans la partie du  \\ **logiciel** HKCU du Registre.</span><span class="sxs-lookup"><span data-stu-id="8c87a-115">Write all **HKCU** registry information in the **HKCU**\\**Software** part of the registry.</span></span>
-   <span data-ttu-id="8c87a-116">Le stockage des informations de configuration dans les fichiers INI n’est pas recommandé.</span><span class="sxs-lookup"><span data-stu-id="8c87a-116">Storing configuration information in INI files is not recommended.</span></span>
-   <span data-ttu-id="8c87a-117">Écrire les informations par utilisateur dans le registre lorsque l’application est exécutée pour la première fois et non au moment de l’installation.</span><span class="sxs-lookup"><span data-stu-id="8c87a-117">Write per-user information to the registry when the application is run for the first time and not at installation time.</span></span> <span data-ttu-id="8c87a-118">Si vous devez écrire des informations par utilisateur dans le registre au moment de l’installation, séparez les informations par utilisateur et par ordinateur dans différents composants de Windows Installer.</span><span class="sxs-lookup"><span data-stu-id="8c87a-118">If you must write per-user information to the registry at installation time, separate the per-user and per-machine information into different Windows Installer components.</span></span> <span data-ttu-id="8c87a-119">Créez le package de sorte que le programme d’installation ne tente pas de valider et de réparer les composants contenant des informations par utilisateur lors de l’installation de l’application.</span><span class="sxs-lookup"><span data-stu-id="8c87a-119">Author the package such that the installer does not attempt to validate and repair the components containing per-user information when the application is installed.</span></span>
-   <span data-ttu-id="8c87a-120">Un package utilisé uniquement pour les installations par ordinateur doit écrire les variables d’environnement dans l’environnement de l’ordinateur en incluant \* dans la colonne nom de la [table d’environnement](environment-table.md).</span><span class="sxs-lookup"><span data-stu-id="8c87a-120">A package used for only per-machine installations should write environment variables to the computer's environment by including \* in the Name column of the [Environment Table](environment-table.md).</span></span> <span data-ttu-id="8c87a-121">Si le package peut être utilisé pour des installations par utilisateur ou par ordinateur, utilisez deux composants.</span><span class="sxs-lookup"><span data-stu-id="8c87a-121">If the package can be used for per-user installations or per-machine installations, use two components.</span></span> <span data-ttu-id="8c87a-122">Incluez le composant pour chaque utilisateur dans la [table des composants](condition-table.md) et entrez les paramètres utilisateur dans la table d’environnement.</span><span class="sxs-lookup"><span data-stu-id="8c87a-122">Include the per-user component in the [Component Table](condition-table.md) and enter the user settings in the Environment Table.</span></span> <span data-ttu-id="8c87a-123">Incluez le composant par ordinateur dans la table des composants et entrez les paramètres de l’ordinateur dans la table d’environnement.</span><span class="sxs-lookup"><span data-stu-id="8c87a-123">Include the per-machine component in the Component Table and enter the computer settings in the Environment Table.</span></span> <span data-ttu-id="8c87a-124">Contrôlez le composant qui est installé à l’aide d’instructions conditionnelles basées sur la propriété [**ALLUSERS**](allusers.md) dans le champ condition de la table des composants.</span><span class="sxs-lookup"><span data-stu-id="8c87a-124">Control which component gets installed by using conditional statements based upon the [**ALLUSERS**](allusers.md) property in the Condition field of the Component Table.</span></span>
-   <span data-ttu-id="8c87a-125">Lors de l’exécution d’installations par ordinateur à partir d’un serveur Terminal Server, le programme d’installation écrit les variables d’environnement par utilisateur dans **HKCU** \\ **. Environnement par défaut** \\ .</span><span class="sxs-lookup"><span data-stu-id="8c87a-125">When performing per-machine installations from a terminal server, the installer writes per-user environment variables to **HKCU**\\ **.Default**\\**Environment**.</span></span> <span data-ttu-id="8c87a-126">Étant donné que le serveur Terminal Server ne réplique pas cette section du Registre, l’installation ne définit pas les variables d’environnement par utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8c87a-126">Because the terminal server does not replicate this section of the registry, the installation does not set the per-user environment variables.</span></span>
-   <span data-ttu-id="8c87a-127">Étant donné qu’un serveur peut être configuré pour empêcher les utilisateurs de réparer des applications, votre application doit gérer le cas de clés de Registre manquantes normalement.</span><span class="sxs-lookup"><span data-stu-id="8c87a-127">Because a server may be configured to prevent users from repairing applications, your application should handle the case of missing registry keys gracefully.</span></span>

<span data-ttu-id="8c87a-128">Les éléments suivants s’appliquent lorsqu’un package Windows Installer qui utilise des [actions personnalisées](custom-actions.md) dll, exe ou de script est installé dans le contexte d’installation par ordinateur sur un serveur Terminal Server.</span><span class="sxs-lookup"><span data-stu-id="8c87a-128">The following applies when a Windows Installer package that uses DLL, EXE, or Script [custom actions](custom-actions.md) is installed in the per-machine installation context on a terminal server.</span></span> <span data-ttu-id="8c87a-129">Dans ce cas, le programme d’installation définit la propriété [**TerminalServer**](terminalserver.md) .</span><span class="sxs-lookup"><span data-stu-id="8c87a-129">In this case, the installer sets the [**TerminalServer**](terminalserver.md) property.</span></span>

-   <span data-ttu-id="8c87a-130">Les actions personnalisées différées s’exécutent dans le contexte du système local, sauf si l’action a l’attribut **msidbCustomActionTypeTSAware** .</span><span class="sxs-lookup"><span data-stu-id="8c87a-130">Deferred custom actions run in the context of the local system unless the action has the **msidbCustomActionTypeTSAware** attribute.</span></span> <span data-ttu-id="8c87a-131">Cela est vrai même si l’action personnalisée emprunte l’identité de l’utilisateur sur un système qui n’est pas un serveur Terminal Server.</span><span class="sxs-lookup"><span data-stu-id="8c87a-131">This is true even if the custom action impersonates the user on a system that is not a terminal server.</span></span> <span data-ttu-id="8c87a-132">Notez que si une action personnalisée ayant l’attribut **msidbCustomActionTypeTSAware** modifie le registre de l’utilisateur, le programme d’installation ne vérifie pas automatiquement que ces modifications sont également apportées au registre de chaque utilisateur sur l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="8c87a-132">Note that if a custom action having the **msidbCustomActionTypeTSAware** attribute changes the user's registry, the installer does not automatically ensure that those changes are also made in the registry of every user on the computer.</span></span>
-   <span data-ttu-id="8c87a-133">Toutes les opérations du Registre dans une action personnalisée différée qui lisent à partir de la ruche du Registre **HKCU** voient la ruche du Registre par défaut du système et non la ruche du registre de l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="8c87a-133">Any registry operations in a deferred custom action that read from the **HKCU** registry hive sees the system's default registry hive and not the current user's registry hive.</span></span>
-   <span data-ttu-id="8c87a-134">Toutes les opérations du Registre dans une action personnalisée différée qui écrivent dans le \\ **logiciel** HKCU sont détectées par le programme d’installation et copiées sur chaque utilisateur de l’ordinateur à la prochaine ouverture de session de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8c87a-134">Any registry operations in a deferred custom action that write to **HKCU**\\**Software** are detected by the installer and copied to every user of the computer at the next logon of the user.</span></span>
-   <span data-ttu-id="8c87a-135">Toutes les opérations de Registre dans une action personnalisée différée qui écrivent dans **HKCU**, mais qui ne sont pas sous la clé de Registre **HKCU** \\ **Software** , ne sont pas détectées par le programme d’installation ou copiées.</span><span class="sxs-lookup"><span data-stu-id="8c87a-135">Any registry operations in a deferred custom action that write to **HKCU**, but are not under the **HKCU**\\**Software** registry key, are not detected by the installer or copied.</span></span>

<span data-ttu-id="8c87a-136">Pour plus d’informations, consultez [services Terminal Server](../termserv/terminal-services-portal.md) dans le kit de développement logiciel (SDK) Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="8c87a-136">For more information, see [Terminal Services](../termserv/terminal-services-portal.md) in the Microsoft Windows Software Development Kit (SDK).</span></span>

## <a name="related-topics"></a><span data-ttu-id="8c87a-137">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="8c87a-137">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8c87a-138">EnableAdminTSRemote</span><span class="sxs-lookup"><span data-stu-id="8c87a-138">EnableAdminTSRemote</span></span>](enableadmintsremote.md)
</dt> <dt>

[<span data-ttu-id="8c87a-139">**Propriété TerminalServer**</span><span class="sxs-lookup"><span data-stu-id="8c87a-139">**TerminalServer property**</span></span>](terminalserver.md)
</dt> <dt>

[<span data-ttu-id="8c87a-140">**Propriété RemoteAdminTS**</span><span class="sxs-lookup"><span data-stu-id="8c87a-140">**RemoteAdminTS property**</span></span>](remoteadmints.md)
</dt> <dt>

[<span data-ttu-id="8c87a-141">Terminal Services</span><span class="sxs-lookup"><span data-stu-id="8c87a-141">Terminal Services</span></span>](../termserv/terminal-services-portal.md)
</dt> </dl>

 

 
