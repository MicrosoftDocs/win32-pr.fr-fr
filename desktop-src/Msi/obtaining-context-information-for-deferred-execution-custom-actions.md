---
description: Étant donné que le script d’installation peut être exécuté en dehors de la session d’installation dans laquelle il a été écrit, la session n’existe peut-être plus pendant l’exécution du script d’installation.
ms.assetid: 13174c5d-c810-4b5d-9d1e-60ed30b8c44d
title: Obtention d’informations de contexte pour les actions personnalisées d’exécution différée
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a13cd956509a5b8a4c92e0a53bfa455154a59bcc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103753516"
---
# <a name="obtaining-context-information-for-deferred-execution-custom-actions"></a><span data-ttu-id="7a204-103">Obtention d’informations de contexte pour les actions personnalisées d’exécution différée</span><span class="sxs-lookup"><span data-stu-id="7a204-103">Obtaining Context Information for Deferred Execution Custom Actions</span></span>

<span data-ttu-id="7a204-104">Étant donné que le script d’installation peut être exécuté en dehors de la session d’installation dans laquelle il a été écrit, la session n’existe peut-être plus pendant l’exécution du script d’installation.</span><span class="sxs-lookup"><span data-stu-id="7a204-104">Because installation script can be executed outside of the installation session in which it was written, the session may no longer exist during execution of the installation script.</span></span> <span data-ttu-id="7a204-105">Dans ce cas, le handle de session d’origine et les propriétés définies pendant la séquence d’installation ne sont pas disponibles pour une action personnalisée d’exécution différée.</span><span class="sxs-lookup"><span data-stu-id="7a204-105">In this case, the original session handle and properties set during the installation sequence are not available to a deferred execution custom action.</span></span> <span data-ttu-id="7a204-106">Toutes les fonctions qui requièrent un descripteur de session sont limitées à quelques méthodes qui peuvent récupérer des informations de contexte, sinon les propriétés nécessaires pendant l’exécution du script doivent être écrites dans le script d’installation.</span><span class="sxs-lookup"><span data-stu-id="7a204-106">Any functions that require a session handle are restricted to a few methods that can retrieve context information, or else properties that are needed during script execution must be written into the installation script.</span></span> <span data-ttu-id="7a204-107">Par exemple, les actions personnalisées différées qui appellent des bibliothèques de liens dynamiques (dll) passent un handle qui ne peut être utilisé que pour obtenir une quantité très limitée d’informations.</span><span class="sxs-lookup"><span data-stu-id="7a204-107">For example, deferred custom actions that call dynamic-link libraries (DLLs) pass a handle which can only be used to obtain a very limited amount of information.</span></span> <span data-ttu-id="7a204-108">Les fonctions qui ne nécessitent pas de descripteur de session sont accessibles à partir d’une action personnalisée différée.</span><span class="sxs-lookup"><span data-stu-id="7a204-108">Functions that do not require a session handle can be accessed from a deferred custom action.</span></span>

<span data-ttu-id="7a204-109">Les actions personnalisées d’exécution différée sont limitées à l’appel des fonctions suivantes qui requièrent un handle.</span><span class="sxs-lookup"><span data-stu-id="7a204-109">Deferred execution custom actions are restricted to calling only the following functions requiring a handle.</span></span>



| <span data-ttu-id="7a204-110">Fonction</span><span class="sxs-lookup"><span data-stu-id="7a204-110">Function</span></span>                                       | <span data-ttu-id="7a204-111">Description</span><span class="sxs-lookup"><span data-stu-id="7a204-111">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="7a204-112">**MsiGetProperty**</span><span class="sxs-lookup"><span data-stu-id="7a204-112">**MsiGetProperty**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya)       | <span data-ttu-id="7a204-113">Prend en charge un ensemble limité de propriétés lorsqu’il est utilisé avec des [actions personnalisées d’exécution différée](deferred-execution-custom-actions.md): la propriété CustomActionData, la propriété [**ProductCode**](productcode.md) et la propriété [**UserSid**](usersid.md) . Les [actions personnalisées de validation](commit-custom-actions.md) ne peuvent pas utiliser la fonction [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) pour obtenir la propriété [**ProductCode**](productcode.md) .</span><span class="sxs-lookup"><span data-stu-id="7a204-113">Supports a limited set of properties when used with [deferred execution custom actions](deferred-execution-custom-actions.md): the CustomActionData property, [**ProductCode**](productcode.md) property, and [**UserSID**](usersid.md) property.[Commit custom actions](commit-custom-actions.md) cannot use the [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) function to obtain the [**ProductCode**](productcode.md) property.</span></span> <span data-ttu-id="7a204-114">Les actions personnalisées de validation peuvent utiliser la propriété CustomActionData pour obtenir le code du produit.</span><span class="sxs-lookup"><span data-stu-id="7a204-114">Commit custom actions can use the CustomActionData property to obtain the product code.</span></span><br/> |
| [<span data-ttu-id="7a204-115">**MsiFormatRecord**</span><span class="sxs-lookup"><span data-stu-id="7a204-115">**MsiFormatRecord**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msiformatrecorda)     | <span data-ttu-id="7a204-116">Prend en charge un ensemble limité de propriétés lorsqu’il est utilisé avec des [actions personnalisées d’exécution différée](deferred-execution-custom-actions.md): les propriétés CustomActionData et ProductCode.</span><span class="sxs-lookup"><span data-stu-id="7a204-116">Supports a limited set of properties when used with [deferred execution custom actions](deferred-execution-custom-actions.md): the CustomActionData and ProductCode properties.</span></span>                                                                                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="7a204-117">**MsiGetMode**</span><span class="sxs-lookup"><span data-stu-id="7a204-117">**MsiGetMode**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode)               | <span data-ttu-id="7a204-118">Lorsqu’elles sont appelées à partir d' [actions personnalisées d’exécution différée](deferred-execution-custom-actions.md), de [validation des actions personnalisées](commit-custom-actions.md)ou de [restaurations personnalisées](rollback-custom-actions.md), [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) retourne true ou false quand il est demandé de vérifier les paramètres de mode MSIRUNMODE \_ , MSIRUNMODE \_ Commit ou MSIRUNMODE \_ Rollback.</span><span class="sxs-lookup"><span data-stu-id="7a204-118">When called from [deferred execution custom actions](deferred-execution-custom-actions.md), [commit custom actions](commit-custom-actions.md), or [rollback custom actions](rollback-custom-actions.md), [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) returns True or False when requested to check the mode parameters MSIRUNMODE\_SCHEDULED, MSIRUNMODE\_COMMIT, or MSIRUNMODE\_ROLLBACK.</span></span> <span data-ttu-id="7a204-119">Les demandes de vérification de tous les autres paramètres de mode d’exécution d’une action personnalisée différée, de validation ou d’annulation renvoient la valeur false.</span><span class="sxs-lookup"><span data-stu-id="7a204-119">Requests to check any other run mode parameters from a deferred, commit, or rollback custom action returns False.</span></span><br/>                       |
| [<span data-ttu-id="7a204-120">**MsiGetLanguage**</span><span class="sxs-lookup"><span data-stu-id="7a204-120">**MsiGetLanguage**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage)       | <span data-ttu-id="7a204-121">ID de langue numérique du produit actuel. Les [actions personnalisées de validation](commit-custom-actions.md) ne peuvent pas utiliser la fonction [**MsiGetLanguage**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) .</span><span class="sxs-lookup"><span data-stu-id="7a204-121">The numeric language ID for the current product.[Commit custom actions](commit-custom-actions.md) cannot use the [**MsiGetLanguage**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) function.</span></span> <span data-ttu-id="7a204-122">Les actions personnalisées de validation peuvent utiliser la propriété CustomActionData pour récupérer l’ID de langue numérique.</span><span class="sxs-lookup"><span data-stu-id="7a204-122">Commit custom actions can use the CustomActionData property to get the numeric language ID.</span></span><br/>                                                                                                                                                                                                                                                           |
| [<span data-ttu-id="7a204-123">**MsiProcessMessage**</span><span class="sxs-lookup"><span data-stu-id="7a204-123">**MsiProcessMessage**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) | <span data-ttu-id="7a204-124">Traite les messages d’erreur ou de progression de l’action personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7a204-124">Processes error or progress messages from the custom action.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |



 

<span data-ttu-id="7a204-125">Une action personnalisée écrite en JScript ou VBScript requiert l’objet de [**session**](session-object.md) d’installation.</span><span class="sxs-lookup"><span data-stu-id="7a204-125">A custom action that is written in JScript or VBScript requires the install [**Session**](session-object.md) object.</span></span> <span data-ttu-id="7a204-126">Il s’agit de l' **objet de session** de type et le programme d’installation l’attache au script avec le nom « session ».</span><span class="sxs-lookup"><span data-stu-id="7a204-126">This is of the type **Session Object** and the installer attaches it to the script with the name "Session".</span></span> <span data-ttu-id="7a204-127">Étant donné que l’objet **session** n’existe peut-être pas lors d’une restauration de l’installation, une action personnalisée différée écrite dans le script doit utiliser l’une des méthodes ou propriétés suivantes de l’objet **session** pour récupérer son contexte.</span><span class="sxs-lookup"><span data-stu-id="7a204-127">Because the **Session** object may not exist during an installation rollback, a deferred custom action written in script must use one of the following methods or properties of the **Session** object to retrieve its context.</span></span>



| <span data-ttu-id="7a204-128">Nom</span><span class="sxs-lookup"><span data-stu-id="7a204-128">Name</span></span>                                                           | <span data-ttu-id="7a204-129">Description</span><span class="sxs-lookup"><span data-stu-id="7a204-129">Description</span></span>                                                                                                                        |
|----------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="7a204-130">**Mode (propriété)**</span><span class="sxs-lookup"><span data-stu-id="7a204-130">**Mode Property**</span></span>](session-mode.md)                          | <span data-ttu-id="7a204-131">Retourne la valeur true pour MSIRUNMODE \_ planifié uniquement.</span><span class="sxs-lookup"><span data-stu-id="7a204-131">Returns True for MSIRUNMODE\_SCHEDULED only.</span></span>                                                                                       |
| [<span data-ttu-id="7a204-132">**Propriété Property (objet session)**</span><span class="sxs-lookup"><span data-stu-id="7a204-132">**Property Property (Session Object)**</span></span>](session-session.md)  | <span data-ttu-id="7a204-133">Retourne la propriété CustomActionData, la propriété [**ProductCode**](productcode.md) ou la propriété [**UserSid**](usersid.md) .</span><span class="sxs-lookup"><span data-stu-id="7a204-133">Returns the CustomActionData property, [**ProductCode**](productcode.md) property, or [**UserSID**](usersid.md) property.</span></span>        |
| [<span data-ttu-id="7a204-134">**Propriété Language (objet session)**</span><span class="sxs-lookup"><span data-stu-id="7a204-134">**Language Property (Session Object)**</span></span>](session-language.md) | <span data-ttu-id="7a204-135">Retourne l’ID de langue numérique de la session d’installation.</span><span class="sxs-lookup"><span data-stu-id="7a204-135">Returns numeric language ID of the installation session.</span></span>                                                                           |
| [<span data-ttu-id="7a204-136">**Message, méthode**</span><span class="sxs-lookup"><span data-stu-id="7a204-136">**Message Method**</span></span>](session-message.md)                      | <span data-ttu-id="7a204-137">Appelé pour gérer les erreurs et la progression.</span><span class="sxs-lookup"><span data-stu-id="7a204-137">Called to handle errors and progress.</span></span>                                                                                              |
| [<span data-ttu-id="7a204-138">**Installer (propriété)**</span><span class="sxs-lookup"><span data-stu-id="7a204-138">**Installer Property**</span></span>](session-installer.md)                | <span data-ttu-id="7a204-139">Retourne l’objet parent, qui est utilisé pour les fonctions qui ne sont pas des sessions, telles que l’accès au registre et la gestion de la configuration du programme d’installation.</span><span class="sxs-lookup"><span data-stu-id="7a204-139">Returns the parent object, which is used for non-session functions such as registry access and installer configuration management.</span></span> |



 

<span data-ttu-id="7a204-140">Les valeurs de propriété qui sont définies au moment du traitement de la séquence d’installation dans le script peuvent ne pas être disponibles au moment de l’exécution du script.</span><span class="sxs-lookup"><span data-stu-id="7a204-140">Property values that are set at the time the installation sequence is processed into script may be unavailable at the time of script execution.</span></span> <span data-ttu-id="7a204-141">Seul l’ensemble de propriétés limité suivant est toujours accessible aux actions personnalisées pendant l’exécution du script.</span><span class="sxs-lookup"><span data-stu-id="7a204-141">Only the following limited set of properties is always accessible to custom actions during script execution.</span></span>



| <span data-ttu-id="7a204-142">Nom de la propriété</span><span class="sxs-lookup"><span data-stu-id="7a204-142">Property name</span></span>                      | <span data-ttu-id="7a204-143">Description</span><span class="sxs-lookup"><span data-stu-id="7a204-143">Description</span></span>                                                                                                                                                                                                     |
|------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="7a204-144">CustomActionData</span><span class="sxs-lookup"><span data-stu-id="7a204-144">CustomActionData</span></span>                   | <span data-ttu-id="7a204-145">Valeur au moment où l’action personnalisée est traitée dans la table de séquences.</span><span class="sxs-lookup"><span data-stu-id="7a204-145">Value at time custom action is processed in sequence table.</span></span> <span data-ttu-id="7a204-146">La propriété CustomActionData est uniquement disponible pour les actions personnalisées d’exécution différée.</span><span class="sxs-lookup"><span data-stu-id="7a204-146">The CustomActionData property is only available to deferred execution custom actions.</span></span> <span data-ttu-id="7a204-147">Les actions personnalisées immédiates n’ont pas accès à cette propriété.</span><span class="sxs-lookup"><span data-stu-id="7a204-147">Immediate custom actions do not have access to this property.</span></span> |
| [<span data-ttu-id="7a204-148">**ProductCode**</span><span class="sxs-lookup"><span data-stu-id="7a204-148">**ProductCode**</span></span>](productcode.md) | <span data-ttu-id="7a204-149">Code unique du produit, une chaîne [GUID](guid.md) .</span><span class="sxs-lookup"><span data-stu-id="7a204-149">Unique code for the product, a [GUID](guid.md) string.</span></span>                                                                                                                                                         |
| [<span data-ttu-id="7a204-150">**UserSID**</span><span class="sxs-lookup"><span data-stu-id="7a204-150">**UserSID**</span></span>](usersid.md)         | <span data-ttu-id="7a204-151">Défini par le programme d’installation sur l’identificateur de sécurité (SID) de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7a204-151">Set by the installer to the user's security identifier (SID).</span></span>                                                                                                                                                   |



 

<span data-ttu-id="7a204-152">Si d’autres données de propriété sont requises par l’action personnalisée d’exécution différée, leurs valeurs doivent être stockées dans le script d’installation.</span><span class="sxs-lookup"><span data-stu-id="7a204-152">If other property data is required by the deferred execution custom action, then their values must be stored in the installation script.</span></span> <span data-ttu-id="7a204-153">Pour ce faire, vous pouvez utiliser une deuxième action personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7a204-153">This can be done by using a second custom action.</span></span>

<span data-ttu-id="7a204-154">**Pour écrire la valeur d’une propriété dans le script d’installation à utiliser pendant une action personnalisée d’exécution différée**</span><span class="sxs-lookup"><span data-stu-id="7a204-154">**To write the value of a property into the installation script for use during a deferred execution custom action**</span></span>

1.  <span data-ttu-id="7a204-155">Insérez une petite action personnalisée dans la séquence d’installation qui définit la propriété d’intérêt pour une propriété portant le même nom que l’action personnalisée d’exécution différée.</span><span class="sxs-lookup"><span data-stu-id="7a204-155">Insert a small custom action into the installation sequence that sets the property of interest to a property having the same name as the deferred execution custom action.</span></span> <span data-ttu-id="7a204-156">Par exemple, si la clé primaire de l’action personnalisée d’exécution différée est « MyAction », définissez une propriété nommée « MyAction » sur la propriété X que vous devez récupérer.</span><span class="sxs-lookup"><span data-stu-id="7a204-156">For example, if the primary key for the deferred execution custom action is "MyAction" set a property named "MyAction" to the property X which you need to retrieve.</span></span> <span data-ttu-id="7a204-157">Vous devez définir la propriété « MyAction » dans la séquence d’installation avant l’action personnalisée « MyAction ».</span><span class="sxs-lookup"><span data-stu-id="7a204-157">You must set the "MyAction" property in the installation sequence before the "MyAction" custom action.</span></span> <span data-ttu-id="7a204-158">Bien que tout type d’action personnalisée puisse définir les données de contexte, la méthode la plus simple consiste à utiliser une action personnalisée d’assignation de propriété (par exemple, le [type d’action personnalisé 51](custom-action-type-51.md)).</span><span class="sxs-lookup"><span data-stu-id="7a204-158">Although any type of custom action can set the context data, the simplest method is to use a property assignment custom action (for example [Custom Action Type 51](custom-action-type-51.md)).</span></span>
2.  <span data-ttu-id="7a204-159">Au moment où la séquence d’installation est traitée, le programme d’installation écrit la valeur de la propriété X dans le script d’exécution comme valeur de la propriété CustomActionData.</span><span class="sxs-lookup"><span data-stu-id="7a204-159">At the time when the installation sequence is processed, the installer will write the value of property X into the execution script as the value of the property CustomActionData.</span></span>

## <a name="related-topics"></a><span data-ttu-id="7a204-160">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="7a204-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7a204-161">À propos des propriétés</span><span class="sxs-lookup"><span data-stu-id="7a204-161">About Properties</span></span>](about-properties.md)
</dt> <dt>

[<span data-ttu-id="7a204-162">Utilisation de propriétés</span><span class="sxs-lookup"><span data-stu-id="7a204-162">Using Properties</span></span>](using-properties.md)
</dt> <dt>

[<span data-ttu-id="7a204-163">Référence de propriété</span><span class="sxs-lookup"><span data-stu-id="7a204-163">Property Reference</span></span>](property-reference.md)
</dt> </dl>

 

 




