---
description: Quand le programme d’installation traite le script d’installation, il génère simultanément un script de restauration.
ms.assetid: 5b9bfc5a-6a78-4b0e-aed8-f25aba089af1
title: Restaurer les actions personnalisées
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c4ad91f8f94145399d51ed2ef53999ab0a91d65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103863541"
---
# <a name="rollback-custom-actions"></a><span data-ttu-id="99464-103">Restaurer les actions personnalisées</span><span class="sxs-lookup"><span data-stu-id="99464-103">Rollback Custom Actions</span></span>

<span data-ttu-id="99464-104">Quand le programme d’installation traite le script d’installation, il génère simultanément un script de restauration.</span><span class="sxs-lookup"><span data-stu-id="99464-104">When the installer processes the installation script, it simultaneously generates a rollback script.</span></span> <span data-ttu-id="99464-105">En plus du script de restauration, le programme d’installation enregistre une copie de chaque fichier qu’il supprime pendant l’installation.</span><span class="sxs-lookup"><span data-stu-id="99464-105">In addition to the rollback script, the installer saves a copy of every file it deletes during the installation.</span></span> <span data-ttu-id="99464-106">Ces fichiers sont conservés dans un répertoire système caché.</span><span class="sxs-lookup"><span data-stu-id="99464-106">These files are kept in a hidden system directory.</span></span> <span data-ttu-id="99464-107">Une fois l’installation terminée, le script de restauration et les fichiers enregistrés sont supprimés.</span><span class="sxs-lookup"><span data-stu-id="99464-107">Once the installation is complete, the rollback script and the saved files are deleted.</span></span> <span data-ttu-id="99464-108">Si une installation échoue, le programme d’installation tente de restaurer les modifications apportées lors de l’installation et de restaurer l’état d’origine de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="99464-108">If an installation is unsuccessful, the installer attempts to rollback the changes made during the installation and restore the original state of the computer.</span></span>

<span data-ttu-id="99464-109">Bien que les actions personnalisées qui planifient des opérations système en insérant des lignes dans la table de base de données soient inversées par une restauration de l’installation, les actions personnalisées qui modifient directement le système ou qui émettent des commandes vers d’autres services système ne peuvent pas toujours être inversées par une restauration.</span><span class="sxs-lookup"><span data-stu-id="99464-109">Although custom actions that schedule system operations by inserting rows into database table are reversed by a rollback of the installation, custom actions that change the system directly, or that issue commands to other system services, cannot always be reversed by a rollback.</span></span> <span data-ttu-id="99464-110">Une action personnalisée de restauration est une action exécutée par le programme d’installation uniquement pendant une restauration de l’installation. son objectif est d’inverser une action personnalisée qui a apporté des modifications au système.</span><span class="sxs-lookup"><span data-stu-id="99464-110">A rollback custom action is an action that the installer executes only during an installation rollback, and its purpose is to reverse a custom action that has made changes to the system.</span></span>

<span data-ttu-id="99464-111">Une action personnalisée de restauration est un type d' [action personnalisée d’exécution différée](deferred-execution-custom-actions.md), car son exécution est différée lorsqu’elle est appelée pendant la séquence d’installation.</span><span class="sxs-lookup"><span data-stu-id="99464-111">A rollback custom action is a type of [deferred execution custom action](deferred-execution-custom-actions.md), because its execution is deferred when it is invoked during the installation sequence.</span></span> <span data-ttu-id="99464-112">Elle diffère d’une action personnalisée différée standard en ce qu’elle n’est exécutée qu’au cours d’une restauration.</span><span class="sxs-lookup"><span data-stu-id="99464-112">It differs from a regular deferred custom action in that it is only executed during a rollback.</span></span> <span data-ttu-id="99464-113">Une action personnalisée de restauration doit toujours précéder l’action personnalisée différée, elle est restaurée dans la séquence d’action.</span><span class="sxs-lookup"><span data-stu-id="99464-113">A rollback custom action must always precede the deferred custom action it rolls back in the action sequence.</span></span> <span data-ttu-id="99464-114">Une action personnalisée de restauration doit également gérer le cas où l’action personnalisée différée est interrompue au milieu de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="99464-114">A rollback custom action should also handle the case where the deferred custom action is interrupted in the middle of execution.</span></span> <span data-ttu-id="99464-115">Par exemple, si l’utilisateur appuie sur le bouton Annuler pendant l’exécution de l’action personnalisée.</span><span class="sxs-lookup"><span data-stu-id="99464-115">For example, if the user were to press the Cancel button while the custom action was executing.</span></span>

<span data-ttu-id="99464-116">Notez que les actions personnalisées Rollback ne peuvent pas s’exécuter de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="99464-116">Note that Rollback Custom Actions cannot run asynchronously.</span></span> <span data-ttu-id="99464-117">Consultez [actions personnalisées synchrones et asynchrones](synchronous-and-asynchronous-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="99464-117">See [Synchronous and Asynchronous Custom Actions](synchronous-and-asynchronous-custom-actions.md).</span></span>

<span data-ttu-id="99464-118">Le complément à une action personnalisée de restauration est une [action personnalisée de validation](commit-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="99464-118">The complement to a rollback custom action is a [commit custom action](commit-custom-actions.md).</span></span> <span data-ttu-id="99464-119">Le programme d’installation exécute une action personnalisée de validation pendant la séquence d’installation, copie l’action personnalisée dans le script de restauration, mais n’exécute pas l’action pendant la restauration.</span><span class="sxs-lookup"><span data-stu-id="99464-119">The installer executes a commit custom action during the installation sequence, copies the custom action into the rollback script, but does not execute the action during rollback.</span></span>

<span data-ttu-id="99464-120">Notez qu’une action personnalisée de restauration peut ne pas être en mesure de supprimer toutes les modifications apportées par les actions personnalisées de validation.</span><span class="sxs-lookup"><span data-stu-id="99464-120">Note that a rollback custom action may not be able to remove all of the changes made by commit custom actions.</span></span> <span data-ttu-id="99464-121">Bien que le programme d’installation écrit à la fois les actions personnalisées Rollback et Commit dans le script de restauration, les actions personnalisées commit ne s’exécutent qu’une fois que le programme d’installation a traité avec succès le script d’installation.</span><span class="sxs-lookup"><span data-stu-id="99464-121">Although the installer writes both rollback and commit custom actions into the rollback script, commit custom actions only run after the installer has successfully processed the installation script.</span></span> <span data-ttu-id="99464-122">Les actions personnalisées de validation sont les premières actions à exécuter dans le script de restauration.</span><span class="sxs-lookup"><span data-stu-id="99464-122">Commit custom actions are the first actions to run in the rollback script.</span></span> <span data-ttu-id="99464-123">Si une action personnalisée de validation échoue, le programme d’installation lance la restauration, mais ne peut restaurer que les opérations déjà écrites dans le script de restauration.</span><span class="sxs-lookup"><span data-stu-id="99464-123">If a commit custom action fails, the installer initiates rollback but can only rollback those operations already written to the rollback script.</span></span> <span data-ttu-id="99464-124">Cela signifie que, selon l’action personnalisée de validation, une restauration peut ne pas être en mesure d’annuler les modifications apportées par l’action.</span><span class="sxs-lookup"><span data-stu-id="99464-124">This means that depending on the commit custom action, a rollback may not be able to undo the changes made by the action.</span></span> <span data-ttu-id="99464-125">Vous pouvez ignorer les échecs dans les actions personnalisées de validation en créant l’action personnalisée afin d’ignorer les codes de retour.</span><span class="sxs-lookup"><span data-stu-id="99464-125">You can ignore failures in commit custom actions by authoring the custom action to ignore return codes.</span></span>

<span data-ttu-id="99464-126">Quand le programme d’installation exécute une action personnalisée de restauration, le seul paramètre de mode qu’il définit est MSIRUNMODE \_ Rollback.</span><span class="sxs-lookup"><span data-stu-id="99464-126">When the installer runs a rollback custom action, the only mode parameter it will set is MSIRUNMODE\_ROLLBACK.</span></span> <span data-ttu-id="99464-127">Pour obtenir une description des paramètres du mode d’exécution, consultez [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) .</span><span class="sxs-lookup"><span data-stu-id="99464-127">See [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) for a description of the run mode parameters.</span></span>

<span data-ttu-id="99464-128">Vous pouvez spécifier une action de restauration personnalisée en ajoutant un indicateur d’option au champ type de la [table CustomAction](customaction-table.md).</span><span class="sxs-lookup"><span data-stu-id="99464-128">A rollback custom action can be specified by adding an option flag to the Type field of the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="99464-129">Consultez [action personnalisée In-Script les options d’exécution](custom-action-in-script-execution-options.md) pour l’indicateur d’option désignant une action personnalisée de restauration.</span><span class="sxs-lookup"><span data-stu-id="99464-129">See [Custom Action In-Script Execution Options](custom-action-in-script-execution-options.md) for the option flag designating a rollback custom action.</span></span>

<span data-ttu-id="99464-130">Les actions personnalisées de restauration et de validation ne s’exécutent pas lorsque la restauration est désactivée.</span><span class="sxs-lookup"><span data-stu-id="99464-130">Rollback and commit custom actions do not run when rollback is disabled.</span></span> <span data-ttu-id="99464-131">Si un auteur de package requiert ces types d’actions personnalisées pour une installation correcte, il doit utiliser la propriété [**RollbackDisabled**](rollbackdisabled.md) dans une condition qui empêche l’installation de se poursuivre lorsque la restauration est désactivée.</span><span class="sxs-lookup"><span data-stu-id="99464-131">If a package author requires these types of custom actions for proper installation, they should use the [**RollbackDisabled**](rollbackdisabled.md) property in a condition that prevents the installation from continuing when rollback is disabled.</span></span> <span data-ttu-id="99464-132">Pour plus d’informations sur la désactivation de la restauration [, consultez restauration de l’installation (Windows Installer)](rollback-installation.md).</span><span class="sxs-lookup"><span data-stu-id="99464-132">For information on how to disable rollback see [Rollback Installation (Windows Installer)](rollback-installation.md).</span></span>

 

 



