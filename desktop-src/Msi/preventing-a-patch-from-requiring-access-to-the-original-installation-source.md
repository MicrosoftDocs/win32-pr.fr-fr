---
description: Il n’est pas possible d’éliminer toutes les circonstances dans lesquelles l’application d’un correctif peut nécessiter l’accès à la source d’installation d’origine.
ms.assetid: f7028c55-e4a5-4596-af7a-728c9f4f367e
title: Empêcher un correctif d’avoir accès à la source d’installation d’origine
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: baee8b261ff0a3f6bb94fb141ee765726ffa2ced
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103864386"
---
# <a name="preventing-a-patch-from-requiring-access-to-the-original-installation-source"></a><span data-ttu-id="00f35-103">Empêcher un correctif d’avoir accès à la source d’installation d’origine</span><span class="sxs-lookup"><span data-stu-id="00f35-103">Preventing a Patch from Requiring Access to the Original Installation Source</span></span>

<span data-ttu-id="00f35-104">Il n’est pas possible d’éliminer toutes les circonstances dans lesquelles l’application d’un correctif peut nécessiter l’accès à la source d’installation d’origine.</span><span class="sxs-lookup"><span data-stu-id="00f35-104">It is not possible to eliminate all circumstances under which the application of a patch may require access to the original installation source.</span></span>

<span data-ttu-id="00f35-105">Respectez les points suivants pour réduire la possibilité que votre correctif nécessite l’accès à la source d’origine :</span><span class="sxs-lookup"><span data-stu-id="00f35-105">Adhere to following points to minimize the possibility that your patch will require access to the original source:</span></span>

-   <span data-ttu-id="00f35-106">Utilisez uniquement des correctifs de fichiers complets.</span><span class="sxs-lookup"><span data-stu-id="00f35-106">Use whole-file only patches.</span></span> <span data-ttu-id="00f35-107">Cela élimine la nécessité de créer des correctifs binaires pour toutes les versions antérieures du fichier.</span><span class="sxs-lookup"><span data-stu-id="00f35-107">This eliminates the need to create binary patches for all previously released versions of the file.</span></span> <span data-ttu-id="00f35-108">Notez que les correctifs de fichiers entiers ont généralement une taille supérieure à celle des correctifs binaires.</span><span class="sxs-lookup"><span data-stu-id="00f35-108">Note that whole file patches are generally larger in size than binary patches.</span></span> <span data-ttu-id="00f35-109">Vous pouvez facilement définir un patch en tant que correctif de fichier complet en créant la propriété IncludeWholeFilesOnly avec la valeur 1 (un) dans le fichier des propriétés de création de correctif (PCP).</span><span class="sxs-lookup"><span data-stu-id="00f35-109">You can easily set a patch to be a whole file patch by authoring the IncludeWholeFilesOnly property with a value of 1 (one) in the Patch Creation Properties (PCP) file.</span></span>
-   <span data-ttu-id="00f35-110">Assurez-vous qu’aucune de vos actions personnalisées n’accède à l’emplacement source d’origine.</span><span class="sxs-lookup"><span data-stu-id="00f35-110">Ensure that none of your custom actions access the original source location.</span></span>
-   <span data-ttu-id="00f35-111">Assurez-vous que l’action ResolveSource est soumise à une condition de manière à ce qu’elle s’exécute uniquement si nécessaire ou qu’elle n’est pas présente du tout.</span><span class="sxs-lookup"><span data-stu-id="00f35-111">Ensure that the ResolveSource action is conditionalized so that it only runs when needed, or alternatively is not present at all.</span></span>
-   <span data-ttu-id="00f35-112">Remplissez la [table MsiFileHash](msifilehash-table.md) pour tous les fichiers dont la version n’est pas distante.</span><span class="sxs-lookup"><span data-stu-id="00f35-112">Populate the [MsiFileHash Table](msifilehash-table.md) for all unversioned files.</span></span> <span data-ttu-id="00f35-113">L’outil du kit de développement logiciel (SDK) Windows Installer, Msifiler.exe, peut facilement le faire pour vous.</span><span class="sxs-lookup"><span data-stu-id="00f35-113">The Windows Installer SDK tool, Msifiler.exe, can easily do this for you.</span></span>
-   <span data-ttu-id="00f35-114">Vérifiez que les informations de version et de langue de tous les fichiers sont correctes.</span><span class="sxs-lookup"><span data-stu-id="00f35-114">Ensure that all files have the correct version and language information.</span></span> <span data-ttu-id="00f35-115">L’outil du kit de développement logiciel (SDK) Windows Installer, Msifiler.exe, peut facilement le faire pour vous.</span><span class="sxs-lookup"><span data-stu-id="00f35-115">The Windows Installer SDK tool, Msifiler.exe, can easily do this for you.</span></span>

## <a name="source-requirements-when-patching"></a><span data-ttu-id="00f35-116">Configuration requise pour la mise à jour corrective</span><span class="sxs-lookup"><span data-stu-id="00f35-116">Source Requirements When Patching</span></span>

<span data-ttu-id="00f35-117">L’accès aux sources d’installation d’origine peut être nécessaire pour appliquer le correctif dans les cas suivants :</span><span class="sxs-lookup"><span data-stu-id="00f35-117">Access to the original installation sources may be required to apply the patch in the following cases:</span></span>

-   <span data-ttu-id="00f35-118">Le correctif s’applique à une fonctionnalité qui est actuellement exécutée à partir de la source.</span><span class="sxs-lookup"><span data-stu-id="00f35-118">The patch applies to a feature that is currently run from source.</span></span> <span data-ttu-id="00f35-119">Dans ce cas, la fonctionnalité passe de l’état d’exécution à partir de la source à l’état local.</span><span class="sxs-lookup"><span data-stu-id="00f35-119">In this case, the feature is transitioned from the run-from-source state to the local state.</span></span>
-   <span data-ttu-id="00f35-120">Le correctif s’applique à un composant pour lequel un fichier est manquant ou endommagé.</span><span class="sxs-lookup"><span data-stu-id="00f35-120">The patch applies to a component that has a missing or corrupted file.</span></span>
-   <span data-ttu-id="00f35-121">Le correctif s’applique à un fichier dans un composant qui contient également des fichiers sans version sans aucune entrée MsiFileHash.</span><span class="sxs-lookup"><span data-stu-id="00f35-121">The patch applies to a file in a component that also contains unversioned files with no MsiFileHash entries.</span></span> <span data-ttu-id="00f35-122">Une [table MsiFileHash](msifilehash-table.md) remplie est requise pour empêcher la recopie inutile de fichiers non distants à partir de l’emplacement source.</span><span class="sxs-lookup"><span data-stu-id="00f35-122">A populated [MsiFileHash Table](msifilehash-table.md) is required to prevent unnecessary recopying of unversioned files from the source location.</span></span>
-   <span data-ttu-id="00f35-123">Le correctif a été appliqué avec un REINSTALLMODE de amuser ou d’Emu.</span><span class="sxs-lookup"><span data-stu-id="00f35-123">The patch was applied with a REINSTALLMODE of amus or emus.</span></span> <span data-ttu-id="00f35-124">Cette option est dangereuse en ce qu’elle effectue des opérations de copie de fichiers, quelle que soit la version du fichier.</span><span class="sxs-lookup"><span data-stu-id="00f35-124">This option is dangerous in that it performs file copy operations regardless of file version.</span></span> <span data-ttu-id="00f35-125">Cela peut entraîner un reving des fichiers et nécessite presque toujours la source.</span><span class="sxs-lookup"><span data-stu-id="00f35-125">This can lead to down-reving of files and almost always requires the source.</span></span> <span data-ttu-id="00f35-126">La valeur REINSTALLMODE recommandée est omus.</span><span class="sxs-lookup"><span data-stu-id="00f35-126">The recommended REINSTALLMODE value is omus.</span></span>
-   <span data-ttu-id="00f35-127">Le package mis en cache pour le produit est manquant.</span><span class="sxs-lookup"><span data-stu-id="00f35-127">The cached package for the product is missing.</span></span> <span data-ttu-id="00f35-128">Le package mis en cache est nécessaire pour l’application d’un correctif.</span><span class="sxs-lookup"><span data-stu-id="00f35-128">The cached package is needed for application of a patch.</span></span> <span data-ttu-id="00f35-129">Le package mis en cache est stocké dans le dossier% windir% \\ installer.</span><span class="sxs-lookup"><span data-stu-id="00f35-129">The cached package is stored in the %windir%\\Installer folder.</span></span>
-   <span data-ttu-id="00f35-130">Le package est créé pour appeler l' [action ResolveSource](resolvesource-action.md).</span><span class="sxs-lookup"><span data-stu-id="00f35-130">The package is authored to make a call to the [ResolveSource Action](resolvesource-action.md).</span></span> <span data-ttu-id="00f35-131">En général, cette action doit être évitée ou conditionnellement, car son exécution donne toujours accès à la source.</span><span class="sxs-lookup"><span data-stu-id="00f35-131">This action should generally be avoided or conditionalized appropriately, because its execution always results in an access to the source.</span></span>
-   <span data-ttu-id="00f35-132">Le package a une action personnalisée qui tente d’accéder à la source d’une certaine manière.</span><span class="sxs-lookup"><span data-stu-id="00f35-132">The package has a custom action that attempts to access the source in some manner.</span></span> <span data-ttu-id="00f35-133">L’exemple le plus courant est une action personnalisée d’installation simultanée de type 23.</span><span class="sxs-lookup"><span data-stu-id="00f35-133">The most common example is a type 23 concurrent installation custom action.</span></span>
    > [!Note]  
    > <span data-ttu-id="00f35-134">Les installations simultanées ne sont pas recommandées pour l’installation d’applications destinées à être communiquées au public.</span><span class="sxs-lookup"><span data-stu-id="00f35-134">Concurrent installations are not recommended for the installation of applications intended for release to the public.</span></span> <span data-ttu-id="00f35-135">Pour plus d’informations sur les installations simultanées, consultez [installations simultanées](concurrent-installations.md).</span><span class="sxs-lookup"><span data-stu-id="00f35-135">For information about concurrent installations please see [Concurrent Installations](concurrent-installations.md).</span></span>

     

-   <span data-ttu-id="00f35-136">Le package de correctifs se compose de correctifs binaires qui ne s’appliquent pas à la version actuelle du fichier sur l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="00f35-136">The patch package consists of binary patches that do not apply to the current version of the file on the computer.</span></span>

<span data-ttu-id="00f35-137">Prenons l’exemple suivant, dans lequel Windows Installer nécessite l’accès à la source d’origine lors de l’application d’un correctif :</span><span class="sxs-lookup"><span data-stu-id="00f35-137">Consider the following example where Windows Installer requires access to the original source when applying a patch:</span></span>

1.  <span data-ttu-id="00f35-138">Installez la version RTM de l’exemple de produit.</span><span class="sxs-lookup"><span data-stu-id="00f35-138">Install RTM version of the product Example.</span></span>
2.  <span data-ttu-id="00f35-139">Appliquez le correctif Qfe1. msp à l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="00f35-139">Apply patch Qfe1.msp to the computer.</span></span> <span data-ttu-id="00f35-140">Cette version de patch 1,0 de Example.dll à la version 1,1.</span><span class="sxs-lookup"><span data-stu-id="00f35-140">This patches version 1.0 of Example.dll to version 1.1.</span></span>
3.  <span data-ttu-id="00f35-141">Un nouveau correctif, Qfe2. msp, est fourni, qui met à jour Example.dll vers la version 1,2 et obsolètes Qfe1. msp.</span><span class="sxs-lookup"><span data-stu-id="00f35-141">A new patch, Qfe2.msp is provided, which updates Example.dll to version 1.2 and obsoletes Qfe1.msp.</span></span> <span data-ttu-id="00f35-142">Toutefois, le correctif a été créé uniquement pour cibler la version 1,0 de Example.dll, car il a été généré à l’aide de la version RTM du produit.</span><span class="sxs-lookup"><span data-stu-id="00f35-142">However, the patch was only created to target version 1.0 of Example.dll because it was generated using the RTM version of the product.</span></span> <span data-ttu-id="00f35-143">Example.dll version 1,2 comprend le correctif contenu dans Example.dll version 1,1, mais le fichier. msp a été généré entre les images RTM et QFE2.</span><span class="sxs-lookup"><span data-stu-id="00f35-143">Example.dll version 1.2 includes the fix contained in Example.dll version 1.1, but the .msp file was generated between the RTM and QFE2 images.</span></span> <span data-ttu-id="00f35-144">Ainsi, quand Qfe2. msp est appliqué à l’ordinateur, Windows Installer doit accéder à la source d’origine.</span><span class="sxs-lookup"><span data-stu-id="00f35-144">So, when Qfe2.msp is applied to the computer, Windows Installer needs to access the original source.</span></span> <span data-ttu-id="00f35-145">Le correctif binaire pour Example.dll ne peut pas s’appliquer à la version 1,1 ; elle ne peut s’appliquer qu’à la version 1,0.</span><span class="sxs-lookup"><span data-stu-id="00f35-145">The binary patch for Example.dll cannot apply to version 1.1; it can only apply to version 1.0.</span></span> <span data-ttu-id="00f35-146">Ainsi, le programme d’installation recopie la version 1,0 de Example.dll à partir de l’emplacement source d’origine afin que le correctif puisse être appliqué avec succès.</span><span class="sxs-lookup"><span data-stu-id="00f35-146">This results in the Installer recopying version 1.0 of Example.dll from the original source location so that the patch can be applied successfully.</span></span>

## <a name="source-requirements-when-removing-a-patch"></a><span data-ttu-id="00f35-147">Spécifications de la source lors de la suppression d’un correctif</span><span class="sxs-lookup"><span data-stu-id="00f35-147">Source Requirements When Removing a Patch</span></span>

<span data-ttu-id="00f35-148">L’accès aux sources d’installation d’origine peut être nécessaire pour supprimer un correctif si le Windows Installer n’a pas stocké les informations de référence sur le correctif.</span><span class="sxs-lookup"><span data-stu-id="00f35-148">Access to the original installation sources may be required to remove a patch if the Windows Installer has not stored baseline information about the patch.</span></span> <span data-ttu-id="00f35-149">À partir de Windows Installer 3,0, le programme d’installation enregistre de manière sélective les informations de référence sur les fichiers lorsqu’ils sont mis à jour.</span><span class="sxs-lookup"><span data-stu-id="00f35-149">Beginning with Windows Installer 3.0, the installer selectively saves baseline information about files when they are updated.</span></span> <span data-ttu-id="00f35-150">Pour plus d’informations sur le cache de base, consultez réduction de la [taille des correctifs](reducing-patch-size.md) .</span><span class="sxs-lookup"><span data-stu-id="00f35-150">For more information about the baseline cache, see [Reducing Patch Size](reducing-patch-size.md) .</span></span>

 

 



