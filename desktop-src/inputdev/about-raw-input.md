---
title: À propos des entrées brutes
description: Cette rubrique décrit les entrées utilisateur à partir d’appareils tels que les manettes, les écrans tactiles et les microphones.
ms.assetid: 013ed309-f667-47ed-ade0-5e7ca5a0997a
keywords:
- entrée d’utilisateur, entrée brute
- capture de l’entrée utilisateur, entrée brute
- entrée brute
- inscription d’une entrée brute
- lecture d’une entrée brute
- entrée brute de manette de jeu
- entrée brute de l’écran tactile
- entrée de microphone RAW
- Périphérique d’interface utilisateur (HID)
- HID (périphérique d’interface utilisateur)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b3535e5601ec63a254c76060611999a1a2f08aeb
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104031233"
---
# <a name="about-raw-input"></a><span data-ttu-id="ae98f-113">À propos des entrées brutes</span><span class="sxs-lookup"><span data-stu-id="ae98f-113">About Raw Input</span></span>

<span data-ttu-id="ae98f-114">Il existe de nombreux périphériques d’entrée utilisateur à côté du clavier et de la souris traditionnels.</span><span class="sxs-lookup"><span data-stu-id="ae98f-114">There are many user-input devices beside the traditional keyboard and mouse.</span></span> <span data-ttu-id="ae98f-115">Par exemple, l’entrée d’utilisateur peut provenir d’une manette de jeu, d’un écran tactile, d’un microphone ou d’autres périphériques qui offrent une grande flexibilité en entrée d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ae98f-115">For example, user input can come from a joystick, a touch screen, a microphone, or other devices that allow great flexibility in user input.</span></span> <span data-ttu-id="ae98f-116">Ces appareils sont collectivement appelés périphériques d’interface utilisateur (HIDs).</span><span class="sxs-lookup"><span data-stu-id="ae98f-116">These devices are collectively known as Human Interface Devices (HIDs).</span></span> <span data-ttu-id="ae98f-117">L’API d’entrée brute offre un moyen stable et fiable pour les applications d’accepter une entrée brute à partir de n’importe quel HID, y compris le clavier et la souris.</span><span class="sxs-lookup"><span data-stu-id="ae98f-117">The raw input API provides a stable and robust way for applications to accept raw input from any HID, including the keyboard and mouse.</span></span>

<span data-ttu-id="ae98f-118">Cette section couvre les sujets suivants :</span><span class="sxs-lookup"><span data-stu-id="ae98f-118">This section covers the following topics:</span></span>

-   [<span data-ttu-id="ae98f-119">Modèle d’entrée brut</span><span class="sxs-lookup"><span data-stu-id="ae98f-119">Raw Input Model</span></span>](#raw-input-model)
-   [<span data-ttu-id="ae98f-120">Inscription pour une entrée brute</span><span class="sxs-lookup"><span data-stu-id="ae98f-120">Registration for Raw Input</span></span>](#registration-for-raw-input)
-   [<span data-ttu-id="ae98f-121">Lecture d’une entrée brute</span><span class="sxs-lookup"><span data-stu-id="ae98f-121">Reading Raw Input</span></span>](#reading-raw-input)

## <a name="raw-input-model"></a><span data-ttu-id="ae98f-122">Modèle d’entrée brut</span><span class="sxs-lookup"><span data-stu-id="ae98f-122">Raw Input Model</span></span>

<span data-ttu-id="ae98f-123">Auparavant, le clavier et la souris généraient généralement des données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="ae98f-123">Previously, the keyboard and mouse typically generated input data.</span></span> <span data-ttu-id="ae98f-124">Le système a interprété les données provenant de ces appareils de manière à éliminer les détails spécifiques au périphérique des informations brutes.</span><span class="sxs-lookup"><span data-stu-id="ae98f-124">The system interpreted the data coming from these devices in a way that eliminated the device-specific details of the raw information.</span></span> <span data-ttu-id="ae98f-125">Par exemple, le clavier génère le code d’analyse spécifique à l’appareil, mais le système fournit une application avec le code de la touche virtuelle.</span><span class="sxs-lookup"><span data-stu-id="ae98f-125">For example, the keyboard generates the device-specific scan code but the system provides an application with the virtual key code.</span></span> <span data-ttu-id="ae98f-126">En plus de masquer les détails de l’entrée brute, le gestionnaire de fenêtres ne prenait pas en charge tous les nouveaux HIDs.</span><span class="sxs-lookup"><span data-stu-id="ae98f-126">Besides hiding the details of the raw input, the window manager did not support all the new HIDs.</span></span> <span data-ttu-id="ae98f-127">Pour obtenir une entrée du HIDs non pris en charge, une application doit effectuer de nombreuses opérations : ouvrir l’appareil, gérer le mode partagé, lire régulièrement l’appareil ou configurer le port de terminaison d’e/s, etc.</span><span class="sxs-lookup"><span data-stu-id="ae98f-127">To get input from the unsupported HIDs, an application had to do many things: open the device, manage the shared mode, periodically read the device or set up the I/O completion port, and so forth.</span></span> <span data-ttu-id="ae98f-128">Le modèle d’entrée brut et les API associées ont été développés pour permettre un accès simple aux entrées brutes à partir de tous les périphériques d’entrée, y compris le clavier et la souris.</span><span class="sxs-lookup"><span data-stu-id="ae98f-128">The raw input model and the associated APIs were developed to allow simple access to raw input from all input devices, including the keyboard and mouse.</span></span>

<span data-ttu-id="ae98f-129">Le modèle d’entrée brut est différent du modèle d’entrée Windows d’origine pour le clavier et la souris.</span><span class="sxs-lookup"><span data-stu-id="ae98f-129">The raw input model is different from the original Windows input model for the keyboard and mouse.</span></span> <span data-ttu-id="ae98f-130">Dans le modèle d’entrée d’origine, une application reçoit une entrée indépendante du périphérique sous la forme de messages envoyés ou publiés dans son Windows, tels que [**WM \_ char**](wm-char.md), [**WM \_ MOUSEMOVE**](wm-mousemove.md)et [**WM \_ APPCOMMAND**](wm-appcommand.md).</span><span class="sxs-lookup"><span data-stu-id="ae98f-130">In the original input model, an application receives device-independent input in the form of messages that are sent or posted to its windows, such as [**WM\_CHAR**](wm-char.md), [**WM\_MOUSEMOVE**](wm-mousemove.md), and [**WM\_APPCOMMAND**](wm-appcommand.md).</span></span> <span data-ttu-id="ae98f-131">En revanche, pour les entrées brutes, une application doit inscrire les périphériques à partir desquels elle souhaite obtenir des données.</span><span class="sxs-lookup"><span data-stu-id="ae98f-131">In contrast, for raw input an application must register the devices it wants to get data from.</span></span> <span data-ttu-id="ae98f-132">En outre, l’application obtient l’entrée brute via le message [**\_ d’entrée WM**](wm-input.md) .</span><span class="sxs-lookup"><span data-stu-id="ae98f-132">Also, the application gets the raw input through the [**WM\_INPUT**](wm-input.md) message.</span></span>

<span data-ttu-id="ae98f-133">Le modèle d’entrée brut présente plusieurs avantages :</span><span class="sxs-lookup"><span data-stu-id="ae98f-133">There are several advantages to the raw input model:</span></span>

-   <span data-ttu-id="ae98f-134">Une application n’a pas besoin de détecter ni d’ouvrir le périphérique d’entrée.</span><span class="sxs-lookup"><span data-stu-id="ae98f-134">An application does not have to detect or open the input device.</span></span>
-   <span data-ttu-id="ae98f-135">Une application obtient les données directement à partir de l’appareil et traite les données en ce qui concerne leurs besoins.</span><span class="sxs-lookup"><span data-stu-id="ae98f-135">An application gets the data directly from the device, and processes the data for its needs.</span></span>
-   <span data-ttu-id="ae98f-136">Une application peut distinguer la source de l’entrée même si elle provient du même type de périphérique.</span><span class="sxs-lookup"><span data-stu-id="ae98f-136">An application can distinguish the source of the input even if it is from the same type of device.</span></span> <span data-ttu-id="ae98f-137">Par exemple, deux souris.</span><span class="sxs-lookup"><span data-stu-id="ae98f-137">For example, two mouse devices.</span></span>
-   <span data-ttu-id="ae98f-138">Une application gère le trafic de données en spécifiant des données à partir d’une collection de périphériques ou uniquement de types d’appareils spécifiques.</span><span class="sxs-lookup"><span data-stu-id="ae98f-138">An application manages the data traffic by specifying data from a collection of devices or only specific device types.</span></span>
-   <span data-ttu-id="ae98f-139">Les périphériques HID peuvent être utilisés lorsqu’ils sont disponibles sur la place de marché, sans attendre que de nouveaux types de messages ou un système d’exploitation mis à jour aient de nouvelles commandes dans [**WM \_ APPCOMMAND**](wm-appcommand.md).</span><span class="sxs-lookup"><span data-stu-id="ae98f-139">HID devices can be used as they become available in the marketplace, without waiting for new message types or an updated OS to have new commands in [**WM\_APPCOMMAND**](wm-appcommand.md).</span></span>

<span data-ttu-id="ae98f-140">Notez que le [**WM \_ APPCOMMAND**](wm-appcommand.md) fournit pour certains périphériques HID.</span><span class="sxs-lookup"><span data-stu-id="ae98f-140">Note that [**WM\_APPCOMMAND**](wm-appcommand.md) does provide for some HID devices.</span></span> <span data-ttu-id="ae98f-141">Toutefois, le **WM \_ APPCOMMAND** est un événement d’entrée indépendant du périphérique de niveau supérieur, tandis que l' [**\_ entrée WM**](wm-input.md) envoie des données brutes de niveau faible qui sont spécifiques à un appareil.</span><span class="sxs-lookup"><span data-stu-id="ae98f-141">However, **WM\_APPCOMMAND** is a higher level device-independent input event, while [**WM\_INPUT**](wm-input.md) sends raw, low level data that is specific to a device.</span></span>

## <a name="registration-for-raw-input"></a><span data-ttu-id="ae98f-142">Inscription pour une entrée brute</span><span class="sxs-lookup"><span data-stu-id="ae98f-142">Registration for Raw Input</span></span>

<span data-ttu-id="ae98f-143">Par défaut, aucune application ne reçoit d’entrée brute.</span><span class="sxs-lookup"><span data-stu-id="ae98f-143">By default, no application receives raw input.</span></span> <span data-ttu-id="ae98f-144">Pour recevoir une entrée brute d’un appareil, une application doit inscrire l’appareil.</span><span class="sxs-lookup"><span data-stu-id="ae98f-144">To receive raw input from a device, an application must register the device.</span></span>

<span data-ttu-id="ae98f-145">Pour inscrire des appareils, une application crée tout d’abord un tableau de structures [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice) qui spécifient la [collection de niveau supérieur](/windows-hardware/drivers/hid/top-level-collections) (CCM) pour les périphériques dont elle a besoin.</span><span class="sxs-lookup"><span data-stu-id="ae98f-145">To register devices, an application first creates an array of [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice) structures that specify the [top level collection](/windows-hardware/drivers/hid/top-level-collections) (TLC) for the devices it wants.</span></span> <span data-ttu-id="ae98f-146">La CCM est définie par une [page d’utilisation](/windows-hardware/drivers/hid/hid-usages#usage-page) (la classe de l’appareil) et un [ID d’utilisation](/windows-hardware/drivers/hid/hid-usages#usage-id) (l’appareil dans la classe).</span><span class="sxs-lookup"><span data-stu-id="ae98f-146">The TLC is defined by a [Usage Page](/windows-hardware/drivers/hid/hid-usages#usage-page) (the class of the device) and a [Usage ID](/windows-hardware/drivers/hid/hid-usages#usage-id) (the device within the class).</span></span> <span data-ttu-id="ae98f-147">Par exemple, pour obtenir le clavier CCM, définissez UsagePage = 0x01 et UsageID = 0x06.</span><span class="sxs-lookup"><span data-stu-id="ae98f-147">For example, to get the keyboard TLC, set UsagePage = 0x01 and UsageID = 0x06.</span></span> <span data-ttu-id="ae98f-148">L’application appelle [**RegisterRawInputDevices**](/windows/win32/api/winuser/nf-winuser-registerrawinputdevices) pour inscrire les appareils.</span><span class="sxs-lookup"><span data-stu-id="ae98f-148">The application calls [**RegisterRawInputDevices**](/windows/win32/api/winuser/nf-winuser-registerrawinputdevices) to register the devices.</span></span>

<span data-ttu-id="ae98f-149">Notez qu’une application peut inscrire un appareil qui n’est pas actuellement attaché au système.</span><span class="sxs-lookup"><span data-stu-id="ae98f-149">Note that an application can register a device that is not currently attached to the system.</span></span> <span data-ttu-id="ae98f-150">Lorsque cet appareil est attaché, le gestionnaire Windows envoie automatiquement l’entrée brute à l’application.</span><span class="sxs-lookup"><span data-stu-id="ae98f-150">When this device is attached, the Windows Manager will automatically send the raw input to the application.</span></span> <span data-ttu-id="ae98f-151">Pour récupérer la liste des périphériques d’entrée bruts sur le système, une application appelle [**GetRawInputDeviceList**](/windows/win32/api/winuser/nf-winuser-getrawinputdevicelist).</span><span class="sxs-lookup"><span data-stu-id="ae98f-151">To get the list of raw input devices on the system, an application calls [**GetRawInputDeviceList**](/windows/win32/api/winuser/nf-winuser-getrawinputdevicelist).</span></span> <span data-ttu-id="ae98f-152">À l’aide de *hDevice* à partir de cet appel, une application appelle [**GetRawInputDeviceInfo**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) pour récupérer les informations de l’appareil.</span><span class="sxs-lookup"><span data-stu-id="ae98f-152">Using the *hDevice* from this call, an application calls [**GetRawInputDeviceInfo**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) to get the device information.</span></span>

<span data-ttu-id="ae98f-153">Par le biais du membre **dwFlags** de [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice), une application peut sélectionner les appareils à écouter, ainsi que ceux qu’elle souhaite ignorer.</span><span class="sxs-lookup"><span data-stu-id="ae98f-153">Through the **dwFlags** member of [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice), an application can select the devices to listen to and also those it wants to ignore.</span></span> <span data-ttu-id="ae98f-154">Par exemple, une application peut demander une entrée à partir de tous les appareils de téléphonie, à l’exception des ordinateurs de réponse.</span><span class="sxs-lookup"><span data-stu-id="ae98f-154">For example, an application can ask for input from all telephony devices except for answering machines.</span></span> <span data-ttu-id="ae98f-155">Pour obtenir un exemple de code, consultez [inscription pour une entrée brute](using-raw-input.md).</span><span class="sxs-lookup"><span data-stu-id="ae98f-155">For sample code, see [Registering for Raw Input](using-raw-input.md).</span></span>

<span data-ttu-id="ae98f-156">Notez que la souris et le clavier sont également HID, donc les données qu’ils contiennent peuvent être transmises à la fois à l' [**\_ entrée WM**](wm-input.md) du message HID et à celles des messages classiques.</span><span class="sxs-lookup"><span data-stu-id="ae98f-156">Note that the mouse and the keyboard are also HIDs, so data from them can come through both the HID message [**WM\_INPUT**](wm-input.md) and from traditional messages.</span></span> <span data-ttu-id="ae98f-157">Une application peut sélectionner l’une ou l’autre méthode par la sélection appropriée des indicateurs dans [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice).</span><span class="sxs-lookup"><span data-stu-id="ae98f-157">An application can select either method by the proper selection of flags in [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice).</span></span>

<span data-ttu-id="ae98f-158">Pour connaître l’état d’inscription d’une application, appelez [**GetRegisteredRawInputDevices**](/windows/win32/api/winuser/nf-winuser-getregisteredrawinputdevices) à tout moment.</span><span class="sxs-lookup"><span data-stu-id="ae98f-158">To get an application's registration status, call [**GetRegisteredRawInputDevices**](/windows/win32/api/winuser/nf-winuser-getregisteredrawinputdevices) at any time.</span></span>

## <a name="reading-raw-input"></a><span data-ttu-id="ae98f-159">Lecture d’une entrée brute</span><span class="sxs-lookup"><span data-stu-id="ae98f-159">Reading Raw Input</span></span>

<span data-ttu-id="ae98f-160">Une application reçoit une entrée brute de tout HID dont la [collection de niveau supérieur](/windows-hardware/drivers/hid/top-level-collections) (CCM) correspond à un CCM de l’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="ae98f-160">An application receives raw input from any HID whose [top level collection](/windows-hardware/drivers/hid/top-level-collections) (TLC) matches a TLC from the registration.</span></span> <span data-ttu-id="ae98f-161">Lorsqu’une application reçoit une entrée brute, sa file d’attente de messages reçoit un message [**\_ d’entrée WM**](wm-input.md) et l’indicateur d’état de la file d’attente **QS \_ RAWINPUT** est défini (l'**\_ entrée QS** comprend également cet indicateur).</span><span class="sxs-lookup"><span data-stu-id="ae98f-161">When an application receives raw input, its message queue gets a [**WM\_INPUT**](wm-input.md) message and the queue status flag **QS\_RAWINPUT** is set (**QS\_INPUT** also includes this flag).</span></span> <span data-ttu-id="ae98f-162">Une application peut recevoir des données lorsqu’elle est au premier plan et lorsqu’elle est en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="ae98f-162">An application can receive data when it is in the foreground and when it is in the background.</span></span>

<span data-ttu-id="ae98f-163">Il existe deux façons de lire les données brutes : la méthode non mise en mémoire tampon (ou la méthode standard) et la méthode mise en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="ae98f-163">There are two ways to read the raw data: the unbuffered (or standard) method and the buffered method.</span></span> <span data-ttu-id="ae98f-164">La méthode unbufferd obtient les données brutes d’une structure [**RAWINPUT**](/windows/win32/api/winuser/ns-winuser-rawinput) à la fois et convient à de nombreux HIDS.</span><span class="sxs-lookup"><span data-stu-id="ae98f-164">The unbuffered method gets the raw data one [**RAWINPUT**](/windows/win32/api/winuser/ns-winuser-rawinput) structure at a time and is adequate for many HIDs.</span></span> <span data-ttu-id="ae98f-165">Ici, l’application appelle [**GetMessage**](/windows/desktop/api/winuser/nf-winuser-getmessage) pour recevoir le [**message \_ d’entrée WM**](wm-input.md) .</span><span class="sxs-lookup"><span data-stu-id="ae98f-165">Here, the application calls [**GetMessage**](/windows/desktop/api/winuser/nf-winuser-getmessage) to get the [**WM\_INPUT**](wm-input.md) message.</span></span> <span data-ttu-id="ae98f-166">L’application appelle ensuite [**GetRawInputData**](/windows/win32/api/winuser/nf-winuser-getrawinputdata) à l’aide du handle **RAWINPUT** contenu dans l' **\_ entrée WM**.</span><span class="sxs-lookup"><span data-stu-id="ae98f-166">Then the application calls [**GetRawInputData**](/windows/win32/api/winuser/nf-winuser-getrawinputdata) using the **RAWINPUT** handle contained in **WM\_INPUT**.</span></span> <span data-ttu-id="ae98f-167">Pour obtenir un exemple, consultez [réalisation d’une lecture standard d’une entrée brute](using-raw-input.md).</span><span class="sxs-lookup"><span data-stu-id="ae98f-167">For an example, see [Doing a Standard Read of Raw Input](using-raw-input.md).</span></span>

<span data-ttu-id="ae98f-168">En revanche, la méthode mise en mémoire tampon obtient un tableau de structures [**RAWINPUT**](/windows/win32/api/winuser/ns-winuser-rawinput) à la fois.</span><span class="sxs-lookup"><span data-stu-id="ae98f-168">In contrast, the buffered method gets an array of [**RAWINPUT**](/windows/win32/api/winuser/ns-winuser-rawinput) structures at a time.</span></span> <span data-ttu-id="ae98f-169">Elle est fournie pour les appareils qui peuvent générer de grandes quantités d’entrées brutes.</span><span class="sxs-lookup"><span data-stu-id="ae98f-169">This is provided for devices that can produce large amounts of raw input.</span></span> <span data-ttu-id="ae98f-170">Dans cette méthode, l’application appelle [**GetRawInputBuffer**](/windows/win32/api/winuser/nf-winuser-getrawinputbuffer) pour récupérer un tableau de structures **RAWINPUT** .</span><span class="sxs-lookup"><span data-stu-id="ae98f-170">In this method, the application calls [**GetRawInputBuffer**](/windows/win32/api/winuser/nf-winuser-getrawinputbuffer) to get an array of **RAWINPUT** structures.</span></span> <span data-ttu-id="ae98f-171">Notez que la macro [**NEXTRAWINPUTBLOCK**](/windows/win32/api/winuser/nf-winuser-nextrawinputblock) est utilisée pour parcourir un tableau de structures **RAWINPUT** .</span><span class="sxs-lookup"><span data-stu-id="ae98f-171">Note that the [**NEXTRAWINPUTBLOCK**](/windows/win32/api/winuser/nf-winuser-nextrawinputblock) macro is used to traverse an array of **RAWINPUT** structures.</span></span> <span data-ttu-id="ae98f-172">Pour obtenir un exemple, consultez [réalisation d’une lecture de données brutes en mémoire tampon](using-raw-input.md).</span><span class="sxs-lookup"><span data-stu-id="ae98f-172">For an example, see [Doing a Buffered Read of Raw Input](using-raw-input.md).</span></span>

<span data-ttu-id="ae98f-173">Pour interpréter l’entrée brute, des informations détaillées sur le HID sont requises.</span><span class="sxs-lookup"><span data-stu-id="ae98f-173">To interpret the raw input, detailed information about the HIDs is required.</span></span> <span data-ttu-id="ae98f-174">Une application obtient les informations de l’appareil en appelant [**GetRawInputDeviceInfo**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) avec le handle de l’appareil.</span><span class="sxs-lookup"><span data-stu-id="ae98f-174">An application gets the device information by calling [**GetRawInputDeviceInfo**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) with the device handle.</span></span> <span data-ttu-id="ae98f-175">Ce descripteur peut provenir d’une [**\_ entrée WM**](wm-input.md) ou du membre **hDevice** de [**RAWINPUTHEADER**](/windows/win32/api/winuser/ns-winuser-rawinputheader).</span><span class="sxs-lookup"><span data-stu-id="ae98f-175">This handle can come either from [**WM\_INPUT**](wm-input.md) or from the **hDevice** member of [**RAWINPUTHEADER**](/windows/win32/api/winuser/ns-winuser-rawinputheader).</span></span>