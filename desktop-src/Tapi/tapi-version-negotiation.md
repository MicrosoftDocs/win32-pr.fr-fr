---
description: Au fil du temps, différentes versions peuvent exister pour l’interface TAPI, les applications et les fournisseurs de services pour une ligne ou un téléphone.
ms.assetid: 36a17ae8-31db-4db9-a401-097d47aa26ad
title: Négociation de version TAPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f41f4ca6f12862d6fc19f982c48b90bdafe2aaa2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106526166"
---
# <a name="tapi-version-negotiation"></a><span data-ttu-id="50c73-103">Négociation de version TAPI</span><span class="sxs-lookup"><span data-stu-id="50c73-103">TAPI Version Negotiation</span></span>

<span data-ttu-id="50c73-104">Au fil du temps, différentes versions peuvent exister pour l’interface TAPI, les applications et les fournisseurs de services pour une ligne ou un téléphone.</span><span class="sxs-lookup"><span data-stu-id="50c73-104">Over time, different versions may exist for TAPI, applications, and service providers for a line or phone.</span></span> <span data-ttu-id="50c73-105">Les nouvelles versions peuvent définir de nouvelles fonctionnalités, de nouveaux champs aux structures de données, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="50c73-105">New versions may define new features, new fields to data structures, and so on.</span></span> <span data-ttu-id="50c73-106">Les numéros de version indiquent donc comment interpréter diverses structures de données.</span><span class="sxs-lookup"><span data-stu-id="50c73-106">Version numbers therefore indicate how to interpret various data structures.</span></span>

<span data-ttu-id="50c73-107">Pour permettre une interopérabilité optimale des différentes versions d’applications, des versions de l’interface TAPI elle-même et des versions de fournisseurs de services par différents fournisseurs, TAPI fournit un mécanisme de négociation de version simple et en deux étapes pour les applications.</span><span class="sxs-lookup"><span data-stu-id="50c73-107">To allow optimal interoperability of different versions of applications, versions of TAPI itself, and versions of service providers by different vendors, TAPI provides a simple, two-step version negotiation mechanism for applications.</span></span> <span data-ttu-id="50c73-108">Deux versions différentes doivent être approuvées par l’application, l’interface TAPI et le fournisseur de services pour chaque périphérique de ligne.</span><span class="sxs-lookup"><span data-stu-id="50c73-108">Two different versions must be agreed on by the application, TAPI, and the service provider for each line device.</span></span> <span data-ttu-id="50c73-109">La première est le numéro de version pour la téléphonie de base et supplémentaire, et est appelée version d’API.</span><span class="sxs-lookup"><span data-stu-id="50c73-109">The first is the version number for Basic and Supplementary Telephony and is referred to as the API version.</span></span> <span data-ttu-id="50c73-110">L’autre est pour les extensions spécifiques au fournisseur, le cas échéant, et est appelée version de l’extension.</span><span class="sxs-lookup"><span data-stu-id="50c73-110">The other is for provider-specific extensions, if any, and is referred to as the extension version.</span></span> <span data-ttu-id="50c73-111">Le format des structures de données et des types de données utilisés par les fonctionnalités de base et supplémentaires de l’interface TAPI est défini par la version de l’API, tandis que la version de l’extension détermine le format des structures de données définies par les extensions spécifiques au fournisseur.</span><span class="sxs-lookup"><span data-stu-id="50c73-111">The format of the data structures and datatypes used by TAPI's basic and supplementary features is defined by the API version, while the extension version determines the format of the data structures defined by the vendor-specific extensions.</span></span>

<span data-ttu-id="50c73-112">La négociation de version se poursuit en deux phases.</span><span class="sxs-lookup"><span data-stu-id="50c73-112">Version negotiation proceeds in two phases.</span></span> <span data-ttu-id="50c73-113">Dans la première phase, le numéro de version de l’API est négocié et l’identificateur d’extension associé aux extensions spécifiques au fournisseur prises en charge sur l’appareil est obtenu.</span><span class="sxs-lookup"><span data-stu-id="50c73-113">In the first phase, the API version number is negotiated and the extension identifier associated with any vendor-specific extensions supported on the device is obtained.</span></span> <span data-ttu-id="50c73-114">Dans la deuxième phase, la version de l’extension est négociée.</span><span class="sxs-lookup"><span data-stu-id="50c73-114">In the second phase, the extension version is negotiated.</span></span> <span data-ttu-id="50c73-115">Si l’application n’utilise pas d’extensions d’API, elle ignore la deuxième phase et les extensions ne sont pas activées par le fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="50c73-115">If the application does not use any API extensions, it skips the second phase and extensions are not activated by the service provider.</span></span> <span data-ttu-id="50c73-116">Si l’application souhaite utiliser des extensions, mais que les extensions du fournisseur de services (l’identificateur d’extension) ne sont pas reconnues par l’application, l’application doit également ignorer la négociation pour la version de l’extension.</span><span class="sxs-lookup"><span data-stu-id="50c73-116">If the application does want to use extensions, but the service provider's extensions (the extension identifier) are not recognized by the application, the application should skip the negotiation for extension version as well.</span></span> <span data-ttu-id="50c73-117">Chaque fournisseur dispose de son propre ensemble de versions juridiques (reconnues) pour chaque ensemble de spécifications d’extension qu’il distribue.</span><span class="sxs-lookup"><span data-stu-id="50c73-117">Each vendor has its own set of legal (recognized) versions for each set of extension specifications it distributes.</span></span>

<span data-ttu-id="50c73-118">La fonction [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) est utilisée pour négocier le numéro de version de l’API à utiliser.</span><span class="sxs-lookup"><span data-stu-id="50c73-118">The [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) function is used to negotiate the API version number to use.</span></span> <span data-ttu-id="50c73-119">Il récupère également l’identificateur d’extension pris en charge par le périphérique de ligne, en retournant des zéros si aucune extension n’est prise en charge.</span><span class="sxs-lookup"><span data-stu-id="50c73-119">It also retrieves the extension identifier supported by the line device, returning zeros if no extensions are supported.</span></span> <span data-ttu-id="50c73-120">Avec cet appel de fonction, l’application fournit la plage de versions de l’API avec laquelle elle est compatible.</span><span class="sxs-lookup"><span data-stu-id="50c73-120">With this function call, the application provides the API version range it is compatible with.</span></span> <span data-ttu-id="50c73-121">TAPI à son tour négocie avec le fournisseur de services de la ligne pour déterminer la plage de versions d’API qu’il prend en charge.</span><span class="sxs-lookup"><span data-stu-id="50c73-121">TAPI in turn negotiates with the line's service provider to determine which API version range it supports.</span></span> <span data-ttu-id="50c73-122">L’interface TAPI sélectionne ensuite un numéro de version (généralement, mais pas nécessairement, le numéro de version le plus élevé) dans la plage de versions qui se chevauche, que l’application, la DLL et le fournisseur de services ont fourni.</span><span class="sxs-lookup"><span data-stu-id="50c73-122">TAPI next selects a version number (typically, although not necessarily, the highest version number) in the overlapping version range that the application, the DLL, and the service provider have supplied.</span></span> <span data-ttu-id="50c73-123">Ce nombre est renvoyé à l’application, avec l’identificateur d’extension qui définit les extensions disponibles à partir du fournisseur de services de cette ligne.</span><span class="sxs-lookup"><span data-stu-id="50c73-123">This number is returned to the application, along with the extension identifier that defines the extensions available from that line's service provider.</span></span>

<span data-ttu-id="50c73-124">Si l’application souhaite utiliser les extensions définies par l’identificateur d’extension retourné, elle doit d’abord appeler [**lineNegotiateExtVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) pour négocier la version de l’extension.</span><span class="sxs-lookup"><span data-stu-id="50c73-124">If the application wants to use the extensions defined by the returned extension identifier, it must first call [**lineNegotiateExtVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) to negotiate the extension version.</span></span> <span data-ttu-id="50c73-125">Dans une phase de négociation similaire, l’application spécifie la version d’API déjà convenue et la plage de versions d’extension qu’elle prend en charge.</span><span class="sxs-lookup"><span data-stu-id="50c73-125">In a similar negotiation phase, the application specifies the already agreed-upon API version and the extension version range it supports.</span></span> <span data-ttu-id="50c73-126">L’interface TAPI transmet ces informations au fournisseur de services de la ligne.</span><span class="sxs-lookup"><span data-stu-id="50c73-126">TAPI passes this information to the service provider for the line.</span></span> <span data-ttu-id="50c73-127">Le fournisseur de services vérifie la version de l’API et la plage de versions d’extension par rapport à sa propre valeur, et sélectionne le numéro de version de l’extension appropriée, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="50c73-127">The service provider checks the API version and the extension version range against its own, and selects the appropriate extension version number, if one exists.</span></span>

<span data-ttu-id="50c73-128">Lorsque l’application appelle ensuite [**lineGetDevCaps**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps), elle retourne un ensemble de fonctionnalités d’appareil pour la ligne qui correspondent aux résultats de la négociation de version.</span><span class="sxs-lookup"><span data-stu-id="50c73-128">When the application later calls [**lineGetDevCaps**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps), it returns a set of device capabilities for the line that correspond to the results of version negotiation.</span></span> <span data-ttu-id="50c73-129">Celles-ci incluent les fonctionnalités d’appareil de la ligne qui sont cohérentes avec la version de l’API et les fonctionnalités spécifiques à l’appareil de la ligne qui sont cohérentes avec la version de l’extension.</span><span class="sxs-lookup"><span data-stu-id="50c73-129">These include the line's device capabilities consistent with the API version and the line's device-specific capabilities consistent with the extension version.</span></span> <span data-ttu-id="50c73-130">L’application doit spécifier les deux numéros de version lors de l’ouverture d’une ligne.</span><span class="sxs-lookup"><span data-stu-id="50c73-130">The application must specify both of these version numbers when it opens a line.</span></span> <span data-ttu-id="50c73-131">À ce stade, l’application, la DLL et le fournisseur de services s’engagent à utiliser les versions convenues.</span><span class="sxs-lookup"><span data-stu-id="50c73-131">At that point, the application, the DLL, and the service provider are committed to using the agreed-upon versions.</span></span> <span data-ttu-id="50c73-132">Si les extensions spécifiques à l’appareil ne sont pas à utiliser, la version de l’extension doit être spécifiée comme zéro.</span><span class="sxs-lookup"><span data-stu-id="50c73-132">If device-specific extensions are not to be used, the extension version should be specified as zero.</span></span>

<span data-ttu-id="50c73-133">Dans un environnement où plusieurs applications ouvrent le même périphérique de ligne, la première application à ouvrir le périphérique de ligne sélectionne les versions de toutes les futures applications qui souhaitent utiliser la ligne (les fournisseurs de services ne prennent pas en charge plusieurs versions simultanément). De même, une application qui ouvre plusieurs périphériques de ligne peut trouver plus facile d’utiliser tous les périphériques de ligne sous le même numéro de version d’API.</span><span class="sxs-lookup"><span data-stu-id="50c73-133">In an environment where multiple applications open the same line device, the first application to open the line device selects the versions for all future applications that want to use the line (service providers do not support multiple versions simultaneously.) Similarly, an application that opens multiple line devices may find it easier to operate all line devices under the same API version number.</span></span>

<span data-ttu-id="50c73-134">Chaque fonction qui accepte un paramètre *dwAPIVersion* ou similaire doit définir ce paramètre sur la version d’API la plus élevée prise en charge par l’application ou la version de l’API négociée à l’aide de la fonction [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) ou [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) sur un appareil particulier.</span><span class="sxs-lookup"><span data-stu-id="50c73-134">Every function that takes a *dwAPIVersion* or similar parameter must set this parameter to either the highest API version supported by the application or the API version negotiated using the [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) or [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) function on a particular device.</span></span> <span data-ttu-id="50c73-135">Utilisez le tableau suivant comme guide :</span><span class="sxs-lookup"><span data-stu-id="50c73-135">Use the following table as a guide:</span></span>



| <span data-ttu-id="50c73-136">Fonction</span><span class="sxs-lookup"><span data-stu-id="50c73-136">Function</span></span>                                                     | <span data-ttu-id="50c73-137">Signification</span><span class="sxs-lookup"><span data-stu-id="50c73-137">Meaning</span></span>                                                                               |
|--------------------------------------------------------------|---------------------------------------------------------------------------------------|
| [<span data-ttu-id="50c73-138">**lineGetAddressCaps**</span><span class="sxs-lookup"><span data-stu-id="50c73-138">**lineGetAddressCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetaddresscaps)             | <span data-ttu-id="50c73-139">Utilisez la version retournée par [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="50c73-139">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="50c73-140">**lineGetCountry**</span><span class="sxs-lookup"><span data-stu-id="50c73-140">**lineGetCountry**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetcountry)                     | <span data-ttu-id="50c73-141">Utilisez la version la plus récente prise en charge par l’application.</span><span class="sxs-lookup"><span data-stu-id="50c73-141">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="50c73-142">**lineGetDevCaps**</span><span class="sxs-lookup"><span data-stu-id="50c73-142">**lineGetDevCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps)                     | <span data-ttu-id="50c73-143">Utilisez la version retournée par [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="50c73-143">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="50c73-144">**lineGetProviderList**</span><span class="sxs-lookup"><span data-stu-id="50c73-144">**lineGetProviderList**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetproviderlist)           | <span data-ttu-id="50c73-145">Utilisez la version la plus récente prise en charge par l’application.</span><span class="sxs-lookup"><span data-stu-id="50c73-145">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="50c73-146">**lineGetTranslateCaps**</span><span class="sxs-lookup"><span data-stu-id="50c73-146">**lineGetTranslateCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegettranslatecaps)         | <span data-ttu-id="50c73-147">Utilisez la version la plus récente prise en charge par l’application.</span><span class="sxs-lookup"><span data-stu-id="50c73-147">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="50c73-148">**lineNegotiateAPIVersion**</span><span class="sxs-lookup"><span data-stu-id="50c73-148">**lineNegotiateAPIVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)   | <span data-ttu-id="50c73-149">Utilisez la version la plus récente prise en charge par l’application.</span><span class="sxs-lookup"><span data-stu-id="50c73-149">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="50c73-150">**lineNegotiateExtVersion**</span><span class="sxs-lookup"><span data-stu-id="50c73-150">**lineNegotiateExtVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion)   | <span data-ttu-id="50c73-151">Utilisez la version retournée par [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="50c73-151">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="50c73-152">**lineOpen**</span><span class="sxs-lookup"><span data-stu-id="50c73-152">**lineOpen**</span></span>](/windows/desktop/api/Tapi/nf-tapi-lineopen)                                 | <span data-ttu-id="50c73-153">Utilisez la version retournée par [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="50c73-153">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="50c73-154">**lineTranslateAddress**</span><span class="sxs-lookup"><span data-stu-id="50c73-154">**lineTranslateAddress**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linetranslateaddress)         | <span data-ttu-id="50c73-155">Utilisez la version la plus récente prise en charge par l’application.</span><span class="sxs-lookup"><span data-stu-id="50c73-155">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="50c73-156">**lineTranslateDialog**</span><span class="sxs-lookup"><span data-stu-id="50c73-156">**lineTranslateDialog**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linetranslatedialog)           | <span data-ttu-id="50c73-157">Utilisez la version la plus récente prise en charge par l’application.</span><span class="sxs-lookup"><span data-stu-id="50c73-157">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="50c73-158">**phoneGetDevCaps**</span><span class="sxs-lookup"><span data-stu-id="50c73-158">**phoneGetDevCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonegetdevcaps)                   | <span data-ttu-id="50c73-159">Utilisez la version retournée par [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="50c73-159">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |
| [<span data-ttu-id="50c73-160">**phoneNegotiateAPIVersion**</span><span class="sxs-lookup"><span data-stu-id="50c73-160">**phoneNegotiateAPIVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) | <span data-ttu-id="50c73-161">Utilisez la version la plus récente prise en charge par l’application.</span><span class="sxs-lookup"><span data-stu-id="50c73-161">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="50c73-162">**phoneNegotiateExtVersion**</span><span class="sxs-lookup"><span data-stu-id="50c73-162">**phoneNegotiateExtVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateextversion) | <span data-ttu-id="50c73-163">Utilisez la version retournée par [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="50c73-163">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |
| [<span data-ttu-id="50c73-164">**phoneOpen**</span><span class="sxs-lookup"><span data-stu-id="50c73-164">**phoneOpen**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phoneopen)                               | <span data-ttu-id="50c73-165">Utilisez la version retournée par [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="50c73-165">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |



 

> [!IMPORTANT]
> <span data-ttu-id="50c73-166">Lors de la négociation d’une version d’API, définissez toujours les numéros de version haute et basse sur la plage de versions que votre application peut prendre en charge.</span><span class="sxs-lookup"><span data-stu-id="50c73-166">When negotiating an API version, always set the high and low version numbers to the range of versions that your application can support.</span></span> <span data-ttu-id="50c73-167">Par exemple, n’utilisez jamais 0x00000000 pour la version basse ou 0xFFFFFFFF pour la valeur élevée, car ces valeurs requièrent que votre application prenne en charge toutes les versions de TAPI, à la fois passées et futures.</span><span class="sxs-lookup"><span data-stu-id="50c73-167">For example, never use 0x00000000 for the low version or 0xFFFFFFFF for the high because these values require that your application support all versions of TAPI, both past and future.</span></span>

 

 

 



