---
description: Quand une application appelle la fonction lineClose avec une ou plusieurs opérations asynchrones en suspens, TAPI peut demander au fournisseur de services d’arrêter les opérations asynchrones associées à un appel.
ms.assetid: b26ce074-76dc-4a50-8c17-d3412c336d59
title: Fin des opérations asynchrones
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f8ed2acb0f442e5f4f07427f0e224d7a288087d6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106543754"
---
# <a name="termination-of-asynchronous-operations"></a><span data-ttu-id="56c85-103">Fin des opérations asynchrones</span><span class="sxs-lookup"><span data-stu-id="56c85-103">Termination of Asynchronous Operations</span></span>

<span data-ttu-id="56c85-104">Lorsqu’une application appelle la fonction [**lineClose**](/windows/win32/api/tapi/nf-tapi-lineclose) avec une ou plusieurs opérations asynchrones en suspens, TAPI peut demander au fournisseur de services d’arrêter les opérations asynchrones associées à un appel, selon que l’application est le seul propriétaire de l’appel et qu’elle a le seul descripteur à l’appel.</span><span class="sxs-lookup"><span data-stu-id="56c85-104">When an application calls the [**lineClose**](/windows/win32/api/tapi/nf-tapi-lineclose) function with one or more outstanding asynchronous operations, TAPI may direct the service provider to terminate asynchronous operations associated with a call, depending on whether the application is the sole owner of the call and has the only handle to the call.</span></span>

<span data-ttu-id="56c85-105">Si l’application est le seul propriétaire d’un appel, TAPI appelle [**TSPI \_ LineDropOnClose**](./tspi-linedroponclose.md) ou [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) (selon le fournisseur) pour chacun de ces appels.</span><span class="sxs-lookup"><span data-stu-id="56c85-105">If the application is the sole owner of a call, TAPI calls [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) (depending on the provider) for each such call.</span></span> <span data-ttu-id="56c85-106">Le fournisseur de services doit vérifier toutes les opérations asynchrones en attente associées à l’appel en cours de suppression.</span><span class="sxs-lookup"><span data-stu-id="56c85-106">The service provider should check for any pending asynchronous operations associated with the call being dropped.</span></span> <span data-ttu-id="56c85-107">Si une opération en attente existe, le fournisseur de services doit prendre l’action appropriée, ce qui peut entraîner l’arrêt de l’opération en cours.</span><span class="sxs-lookup"><span data-stu-id="56c85-107">If a pending operation exists, the service provider should take the appropriate action, possibly terminating the operation in progress.</span></span>

<span data-ttu-id="56c85-108">Si l’application a le seul descripteur d’un appel (c’est-à-dire qu’il n’y a pas d’autres propriétaires ou analyses), TAPI appelle la fonction [**TSPI \_ lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) .</span><span class="sxs-lookup"><span data-stu-id="56c85-108">If the application has the only handle to a call (that is, there are no other owners or monitors), TAPI calls the [**TSPI\_lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) function.</span></span> <span data-ttu-id="56c85-109">Le fournisseur de services doit considérer cet appel comme l’indication absolue que les opérations asynchrones en attente doivent être abandonnées.</span><span class="sxs-lookup"><span data-stu-id="56c85-109">The service provider must consider this call to be the absolute indication that pending asynchronous operations must be abandoned.</span></span> <span data-ttu-id="56c85-110">Le fournisseur de services doit garantir une achèvement ordonné de l’appel et doit appeler la fonction de rappel d' [**\_ achèvement asynchrone**](/windows/win32/api/tspi/nc-tspi-async_completion) pour toutes les opérations asynchrones en suspens, en spécifiant la \_ valeur d’erreur LINEERR OPERATIONFAILED.</span><span class="sxs-lookup"><span data-stu-id="56c85-110">The service provider must ensure an orderly completion of the call, and must call the [**ASYNC\_COMPLETION**](/windows/win32/api/tspi/nc-tspi-async_completion) callback function for all outstanding asynchronous operations, specifying the LINEERR\_OPERATIONFAILED error value.</span></span> <span data-ttu-id="56c85-111">Si TAPI avait précédemment appelé la fonction [**TSPI \_ LineDropOnClose**](./tspi-linedroponclose.md) ou [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) , il appelle **TSPI \_ lineCloseCall** immédiatement après le retour du fournisseur de services de l’autre appel ; il n’attend pas la fin de l’opération asynchrone associée à la fonction TSPI **\_ lineDrop** .</span><span class="sxs-lookup"><span data-stu-id="56c85-111">If TAPI previously called the [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) function, it calls **TSPI\_lineCloseCall** immediately after the service provider returns from the other call; it does not wait for the asynchronous operation associated with the **TSPI\_lineDrop** function to complete.</span></span>

<span data-ttu-id="56c85-112">Si l’application n’est pas le seul propriétaire de l’appel, TAPI n’appelle pas [**TSPI \_ LineDropOnClose**](./tspi-linedroponclose.md) ou [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop).</span><span class="sxs-lookup"><span data-stu-id="56c85-112">If the application is not the sole owner of the call, TAPI does not call [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop).</span></span> <span data-ttu-id="56c85-113">Si l’application n’a pas le seul descripteur de l’appel, TAPI n’appelle pas la fonction [**TSPI \_ lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) .</span><span class="sxs-lookup"><span data-stu-id="56c85-113">If the application does not have the only handle to the call, TAPI does not call the [**TSPI\_lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) function.</span></span> <span data-ttu-id="56c85-114">Si l’application n’est ni le seul propriétaire, ni le seul possesseur d’un descripteur de l’appel, TAPI n’envoie aucune notification au fournisseur de services, et par conséquent, les opérations asynchrones en attente restent intactes.</span><span class="sxs-lookup"><span data-stu-id="56c85-114">If the application is neither the sole owner nor the sole possessor of a handle to the call, TAPI sends no notification to the service provider, and therefore, any pending asynchronous operations remain intact.</span></span> <span data-ttu-id="56c85-115">Cela signifie que ces applications ne peuvent pas terminer les opérations asynchrones qu’elles ont démarrées à l’aide de la fonction [**lineClose**](/windows/win32/api/tapi/nf-tapi-lineclose) .</span><span class="sxs-lookup"><span data-stu-id="56c85-115">This means that such applications cannot terminate asynchronous operations that they have started by using the [**lineClose**](/windows/win32/api/tapi/nf-tapi-lineclose) function.</span></span> <span data-ttu-id="56c85-116">Toutefois, étant donné que chaque opération asynchrone requiert que l’application appelante soit propriétaire de l’appel, la probabilité qu’une application ne soit pas en mesure de terminer les opérations asynchrones soit très rare.</span><span class="sxs-lookup"><span data-stu-id="56c85-116">However, because every asynchronous operation requires the invoking application to be an owner of the call, the likelihood of an application not being able to terminate asynchronous operations is very rare.</span></span> <span data-ttu-id="56c85-117">Si c’est le cas, les autres propriétaires du ou des appels doivent assumer la responsabilité de la disposition du ou des appels.</span><span class="sxs-lookup"><span data-stu-id="56c85-117">If it does occur, the other owner(s) of the call(s) must take responsibility for the disposition of the call(s).</span></span>

<span data-ttu-id="56c85-118">Si TAPI appelle [**TSPI \_ LineDropOnClose**](./tspi-linedroponclose.md) ou [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop), le fournisseur de services doit finalement envoyer un \_ message LINECALLSTATE Idle pour l’appel associé (sauf si [**TSPI \_ lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) est appelé en premier) afin que les analyses de l’appel puissent être nettoyées.</span><span class="sxs-lookup"><span data-stu-id="56c85-118">If TAPI calls [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop), the service provider must eventually send a LINECALLSTATE\_IDLE message for the associated call (unless [**TSPI\_lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) is called first) so that monitors on the call can clean up.</span></span> <span data-ttu-id="56c85-119">Lorsque le dernier analyseur a appelé la fonction [**lineDeallocateCall**](/windows/win32/api/tapi/nf-tapi-linedeallocatecall) , l’interface TAPI appelle la fonction **TSPI \_ lineCloseCall** . toutes les opérations en attente doivent être terminées ou terminées et l' [**\_ achèvement asynchrone**](/windows/win32/api/tspi/nc-tspi-async_completion) appelé, comme décrit précédemment.</span><span class="sxs-lookup"><span data-stu-id="56c85-119">When the last monitor has called the [**lineDeallocateCall**](/windows/win32/api/tapi/nf-tapi-linedeallocatecall) function, TAPI calls the **TSPI\_lineCloseCall** function; any pending operations must be completed or terminated and [**ASYNC\_COMPLETION**](/windows/win32/api/tspi/nc-tspi-async_completion) called, as described earlier.</span></span>

 

 
