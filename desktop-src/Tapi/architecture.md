---
description: L’illustration suivante montre l’architecture générale des fournisseurs de services de téléphonie et les bibliothèques de liens dynamiques (dll) de l’interface utilisateur qui leur sont associées.
ms.assetid: b5efe57a-19b8-49c5-810f-180633ed50d2
title: Architecture (API de téléphonie)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14423dba77af1ded38af4a6f2b896e76d28ca2cd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106534256"
---
# <a name="architecture-telephony-api"></a><span data-ttu-id="780aa-103">Architecture (API de téléphonie)</span><span class="sxs-lookup"><span data-stu-id="780aa-103">Architecture (Telephony API)</span></span>

<span data-ttu-id="780aa-104">L’illustration suivante montre l’architecture générale des fournisseurs de services de téléphonie et les bibliothèques de liens dynamiques (dll) de l’interface utilisateur qui leur sont associées.</span><span class="sxs-lookup"><span data-stu-id="780aa-104">The following illustration shows the general architecture of telephony service providers and their associated user interface dynamic-link libraries (UI DLLs).</span></span>

![tsps et dll d’interface utilisateur associées](images/spuidl01.png)

<span data-ttu-id="780aa-106">Le fournisseur de services se compose d’au moins deux composants.</span><span class="sxs-lookup"><span data-stu-id="780aa-106">The service provider consists of a minimum of two components.</span></span> <span data-ttu-id="780aa-107">La DLL du fournisseur de services (désignée dans l’illustration comme MAIN. TSP) s’exécute dans le contexte du processus TAPISRV et effectue toutes les tâches du fournisseur de services qui ne sont pas liées aux éléments d’interface utilisateur associés à l’utilisation d’un appareil par une application particulière (probablement, conjointement avec les composants de niveau inférieur non affichés dans l’illustration).</span><span class="sxs-lookup"><span data-stu-id="780aa-107">The service provider DLL (designated in the illustration as MAIN.TSP) executes in the context of the TAPISRV process, and performs all of the tasks of the service provider that are not related to user interface elements associated with a particular application's use of the device (most likely, in conjunction with lower-level components not shown in the illustration).</span></span> <span data-ttu-id="780aa-108">Toutefois, à la différence des versions précédentes de TAPI, dans lesquelles le code de l’interface utilisateur était intégré au fournisseur de services (et exécuté, en raison de l’architecture précédente, dans le contexte de l’application), le fournisseur de services doit maintenant inclure un composant distinct qui implémente les éléments de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="780aa-108">But unlike previous versions of TAPI in which the user interface code was integrated into the service provider (and executed, because of the previous architecture, within the context of the application), the service provider must now include a separate component that implements the user interface elements.</span></span>

<span data-ttu-id="780aa-109">La DLL de l’interface utilisateur du fournisseur de services doit exporter les fonctions qui sont appelées par l’interface TAPI lorsque l’application appelle des fonctions TAPI qui génèrent une interface utilisateur : [**TUISPI \_ lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog), [**TUISPI \_ lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit), [**TUISPI \_ PhoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog), [**TUISPI \_**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig)providerConfig, TUISPI [**\_ providerInstall**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall)et [**TUISPI \_**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove)providerRemove.</span><span class="sxs-lookup"><span data-stu-id="780aa-109">The service provider UI DLL must export functions that are called by TAPI when the application calls TAPI functions that generate UI: [**TUISPI\_lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog), [**TUISPI\_lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit), [**TUISPI\_phoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog), [**TUISPI\_providerConfig**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig), [**TUISPI\_providerInstall**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall), and [**TUISPI\_providerRemove**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove).</span></span> <span data-ttu-id="780aa-110">Chacune de ces fonctions comprend comme paramètre un pointeur vers une fonction de rappel dans TAPI, de type [**TUISPIDLLCALLBACK**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback), que la dll de l’interface utilisateur peut utiliser pour communiquer de manière bidirectionnelle (à la fois les données d’envoi et de réception) avec la dll du fournisseur de services s’exécutant dans le processus tapisrv.</span><span class="sxs-lookup"><span data-stu-id="780aa-110">Each of these functions includes as a parameter a pointer to a callback function in TAPI, of type [**TUISPIDLLCALLBACK**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback), which the UI DLL can use to communicate bidirectionally (both send and receive data) with the service provider DLL executing in the TAPISRV process.</span></span> <span data-ttu-id="780aa-111">Si le fournisseur de services génère une interface utilisateur spontanée, telle que la boîte de dialogue de **communication** Unimodem, comme une fonction TSPI pour laquelle l’interface utilisateur n’est pas attendue (par exemple, toute fonction qui n’a pas de paramètre *HWND* ), la dll de l’interface utilisateur doit exporter [**TUISPI \_ providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) et [**TUISPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata).</span><span class="sxs-lookup"><span data-stu-id="780aa-111">If the service provider ever generates spontaneous UI, such as the Unimodem **Talk/Hangup** dialog box, in conjunction with any TSPI function for which UI is not expected (for example, any function that does not have an *hwnd* parameter), then the UI DLL must export [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) and [**TUISPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata).</span></span>

> [!Note]  
> <span data-ttu-id="780aa-112">Les fonctions d’origine de génération de l’interface utilisateur TSPI ( [**TSPI \_ lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog), [**TSPI \_ lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit), [**TSPI \_ PhoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog), TSPI [**\_ providerConfig**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig), [**TSPI \_ providerInstall**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall)et [**TSPI \_ providerRemove**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)) sont obsolètes et ne sont jamais appelées par TAPI.</span><span class="sxs-lookup"><span data-stu-id="780aa-112">The original TSPI UI-generating functions ( [**TSPI\_lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog), [**TSPI\_lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit), [**TSPI\_phoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog), [**TSPI\_providerConfig**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig), [**TSPI\_providerInstall**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall), and [**TSPI\_providerRemove**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)) are obsolete and never called by TAPI.</span></span> <span data-ttu-id="780aa-113">Par conséquent, elles ne doivent pas être exportées par la DLL du fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="780aa-113">Therefore, these are not required to be exported by the service provider DLL.</span></span> <span data-ttu-id="780aa-114">Toutefois, si le fournisseur de services souhaite être listé comme un fournisseur qui peut être ajouté par le panneau de configuration de la téléphonie, un utilitaire fourni avec la téléphonie Windows dans les versions 1,4 et antérieures, doit exporter **TSPI \_ providerInstall**; si le bouton [**supprimer**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) est activé dans le panneau de configuration de la téléphonie lorsqu’il est sélectionné, il doit exporter **TSPI \_ providerRemove** et, s’il souhaite que le bouton configurer soit activé dans le panneau de **configuration** de la téléphonie lorsqu’il est sélectionné, il doit exporter **TSPI \_ providerConfig**.</span><span class="sxs-lookup"><span data-stu-id="780aa-114">However, if the service provider wants to be listed as one that can be added by the Telephony Control Panel, a utility supplied with Windows Telephony in versions 1.4 and earlier, it must export **TSPI\_providerInstall**; if it wants to have the [**Remove**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) button enabled in the Telephony Control Panel when it is selected, it must export **TSPI\_providerRemove**; and if it wants the **Setup** button to be enabled in the Telephony Control Panel when it is selected, it must export **TSPI\_providerConfig**.</span></span> <span data-ttu-id="780aa-115">Le panneau de configuration de la téléphonie vérifie la présence de ces fonctions dans le fichier TSP du fournisseur de services pour ajuster son interface utilisateur afin de refléter les opérations qui peuvent être effectuées.</span><span class="sxs-lookup"><span data-stu-id="780aa-115">The Telephony Control Panel checks for the presence of these functions in the service provider TSP file to adjust its user interface to reflect which operations can be performed.</span></span>

 

<span data-ttu-id="780aa-116">La DLL du fournisseur de services doit exporter la fonction [**TSPI \_ providerUIIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) que le processus tapisrv utilise pour obtenir le nom de la dll de l’interface utilisateur à charger dans le processus d’application.</span><span class="sxs-lookup"><span data-stu-id="780aa-116">The service provider DLL must export the [**TSPI\_providerUIIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) function that TAPISRV process uses to obtain the name of the UI DLL to load in the application process.</span></span> <span data-ttu-id="780aa-117">Elle doit exporter la fonction [**TSPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) pour recevoir et répondre aux demandes de la dll de l’interface utilisateur pour que les données s’affichent, et elle doit exporter [**TSPI \_ providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) pour tapisrv processus afin d’indiquer au fournisseur de services quand publier une association établie dans le but de générer une interface utilisateur spontanée avec une fonction qui n’est pas définie comme présentant une interface utilisateur pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="780aa-117">It must export the [**TSPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) function to receive and respond to requests from the UI DLL for data to display, and it must export [**TSPI\_providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) for TAPISRV process to tell the service provider when to release an association established for the purpose of generating spontaneous UI in conjunction with a function that is not defined as presenting UI to the user.</span></span> <span data-ttu-id="780aa-118">La DLL du fournisseur de services peut envoyer de façon unidirectionnelle des données à la DLL de l’interface utilisateur à l’aide de la nouvelle ligne de message TSPI [**\_ SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md).</span><span class="sxs-lookup"><span data-stu-id="780aa-118">The service provider DLL can unidirectionally send data to the UI DLL by using the new TSPI message [**LINE\_SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md).</span></span>

<span data-ttu-id="780aa-119">Étant donné que les noms des fonctions TSPI et TUISPI sont intentionnellement définis pour être différents, la DLL du fournisseur de services et la DLL de l’interface utilisateur peuvent être le même fichier DLL, si vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="780aa-119">Because the names of the TSPI and TUISPI functions are intentionally defined to be different, the service provider DLL and the UI DLL can be the same DLL file, if desired.</span></span> <span data-ttu-id="780aa-120">Avec la segmentation appropriée, cela n’entraîne pas nécessairement une utilisation inutile de la mémoire dans le contexte de l’application et peut simplifier le processus d’installation pour les fournisseurs de services qui peuvent actuellement être implémentés dans une DLL unique.</span><span class="sxs-lookup"><span data-stu-id="780aa-120">With proper segmentation, this does not necessarily result in any unnecessary usage of memory in the application context, and can simplify the installation process for service providers that can currently be implemented in a single DLL.</span></span> <span data-ttu-id="780aa-121">L’interface TAPI appelle uniquement les fonctions qui sont appropriées pour le contexte dans lequel la DLL est utilisée.</span><span class="sxs-lookup"><span data-stu-id="780aa-121">TAPI calls only the functions that are appropriate for the context in which the DLL is being used.</span></span>

<span data-ttu-id="780aa-122">Le fournisseur de services de téléphonie et la DLL de l’interface utilisateur doivent tous deux être conçus avec l’exigence à l’esprit que les fonctions d’interface utilisateur peuvent être appelées simultanément à partir de plusieurs processus d’application.</span><span class="sxs-lookup"><span data-stu-id="780aa-122">The telephony service provider and the UI DLL must both be designed with the requirement in mind that the UI functions can be invoked from multiple application processes simultaneously.</span></span> <span data-ttu-id="780aa-123">Ils doivent également tenir compte du fait que l’application et le service TAPI sous lequel le fournisseur de services de téléphonie s’exécute peuvent se trouver sur des ordinateurs distincts sur un réseau local.</span><span class="sxs-lookup"><span data-stu-id="780aa-123">They must also consider that the application and the TAPI service under which the telephony service provider is executing can be on separate computers on a LAN.</span></span>

 

 
