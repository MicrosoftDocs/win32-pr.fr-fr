---
description: Dans l’architecture TAPI, tous les TSPs sont exécutés dans le contexte de TAPISRV, qui est implémenté en tant que processus de service dans SVCHOST.
ms.assetid: f47662f9-2fca-4044-ab26-617e5b1f9eae
title: Architecture MSP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e8c1229ddce90f79c122c47572b4567d230b0b4e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104393335"
---
# <a name="msp-architecture"></a><span data-ttu-id="049d3-103">Architecture MSP</span><span class="sxs-lookup"><span data-stu-id="049d3-103">MSP Architecture</span></span>

<span data-ttu-id="049d3-104">Dans l’architecture TAPI, tous les TSPs sont exécutés dans le contexte de TAPISRV, qui est implémenté en tant que processus de service dans SVCHOST.</span><span class="sxs-lookup"><span data-stu-id="049d3-104">In TAPI architecture, all TSPs are run in the context of TAPISRV, which is implemented as a service process within SVCHOST.</span></span> <span data-ttu-id="049d3-105">Les applications TAPI résident dans leur propre processus.</span><span class="sxs-lookup"><span data-stu-id="049d3-105">TAPI applications live in their own process.</span></span> <span data-ttu-id="049d3-106">Les applications TAPI chargent Tapi3.dll et les MSP nécessaires dans leur propre processus, et la DLL TAPI communique avec TAPISRV via une interface RPC privée.</span><span class="sxs-lookup"><span data-stu-id="049d3-106">TAPI applications load Tapi3.dll and any needed MSPs into their own process, and the TAPI DLL communicates with TAPISRV through a private RPC interface.</span></span> <span data-ttu-id="049d3-107">Le diagramme suivant illustre l’interaction de ces composants.</span><span class="sxs-lookup"><span data-stu-id="049d3-107">The following diagram illustrates the interaction of these components.</span></span>

![interactions entre tapisrv, les applications TAPI et les MSP](images/tsp-msp1.png)

<span data-ttu-id="049d3-109">Un fournisseur de services de média (MSP) fournit la diffusion multimédia en continu à l’aide des abstractions des terminaux, des flux et des sous-flux.</span><span class="sxs-lookup"><span data-stu-id="049d3-109">A media service provider (MSP) provides media streaming using the abstractions of Terminals, Streams, and SubStreams.</span></span>

<span data-ttu-id="049d3-110">Un terminal est un récepteur ou une source pour un flux de média.</span><span class="sxs-lookup"><span data-stu-id="049d3-110">A Terminal is a sink or source for a media stream.</span></span> <span data-ttu-id="049d3-111">Il peut s’agir d’un objet physique, tel qu’un haut-parleur ou un microphone, ou d’une abstraction d’un appareil, telle qu’une fenêtre vidéo.</span><span class="sxs-lookup"><span data-stu-id="049d3-111">It may be a physical object, such as a speaker or a microphone, or it may be an abstraction of a device, such as a video window.</span></span> <span data-ttu-id="049d3-112">L' [objet terminal](terminal-object.md) expose l’interface [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) .</span><span class="sxs-lookup"><span data-stu-id="049d3-112">The [Terminal Object](terminal-object.md) exposes the [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) interface.</span></span> <span data-ttu-id="049d3-113">La classe de terminal est décrite par le GUID de la [**classe terminal**](terminal-class.md) .</span><span class="sxs-lookup"><span data-stu-id="049d3-113">The class of terminal is described by the [**Terminal Class**](terminal-class.md) GUID.</span></span> <span data-ttu-id="049d3-114">Un MSP peut définir ses propres classes de terminaux.</span><span class="sxs-lookup"><span data-stu-id="049d3-114">An MSP may define its own terminal classes.</span></span>

<span data-ttu-id="049d3-115">Les flux divisent le média d’un appel en fonction du type de [**média**](tapimediatype--constants.md) ou du type, de la [**direction**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction)du flux et de l’adresse de destination du média.</span><span class="sxs-lookup"><span data-stu-id="049d3-115">Streams divide the media of a call based on the [**media type**](tapimediatype--constants.md) or type, the stream's [**direction**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction), and the destination address of the media.</span></span> <span data-ttu-id="049d3-116">Par exemple, un flux audio entrant d’un modem est un objet de flux, un flux vidéo sortant vers une adresse IP et un port est un objet de flux, les flux vidéo provenant d’un groupe de multidiffusion IP sont également considérés comme un objet de flux.</span><span class="sxs-lookup"><span data-stu-id="049d3-116">For example, an incoming audio stream from a modem is a stream object, an outgoing video stream to an IP address and port is a stream object, the video streams coming from a IP multicast group are also considered as one stream object.</span></span> <span data-ttu-id="049d3-117">L’objet de flux est représenté par l’interface [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="049d3-117">The Stream object is represented by the [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) interface.</span></span>

<span data-ttu-id="049d3-118">Les sous-flux permettent un contrôle plus précis sur le média.</span><span class="sxs-lookup"><span data-stu-id="049d3-118">SubStreams allow finer control over the media.</span></span> <span data-ttu-id="049d3-119">Par exemple, dans le cas de la multidiffusion IP, l’objet flux vidéo entrant peut représenter plusieurs personnes.</span><span class="sxs-lookup"><span data-stu-id="049d3-119">For example, in the IP multicast case, the incoming video stream object might represent several people.</span></span> <span data-ttu-id="049d3-120">L’application souhaitera probablement que chaque participant ait un convertisseur distinct.</span><span class="sxs-lookup"><span data-stu-id="049d3-120">The application will most likely want each participant to have a separate renderer.</span></span> <span data-ttu-id="049d3-121">Le flux vidéo entrant peut être divisé en plusieurs sous-flux, un pour chaque personne.</span><span class="sxs-lookup"><span data-stu-id="049d3-121">The incoming video stream can be divided into several substreams, one for each person.</span></span> <span data-ttu-id="049d3-122">Un sous-flux correspond à une personne et peut être configuré et contrôlé séparément.</span><span class="sxs-lookup"><span data-stu-id="049d3-122">One substream would correspond to one person, and can be configured and controlled separately.</span></span> <span data-ttu-id="049d3-123">L’objet de sous-flux est représenté par l’interface [**ITSubStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="049d3-123">The SubStream object is represented by the [**ITSubStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) interface.</span></span>

<span data-ttu-id="049d3-124">Quand une application appelle [**ITAddress :: createCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) pour configurer un appel, elle doit spécifier le type de média requis.</span><span class="sxs-lookup"><span data-stu-id="049d3-124">When an application calls [**ITAddress::CreateCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) to set up a call, it must specify the type of media required.</span></span> <span data-ttu-id="049d3-125">Sur un appel sortant, il indique simplement à TAPI une fois l’appel créé.</span><span class="sxs-lookup"><span data-stu-id="049d3-125">On an outgoing call, it simply tells TAPI when the call is created.</span></span> <span data-ttu-id="049d3-126">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="049d3-126">For example:</span></span>

``` syntax
HRESULT hr = pAddress->CreateCall( 
       pszDestAddress, 
       lAddressType, 
       TAPIMEDIATYPE_AUDIO | TAPIMEDIATYPE_VIDEO, 
       &pCall 
       ); 
// If (hr != S_OK ) process the error here
```

<span data-ttu-id="049d3-127">Dans ce cas, l’application crée un appel audio-vidéo sortant.</span><span class="sxs-lookup"><span data-stu-id="049d3-127">In this case, the application is creating an outgoing audio-video call.</span></span>

<span data-ttu-id="049d3-128">Les types de média transmis indiquent le support qui intéresse l’application pendant la durée de vie de l’appel.</span><span class="sxs-lookup"><span data-stu-id="049d3-128">The media types passed in indicate the media that the application is interested in over the lifetime of the call.</span></span> <span data-ttu-id="049d3-129">Par exemple, l’application peut spécifier l’audio et la vidéo lors de la création de l’appel, mais ne sélectionner que des terminaux audio au début.</span><span class="sxs-lookup"><span data-stu-id="049d3-129">For example, the application may specify audio and video when creating the call, but select only audio terminals at the beginning.</span></span> <span data-ttu-id="049d3-130">Le MSP démarre uniquement la diffusion audio en continu, mais ne rejette pas une requête vidéo locale ou distante effectuée plus tard au cours de la durée de vie de l’appel.</span><span class="sxs-lookup"><span data-stu-id="049d3-130">The MSP will start streaming only audio, but will not reject a local or remote video request made later in the lifetime of the call.</span></span>

<span data-ttu-id="049d3-131">Lorsque l’application appelle ensuite [**ITBasicCallControl :: Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 appelle [**TSPI \_ lineMakeCall**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) dans le TSP.</span><span class="sxs-lookup"><span data-stu-id="049d3-131">When the application then calls [**ITBasicCallControl::Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 calls [**TSPI\_lineMakeCall**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) in the TSP.</span></span> <span data-ttu-id="049d3-132">Après l’établissement d’un appel, le MSP et le TSP peuvent communiquer en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="049d3-132">After a call is established, the MSP and TSP can communicate as necessary.</span></span>

<span data-ttu-id="049d3-133">Lors de la déconnexion d’un appel, il revient au MSP et au TSP de communiquer sur le déchirement de l’appel.</span><span class="sxs-lookup"><span data-stu-id="049d3-133">When a call is disconnecting, it is up to the MSP and TSP to communicate about tearing down the call.</span></span> <span data-ttu-id="049d3-134">Tapi3.dll appellera [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) si l’application appelle [**Disconnect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).</span><span class="sxs-lookup"><span data-stu-id="049d3-134">Tapi3.dll will call [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) if the application calls [**Disconnect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).</span></span>

 

 
