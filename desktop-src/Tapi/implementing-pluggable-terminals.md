---
description: Les exigences générales relatives à l’implémentation d’un terminal enfichable sont répertoriées ci-dessous.
ms.assetid: 7cee19b1-ceea-494a-b576-4deede759905
title: Implémentation de terminaux enfichables
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 494b2f6bc5ccb214bc7101f570a4db3037fd8cae
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106518729"
---
# <a name="implementing-pluggable-terminals"></a><span data-ttu-id="4f747-103">Implémentation de terminaux enfichables</span><span class="sxs-lookup"><span data-stu-id="4f747-103">Implementing Pluggable Terminals</span></span>

<span data-ttu-id="4f747-104">Les exigences générales en matière d’implémentation de terminal enfichable sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="4f747-104">The general requirements for pluggable terminal implementation are:</span></span>

-   <span data-ttu-id="4f747-105">Le code de diffusion en continu sous-jacent d’un terminal enfichable doit correspondre aux capacités des MSP souhaités.</span><span class="sxs-lookup"><span data-stu-id="4f747-105">A pluggable terminal's underlying streaming code should match the capabilities of the desired MSPs.</span></span>
-   <span data-ttu-id="4f747-106">Le terminal doit utiliser des filtres DirectShow pour travailler avec la plupart des MSP (cela est supposé ici sur).</span><span class="sxs-lookup"><span data-stu-id="4f747-106">The terminal must use DirectShow filters to work with most MSPs (this is assumed from here on).</span></span>
-   <span data-ttu-id="4f747-107">Les terminaux audio doivent prendre en charge le PCM linéaire mono 16 bits 8 kHz pour la plupart des MSP.</span><span class="sxs-lookup"><span data-stu-id="4f747-107">Audio terminals must support 8 kHz 16-bit mono linear PCM for most MSPs.</span></span>
-   <span data-ttu-id="4f747-108">Le terminal doit activer le marshaling de threads libres en implémentant [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span><span class="sxs-lookup"><span data-stu-id="4f747-108">The terminal should enable free threaded marshalling by implementing [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span></span> <span data-ttu-id="4f747-109">Pour ce faire, le terminal peut appeler l’API COM [**CoCreateFreeThreadedMarshaler**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) et agréger **IMarshal** au pointeur retourné.</span><span class="sxs-lookup"><span data-stu-id="4f747-109">The terminal can do this by calling the COM API [**CoCreateFreeThreadedMarshaler**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) and aggregating **IMarshal** to the returned pointer.</span></span> <span data-ttu-id="4f747-110">Le destructeur de l’objet terminal doit appeler [**IMarshal->Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="4f747-110">The terminal object's destructor should call [**IMarshal->Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>
-   <span data-ttu-id="4f747-111">Le terminal doit implémenter ou agréger toutes les interfaces supplémentaires spécifiques au terminal qui sont appropriées.</span><span class="sxs-lookup"><span data-stu-id="4f747-111">The terminal should implement or aggregate any additional terminal-specific interfaces that are appropriate.</span></span>
-   <span data-ttu-id="4f747-112">L’implémentation du terminal doit être thread-safe.</span><span class="sxs-lookup"><span data-stu-id="4f747-112">The terminal implementation must be thread-safe.</span></span>
-   <span data-ttu-id="4f747-113">L’implémentation de terminal doit \# inclure termmgr. h pour la définition de [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol).</span><span class="sxs-lookup"><span data-stu-id="4f747-113">The terminal implementation must \#include Termmgr.h for the definition of [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol).</span></span> <span data-ttu-id="4f747-114">Cela s’ajoute aux fichiers include et libs habituels qui sont nécessaires pour les applications TAPI 3 ou TAPI 3 sous Windows 2000 SP1.</span><span class="sxs-lookup"><span data-stu-id="4f747-114">This is in addition to the usual includes and libs that are needed for TAPI 3 or TAPI 3 applications under Windows 2000 SP1.</span></span>

<span data-ttu-id="4f747-115">Remarques sur l’implémentation des interfaces et des méthodes :</span><span class="sxs-lookup"><span data-stu-id="4f747-115">Interface and method implementation notes:</span></span>

<span data-ttu-id="4f747-116">Le terminal doit implémenter [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (interface double – vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).</span><span class="sxs-lookup"><span data-stu-id="4f747-116">The terminal must implement [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (dual interface–vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).</span></span>

[<span data-ttu-id="4f747-117">**ITTerminal :: obtient \_ TerminalClass**</span><span class="sxs-lookup"><span data-stu-id="4f747-117">**ITTerminal::get\_TerminalClass**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminalclass)

<span data-ttu-id="4f747-118">Le terminal doit retourner une représentation **BSTR** d’un GUID que vous avez choisi pour identifier votre type de terminal.</span><span class="sxs-lookup"><span data-stu-id="4f747-118">The terminal must return a **BSTR** representation of a GUID you've picked that identifies your type of terminal.</span></span> <span data-ttu-id="4f747-119">Allouez le **BSTR** via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="4f747-119">Allocate the **BSTR** via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="4f747-120">Pour convertir un GUID en **BSTR**, appelez [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **SysAllocString** et [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).</span><span class="sxs-lookup"><span data-stu-id="4f747-120">To convert from GUID to **BSTR**, call [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **SysAllocString**, and [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).</span></span>

[<span data-ttu-id="4f747-121">**ITTerminal :: obtient \_ TerminalType**</span><span class="sxs-lookup"><span data-stu-id="4f747-121">**ITTerminal::get\_TerminalType**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminaltype)

<span data-ttu-id="4f747-122">Le terminal doit généralement retourner TT \_ dynamique si une application implémente le terminal.</span><span class="sxs-lookup"><span data-stu-id="4f747-122">The terminal should generally return TT\_DYNAMIC if an application implements the terminal.</span></span> <span data-ttu-id="4f747-123">Le retour de TT \_ static fonctionne également et le retour de cette valeur peut être approprié si le terminal correspond à un périphérique matériel. Toutefois, cette opération peut être déroutante pour les utilisateurs car un terminal statique ne sera pas présent dans l’énumération des terminaux statiques du MSP.</span><span class="sxs-lookup"><span data-stu-id="4f747-123">Returning TT\_STATIC will also work, and returning this value may be appropriate if the terminal corresponds to a hardware device; however, doing this may be confusing to users because a static terminal will not be present in the MSP's static terminal enumeration.</span></span>

[<span data-ttu-id="4f747-124">**ITTerminal :: obtient l' \_ État**</span><span class="sxs-lookup"><span data-stu-id="4f747-124">**ITTerminal::get\_State**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state)

<span data-ttu-id="4f747-125">Si l’implémentation de terminal ne limite pas arbitrairement le nombre de flux auxquels le terminal peut être connecté simultanément, le terminal doit toujours retourner TS \_ NOTINUSE.</span><span class="sxs-lookup"><span data-stu-id="4f747-125">If the terminal implementation does not arbitrarily limit the number of streams that the terminal can be concurrently connected to, then the terminal should always return TS\_NOTINUSE.</span></span>

<span data-ttu-id="4f747-126">Dans le cas contraire, l’implémentation de terminal limite arbitrairement le nombre de flux auxquels le terminal peut être connecté à la fois.</span><span class="sxs-lookup"><span data-stu-id="4f747-126">Otherwise, the terminal implementation arbitrarily limits the number of streams that the terminal can be connected to at a time.</span></span> <span data-ttu-id="4f747-127">Dans ce cas, le terminal doit conserver le nombre de flux auxquels il est connecté.</span><span class="sxs-lookup"><span data-stu-id="4f747-127">In this case, the terminal should keep a count of how many streams it is connected to.</span></span> <span data-ttu-id="4f747-128">Le terminal doit incrémenter ce nombre interne lors de la réussite de l’appel de [**ITTerminalControl :: ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) et le décrémenter sur un appel de [**ITTerminalControl ::D isconnectterminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) réussi.</span><span class="sxs-lookup"><span data-stu-id="4f747-128">The terminal should increment this internal count on a successful [**ITTerminalControl::ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) call and decrement it on a successful [**ITTerminalControl::DisconnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) call.</span></span> <span data-ttu-id="4f747-129">Dans [**ITTerminal :: obtenir l' \_ État**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state), elle doit retourner TS \_ Inuse si ce nombre est égal au nombre maximal de flux que le terminal peut sélectionner à la fois ; sinon, il doit retourner TS \_ NOTINUSE.</span><span class="sxs-lookup"><span data-stu-id="4f747-129">In [**ITTerminal::get\_State**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state), it should return TS\_INUSE if this count is equal to the maximum number of streams that the terminal can be selected on at a time; otherwise, it should return TS\_NOTINUSE.</span></span> <span data-ttu-id="4f747-130">Notez que si la limite est définie sur un, le nombre peut simplement être une valeur booléenne ou d' \_ état terminal.</span><span class="sxs-lookup"><span data-stu-id="4f747-130">Note that if the limit is one, the count can simply be a Boolean or a TERMINAL\_STATE value.</span></span>

[<span data-ttu-id="4f747-131">**ITTerminal :: obtient le \_ nom**</span><span class="sxs-lookup"><span data-stu-id="4f747-131">**ITTerminal::get\_Name**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_name)

<span data-ttu-id="4f747-132">Le terminal doit retourner un nom **BSTR** de son choix, alloué via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="4f747-132">The terminal should return a **BSTR** name of its choice, allocated via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="4f747-133">Ce nom doit être significatif pour l’utilisateur et doit être localisé.</span><span class="sxs-lookup"><span data-stu-id="4f747-133">This name should be meaningful to the user and should be localized.</span></span>

[<span data-ttu-id="4f747-134">**ITTerminal :: obtient le \_ MediaType**</span><span class="sxs-lookup"><span data-stu-id="4f747-134">**ITTerminal::get\_MediaType**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_mediatype)

<span data-ttu-id="4f747-135">Le terminal doit retourner son type de média, TAPIMEDIATYPE \_ audio ou TAPIMEDIATYPE \_ Video.</span><span class="sxs-lookup"><span data-stu-id="4f747-135">The terminal should return its media type, either TAPIMEDIATYPE\_AUDIO or TAPIMEDIATYPE\_VIDEO.</span></span>

[<span data-ttu-id="4f747-136">**ITTerminal :: obtient la \_ direction**</span><span class="sxs-lookup"><span data-stu-id="4f747-136">**ITTerminal::get\_Direction**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_direction)

<span data-ttu-id="4f747-137">Le terminal renvoie la \_ valeur d’énumération de la direction du terminal indiquant la direction du terminal.</span><span class="sxs-lookup"><span data-stu-id="4f747-137">The terminal returns the TERMINAL\_DIRECTION enum value indicating the direction of the terminal.</span></span> <span data-ttu-id="4f747-138">Si le terminal est bidirectionnel (par exemple, un pont), il doit retourner TD \_ bidirectionnel.</span><span class="sxs-lookup"><span data-stu-id="4f747-138">If the terminal is bidirectional (for example, a bridge), then it must return TD\_BIDIRECTIONAL.</span></span>

<span data-ttu-id="4f747-139">Le terminal doit implémenter [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (vtable uniquement).</span><span class="sxs-lookup"><span data-stu-id="4f747-139">The terminal must implement [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (vtable only).</span></span>

[<span data-ttu-id="4f747-140">**ITTerminalControl :: obtient \_ AddressHandle**</span><span class="sxs-lookup"><span data-stu-id="4f747-140">**ITTerminalControl::get\_AddressHandle**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-get_addresshandle)

<span data-ttu-id="4f747-141">Un terminal fourni par l’application doit toujours retourner la **valeur null** comme handle d’adresse.</span><span class="sxs-lookup"><span data-stu-id="4f747-141">An application-provided terminal should always return **NULL** as the address handle.</span></span> <span data-ttu-id="4f747-142">Cela indique au MSP que ce terminal n’a pas été créé sur un objet d’adresse MSP spécifique.</span><span class="sxs-lookup"><span data-stu-id="4f747-142">This indicates to the MSP that this terminal was not created on a specific MSP address object.</span></span>

[<span data-ttu-id="4f747-143">**ITTerminalControl::ConnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="4f747-143">**ITTerminalControl::ConnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal)

<span data-ttu-id="4f747-144">Sur cet appel, le terminal ajoute ses filtres au graphique donné et s’y connecte, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="4f747-144">On this call, the terminal will add its filter(s) to the given graph and connect them to each other, if applicable.</span></span> <span data-ttu-id="4f747-145">Le terminal doit ensuite renvoyer le ou les codes confidentiels exposés par le terminal pour la direction du flux spécifiée.</span><span class="sxs-lookup"><span data-stu-id="4f747-145">Then the terminal should return the pin(s) exposed by the terminal for the stream direction specified.</span></span>

<span data-ttu-id="4f747-146">Un terminal qui ne prend pas en charge la connexion simultanée à plusieurs flux définit une variable interne sur TS \_ Inuse en cas de réussite de l’exécution de cette méthode.</span><span class="sxs-lookup"><span data-stu-id="4f747-146">A terminal that does not support concurrent connection to multiple streams would set an internal variable to TS\_INUSE on successful completion of this method.</span></span>

<span data-ttu-id="4f747-147">Le terminal peut utiliser le paramètre *dwTerminalDirection* à partir de cet appel pour déterminer la direction du flux auquel il est connecté.</span><span class="sxs-lookup"><span data-stu-id="4f747-147">The terminal can use the *dwTerminalDirection* parameter from this call to determine the direction of the stream that it is being connected to.</span></span> <span data-ttu-id="4f747-148">Cela est nécessaire pour les terminaux bidirectionnels.</span><span class="sxs-lookup"><span data-stu-id="4f747-148">This is required for bidirectional terminals.</span></span>

> [!Note]  
> <span data-ttu-id="4f747-149">En général (dans les classes de base MSP et dans tous les MSP connus), le code de flux MSP échoue à la connexion si le terminal renvoie plusieurs codes confidentiels à partir d’un seul appel [**ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) .</span><span class="sxs-lookup"><span data-stu-id="4f747-149">Typically (in the MSP base classes and in all known MSPs), the MSP stream code will fail the connection if the terminal returns more than one pin from a single [**ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) call.</span></span> <span data-ttu-id="4f747-150">Cela est parfait, car un terminal qui retourne plus d’un code confidentiel pendant la connexion requiert que le MSP ait une connaissance particulière du terminal pour pouvoir utiliser efficacement les codes confidentiels supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="4f747-150">This is fine, because a terminal that returns more than one pin during connection requires the MSP to have special knowledge of the terminal to make use of the extra pins effectively.</span></span>

 

[<span data-ttu-id="4f747-151">**ITTerminalControl::CompleteConnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="4f747-151">**ITTerminalControl::CompleteConnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-completeconnectterminal)

<span data-ttu-id="4f747-152">Le terminal doit simplement retourner S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="4f747-152">The terminal should just return S\_OK.</span></span> <span data-ttu-id="4f747-153">Le terminal peut également effectuer une initialisation après la connexion si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="4f747-153">The terminal may also do post-connection initialization if it needs to.</span></span>

[<span data-ttu-id="4f747-154">**ITTerminalControl ::D isconnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="4f747-154">**ITTerminalControl::DisconnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal)

<span data-ttu-id="4f747-155">Le terminal doit effectuer tout ce qui est nécessaire pour déconnecter le terminal du reste du graphique.</span><span class="sxs-lookup"><span data-stu-id="4f747-155">The terminal should do whatever is needed to disconnect the terminal from the rest of the graph.</span></span> <span data-ttu-id="4f747-156">En général, cela implique de supprimer tous les filtres des terminaux du graphique et de définir l’état du terminal sur TS \_ NOTINUSE.</span><span class="sxs-lookup"><span data-stu-id="4f747-156">Typically this involves removing all the terminals' filters from the graph and setting the terminal state to TS\_NOTINUSE.</span></span>

[<span data-ttu-id="4f747-157">**ITTerminalControl::RunRenderFilter**</span><span class="sxs-lookup"><span data-stu-id="4f747-157">**ITTerminalControl::RunRenderFilter**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-runrenderfilter)

<span data-ttu-id="4f747-158">Le terminal doit simplement retourner E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="4f747-158">The terminal should just return E\_NOTIMPL.</span></span>

[<span data-ttu-id="4f747-159">**ITTerminalControl::StopRenderFilter**</span><span class="sxs-lookup"><span data-stu-id="4f747-159">**ITTerminalControl::StopRenderFilter**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-stoprenderfilter)

<span data-ttu-id="4f747-160">Le terminal doit simplement retourner E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="4f747-160">The terminal should just return E\_NOTIMPL.</span></span>

 

 
