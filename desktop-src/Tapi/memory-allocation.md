---
description: Les applications doivent allouer de la mémoire pour ces données ; L’interface TAPI et le fournisseur de services fournissent les données. Si l’opération est asynchrone, les données ne sont pas disponibles tant que le message de réponse asynchrone n’indique pas la réussite.
ms.assetid: 61313fe3-74a1-4195-b5af-37463dad02c1
title: Allocation de mémoire
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f192e34fdc652293c480277631c3839ecd2435fc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106514374"
---
# <a name="memory-allocation"></a><span data-ttu-id="f3cb0-104">Allocation de mémoire</span><span class="sxs-lookup"><span data-stu-id="f3cb0-104">Memory Allocation</span></span>

<span data-ttu-id="f3cb0-105">Les applications doivent allouer de la mémoire pour ces données ; L’interface TAPI et le fournisseur de services fournissent les données.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-105">Applications must allocate memory for this data; TAPI and the service provider provide the data.</span></span> <span data-ttu-id="f3cb0-106">Si l’opération est asynchrone, les données ne sont pas disponibles tant que le message de réponse asynchrone n’indique pas la réussite.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-106">If the operation is asynchronous, the data is not available until the asynchronous reply message indicates success.</span></span>

<span data-ttu-id="f3cb0-107">Toutes les structures de données utilisées pour passer des données entre l’application et l’interface TAPI sont *aplaties*.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-107">All data structures used to pass data between the application and the TAPI are *flattened*.</span></span> <span data-ttu-id="f3cb0-108">Autrement dit, les structures de données ne contiennent pas de pointeurs vers les sous-structures qui contiennent des composants de données de taille variable.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-108">That is, data structures do not contain pointers to substructures that contain variably sized data components.</span></span> <span data-ttu-id="f3cb0-109">Au lieu de cela, les structures de données utilisées pour passer des quantités variables de données à l’application doivent avoir la nanostructure suivante :</span><span class="sxs-lookup"><span data-stu-id="f3cb0-109">Instead, data structures used to pass variable amounts of data back to the application must have the following metastructure:</span></span>

``` syntax
  DWORD  dwTotalSize;
  DWORD  dwNeededSize;
  DWORD  dwUsedSize; 
    <fixed size fields> 
  DWORD  dw<VarSizeField1>Size;
  DWORD  dw<VarSizeField1>Offset; 
    <fixed size fields> 
  DWORD  dw<VarSizeField2>Size;
  DWORD  dw<VarSizeField2>Offset; 
    <common extensions> 
    <var sized field1> 
    <var sized field2>
```

<span data-ttu-id="f3cb0-110">Le membre **dwTotalSize** est la taille, en octets, allouée à cette structure de données.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-110">The **dwTotalSize** member is the size, in bytes, allocated to this data structure.</span></span> <span data-ttu-id="f3cb0-111">Elle marque la fin de la structure de données et est définie par l’application avant d’appeler la fonction qui utilise cette structure de données.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-111">It marks the end of the data structure and is set by the application before it invokes the function that uses this data structure.</span></span> <span data-ttu-id="f3cb0-112">La fonction ne lit pas ou n’écrit pas au-delà de cette taille.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-112">The function does not read or write beyond this size.</span></span> <span data-ttu-id="f3cb0-113">Une application doit définir le membre **dwTotalSize** pour indiquer le nombre total d’octets alloués pour que l’interface TAPI retourne le contenu de la structure.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-113">An application must set the **dwTotalSize** member to indicate the total number of bytes allocated for TAPI to return the contents of the structure.</span></span>

<span data-ttu-id="f3cb0-114">L’interface TAPI remplit le membre **dwNeededSize** .</span><span class="sxs-lookup"><span data-stu-id="f3cb0-114">TAPI fills in the **dwNeededSize** member.</span></span> <span data-ttu-id="f3cb0-115">Elle indique le nombre d’octets requis pour retourner toutes les données demandées.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-115">It indicates how many bytes are required to return all the requested data.</span></span> <span data-ttu-id="f3cb0-116">L’existence de champs de taille variable rend souvent impossible pour l’application d’estimer la taille de la structure de données requise pour l’allocation.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-116">The existence of variably sized fields often makes it impossible for the application to estimate the data structure size required to allocate.</span></span> <span data-ttu-id="f3cb0-117">Ce champ retourne le nombre d’octets réellement requis pour les données.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-117">This field returns the number of bytes actually required for the data.</span></span> <span data-ttu-id="f3cb0-118">Ce nombre peut être inférieur, égal ou supérieur à **dwTotalSize**, et il comprend de l’espace pour le membre **dwTotalSize** lui-même.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-118">This number could be smaller than, equal to, or larger than **dwTotalSize**, and it includes space for the **dwTotalSize** member itself.</span></span> <span data-ttu-id="f3cb0-119">Si la taille est supérieure, la structure retournée n’est que partiellement remplie.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-119">If larger, the returned structure is only partially filled.</span></span> <span data-ttu-id="f3cb0-120">Si les champs requis par l’application sont disponibles dans la structure partielle, rien d’autre ne doit être fait.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-120">If the fields the application requires are available in the partial structure, nothing else must be done.</span></span> <span data-ttu-id="f3cb0-121">Dans le cas contraire, l’application doit allouer une structure au moins à la taille de **dwNeededSize** et appeler à nouveau la fonction.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-121">Otherwise, the application should allocate a structure at least the size of **dwNeededSize** and invoke the function again.</span></span> <span data-ttu-id="f3cb0-122">En règle générale, un espace suffisant est disponible cette fois pour renvoyer toutes les informations, bien qu’il soit possible que la taille soit de nouveau augmentée.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-122">Usually, enough space is available this time to return all the information, although it is possible the size could have increased again.</span></span>

<span data-ttu-id="f3cb0-123">L’interface TAPI remplit le membre **dwUsedSize** s’il retourne des données à l’application pour indiquer la taille réelle, en octets, de la partie de la structure de données qui contient des données utiles.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-123">TAPI fills the **dwUsedSize** member if it returns data to the application to indicate the actual size, in bytes, of the portion of the data structure that contains useful data.</span></span> <span data-ttu-id="f3cb0-124">Si, par exemple, une structure qui a été allouée était trop petite et que le champ tronqué est un champ de taille variable, **dwNeededSize** est plus grand que **dwTotalSize** et le champ tronqué est laissé vide.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-124">If, for example, a structure that was allocated was too small and the truncated field is a variably sized field, **dwNeededSize** is larger than **dwTotalSize**, and the truncated field is left empty.</span></span> <span data-ttu-id="f3cb0-125">Le membre **dwUsedSize** peut donc être plus petit que **dwTotalSize**.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-125">The **dwUsedSize** member could therefore be smaller than **dwTotalSize**.</span></span> <span data-ttu-id="f3cb0-126">Les valeurs de champ partielles ne sont pas retournées.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-126">Partial field values are not returned.</span></span>

<span data-ttu-id="f3cb0-127">Le fait de suivre cet en-tête est la partie fixe de la structure de données.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-127">Following this header is the fixed part of the data structure.</span></span> <span data-ttu-id="f3cb0-128">Il contient des champs normaux et des paires taille/décalage qui décrivent les champs de taille variable réels.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-128">It contains regular fields and size/offset pairs that describe the actual variably sized fields.</span></span> <span data-ttu-id="f3cb0-129">Le champ décalage contient le décalage en octets du champ de taille variable à partir du début de l’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-129">The offset field contains the offset in bytes of the variably sized field from the beginning of the record.</span></span> <span data-ttu-id="f3cb0-130">Le champ Taille contient la taille en octets du champ de taille variable.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-130">The size field contains the size in bytes of the variably sized field.</span></span> <span data-ttu-id="f3cb0-131">Si un champ de taille variable est vide, le champ taille est égal à zéro et le décalage est défini sur zéro.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-131">If a variably sized field is empty, then the size field is zero and the offset is set to zero.</span></span> <span data-ttu-id="f3cb0-132">Les champs de taille variable qui seraient tronqués si la taille totale de la structure est insuffisante sont laissés vides.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-132">Variably sized fields that would be truncated if the total structure size is insufficient are left empty.</span></span> <span data-ttu-id="f3cb0-133">Autrement dit, leur champ de taille est défini sur zéro et le décalage est défini sur zéro.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-133">That is, their size field is set to zero and the offset is set to zero.</span></span> <span data-ttu-id="f3cb0-134">Les champs de taille variable suivent les champs fixes.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-134">The variably sized fields follow the fixed fields.</span></span>

<span data-ttu-id="f3cb0-135">Si le fournisseur de services doit remplir un membre de variable, TAPI initialise la taille et les membres de décalage correspondants à zéro.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-135">If the service provider must fill a variable member, TAPI initializes the corresponding size and offset members to zero.</span></span> <span data-ttu-id="f3cb0-136">Si le fournisseur de services remplit le membre de la variable, il doit définir les membres size et offset correspondants aux valeurs appropriées, y compris **dwUsedSize** et **dwNeededSize** s’il définit des membres de variable.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-136">If the service provider fills in the variable member, it must set the corresponding size and offset members to appropriate values, including **dwUsedSize** and **dwNeededSize** if it sets variable members.</span></span> <span data-ttu-id="f3cb0-137">Le fournisseur de services ne doit pas tronquer un membre de variable pour l’adapter à l’espace disponible.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-137">The service provider must not truncate a variable member to make it fit into the available space.</span></span>

<span data-ttu-id="f3cb0-138">Le fournisseur de services doit démarrer les membres de variable immédiatement après les membres fixes de la structure, et conserver tout espace supplémentaire à la fin de la mémoire allouée afin que TAPI puisse l’utiliser pour les membres de longueur variable.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-138">The service provider must start variable members immediately after the fixed members of the structure, and leave any extra space at the end of the allocated memory so that TAPI can use it for the variable-length members.</span></span> <span data-ttu-id="f3cb0-139">Elle peut placer les membres de la variable dans n’importe quel ordre, mais les membres doivent être contigus.</span><span class="sxs-lookup"><span data-stu-id="f3cb0-139">It can place the variable members in any order, but the members must be contiguous.</span></span>

 

 



