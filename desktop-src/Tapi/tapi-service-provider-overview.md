---
description: Les applications TAPI résident dans leur propre espace de processus.
ms.assetid: 57dedad1-7264-48fc-9ac2-c6c72f7fee27
title: Vue d’ensemble du fournisseur de services TAPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7e847ed49879e9ff55662477a762fa7297443d12
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104567417"
---
# <a name="tapi-service-provider-overview"></a><span data-ttu-id="d31bb-103">Vue d’ensemble du fournisseur de services TAPI</span><span class="sxs-lookup"><span data-stu-id="d31bb-103">TAPI Service Provider Overview</span></span>

<span data-ttu-id="d31bb-104">Les applications TAPI résident dans leur propre espace de processus.</span><span class="sxs-lookup"><span data-stu-id="d31bb-104">TAPI applications reside in their own process space.</span></span> <span data-ttu-id="d31bb-105">Les applications TAPI chargent les Tapi32.dll ou Tapi3.dll dans leur processus, et l’interface TAPI communique avec TAPISRV via une interface RPC privée.</span><span class="sxs-lookup"><span data-stu-id="d31bb-105">TAPI applications load the Tapi32.dll or Tapi3.dll into their process, and TAPI communicates with TAPISRV through a private RPC interface.</span></span> <span data-ttu-id="d31bb-106">Un TSP s’exécute dans le contexte de TAPISRV.</span><span class="sxs-lookup"><span data-stu-id="d31bb-106">A TSP runs in the context of TAPISRV.</span></span> <span data-ttu-id="d31bb-107">Un TSP donné peut résider sur un ordinateur autre que l’ordinateur de l’utilisateur et est accessible à l’aide d’un TSP distant.</span><span class="sxs-lookup"><span data-stu-id="d31bb-107">A given TSP may reside on a machine other than the user's machine and is accessed using a remote TSP.</span></span> <span data-ttu-id="d31bb-108">TAPISRV est implémenté en tant que processus de service dans SVCHOST.</span><span class="sxs-lookup"><span data-stu-id="d31bb-108">TAPISRV is implemented as a service process within SVCHOST.</span></span> <span data-ttu-id="d31bb-109">Un MSP réside dans l’espace de processus de l’application et est toujours local.</span><span class="sxs-lookup"><span data-stu-id="d31bb-109">An MSP lives within the process space of the application and is always local.</span></span>

<span data-ttu-id="d31bb-110">Une paire TSP/MSP peut être considérée comme ayant un chemin de communication privé virtuel.</span><span class="sxs-lookup"><span data-stu-id="d31bb-110">A TSP/MSP pair can be regarded as having a virtual private communication path.</span></span> <span data-ttu-id="d31bb-111">Les informations peuvent être envoyées entre les deux à l’aide de mémoires tampon opaques qui ne sont pas interprétées par TAPISRV ou par la DLL TAPI.</span><span class="sxs-lookup"><span data-stu-id="d31bb-111">Information can be sent between the two using opaque buffers that are not interpreted by either TAPISRV or the TAPI DLL.</span></span>

<span data-ttu-id="d31bb-112">Certains fournisseurs de services implémentent des opérations spécifiques au matériel impliqué.</span><span class="sxs-lookup"><span data-stu-id="d31bb-112">Some service providers implement operations specific to the hardware involved.</span></span> <span data-ttu-id="d31bb-113">TAPI 2. x donne accès à ces opérations via la fonction [**lineDevSpecific**](/windows/win32/api/tapi/nf-tapi-linedevspecific) ou [**phoneDevSpecific**](/windows/win32/api/tapi/nf-tapi-phonedevspecific) .</span><span class="sxs-lookup"><span data-stu-id="d31bb-113">TAPI 2.x provides access to such operations through the [**lineDevSpecific**](/windows/win32/api/tapi/nf-tapi-linedevspecific) or [**phoneDevSpecific**](/windows/win32/api/tapi/nf-tapi-phonedevspecific) function.</span></span> <span data-ttu-id="d31bb-114">TAPI 3. x expose [des interfaces spécifiques au fournisseur](./provider-specific-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="d31bb-114">TAPI 3.x exposes [provider-specific Interfaces](./provider-specific-interfaces.md).</span></span>

<span data-ttu-id="d31bb-115">Le diagramme suivant illustre le déroulement des contrôles et des informations, en montrant un TSP autonome (Unimodem) et une paire TSP/MSP (H. 323).</span><span class="sxs-lookup"><span data-stu-id="d31bb-115">The following diagram illustrates the flow of controls and information, showing one stand-alone TSP (Unimodem) and one TSP/MSP pair (H.323).</span></span>

![PVC autonome et le flot de contrôle et d’informations du PVC/MSP couplé](images/tsp-msp1.png)

<span data-ttu-id="d31bb-117">Le diagramme suivant illustre la progression d’un appel entrant qui implique à la fois un TSP et un MSP.</span><span class="sxs-lookup"><span data-stu-id="d31bb-117">The following diagram illustrates the progress of an incoming call that involves both a TSP and an MSP.</span></span>

![appel entrant avec un TSP et un MSP](images/tspmspin.png)

## <a name="incoming-call-setup"></a><span data-ttu-id="d31bb-119">Configuration de l’appel entrant</span><span class="sxs-lookup"><span data-stu-id="d31bb-119">Incoming Call Setup</span></span>

-   <span data-ttu-id="d31bb-120">Le TSP envoie un message de [**ligne \_ NEWCALL**](line-newcall.md) à tapisrv.</span><span class="sxs-lookup"><span data-stu-id="d31bb-120">The TSP sends a [**LINE\_NEWCALL**](line-newcall.md) message to TAPISRV.</span></span> <span data-ttu-id="d31bb-121">L' [**État**](./linecallstate--constants.md) de l’appel est LINECALLSTATE \_ .</span><span class="sxs-lookup"><span data-stu-id="d31bb-121">The [**call state**](./linecallstate--constants.md) is LINECALLSTATE\_OFFERING.</span></span>
-   <span data-ttu-id="d31bb-122">TAPISRV notifie les clients de l’appel.</span><span class="sxs-lookup"><span data-stu-id="d31bb-122">TAPISRV notifies clients of the call.</span></span>
-   <span data-ttu-id="d31bb-123">TAPI3 crée l’objet d’appel TAPI, puis appelle [**ITMSPAddress :: CreateMSPCall**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-createmspcall), qui est implémenté par le MSP.</span><span class="sxs-lookup"><span data-stu-id="d31bb-123">TAPI3 creates the TAPI Call object, then calls [**ITMSPAddress::CreateMSPCall**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-createmspcall), which is implemented by the MSP.</span></span>
-   <span data-ttu-id="d31bb-124">Le MSP crée un objet d’appel MSP et des flux par défaut en fonction des [**types de médias**](./tapimediatype--constants.md) requis pour l’appel.</span><span class="sxs-lookup"><span data-stu-id="d31bb-124">The MSP creates an MSP Call object and default streams based on the [**media types**](./tapimediatype--constants.md) required for the call.</span></span> <span data-ttu-id="d31bb-125">Elle retourne un pointeur IUnknown vers l’objet d’appel MSP.</span><span class="sxs-lookup"><span data-stu-id="d31bb-125">It returns an IUnknown pointer to the MSP call object.</span></span>
-   <span data-ttu-id="d31bb-126">TAPI3 agrège l’objet d’appel MSP dans l’objet d’appel TAPI, ce qui rend les interfaces telles que [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) disponibles pour l’application.</span><span class="sxs-lookup"><span data-stu-id="d31bb-126">TAPI3 aggregates the MSP Call object into the TAPI Call object, making interfaces such as [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) available to the application.</span></span> <span data-ttu-id="d31bb-127">Il avertit ensuite l’application du nouvel appel.</span><span class="sxs-lookup"><span data-stu-id="d31bb-127">It then notifies the application of the new call.</span></span>

<span data-ttu-id="d31bb-128">L’application peut ensuite utiliser des méthodes telles que [**ITStream :: SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) pour terminer les préparatifs de la fin de l’appel.</span><span class="sxs-lookup"><span data-stu-id="d31bb-128">The application may then use methods such as [**ITStream::SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) to complete preparations for call completion.</span></span>

## <a name="incoming-call-completion"></a><span data-ttu-id="d31bb-129">Fin de l’appel entrant</span><span class="sxs-lookup"><span data-stu-id="d31bb-129">Incoming Call Completion</span></span>

-   <span data-ttu-id="d31bb-130">L’application appelle [**ITBasicCallControl :: Answer**](/windows/win32/api/tapi3if/nf-tapi3if-itbasiccallcontrol-answer).</span><span class="sxs-lookup"><span data-stu-id="d31bb-130">The application calls [**ITBasicCallControl::Answer**](/windows/win32/api/tapi3if/nf-tapi3if-itbasiccallcontrol-answer).</span></span>
-   <span data-ttu-id="d31bb-131">TAPI3 appelle [**lineAnswer**](/windows/win32/api/tapi/nf-tapi-lineanswer).</span><span class="sxs-lookup"><span data-stu-id="d31bb-131">TAPI3 calls [**lineAnswer**](/windows/win32/api/tapi/nf-tapi-lineanswer).</span></span>
-   <span data-ttu-id="d31bb-132">TAPISERV appelle [**TSPI \_ lineAnswer**](/windows/win32/api/tspi/nf-tspi-tspi_lineanswer).</span><span class="sxs-lookup"><span data-stu-id="d31bb-132">TAPISERV calls [**TSPI\_lineAnswer**](/windows/win32/api/tspi/nf-tspi-tspi_lineanswer).</span></span>
-   <span data-ttu-id="d31bb-133">Le TSP lance la diffusion en continu des appels.</span><span class="sxs-lookup"><span data-stu-id="d31bb-133">The TSP initiates call streaming.</span></span> <span data-ttu-id="d31bb-134">En règle générale, le TSP envoie un message au MSP correspondant, et le MSP démarre les flux.</span><span class="sxs-lookup"><span data-stu-id="d31bb-134">Usually, the TSP sends a message to the corresponding MSP, and the MSP starts the streams.</span></span> <span data-ttu-id="d31bb-135">Dans certaines implémentations de TSP/MSP, le TSP démarre les flux.</span><span class="sxs-lookup"><span data-stu-id="d31bb-135">In some TSP/MSP implementations, the TSP starts the streams.</span></span>

## <a name="tspmsp-communication-during-call-progress"></a><span data-ttu-id="d31bb-136">Communication TSP/MSP pendant la progression de l’appel</span><span class="sxs-lookup"><span data-stu-id="d31bb-136">TSP/MSP Communication During Call Progress</span></span>

<span data-ttu-id="d31bb-137">Une fois l’appel en cours, le TSP et le MSP communiquent en passant les mémoires tampon opaques via TAPISRV et TAPI3.</span><span class="sxs-lookup"><span data-stu-id="d31bb-137">After the call is in progress, the TSP and the MSP communicate by passing opaque buffers through TAPISRV and TAPI3.</span></span>

-   <span data-ttu-id="d31bb-138">Le TSP envoie des informations au MSP en envoyant la [**ligne \_ SENDMSPDATA**](line-sendmspdata.md) message à tapisrv.</span><span class="sxs-lookup"><span data-stu-id="d31bb-138">The TSP sends information to the MSP by sending the [**LINE\_SENDMSPDATA**](line-sendmspdata.md) message to TAPISRV.</span></span>
-   <span data-ttu-id="d31bb-139">Le MSP reçoit des informations du TSP via la méthode [**ITMSPAddress :: ReceiveTSPData**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-receivetspdata) .</span><span class="sxs-lookup"><span data-stu-id="d31bb-139">The MSP receives information from the TSP through the [**ITMSPAddress::ReceiveTSPData**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-receivetspdata) method.</span></span> <span data-ttu-id="d31bb-140">Si les données sont associées à un objet d’appel MSP, un pointeur d’interface vers l’objet d’appel MSP est fourni en tant que paramètre de cette méthode.</span><span class="sxs-lookup"><span data-stu-id="d31bb-140">If the data is related to a MSP call object, an interface pointer to the MSP call object is provided as a parameter of that method.</span></span>
-   <span data-ttu-id="d31bb-141">Le MSP envoie des informations au TSP en envoyant un \_ événement de \_ données MSP du TSP à TAPI 3.</span><span class="sxs-lookup"><span data-stu-id="d31bb-141">The MSP sends information to the TSP by sending a MSP\_TSP\_DATA event to TAPI 3.</span></span>
-   <span data-ttu-id="d31bb-142">Le TSP reçoit des informations du MSP via la fonction [**TSPI \_ lineReceiveMSPData**](/windows/win32/api/tspi/nf-tspi-tspi_linereceivemspdata) .</span><span class="sxs-lookup"><span data-stu-id="d31bb-142">The TSP receives information from the MSP through the [**TSPI\_lineReceiveMSPData**](/windows/win32/api/tspi/nf-tspi-tspi_linereceivemspdata) function.</span></span>

<span data-ttu-id="d31bb-143">Le processus et le contenu exacts de la communication entre les fournisseurs de services sont spécifiques à un TSP/MSP donné.</span><span class="sxs-lookup"><span data-stu-id="d31bb-143">The exact process and content of communication between service providers is specific to a given TSP/MSP set.</span></span>

> [!Note]  
> <span data-ttu-id="d31bb-144">Pour les appels sortants, le MSP connaît généralement l’appel avant le TSP.</span><span class="sxs-lookup"><span data-stu-id="d31bb-144">For outgoing calls, the MSP typically knows about the call before the TSP.</span></span> <span data-ttu-id="d31bb-145">Si le MSP tente de communiquer avec le TSP avant que le TSP soit informé d’un appel, la communication échoue.</span><span class="sxs-lookup"><span data-stu-id="d31bb-145">If the MSP tries to communicate with the TSP before the TSP is informed about a call, the communication will fail.</span></span> <span data-ttu-id="d31bb-146">Lorsque le MSP et le TSP doivent échanger des informations concernant un appel spécifique, le TSP doit lancer la communication.</span><span class="sxs-lookup"><span data-stu-id="d31bb-146">When the MSP and the TSP need to exchange information concerning a specific call, the TSP should initiate communication.</span></span>

 

 

 
