---
title: Bluetooth et options de socket
description: Bluetooth pour Windows prend en charge les options de socket suivantes.
ms.assetid: e2e305c2-e749-4566-8e24-c07a7a29c612
keywords:
- Bluetooth et options de Socket Bluetooth
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 84040a98c3dae1fec292e4f0a7086f11d1ee546c
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103941080"
---
# <a name="bluetooth-and-socket-options"></a><span data-ttu-id="2903a-104">Bluetooth et options de socket</span><span class="sxs-lookup"><span data-stu-id="2903a-104">Bluetooth and Socket Options</span></span>

<span data-ttu-id="2903a-105">Bluetooth pour Windows prend en charge les options de socket suivantes.</span><span class="sxs-lookup"><span data-stu-id="2903a-105">Bluetooth for Windows supports the following socket options.</span></span> <span data-ttu-id="2903a-106">Les options de socket sont définies et interrogées à l’aide des fonctions [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) et [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) , respectivement.</span><span class="sxs-lookup"><span data-stu-id="2903a-106">Socket options are set and queried using the [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) and [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) functions, respectively.</span></span> <span data-ttu-id="2903a-107">Toutes les options suivantes peuvent être utilisées avec la fonction **setsockopt** , mais seule l’option **SO de l' \_ \_ unité MTU de BTH** est disponible pour une utilisation avec la fonction **getsockopt** .</span><span class="sxs-lookup"><span data-stu-id="2903a-107">All of the following options can be used with the **setsockopt** function, but only the **SO\_BTH\_MTU** option is available for use with the **getsockopt** function.</span></span>

<span data-ttu-id="2903a-108">Les paramètres suivants sont requis pour l’utilisation des options de Socket Bluetooth :</span><span class="sxs-lookup"><span data-stu-id="2903a-108">The following settings are required for working with Bluetooth socket options:</span></span>

-   <span data-ttu-id="2903a-109">Le paramètre *s* doit être un Socket Bluetooth.</span><span class="sxs-lookup"><span data-stu-id="2903a-109">The *s* parameter must be a Bluetooth socket.</span></span>
-   <span data-ttu-id="2903a-110">Le paramètre de *niveau* doit être **sol \_ RFCOMM**.</span><span class="sxs-lookup"><span data-stu-id="2903a-110">The *level* parameter must be **SOL\_RFCOMM**.</span></span>

## <a name="so_bth_authenticate"></a><span data-ttu-id="2903a-111">par conséquent, \_ BTH \_ Authenticate</span><span class="sxs-lookup"><span data-stu-id="2903a-111">SO\_BTH\_AUTHENTICATE</span></span>

<span data-ttu-id="2903a-112">Pour les sockets déconnectés, l’authentification **\_ BTH de BTH \_** spécifie que l’authentification est requise pour que l’opération de [**connexion**](/windows/desktop/api/winsock2/nf-winsock2-connect) ou d' [**acceptation**](/windows/desktop/api/winsock2/nf-winsock2-accept) se termine correctement.</span><span class="sxs-lookup"><span data-stu-id="2903a-112">For disconnected sockets, the **SO\_BTH\_AUTHENTICATE** specifies that authentication is required for a [**connect**](/windows/desktop/api/winsock2/nf-winsock2-connect) or [**accept**](/windows/desktop/api/winsock2/nf-winsock2-accept) operation to complete successfully.</span></span> <span data-ttu-id="2903a-113">La définition de cette option de socket lance activement l’authentification lors de l’établissement de la connexion, si les deux périphériques Bluetooth n’ont pas été authentifiés précédemment.</span><span class="sxs-lookup"><span data-stu-id="2903a-113">Setting this socket option actively initiates authentication during connection establishment, if the two Bluetooth devices were not previously authenticated.</span></span> <span data-ttu-id="2903a-114">L’interface utilisateur pour l’échange de clé d’aide, si nécessaire, est fournie par le système d’exploitation en dehors du contexte de l’application.</span><span class="sxs-lookup"><span data-stu-id="2903a-114">The user interface for passkey exchange, if necessary, is provided by the operating system outside the application context.</span></span>

<span data-ttu-id="2903a-115">Pour les connexions sortantes qui requièrent une authentification, l’opération de [**connexion**](/windows/desktop/api/winsock2/nf-winsock2-connect) échoue avec **WSAEACCES** si l’authentification échoue.</span><span class="sxs-lookup"><span data-stu-id="2903a-115">For outgoing connections that require authentication, the [**connect**](/windows/desktop/api/winsock2/nf-winsock2-connect) operation fails with **WSAEACCES** if authentication is not successful.</span></span> <span data-ttu-id="2903a-116">En réponse, l’application peut inviter l’utilisateur à authentifier les deux périphériques Bluetooth avant la connexion.</span><span class="sxs-lookup"><span data-stu-id="2903a-116">In response, the application may prompt the user to authenticate the two Bluetooth devices before connection.</span></span>

<span data-ttu-id="2903a-117">Pour les connexions entrantes, la connexion est rejetée si l’authentification ne peut pas être établie et renvoie une erreur **WSAEHOSTDOWN** .</span><span class="sxs-lookup"><span data-stu-id="2903a-117">For incoming connections, the connection is rejected if authentication cannot be established and returns a **WSAEHOSTDOWN** error.</span></span> <span data-ttu-id="2903a-118">Pour plus d’informations sur l’authentification des appareils Bluetooth, consultez [**BluetoothAuthenticateDevice**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice).</span><span class="sxs-lookup"><span data-stu-id="2903a-118">For more information about authenticating Bluetooth devices, see [**BluetoothAuthenticateDevice**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice).</span></span>

<span data-ttu-id="2903a-119">Pour l’option de socket **\_ \_ authentification BTH so** , *OPTVAL* est un pointeur vers ulong BAuthenticate et doit avoir la **valeur true**; *optlen* est équivalent à « sizeof (ULONG) ».</span><span class="sxs-lookup"><span data-stu-id="2903a-119">For the **SO\_BTH\_AUTHENTICATE** socket option, *optval* is a pointer to ULONG bAuthenticate and must be **TRUE**; *optlen* is equivalent to "sizeof(ULONG)".</span></span>

<span data-ttu-id="2903a-120">**Windows XP avec SP2 : so \_ BTH \_ Authenticate** démarre l’authentification pour les sockets connectés et force l’authentification lors de la connexion pour les sockets non connectés.</span><span class="sxs-lookup"><span data-stu-id="2903a-120">**Windows XP with SP2:  SO\_BTH\_AUTHENTICATE** starts authentication for connected sockets, and forces authentication upon connection for unconnected sockets.</span></span> <span data-ttu-id="2903a-121">Pour les connexions entrantes, la connexion est rejetée si l’authentification ne peut pas être effectuée.</span><span class="sxs-lookup"><span data-stu-id="2903a-121">For incoming connections, the connection is rejected if authentication cannot be performed.</span></span>

## <a name="so_bth_encrypt"></a><span data-ttu-id="2903a-122">par conséquent, \_ BTH \_ Encrypt</span><span class="sxs-lookup"><span data-stu-id="2903a-122">SO\_BTH\_ENCRYPT</span></span>

<span data-ttu-id="2903a-123">Sur les sockets non connectés, l’option de socket de **\_ \_ chiffrement BTH** permet d’appliquer le chiffrement pour établir une connexion.</span><span class="sxs-lookup"><span data-stu-id="2903a-123">On unconnected sockets, the **SO\_BTH\_ENCRYPT** socket option enforces encryption to establish a connection.</span></span> <span data-ttu-id="2903a-124">Le chiffrement est disponible uniquement pour les connexions authentifiées.</span><span class="sxs-lookup"><span data-stu-id="2903a-124">Encryption is only available for authenticated connections.</span></span> <span data-ttu-id="2903a-125">Pour les connexions entrantes, une connexion pour laquelle le chiffrement ne peut pas être établi est automatiquement rejetée et retourne **WSAEHOSTDOWN** comme erreur.</span><span class="sxs-lookup"><span data-stu-id="2903a-125">For incoming connections, a connection for which encryption cannot be established is automatically rejected and returns **WSAEHOSTDOWN** as the error.</span></span> <span data-ttu-id="2903a-126">Pour les connexions sortantes, la fonction [**Connect**](/windows/desktop/api/winsock2/nf-winsock2-connect) échoue avec **WSAEACCES** si le chiffrement ne peut pas être établi.</span><span class="sxs-lookup"><span data-stu-id="2903a-126">For outgoing connections, the [**connect**](/windows/desktop/api/winsock2/nf-winsock2-connect) function fails with **WSAEACCES** if encryption cannot be established.</span></span> <span data-ttu-id="2903a-127">En réponse, l’application peut inviter l’utilisateur à authentifier les deux périphériques Bluetooth avant la connexion.</span><span class="sxs-lookup"><span data-stu-id="2903a-127">In response, the application may prompt the user to authenticate the two Bluetooth devices before connection.</span></span> <span data-ttu-id="2903a-128">Pour plus d’informations sur l’authentification des appareils Bluetooth, consultez [**BluetoothAuthenticateDevice**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice).</span><span class="sxs-lookup"><span data-stu-id="2903a-128">For more information about authenticating Bluetooth devices, see [**BluetoothAuthenticateDevice**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice).</span></span>

<span data-ttu-id="2903a-129">Pour l' \_ option de \_ Socket de chiffrement BTH so, *optval* est un pointeur vers ulong **BEncrypt** et doit avoir la **valeur true**. *optlen* est équivalent à sizeof (ULONG).</span><span class="sxs-lookup"><span data-stu-id="2903a-129">For the SO\_BTH\_ENCRYPT socket option, *optval* is a pointer to ULONG **bEncrypt** and must be **TRUE**; *optlen* is equivalent to sizeof(ULONG).</span></span>

<span data-ttu-id="2903a-130">**Windows XP avec SP2 :** Pour un socket qui est connecté et authentifié, par **conséquent, \_ BTH \_ Encrypt** démarre le chiffrement.</span><span class="sxs-lookup"><span data-stu-id="2903a-130">**Windows XP with SP2:** For a socket that is connected and authenticated, **SO\_BTH\_ENCRYPT** starts encryption.</span></span>

## <a name="so_bth_mtu"></a><span data-ttu-id="2903a-131">SO \_ MTU de BTH \_</span><span class="sxs-lookup"><span data-stu-id="2903a-131">SO\_BTH\_MTU</span></span>

<span data-ttu-id="2903a-132">L’option de socket **\_ \_ MTU BTH** est une option avancée qui est principalement utilisée pour la validation.</span><span class="sxs-lookup"><span data-stu-id="2903a-132">The **SO\_BTH\_MTU** socket option is an advanced option used primarily for validation.</span></span> <span data-ttu-id="2903a-133">L’option SO de l’unité **\_ \_ MTU de BTH** obtient ou définit la valeur par défaut de RFCOMM MTU (unité de transmission maximale) pour la négociation de la connexion à une valeur différente de la valeur par défaut du protocole RFCOMM.</span><span class="sxs-lookup"><span data-stu-id="2903a-133">The **SO\_BTH\_MTU** option obtains or sets default RFCOMM MTU (maximum transmission unit) for connection negotiation to a value different than the RFCOMM protocol-default value.</span></span>

<span data-ttu-id="2903a-134">Étant donné que l’unité MTU RFCOMM est affectée par l’unité MTU L2CAP sous-jacente, et les valeurs minimales et maximales du protocole et de l’application, la valeur par défaut de cette option est uniquement un point de départ pour la négociation avec l’homologue distant, et l’unité MTU négociée finale est susceptible de varier par rapport à la valeur par défaut. **\_ \_**</span><span class="sxs-lookup"><span data-stu-id="2903a-134">Because RFCOMM MTU is affected by the underlying L2CAP MTU, and protocol and application minimums and maximums, the default value for **SO\_BTH\_MTU** is only a starting point for negotiation with the remote peer, and the final negotiated MTU is likely to vary from the default.</span></span> <span data-ttu-id="2903a-135">La définition de la valeur de la **\_ \_ MTU de la vue BTH** peut avoir un impact négatif sur le débit, et en tant que telle, toute modification doit être effectuée avec la connaissance du protocole Bluetooth sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="2903a-135">Setting the **SO\_BTH\_MTU** value may negatively affect throughput, and as such, any modification should be performed with knowledge of the underlying Bluetooth protocol.</span></span>

<span data-ttu-id="2903a-136">L’option de socket **\_ \_ MTU BTH** peut être exécutée sur des sockets connectés, mais elle n’a aucun effet si la négociation est déjà terminée.</span><span class="sxs-lookup"><span data-stu-id="2903a-136">The **SO\_BTH\_MTU** socket option can be performed on connected sockets, but has no effect if the negotiation has already completed.</span></span> <span data-ttu-id="2903a-137">Sa définition sur le socket d’écoute (serveur) n’a aucun effet.</span><span class="sxs-lookup"><span data-stu-id="2903a-137">Setting it on the listening (server) socket has no effect.</span></span>

<span data-ttu-id="2903a-138">La quantité de données qu’une application peut envoyer ou recevoir dans un seul appel de socket n’est pas affectée par l’unité de transmission (MTU). La MTU affecte uniquement la manière dont le fournisseur de services Windows Sockets sous-jacent segmente les paquets pour le transport.</span><span class="sxs-lookup"><span data-stu-id="2903a-138">The amount of data that an application can send or receive in a single socket call is not affected by the MTU; MTU only affects how the underlying Windows Sockets service provider segments packets for transport.</span></span> <span data-ttu-id="2903a-139">L’unité MTU proposée et la MTU en fin de négociation doivent être comprises entre **RFCOMM \_ Min \_ MTU** et **RFCOMM \_ \_ MTU Max**, comme défini dans le fichier d’en-tête Ws2bth. h.</span><span class="sxs-lookup"><span data-stu-id="2903a-139">Both the proposed MTU and the MTU ultimately negotiated must be between **RFCOMM\_MIN\_MTU** and **RFCOMM\_MAX\_MTU**, as defined in the Ws2bth.h header file.</span></span>

<span data-ttu-id="2903a-140">Pour l’option de socket **\_ \_ MTU BTH** , *optval* est un pointeur vers l’unité MTU ulong ; *optlen* est équivalent à « sizeof (ULONG) ».</span><span class="sxs-lookup"><span data-stu-id="2903a-140">For the **SO\_BTH\_MTU** socket option, *optval* is a pointer to ULONG mtu; *optlen* is equivalent to "sizeof(ULONG)".</span></span>

## <a name="so_bth_mtu_max"></a><span data-ttu-id="2903a-141">Si \_ BTH \_ mtu \_ Max</span><span class="sxs-lookup"><span data-stu-id="2903a-141">SO\_BTH\_MTU\_MAX</span></span>

<span data-ttu-id="2903a-142">L’option de socket maximale de l' **\_ \_ unité MTU \_ de BTH** est une option avancée utilisée principalement pour la validation.</span><span class="sxs-lookup"><span data-stu-id="2903a-142">The **SO\_BTH\_MTU\_MAX** socket option is an advanced option used primarily for validation.</span></span> <span data-ttu-id="2903a-143">L’option de socket maximum **\_ \_ MTU MTU \_ Max** définit la valeur maximale de RFCOMM MTU (unité de transmission maximale) pour la négociation de la connexion.</span><span class="sxs-lookup"><span data-stu-id="2903a-143">The **SO\_BTH\_MTU\_MAX** socket option sets the maximum RFCOMM MTU (maximum transmission unit) for connection negotiation.</span></span> <span data-ttu-id="2903a-144">Les connexions avec une unité MTU RFCOMM supérieure ou égale à cette valeur échouent au cours du processus d’acceptation de la [**connexion**](/windows/desktop/api/winsock2/nf-winsock2-connect) / [](/windows/desktop/api/winsock2/nf-winsock2-accept) .</span><span class="sxs-lookup"><span data-stu-id="2903a-144">Connections with an RFCOMM MTU equal to or greater than this value fail during the [**connect**](/windows/desktop/api/winsock2/nf-winsock2-connect)/[**accept**](/windows/desktop/api/winsock2/nf-winsock2-accept) process.</span></span> <span data-ttu-id="2903a-145">Alors que la définition de cette option de socket est autorisée pour un socket connecté, elle n’a aucun effet si la négociation est terminée.</span><span class="sxs-lookup"><span data-stu-id="2903a-145">While setting this socket option is allowed for a connected socket, it has no effect if the negotiation has completed.</span></span> <span data-ttu-id="2903a-146">La définition de cette option de socket sur un socket d’écoute propage la valeur de toutes les connexions entrantes.</span><span class="sxs-lookup"><span data-stu-id="2903a-146">Setting this socket option on a listening socket propagates the value for all incoming connections.</span></span> <span data-ttu-id="2903a-147">La valeur MTU MAX doit être comprise entre **RFCOMM \_ Min \_ MTU** et **RFCOMM \_ Max \_ MTU**, comme défini dans le fichier d’en-tête Ws2bth. h.</span><span class="sxs-lookup"><span data-stu-id="2903a-147">The MAX MTU value must be between **RFCOMM\_MIN\_MTU** and **RFCOMM\_MAX\_MTU**, as defined in the Ws2bth.h header file.</span></span>

<span data-ttu-id="2903a-148">Pour l’option de socket maximale de l' **\_ \_ unité MTU \_ de BTH** , *optval* est un pointeur vers l' \_ unité MTU maximale ulong ; *optlen* est équivalent à « sizeof (ULONG) ».</span><span class="sxs-lookup"><span data-stu-id="2903a-148">For the **SO\_BTH\_MTU\_MAX** socket option, *optval* is a pointer to ULONG max\_mtu; *optlen* is equivalent to "sizeof(ULONG)".</span></span>

## <a name="so_bth_mtu_min"></a><span data-ttu-id="2903a-149">SO \_ MTU de BTH \_ \_ min.</span><span class="sxs-lookup"><span data-stu-id="2903a-149">SO\_BTH\_MTU\_MIN</span></span>

<span data-ttu-id="2903a-150">L’option de socket de l' **\_ unité de \_ transmission maximale \_ BTH** est une option avancée utilisée principalement pour la validation.</span><span class="sxs-lookup"><span data-stu-id="2903a-150">The **SO\_BTH\_MTU\_MIN** socket option is an advanced option used primarily for validation.</span></span> <span data-ttu-id="2903a-151">L’option de socket de l’unité de transmission maximale **\_ BTH de BTH \_ \_** définit la MTU RFCOMM minimale (unité de transmission maximale) pour la négociation de la connexion.</span><span class="sxs-lookup"><span data-stu-id="2903a-151">The **SO\_BTH\_MTU\_MIN** socket option sets the minimum RFCOMM MTU (maximum transmission unit) for connection negotiation.</span></span> <span data-ttu-id="2903a-152">Les connexions avec une MTU RFCOMM inférieure à cette valeur échouent pendant le processus d’acceptation de la [**connexion**](/windows/desktop/api/winsock2/nf-winsock2-connect) / [](/windows/desktop/api/winsock2/nf-winsock2-accept) .</span><span class="sxs-lookup"><span data-stu-id="2903a-152">Connections with an RFCOMM MTU smaller than this value fail during the [**connect**](/windows/desktop/api/winsock2/nf-winsock2-connect)/[**accept**](/windows/desktop/api/winsock2/nf-winsock2-accept) process.</span></span> <span data-ttu-id="2903a-153">Alors que la définition de cette option de socket est autorisée pour un socket connecté, elle n’a aucun effet si la négociation est terminée.</span><span class="sxs-lookup"><span data-stu-id="2903a-153">While setting this socket option is allowed for a connected socket, it has no effect if the negotiation has completed.</span></span> <span data-ttu-id="2903a-154">La définition de cette option de socket sur un socket d’écoute propage la valeur de toutes les connexions entrantes.</span><span class="sxs-lookup"><span data-stu-id="2903a-154">Setting this socket option on a listening socket propagates the value for all incoming connections.</span></span>

<span data-ttu-id="2903a-155">Seul un socket d’écoute peut modifier la MTU vers le bas. par conséquent, si la valeur proposée par le socket de connexion est inférieure à la valeur définie pour **\_ BTH \_ mtu \_ min** sur le socket d’écoute, la connexion est refusée.</span><span class="sxs-lookup"><span data-stu-id="2903a-155">Only a listening socket can revise the MTU downward, therefore if the value proposed by the connecting socket is less than the value set for **SO\_BTH\_MTU\_MIN** on the listening socket, the connection is refused.</span></span> <span data-ttu-id="2903a-156">La valeur MTU minimale doit être comprise entre **RFCOMM \_ Min \_ MTU** et **RFCOMM \_ \_ MTU Max**, comme défini dans le fichier d’en-tête Ws2bth. h.</span><span class="sxs-lookup"><span data-stu-id="2903a-156">The minimum MTU must be between **RFCOMM\_MIN\_MTU** and **RFCOMM\_MAX\_MTU**, as defined in the Ws2bth.h header file.</span></span>

<span data-ttu-id="2903a-157">Pour l’option de socket de l' \_ \_ unité de transmission maximale BTH \_ , *optval* est un pointeur vers ulong min \_ MTU ; *optlen* est équivalent à « sizeof (ULONG) ».</span><span class="sxs-lookup"><span data-stu-id="2903a-157">For the SO\_BTH\_MTU\_MIN socket option, *optval* is a pointer to ULONG min\_mtu; *optlen* is equivalent to "sizeof(ULONG)".</span></span>

## <a name="related-topics"></a><span data-ttu-id="2903a-158">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="2903a-158">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2903a-159">Windows Sockets</span><span class="sxs-lookup"><span data-stu-id="2903a-159">Windows Sockets</span></span>](/windows/desktop/WinSock/windows-sockets-start-page-2)
</dt> <dt>

[<span data-ttu-id="2903a-160">**getsockopt**</span><span class="sxs-lookup"><span data-stu-id="2903a-160">**getsockopt**</span></span>](/windows/desktop/api/winsock/nf-winsock-getsockopt)
</dt> <dt>

[<span data-ttu-id="2903a-161">**setsockopt**</span><span class="sxs-lookup"><span data-stu-id="2903a-161">**setsockopt**</span></span>](/windows/desktop/api/winsock/nf-winsock-setsockopt)
</dt> <dt>

[<span data-ttu-id="2903a-162">**BluetoothAuthenticateDevice**</span><span class="sxs-lookup"><span data-stu-id="2903a-162">**BluetoothAuthenticateDevice**</span></span>](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice)
</dt> <dt>

[<span data-ttu-id="2903a-163">**entre**</span><span class="sxs-lookup"><span data-stu-id="2903a-163">**connect**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-connect)
</dt> <dt>

[<span data-ttu-id="2903a-164">**accepter**</span><span class="sxs-lookup"><span data-stu-id="2903a-164">**accept**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-accept)
</dt> </dl>

 

 