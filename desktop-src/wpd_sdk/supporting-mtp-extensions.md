---
description: Prise en charge des extensions MTP
ms.assetid: 9e5f3da6-346a-4eca-bc85-2755c569986d
title: Prise en charge des extensions MTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f26a6a5a585167984ec944528bb74a6746e42ac4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103867525"
---
# <a name="supporting-mtp-extensions"></a><span data-ttu-id="3c011-103">Prise en charge des extensions MTP</span><span class="sxs-lookup"><span data-stu-id="3c011-103">Supporting MTP Extensions</span></span>

## <a name="media-transfer-protocol"></a><span data-ttu-id="3c011-104">Protocole de transfert de médias</span><span class="sxs-lookup"><span data-stu-id="3c011-104">Media Transfer Protocol</span></span>

<span data-ttu-id="3c011-105">Le protocole MTP (Media Transfer Protocol) est une extension du protocole PTP (Picture Transfer Protocol).</span><span class="sxs-lookup"><span data-stu-id="3c011-105">Media Transfer Protocol (MTP) is an extension to the Picture Transfer Protocol (PTP).</span></span> <span data-ttu-id="3c011-106">Par conséquent, toutes les sémantiques de protocole PTP sont valides dans MTP.</span><span class="sxs-lookup"><span data-stu-id="3c011-106">As a result, all PTP protocol semantics are valid in MTP.</span></span>

<span data-ttu-id="3c011-107">MTP communique à l’aide de commandes et de réponses entre deux parties, l’initiateur et le répondeur.</span><span class="sxs-lookup"><span data-stu-id="3c011-107">MTP communicates by using commands and responses between two parties, the initiator and the responder.</span></span> <span data-ttu-id="3c011-108">Les rôles des appareils impliqués sont très clairement définis.</span><span class="sxs-lookup"><span data-stu-id="3c011-108">The roles of the involved devices are very clearly defined.</span></span> <span data-ttu-id="3c011-109">Le PC est généralement l’initiateur et l’appareil est toujours le répondeur.</span><span class="sxs-lookup"><span data-stu-id="3c011-109">The PC typically is the initiator, and the device is always the responder.</span></span> <span data-ttu-id="3c011-110">Un appareil non-PC peut également être un initiateur (par exemple, un étage de voiture ou un boîtier Microsoft X).</span><span class="sxs-lookup"><span data-stu-id="3c011-110">A non-PC device could also be an initiator (for example, a car deck or a Microsoft X-box).</span></span> <span data-ttu-id="3c011-111">Un appareil ne peut jamais assumer les deux rôles en même temps.</span><span class="sxs-lookup"><span data-stu-id="3c011-111">A device can never assume both roles at the same time.</span></span>

<span data-ttu-id="3c011-112">L’initiateur démarre la communication en envoyant une commande au répondeur.</span><span class="sxs-lookup"><span data-stu-id="3c011-112">The initiator starts communication by sending a command to the responder.</span></span> <span data-ttu-id="3c011-113">Le répondeur traite la commande et renvoie une réponse appropriée.</span><span class="sxs-lookup"><span data-stu-id="3c011-113">The responder processes the command and sends back an appropriate response.</span></span> <span data-ttu-id="3c011-114">Une phase de données peut être associée à la commande.</span><span class="sxs-lookup"><span data-stu-id="3c011-114">There might be a data phase associated with the command.</span></span> <span data-ttu-id="3c011-115">Si c’est le cas, la direction du Workflow doit être connue au préalable et acceptée par l’initiateur et le répondeur.</span><span class="sxs-lookup"><span data-stu-id="3c011-115">If this is the case, the direction of data flow must be known beforehand and accepted by both the initiator and the responder.</span></span> <span data-ttu-id="3c011-116">N’oubliez pas qu’il n’existe pas d’en-tête descriptif indiquant des flux de données pour les nouvelles commandes.</span><span class="sxs-lookup"><span data-stu-id="3c011-116">Be aware that there is not a descriptive header that indicates data flows for new commands.</span></span>

<span data-ttu-id="3c011-117">Le répondeur peut démarrer une communication indépendante de l’initiateur.</span><span class="sxs-lookup"><span data-stu-id="3c011-117">The responder can start communication independent of the initiator.</span></span> <span data-ttu-id="3c011-118">Par exemple, le répondeur peut envoyer des événements à l’initiateur.</span><span class="sxs-lookup"><span data-stu-id="3c011-118">For example, the responder can send events to the initiator.</span></span> <span data-ttu-id="3c011-119">Toutefois, aucune donnée ne peut être envoyée avec l’événement.</span><span class="sxs-lookup"><span data-stu-id="3c011-119">However, no data can be sent together with the event.</span></span> <span data-ttu-id="3c011-120">Si des données doivent être lues dans le cadre de l’événement, l’initiateur doit envoyer une commande MTP et l’appareil peut envoyer des données en réponse à la commande.</span><span class="sxs-lookup"><span data-stu-id="3c011-120">If there is any data that needs to be read as part of the event, the initiator must send an MTP command, and the device can then send data in response to the command.</span></span>

<span data-ttu-id="3c011-121">Pour obtenir une description complète de MTP, reportez-vous à la [spécification MTP](https://www.usb.org/sites/default/files/MTPv1_1.zip).</span><span class="sxs-lookup"><span data-stu-id="3c011-121">For a complete description of MTP, refer to the [MTP specification](https://www.usb.org/sites/default/files/MTPv1_1.zip).</span></span>

## <a name="sending-mtp-commands"></a><span data-ttu-id="3c011-122">Envoi de commandes MTP</span><span class="sxs-lookup"><span data-stu-id="3c011-122">Sending MTP Commands</span></span>

<span data-ttu-id="3c011-123">Les applications peuvent envoyer des commandes MTP à un appareil en appelant la méthode [**IPortableDevice :: SendCommand**](/windows/desktop/api/PortableDeviceApi/nf-portabledeviceapi-iportabledevice-sendcommand) .</span><span class="sxs-lookup"><span data-stu-id="3c011-123">Applications can send MTP commands to a device by invoking the [**IPortableDevice::SendCommand**](/windows/desktop/api/PortableDeviceApi/nf-portabledeviceapi-iportabledevice-sendcommand) method.</span></span> <span data-ttu-id="3c011-124">La commande envoyée varie selon qu’il existe une phase de données, et si toutes les données associées sont lues ou écrites sur l’appareil.</span><span class="sxs-lookup"><span data-stu-id="3c011-124">The command that is sent depends on whether there is a data phase, and, on whether any accompanying data is read from or written to the device.</span></span> <span data-ttu-id="3c011-125">Le tableau suivant décrit les trois commandes d’extension MTP possibles.</span><span class="sxs-lookup"><span data-stu-id="3c011-125">The following table describes the three possible MTP extension commands.</span></span>

<span data-ttu-id="3c011-126">N’oubliez pas que ces commandes sont spécifiques à MTP ; et sont donc uniquement implémentées par le pilote de classe MTP WPD.</span><span class="sxs-lookup"><span data-stu-id="3c011-126">Be aware that these commands are specific to MTP; and are therefore, only implemented by the WPD MTP class driver.</span></span>



|                                                                                                                                      |                                                                                                   |
|--------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| <span data-ttu-id="3c011-127">Commande</span><span class="sxs-lookup"><span data-stu-id="3c011-127">Command</span></span>                                                                                                                              | <span data-ttu-id="3c011-128">Description</span><span class="sxs-lookup"><span data-stu-id="3c011-128">Description</span></span>                                                                                       |
| [<span data-ttu-id="3c011-129">**\_transfert de \_ \_ données de \_ fin \_ MTP \_ MTP de commande wpd**</span><span class="sxs-lookup"><span data-stu-id="3c011-129">**WPD\_COMMAND\_MTP\_EXT\_END\_DATA\_TRANSFER**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-end-data-transfer)                                      | <span data-ttu-id="3c011-130">Émet une commande MTP qui signale la conclusion d’une opération de lecture ou d’écriture de données.</span><span class="sxs-lookup"><span data-stu-id="3c011-130">Issues an MTP command that signals the conclusion of a data read or write operation.</span></span>              |
| [<span data-ttu-id="3c011-131">**commande \_ wpd \_ MTP \_ ext \_ Execute \_ Command \_ sans \_ \_ phase Data**</span><span class="sxs-lookup"><span data-stu-id="3c011-131">**WPD\_COMMAND\_MTP\_EXT\_EXECUTE\_COMMAND\_WITHOUT\_DATA\_PHASE**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-execute-command-without-data-phase)  | <span data-ttu-id="3c011-132">Émet une commande MTP sans une phase de données correspondante.</span><span class="sxs-lookup"><span data-stu-id="3c011-132">Issues an MTP command without a corresponding data phase.</span></span>                                         |
| [<span data-ttu-id="3c011-133">**commande \_ wpd \_ MTP \_ ext \_ Execute Command Execute \_ \_ avec les \_ données \_ à \_ écrire**</span><span class="sxs-lookup"><span data-stu-id="3c011-133">**WPD\_COMMAND\_MTP\_EXT\_EXECUTE\_COMMAND\_WITH\_DATA\_TO\_WRITE**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-execute-command-with-data-to-write) | <span data-ttu-id="3c011-134">Émet une commande MTP qui est suivie de données d’accompagnement, qui seront écrites sur l’appareil.</span><span class="sxs-lookup"><span data-stu-id="3c011-134">Issues an MTP command that is followed by accompanying data, which will be written to the device.</span></span> |
| [<span data-ttu-id="3c011-135">**commande \_ wpd \_ MTP \_ ext \_ Execute Command Execute \_ \_ avec les \_ données \_ à \_ lire**</span><span class="sxs-lookup"><span data-stu-id="3c011-135">**WPD\_COMMAND\_MTP\_EXT\_EXECUTE\_COMMAND\_WITH\_DATA\_TO\_READ**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-execute-command-with-data-to-read)   | <span data-ttu-id="3c011-136">Émet une commande MTP qui est suivie de données d’accompagnement, qui sont lues à partir de l’appareil.</span><span class="sxs-lookup"><span data-stu-id="3c011-136">Issues an MTP command that is followed by accompanying data, which is read from the device.</span></span>       |
| [<span data-ttu-id="3c011-137">**\_commande wpd \_ MTP MTP de \_ lecture des \_ \_ données**</span><span class="sxs-lookup"><span data-stu-id="3c011-137">**WPD\_COMMAND\_MTP\_EXT\_READ\_DATA**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-read-data)                                                       | <span data-ttu-id="3c011-138">Émet une commande MTP qui envoie les données de l’appareil au PC.</span><span class="sxs-lookup"><span data-stu-id="3c011-138">Issues an MTP command that sends data from the device to the PC.</span></span>                                  |
| [<span data-ttu-id="3c011-139">**\_données d' \_ \_ écriture MTP \_ ext \_ de la commande wpd**</span><span class="sxs-lookup"><span data-stu-id="3c011-139">**WPD\_COMMAND\_MTP\_EXT\_WRITE\_DATA**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-write-data)                                                     | <span data-ttu-id="3c011-140">Émet une commande MTP qui envoie des données à l’appareil à partir du PC.</span><span class="sxs-lookup"><span data-stu-id="3c011-140">Issues an MTP command that sends data to the device from the PC.</span></span>                                  |



 

<span data-ttu-id="3c011-141">Quelle que soit la phase, vous devez spécifier le code de l' **\_ \_ \_ \_ opération \_ ext MTP de la propriété wpd** et les paramètres de l' **\_ \_ \_ \_ opération MTP \_ ext de la propriété wpd** .</span><span class="sxs-lookup"><span data-stu-id="3c011-141">Regardless of the phase, **WPD\_PROPERTY\_MTP\_EXT\_OPERATION\_CODE** and **WPD\_PROPERTY\_MTP\_EXT\_OPERATION\_PARAMS** must be specified.</span></span>

<span data-ttu-id="3c011-142">Si le pilote MTP a pu envoyer la commande à l’appareil, les valeurs de retour contiennent toujours le **\_ Code de \_ \_ \_ réponse \_ MTP ext de la propriété wpd**.</span><span class="sxs-lookup"><span data-stu-id="3c011-142">If the MTP driver was able to send the command to the device, the return values will always contain **WPD\_PROPERTY\_MTP\_EXT\_RESPONSE\_CODE**.</span></span> <span data-ttu-id="3c011-143">Si le code de réponse indique une réussite et si la sémantique de la commande autorise les paramètres de réponse, les paramètres de **\_ \_ \_ réponse MTP ext \_ \_ de la propriété wpd** seront également disponibles.</span><span class="sxs-lookup"><span data-stu-id="3c011-143">If the response code indicates success and if the semantics of the command allow for response parameters, **WPD\_PROPERTY\_MTP\_EXT\_RESPONSE\_PARAMS** will also be available.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3c011-144">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="3c011-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3c011-145">**Guide de programmation**</span><span class="sxs-lookup"><span data-stu-id="3c011-145">**Programming Guide**</span></span>](programming-guide.md)
</dt> </dl>

 

 
