---
title: Peindre la fenêtre
description: Vous avez créé votre fenêtre. À présent, vous voulez afficher un contenu à l’intérieur de celui-ci. Dans la terminologie Windows, c’est ce que l’on appelle peindre la fenêtre. Pour mélanger des métaphores, une fenêtre est une zone de dessin vide, en attendant que vous la complétiez.
ms.assetid: db97a4c9-7592-42d1-a5de-9c468169eefc
ms.topic: article
ms.date: 08/16/2019
ms.openlocfilehash: f0f9d5c2759ea1735e370eb258743364980daee8
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104552403"
---
# <a name="painting-the-window"></a><span data-ttu-id="ec6e6-106">Peindre la fenêtre</span><span class="sxs-lookup"><span data-stu-id="ec6e6-106">Painting the Window</span></span>

<span data-ttu-id="ec6e6-107">Vous avez créé votre fenêtre.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-107">You've created your window.</span></span> <span data-ttu-id="ec6e6-108">À présent, vous voulez afficher un contenu à l’intérieur de celui-ci.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-108">Now you want to show something inside it.</span></span> <span data-ttu-id="ec6e6-109">Dans la terminologie Windows, c’est ce que l’on appelle peindre la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-109">In Windows terminology, this is called painting the window.</span></span> <span data-ttu-id="ec6e6-110">Pour mélanger des métaphores, une fenêtre est une zone de dessin vide, en attendant que vous la complétiez.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-110">To mix metaphors, a window is a blank canvas, waiting for you to fill it.</span></span>

<span data-ttu-id="ec6e6-111">Parfois, votre programme lance la peinture pour mettre à jour l’apparence de la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-111">Sometimes your program will initiate painting to update the appearance of the window.</span></span> <span data-ttu-id="ec6e6-112">À d’autres moments, le système d’exploitation vous informera que vous devez redessiner une partie de la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-112">At other times, the operating system will notify you that you must repaint a portion of the window.</span></span> <span data-ttu-id="ec6e6-113">Dans ce cas, le système d’exploitation envoie un message [**de \_ peinture WM**](/windows/desktop/gdi/wm-paint) à la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-113">When this occurs, the operating system sends the window a [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) message.</span></span> <span data-ttu-id="ec6e6-114">La partie de la fenêtre qui doit être peinte est appelée *zone de mise à jour*.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-114">The portion of the window that must be painted is called the *update region*.</span></span>

<span data-ttu-id="ec6e6-115">La première fois qu’une fenêtre est affichée, la totalité de la zone cliente de la fenêtre doit être peinte.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-115">The first time a window is shown, the entire client area of the window must be painted.</span></span> <span data-ttu-id="ec6e6-116">Par conséquent, vous recevrez toujours au moins un message [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) lorsque vous affichez une fenêtre.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-116">Therefore, you will always receive at least one [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) message when you show a window.</span></span>

![Illustration montrant la région de mise à jour d’une fenêtre](images/painting01.png)

<span data-ttu-id="ec6e6-118">Vous êtes uniquement responsable de la peinture de la zone cliente.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-118">You are only responsible for painting the client area.</span></span> <span data-ttu-id="ec6e6-119">Le frame environnant, y compris la barre de titre, est automatiquement peint par le système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-119">The surrounding frame, including the title bar, is automatically painted by the operating system.</span></span> <span data-ttu-id="ec6e6-120">Une fois que vous avez fini de peindre la zone client, vous désactivez la zone de mise à jour, ce qui indique au système d’exploitation qu’elle n’a pas besoin d’envoyer un autre message [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) tant qu’un changement n’est pas effectué.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-120">After you finish painting the client area, you clear the update region, which tells the operating system that it does not need to send another [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) message until something changes.</span></span>

<span data-ttu-id="ec6e6-121">Supposons à présent que l’utilisateur déplace une autre fenêtre afin qu’elle masque une partie de votre fenêtre.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-121">Now suppose the user moves another window so that it obscures a portion of your window.</span></span> <span data-ttu-id="ec6e6-122">Lorsque la partie masquée redevient visible, cette partie est ajoutée à la région de mise à jour et votre fenêtre reçoit un autre message [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) .</span><span class="sxs-lookup"><span data-stu-id="ec6e6-122">When the obscured portion becomes visible again, that portion is added to the update region, and your window receives another [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) message.</span></span>

![Illustration montrant comment la région de mise à jour change lorsque deux fenêtres se chevauchent](images/painting02.png)

<span data-ttu-id="ec6e6-124">La région de mise à jour change également si l’utilisateur étire la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-124">The update region also changes if the user stretches the window.</span></span> <span data-ttu-id="ec6e6-125">Dans le diagramme suivant, l’utilisateur étire la fenêtre à droite.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-125">In the following diagram, the user stretches the window to the right.</span></span> <span data-ttu-id="ec6e6-126">La zone récemment exposée sur le côté droit de la fenêtre est ajoutée à la zone de mise à jour :</span><span class="sxs-lookup"><span data-stu-id="ec6e6-126">The newly exposed area on the right side of the window is added to the update region:</span></span>

![Illustration montrant comment la région de mise à jour change lorsqu’une fenêtre est redimensionnée](images/painting03.png)

<span data-ttu-id="ec6e6-128">Dans notre premier exemple de programme, la routine de peinture est très simple.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-128">In our first example program, the painting routine is very simple.</span></span> <span data-ttu-id="ec6e6-129">Elle remplit simplement la zone cliente entière avec une couleur unie.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-129">It just fills the entire client area with a solid color.</span></span> <span data-ttu-id="ec6e6-130">Toutefois, cet exemple suffit pour illustrer certains des concepts importants.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-130">Still, this example is enough to demonstrate some of the important concepts.</span></span>

```C++
switch (uMsg)
{
    case WM_PAINT:
    {
        PAINTSTRUCT ps;
        HDC hdc = BeginPaint(hwnd, &ps);

        // All painting occurs here, between BeginPaint and EndPaint.

        FillRect(hdc, &ps.rcPaint, (HBRUSH) (COLOR_WINDOW+1));

        EndPaint(hwnd, &ps);
    }
    return 0;
}
```

<span data-ttu-id="ec6e6-131">Démarrez l’opération de peinture en appelant la fonction [**BeginPaint**](/windows/desktop/api/winuser/nf-winuser-beginpaint) .</span><span class="sxs-lookup"><span data-stu-id="ec6e6-131">Start the painting operation by calling the [**BeginPaint**](/windows/desktop/api/winuser/nf-winuser-beginpaint) function.</span></span> <span data-ttu-id="ec6e6-132">Cette fonction remplit la structure [**PAINTSTRUCT,**](/windows/win32/api/winuser/ns-winuser-paintstruct) avec des informations sur la demande Repaint.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-132">This function fills in the [**PAINTSTRUCT**](/windows/win32/api/winuser/ns-winuser-paintstruct) structure with information on the repaint request.</span></span> <span data-ttu-id="ec6e6-133">La région de mise à jour actuelle est donnée dans le membre **rcPaint** de **PAINTSTRUCT,**.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-133">The current update region is given in the **rcPaint** member of **PAINTSTRUCT**.</span></span> <span data-ttu-id="ec6e6-134">Cette région de mise à jour est définie par rapport à la zone cliente :</span><span class="sxs-lookup"><span data-stu-id="ec6e6-134">This update region is defined relative to the client area:</span></span>

![Illustration montrant l’origine de la zone cliente](images/painting04.png)

<span data-ttu-id="ec6e6-136">Dans votre code de peinture, vous disposez de deux options de base :</span><span class="sxs-lookup"><span data-stu-id="ec6e6-136">In your painting code, you have two basic options:</span></span>

- <span data-ttu-id="ec6e6-137">Peignez toute la zone cliente, quelle que soit la taille de la région de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-137">Paint the entire client area, regardless of the size of the update region.</span></span> <span data-ttu-id="ec6e6-138">Tout ce qui se trouve en dehors de la région de mise à jour est coupé.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-138">Anything that falls outside of the update region is clipped.</span></span> <span data-ttu-id="ec6e6-139">Autrement dit, le système d’exploitation l’ignore.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-139">That is, the operating system ignores it.</span></span>
- <span data-ttu-id="ec6e6-140">Optimisez en peignant uniquement la partie de la fenêtre à l’intérieur de la région de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-140">Optimize by painting just the portion of the window inside the update region.</span></span>

<span data-ttu-id="ec6e6-141">Si vous peignez toujours la totalité de la zone cliente, le code sera plus simple.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-141">If you always paint the entire client area, the code will be simpler.</span></span> <span data-ttu-id="ec6e6-142">Toutefois, si vous avez une logique de peinture compliquée, il peut être plus efficace d’ignorer les zones en dehors de la région de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-142">If you have complicated painting logic, however, it can be more efficient to skip the areas outside of the update region.</span></span>

<span data-ttu-id="ec6e6-143">La ligne de code suivante remplit la zone de mise à jour avec une couleur unique, à l’aide de la couleur d’arrière-plan de la fenêtre définie par le système (**\_ fenêtre de couleur**).</span><span class="sxs-lookup"><span data-stu-id="ec6e6-143">The following line of code fills the update region with a single color, using the system-defined window background color (**COLOR\_WINDOW**).</span></span> <span data-ttu-id="ec6e6-144">La couleur réelle indiquée par **la \_ fenêtre couleur** dépend du modèle de couleurs actuel de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-144">The actual color indicated by **COLOR\_WINDOW** depends on the user's current color scheme.</span></span>

```C++
FillRect(hdc, &ps.rcPaint, (HBRUSH) (COLOR_WINDOW+1));
```

<span data-ttu-id="ec6e6-145">Les détails des [**fillRect**](/windows/desktop/api/winuser/nf-winuser-fillrect) ne sont pas importants pour cet exemple, mais le deuxième paramètre donne les coordonnées du rectangle à remplir.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-145">The details of [**FillRect**](/windows/desktop/api/winuser/nf-winuser-fillrect) are not important for this example, but the second parameter gives the coordinates of the rectangle to fill.</span></span> <span data-ttu-id="ec6e6-146">Dans ce cas, nous transmettons l’intégralité de la région de mise à jour (le membre **rcPaint** de [**PAINTSTRUCT,**](/windows/win32/api/winuser/ns-winuser-paintstruct)).</span><span class="sxs-lookup"><span data-stu-id="ec6e6-146">In this case, we pass in the entire update region (the **rcPaint** member of [**PAINTSTRUCT**](/windows/win32/api/winuser/ns-winuser-paintstruct)).</span></span> <span data-ttu-id="ec6e6-147">Sur le premier message [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) , toute la zone cliente doit être peinte, de sorte que **rcPaint** contiendra la totalité de la zone cliente.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-147">On the first [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) message, the entire client area needs to be painted, so **rcPaint** will contain the entire client area.</span></span> <span data-ttu-id="ec6e6-148">Pour les messages de **\_ peinture WM** suivants, **rcPaint** peut contenir un rectangle plus petit.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-148">On subsequent **WM\_PAINT** messages, **rcPaint** might contain a smaller rectangle.</span></span>

<span data-ttu-id="ec6e6-149">La fonction [**fillRect**](/windows/desktop/api/winuser/nf-winuser-fillrect) fait partie du Graphics Device Interface (GDI), qui dispose de graphiques Windows alimentés pendant beaucoup de temps.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-149">The [**FillRect**](/windows/desktop/api/winuser/nf-winuser-fillrect) function is part of the Graphics Device Interface (GDI), which has powered Windows graphics for a very long time.</span></span> <span data-ttu-id="ec6e6-150">Dans Windows 7, Microsoft a introduit un nouveau moteur graphique, nommé Direct2D, qui prend en charge les opérations graphiques hautes performances, telles que l’accélération matérielle.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-150">In Windows 7, Microsoft introduced a new graphics engine, named Direct2D, which supports high-performance graphics operations, such as hardware acceleration.</span></span> <span data-ttu-id="ec6e6-151">Direct2D est également disponible pour Windows Vista via la [mise à jour de plateforme pour Windows Vista](../win7ip/platform-update-for-windows-vista-overview.md) et pour windows Server 2008 via la mise à jour de plateforme pour windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-151">Direct2D is also available for Windows Vista through the [Platform Update for Windows Vista](../win7ip/platform-update-for-windows-vista-overview.md) and for Windows Server 2008 through the Platform Update for Windows Server 2008.</span></span> <span data-ttu-id="ec6e6-152">(GDI est toujours entièrement pris en charge.)</span><span class="sxs-lookup"><span data-stu-id="ec6e6-152">(GDI is still fully supported.)</span></span>

<span data-ttu-id="ec6e6-153">Une fois que vous avez fini de peindre, appelez la fonction [**EndPaint**](/windows/desktop/api/winuser/nf-winuser-endpaint) .</span><span class="sxs-lookup"><span data-stu-id="ec6e6-153">After you are done painting, call the [**EndPaint**](/windows/desktop/api/winuser/nf-winuser-endpaint) function.</span></span> <span data-ttu-id="ec6e6-154">Cette fonction efface la zone de mise à jour, qui signale à Windows que la fenêtre a fini de se peindre.</span><span class="sxs-lookup"><span data-stu-id="ec6e6-154">This function clears the update region, which signals to Windows that the window has completed painting itself.</span></span>

## <a name="next"></a><span data-ttu-id="ec6e6-155">Suivant</span><span class="sxs-lookup"><span data-stu-id="ec6e6-155">Next</span></span>

[<span data-ttu-id="ec6e6-156">Fermeture de la fenêtre</span><span class="sxs-lookup"><span data-stu-id="ec6e6-156">Closing the Window</span></span>](closing-the-window.md)