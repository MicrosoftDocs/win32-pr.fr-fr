---
title: État du cache dans la racine de virtualisation
description: Décrit les différents États de cache qu’un fichier ou un répertoire géré par le fournisseur peut avoir.
ms.assetid: <GUID-GOES-HERE>
ms.date: 01/17/2020
ms.topic: article
ms.openlocfilehash: 43d62ceb1f5ef5bf07000666f336077270b1e86a
ms.sourcegitcommit: 62e758931c610782807c7c9fad284921a6c56232
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/22/2020
ms.locfileid: "104381364"
---
# <a name="cache-state-in-the-virtualization-root"></a><span data-ttu-id="2cdfa-103">État du cache dans la racine de virtualisation</span><span class="sxs-lookup"><span data-stu-id="2cdfa-103">Cache State In the Virtualization Root</span></span>

<span data-ttu-id="2cdfa-104">Le fournisseur utilise le système de fichiers local sous la racine de virtualisation comme un cache des éléments qu’il gère.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-104">The provider uses the local file system under the virtualization root as a cache of the items that it manages.</span></span>  <span data-ttu-id="2cdfa-105">Un élément (fichier ou répertoire) peut être dans l’un des six États du système de fichiers local :</span><span class="sxs-lookup"><span data-stu-id="2cdfa-105">An item (file or directory) can be in one of six states on the local file system:</span></span>

* <span data-ttu-id="2cdfa-106">Les machines</span><span class="sxs-lookup"><span data-stu-id="2cdfa-106">Virtual</span></span>

  <span data-ttu-id="2cdfa-107">L’élément n’existe pas localement sur le disque.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-107">The item does not exist locally on disk.</span></span>  <span data-ttu-id="2cdfa-108">Elle est projetée, c’est-à-dire synthétisée, pendant les énumérations de son répertoire parent.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-108">It is projected, i.e. synthesized, during enumerations of its parent directory.</span></span>  <span data-ttu-id="2cdfa-109">Les éléments virtuels sont fusionnés avec tous les éléments qui peuvent exister sur le disque pour présenter le contenu complet du répertoire parent.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-109">Virtual items are merged with any items that may exist on disk to present the full contents of the parent directory.</span></span>

* <span data-ttu-id="2cdfa-110">Espace réservé</span><span class="sxs-lookup"><span data-stu-id="2cdfa-110">Placeholder</span></span>

  <span data-ttu-id="2cdfa-111">Pour les fichiers : le contenu du fichier (flux de données principal) n’est pas présent sur le disque.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-111">For files: The file's content (primary data stream) is not present on the disk.</span></span>  <span data-ttu-id="2cdfa-112">Les métadonnées du fichier (nom, taille, horodatages, attributs, etc.) sont mises en cache sur le disque.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-112">The file’s metadata (name, size, timestamps, attributes, etc.) is cached on the disk.</span></span>
  
  <span data-ttu-id="2cdfa-113">Pour les répertoires : tout ou partie des descendants immédiats de l’annuaire (fichiers et répertoires du répertoire) ne sont pas présents sur le disque, c’est-à-dire qu’ils sont toujours virtuels.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-113">For directories: Some or all of the directory’s immediate descendants (the files and directories in the directory) are not present on the disk, i.e. they are still virtual.</span></span>  <span data-ttu-id="2cdfa-114">Les métadonnées du répertoire (nom, horodatages, attributs, etc.) sont mises en cache sur le disque.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-114">The directory’s metadata (name, timestamps, attributes, etc.) is cached on the disk.</span></span>

* <span data-ttu-id="2cdfa-115">Espace réservé hydraté</span><span class="sxs-lookup"><span data-stu-id="2cdfa-115">Hydrated placeholder</span></span>

  <span data-ttu-id="2cdfa-116">Pour les fichiers : le contenu et les métadonnées du fichier ont été mis en cache sur le disque.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-116">For files: The file’s content and metadata have been cached to the disk.</span></span>  <span data-ttu-id="2cdfa-117">Également appelé « fichier partiel ».</span><span class="sxs-lookup"><span data-stu-id="2cdfa-117">Also referred to as a "partial file".</span></span>
  
  <span data-ttu-id="2cdfa-118">Pour les répertoires : un répertoire qui a été créé sur le disque en tant qu’espace réservé ne devient jamais un répertoire d’espace réservé hydraté.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-118">For directories: A directory that was created on disk as a placeholder never becomes a hydrated placeholder directory.</span></span>  <span data-ttu-id="2cdfa-119">Cela permet au fournisseur d’ajouter ou de supprimer des éléments de l’annuaire dans son magasin de stockage et de faire en sorte que ces modifications soient reflétées dans le cache local.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-119">This allows the provider to add or remove items from the directory in its backing store and have those changes be reflected in the local cache.</span></span>

* <span data-ttu-id="2cdfa-120">Espace réservé de modification (hydraté ou non)</span><span class="sxs-lookup"><span data-stu-id="2cdfa-120">Dirty placeholder (hydrated or not)</span></span>

  <span data-ttu-id="2cdfa-121">Les métadonnées de l’élément ont été modifiées localement et ne sont plus un cache de son état dans le magasin du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-121">The item's metadata has been locally modified and is no longer a cache of its state in the provider's store.</span></span> <span data-ttu-id="2cdfa-122">Notez que la création ou la suppression d’un fichier ou d’un répertoire dans un répertoire d’espaces réservés entraîne l’indisponibilité de ce répertoire.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-122">Note that creating or deleting a file or directory under a placeholder directory causes that placeholder directory to become dirty.</span></span>

* <span data-ttu-id="2cdfa-123">Fichier/répertoire complet</span><span class="sxs-lookup"><span data-stu-id="2cdfa-123">Full file/directory</span></span>

  <span data-ttu-id="2cdfa-124">Pour les fichiers : le contenu du fichier (flux de données principal) a été modifié.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-124">For files: The file's content (primary data stream) has been modified.</span></span>  <span data-ttu-id="2cdfa-125">Le fichier n’est plus un cache de son état dans le magasin du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-125">The file is no longer a cache of its state in the provider's store.</span></span>  <span data-ttu-id="2cdfa-126">Les fichiers qui ont été créés sur le système de fichiers local (par exemple, qui n’existent pas dans le magasin du fournisseur) sont également considérés comme des fichiers complets.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-126">Files that have been created on the local file system (i.e. that do not exist in the provider's store at all) are also considered to be full files.</span></span>
  
  <span data-ttu-id="2cdfa-127">Pour les répertoires : les répertoires qui ont été créés sur le système de fichiers local (par exemple, qui n’existent pas dans le magasin du fournisseur) sont considérés comme des répertoires complets.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-127">For directories: Directories that have been created on the local file system (i.e. that do not exist in the provider's store at all) are considered to be full directories.</span></span>  <span data-ttu-id="2cdfa-128">Un répertoire créé sur le disque en tant qu’espace réservé ne devient jamais un répertoire complet.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-128">A directory that was created on disk as a placeholder never becomes a full directory.</span></span>
  
* <span data-ttu-id="2cdfa-129">Objet tombstone</span><span class="sxs-lookup"><span data-stu-id="2cdfa-129">Tombstone</span></span>

  <span data-ttu-id="2cdfa-130">Espace réservé masqué spécial qui représente un élément qui a été supprimé du système de fichiers local.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-130">A special hidden placeholder that represents an item that has been deleted from the local file system.</span></span>  <span data-ttu-id="2cdfa-131">Lorsqu’un répertoire est énuméré, ProjFS fusionne l’ensemble d’éléments locaux (espaces réservés, fichiers complets, etc.) avec le jeu d’éléments projetés virtuels.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-131">When a directory is enumerated ProjFS merges the set of local items (placeholders, full files, etc.) with the set of virtual projected items.</span></span>  <span data-ttu-id="2cdfa-132">Si un élément apparaît dans les jeux locaux et prévus, l’élément local est prioritaire.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-132">If an item appears in both the local and projected sets, the local item takes precedence.</span></span>  <span data-ttu-id="2cdfa-133">Si un fichier n’existe pas dans le système de fichiers local, il n’y a pas d’état local. par conséquent, il apparaît dans l’énumération.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-133">If a file does not exist in the local file system there is no local state, so it would appear in the enumeration.</span></span>  <span data-ttu-id="2cdfa-134">Toutefois, si cet élément a été supprimé, son affichage dans l’énumération est inattendu.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-134">However if that item had been deleted, having it appear in the enumeration would be unexpected.</span></span>  <span data-ttu-id="2cdfa-135">Le remplacement d’un élément supprimé par un objet tombstone entraîne les effets suivants :</span><span class="sxs-lookup"><span data-stu-id="2cdfa-135">Replacing a deleted item with a tombstone results in the following effects:</span></span>

  * <span data-ttu-id="2cdfa-136">Énumérations pour ne pas révéler l’élément.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-136">Enumerations to not reveal the item.</span></span>
  * <span data-ttu-id="2cdfa-137">Le fichier s’ouvre et s’attend à ce que l’élément existe, par exemple, « fichier introuvable ».</span><span class="sxs-lookup"><span data-stu-id="2cdfa-137">File opens that expect the item to exist fail with e.g. "file not found".</span></span>
  * <span data-ttu-id="2cdfa-138">Les créations de fichier qui s’attendent à une opération réussie uniquement si l’élément n’existe pas, ProjFS supprime l’objet tombstone dans le cadre de l’opération.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-138">File creates that expect to succeed only if the item does not exist succeed; ProjFS removes the tombstone as part of the operation.</span></span>

<span data-ttu-id="2cdfa-139">Pour illustrer les États ci-dessus, considérez la séquence suivante, en fonction d’un fournisseur ProjFS qui a un fichier unique « foo.txt » situé dans la racine de virtualisation C:\Root.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-139">To illustrate the above states, consider the following sequence, given a ProjFS provider that has a single file "foo.txt" located in the virtualization root C:\root.</span></span>

1. <span data-ttu-id="2cdfa-140">Une application énumère C:\Root.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-140">An app enumerates C:\root.</span></span>  <span data-ttu-id="2cdfa-141">Il voit le fichier virtuel « foo.txt ».</span><span class="sxs-lookup"><span data-stu-id="2cdfa-141">It sees the virtual file "foo.txt".</span></span>  <span data-ttu-id="2cdfa-142">Étant donné que le fichier n’a pas encore été accédé, le fichier n’existe pas sur le disque.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-142">Since the file has not yet been accessed, the file does not exist on disk.</span></span>
1. <span data-ttu-id="2cdfa-143">L’application ouvre un handle pour C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-143">The app opens a handle to C:\root\foo.txt.</span></span>  <span data-ttu-id="2cdfa-144">ProjFS indique au fournisseur de créer un espace réservé pour celui-ci.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-144">ProjFS tells the provider to create a placeholder for it.</span></span>
1. <span data-ttu-id="2cdfa-145">L’application lit le contenu du fichier.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-145">The app reads the content of the file.</span></span>  <span data-ttu-id="2cdfa-146">Le fournisseur fournit le contenu du fichier à ProjFS et il est mis en cache dans C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-146">The provider provides the file content to ProjFS and it is cached to C:\root\foo.txt.</span></span>  <span data-ttu-id="2cdfa-147">Le fichier est maintenant un espace réservé hydraté.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-147">The file is now a hydrated placeholder.</span></span>
1. <span data-ttu-id="2cdfa-148">L’application met à jour l’horodateur de la dernière modification.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-148">The app updates the Last Modified timestamp.</span></span>  <span data-ttu-id="2cdfa-149">Le fichier est maintenant un espace réservé hydraté modifié.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-149">The file is now a dirty hydrated placeholder.</span></span>
1. <span data-ttu-id="2cdfa-150">L’application ouvre un handle pour l’accès en écriture au fichier.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-150">The app opens a handle for write access to the file.</span></span>  <span data-ttu-id="2cdfa-151">C:\root\foo.txt est désormais un fichier complet.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-151">C:\root\foo.txt is now a full file.</span></span>
1. <span data-ttu-id="2cdfa-152">L’application supprime C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-152">The app deletes C:\root\foo.txt.</span></span>  <span data-ttu-id="2cdfa-153">ProjFS remplace le fichier par un objet tombstone.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-153">ProjFS replaces the file with a tombstone.</span></span>  <span data-ttu-id="2cdfa-154">Désormais, lorsque l’application énumère C:\Root, elle ne voit pas foo.txt.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-154">Now when the app enumerates C:\root it does not see foo.txt.</span></span>  <span data-ttu-id="2cdfa-155">S’il tente d’ouvrir le fichier, l’ouverture échoue avec ERROR_FILE_NOT_FOUND.</span><span class="sxs-lookup"><span data-stu-id="2cdfa-155">If it tries to open the file, the open fails with ERROR_FILE_NOT_FOUND.</span></span>
