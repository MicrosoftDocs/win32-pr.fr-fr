---
description: Les consommateurs de suivi d’événements peuvent traiter les événements d’un ou de plusieurs fournisseurs.
ms.assetid: 039a9f66-228e-4258-9967-2b2cd7d31091
title: Consommation d’événements (traçage d’événements)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 68ad8234cc66d07b5a52c10ab39c7d7b3c8aa029
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104973799"
---
# <a name="consuming-events-event-tracing"></a><span data-ttu-id="278e2-103">Consommation d’événements (traçage d’événements)</span><span class="sxs-lookup"><span data-stu-id="278e2-103">Consuming Events (Event Tracing)</span></span>

<span data-ttu-id="278e2-104">Les consommateurs de suivi d’événements peuvent traiter les événements d’un ou de plusieurs fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="278e2-104">Event trace consumers can process events from one or more providers.</span></span> <span data-ttu-id="278e2-105">Les consommateurs peuvent traiter des événements à partir d’un fichier journal ou en temps réel.</span><span class="sxs-lookup"><span data-stu-id="278e2-105">Consumers can process events from a log file or in real time.</span></span> <span data-ttu-id="278e2-106">Vous pouvez consommer des événements en temps réel uniquement si le contrôleur spécifie le mode de journalisation en temps réel pour la session.</span><span class="sxs-lookup"><span data-stu-id="278e2-106">You can consume events in real time only if the controller specifies the real time logging mode for the session.</span></span> <span data-ttu-id="278e2-107">Pour des raisons de performances, le traitement en temps réel n’est pas recommandé avant Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="278e2-107">For performance reasons, real-time processing is not recommended prior to Windows Vista.</span></span>

<span data-ttu-id="278e2-108">Pour spécifier la session de trace à partir de laquelle vous souhaitez traiter les événements, vous utilisez la structure du [**\_ \_ fichier journal de suivi d’événements**](/windows/win32/api/evntrace/ns-evntrace-event_trace_logfilea) .</span><span class="sxs-lookup"><span data-stu-id="278e2-108">To specify the trace session from which you want to process events, you use the [**EVENT\_TRACE\_LOGFILE**](/windows/win32/api/evntrace/ns-evntrace-event_trace_logfilea) structure.</span></span> <span data-ttu-id="278e2-109">Vous devez initialiser une copie de cette structure pour chaque fichier journal ou session en temps réel que vous souhaitez traiter.</span><span class="sxs-lookup"><span data-stu-id="278e2-109">You must initialize a copy of this structure for each log file or real time session that you want to process.</span></span>

<span data-ttu-id="278e2-110">Pour consommer des événements à partir d’un fichier journal, définissez le membre **LogFileName** sur le nom du fichier journal.</span><span class="sxs-lookup"><span data-stu-id="278e2-110">To consume events from a log file, set the **LogFileName** member to the name of the log file.</span></span> <span data-ttu-id="278e2-111">Pour consommer des événements à partir d’une session en temps réel, définissez le membre **LoggerName** sur le nom de session.</span><span class="sxs-lookup"><span data-stu-id="278e2-111">To consume events from real time session, set the **LoggerName** member to the session name.</span></span> <span data-ttu-id="278e2-112">Vous utilisez également cette structure pour spécifier le rappel [*BufferCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka) et le rappel [*EventCallback suivante*](/windows/win32/api/evntrace/nc-evntrace-pevent_callback) ou [**EventRecordCallback**](/windows/win32/api/evntrace/nc-evntrace-pevent_record_callback) utilisé pour traiter les événements.</span><span class="sxs-lookup"><span data-stu-id="278e2-112">You also use this structure to specify the [*BufferCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka) callback and the [*EventCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_callback) or [**EventRecordCallback**](/windows/win32/api/evntrace/nc-evntrace-pevent_record_callback) callback used to process the events.</span></span>

-   <span data-ttu-id="278e2-113">[**EventRecordCallback**](/windows/win32/api/evntrace/nc-evntrace-pevent_record_callback): reçoit et traite tous les événements (y compris l’événement d’en-tête) à partir d’un ou de plusieurs fichiers journaux et d’une session en temps réel.</span><span class="sxs-lookup"><span data-stu-id="278e2-113">[**EventRecordCallback**](/windows/win32/api/evntrace/nc-evntrace-pevent_record_callback)—Receives and processes all events (including the header event) from one or more log files and a real-time session.</span></span> <span data-ttu-id="278e2-114">Vous implémentez ce rappel si vous utilisez les fonctions d’assistance des données de trace pour analyser les données d’événement ou si vous souhaitez récupérer les métadonnées relatives à l’événement.</span><span class="sxs-lookup"><span data-stu-id="278e2-114">You implement this callback if you use the trace data helper functions to parse the event data or you want to retrieve metadata about the event.</span></span>
-   <span data-ttu-id="278e2-115">[*EventCallback suivante*](/windows/win32/api/evntrace/nc-evntrace-pevent_callback): reçoit et traite tous les événements (y compris l’événement d’en-tête) à partir d’un ou de plusieurs fichiers journaux et d’une session en temps réel.</span><span class="sxs-lookup"><span data-stu-id="278e2-115">[*EventCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_callback)—Receives and processes all events (including the header event) from one or more log files and a real-time session.</span></span>
-   <span data-ttu-id="278e2-116">[*BufferCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka): reçoit et traite les informations récapitulatives relatives à la mémoire tampon actuelle, comme les événements perdus.</span><span class="sxs-lookup"><span data-stu-id="278e2-116">[*BufferCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka)—Receives and processes summary information about the current buffer, such as events lost.</span></span> <span data-ttu-id="278e2-117">ETW appelle le rappel après la transmission de tous les événements de la mémoire tampon au consommateur.</span><span class="sxs-lookup"><span data-stu-id="278e2-117">ETW calls the callback after delivering all events in the buffer to the consumer.</span></span> <span data-ttu-id="278e2-118">Le consommateur peut également utiliser ce rappel pour annuler le traitement des événements. Toutefois, si vous consommez des événements en temps réel, ETW remet les événements jusqu’à ce que le contrôleur arrête la session.</span><span class="sxs-lookup"><span data-stu-id="278e2-118">The consumer can also use this callback to cancel event processing; however, if you are consuming events in real time, ETW delivers events until the controller stops the session.</span></span>

<span data-ttu-id="278e2-119">Après avoir défini une ou plusieurs sessions de suivi, appelez la fonction [**OpenTrace**](/windows/win32/api/evntrace/nf-evntrace-opentracea) pour chaque session de trace que vous souhaitez traiter. vous pouvez traiter les événements à partir d’un ou de plusieurs fichiers journaux, mais à partir d’une seule session en temps réel.</span><span class="sxs-lookup"><span data-stu-id="278e2-119">After defining one or more trace sessions, call the [**OpenTrace**](/windows/win32/api/evntrace/nf-evntrace-opentracea) function for each trace session that you want to process; you can process events from one or more log files, but from only one real-time session.</span></span> <span data-ttu-id="278e2-120">Vous transmettez ensuite la liste des handles de session de suivi que **OpenTrace** retourne à la fonction [**ProcessTrace**](/windows/win32/api/evntrace/nf-evntrace-processtrace) .</span><span class="sxs-lookup"><span data-stu-id="278e2-120">You then pass the list of trace session handles that **OpenTrace** returns to the [**ProcessTrace**](/windows/win32/api/evntrace/nf-evntrace-processtrace) function.</span></span> <span data-ttu-id="278e2-121">La fonction **ProcessTrace** combine les événements, les trie par ordre chronologique, puis les remet aux rappels un par un.</span><span class="sxs-lookup"><span data-stu-id="278e2-121">The **ProcessTrace** function combines the events, sorts them into chronological order, and then delivers them to the callbacks one at a time.</span></span> <span data-ttu-id="278e2-122">Les événements peuvent être filtrés pour n’inclure que ceux qui appartiennent à un laps de temps spécifique à l’aide des paramètres *StartTime* et *EndTime* .</span><span class="sxs-lookup"><span data-stu-id="278e2-122">The events can be filtered to include only those that fall into a specific time frame using the *StartTime* and *EndTime* parameters.</span></span> <span data-ttu-id="278e2-123">La fonction **ProcessTrace** bloque le thread jusqu’à ce que votre consommateur traite tous les événements dans les sessions de trace, [*BufferCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka) retourne la **valeur false** ou que vous appelez [**CloseTrace**](/windows/win32/api/evntrace/nf-evntrace-closetrace).</span><span class="sxs-lookup"><span data-stu-id="278e2-123">The **ProcessTrace** function blocks the thread until your consumer processes all events in the trace sessions, the [*BufferCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka) returns **FALSE**, or you call [**CloseTrace**](/windows/win32/api/evntrace/nf-evntrace-closetrace).</span></span>

<span data-ttu-id="278e2-124">**Avant Windows Vista :** Vous pouvez appeler [**CloseTrace**](/windows/win32/api/evntrace/nf-evntrace-closetrace) uniquement après le retour de [**ProcessTrace**](/windows/win32/api/evntrace/nf-evntrace-processtrace) .</span><span class="sxs-lookup"><span data-stu-id="278e2-124">**Prior to Windows Vista:** You can call [**CloseTrace**](/windows/win32/api/evntrace/nf-evntrace-closetrace) only after [**ProcessTrace**](/windows/win32/api/evntrace/nf-evntrace-processtrace) returns.</span></span>

<span data-ttu-id="278e2-125">Pour obtenir un exemple qui montre comment utiliser des événements publiés à l’aide d’un manifeste, de fichiers MOF ou TMF, consultez [extraction de données d’événement à l’aide de Tdh](retrieving-event-data-using-tdh.md).</span><span class="sxs-lookup"><span data-stu-id="278e2-125">For an example that shows how to consume events published using a manifest, MOF, or TMF files, see [Retrieving Event Data Using TDH](retrieving-event-data-using-tdh.md).</span></span> <span data-ttu-id="278e2-126">Notez qu’à compter de Windows Vista, vous devez utiliser les fonctions d’assistance des données de trace (TDH) pour consommer des événements.</span><span class="sxs-lookup"><span data-stu-id="278e2-126">Note that beginning with Windows Vista, you should use the trace data helper (TDH) functions to consume events.</span></span>

<span data-ttu-id="278e2-127">Pour obtenir un exemple qui montre comment consommer des événements publiés à l’aide de MOF, consultez [extraction de données d’événement à l’aide de MOF](retrieving-event-data-using-mof.md).</span><span class="sxs-lookup"><span data-stu-id="278e2-127">For an example that shows how to consume events published using MOF, see [Retrieving Event Data Using MOF](retrieving-event-data-using-mof.md).</span></span>

 

 
