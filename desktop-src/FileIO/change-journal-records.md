---
description: À mesure que des fichiers, des répertoires et d’autres objets de système de fichiers NTFS sont ajoutés, supprimés et modifiés, le système de fichiers NTFS entre les enregistrements de journal de modification dans les flux, un pour chaque volume de l’ordinateur.
ms.assetid: c41aa3a8-c8d8-4bf2-9bbb-d6a6a556c5e4
title: Modifier les enregistrements de journal
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 56580a28c01ca164af4598cb290a37c8e36828f5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106519532"
---
# <a name="change-journal-records"></a><span data-ttu-id="63a5e-103">Modifier les enregistrements de journal</span><span class="sxs-lookup"><span data-stu-id="63a5e-103">Change Journal Records</span></span>

<span data-ttu-id="63a5e-104">À mesure que des fichiers, des répertoires et d’autres objets de système de fichiers NTFS sont ajoutés, supprimés et modifiés, le système de fichiers NTFS entre les enregistrements de journal de modification dans les flux, un pour chaque volume de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="63a5e-104">As files, directories, and other NTFS file system objects are added, deleted, and modified, the NTFS file system enters change journal records in streams, one for each volume on the computer.</span></span> <span data-ttu-id="63a5e-105">Chaque enregistrement indique le type de modification et l'objet modifié.</span><span class="sxs-lookup"><span data-stu-id="63a5e-105">Each record indicates the type of change and the object changed.</span></span> <span data-ttu-id="63a5e-106">Le décalage à partir du début du flux pour un enregistrement particulier est appelé numéro de séquence de mise à jour (USN) pour l’enregistrement particulier.</span><span class="sxs-lookup"><span data-stu-id="63a5e-106">The offset from the beginning of the stream for a particular record is called the update sequence number (USN) for the particular record.</span></span> <span data-ttu-id="63a5e-107">Les nouveaux enregistrements sont ajoutés à la fin du flux.</span><span class="sxs-lookup"><span data-stu-id="63a5e-107">New records are appended to the end of the stream.</span></span>

<span data-ttu-id="63a5e-108">Le système de fichiers NTFS peut supprimer les anciens enregistrements pour conserver de l’espace.</span><span class="sxs-lookup"><span data-stu-id="63a5e-108">The NTFS file system may delete old records to conserve space.</span></span> <span data-ttu-id="63a5e-109">Si des enregistrements nécessaires ont été supprimés, le service d’indexation récupère en réindexant le volume, comme c’est le cas lorsqu’il n’existe pas de journal des modifications.</span><span class="sxs-lookup"><span data-stu-id="63a5e-109">If needed records have been deleted, the indexing service recovers by re-indexing the volume, as it does when no change journal exists.</span></span>

<span data-ttu-id="63a5e-110">Le journal des modifications enregistre uniquement le fait d’une modification apportée à un fichier et la raison de la modification (par exemple, opérations d’écriture, troncation, augmentation, suppression, etc.).</span><span class="sxs-lookup"><span data-stu-id="63a5e-110">The change journal logs only the fact of a change to a file and the reason for the change (for example, write operations, truncation, lengthening, deletion, and so on).</span></span> <span data-ttu-id="63a5e-111">Il n’enregistre pas suffisamment d’informations pour permettre l’inversion de la modification.</span><span class="sxs-lookup"><span data-stu-id="63a5e-111">It does not record enough information to allow reversing the change.</span></span>

<span data-ttu-id="63a5e-112">En outre, plusieurs modifications apportées au même fichier peuvent entraîner l’ajout d’un seul indicateur de raison à l’enregistrement actuel.</span><span class="sxs-lookup"><span data-stu-id="63a5e-112">In addition, multiple changes to the same file may result in only one reason flag being added to the current record.</span></span> <span data-ttu-id="63a5e-113">Si le même type de modification se produit plusieurs fois, le système de fichiers NTFS n’écrit pas un nouvel enregistrement pour les modifications après le premier.</span><span class="sxs-lookup"><span data-stu-id="63a5e-113">If the same kind of change occurs more than once, the NTFS file system does not write a new record for the changes after the first.</span></span> <span data-ttu-id="63a5e-114">Par exemple, plusieurs opérations d’écriture sans intervention de fermeture et de réouverture n’aboutissent qu’à un seul enregistrement de modification avec la raison de l’indicateur USN raison du remplacement des données par le \_ \_ jeu de données \_ .</span><span class="sxs-lookup"><span data-stu-id="63a5e-114">For example, several write operations with no intervening close and reopen operations result in only one change record with the reason flag USN\_REASON\_DATA\_OVERWRITE set.</span></span>

<span data-ttu-id="63a5e-115">Pour illustrer le fonctionnement du journal des modifications, supposez qu’un utilisateur accède à un fichier dans l’ordre suivant :</span><span class="sxs-lookup"><span data-stu-id="63a5e-115">To illustrate how the change journal works, suppose a user accesses a file in the following order:</span></span>

1.  <span data-ttu-id="63a5e-116">Écrit dans le fichier.</span><span class="sxs-lookup"><span data-stu-id="63a5e-116">Writes to the file.</span></span>
2.  <span data-ttu-id="63a5e-117">Définit l’horodatage du fichier.</span><span class="sxs-lookup"><span data-stu-id="63a5e-117">Sets the time stamp for the file.</span></span>
3.  <span data-ttu-id="63a5e-118">Écrit dans le fichier.</span><span class="sxs-lookup"><span data-stu-id="63a5e-118">Writes to the file.</span></span>
4.  <span data-ttu-id="63a5e-119">Tronque le fichier.</span><span class="sxs-lookup"><span data-stu-id="63a5e-119">Truncates the file.</span></span>
5.  <span data-ttu-id="63a5e-120">Écrit dans le fichier.</span><span class="sxs-lookup"><span data-stu-id="63a5e-120">Writes to the file.</span></span>
6.  <span data-ttu-id="63a5e-121">Ferme le fichier.</span><span class="sxs-lookup"><span data-stu-id="63a5e-121">Closes the file.</span></span>

<span data-ttu-id="63a5e-122">Dans ce cas, le système de fichiers NTFS effectue les actions suivantes dans le journal des modifications (où \| indique une opération or au niveau du bit).</span><span class="sxs-lookup"><span data-stu-id="63a5e-122">In this case, the NTFS file system takes the following actions in the change journal (where \| indicates a bitwise OR operation).</span></span>



| <span data-ttu-id="63a5e-123">Événement</span><span class="sxs-lookup"><span data-stu-id="63a5e-123">Event</span></span>                                 | <span data-ttu-id="63a5e-124">Action du système de fichiers NTFS</span><span class="sxs-lookup"><span data-stu-id="63a5e-124">NTFS file system action</span></span>                                                                                                                                                                                                                                                    |
|---------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="63a5e-125">Opération d’écriture initiale</span><span class="sxs-lookup"><span data-stu-id="63a5e-125">Initial write operation</span></span><br/>    | <span data-ttu-id="63a5e-126">Le système de fichiers NTFS écrit un nouvel enregistrement USN avec l' \_ indicateur de raison du remplacement des données du motif USN \_ \_ défini.</span><span class="sxs-lookup"><span data-stu-id="63a5e-126">The NTFS file system writes a new USN record with the USN\_REASON\_DATA\_OVERWRITE reason flag set.</span></span> <span data-ttu-id="63a5e-127">Pour plus d’informations sur les indicateurs de raison possibles, consultez la structure de l' [**\_ enregistrement USN**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_record_v2) .</span><span class="sxs-lookup"><span data-stu-id="63a5e-127">For more information on possible reason flags, see the [**USN\_RECORD**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_record_v2) structure.</span></span><br/>                                                     |
| <span data-ttu-id="63a5e-128">Définition de l’horodatage de fichier</span><span class="sxs-lookup"><span data-stu-id="63a5e-128">Setting of file time stamp</span></span><br/> | <span data-ttu-id="63a5e-129">Le système de fichiers NTFS écrit un nouvel enregistrement USN avec l’indicateur paramètre USN \_ motif de \_ remplacement des données USN raison de la modification des \_ \| informations de \_ \_ base \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="63a5e-129">The NTFS file system writes a new USN record with the flag setting USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE.</span></span><br/>                                                                                                                            |
| <span data-ttu-id="63a5e-130">Deuxième opération d’écriture</span><span class="sxs-lookup"><span data-stu-id="63a5e-130">Second write operation</span></span><br/>     | <span data-ttu-id="63a5e-131">Le système de fichiers NTFS n’écrit pas un nouvel enregistrement USN.</span><span class="sxs-lookup"><span data-stu-id="63a5e-131">The NTFS file system does not write a new USN record.</span></span> <span data-ttu-id="63a5e-132">Étant donné que le \_ \_ \_ remplacement des données du motif USN est déjà défini pour l’enregistrement existant, aucune modification n’est apportée à l’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="63a5e-132">Because USN\_REASON\_DATA\_OVERWRITE is already set for the existing record, no changes are made to the record.</span></span><br/>                                                                                           |
| <span data-ttu-id="63a5e-133">Troncation de fichier</span><span class="sxs-lookup"><span data-stu-id="63a5e-133">File truncation</span></span><br/>            | <span data-ttu-id="63a5e-134">Le système de fichiers NTFS écrit un nouvel enregistrement USN avec l’indicateur paramètre USN \_ motif du remplacement des données USN motif de la modification de l' \_ \_ \| \_ USN raison de la \_ \_ \_ \| \_ \_ \_ troncation des données.</span><span class="sxs-lookup"><span data-stu-id="63a5e-134">The NTFS file system writes a new USN record with the flag setting USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE \| USN\_REASON\_DATA\_TRUNCATION.</span></span><br/>                                                                                           |
| <span data-ttu-id="63a5e-135">Troisième opération d’écriture</span><span class="sxs-lookup"><span data-stu-id="63a5e-135">Third write operation</span></span><br/>      | <span data-ttu-id="63a5e-136">Le système de fichiers NTFS n’écrit pas un nouvel enregistrement USN.</span><span class="sxs-lookup"><span data-stu-id="63a5e-136">The NTFS file system does not write a new USN record.</span></span> <span data-ttu-id="63a5e-137">Étant donné que le \_ \_ \_ remplacement des données du motif USN est déjà défini pour l’enregistrement existant, aucune modification n’est apportée à l’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="63a5e-137">Because USN\_REASON\_DATA\_OVERWRITE is already set for the existing record, no changes are made to the record.</span></span><br/>                                                                                           |
| <span data-ttu-id="63a5e-138">Opération de fermeture</span><span class="sxs-lookup"><span data-stu-id="63a5e-138">Close operation</span></span><br/>            | <span data-ttu-id="63a5e-139">Si l’utilisateur qui apporte des modifications est le seul utilisateur du fichier, le système de fichiers NTFS écrit un nouvel enregistrement USN avec le paramètre d’indicateur suivant : valeur USN \_ motif de \_ remplacement des données \_ USN motif de modification de l' \| USN motif de la troncation des \_ données \_ \_ \_ \| \_ \_ \_ \| \_ \_ USN raison de la fermeture.</span><span class="sxs-lookup"><span data-stu-id="63a5e-139">If the user making changes is the only user of the file, the NTFS file system writes a new USN record with the following flag setting: USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE \| USN\_REASON\_DATA\_TRUNCATION \| USN\_REASON\_CLOSE.</span></span><br/> |



 

<span data-ttu-id="63a5e-140">Le journal des modifications accumule une série d’enregistrements entre la première ouverture et la dernière fermeture d’un fichier.</span><span class="sxs-lookup"><span data-stu-id="63a5e-140">The change journal accumulates a series of records between the first opening and last closing of a file.</span></span> <span data-ttu-id="63a5e-141">Un nouvel indicateur de motif est défini pour chaque enregistrement, ce qui indique qu’un nouveau type de modification s’est produit.</span><span class="sxs-lookup"><span data-stu-id="63a5e-141">Each record has a new reason flag set, indicating that a new kind of change has occurred.</span></span> <span data-ttu-id="63a5e-142">La séquence d’enregistrements donne un historique partiel du fichier.</span><span class="sxs-lookup"><span data-stu-id="63a5e-142">The sequence of records gives a partial history of the file.</span></span> <span data-ttu-id="63a5e-143">L’enregistrement final, créé lorsque le fichier est fermé, ajoute l' \_ indicateur de fermeture de raison USN \_ .</span><span class="sxs-lookup"><span data-stu-id="63a5e-143">The final record, created when the file is closed, adds the USN\_REASON\_CLOSE flag.</span></span> <span data-ttu-id="63a5e-144">Cet enregistrement représente un résumé des modifications apportées au fichier, mais contrairement aux enregistrements précédents, ne donne aucune indication de l’ordre des modifications.</span><span class="sxs-lookup"><span data-stu-id="63a5e-144">This record represents a summary of changes to the file, but unlike the prior records, gives no indication of the order of the changes.</span></span>

<span data-ttu-id="63a5e-145">L’utilisateur suivant qui accède au fichier et le modifie génère un nouvel enregistrement USN avec un seul indicateur de raison.</span><span class="sxs-lookup"><span data-stu-id="63a5e-145">The next user to access and change the file generates a new USN record with a single reason flag.</span></span>

 

 




