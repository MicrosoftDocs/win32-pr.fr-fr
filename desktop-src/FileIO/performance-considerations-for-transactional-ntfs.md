---
description: Recommandations pour les transactions de système de fichiers optimales.
ms.assetid: 847939ff-5322-4023-8ef7-9d845e80d65c
title: Considérations relatives aux performances pour le NTFS transactionnel
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a71f7e100e1ddd8524932a4a259a12092bddcb6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103952642"
---
# <a name="performance-considerations-for-transactional-ntfs"></a><span data-ttu-id="8ebd3-103">Considérations relatives aux performances pour le NTFS transactionnel</span><span class="sxs-lookup"><span data-stu-id="8ebd3-103">Performance Considerations for Transactional NTFS</span></span>

<span data-ttu-id="8ebd3-104">Le NTFS transactionnel (TxF) a été soigneusement conçu pour les performances et est généralement plus performant que les alternatives transactionnelles à usage général dans des scénarios similaires.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-104">Transactional NTFS (TxF) has been carefully designed for performance and will typically perform better than general-purpose transactional alternatives under similar scenarios.</span></span> <span data-ttu-id="8ebd3-105">Toutefois, les transactions de système de fichiers ont plus de charge que les opérations non transactionnelles et une réduction des performances d’e/s par rapport aux e/s non transactionnelles est attendue.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-105">However, file system transactions have more overhead than non-transacted operations, and some reduction in I/O performance compared to non-transacted I/O is to be expected.</span></span> <span data-ttu-id="8ebd3-106">Les applications critiques pour les performances doivent effectuer un cycle de qualification d’adoption de technologie, en évaluant l’impact sur les performances des opérations de système de fichiers transactionnelles.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-106">Performance-critical applications should perform a technology adoption qualification cycle, evaluating the performance impact of transacted file system operations.</span></span>

## <a name="overview-of-txf-operations"></a><span data-ttu-id="8ebd3-107">Vue d’ensemble des opérations TxF</span><span class="sxs-lookup"><span data-stu-id="8ebd3-107">Overview of TxF Operations</span></span>

<span data-ttu-id="8ebd3-108">TxF utilise la journalisation des *annulations* pour enregistrer les modifications nécessaires pour réintégrer le système de fichiers dans un état cohérent, également appelé restauration, en cas d’abandon d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-108">TxF uses *undo* logging to record the changes necessary to put the file system back into a consistent state, also referred to as a rollback, should a transaction abort occur.</span></span> <span data-ttu-id="8ebd3-109">Cette annulation de journalisation génère des e/s supplémentaires et constitue la source de la surcharge de performances TxF par rapport aux opérations de système de fichiers non transactionnelles.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-109">This undo logging generates additional I/O and is the source of TxF performance overhead compared to non-transactional file system operations.</span></span>

<span data-ttu-id="8ebd3-110">Voici une synthèse générale du fonctionnement de TxF :</span><span class="sxs-lookup"><span data-stu-id="8ebd3-110">A high-level summary of how TxF operates is as follows:</span></span>

-   <span data-ttu-id="8ebd3-111">À mesure qu’une transaction progresse, TxF écrit des enregistrements d' *annulation* dans son fichier journal pour chaque modification qu’il effectue dans le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-111">As a transaction progresses, TxF writes *undo* records into its log file for each modification it makes to the file system.</span></span> <span data-ttu-id="8ebd3-112">En cas d’abandon, ces enregistrements d’annulation sont analysés pour replacer le système de fichiers dans l’État où il se trouvait avant le début de la transaction.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-112">If an abort occurs, these undo records are parsed to put the file system back in the state it was before the transaction began.</span></span>
-   <span data-ttu-id="8ebd3-113">Un enregistrement d’annulation de *modification de métadonnées* décrit une modification apportée uniquement aux métadonnées du système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-113">A *metadata change* undo record describes a change only to the file system's metadata.</span></span> <span data-ttu-id="8ebd3-114">Le déplacement, le changement de nom, les ajouts et les modifications d’attributs sont des exemples.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-114">Some examples of this are moves, renames, appends, and attribute changes.</span></span> <span data-ttu-id="8ebd3-115">Pour les enregistrements d’annulation de modification de métadonnées, toutes les informations nécessaires pour annuler la modification se trouvent dans l’enregistrement et stockées dans le fichier journal.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-115">For metadata change undo records, all of the information necessary to undo the change is in the record and stored in the log file.</span></span>
-   <span data-ttu-id="8ebd3-116">Un enregistrement d’annulation de *remplacement* décrit un remplacement d’une partie d’un fichier.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-116">An *overwrite* undo record describes an overwrite of a portion of a file.</span></span> <span data-ttu-id="8ebd3-117">Lorsqu’un remplacement de fichier se produit, le contenu d’origine du fichier est stocké dans un fichier d’annulation spécial dans un répertoire masqué et l’enregistrement d’annulation du remplacement pointe sur ce fichier.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-117">When a file overwrite occurs, the file's original contents are stored in a special undo file in a hidden directory and the overwrite undo record points to this file.</span></span> <span data-ttu-id="8ebd3-118">Lorsque des mises à jour de fichiers sont finalement vidées du cache au disque, le contenu du fichier d’annulation doit également être vidé. par conséquent, un remplacement de fichier transactionnel peut générer jusqu’à deux opérations d’e/s aléatoires supplémentaires : une pour lire les anciennes données et une pour les écrire dans le fichier d’annulation.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-118">When file updates are eventually flushed from cache to disk, the contents of the undo file must also be flushed, so a transacted file overwrite could generate up to two extra random I/O operations: one to read the old data and one to write it to the undo file.</span></span> <span data-ttu-id="8ebd3-119">Ces opérations d’e/s supplémentaires sont un coût de fonctionnement de TxF.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-119">These extra I/O operations are a performance cost of TxF.</span></span>
-   <span data-ttu-id="8ebd3-120">Lorsqu’une validation se produit, TxF vide tout d’abord toutes les informations d’annulation, puis vide les modifications de fichier réelles, puis écrit et vide un enregistrement de validation.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-120">When a commit occurs, TxF first flushes all undo information, then flushes the actual file changes, and then writes and flushes a commit record.</span></span> <span data-ttu-id="8ebd3-121">S’il n’y a aucun fichier d’annulation à vider, la seule surcharge TxF supplémentaire relative aux e/s non transactionnelles est le vidage des journaux.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-121">If there are no undo files to flush, the only additional TxF overhead relative to non-transacted I/O is the log flushes themselves.</span></span> <span data-ttu-id="8ebd3-122">Toutefois, les vidages du journal entraînent des écritures séquentielles volumineuses efficaces, ce qui réduit le coût des performances.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-122">However, log flushes result in efficient large sequential writes so the performance cost is minimal.</span></span>
-   <span data-ttu-id="8ebd3-123">TxF est optimisé pour la validation.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-123">TxF is optimized for commit.</span></span> <span data-ttu-id="8ebd3-124">Il est prévu que la plupart des transactions aboutissent et n’aient pas besoin d’être restaurées. par conséquent, tous les enregistrements d’annulation d’une transaction sont censés être inutilisés.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-124">It is expected that most transactions will succeed and not need to rollback, therefore all undo records for a transaction are expected to go unused.</span></span> <span data-ttu-id="8ebd3-125">Du point de vue des performances, les opérations de validation TxF sont rapides et les restaurations nécessitent beaucoup de ressources.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-125">From a performance perspective, TxF commit operations are fast and rollbacks are resource-intensive.</span></span>
-   <span data-ttu-id="8ebd3-126">La restauration est plus gourmande en ressources que la validation.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-126">Rollback is more resource-intensive than commit.</span></span> <span data-ttu-id="8ebd3-127">Pendant la restauration, toutes les modifications apportées à la transaction doivent être annulées.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-127">During rollback, all the changes that were made in the transaction have to be un-done.</span></span> <span data-ttu-id="8ebd3-128">En général, la durée de la restauration peut être approximativement la même que celle qui a été nécessaire pour apporter les modifications à l’origine.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-128">In general, rollback duration can be approximately the same it took to originally make the changes.</span></span> <span data-ttu-id="8ebd3-129">Par exemple, s’il a fallu 1 seconde pour effectuer toutes les modifications, il peut prendre environ 1 seconde pour les annuler.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-129">For example, if it took 1 second to make all the changes then it could take about 1 second to undo them.</span></span> <span data-ttu-id="8ebd3-130">Pour les transactions très longues, la restauration peut créer des impacts supplémentaires sur les performances.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-130">For very long transactions, rollback can create additional performance impacts.</span></span> <span data-ttu-id="8ebd3-131">Par exemple, le temps de démarrage du système peut être retardé si le système doit restaurer automatiquement une transaction dans le cas où le système cesse de répondre et doit effectuer un redémarrage non planifié.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-131">For example, system boot time can be delayed if the system must automatically rollback a transaction in the event that the system stops responding and must perform an unscheduled restart.</span></span>

<span data-ttu-id="8ebd3-132">Les conclusions résumées concernant les performances qui peuvent être extraites de la liste précédente sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="8ebd3-132">The summary conclusions about performance that can be drawn from the previous list are as follows:</span></span>

-   <span data-ttu-id="8ebd3-133">Le coût des performances de TxF pour les transactions impliquant des remplacements de fichiers peut être significatif.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-133">The performance cost of TxF for transactions involving file overwrites can be significant.</span></span>
-   <span data-ttu-id="8ebd3-134">Le coût des performances de TxF pour les transactions impliquant uniquement des opérations de métadonnées peut être relativement faible, à condition que des transactions volumineuses soient utilisées.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-134">The performance cost of TxF for transactions involving only metadata operations can be relatively low, provided large transactions be used.</span></span> <span data-ttu-id="8ebd3-135">Une transaction importante est lorsqu’il existe de nombreux enregistrements d’annulation pour chaque enregistrement de validation.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-135">A large transaction is when there are many undo records for every commit record.</span></span>

## <a name="recommendations-for-best-performance"></a><span data-ttu-id="8ebd3-136">Recommandations pour des performances optimales</span><span class="sxs-lookup"><span data-stu-id="8ebd3-136">Recommendations For Best Performance</span></span>

<span data-ttu-id="8ebd3-137">Amortir la surcharge TxF sur des transactions plus volumineuses.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-137">Amortize TxF overhead over larger transactions.</span></span> <span data-ttu-id="8ebd3-138">Par exemple, si vous avez *n* ensembles de modifications à faire lorsque chaque modification comporte *m* étapes et que vous avez la possibilité de le faire comme *n* transactions de *m* étapes, chacune d’entre elles, ou de la faire comme une seule transaction avec *m* \* *N* étapes, cette dernière option est plus efficace.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-138">For example, if you have *N* sets of changes to make where each change has *M* steps and you have the option to either do this as *N* transactions of *M* steps each or do it all as a single transaction with *M*\**N* steps, the latter option would be more efficient.</span></span>

<span data-ttu-id="8ebd3-139">Tenez compte de l’impact possible sur le démarrage des transactions très volumineuses.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-139">Consider the possible impact on boot of very large transactions.</span></span> <span data-ttu-id="8ebd3-140">Comme indiqué précédemment, la restauration peut être lente et retarder le démarrage si le système doit effectuer des restaurations automatiques au moment du démarrage.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-140">As previously stated, rollback can be slow and will delay boot time if the system needs to perform automatic rollbacks as boot time.</span></span> <span data-ttu-id="8ebd3-141">Plus la transaction est grande, plus le délai est long.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-141">The larger the transaction, the longer the delay.</span></span>

<span data-ttu-id="8ebd3-142">Conservez les transactions dans la plupart des opérations de métadonnées.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-142">Keep transactions to mostly metadata operations.</span></span> <span data-ttu-id="8ebd3-143">C’est ce que TxF est optimisé pour et, en général, les performances sont identiques à celles des e/s de fichier non transactionnelles pour les transactions de métadonnées volumineuses.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-143">This is what TxF is optimized for and, in general, the performance is about the same as non-transacted file I/O for large metadata transactions.</span></span> <span data-ttu-id="8ebd3-144">[**MoveFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda), [**SetFileAttributesTransacted**](/windows/desktop/api/WinBase/nf-winbase-setfileattributestransacteda), [**CopyFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-copyfiletransacteda), [**DeleteFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda), [**CreateHardLinkTransacted**](/windows/desktop/api/WinBase/nf-winbase-createhardlinktransacteda)et les écritures ajoutées (appels à la fonction [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) lorsque le pointeur de fichier se trouve à la fin du fichier ou *EOF*) sont des exemples de fonctions de métadonnées efficaces.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-144">Examples of efficient metadata TxF functions are [**MoveFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda), [**SetFileAttributesTransacted**](/windows/desktop/api/WinBase/nf-winbase-setfileattributestransacteda), [**CopyFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-copyfiletransacteda), [**DeleteFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda), [**CreateHardLinkTransacted**](/windows/desktop/api/WinBase/nf-winbase-createhardlinktransacteda), and appended writes (calls to the [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) function when the file pointer as at the end the file, or *EOF*).</span></span> <span data-ttu-id="8ebd3-145">Un exemple d’opérations non-métadonnées consommatrices de ressources sont des appels à la fonction **WriteFile** lorsque le pointeur de fichier n’est pas au EOF.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-145">An example of resource-intensive non-metadata operations are calls to the **WriteFile** function when the file pointer is not at the EOF.</span></span>

## <a name="summary-of-txf-performance-expectations"></a><span data-ttu-id="8ebd3-146">Résumé des attentes de performances TxF</span><span class="sxs-lookup"><span data-stu-id="8ebd3-146">Summary of TxF Performance Expectations</span></span>

<span data-ttu-id="8ebd3-147">Pour les mises à jour sur place, les remplacements dans une section d’un fichier sont beaucoup plus lents que les e/s de fichier non transactionnelles, tandis que les performances TxF pour les opérations de métadonnées du système de fichiers (par exemple, Create, Move et Append) sont comparables aux e/s de fichier non transactionnelles pour les transactions volumineuses.</span><span class="sxs-lookup"><span data-stu-id="8ebd3-147">For in-place updates, overwrites to a section of a file will be much slower than non-transacted file I/O, while TxF performance for file system metadata operations (for example, create, move, and append) is comparable to non-transacted file I/O for large transactions.</span></span>

 

 



