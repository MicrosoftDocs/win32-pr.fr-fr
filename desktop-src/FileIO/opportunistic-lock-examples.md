---
description: Diagrammes de vues du trafic réseau pour un verrou opportuniste de niveau 1, un verrou par lot opportuniste et un verrou opportuniste de filtre.
ms.assetid: 78830113-b18e-40c7-8ec4-8896dbc58030
title: Exemples de verrouillage opportuniste
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ae8b8a0c5b04897ddc2fc8f2e3bdec20f2fdb02d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104529265"
---
# <a name="opportunistic-lock-examples"></a><span data-ttu-id="860ce-103">Exemples de verrouillage opportuniste</span><span class="sxs-lookup"><span data-stu-id="860ce-103">Opportunistic Lock Examples</span></span>

<span data-ttu-id="860ce-104">Les exemples suivants montrent des données et des mouvements de messages SMB en cas de verrouillage opportuniste.</span><span class="sxs-lookup"><span data-stu-id="860ce-104">The following examples show data and SMB message movements as opportunistic locks are made and broken.</span></span> <span data-ttu-id="860ce-105">Notez que les clients peuvent mettre en cache les données d’attribut de fichier ainsi que les données de fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-105">Note that clients can cache file attribute data as well as file data.</span></span>

<span data-ttu-id="860ce-106">Notez également que ces exemples sont basés sur des situations où les applications clientes demandent des verrous opportunistes à partir de serveurs distants.</span><span class="sxs-lookup"><span data-stu-id="860ce-106">Also note that these examples are based on situations where client applications are requesting opportunistic locks from remote servers.</span></span> <span data-ttu-id="860ce-107">Ces processus sont initiés automatiquement par le redirecteur réseau et le serveur distant ; il n’y a aucune implication directe de la part de l’application cliente ou des applications.</span><span class="sxs-lookup"><span data-stu-id="860ce-107">These processes are automatically initiated by the network redirector and the remote server—there is no direct involvement by the client application or applications.</span></span> <span data-ttu-id="860ce-108">Les processus décrits dans ces exemples peuvent être généralisés dans des situations où les applications clientes locales demandent directement des verrous opportunistes à partir du système de fichiers local, à l’exception du fait qu’aucun échange de données sur le réseau n’est impliqué.</span><span class="sxs-lookup"><span data-stu-id="860ce-108">The processes described by these examples can be generalized into situations where local client applications are directly requesting opportunistic locks from the local file system, with the exception that no exchange of data over the network is involved.</span></span>

## <a name="level-1-opportunistic-lock"></a><span data-ttu-id="860ce-109">Verrou opportuniste de niveau 1</span><span class="sxs-lookup"><span data-stu-id="860ce-109">Level 1 Opportunistic Lock</span></span>

<span data-ttu-id="860ce-110">Le diagramme suivant montre une vue du trafic réseau d’un verrou opportuniste de niveau 1 sur un fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-110">The following diagram shows a network-traffic view of a level 1 opportunistic lock on a file.</span></span> <span data-ttu-id="860ce-111">Les flèches indiquent le sens du déplacement des données, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="860ce-111">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="860ce-112">Événement</span><span class="sxs-lookup"><span data-stu-id="860ce-112">Event</span></span> | <span data-ttu-id="860ce-113">Client X</span><span class="sxs-lookup"><span data-stu-id="860ce-113">Client X</span></span>                                          | <span data-ttu-id="860ce-114">Serveur</span><span class="sxs-lookup"><span data-stu-id="860ce-114">Server</span></span>                                   | <span data-ttu-id="860ce-115">Client Y</span><span class="sxs-lookup"><span data-stu-id="860ce-115">Client Y</span></span>                                          |
|-------|---------------------------------------------------|------------------------------------------|---------------------------------------------------|
| <span data-ttu-id="860ce-116">1</span><span class="sxs-lookup"><span data-stu-id="860ce-116">1</span></span>     | <span data-ttu-id="860ce-117">Ouvre le fichier, demande le niveau 1 Lock = =></span><span class="sxs-lookup"><span data-stu-id="860ce-117">Opens file, requests level 1 lock ==></span></span>          |                                          |                                                   |
| <span data-ttu-id="860ce-118">2</span><span class="sxs-lookup"><span data-stu-id="860ce-118">2</span></span>     |                                                   | <span data-ttu-id="860ce-119"><= = octroie le niveau 1 de verrouillage opportuniste</span><span class="sxs-lookup"><span data-stu-id="860ce-119"><== Grants level 1 opportunistic lock</span></span> |                                                   |
| <span data-ttu-id="860ce-120">3</span><span class="sxs-lookup"><span data-stu-id="860ce-120">3</span></span>     | <span data-ttu-id="860ce-121">Effectue les opérations de lecture, d’écriture et d’autres opérations = =></span><span class="sxs-lookup"><span data-stu-id="860ce-121">Performs read, write, and other operations ==></span></span> |                                          |                                                   |
| <span data-ttu-id="860ce-122">4</span><span class="sxs-lookup"><span data-stu-id="860ce-122">4</span></span>     |                                                   |                                          | <span data-ttu-id="860ce-123"><= = demandes d’ouverture de fichier</span><span class="sxs-lookup"><span data-stu-id="860ce-123"><== Requests to open file</span></span>                      |
| <span data-ttu-id="860ce-124">5</span><span class="sxs-lookup"><span data-stu-id="860ce-124">5</span></span>     |                                                   | <span data-ttu-id="860ce-125"><= = interrompt le verrouillage opportuniste</span><span class="sxs-lookup"><span data-stu-id="860ce-125"><== Breaks opportunistic lock</span></span>         |                                                   |
| <span data-ttu-id="860ce-126">6</span><span class="sxs-lookup"><span data-stu-id="860ce-126">6</span></span>     | <span data-ttu-id="860ce-127">Ignore les données en lecture anticipée</span><span class="sxs-lookup"><span data-stu-id="860ce-127">Discards read-ahead data</span></span>                          |                                          |                                                   |
| <span data-ttu-id="860ce-128">7</span><span class="sxs-lookup"><span data-stu-id="860ce-128">7</span></span>     | <span data-ttu-id="860ce-129">Écrit les données = =></span><span class="sxs-lookup"><span data-stu-id="860ce-129">Writes data ==></span></span>                                |                                          |                                                   |
| <span data-ttu-id="860ce-130">8</span><span class="sxs-lookup"><span data-stu-id="860ce-130">8</span></span>     | <span data-ttu-id="860ce-131">Envoie le message « Close » ou « Done » = =></span><span class="sxs-lookup"><span data-stu-id="860ce-131">Sends "close" or "done" message ==></span></span>            |                                          |                                                   |
| <span data-ttu-id="860ce-132">9</span><span class="sxs-lookup"><span data-stu-id="860ce-132">9</span></span>     |                                                   | <span data-ttu-id="860ce-133">Opération d’ouverture OK = =></span><span class="sxs-lookup"><span data-stu-id="860ce-133">Okays open operation ==></span></span>              |                                                   |
| <span data-ttu-id="860ce-134">10</span><span class="sxs-lookup"><span data-stu-id="860ce-134">10</span></span>    | <span data-ttu-id="860ce-135">Effectue les opérations de lecture, d’écriture et d’autres opérations = =></span><span class="sxs-lookup"><span data-stu-id="860ce-135">Performs read, write, and other operations ==></span></span> |                                          | <span data-ttu-id="860ce-136"><= = effectue des opérations de lecture, d’écriture et d’autres opérations</span><span class="sxs-lookup"><span data-stu-id="860ce-136"><== Performs read, write, and other operations</span></span> |



 

<span data-ttu-id="860ce-137">Dans l’épreuve 1, le client X ouvre un fichier et, dans le cadre de l’opération d’ouverture, demande un verrou opportuniste de niveau 1 sur le fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-137">In event 1, client X opens a file and as part of the open operation requests a level 1 opportunistic lock on the file.</span></span> <span data-ttu-id="860ce-138">Dans l’événement 2, le serveur accorde le verrou de niveau 1, car aucun autre client n’a ouvert le fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-138">In event 2, the server grants the level 1 lock because no other client has the file open.</span></span> <span data-ttu-id="860ce-139">Le client continue d’accéder au fichier de la manière habituelle dans l’événement 3.</span><span class="sxs-lookup"><span data-stu-id="860ce-139">The client proceeds to access the file in the usual manner in event 3.</span></span>

<span data-ttu-id="860ce-140">Dans l’épreuve 4, le client Y tente d’ouvrir le fichier et demande un verrou opportuniste.</span><span class="sxs-lookup"><span data-stu-id="860ce-140">In event 4, client Y attempts to open the file and requests an opportunistic lock.</span></span> <span data-ttu-id="860ce-141">Le serveur constate que le fichier X est ouvert.</span><span class="sxs-lookup"><span data-stu-id="860ce-141">The server sees that client X has the file open.</span></span> <span data-ttu-id="860ce-142">Le serveur ignore la demande de Y pendant que le client X vide toutes les données d’écriture et abandonne son cache de lecture pour le fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-142">The server ignores Y's request while client X flushes any write data and abandons its read cache for the file.</span></span>

<span data-ttu-id="860ce-143">Le serveur Force X à nettoyer en envoyant à X un message SMB qui rompt le verrou opportuniste, événement 5.</span><span class="sxs-lookup"><span data-stu-id="860ce-143">The server forces X to clean up by sending to X an SMB message breaking the opportunistic lock, event 5.</span></span> <span data-ttu-id="860ce-144">Le client X « en mode silencieux » ignore les données en lecture anticipée ; en d’autres termes, ce processus ne génère aucun trafic réseau.</span><span class="sxs-lookup"><span data-stu-id="860ce-144">Client X "silently" discards any read-ahead data; in other words, this process generates no network traffic.</span></span> <span data-ttu-id="860ce-145">Dans l’épreuve 7, le client X écrit toutes les données d’écriture mises en cache sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="860ce-145">In event 7, client X writes any cached write data to the server.</span></span> <span data-ttu-id="860ce-146">Lorsque le client X écrit des données mises en cache sur le serveur, le client X envoie un message « fermer » ou « terminé » au serveur, événement 8.</span><span class="sxs-lookup"><span data-stu-id="860ce-146">When client X is done writing cached data to the server, client X sends either a "close" or a "done" message to the server, event 8.</span></span>

<span data-ttu-id="860ce-147">Une fois que le serveur a été averti que le client X a terminé le vidage du cache d’écriture sur le serveur ou a fermé le fichier, le serveur peut ouvrir le fichier pour le client Y, dans l’événement 9.</span><span class="sxs-lookup"><span data-stu-id="860ce-147">After the server has been notified that client X is done flushing its write cache to the server or has closed the file, then the server can open the file for client Y, in event 9.</span></span> <span data-ttu-id="860ce-148">Étant donné que le serveur a maintenant deux clients avec le même fichier ouvert, il n’accorde un verrou opportuniste à aucun d’entre eux.</span><span class="sxs-lookup"><span data-stu-id="860ce-148">Because the server now has two clients with the same file open, it grants an opportunistic lock to neither.</span></span> <span data-ttu-id="860ce-149">Les deux clients poursuivent la lecture à partir du fichier et l’un ou l’autre n’écrit pas dans le fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-149">Both clients proceed to read from the file, and one or neither writes to the file.</span></span>

## <a name="batch-opportunistic-lock"></a><span data-ttu-id="860ce-150">Verrouillage opportuniste par lot</span><span class="sxs-lookup"><span data-stu-id="860ce-150">Batch Opportunistic Lock</span></span>

<span data-ttu-id="860ce-151">Le diagramme suivant montre une vue du trafic réseau d’un verrou par lot opportuniste.</span><span class="sxs-lookup"><span data-stu-id="860ce-151">The following diagram shows a network-traffic view of a batch opportunistic lock.</span></span> <span data-ttu-id="860ce-152">Les flèches indiquent le sens du déplacement des données, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="860ce-152">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="860ce-153">Événement</span><span class="sxs-lookup"><span data-stu-id="860ce-153">Event</span></span> | <span data-ttu-id="860ce-154">Client X</span><span class="sxs-lookup"><span data-stu-id="860ce-154">Client X</span></span>                               | <span data-ttu-id="860ce-155">Serveur</span><span class="sxs-lookup"><span data-stu-id="860ce-155">Server</span></span>                                 | <span data-ttu-id="860ce-156">Client Y</span><span class="sxs-lookup"><span data-stu-id="860ce-156">Client Y</span></span>                                          |
|-------|----------------------------------------|----------------------------------------|---------------------------------------------------|
| <span data-ttu-id="860ce-157">1</span><span class="sxs-lookup"><span data-stu-id="860ce-157">1</span></span>     | <span data-ttu-id="860ce-158">Ouvre le fichier, demande un verrou de lot = =></span><span class="sxs-lookup"><span data-stu-id="860ce-158">Opens file, requests batch lock ==></span></span> |                                        |                                                   |
| <span data-ttu-id="860ce-159">2</span><span class="sxs-lookup"><span data-stu-id="860ce-159">2</span></span>     |                                        | <span data-ttu-id="860ce-160"><= = octroie un verrou opportuniste par lot</span><span class="sxs-lookup"><span data-stu-id="860ce-160"><== Grants batch opportunistic lock</span></span> |                                                   |
| <span data-ttu-id="860ce-161">3</span><span class="sxs-lookup"><span data-stu-id="860ce-161">3</span></span>     | <span data-ttu-id="860ce-162">Lit le fichier = =></span><span class="sxs-lookup"><span data-stu-id="860ce-162">Reads file ==></span></span>                      |                                        |                                                   |
| <span data-ttu-id="860ce-163">4</span><span class="sxs-lookup"><span data-stu-id="860ce-163">4</span></span>     |                                        | <span data-ttu-id="860ce-164"><= = envoie des données</span><span class="sxs-lookup"><span data-stu-id="860ce-164"><== Sends data</span></span>                      |                                                   |
| <span data-ttu-id="860ce-165">5</span><span class="sxs-lookup"><span data-stu-id="860ce-165">5</span></span>     | <span data-ttu-id="860ce-166">Ferme le fichier</span><span class="sxs-lookup"><span data-stu-id="860ce-166">Closes file</span></span>                            |                                        |                                                   |
| <span data-ttu-id="860ce-167">6</span><span class="sxs-lookup"><span data-stu-id="860ce-167">6</span></span>     | <span data-ttu-id="860ce-168">Ouvre le fichier</span><span class="sxs-lookup"><span data-stu-id="860ce-168">Opens file</span></span>                             |                                        |                                                   |
| <span data-ttu-id="860ce-169">7</span><span class="sxs-lookup"><span data-stu-id="860ce-169">7</span></span>     | <span data-ttu-id="860ce-170">Recherche des données</span><span class="sxs-lookup"><span data-stu-id="860ce-170">Searches for data</span></span>                      |                                        |                                                   |
| <span data-ttu-id="860ce-171">8</span><span class="sxs-lookup"><span data-stu-id="860ce-171">8</span></span>     | <span data-ttu-id="860ce-172">Lit les données = =></span><span class="sxs-lookup"><span data-stu-id="860ce-172">Reads data ==></span></span>                      |                                        |                                                   |
| <span data-ttu-id="860ce-173">9</span><span class="sxs-lookup"><span data-stu-id="860ce-173">9</span></span>     |                                        | <span data-ttu-id="860ce-174"><= = envoie des données</span><span class="sxs-lookup"><span data-stu-id="860ce-174"><== Sends data</span></span>                      |                                                   |
| <span data-ttu-id="860ce-175">10</span><span class="sxs-lookup"><span data-stu-id="860ce-175">10</span></span>    | <span data-ttu-id="860ce-176">Ferme le fichier</span><span class="sxs-lookup"><span data-stu-id="860ce-176">Closes file</span></span>                            |                                        |                                                   |
| <span data-ttu-id="860ce-177">11</span><span class="sxs-lookup"><span data-stu-id="860ce-177">11</span></span>    |                                        |                                        | <span data-ttu-id="860ce-178"><= = ouvre le fichier</span><span class="sxs-lookup"><span data-stu-id="860ce-178"><== Opens file</span></span>                                 |
| <span data-ttu-id="860ce-179">12</span><span class="sxs-lookup"><span data-stu-id="860ce-179">12</span></span>    |                                        | <span data-ttu-id="860ce-180"><= = interrompt le verrouillage opportuniste</span><span class="sxs-lookup"><span data-stu-id="860ce-180"><== Breaks opportunistic lock</span></span>       |                                                   |
| <span data-ttu-id="860ce-181">13</span><span class="sxs-lookup"><span data-stu-id="860ce-181">13</span></span>    | <span data-ttu-id="860ce-182">Ferme le fichier = =></span><span class="sxs-lookup"><span data-stu-id="860ce-182">Closes file ==></span></span>                     |                                        |                                                   |
| <span data-ttu-id="860ce-183">14</span><span class="sxs-lookup"><span data-stu-id="860ce-183">14</span></span>    |                                        | <span data-ttu-id="860ce-184">Opération d’ouverture OK = =></span><span class="sxs-lookup"><span data-stu-id="860ce-184">Okays open operation ==></span></span>            |                                                   |
| <span data-ttu-id="860ce-185">15</span><span class="sxs-lookup"><span data-stu-id="860ce-185">15</span></span>    |                                        |                                        | <span data-ttu-id="860ce-186"><= = effectue des opérations de lecture, d’écriture et d’autres opérations</span><span class="sxs-lookup"><span data-stu-id="860ce-186"><== Performs read, write, and other operations</span></span> |



 

<span data-ttu-id="860ce-187">Dans le verrouillage opportuniste du lot, le client X ouvre un fichier, événement 1, et le serveur accorde au client X un verrou par lot dans l’événement 2.</span><span class="sxs-lookup"><span data-stu-id="860ce-187">In the batch opportunistic lock, client X opens a file, event 1, and the server grants client X a batch lock in event 2.</span></span> <span data-ttu-id="860ce-188">Le client X tente de lire les données, événement 3, auxquelles le serveur répond avec les données, événement 4.</span><span class="sxs-lookup"><span data-stu-id="860ce-188">Client X attempts to read data, event 3, to which the server responds with data, event 4.</span></span>

<span data-ttu-id="860ce-189">L’événement 5 illustre le verrouillage opportuniste du lot au travail.</span><span class="sxs-lookup"><span data-stu-id="860ce-189">Event 5 shows the batch opportunistic lock at work.</span></span> <span data-ttu-id="860ce-190">L’application sur le client X ferme le fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-190">The application on Client X closes the file.</span></span> <span data-ttu-id="860ce-191">Toutefois, le redirecteur réseau filtre l’opération de fermeture et ne transmet pas de message de fermeture, ce qui effectue une fermeture « silencieuse ».</span><span class="sxs-lookup"><span data-stu-id="860ce-191">However, the network redirector filters out the close operation and does not transmit a close message, thus performing a "silent" close.</span></span> <span data-ttu-id="860ce-192">Le redirecteur réseau peut effectuer cette opération, car le client X a la propriété exclusive du fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-192">The network redirector can do this because client X has sole ownership of the file.</span></span> <span data-ttu-id="860ce-193">Plus tard, dans l’épreuve 6, l’application ouvre de nouveau le fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-193">Later on, in event 6, the application reopens the file.</span></span> <span data-ttu-id="860ce-194">Là encore, aucun flux de données n’est transmis sur le réseau.</span><span class="sxs-lookup"><span data-stu-id="860ce-194">Again, no data flows across the network.</span></span> <span data-ttu-id="860ce-195">En ce qui concerne le serveur, ce client a ouvert le fichier depuis l’événement 2.</span><span class="sxs-lookup"><span data-stu-id="860ce-195">As far as the server is concerned, this client has had the file open since event 2.</span></span>

<span data-ttu-id="860ce-196">Les événements 7, 8 et 9 illustrent le déroulement habituel du trafic réseau.</span><span class="sxs-lookup"><span data-stu-id="860ce-196">Events 7, 8, and 9 show the usual course of network traffic.</span></span> <span data-ttu-id="860ce-197">Dans l’événement 10, une autre fermeture silencieuse se produit.</span><span class="sxs-lookup"><span data-stu-id="860ce-197">In event 10, another silent close occurs.</span></span>

<span data-ttu-id="860ce-198">Dans l’événement 11, le client Y tente d’ouvrir le fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-198">In event 11, client Y attempts to open the file.</span></span> <span data-ttu-id="860ce-199">La vue du fichier du serveur est celle où le client X s’ouvre, même si l’application sur le client X l’a fermée.</span><span class="sxs-lookup"><span data-stu-id="860ce-199">The server's view of the file is that client X has it open, even though the application on client X has closed it.</span></span> <span data-ttu-id="860ce-200">Par conséquent, le serveur envoie un message de rupture du verrouillage opportuniste au client X. client X envoie maintenant le message de fermeture sur le réseau, l’événement 13.</span><span class="sxs-lookup"><span data-stu-id="860ce-200">Therefore, the server sends an a message breaking the opportunistic lock to client X. Client X now sends the close message across the network, event 13.</span></span> <span data-ttu-id="860ce-201">L’événement 14 suit quand le serveur ouvre le fichier pour le client Y. L’application sur le client X a fermé le fichier, de sorte qu’il n’y a plus de transferts vers ou à partir du serveur pour ce fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-201">Event 14 follows as the server opens the file for client Y. The application on client X has closed the file, so it does no more transfers to or from the server for that file.</span></span> <span data-ttu-id="860ce-202">Le client Y commence les transferts de données comme d’habitude dans l’événement 15.</span><span class="sxs-lookup"><span data-stu-id="860ce-202">Client Y begins data transfers as usual in event 15.</span></span>

<span data-ttu-id="860ce-203">Entre le moment où le client X reçoit le verrou sur le fichier dans l’événement 2 et la dernière clôture à l’événement 13, toutes les données de fichier mises en cache par le client sont valides, en dépit des opérations d’ouverture et de fermeture de l’application intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="860ce-203">Between the time client X is granted the lock on the file in event 2 and the final close at event 13, any file data that the client has cached is valid, in spite of the intervening application open and close operations.</span></span> <span data-ttu-id="860ce-204">Toutefois, une fois que le verrouillage opportuniste est interrompu, les données mises en cache ne peuvent pas être considérées comme valides.</span><span class="sxs-lookup"><span data-stu-id="860ce-204">However, after the opportunistic lock is broken, cached data cannot be considered valid.</span></span>

## <a name="filter-opportunistic-lock"></a><span data-ttu-id="860ce-205">Filtrer le verrou opportuniste</span><span class="sxs-lookup"><span data-stu-id="860ce-205">Filter Opportunistic Lock</span></span>

<span data-ttu-id="860ce-206">Le diagramme suivant montre une vue du trafic réseau d’un verrou de filtre opportuniste.</span><span class="sxs-lookup"><span data-stu-id="860ce-206">The following diagram shows a network-traffic view of a filter opportunistic lock.</span></span> <span data-ttu-id="860ce-207">Les flèches indiquent le sens du déplacement des données, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="860ce-207">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="860ce-208">Événement</span><span class="sxs-lookup"><span data-stu-id="860ce-208">Event</span></span> | <span data-ttu-id="860ce-209">Client X</span><span class="sxs-lookup"><span data-stu-id="860ce-209">Client X</span></span>                                | <span data-ttu-id="860ce-210">Serveur</span><span class="sxs-lookup"><span data-stu-id="860ce-210">Server</span></span>                   | <span data-ttu-id="860ce-211">Client Y</span><span class="sxs-lookup"><span data-stu-id="860ce-211">Client Y</span></span>                    |
|-------|-----------------------------------------|--------------------------|-----------------------------|
| <span data-ttu-id="860ce-212">1</span><span class="sxs-lookup"><span data-stu-id="860ce-212">1</span></span>     | <span data-ttu-id="860ce-213">Ouvre le fichier sans droits d’accès = =></span><span class="sxs-lookup"><span data-stu-id="860ce-213">Opens file with no access rights ==></span></span> |                          |                             |
| <span data-ttu-id="860ce-214">2</span><span class="sxs-lookup"><span data-stu-id="860ce-214">2</span></span>     |                                         | <span data-ttu-id="860ce-215"><= = ouvre le fichier</span><span class="sxs-lookup"><span data-stu-id="860ce-215"><== Opens the file</span></span>    |                             |
| <span data-ttu-id="860ce-216">3</span><span class="sxs-lookup"><span data-stu-id="860ce-216">3</span></span>     | <span data-ttu-id="860ce-217">Filtre des demandes Lock = =></span><span class="sxs-lookup"><span data-stu-id="860ce-217">Requests filter lock==></span></span>              |                          |                             |
| <span data-ttu-id="860ce-218">4</span><span class="sxs-lookup"><span data-stu-id="860ce-218">4</span></span>     |                                         | <span data-ttu-id="860ce-219"><= = octroie un verrou</span><span class="sxs-lookup"><span data-stu-id="860ce-219"><== Grants lock</span></span>       |                             |
| <span data-ttu-id="860ce-220">5</span><span class="sxs-lookup"><span data-stu-id="860ce-220">5</span></span>     | <span data-ttu-id="860ce-221">Ouvre le fichier pour lecture = =></span><span class="sxs-lookup"><span data-stu-id="860ce-221">Opens file for reading ==></span></span>           |                          |                             |
| <span data-ttu-id="860ce-222">6</span><span class="sxs-lookup"><span data-stu-id="860ce-222">6</span></span>     |                                         | <span data-ttu-id="860ce-223"><= = ouvre de nouveau le fichier</span><span class="sxs-lookup"><span data-stu-id="860ce-223"><== Reopens the file</span></span>  |                             |
| <span data-ttu-id="860ce-224">7</span><span class="sxs-lookup"><span data-stu-id="860ce-224">7</span></span>     | <span data-ttu-id="860ce-225">Lit les données à l’aide du handle de lecture = =></span><span class="sxs-lookup"><span data-stu-id="860ce-225">Reads data using the read handle ==></span></span> |                          |                             |
| <span data-ttu-id="860ce-226">8</span><span class="sxs-lookup"><span data-stu-id="860ce-226">8</span></span>     |                                         | <span data-ttu-id="860ce-227"><= = envoie des données</span><span class="sxs-lookup"><span data-stu-id="860ce-227"><== Sends data</span></span>        |                             |
| <span data-ttu-id="860ce-228">9</span><span class="sxs-lookup"><span data-stu-id="860ce-228">9</span></span>     |                                         | <span data-ttu-id="860ce-229"><= = envoie des données</span><span class="sxs-lookup"><span data-stu-id="860ce-229"><== Sends data</span></span>        |                             |
| <span data-ttu-id="860ce-230">10</span><span class="sxs-lookup"><span data-stu-id="860ce-230">10</span></span>    |                                         | <span data-ttu-id="860ce-231"><= = envoie des données</span><span class="sxs-lookup"><span data-stu-id="860ce-231"><== Sends data</span></span>        |                             |
| <span data-ttu-id="860ce-232">11</span><span class="sxs-lookup"><span data-stu-id="860ce-232">11</span></span>    |                                         |                          | <span data-ttu-id="860ce-233"><= = ouvre le fichier</span><span class="sxs-lookup"><span data-stu-id="860ce-233"><== Opens the file</span></span>       |
| <span data-ttu-id="860ce-234">12</span><span class="sxs-lookup"><span data-stu-id="860ce-234">12</span></span>    |                                         | <span data-ttu-id="860ce-235">Ouvre le fichier = =></span><span class="sxs-lookup"><span data-stu-id="860ce-235">Opens the file ==></span></span>    |                             |
| <span data-ttu-id="860ce-236">13</span><span class="sxs-lookup"><span data-stu-id="860ce-236">13</span></span>    |                                         |                          | <span data-ttu-id="860ce-237"><= = verrou du filtre des demandes</span><span class="sxs-lookup"><span data-stu-id="860ce-237"><== Requests filter lock</span></span> |
| <span data-ttu-id="860ce-238">14</span><span class="sxs-lookup"><span data-stu-id="860ce-238">14</span></span>    |                                         | <span data-ttu-id="860ce-239">Refuse le verrou de filtre = =></span><span class="sxs-lookup"><span data-stu-id="860ce-239">Denies filter lock==></span></span> |                             |
| <span data-ttu-id="860ce-240">15</span><span class="sxs-lookup"><span data-stu-id="860ce-240">15</span></span>    |                                         |                          | <span data-ttu-id="860ce-241"><= = lit les données</span><span class="sxs-lookup"><span data-stu-id="860ce-241"><== Reads data</span></span>           |
| <span data-ttu-id="860ce-242">16</span><span class="sxs-lookup"><span data-stu-id="860ce-242">16</span></span>    |                                         | <span data-ttu-id="860ce-243">Envoie les données = =></span><span class="sxs-lookup"><span data-stu-id="860ce-243">Sends data ==></span></span>        |                             |
| <span data-ttu-id="860ce-244">17</span><span class="sxs-lookup"><span data-stu-id="860ce-244">17</span></span>    | <span data-ttu-id="860ce-245">Lit les données (mises en cache)</span><span class="sxs-lookup"><span data-stu-id="860ce-245">Reads (cached) data</span></span>                     |                          |                             |
| <span data-ttu-id="860ce-246">18</span><span class="sxs-lookup"><span data-stu-id="860ce-246">18</span></span>    | <span data-ttu-id="860ce-247">Ferme le fichier = =></span><span class="sxs-lookup"><span data-stu-id="860ce-247">Closes file ==></span></span>                      |                          |                             |
| <span data-ttu-id="860ce-248">19</span><span class="sxs-lookup"><span data-stu-id="860ce-248">19</span></span>    |                                         |                          | <span data-ttu-id="860ce-249"><= = ferme le fichier</span><span class="sxs-lookup"><span data-stu-id="860ce-249"><== Closes file</span></span>          |



 

<span data-ttu-id="860ce-250">Dans le verrou opportuniste du filtre, le client X ouvre un fichier, événement 1, et le serveur répond dans l’événement 2.</span><span class="sxs-lookup"><span data-stu-id="860ce-250">In the filter opportunistic lock, client X opens a file, event 1, and the server responds in event 2.</span></span> <span data-ttu-id="860ce-251">Le client demande ensuite un verrou opportuniste de filtre dans l’événement 3, suivi du serveur accordant le verrou opportuniste dans l’événement 4.</span><span class="sxs-lookup"><span data-stu-id="860ce-251">The client then requests a filter opportunistic lock in event 3, followed by the server granting the opportunistic lock in event 4.</span></span> <span data-ttu-id="860ce-252">Le client X ouvre ensuite le fichier à nouveau pour lire l’événement 5, vers lequel le serveur répond dans l’événement 6.</span><span class="sxs-lookup"><span data-stu-id="860ce-252">Client X then opens the file again for reading in event 5, to which the server responds in event 6.</span></span> <span data-ttu-id="860ce-253">Le client essaie ensuite de lire les données auxquelles le serveur répond avec les données, événement 8.</span><span class="sxs-lookup"><span data-stu-id="860ce-253">The client then attempts to read data, to which the server responds with data, event 8.</span></span>

<span data-ttu-id="860ce-254">L’événement 9 montre le verrou opportuniste de filtre au travail.</span><span class="sxs-lookup"><span data-stu-id="860ce-254">Event 9 shows the filter opportunistic lock at work.</span></span> <span data-ttu-id="860ce-255">Le serveur lit à l’avance le client et envoie les données sur le réseau, même si le client ne l’a pas demandé.</span><span class="sxs-lookup"><span data-stu-id="860ce-255">The server reads ahead of the client and sends the data over the network even though the client has not requested it.</span></span> <span data-ttu-id="860ce-256">Le client met en cache les données.</span><span class="sxs-lookup"><span data-stu-id="860ce-256">The client caches the data.</span></span> <span data-ttu-id="860ce-257">Dans l’épreuve 10, le serveur anticipe également une demande de données ultérieures et envoie une autre partie du fichier à mettre en cache par le client.</span><span class="sxs-lookup"><span data-stu-id="860ce-257">In event 10, the server also anticipates a future request for data and sends another portion of the file for the client to cache.</span></span>

<span data-ttu-id="860ce-258">Dans les événements 11 et 12, un autre client, Y, ouvre le fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-258">In event 11 and 12, another client, Y, opens the file.</span></span> <span data-ttu-id="860ce-259">Le client Y demande également un verrou opportuniste de filtre.</span><span class="sxs-lookup"><span data-stu-id="860ce-259">Client Y also requests a filter opportunistic lock.</span></span> <span data-ttu-id="860ce-260">Dans l’événement 14, le serveur le refuse.</span><span class="sxs-lookup"><span data-stu-id="860ce-260">In event 14, the server denies it.</span></span> <span data-ttu-id="860ce-261">Dans l’événement 15, le client Y demande des données que le serveur envoie dans l’événement 16.</span><span class="sxs-lookup"><span data-stu-id="860ce-261">In event 15, client Y requests data, which the server sends in event 16.</span></span> <span data-ttu-id="860ce-262">Aucune de ces conséquences n’affecte le client X. À tout moment, un autre client peut ouvrir ce fichier pour l’accès en lecture.</span><span class="sxs-lookup"><span data-stu-id="860ce-262">None of this affects client X. At any time, another client can open this file for read access.</span></span> <span data-ttu-id="860ce-263">Aucun autre client n’affecte le verrou de filtre du client X.</span><span class="sxs-lookup"><span data-stu-id="860ce-263">No other client affects client X's filter lock.</span></span>

<span data-ttu-id="860ce-264">L’événement 17 montre les données de lecture du client X.</span><span class="sxs-lookup"><span data-stu-id="860ce-264">Event 17 shows client X reading data.</span></span> <span data-ttu-id="860ce-265">Toutefois, étant donné que le serveur a déjà envoyé les données et que le client les a mises en cache, aucun trafic ne traverse le réseau.</span><span class="sxs-lookup"><span data-stu-id="860ce-265">However, because the server has already sent the data and the client has cached it, no traffic crosses the network.</span></span>

<span data-ttu-id="860ce-266">Dans cet exemple, le client X ne tente jamais de lire toutes les données du fichier. la lecture anticipée indiquée par les événements 9 et 10 est donc « gaspillée ». autrement dit, les données ne sont jamais réellement utilisées.</span><span class="sxs-lookup"><span data-stu-id="860ce-266">In this example, client X never tries to read all the data in the file, so the read-ahead indicated by events 9 and 10 is "wasted"; that is, the data is never actually used.</span></span> <span data-ttu-id="860ce-267">Il s’agit d’une perte acceptable, car la lecture anticipée a accéléré l’application.</span><span class="sxs-lookup"><span data-stu-id="860ce-267">This is an acceptable loss because the read-ahead has sped up the application.</span></span>

<span data-ttu-id="860ce-268">Dans l’événement 18, le client X ferme le fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-268">In event 18, client X closes the file.</span></span> <span data-ttu-id="860ce-269">Le redirecteur réseau du client abandonne les données mises en cache.</span><span class="sxs-lookup"><span data-stu-id="860ce-269">The client's network redirector abandons the cached data.</span></span> <span data-ttu-id="860ce-270">Le serveur ferme le fichier.</span><span class="sxs-lookup"><span data-stu-id="860ce-270">The server closes the file.</span></span>

 

 



