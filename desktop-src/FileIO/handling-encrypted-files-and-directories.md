---
description: Un fichier marqué comme chiffré est chiffré par le système de fichiers NTFS à l’aide du pilote de chiffrement actuel.
ms.assetid: 166bfb8c-b97d-4cc7-bf6b-399837cb8ad0
title: Gestion des fichiers et des répertoires chiffrés
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2718656a28eb678c10076e228e08a2a95cabd1fc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103952896"
---
# <a name="handling-encrypted-files-and-directories"></a><span data-ttu-id="19934-103">Gestion des fichiers et des répertoires chiffrés</span><span class="sxs-lookup"><span data-stu-id="19934-103">Handling Encrypted Files and Directories</span></span>

<span data-ttu-id="19934-104">Un programmeur ou un utilisateur peut marquer un répertoire ou un fichier comme étant chiffré.</span><span class="sxs-lookup"><span data-stu-id="19934-104">A programmer or user may mark a directory or file as encrypted.</span></span> <span data-ttu-id="19934-105">Un fichier marqué comme chiffré est chiffré par le système de fichiers NTFS à l’aide du pilote de chiffrement actuel.</span><span class="sxs-lookup"><span data-stu-id="19934-105">A file marked encrypted is encrypted by the NTFS file system by using the current encryption driver.</span></span> <span data-ttu-id="19934-106">Si, à une date ultérieure, le fichier est marqué comme non chiffré, il est déchiffré et laissé dans un état de texte brut (non sécurisé).</span><span class="sxs-lookup"><span data-stu-id="19934-106">If at a later date the file is marked as not encrypted, it is decrypted and left in a plain text (unsecured) state.</span></span>

<span data-ttu-id="19934-107">Les répertoires ne sont pas chiffrés.</span><span class="sxs-lookup"><span data-stu-id="19934-107">Directories are not themselves encrypted.</span></span> <span data-ttu-id="19934-108">Au lieu de cela, par défaut, dans un répertoire « chiffré », tous les nouveaux fichiers du répertoire sont chiffrés lors de la création.</span><span class="sxs-lookup"><span data-stu-id="19934-108">Rather, by default, in an "encrypted" directory all new files in the directory are encrypted at creation.</span></span> <span data-ttu-id="19934-109">Un utilisateur doit modifier spécifiquement l’état d’un nouveau fichier à déchiffrer si l’utilisateur ne souhaite pas que le fichier soit chiffré.</span><span class="sxs-lookup"><span data-stu-id="19934-109">A user must specifically change the status of a new file to decrypted if the user does not want the file to be encrypted.</span></span> <span data-ttu-id="19934-110">Un répertoire chiffré est visible.</span><span class="sxs-lookup"><span data-stu-id="19934-110">An encrypted directory is visible.</span></span> <span data-ttu-id="19934-111">Pour rendre un répertoire inaccessible à d’autres utilisateurs, utilisez les méthodes standard de contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="19934-111">To make a directory inaccessible to other users, use the standard methods of access control.</span></span>

<span data-ttu-id="19934-112">Les fonctions de chiffrement ne peuvent pas être utilisées avec l' [API Backup](/windows/desktop/Backup/backup).</span><span class="sxs-lookup"><span data-stu-id="19934-112">The encryption functions cannot be used with the [Backup API](/windows/desktop/Backup/backup).</span></span>

<span data-ttu-id="19934-113">Pour chiffrer un nouveau fichier, utilisez la fonction [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) avec l’indicateur de **fichier \_ attribute \_ Encrypted** .</span><span class="sxs-lookup"><span data-stu-id="19934-113">To encrypt a new file, use the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function with the **FILE\_ATTRIBUTE\_ENCRYPTED** flag.</span></span> <span data-ttu-id="19934-114">Pour chiffrer un fichier existant, utilisez la fonction [**EncryptFile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) .</span><span class="sxs-lookup"><span data-stu-id="19934-114">To encrypt an existing file, use the [**EncryptFile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) function.</span></span> <span data-ttu-id="19934-115">Tous les flux de données dans le fichier sont chiffrés.</span><span class="sxs-lookup"><span data-stu-id="19934-115">All data streams in the file are encrypted.</span></span> <span data-ttu-id="19934-116">Si le fichier est déjà chiffré, **EncryptFile** ne fait rien, mais retourne une valeur différente de zéro, ce qui indique une réussite.</span><span class="sxs-lookup"><span data-stu-id="19934-116">If the file is already encrypted, **EncryptFile** does nothing but returns a nonzero value, which indicates success.</span></span> <span data-ttu-id="19934-117">Si le fichier est compressé, **EncryptFile** décompresse le fichier avant de le chiffrer.</span><span class="sxs-lookup"><span data-stu-id="19934-117">If the file is compressed, **EncryptFile** decompresses the file before encrypting it.</span></span>

<span data-ttu-id="19934-118">Pour déchiffrer un fichier chiffré, utilisez la fonction [**DecryptFile**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) .</span><span class="sxs-lookup"><span data-stu-id="19934-118">To decrypt an encrypted file, use the [**DecryptFile**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) function.</span></span> <span data-ttu-id="19934-119">Si le fichier n’est pas chiffré, **DecryptFile** ne fait rien, mais retourne une valeur différente de zéro indiquant la réussite.</span><span class="sxs-lookup"><span data-stu-id="19934-119">If the file is not encrypted, **DecryptFile** does nothing but returns a nonzero value indicating success.</span></span>

<span data-ttu-id="19934-120">La fonction [**EncryptionDisable**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) désactive ou active le chiffrement du répertoire indiqué et des fichiers qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="19934-120">The [**EncryptionDisable**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) function disables or enables the encryption of the indicated directory and the files in it.</span></span> <span data-ttu-id="19934-121">Elle n’affecte pas le chiffrement des sous-répertoires situés sous le répertoire indiqué.</span><span class="sxs-lookup"><span data-stu-id="19934-121">It does not affect the encryption of subdirectories below the indicated directory.</span></span>

<span data-ttu-id="19934-122">Pour récupérer l’état de chiffrement d’un fichier, utilisez la fonction [**FileEncryptionStatus**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) .</span><span class="sxs-lookup"><span data-stu-id="19934-122">To retrieve the encryption status of a file, use the [**FileEncryptionStatus**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) function.</span></span> <span data-ttu-id="19934-123">Vous pouvez également appeler la fonction [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) et examiner l’indicateur de **fichier \_ attribute \_ Encrypted** dans la valeur de retour.</span><span class="sxs-lookup"><span data-stu-id="19934-123">Alternatively, call the [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) function and examine the **FILE\_ATTRIBUTE\_ENCRYPTED** flag in the return value.</span></span>

<span data-ttu-id="19934-124">[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) et [**CopyFileEx**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) tentent de chiffrer le fichier de destination avec les clés utilisées dans le chiffrement du fichier source.</span><span class="sxs-lookup"><span data-stu-id="19934-124">[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) and [**CopyFileEx**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) attempt to encrypt the destination file with the keys used in the encryption of the source file.</span></span> <span data-ttu-id="19934-125">Si cela ne peut pas être fait, les deux fonctions tentent de chiffrer le fichier de destination avec les clés par défaut.</span><span class="sxs-lookup"><span data-stu-id="19934-125">If this cannot be done, both functions attempt to encrypt the destination file with default keys.</span></span> <span data-ttu-id="19934-126">Si ces deux méthodes ne peuvent pas être effectuées, **CopyFile** et **CopyFileEx** échouent avec une erreur **\_ \_ échec du chiffrement** de l’erreur.</span><span class="sxs-lookup"><span data-stu-id="19934-126">If both of these methods cannot be done, **CopyFile** and **CopyFileEx** fail with an **ERROR\_ENCRYPTION\_FAILED** error.</span></span> <span data-ttu-id="19934-127">Si vous souhaitez que **CopyFileEx** termine l’opération de copie même si le fichier de destination ne peut pas être chiffré, incluez l’indicateur de **\_ Destination fichier de copie autoriser le \_ \_ \_ déchiffrement** dans la valeur du paramètre *dwCopyFlags* dans votre appel à **CopyFileEx**.</span><span class="sxs-lookup"><span data-stu-id="19934-127">If you want **CopyFileEx** to complete the copy operation even when the destination file cannot be encrypted, include the **COPY\_FILE\_ALLOW\_DECRYPTED\_DESTINATION** flag in the value of the *dwCopyFlags* parameter in your call to **CopyFileEx**.</span></span>

 

 
