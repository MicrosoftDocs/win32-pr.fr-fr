---
description: Windows met en cache les données de fichier qui sont lues à partir des disques et écrites sur les disques.
ms.assetid: 0865c741-63e3-4246-ba69-801b02153e4a
title: Mise en cache des fichiers
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1a14fb668af16cfb8a4e42b59b25b73ecefbb7cb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103868249"
---
# <a name="file-caching"></a><span data-ttu-id="b60d4-103">Mise en cache des fichiers</span><span class="sxs-lookup"><span data-stu-id="b60d4-103">File Caching</span></span>

<span data-ttu-id="b60d4-104">Par défaut, Windows met en cache les données de fichier lues à partir de disques et écrites sur des disques.</span><span class="sxs-lookup"><span data-stu-id="b60d4-104">By default, Windows caches file data that is read from disks and written to disks.</span></span> <span data-ttu-id="b60d4-105">Cela implique que les opérations de lecture lisent les données du fichier à partir d’une zone de la mémoire système appelée « cache des fichiers système », plutôt qu’à partir du disque physique.</span><span class="sxs-lookup"><span data-stu-id="b60d4-105">This implies that read operations read file data from an area in system memory known as the system file cache, rather than from the physical disk.</span></span> <span data-ttu-id="b60d4-106">En conséquence, les opérations d’écriture écrivent les données de fichier dans le cache de fichiers système plutôt que sur le disque, et ce type de cache est appelé cache de réinscription.</span><span class="sxs-lookup"><span data-stu-id="b60d4-106">Correspondingly, write operations write file data to the system file cache rather than to the disk, and this type of cache is referred to as a write-back cache.</span></span> <span data-ttu-id="b60d4-107">La mise en cache est gérée par objet de fichier.</span><span class="sxs-lookup"><span data-stu-id="b60d4-107">Caching is managed per file object.</span></span>

<span data-ttu-id="b60d4-108">La mise en cache se produit dans le sens du *Gestionnaire de cache*, qui fonctionne en continu pendant que Windows est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="b60d4-108">Caching occurs under the direction of the *cache manager*, which operates continuously while Windows is running.</span></span> <span data-ttu-id="b60d4-109">Les données de fichier dans le cache de fichiers système sont écrites sur le disque à des intervalles déterminés par le système d’exploitation, et la mémoire utilisée précédemment par ces données de fichier est libérée. cela s’appelle le *vidage* du cache.</span><span class="sxs-lookup"><span data-stu-id="b60d4-109">File data in the system file cache is written to the disk at intervals determined by the operating system, and the memory previously used by that file data is freed—this is referred to as *flushing* the cache.</span></span> <span data-ttu-id="b60d4-110">La stratégie de retardement de l’écriture des données dans le fichier et de leur conservation dans le cache jusqu’à ce que le cache soit vidé est appelée écriture différée, et elle est déclenchée par le gestionnaire de caches à un intervalle de temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="b60d4-110">The policy of delaying the writing of the data to the file and holding it in the cache until the cache is flushed is called lazy writing, and it is triggered by the cache manager at a determinate time interval.</span></span> <span data-ttu-id="b60d4-111">Le moment auquel un bloc de données de fichier est vidé dépend en partie de la durée pendant laquelle il a été stocké dans le cache et de la période écoulée depuis le dernier accès aux données lors d’une opération de lecture.</span><span class="sxs-lookup"><span data-stu-id="b60d4-111">The time at which a block of file data is flushed is partially based on the amount of time it has been stored in the cache and the amount of time since the data was last accessed in a read operation.</span></span> <span data-ttu-id="b60d4-112">Cela garantit que les données de fichier fréquemment lues resteront accessibles dans le cache de fichiers système pendant le temps maximal imparti.</span><span class="sxs-lookup"><span data-stu-id="b60d4-112">This ensures that file data that is frequently read will stay accessible in the system file cache for the maximum amount of time.</span></span>

<span data-ttu-id="b60d4-113">Ce processus de mise en cache des données de fichier est illustré dans la figure suivante.</span><span class="sxs-lookup"><span data-stu-id="b60d4-113">This file data caching process is illustrated in the following figure.</span></span>

![processus de mise en cache des données de fichier](images/fig3.png)

<span data-ttu-id="b60d4-115">Comme illustré par les flèches pleines de la figure précédente, une zone de données de 256 Ko est lue dans un « emplacement » du cache de 256 Ko dans l’espace d’adressage du système lorsqu’elle est demandée pour la première fois par le gestionnaire de cache lors d’une opération de lecture de fichier.</span><span class="sxs-lookup"><span data-stu-id="b60d4-115">As depicted by the solid arrows in the previous figure, a 256 KB region of data is read into a 256 KB cache "slot" in system address space when it is first requested by the cache manager during a file read operation.</span></span> <span data-ttu-id="b60d4-116">Un processus en mode utilisateur copie ensuite les données de cet emplacement dans son propre espace d’adressage.</span><span class="sxs-lookup"><span data-stu-id="b60d4-116">A user-mode process then copies the data in this slot to its own address space.</span></span> <span data-ttu-id="b60d4-117">Lorsque le processus a terminé son accès aux données, il enregistre les données modifiées dans le même emplacement dans la mémoire cache du système, comme indiqué par la flèche en pointillé entre l’espace d’adressage du processus et la mémoire cache du système.</span><span class="sxs-lookup"><span data-stu-id="b60d4-117">When the process has completed its data access, it writes the altered data back to the same slot in the system cache, as shown by the dotted arrow between the process address space and the system cache.</span></span> <span data-ttu-id="b60d4-118">Lorsque le gestionnaire de cache a déterminé que les données ne seront plus nécessaires pendant un certain temps, il réenregistre les données modifiées dans le fichier sur le disque, comme indiqué par la flèche en pointillés entre le cache système et le disque.</span><span class="sxs-lookup"><span data-stu-id="b60d4-118">When the cache manager has determined that the data will no longer be needed for a certain amount of time, it writes the altered data back to the file on the disk, as shown by the dotted arrow between the system cache and the disk.</span></span>

<span data-ttu-id="b60d4-119">La quantité d’amélioration des performances d’e/s offerte par la mise en cache des données de fichiers dépend de la taille du bloc de données de fichier en cours de lecture ou d’écriture.</span><span class="sxs-lookup"><span data-stu-id="b60d4-119">The amount of I/O performance improvement that file data caching offers depends on the size of the file data block being read or written.</span></span> <span data-ttu-id="b60d4-120">Lorsque des blocs volumineux de données de fichier sont lus et écrits, il est plus probable que les lectures et écritures sur le disque seront nécessaires pour terminer l’opération d’e/s.</span><span class="sxs-lookup"><span data-stu-id="b60d4-120">When large blocks of file data are read and written, it is more likely that disk reads and writes will be necessary to finish the I/O operation.</span></span> <span data-ttu-id="b60d4-121">Les performances d’e/s seront de plus en plus altérées, car de plus en plus ce type d’opération d’e/s se produit.</span><span class="sxs-lookup"><span data-stu-id="b60d4-121">I/O performance will be increasingly impaired as more of this kind of I/O operation occurs.</span></span>

<span data-ttu-id="b60d4-122">Dans ce cas, la mise en cache peut être désactivée.</span><span class="sxs-lookup"><span data-stu-id="b60d4-122">In these situations, caching can be turned off.</span></span> <span data-ttu-id="b60d4-123">Cette opération s’effectue au moment où le fichier est ouvert en passant l' **indicateur de fichier \_ \_ sans \_ mise en mémoire tampon** comme valeur pour le paramètre *dwFlagsAndAttributes* de [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="b60d4-123">This is done at the time the file is opened by passing **FILE\_FLAG\_NO\_BUFFERING** as a value for the *dwFlagsAndAttributes* parameter of [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span> <span data-ttu-id="b60d4-124">Lorsque la mise en cache est désactivée, toutes les opérations de lecture et d’écriture accèdent directement au disque physique.</span><span class="sxs-lookup"><span data-stu-id="b60d4-124">When caching is disabled, all read and write operations directly access the physical disk.</span></span> <span data-ttu-id="b60d4-125">Toutefois, les métadonnées du fichier peuvent toujours être mises en cache.</span><span class="sxs-lookup"><span data-stu-id="b60d4-125">However, the file metadata may still be cached.</span></span> <span data-ttu-id="b60d4-126">Pour vider les métadonnées sur le disque, utilisez la fonction [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) .</span><span class="sxs-lookup"><span data-stu-id="b60d4-126">To flush the metadata to disk, use the [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) function.</span></span>

<span data-ttu-id="b60d4-127">La fréquence à laquelle le vidage se produit est un facteur important qui équilibre les performances du système avec la fiabilité du système.</span><span class="sxs-lookup"><span data-stu-id="b60d4-127">The frequency at which flushing occurs is an important consideration that balances system performance with system reliability.</span></span> <span data-ttu-id="b60d4-128">Si le système vide le cache trop souvent, le vidage des opérations d’écriture importantes entraîne une dégradation significative des performances du système.</span><span class="sxs-lookup"><span data-stu-id="b60d4-128">If the system flushes the cache too often, the number of large write operations flushing incurs will degrade system performance significantly.</span></span> <span data-ttu-id="b60d4-129">Si le système n’est pas suffisamment vidé, la probabilité est plus élevée que la mémoire système soit épuisée par le cache ou une défaillance soudaine du système (telle qu’une perte d’alimentation de l’ordinateur) se produira avant le vidage.</span><span class="sxs-lookup"><span data-stu-id="b60d4-129">If the system is not flushed often enough, then the likelihood is greater that either system memory will be depleted by the cache, or a sudden system failure (such as a loss of power to the computer) will happen before the flush.</span></span> <span data-ttu-id="b60d4-130">Dans ce dernier cas, les données mises en cache seront perdues.</span><span class="sxs-lookup"><span data-stu-id="b60d4-130">In the latter instance, the cached data will be lost.</span></span>

<span data-ttu-id="b60d4-131">Pour s’assurer que la quantité de vidage appropriée est levée, le gestionnaire de cache génère un processus chaque seconde appelé Writer différé.</span><span class="sxs-lookup"><span data-stu-id="b60d4-131">To ensure that the right amount of flushing occurs, the cache manager spawns a process every second called a lazy writer.</span></span> <span data-ttu-id="b60d4-132">Le processus d’écriture différée met en file d’attente une huitième des pages qui n’ont pas été vidées récemment pour être écrites sur le disque.</span><span class="sxs-lookup"><span data-stu-id="b60d4-132">The lazy writer process queues one-eighth of the pages that have not been flushed recently to be written to disk.</span></span> <span data-ttu-id="b60d4-133">Elle réévalue constamment la quantité de données vidées pour des performances optimales du système et, si davantage de données doivent être écrites, elle met en file d’attente plus de données.</span><span class="sxs-lookup"><span data-stu-id="b60d4-133">It constantly reevaluates the amount of data being flushed for optimal system performance, and if more data needs to be written it queues more data.</span></span> <span data-ttu-id="b60d4-134">Les enregistreurs paresseux ne vident pas les fichiers temporaires, car ils seront supprimés par l’application ou le système.</span><span class="sxs-lookup"><span data-stu-id="b60d4-134">Lazy writers do not flush temporary files, because the assumption is that they will be deleted by the application or system.</span></span>

<span data-ttu-id="b60d4-135">Certaines applications, telles que les logiciels antivirus, requièrent que leurs opérations d’écriture soient immédiatement vidées sur le disque ; Windows offre cette possibilité via la mise en cache en écriture.</span><span class="sxs-lookup"><span data-stu-id="b60d4-135">Some applications, such as virus-checking software, require that their write operations be flushed to disk immediately; Windows provides this ability through write-through caching.</span></span> <span data-ttu-id="b60d4-136">Un processus permet la mise en cache en écriture automatique pour une opération d’e/s spécifique en passant l’indicateur d’écriture d’indicateur de fichier dans son appel à [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea). **\_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="b60d4-136">A process enables write-through caching for a specific I/O operation by passing the **FILE\_FLAG\_WRITE\_THROUGH** flag into its call to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span> <span data-ttu-id="b60d4-137">Lorsque la mise en cache en écriture différée est activée, les données sont toujours écrites dans le cache, mais le gestionnaire de cache écrit les données immédiatement sur le disque plutôt que d’effectuer un délai à l’aide de l’outil d’écriture différée.</span><span class="sxs-lookup"><span data-stu-id="b60d4-137">With write-through caching enabled, data is still written into the cache, but the cache manager writes the data immediately to disk rather than incurring a delay by using the lazy writer.</span></span> <span data-ttu-id="b60d4-138">Un processus peut également forcer un vidage d’un fichier qu’il a ouvert en appelant la fonction [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) .</span><span class="sxs-lookup"><span data-stu-id="b60d4-138">A process can also force a flush of a file it has opened by calling the [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) function.</span></span>

<span data-ttu-id="b60d4-139">Les métadonnées du système de fichiers sont toujours mises en cache.</span><span class="sxs-lookup"><span data-stu-id="b60d4-139">File system metadata is always cached.</span></span> <span data-ttu-id="b60d4-140">Par conséquent, pour stocker les modifications apportées aux métadonnées sur le disque, le fichier doit être vidé ou ouvert avec l' **indicateur de fichier \_ \_ Write \_ via**.</span><span class="sxs-lookup"><span data-stu-id="b60d4-140">Therefore, to store any metadata changes to disk, the file must either be flushed or be opened with **FILE\_FLAG\_WRITE\_THROUGH**.</span></span>

 

 



