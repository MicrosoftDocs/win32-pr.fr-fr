---
description: Un verrou opportuniste (également appelé oplock) est un verrou placé par un client sur un fichier résidant sur un serveur.
ms.assetid: b4c2f5f0-a29b-4598-a49b-da99e93d2991
title: Verrous opportunistes
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: faec833caae05bff247a7a3655885b1a967f3435
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103752397"
---
# <a name="opportunistic-locks"></a><span data-ttu-id="b6c74-103">Verrous opportunistes</span><span class="sxs-lookup"><span data-stu-id="b6c74-103">Opportunistic Locks</span></span>

<span data-ttu-id="b6c74-104">Un verrou opportuniste (également appelé oplock) est un verrou placé par un client sur un fichier résidant sur un serveur.</span><span class="sxs-lookup"><span data-stu-id="b6c74-104">An opportunistic lock (also called an oplock) is a lock placed by a client on a file residing on a server.</span></span> <span data-ttu-id="b6c74-105">Dans la plupart des cas, un client demande un verrou opportuniste pour pouvoir mettre en cache les données localement, ce qui réduit le trafic réseau et améliore le temps de réponse apparent.</span><span class="sxs-lookup"><span data-stu-id="b6c74-105">In most cases, a client requests an opportunistic lock so it can cache data locally, thus reducing network traffic and improving apparent response time.</span></span> <span data-ttu-id="b6c74-106">Les verrous opportunistes sont utilisés par les redirecteurs réseau sur les clients avec des serveurs distants, ainsi que par les applications clientes sur les serveurs locaux.</span><span class="sxs-lookup"><span data-stu-id="b6c74-106">Opportunistic locks are used by network redirectors on clients with remote servers, as well as by client applications on local servers.</span></span>

<span data-ttu-id="b6c74-107">Les verrous opportunistes coordonnent la mise en cache et la cohérence des données entre les clients et les serveurs et entre plusieurs clients.</span><span class="sxs-lookup"><span data-stu-id="b6c74-107">Opportunistic locks coordinate data caching and coherency between clients and servers and among multiple clients.</span></span> <span data-ttu-id="b6c74-108">Les données cohérentes sont des données qui sont identiques sur le réseau.</span><span class="sxs-lookup"><span data-stu-id="b6c74-108">Data that is coherent is data that is the same across the network.</span></span> <span data-ttu-id="b6c74-109">En d’autres termes, si les données sont cohérentes, les données sur le serveur et tous les clients sont synchronisées.</span><span class="sxs-lookup"><span data-stu-id="b6c74-109">In other words, if data is coherent, data on the server and all the clients is synchronized.</span></span>

<span data-ttu-id="b6c74-110">Les verrous opportunistes ne sont pas des commandes du client sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="b6c74-110">Opportunistic locks are not commands by the client to the server.</span></span> <span data-ttu-id="b6c74-111">Il s’agit de requêtes du client vers le serveur.</span><span class="sxs-lookup"><span data-stu-id="b6c74-111">They are requests from the client to the server.</span></span> <span data-ttu-id="b6c74-112">Du point de vue du client, ils sont opportunistes.</span><span class="sxs-lookup"><span data-stu-id="b6c74-112">From the point of view of the client, they are opportunistic.</span></span> <span data-ttu-id="b6c74-113">En d’autres termes, le serveur accorde ces verrous chaque fois que d’autres facteurs rendent les verrous possibles.</span><span class="sxs-lookup"><span data-stu-id="b6c74-113">In other words, the server grants such locks whenever other factors make the locks possible.</span></span>

<span data-ttu-id="b6c74-114">Lorsqu’une application locale demande l’accès à un fichier distant, l’implémentation de verrous opportunistes est transparente pour l’application.</span><span class="sxs-lookup"><span data-stu-id="b6c74-114">When a local application requests access to a remote file, the implementation of opportunistic locks is transparent to the application.</span></span> <span data-ttu-id="b6c74-115">Le redirecteur réseau et le serveur impliqués ouvrent et ferment automatiquement les verrous opportunistes.</span><span class="sxs-lookup"><span data-stu-id="b6c74-115">The network redirector and the server involved open and close the opportunistic locks automatically.</span></span> <span data-ttu-id="b6c74-116">Toutefois, les verrous opportunistes peuvent également être utilisés lorsqu’une application locale demande l’accès à un fichier local, et l’accès par d’autres applications et processus doit être délégué pour empêcher l’altération du fichier.</span><span class="sxs-lookup"><span data-stu-id="b6c74-116">However, opportunistic locks can also be used when a local application requests access to a local file, and access by other applications and processes must be delegated to prevent corruption of the file.</span></span> <span data-ttu-id="b6c74-117">Dans ce cas, l’application locale demande directement un verrou opportuniste à partir du système de fichiers local et met en cache le fichier localement.</span><span class="sxs-lookup"><span data-stu-id="b6c74-117">In this case, the local application directly requests an opportunistic lock from the local file system and caches the file locally.</span></span> <span data-ttu-id="b6c74-118">Lorsqu’il est utilisé de cette manière, le verrou opportuniste est effectivement un sémaphore géré par le serveur local et est principalement utilisé dans le cadre de la cohérence des données dans la notification d’accès aux fichiers et aux fichiers.</span><span class="sxs-lookup"><span data-stu-id="b6c74-118">When used in this way, the opportunistic lock is effectively a semaphore managed by the local server, and is mainly used for the purposes of data coherency in the file and file access notification.</span></span>

<span data-ttu-id="b6c74-119">Avant d’utiliser des verrous opportunistes dans votre application, vous devez être familiarisé avec les modes d’accès et de partage des fichiers décrits dans [création et ouverture de fichiers](creating-and-opening-files.md).</span><span class="sxs-lookup"><span data-stu-id="b6c74-119">Before using opportunistic locks in your application, you should be familiar with the file access and sharing modes described in [Creating and Opening Files](creating-and-opening-files.md).</span></span>

<span data-ttu-id="b6c74-120">Le nombre maximal de verrous opportunistes simultanés que vous pouvez créer est limité uniquement par la quantité de mémoire disponible.</span><span class="sxs-lookup"><span data-stu-id="b6c74-120">The maximum number of concurrent opportunistic locks that you can create is limited only by the amount of available memory.</span></span>

<span data-ttu-id="b6c74-121">Les applications locales ne doivent pas tenter de demander des verrous opportunistes à partir de serveurs distants.</span><span class="sxs-lookup"><span data-stu-id="b6c74-121">Local applications should not attempt to request opportunistic locks from remote servers.</span></span> <span data-ttu-id="b6c74-122">Une erreur est renvoyée par [**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) si une tentative est effectuée.</span><span class="sxs-lookup"><span data-stu-id="b6c74-122">An error will be returned by [**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) if an attempt is made to do this.</span></span>

<span data-ttu-id="b6c74-123">Les verrous opportunistes sont très peu utilisés pour les applications.</span><span class="sxs-lookup"><span data-stu-id="b6c74-123">Opportunistic locks are of very limited use for applications.</span></span> <span data-ttu-id="b6c74-124">La seule pratique consiste à tester un redirecteur réseau ou un gestionnaire de verrouillage opportuniste de serveur.</span><span class="sxs-lookup"><span data-stu-id="b6c74-124">The only practical use is to test a network redirector or a server opportunistic lock handler.</span></span> <span data-ttu-id="b6c74-125">En règle générale, les systèmes de fichiers implémentent la prise en charge des verrous opportunistes.</span><span class="sxs-lookup"><span data-stu-id="b6c74-125">Typically, file systems implement support for opportunistic locks.</span></span> <span data-ttu-id="b6c74-126">Les applications laissent généralement la gestion des verrous opportunistes aux pilotes du système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="b6c74-126">Applications generally leave opportunistic lock management to the file system drivers.</span></span> <span data-ttu-id="b6c74-127">Toute personne qui implémente un système de fichiers doit utiliser le [Kit IFS (Installable File System)](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx).</span><span class="sxs-lookup"><span data-stu-id="b6c74-127">Anyone implementing a file system should use the [Installable File System (IFS) Kit](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx).</span></span> <span data-ttu-id="b6c74-128">Toute personne développant un pilote de périphérique autre qu’un système de fichiers installable doit utiliser le [Kit WDK (Windows Driver Kit)](https://www.microsoft.com/?ref=go).</span><span class="sxs-lookup"><span data-stu-id="b6c74-128">Anyone developing a device driver other than an installable file system should use the [Windows Driver Kit (WDK)](https://www.microsoft.com/?ref=go).</span></span>

<span data-ttu-id="b6c74-129">Les verrous opportunistes et les opérations associées sont un sur-ensemble de la portion de verrouillage opportuniste du protocole CIFS (Common Internet File System), un brouillon Internet.</span><span class="sxs-lookup"><span data-stu-id="b6c74-129">Opportunistic locks and the associated operations are a superset of the opportunistic lock portion of the Common Internet File System (CIFS) protocol, an Internet Draft.</span></span> <span data-ttu-id="b6c74-130">Le protocole CIFS est une version améliorée du protocole SMB (Server Message Block).</span><span class="sxs-lookup"><span data-stu-id="b6c74-130">The CIFS protocol is an enhanced version of the Server Message Block (SMB) protocol.</span></span> <span data-ttu-id="b6c74-131">Pour plus d’informations, consultez [vue d’ensemble du protocole SMB Microsoft et du protocole CIFS](microsoft-smb-protocol-and-cifs-protocol-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b6c74-131">For more information, see [Microsoft SMB Protocol and CIFS Protocol Overview](microsoft-smb-protocol-and-cifs-protocol-overview.md).</span></span> <span data-ttu-id="b6c74-132">La version préliminaire d’Internet CIFS identifie explicitement qu’une implémentation CIFS peut implémenter des verrous opportunistes en refusant de les accorder.</span><span class="sxs-lookup"><span data-stu-id="b6c74-132">The CIFS Internet Draft explicitly identifies that a CIFS implementation may implement opportunistic locks by refusing to grant them.</span></span>

<span data-ttu-id="b6c74-133">Les rubriques suivantes identifient les verrous opportunistes.</span><span class="sxs-lookup"><span data-stu-id="b6c74-133">The following topics identify opportunistic locks.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="b6c74-134">Contenu de cette section</span><span class="sxs-lookup"><span data-stu-id="b6c74-134">In this section</span></span>



| <span data-ttu-id="b6c74-135">Rubrique</span><span class="sxs-lookup"><span data-stu-id="b6c74-135">Topic</span></span>                                                                                                               | <span data-ttu-id="b6c74-136">Description</span><span class="sxs-lookup"><span data-stu-id="b6c74-136">Description</span></span>                                                                                                                                                                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="b6c74-137">Mise en cache locale</span><span class="sxs-lookup"><span data-stu-id="b6c74-137">Local Caching</span></span>](local-caching.md)<br/>                                                                       | <span data-ttu-id="b6c74-138">*La mise en cache locale* des données est une technique utilisée pour accélérer l’accès réseau aux fichiers de données.</span><span class="sxs-lookup"><span data-stu-id="b6c74-138">*Local caching* of data is a technique used to speed network access to data files.</span></span> <span data-ttu-id="b6c74-139">Cela implique la mise en cache des données sur les clients plutôt que sur des serveurs lorsque cela est possible.</span><span class="sxs-lookup"><span data-stu-id="b6c74-139">It involves caching data on clients rather than on servers when possible.</span></span><br/>                                                                                                                           |
| [<span data-ttu-id="b6c74-140">Cohérence des données</span><span class="sxs-lookup"><span data-stu-id="b6c74-140">Data Coherency</span></span>](data-coherency.md)<br/>                                                                     | <span data-ttu-id="b6c74-141">Si les données sont cohérentes, les données sur le serveur et tous les clients sont synchronisées.</span><span class="sxs-lookup"><span data-stu-id="b6c74-141">If data is coherent, data on the server and all the clients is synchronized.</span></span> <span data-ttu-id="b6c74-142">Un système logiciel qui assure la cohérence des données est un système de contrôle de révision (RCS).</span><span class="sxs-lookup"><span data-stu-id="b6c74-142">One type of software system that provides data coherency is a revision control system (RCS).</span></span><br/>                                                                                                              |
| [<span data-ttu-id="b6c74-143">Comment demander un verrou opportuniste</span><span class="sxs-lookup"><span data-stu-id="b6c74-143">How to Request an Opportunistic Lock</span></span>](how-to-request-an-opportunistic-lock.md)<br/>                         | <span data-ttu-id="b6c74-144">Les verrous opportunistes sont demandés en ouvrant un fichier avec les autorisations et les indicateurs appropriés à l’application ouvrant le fichier.</span><span class="sxs-lookup"><span data-stu-id="b6c74-144">Opportunistic locks are requested by first opening a file with permissions and flags appropriate to the application opening the file.</span></span> <span data-ttu-id="b6c74-145">Tous les fichiers pour lesquels des verrous opportunistes seront demandés doivent être ouverts pour une opération avec chevauchement (asynchrone).</span><span class="sxs-lookup"><span data-stu-id="b6c74-145">All files for which opportunistic locks will be requested must be opened for overlapped (asynchronous) operation.</span></span><br/>                                |
| [<span data-ttu-id="b6c74-146">Réponse du serveur pour les demandes d’ouverture sur les fichiers verrouillés</span><span class="sxs-lookup"><span data-stu-id="b6c74-146">Server Response to Open Requests on Locked Files</span></span>](server-response-to-open-requests-on-locked-files.md)<br/> | <span data-ttu-id="b6c74-147">Vous pouvez réduire l’impact de votre application sur d’autres clients et l’impact qu’elle a sur votre application en accordant autant de partage que possible, en demandant le niveau d’accès minimal nécessaire et en utilisant le verrou opportuniste le moins intrusif adapté à votre application.</span><span class="sxs-lookup"><span data-stu-id="b6c74-147">You can minimize the impact your application has on other clients and the impact they have on your application by granting as much sharing as possible, requesting the minimum access level necessary, and using the least intrusive opportunistic lock suitable for your application.</span></span><br/> |
| [<span data-ttu-id="b6c74-148">Types de verrous opportunistes</span><span class="sxs-lookup"><span data-stu-id="b6c74-148">Types of Opportunistic Locks</span></span>](types-of-opportunistic-locks.md)<br/>                                         | <span data-ttu-id="b6c74-149">Décrit les verrous de niveau 1, de niveau 2, de traitement par lots et de filtrage opportuniste.</span><span class="sxs-lookup"><span data-stu-id="b6c74-149">Describes level 1, level 2, batch, and filter opportunistic locks.</span></span><br/>                                                                                                                                                                                                                     |
| [<span data-ttu-id="b6c74-150">Interruption des verrous opportunistes</span><span class="sxs-lookup"><span data-stu-id="b6c74-150">Breaking Opportunistic Locks</span></span>](breaking-opportunistic-locks.md)<br/>                                         | <span data-ttu-id="b6c74-151">La rupture d’un verrou opportuniste est le processus qui consiste à dégrader le verrou d’un client sur un fichier de sorte qu’un autre client puisse ouvrir le fichier, avec ou sans verrou opportuniste.</span><span class="sxs-lookup"><span data-stu-id="b6c74-151">Breaking an opportunistic lock is the process of degrading the lock that one client has on a file so that another client can open the file, with or without an opportunistic lock.</span></span><br/>                                                                                                     |
| [<span data-ttu-id="b6c74-152">Exemples de verrouillage opportuniste</span><span class="sxs-lookup"><span data-stu-id="b6c74-152">Opportunistic Lock Examples</span></span>](opportunistic-lock-examples.md)<br/>                                           | <span data-ttu-id="b6c74-153">Diagrammes de vues du trafic réseau pour un verrou opportuniste de niveau 1, un verrou par lot opportuniste et un verrou opportuniste de filtre.</span><span class="sxs-lookup"><span data-stu-id="b6c74-153">Diagrams of network-traffic views for a level 1 opportunistic lock, a batch opportunistic lock, and a filter opportunistic lock.</span></span><br/>                                                                                                                                                       |
| [<span data-ttu-id="b6c74-154">Opérations de verrouillage opportuniste</span><span class="sxs-lookup"><span data-stu-id="b6c74-154">Opportunistic Lock Operations</span></span>](opportunistic-lock-operations.md)<br/>                                       | <span data-ttu-id="b6c74-155">Si une application demande des verrous opportunistes, tous les fichiers pour lesquels elle demande des verrous doivent être ouverts pour les entrées et sorties avec chevauchement (asynchrone) à l’aide de la fonction [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) avec l’indicateur de **\_ \_ chevauchement** de l’indicateur de fichier.</span><span class="sxs-lookup"><span data-stu-id="b6c74-155">If an application requests opportunistic locks, all files for which it requests locks must be opened for overlapped (asynchronous) input and output by using the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function with the **FILE\_FLAG\_OVERLAPPED** flag.</span></span><br/>                                   |



 

<span data-ttu-id="b6c74-156">Pour plus d’informations sur les verrous opportunistes, consultez le document préliminaire CIFS Internet.</span><span class="sxs-lookup"><span data-stu-id="b6c74-156">For additional information about opportunistic locks, see the CIFS Internet Draft document.</span></span> <span data-ttu-id="b6c74-157">Toutes les incohérences entre cette rubrique et le brouillon Internet CIFS actuel doivent être résolues en faveur du projet Internet CIFS.</span><span class="sxs-lookup"><span data-stu-id="b6c74-157">Any discrepancies between this topic and the current CIFS Internet Draft should be resolved in favor of the CIFS Internet Draft.</span></span>

 

