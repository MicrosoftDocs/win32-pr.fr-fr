---
description: Les administrateurs peuvent créer, supprimer et recréer des journaux de modifications.
ms.assetid: 26cbacc2-d26b-434b-91b5-31aedc96da13
title: Création, modification et suppression d’un journal des modifications
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 50c8cf7296f93549e7d9ec05f5d614131cc342ce
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106519491"
---
# <a name="creating-modifying-and-deleting-a-change-journal"></a><span data-ttu-id="8e5f1-103">Création, modification et suppression d’un journal des modifications</span><span class="sxs-lookup"><span data-stu-id="8e5f1-103">Creating, Modifying, and Deleting a Change Journal</span></span>

<span data-ttu-id="8e5f1-104">Les administrateurs peuvent créer, supprimer et recréer des journaux de modification à votre consigne.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-104">Administrators can create, delete, and re-create change journals at will.</span></span> <span data-ttu-id="8e5f1-105">Un administrateur doit supprimer un journal lorsque la valeur du numéro de séquence de mise à jour (USN) actuelle approche la valeur USN maximale possible, comme indiqué par le membre **MaxUsn** de la structure des [**\_ \_ données du journal USN**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_journal_data_v0) .</span><span class="sxs-lookup"><span data-stu-id="8e5f1-105">An administrator should delete a journal when the current update sequence number (USN) value approaches the maximum possible USN value, as indicated by the **MaxUsn** member of the [**USN\_JOURNAL\_DATA**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_journal_data_v0) structure.</span></span> <span data-ttu-id="8e5f1-106">Un administrateur peut également supprimer et recréer un journal des modifications pour libérer de l’espace disque.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-106">An administrator might also delete and re-create a change journal to reclaim disk space.</span></span> <span data-ttu-id="8e5f1-107">Pour effectuer cette opération et toutes les autres opérations de journal des modifications non programmées, vous devez disposer de privilèges d’administrateur système.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-107">To perform this and all other non-programmatic change journal operations, you must have system administrator privileges.</span></span> <span data-ttu-id="8e5f1-108">Autrement dit, vous devez être membre du groupe administrateurs.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-108">That is, you must be a member of the Administrators group.</span></span>

<span data-ttu-id="8e5f1-109">Pour créer ou modifier un journal des modifications sur un volume spécifié par programme, utilisez le code de contrôle [**FSCTL \_ créer un \_ \_ journal USN**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) .</span><span class="sxs-lookup"><span data-stu-id="8e5f1-109">To create or modify a change journal on a specified volume programmatically, use the [**FSCTL\_CREATE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) control code.</span></span>

<span data-ttu-id="8e5f1-110">Lorsque vous créez un nouveau journal des modifications ou en modifiez un, le système de fichiers NTFS définit des informations pour ce journal des modifications à partir des informations de la structure [**créer les \_ \_ \_ données du journal USN**](/windows/desktop/api/WinIoCtl/ns-winioctl-create_usn_journal_data) , que [**FSCTL \_ crée le \_ \_ journal USN**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) comme entrée.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-110">When you create a new change journal or modify an existing one, the NTFS file system sets information for that change journal from information in the [**CREATE\_USN\_JOURNAL\_DATA**](/windows/desktop/api/WinIoCtl/ns-winioctl-create_usn_journal_data) structure, which [**FSCTL\_CREATE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) takes as input.</span></span> <span data-ttu-id="8e5f1-111">**Créer \_ Les \_ \_ données du journal USN** possèdent les membres **MaximumSize** et **AllocationDelta**.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-111">**CREATE\_USN\_JOURNAL\_DATA** has the members **MaximumSize** and **AllocationDelta**.</span></span>

<span data-ttu-id="8e5f1-112">**MaximumSize** correspond à la taille maximale cible du journal des modifications, en octets.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-112">**MaximumSize** is the target maximum size for the change journal in bytes.</span></span> <span data-ttu-id="8e5f1-113">Le journal des modifications peut croître plus grand que cette valeur, mais au niveau des points de contrôle du système de fichiers NTFS, le système de fichiers NTFS examine le journal et le tronque lorsque sa taille dépasse la valeur de **MaximumSize** plus la valeur de **AllocationDelta**.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-113">The change journal can grow larger than this value, but at NTFS file system checkpoints the NTFS file system examines the journal and trims it when its size exceeds the value of **MaximumSize** plus the value of **AllocationDelta**.</span></span> <span data-ttu-id="8e5f1-114">(Au niveau des points de contrôle du système de fichiers NTFS, le système d’exploitation écrit des enregistrements dans le fichier journal du système de fichiers NTFS qui permet au système de fichiers NTFS de déterminer le traitement requis pour récupérer suite à une défaillance.)</span><span class="sxs-lookup"><span data-stu-id="8e5f1-114">(At NTFS file system checkpoints, the operating system writes records to the NTFS file system log file that allow the NTFS file system to determine what processing is required to recover from a failure.)</span></span>

<span data-ttu-id="8e5f1-115">**AllocationDelta** est le nombre d’octets ajoutés à la fin et supprimés du début du journal des modifications chaque fois que la mémoire est allouée ou désallouée.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-115">**AllocationDelta** is the number of bytes added to the end and removed from the beginning of the change journal each time memory is allocated or deallocated.</span></span> <span data-ttu-id="8e5f1-116">En d’autres termes, l’allocation et la désallocation ont lieu dans des unités de cette taille.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-116">In other words, allocation and deallocation take place in units of this size.</span></span> <span data-ttu-id="8e5f1-117">Un entier multiple d’une taille de cluster est une valeur raisonnable pour ce membre.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-117">An integer multiple of a cluster size is a reasonable value for this member.</span></span>

<span data-ttu-id="8e5f1-118">Si un administrateur modifie un journal des modifications existant pour qu’il ait **une plus grande** valeur de taille maximale, par exemple si un volume est réindexé trop souvent, le journal des modifications reçoit simplement de nouvelles entrées jusqu’à ce qu’il dépasse la nouvelle taille maximale.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-118">If an administrator modifies an existing change journal to have a larger **MaximumSize** value, for example if a volume is being re-indexed too often, the change journal simply receives new entries until it exceeds the new maximum size.</span></span>

<span data-ttu-id="8e5f1-119">Pour supprimer un journal des modifications, utilisez le code de contrôle [**FSCTL \_ supprimer le \_ \_ journal USN**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) .</span><span class="sxs-lookup"><span data-stu-id="8e5f1-119">To delete a change journal, use the [**FSCTL\_DELETE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) control code.</span></span> <span data-ttu-id="8e5f1-120">Lorsque vous utilisez cette opération, elle parcourt tous les fichiers sur le volume et réinitialise l’USN de chaque fichier à zéro.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-120">When you use this operation, it walks through all of the files on the volume and resets the USN for each file to zero.</span></span> <span data-ttu-id="8e5f1-121">L’opération supprime ensuite le journal des modifications existant.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-121">The operation then deletes the existing change journal.</span></span> <span data-ttu-id="8e5f1-122">Cette opération persiste entre les redémarrages du système jusqu’à ce qu’elle se termine.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-122">This operation persists across system restarts until it completes.</span></span> <span data-ttu-id="8e5f1-123">Toute tentative de lecture, de création ou de modification du journal des modifications au cours de ce processus échoue avec le code **d’erreur erreur \_ \_ de suppression du journal \_ en \_ cours**.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-123">Any attempt to read, create, or modify the change journal during this process fails with the error code **ERROR\_JOURNAL\_DELETE\_IN\_PROGRESS**.</span></span>

<span data-ttu-id="8e5f1-124">Vous pouvez également utiliser le code de contrôle [**FSCTL \_ supprimer le \_ \_ journal USN**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) pour déterminer si une suppression lancée par un autre processus est en cours.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-124">You can also use the [**FSCTL\_DELETE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) control code to determine if a deletion started by some other process is in progress.</span></span> <span data-ttu-id="8e5f1-125">Par exemple, votre application, lorsqu’elle est démarrée, peut déterminer si une suppression est en cours.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-125">For example, your application, when it is started, can determine if a deletion is in progress.</span></span> <span data-ttu-id="8e5f1-126">Étant donné que les suppressions du journal sont conservées entre les redémarrages du système, les services et les applications démarrés au redémarrage du système doivent vérifier qu’une suppression est en cours.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-126">Because journal deletions persist across system restarts, services and applications started at system restart should check for an ongoing deletion.</span></span>

<span data-ttu-id="8e5f1-127">Les journaux des modifications ne sont pas nécessairement créés au démarrage.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-127">Change journals are not necessarily created at startup.</span></span> <span data-ttu-id="8e5f1-128">Pour créer un journal des modifications, un administrateur peut le faire explicitement ou démarrer un autre service qui requiert un journal des modifications.</span><span class="sxs-lookup"><span data-stu-id="8e5f1-128">To create a change journal, an administrator may do so explicitly or start another service that requires a change journal.</span></span>

 

 
