---
description: Les journaux des événements stockent des événements importants pour le compte du système et des applications qui s’exécutent sur le système.
ms.assetid: 58a6569a-2775-4687-bf99-579fa4153191
title: Instructions de journalisation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c1210757a7961d82d13d4887e40fbd3837b86138
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104115199"
---
# <a name="logging-guidelines"></a><span data-ttu-id="d07a3-103">Instructions de journalisation</span><span class="sxs-lookup"><span data-stu-id="d07a3-103">Logging Guidelines</span></span>

<span data-ttu-id="d07a3-104">Les journaux des événements stockent des événements importants pour le compte du système et des applications qui s’exécutent sur le système.</span><span class="sxs-lookup"><span data-stu-id="d07a3-104">Event logs store records of significant events on behalf of the system and applications running on the system.</span></span> <span data-ttu-id="d07a3-105">Étant donné que les fonctions de journalisation sont à usage général, vous devez déterminer quelles informations sont appropriées au journal.</span><span class="sxs-lookup"><span data-stu-id="d07a3-105">Because the logging functions are general purpose, you must decide what information is appropriate to log.</span></span> <span data-ttu-id="d07a3-106">En règle générale, vous devez enregistrer uniquement les informations qui peuvent être utiles pour diagnostiquer un problème matériel ou logiciel.</span><span class="sxs-lookup"><span data-stu-id="d07a3-106">Generally, you should log only information that could be useful in diagnosing a hardware or software problem.</span></span> <span data-ttu-id="d07a3-107">La journalisation des événements n’est pas destinée à être utilisée en tant qu’outil de suivi.</span><span class="sxs-lookup"><span data-stu-id="d07a3-107">Event logging is not intended to be used as a tracing tool.</span></span>

## <a name="choosing-events-to-log"></a><span data-ttu-id="d07a3-108">Choix des événements à consigner</span><span class="sxs-lookup"><span data-stu-id="d07a3-108">Choosing Events to Log</span></span>

<span data-ttu-id="d07a3-109">Voici des exemples de cas dans lesquels la journalisation des événements peut être utile :</span><span class="sxs-lookup"><span data-stu-id="d07a3-109">The following are examples of cases in which event logging can be helpful:</span></span>

-   <span data-ttu-id="d07a3-110">Problèmes de ressources.</span><span class="sxs-lookup"><span data-stu-id="d07a3-110">Resource problems.</span></span> <span data-ttu-id="d07a3-111">La journalisation d’un événement d’avertissement lorsque l’allocation de mémoire échoue peut aider à indiquer la cause d’une situation de mémoire insuffisante.</span><span class="sxs-lookup"><span data-stu-id="d07a3-111">Logging a Warning event when memory allocation fails can help indicate the cause of a low-memory situation.</span></span>
-   <span data-ttu-id="d07a3-112">Problèmes matériels.</span><span class="sxs-lookup"><span data-stu-id="d07a3-112">Hardware problems.</span></span> <span data-ttu-id="d07a3-113">Si un pilote de périphérique rencontre un délai d’attente de contrôleur de disque, une panne d’alimentation dans un port parallèle ou une erreur de données à partir d’un réseau ou d’une carte série, le pilote de périphérique peut consigner des informations sur ces événements pour aider l’administrateur système à diagnostiquer des problèmes matériels.</span><span class="sxs-lookup"><span data-stu-id="d07a3-113">If a device driver encounters a disk controller time-out, a power failure in a parallel port, or a data error from a network or serial card, the device driver can log information about these events to help the system administrator diagnose hardware problems.</span></span>
-   <span data-ttu-id="d07a3-114">Secteurs incorrects.</span><span class="sxs-lookup"><span data-stu-id="d07a3-114">Bad sectors.</span></span> <span data-ttu-id="d07a3-115">Si un pilote de disque rencontre un secteur défectueux, il peut être en mesure de lire ou d’écrire dans le secteur après une nouvelle tentative de l’opération, mais le secteur sera incorrect.</span><span class="sxs-lookup"><span data-stu-id="d07a3-115">If a disk driver encounters a bad sector, it may be able to read from or write to the sector after retrying the operation, but the sector will go bad eventually.</span></span> <span data-ttu-id="d07a3-116">Si le pilote de disque peut continuer, il doit consigner un événement d’avertissement ; dans le cas contraire, il doit consigner un événement d’erreur.</span><span class="sxs-lookup"><span data-stu-id="d07a3-116">If the disk driver can proceed, it should log a Warning event; otherwise, it should log an Error event.</span></span> <span data-ttu-id="d07a3-117">Si un pilote de système de fichiers trouve un grand nombre de secteurs incorrects et les corrige, la journalisation des événements d’avertissement peut aider un administrateur à déterminer que le disque peut être en panne.</span><span class="sxs-lookup"><span data-stu-id="d07a3-117">If a file system driver finds a large number of bad sectors and fixes them, logging Warning events might help an administrator determine that the disk may be about to fail.</span></span>
-   <span data-ttu-id="d07a3-118">Événements d’informations.</span><span class="sxs-lookup"><span data-stu-id="d07a3-118">Information events.</span></span> <span data-ttu-id="d07a3-119">Une application serveur (par exemple, un serveur de base de données) enregistre une ouverture de session utilisateur, l’ouverture d’une base de données ou le démarrage d’un transfert de fichiers.</span><span class="sxs-lookup"><span data-stu-id="d07a3-119">A server application (such as a database server) records a user logging on, opening a database, or starting a file transfer.</span></span> <span data-ttu-id="d07a3-120">Le serveur peut également consigner d’autres événements tels que des erreurs (impossible d’accéder à un fichier, un processus hôte déconnecté, etc.), une base de données endommagée ou si un transfert de fichiers a réussi.</span><span class="sxs-lookup"><span data-stu-id="d07a3-120">The server can also log other events such as errors (cannot access file, host process disconnected, and so on), database corruption, or whether a file transfer was successful.</span></span>

## <a name="writing-messages"></a><span data-ttu-id="d07a3-121">Écriture de messages</span><span class="sxs-lookup"><span data-stu-id="d07a3-121">Writing Messages</span></span>

<span data-ttu-id="d07a3-122">Les messages doivent être compréhensibles pour les administrateurs et les utilisateurs qui tentent de résoudre un problème.</span><span class="sxs-lookup"><span data-stu-id="d07a3-122">Messages should make sense to administrators and users who are trying to troubleshoot a problem.</span></span> <span data-ttu-id="d07a3-123">Un message doit contenir toutes les informations nécessaires pour comprendre ce qui a provoqué le problème et comment le corriger.</span><span class="sxs-lookup"><span data-stu-id="d07a3-123">A message should contain all the information needed to understand what caused the problem and how to correct it.</span></span>

<span data-ttu-id="d07a3-124">Évitez d’écrire un message énigmatique tel que «un paquet de pilote reçu à partir du sous-système d’e/s n’était pas valide.</span><span class="sxs-lookup"><span data-stu-id="d07a3-124">Avoid writing a cryptic message such as "A driver packet received from the I/O subsystem was invalid.</span></span> <span data-ttu-id="d07a3-125">Les données sont le paquet». Un message meilleur indique que le pilote en question fonctionne correctement, mais qu’il enregistre des paquets au format incorrect.</span><span class="sxs-lookup"><span data-stu-id="d07a3-125">The data is the packet."A better message would indicate that the driver in question is functioning properly, but is logging incorrectly formatted packets.</span></span> <span data-ttu-id="d07a3-126">Il est possible d’indiquer qu’une version Unicode du pilote est nécessaire pour corriger le problème.</span><span class="sxs-lookup"><span data-stu-id="d07a3-126">It could go on to say that a Unicode version of the driver is needed to correct the problem.</span></span> <span data-ttu-id="d07a3-127">Pour plus d’informations sur l’écriture de bons messages d’erreur, consultez [instructions relatives aux messages d’erreur](/windows/desktop/Debug/error-message-guidelines).</span><span class="sxs-lookup"><span data-stu-id="d07a3-127">For more information about writing good error messages, see [Error Message Guidelines](/windows/desktop/Debug/error-message-guidelines).</span></span>

<span data-ttu-id="d07a3-128">N’utilisez pas de tabulations ou de virgules dans le texte du message, car les journaux des événements peuvent être enregistrés en tant que fichiers texte séparés par des virgules ou des tabulations.</span><span class="sxs-lookup"><span data-stu-id="d07a3-128">Do not use tabs or commas in the message text, because event logs can be saved as comma or tab-separated text files.</span></span> <span data-ttu-id="d07a3-129">De nombreuses organisations importent ces fichiers dans des bases de données, et les caractères de mise en forme supplémentaires nécessitent une manipulation manuelle.</span><span class="sxs-lookup"><span data-stu-id="d07a3-129">Many organizations import these files into databases, and the extra formatting characters will require manual manipulation.</span></span>

<span data-ttu-id="d07a3-130">Lorsque vous utilisez des noms UNC ou d’autres liens qui contiennent des espaces, placez le nom entre crochets pointus.</span><span class="sxs-lookup"><span data-stu-id="d07a3-130">When using UNC names, or other links that contain spaces, enclose the name in angle brackets.</span></span> <span data-ttu-id="d07a3-131">Par exemple, <\\ \\ *Nom_Partage* \\ *ServerName*>.</span><span class="sxs-lookup"><span data-stu-id="d07a3-131">For example, <\\\\*sharename*\\*servername*>.</span></span> <span data-ttu-id="d07a3-132">Vous pouvez écrire une URL à la fin du message qui dirige l’utilisateur vers le document d’aide associé.</span><span class="sxs-lookup"><span data-stu-id="d07a3-132">You can write a URL to the end of the message that points the user to related help material.</span></span> <span data-ttu-id="d07a3-133">L’URL doit être un nom d’hôte DNS complet.</span><span class="sxs-lookup"><span data-stu-id="d07a3-133">The URL must be a fully qualified DNS host name.</span></span> <span data-ttu-id="d07a3-134">Par exemple, vous pouvez ajouter le texte suivant à vos messages : « pour plus d’informations sur ce message, consultez notre site de support technique à l’adresse https://www.microsoft.com/Support/ProdRedirect/ContentSearch.asp . »</span><span class="sxs-lookup"><span data-stu-id="d07a3-134">For example, you could append the following text to your messages: "For additional information on this message, please visit our support site at https://www.microsoft.com/Support/ProdRedirect/ContentSearch.asp."</span></span> <span data-ttu-id="d07a3-135">Le lien mène à une page ASP qui redirige l’utilisateur vers le contenu relatif au message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="d07a3-135">The link would lead to an ASP page that redirects the user to content relating to the error message.</span></span> <span data-ttu-id="d07a3-136">Il analyse les paramètres supplémentaires (transmis lorsque l’utilisateur clique sur l’URL) pour déterminer où rediriger l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="d07a3-136">It would parse additional parameters (passed when the URL is clicked) to determine where to redirect the user.</span></span>

<span data-ttu-id="d07a3-137">Les arguments passés à la fonction [**ReportEvent**](/windows/desktop/api/Winbase/nf-winbase-reporteventa) sont ajoutés à l’URL comme suit :</span><span class="sxs-lookup"><span data-stu-id="d07a3-137">The arguments passed to the [**ReportEvent**](/windows/desktop/api/Winbase/nf-winbase-reporteventa) function are appended to the URL as follows:</span></span>

``` syntax
strHTTPQuery += L"?EvtSrc=" + _strEscapedSource;
strHTTPQuery += L"&EvtCat=" + _strEscapedCategory;
strHTTPQuery += L"&EvtID=" + _strEscapedEventID;
strHTTPQuery += L"&EvtCatID=" + _strEscapedCategoryID;
strHTTPQuery += L"&EvtType=" + _strEscapedType;
strHTTPQuery += L"&EvtTypeID=" + _strEscapedTypeID;
strHTTPQuery += L"&EvtRptTime=" + _strEscapedDateAndTime;
strHTTPQuery += L"&EvtTZBias=" + _strEscapedTimeZoneBias;
```

<span data-ttu-id="d07a3-138">Si le nom de la société, le nom du produit, la version du produit, le nom du fichier et la version du fichier de l’en-tête de la DLL de message pour la source de l’événement sont valides, ils sont également ajoutés à l’URL :</span><span class="sxs-lookup"><span data-stu-id="d07a3-138">If the company name, product name, product version, file name, and file version from the message DLL header for the event source are valid, they are also appended to the URL:</span></span>

``` syntax
ADD_VER_STR(L"CoName",   _strEscapedCompanyName);
ADD_VER_STR(L"ProdName", _strEscapedProductName);
ADD_VER_STR(L"ProdVer",  _strEscapedProductVersion);
ADD_VER_STR(L"FileName", _strEscapedFileName);
ADD_VER_STR(L"FileVer",  _strEscapedFileVersion);
```

## <a name="reducing-overhead"></a><span data-ttu-id="d07a3-139">Réduction de la surcharge</span><span class="sxs-lookup"><span data-stu-id="d07a3-139">Reducing Overhead</span></span>

<span data-ttu-id="d07a3-140">L’enregistrement des événements consomme des ressources telles que l’espace disque et le temps processeur.</span><span class="sxs-lookup"><span data-stu-id="d07a3-140">Event logging consumes resources such as disk space and processor time.</span></span> <span data-ttu-id="d07a3-141">La quantité d’espace disque nécessaire pour un journal des événements et la surcharge d’une application qui journalise les événements dépend de la quantité d’informations que vous choisissez de consigner.</span><span class="sxs-lookup"><span data-stu-id="d07a3-141">The amount of disk space that an event log requires and the overhead for an application that logs events depend on how much information you choose to log.</span></span> <span data-ttu-id="d07a3-142">C’est pourquoi il est important de ne journaliser que les informations essentielles.</span><span class="sxs-lookup"><span data-stu-id="d07a3-142">This is why it is important to log only essential information.</span></span> <span data-ttu-id="d07a3-143">Il est également conseillé de placer les appels de journalisation des événements dans un chemin d’erreur dans le code plutôt que dans le chemin de code principal, ce qui réduit les performances.</span><span class="sxs-lookup"><span data-stu-id="d07a3-143">It is also good to place event logging calls in an error path in the code rather than in the main code path, which would reduce performance.</span></span>

<span data-ttu-id="d07a3-144">La quantité d’espace disque requise pour chaque enregistrement de journal des événements comprend les membres de la structure [**EVENTLOGRECORD**](/windows/desktop/api/Winnt/ns-winnt-eventlogrecord) .</span><span class="sxs-lookup"><span data-stu-id="d07a3-144">The amount of disk space required for each event log record includes the members of the [**EVENTLOGRECORD**](/windows/desktop/api/Winnt/ns-winnt-eventlogrecord) structure.</span></span> <span data-ttu-id="d07a3-145">Il s’agit d’une structure de longueur variable. les chaînes et les données binaires sont stockées à la suite de la structure.</span><span class="sxs-lookup"><span data-stu-id="d07a3-145">This is a variable length structure; strings and binary data are stored following the structure.</span></span>

 

 
