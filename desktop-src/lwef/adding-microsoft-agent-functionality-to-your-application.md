---
title: Ajout de la fonctionnalité Microsoft Agent à votre application
description: Ajout de la fonctionnalité Microsoft Agent à votre application
ms.assetid: 2b4816dd-11bf-4c17-873e-4bdbb7fa1ccf
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8a2972b0251a4114e5d280d8f739d416ebc5dc1c
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104314837"
---
# <a name="adding-microsoft-agent-functionality-to-your-application"></a><span data-ttu-id="234c4-103">Ajout de la fonctionnalité Microsoft Agent à votre application</span><span class="sxs-lookup"><span data-stu-id="234c4-103">Adding Microsoft Agent Functionality to Your Application</span></span>

<span data-ttu-id="234c4-104">\[Microsoft Agent est déconseillé à partir de Windows 7 et peut ne pas être disponible dans les versions ultérieures de Windows.\]</span><span class="sxs-lookup"><span data-stu-id="234c4-104">\[Microsoft Agent is deprecated as of Windows 7, and may be unavailable in subsequent versions of Windows.\]</span></span>

<span data-ttu-id="234c4-105">Pour accéder aux interfaces serveur de Microsoft Agent, l’agent doit déjà être installé sur le système cible.</span><span class="sxs-lookup"><span data-stu-id="234c4-105">To access Microsoft Agent's server interfaces, Agent must already be installed on the target system.</span></span> <span data-ttu-id="234c4-106">L’installation autre que l’utilisation du fichier exécutable d’installation automatique de l’agent, telle que la tentative de copie et l’inscription des fichiers de composants de l’agent, n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="234c4-106">Installation other than using Agent's self-installing executable file, such as attempting to copy and register Agent component files, is not supported.</span></span> <span data-ttu-id="234c4-107">Cela garantit une installation cohérente et complète.</span><span class="sxs-lookup"><span data-stu-id="234c4-107">This ensures consistent and complete installation.</span></span> <span data-ttu-id="234c4-108">Notez que le fichier d’installation automatique de Microsoft Agent ne s’installe pas sur les systèmes d’exploitation Microsoft Windows 2000 et versions ultérieures, car ces versions du système d’exploitation incluent déjà leur propre version de l’agent.</span><span class="sxs-lookup"><span data-stu-id="234c4-108">Note that the Microsoft Agent self-installing file will not install on Microsoft Windows 2000 and later operating systems because these versions of the operating system already include their own version of Agent.</span></span>

<span data-ttu-id="234c4-109">Pour installer correctement l’agent sur un système cible disposant d’un système d’exploitation Microsoft Windows antérieur, vous devez également vous assurer que le système cible dispose d’une version récente du Microsoft Visual C++ Runtime (Msvcrt.dll), de l’outil d’inscription Microsoft (Regsvr32.dll) et des dll Microsoft COM.</span><span class="sxs-lookup"><span data-stu-id="234c4-109">To successfully install Agent on a target system with a prior Microsoft Windows operating system, you must also ensure that the target system has a recent version of the Microsoft Visual C++ runtime (Msvcrt.dll), Microsoft registration tool (Regsvr32.dll), and Microsoft COM dlls.</span></span> <span data-ttu-id="234c4-110">Le moyen le plus simple de s’assurer que les composants nécessaires se trouvent sur le système cible est d’exiger l’installation de Microsoft Internet Explorer 3,02 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="234c4-110">The easiest way to ensure that the necessary components are on the target system is to require that Microsoft Internet Explorer 3.02 or later is installed.</span></span> <span data-ttu-id="234c4-111">Vous pouvez également installer les deux premiers composants qui sont disponibles dans le cadre de Microsoft Visual C++.</span><span class="sxs-lookup"><span data-stu-id="234c4-111">Alternatively, you can install the first two components which are available as part of Microsoft Visual C++.</span></span> <span data-ttu-id="234c4-112">Les DLL COM nécessaires peuvent être installées dans le cadre de la mise à jour Microsoft DCOM, disponible sur le site Web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="234c4-112">The necessary COM dlls can be installed as part of the Microsoft DCOM update, available at the Microsoft website.</span></span> <span data-ttu-id="234c4-113">Vous trouverez des informations supplémentaires et des informations de licence pour ces composants sur le site Web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="234c4-113">You can find further information and licensing information for these components at the Microsoft website.</span></span>

<span data-ttu-id="234c4-114">Les composants de langue de l’agent peuvent être installés de la même façon.</span><span class="sxs-lookup"><span data-stu-id="234c4-114">Agent's language components can be installed the same way.</span></span> <span data-ttu-id="234c4-115">De même, vous pouvez utiliser cette technique pour installer le format des services ACS des caractères Microsoft disponibles pour la distribution à partir du site Web de Microsoft Agent.</span><span class="sxs-lookup"><span data-stu-id="234c4-115">Similarly, you can use this technique to install the ACS format of the Microsoft characters available for distribution from the Microsoft Agent website.</span></span> <span data-ttu-id="234c4-116">Les fichiers de caractères sont automatiquement installés dans le \\ sous-répertoire Microsoft Agent chars.</span><span class="sxs-lookup"><span data-stu-id="234c4-116">The character files automatically install to the Microsoft Agent \\Chars subdirectory.</span></span>

<span data-ttu-id="234c4-117">Étant donné que les composants de Microsoft Agent sont conçus en tant que composants du système d’exploitation, l’agent n’est peut-être pas désinstallé.</span><span class="sxs-lookup"><span data-stu-id="234c4-117">Because Microsoft Agent's components are designed as operating system components, Agent may not be uninstalled.</span></span> <span data-ttu-id="234c4-118">De même, si l’agent est déjà installé en tant que partie du système d’exploitation Windows, le cabinet à installation automatique de l’agent peut ne pas s’installer.</span><span class="sxs-lookup"><span data-stu-id="234c4-118">Similarly, where Agent is already installed as part of the Windows operating system, the Agent self-installing cabinet may not install.</span></span>

<span data-ttu-id="234c4-119">Une fois installé, pour appeler les interfaces de l’agent, créez une instance du serveur et demandez un pointeur vers une interface spécifique que le serveur prend en charge à l’aide de la Convention COM standard.</span><span class="sxs-lookup"><span data-stu-id="234c4-119">Once installed, to call Agent's interfaces, create an instance of the server and request a pointer to a specific interface that the server supports using the standard COM convention.</span></span> <span data-ttu-id="234c4-120">En particulier, la bibliothèque COM fournit une fonction API, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance), qui crée une instance de l’objet et retourne un pointeur vers l’interface demandée de l’objet.</span><span class="sxs-lookup"><span data-stu-id="234c4-120">In particular, the COM library provides an API function, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance), that creates an instance of the object and returns a pointer to the requested interface of the object.</span></span> <span data-ttu-id="234c4-121">Demandez un pointeur vers l’interface [**IAgent**](iagent.md) ou [**IAgentEx**](iagentex.md) dans votre appel **CoCreateInstance** ou dans un appel ultérieur à [**QueryInterface**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)).</span><span class="sxs-lookup"><span data-stu-id="234c4-121">Request a pointer to the [**IAgent**](iagent.md) or [**IAgentEx**](iagentex.md) interface in your **CoCreateInstance** call or in a subsequent call to [**QueryInterface**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)).</span></span>

<span data-ttu-id="234c4-122">Le code suivant illustre cela en C/C++.</span><span class="sxs-lookup"><span data-stu-id="234c4-122">The following code illustrates this in C/C++.</span></span>


```
hRes = CoCreateInstance(CLSID_AgentServer,
                     NULL,
                     CLSCTX_SERVER,
                     IID_IAgentEx,
                     (LPVOID *)&amp;pAgentEx);
```



<span data-ttu-id="234c4-123">Si le serveur Microsoft Agent est en cours d’exécution, cette fonction se connecte au serveur. dans le cas contraire, il démarre le serveur.</span><span class="sxs-lookup"><span data-stu-id="234c4-123">If the Microsoft Agent server is running, this function connects to the server; otherwise, it starts up the server.</span></span>

<span data-ttu-id="234c4-124">Notez que les interfaces du serveur Microsoft Agent incluent souvent des interfaces étendues qui incluent un suffixe « ex ».</span><span class="sxs-lookup"><span data-stu-id="234c4-124">Note that the Microsoft Agent server interfaces often include extended interfaces that include an "Ex" suffix.</span></span> <span data-ttu-id="234c4-125">Ces interfaces sont dérivées de et, par conséquent, incluent toutes les fonctionnalités de, leurs équivalents non-ex.</span><span class="sxs-lookup"><span data-stu-id="234c4-125">These interfaces are derived from, and therefore include all the functionality of, their non-Ex counterparts.</span></span> <span data-ttu-id="234c4-126">Si vous souhaitez utiliser l’une des fonctionnalités étendues, utilisez les interfaces ex.</span><span class="sxs-lookup"><span data-stu-id="234c4-126">If you want to use any of the extended features, use the Ex interfaces.</span></span>

<span data-ttu-id="234c4-127">Les fonctions qui acceptent des pointeurs vers des BSTR allouent de la mémoire à l’aide de [**SysAllocString**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="234c4-127">Functions that take pointers to BSTRs allocate memory using [**SysAllocString**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="234c4-128">Il incombe à l’appelant de libérer cette mémoire à l’aide de [**SysFreeString**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-sysfreestring).</span><span class="sxs-lookup"><span data-stu-id="234c4-128">It is the caller's responsibility to free this memory using [**SysFreeString**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-sysfreestring).</span></span>

 

 