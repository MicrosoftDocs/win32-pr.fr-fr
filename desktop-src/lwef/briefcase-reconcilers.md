---
title: Création de reconcilers de porte-documents
description: Un réconciliateur de porte-documents permet de rapprocher les différentes versions d’un document.
ms.assetid: 86d66291-96ae-40ea-98ef-ef263f25aa82
keywords:
- réconciliations de porte-documents
- rapprochement
- IReconcilableObject
- IReconcileInitiator
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b925e7055e15f6c7a49408aa28d147fb2eef5a7e
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104381799"
---
# <a name="creating-briefcase-reconcilers"></a><span data-ttu-id="c956e-107">Création de reconcilers de porte-documents</span><span class="sxs-lookup"><span data-stu-id="c956e-107">Creating Briefcase Reconcilers</span></span>

<span data-ttu-id="c956e-108">Un réconciliateur de porte-documents permet de rapprocher les différentes versions d’un document.</span><span class="sxs-lookup"><span data-stu-id="c956e-108">A briefcase reconciler gives Briefcase the means to reconcile different versions of a document.</span></span>

-   [<span data-ttu-id="c956e-109">À propos des réconciliateurs de porte-documents</span><span class="sxs-lookup"><span data-stu-id="c956e-109">About Briefcase Reconcilers</span></span>](#about-briefcase-reconcilers)
    -   [<span data-ttu-id="c956e-110">Rapprochement</span><span class="sxs-lookup"><span data-stu-id="c956e-110">Reconciliation</span></span>](#reconciliation)
    -   [<span data-ttu-id="c956e-111">Création d’un réconciliateur de porte-documents</span><span class="sxs-lookup"><span data-stu-id="c956e-111">Creating a Briefcase Reconciler</span></span>](#creating-a-briefcase-reconciler)
    -   [<span data-ttu-id="c956e-112">Interaction de l’utilisateur dans le rapprochement</span><span class="sxs-lookup"><span data-stu-id="c956e-112">User Interaction in Reconciliation</span></span>](#user-interaction-in-reconciliation)
    -   [<span data-ttu-id="c956e-113">Rapprochement des objets incorporés</span><span class="sxs-lookup"><span data-stu-id="c956e-113">Reconciling Embedded Objects</span></span>](#reconciling-embedded-objects)
    -   [<span data-ttu-id="c956e-114">Résidus</span><span class="sxs-lookup"><span data-stu-id="c956e-114">Residues</span></span>](#residues)
-   [<span data-ttu-id="c956e-115">Référence du réconciliateur de porte-documents</span><span class="sxs-lookup"><span data-stu-id="c956e-115">Briefcase Reconciler Reference</span></span>](#briefcase-reconciler-reference)
    -   [<span data-ttu-id="c956e-116">Méthodes et interfaces du réconciliateur de porte-documents</span><span class="sxs-lookup"><span data-stu-id="c956e-116">Briefcase Reconciler Interfaces and Methods</span></span>](#briefcase-reconciler-interfaces-and-methods)

## <a name="about-briefcase-reconcilers"></a><span data-ttu-id="c956e-117">À propos des réconciliateurs de porte-documents</span><span class="sxs-lookup"><span data-stu-id="c956e-117">About Briefcase Reconcilers</span></span>

<span data-ttu-id="c956e-118">Un réconciliateur de porte-documents associe différentes versions d’entrée d’un document pour produire une nouvelle version de sortie unique du document.</span><span class="sxs-lookup"><span data-stu-id="c956e-118">A briefcase reconciler combines different input versions of a document to produce a single, new output version of the document.</span></span> <span data-ttu-id="c956e-119">Vous devrez peut-être créer un réconciliateur de porte-documents pour prendre en charge votre type de document.</span><span class="sxs-lookup"><span data-stu-id="c956e-119">You might need to create a briefcase reconciler to support your type of document.</span></span> <span data-ttu-id="c956e-120">Cette vue d’ensemble décrit les réconcilieurs de porte-documents et explique comment les créer.</span><span class="sxs-lookup"><span data-stu-id="c956e-120">This overview describes briefcase reconcilers and explains how to create them.</span></span>

<span data-ttu-id="c956e-121">Les rubriques suivantes sont présentées :</span><span class="sxs-lookup"><span data-stu-id="c956e-121">The following topics are discussed:</span></span>

-   [<span data-ttu-id="c956e-122">Rapprochement</span><span class="sxs-lookup"><span data-stu-id="c956e-122">Reconciliation</span></span>](#reconciliation)
-   [<span data-ttu-id="c956e-123">Création d’un réconciliateur de porte-documents</span><span class="sxs-lookup"><span data-stu-id="c956e-123">Creating a Briefcase Reconciler</span></span>](#creating-a-briefcase-reconciler)
-   [<span data-ttu-id="c956e-124">Interaction de l’utilisateur dans le rapprochement</span><span class="sxs-lookup"><span data-stu-id="c956e-124">User Interaction in Reconciliation</span></span>](#user-interaction-in-reconciliation)
-   [<span data-ttu-id="c956e-125">Rapprochement des objets incorporés</span><span class="sxs-lookup"><span data-stu-id="c956e-125">Reconciling Embedded Objects</span></span>](#reconciling-embedded-objects)
-   [<span data-ttu-id="c956e-126">Résidus</span><span class="sxs-lookup"><span data-stu-id="c956e-126">Residues</span></span>](#residues)

### <a name="reconciliation"></a><span data-ttu-id="c956e-127">Rapprochement</span><span class="sxs-lookup"><span data-stu-id="c956e-127">Reconciliation</span></span>

<span data-ttu-id="c956e-128">Un document est une collection d’informations qui peuvent être copiées et modifiées.</span><span class="sxs-lookup"><span data-stu-id="c956e-128">A document is a collection of information that can be copied and changed.</span></span> <span data-ttu-id="c956e-129">Un document a des versions différentes si le contenu d’au moins deux copies du document est différent.</span><span class="sxs-lookup"><span data-stu-id="c956e-129">A document has different versions if the contents of at least two copies of the document are different.</span></span> <span data-ttu-id="c956e-130">Le rapprochement produit une seule version d’un document à partir de deux ou de plusieurs versions initiales.</span><span class="sxs-lookup"><span data-stu-id="c956e-130">Reconciliation produces a single version of a document from two or more initial versions.</span></span> <span data-ttu-id="c956e-131">En règle générale, la version conciliée est une combinaison d’informations des versions initiales avec les informations les plus récentes ou les plus utiles préservées.</span><span class="sxs-lookup"><span data-stu-id="c956e-131">Typically, the reconciled version is a combination of information from the initial versions with the most recent or most useful information preserved.</span></span>

<span data-ttu-id="c956e-132">Le rapprochement est initié par le porte-documents lorsqu’il détermine que deux ou plusieurs copies du même document sont différentes.</span><span class="sxs-lookup"><span data-stu-id="c956e-132">Reconciliation is initiated by Briefcase when it determines that two or more copies of the same document are different.</span></span> <span data-ttu-id="c956e-133">Le porte-documents, qui joue le rôle d’initiateur dans ce contexte, localise et démarre le réconciliateur de porte-documents associé au type de document donné.</span><span class="sxs-lookup"><span data-stu-id="c956e-133">Briefcase, which acts as the initiator in this context, locates and starts the briefcase reconciler associated with the given document type.</span></span> <span data-ttu-id="c956e-134">Le réconciliateur compare les documents et détermine les portions de documents à conserver.</span><span class="sxs-lookup"><span data-stu-id="c956e-134">The reconciler compares the documents and determines which portions of the documents to retain.</span></span> <span data-ttu-id="c956e-135">Certains réconcilieurs peuvent nécessiter une interaction de l’utilisateur pour terminer le rapprochement.</span><span class="sxs-lookup"><span data-stu-id="c956e-135">Some reconcilers might require user interaction to complete reconciliation.</span></span> <span data-ttu-id="c956e-136">D’autres peuvent terminer la conciliation sans intervention de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="c956e-136">Others might complete reconciliation without user interaction.</span></span> <span data-ttu-id="c956e-137">Le réconcilieur peut être contenu dans une application ou être une extension implémentée en tant que DLL.</span><span class="sxs-lookup"><span data-stu-id="c956e-137">The reconciler can be contained within an application or be an extension implemented as a DLL.</span></span>

<span data-ttu-id="c956e-138">Certains réconcilieurs de porte-documents peuvent créer des résidus.</span><span class="sxs-lookup"><span data-stu-id="c956e-138">Some briefcase reconcilers might create residues.</span></span> <span data-ttu-id="c956e-139">Un résidu est un document, qui a généralement le même type de fichier que le document initial, qui contient des informations non enregistrées dans la version fusionnée.</span><span class="sxs-lookup"><span data-stu-id="c956e-139">A residue is a document, usually having the same file type as the initial document, that contains information not saved in the merged version.</span></span> <span data-ttu-id="c956e-140">Les résidus sont généralement utilisés pour fournir aux auteurs un moyen rapide de déterminer les informations de leur document d’origine ne se trouvant pas dans la version fusionnée finale.</span><span class="sxs-lookup"><span data-stu-id="c956e-140">Residues are typically used to give authors a quick way to determine what information from their original document is not in the final merged version.</span></span> <span data-ttu-id="c956e-141">Si un réconciliateur prend en charge les résidus, il crée un résidu pour chacune des versions d’origine du document.</span><span class="sxs-lookup"><span data-stu-id="c956e-141">If a reconciler supports residues, it creates one residue for each of the original versions of the document.</span></span> <span data-ttu-id="c956e-142">Les résidus ne sont pas créés, sauf si l’initiateur les demande.</span><span class="sxs-lookup"><span data-stu-id="c956e-142">Residues are not created unless the initiator requests them.</span></span>

<span data-ttu-id="c956e-143">Certaines réconciliations de porte-documents fonctionnent avec le porte-documents pour permettre à l’utilisateur de terminer la conciliation.</span><span class="sxs-lookup"><span data-stu-id="c956e-143">Some briefcase reconcilers work with Briefcase to allow the user to terminate reconciliation.</span></span> <span data-ttu-id="c956e-144">Il s’agit d’une fonctionnalité importante pour un utilisateur qui peut décider que le rapprochement ne doit pas continuer.</span><span class="sxs-lookup"><span data-stu-id="c956e-144">This is an important feature for a user who might decide that the reconciliation should not proceed.</span></span> <span data-ttu-id="c956e-145">Un réconciliateur fournit généralement un objet d’arrêt lorsque le rapprochement requiert une intervention de l’utilisateur et peut être long.</span><span class="sxs-lookup"><span data-stu-id="c956e-145">A reconciler typically provides a termination object when the reconciliation requires user interaction and might be lengthy.</span></span> <span data-ttu-id="c956e-146">Dans certains environnements, un réconciliateur peut autoriser un rapprochement partiel, ce qui permet à un utilisateur d’interrompre temporairement un rapprochement et de le reprendre ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="c956e-146">In some environments, a reconciler might allow partial reconciliation, enabling a user to temporarily suspend a reconciliation and resume it later.</span></span> <span data-ttu-id="c956e-147">Toutefois, le porte-documents ne prend pas en charge actuellement la conciliation partielle.</span><span class="sxs-lookup"><span data-stu-id="c956e-147">Briefcase does not currently support partial reconciliation, however.</span></span>

### <a name="creating-a-briefcase-reconciler"></a><span data-ttu-id="c956e-148">Création d’un réconciliateur de porte-documents</span><span class="sxs-lookup"><span data-stu-id="c956e-148">Creating a Briefcase Reconciler</span></span>

<span data-ttu-id="c956e-149">Vous créez un réconciliateur de porte-documents en implémentant les interfaces de réconciliation.</span><span class="sxs-lookup"><span data-stu-id="c956e-149">You create a briefcase reconciler by implementing the reconciliation interfaces.</span></span> <span data-ttu-id="c956e-150">Au minimum, un réconciliateur implémente l’interface [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) et l’interface [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) ou [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="c956e-150">At a minimum, a reconciler implements the [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) interface and the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) or [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="c956e-151">En tant qu’initiateur, le porte-documents détermine le moment où le rapprochement est nécessaire et appelle la méthode [**IReconcilableObject :: Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) pour initier le rapprochement.</span><span class="sxs-lookup"><span data-stu-id="c956e-151">As the initiator, Briefcase determines when reconciliation is needed and calls the [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) method to initiate reconciliation.</span></span>

<span data-ttu-id="c956e-152">Bien que [**IReconcilableObject :: Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) offre un ensemble vaste de fonctionnalités de rapprochement, un réconciliateur de porte-documents n’effectue qu’une réconciliation minimale dans la plupart des cas.</span><span class="sxs-lookup"><span data-stu-id="c956e-152">Although [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) provides a wide-ranging set of reconciliation capabilities, a briefcase reconciler carries out only minimal reconciliation in most cases.</span></span> <span data-ttu-id="c956e-153">En particulier, le porte-documents ne nécessite pas que le réconciliateur prenne en charge la génération de résidus ou prenne en charge l’objet d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="c956e-153">In particular, Briefcase does not require the reconciler to support residue generation or to support the termination object.</span></span> <span data-ttu-id="c956e-154">En outre, le réconciliateur effectue une seule réconciliation de haut en bas et ne doit pas retourner la \_ valeur Rec E \_ NOTCOMPLETE ; autrement dit, il ne doit pas essayer le rapprochement partiel.</span><span class="sxs-lookup"><span data-stu-id="c956e-154">Also, the reconciler carries out a single top-to-bottom reconciliation and must not return the REC\_E\_NOTCOMPLETE value; that is, it should not attempt partial reconciliation.</span></span>

<span data-ttu-id="c956e-155">Le porte-documents fournit l’interface [**IReconcileInitiator**](ireconcileinitiator.md) .</span><span class="sxs-lookup"><span data-stu-id="c956e-155">Briefcase provides the [**IReconcileInitiator**](ireconcileinitiator.md) interface.</span></span> <span data-ttu-id="c956e-156">Le réconciliateur de porte-documents peut utiliser la méthode [**IReconcileInitiator :: SetAbortCallback**](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback) pour définir l’objet d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="c956e-156">The briefcase reconciler can use the [**IReconcileInitiator::SetAbortCallback**](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback) method to set the termination object.</span></span> <span data-ttu-id="c956e-157">Le porte-documents n’utilise pas les identificateurs de version et ne peut donc pas fournir de versions antérieures d’un document si un réconciliateur les demande à l’aide des méthodes correspondantes dans **IReconcileInitiator**.</span><span class="sxs-lookup"><span data-stu-id="c956e-157">Briefcase does not use version identifiers and cannot, therefore, provide previous versions of a document if a reconciler requests them using the corresponding methods in **IReconcileInitiator**.</span></span>

<span data-ttu-id="c956e-158">Le porte-documents passe à [**IReconcilableObject :: rapprocher**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) les monikers de fichiers représentant les versions du document à rapprocher.</span><span class="sxs-lookup"><span data-stu-id="c956e-158">Briefcase passes to [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) file monikers representing the versions of the document to be reconciled.</span></span> <span data-ttu-id="c956e-159">Le réconciliateur de porte-documents accède à la version à l’aide de la méthode [IMoniker :: BindToObject](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject) ou [IMoniker :: BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) .</span><span class="sxs-lookup"><span data-stu-id="c956e-159">The briefcase reconciler gains access to the versions by using either the [IMoniker::BindToObject](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject) or [IMoniker::BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) method.</span></span> <span data-ttu-id="c956e-160">Ce dernier est généralement plus rapide et recommandé.</span><span class="sxs-lookup"><span data-stu-id="c956e-160">The latter is generally faster and is recommended.</span></span> <span data-ttu-id="c956e-161">Le réconciliateur doit libérer tout objet ou stockage auquel il est lié.</span><span class="sxs-lookup"><span data-stu-id="c956e-161">The reconciler must release any objects or storage to which it binds.</span></span>

<span data-ttu-id="c956e-162">Lorsque le réconciliateur de porte-documents utilise [IMoniker :: BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage), il se lie au stockage plat (un flux) ou à un stockage structuré OLE.</span><span class="sxs-lookup"><span data-stu-id="c956e-162">When the briefcase reconciler uses [IMoniker::BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage), it binds to storage that is either flat storage (a stream) or OLE-defined structured storage.</span></span> <span data-ttu-id="c956e-163">Si le réconciliateur attend un stockage plat, il doit utiliser IMoniker :: BindToStorage pour demander l’interface [IStream](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="c956e-163">If the reconciler expects flat storage, it should use IMoniker::BindToStorage to request the [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="c956e-164">Si le réconciliateur attend un stockage structuré, il doit demander l’interface [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="c956e-164">If the reconciler expects structured storage, it should request the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="c956e-165">Dans les deux cas, il doit demander un accès direct en lecture seule (non-Transact) au stockage. l’accès en lecture/écriture n’est peut-être pas disponible.</span><span class="sxs-lookup"><span data-stu-id="c956e-165">In both cases, it should request read-only direct (nontransacted) access to the storage; read/write access might not be available.</span></span>

<span data-ttu-id="c956e-166">Un réconciliateur de porte-documents minimal examine généralement directement le stockage des autres versions et traite les objets incorporés de manière très primitive, tels que la fusion de deux versions de l’objet en incluant les deux versions dans la version de sortie.</span><span class="sxs-lookup"><span data-stu-id="c956e-166">A minimal briefcase reconciler typically looks directly at the storage of the other versions and deals with embedded objects in a very primitive manner, such as merging two versions of the object by including both versions in the output version.</span></span>

<span data-ttu-id="c956e-167">L’initiateur localise le réconciliateur de porte-documents approprié en utilisant un sous-ensemble de la logique implémentée par la fonction [GetClassFile](/windows/win32/api/objbase/nf-objbase-getclassfile) pour déterminer le type d’un fichier donné, puis recherche dans le registre la classe de réconciliateur associée au type de fichier donné.</span><span class="sxs-lookup"><span data-stu-id="c956e-167">The initiator locates the appropriate briefcase reconciler by using a subset of the logic implemented by the [GetClassFile](/windows/win32/api/objbase/nf-objbase-getclassfile) function to determine the type of a given file and then looks in the registry for the reconciler class associated with the given file type.</span></span> <span data-ttu-id="c956e-168">Le porte-documents, comme les autres composants de Shell, détermine le type d’un fichier uniquement par l’extension de nom de fichier.</span><span class="sxs-lookup"><span data-stu-id="c956e-168">Briefcase, like other Shell components, determines the type of a file solely by the file name extension.</span></span> <span data-ttu-id="c956e-169">L’extension d’un fichier doit avoir un type de fichier inscrit pour que le porte-documents appelle un réconciliateur pour le fichier.</span><span class="sxs-lookup"><span data-stu-id="c956e-169">A file's extension must have a registered file type for Briefcase to invoke a reconciler for the file.</span></span> <span data-ttu-id="c956e-170">Vous devez définir une entrée de Registre au format suivant lors de l’installation de votre réconciliateur.</span><span class="sxs-lookup"><span data-stu-id="c956e-170">You must set a registry entry of the following form when installing your reconciler.</span></span>

```
CLSID
   {the file CLSID}
      Roles
         Reconciler
            (Default) = {the reconciler-classid}
```

<span data-ttu-id="c956e-171">La classe doit être à chargement rapide, doit être désignée \_ MULTIPLEUSE et, à moins que des marshaleurs ne soient fournis pour l’interface de réconciliation, doive être un serveur in-process (contenu dans une dll) plutôt qu’un serveur local (implémenté dans un fichier. exe).</span><span class="sxs-lookup"><span data-stu-id="c956e-171">The class must be quick loading, must be designated \_MULTIPLEUSE, and, unless marshalers are provided for the reconciliation interface, must be an in-process server (contained in a DLL) rather than a local server (implemented in an .exe file).</span></span>

### <a name="user-interaction-in-reconciliation"></a><span data-ttu-id="c956e-172">Interaction de l’utilisateur dans le rapprochement</span><span class="sxs-lookup"><span data-stu-id="c956e-172">User Interaction in Reconciliation</span></span>

<span data-ttu-id="c956e-173">Un réconciliateur de porte-documents doit tenter d’effectuer une réconciliation sans intervention de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="c956e-173">A briefcase reconciler should attempt to carry out reconciliation without user interaction.</span></span> <span data-ttu-id="c956e-174">Plus la réconciliation est automatisée, plus la perception de l’utilisateur du processus est bonne.</span><span class="sxs-lookup"><span data-stu-id="c956e-174">The more automated the reconciliation, the better the user's perception of the process.</span></span>

<span data-ttu-id="c956e-175">Dans certains cas, l’intervention de l’utilisateur peut être utile.</span><span class="sxs-lookup"><span data-stu-id="c956e-175">In some cases, user intervention can be valuable.</span></span> <span data-ttu-id="c956e-176">Par exemple, un système de documents peut demander à un utilisateur de réviser les modifications avant d’accepter la version fusionnée d’un document ou peut nécessiter des commentaires de la part de l’utilisateur expliquant les modifications apportées.</span><span class="sxs-lookup"><span data-stu-id="c956e-176">For example, a document system might require a user to review changes before accepting the merged version of a document or might require comments from the user explaining the changes that have been made.</span></span> <span data-ttu-id="c956e-177">Dans ce cas, l’initiateur, et non le réconciliateur de porte-documents, est responsable de l’interrogation de l’utilisateur et de l’exécution des instructions de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="c956e-177">In these cases, the initiator, not the briefcase reconciler, is responsible for querying the user and carrying out the user's instructions.</span></span>

<span data-ttu-id="c956e-178">Dans d’autres cas, l’intervention de l’utilisateur peut s’avérer nécessaire, par exemple, lorsque deux versions ont été modifiées de manière incompatible.</span><span class="sxs-lookup"><span data-stu-id="c956e-178">In other cases, user intervention might be necessary—for example, when two versions have been edited in incompatible ways.</span></span> <span data-ttu-id="c956e-179">Dans ce cas, l’initiateur ou le réconciliateur de porte-documents doit interroger l’utilisateur pour obtenir des instructions sur la façon de résoudre le conflit.</span><span class="sxs-lookup"><span data-stu-id="c956e-179">In such cases, either the initiator or briefcase reconciler must query the user for instructions on how to resolve the conflict.</span></span> <span data-ttu-id="c956e-180">En général, aucun initiateur ne peut s’appuyer sur l’exécution d’un rapprochement sans attendre une interaction de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="c956e-180">In general, no initiator can rely on completing a reconciliation without expecting some user interaction.</span></span> <span data-ttu-id="c956e-181">En revanche, les réconcilieurs ont la possibilité d’interagir avec l’utilisateur pour résoudre les conflits ou demander à l’initiateur de le faire.</span><span class="sxs-lookup"><span data-stu-id="c956e-181">Reconcilers, on the other hand, have the option of interacting with the user to resolve conflicts or requiring the initiator to do so.</span></span>

### <a name="reconciling-embedded-objects"></a><span data-ttu-id="c956e-182">Rapprochement des objets incorporés</span><span class="sxs-lookup"><span data-stu-id="c956e-182">Reconciling Embedded Objects</span></span>

<span data-ttu-id="c956e-183">Lors du rapprochement d’un document, le réconciliateur de porte-documents peut devenir un initiateur s’il découvre un objet incorporé d’un type qu’il ne peut pas rapprocher.</span><span class="sxs-lookup"><span data-stu-id="c956e-183">When reconciling a document, the briefcase reconciler itself can become an initiator if it discovers an embedded object of a type that it cannot reconcile.</span></span> <span data-ttu-id="c956e-184">Dans ce cas, le réconciliateur doit réconcilier de manière récursive chacun des objets incorporés et assumer toutes les responsabilités d’un initiateur.</span><span class="sxs-lookup"><span data-stu-id="c956e-184">In this case, the reconciler needs to recursively reconcile each of the embedded objects and assume all the responsibilities of an initiator.</span></span>

<span data-ttu-id="c956e-185">Pour effectuer la récursivité, le réconciliateur de porte-documents charge l’objet et les requêtes pour l’interface appropriée.</span><span class="sxs-lookup"><span data-stu-id="c956e-185">To carry out the recursion, the briefcase reconciler loads the object and queries for the appropriate interface.</span></span> <span data-ttu-id="c956e-186">Le gestionnaire de l’objet doit prendre en charge l’interface.</span><span class="sxs-lookup"><span data-stu-id="c956e-186">The handler for the object must support the interface.</span></span> <span data-ttu-id="c956e-187">Si une méthode de l’interface retourne la \_ valeur OLE E \_ NOTRUNNING, le réconciliateur doit exécuter l’objet afin d’effectuer l’opération.</span><span class="sxs-lookup"><span data-stu-id="c956e-187">If any method of the interface returns the OLE\_E\_NOTRUNNING value, the reconciler must run the object in order to carry out the operation.</span></span> <span data-ttu-id="c956e-188">Étant donné que le code des objets incorporés n’est pas toujours disponible, un réconciliateur doit fournir une solution pour cette condition.</span><span class="sxs-lookup"><span data-stu-id="c956e-188">Because code for embedded objects is not always available, a reconciler must provide a solution for this condition.</span></span> <span data-ttu-id="c956e-189">Par exemple, le réconciliateur peut inclure à la fois les anciennes et les nouvelles versions de l’objet incorporé dans la version conciliée.</span><span class="sxs-lookup"><span data-stu-id="c956e-189">For example, the reconciler might include both old and new versions of the embedded object in the reconciled version.</span></span> <span data-ttu-id="c956e-190">Le réconciliateur ne doit pas tenter d’effectuer un rapprochement entre les liens.</span><span class="sxs-lookup"><span data-stu-id="c956e-190">The reconciler must not attempt to reconcile across links.</span></span>

<span data-ttu-id="c956e-191">L’initiateur stocke les versions de documents en cours de fusion.</span><span class="sxs-lookup"><span data-stu-id="c956e-191">The initiator stores the document versions being merged.</span></span> <span data-ttu-id="c956e-192">Dans de nombreux cas, l’initiateur a accès au stockage de chaque version et enregistre le résultat de la réconciliation à l’aide d’un stockage similaire.</span><span class="sxs-lookup"><span data-stu-id="c956e-192">In many cases, the initiator has access to the storage of each version and saves the result of reconciliation using similar storage.</span></span> <span data-ttu-id="c956e-193">Toutefois, l’initiateur peut parfois avoir un objet en mémoire pour lequel aucune version persistante n’est disponible.</span><span class="sxs-lookup"><span data-stu-id="c956e-193">Sometimes, however, the initiator might have an in-memory object for which no persistent version is available.</span></span> <span data-ttu-id="c956e-194">Cette situation peut se produire lorsqu’un document contenant des objets incorporés ouverts doit être concilié avant d’être enregistré.</span><span class="sxs-lookup"><span data-stu-id="c956e-194">This situation can occur when a document containing open embedded objects must be reconciled before being saved.</span></span> <span data-ttu-id="c956e-195">Dans ce cas, l’initiateur enregistre le résultat du rapprochement dans la version trouvée dans la mémoire.</span><span class="sxs-lookup"><span data-stu-id="c956e-195">In such cases, the initiator saves the result of the reconciliation in the version found in memory.</span></span>

<span data-ttu-id="c956e-196">L’initiateur utilise l’interface [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) pour lier (charger) la version fusionnée.</span><span class="sxs-lookup"><span data-stu-id="c956e-196">The initiator uses the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) interface to bind (load) the merged version.</span></span> <span data-ttu-id="c956e-197">L’initiateur utilise la méthode [IPersistStorage :: Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) si une version initiale a déjà été créée et utilise la méthode [IPersistStorage :: InitNew](/windows/win32/api/objidl/nf-objidl-ipersiststorage-initnew) pour la version initiale.</span><span class="sxs-lookup"><span data-stu-id="c956e-197">The initiator uses the [IPersistStorage::Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) method if an initial version has already been created and uses the [IPersistStorage::InitNew](/windows/win32/api/objidl/nf-objidl-ipersiststorage-initnew) method for the initial version.</span></span> <span data-ttu-id="c956e-198">Lorsque la version fusionnée est chargée, l’initiateur utilise [QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) pour récupérer l’adresse de l’interface [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) .</span><span class="sxs-lookup"><span data-stu-id="c956e-198">When the merged version is loaded, the initiator uses [QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) to retrieve the address of the [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) interface.</span></span> <span data-ttu-id="c956e-199">Cette interface donne à l’initiateur l’accès au stockage des résidus existants et lui donne la possibilité de créer un stockage pour les nouveaux résidus.</span><span class="sxs-lookup"><span data-stu-id="c956e-199">This interface gives the initiator access to the storage of the existing residues and gives it a way to create storage for any new residues.</span></span> <span data-ttu-id="c956e-200">L’initiateur dirige ensuite l’interface pour effectuer la réconciliation.</span><span class="sxs-lookup"><span data-stu-id="c956e-200">Then the initiator directs the interface to carry out the reconciliation.</span></span> <span data-ttu-id="c956e-201">En fait, l’initiateur interroge l’interface [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) avant IPersistStorage.</span><span class="sxs-lookup"><span data-stu-id="c956e-201">The initiator actually queries for the [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface before IPersistStorage.</span></span> <span data-ttu-id="c956e-202">Si le réconciliateur prend en charge IPersistFile, l’initiateur manipule le réplica via IPersistFile plutôt que les méthodes IPersistStorage.</span><span class="sxs-lookup"><span data-stu-id="c956e-202">If the reconciler supports IPersistFile, the initiator manipulates the replica through the IPersistFile rather than the IPersistStorage methods.</span></span> <span data-ttu-id="c956e-203">Cela permet de réconcilier les fichiers qui ne sont pas stockés en tant que documents composés.</span><span class="sxs-lookup"><span data-stu-id="c956e-203">This permits reconciliation of files that are not stored as compound documents.</span></span>

<span data-ttu-id="c956e-204">Une fois le rapprochement terminé, l’initiateur peut enregistrer la version fusionnée à l’aide de l’interface [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) ou [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="c956e-204">When the reconciliation is complete, the initiator can save the merged version by using the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) or [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="c956e-205">Lors du rapprochement, le réconciliateur de porte-documents crée des résidus en fonction des besoins et écrit leurs bits persistants dans le stockage.</span><span class="sxs-lookup"><span data-stu-id="c956e-205">During reconciliation, the briefcase reconciler creates residues as needed and writes their persistent bits to storage.</span></span> <span data-ttu-id="c956e-206">Si la version fusionnée est un flux, l’interface [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) transmise à [IPersistStorage :: Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) contient un flux nommé « contents » dont l’état de stockage est défini sur STATEBITS \_ Flat.</span><span class="sxs-lookup"><span data-stu-id="c956e-206">If the merged version is a stream, the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface passed to [IPersistStorage::Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) contains a stream named "Contents" with its storage state set to STATEBITS\_FLAT.</span></span> <span data-ttu-id="c956e-207">(Vous pouvez définir les bits d’État à l’aide de la méthode [IStorage :: stat](/windows/win32/api/objidl/nf-objidl-istorage-stat) .) Après la fusion, l’initiateur enregistre la version fusionnée en écrivant les données de manière appropriée.</span><span class="sxs-lookup"><span data-stu-id="c956e-207">(You can set the state bits by using the [IStorage::Stat](/windows/win32/api/objidl/nf-objidl-istorage-stat) method.) After the merge, the initiator saves the merged version by writing the data in an appropriate manner.</span></span> <span data-ttu-id="c956e-208">Il doit s’assurer que STATEBITS \_ Flat est défini comme approprié pour le stockage.</span><span class="sxs-lookup"><span data-stu-id="c956e-208">It should ensure that STATEBITS\_FLAT is set as appropriate for the storage.</span></span>

### <a name="residues"></a><span data-ttu-id="c956e-209">Résidus</span><span class="sxs-lookup"><span data-stu-id="c956e-209">Residues</span></span>

<span data-ttu-id="c956e-210">L’initiateur indique s’il souhaite obtenir des résidus en définissant le paramètre *pstgNewResidues* sur une adresse valide lors de l’appel de la méthode [**IReconcilableObject :: réconcili**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) .</span><span class="sxs-lookup"><span data-stu-id="c956e-210">The initiator indicates whether it wants residues by setting the *pstgNewResidues* parameter to a valid address when calling the [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) method.</span></span> <span data-ttu-id="c956e-211">Si le réconciliateur ne prend pas en charge la création de résidus, il doit retourner immédiatement la \_ valeur Rec E \_ noresidus, sauf si le paramètre *dwFlags* spécifie la valeur **\_ NORESIDUESOK RECONCILEF** .</span><span class="sxs-lookup"><span data-stu-id="c956e-211">If the reconciler does not support the creation of residues, it must return immediately the REC\_E\_NORESIDUES value, unless the *dwFlags* parameter specifies the **RECONCILEF\_NORESIDUESOK** value.</span></span>

<span data-ttu-id="c956e-212">Le réconciliateur de porte-documents retourne les résidus à l’initiateur en créant de nouveaux éléments de stockage et en les copiant dans le tableau pointé par *pstgNewResidues*.</span><span class="sxs-lookup"><span data-stu-id="c956e-212">The briefcase reconciler returns residues to the initiator by creating new storage elements and copying them to the array pointed to by *pstgNewResidues*.</span></span> <span data-ttu-id="c956e-213">Pour les résidus de stockage structuré, le réconciliateur copie une interface [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) et, pour les résidus de stockage plat, il copie une interface [IStream](/windows/win32/api/objidl/nn-objidl-istream) ou IStorage avec l' \_ indicateur plat STATEBITS défini.</span><span class="sxs-lookup"><span data-stu-id="c956e-213">For structured storage residues, the reconciler copies an [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface, and for flat storage residues, it copies either an [IStream](/windows/win32/api/objidl/nn-objidl-istream) or an IStorage interface with the STATEBITS\_FLAT flag set.</span></span> <span data-ttu-id="c956e-214">Le réconciliateur utilise IStorage pour créer le stockage nécessaire, en utilisant [IStorage :: CreateStream,](/windows/win32/api/objidl/nf-objidl-istorage-createstream) pour créer un stockage plat pour un résidu qui est un flux et [IStorage :: CreateStorage](/windows/win32/api/objidl/nf-objidl-istorage-createstorage) pour créer un stockage structuré.</span><span class="sxs-lookup"><span data-stu-id="c956e-214">The reconciler uses IStorage to create the necessary storage, using [IStorage::CreateStream](/windows/win32/api/objidl/nf-objidl-istorage-createstream) to create flat storage for a residue that is a stream and [IStorage::CreateStorage](/windows/win32/api/objidl/nf-objidl-istorage-createstorage) to create structured storage.</span></span>

<span data-ttu-id="c956e-215">L’initiateur prépare *pstgNewResidues* afin qu’il ne contienne aucun élément dans la partie non réservée de l’espace de noms [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="c956e-215">The initiator prepares *pstgNewResidues* so that it contains no elements in the nonreserved part of the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) namespace.</span></span> <span data-ttu-id="c956e-216">Le réconciliateur de porte-documents place chaque résidu dans un élément dont le nom correspond à l’ordre de sa version initiale.</span><span class="sxs-lookup"><span data-stu-id="c956e-216">The briefcase reconciler places each residue in an element whose name corresponds to the order of its initial version.</span></span> <span data-ttu-id="c956e-217">Par exemple, le premier résidu est contenu dans « 1 », le deuxième dans « 2 », et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="c956e-217">For example, the first residue is contained in "1", the second in "2", and so on.</span></span> <span data-ttu-id="c956e-218">Si l’objet concilié lui-même produit un résidu, il se trouve dans l’élément nommé « 0 ».</span><span class="sxs-lookup"><span data-stu-id="c956e-218">If the reconciled object itself produces a residue, it is found in the element named "0".</span></span>

<span data-ttu-id="c956e-219">Le réconciliateur de porte-documents valide chacun des éléments nouvellement créés individuellement, en veillant à ce que l’initiateur ait accès aux informations.</span><span class="sxs-lookup"><span data-stu-id="c956e-219">The briefcase reconciler commits each of the newly created elements individually, ensuring that the initiator has access to the information.</span></span> <span data-ttu-id="c956e-220">Toutefois, le réconciliateur ne valide pas *pstgNewResidues* .</span><span class="sxs-lookup"><span data-stu-id="c956e-220">The reconciler does not, however, commit *pstgNewResidues* itself.</span></span> <span data-ttu-id="c956e-221">L’initiateur est chargé de la valider ou de le supprimer.</span><span class="sxs-lookup"><span data-stu-id="c956e-221">The initiator is responsible for committing this or otherwise disposing of it.</span></span>

## <a name="briefcase-reconciler-reference"></a><span data-ttu-id="c956e-222">Référence du réconciliateur de porte-documents</span><span class="sxs-lookup"><span data-stu-id="c956e-222">Briefcase Reconciler Reference</span></span>

<span data-ttu-id="c956e-223">Cette section contient des informations sur les interfaces de réconciliation.</span><span class="sxs-lookup"><span data-stu-id="c956e-223">This section contains information about the reconciliation interfaces.</span></span> <span data-ttu-id="c956e-224">Lors de la gestion des erreurs, une méthode peut retourner uniquement les valeurs d’erreur qui sont explicitement définies comme valeurs de retour possibles.</span><span class="sxs-lookup"><span data-stu-id="c956e-224">When handling errors, a method can return only those error values that are explicitly defined as possible return values.</span></span> <span data-ttu-id="c956e-225">En outre, la méthode doit définir toutes les variables dont les adresses sont passées en tant que paramètres à la **valeur null** avant de retourner l’erreur.</span><span class="sxs-lookup"><span data-stu-id="c956e-225">Furthermore, the method must set all variables whose addresses are passed as parameters to **NULL** before returning from the error.</span></span>

### <a name="briefcase-reconciler-interfaces-and-methods"></a><span data-ttu-id="c956e-226">Méthodes et interfaces du réconciliateur de porte-documents</span><span class="sxs-lookup"><span data-stu-id="c956e-226">Briefcase Reconciler Interfaces and Methods</span></span>

-   [<span data-ttu-id="c956e-227">**IReconcilableObject**</span><span class="sxs-lookup"><span data-stu-id="c956e-227">**IReconcilableObject**</span></span>](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) 
    -   -   [<span data-ttu-id="c956e-228">**IReconcilableObject::GetProgressFeedbackMaxEstimate**</span><span class="sxs-lookup"><span data-stu-id="c956e-228">**IReconcilableObject::GetProgressFeedbackMaxEstimate**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-getprogressfeedbackmaxestimate)
        -   [<span data-ttu-id="c956e-229">**IReconcilableObject :: rapprocher**</span><span class="sxs-lookup"><span data-stu-id="c956e-229">**IReconcilableObject::Reconcile**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile)

-   [<span data-ttu-id="c956e-230">**IReconcileInitiator**</span><span class="sxs-lookup"><span data-stu-id="c956e-230">**IReconcileInitiator**</span></span>](ireconcileinitiator.md) 
    -   -   [<span data-ttu-id="c956e-231">**IReconcileInitiator::SetAbortCallback**</span><span class="sxs-lookup"><span data-stu-id="c956e-231">**IReconcileInitiator::SetAbortCallback**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback)
        -   [<span data-ttu-id="c956e-232">**IReconcileInitiator::SetProgressFeedback**</span><span class="sxs-lookup"><span data-stu-id="c956e-232">**IReconcileInitiator::SetProgressFeedback**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setprogressfeedback)

-   [<span data-ttu-id="c956e-233">**INotifyReplica**</span><span class="sxs-lookup"><span data-stu-id="c956e-233">**INotifyReplica**</span></span>](/windows/desktop/api/reconcil/nn-reconcil-inotifyreplica) 
    -   -   [<span data-ttu-id="c956e-234">**INotifyReplica::YouAreAReplica**</span><span class="sxs-lookup"><span data-stu-id="c956e-234">**INotifyReplica::YouAreAReplica**</span></span>](/windows/desktop/api/reconcil/nf-reconcil-inotifyreplica-youareareplica)

 

 