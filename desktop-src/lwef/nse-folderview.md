---
title: Implémentation d’un affichage des dossiers
description: Le shell Windows fournit une implémentation par défaut de l’affichage des dossiers, connu sous le nom de DefView, ce qui vous permet d’éviter une grande partie du travail d’implémentation de votre propre extension d’espace de noms.
ms.assetid: 8c6712d8-c3cb-4450-8277-3a8675622651
keywords:
- objet de l’affichage des dossiers
- IShellView
- IShellBrowser, objets de vue de dossier
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 48c7b86d587154a034f276d4bdab903e5337ed4b
ms.sourcegitcommit: 469b6de41e2a565b7ead231d7f282ec4071ac158
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/11/2020
ms.locfileid: "104383152"
---
# <a name="implementing-a-folder-view"></a><span data-ttu-id="11392-106">Implémentation d’un affichage des dossiers</span><span class="sxs-lookup"><span data-stu-id="11392-106">Implementing a Folder View</span></span>

<span data-ttu-id="11392-107">Le shell Windows fournit une implémentation par défaut de l’affichage des dossiers, connu sous le nom de DefView, ce qui vous permet d’éviter une grande partie du travail d’implémentation de votre propre extension d’espace de noms.</span><span class="sxs-lookup"><span data-stu-id="11392-107">Windows Shell provides a default implementation of the folder view, colloquially known as DefView, so that you can avoid much of the work of implementing your own namespace extension.</span></span> <span data-ttu-id="11392-108">Étant donné que certaines fonctionnalités de vue ne peuvent pas être obtenues par le biais de vues personnalisées, il est souvent recommandé d’utiliser l’objet de vue de dossier système par défaut à la place d’une vue personnalisée.</span><span class="sxs-lookup"><span data-stu-id="11392-108">Because some view features cannot be achieved through custom views, it is often recommended that the default system folder view object is used in place of a custom view.</span></span> <span data-ttu-id="11392-109">Pour plus d’informations, consultez [**SHCreateShellFolderView**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreateshellfolderview).</span><span class="sxs-lookup"><span data-stu-id="11392-109">For more information, see [**SHCreateShellFolderView**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreateshellfolderview).</span></span> <span data-ttu-id="11392-110">Le reste de cette rubrique traite de l’implémentation d’une vue de dossier personnalisée qui ne prend pas en charge les fonctionnalités d’affichage plus récentes.</span><span class="sxs-lookup"><span data-stu-id="11392-110">The remainder of this topic discusses implementing a custom folder view that cannot support newer view features.</span></span>

<span data-ttu-id="11392-111">Contrairement à l’arborescence, l’Explorateur Windows ne gère pas le contenu d’une vue de dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-111">Unlike the tree view, Windows Explorer does not manage the contents of a folder view.</span></span> <span data-ttu-id="11392-112">Au lieu de cela, la fenêtre d’affichage des dossiers héberge une fenêtre enfant qui est fournie par l’objet dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-112">Instead, the folder view window hosts a child window that is provided by the folder object.</span></span> <span data-ttu-id="11392-113">L’objet Folder est chargé de créer un objet d’affichage des dossiers pour afficher le contenu du dossier dans la fenêtre enfant.</span><span class="sxs-lookup"><span data-stu-id="11392-113">The folder object is responsible for creating a folder view object to display the folder's contents in the child window.</span></span>

<span data-ttu-id="11392-114">La clé de l’implémentation d’un objet de vue de dossier est l’interface [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="11392-114">The key to implementing a folder view object is the [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="11392-115">Cette interface est utilisée par l’Explorateur Windows pour communiquer avec l’objet de vue de dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-115">This interface is used by Windows Explorer to communicate with the folder view object.</span></span> <span data-ttu-id="11392-116">Avant d’afficher un affichage des dossiers, l’Explorateur Windows appelle la méthode [**IShellFolder :: CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) de l’objet Folder avec *riid* défini sur IID \_ IShellView.</span><span class="sxs-lookup"><span data-stu-id="11392-116">Before displaying a folder view, Windows Explorer calls the folder object's [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) method with *riid* set to IID\_IShellView.</span></span> <span data-ttu-id="11392-117">Créez un objet de vue de dossier et retournez son interface **IShellView** .</span><span class="sxs-lookup"><span data-stu-id="11392-117">Create a folder view object and return its **IShellView** interface.</span></span> <span data-ttu-id="11392-118">L’objet de vue de dossier doit ensuite créer une fenêtre enfant de la fenêtre d’affichage des dossiers et utiliser la fenêtre enfant pour afficher des informations sur le contenu du dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-118">The folder view object must then create a child window of the folder view window and use the child window to display information about the folder's contents.</span></span>

<span data-ttu-id="11392-119">Outre le contrôle de l’affichage des données, les extensions peuvent également personnaliser un certain nombre de fonctionnalités de l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-119">In addition to controlling how data is displayed, extensions can also customize a number of the features of Windows Explorer.</span></span> <span data-ttu-id="11392-120">Par exemple, une extension peut ajouter des éléments à la barre d’outils ou à la barre de menus, ou afficher des informations sur la barre d’État.</span><span class="sxs-lookup"><span data-stu-id="11392-120">For instance, an extension can add items to the toolbar or menu bar, or display information on the status bar.</span></span>

-   [<span data-ttu-id="11392-121">Objet de l’affichage des dossiers</span><span class="sxs-lookup"><span data-stu-id="11392-121">The Folder View Object</span></span>](#the-folder-view-object)
-   [<span data-ttu-id="11392-122">Initialisation de l’objet de vue de dossier</span><span class="sxs-lookup"><span data-stu-id="11392-122">Initializing the Folder View Object</span></span>](#initializing-the-folder-view-object)
-   [<span data-ttu-id="11392-123">Affichage de l’affichage des dossiers</span><span class="sxs-lookup"><span data-stu-id="11392-123">Displaying the Folder View</span></span>](#displaying-the-folder-view)
-   [<span data-ttu-id="11392-124">Implémentation de IShellView</span><span class="sxs-lookup"><span data-stu-id="11392-124">Implementing IShellView</span></span>](#implementing-ishellview)
    -   [<span data-ttu-id="11392-125">AddPropertySheetPages</span><span class="sxs-lookup"><span data-stu-id="11392-125">AddPropertySheetPages</span></span>](#addpropertysheetpages)
    -   [<span data-ttu-id="11392-126">GetCurrentInfo</span><span class="sxs-lookup"><span data-stu-id="11392-126">GetCurrentInfo</span></span>](#getcurrentinfo)
    -   [<span data-ttu-id="11392-127">Actualiser</span><span class="sxs-lookup"><span data-stu-id="11392-127">Refresh</span></span>](#refresh)
    -   [<span data-ttu-id="11392-128">SaveViewState</span><span class="sxs-lookup"><span data-stu-id="11392-128">SaveViewState</span></span>](#saveviewstate)
    -   [<span data-ttu-id="11392-129">TranslateAcelerator</span><span class="sxs-lookup"><span data-stu-id="11392-129">TranslateAcelerator</span></span>](#translateacelerator)
-   [<span data-ttu-id="11392-130">Utilisation de IShellBrowser pour communiquer avec l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-130">Using IShellBrowser to Communicate with Windows Explorer</span></span>](#using-ishellbrowser-to-communicate-with-windows-explorer)
    -   [<span data-ttu-id="11392-131">Modification de la barre de menus de l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-131">Modifying the Windows Explorer Menu Bar</span></span>](#modifying-the-windows-explorer-menu-bar)
    -   [<span data-ttu-id="11392-132">Modification de la barre d’outils de l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-132">Modifying the Windows Explorer Toolbar</span></span>](#modifying-the-windows-explorer-toolbar)
    -   [<span data-ttu-id="11392-133">Modification de la barre d’état de l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-133">Modifying the Windows Explorer Status Bar</span></span>](#modifying-the-windows-explorer-status-bar)
    -   [<span data-ttu-id="11392-134">Stockage des informations spécifiques à la vue</span><span class="sxs-lookup"><span data-stu-id="11392-134">Storing View-specific Information</span></span>](#storing-view-specific-information)

## <a name="the-folder-view-object"></a><span data-ttu-id="11392-135">Objet de l’affichage des dossiers</span><span class="sxs-lookup"><span data-stu-id="11392-135">The Folder View Object</span></span>

<span data-ttu-id="11392-136">Un objet de vue de dossier est un objet COM (Component Object Model) qui expose une interface [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="11392-136">A folder view object is a Component Object Model (COM) object that exposes an [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="11392-137">Cet objet est chargé des opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="11392-137">This object is responsible for:</span></span>

-   <span data-ttu-id="11392-138">Création d’une fenêtre enfant de la fenêtre d’affichage des dossiers et utilisation de celle-ci pour afficher le contenu du dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-138">Creating a child window of the folder view window and using it to display the contents of the folder.</span></span>
-   <span data-ttu-id="11392-139">Gestion de la communication avec l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-139">Handling communication with Windows Explorer.</span></span>
-   <span data-ttu-id="11392-140">Ajout de commandes spécifiques aux dossiers à la barre de menus et à la barre d’outils de l’Explorateur Windows et gestion de ces commandes lorsqu’elles sont sélectionnées.</span><span class="sxs-lookup"><span data-stu-id="11392-140">Adding folder-specific commands to the Windows Explorer menu bar and toolbar and handling those commands when they are selected.</span></span>
-   <span data-ttu-id="11392-141">Gestion de l’interaction de l’utilisateur à l’aide de la fenêtre d’affichage des dossiers, telle que l’affichage des menus contextuels ou la gestion des opérations de glisser-déplacer.</span><span class="sxs-lookup"><span data-stu-id="11392-141">Managing user interaction with the folder view window, such as displaying shortcut menus or handling drag-and-drop operations.</span></span>

<span data-ttu-id="11392-142">Ce document traite des trois premières rubriques.</span><span class="sxs-lookup"><span data-stu-id="11392-142">This document discusses the first three topics.</span></span> <span data-ttu-id="11392-143">Étant donné que l’interaction de l’utilisateur avec l’affichage des dossiers s’effectue dans votre fenêtre enfant, votre objet de vue de dossier est chargé de le gérer comme n’importe quelle autre fenêtre.</span><span class="sxs-lookup"><span data-stu-id="11392-143">Because user interaction with the folder view takes place within your child window, your folder view object is responsible for handling it as it would for any other window.</span></span>

<span data-ttu-id="11392-144">L’Explorateur Windows demande un objet de vue de dossier en appelant le [**IShellFolder :: CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) de l’objet Folder avec *riid* défini sur IID \_ IShellView.</span><span class="sxs-lookup"><span data-stu-id="11392-144">Windows Explorer requests a folder view object by calling your folder object's [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) with *riid* set to IID\_IShellView.</span></span> <span data-ttu-id="11392-145">La procédure de création d’un affichage des dossiers est la suivante :</span><span class="sxs-lookup"><span data-stu-id="11392-145">The procedure for creating a folder view is:</span></span>

1.  <span data-ttu-id="11392-146">Votre objet Folder crée une nouvelle instance de votre objet de vue de dossier et retourne un pointeur vers son interface [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="11392-146">Your folder object creates a new instance of your folder view object and returns a pointer to its [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span>
2.  <span data-ttu-id="11392-147">L’Explorateur Windows initialise l’objet d’affichage des dossiers en appelant la méthode [**IShellView :: CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) .</span><span class="sxs-lookup"><span data-stu-id="11392-147">Windows Explorer initializes the folder view object by calling the [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method.</span></span> <span data-ttu-id="11392-148">Crée une fenêtre enfant de la fenêtre d’affichage des dossiers et retourne son handle à l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-148">Create a child window of the folder view window and return its handle to Windows Explorer.</span></span>
3.  <span data-ttu-id="11392-149">L’objet d’affichage des dossiers utilise l’interface [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) de l’Explorateur Windows pour personnaliser la barre d’outils de l’Explorateur Windows, la barre de menus et la barre d’État.</span><span class="sxs-lookup"><span data-stu-id="11392-149">The folder view object uses the Windows Explorer [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface to customize the Windows Explorer toolbar, menu bar, and status bar.</span></span>
4.  <span data-ttu-id="11392-150">L’objet d’affichage des dossiers affiche le contenu du dossier dans la fenêtre enfant.</span><span class="sxs-lookup"><span data-stu-id="11392-150">The folder view object displays the contents of the folder in the child window.</span></span>
5.  <span data-ttu-id="11392-151">L’objet d’affichage des dossiers gère l’interaction de l’utilisateur avec l’affichage des dossiers et les éléments de barre de menus ou de barre d’outils spécifiques aux dossiers.</span><span class="sxs-lookup"><span data-stu-id="11392-151">The folder view object handles user interaction with the folder view and any folder-specific toolbar or menu bar items.</span></span>

## <a name="initializing-the-folder-view-object"></a><span data-ttu-id="11392-152">Initialisation de l’objet de vue de dossier</span><span class="sxs-lookup"><span data-stu-id="11392-152">Initializing the Folder View Object</span></span>

<span data-ttu-id="11392-153">L’Explorateur Windows initialise l’objet d’affichage des dossiers en appelant la méthode [**IShellView :: CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) .</span><span class="sxs-lookup"><span data-stu-id="11392-153">Windows Explorer initializes the folder view object by calling the [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method.</span></span> <span data-ttu-id="11392-154">Les paramètres de la méthode fournissent à l’objet de vue de dossier les informations dont il a besoin pour créer la fenêtre enfant qui sera utilisée pour afficher le contenu du dossier :</span><span class="sxs-lookup"><span data-stu-id="11392-154">The method's parameters provide the folder view object with the information it needs to create the child window that will be used to display the folder's contents:</span></span>

-   <span data-ttu-id="11392-155">Pointeur vers l’interface [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) de l’objet d’affichage du dossier précédent.</span><span class="sxs-lookup"><span data-stu-id="11392-155">A pointer to the previous folder view object's [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="11392-156">Ce paramètre peut avoir la valeur **null**.</span><span class="sxs-lookup"><span data-stu-id="11392-156">This parameter can be set to **NULL**.</span></span>
-   <span data-ttu-id="11392-157">Structure [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) qui contient les paramètres de la vue de dossier précédente.</span><span class="sxs-lookup"><span data-stu-id="11392-157">A [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure that contains the previous folder view's settings.</span></span>
-   <span data-ttu-id="11392-158">Pointeur vers l’interface [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) de l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-158">A pointer to the Windows Explorer [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface.</span></span>
-   <span data-ttu-id="11392-159">Une structure [Rect](/previous-versions//ms536136(v=vs.85)) avec les dimensions de la fenêtre d’affichage des dossiers.</span><span class="sxs-lookup"><span data-stu-id="11392-159">A [RECT](/previous-versions//ms536136(v=vs.85)) structure with the dimensions of the folder view window.</span></span>

<span data-ttu-id="11392-160">La méthode [**IShellView :: CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) est appelée avant la destruction de l’objet de vue de dossier précédent.</span><span class="sxs-lookup"><span data-stu-id="11392-160">The [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method is called before the previous folder view object is destroyed.</span></span> <span data-ttu-id="11392-161">Le pointeur d’interface [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) vous permet donc de communiquer avec l’objet d’affichage de dossier précédent.</span><span class="sxs-lookup"><span data-stu-id="11392-161">The [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface pointer thus allows you to communicate with the previous folder view object.</span></span> <span data-ttu-id="11392-162">Cette interface est surtout utile si le dossier précédent appartenait à votre extension et utilisait le même schéma d’affichage.</span><span class="sxs-lookup"><span data-stu-id="11392-162">This interface is primarily useful if the previous folder belonged to your extension and used the same display scheme.</span></span> <span data-ttu-id="11392-163">Dans ce cas, vous pouvez communiquer avec l’objet d’affichage de dossier précédent à des fins telles que l’échange de paramètres privés.</span><span class="sxs-lookup"><span data-stu-id="11392-163">If so, you can communicate with the previous folder view object for such purposes as exchanging private settings.</span></span>

<span data-ttu-id="11392-164">Un moyen simple de déterminer si le pointeur [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) appartient à votre extension est de faire en sorte que tous vos objets de vue de dossier exposent une interface privée.</span><span class="sxs-lookup"><span data-stu-id="11392-164">A simple way to determine whether the [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) pointer belongs to your extension is to have all your folder view objects expose a private interface.</span></span> <span data-ttu-id="11392-165">Appelez [IShellView :: QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) pour demander l’interface privée, puis examinez la valeur de retour pour déterminer si l’objet de la vue du dossier est l’un des vôtres.</span><span class="sxs-lookup"><span data-stu-id="11392-165">Call [IShellView::QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) to request the private interface, and examine the return value to determine whether the folder view object is one of yours.</span></span> <span data-ttu-id="11392-166">Vous pouvez ensuite utiliser une méthode privée sur cette interface pour échanger des informations.</span><span class="sxs-lookup"><span data-stu-id="11392-166">You can then use a private method on that interface to exchange information.</span></span>

<span data-ttu-id="11392-167">La structure [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) contient les paramètres d’affichage du dossier précédent.</span><span class="sxs-lookup"><span data-stu-id="11392-167">The [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure contains the previous folder view's display settings.</span></span> <span data-ttu-id="11392-168">Le paramètre principal est le mode d’affichage : grande icône, petite icône, liste ou détails.</span><span class="sxs-lookup"><span data-stu-id="11392-168">The primary setting is the viewing mode: large icon, small icon, list, or details.</span></span> <span data-ttu-id="11392-169">Il y a également un indicateur qui contient les paramètres d’une variété d’options d’affichage, par exemple si la vue doit être alignée à gauche.</span><span class="sxs-lookup"><span data-stu-id="11392-169">There is also a flag that contains the settings of a variety of display options, such as whether the view should be left-aligned.</span></span> <span data-ttu-id="11392-170">L’affichage de vos dossiers doit respecter ces paramètres dans la mesure du possible, afin de fournir aux utilisateurs une expérience cohérente lorsqu’ils passent d’un dossier à un autre.</span><span class="sxs-lookup"><span data-stu-id="11392-170">Your folder display should follow these settings to the extent possible, to give users a consistent experience as they go from one folder to another.</span></span> <span data-ttu-id="11392-171">Vous devez stocker cette structure et la mettre à jour en fonction des modifications apportées aux paramètres.</span><span class="sxs-lookup"><span data-stu-id="11392-171">You should store this structure and update it as the settings change.</span></span> <span data-ttu-id="11392-172">L’Explorateur Windows appelle [**IShellView :: GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) pour obtenir la valeur la plus récente de cette structure avant d’ouvrir l’affichage suivant du dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-172">Windows Explorer calls [**IShellView::GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) to obtain the most recent value of this structure before it opens the next folder view.</span></span>

<span data-ttu-id="11392-173">L’interface [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) est exposée par l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-173">The [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface is exposed by Windows Explorer.</span></span> <span data-ttu-id="11392-174">Cette interface est associée à [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) et permet à un objet de vue de dossier de communiquer avec l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-174">This interface is a companion to [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) and allows a folder view object to communicate with Windows Explorer.</span></span> <span data-ttu-id="11392-175">Il n’existe aucune autre façon de récupérer ce pointeur d’interface, votre objet de vue de dossier doit donc le stocker pour une utilisation ultérieure.</span><span class="sxs-lookup"><span data-stu-id="11392-175">There is no other way to retrieve this interface pointer, so your folder view object should store it for later use.</span></span> <span data-ttu-id="11392-176">En particulier, vous devez appeler [IShellBrowser :: GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) pour récupérer la fenêtre d’affichage du dossier parent que vous allez utiliser pour créer votre fenêtre enfant.</span><span class="sxs-lookup"><span data-stu-id="11392-176">In particular, you will need to call [IShellBrowser::GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) to retrieve the parent folder view window that you will use to create your child window.</span></span> <span data-ttu-id="11392-177">Notez que la méthode IShellBrowser :: GetWindow n’est pas incluse dans la documentation **IShellBrowser** , car elle est héritée de [IOleWindow](/windows/win32/api/oleidl/nn-oleidl-iolewindow).</span><span class="sxs-lookup"><span data-stu-id="11392-177">Note that the IShellBrowser::GetWindow method is not included in the **IShellBrowser** documentation because it is inherited from [IOleWindow](/windows/win32/api/oleidl/nn-oleidl-iolewindow).</span></span> <span data-ttu-id="11392-178">Après avoir stocké le pointeur d’interface, n’oubliez pas d’appeler [IShellBrowser :: AddRef](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) pour incrémenter le décompte de références de l’interface.</span><span class="sxs-lookup"><span data-stu-id="11392-178">After storing the interface pointer, remember to call [IShellBrowser::AddRef](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) to increment the interface's reference count.</span></span> <span data-ttu-id="11392-179">Lorsque vous n’avez plus besoin de l’interface, appelez [IShellBrowser :: Release](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="11392-179">When you no longer need the interface, call [IShellBrowser::Release](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>

<span data-ttu-id="11392-180">Pour créer votre fenêtre enfant :</span><span class="sxs-lookup"><span data-stu-id="11392-180">To create your child window:</span></span>

1.  <span data-ttu-id="11392-181">Examinez les structures [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) et [Rect](/previous-versions//ms536136(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="11392-181">Examine the [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) and [RECT](/previous-versions//ms536136(v=vs.85)) structures.</span></span>
2.  <span data-ttu-id="11392-182">Si nécessaire, obtenez des paramètres privés à partir de l’objet d’affichage du dossier précédent.</span><span class="sxs-lookup"><span data-stu-id="11392-182">If needed, obtain private settings from the previous folder view object.</span></span>
3.  <span data-ttu-id="11392-183">Appelez [IShellBrowser :: GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) pour récupérer la fenêtre d’affichage du dossier parent.</span><span class="sxs-lookup"><span data-stu-id="11392-183">Call [IShellBrowser::GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) to retrieve the parent folder view window.</span></span>
4.  <span data-ttu-id="11392-184">Créez un enfant de la fenêtre d’affichage des dossiers obtenue à l’étape précédente et renvoyez-le à l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-184">Create a child of the folder view window obtained in the previous step and return it to Windows Explorer.</span></span>

## <a name="displaying-the-folder-view"></a><span data-ttu-id="11392-185">Affichage de l’affichage des dossiers</span><span class="sxs-lookup"><span data-stu-id="11392-185">Displaying the Folder View</span></span>

<span data-ttu-id="11392-186">Une fois que vous avez créé la fenêtre enfant et que vous l’avez retournée à l’Explorateur Windows, vous pouvez afficher le contenu du dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-186">Once you have created the child window and returned it to Windows Explorer, you can display the folder's contents.</span></span> <span data-ttu-id="11392-187">En règle générale, les extensions affichent leurs informations en faisant en sorte que la fenêtre enfant héberge soit un [contrôle List View](../controls/list-view-control-reference.md) , soit un **contrôle WebBrowser**.</span><span class="sxs-lookup"><span data-stu-id="11392-187">Typically, extensions display their information by having the child window host either a [list view control](../controls/list-view-control-reference.md) or a **WebBrowser control**.</span></span> <span data-ttu-id="11392-188">Le contrôle List View vous permet de répliquer l' [affichage classique](web-view.md)de l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-188">The list view control allows you to replicate the Windows Explorer [classic view](web-view.md).</span></span> <span data-ttu-id="11392-189">Le contrôle WebBrowser vous permet d’utiliser un document DHTML (Dynamic HTML) pour afficher vos informations, de la même façon que l’affichage Web de l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-189">The WebBrowser control allows you to use a Dynamic HTML (DHTML) document to display your information, much like the Windows Explorer Web view.</span></span> <span data-ttu-id="11392-190">Pour plus d’informations, reportez-vous à la documentation de ces contrôles.</span><span class="sxs-lookup"><span data-stu-id="11392-190">For further information, refer to the documentation of those controls.</span></span>

<span data-ttu-id="11392-191">La fenêtre d’affichage des dossiers existe toujours, même si elle n’a pas le focus.</span><span class="sxs-lookup"><span data-stu-id="11392-191">The folder view window always exists, even if it does not have focus.</span></span> <span data-ttu-id="11392-192">Vous devez donc conserver trois États pour votre fenêtre enfant :</span><span class="sxs-lookup"><span data-stu-id="11392-192">You should therefore maintain three states for your child window:</span></span>

-   <span data-ttu-id="11392-193">Activé avec focus.</span><span class="sxs-lookup"><span data-stu-id="11392-193">Activated with focus.</span></span> <span data-ttu-id="11392-194">L’affichage des dossiers a été créé et a le focus.</span><span class="sxs-lookup"><span data-stu-id="11392-194">The folder view has been created and has focus.</span></span> <span data-ttu-id="11392-195">Définissez la barre de menus ou les éléments de barre d’outils qui conviennent à un État ciblé.</span><span class="sxs-lookup"><span data-stu-id="11392-195">Set the menu bar or toolbar items that are appropriate for a focused state.</span></span>
-   <span data-ttu-id="11392-196">Activé sans focus.</span><span class="sxs-lookup"><span data-stu-id="11392-196">Activated without focus.</span></span> <span data-ttu-id="11392-197">L’affichage des dossiers a été créé et est actif, mais il n’a pas le focus.</span><span class="sxs-lookup"><span data-stu-id="11392-197">The folder view has been created and is active, but it does not have focus.</span></span> <span data-ttu-id="11392-198">Définissez la barre de menus ou les éléments de barre d’outils qui conviennent à un État sans focus.</span><span class="sxs-lookup"><span data-stu-id="11392-198">Set the menu bar or toolbar items that are appropriate for a nonfocused state.</span></span> <span data-ttu-id="11392-199">Omettez tous les éléments qui s’appliquent à la sélection d’éléments dans l’affichage des dossiers.</span><span class="sxs-lookup"><span data-stu-id="11392-199">Omit any items that apply to the selection of items within the folder view.</span></span>
-   <span data-ttu-id="11392-200">Désactivé.</span><span class="sxs-lookup"><span data-stu-id="11392-200">Deactivated.</span></span> <span data-ttu-id="11392-201">L’affichage des dossiers va être détruit.</span><span class="sxs-lookup"><span data-stu-id="11392-201">The folder view is about to be destroyed.</span></span> <span data-ttu-id="11392-202">Supprimer tous les éléments de menu spécifiques au dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-202">Remove all folder-specific menu items.</span></span>

<span data-ttu-id="11392-203">L’Explorateur Windows avertit votre objet de vue de dossier lorsque l’état de la fenêtre change en appelant [**IShellView :: UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate).</span><span class="sxs-lookup"><span data-stu-id="11392-203">Windows Explorer notifies your folder view object when the window state changes by calling [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate).</span></span> <span data-ttu-id="11392-204">À son tour, l’objet d’affichage des dossiers doit notifier l’Explorateur Windows lorsqu’un utilisateur active la fenêtre d’affichage des dossiers en appelant [**IShellBrowser :: OnViewWindowActive**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-onviewwindowactive).</span><span class="sxs-lookup"><span data-stu-id="11392-204">In turn, the folder view object should notify Windows Explorer when a user activates the folder view window by calling [**IShellBrowser::OnViewWindowActive**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-onviewwindowactive).</span></span> <span data-ttu-id="11392-205">Pour plus d’informations sur cette interface, consultez [utilisation de IShellBrowser pour communiquer avec l’Explorateur Windows](#using-ishellbrowser-to-communicate-with-windows-explorer).</span><span class="sxs-lookup"><span data-stu-id="11392-205">For further discussion of this interface, see [Using IShellBrowser to Communicate with Windows Explorer](#using-ishellbrowser-to-communicate-with-windows-explorer).</span></span>

<span data-ttu-id="11392-206">Lorsque l’affichage des dossiers est actif, vous devez traiter tous les messages Windows, tels que la [ \_ taille du WM](../winmsg/wm-size.md), qui appartiennent à votre fenêtre enfant.</span><span class="sxs-lookup"><span data-stu-id="11392-206">While the folder view is active, you need to process any Windows messages, such as [WM\_SIZE](../winmsg/wm-size.md), that belong to your child window.</span></span> <span data-ttu-id="11392-207">Votre procédure de fenêtre recevra également les messages de [ \_ commande WM](../menurc/wm-command.md) pour tous les éléments que vous avez ajoutés à la barre de menus ou à la barre d’outils de l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-207">Your window procedure will also receive [WM\_COMMAND](../menurc/wm-command.md) messages for any items you have added to the Windows Explorer menu bar or toolbar.</span></span>

<span data-ttu-id="11392-208">Après la création de l’affichage des dossiers, l’Explorateur Windows appelle l’interface [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) de l’objet affichage des dossiers pour lui transmettre de nombreuses informations.</span><span class="sxs-lookup"><span data-stu-id="11392-208">After creating the folder view, Windows Explorer calls the folder view object's [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface to pass it a variety of information.</span></span> <span data-ttu-id="11392-209">Votre objet doit modifier son affichage en conséquence.</span><span class="sxs-lookup"><span data-stu-id="11392-209">Your object must modify its display accordingly.</span></span> <span data-ttu-id="11392-210">Lorsque l’affichage des dossiers va être détruit, l’Explorateur Windows avertit l’objet de la vue du dossier en appelant sa méthode [**IShellView ::D estroyviewwindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-destroyviewwindow) .</span><span class="sxs-lookup"><span data-stu-id="11392-210">When the folder view is about to be destroyed, Windows Explorer notifies the folder view object by calling its [**IShellView::DestroyViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-destroyviewwindow) method.</span></span>

## <a name="implementing-ishellview"></a><span data-ttu-id="11392-211">Implémentation de IShellView</span><span class="sxs-lookup"><span data-stu-id="11392-211">Implementing IShellView</span></span>

<span data-ttu-id="11392-212">Une fois l’objet dossier créé, l’Explorateur Windows appelle différentes méthodes [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) pour demander des informations ou notifier l’objet d’une modification de l’état de l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-212">After the folder object has been created, Windows Explorer calls various [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) methods to either request information or notify the object of a change in the state of Windows Explorer.</span></span> <span data-ttu-id="11392-213">Cette section décrit comment implémenter ces méthodes **IShellView** .</span><span class="sxs-lookup"><span data-stu-id="11392-213">This section outlines how to implement those **IShellView** methods.</span></span> <span data-ttu-id="11392-214">Les méthodes restantes sont utilisées à des fins plus spécialisées, telles que la boîte de dialogue Ouvrir un fichier commun.</span><span class="sxs-lookup"><span data-stu-id="11392-214">The remaining methods are used for more specialized purposes, such as the File Open common dialog box.</span></span> <span data-ttu-id="11392-215">Pour plus d’informations, consultez la documentation **IShellView** .</span><span class="sxs-lookup"><span data-stu-id="11392-215">For details, see the **IShellView** documentation.</span></span>

### <a name="addpropertysheetpages"></a><span data-ttu-id="11392-216">AddPropertySheetPages</span><span class="sxs-lookup"><span data-stu-id="11392-216">AddPropertySheetPages</span></span>

<span data-ttu-id="11392-217">Quand un utilisateur sélectionne des **options de dossier** dans le menu **Outils** de l’Explorateur Windows, une feuille de propriétés s’affiche et permet à l’utilisateur de modifier les options des dossiers.</span><span class="sxs-lookup"><span data-stu-id="11392-217">When a user selects **Folder Options** from the Windows Explorer **Tools** menu, a property sheet is displayed that allows the user to modify the folder options.</span></span> <span data-ttu-id="11392-218">L’Explorateur Windows appelle la méthode [**IShellView :: AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages) de l’objet affichage des dossiers pour vous permettre d’ajouter une page à cette feuille de propriétés.</span><span class="sxs-lookup"><span data-stu-id="11392-218">Windows Explorer calls your folder view object's [**IShellView::AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages) method to allow you to add a page to this property sheet.</span></span>

<span data-ttu-id="11392-219">L’Explorateur Windows passe un pointeur vers une fonction de rappel [AddPropSheetPageProc](/windows/win32/api/prsht/nc-prsht-lpfnaddpropsheetpage) dans le paramètre *lpfn* de [**IShellView :: AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages).</span><span class="sxs-lookup"><span data-stu-id="11392-219">Windows Explorer passes a pointer to an [AddPropSheetPageProc](/windows/win32/api/prsht/nc-prsht-lpfnaddpropsheetpage) callback function in the *lpfn* parameter of [**IShellView::AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages).</span></span> <span data-ttu-id="11392-220">Appelez [CreatePropertySheetPage](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) pour créer la page, puis appelez AddPropSheetPageProc pour l’ajouter à la feuille de propriétés.</span><span class="sxs-lookup"><span data-stu-id="11392-220">Call [CreatePropertySheetPage](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) to create the page, and then call the AddPropSheetPageProc to add it to the property sheet.</span></span> <span data-ttu-id="11392-221">Pour plus d’informations sur la façon de gérer les feuilles de propriétés, consultez [feuilles de propriétés](../controls/property-sheets.md).</span><span class="sxs-lookup"><span data-stu-id="11392-221">For further discussion of how to handle property sheets, see [Property Sheets](../controls/property-sheets.md).</span></span>

### <a name="getcurrentinfo"></a><span data-ttu-id="11392-222">GetCurrentInfo</span><span class="sxs-lookup"><span data-stu-id="11392-222">GetCurrentInfo</span></span>

<span data-ttu-id="11392-223">Lorsque l’utilisateur passe d’un dossier à un autre, l’Explorateur Windows tente de maintenir un affichage de dossiers similaire.</span><span class="sxs-lookup"><span data-stu-id="11392-223">When the user switches from one folder to another, Windows Explorer attempts to maintain a similar folder view.</span></span> <span data-ttu-id="11392-224">Par exemple, si l’affichage du dossier précédent affichait de grandes icônes, le prochain devrait également.</span><span class="sxs-lookup"><span data-stu-id="11392-224">For instance, if the previous folder view showed large icons, the next should as well.</span></span> <span data-ttu-id="11392-225">Lorsque l’Explorateur Windows appelle [**IShellView :: CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) pour initialiser votre objet de vue de dossier, la méthode reçoit une structure [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) .</span><span class="sxs-lookup"><span data-stu-id="11392-225">When Windows Explorer calls [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) to initialize your folder view object, the method receives a [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure.</span></span> <span data-ttu-id="11392-226">Cette structure contient des informations qui vous permettent de rendre votre affichage des dossiers cohérent avec l’affichage du dossier précédent.</span><span class="sxs-lookup"><span data-stu-id="11392-226">This structure contains information that allows you to make your folder view display consistent with the previous folder view.</span></span>

<span data-ttu-id="11392-227">Pour vous assurer que la vue suivante est cohérente avec la vue actuelle, stockez la structure [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) .</span><span class="sxs-lookup"><span data-stu-id="11392-227">To help ensure that the next view is consistent with the current view, store the [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure.</span></span> <span data-ttu-id="11392-228">Si la vue change, par exemple de grande taille à petite icône, mettez à jour la structure en conséquence.</span><span class="sxs-lookup"><span data-stu-id="11392-228">If the view changes, for instance from large to small icons, update the structure accordingly.</span></span> <span data-ttu-id="11392-229">Avant de basculer entre les vues, l’Explorateur Windows appelle [**IShellView :: GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) pour demander les valeurs **FOLDERSETTINGS** actuelles pour les passer à l’objet de vue de dossier suivant.</span><span class="sxs-lookup"><span data-stu-id="11392-229">Prior to switching views, Windows Explorer will call [**IShellView::GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) to request the current **FOLDERSETTINGS** values to pass them to the next folder view object.</span></span>

### <a name="refresh"></a><span data-ttu-id="11392-230">Actualiser</span><span class="sxs-lookup"><span data-stu-id="11392-230">Refresh</span></span>

<span data-ttu-id="11392-231">L’utilisateur peut s’assurer que l’affichage des dossiers reflète l’état actuel du dossier en sélectionnant **Actualiser** dans le menu **affichage** ou en appuyant sur la touche F5.</span><span class="sxs-lookup"><span data-stu-id="11392-231">The user can ensure that the folder view reflects the current state of the folder by selecting **Refresh** from the **View** menu or pressing the F5 key.</span></span> <span data-ttu-id="11392-232">Lorsque l’utilisateur le fait, l’Explorateur Windows appelle la méthode [**IShellView :: Refresh**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-refresh) .</span><span class="sxs-lookup"><span data-stu-id="11392-232">When the user does so, Windows Explorer calls the [**IShellView::Refresh**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-refresh) method.</span></span> <span data-ttu-id="11392-233">Votre objet de vue de dossier doit immédiatement mettre à jour l’affichage du dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-233">Your folder view object should immediately update the folder view display.</span></span>

### <a name="saveviewstate"></a><span data-ttu-id="11392-234">SaveViewState</span><span class="sxs-lookup"><span data-stu-id="11392-234">SaveViewState</span></span>

<span data-ttu-id="11392-235">L’Explorateur Windows appelle la méthode [**IShellView :: SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate) pour inviter votre objet de vue de dossier à enregistrer son état d’affichage.</span><span class="sxs-lookup"><span data-stu-id="11392-235">Windows Explorer calls the [**IShellView::SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate) method to prompt your folder view object to save its view state.</span></span> <span data-ttu-id="11392-236">Vous pouvez ensuite récupérer l’état lors de la prochaine consultation du dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-236">You can then recover the state the next time the folder is viewed.</span></span> <span data-ttu-id="11392-237">Pour enregistrer un état d’affichage, il est préférable d’appeler la méthode [**IShellBrowser :: GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream) .</span><span class="sxs-lookup"><span data-stu-id="11392-237">The preferred way to save a view state is by calling the [**IShellBrowser::GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream) method.</span></span> <span data-ttu-id="11392-238">Cette méthode retourne une interface [IStream](/windows/win32/api/objidl/nn-objidl-istream) que votre objet d’affichage des dossiers peut utiliser pour enregistrer son état.</span><span class="sxs-lookup"><span data-stu-id="11392-238">This method returns an [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface that your folder view object can use to save its state.</span></span> <span data-ttu-id="11392-239">Lorsque vous créez un autre affichage des dossiers, vous pouvez appeler la même méthode **IShellBrowser :: GetViewStateStream** pour obtenir un pointeur IStream qui vous permet de lire les paramètres enregistrés par les affichages des dossiers précédents.</span><span class="sxs-lookup"><span data-stu-id="11392-239">When you create another folder view, you can call the same **IShellBrowser::GetViewStateStream** method to obtain an IStream pointer that allows you to read the settings saved by previous folder views.</span></span>

### <a name="translateacelerator"></a><span data-ttu-id="11392-240">TranslateAcelerator</span><span class="sxs-lookup"><span data-stu-id="11392-240">TranslateAcelerator</span></span>

<span data-ttu-id="11392-241">Quand l’utilisateur appuie sur une touche de raccourci, l’Explorateur Windows transmet le message à l’objet d’affichage des dossiers en appelant [**IShellView :: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator).</span><span class="sxs-lookup"><span data-stu-id="11392-241">When the user presses a shortcut key, Windows Explorer passes the message to the folder view object by calling [**IShellView::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator).</span></span> <span data-ttu-id="11392-242">Retourne \_ la valeur false pour que l’Explorateur Windows traite le message.</span><span class="sxs-lookup"><span data-stu-id="11392-242">Return S\_FALSE to have Windows Explorer process the message.</span></span> <span data-ttu-id="11392-243">Si votre objet de vue de dossier a traité le message, renvoyez \_ OK.</span><span class="sxs-lookup"><span data-stu-id="11392-243">If your folder view object has processed the message, return S\_OK.</span></span>

<span data-ttu-id="11392-244">Lorsque la fenêtre d’affichage des dossiers a le focus, l’Explorateur Windows appelle [**IShellView :: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator) avant de traiter le message.</span><span class="sxs-lookup"><span data-stu-id="11392-244">When the folder view window has focus, Windows Explorer calls [**IShellView::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator) before it processes the message.</span></span> <span data-ttu-id="11392-245">Étant donné que la plupart des messages sont généralement associés à des commandes de barre de menus ou de barre d’outils de l’Explorateur Windows, votre objet de vue de dossier doit normalement retourner S \_ false.</span><span class="sxs-lookup"><span data-stu-id="11392-245">Because most of the messages are typically associated with Windows Explorer menu bar or toolbar commands, your folder view object should normally return S\_FALSE.</span></span> <span data-ttu-id="11392-246">L’Explorateur Windows peut ensuite traiter le message normalement.</span><span class="sxs-lookup"><span data-stu-id="11392-246">Windows Explorer can then process the message normally.</span></span> <span data-ttu-id="11392-247">Retourne \_ la valeur OK uniquement si le message est spécifique à un dossier et que vous ne souhaitez pas que l’Explorateur Windows effectue un traitement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="11392-247">Return S\_OK only if the message is folder-specific and you do not want Windows Explorer to do any further processing.</span></span> <span data-ttu-id="11392-248">Si l’affichage des dossiers n’a pas le focus, l’Explorateur Windows traite le message en premier.</span><span class="sxs-lookup"><span data-stu-id="11392-248">If the folder view does not have focus, Windows Explorer processes the message first.</span></span> <span data-ttu-id="11392-249">Elle appelle [**IShellBrowser :: TranslateAcceleratorSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-translateacceleratorsb) uniquement si elle ne gère pas le message.</span><span class="sxs-lookup"><span data-stu-id="11392-249">It calls [**IShellBrowser::TranslateAcceleratorSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-translateacceleratorsb) only if it does not handle the message.</span></span>

## <a name="using-ishellbrowser-to-communicate-with-windows-explorer"></a><span data-ttu-id="11392-250">Utilisation de IShellBrowser pour communiquer avec l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-250">Using IShellBrowser to Communicate with Windows Explorer</span></span>

<span data-ttu-id="11392-251">L’interface [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) est utilisée par l’objet d’affichage des dossiers pour communiquer avec l’Explorateur Windows à diverses fins, notamment :</span><span class="sxs-lookup"><span data-stu-id="11392-251">The [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface is used by the folder view object to communicate with Windows Explorer for a variety of purposes, including:</span></span>

-   [<span data-ttu-id="11392-252">Modification de la barre de menus de l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-252">Modifying the Windows Explorer Menu Bar</span></span>](#modifying-the-windows-explorer-menu-bar)
-   [<span data-ttu-id="11392-253">Modification de la barre d’outils de l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-253">Modifying the Windows Explorer Toolbar</span></span>](#modifying-the-windows-explorer-toolbar)
-   [<span data-ttu-id="11392-254">Modification de la barre d’état de l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-254">Modifying the Windows Explorer Status Bar</span></span>](#modifying-the-windows-explorer-status-bar)
-   [<span data-ttu-id="11392-255">Stockage des informations spécifiques à la vue</span><span class="sxs-lookup"><span data-stu-id="11392-255">Storing View-specific Information</span></span>](#storing-view-specific-information)

### <a name="modifying-the-windows-explorer-menu-bar"></a><span data-ttu-id="11392-256">Modification de la barre de menus de l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-256">Modifying the Windows Explorer Menu Bar</span></span>

<span data-ttu-id="11392-257">La barre de menus de l’Explorateur Windows permet à l’utilisateur de lancer une série de commandes.</span><span class="sxs-lookup"><span data-stu-id="11392-257">The Windows Explorer menu bar allows the user to launch a variety of commands.</span></span> <span data-ttu-id="11392-258">Par défaut, la barre de menus ne prend en charge que les commandes spécifiques à l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-258">By default, the menu bar only supports commands that are specific to Windows Explorer.</span></span> <span data-ttu-id="11392-259">Les messages [de \_ commande WM](../menurc/wm-command.md) associés sont traités par l’Explorateur Windows et ne sont pas transmis à votre objet de vue de dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-259">The related [WM\_COMMAND](../menurc/wm-command.md) messages are processed by Windows Explorer and are not passed to your folder view object.</span></span> <span data-ttu-id="11392-260">Toutefois, vous pouvez modifier la barre de menus pour inclure un ou plusieurs éléments de menu spécifiques à un dossier avec [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser).</span><span class="sxs-lookup"><span data-stu-id="11392-260">However, you can modify the menu bar to include one or more folder-specific menu items with [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser).</span></span> <span data-ttu-id="11392-261">L’Explorateur Windows transmet les \_ messages de commande WM associés à ces éléments à la procédure de fenêtre de votre objet dossier pour traitement.</span><span class="sxs-lookup"><span data-stu-id="11392-261">Windows Explorer passes the associated WM\_COMMAND messages of those items to your folder object's window procedure for processing.</span></span> <span data-ttu-id="11392-262">Vous pouvez également supprimer ou désactiver toutes les commandes standard qui ne s’appliquent pas à votre application.</span><span class="sxs-lookup"><span data-stu-id="11392-262">You can also remove or disable any standard commands that do not apply to your application.</span></span>

<span data-ttu-id="11392-263">Les objets d’affichage des dossiers modifient généralement la barre de menus avant l’affichage du dossier.</span><span class="sxs-lookup"><span data-stu-id="11392-263">Folder view objects typically modify the menu bar before the folder view is first displayed.</span></span> <span data-ttu-id="11392-264">Ils doivent retourner la barre de menus à son état d’origine lorsque l’affichage des dossiers est détruit.</span><span class="sxs-lookup"><span data-stu-id="11392-264">They must return the menu bar to its original state when the folder view is destroyed.</span></span> <span data-ttu-id="11392-265">Vous devrez peut-être également modifier la barre de menus chaque fois que votre vue de dossier gagne ou perd le focus.</span><span class="sxs-lookup"><span data-stu-id="11392-265">You might also need to modify the menu bar each time your folder view gains or loses focus.</span></span>

<span data-ttu-id="11392-266">Étant donné que l’Explorateur Windows appelle [**IShellView :: UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) chaque fois que l’état de la fenêtre d’affichage des dossiers change, la modification de la barre de menus est normalement incluse dans l’implémentation de cette méthode.</span><span class="sxs-lookup"><span data-stu-id="11392-266">Because Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) each time the folder view window's state changes, menu bar modification is normally included in that method's implementation.</span></span> <span data-ttu-id="11392-267">La procédure de base pour modifier la barre de menus de l’Explorateur Windows est la suivante :</span><span class="sxs-lookup"><span data-stu-id="11392-267">The basic procedure for modifying the Windows Explorer menu bar is:</span></span>

1.  <span data-ttu-id="11392-268">Appelez [CreateMenu](/windows/win32/api/winuser/nf-winuser-createmenu) pour créer un handle de menu.</span><span class="sxs-lookup"><span data-stu-id="11392-268">Call [CreateMenu](/windows/win32/api/winuser/nf-winuser-createmenu) to create a menu handle.</span></span>
2.  <span data-ttu-id="11392-269">Transmettez ce handle de menu à l’Explorateur Windows en appelant [**IShellBrowser :: InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb).</span><span class="sxs-lookup"><span data-stu-id="11392-269">Pass that menu handle to Windows Explorer by calling [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb).</span></span> <span data-ttu-id="11392-270">L’Explorateur Windows renseigne ses informations de menu.</span><span class="sxs-lookup"><span data-stu-id="11392-270">Windows Explorer will fill in its menu information.</span></span>
3.  <span data-ttu-id="11392-271">Modifiez le menu en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="11392-271">Modify the menu as needed.</span></span>
4.  <span data-ttu-id="11392-272">Appelez [**IShellBrowser :: SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) pour que l’Explorateur Windows affiche la barre de menus modifiée.</span><span class="sxs-lookup"><span data-stu-id="11392-272">Call [**IShellBrowser::SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) to have Windows Explorer display the modified menu bar.</span></span>

<span data-ttu-id="11392-273">L’Explorateur Windows possède six menus contextuels dans sa barre de menus.</span><span class="sxs-lookup"><span data-stu-id="11392-273">Windows Explorer has six pop-up menus on its menu bar.</span></span> <span data-ttu-id="11392-274">Comme avec tous les conteneurs OLE, le menu de l’Explorateur Windows est divisé en six groupes : fichier, modifier, conteneur, objet, fenêtre et aide.</span><span class="sxs-lookup"><span data-stu-id="11392-274">As with all OLE containers, the Windows Explorer menu is divided into six groups: File, Edit, Container, Object, Window, and Help.</span></span> <span data-ttu-id="11392-275">Le tableau suivant répertorie les menus contextuels de l’Explorateur Windows et le groupe qui leur est associé, ainsi que les ID de menu.</span><span class="sxs-lookup"><span data-stu-id="11392-275">The following table lists the Windows Explorer pop-up menus and their associated group, along with the menu IDs.</span></span>



| <span data-ttu-id="11392-276">Menu contextuel</span><span class="sxs-lookup"><span data-stu-id="11392-276">Pop-up menu</span></span> | <span data-ttu-id="11392-277">id</span><span class="sxs-lookup"><span data-stu-id="11392-277">ID</span></span>                     | <span data-ttu-id="11392-278">Group</span><span class="sxs-lookup"><span data-stu-id="11392-278">Group</span></span>     |
|-------------|------------------------|-----------|
| <span data-ttu-id="11392-279">Fichier</span><span class="sxs-lookup"><span data-stu-id="11392-279">File</span></span>        | <span data-ttu-id="11392-280">\_fichier de menu FCIDM \_</span><span class="sxs-lookup"><span data-stu-id="11392-280">FCIDM\_MENU\_FILE</span></span>      | <span data-ttu-id="11392-281">Fichier</span><span class="sxs-lookup"><span data-stu-id="11392-281">File</span></span>      |
| <span data-ttu-id="11392-282">Modifier</span><span class="sxs-lookup"><span data-stu-id="11392-282">Edit</span></span>        | <span data-ttu-id="11392-283">FCIDM \_ menu \_ Edition</span><span class="sxs-lookup"><span data-stu-id="11392-283">FCIDM\_MENU\_EDIT</span></span>      | <span data-ttu-id="11392-284">Fichier</span><span class="sxs-lookup"><span data-stu-id="11392-284">File</span></span>      |
| <span data-ttu-id="11392-285">Affichage</span><span class="sxs-lookup"><span data-stu-id="11392-285">View</span></span>        | <span data-ttu-id="11392-286">\_affichage du menu FCIDM \_</span><span class="sxs-lookup"><span data-stu-id="11392-286">FCIDM\_MENU\_VIEW</span></span>      | <span data-ttu-id="11392-287">Conteneur</span><span class="sxs-lookup"><span data-stu-id="11392-287">Container</span></span> |
| <span data-ttu-id="11392-288">Favoris</span><span class="sxs-lookup"><span data-stu-id="11392-288">Favorites</span></span>   | <span data-ttu-id="11392-289">FCIDM \_ menu \_ favoris</span><span class="sxs-lookup"><span data-stu-id="11392-289">FCIDM\_MENU\_FAVORITES</span></span> | <span data-ttu-id="11392-290">Conteneur</span><span class="sxs-lookup"><span data-stu-id="11392-290">Container</span></span> |
| <span data-ttu-id="11392-291">Outils</span><span class="sxs-lookup"><span data-stu-id="11392-291">Tools</span></span>       | <span data-ttu-id="11392-292">\_outils de menu FCIDM \_</span><span class="sxs-lookup"><span data-stu-id="11392-292">FCIDM\_MENU\_TOOLS</span></span>     | <span data-ttu-id="11392-293">Conteneur</span><span class="sxs-lookup"><span data-stu-id="11392-293">Container</span></span> |
| <span data-ttu-id="11392-294">Aide</span><span class="sxs-lookup"><span data-stu-id="11392-294">Help</span></span>        | <span data-ttu-id="11392-295">\_aide du menu FCIDM \_</span><span class="sxs-lookup"><span data-stu-id="11392-295">FCIDM\_MENU\_HELP</span></span>      | <span data-ttu-id="11392-296">Fenêtre</span><span class="sxs-lookup"><span data-stu-id="11392-296">Window</span></span>    |



 

<span data-ttu-id="11392-297">Quand vous transmettez le descripteur de menu à l’Explorateur Windows en appelant [**IShellBrowser :: InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb), vous devez également passer un pointeur vers une structure [OLEMENUGROUPWIDTHS](/windows/win32/api/oleidl/ns-oleidl-olemenugroupwidths) dont les membres ont été initialisés à zéro.</span><span class="sxs-lookup"><span data-stu-id="11392-297">When you pass the menu handle to Windows Explorer by calling [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb), you must also pass a pointer to an [OLEMENUGROUPWIDTHS](/windows/win32/api/oleidl/ns-oleidl-olemenugroupwidths) structure whose members have been initialized to zero.</span></span>

<span data-ttu-id="11392-298">Quand [**IShellBrowser :: InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb) est retourné, l’Explorateur Windows a ajouté ses éléments de menu.</span><span class="sxs-lookup"><span data-stu-id="11392-298">When [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb) returns, Windows Explorer will have added its menu items.</span></span> <span data-ttu-id="11392-299">Vous pouvez ensuite utiliser le descripteur de menu retourné avec les fonctions de menu Windows standard, telles que [InsertMenuItem](/windows/win32/api/winuser/nf-winuser-insertmenuitema) , pour :</span><span class="sxs-lookup"><span data-stu-id="11392-299">You can then use the returned menu handle with standard Windows menu functions such as [InsertMenuItem](/windows/win32/api/winuser/nf-winuser-insertmenuitema) to:</span></span>

-   <span data-ttu-id="11392-300">Ajoutez des éléments aux menus contextuels de l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-300">Add items to the Windows Explorer pop-up menus.</span></span>
-   <span data-ttu-id="11392-301">Modifiez ou supprimez des éléments existants dans les menus contextuels de l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-301">Modify or delete existing items in the Windows Explorer pop-up menus.</span></span>
-   <span data-ttu-id="11392-302">Ajoutez de nouveaux menus contextuels.</span><span class="sxs-lookup"><span data-stu-id="11392-302">Add new pop-up menus.</span></span>

<span data-ttu-id="11392-303">Utilisez les ID figurant dans le tableau pour identifier les différents menus contextuels de l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="11392-303">Use the IDs listed in the table to identify the various Windows Explorer pop-up menus.</span></span>

> [!Note]  
> <span data-ttu-id="11392-304">Pour éviter les conflits avec les ID de commande de l’Explorateur Windows, les ID des éléments de menu que vous ajoutez doivent être compris entre FCIDM \_ SHVIEWFIRST et FCIDM \_ SHVIEWLAST.</span><span class="sxs-lookup"><span data-stu-id="11392-304">To avoid conflicts with Windows Explorer command IDs, the IDs of any menu items that you add must fall between FCIDM\_SHVIEWFIRST and FCIDM\_SHVIEWLAST.</span></span> <span data-ttu-id="11392-305">Ces deux valeurs sont définies dans shlobj. h.</span><span class="sxs-lookup"><span data-stu-id="11392-305">These two values are defined in Shlobj.h.</span></span>

 

<span data-ttu-id="11392-306">Une fois que vous avez fini de modifier le menu, appelez [**IShellBrowser :: SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) pour que l’Explorateur Windows affiche la nouvelle barre de menus.</span><span class="sxs-lookup"><span data-stu-id="11392-306">Once you have finished modifying the menu, call [**IShellBrowser::SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) to have Windows Explorer display the new menu bar.</span></span>

<span data-ttu-id="11392-307">Une fois l’affichage des dossiers initialement affiché, l’Explorateur Windows appelle [**IShellView :: UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) chaque fois que l’affichage des dossiers gagne ou perd le focus.</span><span class="sxs-lookup"><span data-stu-id="11392-307">After the folder view is initially displayed, Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) each time the folder view gains or loses focus.</span></span> <span data-ttu-id="11392-308">Si vous avez des éléments de menu qui sont sensibles à l’état de l’affichage des dossiers, vous devez modifier le menu en conséquence, chaque fois que l’état change.</span><span class="sxs-lookup"><span data-stu-id="11392-308">If you have any menu items that are sensitive to the state of the folder view, you should modify the menu accordingly, each time the state changes.</span></span> <span data-ttu-id="11392-309">Par exemple, vous pouvez avoir un élément de menu qui agit sur un élément dans l’affichage des dossiers qui a été sélectionné par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="11392-309">For instance, you might have a menu item that acts on an item in the folder view that has been selected by the user.</span></span> <span data-ttu-id="11392-310">Vous devez désactiver ou supprimer cet élément de menu lorsque l’affichage des dossiers perd le focus.</span><span class="sxs-lookup"><span data-stu-id="11392-310">You should disable or remove this menu item when the folder view loses focus.</span></span>

<span data-ttu-id="11392-311">Lorsque l’Explorateur Windows appelle [**IShellView :: UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) pour indiquer que l’affichage des dossiers est désactivé, restaurez la barre de menus à son état d’origine en appelant [**IShellBrowser :: RemoveMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-removemenussb).</span><span class="sxs-lookup"><span data-stu-id="11392-311">When Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) to indicate that the folder view is being deactivated, restore the menu bar to its original state by calling [**IShellBrowser::RemoveMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-removemenussb).</span></span>

### <a name="modifying-the-windows-explorer-toolbar"></a><span data-ttu-id="11392-312">Modification de la barre d’outils de l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-312">Modifying the Windows Explorer Toolbar</span></span>

<span data-ttu-id="11392-313">Outre la modification de la barre de menus de l’Explorateur Windows, vous pouvez également ajouter des boutons à la barre d’outils.</span><span class="sxs-lookup"><span data-stu-id="11392-313">In addition to modifying the Windows Explorer menu bar, you can also add buttons to the toolbar.</span></span> <span data-ttu-id="11392-314">Comme avec la barre de menus, la modification de la barre d’outils fait généralement partie de l’implémentation de [**IShellView :: UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) .</span><span class="sxs-lookup"><span data-stu-id="11392-314">As with the menu bar, toolbar modification is usually part of the [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) implementation.</span></span> <span data-ttu-id="11392-315">La procédure d’ajout de boutons à la barre d’outils de l’Explorateur Windows est la suivante :</span><span class="sxs-lookup"><span data-stu-id="11392-315">The procedure for adding buttons to the Windows Explorer toolbar is:</span></span>

1.  <span data-ttu-id="11392-316">Ajoutez l’image bitmap du bouton à la liste d’images de la barre d’outils.</span><span class="sxs-lookup"><span data-stu-id="11392-316">Add the button's bitmap to the toolbar's image list.</span></span>
2.  <span data-ttu-id="11392-317">Définissez la chaîne de texte du bouton.</span><span class="sxs-lookup"><span data-stu-id="11392-317">Define the button's text string.</span></span>
3.  <span data-ttu-id="11392-318">Ajoutez le bouton à la barre d’outils.</span><span class="sxs-lookup"><span data-stu-id="11392-318">Add the button to the toolbar.</span></span>

<span data-ttu-id="11392-319">Pour ajouter une image bitmap à la liste d’images d’une barre d’outils, envoyez la barre d’outils à un message [ \_ ADDBITMAP to](../controls/tb-addbitmap.md) en appelant [**IShellBrowser :: SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span><span class="sxs-lookup"><span data-stu-id="11392-319">To add a bitmap to a toolbar's image list, send the toolbar a [TB\_ADDBITMAP](../controls/tb-addbitmap.md) message by calling [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span></span> <span data-ttu-id="11392-320">Pour spécifier le contrôle ToolBar, définissez le paramètre *ID* de la méthode sur la **\_ barre d’outils FCW**.</span><span class="sxs-lookup"><span data-stu-id="11392-320">To specify the toolbar control, set the method's *id* parameter to **FCW\_TOOLBAR**.</span></span> <span data-ttu-id="11392-321">Définissez *wParam* sur le nombre d’images de bouton dans l’image bitmap et *lParam* sur l’adresse d’une structure [TBADDBITMAP](/windows/win32/api/commctrl/ns-commctrl-tbaddbitmap) .</span><span class="sxs-lookup"><span data-stu-id="11392-321">Set *wParam* to the number of button images in the bitmap, and *lParam* to the address of a [TBADDBITMAP](/windows/win32/api/commctrl/ns-commctrl-tbaddbitmap) structure.</span></span> <span data-ttu-id="11392-322">L’index d’image est retourné dans le paramètre *pret* .</span><span class="sxs-lookup"><span data-stu-id="11392-322">The image index is returned in the *pret* parameter.</span></span>

<span data-ttu-id="11392-323">Il existe deux façons de définir une chaîne pour le bouton :</span><span class="sxs-lookup"><span data-stu-id="11392-323">There are two ways to define a string for the button:</span></span>

-   <span data-ttu-id="11392-324">Assignez la chaîne au membre **iString** de la structure [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) du bouton.</span><span class="sxs-lookup"><span data-stu-id="11392-324">Assign the string to the **iString** member of the button's [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) structure.</span></span>
-   <span data-ttu-id="11392-325">Appelez [**IShellBrowser :: SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) pour envoyer le contrôle de barre d’outils à un message [ \_ ADDSTRING to](../controls/tb-addstring.md) .</span><span class="sxs-lookup"><span data-stu-id="11392-325">Call [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) to send the toolbar control a [TB\_ADDSTRING](../controls/tb-addstring.md) message.</span></span> <span data-ttu-id="11392-326">Le paramètre *wParam* doit être défini sur zéro et le paramètre *lParam* sur la chaîne.</span><span class="sxs-lookup"><span data-stu-id="11392-326">The *wParam* parameter should be set to zero and the *lParam* parameter to the string.</span></span> <span data-ttu-id="11392-327">L’index de chaîne est retourné dans le paramètre *pret* .</span><span class="sxs-lookup"><span data-stu-id="11392-327">The string index is returned in the *pret* parameter.</span></span>

<span data-ttu-id="11392-328">Pour ajouter le bouton à la barre d’outils, remplissez une structure [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) et transmettez-la à [**IShellBrowser :: SetToolbarItems**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-settoolbaritems).</span><span class="sxs-lookup"><span data-stu-id="11392-328">To add the button to the toolbar, fill in a [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) structure and pass it to [**IShellBrowser::SetToolbarItems**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-settoolbaritems).</span></span> <span data-ttu-id="11392-329">Comme avec le menu, votre ID de commande doit se situer entre FCIDM \_ SHVIEWFIRST et FCIDM \_ SHVIEWLAST.</span><span class="sxs-lookup"><span data-stu-id="11392-329">As with the menu, your command ID must fall between FCIDM\_SHVIEWFIRST and FCIDM\_SHVIEWLAST.</span></span> <span data-ttu-id="11392-330">La barre d’outils ajoute ensuite le bouton à droite des boutons existants.</span><span class="sxs-lookup"><span data-stu-id="11392-330">The toolbar will then append the button to the right of the existing buttons.</span></span>

<span data-ttu-id="11392-331">Par exemple, le fragment de code suivant ajoute un bouton standard à la barre d’outils de l’Explorateur Windows avec l’ID de commande IDB \_ MYBUTTON.</span><span class="sxs-lookup"><span data-stu-id="11392-331">For instance, the following code fragment adds one standard button to the Windows Explorer toolbar with a command ID of IDB\_MYBUTTON.</span></span>


```
TBADDBITMAP tbadbm;
int iButtonIndex;
TBBUTTON tbb;

tbadbm.hInst = g_hInstance;    // The module's instance handle
tbadbm.nID = IDB_BUTTONIMAGE;  // The bitmap's resource ID

psb->SendControlMsg(FCW_TOOLBAR, TB_ADDBITMAP, 1,
                    reinterpret_cast<LPARAM>(&tbadbm), &iButtonIndex);

psb->SendControlMsg(FCW_TOOLBAR, TB_ADDSTRING, NULL,
                    reinterpret_cast<LPARAM>(szLabel), &iStringIndex);

ZeroMemory(&tbb, sizeof(TBBUTTON));
tbb.iBitmap = iButtonIndex;
tbb.iCommand = IDB_MYBUTTON;
tbb.iString = iStringIndex;
tbb.fsState = TBSTATE_ENABLED;
tbb.fsStyle = TBSTYLE_BUTTON;

psb->SetToolbarItems(&tbb, 1, FCT_MERGE);
```



<span data-ttu-id="11392-332">Pour plus d’informations sur la gestion des contrôles ToolBar, consultez [Toolbar Controls](../controls/toolbar-control-reference.md).</span><span class="sxs-lookup"><span data-stu-id="11392-332">For further discussion of how to handle toolbar controls, see [Toolbar Controls](../controls/toolbar-control-reference.md).</span></span>

### <a name="modifying-the-windows-explorer-status-bar"></a><span data-ttu-id="11392-333">Modification de la barre d’état de l’Explorateur Windows</span><span class="sxs-lookup"><span data-stu-id="11392-333">Modifying the Windows Explorer Status Bar</span></span>

<span data-ttu-id="11392-334">Vous pouvez utiliser la barre d’état de l’Explorateur Windows pour afficher une variété d’informations utiles.</span><span class="sxs-lookup"><span data-stu-id="11392-334">You can use the Windows Explorer status bar to display a variety of useful information.</span></span> <span data-ttu-id="11392-335">Il existe deux façons d’utiliser la barre d’État :</span><span class="sxs-lookup"><span data-stu-id="11392-335">There are two ways to use the status bar:</span></span>

-   <span data-ttu-id="11392-336">Utilisez [**IShellBrowser :: SetStatusTextSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setstatustextsb) pour afficher une chaîne de texte dans la barre d’État.</span><span class="sxs-lookup"><span data-stu-id="11392-336">Use [**IShellBrowser::SetStatusTextSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setstatustextsb) to display a text string on the status bar.</span></span>
-   <span data-ttu-id="11392-337">Envoyer des messages directement au contrôle de barre d’État avec [**IShellBrowser :: SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span><span class="sxs-lookup"><span data-stu-id="11392-337">Send messages directly to the status bar control with [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span></span>

<span data-ttu-id="11392-338">La première méthode est simple, mais suffisante pour de nombreuses raisons.</span><span class="sxs-lookup"><span data-stu-id="11392-338">The first method is straightforward but sufficient for many purposes.</span></span> <span data-ttu-id="11392-339">Pour une plus grande flexibilité, vous pouvez envoyer des messages directement au contrôle de barre d’État en appelant [**IShellBrowser :: SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) avec le paramètre *ID* défini sur **FCW \_ Status**.</span><span class="sxs-lookup"><span data-stu-id="11392-339">For greater flexibility, you can send messages directly to the status bar control by calling [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) with the *id* parameter set to **FCW\_STATUS**.</span></span> <span data-ttu-id="11392-340">Pour plus d’informations sur les contrôles de barre d’État, consultez [barres d’État](../controls/status-bars.md).</span><span class="sxs-lookup"><span data-stu-id="11392-340">For further discussion of status bar controls, see [Status Bars](../controls/status-bars.md).</span></span>

### <a name="storing-view-specific-information"></a><span data-ttu-id="11392-341">Stockage des informations spécifiques à la vue</span><span class="sxs-lookup"><span data-stu-id="11392-341">Storing View-specific Information</span></span>

<span data-ttu-id="11392-342">Quand une vue va être détruite, il est souvent utile de stocker des informations telles que l’État ou les paramètres de la vue.</span><span class="sxs-lookup"><span data-stu-id="11392-342">When a view is about to be destroyed, it is often useful to store information such as the view's state or settings.</span></span> <span data-ttu-id="11392-343">L’Explorateur Windows vous invite à effectuer cette tâche en appelant [**IShellView :: SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate).</span><span class="sxs-lookup"><span data-stu-id="11392-343">Windows Explorer prompts you to do this task by calling [**IShellView::SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate).</span></span> <span data-ttu-id="11392-344">La méthode recommandée pour enregistrer des informations spécifiques à une vue consiste à appeler [**IShellBrowser :: GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream).</span><span class="sxs-lookup"><span data-stu-id="11392-344">The preferred way to save view-specific information is to call [**IShellBrowser::GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream).</span></span> <span data-ttu-id="11392-345">Cette méthode vous fournit une interface [IStream](/windows/win32/api/objidl/nn-objidl-istream) que vous pouvez utiliser pour stocker les informations.</span><span class="sxs-lookup"><span data-stu-id="11392-345">This method provides you with an [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface that you can use to store the information.</span></span> <span data-ttu-id="11392-346">Vous êtes libre d’utiliser n’importe quel format de données approprié.</span><span class="sxs-lookup"><span data-stu-id="11392-346">You are free to use any suitable data format.</span></span>

 

 
