---
title: Développement de compléments IFilter
description: Vous pouvez étendre Microsoft Windows Desktop Search (WDS) avec des compléments de filtre, des composants qui implémentent IFilterinterface, pour inclure de nouveaux types de fichiers.
ms.assetid: 71dd515d-a73e-4e0a-b0da-c8a6209d09fe
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 79f846cf2101eefc17b1e92fbd7992529a06fb43
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104463099"
---
# <a name="developing-ifilter-add-ins"></a><span data-ttu-id="73d7e-103">Développement de compléments IFilter</span><span class="sxs-lookup"><span data-stu-id="73d7e-103">Developing IFilter Add-ins</span></span>

> [!NOTE]
> <span data-ttu-id="73d7e-104">Windows Desktop Search 2. x est une technologie obsolète qui était à l’origine disponible en tant que complément pour Windows XP et Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="73d7e-104">Windows Desktop Search 2.x is an obsolete technology that was originally available as an add-in for Windows XP and Windows Server 2003.</span></span> <span data-ttu-id="73d7e-105">Dans les versions ultérieures, utilisez [Windows Search](../search/-search-3x-wds-overview.md) à la place.</span><span class="sxs-lookup"><span data-stu-id="73d7e-105">On later releases, use [Windows Search](../search/-search-3x-wds-overview.md) instead.</span></span>

<span data-ttu-id="73d7e-106">Vous pouvez étendre Microsoft Windows Desktop Search (WDS) avec des compléments de filtre, des composants qui implémentent l’interface [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter), pour inclure de nouveaux types de fichiers.</span><span class="sxs-lookup"><span data-stu-id="73d7e-106">You can extend Microsoft Windows Desktop Search (WDS) with filter add-ins, components that implement the [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)interface, to include new file types.</span></span> <span data-ttu-id="73d7e-107">Les filtres sont chargés d’accéder aux données et de les analyser dans des fichiers, et de retourner des paires de propriétés et de valeurs ainsi que des blocs de texte pour l’indexation.</span><span class="sxs-lookup"><span data-stu-id="73d7e-107">Filters are responsible for accessing and parsing data in files and for returning pairs of properties and values as well as chunks of text for indexing.</span></span> <span data-ttu-id="73d7e-108">Pendant le processus d’indexation, WDS appelle le filtre approprié avec l’URL de chaque fichier ou élément.</span><span class="sxs-lookup"><span data-stu-id="73d7e-108">During the indexing process, WDS calls the appropriate filter with the URL for each file or item.</span></span> <span data-ttu-id="73d7e-109">Le filtre extrait d’abord les métadonnées qui correspondent aux propriétés marquées comme étant récupérables dans le schéma WDS, telles que le titre, la taille de fichier et la date de dernière modification.</span><span class="sxs-lookup"><span data-stu-id="73d7e-109">The filter first extracts metadata that corresponds to properties that are marked retrievable in the WDS schema, such as title, file size, and last modified date.</span></span> <span data-ttu-id="73d7e-110">Ensuite, il divise le contenu de l’élément en segments de texte.</span><span class="sxs-lookup"><span data-stu-id="73d7e-110">Then it breaks the item content into chunks of text.</span></span> <span data-ttu-id="73d7e-111">WDS ajoute les propriétés et le texte retournés par le filtre au catalogue.</span><span class="sxs-lookup"><span data-stu-id="73d7e-111">WDS adds the properties and text returned by the filter to the catalog.</span></span> <span data-ttu-id="73d7e-112">WDS peut indexer n’importe quel type de fichier pour lequel il possède un filtre inscrit.</span><span class="sxs-lookup"><span data-stu-id="73d7e-112">WDS can index any file type for which it has a registered filter.</span></span>

<span data-ttu-id="73d7e-113">Dans certains cas, vous n’avez pas besoin d’écrire un nouveau filtre.</span><span class="sxs-lookup"><span data-stu-id="73d7e-113">In some circumstances, you do not need to write a new filter.</span></span> <span data-ttu-id="73d7e-114">WDS 2. x contient des filtres pour plus de 200 types d’éléments (y compris des éléments en texte clair tels que HTML, XML et des fichiers de code source) et utilise la même technologie [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)que SharePoint Services.</span><span class="sxs-lookup"><span data-stu-id="73d7e-114">WDS 2.x contains filters for over 200 types of items (including plaintext items such as HTML, XML, and source code files) and uses the same [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)technology as SharePoint Services.</span></span> <span data-ttu-id="73d7e-115">Si vous avez déjà installé des filtres pour vos types de fichiers, WDS peut utiliser ces filtres existants pour indexer ces données.</span><span class="sxs-lookup"><span data-stu-id="73d7e-115">If you already have filters installed for your file types, WDS can use those existing filters to index this data.</span></span> <span data-ttu-id="73d7e-116">En outre, WDS comprend un filtre général pour les types de fichiers qui sont en texte clair.</span><span class="sxs-lookup"><span data-stu-id="73d7e-116">Furthermore, WDS includes a general filter for file types that are plaintext-based.</span></span> <span data-ttu-id="73d7e-117">Si vous avez un type de fichier qui peut être traité par un filtre SharePoint Services existant ou le filtre de texte en clair, vous pouvez ajouter l’extension de nom de fichier et le GUID de filtre au registre pour que WDS puisse les localiser et les utiliser (pour plus d’informations, consultez [pour inscrire un complément de filtre](#to-register-a-filter-add-in) ).</span><span class="sxs-lookup"><span data-stu-id="73d7e-117">If you have a file type that can be processed by either an existing SharePoint Services filter or the plaintext filter, you can add the file name extension and filter GUID to the Registry so WDS can locate and use it (see [To Register a Filter Add-in](#to-register-a-filter-add-in) for more information).</span></span>

<span data-ttu-id="73d7e-118">Toutefois, si vous disposez d’un format de fichier ou de données propriétaire non en texte brut, l’écriture d’une implémentation de filtre personnalisée est la seule façon de s’assurer que WDS peut indexer le format de fichier dans le catalogue.</span><span class="sxs-lookup"><span data-stu-id="73d7e-118">If, however, you have a non-plaintext and proprietary data or file format, writing a custom filter implementation is the only way to ensure WDS can index the file format in the catalog.</span></span> <span data-ttu-id="73d7e-119">Vous ne pouvez avoir qu’un seul complément de filtre pour un type de fichier. il est donc possible de remplacer un filtre existant ou de faire en sorte qu’un autre filtre remplace le vôtre pour un type de fichier spécifique.</span><span class="sxs-lookup"><span data-stu-id="73d7e-119">You can have only one filter add-in for a file type, so it is possible to override an existing filter or to have another filter override yours for a specific file type.</span></span>

<span data-ttu-id="73d7e-120">Cette section contient les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="73d7e-120">This section contains the following topics:</span></span>

-   [<span data-ttu-id="73d7e-121">Interfaces de filtre requises</span><span class="sxs-lookup"><span data-stu-id="73d7e-121">Required Filter Interfaces</span></span>](#required-filter-interfaces)
    -   [<span data-ttu-id="73d7e-122">Interface IFilter</span><span class="sxs-lookup"><span data-stu-id="73d7e-122">IFilter Interface</span></span>](#ifilter-interface)
    -   [<span data-ttu-id="73d7e-123">IPersistStream</span><span class="sxs-lookup"><span data-stu-id="73d7e-123">IPersistStream</span></span>](#ipersiststream)
    -   [<span data-ttu-id="73d7e-124">IPersistFile</span><span class="sxs-lookup"><span data-stu-id="73d7e-124">IPersistFile</span></span>](#ipersistfile)
    -   [<span data-ttu-id="73d7e-125">IPersistStorage</span><span class="sxs-lookup"><span data-stu-id="73d7e-125">IPersistStorage</span></span>](#ipersiststorage)
-   [<span data-ttu-id="73d7e-126">Sortir des propriétés avec des filtres</span><span class="sxs-lookup"><span data-stu-id="73d7e-126">Outputting Properties with Filters</span></span>](#outputting-properties-with-filters)
    -   [<span data-ttu-id="73d7e-127">Valeurs de propriété</span><span class="sxs-lookup"><span data-stu-id="73d7e-127">Property Values</span></span>](#property-values)
-   [<span data-ttu-id="73d7e-128">Filtrer l’installation du complément</span><span class="sxs-lookup"><span data-stu-id="73d7e-128">Filter Add-in Installation</span></span>](#filter-add-in-installation)
    -   [<span data-ttu-id="73d7e-129">CLSID requis pour l’inscription</span><span class="sxs-lookup"><span data-stu-id="73d7e-129">CLSIDs Required for Registration</span></span>](#clsids-required-for-registration)
    -   [<span data-ttu-id="73d7e-130">Modèle d’inscription</span><span class="sxs-lookup"><span data-stu-id="73d7e-130">Registration Model</span></span>](#registration-model)
    -   [<span data-ttu-id="73d7e-131">Pour inscrire un complément de filtre</span><span class="sxs-lookup"><span data-stu-id="73d7e-131">To Register a Filter Add-in</span></span>](#to-register-a-filter-add-in)
-   [<span data-ttu-id="73d7e-132">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="73d7e-132">Related topics</span></span>](#related-topics)

## <a name="required-filter-interfaces"></a><span data-ttu-id="73d7e-133">Interfaces de filtre requises</span><span class="sxs-lookup"><span data-stu-id="73d7e-133">Required Filter Interfaces</span></span>

<span data-ttu-id="73d7e-134">Un complément de filtre doit implémenter l’interface [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)et l’une des interfaces suivantes :</span><span class="sxs-lookup"><span data-stu-id="73d7e-134">A filter add-in must implement the [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)interface and one of the following interfaces:</span></span>

-   <span data-ttu-id="73d7e-135">[IPersistStream](/windows/win32/api/objidl/nn-objidl-ipersiststream) -pour charger des données à partir d’un flux.</span><span class="sxs-lookup"><span data-stu-id="73d7e-135">[IPersistStream](/windows/win32/api/objidl/nn-objidl-ipersiststream) - To load data from a stream.</span></span> <span data-ttu-id="73d7e-136">Cette opération est plus sécurisée que l’utilisation de fichiers, car rien n’est écrit sur le disque.</span><span class="sxs-lookup"><span data-stu-id="73d7e-136">This is more secure than using files because nothing is written to disk.</span></span> <span data-ttu-id="73d7e-137">L’interface IPersistStream est la méthode préférée pour la compatibilité ascendante avec Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="73d7e-137">The IPersistStream interface is the preferred method for forward compatibility with Windows Vista.</span></span>
-   <span data-ttu-id="73d7e-138">[IPersistFile, interface](/windows/win32/api/objidl/nn-objidl-ipersistfile) -pour charger des données à partir d’un fichier.</span><span class="sxs-lookup"><span data-stu-id="73d7e-138">[IPersistFile Interface](/windows/win32/api/objidl/nn-objidl-ipersistfile) - To load data from a file.</span></span> <span data-ttu-id="73d7e-139">Cette interface n’est pas prise en charge dans Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="73d7e-139">This interface is not supported in Windows Vista.</span></span>
-   <span data-ttu-id="73d7e-140">[IPersistStorage, interface](/windows/win32/api/objidl/nn-objidl-ipersiststorage) -pour charger des données à partir d’un stockage structuré com OLE.</span><span class="sxs-lookup"><span data-stu-id="73d7e-140">[IPersistStorage Interface](/windows/win32/api/objidl/nn-objidl-ipersiststorage) - To load data from an OLE COM Structured Storage.</span></span>

<span data-ttu-id="73d7e-141">Un complément de filtre utilise ces interfaces pour obtenir le contenu de l’élément et les retourner de manière itérative à l’index jusqu’à ce que la fin du fichier soit atteinte.</span><span class="sxs-lookup"><span data-stu-id="73d7e-141">A filter add-in uses these interfaces to get the contents of the item and return them iteratively to the index until the end of the file is reached.</span></span> <span data-ttu-id="73d7e-142">Un complément de filtre doit être aussi robuste que possible pour gérer les fichiers endommagés et ceux qui ne satisfont pas aux formats d’entrée attendus.</span><span class="sxs-lookup"><span data-stu-id="73d7e-142">A filter add-in should be as robust as possible to handle corrupt files and those that do not meet expected input formats.</span></span>

### <a name="ifilter-interface"></a><span data-ttu-id="73d7e-143">Interface IFilter</span><span class="sxs-lookup"><span data-stu-id="73d7e-143">IFilter Interface</span></span>

<span data-ttu-id="73d7e-144">Il s’agit d’une interface requise pour l’implémentation d’un filtre.</span><span class="sxs-lookup"><span data-stu-id="73d7e-144">This is a required interface for a filter implementation.</span></span> <span data-ttu-id="73d7e-145">Pour plus d’informations, consultez les informations de référence sur l’interface [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter).</span><span class="sxs-lookup"><span data-stu-id="73d7e-145">For more information, see the [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)interface reference.</span></span>



| <span data-ttu-id="73d7e-146">Méthode</span><span class="sxs-lookup"><span data-stu-id="73d7e-146">Method</span></span>       | <span data-ttu-id="73d7e-147">Description</span><span class="sxs-lookup"><span data-stu-id="73d7e-147">Description</span></span>                                                                            |
|--------------|----------------------------------------------------------------------------------------|
| <span data-ttu-id="73d7e-148">Init ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-148">Init()</span></span>       | <span data-ttu-id="73d7e-149">Initialise une session de filtrage.</span><span class="sxs-lookup"><span data-stu-id="73d7e-149">Initializes a filtering session.</span></span>                                                       |
| <span data-ttu-id="73d7e-150">GetChunk ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-150">GetChunk()</span></span>   | <span data-ttu-id="73d7e-151">Positionne le filtre au début du bloc First ou Next et retourne un descripteur.</span><span class="sxs-lookup"><span data-stu-id="73d7e-151">Positions the filter at the beginning of first or next chunk and returns a descriptor.</span></span> |
| <span data-ttu-id="73d7e-152">GetText ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-152">GetText()</span></span>    | <span data-ttu-id="73d7e-153">Récupère le texte du bloc actuel.</span><span class="sxs-lookup"><span data-stu-id="73d7e-153">Retrieves text from the current chunk.</span></span>                                                 |
| <span data-ttu-id="73d7e-154">GetValue()</span><span class="sxs-lookup"><span data-stu-id="73d7e-154">GetValue()</span></span>   | <span data-ttu-id="73d7e-155">Récupère les valeurs de propriété du bloc actuel.</span><span class="sxs-lookup"><span data-stu-id="73d7e-155">Retrieves property values from the current chunk.</span></span>                                      |
| <span data-ttu-id="73d7e-156">BindRegion()</span><span class="sxs-lookup"><span data-stu-id="73d7e-156">BindRegion()</span></span> | <span data-ttu-id="73d7e-157">Actuellement réservé à un usage interne ; n’implémentez pas.</span><span class="sxs-lookup"><span data-stu-id="73d7e-157">Currently reserved for internal use; do not implement.</span></span> <span data-ttu-id="73d7e-158">Cette méthode retourne E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="73d7e-158">This method returns E\_NOTIMPL.</span></span> |



 

### <a name="ipersiststream"></a><span data-ttu-id="73d7e-159">IPersistStream</span><span class="sxs-lookup"><span data-stu-id="73d7e-159">IPersistStream</span></span>

<span data-ttu-id="73d7e-160">Cette interface charge un fichier à partir d’un flux pour un traitement plus sécurisé que l' [interface IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) , car le contexte dans lequel un filtre [IPersistStream](/windows/win32/api/objidl/nn-objidl-ipersiststream) s’exécute n’a pas besoin des droits pour ouvrir des fichiers sur le disque ou sur le réseau.</span><span class="sxs-lookup"><span data-stu-id="73d7e-160">This interface loads a file from a stream for more secure processing than [IPersistFile Interface](/windows/win32/api/objidl/nn-objidl-ipersistfile) because the context in which a [IPersistStream](/windows/win32/api/objidl/nn-objidl-ipersiststream) filter runs does not need the rights to open any files on the disk or over the network.</span></span> <span data-ttu-id="73d7e-161">Parmi les deux méthodes d’accès à un seul fichier, il s’agit de la méthode recommandée pour la compatibilité ascendante avec Windows.</span><span class="sxs-lookup"><span data-stu-id="73d7e-161">Of the two methods for accessing a single file, this is the preferred method for forward compatibility with Windows.</span></span>



| <span data-ttu-id="73d7e-162">Méthode</span><span class="sxs-lookup"><span data-stu-id="73d7e-162">Method</span></span>       | <span data-ttu-id="73d7e-163">Description</span><span class="sxs-lookup"><span data-stu-id="73d7e-163">Description</span></span>                                                                                                                                        |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="73d7e-164">IsDirty ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-164">IsDirty()</span></span>    | <span data-ttu-id="73d7e-165">Vérifie si une modification a été apportée.</span><span class="sxs-lookup"><span data-stu-id="73d7e-165">Checks if there has been a change.</span></span> <span data-ttu-id="73d7e-166">Cette méthode retourne E \_ NOTIMPL dans les filtres.</span><span class="sxs-lookup"><span data-stu-id="73d7e-166">This method returns E\_NOTIMPL in filters.</span></span>                                                                      |
| <span data-ttu-id="73d7e-167">InitNew ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-167">InitNew()</span></span>    | <span data-ttu-id="73d7e-168">Crée un nouveau stockage.</span><span class="sxs-lookup"><span data-stu-id="73d7e-168">Creates a new storage.</span></span> <span data-ttu-id="73d7e-169">Cette méthode retourne E \_ NOTIMPL dans les filtres.</span><span class="sxs-lookup"><span data-stu-id="73d7e-169">This method returns E\_NOTIMPL in filters.</span></span>                                                                                  |
| <span data-ttu-id="73d7e-170">Load ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-170">Load()</span></span>       | <span data-ttu-id="73d7e-171">Initialise un objet à partir du flux ayant été précédemment enregistré.</span><span class="sxs-lookup"><span data-stu-id="73d7e-171">Initializes an object from the stream where it was previously saved.</span></span>                                                                               |
| <span data-ttu-id="73d7e-172">Save ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-172">Save()</span></span>       | <span data-ttu-id="73d7e-173">Enregistre un objet dans le flux spécifié et indique si l’objet doit réinitialiser son indicateur de modification.</span><span class="sxs-lookup"><span data-stu-id="73d7e-173">Saves an object into the specified stream and indicates whether the object should reset its dirty flag.</span></span> <span data-ttu-id="73d7e-174">Cette méthode retourne E \_ NOTIMPL dans les filtres.</span><span class="sxs-lookup"><span data-stu-id="73d7e-174">This method returns E\_NOTIMPL in filters.</span></span> |
| <span data-ttu-id="73d7e-175">GetSizeMax()</span><span class="sxs-lookup"><span data-stu-id="73d7e-175">GetSizeMax()</span></span> | <span data-ttu-id="73d7e-176">Retourne la taille en octets du flux requis pour enregistrer l'objet.</span><span class="sxs-lookup"><span data-stu-id="73d7e-176">Returns the size in bytes of the stream needed to save the object.</span></span> <span data-ttu-id="73d7e-177">Cette méthode retourne E \_ NOTIMPL dans les filtres.</span><span class="sxs-lookup"><span data-stu-id="73d7e-177">This method returns E\_NOTIMPL in filters.</span></span>                                      |



 

### <a name="ipersistfile"></a><span data-ttu-id="73d7e-178">IPersistFile</span><span class="sxs-lookup"><span data-stu-id="73d7e-178">IPersistFile</span></span>

<span data-ttu-id="73d7e-179">Cette interface charge un fichier par chemin d’accès absolu et n’est pas pris en charge dans Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="73d7e-179">This interface loads a file by absolute path and is not supported in Windows Vista.</span></span>



| <span data-ttu-id="73d7e-180">Méthode</span><span class="sxs-lookup"><span data-stu-id="73d7e-180">Method</span></span>          | <span data-ttu-id="73d7e-181">Description</span><span class="sxs-lookup"><span data-stu-id="73d7e-181">Description</span></span>                                                                                                                  |
|-----------------|------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="73d7e-182">GetCurFile()</span><span class="sxs-lookup"><span data-stu-id="73d7e-182">GetCurFile()</span></span>    | <span data-ttu-id="73d7e-183">Obtient le nom actuel du fichier associé à l’objet.</span><span class="sxs-lookup"><span data-stu-id="73d7e-183">Gets the current name of the file associated with the object.</span></span> <span data-ttu-id="73d7e-184">Retourne le chemin d’accès spécifié dans Load ().</span><span class="sxs-lookup"><span data-stu-id="73d7e-184">Returns the path specified in Load().</span></span>                          |
| <span data-ttu-id="73d7e-185">Load ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-185">Load()</span></span>          | <span data-ttu-id="73d7e-186">Ouvre le fichier spécifié et initialise un objet à partir du contenu du fichier.</span><span class="sxs-lookup"><span data-stu-id="73d7e-186">Opens the specified file and initializes an object from the file contents.</span></span> <span data-ttu-id="73d7e-187">Vous pouvez différer l’ouverture du fichier jusqu’à ce que vous en ayez besoin.</span><span class="sxs-lookup"><span data-stu-id="73d7e-187">You can delay opening the file until you need it.</span></span> |
| <span data-ttu-id="73d7e-188">GetClassID ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-188">GetClassID()</span></span>    | <span data-ttu-id="73d7e-189">Retourne l’identificateur de classe (CLSID) pour le nouveau type de fichier.</span><span class="sxs-lookup"><span data-stu-id="73d7e-189">Returns the class identifier (CLSID) for the new file type.</span></span> <span data-ttu-id="73d7e-190">Vous devez utiliser uuidgen.exe pour générer un CLSID unique.</span><span class="sxs-lookup"><span data-stu-id="73d7e-190">You should use uuidgen.exe to generate a unique CLSID.</span></span>           |
| <span data-ttu-id="73d7e-191">IsDirty ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-191">IsDirty()</span></span>       | <span data-ttu-id="73d7e-192">N’a besoin que \_ de retourner E NOTIMPL dans les filtres</span><span class="sxs-lookup"><span data-stu-id="73d7e-192">Need only return E\_NOTIMPL in filters</span></span>                                                                                       |
| <span data-ttu-id="73d7e-193">Save ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-193">Save()</span></span>          | <span data-ttu-id="73d7e-194">N’a besoin que \_ de retourner E NOTIMPL dans les filtres</span><span class="sxs-lookup"><span data-stu-id="73d7e-194">Need only return E\_NOTIMPL in filters</span></span>                                                                                       |
| <span data-ttu-id="73d7e-195">SaveCompleted()</span><span class="sxs-lookup"><span data-stu-id="73d7e-195">SaveCompleted()</span></span> | <span data-ttu-id="73d7e-196">N’a besoin que \_ de retourner E NOTIMPL dans les filtres</span><span class="sxs-lookup"><span data-stu-id="73d7e-196">Need only return E\_NOTIMPL in filters</span></span>                                                                                       |



 

### <a name="ipersiststorage"></a><span data-ttu-id="73d7e-197">IPersistStorage</span><span class="sxs-lookup"><span data-stu-id="73d7e-197">IPersistStorage</span></span>

<span data-ttu-id="73d7e-198">Cette interface prend en charge le modèle de stockage structuré, dans lequel chaque objet contenu a son propre stockage qui est imbriqué dans le stockage du conteneur.</span><span class="sxs-lookup"><span data-stu-id="73d7e-198">This interface supports the structured storage model, in which each contained object has its own storage that is nested within the container's storage.</span></span> <span data-ttu-id="73d7e-199">À l’instar de l' [interface IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile), cette interface est chargée par le chemin d’accès absolu et n’est pas prise en charge dans Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="73d7e-199">Like [IPersistFile Interface](/windows/win32/api/objidl/nn-objidl-ipersistfile), this interface loads by absolute path and is not supported in Windows Vista.</span></span>



| <span data-ttu-id="73d7e-200">Méthode</span><span class="sxs-lookup"><span data-stu-id="73d7e-200">Method</span></span>            | <span data-ttu-id="73d7e-201">Description</span><span class="sxs-lookup"><span data-stu-id="73d7e-201">Description</span></span>                                                                                                   |
|-------------------|---------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="73d7e-202">IsDirty ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-202">IsDirty()</span></span>         | <span data-ttu-id="73d7e-203">Vérifie si une modification a été apportée.</span><span class="sxs-lookup"><span data-stu-id="73d7e-203">Checks if there has been a change.</span></span> <span data-ttu-id="73d7e-204">Cette méthode retourne E \_ NOTIMPL dans les filtres.</span><span class="sxs-lookup"><span data-stu-id="73d7e-204">This method returns E\_NOTIMPL in filters.</span></span>                                 |
| <span data-ttu-id="73d7e-205">InitNew ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-205">InitNew()</span></span>         | <span data-ttu-id="73d7e-206">Crée un nouveau stockage.</span><span class="sxs-lookup"><span data-stu-id="73d7e-206">Creates a new storage.</span></span> <span data-ttu-id="73d7e-207">Cette méthode retourne E \_ NOTIMPL dans les filtres.</span><span class="sxs-lookup"><span data-stu-id="73d7e-207">This method returns E\_NOTIMPL in filters.</span></span>                                             |
| <span data-ttu-id="73d7e-208">Load ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-208">Load()</span></span>            | <span data-ttu-id="73d7e-209">Enregistre le stockage.</span><span class="sxs-lookup"><span data-stu-id="73d7e-209">Saves the storage.</span></span> <span data-ttu-id="73d7e-210">Cette méthode retourne E \_ NOTIMPL dans les filtres.</span><span class="sxs-lookup"><span data-stu-id="73d7e-210">This method returns E\_NOTIMPL in filters.</span></span>                                                 |
| <span data-ttu-id="73d7e-211">Save ()</span><span class="sxs-lookup"><span data-stu-id="73d7e-211">Save()</span></span>            | <span data-ttu-id="73d7e-212">Retourne la taille en octets du flux requis pour enregistrer l'objet.</span><span class="sxs-lookup"><span data-stu-id="73d7e-212">Returns the size in bytes of the stream needed to save the object.</span></span> <span data-ttu-id="73d7e-213">Cette méthode retourne E \_ NOTIMPL dans les filtres.</span><span class="sxs-lookup"><span data-stu-id="73d7e-213">This method returns E\_NOTIMPL in filters.</span></span> |
| <span data-ttu-id="73d7e-214">SaveCompleted()</span><span class="sxs-lookup"><span data-stu-id="73d7e-214">SaveCompleted()</span></span>   | <span data-ttu-id="73d7e-215">Réservé à un usage interne.</span><span class="sxs-lookup"><span data-stu-id="73d7e-215">Reserved for internal use.</span></span> <span data-ttu-id="73d7e-216">Cette méthode retourne E \_ NOTIMPL dans les filtres.</span><span class="sxs-lookup"><span data-stu-id="73d7e-216">This method returns E\_NOTIMPL in filters.</span></span>                                         |
| <span data-ttu-id="73d7e-217">HandsOffStorage()</span><span class="sxs-lookup"><span data-stu-id="73d7e-217">HandsOffStorage()</span></span> | <span data-ttu-id="73d7e-218">Réservé à un usage interne.</span><span class="sxs-lookup"><span data-stu-id="73d7e-218">Reserved for internal use.</span></span> <span data-ttu-id="73d7e-219">Cette méthode retourne E \_ NOTIMPL dans les filtres.</span><span class="sxs-lookup"><span data-stu-id="73d7e-219">This method returns E\_NOTIMPL in filters.</span></span>                                         |



 

## <a name="outputting-properties-with-filters"></a><span data-ttu-id="73d7e-220">Sortir des propriétés avec des filtres</span><span class="sxs-lookup"><span data-stu-id="73d7e-220">Outputting Properties with Filters</span></span>

<span data-ttu-id="73d7e-221">L’objectif d’un filtre est d’extraire le contenu et les propriétés des fichiers à inclure dans l’index de recherche en texte intégral.</span><span class="sxs-lookup"><span data-stu-id="73d7e-221">The purpose of a filter is to extract the content and properties of files for inclusion in the full-text index.</span></span> <span data-ttu-id="73d7e-222">WDS appelle d’abord la méthode Load sur les implémentations IPersistFile, IPersistStream ou IPersistStorage, puis appelle la méthode Init de l’implémentation IFilter.</span><span class="sxs-lookup"><span data-stu-id="73d7e-222">WDS first calls the Load method on either the IPersistFile, IPersistStream, or IPersistStorage implementations and then invokes the Init method of the IFilter implementation.</span></span> <span data-ttu-id="73d7e-223">**GetChunk** est appelé pour extraire des blocs de données de texte ou de valeur de propriété, puis **gettext** ou **GetValue** est appelé autant de fois que nécessaire pour récupérer toutes les valeurs de texte ou de propriété associées au bloc.</span><span class="sxs-lookup"><span data-stu-id="73d7e-223">**GetChunk** is called to retrieve chunks of text or property value data, and then either **GetText** or **GetValue** is called as many times as needed to retrieve all of the text or property values associated with the chunk.</span></span> <span data-ttu-id="73d7e-224">Ce processus se répète jusqu’à ce que **GetChunk** signale qu’il n’y a plus de segments dans le document.</span><span class="sxs-lookup"><span data-stu-id="73d7e-224">This process repeats until **GetChunk** reports that there are no more chunks in the document.</span></span>

<span data-ttu-id="73d7e-225">La méthode **GetChunk** récupère des informations sur le premier ou le prochain bloc d’informations logiques à partir du fichier filtré et retourne ces informations dans une \_ structure de blocs STAT, y compris un ID de segment à croissance monotone, des informations d’État sur la façon dont le segment actuel est associé au bloc précédent, un indicateur qui spécifie si le segment contient du texte ou une valeur, les paramètres régionaux du</span><span class="sxs-lookup"><span data-stu-id="73d7e-225">The **GetChunk** method retrieves information about the first or next logical block of information from the file being filtered and returns that information in a STAT\_CHUNK structure, including a monotonically increasing chunk ID, status information about how the current chunk relates to the previous chunk, a flag indicating whether the chunk contains text or a value, the chunk's locale, and the chunk's property specification.</span></span> <span data-ttu-id="73d7e-226">La spécification de propriété est un [**FULLPROPSPEC**](/windows/desktop/api/filter/ns-filter-fullpropspec) qui se compose d’un CLSID et d’un identificateur de propriété de type entier ou chaîne (par exemple, D5CDD505-2E9C-101B-9397-08002B2CF9AE/PerceivedType).</span><span class="sxs-lookup"><span data-stu-id="73d7e-226">The property specification is a [**FULLPROPSPEC**](/windows/desktop/api/filter/ns-filter-fullpropspec) consisting of a CLSID and either an integer or string property identifier (for example, D5CDD505-2E9C-101B-9397-08002B2CF9AE/PerceivedType).</span></span> <span data-ttu-id="73d7e-227">Elle identifie le type de propriété plutôt que la valeur de propriété elle-même.</span><span class="sxs-lookup"><span data-stu-id="73d7e-227">It identifies the type of property rather than the property value itself.</span></span>

<span data-ttu-id="73d7e-228">L’identificateur de paramètres régionaux du bloc est utilisé pour choisir un analyseur lexical approprié et il est très important que vous l’identifiiez correctement.</span><span class="sxs-lookup"><span data-stu-id="73d7e-228">The chunk locale identifier is used to choose an appropriate word breaker, and it is very important that you correctly identify it.</span></span> <span data-ttu-id="73d7e-229">Si le filtre ne peut pas déterminer les paramètres régionaux du texte, il doit supposer les paramètres régionaux système par défaut, disponibles à l’aide de **GetSystemDefaultLCID**.</span><span class="sxs-lookup"><span data-stu-id="73d7e-229">If the filter cannot determine the locale of the text, it should assume the default system locale, available by using **GetSystemDefaultLCID**.</span></span> <span data-ttu-id="73d7e-230">Si vous contrôlez le format de fichier et qu’il ne contient pas d’informations de paramètres régionaux, vous devez ajouter une fonctionnalité utilisateur pour permettre l’identification des paramètres régionaux appropriés.</span><span class="sxs-lookup"><span data-stu-id="73d7e-230">If you control the file format and it currently does not contain locale information, you should add a user feature to enable proper locale identification.</span></span> <span data-ttu-id="73d7e-231">L’utilisation d’un analyseur lexical incompatible peut entraîner une mauvaise expérience de requête pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="73d7e-231">Using a mismatched word breaker can lead to a bad query experience for the user.</span></span>

<span data-ttu-id="73d7e-232">**GetChunk** gère uniquement l’accès aux segments et ne retourne pas le texte ou la valeur de propriété elle-même.</span><span class="sxs-lookup"><span data-stu-id="73d7e-232">**GetChunk** only manages accessing chunks and does not return the text or property value itself.</span></span> <span data-ttu-id="73d7e-233">Au lieu de cela, les appels suivants à **gettext** et **GetValue** récupèrent le corps du bloc.</span><span class="sxs-lookup"><span data-stu-id="73d7e-233">Rather, subsequent calls to **GetText** and **GetValue** retrieve the body of the chunk.</span></span> <span data-ttu-id="73d7e-234">**Gettext** retourne des segments de texte, qui sont des chaînes Unicode, à partir du segment de texte de bloc actuel \_ .</span><span class="sxs-lookup"><span data-stu-id="73d7e-234">**GetText** returns text chunks, which are Unicode strings, from the current CHUNK\_TEXT chunk.</span></span> <span data-ttu-id="73d7e-235">Si le segment actuel est trop volumineux, plusieurs appels à la méthode **gettext** peuvent être nécessaires.</span><span class="sxs-lookup"><span data-stu-id="73d7e-235">If the current chunk is too large, more than one call to the **GetText** method can be required.</span></span> <span data-ttu-id="73d7e-236">Chaque appel à la méthode **gettext** récupère le texte qui suit immédiatement le texte du dernier appel à la méthode **gettext** .</span><span class="sxs-lookup"><span data-stu-id="73d7e-236">Each call to the **GetText** method retrieves text that immediately follows the text from the last call to the **GetText** method.</span></span> <span data-ttu-id="73d7e-237">Par exemple, le dernier caractère d’un appel peut être au milieu d’un mot, et le premier caractère de l’appel suivant continue ce mot.</span><span class="sxs-lookup"><span data-stu-id="73d7e-237">For example, the last character from one call can be in the middle of a word, and the first character in the next call would continue that word.</span></span> <span data-ttu-id="73d7e-238">Les moteurs de recherche doivent gérer cette situation.</span><span class="sxs-lookup"><span data-stu-id="73d7e-238">Search engines must handle this situation.</span></span>

<span data-ttu-id="73d7e-239">**GetValue** retourne des valeurs de propriété pour le segment de valeur de segment actuel \_ dans les structures PROPVARIANT, qui peuvent contenir un large éventail de types de données.</span><span class="sxs-lookup"><span data-stu-id="73d7e-239">**GetValue** returns property values for the current CHUNK\_VALUE chunk in PROPVARIANT structures, which can hold a wide variety of data types.</span></span> <span data-ttu-id="73d7e-240">**GetValue** doit allouer la structure PROPVARIANT elle-même à l’aide de CoTaskMemAlloc.</span><span class="sxs-lookup"><span data-stu-id="73d7e-240">**GetValue** must allocate the PROPVARIANT structure itself using CoTaskMemAlloc.</span></span> <span data-ttu-id="73d7e-241">L’appelant de **GetValue** est chargé de libérer la mémoire vers laquelle pointe le PROPVARIANT à l’aide de PropVariantClear, et de libérer la structure elle-même avec CoTaskMemFree.</span><span class="sxs-lookup"><span data-stu-id="73d7e-241">The caller of **GetValue** is responsible for freeing memory pointed to by the PROPVARIANT using PropVariantClear, and for freeing the structure itself with CoTaskMemFree.</span></span> <span data-ttu-id="73d7e-242">Pour plus d’informations sur PROPVARIANTs, consultez la référence [PROPVARIANT](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) .</span><span class="sxs-lookup"><span data-stu-id="73d7e-242">For more information on PROPVARIANTs, see the [PROPVARIANT](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) reference.</span></span>

### <a name="property-values"></a><span data-ttu-id="73d7e-243">Valeurs de la propriété</span><span class="sxs-lookup"><span data-stu-id="73d7e-243">Property Values</span></span>

<span data-ttu-id="73d7e-244">Les filtres doivent sortir au minimum des propriétés suivantes, qui sont les colonnes par défaut dans l’affichage des résultats de WDS.</span><span class="sxs-lookup"><span data-stu-id="73d7e-244">Filters should output at a minimum the following properties which are the default columns in the WDS results view.</span></span>



| <span data-ttu-id="73d7e-245">GUID</span><span class="sxs-lookup"><span data-stu-id="73d7e-245">GUID</span></span>                                 | <span data-ttu-id="73d7e-246">PROPSPEC</span><span class="sxs-lookup"><span data-stu-id="73d7e-246">PROPSPEC</span></span>      | <span data-ttu-id="73d7e-247">Nom convivial</span><span class="sxs-lookup"><span data-stu-id="73d7e-247">Friendly Name</span></span>  | <span data-ttu-id="73d7e-248">Description</span><span class="sxs-lookup"><span data-stu-id="73d7e-248">Description</span></span>                                                                                                                                     |
|--------------------------------------|---------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="73d7e-249">F29F85E0-4FF9-1068-AB91-08002B27B3D9</span><span class="sxs-lookup"><span data-stu-id="73d7e-249">F29F85E0-4FF9-1068-AB91-08002B27B3D9</span></span> | <span data-ttu-id="73d7e-250">2</span><span class="sxs-lookup"><span data-stu-id="73d7e-250">2</span></span>             | <span data-ttu-id="73d7e-251">PrimaryTitle</span><span class="sxs-lookup"><span data-stu-id="73d7e-251">PrimaryTitle</span></span>   | <span data-ttu-id="73d7e-252">Titre qui s’affiche pour cet élément.</span><span class="sxs-lookup"><span data-stu-id="73d7e-252">Title that displays for this item.</span></span>                                                                                                              |
| <span data-ttu-id="73d7e-253">F29F85E0-4FF9-1068-AB91-08002B27B3D9</span><span class="sxs-lookup"><span data-stu-id="73d7e-253">F29F85E0-4FF9-1068-AB91-08002B27B3D9</span></span> | <span data-ttu-id="73d7e-254">4</span><span class="sxs-lookup"><span data-stu-id="73d7e-254">4</span></span>             | <span data-ttu-id="73d7e-255">PrimaryAuthors</span><span class="sxs-lookup"><span data-stu-id="73d7e-255">PrimaryAuthors</span></span> | <span data-ttu-id="73d7e-256">Personne la plus associée à cet élément.</span><span class="sxs-lookup"><span data-stu-id="73d7e-256">Person most associated with this item.</span></span>                                                                                                          |
| <span data-ttu-id="73d7e-257">D5CDD505-2E9C-101B-9397-08002B2CF9AE</span><span class="sxs-lookup"><span data-stu-id="73d7e-257">D5CDD505-2E9C-101B-9397-08002B2CF9AE</span></span> | <span data-ttu-id="73d7e-258">PrimaryDate</span><span class="sxs-lookup"><span data-stu-id="73d7e-258">PrimaryDate</span></span>   | <span data-ttu-id="73d7e-259">PrimaryDate</span><span class="sxs-lookup"><span data-stu-id="73d7e-259">PrimaryDate</span></span>    | <span data-ttu-id="73d7e-260">Date la plus importante pour l’élément, par exemple la date de réception de l’e-mail ou la modification des fichiers.</span><span class="sxs-lookup"><span data-stu-id="73d7e-260">Most important date for item, like date received for email or modified for files.</span></span>                                                               |
| <span data-ttu-id="73d7e-261">D5CDD505-2E9C-101B-9397-08002B2CF9AE</span><span class="sxs-lookup"><span data-stu-id="73d7e-261">D5CDD505-2E9C-101B-9397-08002B2CF9AE</span></span> | <span data-ttu-id="73d7e-262">PerceivedType</span><span class="sxs-lookup"><span data-stu-id="73d7e-262">PerceivedType</span></span> | <span data-ttu-id="73d7e-263">PerceivedType</span><span class="sxs-lookup"><span data-stu-id="73d7e-263">PerceivedType</span></span>  | <span data-ttu-id="73d7e-264">Type de fichier en cours d’analyse.</span><span class="sxs-lookup"><span data-stu-id="73d7e-264">Type of file being parsed.</span></span> <span data-ttu-id="73d7e-265">Doit correspondre à l’un des types de recherche Windows Desktop listés dans le type de WDS [perçu](-search-2x-wds-perceivedtype.md).</span><span class="sxs-lookup"><span data-stu-id="73d7e-265">Must match one of the Windows Desktop Search types listed in WDS [Perceived Type](-search-2x-wds-perceivedtype.md).</span></span> |



 

<span data-ttu-id="73d7e-266">Pour les éléments en texte clair, WDS extrait toutes les propriétés définies par le système, telles que la taille ou l’extension du fichier, en incluant de nouveaux types de fichiers en texte brut à l’index.</span><span class="sxs-lookup"><span data-stu-id="73d7e-266">For plaintext items, WDS extracts all text and system-defined properties such as file size or extension on including new plaintext file types to the index).</span></span> <span data-ttu-id="73d7e-267">Les autres types de propriétés qui peuvent être retournées à l’index sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="73d7e-267">Other types of properties that can be returned to the index include:</span></span>

-   <span data-ttu-id="73d7e-268">Pour les fichiers : auteur, titre, État, Mots clés</span><span class="sxs-lookup"><span data-stu-id="73d7e-268">For files: author, title, status, keywords</span></span>
-   <span data-ttu-id="73d7e-269">Pour le média : album, genre, marque de caméra, date de prise</span><span class="sxs-lookup"><span data-stu-id="73d7e-269">For media: album, genre, camera make, date taken</span></span>
-   <span data-ttu-id="73d7e-270">Pour les communications : de, à, CC, importance</span><span class="sxs-lookup"><span data-stu-id="73d7e-270">For communications: from, to, cc, importance</span></span>
-   <span data-ttu-id="73d7e-271">Pour les contacts : poste, téléphone professionnel, entreprise</span><span class="sxs-lookup"><span data-stu-id="73d7e-271">For contacts: job title, business phone, company</span></span>

<span data-ttu-id="73d7e-272">La liste ci-dessus regroupe les propriétés communes à un type perçu spécifié ; Toutefois, toute propriété peut être utilisée quel que soit le type.</span><span class="sxs-lookup"><span data-stu-id="73d7e-272">The list above groups properties common to a specified Perceived Type; however, any property can be used regardless of the type.</span></span> <span data-ttu-id="73d7e-273">Par exemple, la société peut être utilisée pour le nom de l’employeur d’un contact et peut également être utilisée pour faire référence au nom d’un client auquel le fichier est associé.</span><span class="sxs-lookup"><span data-stu-id="73d7e-273">For example, company could be used for a contact's employer name and could also be used to refer to the name of a client the file relates to.</span></span> <span data-ttu-id="73d7e-274">Un grand nombre de ces propriétés sont utilisées pour afficher les résultats de la recherche dans l’affichage des résultats WDS.</span><span class="sxs-lookup"><span data-stu-id="73d7e-274">Many of these properties are used to display search results in the WDS results view.</span></span> <span data-ttu-id="73d7e-275">Par exemple, la propriété titre d’un fichier est affichée en tant que colonne principale dans la vue des résultats par défaut.</span><span class="sxs-lookup"><span data-stu-id="73d7e-275">For example, a file's Title property is shown as the main column in the default results view.</span></span> <span data-ttu-id="73d7e-276">Les objets IFilter doivent générer toutes les propriétés associées au type d’élément qu’ils analysent.</span><span class="sxs-lookup"><span data-stu-id="73d7e-276">IFilter objects should output all the properties related to the item type they are parsing.</span></span> <span data-ttu-id="73d7e-277">Impossible d’ajouter des propriétés personnalisées dans WDS 2. x.</span><span class="sxs-lookup"><span data-stu-id="73d7e-277">Custom properties cannot be added in WDS 2.x.</span></span> <span data-ttu-id="73d7e-278">Pour obtenir la liste complète des propriétés disponibles, consultez le [schéma WDS](-search-2x-wds-schematable.md).</span><span class="sxs-lookup"><span data-stu-id="73d7e-278">For a full list of properties available, see the [WDS Schema](-search-2x-wds-schematable.md).</span></span>

## <a name="filter-add-in-installation"></a><span data-ttu-id="73d7e-279">Filtrer l’installation du complément</span><span class="sxs-lookup"><span data-stu-id="73d7e-279">Filter Add-in Installation</span></span>

<span data-ttu-id="73d7e-280">L’installation du filtre implique la copie de la DLL à un emplacement approprié dans le répertoire Program Files et son inscription.</span><span class="sxs-lookup"><span data-stu-id="73d7e-280">Installing the filter involves copying the DLL to an appropriate location in the Program Files directory and registering it.</span></span> <span data-ttu-id="73d7e-281">Les filtres doivent implémenter l’inscription automatique pour l’installation et doivent suivre les instructions suivantes :</span><span class="sxs-lookup"><span data-stu-id="73d7e-281">Filters should implement self-registration for installation and should follow these guidelines:</span></span>

-   <span data-ttu-id="73d7e-282">Le programme d’installation doit utiliser le programme d’installation EXE ou MSI.</span><span class="sxs-lookup"><span data-stu-id="73d7e-282">The installer must use either EXE or MSI installer.</span></span>
-   <span data-ttu-id="73d7e-283">Des notes de publication doivent être fournies.</span><span class="sxs-lookup"><span data-stu-id="73d7e-283">Release notes must be provided.</span></span>
-   <span data-ttu-id="73d7e-284">Une entrée **Ajout/suppression de programmes** doit être créée pour chaque complément installé.</span><span class="sxs-lookup"><span data-stu-id="73d7e-284">An **Add/Remove Programs** entry must be created for each add-in installed.</span></span>
-   <span data-ttu-id="73d7e-285">Le programme d’installation doit prendre en charge tous les paramètres du Registre pour le type de fichier spécifique ou le magasin que le complément actuel comprend.</span><span class="sxs-lookup"><span data-stu-id="73d7e-285">The installer must take over all registry settings for the particular file type or store that the current add-in understands.</span></span>
-   <span data-ttu-id="73d7e-286">Si un complément précédent est remplacé, le programme d’installation doit avertir l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="73d7e-286">If a previous add-in is being overwritten, the installer should notify the user.</span></span>
-   <span data-ttu-id="73d7e-287">Si un complément plus récent a remplacé le complément précédent, il devrait y avoir la possibilité de restaurer les fonctionnalités du complément précédent et de le faire en tant que complément par défaut pour ce type de fichier ou en magasin.</span><span class="sxs-lookup"><span data-stu-id="73d7e-287">If a newer add-in has overwritten the previous add-in, there should be the ability to restore the previous add-in's functionality and make it the default add-in for that file type or store again.</span></span>

### <a name="clsids-required-for-registration"></a><span data-ttu-id="73d7e-288">CLSID requis pour l’inscription</span><span class="sxs-lookup"><span data-stu-id="73d7e-288">CLSIDs Required for Registration</span></span>

<span data-ttu-id="73d7e-289">Il existe trois identificateurs de classe, ou CLSID, associés à chaque filtre.</span><span class="sxs-lookup"><span data-stu-id="73d7e-289">There are three class identifiers, or CLSIDs, associated with every filter.</span></span> <span data-ttu-id="73d7e-290">Vous devez générer un ou plusieurs de ces (utilisez uuidgen.exe) pour inscrire votre complément de filtre.</span><span class="sxs-lookup"><span data-stu-id="73d7e-290">You'll need to generate one or more of these (use uuidgen.exe) to register your filter add-in.</span></span>

-   <span data-ttu-id="73d7e-291">La première identifie tous les filtres « gestionnaire persistant », IID \_ IFilter, qui est {89BCB740-6119-101A-BCB7-00DD010655AF}.</span><span class="sxs-lookup"><span data-stu-id="73d7e-291">The first identifies all filters' persistent handler, IID\_IFilter, which is {89BCB740-6119-101A-BCB7-00DD010655AF}.</span></span> <span data-ttu-id="73d7e-292">Ce CLSID est constant pour tous les filtres qui implémentent IFilter.</span><span class="sxs-lookup"><span data-stu-id="73d7e-292">This CLSID is constant for all filters that implement IFilter.</span></span>
-   <span data-ttu-id="73d7e-293">La seconde (la valeur de la clé IID d’IID \_ ) identifie l’implémentation IFilter pour votre type de fichier.</span><span class="sxs-lookup"><span data-stu-id="73d7e-293">The second (the value of the IID\_IFilter key) identifies the IFilter implementation for your file type.</span></span> <span data-ttu-id="73d7e-294">Cette clé contient une valeur InprocServer32 qui spécifie le nom de la DLL par chemin d’accès et le modèle de thread.</span><span class="sxs-lookup"><span data-stu-id="73d7e-294">This key contains an InprocServer32 value that specifies the DLL name by path and the threading model.</span></span> <span data-ttu-id="73d7e-295">Si le filtre se trouve dans le chemin système, comme le répertoire system32, un nom de fichier suffit.</span><span class="sxs-lookup"><span data-stu-id="73d7e-295">If the filter is in the system path, like the system32 directory, a file name is sufficient.</span></span> <span data-ttu-id="73d7e-296">Dans le cas contraire, cette valeur doit avoir une spécification de chemin d’accès complet.</span><span class="sxs-lookup"><span data-stu-id="73d7e-296">Otherwise, this value should have a full path specification.</span></span>
-   <span data-ttu-id="73d7e-297">La troisième identifie le type de fichier traité par le filtre et est retourné par la méthode GetClassID sur votre interface IPersist.</span><span class="sxs-lookup"><span data-stu-id="73d7e-297">The third identifies the file type the filter processes and is returned by the GetClassID method on your IPersist interface.</span></span>

> [!Note]
>
> <span data-ttu-id="73d7e-298">Dans les versions ultérieures des systèmes d’exploitation Microsoft, l’installation de fichiers dans le répertoire system32 peut devenir plus difficile. nous vous recommandons donc de les installer sous Program Files et d’inclure un chemin d’accès complet au filtre dans le registre.</span><span class="sxs-lookup"><span data-stu-id="73d7e-298">In future versions of Microsoft operating systems, installing files in the system32 directory may get more difficult, so we recommend you install them under Program Files and include a full path to the filter in the registry.</span></span> <span data-ttu-id="73d7e-299">Pour des raisons de sécurité, il est également prudent de spécifier un chemin d’accès complet à votre DLL dans le registre.</span><span class="sxs-lookup"><span data-stu-id="73d7e-299">For security reasons, it is also prudent to specify a full path to your DLL in the registry.</span></span> <span data-ttu-id="73d7e-300">Dans le cas contraire, une version « cheval de Troie » de votre DLL pourrait être chargée si elle se trouve dans le chemin d’accès du processus avant votre version.</span><span class="sxs-lookup"><span data-stu-id="73d7e-300">Otherwise, a "Trojan horse" version of your DLL could be loaded if it happens to be in the process path before your version.</span></span>

 

### <a name="registration-model"></a><span data-ttu-id="73d7e-301">Modèle d’inscription</span><span class="sxs-lookup"><span data-stu-id="73d7e-301">Registration Model</span></span>

<span data-ttu-id="73d7e-302">Lorsque WDS est prêt à filtrer un fichier, il consulte le Registre sous l’extension du fichier pour déterminer le filtre à charger.</span><span class="sxs-lookup"><span data-stu-id="73d7e-302">When WDS is ready to filter a file, it looks in the registry under the file's extension to determine which filter to load.</span></span> <span data-ttu-id="73d7e-303">Il suit ensuite une série de liens de Registre pour rechercher le nom de la DLL de filtre, dans cet ordre :</span><span class="sxs-lookup"><span data-stu-id="73d7e-303">It then follows a series of registry links to find the name of the filter DLL, in this order:</span></span>

1.  <span data-ttu-id="73d7e-304">À partir de CLSID situés à l’emplacement suivant :</span><span class="sxs-lookup"><span data-stu-id="73d7e-304">From CLSIDs located at:</span></span>

    <span data-ttu-id="73d7e-305">**HKEY \_ Current \_ User \\ Software \\ Microsoft \\ RSSearch \\ ContentIndexCommon \\ Filters \\ override \\ RSApp**</span><span class="sxs-lookup"><span data-stu-id="73d7e-305">**HKEY\_CURRENT\_USER\\SOFTWARE\\Microsoft\\RSSearch\\ContentIndexCommon\\Filters\\Override\\RSApp**</span></span>

    <span data-ttu-id="73d7e-306">**HKEY \_ Current \_ User \\ Software \\ Microsoft \\ RSSearch \\ ContentIndexCommon \\ Filters**</span><span class="sxs-lookup"><span data-stu-id="73d7e-306">**HKEY\_CURRENT\_USER\\SOFTWARE\\Microsoft\\RSSearch\\ContentIndexCommon\\Filters**</span></span>

2.  <span data-ttu-id="73d7e-307">À partir du type de contenu de fichier à :</span><span class="sxs-lookup"><span data-stu-id="73d7e-307">From the file content type at:</span></span>

    <span data-ttu-id="73d7e-308">**HKEY \_ local \_ machine \\ classes logicielles \\ \\ \\ type de contenu de base de données MIME \\**</span><span class="sxs-lookup"><span data-stu-id="73d7e-308">**HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Classes\\MIME\\Database\\Content Type**</span></span>

3.  <span data-ttu-id="73d7e-309">À partir de l’extension de nom de fichier (identique à l’API LoadIFilter Win32) à l’adresse :</span><span class="sxs-lookup"><span data-stu-id="73d7e-309">From the file name extension (same as Win32 LoadIFilter API) at:</span></span>

    <span data-ttu-id="73d7e-310">**HKEY \_ Current \_ User \\ Software \\ Microsoft \\ RSSearch \\ ContentIndexCommon \\ Filters \\ override \\ RSApp**</span><span class="sxs-lookup"><span data-stu-id="73d7e-310">**HKEY\_CURRENT\_USER\\SOFTWARE\\Microsoft\\RSSearch\\ContentIndexCommon\\Filters\\Override\\RSApp**</span></span>

    <span data-ttu-id="73d7e-311">**HKEY \_ Current \_ User \\ Software \\ Microsoft \\ RSSearch \\ ContentIndexCommon \\ Filters**</span><span class="sxs-lookup"><span data-stu-id="73d7e-311">**HKEY\_CURRENT\_USER\\SOFTWARE\\Microsoft\\RSSearch\\ContentIndexCommon\\Filters**</span></span>

    <span data-ttu-id="73d7e-312">**HKEY \_ classes \_ racine \\ EXTPERSISTENTHANDLER->CLSID->IID IID \_ ->CLSID**</span><span class="sxs-lookup"><span data-stu-id="73d7e-312">**HKEY\_CLASSES\_ROOT\\extpersistentHandler->CLSID->IID\_IFilter->CLSID**</span></span>

4.  <span data-ttu-id="73d7e-313">À partir de la valeur par défaut :</span><span class="sxs-lookup"><span data-stu-id="73d7e-313">From Default at:</span></span>

    <span data-ttu-id="73d7e-314">**HKEY \_ local \_ machine \\ Software \\ Microsoft \\ RSSearch \\ ContentIndexCommon \\ filtres**</span><span class="sxs-lookup"><span data-stu-id="73d7e-314">**HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\RSSearch\\ContentIndexCommon\\Filters**</span></span>

### <a name="to-register-a-filter-add-in"></a><span data-ttu-id="73d7e-315">Pour inscrire un complément de filtre</span><span class="sxs-lookup"><span data-stu-id="73d7e-315">To Register a Filter Add-in</span></span>

<span data-ttu-id="73d7e-316">Vous devez faire un total de huit entrées dans le registre pour inscrire votre complément de filtre, où :</span><span class="sxs-lookup"><span data-stu-id="73d7e-316">You need to make a total of eight entries in the registry to register your filter add-in, where:</span></span>

-   <span data-ttu-id="73d7e-317">**. ext** est la nouvelle extension de nom de fichier</span><span class="sxs-lookup"><span data-stu-id="73d7e-317">**.ext** is the new file name extension</span></span>
-   <span data-ttu-id="73d7e-318">Le **GUID \_ 1** peut être n’importe quel nouveau GUID généré pour cette extension</span><span class="sxs-lookup"><span data-stu-id="73d7e-318">**GUID\_1** can be any new GUID generated for this extension</span></span>
-   <span data-ttu-id="73d7e-319">**89BCB740-6119-101A-BCB7-00DD010655AF** est le GUID d’interface IFilter, qui est une constante pour toutes les implémentations IFilter.</span><span class="sxs-lookup"><span data-stu-id="73d7e-319">**89BCB740-6119-101A-BCB7-00DD010655AF** is the IFilter interface GUID, which is a constant for all IFilter implementations.</span></span>

1.  <span data-ttu-id="73d7e-320">Enregistrez le gestionnaire persistant pour l’extension de nom de fichier avec les clés et valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="73d7e-320">Register the persistent handler for the file name extension with the following keys and values:</span></span>

    ```
    HKEY_CLASSES_ROOT\<.ext>\PersistentHandler
       (Default) = {GUID_1}
    ```

    ```
    HKEY_CLASSES_ROOT\CLSID\{GUID_1}
       (Default) = <Persistent Handler Description>
    ```

    ```
    HKEY_CLASSES_ROOT\CLSID\{GUID_1}\PersistentAddinsRegistered
       (Default) = (Value Not Set)
    ```

    ```
    HKEY_CLASSES_ROOT\CLSID\{GUID_1}\PersistentAddinsRegistered\{89BCB740-6119-101A-BCB7-00DD010655AF}
       (Default) = {CLSID of IFilter implementation}
    ```

    ```
    HKEY_CLASSES_ROOT\CLSID\{GUID_1}\PersistentHandler
       (Default) = {GUID_1}
    ```

2.  <span data-ttu-id="73d7e-321">Inscrivez l’implémentation IFilter avec les clés et valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="73d7e-321">Register the IFilter implementation with the following keys and values:</span></span>

    ```
    HKEY_CLASSES_ROOT\CLSID\{CLSID of IFilter implementation}
       (Default) = Extension IFilter Description">
    ```

    ```
    HKEY_CLASSES_ROOT\CLSID\{CLSID of IFilter implementation}\InprocServer32
       (Default) = <DLL Install Path>
       ThreadingModel = Both
    ```

3.  <span data-ttu-id="73d7e-322">Inscrivez l’implémentation IFilter avec Windows Desktop Search avec la clé et la valeur suivantes :</span><span class="sxs-lookup"><span data-stu-id="73d7e-322">Register the IFilter implementation with Windows Desktop Search with the following key and value:</span></span>

    ```
    HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\RSSearch\ContentIndexCommon\Filters\Extension\<.ext>
       (Default) = {CLSID of IFilter implementation}"
    ```

## <a name="related-topics"></a><span data-ttu-id="73d7e-323">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="73d7e-323">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="73d7e-324">**Informations de référence**</span><span class="sxs-lookup"><span data-stu-id="73d7e-324">**Reference**</span></span>
</dt> <dt>

[<span data-ttu-id="73d7e-325">SchemaTable</span><span class="sxs-lookup"><span data-stu-id="73d7e-325">SchemaTable</span></span>](-search-2x-wds-schematable.md)
</dt> <dt>

[<span data-ttu-id="73d7e-326">Types perçus</span><span class="sxs-lookup"><span data-stu-id="73d7e-326">Perceived Types</span></span>](-search-2x-wds-perceivedtype.md)
</dt> <dt>

[<span data-ttu-id="73d7e-327">Développement de gestionnaires de protocole</span><span class="sxs-lookup"><span data-stu-id="73d7e-327">Developing Protocol Handlers</span></span>](-search-2x-wds-phaddins.md)
</dt> <dt>

<span data-ttu-id="73d7e-328">**Autres ressources**</span><span class="sxs-lookup"><span data-stu-id="73d7e-328">**Other Resources**</span></span>
</dt> <dt>

[<span data-ttu-id="73d7e-329">**Filtres**</span><span class="sxs-lookup"><span data-stu-id="73d7e-329">**IFilter**</span></span>](/windows/desktop/api/filter/nn-filter-ifilter)
</dt> </dl>

 

 