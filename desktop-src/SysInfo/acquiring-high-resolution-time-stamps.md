---
description: Windows fournit des API que vous pouvez utiliser pour acquérir des horodatages haute résolution ou mesurer des intervalles de temps.
ms.assetid: D66E0FC2-3AF2-489B-B4B5-78648905B77B
title: Acquisition d’horodatages haute résolution
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c9a1300967738b717ab8d8c822bf2af3f6a4a7ed
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103953245"
---
# <a name="acquiring-high-resolution-time-stamps"></a><span data-ttu-id="d70d0-103">Acquisition d’horodatages haute résolution</span><span class="sxs-lookup"><span data-stu-id="d70d0-103">Acquiring high-resolution time stamps</span></span>

<span data-ttu-id="d70d0-104">Windows fournit des API que vous pouvez utiliser pour acquérir des horodatages haute résolution ou mesurer des intervalles de temps.</span><span class="sxs-lookup"><span data-stu-id="d70d0-104">Windows provides APIs that you can use to acquire high-resolution time stamps or measure time intervals.</span></span> <span data-ttu-id="d70d0-105">L’API principale pour le code natif est [**QueryPerformanceCounter (QPC)**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="d70d0-105">The primary API for native code is [**QueryPerformanceCounter (QPC)**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="d70d0-106">Pour les pilotes de périphérique, l’API en mode noyau est [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="d70d0-106">For device drivers, the kernel-mode API is [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter).</span></span> <span data-ttu-id="d70d0-107">Pour le code managé, la classe [**System. Diagnostics. chronomètre**](/previous-versions/windows/) utilise **QPC** comme heure précise.</span><span class="sxs-lookup"><span data-stu-id="d70d0-107">For managed code, the [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class uses **QPC** as its precise time basis.</span></span>

<span data-ttu-id="d70d0-108">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) est indépendant de et n’est pas synchronisé avec les références d’heure externes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-108">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is independent of and isn't synchronized to any external time reference.</span></span> <span data-ttu-id="d70d0-109">Pour récupérer les horodatages qui peuvent être synchronisés avec une référence horaire externe, par exemple, le temps universel coordonné (UTC, Universal Time Coordinated) pour une utilisation dans des mesures à un moment donné dans le temps de haute résolution, utilisez [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="d70d0-109">To retrieve time stamps that can be synchronized to an external time reference, such as, Coordinated Universal Time (UTC) for use in high-resolution time-of-day measurements, use [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span>

<span data-ttu-id="d70d0-110">Les horodatages et les mesures de l’intervalle de temps font partie intégrante des mesures de performances de l’ordinateur et du réseau.</span><span class="sxs-lookup"><span data-stu-id="d70d0-110">Time stamps and time-interval measurements are an integral part of computer and network performance measurements.</span></span> <span data-ttu-id="d70d0-111">Ces opérations de mesure des performances incluent le calcul du temps de réponse, le débit et la latence, ainsi que l’exécution du code de profilage.</span><span class="sxs-lookup"><span data-stu-id="d70d0-111">These performance measurement operations include the computation of response time, throughput, and latency as well as profiling code execution.</span></span> <span data-ttu-id="d70d0-112">Chacune de ces opérations implique une mesure des activités qui se produisent pendant un intervalle de temps défini par un événement de début et de fin qui peut être indépendant de toute référence au moment de la journée externe.</span><span class="sxs-lookup"><span data-stu-id="d70d0-112">Each of these operations involves a measurement of activities that occur during a time interval that is defined by a start and an end event that can be independent of any external time-of-day reference.</span></span>

<span data-ttu-id="d70d0-113">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) est généralement la meilleure méthode pour utiliser les événements d’horodatage et mesurer les petits intervalles de temps qui se produisent sur le même système ou la même machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d70d0-113">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is typically the best method to use to time-stamp events and measure small time intervals that occur on the same system or virtual machine.</span></span> <span data-ttu-id="d70d0-114">Envisagez d’utiliser [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) lorsque vous souhaitez horodater des événements sur plusieurs ordinateurs, à condition que chaque ordinateur participe à un schéma de synchronisation horaire tel que NTP (Network Time Protocol).</span><span class="sxs-lookup"><span data-stu-id="d70d0-114">Consider using [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) when you want to time-stamp events across multiple machines, provided that each machine is participating in a time synchronization scheme such as Network Time Protocol (NTP).</span></span> <span data-ttu-id="d70d0-115">**QPC** vous aide à éviter les difficultés qui peuvent être rencontrées avec d’autres approches de mesure du temps, telles que la lecture directe du compteur d’horodatage du processeur (TSC).</span><span class="sxs-lookup"><span data-stu-id="d70d0-115">**QPC** helps you avoid difficulties that can be encountered with other time measurement approaches, such as reading the processor’s time stamp counter (TSC) directly.</span></span>

-   [<span data-ttu-id="d70d0-116">Prise en charge de QPC dans les versions de Windows</span><span class="sxs-lookup"><span data-stu-id="d70d0-116">QPC support in Windows versions</span></span>](#qpc-support-in-windows-versions)
-   [<span data-ttu-id="d70d0-117">Conseils pour l’acquisition d’horodatages</span><span class="sxs-lookup"><span data-stu-id="d70d0-117">Guidance for acquiring time stamps</span></span>](#guidance-for-acquiring-time-stamps)
    -   [<span data-ttu-id="d70d0-118">Virtualisation</span><span class="sxs-lookup"><span data-stu-id="d70d0-118">Virtualization</span></span>](#virtualization)
    -   [<span data-ttu-id="d70d0-119">Utilisation directe du TSC</span><span class="sxs-lookup"><span data-stu-id="d70d0-119">Direct TSC usage</span></span>](#direct-tsc-usage)
    -   [<span data-ttu-id="d70d0-120">Exemples d’acquisition d’horodatages</span><span class="sxs-lookup"><span data-stu-id="d70d0-120">Examples for acquiring time stamps</span></span>](#examples-for-acquiring-time-stamps)
-   [<span data-ttu-id="d70d0-121">FAQ générale sur QPC et TSC</span><span class="sxs-lookup"><span data-stu-id="d70d0-121">General FAQ about QPC and TSC</span></span>](#general-faq-about-qpc-and-tsc)
-   [<span data-ttu-id="d70d0-122">FAQ sur la programmation avec QPC et TSC</span><span class="sxs-lookup"><span data-stu-id="d70d0-122">FAQ about programming with QPC and TSC</span></span>](#faq-about-programming-with-qpc-and-tsc)
-   [<span data-ttu-id="d70d0-123">Caractéristiques de l’horloge matérielle de bas niveau</span><span class="sxs-lookup"><span data-stu-id="d70d0-123">Low-level hardware clock characteristics</span></span>](#low-level-hardware-clock-characteristics)
    -   [<span data-ttu-id="d70d0-124">Horloges absolues et horloges de différence</span><span class="sxs-lookup"><span data-stu-id="d70d0-124">Absolute Clocks and Difference Clocks</span></span>](#absolute-clocks-and-difference-clocks)
    -   [<span data-ttu-id="d70d0-125">Résolution, précision, précision et stabilité</span><span class="sxs-lookup"><span data-stu-id="d70d0-125">Resolution, Precision, Accuracy, and Stability</span></span>](#resolution-precision-accuracy-and-stability)
-   [<span data-ttu-id="d70d0-126">Informations sur la minuterie matérielle</span><span class="sxs-lookup"><span data-stu-id="d70d0-126">Hardware timer info</span></span>](#hardware-timer-info)

## <a name="qpc-support-in-windows-versions"></a><span data-ttu-id="d70d0-127">Prise en charge de QPC dans les versions de Windows</span><span class="sxs-lookup"><span data-stu-id="d70d0-127">QPC support in Windows versions</span></span>

<span data-ttu-id="d70d0-128">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) a été introduit dans Windows 2000 et Windows XP et a évolué pour tirer parti des améliorations apportées à la plate-forme matérielle et aux processeurs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-128">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) was introduced in Windows 2000 and Windows XP and has evolved to take advantage of improvements in the hardware platform and processors.</span></span> <span data-ttu-id="d70d0-129">Ici, nous décrivons les caractéristiques de **QPC** sur différentes versions de Windows pour vous aider à gérer les logiciels qui s’exécutent sur ces versions de Windows.</span><span class="sxs-lookup"><span data-stu-id="d70d0-129">Here we describe the characteristics of **QPC** on different Windows versions to help you maintain software that runs on those Windows versions.</span></span>

### <a name="windows-xp-and-windows-2000"></a><span data-ttu-id="d70d0-130">Windows XP et Windows 2000</span><span class="sxs-lookup"><span data-stu-id="d70d0-130">Windows XP and Windows 2000</span></span>

<span data-ttu-id="d70d0-131">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) est disponible sur Windows XP et Windows 2000 et fonctionne bien sur la plupart des systèmes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-131">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is available on Windows XP and Windows 2000 and works well on most systems.</span></span> <span data-ttu-id="d70d0-132">Toutefois, le BIOS de certains systèmes matériels n’indique pas correctement les caractéristiques de l’UC matérielle (TSC non indifférent), et certains systèmes à plusieurs cœurs ou multiprocesseurs utilisaient des processeurs avec TSCs qui n’ont pas pu être synchronisés entre les cœurs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-132">However, some hardware systems' BIOS didn't indicate the hardware CPU characteristics correctly (a non-invariant TSC), and some multi-core or multi-processor systems used processors with TSCs that couldn't be synchronized across cores.</span></span> <span data-ttu-id="d70d0-133">Les systèmes avec un microprogramme défectueux qui exécutent ces versions de Windows peuvent ne pas fournir la même **QPC** de lecture sur différents cœurs s’ils ont utilisé le TSC comme base pour **QPC**.</span><span class="sxs-lookup"><span data-stu-id="d70d0-133">Systems with flawed firmware that run these versions of Windows might not provide the same **QPC** reading on different cores if they used the TSC as the basis for **QPC**.</span></span>

### <a name="windows-vista-and-windows-server-2008"></a><span data-ttu-id="d70d0-134">Windows Vista et Windows Server 2008</span><span class="sxs-lookup"><span data-stu-id="d70d0-134">Windows Vista and Windows Server 2008</span></span>

<span data-ttu-id="d70d0-135">Tous les ordinateurs livrés avec Windows Vista et Windows Server 2008 utilisaient un compteur de plateforme (High Precision Event Timer (HPET)) ou le minuteur de gestion de l’alimentation ACPI (minuteur PM) comme base pour [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="d70d0-135">All computers that shipped with Windows Vista and Windows Server 2008 used a platform counter (High Precision Event Timer (HPET)) or the ACPI Power Management Timer (PM timer) as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="d70d0-136">Ces minuteurs de plateforme ont une latence d’accès plus élevée que le TSC et sont partagés entre plusieurs processeurs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-136">Such platform timers have higher access latency than the TSC and are shared between multiple processors.</span></span> <span data-ttu-id="d70d0-137">Cela limite l’extensibilité de **QPC** si elle est appelée simultanément à partir de plusieurs processeurs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-137">This limits scalability of **QPC** if it is called concurrently from multiple processors.</span></span>

### <a name="windows-7-and-windows-server-2008-r2"></a><span data-ttu-id="d70d0-138">Windows 7 et Windows Server 2008 R2</span><span class="sxs-lookup"><span data-stu-id="d70d0-138">Windows 7 and Windows Server 2008 R2</span></span>

<span data-ttu-id="d70d0-139">La majorité des ordinateurs Windows 7 et Windows Server 2008 R2 disposent de processeurs avec TSCs à débit constant et utilisent ces compteurs comme base pour [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="d70d0-139">The majority of Windows 7 and Windows Server 2008 R2 computers have processors with constant-rate TSCs and use these counters as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="d70d0-140">Les TSCs sont des compteurs matériels à haute résolution par processeur qui sont accessibles avec une latence et une surcharge très faibles (dans l’ordre des dizaines ou des centaines de cycles d’ordinateur, selon le type de processeur).</span><span class="sxs-lookup"><span data-stu-id="d70d0-140">TSCs are high-resolution per-processor hardware counters that can be accessed with very low latency and overhead (in the order of 10s or 100s of machine cycles, depending on the processor type).</span></span> <span data-ttu-id="d70d0-141">Windows 7 et Windows Server 2008 R2 utilisent TSCs comme base de **QPC** sur des systèmes de domaine à une seule horloge où le système d’exploitation (ou l’hyperviseur) est en mesure de synchroniser étroitement les TSCs individuels sur tous les processeurs pendant l’initialisation du système.</span><span class="sxs-lookup"><span data-stu-id="d70d0-141">Windows 7 and Windows Server 2008 R2 use TSCs as the basis of **QPC** on single-clock domain systems where the operating system (or the hypervisor) is able to tightly synchronize the individual TSCs across all processors during system initialization.</span></span> <span data-ttu-id="d70d0-142">Sur ces systèmes, le coût de lecture du compteur de performances est nettement plus faible par rapport aux systèmes qui utilisent un compteur de plateforme.</span><span class="sxs-lookup"><span data-stu-id="d70d0-142">On such systems, the cost of reading the performance counter is significantly lower compared to systems that use a platform counter.</span></span> <span data-ttu-id="d70d0-143">En outre, il n’existe aucune surcharge supplémentaire pour les appels simultanés et les requêtes en mode utilisateur contournent souvent des appels système, ce qui réduit encore davantage la surcharge.</span><span class="sxs-lookup"><span data-stu-id="d70d0-143">Furthermore, there is no added overhead for concurrent calls and user-mode queries often bypass system calls, which further reduces overhead.</span></span> <span data-ttu-id="d70d0-144">Sur les systèmes où le TSC n’est pas adapté pour la minuterie, Windows sélectionne automatiquement un compteur de plateforme (le minuteur HPET ou le minuteur ACPI PM) comme base pour **QPC**.</span><span class="sxs-lookup"><span data-stu-id="d70d0-144">On systems where the TSC is not suitable for timekeeping, Windows automatically selects a platform counter (either the HPET timer or the ACPI PM timer) as the basis for **QPC**.</span></span>

### <a name="windows-8-windows-81-windows-server-2012-and-windows-server-2012-r2"></a><span data-ttu-id="d70d0-145">Windows 8, Windows 8.1, Windows Server 2012 et Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="d70d0-145">Windows 8, Windows 8.1, Windows Server 2012, and Windows Server 2012 R2</span></span>

<span data-ttu-id="d70d0-146">Windows 8, Windows 8.1, Windows Server 2012 et Windows Server 2012 R2 utilisent TSCs comme base pour le compteur de performances.</span><span class="sxs-lookup"><span data-stu-id="d70d0-146">Windows 8, Windows 8.1, Windows Server 2012, and Windows Server 2012 R2 use TSCs as the basis for the performance counter.</span></span> <span data-ttu-id="d70d0-147">L’algorithme de synchronisation TSC a été considérablement amélioré pour mieux prendre en charge de grands systèmes avec de nombreux processeurs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-147">The TSC synchronization algorithm was significantly improved to better accommodate large systems with many processors.</span></span> <span data-ttu-id="d70d0-148">En outre, la prise en charge de la nouvelle API précise de l’heure du jour a été ajoutée, ce qui permet d’obtenir des horodatages précis de l’horloge du système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="d70d0-148">In addition, support for the new precise time-of-day API was added, which enables acquiring precise wall clock time stamps from the operating system.</span></span> <span data-ttu-id="d70d0-149">Pour plus d’informations, consultez [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="d70d0-149">For more info, see [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span> <span data-ttu-id="d70d0-150">Sur les plateformes PC Windows RT, le compteur de performances est basé sur un compteur de plateforme propriétaire ou sur le compteur système fourni par le minuteur générique Windows RT PC si la plateforme est équipée.</span><span class="sxs-lookup"><span data-stu-id="d70d0-150">On Windows RT PC platforms, the performance counter is based on either a proprietary platform counter or the system counter provided by the Windows RT PC Generic Timer if the platform is so equipped.</span></span>

## <a name="guidance-for-acquiring-time-stamps"></a><span data-ttu-id="d70d0-151">Conseils pour l’acquisition d’horodatages</span><span class="sxs-lookup"><span data-stu-id="d70d0-151">Guidance for acquiring time stamps</span></span>

<span data-ttu-id="d70d0-152">Windows a et continuera à investir dans la fourniture d’un compteur de performances fiable et efficace.</span><span class="sxs-lookup"><span data-stu-id="d70d0-152">Windows has and will continue to invest in providing a reliable and efficient performance counter.</span></span> <span data-ttu-id="d70d0-153">Lorsque vous avez besoin d’horodatages avec une résolution de 1 microsecondes ou plus et que vous n’avez pas besoin des horodatages à synchroniser avec une référence horaire externe, choisissez [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter), [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter)ou [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise).</span><span class="sxs-lookup"><span data-stu-id="d70d0-153">When you need time stamps with a resolution of 1 microsecond or better and you don't need the time stamps to be synchronized to an external time reference, choose [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter), [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter), or [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise).</span></span> <span data-ttu-id="d70d0-154">Lorsque vous avez besoin d’horodatages synchronisés UTC avec une résolution de 1 microsecondes ou plus, choisissez [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) ou [**KeQuerySystemTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequerysystemtimeprecise).</span><span class="sxs-lookup"><span data-stu-id="d70d0-154">When you need UTC-synchronized time stamps with a resolution of 1 microsecond or better, choose [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) or [**KeQuerySystemTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequerysystemtimeprecise).</span></span>

<span data-ttu-id="d70d0-155">Sur un nombre relativement faible de plateformes qui ne peuvent pas utiliser le registre TSC comme base [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) , par exemple, pour des raisons expliquées dans informations sur la [minuterie matérielle](#hardware-timer-info), l’acquisition d’horodatages haute résolution peut être considérablement plus coûteuse que l’acquisition d’horodatages avec une résolution inférieure.</span><span class="sxs-lookup"><span data-stu-id="d70d0-155">On a relatively small number of platforms that can't use the TSC register as the [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) basis, for example, for reasons explained in [Hardware timer info](#hardware-timer-info), acquiring high resolution time stamps can be significantly more expensive than acquiring time stamps with lower resolution.</span></span> <span data-ttu-id="d70d0-156">Si la résolution de 10 à 16 millisecondes est suffisante, vous pouvez utiliser [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64), [**QueryInterruptTime**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttime), [**QueryUnbiasedInterruptTime**](/windows/win32/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttime), [**KeQueryInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttime)ou [**KeQueryUnbiasedInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryunbiasedinterrupttime) pour obtenir des horodatages qui ne sont pas synchronisés avec une référence horaire externe.</span><span class="sxs-lookup"><span data-stu-id="d70d0-156">If resolution of 10 to 16 milliseconds is sufficient, you can use [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64), [**QueryInterruptTime**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttime), [**QueryUnbiasedInterruptTime**](/windows/win32/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttime), [**KeQueryInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttime), or [**KeQueryUnbiasedInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryunbiasedinterrupttime) to obtain time stamps that aren't synchronized to an external time reference.</span></span> <span data-ttu-id="d70d0-157">Pour les horodatages synchronisés en UTC, utilisez [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) ou [**KeQuerySystemTime**](/windows-hardware/drivers/ddi/wdm/nf-wdm-kequerysystemtime~r1).</span><span class="sxs-lookup"><span data-stu-id="d70d0-157">For UTC-synchronized time stamps, use [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) or [**KeQuerySystemTime**](/windows-hardware/drivers/ddi/wdm/nf-wdm-kequerysystemtime~r1).</span></span> <span data-ttu-id="d70d0-158">Si vous avez besoin d’une résolution supérieure, vous pouvez utiliser [**QueryInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttimeprecise), [**QueryUnbiasedInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttimeprecise)ou [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise) pour obtenir des horodatages à la place.</span><span class="sxs-lookup"><span data-stu-id="d70d0-158">If higher resolution is needed, you can use [**QueryInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttimeprecise), [**QueryUnbiasedInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttimeprecise), or [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise) to obtain time stamps instead.</span></span>

<span data-ttu-id="d70d0-159">En général, les résultats des compteurs de performances sont cohérents sur tous les processeurs des systèmes multicœurs et multiprocesseurs, même s’ils sont mesurés sur différents threads ou processus.</span><span class="sxs-lookup"><span data-stu-id="d70d0-159">In general, the performance counter results are consistent across all processors in multi-core and multi-processor systems, even when measured on different threads or processes.</span></span> <span data-ttu-id="d70d0-160">Voici quelques exceptions à cette règle :</span><span class="sxs-lookup"><span data-stu-id="d70d0-160">Here are some exceptions to this rule:</span></span>

-   <span data-ttu-id="d70d0-161">Les systèmes d’exploitation antérieurs à Windows Vista qui s’exécutent sur certains processeurs peuvent violer cette cohérence pour l’une des raisons suivantes :</span><span class="sxs-lookup"><span data-stu-id="d70d0-161">Pre-Windows Vista operating systems that run on certain processors might violate this consistency because of one of these reasons:</span></span>

    -   <span data-ttu-id="d70d0-162">Les processeurs matériels ont un TSC non indifférent et le BIOS n’indique pas correctement cette condition.</span><span class="sxs-lookup"><span data-stu-id="d70d0-162">The hardware processors have a non-invariant TSC and the BIOS doesn't indicate this condition correctly.</span></span>
    -   <span data-ttu-id="d70d0-163">L’algorithme de synchronisation TSC utilisé n’était pas adapté aux systèmes avec un grand nombre de processeurs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-163">The TSC synchronization algorithm that was used wasn't suitable for systems with large numbers of processors.</span></span>

-   <span data-ttu-id="d70d0-164">Lorsque vous comparez les résultats des compteurs de performance obtenus à partir de différents threads, envisagez des valeurs qui diffèrent par un battement de ± 1 pour avoir un classement ambigu.</span><span class="sxs-lookup"><span data-stu-id="d70d0-164">When you compare performance counter results that are acquired from different threads, consider values that differ by ± 1 tick to have an ambiguous ordering.</span></span> <span data-ttu-id="d70d0-165">Si les horodatages sont tirés du même thread, cette incertitude de l’intervalle ± 1 ne s’applique pas.</span><span class="sxs-lookup"><span data-stu-id="d70d0-165">If the time stamps are taken from the same thread, this ± 1 tick uncertainty doesn't apply.</span></span> <span data-ttu-id="d70d0-166">Dans ce contexte, le terme « Tick » fait référence à un laps de temps égal à 1 ÷ (fréquence du compteur de performance obtenu de [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span><span class="sxs-lookup"><span data-stu-id="d70d0-166">In this context, the term tick refers to a period of time equal to 1 ÷ (the frequency of the performance counter obtained from [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span></span>

<span data-ttu-id="d70d0-167">Quand vous utilisez le compteur de performances sur des systèmes de serveur de grande taille avec des domaines à plusieurs horloges qui ne sont pas synchronisés dans le matériel, Windows détermine que le TSC ne peut pas être utilisé à des fins de synchronisation et sélectionne un compteur de plateforme comme base pour [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="d70d0-167">When you use the performance counter on large server systems with multiple-clock domains that aren't synchronized in hardware, Windows determines that the TSC can't be used for timing purposes and selects a platform counter as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="d70d0-168">Bien que ce scénario produise toujours des horodatages fiables, la latence d’accès et l’évolutivité sont affectées.</span><span class="sxs-lookup"><span data-stu-id="d70d0-168">While this scenario still yields reliable time stamps, the access latency and scalability is adversely affected.</span></span> <span data-ttu-id="d70d0-169">Par conséquent, comme indiqué précédemment dans les instructions d’utilisation précédentes, utilisez uniquement les API qui fournissent 1 microseconde ou une meilleure résolution lorsque cette résolution est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="d70d0-169">Therefore, as previously stated in the preceding usage guidance, only use the APIs that provide 1 microsecond or better resolution when such resolution is necessary.</span></span> <span data-ttu-id="d70d0-170">Le TSC est utilisé comme base pour les **QPC** sur des systèmes de domaine à plusieurs horloges qui incluent la synchronisation matérielle de tous les domaines d’horloge de processeur, car cela leur fait fonctionner en tant que système de domaine à horloge unique.</span><span class="sxs-lookup"><span data-stu-id="d70d0-170">The TSC is used as the basis for **QPC** on multi-clock domain systems that include hardware synchronization of all processor clock domains, as this effectively makes them function as a single clock domain system.</span></span>

<span data-ttu-id="d70d0-171">La fréquence du compteur de performances est fixée au démarrage du système et est cohérente sur tous les processeurs. vous devez donc uniquement interroger la fréquence à partir de [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) à mesure que l’application est initialisée, puis mettre en cache le résultat.</span><span class="sxs-lookup"><span data-stu-id="d70d0-171">The frequency of the performance counter is fixed at system boot and is consistent across all processors so you only need to query the frequency from [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) as the application initializes, and then cache the result.</span></span>

### <a name="virtualization"></a><span data-ttu-id="d70d0-172">Virtualisation</span><span class="sxs-lookup"><span data-stu-id="d70d0-172">Virtualization</span></span>

<span data-ttu-id="d70d0-173">Le compteur de performances est censé fonctionner de manière fiable sur toutes les machines virtuelles invitées s’exécutant sur des hyperviseurs correctement implémentés.</span><span class="sxs-lookup"><span data-stu-id="d70d0-173">The performance counter is expected to work reliably on all guest virtual machines running on correctly implemented hypervisors.</span></span> <span data-ttu-id="d70d0-174">Toutefois, les hyperviseurs qui sont conformes à l’interface de la version 1,0 de l’hyperviseur et qui surveillent l’indisponibilité du temps de référence peuvent offrir une surcharge nettement inférieure.</span><span class="sxs-lookup"><span data-stu-id="d70d0-174">However, hypervisors that comply with the hypervisor version 1.0 interface and surface the reference time enlightenment can offer substantially lower overhead.</span></span> <span data-ttu-id="d70d0-175">Pour plus d’informations sur les interfaces d’hyperviseur et les indications, consultez spécifications de l' [hyperviseur](/virtualization/hyper-v-on-windows/reference/tlfs).</span><span class="sxs-lookup"><span data-stu-id="d70d0-175">For more information about hypervisor interfaces and enlightenments, see [Hypervisor Specifications](/virtualization/hyper-v-on-windows/reference/tlfs).</span></span>

### <a name="direct-tsc-usage"></a><span data-ttu-id="d70d0-176">Utilisation directe du TSC</span><span class="sxs-lookup"><span data-stu-id="d70d0-176">Direct TSC usage</span></span>

<span data-ttu-id="d70d0-177">Nous vous déconseillons fortement d’utiliser l’instruction de processeur **RDTSC** ou **rdtscp,** pour INTERroger directement le TSC, car vous n’obtiendrez pas de résultats fiables sur certaines versions de Windows, sur les migrations dynamiques des machines virtuelles, et sur les systèmes matériels sans invariant ou synchronisation étroite des TSCs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-177">We strongly discourage using the **RDTSC** or **RDTSCP** processor instruction to directly query the TSC because you won't get reliable results on some versions of Windows, across live migrations of virtual machines, and on hardware systems without invariant or tightly synchronized TSCs.</span></span> <span data-ttu-id="d70d0-178">Au lieu de cela, nous vous encourageons à utiliser [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) pour tirer parti de l’abstraction, de la cohérence et de la portabilité qu’il offre.</span><span class="sxs-lookup"><span data-stu-id="d70d0-178">Instead, we encourage you to use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) to leverage the abstraction, consistency, and portability that it offers.</span></span>

### <a name="examples-for-acquiring-time-stamps"></a><span data-ttu-id="d70d0-179">Exemples d’acquisition d’horodatages</span><span class="sxs-lookup"><span data-stu-id="d70d0-179">Examples for acquiring time stamps</span></span>

<span data-ttu-id="d70d0-180">Les différents exemples de code de ces sections montrent comment obtenir des horodatages.</span><span class="sxs-lookup"><span data-stu-id="d70d0-180">The various code examples in these sections show how to acquire time stamps.</span></span>

### <a name="using-qpc-in-native-code"></a><span data-ttu-id="d70d0-181">Utilisation de QPC en code natif</span><span class="sxs-lookup"><span data-stu-id="d70d0-181">Using QPC in native code</span></span>

<span data-ttu-id="d70d0-182">Cet exemple montre comment utiliser [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) en code natif C et C++.</span><span class="sxs-lookup"><span data-stu-id="d70d0-182">This example shows how to use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) in C and C++ native code.</span></span>


```C++
LARGE_INTEGER StartingTime, EndingTime, ElapsedMicroseconds;
LARGE_INTEGER Frequency;

QueryPerformanceFrequency(&Frequency); 
QueryPerformanceCounter(&StartingTime);

// Activity to be timed

QueryPerformanceCounter(&EndingTime);
ElapsedMicroseconds.QuadPart = EndingTime.QuadPart - StartingTime.QuadPart;


//
// We now have the elapsed number of ticks, along with the
// number of ticks-per-second. We use these values
// to convert to the number of elapsed microseconds.
// To guard against loss-of-precision, we convert
// to microseconds *before* dividing by ticks-per-second.
//

ElapsedMicroseconds.QuadPart *= 1000000;
ElapsedMicroseconds.QuadPart /= Frequency.QuadPart;
```



### <a name="acquiring-high-resolution-time-stamps-from-managed-code"></a><span data-ttu-id="d70d0-183">Acquisition d’horodatages haute résolution à partir du code managé</span><span class="sxs-lookup"><span data-stu-id="d70d0-183">Acquiring high resolution time stamps from managed code</span></span>

<span data-ttu-id="d70d0-184">Cet exemple montre comment utiliser la classe [**System. Diagnostics. chronomètre**](/previous-versions/windows/) du code managé.</span><span class="sxs-lookup"><span data-stu-id="d70d0-184">This example shows how to use the managed code [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class.</span></span>


```CSharp
using System.Diagnostics;

long StartingTime = Stopwatch.GetTimestamp();

// Activity to be timed

long EndingTime  = Stopwatch.GetTimestamp();
long ElapsedTime = EndingTime - StartingTime;

double ElapsedSeconds = ElapsedTime * (1.0 / Stopwatch.Frequency);
```



<span data-ttu-id="d70d0-185">La classe [**System. Diagnostics. chronomètre**](/previous-versions/windows/) fournit également plusieurs méthodes pratiques pour effectuer des mesures d’intervalle de temps.</span><span class="sxs-lookup"><span data-stu-id="d70d0-185">The [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class also provides several convenient methods to perform time-interval measurements.</span></span>

### <a name="using-qpc-from-kernel-mode"></a><span data-ttu-id="d70d0-186">Utilisation de QPC à partir du mode noyau</span><span class="sxs-lookup"><span data-stu-id="d70d0-186">Using QPC from kernel mode</span></span>

<span data-ttu-id="d70d0-187">Le noyau Windows fournit un accès en mode noyau au compteur de performances par le biais de [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) à partir desquels le compteur de performance et la fréquence de performance peuvent être obtenus.</span><span class="sxs-lookup"><span data-stu-id="d70d0-187">The Windows kernel provides kernel-mode access to the performance counter through [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) from which both the performance counter and performance frequency can be obtained.</span></span> <span data-ttu-id="d70d0-188">**KeQueryPerformanceCounter** est disponible uniquement à partir du mode noyau et est fourni pour les rédacteurs de pilotes de périphériques et d’autres composants en mode noyau.</span><span class="sxs-lookup"><span data-stu-id="d70d0-188">**KeQueryPerformanceCounter** is available from kernel mode only and is provided for writers of device drivers and other kernel-mode components.</span></span>

<span data-ttu-id="d70d0-189">Cet exemple montre comment utiliser [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) en mode noyau C et C++.</span><span class="sxs-lookup"><span data-stu-id="d70d0-189">This example shows how to use [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) in C and C++ kernel mode.</span></span>


```C++
LARGE_INTEGER StartingTime, EndingTime, ElapsedMicroseconds;
LARGE_INTEGER Frequency;

StartingTime = KeQueryPerformanceCounter(&Frequency);

// Activity to be timed

EndingTime = KeQueryPerformanceCounter(NULL);
ElapsedMicroseconds.QuadPart = EndingTime.QuadPart - StartingTime.QuadPart;
ElapsedMicroseconds.QuadPart *= 1000000;
ElapsedMicroseconds.QuadPart /= Frequency.QuadPart;
```



## <a name="general-faq-about-qpc-and-tsc"></a><span data-ttu-id="d70d0-190">FAQ générale sur QPC et TSC</span><span class="sxs-lookup"><span data-stu-id="d70d0-190">General FAQ about QPC and TSC</span></span>

<span data-ttu-id="d70d0-191">Voici des réponses aux questions fréquemment posées sur [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) et TSCs en général.</span><span class="sxs-lookup"><span data-stu-id="d70d0-191">Here are answers to frequently-asked questions about [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) and TSCs in general.</span></span>

<dl> <dt>

<span data-ttu-id="d70d0-192"><span id="Is_QueryPerformanceCounter___the_same_as_the_Win32_GetTickCount___or_________GetTickCount64___function_"></span><span id="is_queryperformancecounter___the_same_as_the_win32_gettickcount___or_________gettickcount64___function_"></span><span id="IS_QUERYPERFORMANCECOUNTER___THE_SAME_AS_THE_WIN32_GETTICKCOUNT___OR_________GETTICKCOUNT64___FUNCTION_"></span>**QueryPerformanceCounter () est-il identique à la fonction Win32 GetTickCount () ou GetTickCount64 () ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-192"><span id="Is_QueryPerformanceCounter___the_same_as_the_Win32_GetTickCount___or_________GetTickCount64___function_"></span><span id="is_queryperformancecounter___the_same_as_the_win32_gettickcount___or_________gettickcount64___function_"></span><span id="IS_QUERYPERFORMANCECOUNTER___THE_SAME_AS_THE_WIN32_GETTICKCOUNT___OR_________GETTICKCOUNT64___FUNCTION_"></span>**Is QueryPerformanceCounter() the same as the Win32 GetTickCount() or GetTickCount64() function?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-193">Non.</span><span class="sxs-lookup"><span data-stu-id="d70d0-193">No.</span></span> <span data-ttu-id="d70d0-194">[**GetTickCount**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount) et [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64) ne sont pas liés à [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="d70d0-194">[**GetTickCount**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount) and [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64) aren't related to [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="d70d0-195">**GetTickCount** et **GetTickCount64** retournent le nombre de millisecondes écoulées depuis le démarrage du système.</span><span class="sxs-lookup"><span data-stu-id="d70d0-195">**GetTickCount** and **GetTickCount64** return the number of milliseconds since the system was started.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-196"><span id="Should_I_use_QPC_or_call_the_RDTSC__RDTSCP_instructions_directly_"></span><span id="should_i_use_qpc_or_call_the_rdtsc__rdtscp_instructions_directly_"></span><span id="SHOULD_I_USE_QPC_OR_CALL_THE_RDTSC__RDTSCP_INSTRUCTIONS_DIRECTLY_"></span>**Dois-je utiliser QPC ou appeler directement les instructions RDTSC/RDTSCP ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-196"><span id="Should_I_use_QPC_or_call_the_RDTSC__RDTSCP_instructions_directly_"></span><span id="should_i_use_qpc_or_call_the_rdtsc__rdtscp_instructions_directly_"></span><span id="SHOULD_I_USE_QPC_OR_CALL_THE_RDTSC__RDTSCP_INSTRUCTIONS_DIRECTLY_"></span>**Should I use QPC or call the RDTSC /RDTSCP instructions directly?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-197">Pour éviter les problèmes d’inexactitude et de portabilité, nous vous encourageons vivement à utiliser [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) au lieu d’utiliser le registre TSC ou les instructions de processeur **RDTSC** ou **rdtscp,** .</span><span class="sxs-lookup"><span data-stu-id="d70d0-197">To avoid incorrectness and portability issues, we strongly encourage you to use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) instead of using the TSC register or the **RDTSC** or **RDTSCP** processor instructions.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-198"><span id="What_is_QPC_s_relation_to_an_external_time_epoch__Can_it_be_synchronized_to_an_________external_epoch_such_as_UTC_"></span><span id="what_is_qpc_s_relation_to_an_external_time_epoch__can_it_be_synchronized_to_an_________external_epoch_such_as_utc_"></span><span id="WHAT_IS_QPC_S_RELATION_TO_AN_EXTERNAL_TIME_EPOCH__CAN_IT_BE_SYNCHRONIZED_TO_AN_________EXTERNAL_EPOCH_SUCH_AS_UTC_"></span>**Qu’est-ce que la relation entre QPC et une époque de temps externe ? Peut-il être synchronisé avec une époque externe telle que l’heure UTC ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-198"><span id="What_is_QPC_s_relation_to_an_external_time_epoch__Can_it_be_synchronized_to_an_________external_epoch_such_as_UTC_"></span><span id="what_is_qpc_s_relation_to_an_external_time_epoch__can_it_be_synchronized_to_an_________external_epoch_such_as_utc_"></span><span id="WHAT_IS_QPC_S_RELATION_TO_AN_EXTERNAL_TIME_EPOCH__CAN_IT_BE_SYNCHRONIZED_TO_AN_________EXTERNAL_EPOCH_SUCH_AS_UTC_"></span>**What is QPC’s relation to an external time epoch? Can it be synchronized to an external epoch such as UTC?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-199">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) est basé sur un compteur matériel qui ne peut pas être synchronisé avec une référence horaire externe, par exemple UTC.</span><span class="sxs-lookup"><span data-stu-id="d70d0-199">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is based on a hardware counter that can't be synchronized to an external time reference, such as UTC.</span></span> <span data-ttu-id="d70d0-200">Pour obtenir des horodatages précis au moment de la journée qui peuvent être synchronisés avec une référence UTC externe, utilisez [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="d70d0-200">For precise time-of-day time stamps that can be synchronized to an external UTC reference, use [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-201"><span id="Is_QPC_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="is_qpc_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="IS_QPC_AFFECTED_BY_DAYLIGHT_SAVINGS_TIME__LEAP_SECONDS__TIME_ZONES__OR_SYSTEM_________TIME_CHANGES_MADE_BY_THE_ADMINISTRATOR_"></span>**Le QPC est-il affecté par l’heure d’été, les secondes bissextiles, les fuseaux horaires ou les modifications de l’heure système effectuées par l’administrateur ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-201"><span id="Is_QPC_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="is_qpc_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="IS_QPC_AFFECTED_BY_DAYLIGHT_SAVINGS_TIME__LEAP_SECONDS__TIME_ZONES__OR_SYSTEM_________TIME_CHANGES_MADE_BY_THE_ADMINISTRATOR_"></span>**Is QPC affected by daylight savings time, leap seconds, time zones, or system time changes made by the administrator?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-202">Non.</span><span class="sxs-lookup"><span data-stu-id="d70d0-202">No.</span></span> <span data-ttu-id="d70d0-203">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) est complètement indépendant de l’heure système et du temps universel coordonné (UTC).</span><span class="sxs-lookup"><span data-stu-id="d70d0-203">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is completely independent of the system time and UTC.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-204"><span id="Is_QPC_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_Turbo_Boost_technology_"></span><span id="is_qpc_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_turbo_boost_technology_"></span><span id="IS_QPC_ACCURACY_AFFECTED_BY_PROCESSOR_FREQUENCY_CHANGES_CAUSED_BY_POWER_________MANAGEMENT_OR_TURBO_BOOST_TECHNOLOGY_"></span>**La précision QPC est-elle affectée par les modifications de fréquence du processeur dues à la gestion de l’alimentation ou à la technologie Turbo Boost ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-204"><span id="Is_QPC_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_Turbo_Boost_technology_"></span><span id="is_qpc_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_turbo_boost_technology_"></span><span id="IS_QPC_ACCURACY_AFFECTED_BY_PROCESSOR_FREQUENCY_CHANGES_CAUSED_BY_POWER_________MANAGEMENT_OR_TURBO_BOOST_TECHNOLOGY_"></span>**Is QPC accuracy affected by processor frequency changes caused by power management or Turbo Boost technology?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-205">Non.</span><span class="sxs-lookup"><span data-stu-id="d70d0-205">No.</span></span> <span data-ttu-id="d70d0-206">Si le processeur a un TSC invariant, le [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) n’est pas affecté par ce type de modifications.</span><span class="sxs-lookup"><span data-stu-id="d70d0-206">If the processor has an invariant TSC, the [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is not affected by these sort of changes.</span></span> <span data-ttu-id="d70d0-207">Si le processeur ne dispose pas d’un TSC invariant, **QPC** reviendra à une horloge matérielle de la plateforme qui n’est pas affectée par les modifications de fréquence du processeur ou la technologie Turbo Boost.</span><span class="sxs-lookup"><span data-stu-id="d70d0-207">If the processor doesn't have an invariant TSC, **QPC** will revert to a platform hardware timer that won't be affected by processor frequency changes or Turbo Boost technology.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-208"><span id="Does_QPC_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="does_qpc_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="DOES_QPC_RELIABLY_WORK_ON_MULTI-PROCESSOR_SYSTEMS__MULTI-CORE_SYSTEM__AND_________SYSTEMS_WITH_HYPER-THREADING_"></span>**QPC fonctionne-t-il de manière fiable sur les systèmes multiprocesseurs, le système multicœur et les systèmes avec Hyper-Threading ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-208"><span id="Does_QPC_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="does_qpc_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="DOES_QPC_RELIABLY_WORK_ON_MULTI-PROCESSOR_SYSTEMS__MULTI-CORE_SYSTEM__AND_________SYSTEMS_WITH_HYPER-THREADING_"></span>**Does QPC reliably work on multi-processor systems, multi-core system, and systems with hyper-threading?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-209">Oui</span><span class="sxs-lookup"><span data-stu-id="d70d0-209">Yes</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-210"><span id="How_do_I_determine_and_validate_that_QPC_works_on_my_machine_"></span><span id="how_do_i_determine_and_validate_that_qpc_works_on_my_machine_"></span><span id="HOW_DO_I_DETERMINE_AND_VALIDATE_THAT_QPC_WORKS_ON_MY_MACHINE_"></span>**Comment faire déterminer et vérifier que QPC fonctionne sur mon ordinateur ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-210"><span id="How_do_I_determine_and_validate_that_QPC_works_on_my_machine_"></span><span id="how_do_i_determine_and_validate_that_qpc_works_on_my_machine_"></span><span id="HOW_DO_I_DETERMINE_AND_VALIDATE_THAT_QPC_WORKS_ON_MY_MACHINE_"></span>**How do I determine and validate that QPC works on my machine?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-211">Vous n’avez pas besoin d’effectuer ces vérifications.</span><span class="sxs-lookup"><span data-stu-id="d70d0-211">You don't need to perform such checks.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-212"><span id="Which_processors_have_non-invariant_TSCs__How_can_I_check_if_my_system_has_a_________non-invariant_TSC_"></span><span id="which_processors_have_non-invariant_tscs__how_can_i_check_if_my_system_has_a_________non-invariant_tsc_"></span><span id="WHICH_PROCESSORS_HAVE_NON-INVARIANT_TSCS__HOW_CAN_I_CHECK_IF_MY_SYSTEM_HAS_A_________NON-INVARIANT_TSC_"></span>**Quels processeurs ont des TSCs non invariants ? Comment puis-je vérifier si mon système a un TSC non indifférent ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-212"><span id="Which_processors_have_non-invariant_TSCs__How_can_I_check_if_my_system_has_a_________non-invariant_TSC_"></span><span id="which_processors_have_non-invariant_tscs__how_can_i_check_if_my_system_has_a_________non-invariant_tsc_"></span><span id="WHICH_PROCESSORS_HAVE_NON-INVARIANT_TSCS__HOW_CAN_I_CHECK_IF_MY_SYSTEM_HAS_A_________NON-INVARIANT_TSC_"></span>**Which processors have non-invariant TSCs? How can I check if my system has a non-invariant TSC?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-213">Vous n’avez pas besoin d’effectuer cette vérification vous-même.</span><span class="sxs-lookup"><span data-stu-id="d70d0-213">You don't need to perform this check yourself.</span></span> <span data-ttu-id="d70d0-214">Les systèmes d’exploitation Windows effectuent plusieurs vérifications lors de l’initialisation du système pour déterminer si le TSC est approprié comme base pour [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="d70d0-214">Windows operating systems perform several checks at system initialization to determine if the TSC is suitable as a basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="d70d0-215">Toutefois, à des fins de référence, vous pouvez déterminer si votre processeur a un TSC invariant en utilisant l’une des opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="d70d0-215">However, for reference purposes, you can determine whether your processor has an invariant TSC by using one of these:</span></span>

-   <span data-ttu-id="d70d0-216">utilitaire Coreinfo.exe de Windows Sysinternals</span><span class="sxs-lookup"><span data-stu-id="d70d0-216">the Coreinfo.exe utility from Windows Sysinternals</span></span>
-   <span data-ttu-id="d70d0-217">vérification des valeurs retournées par l’instruction CPUID concernant les caractéristiques TSC</span><span class="sxs-lookup"><span data-stu-id="d70d0-217">checking the values returned by the CPUID instruction pertaining to the TSC characteristics</span></span>
-   <span data-ttu-id="d70d0-218">documentation du fabricant du processeur</span><span class="sxs-lookup"><span data-stu-id="d70d0-218">the processor manufacturer’s documentation</span></span>

<span data-ttu-id="d70d0-219">L’exemple suivant montre les informations d’invariant TSC fournies par l’utilitaire de Coreinfo.exe Windows Sysinternals ([www.sysInternals.com](https://www.sysinternals.com)).</span><span class="sxs-lookup"><span data-stu-id="d70d0-219">The following shows the TSC-INVARIANT info that is provided by the Windows Sysinternals Coreinfo.exe utility ([www.sysinternals.com](https://www.sysinternals.com)).</span></span> <span data-ttu-id="d70d0-220">Un astérisque signifie « true ».</span><span class="sxs-lookup"><span data-stu-id="d70d0-220">An asterisk means "True".</span></span>

``` syntax
> Coreinfo.exe 

Coreinfo v3.2 - Dump information on system CPU and memory topology
Copyright (C) 2008-2012 Mark Russinovich
Sysinternals - www.sysinternals.com

 <unrelated text removed>

RDTSCP          * Supports RDTSCP instruction
TSC             * Supports RDTSC instruction
TSC-DEADLINE    - Local APIC supports one-shot deadline timer
TSC-INVARIANT   * TSC runs at constant rate
```

</dd> <dt>

<span data-ttu-id="d70d0-221"><span id="Does_QPC_work_reliably_on__hardware_platforms_"></span><span id="does_qpc_work_reliably_on__hardware_platforms_"></span><span id="DOES_QPC_WORK_RELIABLY_ON__HARDWARE_PLATFORMS_"></span>**QPC fonctionne-t-il de façon fiable sur les plateformes matérielles PC Windows RT ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-221"><span id="Does_QPC_work_reliably_on__hardware_platforms_"></span><span id="does_qpc_work_reliably_on__hardware_platforms_"></span><span id="DOES_QPC_WORK_RELIABLY_ON__HARDWARE_PLATFORMS_"></span>**Does QPC work reliably on Windows RT PC hardware platforms?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-222">Oui</span><span class="sxs-lookup"><span data-stu-id="d70d0-222">Yes</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-223"><span id="How_often_does_QPC_roll_over_"></span><span id="how_often_does_qpc_roll_over_"></span><span id="HOW_OFTEN_DOES_QPC_ROLL_OVER_"></span>**Quelle est la fréquence de l’annulation de QPC ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-223"><span id="How_often_does_QPC_roll_over_"></span><span id="how_often_does_qpc_roll_over_"></span><span id="HOW_OFTEN_DOES_QPC_ROLL_OVER_"></span>**How often does QPC roll over?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-224">Au moins 100 ans du démarrage système le plus récent, et potentiellement plus longtemps en fonction du minuteur matériel sous-jacent utilisé.</span><span class="sxs-lookup"><span data-stu-id="d70d0-224">Not less than 100 years from the most recent system boot, and potentially longer based on the underlying hardware timer used.</span></span> <span data-ttu-id="d70d0-225">Pour la plupart des applications, la substitution n’est pas un problème.</span><span class="sxs-lookup"><span data-stu-id="d70d0-225">For most applications, rollover isn't a concern.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-226"><span id="What_is_the_computational_cost_of_calling_QPC_"></span><span id="what_is_the_computational_cost_of_calling_qpc_"></span><span id="WHAT_IS_THE_COMPUTATIONAL_COST_OF_CALLING_QPC_"></span>**Quel est le coût de calcul de l’appel de QPC ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-226"><span id="What_is_the_computational_cost_of_calling_QPC_"></span><span id="what_is_the_computational_cost_of_calling_qpc_"></span><span id="WHAT_IS_THE_COMPUTATIONAL_COST_OF_CALLING_QPC_"></span>**What is the computational cost of calling QPC?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-227">Le coût d’appel de calcul de [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) est déterminé principalement par la plateforme matérielle sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="d70d0-227">The computational calling cost of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is determined primarily by the underlying hardware platform.</span></span> <span data-ttu-id="d70d0-228">Si le registre TSC est utilisé comme base pour QPC, le coût de calcul est déterminé principalement par la durée de traitement d’une instruction **RDTSC** par le processeur.</span><span class="sxs-lookup"><span data-stu-id="d70d0-228">If the TSC register is used as the basis for QPC, the computational cost is determined primarily by how long the processor takes to process an **RDTSC** instruction.</span></span> <span data-ttu-id="d70d0-229">Cette période est comprise entre 10 et 10 cycles de processeur, en fonction du processeur utilisé.</span><span class="sxs-lookup"><span data-stu-id="d70d0-229">This time ranges from 10s of CPU cycles to several hundred CPU cycles depending upon the processor used.</span></span> <span data-ttu-id="d70d0-230">Si le TSC ne peut pas être utilisé, le système sélectionnera une autre durée du matériel.</span><span class="sxs-lookup"><span data-stu-id="d70d0-230">If the TSC can't be used, the system will select a different hardware time basis.</span></span> <span data-ttu-id="d70d0-231">Étant donné que ces bases de temps se trouvent sur la carte mère (par exemple, sur le pont Sud PCI ou PCH), le coût de calcul par appel est plus élevé que le TSC, et est fréquemment situé à proximité de 0,8 à 1,0 microsecondes, en fonction de la vitesse du processeur et d’autres facteurs matériels.</span><span class="sxs-lookup"><span data-stu-id="d70d0-231">Because these time bases are located on the motherboard (for example, on the PCI South Bridge or PCH), the per-call computational cost is higher than the TSC, and is frequently in the vicinity of 0.8 - 1.0 microseconds depending on processor speed and other hardware factors.</span></span> <span data-ttu-id="d70d0-232">Ce coût est dominé par le temps nécessaire pour accéder au périphérique matériel sur la carte mère.</span><span class="sxs-lookup"><span data-stu-id="d70d0-232">This cost is dominated by the time required to access the hardware device on the motherboard.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-233"><span id="Does_QPC_require_a_kernel_transition__system_call__"></span><span id="does_qpc_require_a_kernel_transition__system_call__"></span><span id="DOES_QPC_REQUIRE_A_KERNEL_TRANSITION__SYSTEM_CALL__"></span>**QPC requiert-t-il une transition de noyau (appel système) ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-233"><span id="Does_QPC_require_a_kernel_transition__system_call__"></span><span id="does_qpc_require_a_kernel_transition__system_call__"></span><span id="DOES_QPC_REQUIRE_A_KERNEL_TRANSITION__SYSTEM_CALL__"></span>**Does QPC require a kernel transition (system call)?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-234">Une transition de noyau n’est pas nécessaire si le système peut utiliser le registre TSC comme base pour [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="d70d0-234">A kernel transition is not required if the system can use the TSC register as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="d70d0-235">Si le système doit utiliser une autre base de temps, telle que la minuterie HPET ou PM, un appel système est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="d70d0-235">If the system must use a different time base, such as the HPET or PM timer, a system call is required.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-236"><span id="Is_the_performance_counter_monotonic__non-decreasing__"></span><span id="is_the_performance_counter_monotonic__non-decreasing__"></span><span id="IS_THE_PERFORMANCE_COUNTER_MONOTONIC__NON-DECREASING__"></span>**Le compteur de performances est-il monotone (non décroissant) ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-236"><span id="Is_the_performance_counter_monotonic__non-decreasing__"></span><span id="is_the_performance_counter_monotonic__non-decreasing__"></span><span id="IS_THE_PERFORMANCE_COUNTER_MONOTONIC__NON-DECREASING__"></span>**Is the performance counter monotonic (non-decreasing)?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-237">Oui</span><span class="sxs-lookup"><span data-stu-id="d70d0-237">Yes</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-238"><span id="Can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="CAN_THE_PERFORMANCE_COUNTER_BE_USED_TO_ORDER_EVENTS_IN_TIME_"></span>**Le compteur de performances peut-il être utilisé pour ordonner les événements dans le temps ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-238"><span id="Can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="CAN_THE_PERFORMANCE_COUNTER_BE_USED_TO_ORDER_EVENTS_IN_TIME_"></span>**Can the performance counter be used to order events in time?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-239">Oui.</span><span class="sxs-lookup"><span data-stu-id="d70d0-239">Yes.</span></span> <span data-ttu-id="d70d0-240">Toutefois, lors de la comparaison des résultats des compteurs de performance obtenus à partir de différents threads, les valeurs qui diffèrent par une graduation de ± 1 ont un ordre ambigu comme si elles avaient un horodatage identique.</span><span class="sxs-lookup"><span data-stu-id="d70d0-240">However, when comparing performance counter results that are acquired from different threads, values that differ by ± 1 tick have an ambiguous ordering as if they had an identical time stamp.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-241"><span id="How_accurate_is_the_performance_counter_"></span><span id="how_accurate_is_the_performance_counter_"></span><span id="HOW_ACCURATE_IS_THE_PERFORMANCE_COUNTER_"></span>**Quel est le degré de précision du compteur de performances ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-241"><span id="How_accurate_is_the_performance_counter_"></span><span id="how_accurate_is_the_performance_counter_"></span><span id="HOW_ACCURATE_IS_THE_PERFORMANCE_COUNTER_"></span>**How accurate is the performance counter?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-242">La réponse dépend de plusieurs facteurs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-242">The answer depends on a variety of factors.</span></span> <span data-ttu-id="d70d0-243">Pour plus d’informations, consultez caractéristiques de l' [horloge matérielle de bas niveau](#low-level-hardware-clock-characteristics).</span><span class="sxs-lookup"><span data-stu-id="d70d0-243">For more info, see [Low-level hardware clock characteristics](#low-level-hardware-clock-characteristics).</span></span>

</dd> </dl>

## <a name="faq-about-programming-with-qpc-and-tsc"></a><span data-ttu-id="d70d0-244">FAQ sur la programmation avec QPC et TSC</span><span class="sxs-lookup"><span data-stu-id="d70d0-244">FAQ about programming with QPC and TSC</span></span>

<span data-ttu-id="d70d0-245">Voici des réponses aux questions fréquemment posées sur la programmation avec [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) et TSCs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-245">Here are answers to frequently-asked questions about programming with [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) and TSCs.</span></span>

<dl> <dt>

<span data-ttu-id="d70d0-246"><span id="I_need_to_convert_the_QPC_output_to_milliseconds._How_can_I_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="i_need_to_convert_the_qpc_output_to_milliseconds._how_can_i_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="I_NEED_TO_CONVERT_THE_QPC_OUTPUT_TO_MILLISECONDS._HOW_CAN_I_AVOID_LOSS_OF_________PRECISION_WITH_CONVERTING_TO_DOUBLE_OR_FLOAT_"></span>**Je dois convertir la sortie QPC en millisecondes. Comment puis-je éviter la perte de précision lors de la conversion en double ou float ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-246"><span id="I_need_to_convert_the_QPC_output_to_milliseconds._How_can_I_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="i_need_to_convert_the_qpc_output_to_milliseconds._how_can_i_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="I_NEED_TO_CONVERT_THE_QPC_OUTPUT_TO_MILLISECONDS._HOW_CAN_I_AVOID_LOSS_OF_________PRECISION_WITH_CONVERTING_TO_DOUBLE_OR_FLOAT_"></span>**I need to convert the QPC output to milliseconds. How can I avoid loss of precision with converting to double or float?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-247">Il y a plusieurs choses à garder à l’esprit lors de l’exécution de calculs sur des compteurs de performances d’entiers :</span><span class="sxs-lookup"><span data-stu-id="d70d0-247">There are several things to keep in mind when performing calculations on integer performance counters:</span></span>

-   <span data-ttu-id="d70d0-248">La Division d’entiers perd le reste.</span><span class="sxs-lookup"><span data-stu-id="d70d0-248">Integer division will lose the remainder.</span></span> <span data-ttu-id="d70d0-249">Cela peut entraîner une perte de précision dans certains cas.</span><span class="sxs-lookup"><span data-stu-id="d70d0-249">This can cause loss of precision in some cases.</span></span>
-   <span data-ttu-id="d70d0-250">La conversion entre des entiers 64 bits et une virgule flottante (double) peut entraîner une perte de précision, car la mantisse à virgule flottante ne peut pas représenter toutes les valeurs intégrales possibles.</span><span class="sxs-lookup"><span data-stu-id="d70d0-250">Conversion between 64 bit integers and floating point (double) can cause loss of precision because the floating point mantissa can't represent all possible integral values.</span></span>
-   <span data-ttu-id="d70d0-251">La multiplication des entiers 64 bits peut entraîner un dépassement sur les entiers.</span><span class="sxs-lookup"><span data-stu-id="d70d0-251">Multiplication of 64 bit integers can result in integer overflow.</span></span>

<span data-ttu-id="d70d0-252">En règle générale, retardez ces calculs et conversions autant que possible pour éviter d’aggraver les erreurs introduites.</span><span class="sxs-lookup"><span data-stu-id="d70d0-252">As a general principle, delay these computations and conversions as long as possible to avoid compounding the errors introduced.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-253"><span id="How_can_I_convert_QPC_to_100_nanosecond_ticks_so_I_can_add_it_to_a_________FILETIME_"></span><span id="how_can_i_convert_qpc_to_100_nanosecond_ticks_so_i_can_add_it_to_a_________filetime_"></span><span id="HOW_CAN_I_CONVERT_QPC_TO_100_NANOSECOND_TICKS_SO_I_CAN_ADD_IT_TO_A_________FILETIME_"></span>**Comment puis-je convertir QPC en graduations de 100 nanosecondes afin de pouvoir l’ajouter à un FILETIME ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-253"><span id="How_can_I_convert_QPC_to_100_nanosecond_ticks_so_I_can_add_it_to_a_________FILETIME_"></span><span id="how_can_i_convert_qpc_to_100_nanosecond_ticks_so_i_can_add_it_to_a_________filetime_"></span><span id="HOW_CAN_I_CONVERT_QPC_TO_100_NANOSECOND_TICKS_SO_I_CAN_ADD_IT_TO_A_________FILETIME_"></span>**How can I convert QPC to 100 nanosecond ticks so I can add it to a FILETIME?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-254">Une heure de fichier est une valeur 64 bits qui représente le nombre d’intervalles de 100 nanosecondes qui se sont écoulés depuis 12:00 h 00.</span><span class="sxs-lookup"><span data-stu-id="d70d0-254">A file time is a 64-bit value that represents the number of 100-nanosecond intervals that have elapsed since 12:00 A.M.</span></span> <span data-ttu-id="d70d0-255">Le 1er janvier 1601 temps universel coordonné (UTC).</span><span class="sxs-lookup"><span data-stu-id="d70d0-255">January 1, 1601 Coordinated Universal Time (UTC).</span></span> <span data-ttu-id="d70d0-256">Les heures de fichier sont utilisées par les appels d’API Win32 qui renvoient l’heure du jour, par exemple [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) et [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="d70d0-256">File times are used by Win32 API calls that return time-of-day, such as [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) and [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span> <span data-ttu-id="d70d0-257">En revanche, [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) retourne des valeurs qui représentent le temps en unités de 1/(fréquence du compteur de performance obtenu à partir de [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span><span class="sxs-lookup"><span data-stu-id="d70d0-257">By contrast, [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) returns values that represent time in units of 1/(the frequency of the performance counter obtained from [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span></span> <span data-ttu-id="d70d0-258">La conversion entre les deux requiert le calcul du rapport entre l’intervalle **QPC** et les intervalles de 100 nanosecondes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-258">Conversion between the two requires calculating the ratio of the **QPC** interval and 100-nanoseconds intervals.</span></span> <span data-ttu-id="d70d0-259">Veillez à éviter la perte de précision, car les valeurs peuvent être petites (0,0000001/0,000000340).</span><span class="sxs-lookup"><span data-stu-id="d70d0-259">Be careful to avoid losing precision because the values might be small (0.0000001 / 0.000000340).</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-260"><span id="Why_is_the_time_stamp_that_is_returned_from_QPC_a_signed_integer_"></span><span id="why_is_the_time_stamp_that_is_returned_from_qpc_a_signed_integer_"></span><span id="WHY_IS_THE_TIME_STAMP_THAT_IS_RETURNED_FROM_QPC_A_SIGNED_INTEGER_"></span>**Pourquoi l’horodatage renvoyé par QPC est-il un entier signé ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-260"><span id="Why_is_the_time_stamp_that_is_returned_from_QPC_a_signed_integer_"></span><span id="why_is_the_time_stamp_that_is_returned_from_qpc_a_signed_integer_"></span><span id="WHY_IS_THE_TIME_STAMP_THAT_IS_RETURNED_FROM_QPC_A_SIGNED_INTEGER_"></span>**Why is the time stamp that is returned from QPC a signed integer?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-261">Les calculs qui impliquent des horodatages [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) peuvent impliquer la soustraction.</span><span class="sxs-lookup"><span data-stu-id="d70d0-261">Calculations that involve [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) time stamps might involve subtraction.</span></span> <span data-ttu-id="d70d0-262">En utilisant une valeur signée, vous pouvez gérer des calculs qui peuvent produire des valeurs négatives.</span><span class="sxs-lookup"><span data-stu-id="d70d0-262">By using a signed value, you can handle calculations that might yield negative values.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-263"><span id="How_can_I_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="how_can_i_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="HOW_CAN_I_OBTAIN_HIGH_RESOLUTION_TIME_STAMPS_FROM_MANAGED_CODE_"></span>**Comment puis-je obtenir des horodatages haute résolution à partir du code managé ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-263"><span id="How_can_I_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="how_can_i_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="HOW_CAN_I_OBTAIN_HIGH_RESOLUTION_TIME_STAMPS_FROM_MANAGED_CODE_"></span>**How can I obtain high resolution time stamps from managed code?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-264">Appelez la méthode [**chronomètre. getTimestamp**](/previous-versions/windows/) à partir de la classe [**System. Diagnostics. chronomètre**](/previous-versions/windows/) .</span><span class="sxs-lookup"><span data-stu-id="d70d0-264">Call the [**Stopwatch.GetTimeStamp**](/previous-versions/windows/) method from the [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class.</span></span> <span data-ttu-id="d70d0-265">Pour obtenir un exemple d’utilisation de **chronomètre. getTimestamp**, consultez [acquisition d’horodatages haute résolution à partir du code managé](#acquiring-high-resolution-time-stamps-from-managed-code).</span><span class="sxs-lookup"><span data-stu-id="d70d0-265">For an example about how to use **Stopwatch.GetTimeStamp**, see [Acquiring high resolution time stamps from managed code](#acquiring-high-resolution-time-stamps-from-managed-code).</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-266"><span id="Under_what_circumstances_does_QueryPerformanceFrequency_return_FALSE__or_________QueryPerformanceCounter_return_zero_"></span><span id="under_what_circumstances_does_queryperformancefrequency_return_false__or_________queryperformancecounter_return_zero_"></span><span id="UNDER_WHAT_CIRCUMSTANCES_DOES_QUERYPERFORMANCEFREQUENCY_RETURN_FALSE__OR_________QUERYPERFORMANCECOUNTER_RETURN_ZERO_"></span>**Dans quelles circonstances QueryPerformanceFrequency retourne FALSe ou QueryPerformanceCounter retourne zéro ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-266"><span id="Under_what_circumstances_does_QueryPerformanceFrequency_return_FALSE__or_________QueryPerformanceCounter_return_zero_"></span><span id="under_what_circumstances_does_queryperformancefrequency_return_false__or_________queryperformancecounter_return_zero_"></span><span id="UNDER_WHAT_CIRCUMSTANCES_DOES_QUERYPERFORMANCEFREQUENCY_RETURN_FALSE__OR_________QUERYPERFORMANCECOUNTER_RETURN_ZERO_"></span>**Under what circumstances does QueryPerformanceFrequency return FALSE, or QueryPerformanceCounter return zero?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-267">Cela ne se produit pas sur les systèmes qui exécutent Windows XP ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="d70d0-267">This won't occur on any system that runs Windows XP or later.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-268"><span id="Do_I_need_to_set_the_thread_affinity_to_a_single_core_to_use_QPC_"></span><span id="do_i_need_to_set_the_thread_affinity_to_a_single_core_to_use_qpc_"></span><span id="DO_I_NEED_TO_SET_THE_THREAD_AFFINITY_TO_A_SINGLE_CORE_TO_USE_QPC_"></span>**Ai-je besoin de définir l’affinité de thread sur un seul cœur pour utiliser QPC ?**</span><span class="sxs-lookup"><span data-stu-id="d70d0-268"><span id="Do_I_need_to_set_the_thread_affinity_to_a_single_core_to_use_QPC_"></span><span id="do_i_need_to_set_the_thread_affinity_to_a_single_core_to_use_qpc_"></span><span id="DO_I_NEED_TO_SET_THE_THREAD_AFFINITY_TO_A_SINGLE_CORE_TO_USE_QPC_"></span>**Do I need to set the thread affinity to a single core to use QPC?**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-269">Non.</span><span class="sxs-lookup"><span data-stu-id="d70d0-269">No.</span></span> <span data-ttu-id="d70d0-270">Pour plus d’informations, consultez [conseils pour l’acquisition d’horodatages](#guidance-for-acquiring-time-stamps).</span><span class="sxs-lookup"><span data-stu-id="d70d0-270">For more info, see [Guidance for acquiring time stamps](#guidance-for-acquiring-time-stamps).</span></span> <span data-ttu-id="d70d0-271">Ce scénario n’est ni nécessaire ni souhaitable.</span><span class="sxs-lookup"><span data-stu-id="d70d0-271">This scenario is neither necessary nor desirable.</span></span> <span data-ttu-id="d70d0-272">L’exécution de ce scénario peut nuire aux performances de votre application en restreignant le traitement à un seul cœur ou en créant un goulot d’étranglement sur un seul cœur si plusieurs threads définissent leur affinité sur le même noyau lors de l’appel de [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="d70d0-272">Performing this scenario might adversely affect your application's performance by restricting processing to one core or by creating a bottleneck on a single core if multiple threads set their affinity to the same core when calling [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span>

</dd> </dl>

## <a name="low-level-hardware-clock-characteristics"></a><span data-ttu-id="d70d0-273">Caractéristiques de l’horloge matérielle de bas niveau</span><span class="sxs-lookup"><span data-stu-id="d70d0-273">Low-level hardware clock characteristics</span></span>

<span data-ttu-id="d70d0-274">Ces sections présentent les caractéristiques de l’horloge matérielle de bas niveau.</span><span class="sxs-lookup"><span data-stu-id="d70d0-274">These sections show low-level hardware clock characteristics.</span></span>

### <a name="absolute-clocks-and-difference-clocks"></a><span data-ttu-id="d70d0-275">Horloges absolues et horloges de différence</span><span class="sxs-lookup"><span data-stu-id="d70d0-275">Absolute Clocks and Difference Clocks</span></span>

<span data-ttu-id="d70d0-276">Les horloges absolues fournissent des lectures temporelles précises.</span><span class="sxs-lookup"><span data-stu-id="d70d0-276">Absolute clocks provide accurate time-of-day readings.</span></span> <span data-ttu-id="d70d0-277">Elles sont généralement basées sur le temps universel coordonné (UTC, Universal Time Coordinated) et, par conséquent, leur précision dépend en partie de la façon dont elles sont synchronisées avec une référence horaire externe.</span><span class="sxs-lookup"><span data-stu-id="d70d0-277">They are typically based on Coordinated Universal Time (UTC) and consequently their accuracy depends in part on how well they are synchronized to an external time reference.</span></span> <span data-ttu-id="d70d0-278">Les horloges de différence mesurent les intervalles de temps et ne sont généralement pas basées sur une époque de temps externe.</span><span class="sxs-lookup"><span data-stu-id="d70d0-278">Difference clocks measure time intervals and aren't typically based on an external time epoch.</span></span> <span data-ttu-id="d70d0-279">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) est une horloge de différence et n’est pas synchronisée avec une époque ou référence de temps externe.</span><span class="sxs-lookup"><span data-stu-id="d70d0-279">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is a difference clock and isn't synchronized to an external time epoch or reference.</span></span> <span data-ttu-id="d70d0-280">Lorsque vous utilisez **QPC** pour les mesures de l’intervalle de temps, vous obtiendrez généralement une meilleure précision que si vous obteniez des horodatages dérivés d’une horloge absolue.</span><span class="sxs-lookup"><span data-stu-id="d70d0-280">When you use **QPC** for time-interval measurements, you typically get better accuracy than you would get by using time stamps that are derived from an absolute clock.</span></span> <span data-ttu-id="d70d0-281">Cela est dû au fait que le processus de synchronisation de l’heure d’une horloge absolue peut introduire des décalages de phase et de fréquence qui augmentent l’incertitude des mesures de l’intervalle de temps à long terme.</span><span class="sxs-lookup"><span data-stu-id="d70d0-281">This is because the process of synchronizing the time of an absolute clock can introduce phase and frequency shifts that increase the uncertainty of short term time-interval measurements.</span></span>

### <a name="resolution-precision-accuracy-and-stability"></a><span data-ttu-id="d70d0-282">Résolution, précision, précision et stabilité</span><span class="sxs-lookup"><span data-stu-id="d70d0-282">Resolution, Precision, Accuracy, and Stability</span></span>

<span data-ttu-id="d70d0-283">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) utilise un compteur matériel comme base.</span><span class="sxs-lookup"><span data-stu-id="d70d0-283">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) uses a hardware counter as its basis.</span></span> <span data-ttu-id="d70d0-284">Les minuteurs matériels se composent de trois parties : un générateur de graduations, un compteur qui compte les graduations et un moyen de récupérer la valeur de compteur.</span><span class="sxs-lookup"><span data-stu-id="d70d0-284">Hardware timers consist of three parts: a tick generator, a counter that counts the ticks, and a means of retrieving the counter value.</span></span> <span data-ttu-id="d70d0-285">Les caractéristiques de ces trois composants déterminent la résolution, la précision, la précision et la stabilité des **QPC**.</span><span class="sxs-lookup"><span data-stu-id="d70d0-285">The characteristics of these three components determine the resolution, precision, accuracy, and stability of **QPC**.</span></span>

<span data-ttu-id="d70d0-286">Si un générateur de matériel fournit des graduations à une vitesse constante, les intervalles de temps peuvent être mesurés en comptant simplement ces graduations.</span><span class="sxs-lookup"><span data-stu-id="d70d0-286">If a hardware generator provides ticks at a constant rate, time intervals can be measured by simply counting these ticks.</span></span> <span data-ttu-id="d70d0-287">La vitesse à laquelle les battements sont générées est appelée fréquence et exprimée en Hertz (Hz).</span><span class="sxs-lookup"><span data-stu-id="d70d0-287">The rate at which the ticks are generated is called the frequency and expressed in Hertz (Hz).</span></span> <span data-ttu-id="d70d0-288">La réciproque de la fréquence est appelée intervalle de période ou de cycle et est exprimée dans un système international approprié d’unités de temps (SI) (par exemple, seconde, milliseconde, microseconde ou nanoseconde).</span><span class="sxs-lookup"><span data-stu-id="d70d0-288">The reciprocal of the frequency is called the period or tick interval and is expressed in an appropriate International System of Units (SI) time unit (for example, second, millisecond, microsecond, or nanosecond).</span></span>

![intervalle de temps](images/tick-interval.png)

<span data-ttu-id="d70d0-290">La résolution de la minuterie est égale à la période.</span><span class="sxs-lookup"><span data-stu-id="d70d0-290">The resolution of the timer is equal to the period.</span></span> <span data-ttu-id="d70d0-291">La résolution détermine la possibilité de faire la distinction entre deux horodatages et place une limite inférieure sur les intervalles de temps les plus petits qui peuvent être mesurés.</span><span class="sxs-lookup"><span data-stu-id="d70d0-291">Resolution determines the ability to distinguish between any two time stamps and places a lower bound on the smallest time intervals that can be measured.</span></span> <span data-ttu-id="d70d0-292">C’est ce que l’on appelle parfois la résolution de graduation.</span><span class="sxs-lookup"><span data-stu-id="d70d0-292">This is sometimes called the tick resolution.</span></span>

<span data-ttu-id="d70d0-293">La mesure numérique du temps introduit une incertitude de mesure de ± 1 cycle, car le compteur numérique avance en étapes discrètes, tandis que le temps progresse continuellement.</span><span class="sxs-lookup"><span data-stu-id="d70d0-293">Digital measurement of time introduces a measurements uncertainty of ± 1 tick because the digital counter advances in discrete steps, while time is continuously advancing.</span></span> <span data-ttu-id="d70d0-294">Cette incertitude est appelée une erreur de quantification.</span><span class="sxs-lookup"><span data-stu-id="d70d0-294">This uncertainty is called a quantization error.</span></span> <span data-ttu-id="d70d0-295">Pour les mesures d’intervalle de temps classiques, cet effet peut souvent être ignoré car l’erreur de quantification est bien plus petite que l’intervalle de temps mesuré.</span><span class="sxs-lookup"><span data-stu-id="d70d0-295">For typical time-interval measurements, this effect can often be ignored because the quantizing error is much smaller than the time interval being measured.</span></span>

![mesure du temps numérique](images/digital-time-measure.png)

<span data-ttu-id="d70d0-297">Toutefois, si la période mesurée est faible et s’approche de la résolution de la minuterie, vous devez tenir compte de cette erreur de quantification.</span><span class="sxs-lookup"><span data-stu-id="d70d0-297">However, if the period being measured is small and approaches the resolution of the timer, you will need to consider this quantizing error.</span></span> <span data-ttu-id="d70d0-298">La taille de l’erreur introduite est celle d’une période d’horloge.</span><span class="sxs-lookup"><span data-stu-id="d70d0-298">The size of the error introduced is that of one clock period.</span></span>

<span data-ttu-id="d70d0-299">Les deux diagrammes suivants illustrent l’impact de l’incertitude du battement ± 1 à l’aide d’un minuteur avec une résolution de 1 unité de temps.</span><span class="sxs-lookup"><span data-stu-id="d70d0-299">The following two diagrams illustrate the impact of the ± 1 tick uncertainty by using a timer with a resolution of 1 time unit.</span></span>

![incertitude du cycle](images/tick-uncertainty.png)

<span data-ttu-id="d70d0-301">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) retourne la fréquence de [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter), et la période et la résolution sont égales à la réciproque de cette valeur.</span><span class="sxs-lookup"><span data-stu-id="d70d0-301">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) returns the frequency of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter), and the period and resolution are equal to the reciprocal of this value.</span></span> <span data-ttu-id="d70d0-302">La fréquence des compteurs de performance renvoyée par **QueryPerformanceFrequency** est déterminée lors de l’initialisation du système et ne change pas pendant l’exécution du système.</span><span class="sxs-lookup"><span data-stu-id="d70d0-302">The performance counter frequency that **QueryPerformanceFrequency** returns is determined during system initialization and doesn't change while the system is running.</span></span>

> [!Note]  
> <span data-ttu-id="d70d0-303">Il existe des cas où [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) ne retourne pas la fréquence réelle du générateur de cycles matériels.</span><span class="sxs-lookup"><span data-stu-id="d70d0-303">Cases might exist where [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) doesn't return the actual frequency of the hardware tick generator.</span></span> <span data-ttu-id="d70d0-304">Par exemple, dans de nombreux cas, **QueryPerformanceFrequency** retourne la fréquence TSC divisée par 1024 ; et sur Hyper-V, la fréquence du compteur de performance est toujours de 10 MHz lorsque l’ordinateur virtuel invité s’exécute sous un [hyperviseur](https://msdn.microsoft.com/library/Ff542584(v=VS.85).aspx) qui implémente l’interface de l' [hyperviseur version 1,0](https://msdn.microsoft.com/library/Ff541458(v=VS.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="d70d0-304">For example, in many cases, **QueryPerformanceFrequency** returns the TSC frequency divided by 1024; and on Hyper-V, the performance counter frequency is always 10 MHz when the guest virtual machine runs under a [hypervisor](https://msdn.microsoft.com/library/Ff542584(v=VS.85).aspx) that implements the [hypervisor version 1.0 interface](https://msdn.microsoft.com/library/Ff541458(v=VS.85).aspx).</span></span> <span data-ttu-id="d70d0-305">Par conséquent, ne supposez pas que **QueryPerformanceFrequency** retourne la fréquence TSC précise.</span><span class="sxs-lookup"><span data-stu-id="d70d0-305">As a result, don't assume that **QueryPerformanceFrequency** will return the precise TSC frequency.</span></span>

 

<span data-ttu-id="d70d0-306">[**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) lit le compteur de performance et retourne le nombre total de cycles qui se sont produits depuis le démarrage du système d’exploitation Windows, y compris l’heure à laquelle l’ordinateur se trouvait dans un état de veille, comme en veille, en veille prolongée ou en veille connectée.</span><span class="sxs-lookup"><span data-stu-id="d70d0-306">[**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) reads the performance counter and returns the total number of ticks that have occurred since the Windows operating system was started, including the time when the machine was in a sleep state such as standby, hibernate, or connected standby.</span></span>

<span data-ttu-id="d70d0-307">Ces exemples montrent comment calculer l’intervalle de graduation et la résolution et comment convertir le nombre de graduations en valeur d’heure.</span><span class="sxs-lookup"><span data-stu-id="d70d0-307">These examples show how to calculate the tick interval and resolution and how to convert the tick count into a time value.</span></span>

<dl> <dt>

<span data-ttu-id="d70d0-308"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Exemple 1**</span><span class="sxs-lookup"><span data-stu-id="d70d0-308"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Example 1**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-309">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) retourne la valeur 3 125 000 sur un ordinateur particulier.</span><span class="sxs-lookup"><span data-stu-id="d70d0-309">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) returns the value 3,125,000 on a particular machine.</span></span> <span data-ttu-id="d70d0-310">Quel est l’intervalle de graduation et la résolution des mesures de [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) sur cet ordinateur ?</span><span class="sxs-lookup"><span data-stu-id="d70d0-310">What is the tick interval and resolution of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) measurements on this machine?</span></span> <span data-ttu-id="d70d0-311">L’intervalle de graduation, ou point, est la réciproque de 3 125 000, qui est 0,000000320 (320 nanosecondes).</span><span class="sxs-lookup"><span data-stu-id="d70d0-311">The tick interval, or period, is the reciprocal of 3,125,000, which is 0.000000320 (320 nanoseconds).</span></span> <span data-ttu-id="d70d0-312">Par conséquent, chaque battement représente le passage de nanosecondes de 320.</span><span class="sxs-lookup"><span data-stu-id="d70d0-312">Therefore, each tick represents the passing of 320 nanoseconds.</span></span> <span data-ttu-id="d70d0-313">Les intervalles de temps inférieurs à 320 nanosecondes ne peuvent pas être mesurés sur cet ordinateur.</span><span class="sxs-lookup"><span data-stu-id="d70d0-313">Time intervals smaller than 320 nanoseconds can't be measured on this machine.</span></span>

<span data-ttu-id="d70d0-314">Intervalle de graduation = 1/(fréquence de performance)</span><span class="sxs-lookup"><span data-stu-id="d70d0-314">Tick Interval = 1/(Performance Frequency)</span></span>

<span data-ttu-id="d70d0-315">Intervalle de graduation = 1/3125000 = 320 NS</span><span class="sxs-lookup"><span data-stu-id="d70d0-315">Tick Interval = 1/3,125,000 = 320 ns</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-316"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Exemple 2**</span><span class="sxs-lookup"><span data-stu-id="d70d0-316"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Example 2**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-317">Sur le même ordinateur que l’exemple précédent, la différence entre les valeurs retournées par deux appels successifs à [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) est de 5.</span><span class="sxs-lookup"><span data-stu-id="d70d0-317">On the same machine as the preceding example, the difference of the values returned from two successive calls to [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is 5.</span></span> <span data-ttu-id="d70d0-318">Combien de temps s’est écoulé entre les deux appels ?</span><span class="sxs-lookup"><span data-stu-id="d70d0-318">How much time has elapsed between the two calls?</span></span> <span data-ttu-id="d70d0-319">5 battements multiplié par 320 nanosecondes génèrent 1,6 microsecondes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-319">5 ticks multiplied by 320 nanoseconds yields 1.6 microseconds.</span></span>

<span data-ttu-id="d70d0-320">ElapsedTime = intervalle de \* graduations</span><span class="sxs-lookup"><span data-stu-id="d70d0-320">ElapsedTime = Ticks \* Tick Interval</span></span>

<span data-ttu-id="d70d0-321">ElapsedTime = 5 \* 320 NS = 1,6 μs</span><span class="sxs-lookup"><span data-stu-id="d70d0-321">ElapsedTime = 5 \* 320 ns = 1.6 μs</span></span>

</dd> </dl>

<span data-ttu-id="d70d0-322">L’accès (lecture) du compteur du logiciel prend du temps, et ce temps d’accès peut réduire la précision de la mesure du temps.</span><span class="sxs-lookup"><span data-stu-id="d70d0-322">It takes time to access (read) the tick counter from software, and this access time can reduce the precision of the of the time measurement.</span></span> <span data-ttu-id="d70d0-323">Cela est dû au fait que la durée minimale de l’intervalle (l’intervalle de temps le plus court pouvant être mesuré) est la plus grande de la résolution et du temps d’accès.</span><span class="sxs-lookup"><span data-stu-id="d70d0-323">This is because the minimum interval time (the smallest time interval that can be measured) is the larger of the resolution and the access time.</span></span>

<span data-ttu-id="d70d0-324">Précision = \[ résolution maximale, AccessTime\]</span><span class="sxs-lookup"><span data-stu-id="d70d0-324">Precision = MAX \[ Resolution, AccessTime\]</span></span>

<span data-ttu-id="d70d0-325">Par exemple, considérez un minuteur matériel hypothétique avec une résolution de 100 nanosecondes et un temps d’accès de 800 nanoseconde.</span><span class="sxs-lookup"><span data-stu-id="d70d0-325">For example, consider a hypothetical hardware timer with a 100 nanosecond resolution and an 800 nanosecond access time.</span></span> <span data-ttu-id="d70d0-326">Cela peut être le cas si la minuterie de la plateforme a été utilisée à la place du Registre TSC comme base de [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="d70d0-326">This might be the case if the platform timer were used instead of the TSC register as the basis of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="d70d0-327">Par conséquent, la précision est de 800 nanosecondes non 100 nanosecondes, comme indiqué dans ce calcul.</span><span class="sxs-lookup"><span data-stu-id="d70d0-327">Thus, the precision would be 800 nanoseconds not 100 nanoseconds as shown in this calculation.</span></span>

<span data-ttu-id="d70d0-328">Précision = MAX \[ 800 NS, 100 NS \] = 800 NS</span><span class="sxs-lookup"><span data-stu-id="d70d0-328">Precision = MAX \[800 ns,100 ns\] = 800 ns</span></span>

<span data-ttu-id="d70d0-329">Ces deux figures illustrent cet effet.</span><span class="sxs-lookup"><span data-stu-id="d70d0-329">These two figures depict this effect.</span></span>

![heure d’accès QPC](images/qpc-access-time.png)

<span data-ttu-id="d70d0-331">Si le temps d’accès est supérieur à la résolution, ne tentez pas d’améliorer la précision en devinant.</span><span class="sxs-lookup"><span data-stu-id="d70d0-331">If the access time is greater than the resolution, don't try to improve the precision by guessing.</span></span> <span data-ttu-id="d70d0-332">En d’autres termes, il s’agit d’une erreur qui consiste à supposer que l’horodatage est pris précisément au milieu, ou au début ou à la fin de l’appel.</span><span class="sxs-lookup"><span data-stu-id="d70d0-332">In other words, it's an error to assume that the time stamp is taken precisely in the middle, or at the beginning or the end of the call.</span></span>

<span data-ttu-id="d70d0-333">En revanche, prenons l’exemple suivant dans lequel l’heure d’accès [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) est uniquement de 20 nanosecondes et la résolution de l’horloge matérielle est de 100 nanosecondes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-333">By contrast, consider the following example in which the [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) access time is only 20 nanoseconds and the hardware clock resolution is 100 nanoseconds.</span></span> <span data-ttu-id="d70d0-334">Cela peut être le cas si le registre TSC a été utilisé comme base pour **QPC**.</span><span class="sxs-lookup"><span data-stu-id="d70d0-334">This might be the case if the TSC register was used as the basis for **QPC**.</span></span> <span data-ttu-id="d70d0-335">Ici, la précision est limitée par la résolution de l’horloge.</span><span class="sxs-lookup"><span data-stu-id="d70d0-335">Here the precision is limited by the clock resolution.</span></span>

![précision QPC](images/qpc-precision.png)

<span data-ttu-id="d70d0-337">Dans la pratique, vous pouvez rechercher les sources de temps pour lesquelles le temps nécessaire pour lire le compteur est plus grand ou plus petit que la résolution.</span><span class="sxs-lookup"><span data-stu-id="d70d0-337">In practice, you can find time sources for which the time required to read the counter is larger or smaller than the resolution.</span></span> <span data-ttu-id="d70d0-338">Dans les deux cas, la précision est la plus grande des deux.</span><span class="sxs-lookup"><span data-stu-id="d70d0-338">In either case, the precision will be the larger of the two.</span></span>

<span data-ttu-id="d70d0-339">Ce tableau fournit des informations sur la résolution approximative, le temps d’accès et la précision d’une variété d’horloges.</span><span class="sxs-lookup"><span data-stu-id="d70d0-339">This table provides info on the approximate resolution, access time, and precision of a variety of clocks.</span></span> <span data-ttu-id="d70d0-340">Notez que certaines valeurs varient selon les processeurs, les plateformes matérielles et les vitesses de processeur.</span><span class="sxs-lookup"><span data-stu-id="d70d0-340">Note that some of the values will vary with different processors, hardware platforms, and processor speeds.</span></span>



| <span data-ttu-id="d70d0-341">Source de l’horloge</span><span class="sxs-lookup"><span data-stu-id="d70d0-341">Clock Source</span></span>                                                      | <span data-ttu-id="d70d0-342">Fréquence d’horloge nominale</span><span class="sxs-lookup"><span data-stu-id="d70d0-342">Nominal Clock Frequency</span></span> | <span data-ttu-id="d70d0-343">Résolution de l’horloge</span><span class="sxs-lookup"><span data-stu-id="d70d0-343">Clock Resolution</span></span>    | <span data-ttu-id="d70d0-344">Temps d’accès (par défaut)</span><span class="sxs-lookup"><span data-stu-id="d70d0-344">Access Time (Typical)</span></span> | <span data-ttu-id="d70d0-345">Précision</span><span class="sxs-lookup"><span data-stu-id="d70d0-345">Precision</span></span>       |
|-------------------------------------------------------------------|-------------------------|---------------------|-----------------------|-----------------|
| <span data-ttu-id="d70d0-346">ORDINATEUR RTC</span><span class="sxs-lookup"><span data-stu-id="d70d0-346">PC RTC</span></span>                                                            | <span data-ttu-id="d70d0-347">64 Hz</span><span class="sxs-lookup"><span data-stu-id="d70d0-347">64 Hz</span></span>                   | <span data-ttu-id="d70d0-348">15,625 millisecondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-348">15.625 milliseconds</span></span> | <span data-ttu-id="d70d0-349">N/A</span><span class="sxs-lookup"><span data-stu-id="d70d0-349">N/A</span></span>                   | <span data-ttu-id="d70d0-350">N/A</span><span class="sxs-lookup"><span data-stu-id="d70d0-350">N/A</span></span>             |
| <span data-ttu-id="d70d0-351">Compteur de performances de requête utilisant TSC avec une horloge de processeur de 3 GHz</span><span class="sxs-lookup"><span data-stu-id="d70d0-351">Query performance counter using TSC with a 3 GHz processor clock</span></span>  | <span data-ttu-id="d70d0-352">3 MHz</span><span class="sxs-lookup"><span data-stu-id="d70d0-352">3 MHz</span></span>                   | <span data-ttu-id="d70d0-353">333 nanosecondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-353">333 nanoseconds</span></span>     | <span data-ttu-id="d70d0-354">30 nanosecondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-354">30 nanoseconds</span></span>        | <span data-ttu-id="d70d0-355">333 nanosecondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-355">333 nanoseconds</span></span> |
| <span data-ttu-id="d70d0-356">Instruction de machine **RDTSC** sur un système avec une durée de cycle de 3 GHz</span><span class="sxs-lookup"><span data-stu-id="d70d0-356">**RDTSC** machine instruction on a system with a 3 GHz cycle time</span></span> | <span data-ttu-id="d70d0-357">3 GHz</span><span class="sxs-lookup"><span data-stu-id="d70d0-357">3 GHz</span></span>                   | <span data-ttu-id="d70d0-358">333 picoseconds</span><span class="sxs-lookup"><span data-stu-id="d70d0-358">333 picoseconds</span></span>     | <span data-ttu-id="d70d0-359">30 nanosecondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-359">30 nanoseconds</span></span>        | <span data-ttu-id="d70d0-360">30 nanosecondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-360">30 nanoseconds</span></span>  |



 

<span data-ttu-id="d70d0-361">Comme [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) utilise un compteur matériel, lorsque vous comprenez certaines caractéristiques de base des compteurs matériels, vous vous familiarisez avec les fonctionnalités et les limitations de **QPC**.</span><span class="sxs-lookup"><span data-stu-id="d70d0-361">Because [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) uses a hardware counter, when you understand some basic characteristics of hardware counters, you gain understanding about the capabilities and limitations of **QPC**.</span></span>

<span data-ttu-id="d70d0-362">Le générateur de cycles matériels le plus couramment utilisé est un oscillateur à cristal.</span><span class="sxs-lookup"><span data-stu-id="d70d0-362">The most commonly used hardware tick generator is a crystal oscillator.</span></span> <span data-ttu-id="d70d0-363">Le cristal est un petit morceau de quartz ou autre matériau céramique qui présente des caractéristiques piézoélectriques qui fournissent une référence de fréquence peu coûteuse avec une stabilité et une précision excellentes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-363">The crystal is a small piece of quartz or other ceramic material that exhibits piezoelectric characteristics that provide an inexpensive frequency reference with excellent stability and accuracy.</span></span> <span data-ttu-id="d70d0-364">Cette fréquence est utilisée pour générer les graduations comptées par l’horloge.</span><span class="sxs-lookup"><span data-stu-id="d70d0-364">This frequency is used to generate the ticks counted by the clock.</span></span>

<span data-ttu-id="d70d0-365">La précision d’un minuteur fait référence au degré de conformité à une valeur true ou standard.</span><span class="sxs-lookup"><span data-stu-id="d70d0-365">The accuracy of a timer refers to the degree of conformity to a true or standard value.</span></span> <span data-ttu-id="d70d0-366">Cela dépend principalement de la capacité de l’oscillateur Crystal à fournir des graduations à la fréquence spécifiée.</span><span class="sxs-lookup"><span data-stu-id="d70d0-366">This depends primarily on the crystal oscillator’s ability to provide ticks at the specified frequency.</span></span> <span data-ttu-id="d70d0-367">Si la fréquence d’oscillation est trop élevée, l’horloge est « exécutée rapidement » et les intervalles mesurés s’affichent plus longtemps qu’ils ne le sont vraiment. en outre, si la fréquence est trop faible, l’horloge s’exécute lentement et les intervalles mesurés sont plus courts qu’ils ne le sont vraiment.</span><span class="sxs-lookup"><span data-stu-id="d70d0-367">If the frequency of oscillation is too high, the clock will 'run fast', and measured intervals will appear longer than they really are; and if the frequency is too low, the clock will 'run slow', and measured intervals will appear shorter than they really are.</span></span>

<span data-ttu-id="d70d0-368">Pour les mesures d’intervalle de temps standard pour une durée brève (par exemple, les mesures de temps de réponse, les mesures de latence réseau, etc.), la précision de l’oscillateur matériel est généralement suffisante.</span><span class="sxs-lookup"><span data-stu-id="d70d0-368">For typical time-interval measurements for short duration (for example, response time measurements, network latency measurements, and so on), the accuracy of the hardware oscillator is usually sufficient.</span></span> <span data-ttu-id="d70d0-369">Toutefois, pour certaines mesures, la précision de la fréquence de l’oscillateur devient importante, en particulier pour les intervalles de temps longs ou lorsque vous souhaitez comparer les mesures effectuées sur des ordinateurs différents.</span><span class="sxs-lookup"><span data-stu-id="d70d0-369">However, for some measurements the oscillator frequency accuracy becomes important, particularly for long time intervals or when you want to compare measurements taken on different machines.</span></span> <span data-ttu-id="d70d0-370">Le reste de cette section explore les effets de la précision de l’oscillateur.</span><span class="sxs-lookup"><span data-stu-id="d70d0-370">The remainder of this section explores the effects of the oscillator accuracy.</span></span>

<span data-ttu-id="d70d0-371">La fréquence d’oscillation des cristaux est définie pendant le processus de fabrication et est spécifiée par le fabricant en termes de fréquence spécifiée plus ou moins une tolérance de fabrication exprimée en « parties par million » (ppm), appelée décalage de fréquence maximale.</span><span class="sxs-lookup"><span data-stu-id="d70d0-371">The crystals' frequency of oscillation is set during the manufacturing process and is specified by the manufacturer in terms of a specified frequency plus or minus a manufacturing tolerance expressed in 'parts per million' (ppm), called the maximum frequency offset.</span></span> <span data-ttu-id="d70d0-372">Un cristal avec une fréquence spécifiée de 1 million Hz et un décalage de fréquence maximal de ± 10 ppm se trouve dans les limites de spécifications si sa fréquence réelle est comprise entre 999 990 Hz et 1 000 010 Hz.</span><span class="sxs-lookup"><span data-stu-id="d70d0-372">A crystal with a specified frequency of 1,000,000 Hz and a maximum frequency offset of ± 10 ppm would be within specification limits if its actual frequency were between 999,990 Hz and 1,000,010 Hz.</span></span>

<span data-ttu-id="d70d0-373">En remplaçant les parties de l’expression par million de microsecondes par seconde, nous pouvons appliquer cette erreur de décalage de fréquence aux mesures de l’intervalle de temps.</span><span class="sxs-lookup"><span data-stu-id="d70d0-373">By substituting the phrase parts per million with microseconds per second, we can apply this frequency offset error to time-interval measurements.</span></span> <span data-ttu-id="d70d0-374">Un oscillateur avec un décalage de + 10 ppm a une erreur de 10 microsecondes par seconde.</span><span class="sxs-lookup"><span data-stu-id="d70d0-374">An oscillator with a + 10 ppm offset would have an error of 10 microseconds per second.</span></span> <span data-ttu-id="d70d0-375">En conséquence, lorsque vous mesurez un intervalle de 1 seconde, il s’exécute rapidement et mesure un intervalle de 1 seconde comme 0,999990 secondes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-375">Accordingly, when measuring a 1 second interval, it would run fast and measure a 1 second interval as 0.999990 seconds.</span></span>

<span data-ttu-id="d70d0-376">Une référence pratique est qu’une erreur de fréquence de 100 ppm provoque une erreur de 8,64 secondes après 24 heures.</span><span class="sxs-lookup"><span data-stu-id="d70d0-376">A convenient reference is that a frequency error of 100 ppm causes an error of 8.64 seconds after 24 hours.</span></span> <span data-ttu-id="d70d0-377">Ce tableau présente l’incertitude de mesure en raison de l’erreur accumulée pendant des intervalles de temps plus longs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-377">This table presents the measurement uncertainty due to the accumulated error for longer time intervals.</span></span>



| <span data-ttu-id="d70d0-378">Durée de l’intervalle de temps</span><span class="sxs-lookup"><span data-stu-id="d70d0-378">Time interval duration</span></span> | <span data-ttu-id="d70d0-379">Incertitude de mesure due à une erreur accumulée avec une tolérance de fréquence de +/-10 PPM</span><span class="sxs-lookup"><span data-stu-id="d70d0-379">Measurement uncertainty due to accumulated error with +/- 10 PPM frequency tolerance</span></span> |
|------------------------|--------------------------------------------------------------------------------------|
| <span data-ttu-id="d70d0-380">1 microseconde</span><span class="sxs-lookup"><span data-stu-id="d70d0-380">1 microsecond</span></span>          | <span data-ttu-id="d70d0-381">± 10 picoseconds (10-12)</span><span class="sxs-lookup"><span data-stu-id="d70d0-381">± 10 picoseconds (10-12)</span></span>                                                             |
| <span data-ttu-id="d70d0-382">1 milliseconde</span><span class="sxs-lookup"><span data-stu-id="d70d0-382">1 millisecond</span></span>          | <span data-ttu-id="d70d0-383">± 10 nanosecondes (10-9)</span><span class="sxs-lookup"><span data-stu-id="d70d0-383">± 10 nanoseconds (10-9)</span></span>                                                              |
| <span data-ttu-id="d70d0-384">1 seconde</span><span class="sxs-lookup"><span data-stu-id="d70d0-384">1 second</span></span>               | <span data-ttu-id="d70d0-385">± 10 microsecondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-385">± 10 microseconds</span></span>                                                                    |
| <span data-ttu-id="d70d0-386">1 heure</span><span class="sxs-lookup"><span data-stu-id="d70d0-386">1 hour</span></span>                 | <span data-ttu-id="d70d0-387">± 60 microsecondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-387">± 60 microseconds</span></span>                                                                    |
| <span data-ttu-id="d70d0-388">1 jour</span><span class="sxs-lookup"><span data-stu-id="d70d0-388">1 day</span></span>                  | <span data-ttu-id="d70d0-389">± 0,86 secondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-389">± 0.86 seconds</span></span>                                                                       |
| <span data-ttu-id="d70d0-390">1 semaine</span><span class="sxs-lookup"><span data-stu-id="d70d0-390">1 week</span></span>                 | <span data-ttu-id="d70d0-391">± 6,08 secondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-391">± 6.08 seconds</span></span>                                                                       |



 

<span data-ttu-id="d70d0-392">Le tableau ci-dessus montre que pour les intervalles de temps réduits, l’erreur de décalage de fréquence peut souvent être ignorée.</span><span class="sxs-lookup"><span data-stu-id="d70d0-392">The preceding table shows that for small time intervals the frequency offset error can often be ignored.</span></span> <span data-ttu-id="d70d0-393">Toutefois, pour des intervalles de temps longs, même un décalage de fréquence réduit peut entraîner une incertitude significative de la mesure.</span><span class="sxs-lookup"><span data-stu-id="d70d0-393">However for long time intervals, even a small frequency offset can result in a substantial measurement uncertainty.</span></span>

<span data-ttu-id="d70d0-394">Les oscillateurs Crystal utilisés dans les ordinateurs personnels et les serveurs sont généralement fabriqués avec une tolérance de fréquence de ± 30 à 50 pièces par million et, rarement, les cristaux peuvent être désactivés jusqu’à 500 ppm.</span><span class="sxs-lookup"><span data-stu-id="d70d0-394">Crystal oscillators that are used in personal computers and servers are typically manufactured with a frequency tolerance of ± 30 to 50 parts per million, and rarely, crystals can be off by as much as 500 ppm.</span></span> <span data-ttu-id="d70d0-395">Bien que les cristaux avec des tolérances de décalage de fréquence beaucoup plus étroites soient disponibles, ils sont plus onéreux et ne sont donc pas utilisés dans la plupart des ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-395">Although crystals with much tighter frequency offset tolerances are available, they are more expensive and thus are not used in most computers.</span></span>

<span data-ttu-id="d70d0-396">Pour réduire les effets indésirables de cette erreur de décalage de fréquence, les versions récentes de Windows, en particulier Windows 8, utilisent plusieurs minuteries matérielles pour détecter le décalage de fréquence et compensent le résultat dans la mesure du possible.</span><span class="sxs-lookup"><span data-stu-id="d70d0-396">To reduce the adverse effects of this frequency offset error, recent versions of Windows, particularly Windows 8, use multiple hardware timers to detect the frequency offset and compensate for it to the extent possible.</span></span> <span data-ttu-id="d70d0-397">Ce processus d’étalonnage est effectué au démarrage de Windows.</span><span class="sxs-lookup"><span data-stu-id="d70d0-397">This calibration process is performed when Windows is started.</span></span>

<span data-ttu-id="d70d0-398">Comme le montrent les exemples suivants, l’erreur de décalage de fréquence d’une horloge matérielle influence la précision obtenue et la résolution de l’horloge peut être moins importante.</span><span class="sxs-lookup"><span data-stu-id="d70d0-398">As the following examples show, the frequency offset error of a hardware clock influences the achievable accuracy, and the resolution of the clock can be less important.</span></span>

![l’erreur de décalage de fréquence influe sur la précision obtenue](images/freq-offset-error.png)

<dl> <dt>

<span data-ttu-id="d70d0-400"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Exemple 1**</span><span class="sxs-lookup"><span data-stu-id="d70d0-400"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Example 1**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-401">Supposons que vous exécutiez des mesures d’intervalle de temps à l’aide d’un oscillateur de 1 MHz, qui a une résolution de 1 microseconde et une erreur de décalage de fréquence maximale de ± 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="d70d0-401">Suppose you perform time-interval measurements by using a 1 MHz oscillator, which has a resolution of 1 microsecond, and a maximum frequency offset error of ±50 ppm.</span></span> <span data-ttu-id="d70d0-402">Nous supposons à présent que le décalage soit exactement + 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="d70d0-402">Now, let us suppose the offset is exactly +50 ppm.</span></span> <span data-ttu-id="d70d0-403">Cela signifie que la fréquence réelle est de 1 000 050 Hz.</span><span class="sxs-lookup"><span data-stu-id="d70d0-403">This means that the actual frequency would be 1,000,050 Hz.</span></span> <span data-ttu-id="d70d0-404">Si nous avons mesuré un intervalle de temps de 24 heures, notre mesure serait de 4,3 secondes trop courtes (23:59:55.700000 mesuré par rapport à 24:00:00.000000 réel).</span><span class="sxs-lookup"><span data-stu-id="d70d0-404">If we measured a time interval of 24 hours, our measurement would be 4.3 seconds too short (23:59:55.700000 measured versus 24:00:00.000000 actual).</span></span>

<span data-ttu-id="d70d0-405">Secondes dans une journée = 86400</span><span class="sxs-lookup"><span data-stu-id="d70d0-405">Seconds in a day = 86400</span></span>

<span data-ttu-id="d70d0-406">Erreur de décalage de fréquence = 50 ppm = 0,00005</span><span class="sxs-lookup"><span data-stu-id="d70d0-406">Frequency offset error = 50 ppm = 0.00005</span></span>

<span data-ttu-id="d70d0-407">86 400 secondes \* 0,00005 = 4,3 secondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-407">86,400 seconds \* 0.00005 = 4.3 seconds</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-408"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Exemple 2**</span><span class="sxs-lookup"><span data-stu-id="d70d0-408"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Example 2**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-409">Supposons que l’horloge TSC du processeur est contrôlée par un oscillateur cristallin et que la fréquence spécifiée est de 3 GHz.</span><span class="sxs-lookup"><span data-stu-id="d70d0-409">Suppose the processor TSC clock is controlled by a crystal oscillator and has specified frequency of 3 GHz.</span></span> <span data-ttu-id="d70d0-410">Cela signifie que la résolution est de 1/3000000000 ou d’environ 333 picoseconds.</span><span class="sxs-lookup"><span data-stu-id="d70d0-410">This means that the resolution would be 1/3,000,000,000 or about 333 picoseconds.</span></span> <span data-ttu-id="d70d0-411">Supposons que le cristal utilisé pour contrôler l’horloge du processeur a une tolérance de fréquence de ± 50 ppm et qu’elle est en fait de + 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="d70d0-411">Assume the crystal used to control the processor clock has a frequency tolerance of ±50 ppm and is actually +50 ppm.</span></span> <span data-ttu-id="d70d0-412">Malgré la haute résolution, une mesure de l’intervalle de temps de 24 heures sera toujours de 4,3 secondes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-412">In spite of the impressive resolution, a time-interval measurement of 24 hours will still be 4.3 seconds too short.</span></span> <span data-ttu-id="d70d0-413">(23:59:55.7000000000 mesuré par rapport à 24:00:00.0000000000 réel).</span><span class="sxs-lookup"><span data-stu-id="d70d0-413">(23:59:55.7000000000 measured versus 24:00:00.0000000000 actual).</span></span>

<span data-ttu-id="d70d0-414">Secondes dans une journée = 86400</span><span class="sxs-lookup"><span data-stu-id="d70d0-414">Seconds in a day = 86400</span></span>

<span data-ttu-id="d70d0-415">Erreur de décalage de fréquence = 50 ppm = 0,00005</span><span class="sxs-lookup"><span data-stu-id="d70d0-415">Frequency offset error = 50 ppm = 0.00005</span></span>

<span data-ttu-id="d70d0-416">86 400 secondes \* 0,00005 = 4,3 secondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-416">86,400 seconds \* 0.00005 = 4.3 seconds</span></span>

<span data-ttu-id="d70d0-417">Cela montre qu’une horloge TSC haute résolution ne fournit pas nécessairement des mesures plus précises qu’une horloge de résolution inférieure.</span><span class="sxs-lookup"><span data-stu-id="d70d0-417">This shows that a high resolution TSC clock doesn't necessarily provide more accurate measurements than a lower resolution clock.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-418"><span id="Example_3"></span><span id="example_3"></span><span id="EXAMPLE_3"></span>**Exemple 3**</span><span class="sxs-lookup"><span data-stu-id="d70d0-418"><span id="Example_3"></span><span id="example_3"></span><span id="EXAMPLE_3"></span>**Example 3**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-419">Envisagez d’utiliser deux ordinateurs différents pour mesurer le même intervalle de 24 heures.</span><span class="sxs-lookup"><span data-stu-id="d70d0-419">Consider using two different computers to measure the same 24 hour time interval.</span></span> <span data-ttu-id="d70d0-420">Les deux ordinateurs ont un oscillateur avec un décalage de fréquence maximal de ± 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="d70d0-420">Both computers have an oscillator with a maximum frequency offset of ± 50 ppm.</span></span> <span data-ttu-id="d70d0-421">À quelle distance la mesure du même intervalle de temps sur ces deux systèmes peut-elle être ?</span><span class="sxs-lookup"><span data-stu-id="d70d0-421">How far apart can the measurement of the same time interval on these two systems be?</span></span> <span data-ttu-id="d70d0-422">Comme dans les exemples précédents, ± 50 ppm génère une erreur maximale de ± 4,3 secondes après 24 heures.</span><span class="sxs-lookup"><span data-stu-id="d70d0-422">As in the previous examples, ± 50 ppm yields a maximum error of ± 4.3 seconds after 24 hours.</span></span> <span data-ttu-id="d70d0-423">Si un système exécute 4,3 secondes rapidement et que les autres 4,3 secondes sont lentes, l’erreur maximale au bout de 24 heures peut être de 8,6 secondes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-423">If one system runs 4.3 seconds fast, and the other 4.3 seconds slow, the maximum error after 24 hours could be 8.6 seconds.</span></span>

<span data-ttu-id="d70d0-424">Secondes dans une journée = 86400</span><span class="sxs-lookup"><span data-stu-id="d70d0-424">Seconds in a day = 86400</span></span>

<span data-ttu-id="d70d0-425">Erreur de décalage de fréquence = ± 50 ppm = ± 0,00005</span><span class="sxs-lookup"><span data-stu-id="d70d0-425">Frequency offset error = ±50 ppm = ±0.00005</span></span>

<span data-ttu-id="d70d0-426">± (86 400 secondes \* 0,00005) = ± 4,3 secondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-426">±(86,400 seconds \* 0.00005) = ±4.3 seconds</span></span>

<span data-ttu-id="d70d0-427">Décalage maximal entre les deux systèmes = 8,6 secondes</span><span class="sxs-lookup"><span data-stu-id="d70d0-427">Maximum offset between the two systems = 8.6 seconds</span></span>

<span data-ttu-id="d70d0-428">En résumé, l’erreur de décalage de fréquence devient de plus en plus importante lorsque vous mesurez des intervalles de temps longs et que vous comparez des mesures entre différents systèmes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-428">In summary, the frequency offset error becomes increasingly important when measuring long time intervals and when comparing measurements between different systems.</span></span>

<span data-ttu-id="d70d0-429">La stabilité d’un minuteur indique si la fréquence des graduations change au fil du temps, par exemple suite à des modifications de températures.</span><span class="sxs-lookup"><span data-stu-id="d70d0-429">The stability of a timer describes whether the tick frequency changes over time, for example as the result of temperatures changes.</span></span> <span data-ttu-id="d70d0-430">Les cristaux de quartz utilisés comme générateurs de battements sur les ordinateurs présentent de petites modifications de fréquence en tant que fonction de température.</span><span class="sxs-lookup"><span data-stu-id="d70d0-430">Quartz crystals used as the tick generators on computers will exhibit small changes in frequency as a function of temperature.</span></span> <span data-ttu-id="d70d0-431">L’erreur provoquée par la dérive thermique est généralement faible par rapport à l’erreur de décalage de fréquence pour les plages de température courantes.</span><span class="sxs-lookup"><span data-stu-id="d70d0-431">The error caused by thermal drift is typically small compared to the frequency offset error for common temperature ranges.</span></span> <span data-ttu-id="d70d0-432">Toutefois, les concepteurs de logiciels pour les équipements portables ou les équipements soumis à des fluctuations de température importante peuvent avoir à prendre en compte cet effet.</span><span class="sxs-lookup"><span data-stu-id="d70d0-432">However, designers of software for portable equipment or equipment subject to large temperature fluctuations might need to consider this effect.</span></span>

</dd> </dl>

## <a name="hardware-timer-info"></a><span data-ttu-id="d70d0-433">Informations sur la minuterie matérielle</span><span class="sxs-lookup"><span data-stu-id="d70d0-433">Hardware timer info</span></span>

<dl> <dt>

<span data-ttu-id="d70d0-434"><span id="TSC_Register"></span><span id="tsc_register"></span><span id="TSC_REGISTER"></span>**Registre TSC**</span><span class="sxs-lookup"><span data-stu-id="d70d0-434"><span id="TSC_Register"></span><span id="tsc_register"></span><span id="TSC_REGISTER"></span>**TSC Register**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-435">Certains processeurs Intel et AMD contiennent un registre TSC qui est un registre 64 bits qui augmente à un taux élevé, généralement égal à l’horloge du processeur.</span><span class="sxs-lookup"><span data-stu-id="d70d0-435">Some Intel and AMD processors contain a TSC register that is a 64-bit register that increases at a high rate, typically equal to the processor clock.</span></span> <span data-ttu-id="d70d0-436">La valeur de ce compteur peut être lue à l’aide des instructions de l’ordinateur **RDTSC** ou **rdtscp,** , ce qui permet de réduire le temps d’accès et le coût de calcul dans l’ordre des dizaines ou des centaines de cycles de machine, en fonction du processeur.</span><span class="sxs-lookup"><span data-stu-id="d70d0-436">The value of this counter can be read through the **RDTSC** or **RDTSCP** machine instructions, providing very low access time and computational cost in the order of tens or hundreds of machine cycles, depending upon the processor.</span></span>

<span data-ttu-id="d70d0-437">Bien que le registre TSC ressemble à un mécanisme d’horodatage idéal, voici quelques circonstances dans lesquelles il ne peut pas fonctionner de manière fiable à des fins de minuterie :</span><span class="sxs-lookup"><span data-stu-id="d70d0-437">Although the TSC register seems like an ideal time stamp mechanism, here are circumstances in which it can't function reliably for timekeeping purposes:</span></span>

-   <span data-ttu-id="d70d0-438">Tous les processeurs n’ont pas de registres TSC. par conséquent, l’utilisation du Registre TSC dans le logiciel crée directement un problème de portabilité.</span><span class="sxs-lookup"><span data-stu-id="d70d0-438">Not all processors have TSC registers, so using the TSC register in software directly creates a portability problem.</span></span> <span data-ttu-id="d70d0-439">(Windows sélectionne une autre source de temps pour [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) dans ce cas, ce qui évite le problème de portabilité.)</span><span class="sxs-lookup"><span data-stu-id="d70d0-439">(Windows will select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) in this case, which avoids the portability problem.)</span></span>
-   <span data-ttu-id="d70d0-440">Certains processeurs peuvent varier la fréquence de l’horloge TSC ou arrêter l’avancement du Registre TSC, ce qui rend le TSC inadapté à des fins de synchronisation sur ces processeurs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-440">Some processors can vary the frequency of the TSC clock or stop the advancement of the TSC register, which makes the TSC unsuitable for timing purposes on these processors.</span></span> <span data-ttu-id="d70d0-441">Ces processeurs sont appelés registres TSC non invariants.</span><span class="sxs-lookup"><span data-stu-id="d70d0-441">These processors are said to have non-invariant TSC registers.</span></span> <span data-ttu-id="d70d0-442">(Windows détecte automatiquement cela et sélectionne une autre source de temps pour [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span><span class="sxs-lookup"><span data-stu-id="d70d0-442">(Windows will automatically detect this, and select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span></span>
-   <span data-ttu-id="d70d0-443">Sur les systèmes multiprocesseurs ou multicœurs, certains processeurs et systèmes ne peuvent pas synchroniser les horloges de chaque cœur avec la même valeur.</span><span class="sxs-lookup"><span data-stu-id="d70d0-443">On multi-processor or multi-core systems, some processors and systems are unable to synchronize the clocks on each core to the same value.</span></span> <span data-ttu-id="d70d0-444">(Windows détecte automatiquement cela et sélectionne une autre source de temps pour [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span><span class="sxs-lookup"><span data-stu-id="d70d0-444">(Windows will automatically detect this, and select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span></span>
-   <span data-ttu-id="d70d0-445">Sur certains systèmes multiprocesseurs volumineux, vous ne pourrez peut-être pas synchroniser les horloges du processeur avec la même valeur même si le processeur a un TSC invariant.</span><span class="sxs-lookup"><span data-stu-id="d70d0-445">On some large multi-processor systems, you might not be able to synchronize the processor clocks to the same value even if the processor has an invariant TSC.</span></span> <span data-ttu-id="d70d0-446">(Windows détecte automatiquement cela et sélectionne une autre source de temps pour [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span><span class="sxs-lookup"><span data-stu-id="d70d0-446">(Windows will automatically detect this, and select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span></span>
-   <span data-ttu-id="d70d0-447">Certains processeurs exécutent des instructions dans le désordre.</span><span class="sxs-lookup"><span data-stu-id="d70d0-447">Some processors will execute instructions out of order.</span></span> <span data-ttu-id="d70d0-448">Cela peut entraîner des nombres de cycles incorrects lorsque **RDTSC** est utilisé pour les séquences d’instructions Time, car l’instruction **RDTSC** peut être exécutée à une heure différente de celle spécifiée dans votre programme.</span><span class="sxs-lookup"><span data-stu-id="d70d0-448">This can result in incorrect cycle counts when **RDTSC** is used to time instruction sequences because the **RDTSC** instruction might be executed at a different time than specified in your program.</span></span> <span data-ttu-id="d70d0-449">L’instruction **rdtscp,** a été introduite sur certains processeurs en réponse à ce problème.</span><span class="sxs-lookup"><span data-stu-id="d70d0-449">The **RDTSCP** instruction has been introduced on some processors in response to this problem.</span></span>

<span data-ttu-id="d70d0-450">Comme les autres minuteries, le TSC est basé sur un oscillateur à quartz dont la fréquence exacte n’est pas connue à l’avance et qui a une erreur de décalage de fréquence.</span><span class="sxs-lookup"><span data-stu-id="d70d0-450">Like other timers, the TSC is based on a crystal oscillator whose exact frequency is not known in advance and that has a frequency offset error.</span></span> <span data-ttu-id="d70d0-451">Ainsi, avant de pouvoir être utilisé, il doit être étalonné à l’aide d’une autre référence de minutage.</span><span class="sxs-lookup"><span data-stu-id="d70d0-451">Thus before it can be used, it must be calibrated using another timing reference.</span></span>

<span data-ttu-id="d70d0-452">Lors de l’initialisation du système, Windows vérifie si le TSC est adapté à des fins de synchronisation et effectue l’étalonnage et la synchronisation de base de la fréquence nécessaires.</span><span class="sxs-lookup"><span data-stu-id="d70d0-452">During system initialization, Windows checks if the TSC is suitable for timing purposes and performs the necessary frequency calibration and core synchronization.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-453"><span id="PM_Clock"></span><span id="pm_clock"></span><span id="PM_CLOCK"></span>**Heure PM**</span><span class="sxs-lookup"><span data-stu-id="d70d0-453"><span id="PM_Clock"></span><span id="pm_clock"></span><span id="PM_CLOCK"></span>**PM Clock**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-454">Le minuteur ACPI, également appelé horloge PM, a été ajouté à l’architecture système pour fournir des horodatages fiables indépendamment de la vitesse des processeurs.</span><span class="sxs-lookup"><span data-stu-id="d70d0-454">The ACPI timer, also known as the PM clock, was added to the system architecture to provide reliable time stamps independently of the processors speed.</span></span> <span data-ttu-id="d70d0-455">Comme il s’agissait du seul objectif de ce minuteur, il fournit un horodatage en un seul cycle d’horloge, mais il ne fournit pas d’autres fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="d70d0-455">Because this was the single goal of this timer, it provides a time stamp in a single clock cycle, but it doesn't provide any other functionality.</span></span>

</dd> <dt>

<span data-ttu-id="d70d0-456"><span id="HPET_Timer"></span><span id="hpet_timer"></span><span id="HPET_TIMER"></span>**Minuteur HPET**</span><span class="sxs-lookup"><span data-stu-id="d70d0-456"><span id="HPET_Timer"></span><span id="hpet_timer"></span><span id="HPET_TIMER"></span>**HPET Timer**</span></span>
</dt> <dd>

<span data-ttu-id="d70d0-457">Le High Precision Event Timer (HPET) a été développé conjointement par Intel et Microsoft afin de répondre aux exigences de synchronisation du multimédia et d’autres applications de temps.</span><span class="sxs-lookup"><span data-stu-id="d70d0-457">The High Precision Event Timer (HPET) was developed jointly by Intel and Microsoft to meet the timing requirements of multimedia and other time-sensitive applications.</span></span> <span data-ttu-id="d70d0-458">La prise en charge de HPET dans Windows depuis Windows Vista, et Windows 7 et Windows 8 requiert la prise en charge de HPET dans la plateforme matérielle.</span><span class="sxs-lookup"><span data-stu-id="d70d0-458">HPET support has been in Windows since Windows Vista, and Windows 7 and Windows 8 Hardware Logo certification requires HPET support in the hardware platform.</span></span>

</dd> </dl>

 

 
