---
description: Cette rubrique décrit les considérations et les stratégies d’optimisation avec la bibliothèque DirectXMath.
ms.assetid: bcbf8ae1-ed49-fdf7-812d-b2089537ab28
title: Optimisation du code avec la bibliothèque DirectXMath
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d11b331077e3d6538952a2f7956641b8b3919e14
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106540838"
---
# <a name="code-optimization-with-the-directxmath-library"></a><span data-ttu-id="b94f2-103">Optimisation du code avec la bibliothèque DirectXMath</span><span class="sxs-lookup"><span data-stu-id="b94f2-103">Code Optimization with the DirectXMath Library</span></span>

<span data-ttu-id="b94f2-104">Cette rubrique décrit les considérations et les stratégies d’optimisation avec la bibliothèque DirectXMath.</span><span class="sxs-lookup"><span data-stu-id="b94f2-104">This topic describes optimization considerations and strategies with the DirectXMath Library.</span></span>

-   [<span data-ttu-id="b94f2-105">Utiliser des accesseurs avec modération</span><span class="sxs-lookup"><span data-stu-id="b94f2-105">Use accessors sparingly</span></span>](#use-accessors-sparingly)
-   [<span data-ttu-id="b94f2-106">Utiliser les paramètres de compilation corrects</span><span class="sxs-lookup"><span data-stu-id="b94f2-106">Use correct compilation settings</span></span>](#use-correct-compilation-settings)
-   [<span data-ttu-id="b94f2-107">Utiliser les fonctions est lorsque cela est approprié</span><span class="sxs-lookup"><span data-stu-id="b94f2-107">Use Est functions when appropriate</span></span>](#use-est-functions-when-appropriate)
-   [<span data-ttu-id="b94f2-108">Utiliser des types de données alignés et des opérations</span><span class="sxs-lookup"><span data-stu-id="b94f2-108">Use Aligned Data Types and Operations</span></span>](#use-aligned-data-types-and-operations)
-   [<span data-ttu-id="b94f2-109">Aligner correctement les allocations</span><span class="sxs-lookup"><span data-stu-id="b94f2-109">Properly Align Allocations</span></span>](#properly-align-allocations)
-   [<span data-ttu-id="b94f2-110">Éviter les surcharges d’opérateur lorsque cela est possible</span><span class="sxs-lookup"><span data-stu-id="b94f2-110">Avoid Operator Overloads When Possible</span></span>](#avoid-operator-overloads-when-possible)
-   [<span data-ttu-id="b94f2-111">Nombres dénormalisés</span><span class="sxs-lookup"><span data-stu-id="b94f2-111">Denormals</span></span>](#denormals)
-   [<span data-ttu-id="b94f2-112">Tirez parti de la double de la virgule flottante entière</span><span class="sxs-lookup"><span data-stu-id="b94f2-112">Take Advantage of the Integer Floating Point Duality</span></span>](#take-advantage-of-the-integer-floating-point-duality)
-   [<span data-ttu-id="b94f2-113">Préférer les formulaires de modèle</span><span class="sxs-lookup"><span data-stu-id="b94f2-113">Prefer Template Forms</span></span>](#prefer-template-forms)
-   [<span data-ttu-id="b94f2-114">Utilisation de DirectXMath avec Direct3D</span><span class="sxs-lookup"><span data-stu-id="b94f2-114">Using DirectXMath with Direct3D</span></span>](#using-directxmath-with-direct3d)
-   [<span data-ttu-id="b94f2-115">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="b94f2-115">Related topics</span></span>](#related-topics)

## <a name="use-accessors-sparingly"></a><span data-ttu-id="b94f2-116">Utiliser des accesseurs avec modération</span><span class="sxs-lookup"><span data-stu-id="b94f2-116">Use accessors sparingly</span></span>

<span data-ttu-id="b94f2-117">Les opérations basées sur des vecteurs utilisent les jeux d’instructions SIMD et utilisent des registres spéciaux.</span><span class="sxs-lookup"><span data-stu-id="b94f2-117">Vector-based operations use the SIMD instruction sets and these make use of special registers.</span></span> <span data-ttu-id="b94f2-118">L’accès à des composants individuels nécessite de passer des registres SIMD aux types scalaires, puis de les replacer.</span><span class="sxs-lookup"><span data-stu-id="b94f2-118">Accessing individual components requires moving from the SIMD registers to the scalar ones and back again.</span></span>

<span data-ttu-id="b94f2-119">Dans la mesure du possible, il est plus efficace d’initialiser tous les composants d’un [**XMVECTOR**](xmvector-data-type.md) à la fois, au lieu d’utiliser une série d’accesseurs vectoriels individuels.</span><span class="sxs-lookup"><span data-stu-id="b94f2-119">When possible, it is more efficient to initialize all of the components of an [**XMVECTOR**](xmvector-data-type.md) at one time, instead of using a series of individual vector accessors.</span></span>

## <a name="use-correct-compilation-settings"></a><span data-ttu-id="b94f2-120">Utiliser les paramètres de compilation corrects</span><span class="sxs-lookup"><span data-stu-id="b94f2-120">Use correct compilation settings</span></span>

<span data-ttu-id="b94f2-121">Pour les cibles Windows x86, activez/arch : SSE2.</span><span class="sxs-lookup"><span data-stu-id="b94f2-121">For Windows x86 targets, enable /arch:SSE2.</span></span> <span data-ttu-id="b94f2-122">Pour toutes les cibles Windows, activez/FP : Fast.</span><span class="sxs-lookup"><span data-stu-id="b94f2-122">For all Windows targets, enable /fp:fast.</span></span>

<span data-ttu-id="b94f2-123">Par défaut, la compilation par rapport à la bibliothèque DirectXMath pour les cibles x86 des fenêtres est effectuée avec des \_ \_ \_ intrinsèques SSE \_ définis.</span><span class="sxs-lookup"><span data-stu-id="b94f2-123">By default, compilation against the DirectXMath Library for Window x86 targets is done with \_XM\_SSE\_INTRINSICS\_ defined.</span></span> <span data-ttu-id="b94f2-124">Cela signifie que toutes les fonctionnalités de DirectXMath utilisent des instructions SSE2.</span><span class="sxs-lookup"><span data-stu-id="b94f2-124">This means that all DirectXMath functionality will make use of SSE2 instructions.</span></span> <span data-ttu-id="b94f2-125">Toutefois, ce n’est pas le cas pour un autre code.</span><span class="sxs-lookup"><span data-stu-id="b94f2-125">However, the same is not true for other code.</span></span>

<span data-ttu-id="b94f2-126">Le code en dehors de DirectXMath est géré à l’aide des valeurs par défaut du compilateur.</span><span class="sxs-lookup"><span data-stu-id="b94f2-126">Code outside of DirectXMath is handled using compiler defaults.</span></span> <span data-ttu-id="b94f2-127">Sans ce commutateur, le code généré peut souvent utiliser le code X87 moins efficace.</span><span class="sxs-lookup"><span data-stu-id="b94f2-127">Without this switch, the generated code may often use the less efficient x87 code.</span></span>

<span data-ttu-id="b94f2-128">Nous vous recommandons vivement de toujours utiliser la dernière version disponible du compilateur.</span><span class="sxs-lookup"><span data-stu-id="b94f2-128">We highly recommend that you always use the latest available version of the compiler.</span></span>

## <a name="use-est-functions-when-appropriate"></a><span data-ttu-id="b94f2-129">Utiliser les fonctions est lorsque cela est approprié</span><span class="sxs-lookup"><span data-stu-id="b94f2-129">Use Est functions when appropriate</span></span>

<span data-ttu-id="b94f2-130">De nombreuses fonctions ont une fonction d’estimation équivalente se terminant par est.</span><span class="sxs-lookup"><span data-stu-id="b94f2-130">Many functions have an equivalent estimation function ending in Est.</span></span> <span data-ttu-id="b94f2-131">Ces fonctions échangent une certaine précision pour améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="b94f2-131">These functions trade some accuracy for improved performance.</span></span> <span data-ttu-id="b94f2-132">Les fonctions est appropriées pour les calculs non critiques où la précision peut être sacrifiée à la vitesse.</span><span class="sxs-lookup"><span data-stu-id="b94f2-132">Est functions are appropriate for non-critical calculations where accuracy can be sacrificed for speed.</span></span> <span data-ttu-id="b94f2-133">La quantité exacte de précision et d’augmentation de la vitesse perdue dépend de la plateforme.</span><span class="sxs-lookup"><span data-stu-id="b94f2-133">The exact amount of lost accuracy and speed increase are platform dependent.</span></span>

<span data-ttu-id="b94f2-134">Par exemple, la fonction [**XMVector3AngleBetweenNormalsEst**](/windows/win32/api/directxmath/nf-directxmath-xmvector3anglebetweennormalsest) peut être utilisée à la place de la fonction [**XMVector3AngleBetweenNormals**](/windows/win32/api/directxmath/nf-directxmath-xmvector3anglebetweennormals) .</span><span class="sxs-lookup"><span data-stu-id="b94f2-134">For example, the [**XMVector3AngleBetweenNormalsEst**](/windows/win32/api/directxmath/nf-directxmath-xmvector3anglebetweennormalsest) function could be used in place of the [**XMVector3AngleBetweenNormals**](/windows/win32/api/directxmath/nf-directxmath-xmvector3anglebetweennormals) function.</span></span>

## <a name="use-aligned-data-types-and-operations"></a><span data-ttu-id="b94f2-135">Utiliser des types de données alignés et des opérations</span><span class="sxs-lookup"><span data-stu-id="b94f2-135">Use Aligned Data Types and Operations</span></span>

<span data-ttu-id="b94f2-136">Les jeux d’instructions SIMD sur les versions de Windows prenant en charge SSE2 ont généralement des versions alignées et non alignées des opérations de mémoire.</span><span class="sxs-lookup"><span data-stu-id="b94f2-136">The SIMD instruction sets on versions of windows supporting SSE2 typically have aligned and unaligned versions of memory operations.</span></span> <span data-ttu-id="b94f2-137">L’utilisation des opérations alignées est plus rapide et doit être préférable dans la mesure du possible.</span><span class="sxs-lookup"><span data-stu-id="b94f2-137">The use of the aligned operations is faster, and should be preferred wherever possible.</span></span>

<span data-ttu-id="b94f2-138">La bibliothèque DirectXMath fournit des fonctionnalités alignées et non alignées par le biais de types de vecteurs variants, d’une structure et de fonctions.</span><span class="sxs-lookup"><span data-stu-id="b94f2-138">The DirectXMath Library provides access aligned and unaligned functionality through variant vector types, structure, and functions.</span></span> <span data-ttu-id="b94f2-139">Ces variantes sont indiquées par un « A » à la fin du nom.</span><span class="sxs-lookup"><span data-stu-id="b94f2-139">These variants are indicated by an "A" at the end of the name.</span></span>

<span data-ttu-id="b94f2-140">Par exemple, il existe une structure [**XMFLOAT4X4**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4x4) non alignée et une structure [**XMFLOAT4X4A**](/previous-versions/windows/desktop/legacy/ee419623(v=vs.85)) alignée, qui sont utilisées respectivement par les fonctions [**XMStoreFloat4**](/windows/win32/api/directxmath/nf-directxmath-xmstorefloat4) et [**XMStoreFloat4A**](/windows/win32/api/directxmath/nf-directxmath-xmstorefloat4a) .</span><span class="sxs-lookup"><span data-stu-id="b94f2-140">For example, there are an unaligned [**XMFLOAT4X4**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4x4) structure and an aligned [**XMFLOAT4X4A**](/previous-versions/windows/desktop/legacy/ee419623(v=vs.85)) structure, which are used by the [**XMStoreFloat4**](/windows/win32/api/directxmath/nf-directxmath-xmstorefloat4) and [**XMStoreFloat4A**](/windows/win32/api/directxmath/nf-directxmath-xmstorefloat4a) functions respectively.</span></span>

## <a name="properly-align-allocations"></a><span data-ttu-id="b94f2-141">Aligner correctement les allocations</span><span class="sxs-lookup"><span data-stu-id="b94f2-141">Properly Align Allocations</span></span>

<span data-ttu-id="b94f2-142">Les versions alignées des intrinsèques [SSE](/previous-versions/visualstudio/visual-studio-2010/t467de55(v=vs.100)) sous-jacents de la bibliothèque DirectXMath sont plus rapides que le non aligné.</span><span class="sxs-lookup"><span data-stu-id="b94f2-142">The aligned versions of the [SSE](/previous-versions/visualstudio/visual-studio-2010/t467de55(v=vs.100)) intrinsics underlying the DirectXMath Library are faster than the unaligned.</span></span>

<span data-ttu-id="b94f2-143">Pour cette raison, les opérations DirectXMath utilisant des objets [**XMVECTOR**](xmvector-data-type.md) et [**XMMATRIX**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) supposent que ces objets sont alignés sur 16 octets.</span><span class="sxs-lookup"><span data-stu-id="b94f2-143">For this reason, DirectXMath operations using [**XMVECTOR**](xmvector-data-type.md) and [**XMMATRIX**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) objects assume those objects are 16-byte aligned.</span></span> <span data-ttu-id="b94f2-144">Cela est automatique pour les allocations basées sur la pile, si le code est compilé par rapport à la bibliothèque DirectXMath à l’aide des paramètres du compilateur Windows (consultez [utiliser des paramètres de compilation corrects](#use-correct-compilation-settings)).</span><span class="sxs-lookup"><span data-stu-id="b94f2-144">This is automatic for stack based allocations, if code is compiled against the DirectXMath Library using the recommended Windows (see [Use Correct Compilation Settings](#use-correct-compilation-settings)) compiler settings.</span></span> <span data-ttu-id="b94f2-145">Toutefois, il est important de s’assurer que l’allocation du tas contenant les objets **XMVECTOR** et **XMMATRIX** , ou les casts vers ces types, répondent à ces exigences d’alignement.</span><span class="sxs-lookup"><span data-stu-id="b94f2-145">However, it is important to ensure that heap-allocation containing **XMVECTOR** and **XMMATRIX** objects, or casts to these types, meet these alignment requirements.</span></span>

<span data-ttu-id="b94f2-146">Alors que les allocations de mémoire Windows 64 bits sont alignées sur 16 octets, par défaut sur les versions 32 bits de la mémoire Windows allouée est uniquement alignée sur 8 octets.</span><span class="sxs-lookup"><span data-stu-id="b94f2-146">While 64-bit Windows memory allocations are 16-byte aligned, by default on 32 bit versions of Windows memory allocated is only 8-byte aligned.</span></span> <span data-ttu-id="b94f2-147">Pour plus d’informations sur le contrôle de l’alignement de la mémoire, consultez [ \_ \_ malloc aligné](https://msdn.microsoft.com/library/8z34s9c6(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="b94f2-147">For information on controlling memory alignment, see [\_aligned\_malloc](https://msdn.microsoft.com/library/8z34s9c6(VS.80).aspx).</span></span>

<span data-ttu-id="b94f2-148">Lorsque vous utilisez des types DirectXMath alignés avec la bibliothèque STL (Standard Template Library), vous devez fournir un allocateur personnalisé qui garantit l’alignement sur 16 octets.</span><span class="sxs-lookup"><span data-stu-id="b94f2-148">When using aligned DirectXMath types with the Standard Template Library (STL), you will need to provide a custom allocator that ensures the 16-byte alignment.</span></span> <span data-ttu-id="b94f2-149">Consultez le [blog](https://devblogs.microsoft.com/cppblog/the-mallocator/) de l’équipe Visual C++ pour obtenir un exemple d’écriture d’un allocateur personnalisé (au lieu de malloc/Free, vous souhaiterez utiliser \_ \_ le malloc aligné et l' \_ alignement \_ gratuit dans votre implémentation).</span><span class="sxs-lookup"><span data-stu-id="b94f2-149">See the Visual C++ Team [blog](https://devblogs.microsoft.com/cppblog/the-mallocator/) for an example of writing a custom allocator (instead of malloc/free you'll want to use \_aligned\_malloc and \_aligned\_free in your implementation).</span></span>

> [!Note]  
> <span data-ttu-id="b94f2-150">Certains modèles STL modifient l’alignement du type fourni.</span><span class="sxs-lookup"><span data-stu-id="b94f2-150">Some STL templates modify the provided type's alignment.</span></span> <span data-ttu-id="b94f2-151">Par exemple, [créez un \_<>partagé ](/cpp/standard-library/memory-functions?view=vs-2017&preserve-view=true) pour ajouter des informations de suivi internes qui peuvent ou non respecter l’alignement du type d’utilisateur fourni, ce qui entraîne des données membres non alignées.</span><span class="sxs-lookup"><span data-stu-id="b94f2-151">For example, [make\_shared<>](/cpp/standard-library/memory-functions?view=vs-2017&preserve-view=true) adds some internal tracking information which may or may not respect the alignment of the provided user type, resulting in unaligned data members.</span></span> <span data-ttu-id="b94f2-152">Dans ce cas, vous devez utiliser des types non alignés au lieu de types alignés.</span><span class="sxs-lookup"><span data-stu-id="b94f2-152">In this case, you need to use unaligned types instead of aligned types.</span></span> <span data-ttu-id="b94f2-153">Si vous dérivez de classes existantes, y compris de nombreux objets Windows Runtime, vous pouvez également modifier l’alignement d’une classe ou d’une structure.</span><span class="sxs-lookup"><span data-stu-id="b94f2-153">If you derive from existing classes, including many Windows Runtime objects, you can also modify the alignment of a class or structure.</span></span>

 

## <a name="avoid-operator-overloads-when-possible"></a><span data-ttu-id="b94f2-154">Éviter les surcharges d’opérateur lorsque cela est possible</span><span class="sxs-lookup"><span data-stu-id="b94f2-154">Avoid Operator Overloads When Possible</span></span>

<span data-ttu-id="b94f2-155">En guise de fonctionnalité pratique, plusieurs types tels que [**XMVECTOR**](xmvector-data-type.md) et [**XMMATRIX**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) ont des surcharges d’opérateur pour les opérations arithmétiques courantes.</span><span class="sxs-lookup"><span data-stu-id="b94f2-155">As a convenience feature, a number of types such as [**XMVECTOR**](xmvector-data-type.md) and [**XMMATRIX**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) have operator overloads for common arithmetic operations.</span></span> <span data-ttu-id="b94f2-156">Ces surcharges d’opérateur ont tendance à créer de nombreux objets temporaires.</span><span class="sxs-lookup"><span data-stu-id="b94f2-156">Such operator overloads tend to create numerous temporary objects.</span></span> <span data-ttu-id="b94f2-157">Nous vous recommandons d’éviter ces surcharges d’opérateur dans le code qui respecte les performances.</span><span class="sxs-lookup"><span data-stu-id="b94f2-157">We recommend that you avoid these operator overloads in performance sensitive code.</span></span>

## <a name="denormals"></a><span data-ttu-id="b94f2-158">Nombres dénormalisés</span><span class="sxs-lookup"><span data-stu-id="b94f2-158">Denormals</span></span>

<span data-ttu-id="b94f2-159">Pour prendre en charge les calculs proches de 0, la norme IEEE 754 à virgule flottante prend en charge le débordement graduel.</span><span class="sxs-lookup"><span data-stu-id="b94f2-159">To support computations close to 0, the IEEE 754 float-point standard includes support for gradual underflow.</span></span> <span data-ttu-id="b94f2-160">Un dépassement de capacité négatif graduel est implémenté par le biais de l’utilisation de valeurs dénormalisées, et de nombreuses implémentations matérielles sont lentes lors de la gestion des dénormals.</span><span class="sxs-lookup"><span data-stu-id="b94f2-160">Gradual underflow is implemented through the use of denormalized values, and many hardware implementations are slow when handling denormals.</span></span> <span data-ttu-id="b94f2-161">Une optimisation à prendre en compte est la désactivation de la gestion des dénormals pour les opérations vectorielles utilisées par DirectXMath.</span><span class="sxs-lookup"><span data-stu-id="b94f2-161">An optimization to consider is to disable the handling of denormals for the vector operations used by DirectXMath.</span></span>

<span data-ttu-id="b94f2-162">La modification de la gestion des dénormals s’effectue à l’aide de la routine [ \_ controlfp \_ s](/cpp/c-runtime-library/reference/controlfp-s) sur une base pré-thread, ce qui peut améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="b94f2-162">Changing the handling of denormals is done by using the [\_controlfp\_s](/cpp/c-runtime-library/reference/controlfp-s) routine on a pre-thread basis, and can result in performance improvements.</span></span> <span data-ttu-id="b94f2-163">Utilisez ce code pour modifier la gestion des dénormals :</span><span class="sxs-lookup"><span data-stu-id="b94f2-163">Use this code to change the handling of denormals:</span></span>


```
  #include <float.h>;
    unsigned int control_word;
    _controlfp_s( &control_word, _DN_FLUSH, _MCW_DN );
```



> [!Note]  
> <span data-ttu-id="b94f2-164">Sur les versions 64 bits de Windows, les instructions [SSE](/previous-versions/visualstudio/visual-studio-2010/t467de55(v=vs.100)) sont utilisées pour tous les calculs, pas seulement pour les opérations de vecteur.</span><span class="sxs-lookup"><span data-stu-id="b94f2-164">On 64-bit versions of Windows, [SSE](/previous-versions/visualstudio/visual-studio-2010/t467de55(v=vs.100)) instructions are used for all computations, not just the vector operations.</span></span> <span data-ttu-id="b94f2-165">La modification du traitement dénormal affecte tous les calculs à virgule flottante dans votre programme, pas seulement les opérations vectorielles utilisées par DirectXMath.</span><span class="sxs-lookup"><span data-stu-id="b94f2-165">Changing the denormal handling affects all floating-point computations in your program, not just the vector operations used by DirectXMath.</span></span>

 

## <a name="take-advantage-of-the-integer-floating-point-duality"></a><span data-ttu-id="b94f2-166">Tirez parti de la double de la virgule flottante entière</span><span class="sxs-lookup"><span data-stu-id="b94f2-166">Take Advantage of the Integer Floating Point Duality</span></span>

<span data-ttu-id="b94f2-167">DirectXMath prend en charge les vecteurs de 4 valeurs à virgule flottante simple précision ou 4 32 bits (signé ou non signé).</span><span class="sxs-lookup"><span data-stu-id="b94f2-167">DirectXMath supports vectors of 4 single-precision floating-point or four 32-bit (signed or unsigned) values.</span></span>

<span data-ttu-id="b94f2-168">Étant donné que les jeux d’instructions utilisés pour implémenter la bibliothèque DirectXMath peuvent traiter les mêmes données que plusieurs types différents, par exemple, traiter le même vecteur comme des données à virgule flottante et des entiers, certaines optimisations peuvent être réalisées.</span><span class="sxs-lookup"><span data-stu-id="b94f2-168">Because the instruction sets used to implement the DirectXMath Library have the ability to treat the same data as multiple different types-for example, treat the same vector as floating-point and integer data-certain optimizations can be achieved.</span></span> <span data-ttu-id="b94f2-169">Vous pouvez utiliser ces optimisations à l’aide des routines d’initialisation de vecteur entier et des opérateurs de bits pour manipuler les valeurs à virgule flottante.</span><span class="sxs-lookup"><span data-stu-id="b94f2-169">You can get these optimizations by using the integer vector initialization routines and bit-wise operators to manipulate floating-point values.</span></span>

<span data-ttu-id="b94f2-170">Le format binaire des nombres à virgule flottante simple précision utilisé par la bibliothèque DirectXMath est entièrement conforme à la norme IEEE 764 :</span><span class="sxs-lookup"><span data-stu-id="b94f2-170">The binary format of single-precision floating-point numbers used by the DirectXMath Library completely conforms to the IEEE 764 standard:</span></span>

``` syntax
     SIGN    EXPONENT   MANTISSA
     X       XXXXXXXX   XXXXXXXXXXXXXXXXXXXXXXX
     1 bit   8 bits     23 bits
```

<span data-ttu-id="b94f2-171">Lorsque vous utilisez le nombre à virgule flottante simple précision IEEE 764, il est important de garder à l’esprit que certaines représentations ont une signification particulière (autrement dit, elles ne sont pas conformes à la description précédente).</span><span class="sxs-lookup"><span data-stu-id="b94f2-171">When working with the IEEE 764 single precision floating-point number, it is important to keep in mind, that some representations have special meaning (that is, they do not conform to the preceding description).</span></span> <span data-ttu-id="b94f2-172">Voici quelques exemples :</span><span class="sxs-lookup"><span data-stu-id="b94f2-172">Examples include:</span></span>

-   <span data-ttu-id="b94f2-173">Un zéro positif est 0</span><span class="sxs-lookup"><span data-stu-id="b94f2-173">Positive zero is 0</span></span>
-   <span data-ttu-id="b94f2-174">Zéro négatif est 0x80000000</span><span class="sxs-lookup"><span data-stu-id="b94f2-174">Negative zero is 0x80000000</span></span>
-   <span data-ttu-id="b94f2-175">Q \_ NaN est 07FC0000</span><span class="sxs-lookup"><span data-stu-id="b94f2-175">Q\_NAN is 07FC0000</span></span>
-   <span data-ttu-id="b94f2-176">+ INF est 0x7F800000</span><span class="sxs-lookup"><span data-stu-id="b94f2-176">+INF is 0x7F800000</span></span>
-   <span data-ttu-id="b94f2-177">-Le fichier INF est 0xFF800000</span><span class="sxs-lookup"><span data-stu-id="b94f2-177">-INF is 0xFF800000</span></span>

## <a name="prefer-template-forms"></a><span data-ttu-id="b94f2-178">Préférer les formulaires de modèle</span><span class="sxs-lookup"><span data-stu-id="b94f2-178">Prefer Template Forms</span></span>

<span data-ttu-id="b94f2-179">Le formulaire de modèle existe pour [**XMVectorSwizzle**](/windows/win32/api/directxmath/nf-directxmath-xmvectorswizzle), [**XMVectorPermute**](/windows/win32/api/directxmath/nf-directxmath-xmvectorpermute), [**XMVectorInsert**](/windows/win32/api/directxmath/nf-directxmath-xmvectorinsert), [**XMVectorShiftLeft**](/windows/win32/api/directxmath/nf-directxmath-xmvectorshiftleft), [**XMVectorRotateLeft**](/windows/win32/api/directxmath/nf-directxmath-xmvectorrotateleft)et [**XMVectorRotateRight**](/windows/win32/api/directxmath/nf-directxmath-xmvectorrotateright).</span><span class="sxs-lookup"><span data-stu-id="b94f2-179">Template form exists for [**XMVectorSwizzle**](/windows/win32/api/directxmath/nf-directxmath-xmvectorswizzle), [**XMVectorPermute**](/windows/win32/api/directxmath/nf-directxmath-xmvectorpermute), [**XMVectorInsert**](/windows/win32/api/directxmath/nf-directxmath-xmvectorinsert), [**XMVectorShiftLeft**](/windows/win32/api/directxmath/nf-directxmath-xmvectorshiftleft), [**XMVectorRotateLeft**](/windows/win32/api/directxmath/nf-directxmath-xmvectorrotateleft), and [**XMVectorRotateRight**](/windows/win32/api/directxmath/nf-directxmath-xmvectorrotateright).</span></span> <span data-ttu-id="b94f2-180">L’utilisation de ces fonctions au lieu du formulaire de fonction générale permet au compilateur de créer des implémentations bien plus efficent.</span><span class="sxs-lookup"><span data-stu-id="b94f2-180">Using these instead of the general function form allows the compiler to create much more efficent implementations.</span></span> <span data-ttu-id="b94f2-181">Pour [SSE](/previous-versions/visualstudio/visual-studio-2010/t467de55(v=vs.100)), cette valeur est souvent réduite à une ou deux \_ mm \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="b94f2-181">For [SSE](/previous-versions/visualstudio/visual-studio-2010/t467de55(v=vs.100)), this often collapses down to one or two \_mm\_shuffle\_ps values.</span></span> <span data-ttu-id="b94f2-182">Pour ARM-néon, le modèle **XMVectorSwizzle** peut utiliser un certain nombre de cas spéciaux plutôt que les Swizzle/permutements VTBL plus généraux.</span><span class="sxs-lookup"><span data-stu-id="b94f2-182">For ARM-NEON, the **XMVectorSwizzle** template can utilize a number of special cases rather than the more general VTBL swizzle/permute.</span></span>

## <a name="using-directxmath-with-direct3d"></a><span data-ttu-id="b94f2-183">Utilisation de DirectXMath avec Direct3D</span><span class="sxs-lookup"><span data-stu-id="b94f2-183">Using DirectXMath with Direct3D</span></span>

<span data-ttu-id="b94f2-184">Une utilisation courante de DirectXMath consiste à effectuer des calculs graphiques à utiliser avec Direct3D.</span><span class="sxs-lookup"><span data-stu-id="b94f2-184">A common use for DirectXMath is to perform graphics computations for use with Direct3D.</span></span> <span data-ttu-id="b94f2-185">Avec Direct3D 10. x et Direct3D 11. x, vous pouvez utiliser la bibliothèque DirectXMath de l’une des façons suivantes :</span><span class="sxs-lookup"><span data-stu-id="b94f2-185">With Direct3D 10.x and Direct3D 11.x, you can use the DirectXMath library in these direct ways:</span></span>

-   <span data-ttu-id="b94f2-186">Utilisez les [constantes](ovw-xnamath-reference-constants.md) d’espace de noms de couleurs directement dans le paramètre *ColorRGBA* dans un appel à la méthode [**ID3D11DeviceContext :: ClearRenderTargetView**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-clearrendertargetview) ou [**ID3D10Device :: ClearRenderTargetView**](/windows/win32/api/d3d10/nf-d3d10-id3d10device-clearrendertargetview) .</span><span class="sxs-lookup"><span data-stu-id="b94f2-186">Use the Colors namespace [constants](ovw-xnamath-reference-constants.md) directly in the *ColorRGBA* parameter in a call to the [**ID3D11DeviceContext::ClearRenderTargetView**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-clearrendertargetview) or [**ID3D10Device::ClearRenderTargetView**](/windows/win32/api/d3d10/nf-d3d10-id3d10device-clearrendertargetview) method.</span></span> <span data-ttu-id="b94f2-187">Pour Direct3D 9, vous devez effectuer la conversion vers le type [**XMCOLOR**](/windows/desktop/api/DirectXPackedVector/ns-directxpackedvector-xmcolor) pour l’utiliser comme paramètre *Color* dans un appel à la méthode [**IDirect3DDevice9 :: Clear**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-clear) .</span><span class="sxs-lookup"><span data-stu-id="b94f2-187">For Direct3D 9, you must convert to the [**XMCOLOR**](/windows/desktop/api/DirectXPackedVector/ns-directxpackedvector-xmcolor) type to use it as the *Color* parameter in a call to the [**IDirect3DDevice9::Clear**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-clear) method.</span></span>
-   <span data-ttu-id="b94f2-188">Utilisez les types [**XMFLOAT4**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4) / [**XMVECTOR**](xmvector-data-type.md) et [**XMFLOAT4X4**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4x4) / [**XMMATRIX**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) pour configurer des structures de mémoire tampon constantes pour les références par les types HLSL [**float4**](../direct3dhlsl/dx-graphics-hlsl-scalar.md) ou [**Matrix**](../direct3dhlsl/dx-graphics-hlsl-matrix.md)/float4x4.</span><span class="sxs-lookup"><span data-stu-id="b94f2-188">Use the [**XMFLOAT4**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4)/[**XMVECTOR**](xmvector-data-type.md) and [**XMFLOAT4X4**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4x4)/[**XMMATRIX**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) types to setup constant buffer structures for reference by HLSL [**float4**](../direct3dhlsl/dx-graphics-hlsl-scalar.md) or [**matrix**](../direct3dhlsl/dx-graphics-hlsl-matrix.md)/float4x4 types.</span></span>
    > [!Note]  
    > <span data-ttu-id="b94f2-189">[**XMFLOAT4X4**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4x4) / Les types [**XMMATRIX**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) sont au format de ligne principale.</span><span class="sxs-lookup"><span data-stu-id="b94f2-189">[**XMFLOAT4X4**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4x4)/[**XMMATRIX**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) types are in row-major format.</span></span> <span data-ttu-id="b94f2-190">Par conséquent, si vous utilisez le commutateur de compilateur/ZPR (indicateur de compilation [**\_ \_ \_ colonne \_ principale de matrice D3DCOMPILE**](../direct3dhlsl/d3dcompile-constants.md) ) ou si \_ vous [](../direct3dhlsl/dx-graphics-hlsl-appendix-keywords.md) déclarez le type de matrice en HLSL, vous devez transposer la matrice lorsque vous la définissez dans la mémoire tampon constante.</span><span class="sxs-lookup"><span data-stu-id="b94f2-190">Therefore, if you use the /Zpr compiler switch (the [**D3DCOMPILE\_PACK\_MATRIX\_COLUMN\_MAJOR**](../direct3dhlsl/d3dcompile-constants.md) compile flag) or omit the row\_major [keyword](../direct3dhlsl/dx-graphics-hlsl-appendix-keywords.md) when you declare the matrix type in HLSL, you must transpose the matrix when you set it into the constant buffer.</span></span>

     

-   <span data-ttu-id="b94f2-191">Avec Direct3D 10. x et Direct3D 11. x, vous pouvez supposer que le pointeur retourné par la méthode Map (par exemple, [**ID3D11DeviceContext :: Map**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-map)) dans le membre **pData** ([**D3D10 \_ mappé \_ TEXTURE2D**](/windows/win32/api/d3d10/ns-d3d10-d3d10_mapped_texture2d).**pData**, [**D3D10 \_ mappé \_ TEXTURE3D**](/windows/win32/api/d3d10/ns-d3d10-d3d10_mapped_texture3d).**pData**, ou sous- [**\_ \_ ressource mappée d3d11**](/windows/win32/api/d3d11/ns-d3d11-d3d11_mapped_subresource).**pData**) est aligné sur 16 octets si vous utilisez le [niveau de fonctionnalité](../direct3d11/overviews-direct3d-11-devices-downlevel-intro.md) 10 \_ 0 ou une valeur supérieure, ou chaque fois que vous utilisez des ressources de mise en [**\_ \_ lots de l’utilisation de d3d11**](/windows/win32/api/d3d11/ne-d3d11-d3d11_usage) .</span><span class="sxs-lookup"><span data-stu-id="b94f2-191">With Direct3D 10.x and Direct3D 11.x, you can assume that the pointer returned by the Map method (for example, [**ID3D11DeviceContext::Map**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-map)) in the **pData** member ([**D3D10\_MAPPED\_TEXTURE2D**](/windows/win32/api/d3d10/ns-d3d10-d3d10_mapped_texture2d).**pData**, [**D3D10\_MAPPED\_TEXTURE3D**](/windows/win32/api/d3d10/ns-d3d10-d3d10_mapped_texture3d).**pData**, or [**D3D11\_MAPPED\_SUBRESOURCE**](/windows/win32/api/d3d11/ns-d3d11-d3d11_mapped_subresource).**pData**) is 16-byte aligned if you use [feature level](../direct3d11/overviews-direct3d-11-devices-downlevel-intro.md) 10\_0 or higher or whenever you use [**D3D11\_USAGE\_STAGING**](/windows/win32/api/d3d11/ne-d3d11-d3d11_usage) resources.</span></span>

## <a name="related-topics"></a><span data-ttu-id="b94f2-192">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="b94f2-192">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b94f2-193">Guide de programmation DirectXMath</span><span class="sxs-lookup"><span data-stu-id="b94f2-193">DirectXMath Programming Guide</span></span>](ovw-xnamath-progguide.md)
</dt> </dl>

 

 
