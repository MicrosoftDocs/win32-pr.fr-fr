---
title: Réflexion du Registre
description: Le redirecteur du Registre isole les applications 32 bits et 64 bits en fournissant des vues logiques distinctes de certaines parties du Registre sur WOW64. Toutefois, les valeurs de certaines clés de Registre doivent être identiques dans les vues 32 bits et 64 bits.
ms.assetid: eac9038b-9f59-4ac7-8974-f94a4a62a257
keywords:
- réflexion du Registre, 64 bits, programmation Windows
- la programmation Windows 64 bits de réflexion
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 523041004d9570bbdf101050e30f5d9139031913
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "106518018"
---
# <a name="registry-reflection"></a><span data-ttu-id="3b516-106">Réflexion du Registre</span><span class="sxs-lookup"><span data-stu-id="3b516-106">Registry Reflection</span></span>

<span data-ttu-id="3b516-107">\[Les informations contenues dans cette rubrique s’appliquent à Windows Server 2008, Windows Vista, Windows Server 2003 et Windows XP.</span><span class="sxs-lookup"><span data-stu-id="3b516-107">\[The information in this topic applies to Windows Server 2008, Windows Vista, Windows Server 2003, and Windows XP.</span></span> <span data-ttu-id="3b516-108">À compter de Windows 7 et de Windows Server 2008 R2, WOW64 n’utilise plus la réflexion du Registre et les clés précédemment réfléchies sont partagées à la place.</span><span class="sxs-lookup"><span data-stu-id="3b516-108">Starting with Windows 7 and Windows Server 2008 R2, WOW64 no longer uses registry reflection and formerly reflected keys are shared instead.</span></span> <span data-ttu-id="3b516-109">Pour plus d’informations, consultez [clés de Registre affectées par WOW64](shared-registry-keys.md).\]</span><span class="sxs-lookup"><span data-stu-id="3b516-109">For more information, see [Registry Keys Affected by WOW64](shared-registry-keys.md).\]</span></span>

<span data-ttu-id="3b516-110">Le [redirecteur du Registre](registry-redirector.md) isole les applications 32 bits et 64 bits en fournissant des vues logiques distinctes de certaines parties du Registre sur WOW64.</span><span class="sxs-lookup"><span data-stu-id="3b516-110">The [registry redirector](registry-redirector.md) isolates 32-bit and 64-bit applications by providing separate logical views of certain portions of the registry on WOW64.</span></span> <span data-ttu-id="3b516-111">Toutefois, les valeurs de certaines clés de Registre doivent être identiques dans les vues 32 bits et 64 bits.</span><span class="sxs-lookup"><span data-stu-id="3b516-111">However, the values of some registry keys must be the same in both the 32-bit and 64-bit views.</span></span>

<span data-ttu-id="3b516-112">Le processus de *réflexion du Registre* copie les clés de Registre et les valeurs entre deux vues du Registre pour les maintenir synchronisées.</span><span class="sxs-lookup"><span data-stu-id="3b516-112">The process of *registry reflection* copies registry keys and values between two registry views to keep them synchronized.</span></span> <span data-ttu-id="3b516-113">Chaque vue a une copie physique distincte de chaque clé de Registre réfléchie, une pour la vue de Registre 32 bits et l’autre pour la vue de Registre 64 bits.</span><span class="sxs-lookup"><span data-stu-id="3b516-113">Each view has a separate physical copy of each reflected registry key, one for the 32-bit registry view and the other for the 64-bit registry view.</span></span>

<span data-ttu-id="3b516-114">Une clé réfléchie est copiée quand une clé est fermée en appelant [**échec RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey).</span><span class="sxs-lookup"><span data-stu-id="3b516-114">A reflected key is copied when a key is closed by calling [**RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey).</span></span> <span data-ttu-id="3b516-115">Notez que cela donne lieu à une situation de concurrence possible : si plusieurs processus modifient la clé réfléchie, le dernier appel **échec RegCloseKey** détermine la valeur finale de la clé.</span><span class="sxs-lookup"><span data-stu-id="3b516-115">Note that this gives rise to a possible race condition: if more than one process changes the reflected key, the last **RegCloseKey** call determines the key's final value.</span></span>

<span data-ttu-id="3b516-116">Le réflecteur copie les données d’activation COM pour les serveurs locaux entre les vues, mais il ne copie pas les données in-process, car le mixage de données in-process 32/64 n’est pas autorisé sur Windows 64 bits.</span><span class="sxs-lookup"><span data-stu-id="3b516-116">The reflector copies COM activation data for Local servers between the views, but it does not copy in-process data because 32/64 in-process data mixing is not permitted on 64-bit Windows.</span></span>

<span data-ttu-id="3b516-117">La réflexion n’est pas activée pour les clés de Registre partagées ou pour les clés de Registre qui ne sont pas redirigées.</span><span class="sxs-lookup"><span data-stu-id="3b516-117">Reflection is not enabled for shared registry keys or for registry keys that are not redirected.</span></span> <span data-ttu-id="3b516-118">Par exemple, la réflexion n’est pas activée pour la clé **\_ \_ \\ système HKEY local machine** .</span><span class="sxs-lookup"><span data-stu-id="3b516-118">For example, reflection is not enabled for the **HKEY\_LOCAL\_MACHINE\\System** key.</span></span> <span data-ttu-id="3b516-119">Pour obtenir la liste des clés de Registre qui sont redirigées, partagées ou reflétées, consultez [clés de Registre affectées par WOW64](shared-registry-keys.md).</span><span class="sxs-lookup"><span data-stu-id="3b516-119">For a list of registry keys that are redirected, shared, or reflected, see [Registry Keys Affected by WOW64](shared-registry-keys.md).</span></span>

<span data-ttu-id="3b516-120">La réflexion du Registre utilise une stratégie « dernier enregistreur gagne », comme illustré dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="3b516-120">Registry reflection uses a "last writer wins" policy as illustrated in the following example:</span></span>

-   <span data-ttu-id="3b516-121">Après une nouvelle installation de Windows 64 bits, le Wordpad.exe 64 bits est inscrit pour gérer les fichiers. doc.</span><span class="sxs-lookup"><span data-stu-id="3b516-121">After a clean installation of 64-bit Windows, 64-bit Wordpad.exe is registered to handle .doc files.</span></span> <span data-ttu-id="3b516-122">Le réflecteur copie l’inscription. doc à partir de la vue de Registre 64 bits dans la vue de Registre 32 bits.</span><span class="sxs-lookup"><span data-stu-id="3b516-122">The reflector copies the .doc registration from the 64-bit registry view into the 32-bit registry view.</span></span>
-   <span data-ttu-id="3b516-123">Un administrateur installe le bureau 32 bits, qui inscrit le Winword.exe 32 bits pour gérer les fichiers. doc dans l’affichage du Registre 32 bits.</span><span class="sxs-lookup"><span data-stu-id="3b516-123">An administrator installs 32-bit Office, which registers 32-bit Winword.exe to handle .doc files in the 32-bit registry view.</span></span> <span data-ttu-id="3b516-124">Le réflecteur du Registre copie ces informations dans la vue de Registre 64 bits, de sorte que les applications 32 bits et 64 bits lancent la version 32 bits de Winword.exe pour les fichiers. doc.</span><span class="sxs-lookup"><span data-stu-id="3b516-124">The registry reflector copies this information into the 64-bit registry view, so both 32-bit and 64-bit applications launch the 32-bit version of Winword.exe for .doc files.</span></span>
-   <span data-ttu-id="3b516-125">Un administrateur installe le bureau 64 bits, qui inscrit le Winword.exe 64 bits pour gérer les fichiers. doc dans l’affichage du Registre 64 bits.</span><span class="sxs-lookup"><span data-stu-id="3b516-125">An administrator installs 64-bit Office, which registers 64-bit Winword.exe to handle .doc files in the 64-bit registry view.</span></span> <span data-ttu-id="3b516-126">Le réflecteur de Registre copie ces informations dans le registre 32 bits, de sorte que les applications 32 bits et 64 bits lancent la version 64 bits de Winword.exe pour les fichiers. doc.</span><span class="sxs-lookup"><span data-stu-id="3b516-126">The registry reflector copies this information into the 32-bit registry, so both 32-bit and 64-bit applications launch the 64-bit version of Winword.exe for .doc files.</span></span>

<span data-ttu-id="3b516-127">Par conséquent, les informations d’association de fichiers sont conservées pour l’application la plus récemment installée.</span><span class="sxs-lookup"><span data-stu-id="3b516-127">Therefore, the file association information is preserved for the most recently installed application.</span></span>

<span data-ttu-id="3b516-128">Il peut être utile pour les applications 32 bits et 64 bits de partager des valeurs de clé de Registre spécifiques qui sont normalement écrites dans des vues de Registre distinctes.</span><span class="sxs-lookup"><span data-stu-id="3b516-128">It can be useful for 32-bit and 64-bit applications to share specific registry key values that are normally written to separate registry views.</span></span> <span data-ttu-id="3b516-129">Par exemple, un serveur OLE 32 bits qui peut traiter les demandes des clients 32 bits et 64 bits peut rendre les données de Registre 32 bits disponibles pour la vue 64 bits du Registre système.</span><span class="sxs-lookup"><span data-stu-id="3b516-129">For example, a 32-bit OLE server that can serve requests from both 32-bit and 64-bit clients could make its 32-bit registry data available to the 64-bit view of the system registry.</span></span>

<span data-ttu-id="3b516-130">Quand un composant écrit des données dans le registre système, WOW64 analyse les informations et effectue une copie des données dans l’autre vue du Registre, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="3b516-130">When a component writes data in the system registry, WOW64 analyzes the information and makes a copy of the data in the alternate view of the registry when appropriate.</span></span> <span data-ttu-id="3b516-131">En général, ce processus conserve deux copies physiques distinctes des mêmes clés de Registre dans les deux vues du Registre, et est appelée réflexion du registre ou mise en miroir du Registre.</span><span class="sxs-lookup"><span data-stu-id="3b516-131">Typically, this process keeps two separate physical copies of the same registry keys in both views in the registry, and is called registry reflection or registry mirroring.</span></span>

<span data-ttu-id="3b516-132">La plupart des clés sous la racine des classes se trouvent dans cette catégorie.</span><span class="sxs-lookup"><span data-stu-id="3b516-132">Most of the keys under the classes root are in this category.</span></span> <span data-ttu-id="3b516-133">Les mises à jour des clés sont reflétées lorsque la mise à jour est terminée et que le handle de la clé se ferme.</span><span class="sxs-lookup"><span data-stu-id="3b516-133">Updates to the keys are reflected when the update completes and the handle to the key closes.</span></span> <span data-ttu-id="3b516-134">Dans certains cas, les écritures dans une clé ne sont pas reflétées si la clé a une dépendance de nombre de bits.</span><span class="sxs-lookup"><span data-stu-id="3b516-134">In specific cases, writes to a key are not reflected if the key has some bitness dependency.</span></span> <span data-ttu-id="3b516-135">Par exemple, la clé InprocServer32 32 bits n’est pas pertinente pour les applications 64 bits, donc la clé InprocServer32 n’est pas reflétée dans la vue de Registre 64 bits.</span><span class="sxs-lookup"><span data-stu-id="3b516-135">For example, the 32-bit InprocServer32 key is not relevant for 64-bit applications, so the InprocServer32 key is not reflected to the 64-bit registry view.</span></span> <span data-ttu-id="3b516-136">Toutefois, les applications 64 bits peuvent utiliser la clé LocalServer32 de 32 bits et la clé LocalServer32 est reflétée.</span><span class="sxs-lookup"><span data-stu-id="3b516-136">However, 64-bit applications can use the 32-bit LocalServer32 key and the LocalServer32 key gets reflected.</span></span>

<span data-ttu-id="3b516-137">Pour **les \_ classes de logiciel HKEY local \_ machine \\ \\ \\ CLSID** et **HKEY \_ Current \_ User \\ Software \\ classes \\ CLSID**, seuls les CLSID qui ne spécifient pas InprocServer32 ou InprocHandler32 sont reflétés.</span><span class="sxs-lookup"><span data-stu-id="3b516-137">For **HKEY\_LOCAL\_MACHINE\\Software\\Classes\\CLSID** and **HKEY\_CURRENT\_USER\\Software\\Classes\\CLSID**, only CLSIDs that do not specify InprocServer32 or InprocHandler32 are reflected.</span></span> <span data-ttu-id="3b516-138">Seuls les CLSID LocalServer32 sont reflétés, car ils s’exécutent hors processus et peuvent être activés par des applications 32 ou 64 bits.</span><span class="sxs-lookup"><span data-stu-id="3b516-138">Only LocalServer32 CLSIDs are reflected because they run out-of-process and can be activated by either 32- or 64-bit applications.</span></span> <span data-ttu-id="3b516-139">Les CLSID InProcServer32 ne sont pas reflétés, car il n’est pas possible de charger une DLL 32 bits pour l’exécution dans un processus 64 bits, ou une DLL 64 bits pour l’exécution dans un processus de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="3b516-139">InProcServer32 CLSIDs are not reflected because it is not possible to load a 32-bit DLL for execution in a 64-bit process, or a 64-bit DLL for execution in a 32-bit process.</span></span>

<span data-ttu-id="3b516-140">Pour les classes de logiciels de la classe HKEY de l' **\_ \_ ordinateur local \\ \\ \\ AppID** et **HKEY \_ Current \_ User \\ Software \\ classes \\ AppID**, les valeurs de Registre [DllSurrogate](../com/dllsurrogate.md) et [DllSurrogateExecutable]( ../com/dllsurrogateexecutable.md) ne sont pas reflétées si leur valeur est une chaîne vide.</span><span class="sxs-lookup"><span data-stu-id="3b516-140">For **HKEY\_LOCAL\_MACHINE\\Software\\Classes\\Appid** and **HKEY\_CURRENT\_USER\\Software\\Classes\\Appid**, the [DllSurrogate](../com/dllsurrogate.md) and [DllSurrogateExecutable]( ../com/dllsurrogateexecutable.md) registry values are not reflected if their value is an empty string.</span></span>

<span data-ttu-id="3b516-141">Pour désactiver et activer la réflexion du Registre pour une clé réfléchie particulière, utilisez les fonctions [**RegDisableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regdisablereflectionkey) et [**RegEnableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regenablereflectionkey) .</span><span class="sxs-lookup"><span data-stu-id="3b516-141">To disable and enable registry reflection for a particular reflected key, use the [**RegDisableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regdisablereflectionkey) and [**RegEnableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regenablereflectionkey) functions.</span></span> <span data-ttu-id="3b516-142">Ces fonctions n’affectent pas les clés qui ne figurent pas dans la liste des clés réfléchies, plus haut dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="3b516-142">These functions do not affect keys that are not on the list of reflected keys earlier in this topic.</span></span> <span data-ttu-id="3b516-143">Les applications doivent désactiver la réflexion uniquement pour les clés de registre qu’elles créent et ne pas tenter de désactiver la réflexion pour les clés prédéfinies, telles que **HKEY \_ local \_ machine** ou **HKEY \_ Current \_ User**.</span><span class="sxs-lookup"><span data-stu-id="3b516-143">Applications should disable reflection only for the registry keys that they create and not attempt to disable reflection for the predefined keys such as **HKEY\_LOCAL\_MACHINE** or **HKEY\_CURRENT\_USER**.</span></span> <span data-ttu-id="3b516-144">Pour déterminer si les clés de la liste de réflexion ont été désactivées, utilisez la fonction [**RegQueryReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regqueryreflectionkey) .</span><span class="sxs-lookup"><span data-stu-id="3b516-144">To determine whether the keys on the reflection list have been disabled, use the [**RegQueryReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regqueryreflectionkey) function.</span></span>

<span data-ttu-id="3b516-145">Les clés réfléchies ne doivent pas être utilisées dans les opérations de Registre traitées.</span><span class="sxs-lookup"><span data-stu-id="3b516-145">Reflected keys should not be used in transacted registry operations.</span></span> <span data-ttu-id="3b516-146">L’écriture de clés reflétées pendant une transaction peut provoquer l’échec de la transaction.</span><span class="sxs-lookup"><span data-stu-id="3b516-146">Writing to reflected keys during a transaction can cause the transaction to fail.</span></span> <span data-ttu-id="3b516-147">Pour plus d’informations sur les transactions, consultez [Gestionnaire de transactions du noyau](/windows/desktop/Ktm/kernel-transaction-manager-portal).</span><span class="sxs-lookup"><span data-stu-id="3b516-147">For more information about transactions, see [Kernel Transaction Manager](/windows/desktop/Ktm/kernel-transaction-manager-portal).</span></span>

## <a name="related-topics"></a><span data-ttu-id="3b516-148">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="3b516-148">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3b516-149">Redirecteur du Registre</span><span class="sxs-lookup"><span data-stu-id="3b516-149">Registry Redirector</span></span>](registry-redirector.md)
</dt> <dt>

[<span data-ttu-id="3b516-150">Réflexion du Registre dans Windows</span><span class="sxs-lookup"><span data-stu-id="3b516-150">Registry Reflection in Windows</span></span>](/windows-hardware/drivers/display/microsoft-windows-vista-display-driver-64-bit-issues)
</dt> <dt>

[<span data-ttu-id="3b516-151">Clés de Registre affectées par WOW64</span><span class="sxs-lookup"><span data-stu-id="3b516-151">Registry Keys Affected by WOW64</span></span>](shared-registry-keys.md)
</dt> </dl>

 

 