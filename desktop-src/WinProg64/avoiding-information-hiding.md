---
title: Éviter le masquage des informations
description: Parfois, les programmes masquent les informations délibérément ou par inadvertance à partir du moteur de marshaling RPC.
ms.assetid: 016b9221-092d-4c25-a396-4f41dcdfb3cf
keywords:
- compatibilité descendante avec la programmation Windows 64 bits
- problèmes de compatibilité 64-programmation Windows bits
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2f4b9e4ba7ed5165378beb93005243af03f9e469
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104382218"
---
# <a name="avoiding-information-hiding"></a><span data-ttu-id="db599-105">Éviter le masquage des informations</span><span class="sxs-lookup"><span data-stu-id="db599-105">Avoiding Information Hiding</span></span>

<span data-ttu-id="db599-106">Parfois, les programmes masquent les informations délibérément ou par inadvertance à partir du moteur de marshaling RPC.</span><span class="sxs-lookup"><span data-stu-id="db599-106">Occasionally, programs deliberately or inadvertently hide information from the RPC marshaling engine.</span></span> <span data-ttu-id="db599-107">Voici quelques exemples :</span><span class="sxs-lookup"><span data-stu-id="db599-107">Some examples are as follows:</span></span>

-   <span data-ttu-id="db599-108">Envoi d’une structure de données sous la forme d’un bloc d’octets non différencié</span><span class="sxs-lookup"><span data-stu-id="db599-108">Sending a data structure as an undifferentiated block of bytes</span></span>
-   <span data-ttu-id="db599-109">Tirer parti des performances à l’aide d’un effet secondaire d’une méthode pour canaliser des données supplémentaires sur le réseau</span><span class="sxs-lookup"><span data-stu-id="db599-109">Leveraging performance by using a side effect from a method to channel additional data across the wire</span></span>
-   <span data-ttu-id="db599-110">Tentative de déguisement d’un handle en le transmettant en tant que **DWORD** ou **ULong**</span><span class="sxs-lookup"><span data-stu-id="db599-110">Attempting to disguise a handle by passing it as a **DWORD** or a **ULONG**</span></span>

<span data-ttu-id="db599-111">Il est presque garanti que ces techniques introduisent des problèmes de compatibilité avant de porter votre application sur Windows 64 bits.</span><span class="sxs-lookup"><span data-stu-id="db599-111">These techniques are almost guaranteed to introduce compatibility problems even before you port your application to 64-bit Windows.</span></span>

<span data-ttu-id="db599-112">Au lieu d’envoyer un contexte de serveur en tant que **valeur DWORD** dans un appel de procédure distante standard, utilisez un handle de contexte pour fournir un handle opaque à un contexte de serveur détenu pour le compte d’un client.</span><span class="sxs-lookup"><span data-stu-id="db599-112">Instead of sending a server context as a **DWORD** in a standard remote procedure call, use a context handle to provide an opaque handle to a server context that is held on behalf of a client.</span></span> <span data-ttu-id="db599-113">Les contextes sont identifiés par des GUID définis par le runtime d’exécution RPC lorsqu’un serveur crée un handle de contexte pour un client.</span><span class="sxs-lookup"><span data-stu-id="db599-113">Contexts are identified by GUIDs defined by the RPC run time when a server creates a context handle for a client.</span></span> <span data-ttu-id="db599-114">Aucun pointeur n’est utilisé sur le câble et l’opération est complètement transparente sur les limites de 32 ou 64 bits.</span><span class="sxs-lookup"><span data-stu-id="db599-114">No pointer is used over the wire and the operation is completely transparent across 32- or 64-bit boundaries.</span></span> <span data-ttu-id="db599-115">Pour plus d’informations sur l’utilisation des handles de contexte, consultez [Handles de contexte](/windows/desktop/Rpc/context-handles).</span><span class="sxs-lookup"><span data-stu-id="db599-115">For more information on using context handles, see [Context Handles](/windows/desktop/Rpc/context-handles).</span></span>

<span data-ttu-id="db599-116">Les interfaces DCOM ne peuvent pas utiliser de handles de contexte, car COM fournit sa propre gestion de contexte.</span><span class="sxs-lookup"><span data-stu-id="db599-116">DCOM interfaces cannot use context handles because COM provides its own context management.</span></span> <span data-ttu-id="db599-117">Au lieu de créer un handle de contexte, vous pouvez passer un pointeur d’interface à l’objet COM.</span><span class="sxs-lookup"><span data-stu-id="db599-117">Instead of creating a context handle, you can pass an interface pointer to the COM object.</span></span> <span data-ttu-id="db599-118">Vous pouvez ensuite appeler les méthodes directement par le biais du pointeur d’interface ou placer le pointeur à l’intérieur d’autres appels.</span><span class="sxs-lookup"><span data-stu-id="db599-118">Then you can call the methods directly through the interface pointer or place the pointer inside other calls.</span></span> <span data-ttu-id="db599-119">Pour libérer l’objet serveur, le client appelle la méthode **Release** de l’interface par le biais du pointeur d’interface.</span><span class="sxs-lookup"><span data-stu-id="db599-119">To release the server object, the client calls the interface's **Release** method through the interface pointer.</span></span>

<span data-ttu-id="db599-120">Là encore, il peut arriver que vous ne pouvez pas modifier la conception originale du code que vous portez.</span><span class="sxs-lookup"><span data-stu-id="db599-120">Again, there may be times when you cannot change the original design of the code that you are porting.</span></span> <span data-ttu-id="db599-121">S’il n’existe aucun moyen d’éviter d’envoyer un pointeur sur le câble en tant que **valeur DWORD**, vous devez implémenter une forme de mappage côté serveur entre les valeurs **DWORD** et les pointeurs.</span><span class="sxs-lookup"><span data-stu-id="db599-121">If there is no way to avoid sending a pointer across the wire as a **DWORD**, you will have to implement some form of server-side mapping between **DWORD** values and pointers.</span></span> <span data-ttu-id="db599-122">Pour ce faire, vous pouvez modifier les pointeurs de l’application côté client en types de pointeurs de précision, tels que **ULong \_ ptr** ou **DWORD \_ ptr**.</span><span class="sxs-lookup"><span data-stu-id="db599-122">One way to do this is to change the pointers in the client side application to pointer-precision types, such as **ULONG\_PTR** or **DWORD\_PTR**.</span></span> <span data-ttu-id="db599-123">Utilisez ensuite l' \[ [**appel MIDL \_ en tant qu'**](/windows/desktop/Midl/call-as) \] attribut pour placer les pointeurs sur le câble en tant que valeurs **DWORD** .</span><span class="sxs-lookup"><span data-stu-id="db599-123">Then use the MIDL \[[**call\_as**](/windows/desktop/Midl/call-as)\] attribute to put the pointers on the wire as **DWORD** values.</span></span> <span data-ttu-id="db599-124">Le wrapper côté client ne doit passer les arguments qu’en même temps.</span><span class="sxs-lookup"><span data-stu-id="db599-124">The client-side wrapper need only pass the arguments along.</span></span> <span data-ttu-id="db599-125">Le wrapper côté serveur gère le mappage entre les deux types.</span><span class="sxs-lookup"><span data-stu-id="db599-125">The server-side wrapper handles the mapping between both types.</span></span> <span data-ttu-id="db599-126">De la même façon, vous pouvez utiliser l’attribut \[ [**transmettre \_ en tant que**](/windows/desktop/Midl/transmit-as) \] ou l' \[ attribut [**représenter \_ en tant que**](/windows/desktop/Midl/represent-as) \] pour convertir vos données dans un format à compatibilité descendante pour la représentation filaire.</span><span class="sxs-lookup"><span data-stu-id="db599-126">In a similar way, you can use either the \[[**transmit\_as**](/windows/desktop/Midl/transmit-as)\] attribute or the \[[**represent\_as**](/windows/desktop/Midl/represent-as)\] attribute to convert your data to a backward-compatible format for wire representation.</span></span>

<span data-ttu-id="db599-127">Si la compatibilité de la transmission descendante n’est pas un problème ou si le handle n’est pas utilisé pour les appels distants et si vous êtes sûr que les appels distants entre les processus 32 et 64 bits ne se produiront jamais, vous pouvez redéfinir un argument en tant que **ULONG64**.</span><span class="sxs-lookup"><span data-stu-id="db599-127">If backward-wire compatibility is not an issue or if the handle is not used for remote calls and you are sure that remote calls between 32- and 64-bit processes will never happen, you can redefine an argument as a **ULONG64**.</span></span> <span data-ttu-id="db599-128">Si nécessaire, vous pouvez modifier l’application 32 bits pour transmettre un **DWORD** à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="db599-128">If necessary, you can modify the 32-bit application to pass a **DWORD** to the user.</span></span> <span data-ttu-id="db599-129">Vous pouvez également créer des stubs distincts à partir de fichiers IDL distincts pour chaque plateforme à l’aide d’un **DWORD** sur Windows 32 bits et un **ULONG64** sur Windows 64 bits.</span><span class="sxs-lookup"><span data-stu-id="db599-129">Alternatively, you can build separate stubs from separate IDL files for each platform using a **DWORD** on 32-bit Windows and a **ULONG64** on 64-bit Windows.</span></span>

 

 