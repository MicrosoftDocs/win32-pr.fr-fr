---
title: Modification d’une interface existante
description: Dans la mesure du possible, implémentez une nouvelle interface pour votre application, au lieu d’apporter des modifications à une interface existante.
ms.assetid: 29845cf5-445c-403d-b298-d4e07c3536b7
keywords:
- modification des interfaces existantes programmation Windows 64 bits
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 51a656ee768dcc2e88725d2cff0ddc5604fd771f
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104508002"
---
# <a name="changing-an-existing-interface"></a><span data-ttu-id="0f794-104">Modification d’une interface existante</span><span class="sxs-lookup"><span data-stu-id="0f794-104">Changing an Existing Interface</span></span>

<span data-ttu-id="0f794-105">Dans la mesure du possible, implémentez une nouvelle interface pour votre application, au lieu d’apporter des modifications à une interface existante.</span><span class="sxs-lookup"><span data-stu-id="0f794-105">Whenever possible, implement a new interface for your application, rather than making changes to an existing one.</span></span> <span data-ttu-id="0f794-106">Si vous ne pouvez pas éviter de modifier une interface existante, utilisez de nouveaux types de données uniquement dans les nouvelles méthodes.</span><span class="sxs-lookup"><span data-stu-id="0f794-106">If you cannot avoid changing an existing interface, use new data types in new methods only.</span></span> <span data-ttu-id="0f794-107">L’introduction d’un nouveau type de données ou la modification d’un type existant est la source la plus courante de problèmes d’incompatibilité.</span><span class="sxs-lookup"><span data-stu-id="0f794-107">Introducing a new data type or modifying an existing type is the most common source of incompatibility problems.</span></span> <span data-ttu-id="0f794-108">Le modèle d’exécution RPC suppose que l’application réceptrice connaît les types de données qu’elle reçoit, de sorte que les données sont placées sur le réseau sans une description de données générique.</span><span class="sxs-lookup"><span data-stu-id="0f794-108">The RPC run-time model assumes that the receiving application knows about the types of data that it receives, so data is put onto the wire without a generic data description.</span></span> <span data-ttu-id="0f794-109">Lorsque le destinataire attend un type de données différent de celui que l’expéditeur a placé sur le câble, le stub lève une exception (ou la transmission échoue de manière moins appropriée).</span><span class="sxs-lookup"><span data-stu-id="0f794-109">When the recipient expects a different data type than what the sender has put on the wire, the stub raises an exception (or transmission fails in some other less graceful manner).</span></span>

<span data-ttu-id="0f794-110">Une interface RPC est définie par son UUID et ses numéros de version majeure et mineure.</span><span class="sxs-lookup"><span data-stu-id="0f794-110">An RPC interface is defined by its UUID and its major and minor version numbers.</span></span> <span data-ttu-id="0f794-111">Lorsque vous modifiez une interface existante, vous devez ajouter les nouvelles méthodes à la fin de l’interface et modifier le numéro de version mineure.</span><span class="sxs-lookup"><span data-stu-id="0f794-111">When you change an existing interface, you should add the new methods at the end of the interface and change the minor version number.</span></span> <span data-ttu-id="0f794-112">Si vous ajoutez des méthodes ailleurs ou apportez d’autres modifications à l’interface, vous devez également modifier le numéro de version principale.</span><span class="sxs-lookup"><span data-stu-id="0f794-112">If you add methods anywhere else or make any other changes to the interface, you will also need to change the major version number.</span></span>

<span data-ttu-id="0f794-113">En réalité, il existe des cas où vous ne pouvez pas modifier même le numéro de version mineure, car un nouveau client ne pourra pas communiquer avec un ancien serveur et vous ne pourrez pas mettre à jour le serveur.</span><span class="sxs-lookup"><span data-stu-id="0f794-113">Realistically, there are times when you cannot change even the minor version number, because a new client will not be able to communicate with an old server and you cannot update the server.</span></span> <span data-ttu-id="0f794-114">Le temps d’exécution RPC lève une exception, \_ RPC \_ S \_ PROCNUM \_ hors \_ limites, lorsqu’un client appelle une méthode au-delà de celles spécifiées pour son interface avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="0f794-114">The RPC run time raises an exception, RPC\_S\_PROCNUM\_OUT\_OF\_RANGE, when a client calls a method beyond the ones specified for its interface with the server.</span></span> <span data-ttu-id="0f794-115">La solution de contournement consiste à ne pas modifier les numéros de version et à écrire votre code client pour gérer cette exception de manière appropriée, par le client dégrader ses performances, par exemple, ou par n’importe quel moyen adapté à votre application.</span><span class="sxs-lookup"><span data-stu-id="0f794-115">The workaround is to leave the version numbers unchanged and write your client code to handle this exception gracefully—by the client degrading its performance, for example, or by whatever means are appropriate for your application.</span></span>

<span data-ttu-id="0f794-116">Il existe une solution de contournement similaire pour un cas particulier de modification d’un type de données dans une méthode existante.</span><span class="sxs-lookup"><span data-stu-id="0f794-116">There is a similar workaround for one special case of changing a data type in an existing method.</span></span> <span data-ttu-id="0f794-117">Si vous avez une [**Union**](/windows/desktop/Midl/union) dont les branches sont des pointeurs et que n’a pas de branche par défaut pour les types non reconnus, vous pouvez ajouter une nouvelle branche qui utilise le nouveau type de données.</span><span class="sxs-lookup"><span data-stu-id="0f794-117">If you have a [**union**](/windows/desktop/Midl/union) whose branches are pointers and that does not have a default branch for unrecognized types, you can add a new branch that uses the new data type.</span></span> <span data-ttu-id="0f794-118">Cela ne modifie pas la taille de la structure de données.</span><span class="sxs-lookup"><span data-stu-id="0f794-118">This will not change the size of the data structure.</span></span> <span data-ttu-id="0f794-119">Lorsque votre client parle à un nouveau serveur, il peut utiliser le nouveau type de données.</span><span class="sxs-lookup"><span data-stu-id="0f794-119">When your client talks to a new server, it can use the new data type.</span></span> <span data-ttu-id="0f794-120">Toutefois, lorsque votre client parle à un ancien serveur, le temps d’exécution génère la balise d’exception RPC \_ \_ non valide \_ .</span><span class="sxs-lookup"><span data-stu-id="0f794-120">However, when your client talks to an old server, the run time will raise the exception RPC\_S\_INVALID\_TAG.</span></span> <span data-ttu-id="0f794-121">Là encore, vous devrez écrire votre code client pour gérer cette exception de manière appropriée.</span><span class="sxs-lookup"><span data-stu-id="0f794-121">Again, you will need to write your client code to handle this exception appropriately.</span></span>

<span data-ttu-id="0f794-122">Une interface DCOM est identifiée par son GUID.</span><span class="sxs-lookup"><span data-stu-id="0f794-122">A DCOM interface is identified by its GUID.</span></span> <span data-ttu-id="0f794-123">Dans DCOM, les interfaces sont considérées comme immuables et vous pouvez apporter des modifications uniquement en créant une nouvelle interface qui hérite de l’ancienne.</span><span class="sxs-lookup"><span data-stu-id="0f794-123">In DCOM, interfaces are considered immutable and you can make changes only by creating a new interface that inherits from the old one.</span></span> <span data-ttu-id="0f794-124">Ces règles garantissent que les clients et les serveurs restent compatibles.</span><span class="sxs-lookup"><span data-stu-id="0f794-124">These rules ensure that clients and servers remain compatible.</span></span>

 

 