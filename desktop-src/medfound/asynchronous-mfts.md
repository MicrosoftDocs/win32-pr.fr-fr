---
description: Cette rubrique décrit le traitement asynchrone des données pour les transformations de Media Foundation (MFTs).
ms.assetid: d438ffae-fc50-454f-8ce4-2d6676500fff
title: MFTs asynchrone
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4a16950cf431eff16f2befb382a77910c49ccb2e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106541181"
---
# <a name="asynchronous-mfts"></a><span data-ttu-id="a8ca3-103">MFTs asynchrone</span><span class="sxs-lookup"><span data-stu-id="a8ca3-103">Asynchronous MFTs</span></span>

<span data-ttu-id="a8ca3-104">Cette rubrique décrit le traitement asynchrone des données pour les transformations de Media Foundation (MFTs).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-104">This topic describes asynchronous data processing for Media Foundation transforms (MFTs).</span></span>

> [!Note]  
> <span data-ttu-id="a8ca3-105">Cette rubrique s’applique à Windows 7 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-105">This topic applies to Windows 7 or later.</span></span>

 

-   [<span data-ttu-id="a8ca3-106">À propos des MFTs asynchrones</span><span class="sxs-lookup"><span data-stu-id="a8ca3-106">About Asynchronous MFTs</span></span>](#about-asynchronous-mfts)
-   [<span data-ttu-id="a8ca3-107">Exigences générales</span><span class="sxs-lookup"><span data-stu-id="a8ca3-107">General Requirements</span></span>](#general-requirements)
-   [<span data-ttu-id="a8ca3-108">Événements</span><span class="sxs-lookup"><span data-stu-id="a8ca3-108">Events</span></span>](#events)
-   [<span data-ttu-id="a8ca3-109">ProcessInput</span><span class="sxs-lookup"><span data-stu-id="a8ca3-109">ProcessInput</span></span>](#processinput)
-   [<span data-ttu-id="a8ca3-110">ProcessOutput</span><span class="sxs-lookup"><span data-stu-id="a8ca3-110">ProcessOutput</span></span>](#processoutput)
-   [<span data-ttu-id="a8ca3-111">Drainage</span><span class="sxs-lookup"><span data-stu-id="a8ca3-111">Draining</span></span>](#draining)
-   [<span data-ttu-id="a8ca3-112">Vidage</span><span class="sxs-lookup"><span data-stu-id="a8ca3-112">Flushing</span></span>](#flushing)
-   [<span data-ttu-id="a8ca3-113">Marqueurs</span><span class="sxs-lookup"><span data-stu-id="a8ca3-113">Markers</span></span>](#markers)
-   [<span data-ttu-id="a8ca3-114">Modifications de format</span><span class="sxs-lookup"><span data-stu-id="a8ca3-114">Format Changes</span></span>](#format-changes)
-   [<span data-ttu-id="a8ca3-115">Attributs</span><span class="sxs-lookup"><span data-stu-id="a8ca3-115">Attributes</span></span>](#attributes)
-   [<span data-ttu-id="a8ca3-116">Déverrouillage des MFTs asynchrones</span><span class="sxs-lookup"><span data-stu-id="a8ca3-116">Unlocking Asynchronous MFTs</span></span>](#unlocking-asynchronous-mfts)
-   [<span data-ttu-id="a8ca3-117">Arrêt de la MFT</span><span class="sxs-lookup"><span data-stu-id="a8ca3-117">Shutting Down the MFT</span></span>](#shutting-down-the-mft)
-   [<span data-ttu-id="a8ca3-118">Inscription et énumération</span><span class="sxs-lookup"><span data-stu-id="a8ca3-118">Registration and Enumeration</span></span>](#registration-and-enumeration)
-   [<span data-ttu-id="a8ca3-119">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="a8ca3-119">Related topics</span></span>](#related-topics)

## <a name="about-asynchronous-mfts"></a><span data-ttu-id="a8ca3-120">À propos des MFTs asynchrones</span><span class="sxs-lookup"><span data-stu-id="a8ca3-120">About Asynchronous MFTs</span></span>

<span data-ttu-id="a8ca3-121">Lorsque MFTs a été introduit dans Windows Vista, l’API a été conçue pour le traitement *synchrone* des données.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-121">When MFTs were introduced in Windows Vista, the API was designed for *synchronous* data processing.</span></span> <span data-ttu-id="a8ca3-122">Dans ce modèle, la MFT est toujours en attente d’obtenir une entrée ou en attente de production.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-122">In that model, the MFT is always either waiting to get input, or waiting to produce output.</span></span>

<span data-ttu-id="a8ca3-123">Prenons l’exemple d’un décodeur vidéo classique.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-123">Consider a typical video decoder.</span></span> <span data-ttu-id="a8ca3-124">Pour obtenir un frame décodé, le client appelle [**IMFTransform ::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-124">To get a decoded frame, the client calls [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="a8ca3-125">Si le décodeur a suffisamment de données pour décoder un frame, **ProcessOutput** se bloque pendant que la MFT décode le frame.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-125">If the decoder has enough data to decode a frame, **ProcessOutput** blocks while the MFT decodes the frame.</span></span> <span data-ttu-id="a8ca3-126">Sinon, **ProcessOutput** retourne **MF_E_TRANSFORM_NEED_MORE_INPUT**, indiquant que le client doit appeler [**IMFTransform ::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-126">Otherwise, **ProcessOutput** returns **MF_E_TRANSFORM_NEED_MORE_INPUT**, indicating that the client should call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>

<span data-ttu-id="a8ca3-127">Ce modèle fonctionne bien si le décodeur effectue toutes les opérations de décodage sur un thread.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-127">This model works well if the decoder performs all of its decoding operations on one thread.</span></span> <span data-ttu-id="a8ca3-128">Mais supposons que le décodeur utilise plusieurs threads pour décoder des frames en parallèle.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-128">But suppose the decoder uses several threads to decode frames in parallel.</span></span> <span data-ttu-id="a8ca3-129">Pour des performances optimales, le décodeur doit recevoir une nouvelle entrée chaque fois qu’un thread de décodage devient inactif.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-129">For the best performance, the decoder should receive new input whenever a decoding thread becomes idle.</span></span> <span data-ttu-id="a8ca3-130">Mais la vitesse à laquelle les threads achèvent les opérations de décodage ne s’aligne pas exactement avec les appels du client à [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) et [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput), ce qui entraîne l’attente du travail par les threads.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-130">But the rate at which threads complete decoding operations will not align exactly with the client's calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput), resulting in threads waiting for work.</span></span>

<span data-ttu-id="a8ca3-131">Windows 7 introduit le traitement *asynchrone* piloté par les événements pour MFTS.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-131">Windows 7 introduces event-driven, *asynchronous* processing for MFTs.</span></span> <span data-ttu-id="a8ca3-132">Dans ce modèle, chaque fois que la MFT a besoin d’une entrée ou d’une sortie, elle envoie un événement au client.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-132">In this model, whenever the MFT needs input or has output, it sends an event to the client.</span></span>

## <a name="general-requirements"></a><span data-ttu-id="a8ca3-133">Conditions générales requises</span><span class="sxs-lookup"><span data-stu-id="a8ca3-133">General Requirements</span></span>

<span data-ttu-id="a8ca3-134">Cette rubrique décrit la façon dont les MFTs asynchrones diffèrent de la MFT synchrone.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-134">This topic describes how asynchronous MFTs differ from synchronous MFT.</span></span> <span data-ttu-id="a8ca3-135">Sauf indication contraire dans cette rubrique, les deux modèles de traitement sont les mêmes.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-135">Except where noted in this topic, the two processing models are the same.</span></span> <span data-ttu-id="a8ca3-136">(En particulier, la négociation de format est la même.)</span><span class="sxs-lookup"><span data-stu-id="a8ca3-136">(In particular, format negotiation is the same.)</span></span>

<span data-ttu-id="a8ca3-137">Une table MFT asynchrone doit implémenter les interfaces suivantes :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-137">An asynchronous MFT must implement the following interfaces:</span></span>

-   [<span data-ttu-id="a8ca3-138">**IMFTransform**</span><span class="sxs-lookup"><span data-stu-id="a8ca3-138">**IMFTransform**</span></span>](/windows/desktop/api/mftransform/nn-mftransform-imftransform)
-   [<span data-ttu-id="a8ca3-139">**IMFMediaEventGenerator**</span><span class="sxs-lookup"><span data-stu-id="a8ca3-139">**IMFMediaEventGenerator**</span></span>](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator)
-   [<span data-ttu-id="a8ca3-140">**IMFShutdown**</span><span class="sxs-lookup"><span data-stu-id="a8ca3-140">**IMFShutdown**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown)

## <a name="events"></a><span data-ttu-id="a8ca3-141">Événements</span><span class="sxs-lookup"><span data-stu-id="a8ca3-141">Events</span></span>

<span data-ttu-id="a8ca3-142">Une table MFT asynchrone utilise les événements suivants pour signaler son état de traitement de données :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-142">An asynchronous MFT uses the following events to signal its data-processing status:</span></span>



| <span data-ttu-id="a8ca3-143">Événement</span><span class="sxs-lookup"><span data-stu-id="a8ca3-143">Event</span></span>                                                    | <span data-ttu-id="a8ca3-144">Description</span><span class="sxs-lookup"><span data-stu-id="a8ca3-144">Description</span></span>                                                       |
|----------------------------------------------------------|-------------------------------------------------------------------|
| [<span data-ttu-id="a8ca3-145">METransformNeedInput</span><span class="sxs-lookup"><span data-stu-id="a8ca3-145">METransformNeedInput</span></span>](metransformneedinput.md)         | <span data-ttu-id="a8ca3-146">Envoyé lorsque la MFT peut accepter davantage d’entrées.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-146">Sent when the MFT can accept more input.</span></span>                          |
| [<span data-ttu-id="a8ca3-147">METransformHaveOutput</span><span class="sxs-lookup"><span data-stu-id="a8ca3-147">METransformHaveOutput</span></span>](metransformhaveoutput.md)       | <span data-ttu-id="a8ca3-148">Envoyé lorsque la table MFT a une sortie.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-148">Sent when the MFT has output.</span></span>                                     |
| [<span data-ttu-id="a8ca3-149">METransformDrainComplete</span><span class="sxs-lookup"><span data-stu-id="a8ca3-149">METransformDrainComplete</span></span>](metransformdraincomplete.md) | <span data-ttu-id="a8ca3-150">Envoyé lorsqu’une opération de drainage est terminée.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-150">Sent when a drain operation completes.</span></span> <span data-ttu-id="a8ca3-151">Consultez [drainage](#draining).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-151">See [Draining](#draining).</span></span> |
| [<span data-ttu-id="a8ca3-152">METransformMarker</span><span class="sxs-lookup"><span data-stu-id="a8ca3-152">METransformMarker</span></span>](metransformmarker.md)               | <span data-ttu-id="a8ca3-153">Envoyé lorsqu’un marqueur est un processus.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-153">Sent when a marker is process.</span></span> <span data-ttu-id="a8ca3-154">Consultez [marqueurs](#markers).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-154">See [Markers](#markers).</span></span>           |



 

<span data-ttu-id="a8ca3-155">Ces événements sont envoyés hors bande.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-155">These events are sent out-of-band.</span></span> <span data-ttu-id="a8ca3-156">Il est important de comprendre la différence entre les événements intrabande et hors bande dans le contexte d’une table MFT.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-156">It is important to understand the difference between in-band and out-of-band events in the context of an MFT.</span></span>

<span data-ttu-id="a8ca3-157">La conception MFT d’origine prend en charge les événements *intrabande* .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-157">The original MFT design supports *in-band* events.</span></span> <span data-ttu-id="a8ca3-158">Un événement intrabande contient des informations sur le flux de données, telles que des informations sur une modification de format.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-158">An in-band event contains information about the data stream, such as information about a format change.</span></span> <span data-ttu-id="a8ca3-159">Le client envoie des événements intrabande à la MFT en appelant [**IMFTransform ::P rocessevent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-159">The client sends in-band events to the MFT by calling [**IMFTransform::ProcessEvent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span></span> <span data-ttu-id="a8ca3-160">La table MFT peut renvoyer des événements intrabande au client dans la méthode [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-160">The MFT can send in-band events back to the client in the [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="a8ca3-161">(En particulier, les événements sont transmis dans le membre **pEvents** de la structure [**MFT_OUTPUT_DATA_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) .)</span><span class="sxs-lookup"><span data-stu-id="a8ca3-161">(Specifically, events are conveyed in the **pEvents** member of the [**MFT_OUTPUT_DATA_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) structure.)</span></span>

<span data-ttu-id="a8ca3-162">Une table MFT envoie des événements hors bande par le biais de l’interface [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) , comme suit :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-162">An MFT sends out-of-band events through the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface as follows:</span></span>

1.  <span data-ttu-id="a8ca3-163">La table MFT implémente l’interface [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) , comme décrit dans [Générateur d’événements multimédias](media-event-generators.md).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-163">The MFT implements the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface, as described in [Media Event Generators](media-event-generators.md).</span></span>
2.  <span data-ttu-id="a8ca3-164">Le client appelle **IUnknown :: QueryInterface** sur la MFT pour l’interface [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-164">The client calls **IUnknown::QueryInterface** on the MFT for the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface.</span></span> <span data-ttu-id="a8ca3-165">Une table MFT asynchrone doit exposer cette interface.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-165">An asynchronous MFT must expose this interface.</span></span> <span data-ttu-id="a8ca3-166">Le MFTs synchrone ne doit pas exposer cette interface.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-166">Synchronous MFTs should not expose this interface.</span></span>
3.  <span data-ttu-id="a8ca3-167">Le client appelle [**IMFMediaEventGenerator :: BeginGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-begingetevent) et [**IMFMediaEventGenerator :: EndGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-endgetevent) pour recevoir les événements hors bande de la MFT.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-167">The client calls [**IMFMediaEventGenerator::BeginGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-begingetevent) and [**IMFMediaEventGenerator::EndGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-endgetevent) to receive out-of-band events from the MFT.</span></span>

## <a name="processinput"></a><span data-ttu-id="a8ca3-168">ProcessInput</span><span class="sxs-lookup"><span data-stu-id="a8ca3-168">ProcessInput</span></span>

<span data-ttu-id="a8ca3-169">La méthode [**IMFTransform ::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) est modifiée comme suit :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-169">The [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) method is modified as follows:</span></span>

1.  <span data-ttu-id="a8ca3-170">Lors du démarrage de la diffusion en continu, le client envoie le message [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-170">When streaming starts, the client sends the [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message.</span></span>
2.  <span data-ttu-id="a8ca3-171">Pendant la diffusion en continu, la MFT demande des données en envoyant un événement [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-171">During streaming, the MFT requests data by sending an [METransformNeedInput](metransformneedinput.md) event.</span></span> <span data-ttu-id="a8ca3-172">Les données d’événement sont l’identificateur de flux.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-172">The event data is the stream identifier.</span></span>
3.  <span data-ttu-id="a8ca3-173">Pour chaque événement [METransformNeedInput](metransformneedinput.md) , le client appelle [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) pour le flux spécifié.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-173">For each [METransformNeedInput](metransformneedinput.md) event, the client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) for the specified stream.</span></span>
4.  <span data-ttu-id="a8ca3-174">À la fin de la diffusion en continu, le client peut appeler [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) avec le message [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-174">At the end of streaming, the client may call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>

<span data-ttu-id="a8ca3-175">Remarques sur l’implémentation :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-175">Implementation notes:</span></span>

-   <span data-ttu-id="a8ca3-176">La table MFT ne doit pas envoyer d’événements [METransformNeedInput](metransformneedinput.md) tant qu’elle n’a pas reçu le message [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-176">The MFT must not send any [METransformNeedInput](metransformneedinput.md) events until it receives the [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message.</span></span>
-   <span data-ttu-id="a8ca3-177">Pendant la diffusion en continu, la table MFT peut envoyer des événements [METransformNeedInput](metransformneedinput.md) à tout moment.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-177">During streaming, the MFT may send [METransformNeedInput](metransformneedinput.md) events at any time.</span></span>
-   <span data-ttu-id="a8ca3-178">La table MFT doit tenir à jour le nombre d’événements [METransformNeedInput](metransformneedinput.md) en attente.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-178">The MFT should maintain a count of pending [METransformNeedInput](metransformneedinput.md) events.</span></span> <span data-ttu-id="a8ca3-179">Tout appel à [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) qui ne correspond pas à un événement METransformNeedInput doit retourner **MF_E_NOTACCEPTING**.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-179">Any call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) that does not correspond to an METransformNeedInput event must return **MF_E_NOTACCEPTING**.</span></span>
-   <span data-ttu-id="a8ca3-180">Lorsque la table MFT reçoit le message [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) , elle réinitialise le nombre d’événements [METransformNeedInput](metransformneedinput.md) en attente à zéro.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-180">When the MFT receives the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message, it resets the count of pending [METransformNeedInput](metransformneedinput.md) events to zero.</span></span>
-   <span data-ttu-id="a8ca3-181">La table MFT ne doit pas envoyer d’événements [METransformNeedInput](metransformneedinput.md) une fois qu’elle a reçu le message [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-181">The MFT must not send any [METransformNeedInput](metransformneedinput.md) events after it receives the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>
-   <span data-ttu-id="a8ca3-182">Si [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) est appelé avant [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) ou après [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md), la méthode doit retourner **MF_E_NOTACCEPTING**.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-182">If [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) is called before [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) or after [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md), the method must return **MF_E_NOTACCEPTING**.</span></span>

## <a name="processoutput"></a><span data-ttu-id="a8ca3-183">ProcessOutput</span><span class="sxs-lookup"><span data-stu-id="a8ca3-183">ProcessOutput</span></span>

<span data-ttu-id="a8ca3-184">La méthode [**IMFTransform ::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) est modifiée comme suit :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-184">The [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method is modified as follows:</span></span>

1.  <span data-ttu-id="a8ca3-185">Chaque fois que la table MFT a une sortie, elle envoie un événement [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-185">Whenever the MFT has output, it sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
2.  <span data-ttu-id="a8ca3-186">Pour chaque événement [METransformHaveOutput](metransformhaveoutput.md) , le client appelle [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-186">For each [METransformHaveOutput](metransformhaveoutput.md) event, the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="a8ca3-187">Remarques sur l’implémentation :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-187">Implementation notes:</span></span>

-   <span data-ttu-id="a8ca3-188">Si le client appelle [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) à un autre moment, la méthode retourne **E_UNEXPECTED**.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-188">If the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at any other time, the method returns **E_UNEXPECTED**.</span></span>
-   <span data-ttu-id="a8ca3-189">Une table MFT asynchrone ne doit jamais retourner **MF_E_TRANSFORM_NEED_MORE_INPUT** à partir de la méthode [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-189">An asynchronous MFT should never return **MF_E_TRANSFORM_NEED_MORE_INPUT** from the [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="a8ca3-190">Si la table MFT requiert davantage d’entrées, elle envoie un événement [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-190">If the MFT requires more input, it sends an [METransformNeedInput](metransformneedinput.md) event.</span></span>

## <a name="draining"></a><span data-ttu-id="a8ca3-191">Drainage</span><span class="sxs-lookup"><span data-stu-id="a8ca3-191">Draining</span></span>

<span data-ttu-id="a8ca3-192">Le vidage d’une table MFT fait que la table MFT produit autant de sortie que possible, quelles que soient les données d’entrée déjà envoyées.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-192">Draining an MFT causes the MFT to produce as much output as it can from whatever input data has already been sent.</span></span> <span data-ttu-id="a8ca3-193">Le vidage d’une table MFT asynchrone fonctionne de la façon suivante :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-193">Draining an asynchronous MFT works as follows:</span></span>

1.  <span data-ttu-id="a8ca3-194">Le client envoie le message de [**MFT_MESSAGE_COMMAND_DRAIN**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-194">The client sends the [**MFT_MESSAGE_COMMAND_DRAIN**](mft-message-command-drain.md) message.</span></span>
2.  <span data-ttu-id="a8ca3-195">La table MFT continue à envoyer des événements [METransformHaveOutput](metransformhaveoutput.md) jusqu’à ce qu’elle n’ait plus aucune donnée à traiter.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-195">The MFT continues to send [METransformHaveOutput](metransformhaveoutput.md) events until it has no more data to process.</span></span> <span data-ttu-id="a8ca3-196">Elle n’envoie pas d’événements [METransformNeedInput](metransformneedinput.md) pendant cette période.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-196">It does not send [METransformNeedInput](metransformneedinput.md) events during this time.</span></span>
3.  <span data-ttu-id="a8ca3-197">Une fois que la table MFT envoie le dernier événement [METransformHaveOutput](metransformhaveoutput.md) , elle envoie un événement [METransformDrainComplete](metransformdraincomplete.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-197">After the MFT sends the last [METransformHaveOutput](metransformhaveoutput.md) event, it sends an [METransformDrainComplete](metransformdraincomplete.md) event.</span></span>

<span data-ttu-id="a8ca3-198">Une fois la vidange terminée, la table MFT n’envoie pas d’autre événement [METransformNeedInput](metransformneedinput.md) tant qu’elle n’a pas reçu de message [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) du client.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-198">After draining is complete, the MFT does not send another [METransformNeedInput](metransformneedinput.md) event until it receives an [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message from the client.</span></span>

## <a name="flushing"></a><span data-ttu-id="a8ca3-199">Vidage</span><span class="sxs-lookup"><span data-stu-id="a8ca3-199">Flushing</span></span>

<span data-ttu-id="a8ca3-200">Le client peut vider la MFT en envoyant le message [**MFT_MESSAGE_COMMAND_FLUSH**](mft-message-command-flush.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-200">The client can flush the MFT by sending the [**MFT_MESSAGE_COMMAND_FLUSH**](mft-message-command-flush.md) message.</span></span> <span data-ttu-id="a8ca3-201">La table MFT supprime tous les échantillons d’entrée et de sortie qu’elle contient.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-201">The MFT drops all of the input and output samples it is holding.</span></span>

<span data-ttu-id="a8ca3-202">La table MFT n’envoie pas d’autre événement [METransformNeedInput](metransformneedinput.md) tant qu’elle n’a pas reçu de message [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) du client.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-202">The MFT does not send another [METransformNeedInput](metransformneedinput.md) event until it receives an [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message from the client.</span></span>

## <a name="markers"></a><span data-ttu-id="a8ca3-203">Marqueurs</span><span class="sxs-lookup"><span data-stu-id="a8ca3-203">Markers</span></span>

<span data-ttu-id="a8ca3-204">Le client peut marquer un point dans le flux en envoyant le message [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-204">The client can mark a point in the stream by sending the [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) message.</span></span> <span data-ttu-id="a8ca3-205">La table MFT répond comme suit :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-205">The MFT responds as follows:</span></span>

1.  <span data-ttu-id="a8ca3-206">La table MFT génère autant d’exemples de sortie que possible des données d’entrée existantes, en envoyant un événement [METransformHaveOutput](metransformhaveoutput.md) pour chaque exemple de sortie.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-206">The MFT generates as many output samples as it can from the existing input data, sending an [METransformHaveOutput](metransformhaveoutput.md) event for each output sample.</span></span>
2.  <span data-ttu-id="a8ca3-207">Une fois que toutes les sorties sont générées, la table MFT envoie un événement [METransformMarker](metransformmarker.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-207">After all of the output is generated, the MFT sends an [METransformMarker](metransformmarker.md) event.</span></span> <span data-ttu-id="a8ca3-208">Cet événement doit être envoyé après tous les événements [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-208">This event must be sent after all of the [METransformHaveOutput](metransformhaveoutput.md) events.</span></span>

<span data-ttu-id="a8ca3-209">Supposons, par exemple, qu’un décodeur ait suffisamment de données d’entrée pour produire quatre échantillons de sortie.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-209">For example, suppose that a decoder has enough input data to produce four output samples.</span></span> <span data-ttu-id="a8ca3-210">Si le client envoie le message [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) , la table MFT met en file d’attente quatre événements [METransformHaveOutput](metransformhaveoutput.md) (un par exemple de sortie), suivis d’un événement [METransformMarker](metransformmarker.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-210">If the client sends the [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) message, the MFT will queue four [METransformHaveOutput](metransformhaveoutput.md) events (one per output sample), followed by an [METransformMarker](metransformmarker.md) event.</span></span>

<span data-ttu-id="a8ca3-211">Le message de marqueur est similaire au message de drainage.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-211">The marker message is similar to the drain message.</span></span> <span data-ttu-id="a8ca3-212">Toutefois, un drainage est considéré comme une rupture dans le flux, contrairement à un marqueur.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-212">However, a drain is considered a break in the stream, whereas a marker is not.</span></span> <span data-ttu-id="a8ca3-213">Le drainage et les marqueurs présentent les différences suivantes.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-213">Draining and markers have the following differences.</span></span>

<span data-ttu-id="a8ca3-214">Drainage</span><span class="sxs-lookup"><span data-stu-id="a8ca3-214">Draining:</span></span>

-   <span data-ttu-id="a8ca3-215">Lors de la vidange, la MFT n’envoie pas d’événements [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-215">While draining, the MFT does not send [METransformNeedInput](metransformneedinput.md) events.</span></span>
-   <span data-ttu-id="a8ca3-216">La table MFT ignore les données d’entrée qui ne peuvent pas être utilisées pour créer un exemple de sortie.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-216">The MFT discards any input data that cannot be used to create an output sample.</span></span>
-   <span data-ttu-id="a8ca3-217">Certaines MFTs produisent une « queue » à la fin des données.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-217">Some MFTs produce a "tail" at the end of the data.</span></span> <span data-ttu-id="a8ca3-218">Par exemple, les effets audio tels que la réverbération ou l’écho produisent des données supplémentaires une fois les données d’entrée arrêtées.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-218">For example, audio effects such as reverb or echo produce extra data after the input data has stopped.</span></span> <span data-ttu-id="a8ca3-219">Une table MFT qui génère une fin doit le faire à la fin d’une opération de drainage.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-219">An MFT that generates a tail should do so at the end of a drain operation.</span></span>
-   <span data-ttu-id="a8ca3-220">Une fois l’écoulement de la MFT terminé, l’exemple de sortie suivant est marqué avec l’attribut [**MFSampleExtension_Discontinuity**](mfsampleextension-discontinuity-attribute.md) , pour indiquer une discontinuité dans le flux.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-220">After the MFT has finished draining, it marks the next output sample with the [**MFSampleExtension_Discontinuity**](mfsampleextension-discontinuity-attribute.md) attribute, to indicate a discontinuity in the stream.</span></span>

<span data-ttu-id="a8ca3-221">Repère</span><span class="sxs-lookup"><span data-stu-id="a8ca3-221">Marker:</span></span>

-   <span data-ttu-id="a8ca3-222">La table MFT continue à envoyer des événements [METransformNeedInput](metransformneedinput.md) avant l’envoi de l’événement marqueur.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-222">The MFT continues to send [METransformNeedInput](metransformneedinput.md) events before sending the marker event.</span></span>
-   <span data-ttu-id="a8ca3-223">La table MFT n’ignore aucune donnée d’entrée.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-223">The MFT does not discard any input data.</span></span> <span data-ttu-id="a8ca3-224">S’il existe des données partielles, elles doivent être traitées après le point de marqueur.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-224">If there is partial data, it should be processed after the marker point.</span></span>
-   <span data-ttu-id="a8ca3-225">La table MFT ne produit pas de fin au niveau du point de marqueur.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-225">The MFT does not produce a tail at the marker point.</span></span>
-   <span data-ttu-id="a8ca3-226">La table MFT ne définit pas l’indicateur de discontinuité après le point de marqueur.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-226">The MFT does not set the discontinuity flag after the marker point.</span></span>

## <a name="format-changes"></a><span data-ttu-id="a8ca3-227">Modifications de format</span><span class="sxs-lookup"><span data-stu-id="a8ca3-227">Format Changes</span></span>

<span data-ttu-id="a8ca3-228">Une table MFT asynchrone doit prendre en charge les modifications de format dynamiques, comme décrit dans [gestion des modifications de flux](handling-stream-changes.md).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-228">An asynchronous MFT must support dynamic format changes, as described in [Handling Stream Changes](handling-stream-changes.md).</span></span>

## <a name="attributes"></a><span data-ttu-id="a8ca3-229">Attributs</span><span class="sxs-lookup"><span data-stu-id="a8ca3-229">Attributes</span></span>

<span data-ttu-id="a8ca3-230">Une table MFT asynchrone doit implémenter la méthode [**IMFTransform :: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) pour retourner un magasin d’attributs valide.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-230">An asynchronous MFT must implement the [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) method to return a valid attribute store.</span></span> <span data-ttu-id="a8ca3-231">Les attributs suivants s’appliquent à un MFTs asynchrone :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-231">The following attributes apply to asynchronous MFTs:</span></span>



| <span data-ttu-id="a8ca3-232">Attribut</span><span class="sxs-lookup"><span data-stu-id="a8ca3-232">Attribute</span></span>                                                                                    | <span data-ttu-id="a8ca3-233">Description</span><span class="sxs-lookup"><span data-stu-id="a8ca3-233">Description</span></span>                                                                                                                       |
|----------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="a8ca3-234">MF_TRANSFORM_ASYNC</span><span class="sxs-lookup"><span data-stu-id="a8ca3-234">MF_TRANSFORM_ASYNC</span></span>](mf-transform-async.md)                                               | <span data-ttu-id="a8ca3-235">La table MFT doit affecter à cet attribut la **valeur true** (1).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-235">The MFT must set this attribute to **TRUE** (1).</span></span> <span data-ttu-id="a8ca3-236">Le client peut interroger cet attribut pour déterminer si la table MFT est asynchrone.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-236">The client can query this attribute to discover whether the MFT is asynchronous.</span></span> |
| [<span data-ttu-id="a8ca3-237">MF_TRANSFORM_ASYNC_UNLOCK</span><span class="sxs-lookup"><span data-stu-id="a8ca3-237">MF_TRANSFORM_ASYNC_UNLOCK</span></span>](mf-transform-async-unlock.md)                                |                                                                                                                                   |
| [<span data-ttu-id="a8ca3-238">**MFT_SUPPORT_DYNAMIC_FORMAT_CHANGE**</span><span class="sxs-lookup"><span data-stu-id="a8ca3-238">**MFT_SUPPORT_DYNAMIC_FORMAT_CHANGE**</span></span>](mft-support-dynamic-format-change-attribute.md) | <span data-ttu-id="a8ca3-239">La table MFT doit affecter à cet attribut la **valeur true** (1).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-239">The MFT must set this attribute to **TRUE** (1).</span></span> <span data-ttu-id="a8ca3-240">Le client peut supposer que cet attribut est défini.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-240">The client can assume that this attribute is set.</span></span>                                |



 

## <a name="unlocking-asynchronous-mfts"></a><span data-ttu-id="a8ca3-241">Déverrouillage des MFTs asynchrones</span><span class="sxs-lookup"><span data-stu-id="a8ca3-241">Unlocking Asynchronous MFTs</span></span>

<span data-ttu-id="a8ca3-242">Les MFTs asynchrones ne sont pas compatibles avec le modèle de traitement de données MFT d’origine.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-242">Asynchronous MFTs are not compatible with the original MFT data processing model.</span></span> <span data-ttu-id="a8ca3-243">Pour empêcher les MFTs asynchrones de rompre les applications existantes, le mécanisme suivant est défini :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-243">To prevent asynchronous MFTs from breaking existing applications, the following mechanism is defined:</span></span>

<dl> <span data-ttu-id="a8ca3-244">Le client appelle <a href="/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes">IMFTransform :: GetAttributes</a> sur la table MFT.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-244">The client calls <a href="/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes">IMFTransform::GetAttributes</a> on the MFT.</span></span>  
<span data-ttu-id="a8ca3-245">Le client interroge pour cet attribut <a href="mf-transform-async.md">MF_TRANSFORM_ASYNC</a> .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-245">The client queries the for this <a href="mf-transform-async.md">MF_TRANSFORM_ASYNC</a> attribute.</span></span> <span data-ttu-id="a8ca3-246">Pour une table MFT asynchrone, la valeur de cet attribut est **true**.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-246">For an asynchronous MFT, the value of this attribute is **TRUE**.</span></span>  
<span data-ttu-id="a8ca3-247">Pour déverrouiller la MFT, le client doit affecter la **valeur true** à l’attribut <a href="mf-transform-async-unlock.md">MF_TRANSFORM_ASYNC_UNLOCK</a> .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-247">To unlock the MFT, the client must sets the <a href="mf-transform-async-unlock.md">MF_TRANSFORM_ASYNC_UNLOCK</a> attribute to **TRUE**.</span></span>  
</dl>

<span data-ttu-id="a8ca3-248">Tant que le client n’a pas déverrouillé la MFT, toutes les méthodes [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) doivent retourner **MF_E_TRANSFORM_ASYNC_LOCKED**, avec les exceptions suivantes :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-248">Until the client unlocks the MFT, all [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) methods should return **MF_E_TRANSFORM_ASYNC_LOCKED**, with the following exceptions:</span></span>

-   <span data-ttu-id="a8ca3-249">[**IMFTransform :: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) (tous les MFTS asynchrones)</span><span class="sxs-lookup"><span data-stu-id="a8ca3-249">[**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="a8ca3-250">[**IMFTransform :: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) (tous les MFTS asynchrones)</span><span class="sxs-lookup"><span data-stu-id="a8ca3-250">[**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="a8ca3-251">[**IMFTransform :: GetOutputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputcurrenttype) (encodeurs uniquement)</span><span class="sxs-lookup"><span data-stu-id="a8ca3-251">[**IMFTransform::GetOutputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputcurrenttype) (encoders only)</span></span>
-   <span data-ttu-id="a8ca3-252">[**IMFTransform :: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) (encodeurs uniquement)</span><span class="sxs-lookup"><span data-stu-id="a8ca3-252">[**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) (encoders only)</span></span>
-   <span data-ttu-id="a8ca3-253">[**IMFTransform :: GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) (tous les MFTS asynchrones)</span><span class="sxs-lookup"><span data-stu-id="a8ca3-253">[**IMFTransform::GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="a8ca3-254">[**IMFTransform :: GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) (tous les MFTS asynchrones)</span><span class="sxs-lookup"><span data-stu-id="a8ca3-254">[**IMFTransform::GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) (all asynchronous MFTs)</span></span>

<span data-ttu-id="a8ca3-255">Le code suivant montre comment déverrouiller une table MFT asynchrone :</span><span class="sxs-lookup"><span data-stu-id="a8ca3-255">The following code shows how to unlock an asynchronous MFT:</span></span>


```C++
HRESULT UnlockAsyncMFT(IMFTransform *pMFT)
{
    IMFAttributes *pAttributes = NULL;

    HRESULT hr = hr = pMFT->GetAttributes(&pAttributes);

    if (SUCCEEDED(hr))
    {
        hr = pAttributes->SetUINT32(MF_TRANSFORM_ASYNC_UNLOCK, TRUE);
        pAttributes->Release();
    }
    
    return hr;
}
```



## <a name="shutting-down-the-mft"></a><span data-ttu-id="a8ca3-256">Arrêt de la MFT</span><span class="sxs-lookup"><span data-stu-id="a8ca3-256">Shutting Down the MFT</span></span>

<span data-ttu-id="a8ca3-257">Un MFTs asynchrone doit implémenter l’interface [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-257">Asynchronous MFTs must implement the [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) interface.</span></span>

-   <span data-ttu-id="a8ca3-258">[**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown): la MFT doit arrêter sa file d’attente d’événements.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-258">[**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown): The MFT must shut down its event queue.</span></span> <span data-ttu-id="a8ca3-259">Si vous utilisez la file d’attente d’événements standard, appelez [**IMFMediaEventQueue :: Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown).</span><span class="sxs-lookup"><span data-stu-id="a8ca3-259">If using the standard event queue, call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown).</span></span> <span data-ttu-id="a8ca3-260">Éventuellement, la MFT peut libérer d’autres ressources.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-260">Optionally, the MFT may release other resources.</span></span> <span data-ttu-id="a8ca3-261">Le client ne doit pas utiliser la MFT après l' **arrêt** de l’appel.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-261">The client must not use the MFT after calling **Shutdown**.</span></span>
-   <span data-ttu-id="a8ca3-262">[**GetShutdownStatus**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-getshutdownstatus): après l’appel de [**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown) , la table MFT doit retourner la valeur **MFSHUTDOWN_COMPLETED** dans le paramètre *pStatus* .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-262">[**GetShutdownStatus**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-getshutdownstatus): After [**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown) has been called, the MFT should return the value **MFSHUTDOWN_COMPLETED** in the *pStatus* parameter.</span></span> <span data-ttu-id="a8ca3-263">Elle ne doit pas retourner la valeur **MFSHUTDOWN_INITIATED**.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-263">It should not return the value **MFSHUTDOWN_INITIATED**.</span></span>

## <a name="registration-and-enumeration"></a><span data-ttu-id="a8ca3-264">Inscription et énumération</span><span class="sxs-lookup"><span data-stu-id="a8ca3-264">Registration and Enumeration</span></span>

<span data-ttu-id="a8ca3-265">Pour inscrire une table MFT asynchrone, appelez la fonction [**MFTRegister**](/windows/desktop/api/mfapi/nf-mfapi-mftregister) et définissez l’indicateur **MFT_ENUM_FLAG_ASYNCMFT** dans le paramètre *Flags* .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-265">To register an asynchronous MFT, call the [**MFTRegister**](/windows/desktop/api/mfapi/nf-mfapi-mftregister) function and set the **MFT_ENUM_FLAG_ASYNCMFT** flag in the *Flags* parameter.</span></span> <span data-ttu-id="a8ca3-266">(Précédemment, cet indicateur était réservé.)</span><span class="sxs-lookup"><span data-stu-id="a8ca3-266">(Previously this flag was reserved.)</span></span>

<span data-ttu-id="a8ca3-267">Pour énumérer les MFTs asynchrones, appelez la fonction [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) et définissez l’indicateur **MFT_ENUM_FLAG_ASYNCMFT** dans le paramètre *Flags* .</span><span class="sxs-lookup"><span data-stu-id="a8ca3-267">To enumerate asynchronous MFTs, call the [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) function and set the **MFT_ENUM_FLAG_ASYNCMFT** flag in the *Flags* parameter.</span></span> <span data-ttu-id="a8ca3-268">Pour la compatibilité descendante, la fonction [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) n’énumère pas les MFTS asynchrones.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-268">For backward compatibility, the [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) function does not enumerate asynchronous MFTs.</span></span> <span data-ttu-id="a8ca3-269">Dans le cas contraire, l’installation d’une table MFT asynchrone sur l’ordinateur de l’utilisateur risque de perturber les applications existantes.</span><span class="sxs-lookup"><span data-stu-id="a8ca3-269">Otherwise, installing an asynchronous MFT on the user's computer could break existing applications.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a8ca3-270">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="a8ca3-270">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a8ca3-271">Transformations de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="a8ca3-271">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



