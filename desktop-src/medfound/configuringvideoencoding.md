---
description: Configuration de l’encodage vidéo
ms.assetid: 917600f5-5580-4ca5-bce9-70eadec40df7
title: Configuration de l’encodage vidéo (Microsoft Media Foundation)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bd82240ea9f540f283e0fb6340c06be00336226
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104111834"
---
# <a name="configuring-video-encoding-microsoft-media-foundation"></a><span data-ttu-id="bd55b-103">Configuration de l’encodage vidéo (Microsoft Media Foundation)</span><span class="sxs-lookup"><span data-stu-id="bd55b-103">Configuring Video Encoding (Microsoft Media Foundation)</span></span>

<span data-ttu-id="bd55b-104">Pour configurer l’encodeur vidéo, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="bd55b-104">To configure the video encoder, perform the following steps:</span></span>

1.  <span data-ttu-id="bd55b-105">Définissez des propriétés sur l’encodeur DMO à l’aide de **IPropertyBag :: Write**.</span><span class="sxs-lookup"><span data-stu-id="bd55b-105">Set any properties on the encoder DMO by using **IPropertyBag::Write**.</span></span> <span data-ttu-id="bd55b-106">La liste suivante résume l’ensemble minimal des propriétés requises pour encoder un flux vidéo CBR (toutes ces valeurs ont des valeurs par défaut qui peuvent être utilisées) :</span><span class="sxs-lookup"><span data-stu-id="bd55b-106">The following list summarizes the minimum set of properties that are required to encode a CBR video stream (all of these values have defaults that can be used):</span></span>

    -   <span data-ttu-id="bd55b-107">La propriété[MFPKEY \_ VIDEOWINDOW](mfpkey-videowindowproperty.md) spécifie la fenêtre de mémoire tampon à utiliser pour le flux.</span><span class="sxs-lookup"><span data-stu-id="bd55b-107">The[MFPKEY\_VIDEOWINDOW](mfpkey-videowindowproperty.md) property specifies the buffer window to use for the stream.</span></span> <span data-ttu-id="bd55b-108">Pour plus d’informations sur le paramètre Windows de mémoire tampon et son impact sur le contenu, consultez [méthodes d’encodage](encodingmethods.md).</span><span class="sxs-lookup"><span data-stu-id="bd55b-108">For more information about the buffer windows setting and how it affects content, see [Encoding Methods](encodingmethods.md).</span></span> <span data-ttu-id="bd55b-109">La fenêtre de mémoire tampon par défaut est de trois secondes, ce qui convient à de nombreux scénarios.</span><span class="sxs-lookup"><span data-stu-id="bd55b-109">The default buffer window is three seconds, which is appropriate for many scenarios.</span></span>
    -   <span data-ttu-id="bd55b-110">La complexité vidéo est définie pour déterminer le compromis entre la qualité du contenu encodé et le temps nécessaire à l’encodage.</span><span class="sxs-lookup"><span data-stu-id="bd55b-110">Video complexity is set to determine the tradeoff between the quality of the encoded content and the time that is required to encode.</span></span> <span data-ttu-id="bd55b-111">Si vous ne définissez pas de valeur, la valeur par défaut est utilisée.</span><span class="sxs-lookup"><span data-stu-id="bd55b-111">If you do not set a value, the default value is used.</span></span> <span data-ttu-id="bd55b-112">Toutefois, vous pouvez trouver les modes recommandés pour un codec spécifique en appelant [IWMCodecProps :: GetCodecProp](/windows/desktop/api/wmcodecdsp/nf-wmcodecdsp-iwmcodecprops-getcodecprop) pour récupérer g \_ wszWMVCComplexityExLive, g \_ wszWMVCComplexityExOffline et g \_ wszWMVCComplexityExMax.</span><span class="sxs-lookup"><span data-stu-id="bd55b-112">However, you can find the recommended modes for a specific codec by calling [IWMCodecProps::GetCodecProp](/windows/desktop/api/wmcodecdsp/nf-wmcodecdsp-iwmcodecprops-getcodecprop) to retrieve g\_wszWMVCComplexityExLive, g\_wszWMVCComplexityExOffline, and g\_wszWMVCComplexityExMax.</span></span> <span data-ttu-id="bd55b-113">Vous pouvez ensuite définir [MFPKEY \_ COMPLEXITYEX](mfpkey-complexityexproperty.md) sur une valeur comprise entre 0 et la complexité maximale signalée.</span><span class="sxs-lookup"><span data-stu-id="bd55b-113">Then you can set [MFPKEY\_COMPLEXITYEX](mfpkey-complexityexproperty.md) to a value between 0 and the reported maximum complexity.</span></span>
    -   <span data-ttu-id="bd55b-114">[MFPKEY \_ CRISP](mfpkey-crispproperty.md) spécifie l’importance relative du lissage vidéo et la qualité d’image des frames encodés.</span><span class="sxs-lookup"><span data-stu-id="bd55b-114">[MFPKEY\_CRISP](mfpkey-crispproperty.md) specifies the relative importance of video smoothness and the image quality of encoded frames.</span></span> <span data-ttu-id="bd55b-115">Dans la plupart des cas, la valeur par défaut fonctionne correctement.</span><span class="sxs-lookup"><span data-stu-id="bd55b-115">In most cases, the default value works fine.</span></span>
    -   <span data-ttu-id="bd55b-116">Pour le contenu vidéo stocké dans un conteneur autre que ASF, la propriété [MFPKEY \_ ASFOVERHEADPERFRAME](mfpkey-asfoverheadperframeproperty.md) doit avoir la valeur 0.</span><span class="sxs-lookup"><span data-stu-id="bd55b-116">For video content stored in a container other than ASF, the [MFPKEY\_ASFOVERHEADPERFRAME](mfpkey-asfoverheadperframeproperty.md) property must be set to 0.</span></span> <span data-ttu-id="bd55b-117">Il ne s’agit pas de la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="bd55b-117">This is not the default value.</span></span>

    <span data-ttu-id="bd55b-118">Pour plus d’informations sur la configuration des flux VBR, consultez [utilisation de l’encodage VBR](usingvbrencoding.md).</span><span class="sxs-lookup"><span data-stu-id="bd55b-118">For information about configuring VBR streams, see [Using VBR Encoding](usingvbrencoding.md).</span></span>

2.  <span data-ttu-id="bd55b-119">Configurez la structure de [**\_ \_ type de média DMO**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) pour le type d’entrée, ou si vous utilisez le kit de développement logiciel (SDK) Media Foundation, utilisez la fonction [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) .</span><span class="sxs-lookup"><span data-stu-id="bd55b-119">Configure the [**DMO\_MEDIA\_TYPE**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) structure for the input type, or if you are using the Media Foundation SDK, use the [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) function.</span></span> <span data-ttu-id="bd55b-120">Utilisez une structure [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) décrivant le contenu d’entrée non compressé.</span><span class="sxs-lookup"><span data-stu-id="bd55b-120">Use a [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) structure describing the uncompressed input content.</span></span> <span data-ttu-id="bd55b-121">Le codec ne redimensionne pas la vidéo ou ne convertit pas l’espace colorimétrique.</span><span class="sxs-lookup"><span data-stu-id="bd55b-121">The codec does not resize video or convert the color space.</span></span>
3.  <span data-ttu-id="bd55b-122">Définissez le type d’entrée à l’aide de [**IMediaObject :: SetInputType**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-setinputtype) ou [**IMFTransform :: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).</span><span class="sxs-lookup"><span data-stu-id="bd55b-122">Set the input type using [**IMediaObject::SetInputType**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-setinputtype) or [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).</span></span>
4.  <span data-ttu-id="bd55b-123">Configurez le type de sortie pour l’encodeur.</span><span class="sxs-lookup"><span data-stu-id="bd55b-123">Configure the output type for the encoder.</span></span> <span data-ttu-id="bd55b-124">Une fois que le type d’entrée est défini, l’encodeur énumère les types de sortie qui sont complets, à l’exception du membre **dwBitrate** de la structure [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) , ou de l’attribut de [**vitesse de \_ \_ \_ transmission moyenne MF MT**](mf-mt-avg-bitrate-attribute.md) de l’interface [**IMFMediaType**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediatype) .</span><span class="sxs-lookup"><span data-stu-id="bd55b-124">After the input type is set, the encoder enumerates output types that are complete except for the **dwBitrate** member of the [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) structure, or the [**MF\_MT\_AVG\_BITRATE**](mf-mt-avg-bitrate-attribute.md) attribute of the [**IMFMediaType**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediatype) interface.</span></span> <span data-ttu-id="bd55b-125">Si vous récupérez un type de sortie avant de définir un type d’entrée, la structure de [**\_ \_ type de média DMO**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) fournie n’a pas de **VIDEOINFOHEADER** associé.</span><span class="sxs-lookup"><span data-stu-id="bd55b-125">If you retrieve an output type before setting an input type, the delivered [**DMO\_MEDIA\_TYPE**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) structure will not have an associated **VIDEOINFOHEADER**.</span></span>
5.  <span data-ttu-id="bd55b-126">Récupérez les données privées du codec et ajoutez-les à la structure [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) que vous transmettez à la structure du [](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediatype) [**\_ \_ type de média DMO**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) ou à IMFMediaType.</span><span class="sxs-lookup"><span data-stu-id="bd55b-126">Retrieve the codec private data and append it to the [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) structure that you pass to the [**DMO\_MEDIA\_TYPE**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) structure or to [**IMFMediaType**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediatype).</span></span> <span data-ttu-id="bd55b-127">Pour plus d’informations, consultez [utilisation de données privées de codec vidéo](usingvideocodecprivatedata.md).</span><span class="sxs-lookup"><span data-stu-id="bd55b-127">For more information, see [Using Video Codec Private Data](usingvideocodecprivatedata.md).</span></span>
6.  <span data-ttu-id="bd55b-128">Définissez le type de sortie en appelant la méthode [**IMediaObject :: SetOutputType**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-setoutputtype) ou [**IMFTransform :: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) .</span><span class="sxs-lookup"><span data-stu-id="bd55b-128">Set the output type by calling the [**IMediaObject::SetOutputType**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-setoutputtype) or [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) method.</span></span> <span data-ttu-id="bd55b-129">Transmettez la structure du [**\_ \_ type de média DMO**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) avec la structure [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) terminée (y compris les données privées ajoutées) référencées dans le membre **pbFormat** , ou construisez un [**IMFMediaType**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediatype) en appelant [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader).</span><span class="sxs-lookup"><span data-stu-id="bd55b-129">Either pass the [**DMO\_MEDIA\_TYPE**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) structure with the completed [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) structure (including appended private data) referenced in the **pbFormat** member, or construct an [**IMFMediaType**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediatype) by calling [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader).</span></span>

> [!Note]  
> <span data-ttu-id="bd55b-130">L’objet encodeur vidéo prend en charge deux sorties.</span><span class="sxs-lookup"><span data-stu-id="bd55b-130">The video encoder object supports two outputs.</span></span> <span data-ttu-id="bd55b-131">La deuxième sortie est pour l’encodeur « affichage de la publication ».</span><span class="sxs-lookup"><span data-stu-id="bd55b-131">The second output is for encoder "post view".</span></span> <span data-ttu-id="bd55b-132">Il fournit les exemples non compressés tels qu’ils seront fournis par le décodeur.</span><span class="sxs-lookup"><span data-stu-id="bd55b-132">It delivers the uncompressed samples as they will be delivered from the decoder.</span></span> <span data-ttu-id="bd55b-133">Cela vous permet de surveiller la qualité de l’encodage sans avoir à attendre que le flux entier soit traité.</span><span class="sxs-lookup"><span data-stu-id="bd55b-133">This enables you to monitor the quality of the encoding without having to wait until the entire stream is processed.</span></span> <span data-ttu-id="bd55b-134">Cette sortie est facultative.</span><span class="sxs-lookup"><span data-stu-id="bd55b-134">This output is optional.</span></span> <span data-ttu-id="bd55b-135">Si vous souhaitez l’utiliser, configurez son type suivant le même processus que celui utilisé pour définir le type d’entrée de l’encodeur.</span><span class="sxs-lookup"><span data-stu-id="bd55b-135">If you want to use it, configure its type following the same process used to set the encoder input type.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="bd55b-136">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="bd55b-136">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bd55b-137">Utilisation de la vidéo</span><span class="sxs-lookup"><span data-stu-id="bd55b-137">Working with Video</span></span>](workingwithvideo.md)
</dt> </dl>

 

 
