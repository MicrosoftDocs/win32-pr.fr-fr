---
description: Le récepteur de fichiers ASF est une implémentation de IMFMediaSink fournie par Media Foundation qu’une application peut utiliser pour archiver des données de média ASF dans un fichier. Pour plus d’informations sur le modèle objet des récepteurs de média ASF et l’utilisation générale, consultez récepteurs de média ASF.
ms.assetid: 991f3345-a6b4-45c2-a89d-3c13c70b6bbc
title: Création du récepteur de fichiers ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c43625bcbc581b4967d4db99cef71a0fc779f070
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104111827"
---
# <a name="creating-the-asf-file-sink"></a><span data-ttu-id="2fbe4-104">Création du récepteur de fichiers ASF</span><span class="sxs-lookup"><span data-stu-id="2fbe4-104">Creating the ASF File Sink</span></span>

<span data-ttu-id="2fbe4-105">Le récepteur de fichiers ASF est une implémentation de [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) fournie par Media Foundation qu’une application peut utiliser pour archiver des données de média ASF dans un fichier.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-105">The ASF file sink is an implementation of [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) provided by Media Foundation that an application can use to archive ASF media data to a file.</span></span> <span data-ttu-id="2fbe4-106">Pour plus d’informations sur le modèle objet et l’utilisation générale des récepteurs de média ASF, consultez [récepteurs de média ASF](asf-media-sinks.md).</span><span class="sxs-lookup"><span data-stu-id="2fbe4-106">For information about ASF Media Sinks' object model and general usage, see [ASF Media Sinks](asf-media-sinks.md).</span></span>

<span data-ttu-id="2fbe4-107">Il existe deux façons de créer une instance du récepteur de fichiers ASF.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-107">There are two ways of creating an instance of the ASF file sink.</span></span> <span data-ttu-id="2fbe4-108">Vous pouvez appeler [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) ou [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate).</span><span class="sxs-lookup"><span data-stu-id="2fbe4-108">You can call [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) or [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate).</span></span>

<span data-ttu-id="2fbe4-109">Si vous appelez [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), vous devez spécifier un flux d’octets, pour le fichier de sortie, dans lequel le récepteur écrira le contenu ASF pendant une session d’encodage.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-109">If you call [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), you must specify a byte stream, for the output file, into which the sink will write the ASF content during an encoding session.</span></span> <span data-ttu-id="2fbe4-110">Le flux d’octets spécifié doit avoir des fonctionnalités pouvant être recherchées et accessibles en écriture, sinon l’appel **MFCreateASFMediaSink** échoue avec le \_ code d’erreur E Fail.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-110">The specified byte stream must have seekable and writable capabilities otherwise the **MFCreateASFMediaSink** call fails with the E\_FAIL error code.</span></span> <span data-ttu-id="2fbe4-111">Cet appel crée un objet récepteur de fichiers in-process et retourne un pointeur vers l’interface [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) du récepteur de fichiers.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-111">This call creates an in-process file sink object and returns a pointer to the [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) interface of the file sink.</span></span>

<span data-ttu-id="2fbe4-112">Si vous appelez [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), vous devez spécifier l’URL du fichier de sortie dans lequel le récepteur de fichiers écrira les données multimédias.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-112">If you call [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), you must specify the URL of the output file into which the file sink will write media data.</span></span> <span data-ttu-id="2fbe4-113">Dans ce cas, le récepteur de fichiers crée en interne le flux d’octets.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-113">In this case, the file sink internally creates the byte stream.</span></span> <span data-ttu-id="2fbe4-114">La fonction retourne un pointeur vers l’interface [**IMFActivate**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) du récepteur de fichiers.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-114">The function returns a pointer to the [**IMFActivate**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) interface of the file sink.</span></span> <span data-ttu-id="2fbe4-115">Pour</span><span class="sxs-lookup"><span data-stu-id="2fbe4-115">To</span></span>

<span data-ttu-id="2fbe4-116">Pensez à [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate) au lieu de [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), lorsque votre topologie d’encodage est conçue comme suit :</span><span class="sxs-lookup"><span data-stu-id="2fbe4-116">Consider [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate) instead of [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), when your encoding topology is designed as follows:</span></span>

-   <span data-ttu-id="2fbe4-117">La topologie d’encodage est pour le chemin d’accès du média protégé (PMP) et le récepteur de fichiers est utilisé hors processus.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-117">The encoding topology is for the protected media path (PMP) and the file sink is used out-of-process.</span></span>
-   <span data-ttu-id="2fbe4-118">Le nœud de sortie de la topologie est créé à l’aide du pointeur retourné vers l’objet Activate du récepteur de fichiers et votre application effectue le suivi des flux dans le récepteur de fichiers par numéros de flux.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-118">The output node of the topology is created by using the returned pointer to the activate object of the file sink and your application is keeping track of the streams in the file sink by stream numbers.</span></span>
    > [!Note]  
    > <span data-ttu-id="2fbe4-119">Vous pouvez activer le récepteur de fichiers en appelant [**IMFActivate :: ActivateObject**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject).</span><span class="sxs-lookup"><span data-stu-id="2fbe4-119">You can activate the file sink by calling [**IMFActivate::ActivateObject**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject).</span></span> <span data-ttu-id="2fbe4-120">Toutefois, vous n’avez pas besoin d’activer l’objet de façon explicitement.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-120">However you do not need to activate the object explictly.</span></span> <span data-ttu-id="2fbe4-121">La session multimédia effectue le suivi de l’objet d’activation et active le récepteur de fichiers automatiquement pendant la session d’encodage.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-121">The Media Session keeps track of the activation object and activates the file sink automatically during the encoding session.</span></span>

     

-   <span data-ttu-id="2fbe4-122">Les informations de flux de données sont configurées dans l’objet ContentInfo.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-122">The stream information is configured in the ContentInfo object.</span></span> <span data-ttu-id="2fbe4-123">Disucssed dans la sous-section suivante.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-123">Disucssed in the next sub-section.</span></span>

<span data-ttu-id="2fbe4-124">Une fois le récepteur de fichiers ASF créé, il doit être configuré avant de générer la topologie.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-124">After creating the ASF file sink it must be configured before building the topology.</span></span> <span data-ttu-id="2fbe4-125">Le récepteur de fichiers doit connaître les informations suivantes afin de générer le fichier de sortie.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-125">The file sink needs to know the following information in order to generate the output file.</span></span>

-   <span data-ttu-id="2fbe4-126">Informations de base sur le flux</span><span class="sxs-lookup"><span data-stu-id="2fbe4-126">Basic stream information</span></span>
-   <span data-ttu-id="2fbe4-127">Informations sur le mode d’encodage</span><span class="sxs-lookup"><span data-stu-id="2fbe4-127">Encoding mode information</span></span>
-   <span data-ttu-id="2fbe4-128">Métadonnées</span><span class="sxs-lookup"><span data-stu-id="2fbe4-128">Metadata</span></span>

<span data-ttu-id="2fbe4-129">Le récepteur de fichiers implémente l' [objet ASF ContentInfo](asf-contentinfo-object.md) et expose l’interface [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) afin qu’une application puisse l’utiliser pour définir les informations relatives aux flux et à l’encodage.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-129">The file sink implements the [ASF ContentInfo Object](asf-contentinfo-object.md) and exposes the [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) interface so that an application can use it to set information related to the streams and encoding.</span></span> <span data-ttu-id="2fbe4-130">Selon la fonction que vous avez appelée pour créer le récepteur de fichiers, il existe deux façons d’obtenir une référence à l’interface **IMFASFContentInfo** .</span><span class="sxs-lookup"><span data-stu-id="2fbe4-130">Depending on the function you called to create the file sink, there are two ways of getting a reference to the **IMFASFContentInfo** interface.</span></span>

-   <span data-ttu-id="2fbe4-131">Si vous appelez la fonction [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) , l’application doit interroger l’interface [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) en appelant **IMFMediaSink :: QueryInterface** sur le récepteur de fichiers retourné.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-131">If you call the [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) function, the application must query for [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) interface by calling **IMFMediaSink::QueryInterface** on the returned file sink.</span></span>
-   <span data-ttu-id="2fbe4-132">Si vous choisissez d’appeler [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), cette fonction s’attend à ce que vous disposiez d’un objet ContentInfo entièrement configuré avant l’appel.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-132">If you choose to call [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), this function expects that you have a fully-configured ContentInfo object prior to the call.</span></span> <span data-ttu-id="2fbe4-133">Pour ce faire, vous devez créer un objet ContentInfo vide en appelant [**MFCreateASFContentInfo**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfcontentinfo) , puis le configurer avec toutes les informations requises.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-133">To do this, you need to create an empty ContentInfo object by calling [**MFCreateASFContentInfo**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfcontentinfo) and then configure it with all the required information.</span></span> <span data-ttu-id="2fbe4-134">Transmettez l’objet ContentInfo configuré à **MFCreateASFMediaSinkActivate** pour recevoir un pointeur vers l’objet récepteur Activate.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-134">Pass the configured ContentInfo object to the **MFCreateASFMediaSinkActivate** to receive a pointer to the sink activate object.</span></span> <span data-ttu-id="2fbe4-135">Vous ne pouvez pas activer le récepteur de fichiers en utilisant l’objet d’activation retourné, puis modifier les informations de flux ou d’encodage.</span><span class="sxs-lookup"><span data-stu-id="2fbe4-135">You cannot activate the file sink by using the returned activation object and then change any stream or encoding information.</span></span>

<span data-ttu-id="2fbe4-136">Pour plus d’informations sur la configuration des flux de récepteurs et des propriétés spécifiques, consultez les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="2fbe4-136">For information about configuring sink streams and specific properties, see the following topics:</span></span>

-   [<span data-ttu-id="2fbe4-137">Ajout d’informations de flux au récepteur de fichiers ASF</span><span class="sxs-lookup"><span data-stu-id="2fbe4-137">Adding Stream Information to the ASF File Sink</span></span>](adding-stream-information-to-the-asf-file-sink.md)
-   [<span data-ttu-id="2fbe4-138">Définition des propriétés dans le récepteur de fichiers</span><span class="sxs-lookup"><span data-stu-id="2fbe4-138">Setting Properties in the File Sink</span></span>](setting-properties-in-the-file-sink.md)
-   [<span data-ttu-id="2fbe4-139">Ajout de métadonnées au récepteur de fichiers</span><span class="sxs-lookup"><span data-stu-id="2fbe4-139">Adding Metadata to the File Sink</span></span>](adding-metadata-to-the-file-sink.md)

## <a name="related-topics"></a><span data-ttu-id="2fbe4-140">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="2fbe4-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2fbe4-141">Récepteurs de média ASF</span><span class="sxs-lookup"><span data-stu-id="2fbe4-141">ASF Media Sinks</span></span>](asf-media-sinks.md)
</dt> <dt>

[<span data-ttu-id="2fbe4-142">Composants ASF de couche de pipeline</span><span class="sxs-lookup"><span data-stu-id="2fbe4-142">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> <dt>

[<span data-ttu-id="2fbe4-143">Prise en charge ASF dans Media Foundation</span><span class="sxs-lookup"><span data-stu-id="2fbe4-143">ASF Support in Media Foundation</span></span>](asf-support-in-media-foundation.md)
</dt> </dl>

 

 



