---
description: Cette rubrique décrit comment Media Foundation transformations doit gérer les horodatages.
ms.assetid: 4ab576ce-becd-4736-921e-e463c0dff841
title: Horodatages et durées
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2323c11fa0e3ec2b2b2d5ba1cefe4f5d5fa80c5b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104114350"
---
# <a name="time-stamps-and-durations"></a><span data-ttu-id="69a29-103">Horodatages et durées</span><span class="sxs-lookup"><span data-stu-id="69a29-103">Time Stamps and Durations</span></span>

<span data-ttu-id="69a29-104">Cette rubrique décrit comment [Media Foundation transformations](media-foundation-transforms.md) doit gérer les horodatages.</span><span class="sxs-lookup"><span data-stu-id="69a29-104">This topic describes how [Media Foundation Transforms](media-foundation-transforms.md) should handle time stamps.</span></span>

<span data-ttu-id="69a29-105">Un MFT doit définir un horodatage et une durée aussi précis que possible sur tous les échantillons de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-105">An MFT must set as accurate a time stamp and duration as possible on all output samples.</span></span> <span data-ttu-id="69a29-106">Pour une table MFT simple qui prend une mémoire tampon d’entrée et la traite complètement dans une mémoire tampon de sortie, la table MFT doit simplement copier l’horodatage et la durée directement de l’exemple d’entrée vers l’exemple de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-106">For a simple MFT that takes one input buffer and completely processes it into an output buffer, the MFT should just copy the time stamp and duration directly from the input sample to the output sample.</span></span> <span data-ttu-id="69a29-107">Toutefois, de nombreuses transformations sont plus complexes que cela et peuvent nécessiter des calculs plus complexes de l’heure de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-107">However, many transforms are more complex than this and may require more complex calculations of output time.</span></span> <span data-ttu-id="69a29-108">Toutes les MFTs doivent respecter les règles de base suivantes :</span><span class="sxs-lookup"><span data-stu-id="69a29-108">All MFTs should observe the following basic rules:</span></span>

-   <span data-ttu-id="69a29-109">Une table MFT doit essayer de placer un horodatage et une durée sur tous les échantillons de sortie vidéo ou audio non compressés si un horodatage ou une durée précis est donné (e) sur les échantillons d’entrée ou peut être calculé.</span><span class="sxs-lookup"><span data-stu-id="69a29-109">An MFT should try to put a time stamp and duration on all uncompressed video or audio output samples if an accurate time stamp or duration is given on the input samples or can be calculated.</span></span> <span data-ttu-id="69a29-110">L’interpolation peut être nécessaire pour certains horodatages de sortie, en particulier pour les décodeurs.</span><span class="sxs-lookup"><span data-stu-id="69a29-110">Interpolation may be required for some output time stamps, especially for decoders.</span></span>
-   <span data-ttu-id="69a29-111">Les horodatages et les durées des échantillons d’entrée doivent être préservés autant que possible sur les échantillons de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-111">The time stamps and durations of the input samples should be preserved on the output samples as much as possible.</span></span>
-   <span data-ttu-id="69a29-112">Les horodatages de sortie ou les durées peuvent ne pas correspondre à l’entrée, car la table MFT contient des données de retour ou des données de sortie dans des parties de taille différente de celles de l’entrée.</span><span class="sxs-lookup"><span data-stu-id="69a29-112">The output time stamps or durations might not match the input because the MFT is holding back data or breaking the output into different-sized pieces than the input.</span></span> <span data-ttu-id="69a29-113">Dans ce cas, la table MFT doit calculer l’horodatage de sortie à partir de l’exemple d’entrée le plus ancien qui contient les données utilisées pour créer l’exemple de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-113">In that case, the MFT should calculate the output time stamp from the earliest input sample that contains data used to create the output sample.</span></span> <span data-ttu-id="69a29-114">Pour calculer l’horodatage de sortie, ajoutez l’horodatage d’entrée de l’exemple d’entrée approprié à la durée des données qui ont déjà été transformées à partir de cet exemple.</span><span class="sxs-lookup"><span data-stu-id="69a29-114">To calculate the output time stamp, add the input time stamp of the appropriate input sample to the duration of data that has already been transformed from that sample.</span></span> <span data-ttu-id="69a29-115">Le deuxième exemple à la fin de cette section illustre cette idée.</span><span class="sxs-lookup"><span data-stu-id="69a29-115">The second example at the end of this section illustrates this idea.</span></span>
-   <span data-ttu-id="69a29-116">Si les échantillons d’entrée ont une durée, cette durée doit être conservée.</span><span class="sxs-lookup"><span data-stu-id="69a29-116">If the input samples have duration, that duration should be preserved.</span></span> <span data-ttu-id="69a29-117">Si un exemple d’entrée n’a pas de durée, la table MFT doit calculer une durée si possible à partir de la taille de la mémoire tampon de sortie ou le débit de données donné par le type de média.</span><span class="sxs-lookup"><span data-stu-id="69a29-117">If an input sample does not have duration, the MFT should calculate a duration if possible from the size of the output buffer or the data rate given by the media type.</span></span>
-   <span data-ttu-id="69a29-118">Les durées calculées doivent être tronquées (arrondies vers le bas), pas arrondies à l’incrément le plus proche.</span><span class="sxs-lookup"><span data-stu-id="69a29-118">Calculated durations should be truncated (rounded down), not rounded to the nearest increment.</span></span> <span data-ttu-id="69a29-119">Le pipeline a suffisamment de marge pour gérer les durées légèrement inexactes, mais il est plus facile pour le pipeline de gérer une durée de 1% trop petite qu’une durée de 1% trop longue.</span><span class="sxs-lookup"><span data-stu-id="69a29-119">The pipeline has enough slack to handle durations that are slightly inaccurate, but it is easier for the pipeline to handle a duration that is 1% too short than a duration that is 1% too long.</span></span> <span data-ttu-id="69a29-120">Cela dit, il n’y a aucune raison de raccourcir délibérément les durées, à l’exception de l’arrondi.</span><span class="sxs-lookup"><span data-stu-id="69a29-120">That said, there is no reason to deliberately shorten the durations, other than by rounding.</span></span>

### <a name="decoders"></a><span data-ttu-id="69a29-121">Décodeurs</span><span class="sxs-lookup"><span data-stu-id="69a29-121">Decoders</span></span>

<span data-ttu-id="69a29-122">Un décodeur convertit les paquets compressés en données non compressées.</span><span class="sxs-lookup"><span data-stu-id="69a29-122">A decoder converts compressed packets into uncompressed data.</span></span> <span data-ttu-id="69a29-123">Étant donné que la sortie est décompressée, les décodeurs ont une obligation spéciale d’obtenir les horodatages et les durées correctes.</span><span class="sxs-lookup"><span data-stu-id="69a29-123">Because the output is uncompressed, decoders have a special obligation to get the time stamps and durations correct.</span></span> <span data-ttu-id="69a29-124">Certains formats compressés, plus particulièrement MPEG-2, n’ont pas de datage pour tous les paquets en entrée et n’ont souvent aucune durée sur aucun paquet.</span><span class="sxs-lookup"><span data-stu-id="69a29-124">Some compressed formats, most notably MPEG-2, do not have time stamps on all input packets and often have no duration on any packet.</span></span> <span data-ttu-id="69a29-125">Pour ces formats, le décodeur est chargé de placer un horodatage et une durée valides pour chaque échantillon de sortie, en additionnant les durées implicites de l’ensemble de la sortie depuis le dernier exemple d’entrée horodaté.</span><span class="sxs-lookup"><span data-stu-id="69a29-125">For these formats, the decoder is responsible for putting a valid time stamp and duration on every output sample, by summing the implied durations of all the output since the last time-stamped input sample.</span></span>

<span data-ttu-id="69a29-126">Pour la vidéo, si la durée n’est pas disponible dans le format compressé, le décodeur doit calculer la durée comme l’inverse de la fréquence d’images, converti en unités de nanosecondes 100 et arrondi à la valeur inférieure.</span><span class="sxs-lookup"><span data-stu-id="69a29-126">For video, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the frame rate, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="69a29-127">Pour l’audio, si la durée n’est pas disponible dans le format compressé, le décodeur doit calculer la durée comme l’inverse du taux d’échantillonnage audio multiplié par le nombre d’échantillons dans la mémoire tampon de sortie, convertis en unités de 100 nanosecondes et arrondis à la baisse.</span><span class="sxs-lookup"><span data-stu-id="69a29-127">For audio, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the audio sample rate multiplied by the number of samples in the output buffer, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="69a29-128">La seule fois où une transformation doit générer un exemple sans horodatage est si la table MFT n’a jamais reçu d’horodatage sur un échantillon d’entrée, ou s’il n’existe aucun moyen de calculer un horodatage de sortie précis à partir de l’horodatage d’entrée précédent.</span><span class="sxs-lookup"><span data-stu-id="69a29-128">The only time a transform should output a sample without a time stamp is if the MFT has never received a time stamp on an input sample, or if there is no way to calculate an accurate output time stamp from the previous input time stamp.</span></span>

### <a name="audio-decoders"></a><span data-ttu-id="69a29-129">Décodeurs audio</span><span class="sxs-lookup"><span data-stu-id="69a29-129">Audio Decoders</span></span>

<span data-ttu-id="69a29-130">Pour les décodeurs audio, la durée de chaque échantillon de sortie est calculée à partir de la fréquence d’échantillonnage audio et du nombre d’échantillons PCM par canal dans la mémoire tampon de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-130">For audio decoders, the duration of each output sample is calculated from the audio sampling rate and the number of PCM samples per channel in the output buffer.</span></span>

<span data-ttu-id="69a29-131">La méthode correcte pour calculer les horodatages de sortie varie selon que les exemples d’entrée contiennent des horodatages.</span><span class="sxs-lookup"><span data-stu-id="69a29-131">The correct way to calculate output time stamps depends on whether the input samples contain time stamps.</span></span>

<span data-ttu-id="69a29-132">Si les exemples d’entrée contiennent des horodatages, le décodeur calcule les horodatages de sortie à partir des horodatages d’entrée, comme suit :</span><span class="sxs-lookup"><span data-stu-id="69a29-132">If the input samples contain time stamps, the decoder calculates the output time stamps from the input time stamps, as follows:</span></span>

-   <span data-ttu-id="69a29-133">Si chaque mémoire tampon d’entrée contient un ou plusieurs frames compressés complets, sans frames partiels, l’horodatage de sortie est égal à l’horodatage d’entrée, moins la latence connue du décodeur.</span><span class="sxs-lookup"><span data-stu-id="69a29-133">If each input buffer contains a one or more complete compressed frames, with no partial frames, the output time stamp equals the input time stamp, minus the known latency of the decoder.</span></span> <span data-ttu-id="69a29-134">Par exemple, un décodeur Dolby Digital (AC-3) a une latence de 256 PCM.</span><span class="sxs-lookup"><span data-stu-id="69a29-134">For example, a Dolby Digital (AC-3) decoder has a latency of 256 PCM samples.</span></span> <span data-ttu-id="69a29-135">Par exemple, au taux d’échantillonnage de 48 kHz, la latence est de 5,33 millisecondes (MS).</span><span class="sxs-lookup"><span data-stu-id="69a29-135">For example, at 48-kHz sampling rate, the latency is 5.33 milliseconds (msec).</span></span> <span data-ttu-id="69a29-136">Par conséquent, si l’horodatage d’entrée est 1000 ms, l’horodatage de sortie est 1000-5,33 = 994,66 ms.</span><span class="sxs-lookup"><span data-stu-id="69a29-136">Therefore, if the input time stamp is 1000 msec, the output time stamp is 1000 – 5.33 = 994.66 msec.</span></span> <span data-ttu-id="69a29-137">Si la mémoire tampon d’entrée contient plusieurs frames compressés entiers, le décodeur produira un échantillon de sortie pour chaque frame de l’exemple d’entrée.</span><span class="sxs-lookup"><span data-stu-id="69a29-137">If the input buffer includes more than one whole compressed frame, the decoder will produce one output sample for every frame in the input sample.</span></span> <span data-ttu-id="69a29-138">Tous les échantillons de sortie seront horodatés correctement, de sorte qu’il n’y a pas d’écarts.</span><span class="sxs-lookup"><span data-stu-id="69a29-138">All output samples will be time stamped correctly such that there are no gaps.</span></span>
-   <span data-ttu-id="69a29-139">Selon le format de transport, une mémoire tampon d’entrée peut contenir des frames partiels.</span><span class="sxs-lookup"><span data-stu-id="69a29-139">Depending on the transport format, an input buffer might contain partial frames.</span></span> <span data-ttu-id="69a29-140">Par exemple, une mémoire tampon peut contenir une partie d’un frame à partir de la mémoire tampon d’entrée précédente, suivie d’un ou de plusieurs frames complets, suivi du début du frame suivant.</span><span class="sxs-lookup"><span data-stu-id="69a29-140">For example, a buffer might contain part of a frame from the previous input buffer, followed by one or more complete frames, followed by the start of the next frame.</span></span> <span data-ttu-id="69a29-141">Dans ce cas, il est généralement correct de supposer que l’horodatage d’entrée correspond au premier frame qui démarre dans la mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="69a29-141">In this case, it is generally correct to assume that the input time stamp corresponds to the first frame that starts within the buffer.</span></span> <span data-ttu-id="69a29-142">(Autrement dit, un frame partiel qui a démarré dans la mémoire tampon précédente n’est pas inclus dans l’horodatage de la mémoire tampon actuelle.) Calculez l’horodatage de sortie en conséquence.</span><span class="sxs-lookup"><span data-stu-id="69a29-142">(That is, a partial frame that started in the previous buffer is not included in the time stamp for the current buffer.) Calculate the output time stamp accordingly.</span></span>

<span data-ttu-id="69a29-143">Si les exemples d’entrée ne contiennent pas d’horodatage :</span><span class="sxs-lookup"><span data-stu-id="69a29-143">If the input samples do not contain any time stamps:</span></span>

-   <span data-ttu-id="69a29-144">Le décodeur doit générer ses propres horodatages, en définissant le premier horodatage de sortie sur zéro.</span><span class="sxs-lookup"><span data-stu-id="69a29-144">The decoder should generate its own time stamps, setting the first output time stamp to zero.</span></span>
-   <span data-ttu-id="69a29-145">La durée de l’échantillon est calculée à partir du nombre d’échantillons de sortie dans la mémoire tampon et du taux d’échantillonnage.</span><span class="sxs-lookup"><span data-stu-id="69a29-145">The sample duration is calculated from the number of output samples in the buffer and the sample rate.</span></span>
-   <span data-ttu-id="69a29-146">Les horodatages suivants sont calculés à partir de l’horodatage précédent et de la durée : horodatage actuel + durée actuelle = horodatage suivant.</span><span class="sxs-lookup"><span data-stu-id="69a29-146">Subsequent time stamps are calculated from the previous time stamp and duration: Current time stamp + current duration = next time stamp.</span></span> <span data-ttu-id="69a29-147">Il ne doit y avoir aucun écart dans les horodatages de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-147">There should be no gaps in the output time stamps.</span></span>

<span data-ttu-id="69a29-148">Si le flux d’entrée contient initialement des horodatages, mais pour une raison quelconque, pour une raison quelconque, le décodeur doit continuer à générer ses propres horodatages de sortie, de sorte qu’ils soient continus et qu’il n’y ait aucun intervalle.</span><span class="sxs-lookup"><span data-stu-id="69a29-148">If the input stream initially contains time stamps, but for some reason switches to no time stamps, the decoder should continue to generate its own output time stamps, such that they are continuous and there is no gap.</span></span>

<span data-ttu-id="69a29-149">Si le flux d’entrée contient des horodatages, mais qu’il y a des écarts dans les temps, le décodeur propage simplement ces lacunes.</span><span class="sxs-lookup"><span data-stu-id="69a29-149">If the input stream contains time stamps, but there are gaps in the times, the decoder will simply propagate these gaps.</span></span> <span data-ttu-id="69a29-150">En d’autres termes, le décodeur ne doit pas tenter de corriger les horodatages incohérents dans le flux d’entrée.</span><span class="sxs-lookup"><span data-stu-id="69a29-150">In other words, the decoder should not attempt to fix inconsistent time stamps in the input stream.</span></span>

### <a name="mixers"></a><span data-ttu-id="69a29-151">Mélangeurs</span><span class="sxs-lookup"><span data-stu-id="69a29-151">Mixers</span></span>

> [!Note]  
> <span data-ttu-id="69a29-152">Dans Windows Vista, le pipeline Media Foundation ne prend pas en charge MFTs avec plus d’une entrée.</span><span class="sxs-lookup"><span data-stu-id="69a29-152">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="69a29-153">Les MFTs à entrées multiples sont pris en charge dans Windows 7.</span><span class="sxs-lookup"><span data-stu-id="69a29-153">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="69a29-154">Un mélangeur prend plusieurs entrées et les mélange en une seule sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-154">A mixer takes multiple inputs and mixes them into one output.</span></span> <span data-ttu-id="69a29-155">Si les flux d’entrée ne sont pas complètement verrouillés, ou sont légèrement décalés les uns des autres, il peut y avoir une ambiguïté sur le temps à définir sur la sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-155">If the input streams are not completely rate-locked, or are slightly offset in time from each other, there can be ambiguity about which time to set on the output.</span></span> <span data-ttu-id="69a29-156">Voici quelques instructions, selon le type de média :</span><span class="sxs-lookup"><span data-stu-id="69a29-156">Here are some guidelines, depending on the media type:</span></span>

-   <span data-ttu-id="69a29-157">HD.</span><span class="sxs-lookup"><span data-stu-id="69a29-157">Audio.</span></span> <span data-ttu-id="69a29-158">Au démarrage ou immédiatement après un drainage ou un vidage, un mélangeur audio doit attendre pour produire des échantillons de sortie jusqu’à ce qu’il ait reçu un échantillon d’entrée sur tous les flux d’entrée requis.</span><span class="sxs-lookup"><span data-stu-id="69a29-158">At startup or immediately after a drain or flush, an audio mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="69a29-159">À ce stade, il doit choisir l’horodatage le plus ancien des échantillons initiaux à utiliser comme référence pour les horodatages de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-159">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="69a29-160">Les autres flux doivent être remplis avec un silence pour commettre les différences de temps.</span><span class="sxs-lookup"><span data-stu-id="69a29-160">The other streams should be padded with silence to make up any time discrepancy.</span></span> <span data-ttu-id="69a29-161">Si un exemple est reçu sur un flux d’entrée facultatif, il doit également être pris en compte dans le calcul.</span><span class="sxs-lookup"><span data-stu-id="69a29-161">If a sample is received on an optional input stream, it should also be factored into the calculation.</span></span> <span data-ttu-id="69a29-162">À partir de ce point, la MFT doit s’efforcer de produire une chaîne continue et ininterrompue d’horodatages de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-162">From that point on, the MFT should strive to produce a continuous and unbroken chain of output time stamps.</span></span> <span data-ttu-id="69a29-163">En général, la table MFT ne doit pas essayer de tenir compte d’une dérive de flux par rapport à une autre.</span><span class="sxs-lookup"><span data-stu-id="69a29-163">In general, the MFT should not try to account for one stream drifting relative to another.</span></span> <span data-ttu-id="69a29-164">Au lieu de cela, il doit calculer les horodatages de sortie à partir de l’horodatage de la ligne de base, le taux de sortie et les tailles de mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="69a29-164">Instead, it should calculate the output time stamps from the baseline time stamp, the output rate, and the buffer sizes.</span></span> <span data-ttu-id="69a29-165">Lorsqu’un autre drainage ou vidage se produit, la table MFT doit réinitialiser ses horodatages de référence.</span><span class="sxs-lookup"><span data-stu-id="69a29-165">When another drain or flush occurs, the MFT should reset its baseline time stamps.</span></span>

-   <span data-ttu-id="69a29-166">Vidéo.</span><span class="sxs-lookup"><span data-stu-id="69a29-166">Video.</span></span> <span data-ttu-id="69a29-167">Au démarrage ou immédiatement après un drainage ou un vidage, un mélangeur vidéo doit attendre de produire des échantillons de sortie jusqu’à ce qu’il ait reçu un échantillon d’entrée sur tous les flux d’entrée requis.</span><span class="sxs-lookup"><span data-stu-id="69a29-167">At startup or immediately after a drain or flush, a video mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="69a29-168">À ce stade, il doit choisir l’horodatage le plus ancien des échantillons initiaux à utiliser comme référence pour les horodatages de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-168">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="69a29-169">En général, elle doit s’efforcer de conserver les horodatages de sortie continus et réguliers et les durées fixes, même si l’entrée n’est pas aussi régulière, si nécessaire, en répétant les trames d’entrée.</span><span class="sxs-lookup"><span data-stu-id="69a29-169">In general, it should strive to keep continuous and regular output time stamps and fixed durations, even if the input is not as regular, if necessary by repeating input frames.</span></span>

### <a name="encoders"></a><span data-ttu-id="69a29-170">Encodeurs</span><span class="sxs-lookup"><span data-stu-id="69a29-170">Encoders</span></span>

<span data-ttu-id="69a29-171">Un encodeur convertit le contenu audio ou vidéo non compressé en paquets compressés.</span><span class="sxs-lookup"><span data-stu-id="69a29-171">An encoder converts uncompressed audio or video into compressed packets.</span></span> <span data-ttu-id="69a29-172">Un encodeur doit suivre les instructions suivantes :</span><span class="sxs-lookup"><span data-stu-id="69a29-172">An encoder should follow these guidelines:</span></span>

-   <span data-ttu-id="69a29-173">L’encodeur doit respecter les conventions du format de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-173">The encoder should follow the conventions of the output format.</span></span> <span data-ttu-id="69a29-174">Si le format n’a pas d’horodatage pour chaque échantillon, comme dans MPEG-2, tous les échantillons de sortie n’ont pas besoin d’un horodatage et d’une durée.</span><span class="sxs-lookup"><span data-stu-id="69a29-174">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="69a29-175">Les horodatages d’entrée doivent être conservés dans le format de sortie, si le format contient des champs pour les horodatages, à moins que des informations de temps plus performantes soient disponibles à partir d’une autre source, telle que l’application elle-même.</span><span class="sxs-lookup"><span data-stu-id="69a29-175">The input time stamps should be preserved in the output format, if the format has fields for time stamps, unless better time information is a available from another source, such as the application itself.</span></span>

### <a name="multiplexers"></a><span data-ttu-id="69a29-176">Multiplexeurs</span><span class="sxs-lookup"><span data-stu-id="69a29-176">Multiplexers</span></span>

> [!Note]  
> <span data-ttu-id="69a29-177">Dans Windows Vista, le pipeline Media Foundation ne prend pas en charge MFTs avec plus d’une entrée.</span><span class="sxs-lookup"><span data-stu-id="69a29-177">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="69a29-178">Les MFTs à entrées multiples sont pris en charge dans Windows 7.</span><span class="sxs-lookup"><span data-stu-id="69a29-178">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="69a29-179">Un multiplexeur combine deux flux audio ou vidéo différents en un seul format entrelacé, tel que le flux de transport AVI ou MPEG-2.</span><span class="sxs-lookup"><span data-stu-id="69a29-179">A multiplexer combines two different audio or video streams into one interleaved format, such as AVI or MPEG-2 Transport Stream.</span></span> <span data-ttu-id="69a29-180">Un multiplexeur doit suivre les instructions suivantes :</span><span class="sxs-lookup"><span data-stu-id="69a29-180">A multiplexer should follow these guidelines:</span></span>

-   <span data-ttu-id="69a29-181">Le multiplexeur doit respecter les conventions du format de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-181">The multiplexer should follow the conventions of the output format.</span></span> <span data-ttu-id="69a29-182">Si le format n’a pas d’horodatage pour chaque échantillon, comme dans MPEG-2, tous les échantillons de sortie n’ont pas besoin d’un horodatage et d’une durée.</span><span class="sxs-lookup"><span data-stu-id="69a29-182">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="69a29-183">L’horodatage doit refléter l’heure la plus ancienne qui serait placée sur toute image qui commence dans ce paquet, ou l’heure du premier échantillon audio qui serait décodé à partir de ce paquet.</span><span class="sxs-lookup"><span data-stu-id="69a29-183">The time stamp should reflect the earliest time that would be placed on any frame that begins in that packet, or the time of the first audio sample that would be decoded from that packet.</span></span> <span data-ttu-id="69a29-184">Ignorez cette règle si elle est en conflit avec les conventions du format de sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-184">Ignore this guideline if it conflicts with the conventions of the output format.</span></span>

### <a name="demultiplexers"></a><span data-ttu-id="69a29-185">Démultiplexeurs</span><span class="sxs-lookup"><span data-stu-id="69a29-185">Demultiplexers</span></span>

<span data-ttu-id="69a29-186">Un démultiplexeur fractionne un format entrelacé, tel qu’un flux de transport AVI ou MPEG-2, dans les flux audio et vidéo sous-jacents.</span><span class="sxs-lookup"><span data-stu-id="69a29-186">A demultiplexer splits an interleaved format, such as AVI or MPEG-2 Transport Stream, into the underlying audio and video streams.</span></span>

<span data-ttu-id="69a29-187">Si le format contient des informations d’horodatage spécifiques qui peuvent être utilisées pour calculer des horodatages de sortie précis en fonction des horodatages d’entrée, ces informations doivent être utilisées.</span><span class="sxs-lookup"><span data-stu-id="69a29-187">If the format contains specific time stamp information that can be used to calculate accurate output time stamps based on the input time stamps, that information should be used.</span></span> <span data-ttu-id="69a29-188">Toutefois, si le format contient des heures dans une base complètement différente qui ne porte aucune relation avec les horodatages d’entrée, et qu’un décalage précis de l’horodatage d’entrée ne peut pas être calculé, les heures propres au format doivent être ignorées.</span><span class="sxs-lookup"><span data-stu-id="69a29-188">However, if the format contains times in a completely different base that bear no relation to the input time stamps, and an accurate offset to the input time stamp cannot be calculated, the format's own times should be ignored.</span></span>

<span data-ttu-id="69a29-189">Si le format n’a pas d’informations d’horodatage utilisables, le démultiplexeur doit suivre les règles suivantes :</span><span class="sxs-lookup"><span data-stu-id="69a29-189">If the format does not have usable time stamp information, the demultiplexer should follow these rules:</span></span>

-   <span data-ttu-id="69a29-190">Si possible, les flux de sortie non compressés doivent avoir des horodatages et des durées valides, calculés à partir de l’horodatage d’entrée précédent le plus proche.</span><span class="sxs-lookup"><span data-stu-id="69a29-190">Uncompressed output streams should have valid time stamps and durations if possible, calculated from the closest previous input time stamp.</span></span>

-   <span data-ttu-id="69a29-191">Les flux de sortie compressés doivent avoir des horodatages uniquement pour le premier échantillon de sortie dérivé d’un exemple d’entrée avec un horodatage.</span><span class="sxs-lookup"><span data-stu-id="69a29-191">Compressed output streams should have time stamps on only the first output sample derived from an input sample with a time stamp.</span></span> <span data-ttu-id="69a29-192">Si l’exemple d’entrée n’a pas d’horodatage, aucun échantillon de sortie dérivé de cet exemple d’entrée ne doit avoir un horodatage.</span><span class="sxs-lookup"><span data-stu-id="69a29-192">If the input sample does not have a time stamp, no output samples derived from that input sample should have a time stamp.</span></span> <span data-ttu-id="69a29-193">Si l’exemple d’entrée est divisé en plusieurs exemples de sortie, seul le premier exemple de sortie doit avoir un horodatage, et le reste ne doit pas avoir de datage.</span><span class="sxs-lookup"><span data-stu-id="69a29-193">If the input sample is broken into multiple output samples, only the first output sample should have a time stamp, and the rest should have no time stamps.</span></span>

### <a name="examples"></a><span data-ttu-id="69a29-194">Exemples</span><span class="sxs-lookup"><span data-stu-id="69a29-194">Examples</span></span>

<span data-ttu-id="69a29-195">Exemple 1.</span><span class="sxs-lookup"><span data-stu-id="69a29-195">Example 1.</span></span> <span data-ttu-id="69a29-196">Supposons qu’un effet vidéo prend toujours une trame d’entrée non compressée, applique l’effet et le copie dans la sortie.</span><span class="sxs-lookup"><span data-stu-id="69a29-196">Suppose that a video effect always takes an uncompressed input frame, applies the effect, and copies it to the output.</span></span> <span data-ttu-id="69a29-197">Elle ne conserve jamais de frame ou de tampons d’entrée.</span><span class="sxs-lookup"><span data-stu-id="69a29-197">It never holds back any frames or buffers any input.</span></span> <span data-ttu-id="69a29-198">Cette table MFT copie simplement l’horodatage et la durée de l’exemple d’entrée vers l’exemple de sortie, s’ils sont disponibles, et n’effectue aucun calcul de temps.</span><span class="sxs-lookup"><span data-stu-id="69a29-198">This MFT simply copies the time stamp and duration from the input sample to the output sample, if they are available, and does no time calculations at all.</span></span>

<span data-ttu-id="69a29-199">Exemple 2.</span><span class="sxs-lookup"><span data-stu-id="69a29-199">Example 2.</span></span> <span data-ttu-id="69a29-200">Supposons qu’un effet audio transforme tout sauf 10 millisecondes (MS) de chaque mémoire tampon d’entrée, ce qui permet d’économiser 10 ms supplémentaires pour combiner avec la mémoire tampon suivante.</span><span class="sxs-lookup"><span data-stu-id="69a29-200">Suppose that an audio effect transforms all but 10 milliseconds (ms) of each input buffer, saving the extra 10 ms to combine with the next buffer.</span></span> <span data-ttu-id="69a29-201">Elle obtient un flux d’exemples qui ont tous une durée de 50 ms.</span><span class="sxs-lookup"><span data-stu-id="69a29-201">It gets a stream of samples that all have a duration of 50 ms.</span></span> <span data-ttu-id="69a29-202">Les heures d’entrée sont indiquées dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="69a29-202">The input times are shown in the following table.</span></span>



| <span data-ttu-id="69a29-203">Exemple</span><span class="sxs-lookup"><span data-stu-id="69a29-203">Sample</span></span> | <span data-ttu-id="69a29-204">Heure d’entrée</span><span class="sxs-lookup"><span data-stu-id="69a29-204">Input time</span></span> | <span data-ttu-id="69a29-205">Durée d’entrée</span><span class="sxs-lookup"><span data-stu-id="69a29-205">Input duration</span></span> | <span data-ttu-id="69a29-206">Heure de sortie</span><span class="sxs-lookup"><span data-stu-id="69a29-206">Output time</span></span> | <span data-ttu-id="69a29-207">Durée de sortie</span><span class="sxs-lookup"><span data-stu-id="69a29-207">Output duration</span></span> |
|--------|------------|----------------|-------------|-----------------|
| <span data-ttu-id="69a29-208">1</span><span class="sxs-lookup"><span data-stu-id="69a29-208">1</span></span>      | <span data-ttu-id="69a29-209">20</span><span class="sxs-lookup"><span data-stu-id="69a29-209">20</span></span>         | <span data-ttu-id="69a29-210">50</span><span class="sxs-lookup"><span data-stu-id="69a29-210">50</span></span>             | <span data-ttu-id="69a29-211">20</span><span class="sxs-lookup"><span data-stu-id="69a29-211">20</span></span>          | <span data-ttu-id="69a29-212">40</span><span class="sxs-lookup"><span data-stu-id="69a29-212">40</span></span>              |
| <span data-ttu-id="69a29-213">2</span><span class="sxs-lookup"><span data-stu-id="69a29-213">2</span></span>      | <span data-ttu-id="69a29-214">70</span><span class="sxs-lookup"><span data-stu-id="69a29-214">70</span></span>         | <span data-ttu-id="69a29-215">50</span><span class="sxs-lookup"><span data-stu-id="69a29-215">50</span></span>             | <span data-ttu-id="69a29-216">60</span><span class="sxs-lookup"><span data-stu-id="69a29-216">60</span></span>          | <span data-ttu-id="69a29-217">50</span><span class="sxs-lookup"><span data-stu-id="69a29-217">50</span></span>              |
| <span data-ttu-id="69a29-218">3</span><span class="sxs-lookup"><span data-stu-id="69a29-218">3</span></span>      | <span data-ttu-id="69a29-219">121</span><span class="sxs-lookup"><span data-stu-id="69a29-219">121</span></span>        | <span data-ttu-id="69a29-220">50</span><span class="sxs-lookup"><span data-stu-id="69a29-220">50</span></span>             | <span data-ttu-id="69a29-221">110</span><span class="sxs-lookup"><span data-stu-id="69a29-221">110</span></span>         | <span data-ttu-id="69a29-222">50</span><span class="sxs-lookup"><span data-stu-id="69a29-222">50</span></span>              |
| <span data-ttu-id="69a29-223">4</span><span class="sxs-lookup"><span data-stu-id="69a29-223">4</span></span>      | <span data-ttu-id="69a29-224">171</span><span class="sxs-lookup"><span data-stu-id="69a29-224">171</span></span>        | <span data-ttu-id="69a29-225">50</span><span class="sxs-lookup"><span data-stu-id="69a29-225">50</span></span>             | <span data-ttu-id="69a29-226">161</span><span class="sxs-lookup"><span data-stu-id="69a29-226">161</span></span>         | <span data-ttu-id="69a29-227">50</span><span class="sxs-lookup"><span data-stu-id="69a29-227">50</span></span>              |



 

<span data-ttu-id="69a29-228">Notez la différence de 1-ms entre la durée réelle de l’échantillon 2 et la durée implicite basée sur l’horodatage suivant (121 ?</span><span class="sxs-lookup"><span data-stu-id="69a29-228">Note the 1-ms discrepancy between the actual duration of sample 2 and the implied duration based on the next time stamp (121 ?</span></span> <span data-ttu-id="69a29-229">70 = 51).</span><span class="sxs-lookup"><span data-stu-id="69a29-229">70 = 51).</span></span>

<span data-ttu-id="69a29-230">Étant donné que la MFT conserve 10 ms, il génère le premier 40 ms de l’échantillon d’entrée 1 comme exemple de sortie 1, avec un horodatage de 20 ms et une durée de 40 ms.</span><span class="sxs-lookup"><span data-stu-id="69a29-230">Because the MFT holds back 10 ms, it outputs the first 40 ms of input sample 1 as output sample 1, with a time stamp of 20 ms and a duration of 40 ms.</span></span>

<span data-ttu-id="69a29-231">L’exemple de sortie 2 combine le 10 ms précédemment retenu avec 40 ms de l’exemple d’entrée 2.</span><span class="sxs-lookup"><span data-stu-id="69a29-231">Output sample 2 combines the 10 ms previously held back with 40 ms of input sample 2.</span></span> <span data-ttu-id="69a29-232">Cet exemple reçoit un horodatage de 60 ms (horodatage de l’exemple d’entrée précédent, 20 ms, plus la durée des données déjà traitées à partir de cet exemple, 40ms).</span><span class="sxs-lookup"><span data-stu-id="69a29-232">This sample is given a time stamp of 60 ms (the time stamp of the previous input sample, 20ms, plus the duration of the data already processed from that sample, 40ms).</span></span> <span data-ttu-id="69a29-233">Elle reçoit une durée de 50 ms.</span><span class="sxs-lookup"><span data-stu-id="69a29-233">It is given a duration of 50ms.</span></span>

<span data-ttu-id="69a29-234">De même, l’exemple suivant a un horodatage de 110ms (70ms + 40ms) avec une durée de 50 ms.</span><span class="sxs-lookup"><span data-stu-id="69a29-234">Similarly, the next sample has a time stamp of 110ms (70ms + 40ms) with a duration of 50 ms.</span></span>

<span data-ttu-id="69a29-235">Le calcul suivant est plus intéressant.</span><span class="sxs-lookup"><span data-stu-id="69a29-235">The next calculation is more interesting.</span></span> <span data-ttu-id="69a29-236">L’horodatage implicite de l’heure et de la durée de sortie précédentes serait 160 ms (horodatage 110 MS + Duration 50 ms).</span><span class="sxs-lookup"><span data-stu-id="69a29-236">The implied time stamp from the previous output time and duration would be 160 ms (time stamp 110 ms + duration 50 ms).</span></span> <span data-ttu-id="69a29-237">Toutefois, l’horodatage de sortie est supposé être calculé à partir de l’horodatage d’entrée de l’exemple d’entrée le plus ancien qui chevauche l’échantillon de sortie dans le temps, plus la longueur de toutes les données déjà traitées à partir de cet exemple.</span><span class="sxs-lookup"><span data-stu-id="69a29-237">However, the output time stamp is supposed to be calculated from the input time stamp of the earliest input sample that overlaps the output sample in time, plus the length of any data already processed from that sample.</span></span> <span data-ttu-id="69a29-238">L’exemple d’entrée qui se chevauche le plus proche est l’exemple 4 (horodatage = 171), mais ce n’est pas le plus ancien.</span><span class="sxs-lookup"><span data-stu-id="69a29-238">The closest overlapping input sample is the sample 4 (time stamp = 171), but this is not the earliest one.</span></span> <span data-ttu-id="69a29-239">L’exemple qui se chevauche le plus ancien est Sample 3 (horodatage = 121).</span><span class="sxs-lookup"><span data-stu-id="69a29-239">The earliest overlapping sample is sample 3 (time stamp = 121).</span></span> <span data-ttu-id="69a29-240">Si vous ajoutez le 40ms qui a déjà été traité à partir de cet exemple, le résultat est 161.</span><span class="sxs-lookup"><span data-stu-id="69a29-240">Adding the 40ms that has already been processed from that sample, the result is 161.</span></span>

## <a name="related-topics"></a><span data-ttu-id="69a29-241">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="69a29-241">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="69a29-242">Écriture d’une table MFT personnalisée</span><span class="sxs-lookup"><span data-stu-id="69a29-242">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



