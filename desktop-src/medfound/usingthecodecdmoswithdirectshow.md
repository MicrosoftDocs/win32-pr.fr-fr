---
description: Utilisation des codecs multimédias Windows dans DirectShow
ms.assetid: 5b930447-6bf2-4bb3-8dfb-05f4c1e7cd64
title: Utilisation des codecs multimédias Windows dans DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cb521c0e3897dc2415fbd613f97b755a146657d3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106518136"
---
# <a name="using-the-window-media-codecs-in-directshow"></a><span data-ttu-id="8f355-103">Utilisation des codecs multimédias Windows dans DirectShow</span><span class="sxs-lookup"><span data-stu-id="8f355-103">Using the Window Media Codecs in DirectShow</span></span>

<span data-ttu-id="8f355-104">Les objets d’encodeur et de décodeur Windows Media Audio et vidéo ont été initialement conçus et optimisés pour fonctionner avec le format de conteneur de fichiers ASF et le kit de développement logiciel (SDK) du format Windows Media.</span><span class="sxs-lookup"><span data-stu-id="8f355-104">The Windows Media Audio and Video encoder and decoder objects were originally designed and optimized to work with the ASF file container format and the Windows Media Format SDK.</span></span> <span data-ttu-id="8f355-105">Les objets codec fonctionnent correctement dans DirectShow pour certains scénarios, à savoir un encodage CBR et un encodage VBR basé sur la qualité des flux vidéo.</span><span class="sxs-lookup"><span data-stu-id="8f355-105">The codec objects work well in DirectShow for certain scenarios, namely one-pass CBR and quality based VBR encoding of video streams.</span></span> <span data-ttu-id="8f355-106">Toutefois, si vous envisagez d’utiliser les objets codec directement dans DirectShow en utilisant des conteneurs de fichiers autres que ASF, vous devez connaître à l’avance certains comportements et problèmes.</span><span class="sxs-lookup"><span data-stu-id="8f355-106">But if you are considering using the codec objects directly in DirectShow using file containers other than ASF, there are certain behaviors and issues that you should be aware of in advance.</span></span>

> [!Note]  
> <span data-ttu-id="8f355-107">Si vous envisagez d’utiliser des codecs autonomes avec DirectShow, vous souhaiterez probablement les utiliser en tant que DMOs uniquement.</span><span class="sxs-lookup"><span data-stu-id="8f355-107">If you are going to use standalone codecs with DirectShow, you will probably want to use them as DMOs only.</span></span> <span data-ttu-id="8f355-108">En d’autres termes, vous allez utiliser l’interface [**IMediaObject**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) au lieu de [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform).</span><span class="sxs-lookup"><span data-stu-id="8f355-108">In other words, you will be using the [**IMediaObject**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) interface instead of [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform).</span></span>

 

## <a name="wm-audio-in-avi-files"></a><span data-ttu-id="8f355-109">Fichier audio WM dans les fichiers AVI</span><span class="sxs-lookup"><span data-stu-id="8f355-109">WM Audio in AVI Files</span></span>

<span data-ttu-id="8f355-110">Vous pouvez utiliser DirectShow pour encoder des flux WMA dans n’importe quel format de conteneur de fichiers pour lequel vous disposez d’un filtre multiplexeur.</span><span class="sxs-lookup"><span data-stu-id="8f355-110">You can use DirectShow to encode WMA streams into any file container format for which you have a multiplexer filter.</span></span> <span data-ttu-id="8f355-111">Toutefois, les interfaces de codec vidéo et Windows Media Audio ne prennent pas en charge WMA dans les fichiers AVI, car il est impossible d’utiliser les filtres de lecture AVI par défaut pour maintenir la synchronisation audio-vidéo dans un fichier AVI avec un flux WMA.</span><span class="sxs-lookup"><span data-stu-id="8f355-111">However, the Windows Media Audio and Video codec interfaces do not support WMA in AVI files because it is impossible, using the default DirectShow AVI playback filters, to maintain audio-video sync in an AVI file with a WMA stream.</span></span> <span data-ttu-id="8f355-112">Pour plus d’informations, consultez [stockage de médias compressés dans des fichiers AVI](storingcompressedmediainavifiles.md).</span><span class="sxs-lookup"><span data-stu-id="8f355-112">For more information, see [Storing Compressed Media in AVI Files](storingcompressedmediainavifiles.md).</span></span>

<span data-ttu-id="8f355-113">L’encodeur audio DMO génère des échantillons de durée variable, même en mode « taux binaire constant ».</span><span class="sxs-lookup"><span data-stu-id="8f355-113">The audio encoder DMO outputs samples of varying duration, even when in "constant bit rate" mode.</span></span> <span data-ttu-id="8f355-114">Cela fonctionne donc mieux avec les formats de conteneur de fichiers qui utilisent des horodatages.</span><span class="sxs-lookup"><span data-stu-id="8f355-114">It therefore works best with file container formats that use time stamps.</span></span> <span data-ttu-id="8f355-115">Les fichiers AVI ne fournissent pas d’horodatage pour chaque exemple audio ou groupe d’exemples.</span><span class="sxs-lookup"><span data-stu-id="8f355-115">AVI files do not provide a time stamp for each audio sample or group of samples.</span></span> <span data-ttu-id="8f355-116">Dans DirectShow, le filtre de séparateur AVI fabrique des horodatages pour chaque groupe d’échantillons (chaque bloc audio) en fonction de la valeur **nAvgBytesPerSec** de la structure [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) dans l’en-tête de flux avi.</span><span class="sxs-lookup"><span data-stu-id="8f355-116">In DirectShow, the AVI Splitter filter manufactures time stamps for each group of samples (each audio frame) based on the **nAvgBytesPerSec** value in the [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) structure in the AVI stream header.</span></span>

<span data-ttu-id="8f355-117">L’hypothèse sous-jacente à ce calcul est que tous les échantillons audio dans le flux sont de même durée ; Toutefois, les exemples générés par DMO ne sont pas de la même durée, et les horodatages appliqués par le séparateur AVI ne sont pas exacts.</span><span class="sxs-lookup"><span data-stu-id="8f355-117">The assumption underlying this calculation is that all audio samples in the stream are of equal duration; however, the samples output by the DMO are not of equal duration, and so the time stamps applied by the AVI Splitter are not accurate.</span></span> <span data-ttu-id="8f355-118">Par conséquent, il n’est pas possible, sans modifier le séparateur AVI ou le décodeur audio DMO, d’utiliser une application DirectShow pour lire les fichiers AVI avec des flux audio et vidéo synchronisés. Le codec vocal Windows Media Audio 9 fonctionne dans certains cas, mais même si cela perd la synchronisation après toute opération de recherche, il ne peut pas être considéré comme une solution viable.</span><span class="sxs-lookup"><span data-stu-id="8f355-118">Therefore, it is not possible, without modifying either the AVI Splitter or the audio decoder DMO, to use any DirectShow-based application to play back AVI files with audio and video streams in sync. The Windows Media Audio 9 Voice codec will work in some cases, but even this will lose sync after any seek operation, so it really cannot be considered a viable solution.</span></span>

<span data-ttu-id="8f355-119">Si vous disposez d’un encodeur MP3, vous pouvez créer des fichiers AVI avec WMV et MP3 pour le flux audio.</span><span class="sxs-lookup"><span data-stu-id="8f355-119">If you have an MP3 encoder, you can create AVI files with WMV and MP3 for the audio stream.</span></span> <span data-ttu-id="8f355-120">Ces fichiers sont lus et se recherchent correctement dans le lecteur Windows Media et d’autres applications DirectShow, car le séparateur AVI contient du code de gestion spécial pour les flux MP3.</span><span class="sxs-lookup"><span data-stu-id="8f355-120">Such files will play back and seek correctly in Windows Media Player and other DirectShow-based applications, because the AVI Splitter contains special handling code for MP3 streams.</span></span> <span data-ttu-id="8f355-121">Une autre option consiste à utiliser l’audio PCM non compressé, bien que la taille du fichier résultant soit nettement supérieure à celle d’un flux audio compressé.</span><span class="sxs-lookup"><span data-stu-id="8f355-121">Another option is to use uncompressed PCM audio, although obviously the resulting file size will be much larger than with a compressed audio stream.</span></span> <span data-ttu-id="8f355-122">Étant donné que l’exemple d’application DirectShow crée des fichiers AVI, il ne montre pas comment utiliser l’encodeur audio DMO.</span><span class="sxs-lookup"><span data-stu-id="8f355-122">Because the DirectShow sample application creates AVI files, it does not demonstrate how to use the audio encoder DMO.</span></span>

## <a name="one-pass-encoding"></a><span data-ttu-id="8f355-123">Encodage à passage unique</span><span class="sxs-lookup"><span data-stu-id="8f355-123">One-pass Encoding</span></span>

<span data-ttu-id="8f355-124">L’encodeur vidéo DMO fonctionne facilement dans DirectShow pour deux modes d’encodage : CBR et VBR basé sur la qualité.</span><span class="sxs-lookup"><span data-stu-id="8f355-124">The video encoder DMO works easily in DirectShow for two encoding modes: CBR and quality based VBR.</span></span> <span data-ttu-id="8f355-125">Tant que vous suivez l’ordre correct des opérations lors de la génération du graphique de filtre, comme illustré dans l’exemple d’application, il est relativement simple de placer du contenu WMV dans un fichier AVI à l’aide du multiplexeur AVI et du writer de fichier.</span><span class="sxs-lookup"><span data-stu-id="8f355-125">As long as you follow the correct order of operations when building the filter graph, as demonstrated in the sample application, it is relatively simple to place WMV content into an AVI file using the AVI Multiplexer and the File Writer.</span></span>

## <a name="two-pass-encoding"></a><span data-ttu-id="8f355-126">Encodage en deux passes</span><span class="sxs-lookup"><span data-stu-id="8f355-126">Two-pass Encoding</span></span>

<span data-ttu-id="8f355-127">Les modes d’encodage à deux passes nécessitent une approche plus complexe de la génération et de la diffusion de graphiques afin d’empêcher la réinitialisation de son contenu à partir de la première passe avant de commencer la deuxième.</span><span class="sxs-lookup"><span data-stu-id="8f355-127">The two-pass encoding modes require a more complex approach to graph building and streaming in order to prevent the DMO from flushing its contents from the first pass before beginning the second pass.</span></span> <span data-ttu-id="8f355-128">Dans l’encodage en deux passes, il est nécessaire d’exécuter le graphique une seule fois pour que la solution DMO puisse effectuer son analyse de prétraitement des données de fichier, puis Rembobiner le graphique et l’exécuter à nouveau afin que la solution DMO puisse effectuer l’encodage réel.</span><span class="sxs-lookup"><span data-stu-id="8f355-128">In two-pass encoding, it is necessary to run the graph once so the DMO can perform its preprocessing analysis of the file data, and then rewind the graph and run it again so that the DMO can do the actual encoding.</span></span>

<span data-ttu-id="8f355-129">Lorsque le graphique passe à l’état d’exécution pour la deuxième passe, le wrapper DMO définit l’indicateur de discontinuité sur le premier exemple, car l’horodatage n’est pas séquentiel avec le dernier horodatage sur la première passe.</span><span class="sxs-lookup"><span data-stu-id="8f355-129">When the graph goes into a run state for the second pass, the DMO Wrapper sets the DISCONTINUITY flag on the first sample, because the time stamp is not sequential with the last time stamp on the first pass.</span></span> <span data-ttu-id="8f355-130">Lorsque la solution DMO, qui n’a pas été conçue pour fonctionner dans DirectShow, reçoit l’indicateur de discontinuité, elle effectue un vidage et perd les données stockées à partir de la première passe.</span><span class="sxs-lookup"><span data-stu-id="8f355-130">When the DMO, which was not designed to work in DirectShow in this way, receives the DISCONTINUITY flag, it performs a flush and loses the data stored from the first pass.</span></span> <span data-ttu-id="8f355-131">Pour contourner ce problème, la meilleure solution consiste probablement à écrire un filtre de wrappers DMO personnalisé qui ne définit pas l’indicateur de discontinuité lorsque le graphique est cherché après la première passe.</span><span class="sxs-lookup"><span data-stu-id="8f355-131">To work around this issue, the best solution is probably to write a custom DMO Wrapper filter that does not set the DISCONTINUITY flag when the graph is seeked after the first pass.</span></span> <span data-ttu-id="8f355-132">L’exemple Video for Windows (VfW) dans ce kit de développement logiciel (SDK) montre comment effectuer un encodage en deux passes.</span><span class="sxs-lookup"><span data-stu-id="8f355-132">The Video for Windows (VfW) sample in this SDK demonstrates how to perform two-pass encoding.</span></span>

## <a name="interlaced-content"></a><span data-ttu-id="8f355-133">Contenu entrelacé</span><span class="sxs-lookup"><span data-stu-id="8f355-133">Interlaced Content</span></span>

<span data-ttu-id="8f355-134">L’encodeur WMV est capable d’encoder du contenu entrelacé tout en préservant l’entrelacement, ce qui est utile pour le contenu capturé à partir d’un téléviseur et peut également être lu sur un téléviseur.</span><span class="sxs-lookup"><span data-stu-id="8f355-134">The WMV encoder DMO is able to encode interlaced content while preserving the interlacing, which is useful for content that is captured from a TV and might also be played back on a TV.</span></span> <span data-ttu-id="8f355-135">Toutefois, il n’est pas possible de conserver l’entrelacement à l’aide du wrapper DMO par défaut, car ce filtre ne prend pas en charge [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) sur ses exemples d’entrée.</span><span class="sxs-lookup"><span data-stu-id="8f355-135">However, it is not possible to preserve interlacing using the default DMO Wrapper, because that filter does not support [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) on its input samples.</span></span>

<span data-ttu-id="8f355-136">La DMO utilise cette interface pour obtenir les paramètres entrelacés pour chaque exemple qu’elle reçoit.</span><span class="sxs-lookup"><span data-stu-id="8f355-136">The DMO uses that interface to obtain the interlaced settings for each sample that it receives.</span></span> <span data-ttu-id="8f355-137">Si l’interface est introuvable, comme c’est le cas avec le wrapper DMO, DMO traite simplement les exemples d’entrée comme non entrelacés.</span><span class="sxs-lookup"><span data-stu-id="8f355-137">If the interface is not found, as is the case with the DMO Wrapper, the DMO simply treats the input samples as noninterlaced.</span></span> <span data-ttu-id="8f355-138">Pour effectuer un encodage entrelacé dans DirectShow, il existe plusieurs alternatives.</span><span class="sxs-lookup"><span data-stu-id="8f355-138">To perform interlaced encoding in DirectShow, there are several alternatives.</span></span> <span data-ttu-id="8f355-139">L’approche la plus simple consiste probablement à utiliser le kit de développement logiciel (SDK) de la série Windows Media Format 9 directement ou à l’aide du filtre DirectShow de l’enregistreur ASF pour créer un fichier ASF entrelacé.</span><span class="sxs-lookup"><span data-stu-id="8f355-139">The easiest approach is probably to use the Windows Media Format 9 Series SDK either directly or using the WM ASF Writer DirectShow filter, to create an interlaced ASF file.</span></span> <span data-ttu-id="8f355-140">Vous pouvez ensuite transcoder ce fichier dans un autre format.</span><span class="sxs-lookup"><span data-stu-id="8f355-140">You can then transcode that file into some other format.</span></span> <span data-ttu-id="8f355-141">Si vous transcodez dans AVI, vous disposerez d’un fichier entrelacé, mais les filtres de lecture AVI standard DirectShow ne le reconnaîtront pas comme tels, car ils ne prennent pas en charge [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2).</span><span class="sxs-lookup"><span data-stu-id="8f355-141">If you transcode into AVI, you will have an interlaced file, but the standard DirectShow AVI playback filters will not recognize it as such because they do not support [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2).</span></span> <span data-ttu-id="8f355-142">Une autre approche consiste à écrire votre propre filtre de wrappers DMO qui prend en charge l’interface [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) .</span><span class="sxs-lookup"><span data-stu-id="8f355-142">Another approach is to write your own DMO Wrapper filter that supports the [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) interface.</span></span>

## <a name="related-topics"></a><span data-ttu-id="8f355-143">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="8f355-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8f355-144">Utilisation du codec DMOs</span><span class="sxs-lookup"><span data-stu-id="8f355-144">Working with Codec DMOs</span></span>](workingwithcodecdmos.md)
</dt> </dl>

 

 
