---
description: Négociation de type de média sur l’encodeur
ms.assetid: c8ae543e-68f7-4c74-9cb7-2a200bd51820
title: Négociation de type de média sur l’encodeur
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c7845e9d50c5d418198dc0e08313e2e9329ffab8
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/03/2021
ms.locfileid: "103953458"
---
# <a name="media-type-negotiation-on-the-encoder"></a><span data-ttu-id="a4286-103">Négociation de type de média sur l’encodeur</span><span class="sxs-lookup"><span data-stu-id="a4286-103">Media Type Negotiation on the Encoder</span></span>

<span data-ttu-id="a4286-104">Dans Microsoft Media Foundation, les encodeurs sont implémentés en tant que [Media Foundation transformations](media-foundation-transforms.md) (MFTS) avec une entrée et une sortie.</span><span class="sxs-lookup"><span data-stu-id="a4286-104">In Microsoft Media Foundation, encoders are implemented as [Media Foundation transforms](media-foundation-transforms.md) (MFTs) with one input and one output.</span></span> <span data-ttu-id="a4286-105">Avant une session d’encodage, un encodeur doit connaître les caractéristiques du flux qu’il recevra en tant qu’entrée et le format du flux qu’il produira comme sortie.</span><span class="sxs-lookup"><span data-stu-id="a4286-105">Before an encoding session, an encoder needs to know the characteristics of the stream it will receive as input and the format of the stream it will produce as output.</span></span> <span data-ttu-id="a4286-106">Vous devez définir les types de média d’entrée et de sortie et les caractéristiques associées avant de transmettre des données via l’encodeur.</span><span class="sxs-lookup"><span data-stu-id="a4286-106">You must set the input and output media types and related characteristics before you pass data through the encoder.</span></span> <span data-ttu-id="a4286-107">Vous devez fournir les formats d’entrée et de sortie en spécifiant les [GUID de type de média](media-type-guids.md) appropriés et définir les caractéristiques du flux de sortie en définissant les attributs de type de [média](media-type-attributes.md) appropriés sur le type de média de sortie.</span><span class="sxs-lookup"><span data-stu-id="a4286-107">You must supply the input and output formats by specifying the appropriate [Media Type GUIDs](media-type-guids.md) and set the characteristics of the output stream by setting the relevant [Media Type Attributes](media-type-attributes.md) on the output media type.</span></span> <span data-ttu-id="a4286-108">Un encodeur nouvellement instancié n’a aucun type de média défini.</span><span class="sxs-lookup"><span data-stu-id="a4286-108">A newly instantiated encoder does not have any set media types.</span></span>

<span data-ttu-id="a4286-109">Le type de média d’entrée est un format non compressé, tel qu’une vidéo PCM audio ou RVB.</span><span class="sxs-lookup"><span data-stu-id="a4286-109">The input media type is an uncompressed format, such as PCM audio or RGB video.</span></span> <span data-ttu-id="a4286-110">Les types de format utilisés par l’encodeur sont limités à ceux décrits par les structures **VIDEOINFOHEADER** et **WAVEFORMATEX** .</span><span class="sxs-lookup"><span data-stu-id="a4286-110">The format types that are used by the encoder are limited to those described by the **VIDEOINFOHEADER** and **WAVEFORMATEX** structures.</span></span> <span data-ttu-id="a4286-111">Pour plus d’informations sur ces structures, consultez la documentation SDK Windows. Media Foundation fournit des fonctions d’assistance pour créer des types de média à partir de structures de format.</span><span class="sxs-lookup"><span data-stu-id="a4286-111">For more information about these structures, see the Windows SDK documentation.Media foundation provides helper functions to create media types from format structures.</span></span> <span data-ttu-id="a4286-112">Par exemple, la fonction [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) Initialise un type de vidéo à partir d’une structure **VIDEOINFOHEADER** , et la fonction [**MFInitMediaTypeFromWaveFormatEx**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromwaveformatex) Initialise un type de vidéo à partir d’une structure **WAVEFORMATEX** ou **WAVEFORMATEXTENSIBLE** .</span><span class="sxs-lookup"><span data-stu-id="a4286-112">For example, the [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) function initializes a video type from a **VIDEOINFOHEADER** structure, and the [**MFInitMediaTypeFromWaveFormatEx**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromwaveformatex) function initializes a video type from a **WAVEFORMATEX** or **WAVEFORMATEXTENSIBLE** structure.</span></span> <span data-ttu-id="a4286-113">Pour plus d’informations, consultez [conversions de type de média](media-type-conversions.md).</span><span class="sxs-lookup"><span data-stu-id="a4286-113">For more information, see [Media Type Conversions](media-type-conversions.md).</span></span> <span data-ttu-id="a4286-114">Vous devez définir le type de média d’entrée sur l’encodeur en appelant [**IMFTransform :: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).</span><span class="sxs-lookup"><span data-stu-id="a4286-114">You must set the input media type on the encoder by calling [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).</span></span>

<span data-ttu-id="a4286-115">Le type de média de sortie est le format de compression utilisé dans le fichier ou le flux de source final.</span><span class="sxs-lookup"><span data-stu-id="a4286-115">The output media type is the compression format used in the final source stream or file.</span></span> <span data-ttu-id="a4286-116">Vous pouvez définir le type de média de sortie disponible uniquement après avoir défini le type de média d’entrée.</span><span class="sxs-lookup"><span data-stu-id="a4286-116">You can set the available output media type only after setting the input media type.</span></span> <span data-ttu-id="a4286-117">Vous pouvez récupérer les types de sortie pris en charge en appelant [**IMFTransform :: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) dans une boucle jusqu’à ce que l’encodeur retourne **MF E plus de \_ \_ \_ \_ types**.</span><span class="sxs-lookup"><span data-stu-id="a4286-117">You can retrieve the supported output types by calling [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) in a loop until the encoder returns **MF\_E\_NO\_MORE\_TYPES**.</span></span> <span data-ttu-id="a4286-118">Incrémentez l’index de type avec chaque itération.</span><span class="sxs-lookup"><span data-stu-id="a4286-118">Increment the type index with each iteration.</span></span> <span data-ttu-id="a4286-119">Lorsque vous trouvez un type de média approprié, définissez le type de média de sortie en appelant [**IMFTransform :: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="a4286-119">When you find an appropriate media type, set the output media type by calling [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span>

<span data-ttu-id="a4286-120">Le facteur déterminant dans le choix du type de média de sortie dépend du type d’encodage et de vos exigences d’encodage.</span><span class="sxs-lookup"><span data-stu-id="a4286-120">The deciding factor in choosing the output media type depends on the type of encoding and your encoding requirements.</span></span> <span data-ttu-id="a4286-121">Par exemple, pour les flux audio qui sont encodés CBR, vous souhaitez rechercher un type de média qui correspond à votre entrée et une vitesse de transmission aussi proche que possible d’une valeur cible.</span><span class="sxs-lookup"><span data-stu-id="a4286-121">For example, for audio streams that are CBR-encoded, you want to find a media type that matches your input and has a bit rate that is as close as possible to a target value.</span></span>

<span data-ttu-id="a4286-122">Si vous souhaitez utiliser un mode d’encodage autre que CBR, vous devez définir le mode, puis énumérer les types de sortie pour ce mode, car l’encodeur modifie les types de sortie pris en charge en fonction du jeu de modes.</span><span class="sxs-lookup"><span data-stu-id="a4286-122">If you want to use an encoding mode other than CBR, you must set the mode and then enumerate the output types for that mode, because the encoder changes the supported output types depending upon the mode set.</span></span> <span data-ttu-id="a4286-123">Les propriétés qui contrôlent le mode d’encodage sont [**MFPKEY \_ VBRENABLED**](mfpkey-vbrenabledproperty.md) et [**MFPKEY \_ PASSESUSED**](mfpkey-passesusedproperty.md).</span><span class="sxs-lookup"><span data-stu-id="a4286-123">The properties that control the encoding mode are [**MFPKEY\_VBRENABLED**](mfpkey-vbrenabledproperty.md) and [**MFPKEY\_PASSESUSED**](mfpkey-passesusedproperty.md).</span></span> <span data-ttu-id="a4286-124">Par exemple, si vous énumérez les types de sortie pour l’encodage VBR-Quality, le type de média dépend de la valeur de qualité que vous décidez d’utiliser.</span><span class="sxs-lookup"><span data-stu-id="a4286-124">For example, if you are enumerating output types for VBR-quality encoding, the media type depends on the quality value you decide to use.</span></span> <span data-ttu-id="a4286-125">Pour plus d’informations sur la définition de ces propriétés, consultez [Propriétés de codage](configuring-the-encoder.md).</span><span class="sxs-lookup"><span data-stu-id="a4286-125">For information about setting these properties, see [Encoding Properties](configuring-the-encoder.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="a4286-126">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="a4286-126">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a4286-127">Instanciation d’une table MFT d’encodeur</span><span class="sxs-lookup"><span data-stu-id="a4286-127">Instantiating an Encoder MFT</span></span>](instantiating-the-encoder-mft.md)
</dt> <dt>

[<span data-ttu-id="a4286-128">Encodeurs Windows Media</span><span class="sxs-lookup"><span data-stu-id="a4286-128">Windows Media Encoders</span></span>](windows-media-encoders.md)
</dt> </dl>

 

 



