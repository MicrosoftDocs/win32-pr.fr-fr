---
description: Cette rubrique décrit comment une transformation de Media Foundation (MFT) doit gérer les modifications de format pendant la diffusion en continu.
ms.assetid: b0a94760-b4dd-4e50-a5ce-a1f674dde156
title: Gestion des modifications de flux
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2adf3cbc0504a37fe611b77047c73f85b9d1e742
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104201805"
---
# <a name="handling-stream-changes"></a><span data-ttu-id="30cc9-103">Gestion des modifications de flux</span><span class="sxs-lookup"><span data-stu-id="30cc9-103">Handling Stream Changes</span></span>

<span data-ttu-id="30cc9-104">Cette rubrique décrit comment une transformation de Media Foundation (MFT) doit gérer les modifications de format pendant la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="30cc9-104">This topic describes how a Media Foundation transform (MFT) should handle format changes during streaming.</span></span>

> [!IMPORTANT]
>
> <span data-ttu-id="30cc9-105">Cette rubrique ne s’applique pas aux encodeurs.</span><span class="sxs-lookup"><span data-stu-id="30cc9-105">This topic does not apply to encoders.</span></span> <span data-ttu-id="30cc9-106">Les encodeurs ne doivent pas propager les modifications de format comme décrit dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="30cc9-106">Encoders should not propagate format changes as described in this topic.</span></span> <span data-ttu-id="30cc9-107">Les encodeurs doivent uniquement accepter un type d’entrée qui correspond au type de sortie actuellement configuré.</span><span class="sxs-lookup"><span data-stu-id="30cc9-107">Encoders should only accept an input type that matches the currently configured output type.</span></span>

 

## <a name="overview-of-format-changes"></a><span data-ttu-id="30cc9-108">Vue d’ensemble des modifications de format</span><span class="sxs-lookup"><span data-stu-id="30cc9-108">Overview of Format Changes</span></span>

<span data-ttu-id="30cc9-109">En règle générale, il existe deux raisons pour lesquelles un format peut changer pendant la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="30cc9-109">Generally, there are two reasons that a format can change during streaming.</span></span>

-   <span data-ttu-id="30cc9-110">Le client peut basculer vers un flux avec un nouveau format.</span><span class="sxs-lookup"><span data-stu-id="30cc9-110">The client might switch to a stream with a new format.</span></span> <span data-ttu-id="30cc9-111">Par exemple, dans la télévision numérique, cela peut se produire en raison d’un changement de canal.</span><span class="sxs-lookup"><span data-stu-id="30cc9-111">For example, in digital television, this can occur due to a channel change.</span></span>
-   <span data-ttu-id="30cc9-112">Dans certains formats vidéo, comme H. 264, le flux binaire peut signaler une modification de format.</span><span class="sxs-lookup"><span data-stu-id="30cc9-112">In some video formats, such as H.264, the bitstream can signal a format change.</span></span> <span data-ttu-id="30cc9-113">Ces modifications peuvent inclure des modifications apportées à la dominance des champs, à la résolution vidéo ou au proportions en pixels.</span><span class="sxs-lookup"><span data-stu-id="30cc9-113">Such changes might include changes in field dominance, video resolution, or pixel aspect ratio.</span></span>

<span data-ttu-id="30cc9-114">Si le type d’encodage change, le client peut avoir besoin de supprimer la MFT du pipeline et de la remplacer par une autre MFT.</span><span class="sxs-lookup"><span data-stu-id="30cc9-114">If the encoding type changes, the client might need to remove the MFT from the pipeline and replace it with another MFT.</span></span> <span data-ttu-id="30cc9-115">(Par exemple, le client devra peut-être effectuer une permutation dans un nouveau décodeur.) Cette rubrique ne couvre pas cette situation.</span><span class="sxs-lookup"><span data-stu-id="30cc9-115">(For example, the client might need to swap in a new decoder.) This topic does not cover that situation.</span></span> <span data-ttu-id="30cc9-116">Cette rubrique couvre uniquement le cas où la MFT actuelle peut gérer le nouveau format.</span><span class="sxs-lookup"><span data-stu-id="30cc9-116">This topic covers only the case where the current MFT can handle the new format.</span></span>

<span data-ttu-id="30cc9-117">Si le format change, la table MFT peut nécessiter un nouveau type d’entrée, un nouveau type de sortie, ou les deux.</span><span class="sxs-lookup"><span data-stu-id="30cc9-117">If the format changes, the MFT might require a new input type, a new output type, or both.</span></span>

-   <span data-ttu-id="30cc9-118">Les modifications apportées au type d’entrée sont initiées par le client.</span><span class="sxs-lookup"><span data-stu-id="30cc9-118">Changes to input type are initiated by the client.</span></span> <span data-ttu-id="30cc9-119">Une table MFT ne change jamais son propre type d’entrée.</span><span class="sxs-lookup"><span data-stu-id="30cc9-119">An MFT never changes its own input type.</span></span>
-   <span data-ttu-id="30cc9-120">Les modifications apportées au type de sortie sont initiées par la table MFT.</span><span class="sxs-lookup"><span data-stu-id="30cc9-120">Changes to output type are initiated by the MFT.</span></span> <span data-ttu-id="30cc9-121">La table MFT signale qu’elle requiert un nouveau type de sortie et que le client négocie le nouveau type de sortie avec la table MFT.</span><span class="sxs-lookup"><span data-stu-id="30cc9-121">The MFT signals that it requires a new output type, and the client negotiates the new output type with the MFT.</span></span>

<span data-ttu-id="30cc9-122">Trois cas distincts sont donc possibles :</span><span class="sxs-lookup"><span data-stu-id="30cc9-122">Thus, three distinct cases are possible:</span></span>

-   <span data-ttu-id="30cc9-123">Le client définit un nouveau type d’entrée.</span><span class="sxs-lookup"><span data-stu-id="30cc9-123">The client sets a new input type.</span></span> <span data-ttu-id="30cc9-124">La table MFT utilise le nouveau format, sans aucune modification de son type de sortie.</span><span class="sxs-lookup"><span data-stu-id="30cc9-124">The MFT consumes the new format, with no change to its output type.</span></span>
-   <span data-ttu-id="30cc9-125">Le client définit un nouveau type d’entrée, ce qui déclenche une modification du type de sortie.</span><span class="sxs-lookup"><span data-stu-id="30cc9-125">The client sets a new input type, and this triggers a change in the output type.</span></span>
-   <span data-ttu-id="30cc9-126">Le type d’entrée ne change pas, mais la table MFT détecte une modification de format dans le flux de données binaire, ce qui nécessite un nouveau type de sortie.</span><span class="sxs-lookup"><span data-stu-id="30cc9-126">The input type does not change, but the MFT detects a format change in the bitstream, which requires a new output type.</span></span>

## <a name="implementing-format-changes"></a><span data-ttu-id="30cc9-127">Implémentation des modifications de format</span><span class="sxs-lookup"><span data-stu-id="30cc9-127">Implementing Format Changes</span></span>

<span data-ttu-id="30cc9-128">Le reste de cette rubrique décrit comment le client doit traiter une modification de format et comment implémenter les modifications de format dans une table MFT.</span><span class="sxs-lookup"><span data-stu-id="30cc9-128">The remainder of this topic describes how the client should process a format change, and how to implement format changes in an MFT.</span></span>

### <a name="output-type"></a><span data-ttu-id="30cc9-129">Type de sortie</span><span class="sxs-lookup"><span data-stu-id="30cc9-129">Output Type</span></span>

<span data-ttu-id="30cc9-130">Tout MFT peut lancer une modification de son type de sortie, comme suit :</span><span class="sxs-lookup"><span data-stu-id="30cc9-130">Any MFT can initiate a change to its output type, as follows:</span></span>

1.  <span data-ttu-id="30cc9-131">Le client appelle [**IMFTransform ::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="30cc9-131">The client calls [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="30cc9-132">La table MFT répond comme suit :</span><span class="sxs-lookup"><span data-stu-id="30cc9-132">The MFT responds as follows:</span></span>
    1.  <span data-ttu-id="30cc9-133">La table MFT ne produit pas d’exemple de sortie dans [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="30cc9-133">The MFT does not produce an output sample in [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>
    2.  <span data-ttu-id="30cc9-134">La table MFT définit l’indicateur de **modification de \_ \_ \_ \_ format \_ de mémoire tampon de données de sortie MFT** dans le membre **dwStatus** de la structure de [**\_ \_ \_ mémoire tampon de données de sortie MFT**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) .</span><span class="sxs-lookup"><span data-stu-id="30cc9-134">The MFT sets the **MFT\_OUTPUT\_DATA\_BUFFER\_FORMAT\_CHANGE** flag in the **dwStatus** member of the [**MFT\_OUTPUT\_DATA\_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) structure.</span></span>
    3.  <span data-ttu-id="30cc9-135">La méthode [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) retourne le code d’erreur de la modification du **flux de \_ \_ transformation \_ \_ MF E**.</span><span class="sxs-lookup"><span data-stu-id="30cc9-135">The [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method returns the error code **MF\_E\_TRANSFORM\_STREAM\_CHANGE**.</span></span>
2.  <span data-ttu-id="30cc9-136">Le client appelle [**IMFTransform :: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span><span class="sxs-lookup"><span data-stu-id="30cc9-136">The client calls [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span></span> <span data-ttu-id="30cc9-137">Cette méthode retourne un jeu de types de sortie mis à jour.</span><span class="sxs-lookup"><span data-stu-id="30cc9-137">This method returns an updated set of output types.</span></span>
3.  <span data-ttu-id="30cc9-138">Le client appelle [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) pour définir un nouveau type de sortie.</span><span class="sxs-lookup"><span data-stu-id="30cc9-138">The client calls [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) to set a new output type.</span></span>
4.  <span data-ttu-id="30cc9-139">Le client reprend l’appel de [**ProcessInput**](/windows/desktop/api/mfidl/nf-mfidl-imfqualitymanager-notifyprocessinput) / [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="30cc9-139">The client resumes calling [**ProcessInput**](/windows/desktop/api/mfidl/nf-mfidl-imfqualitymanager-notifyprocessinput)/[**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

### <a name="input-type"></a><span data-ttu-id="30cc9-140">Type d’entrée</span><span class="sxs-lookup"><span data-stu-id="30cc9-140">Input Type</span></span>

<span data-ttu-id="30cc9-141">Les modifications apportées au type d’entrée sont lancées par le client, jamais par la MFT.</span><span class="sxs-lookup"><span data-stu-id="30cc9-141">Changes to the input type are initiated by the client, never by the MFT.</span></span> <span data-ttu-id="30cc9-142">Si le type d’entrée change, il peut déclencher une modification du type de sortie.</span><span class="sxs-lookup"><span data-stu-id="30cc9-142">If the input type changes, it might trigger a change to the output type.</span></span>

<span data-ttu-id="30cc9-143">La séquence exacte d’événements dépend de la valeur de l’attribut de modification de la [**\_ prise en charge du \_ \_ format \_ dynamique de la table MFT**](mft-support-dynamic-format-change-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="30cc9-143">The exact sequence of events depends on the value of the [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute.</span></span>



| <span data-ttu-id="30cc9-144">Valeur</span><span class="sxs-lookup"><span data-stu-id="30cc9-144">Value</span></span>     | <span data-ttu-id="30cc9-145">Description</span><span class="sxs-lookup"><span data-stu-id="30cc9-145">Description</span></span>                                                     |
|-----------|-----------------------------------------------------------------|
| <span data-ttu-id="30cc9-146">**FALSE**</span><span class="sxs-lookup"><span data-stu-id="30cc9-146">**FALSE**</span></span> | <span data-ttu-id="30cc9-147">Avant de définir un nouveau type d’entrée, le client doit vider la table MFT.</span><span class="sxs-lookup"><span data-stu-id="30cc9-147">Before the client sets a new input type, it must drain the MFT.</span></span> |
| <span data-ttu-id="30cc9-148">**TRUE**</span><span class="sxs-lookup"><span data-stu-id="30cc9-148">**TRUE**</span></span>  | <span data-ttu-id="30cc9-149">Le client peut définir un nouveau type d’entrée sans vider la MFT.</span><span class="sxs-lookup"><span data-stu-id="30cc9-149">The client can set a new input type without draining the MFT.</span></span>   |



 

<span data-ttu-id="30cc9-150">Une table MFT expose cet attribut par le biais de sa méthode [**IMFTransform :: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) .</span><span class="sxs-lookup"><span data-stu-id="30cc9-150">An MFT exposes this attribute through its [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) method.</span></span> <span data-ttu-id="30cc9-151">La valeur par défaut de cet attribut est **false**. Si la MFT ne définit pas l’attribut, traitez la valeur comme **false**.</span><span class="sxs-lookup"><span data-stu-id="30cc9-151">The default value of this attribute is **FALSE**; if the MFT does not set the attribute, treat the value as **FALSE**.</span></span>

<span data-ttu-id="30cc9-152">**La \_ modification du format dynamique de la prise en charge MFT \_ \_ \_ est false**</span><span class="sxs-lookup"><span data-stu-id="30cc9-152">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE is FALSE**</span></span>

1.  <span data-ttu-id="30cc9-153">Le client envoie le message de [**\_ drainage de \_ commande \_ de message MFT**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="30cc9-153">The client sends the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span>
2.  <span data-ttu-id="30cc9-154">Le client draine la MFT en appelant [**IMFTransform ::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) jusqu’à ce que **ProcessOutput** retourne la **\_ transformation MF E \_ \_ nécessite \_ plus \_ d’entrée**.</span><span class="sxs-lookup"><span data-stu-id="30cc9-154">The client drains the MFT by calling [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) until **ProcessOutput** returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span>
3.  <span data-ttu-id="30cc9-155">Le client appelle [**IMFTransform :: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) pour définir le nouveau type d’entrée.</span><span class="sxs-lookup"><span data-stu-id="30cc9-155">The client calls [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the new input type.</span></span>
4.  <span data-ttu-id="30cc9-156">La table MFT valide le type d’entrée.</span><span class="sxs-lookup"><span data-stu-id="30cc9-156">The MFT validates the input type.</span></span> <span data-ttu-id="30cc9-157">Si le type n’est pas valide, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) retourne **MF \_ E \_ INVALIDMEDIATYPE** ou un autre code d’erreur.</span><span class="sxs-lookup"><span data-stu-id="30cc9-157">If the type is invalid, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) returns **MF\_E\_INVALIDMEDIATYPE** or another error code.</span></span> <span data-ttu-id="30cc9-158">Sinon, **SetInputType** retourne S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="30cc9-158">Otherwise, **SetInputType** returns S\_OK.</span></span>
5.  <span data-ttu-id="30cc9-159">En supposant que le type d’entrée est valide, la table MFT évalue si le type de sortie change également.</span><span class="sxs-lookup"><span data-stu-id="30cc9-159">Assuming the input type is valid, the MFT evaluates whether the output type also changes.</span></span> <span data-ttu-id="30cc9-160">Si ce n’est pas le cas, la diffusion continue et aucune autre action n’est requise.</span><span class="sxs-lookup"><span data-stu-id="30cc9-160">If not, streaming continues, and no further action is required.</span></span>
6.  <span data-ttu-id="30cc9-161">Si le type de sortie change :</span><span class="sxs-lookup"><span data-stu-id="30cc9-161">If the output type changes:</span></span>
    1.  <span data-ttu-id="30cc9-162">La table MFT invalide son type de média de sortie actuel et met à jour la liste des types de médias de sortie disponibles.</span><span class="sxs-lookup"><span data-stu-id="30cc9-162">The MFT invalidates its current output media type, and updates the list of available output media types.</span></span>
    2.  <span data-ttu-id="30cc9-163">L’appel suivant à [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) retourne **la \_ \_ modification du \_ flux \_ de transformation MF E**, comme décrit dans la section précédente.</span><span class="sxs-lookup"><span data-stu-id="30cc9-163">The next call to [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**, as described in the previous section.</span></span>
    3.  <span data-ttu-id="30cc9-164">Le client appelle [**IMFTransform :: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) pour accéder à la liste mise à jour des types de sortie.</span><span class="sxs-lookup"><span data-stu-id="30cc9-164">The client calls [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) to get the updated list of output types.</span></span>
    4.  <span data-ttu-id="30cc9-165">Le client appelle [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="30cc9-165">The client calls [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span>

<span data-ttu-id="30cc9-166">**La \_ modification du format dynamique de la prise en charge MFT \_ \_ \_ est vraie**</span><span class="sxs-lookup"><span data-stu-id="30cc9-166">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE is TRUE**</span></span>

1.  <span data-ttu-id="30cc9-167">Le client appelle [**IMFTransform :: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) pour définir le nouveau type d’entrée.</span><span class="sxs-lookup"><span data-stu-id="30cc9-167">The client calls [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the new input type.</span></span>
2.  <span data-ttu-id="30cc9-168">La table MFT valide le type d’entrée.</span><span class="sxs-lookup"><span data-stu-id="30cc9-168">The MFT validates the input type.</span></span> <span data-ttu-id="30cc9-169">Si le type n’est pas valide, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) retourne **MF \_ E \_ INVALIDMEDIATYPE** ou un autre code d’erreur.</span><span class="sxs-lookup"><span data-stu-id="30cc9-169">If the type is invalid, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) returns **MF\_E\_INVALIDMEDIATYPE** or another error code.</span></span> <span data-ttu-id="30cc9-170">Sinon, **SetInputType** retourne S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="30cc9-170">Otherwise, **SetInputType** returns S\_OK.</span></span>
3.  <span data-ttu-id="30cc9-171">En supposant que le type d’entrée est valide, la table MFT évalue si le type de sortie change également.</span><span class="sxs-lookup"><span data-stu-id="30cc9-171">Assuming the input type is valid, the MFT evaluates whether the output type also changes.</span></span> <span data-ttu-id="30cc9-172">Si ce n’est pas le cas, la diffusion continue et aucune autre action n’est requise.</span><span class="sxs-lookup"><span data-stu-id="30cc9-172">If not, streaming continues, and no further action is required.</span></span>
4.  <span data-ttu-id="30cc9-173">Avant que le type de sortie ne change, la table MFT doit traiter tous les exemples d’entrée mis en cache, comme suit :</span><span class="sxs-lookup"><span data-stu-id="30cc9-173">Before the output type changes, the MFT must process any cached input samples, as follows:</span></span>
    1.  <span data-ttu-id="30cc9-174">La table MFT n’invalide pas son type de sortie actuel.</span><span class="sxs-lookup"><span data-stu-id="30cc9-174">The MFT does not invalidate its current output type.</span></span>
    2.  <span data-ttu-id="30cc9-175">La table MFT produit autant de sortie que possible des exemples d’entrée mis en cache.</span><span class="sxs-lookup"><span data-stu-id="30cc9-175">The MFT produces as much output as it can from the cached input samples.</span></span>
    3.  <span data-ttu-id="30cc9-176">Il est facultatif que la table MFT accepte de nouveaux exemples d’entrée lors du traitement des exemples mis en cache.</span><span class="sxs-lookup"><span data-stu-id="30cc9-176">It is optional whether the MFT accepts new input samples while it processes the cached samples.</span></span> <span data-ttu-id="30cc9-177">Si c’est le cas, les nouveaux exemples d’entrée utilisent le nouveau format d’entrée, de sorte que la MFT doit assurer le suivi du point lorsque le format a changé.</span><span class="sxs-lookup"><span data-stu-id="30cc9-177">If so, the new input samples will use the new input format, so the MFT must keep track of the point when the format changed.</span></span>
5.  <span data-ttu-id="30cc9-178">Une fois que la MFT a traité tous les exemples qu’il a reçus avant la modification du type d’entrée, [**IMFTransform ::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) retourne la **\_ modification du flux de \_ transformation \_ \_ MF E**.</span><span class="sxs-lookup"><span data-stu-id="30cc9-178">After the MFT processes all of the samples that it received before the input type changed, the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**.</span></span>
6.  <span data-ttu-id="30cc9-179">La table MFT invalide son type de sortie actuel et met à jour la liste des types de médias de sortie disponibles.</span><span class="sxs-lookup"><span data-stu-id="30cc9-179">The MFT invalidates its current output type, and updates the list of available output media types.</span></span>
7.  <span data-ttu-id="30cc9-180">Le client négocie le nouveau type de sortie, comme décrit précédemment.</span><span class="sxs-lookup"><span data-stu-id="30cc9-180">The client negotiates the new output type, as described previously.</span></span>

<span data-ttu-id="30cc9-181">Un [MFTS asynchrone](asynchronous-mfts.md) doit retourner la valeur **true** pour l’attribut de [**\_ \_ \_ \_ modification de format dynamique de la prise en charge de MFT**](mft-support-dynamic-format-change-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="30cc9-181">[Asynchronous MFTs](asynchronous-mfts.md) must return the value **TRUE** for the [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute.</span></span> <span data-ttu-id="30cc9-182">Lors de l’utilisation d’une table MFT asynchrone, le client peut supposer que l’attribut de **\_ \_ \_ \_ modification de format dynamique de la table MFT prend** la valeur **true**.</span><span class="sxs-lookup"><span data-stu-id="30cc9-182">When using an asynchronous MFT, the client can assume that the **MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE** attribute is set to **TRUE**.</span></span>

<span data-ttu-id="30cc9-183">Lorsque [**la \_ prise en charge de la \_ \_ mise en forme dynamique \_**](mft-support-dynamic-format-change-attribute.md) par la MFT prend la **valeur true**, la principale différence réside dans le fait que le client n’est pas obligé de vider la MFT avant de définir un nouveau type d’entrée.</span><span class="sxs-lookup"><span data-stu-id="30cc9-183">When [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) is **TRUE**, the main difference is that the client is not required to drain the MFT before setting a new input type.</span></span> <span data-ttu-id="30cc9-184">Par conséquent, le type d’entrée peut changer pendant que la table MFT contient des exemples d’entrée.</span><span class="sxs-lookup"><span data-stu-id="30cc9-184">As a result, the input type might change while the MFT is holding onto input samples.</span></span> <span data-ttu-id="30cc9-185">Il est important que la MFT ne supprime pas simplement ces exemples.</span><span class="sxs-lookup"><span data-stu-id="30cc9-185">It is important that the MFT does not simply drop these samples.</span></span> <span data-ttu-id="30cc9-186">En outre, le type de sortie ne peut pas changer tant que la table MFT n’a pas traité toutes ses données mises en cache.</span><span class="sxs-lookup"><span data-stu-id="30cc9-186">Also, the output type cannot change until the MFT processes all of its cached data.</span></span>

<span data-ttu-id="30cc9-187">Le paragraphe précédent s’applique particulièrement aux décodeurs vidéo, qui peuvent recevoir des frames inter-codés hors de l’ordre temporel et doivent donc les mettre en cache.</span><span class="sxs-lookup"><span data-stu-id="30cc9-187">The previous paragraph applies especially to video decoders, which can receive inter-coded frames out of temporal order, and thus need to cache them.</span></span> <span data-ttu-id="30cc9-188">Si une table MFT ne met pas en cache les exemples d’entrée, le drainage est essentiellement une absence d’opération.</span><span class="sxs-lookup"><span data-stu-id="30cc9-188">If an MFT does not cache input samples, draining is essentially a no-op.</span></span> <span data-ttu-id="30cc9-189">Dans ce cas, la table MFT peut définir la [**\_ \_ \_ \_ modification du format dynamique de la table MFT**](mft-support-dynamic-format-change-attribute.md) sur **false** (ou laissez l’attribut désactivé).</span><span class="sxs-lookup"><span data-stu-id="30cc9-189">In that case, the MFT can set [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) to **FALSE** (or leave the attribute unset).</span></span>

<span data-ttu-id="30cc9-190">Notez également que chaque MFT est censé gérer les modifications de format correctement après avoir été vidé.</span><span class="sxs-lookup"><span data-stu-id="30cc9-190">Also, note that every MFT is expected to handle format changes correctly after being drained.</span></span> <span data-ttu-id="30cc9-191">L’attribut de [**\_ \_ \_ \_ modification de format dynamique de la table MFT**](mft-support-dynamic-format-change-attribute.md) indique si la table MFT prend en charge les changements de format sans purge.</span><span class="sxs-lookup"><span data-stu-id="30cc9-191">The [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute indicates whether the MFT supports format changes without draining.</span></span>

## <a name="change-in-interlace-mode"></a><span data-ttu-id="30cc9-192">Changer en mode entrelacé</span><span class="sxs-lookup"><span data-stu-id="30cc9-192">Change in Interlace Mode</span></span>

<span data-ttu-id="30cc9-193">Les modifications apportées au mode d’entrelacement de vidéos sont un cas particulier, car ils n’invalident pas le type de média actuel.</span><span class="sxs-lookup"><span data-stu-id="30cc9-193">Changes in the video interlacing mode are a special case, because they do not invalidate the current media type.</span></span> <span data-ttu-id="30cc9-194">Au lieu de cela, le mode entrelacé est spécifié pour chaque image vidéo en définissant des attributs sur l’exemple de support.</span><span class="sxs-lookup"><span data-stu-id="30cc9-194">Instead, the interlace mode is specified for each video frame by setting attributes on the media sample.</span></span> <span data-ttu-id="30cc9-195">Une table MFT vidéo doit vérifier chaque échantillon d’entrée pour la présence de ces indicateurs.</span><span class="sxs-lookup"><span data-stu-id="30cc9-195">A video MFT should check each input sample for the presence of these flags.</span></span>

<span data-ttu-id="30cc9-196">Le mode entrelacé peut changer lorsque la trame de champ supérieure passe du champ supérieur au champ inférieur, ou lorsque la vidéo bascule entre des images progressives et entrelacées.</span><span class="sxs-lookup"><span data-stu-id="30cc9-196">The interlace mode can change when the field dominance switches from top-field to bottom-field, or when the video switches between progressive and interlaced pictures.</span></span>

<span data-ttu-id="30cc9-197">Pour plus d’informations, consultez [entrelacer les indicateurs sur les exemples](video-interlacing.md).</span><span class="sxs-lookup"><span data-stu-id="30cc9-197">For more information, see [Interlace Flags on Samples](video-interlacing.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="30cc9-198">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="30cc9-198">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="30cc9-199">Écriture d’une table MFT personnalisée</span><span class="sxs-lookup"><span data-stu-id="30cc9-199">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



