---
description: Cette rubrique décrit comment prendre en charge Microsoft Direct3D 11 dans un décodeur de Microsoft Media Foundation.
ms.assetid: 656556AA-0266-4318-9D3C-AED75BD728F6
title: Prise en charge du décodage vidéo Direct3D 11 dans Media Foundation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 542f7244922dc7947f22e4d33027fdcac1962fe5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/03/2021
ms.locfileid: "106529531"
---
# <a name="supporting-direct3d-11-video-decoding-in-media-foundation"></a><span data-ttu-id="36eb9-103">Prise en charge du décodage vidéo Direct3D 11 dans Media Foundation</span><span class="sxs-lookup"><span data-stu-id="36eb9-103">Supporting Direct3D 11 Video Decoding in Media Foundation</span></span>

<span data-ttu-id="36eb9-104">Cette rubrique décrit comment prendre en charge Microsoft Direct3D 11 dans un décodeur de Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="36eb9-104">This topic describes how to support Microsoft Direct3D 11 in a Microsoft Media Foundation decoder.</span></span> <span data-ttu-id="36eb9-105">Plus précisément, il décrit la communication entre le décodeur et le convertisseur vidéo.</span><span class="sxs-lookup"><span data-stu-id="36eb9-105">Specifically, it describes the communication between the decoder and the video renderer.</span></span> <span data-ttu-id="36eb9-106">Cette rubrique ne décrit pas comment implémenter les opérations de décodage.</span><span class="sxs-lookup"><span data-stu-id="36eb9-106">This topic does not describe how to implement the decoding operations.</span></span>

-   [<span data-ttu-id="36eb9-107">Vue d’ensemble</span><span class="sxs-lookup"><span data-stu-id="36eb9-107">Overview</span></span>](#overview)
-   [<span data-ttu-id="36eb9-108">Ouvrir un handle d’appareil</span><span class="sxs-lookup"><span data-stu-id="36eb9-108">Open a Device Handle</span></span>](#open-a-device-handle)
-   [<span data-ttu-id="36eb9-109">Rechercher une configuration de décodeur</span><span class="sxs-lookup"><span data-stu-id="36eb9-109">Find a Decoder Configuration</span></span>](#find-a-decoder-configuration)
-   [<span data-ttu-id="36eb9-110">Revenir au décodage logiciel</span><span class="sxs-lookup"><span data-stu-id="36eb9-110">Fallback to Software Decoding</span></span>](#fallback-to-software-decoding)
-   [<span data-ttu-id="36eb9-111">Allocation de mémoires tampons non compressées</span><span class="sxs-lookup"><span data-stu-id="36eb9-111">Allocating Uncompressed Buffers</span></span>](#allocating-uncompressed-buffers)
-   [<span data-ttu-id="36eb9-112">Décodage</span><span class="sxs-lookup"><span data-stu-id="36eb9-112">Decoding</span></span>](#supporting-direct3d-11-video-decoding-in-media-foundation)
-   [<span data-ttu-id="36eb9-113">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="36eb9-113">Related topics</span></span>](#related-topics)

## <a name="overview"></a><span data-ttu-id="36eb9-114">Vue d’ensemble</span><span class="sxs-lookup"><span data-stu-id="36eb9-114">Overview</span></span>

<span data-ttu-id="36eb9-115">Dans le reste de cette rubrique, les termes suivants sont utilisés :</span><span class="sxs-lookup"><span data-stu-id="36eb9-115">In the remainder of this topic, the following terms are used:</span></span>

-   <span data-ttu-id="36eb9-116">**Décodeur logiciel**.</span><span class="sxs-lookup"><span data-stu-id="36eb9-116">**Software decoder**.</span></span> <span data-ttu-id="36eb9-117">Le décodeur logiciel est la Media Foundation transformation (MFT) qui reçoit des échantillons vidéo compressés et génère des trames vidéo non compressées.</span><span class="sxs-lookup"><span data-stu-id="36eb9-117">The software decoder is the Media Foundation transform (MFT) that receives compressed video samples and outputs uncompressed video frames.</span></span>
-   <span data-ttu-id="36eb9-118">**Appareil de décodage**.</span><span class="sxs-lookup"><span data-stu-id="36eb9-118">**Decoder device**.</span></span> <span data-ttu-id="36eb9-119">L’appareil décodeur est l’accélérateur vidéo et est implémenté par le pilote Graphics.</span><span class="sxs-lookup"><span data-stu-id="36eb9-119">The decoder device is the video accelerator, and is implemented by the graphics driver.</span></span> <span data-ttu-id="36eb9-120">L’appareil décodeur effectue des opérations de décodage accélérées.</span><span class="sxs-lookup"><span data-stu-id="36eb9-120">The decoder device performs accelerated decoding operations.</span></span>
-   <span data-ttu-id="36eb9-121">**Pipeline**.</span><span class="sxs-lookup"><span data-stu-id="36eb9-121">**Pipeline**.</span></span> <span data-ttu-id="36eb9-122">Le pipeline héberge le décodeur logiciel et fournit des mémoires tampons vers et depuis le décodeur logiciel.</span><span class="sxs-lookup"><span data-stu-id="36eb9-122">The pipeline hosts the software decoder and delivers buffers to and from the software decoder.</span></span> <span data-ttu-id="36eb9-123">Selon l’application, le pipeline peut être la [session multimédia](media-session.md), le [lecteur source](source-reader.md)ou le code d’application qui appelle directement la table MFT.</span><span class="sxs-lookup"><span data-stu-id="36eb9-123">Depending on the application, the pipeline might be the [Media Session](media-session.md), the [Source Reader](source-reader.md), or application code that directly calls into the MFT.</span></span>

<span data-ttu-id="36eb9-124">Pour effectuer le décodage à l’aide de Direct3D 11, le décodeur logiciel doit avoir un pointeur vers un appareil Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="36eb9-124">To perform decoding using Direct3D 11, the software decoder must have a pointer to a Direct3D 11 device.</span></span> <span data-ttu-id="36eb9-125">L’appareil Direct3D 11 est créé en externe dans le décodeur logiciel.</span><span class="sxs-lookup"><span data-stu-id="36eb9-125">The Direct3D 11 device is created externally to the software decoder.</span></span> <span data-ttu-id="36eb9-126">Dans un scénario de [session multimédia](media-session.md) , le convertisseur vidéo crée l’appareil Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="36eb9-126">In a [Media Session](media-session.md) scenario, the video renderer creates the Direct3D 11 device.</span></span> <span data-ttu-id="36eb9-127">Dans un scénario de [lecteur source](source-reader.md) , l’application crée généralement l’appareil Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="36eb9-127">In a [Source Reader](source-reader.md) scenario, typically the application creates the Direct3D 11 device.</span></span>

<span data-ttu-id="36eb9-128">Le Gestionnaire de périphériques DXGI est utilisé pour partager le Direct3D 11 entre les composants.</span><span class="sxs-lookup"><span data-stu-id="36eb9-128">The DXGI Device Manager is used to share the Direct3D 11 between components.</span></span> <span data-ttu-id="36eb9-129">L’Gestionnaire de périphériques DXGI expose l’interface [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-129">The DXGI Device Manager exposes the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span> <span data-ttu-id="36eb9-130">Le pipeline définit le pointeur **IMFDXGIDeviceManager** sur le décodeur logiciel en envoyant le message de l' [**ensemble de messages MFT du \_ \_ \_ \_ Gestionnaire D3D**](mft-message-set-d3d-manager.md) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-130">The pipeline sets the **IMFDXGIDeviceManager** pointer on the software decoder by sending the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span>

<span data-ttu-id="36eb9-131">Le diagramme suivant montre la relation entre le décodeur logiciel, Direct3D 11 et le pipeline.</span><span class="sxs-lookup"><span data-stu-id="36eb9-131">The following diagram shows the relation between the software decoder, the Direct3D 11, and the pipeline.</span></span>

![diagramme qui montre le décodeur logiciel et le gestionnaire d’appareils DXGI.](images/d3d11video01.png)

<span data-ttu-id="36eb9-133">Voici les étapes de base qu’un décodeur logiciel doit effectuer pour prendre en charge Direct3D 11 dans Media Foundation :</span><span class="sxs-lookup"><span data-stu-id="36eb9-133">Here are the basic steps that a software decoder must perform to support Direct3D 11 in Media Foundation:</span></span>

1.  <span data-ttu-id="36eb9-134">Ouvrez un handle vers l’appareil Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="36eb9-134">Open a handle to the Direct3D 11 device.</span></span>
2.  <span data-ttu-id="36eb9-135">Rechercher une configuration de décodeur.</span><span class="sxs-lookup"><span data-stu-id="36eb9-135">Find a decoder configuration.</span></span>
3.  <span data-ttu-id="36eb9-136">Allouez des tampons non compressés.</span><span class="sxs-lookup"><span data-stu-id="36eb9-136">Allocate uncompressed buffers.</span></span>
4.  <span data-ttu-id="36eb9-137">Décodez les frames.</span><span class="sxs-lookup"><span data-stu-id="36eb9-137">Decode frames.</span></span>

<span data-ttu-id="36eb9-138">Ces étapes sont décrites plus en détail dans le reste de cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="36eb9-138">These steps are described in more detail in the remainder of this topic.</span></span>

## <a name="open-a-device-handle"></a><span data-ttu-id="36eb9-139">Ouvrir un handle d’appareil</span><span class="sxs-lookup"><span data-stu-id="36eb9-139">Open a Device Handle</span></span>

<span data-ttu-id="36eb9-140">La table MFT du décodeur utilise DXGI Device Manager pour obtenir un descripteur de l’appareil Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="36eb9-140">The decoder MFT uses the DXGI device manager to get a handle to the Direct3D 11 device.</span></span> <span data-ttu-id="36eb9-141">Pour ouvrir le descripteur de l’appareil, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="36eb9-141">To open the device handle, perform the following steps:</span></span>

1.  <span data-ttu-id="36eb9-142">La table MFT du décodeur doit exposer l’attribut [ \_ prenant en \_ \_ charge MF sa d3d11](mf-sa-d3d11-aware.md) avec la valeur **true**.</span><span class="sxs-lookup"><span data-stu-id="36eb9-142">The decoder MFT must expose the [MF\_SA\_D3D11\_AWARE](mf-sa-d3d11-aware.md) attribute with the value **TRUE**.</span></span>
2.  <span data-ttu-id="36eb9-143">Le chargeur de topologie interroge cet attribut en appelant [**IMFTransform :: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span><span class="sxs-lookup"><span data-stu-id="36eb9-143">The Topology Loader queries this attribute by calling [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span></span> <span data-ttu-id="36eb9-144">La valeur **true** indique que la table MFT prend en charge Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="36eb9-144">The value **TRUE** indicates that the MFT supports Direct3D 11.</span></span>
3.  <span data-ttu-id="36eb9-145">Le chargeur de topologie appelle [**IMFTransform ::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) avec le message de l' [**ensemble de messages MFT du \_ \_ \_ \_ Gestionnaire D3D**](mft-message-set-d3d-manager.md) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-145">The Topology Loader calls [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span> <span data-ttu-id="36eb9-146">Le paramètre *ulParam* est un pointeur [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) vers le gestionnaire de périphériques DXGI.</span><span class="sxs-lookup"><span data-stu-id="36eb9-146">The *ulParam* parameter is an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer to the DXGI device manager.</span></span> <span data-ttu-id="36eb9-147">Interrogez ce pointeur sur l’interface [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-147">Query this pointer for the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span>
4.  <span data-ttu-id="36eb9-148">Appelez [**IMFDXGIDeviceManager :: OpenDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-opendevicehandle) pour obtenir un descripteur de l’appareil Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="36eb9-148">Call [**IMFDXGIDeviceManager::OpenDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-opendevicehandle) to get a handle to the Direct3D 11 device.</span></span>
5.  <span data-ttu-id="36eb9-149">Pour obtenir un pointeur vers l’appareil Direct3D 11, appelez [**IMFDXGIDeviceManager :: GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span><span class="sxs-lookup"><span data-stu-id="36eb9-149">To get a pointer to the Direct3D 11 device, call [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span></span> <span data-ttu-id="36eb9-150">Transmettez le descripteur de l’appareil et la valeur **IID \_ ID3D11Device**.</span><span class="sxs-lookup"><span data-stu-id="36eb9-150">Pass in the device handle and the value **IID\_ID3D11Device**.</span></span> <span data-ttu-id="36eb9-151">La méthode retourne un pointeur vers l’interface [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-151">The method returns a pointer to the [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) interface.</span></span>
6.  <span data-ttu-id="36eb9-152">Pour obtenir un pointeur vers l’accélérateur vidéo, appelez à nouveau [**IMFDXGIDeviceManager :: GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-152">To get a pointer to the video accelerator, call [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice) again.</span></span> <span data-ttu-id="36eb9-153">Cette fois-ci, transmettez le descripteur de l’appareil et la valeur **IID \_ ID3D11VideoDevice**.</span><span class="sxs-lookup"><span data-stu-id="36eb9-153">This time, pass in the device handle and the value **IID\_ID3D11VideoDevice**.</span></span> <span data-ttu-id="36eb9-154">La méthode retourne un pointeur vers l’interface [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-154">The method returns a pointer to the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface.</span></span>
7.  <span data-ttu-id="36eb9-155">Appelez [**ID3D11Device :: GetImmediateContext**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-getimmediatecontext) pour accéder à un pointeur [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-155">Call [**ID3D11Device::GetImmediateContext**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-getimmediatecontext) to get an [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) pointer.</span></span>
8.  <span data-ttu-id="36eb9-156">Appelez [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) sur [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) pour accéder à un pointeur [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-156">Call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on the [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) to get an [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext) pointer.</span></span>
9.  <span data-ttu-id="36eb9-157">Il est recommandé d’utiliser la protection multithreads sur le contexte de l’appareil pour éviter des problèmes d’interblocage qui peuvent parfois se produire quand vous appelez [**ID3D11VideoContext :: GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) ou [**ID3D11VideoContext :: ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span><span class="sxs-lookup"><span data-stu-id="36eb9-157">It is recommended that you use multi-thread protection on the device context to prevent deadlock issues that can sometimes happen when you call [**ID3D11VideoContext::GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) or [**ID3D11VideoContext::ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span></span> <span data-ttu-id="36eb9-158">Pour définir la protection multithread, appelez d’abord [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) sur [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) pour accéder à un pointeur [**ID3D10Multithread**](/windows/win32/api/d3d10/nn-d3d10-id3d10multithread) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-158">To set multi-thread protection, first call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) to get an [**ID3D10Multithread**](/windows/win32/api/d3d10/nn-d3d10-id3d10multithread) pointer.</span></span> <span data-ttu-id="36eb9-159">Appelez ensuite [**ID3D10Multithread :: SetMultithreadProtected**](/windows/win32/api/d3d10/nf-d3d10-id3d10multithread-setmultithreadprotected), en passant **true** pour *bMTProtect*.</span><span class="sxs-lookup"><span data-stu-id="36eb9-159">Then call [**ID3D10Multithread::SetMultithreadProtected**](/windows/win32/api/d3d10/nf-d3d10-id3d10multithread-setmultithreadprotected), passing in **true** for *bMTProtect*.</span></span>

## <a name="find-a-decoder-configuration"></a><span data-ttu-id="36eb9-160">Rechercher une configuration de décodeur</span><span class="sxs-lookup"><span data-stu-id="36eb9-160">Find a Decoder Configuration</span></span>

<span data-ttu-id="36eb9-161">Pour effectuer le décodage, le décodeur logiciel doit trouver une configuration compatible qui est prise en charge par l’appareil décodeur, y compris un format de cible de rendu.</span><span class="sxs-lookup"><span data-stu-id="36eb9-161">To perform decoding, the software decoder must find a compatible configuration that is supported by the decoder device, including a render-target format.</span></span> <span data-ttu-id="36eb9-162">Cette étape se produit à l’intérieur de la méthode [**IMFTransform :: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) , comme suit.</span><span class="sxs-lookup"><span data-stu-id="36eb9-162">This step occurs inside the [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) method, as follows.</span></span>

1.  <span data-ttu-id="36eb9-163">Validez le type de média d’entrée.</span><span class="sxs-lookup"><span data-stu-id="36eb9-163">Validate the input media type.</span></span> <span data-ttu-id="36eb9-164">Si le type est rejeté, ignorez les étapes restantes et retournez un code d’erreur.</span><span class="sxs-lookup"><span data-stu-id="36eb9-164">If the type is rejected, skip the remaining steps and return an error code.</span></span>
2.  <span data-ttu-id="36eb9-165">Appelez [**ID3D11VideoDevice :: GetVideoDecoderProfileCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofilecount) pour connaître le nombre de profils pris en charge.</span><span class="sxs-lookup"><span data-stu-id="36eb9-165">Call [**ID3D11VideoDevice::GetVideoDecoderProfileCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofilecount) to get the number of supported profiles.</span></span>
3.  <span data-ttu-id="36eb9-166">Appelez [**ID3D11VideoDevice :: GetVideoDecoderProfile**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofile) pour énumérer les profils et récupérer les GUID de profil.</span><span class="sxs-lookup"><span data-stu-id="36eb9-166">Call [**ID3D11VideoDevice::GetVideoDecoderProfile**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofile) to enumerate the profiles and get the profile GUIDs.</span></span>
4.  <span data-ttu-id="36eb9-167">Recherchez un GUID de profil qui correspond au format vidéo et aux fonctionnalités du décodeur logiciel.</span><span class="sxs-lookup"><span data-stu-id="36eb9-167">Look for a profile GUID that matches the video format and the capabilities of the software decoder.</span></span> <span data-ttu-id="36eb9-168">Par exemple, un décodeur MPEG-2 recherche le **profil de \_ décodage d3d11 \_ \_ MPEG2 \_ MOCOMP**, le profil de **\_ décodage d3d11 MPEG2 \_ \_ \_ IDCT** et le **profil de \_ décodeur d3d11 \_ \_ MPEG2 \_ VLD**.</span><span class="sxs-lookup"><span data-stu-id="36eb9-168">For example, an MPEG-2 decoder would look for **D3D11\_DECODER\_PROFILE\_MPEG2\_MOCOMP**,**D3D11\_DECODER\_PROFILE\_MPEG2\_IDCT**, and **D3D11\_DECODER\_PROFILE\_MPEG2\_VLD**.</span></span>
5.  <span data-ttu-id="36eb9-169">Si un GUID de décodeur approprié est trouvé, vérifiez le format de sortie en appelant la méthode [**ID3D11VideoDevice :: CheckVideoDecoderFormat**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkvideodecoderformat) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-169">If a suitable decoder GUID is found, check the output format by calling the [**ID3D11VideoDevice::CheckVideoDecoderFormat**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkvideodecoderformat) method.</span></span> <span data-ttu-id="36eb9-170">Transmettez le GUID du décodeur et une valeur de **\_ format de dxgi** qui spécifie le format de la cible de rendu.</span><span class="sxs-lookup"><span data-stu-id="36eb9-170">Pass in the decoder GUID and a **DXGI\_FORMAT** value that specifies the render-target format.</span></span>
6.  <span data-ttu-id="36eb9-171">Recherchez ensuite une configuration appropriée pour le décodeur.</span><span class="sxs-lookup"><span data-stu-id="36eb9-171">Next, find a suitable configuration for the decoder.</span></span>
    1.  <span data-ttu-id="36eb9-172">Appelez [**ID3D11VideoDevice :: GetVideoDecoderConfigCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfigcount) pour connaître le nombre de configurations du décodeur.</span><span class="sxs-lookup"><span data-stu-id="36eb9-172">Call [**ID3D11VideoDevice::GetVideoDecoderConfigCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfigcount) to get the number of decoder configurations.</span></span> <span data-ttu-id="36eb9-173">Transmettez le même GUID de périphérique décodeur, ainsi qu’une structure [**\_ \_ \_ desc décodeur vidéo d3d11**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_desc) qui décrit le format de cible de rendu proposé.</span><span class="sxs-lookup"><span data-stu-id="36eb9-173">Pass in the same decoder device GUID, along with a [**D3D11\_VIDEO\_DECODER\_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_desc) structure that describes the proposed render-target format.</span></span>
    2.  <span data-ttu-id="36eb9-174">Appelez [**ID3D11VideoDevice :: GetVideoDecoderConfig**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfig) pour énumérer les configurations du décodeur.</span><span class="sxs-lookup"><span data-stu-id="36eb9-174">Call [**ID3D11VideoDevice::GetVideoDecoderConfig**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfig) to enumerate the decoder configurations.</span></span>

<span data-ttu-id="36eb9-175">Dans la méthode [**IMFTransform :: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) , retourne un format vidéo non compressé basé sur le format de cible de rendu proposé.</span><span class="sxs-lookup"><span data-stu-id="36eb9-175">In the [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) method, return an uncompressed video format based on the proposed render-target format.</span></span>

<span data-ttu-id="36eb9-176">Dans la méthode [**IMFTransform :: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) , vérifiez le type de média par rapport au format de la cible de rendu.</span><span class="sxs-lookup"><span data-stu-id="36eb9-176">In the [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) method, check the media type against the render target format.</span></span>

## <a name="fallback-to-software-decoding"></a><span data-ttu-id="36eb9-177">Revenir au décodage logiciel</span><span class="sxs-lookup"><span data-stu-id="36eb9-177">Fallback to Software Decoding</span></span>

<span data-ttu-id="36eb9-178">Il se peut que la MFT ne trouve pas de configuration.</span><span class="sxs-lookup"><span data-stu-id="36eb9-178">The MFT might be unable to find a configuration.</span></span> <span data-ttu-id="36eb9-179">Par exemple, le pilote Graphics peut ne pas prendre en charge les fonctionnalités appropriées.</span><span class="sxs-lookup"><span data-stu-id="36eb9-179">For example, the graphics driver might not support the right capabilities.</span></span> <span data-ttu-id="36eb9-180">Dans ce cas, la MFT doit revenir au décodage logiciel, comme suit.</span><span class="sxs-lookup"><span data-stu-id="36eb9-180">In that case, the MFT must fall back to software decoding, as follows.</span></span>

1.  <span data-ttu-id="36eb9-181">Les méthodes [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) et [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) doivent retourner un **\_ \_ \_ \_ type D3D non pris en charge MF E**.</span><span class="sxs-lookup"><span data-stu-id="36eb9-181">The [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) and [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) methods should both return **MF\_E\_UNSUPPORTED\_D3D\_TYPE**.</span></span>
2.  <span data-ttu-id="36eb9-182">En réponse, le chargeur de topologie envoie le message de [**l' \_ ensemble de messages MFT du \_ \_ \_ Gestionnaire D3D**](mft-message-set-d3d-manager.md) avec la valeur **null** pour le paramètre *ulParam* .</span><span class="sxs-lookup"><span data-stu-id="36eb9-182">In response, the Topology Loader will send the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message with the value **NULL** for the *ulParam* parameter.</span></span>
3.  <span data-ttu-id="36eb9-183">La table MFT libère son pointeur vers l’interface [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-183">The MFT releases its pointer to the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span>
4.  <span data-ttu-id="36eb9-184">Le chargeur de topologie renégocie le type de média.</span><span class="sxs-lookup"><span data-stu-id="36eb9-184">The Topology Loader renegotiates the media type.</span></span>

<span data-ttu-id="36eb9-185">À ce stade, la table MFT peut utiliser le décodage logiciel.</span><span class="sxs-lookup"><span data-stu-id="36eb9-185">At this point, the MFT can use software decoding.</span></span>

## <a name="allocating-uncompressed-buffers"></a><span data-ttu-id="36eb9-186">Allocation de mémoires tampons non compressées</span><span class="sxs-lookup"><span data-stu-id="36eb9-186">Allocating Uncompressed Buffers</span></span>

<span data-ttu-id="36eb9-187">Le décodeur est chargé d’allouer les textures Direct3D 11 à utiliser comme tampons vidéo non compressés.</span><span class="sxs-lookup"><span data-stu-id="36eb9-187">The decoder is responsible for allocating Direct3D 11 textures to use as uncompressed video buffers.</span></span> <span data-ttu-id="36eb9-188">L’attribut de [ \_ \_ nombre minimal d' \_ \_ échantillons \_ de sortie MF sa](mf-sa-minimum-output-sample-count.md) dans les attributs de flux de sortie (voir [**IMFTransform :: GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes)) est utilisé pour déterminer le nombre de surfaces que le décodeur doit allouer pour le convertisseur vidéo à utiliser pour l’entrelacement.</span><span class="sxs-lookup"><span data-stu-id="36eb9-188">The [MF\_SA\_MINIMUM\_OUTPUT\_SAMPLE\_COUNT](mf-sa-minimum-output-sample-count.md) attribute in the output stream attributes (see [**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes)) is used to determine how many surfaces the decoder should allocate for the video renderer to use for deinterlacing .</span></span> <span data-ttu-id="36eb9-189">Un décodeur doit utiliser cette valeur pour la limiter à des limites supérieures et inférieures raisonnables, par exemple 3-32.</span><span class="sxs-lookup"><span data-stu-id="36eb9-189">A decoder should use this value bounding it for some reasonable upper and lower limits, for example 3-32.</span></span> <span data-ttu-id="36eb9-190">Pour obtenir du contenu progressif, consultez [MF \_ sa \_ minimum \_ Output \_ Sample \_ Count \_ progressif](mf-sa-minimum-output-sample-count-progressive.md).</span><span class="sxs-lookup"><span data-stu-id="36eb9-190">For progressive content see [MF\_SA\_MINIMUM\_OUTPUT\_SAMPLE\_COUNT\_PROGRESSIVE](mf-sa-minimum-output-sample-count-progressive.md).</span></span>

<span data-ttu-id="36eb9-191">Dans la méthode [**IMFTransform :: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) , définissez le **flux de sortie MFT fournit l’indicateur \_ \_ \_ \_ Samples** dans la structure d' [**informations du \_ \_ flux \_ de sortie MFT**](/windows/win32/api/mftransform/ne-mftransform-_mft_output_stream_info_flags) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-191">In the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method, set the **MFT\_OUTPUT\_STREAM\_PROVIDES\_SAMPLES** flag in the [**MFT\_OUTPUT\_STREAM\_INFO**](/windows/win32/api/mftransform/ne-mftransform-_mft_output_stream_info_flags) structure.</span></span> <span data-ttu-id="36eb9-192">Cet indicateur signale à la session multimédia que la table MFT alloue ses propres exemples de sortie.</span><span class="sxs-lookup"><span data-stu-id="36eb9-192">This flag notifies the Media Session that the MFT allocates its own output samples.</span></span> <span data-ttu-id="36eb9-193">Pour allouer les exemples de sortie, la table MFT effectue les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="36eb9-193">To allocate the output samples, the MFT performs the following steps:</span></span>

1.  <span data-ttu-id="36eb9-194">Créez un tableau de texture 2D en appelant [**ID3D11Device :: CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d).</span><span class="sxs-lookup"><span data-stu-id="36eb9-194">Create a 2D texture array by calling [**ID3D11Device::CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d).</span></span> <span data-ttu-id="36eb9-195">Dans la structure [**d3d11 \_ TEXTURE2D \_ desc**](/windows/win32/api/d3d11/ns-d3d11-d3d11_texture2d_desc) , définissez **arraySize** égal au nombre de surfaces dont le décodeur a besoin.</span><span class="sxs-lookup"><span data-stu-id="36eb9-195">In the [**D3D11\_TEXTURE2D\_DESC**](/windows/win32/api/d3d11/ns-d3d11-d3d11_texture2d_desc) structure, set **ArraySize** equal to the number of surfaces that the decoder needs.</span></span> <span data-ttu-id="36eb9-196">notamment :</span><span class="sxs-lookup"><span data-stu-id="36eb9-196">This includes:</span></span>
    -   <span data-ttu-id="36eb9-197">Surfaces pour les frames de référence.</span><span class="sxs-lookup"><span data-stu-id="36eb9-197">Surfaces for reference frames.</span></span>
    -   <span data-ttu-id="36eb9-198">Surfaces pour l’entrelacement (trois surfaces).</span><span class="sxs-lookup"><span data-stu-id="36eb9-198">Surfaces for deinterlacing (three surfaces).</span></span>
    -   <span data-ttu-id="36eb9-199">Surfaces dont le décodeur a besoin pour la mise en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="36eb9-199">Surfaces that the decoder needs for buffering.</span></span>

    <span data-ttu-id="36eb9-200">Les indicateurs de liaison (**BindFlags**) doivent inclure l’indicateur de **\_ \_ décodeur de liaison d3d11** et tous les indicateurs de liaison définis par le biais de l’attribut [ \_ \_ \_ BindFlags MF d3d11](mf-sa-d3d11-bindflags.md) dans les attributs de flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="36eb9-200">The binding flags (**BindFlags**) should include the **D3D11\_BIND\_DECODER** flag and any bind flags set through the [MF\_SA\_D3D11\_BINDFLAGS](mf-sa-d3d11-bindflags.md) attribute in the output stream attributes.</span></span>
2.  <span data-ttu-id="36eb9-201">Pour chaque surface dans le tableau de texture, appelez [**ID3D11VideoDevice :: CreateVideoDecoderOutputView**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview) pour créer une vue de sortie du décodeur vidéo.</span><span class="sxs-lookup"><span data-stu-id="36eb9-201">For each surface in the texture array, call [**ID3D11VideoDevice::CreateVideoDecoderOutputView**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview) to create a video decoder output view.</span></span> <span data-ttu-id="36eb9-202">Pendant le décodage, ces affichages de sortie sont transmis à la méthode [**ID3D11VideoContext ::D ecoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-202">During decoding, these output views will be passed to the [**ID3D11VideoContext::DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) method.</span></span>
3.  <span data-ttu-id="36eb9-203">Pour chaque surface dans le tableau de textures, créez un exemple de support comme suit :</span><span class="sxs-lookup"><span data-stu-id="36eb9-203">For each surface in the texture array, create a media sample as follows:</span></span>
    1.  <span data-ttu-id="36eb9-204">Créez une mémoire tampon de média DXGI en appelant la fonction [**MFCreateDXGISurfaceBuffer**](/windows/desktop/api/mfapi/nf-mfapi-mfcreatedxgisurfacebuffer) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-204">Create a DXGI media buffer by calling the [**MFCreateDXGISurfaceBuffer**](/windows/desktop/api/mfapi/nf-mfapi-mfcreatedxgisurfacebuffer) function.</span></span> <span data-ttu-id="36eb9-205">Transmettez le pointeur [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) et le décalage pour chaque élément dans le tableau de texture.</span><span class="sxs-lookup"><span data-stu-id="36eb9-205">Pass in the [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) pointer and the offset for each element in the texture array.</span></span> <span data-ttu-id="36eb9-206">La fonction retourne un pointeur [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-206">The function returns an [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) pointer.</span></span>
    2.  <span data-ttu-id="36eb9-207">Créez un exemple de support vide en appelant la fonction [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-207">Create an empty media sample by calling the [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) function.</span></span> <span data-ttu-id="36eb9-208">Affectez la valeur **null** au paramètre *pUnkSurface* .</span><span class="sxs-lookup"><span data-stu-id="36eb9-208">Set the *pUnkSurface* parameter equal to **NULL**.</span></span> <span data-ttu-id="36eb9-209">La fonction retourne un pointeur [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-209">The function returns an [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) pointer.</span></span>
    3.  <span data-ttu-id="36eb9-210">Appelez [**IMFSample :: AddBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-addbuffer) pour ajouter la mémoire tampon du média à l’exemple.</span><span class="sxs-lookup"><span data-stu-id="36eb9-210">Call [**IMFSample::AddBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-addbuffer) to add the media buffer to the sample.</span></span>

<span data-ttu-id="36eb9-211">Vous devez détruire toutes les textures que vous créez en même temps, au lieu de détruire uniquement certains et de continuer à utiliser le rappel.</span><span class="sxs-lookup"><span data-stu-id="36eb9-211">You should destroy all the textures you create at the same time, rather then destroying only some and continuing to use the reminder.</span></span>

## <a name="decoding"></a><span data-ttu-id="36eb9-212">Décodage</span><span class="sxs-lookup"><span data-stu-id="36eb9-212">Decoding</span></span>

<span data-ttu-id="36eb9-213">Pour créer l’appareil de décodage, appelez [**ID3D11VideoDevice :: CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoder).</span><span class="sxs-lookup"><span data-stu-id="36eb9-213">To create the decoder device, call [**ID3D11VideoDevice::CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoder).</span></span> <span data-ttu-id="36eb9-214">La méthode retourne un pointeur vers l’interface [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-214">The method returns a pointer to the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) interface.</span></span> <span data-ttu-id="36eb9-215">Le décodage doit se produire à l’intérieur de la méthode [**IMFTransform ::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-215">Decoding should occur inside the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="36eb9-216">Sur chaque frame, appelez [**IMFDXGIDeviceManager :: TestDevice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-testdevice) pour tester la disponibilité du DXGI.</span><span class="sxs-lookup"><span data-stu-id="36eb9-216">On each frame, call [**IMFDXGIDeviceManager::TestDevice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-testdevice) to test the availability of the DXGI.</span></span> <span data-ttu-id="36eb9-217">Si l’appareil a changé, le décodeur logiciel doit recréer le périphérique décodeur, comme suit :</span><span class="sxs-lookup"><span data-stu-id="36eb9-217">If the device has changed, the software decoder must recreate the decoder device, as follows:</span></span>

1.  <span data-ttu-id="36eb9-218">Fermez le handle d’appareil en appelant [**IMFDXGIDeviceManager :: CloseDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-closedevicehandle).</span><span class="sxs-lookup"><span data-stu-id="36eb9-218">Close the device handle by calling [**IMFDXGIDeviceManager::CloseDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-closedevicehandle).</span></span>
2.  <span data-ttu-id="36eb9-219">Libérer toutes les ressources associées à l’appareil Direct3D 11 précédent, y compris les interfaces [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder), [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext), [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d)et [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-219">Release all resources associated with the previous Direct3D 11 device, including the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder), [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext), [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d), and [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) interfaces.</span></span>
3.  <span data-ttu-id="36eb9-220">Ouvrez un nouveau descripteur d’appareil.</span><span class="sxs-lookup"><span data-stu-id="36eb9-220">Open a new device handle.</span></span>
4.  <span data-ttu-id="36eb9-221">Négociez une nouvelle configuration de décodeur, comme décrit précédemment dans [Rechercher une configuration de décodeur](#find-a-decoder-configuration).</span><span class="sxs-lookup"><span data-stu-id="36eb9-221">Negotiate a new decoder configuration, as described previously in [Find a Decoder Configuration](#find-a-decoder-configuration).</span></span> <span data-ttu-id="36eb9-222">Cette étape est nécessaire, car les fonctionnalités de l’appareil peuvent avoir changé.</span><span class="sxs-lookup"><span data-stu-id="36eb9-222">This step is necessary because the device capabilities might have changed.</span></span>
5.  <span data-ttu-id="36eb9-223">Créez un appareil de décodage.</span><span class="sxs-lookup"><span data-stu-id="36eb9-223">Create a new decoder device.</span></span>

<span data-ttu-id="36eb9-224">En supposant que le descripteur de l’appareil est valide, le processus de décodage fonctionne comme suit :</span><span class="sxs-lookup"><span data-stu-id="36eb9-224">Assuming that the device handle is valid, the decoding process works as follows:</span></span>

1.  <span data-ttu-id="36eb9-225">Obtient une surface disponible qui n’est pas en cours d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="36eb9-225">Get an available surface that is not currently in use.</span></span> <span data-ttu-id="36eb9-226">Initialement, toutes les surfaces sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="36eb9-226">Initially, all of the surfaces are available.</span></span>
2.  <span data-ttu-id="36eb9-227">Interrogez l’exemple de support pour l’interface [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-227">Query the media sample for the [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) interface.</span></span>
3.  <span data-ttu-id="36eb9-228">Appelez [**IMFTrackedSample :: SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) et fournissez un pointeur vers l’interface [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) .</span><span class="sxs-lookup"><span data-stu-id="36eb9-228">Call [**IMFTrackedSample::SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) and provide a pointer to the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span> <span data-ttu-id="36eb9-229">(Le décodeur logiciel doit implémenter cette interface.) Quand le convertisseur vidéo libère l’exemple, le rappel est appelé.</span><span class="sxs-lookup"><span data-stu-id="36eb9-229">(The software decoder must implement this interface.) When the video renderer releases the sample, the callback will be invoked.</span></span> <span data-ttu-id="36eb9-230">Utilisez ce rappel pour suivre les exemples actuellement disponibles et ceux qui sont en cours d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="36eb9-230">Use this callback to keep track of which samples are currently available and which are in use.</span></span>
4.  <span data-ttu-id="36eb9-231">Appelez [**ID3D11VideoContext ::D ecoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe).</span><span class="sxs-lookup"><span data-stu-id="36eb9-231">Call [**ID3D11VideoContext::DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe).</span></span> <span data-ttu-id="36eb9-232">Transmettez les pointeurs vers l’interface [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) pour l’appareil de décodage et l’interface [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) pour la vue de sortie.</span><span class="sxs-lookup"><span data-stu-id="36eb9-232">Pass in the pointers to the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) interface for the decoder device and the [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) interface for the output view.</span></span>
5.  <span data-ttu-id="36eb9-233">Effectuez les opérations suivantes une ou plusieurs fois :</span><span class="sxs-lookup"><span data-stu-id="36eb9-233">Do the following one or more times:</span></span>
    1.  <span data-ttu-id="36eb9-234">Appelez [**ID3D11VideoContext :: GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) pour obtenir une mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="36eb9-234">Call [**ID3D11VideoContext::GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) to get a buffer.</span></span>
    2.  <span data-ttu-id="36eb9-235">Remplir la mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="36eb9-235">Fill the buffer.</span></span>
    3.  <span data-ttu-id="36eb9-236">Appelez [**ID3D11VideoContext :: ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span><span class="sxs-lookup"><span data-stu-id="36eb9-236">Call [**ID3D11VideoContext::ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span></span>
    4.  <span data-ttu-id="36eb9-237">Appelez [**ID3D11VideoContext :: SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers).</span><span class="sxs-lookup"><span data-stu-id="36eb9-237">Call [**ID3D11VideoContext::SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers).</span></span> <span data-ttu-id="36eb9-238">Cette méthode indique à l’appareil décodeur d’effectuer les opérations de décodage sur le frame.</span><span class="sxs-lookup"><span data-stu-id="36eb9-238">This method instructs the decoder device to perform the decoding operations on the frame.</span></span>
6.  <span data-ttu-id="36eb9-239">Appelez [**ID3D11VideoContext ::D ecoderendframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderendframe) pour signaler la fin du décodage du frame actuel.</span><span class="sxs-lookup"><span data-stu-id="36eb9-239">Call [**ID3D11VideoContext::DecoderEndFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderendframe) to signal the end of decoding for the current frame.</span></span>

<span data-ttu-id="36eb9-240">Direct3D 11 utilise les mêmes structures de données que DXVA 2,0 pour les opérations de décodage.</span><span class="sxs-lookup"><span data-stu-id="36eb9-240">Direct3D 11 uses the same data structures as DXVA 2.0 for decoding operations.</span></span> <span data-ttu-id="36eb9-241">Pour l’ensemble initial de profils DXVA (pour H. 261, H. 263 et MPEG-2), ces structures de données sont décrites dans la [spécification DXVA 1,0](/windows-hardware/drivers/display/directx-video-acceleration).</span><span class="sxs-lookup"><span data-stu-id="36eb9-241">For the original set of DXVA profiles (for H.261, H.263, and MPEG-2), these data structures are described in the [DXVA 1.0 specification](/windows-hardware/drivers/display/directx-video-acceleration).</span></span>

<span data-ttu-id="36eb9-242">Au sein de chaque paire d’appels [**DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) et [**SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers) , vous pouvez appeler [**GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) plusieurs fois, mais une seule fois pour chaque type de mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="36eb9-242">Within each pair of [**DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) and [**SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers) calls, you may call [**GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) multiple times, but only once for each type of buffer.</span></span> <span data-ttu-id="36eb9-243">Si vous utilisez le même type de mémoire tampon à deux reprises sans appeler **SubmitDecoderBuffer**, vous allez remplacer les données dans la mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="36eb9-243">If you use the same buffer type twice without calling **SubmitDecoderBuffer**, you will overwrite the data in the buffer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="36eb9-244">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="36eb9-244">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="36eb9-245">API vidéo Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="36eb9-245">Direct3D 11 Video APIs</span></span>](direct3d-11-video-apis.md)
</dt> <dt>

[<span data-ttu-id="36eb9-246">Accélération vidéo DirectX 2,0</span><span class="sxs-lookup"><span data-stu-id="36eb9-246">DirectX Video Acceleration 2.0</span></span>](directx-video-acceleration-2-0.md)
</dt> </dl>

 

 
