---
description: Cette rubrique décrit comment implémenter une source de média personnalisée dans Microsoft Media Foundation.
ms.assetid: 82db6f32-ad94-4563-b8bd-8a5072c5b221
title: Écriture d’une source de média personnalisée
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8769fa16d4dcbfd3438b66f9a9e78c34274735a5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/03/2021
ms.locfileid: "106522501"
---
# <a name="writing-a-custom-media-source"></a><span data-ttu-id="ab8e5-103">Écriture d’une source de média personnalisée</span><span class="sxs-lookup"><span data-stu-id="ab8e5-103">Writing a Custom Media Source</span></span>

<span data-ttu-id="ab8e5-104">Cette rubrique décrit comment implémenter une source de média personnalisée dans Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-104">This topic describes how to implement a custom media source in Microsoft Media Foundation.</span></span> <span data-ttu-id="ab8e5-105">Il contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab8e5-105">It contains the following sections:</span></span>

-   [<span data-ttu-id="ab8e5-106">Création du descripteur de présentation</span><span class="sxs-lookup"><span data-stu-id="ab8e5-106">Creating the Presentation Descriptor</span></span>](#creating-the-presentation-descriptor)
-   [<span data-ttu-id="ab8e5-107">Démarrage de la source du média</span><span class="sxs-lookup"><span data-stu-id="ab8e5-107">Starting the Media Source</span></span>](#starting-the-media-source)
    -   [<span data-ttu-id="ab8e5-108">Cherche</span><span class="sxs-lookup"><span data-stu-id="ab8e5-108">Seeking</span></span>](#seeking)
-   [<span data-ttu-id="ab8e5-109">Suspension de la source du média</span><span class="sxs-lookup"><span data-stu-id="ab8e5-109">Pausing the Media Source</span></span>](#pausing-the-media-source)
-   [<span data-ttu-id="ab8e5-110">Génération de données sources</span><span class="sxs-lookup"><span data-stu-id="ab8e5-110">Generating Source Data</span></span>](#generating-source-data)
    -   [<span data-ttu-id="ab8e5-111">Exemples de demandes</span><span class="sxs-lookup"><span data-stu-id="ab8e5-111">Sample Requests</span></span>](#sample-requests)
    -   [<span data-ttu-id="ab8e5-112">Allouer des exemples</span><span class="sxs-lookup"><span data-stu-id="ab8e5-112">Allocating Samples</span></span>](#allocating-samples)
    -   [<span data-ttu-id="ab8e5-113">Écarts dans le flux</span><span class="sxs-lookup"><span data-stu-id="ab8e5-113">Gaps in the Stream</span></span>](#gaps-in-the-stream)
-   [<span data-ttu-id="ab8e5-114">Arrêt de la source du média</span><span class="sxs-lookup"><span data-stu-id="ab8e5-114">Shutting Down the Media Source</span></span>](#shutting-down-the-media-source)
-   [<span data-ttu-id="ab8e5-115">Sources en direct</span><span class="sxs-lookup"><span data-stu-id="ab8e5-115">Live Sources</span></span>](#live-sources)
-   [<span data-ttu-id="ab8e5-116">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="ab8e5-116">Related topics</span></span>](#related-topics)

## <a name="creating-the-presentation-descriptor"></a><span data-ttu-id="ab8e5-117">Création du descripteur de présentation</span><span class="sxs-lookup"><span data-stu-id="ab8e5-117">Creating the Presentation Descriptor</span></span>

<span data-ttu-id="ab8e5-118">La méthode [**IMFMediaSource :: CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) retourne une copie du descripteur de présentation de la source.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-118">The [**IMFMediaSource::CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method returns a copy of the source's presentation descriptor.</span></span> <span data-ttu-id="ab8e5-119">Pour créer le descripteur de présentation, vous devez connaître le nombre de flux dans le contenu source et les formats possibles de chaque flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-119">To create the presentation descriptor, you must know the number of streams in the source content, and the possible formats of each stream.</span></span> <span data-ttu-id="ab8e5-120">Pour chaque flux, créez un descripteur de flux comme suit :</span><span class="sxs-lookup"><span data-stu-id="ab8e5-120">For each stream, create a stream descriptor as follows:</span></span>

1.  <span data-ttu-id="ab8e5-121">Créer un tableau de types de médias.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-121">Create an array of media types.</span></span> <span data-ttu-id="ab8e5-122">Chaque type de média dans le tableau représente un format possible pour le flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-122">Each media type in the array represents a possible format for the stream.</span></span> <span data-ttu-id="ab8e5-123">Pour plus d’informations sur la création de types de médias, consultez [types de médias](media-types.md).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-123">For more information about creating media types, see [Media Types](media-types.md).</span></span>
2.  <span data-ttu-id="ab8e5-124">Appelez [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) pour créer le descripteur de flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-124">Call [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) to create the stream descriptor.</span></span> <span data-ttu-id="ab8e5-125">Transmettez le tableau de types de média.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-125">Pass in the array of media types.</span></span> <span data-ttu-id="ab8e5-126">La fonction retourne un pointeur [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-126">The function returns an [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) pointer.</span></span>
3.  <span data-ttu-id="ab8e5-127">Appelez [**IMFStreamDescriptor :: GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) pour récupérer le gestionnaire de type de média du descripteur de flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-127">Call [**IMFStreamDescriptor::GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) to get the stream descriptor's media type handler.</span></span>
4.  <span data-ttu-id="ab8e5-128">Appelez [**IMFMediaTypeHandler :: SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) pour définir le format de flux par défaut.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-128">Call [**IMFMediaTypeHandler::SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) to set the default stream format.</span></span> <span data-ttu-id="ab8e5-129">Utilisez l’un des types de médias que vous avez créés à l’étape 1.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-129">Use one of the media types that you created in step 1.</span></span> <span data-ttu-id="ab8e5-130">En règle générale, vous devez utiliser le format avec la qualité la plus élevée.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-130">Generally, you should use the format with the highest quality.</span></span>
5.  <span data-ttu-id="ab8e5-131">Vous pouvez éventuellement définir des attributs sur le descripteur de flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-131">Optionally, set attributes on the stream descriptor.</span></span> <span data-ttu-id="ab8e5-132">Pour obtenir la liste des attributs qui s’appliquent aux descripteurs de flux, consultez attributs du descripteur de [flux](stream-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-132">For a list of attributes that apply to stream descriptors, see [Stream Descriptor Attributes](stream-descriptor-attributes.md).</span></span>

<span data-ttu-id="ab8e5-133">Maintenant, créez le descripteur de présentation :</span><span class="sxs-lookup"><span data-stu-id="ab8e5-133">Now create the presentation descriptor:</span></span>

1.  <span data-ttu-id="ab8e5-134">Appelez [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) et transmettez le tableau de descripteurs de flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-134">Call [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) and pass in the array of stream descriptors.</span></span> <span data-ttu-id="ab8e5-135">La fonction retourne un pointeur [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-135">The function returns an [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) pointer.</span></span>
2.  <span data-ttu-id="ab8e5-136">Choisissez la sélection de flux par défaut en appelant [**IMFPresentationDescriptor :: SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) pour sélectionner un ou plusieurs flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-136">Choose the default stream selection by calling [**IMFPresentationDescriptor::SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) to select one or more streams.</span></span> <span data-ttu-id="ab8e5-137">Au moins un flux doit être sélectionné dans la configuration par défaut.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-137">At least one stream must be selected in the default configuration.</span></span>
3.  <span data-ttu-id="ab8e5-138">Vous pouvez éventuellement définir des attributs sur le descripteur de présentation.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-138">Optionally, set attributes on the presentation descriptor.</span></span> <span data-ttu-id="ab8e5-139">Pour obtenir la liste des attributs qui s’appliquent aux descripteurs de flux, consultez attributs du descripteur de [Présentation](presentation-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-139">For a list of attributes that apply to stream descriptors, see [Presentation Descriptor Attributes](presentation-descriptor-attributes.md).</span></span>

<span data-ttu-id="ab8e5-140">Vous devez créer le descripteur de présentation une seule fois, au démarrage ou une fois que la source a analysé suffisamment les données sources pour déterminer le contenu.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-140">You should create the presentation descriptor once, either at startup or after the source has parsed enough of the source data to determine the contents.</span></span> <span data-ttu-id="ab8e5-141">La méthode [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) doit retourner une copie du descripteur de présentation.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-141">The [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method should return a copy of presentation descriptor.</span></span> <span data-ttu-id="ab8e5-142">Pour créer la copie, appelez [**IMFPresentationDescriptor :: Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-142">To create the copy, call [**IMFPresentationDescriptor::Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span></span> <span data-ttu-id="ab8e5-143">Le retour d’une copie empêche le client de modifier l’état du descripteur de présentation d’origine, tel que les attributs ou la sélection de flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-143">Returning a copy prevents the client from modifying the state of the original presentation descriptor, such as the attributes or the stream selection.</span></span> <span data-ttu-id="ab8e5-144">Toutefois, sachez que **clone** crée une copie superficielle, de sorte que le client peut potentiellement modifier les descripteurs de flux sous-jacents.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-144">However, be aware that **Clone** creates a shallow copy, so the client can potentially modify the underlying stream descriptors.</span></span>

## <a name="starting-the-media-source"></a><span data-ttu-id="ab8e5-145">Démarrage de la source du média</span><span class="sxs-lookup"><span data-stu-id="ab8e5-145">Starting the Media Source</span></span>

<span data-ttu-id="ab8e5-146">La méthode [**IMFMediaSource :: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) démarre la source du média ou cherche à une nouvelle position.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-146">The [**IMFMediaSource::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method starts the media source or seeks to a new position.</span></span> <span data-ttu-id="ab8e5-147">Un appel à **Start** provoque une *recherche* lorsque l’état précédent a été suspendu ou en cours d’exécution, et une nouvelle heure de début est spécifiée.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-147">A call to **Start** causes a *seek* when the previous state was either paused or running, and a new start time is specified.</span></span> <span data-ttu-id="ab8e5-148">Dans le cas contraire, la méthode **Start** provoque un *démarrage*.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-148">Otherwise, the **Start** method causes a *start*.</span></span> <span data-ttu-id="ab8e5-149">Une fois l’opération de **démarrage** terminée, envoyez les événements suivants.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-149">When the **Start** operation completes, send the following events.</span></span>

1.  <span data-ttu-id="ab8e5-150">Envoyez un événement [MENewStream](menewstream.md) pour chaque nouveau flux, autrement dit, chaque flux qui a été désélectionné précédemment et qui est maintenant sélectionné.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-150">Send an [MENewStream](menewstream.md) event for each new stream—that is, each stream that was previously deselected and is now selected.</span></span> <span data-ttu-id="ab8e5-151">Les données d’événement sont un pointeur vers le flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-151">The event data is a pointer to the stream.</span></span>
2.  <span data-ttu-id="ab8e5-152">Envoyez un événement [MEUpdatedStream](meupdatedstream.md) pour chaque flux précédemment sélectionné et est toujours sélectionné.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-152">Send an [MEUpdatedStream](meupdatedstream.md) event for each stream that was previously selected and is still selected.</span></span> <span data-ttu-id="ab8e5-153">Les données d’événement sont un pointeur vers le flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-153">The event data is a pointer to the stream.</span></span> <span data-ttu-id="ab8e5-154">(N’envoyez pas d’événement pour les flux désélectionnés.)</span><span class="sxs-lookup"><span data-stu-id="ab8e5-154">(Do not send an event for deselected streams.)</span></span>
3.  <span data-ttu-id="ab8e5-155">Si la source recherche, envoyer un événement [MESourceSeeked](mesourceseeked.md) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-155">If the source is seeking, send an [MESourceSeeked](mesourceseeked.md) event.</span></span> <span data-ttu-id="ab8e5-156">Sinon, envoyer un événement [MESourceStarted](mesourcestarted.md) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-156">Otherwise, send an [MESourceStarted](mesourcestarted.md) event.</span></span> <span data-ttu-id="ab8e5-157">Les données d’événement sont l’heure de début spécifiée dans la méthode [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-157">The event data is the start time that was specified in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method.</span></span> <span data-ttu-id="ab8e5-158">Pour l’événement MESourceStarted, si l’heure de début est VT \_ vide, définissez l’attribut de [**\_ \_ \_ \_ démarrage réel**](mf-event-source-actual-start-attribute.md) de la source de l’événement MF sur l’événement.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-158">For the MESourceStarted event, if the start time is VT\_EMPTY, set the [**MF\_EVENT\_SOURCE\_ACTUAL\_START**](mf-event-source-actual-start-attribute.md) attribute on the event.</span></span> <span data-ttu-id="ab8e5-159">La valeur de l’attribut est l’heure de début réelle.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-159">The attribute value is the actual start time.</span></span>
4.  <span data-ttu-id="ab8e5-160">Pour chaque flux, si la source recherche, envoyer un événement [MEStreamSeeked](mestreamseeked.md) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-160">For each stream, if the source is seeking, send an [MEStreamSeeked](mestreamseeked.md) event.</span></span> <span data-ttu-id="ab8e5-161">Sinon, envoyer un événement [MEStreamStarted](mestreamstarted.md) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-161">Otherwise, send an [MEStreamStarted](mestreamstarted.md) event.</span></span> <span data-ttu-id="ab8e5-162">Les données d’événement sont l’heure de début.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-162">The event data is the start time.</span></span> <span data-ttu-id="ab8e5-163">(La source du média peut faire la file d’attente d’un événement sur le flux en appelant la méthode [**IMFMediaEventGenerator :: QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) du flux.)</span><span class="sxs-lookup"><span data-stu-id="ab8e5-163">(The media source can queue an event on the stream by calling the stream's [**IMFMediaEventGenerator::QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) method.)</span></span>

<span data-ttu-id="ab8e5-164">Lorsqu’un flux est désélectionné, arrêtez le flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-164">When a stream is deselected, shut down the stream.</span></span> <span data-ttu-id="ab8e5-165">Le flux ne doit pas défiler plus d’événements à ce stade.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-165">The stream should not queue any more events at that point.</span></span>

<span data-ttu-id="ab8e5-166">Le format d’heure de la méthode [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) est indiqué dans le paramètre *pguidTimeFormat* .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-166">The time format for the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is given in the *pguidTimeFormat* parameter.</span></span> <span data-ttu-id="ab8e5-167">Le format d’heure standard, indiqué par le **GUID \_ null**, est de 100 à nanosecondes unités.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-167">The standard time format, indicated by **GUID\_NULL**, is 100-nanosecond units.</span></span> <span data-ttu-id="ab8e5-168">Une source de média doit prendre en charge ce format d’heure.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-168">A media source must support this time format.</span></span>

### <a name="seeking"></a><span data-ttu-id="ab8e5-169">Cherche</span><span class="sxs-lookup"><span data-stu-id="ab8e5-169">Seeking</span></span>

<span data-ttu-id="ab8e5-170">Lors de la recherche, la position de départ demandée peut ne pas se trouver sur une limite d’échantillon exacte.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-170">When seeking, the requested start position might not fall on an exact sample boundary.</span></span> <span data-ttu-id="ab8e5-171">En outre, pour le contenu compressé, la position de début peut se situer entre les images clés.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-171">Also, for compressed content, the start position might fall between key frames.</span></span> <span data-ttu-id="ab8e5-172">Un flux doit fournir des échantillons à partir du point le plus ancien nécessaire pour produire un exemple non compressé à la position de départ demandée.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-172">A stream should deliver samples from the earliest point needed to produce an uncompressed sample at the requested start position.</span></span> <span data-ttu-id="ab8e5-173">Pour la vidéo, cela signifie démarrer à partir de l’image clé précédente.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-173">For video, that means starting from the previous key frame.</span></span> <span data-ttu-id="ab8e5-174">Le pipeline est chargé de supprimer les frames supplémentaires du décodeur, afin que la lecture commence à l’heure demandée.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-174">The pipeline is responsible for dropping the extra frames from the decoder, so that playback starts at the requested time.</span></span>

<span data-ttu-id="ab8e5-175">L’heure de début indiquée dans les événements source ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md)et [MEStreamSeeked](mestreamseeked.md)) est l’heure de début demandée (la valeur donnée dans la méthode [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) ), quelle que soit la position de début réelle.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-175">The starting time given in the source events ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md), and [MEStreamSeeked](mestreamseeked.md)) is the requested starting time (the value given in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method), regardless of the actual start position.</span></span>

<span data-ttu-id="ab8e5-176">Par exemple, supposons que les premières images d’un flux vidéo présentent les caractéristiques suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab8e5-176">For example, suppose the first few frames of a video stream have the following characteristics:</span></span>



| <span data-ttu-id="ab8e5-177">Exemple</span><span class="sxs-lookup"><span data-stu-id="ab8e5-177">Sample</span></span>     | <span data-ttu-id="ab8e5-178">1</span><span class="sxs-lookup"><span data-stu-id="ab8e5-178">1</span></span>       | <span data-ttu-id="ab8e5-179">2</span><span class="sxs-lookup"><span data-stu-id="ab8e5-179">2</span></span>       | <span data-ttu-id="ab8e5-180">3</span><span class="sxs-lookup"><span data-stu-id="ab8e5-180">3</span></span>        | <span data-ttu-id="ab8e5-181">4</span><span class="sxs-lookup"><span data-stu-id="ab8e5-181">4</span></span>        |
|------------|---------|---------|----------|----------|
| <span data-ttu-id="ab8e5-182">Temps</span><span class="sxs-lookup"><span data-stu-id="ab8e5-182">Time</span></span>       | <span data-ttu-id="ab8e5-183">33 ms</span><span class="sxs-lookup"><span data-stu-id="ab8e5-183">33 msec</span></span> | <span data-ttu-id="ab8e5-184">66 ms</span><span class="sxs-lookup"><span data-stu-id="ab8e5-184">66 msec</span></span> | <span data-ttu-id="ab8e5-185">100 ms</span><span class="sxs-lookup"><span data-stu-id="ab8e5-185">100 msec</span></span> | <span data-ttu-id="ab8e5-186">133 ms</span><span class="sxs-lookup"><span data-stu-id="ab8e5-186">133 msec</span></span> |
| <span data-ttu-id="ab8e5-187">Image clé ?</span><span class="sxs-lookup"><span data-stu-id="ab8e5-187">Key frame?</span></span> | <span data-ttu-id="ab8e5-188">Oui</span><span class="sxs-lookup"><span data-stu-id="ab8e5-188">Yes</span></span>     | <span data-ttu-id="ab8e5-189">Non</span><span class="sxs-lookup"><span data-stu-id="ab8e5-189">No</span></span>      | <span data-ttu-id="ab8e5-190">Non</span><span class="sxs-lookup"><span data-stu-id="ab8e5-190">No</span></span>       | <span data-ttu-id="ab8e5-191">Oui</span><span class="sxs-lookup"><span data-stu-id="ab8e5-191">Yes</span></span>      |



 

<span data-ttu-id="ab8e5-192">Si la méthode [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) est appelée avec une valeur de 100 millisecondes, la source doit générer une vidéo à partir de l’image 1, la première image clé avant cette heure.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-192">If the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is called with a value of 100 milliseconds, the source needs to output video starting from frame 1, the first key frame prior to this time.</span></span> <span data-ttu-id="ab8e5-193">L’événement de début indiquera toujours 100 millisecondes dans les données d’événement.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-193">The start event will still indicate 100 milliseconds in the event data.</span></span>

## <a name="pausing-the-media-source"></a><span data-ttu-id="ab8e5-194">Suspension de la source du média</span><span class="sxs-lookup"><span data-stu-id="ab8e5-194">Pausing the Media Source</span></span>

<span data-ttu-id="ab8e5-195">La méthode [**IMFMediaSource ::P ause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) interrompt la source du média.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-195">The [**IMFMediaSource::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) method pauses the media source.</span></span>

<span data-ttu-id="ab8e5-196">Lorsque la source est suspendue, un flux peut créer de nouveaux exemples et les stocker dans une file d’attente, mais le flux ne remet pas les exemples.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-196">While the source is paused, a stream can create new samples and store them on a queue, but the stream does not deliver the samples.</span></span> <span data-ttu-id="ab8e5-197">Voici quelques exceptions à cette règle :</span><span class="sxs-lookup"><span data-stu-id="ab8e5-197">Here are some exceptions to this rule:</span></span>

-   <span data-ttu-id="ab8e5-198">Les sources dynamiques doivent supprimer les données pendant la suspension.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-198">Live sources should drop data while paused.</span></span>
-   <span data-ttu-id="ab8e5-199">Si la source obtient des données à partir d’un réseau, elle peut suspendre le serveur.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-199">If the source gets data from a network, it might pause the server.</span></span>

<span data-ttu-id="ab8e5-200">Si le client appelle [**IMFMediaStream :: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) alors que la source est suspendue, la demande est également mise en file d’attente jusqu’à ce que la source soit de nouveau redémarrée.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-200">If the client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) while the source is paused, the request is also queued until the source is started again.</span></span> <span data-ttu-id="ab8e5-201">Les requêtes ne doivent pas être supprimées.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-201">Requests should not be dropped.</span></span>

<span data-ttu-id="ab8e5-202">La suspension est autorisée uniquement à partir de l’état Démarré.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-202">Pausing is allowed only from the started state.</span></span> <span data-ttu-id="ab8e5-203">Sinon, la [**suspension**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) doit retourner **MF E une \_ \_ \_ \_ transition d’État non valide**.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-203">Otherwise, [**Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) should return **MF\_E\_INVALID\_STATE\_TRANSITION**.</span></span>

## <a name="generating-source-data"></a><span data-ttu-id="ab8e5-204">Génération de données sources</span><span class="sxs-lookup"><span data-stu-id="ab8e5-204">Generating Source Data</span></span>

<span data-ttu-id="ab8e5-205">Media Foundation utilise un *modèle d’extraction*, ce qui signifie que les flux génèrent et fournissent des exemples en réponse aux demandes du pipeline.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-205">Media Foundation uses a *pull model*, meaning that streams generate and deliver samples in response to requests from the pipeline.</span></span> <span data-ttu-id="ab8e5-206">Un flux peut fournir des exemples lorsque la source du média est en cours d’exécution et que le flux est sélectionné.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-206">A stream can deliver samples when the media source is running and the stream is selected.</span></span> <span data-ttu-id="ab8e5-207">Un flux fournit des données uniquement lorsque le client demande un nouvel exemple.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-207">A stream delivers data only when the client requests a new sample.</span></span>

### <a name="sample-requests"></a><span data-ttu-id="ab8e5-208">Exemple de demande</span><span class="sxs-lookup"><span data-stu-id="ab8e5-208">Sample Requests</span></span>

<span data-ttu-id="ab8e5-209">Le client demande un nouvel exemple en appelant [**IMFMediaStream :: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-209">The client requests a new sample by calling [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="ab8e5-210">Voici la séquence des opérations :</span><span class="sxs-lookup"><span data-stu-id="ab8e5-210">Here is the sequence of operations:</span></span>

1.  <span data-ttu-id="ab8e5-211">Le client appelle [**IMFMediaStream :: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-211">The client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="ab8e5-212">L’argument est un pointeur vers un objet de *jeton* facultatif que le client utilise pour effectuer le suivi de la requête.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-212">The argument is a pointer to an optional *token* object that the client uses to track the request.</span></span> <span data-ttu-id="ab8e5-213">Le client implémente le jeton.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-213">The client implements the token.</span></span> <span data-ttu-id="ab8e5-214">Les jetons doivent exposer l’interface **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-214">Tokens must expose the **IUnknown** interface.</span></span> <span data-ttu-id="ab8e5-215">Le client peut également passer un pointeur NULL au lieu d’un jeton.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-215">The client can also pass in a NULL pointer instead of a token.</span></span>
2.  <span data-ttu-id="ab8e5-216">Si le client a fourni un jeton, le flux multimédia appelle **AddRef** sur le jeton et le place dans une file d’attente premier entré, premier sorti.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-216">If the client provided a token, the media stream calls **AddRef** on the token and places the token in a first-in, first-out queue.</span></span> <span data-ttu-id="ab8e5-217">La méthode retourne, et les étapes restantes se produisent de manière asynchrone.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-217">The method returns, and the remaining steps occur asynchronously.</span></span>

3.  <span data-ttu-id="ab8e5-218">Quand davantage de données sont disponibles, le flux de média crée un nouvel exemple.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-218">When more data is available, the media stream creates a new sample.</span></span> <span data-ttu-id="ab8e5-219">(Cette étape est décrite plus en détail dans la section suivante.)</span><span class="sxs-lookup"><span data-stu-id="ab8e5-219">(This step is described in more detail in the next section.)</span></span>
4.  <span data-ttu-id="ab8e5-220">Le flux multimédia extrait le premier jeton de la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-220">The media stream pulls the first token from the queue.</span></span>
5.  <span data-ttu-id="ab8e5-221">Si le jeton n’est pas **null**, le flux de média définit l’attribut de [**\_ jeton MFSampleExtension**](mfsampleextension-token-attribute.md) sur l’exemple de support.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-221">If the token is not **NULL**, the media stream sets the [**MFSampleExtension\_Token**](mfsampleextension-token-attribute.md) attribute on the media sample.</span></span> <span data-ttu-id="ab8e5-222">La valeur de l’attribut est un pointeur vers le jeton.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-222">The value of the attribute is a pointer to the token.</span></span>
6.  <span data-ttu-id="ab8e5-223">Le flux de média envoie un événement [MEMediaSample](memediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-223">The media stream sends an [MEMediaSample](memediasample.md) event.</span></span> <span data-ttu-id="ab8e5-224">Les données d’événement sont un pointeur vers l’interface [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) de l’exemple.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-224">The event data is a pointer to the sample's [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) interface.</span></span>
7.  <span data-ttu-id="ab8e5-225">Si le client a fourni un jeton, le flux multimédia appelle la **version finale** sur l’objet de jeton.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-225">If the client provided a token, the media stream calls **Release** on the token object.</span></span>

<span data-ttu-id="ab8e5-226">Si le flux de média ne peut pas satisfaire la requête [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) du client, il extrait le jeton de la file d’attente et appelle la **libération** sur le jeton, mais n’envoie pas d’événement [MEMediaSample](memediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-226">If the media stream cannot fulfill the client's [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) request, it pulls the token from the queue and calls **Release** on the token, but does not send an [MEMediaSample](memediasample.md) event.</span></span>

<span data-ttu-id="ab8e5-227">Le client peut utiliser le jeton pour suivre l’état de la demande.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-227">The client can use the token to track the status of the request.</span></span> <span data-ttu-id="ab8e5-228">Lorsque le client reçoit l’événement [MEMediaSample](memediasample.md) , il peut obtenir le jeton de l’exemple et le mettre en correspondance avec la requête d’origine.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-228">When the client receives the [MEMediaSample](memediasample.md) event, it can get the token from the sample and match it against the original request.</span></span> <span data-ttu-id="ab8e5-229">Le client peut également utiliser le jeton pour déterminer si la source du média a supprimé la demande.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-229">The client can also use the token to detect if the media source dropped the request.</span></span> <span data-ttu-id="ab8e5-230">Si le nombre de références du jeton est égal à zéro et que le flux de média n’envoie pas d’événement MEMediaSample, cela signifie que la requête a été supprimée.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-230">If the token's reference count falls to zero and the media stream does not send an MEMediaSample event, it means that the request was dropped.</span></span>

<span data-ttu-id="ab8e5-231">Les étapes répertoriées ici supposent que la méthode [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) est implémentée en tant qu’opération asynchrone.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-231">The steps listed here assume that [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method is implemented as an asynchronous operation.</span></span> <span data-ttu-id="ab8e5-232">Si la méthode est synchrone, vous n’avez pas besoin de placer le jeton de requête dans une file d’attente.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-232">If the method is synchronous, you do not need to put the request token on a queue.</span></span> <span data-ttu-id="ab8e5-233">Toutefois, si la génération de données prend beaucoup de temps, une approche asynchrone est recommandée, par exemple, si la source lit les données à partir d’un flux d’octets.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-233">However, if generating data takes any significant amount of time, an asynchronous approach is recommended—for example, if the source reads data from a byte stream.</span></span>

<span data-ttu-id="ab8e5-234">Le flux est responsable de la mise en mémoire tampon des données qui s’accumulent entre les appels à [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-234">The stream is responsible for buffering any data that accumulates between calls to [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span>

<span data-ttu-id="ab8e5-235">Lorsque le flux multimédia atteint la fin du flux, il envoie un événement [MEEndOfStream](meendofstream.md) après le dernier échantillon.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-235">When the media stream reaches the end of the stream, it sends an [MEEndOfStream](meendofstream.md) event after the last sample.</span></span> <span data-ttu-id="ab8e5-236">Une fois que chaque flux est terminé, la source du média envoie un événement [MEEndOfPresentation](meendofpresentation.md) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-236">After every stream has ended, the media source sends an [MEEndOfPresentation](meendofpresentation.md) event.</span></span> <span data-ttu-id="ab8e5-237">Une fois qu’un flux de données multimédia envoie l’événement MEEndOfStream, la méthode [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) retourne **MF \_ E \_ End \_ du \_ flux** jusqu’à ce que la source soit redémarrée.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-237">After a media stream sends the MEEndOfStream event, the [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method returns **MF\_E\_END\_OF\_STREAM** until the source is restarted.</span></span>

### <a name="allocating-samples"></a><span data-ttu-id="ab8e5-238">Allouer des exemples</span><span class="sxs-lookup"><span data-stu-id="ab8e5-238">Allocating Samples</span></span>

<span data-ttu-id="ab8e5-239">Lorsque le flux est prêt à remplir un exemple de demande en attente, il crée un nouvel exemple et ajoute une ou plusieurs mémoires tampons de média à l’exemple.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-239">When the stream is ready to fill a pending sample request, it creates a new sample and adds one or more media buffers to the sample.</span></span> <span data-ttu-id="ab8e5-240">Pour plus d’informations sur la création de mémoires tampons de média, consultez [mémoires tampons de média](media-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-240">For more information about creating media buffers, see [Media Buffers](media-buffers.md).</span></span>

<span data-ttu-id="ab8e5-241">Le flux doit définir l’horodatage et la durée, s’ils sont connus.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-241">The stream must set the time stamp and the duration, if known.</span></span> <span data-ttu-id="ab8e5-242">L’horodatage est relatif à la source.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-242">The time stamp is relative to the source.</span></span> <span data-ttu-id="ab8e5-243">Dans la plupart des cas, le début du contenu correspond à un horodatage de zéro.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-243">In most cases, the start of the content corresponds to a time stamp of zero.</span></span> <span data-ttu-id="ab8e5-244">Par exemple, si la source lit à partir d’un fichier multimédia, le début du fichier aurait un horodatage égal à zéro.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-244">For example, if the source reads from a media file, the start of the file would have a time stamp of zero.</span></span>

<span data-ttu-id="ab8e5-245">L’horodatage de l’échantillon n’est pas nécessairement égal à l’heure de la présentation.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-245">The time stamp on the sample does not necessarily equal the presentation time.</span></span> <span data-ttu-id="ab8e5-246">La session multimédia se traduit de l’heure de la source à l’heure de la présentation.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-246">The Media Session translates from source time to presentation time.</span></span> <span data-ttu-id="ab8e5-247">Pour les données compressées, le flux doit générer les données à partir de l’image clé la plus proche avant l’heure de début.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-247">For compressed data, the stream should generate data starting from the nearest key frame before the start time.</span></span> <span data-ttu-id="ab8e5-248">Cela permet au décodeur de remettre le frame qui apparaît à l’heure de début demandée.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-248">This enables the decoder to deliver the frame that appears at the requested start time.</span></span> <span data-ttu-id="ab8e5-249">(Sinon, le décodeur doit attendre l’image clé suivante.)</span><span class="sxs-lookup"><span data-stu-id="ab8e5-249">(Otherwise, the decoder would need to wait until the following key frame.)</span></span>

<span data-ttu-id="ab8e5-250">Si la vitesse de lecture est plus rapide ou plus lente que 1,0, le pipeline ajuste la vitesse de l’horloge de la présentation.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-250">If the playback rate is faster or slower than 1.0, the pipeline adjusts the rate of the presentation clock.</span></span> <span data-ttu-id="ab8e5-251">La source n’ajuste pas les horodatages sur les échantillons.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-251">The source does not adjust the time stamps on samples.</span></span>

<span data-ttu-id="ab8e5-252">La source peut définir des informations supplémentaires sur l’exemple en définissant des attributs.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-252">The source can set additional information on the sample by setting attributes.</span></span> <span data-ttu-id="ab8e5-253">Pour obtenir la liste des exemples d’attributs, consultez [exemples d’attributs](sample-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-253">For a list of sample attributes, see [Sample Attributes](sample-attributes.md).</span></span>

### <a name="gaps-in-the-stream"></a><span data-ttu-id="ab8e5-254">Écarts dans le flux</span><span class="sxs-lookup"><span data-stu-id="ab8e5-254">Gaps in the Stream</span></span>

<span data-ttu-id="ab8e5-255">Si un flux contient un intervalle de longueur significative, il est recommandé que le flux envoie un événement [MEStreamTick](mestreamtick.md) .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-255">If a stream contains a gap of significant length, it is recommended that the stream send an [MEStreamTick](mestreamtick.md) event.</span></span> <span data-ttu-id="ab8e5-256">Cet événement avertit le client qu’un exemple est manquant.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-256">This event notifies the client that a sample is missing.</span></span> <span data-ttu-id="ab8e5-257">Les données d’événement sont l’horodatage de l’échantillon manquant, en unités de 100 nanosecondes (**VT \_ i8**).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-257">The event data is the time stamp of the missing sample, in 100-nanosecond units (**VT\_I8**).</span></span> <span data-ttu-id="ab8e5-258">Cet événement peut enregistrer les composants en aval qui n’arrivent pas à attendre.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-258">This event can save downstream components from waiting for samples that will not arrive.</span></span> <span data-ttu-id="ab8e5-259">Le flux peut envoyer autant d’événements MEStreamTick que nécessaire pour couvrir l’intervalle dans le flux.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-259">The stream can send as many MEStreamTick events as needed to span the gap in the stream.</span></span>

## <a name="shutting-down-the-media-source"></a><span data-ttu-id="ab8e5-260">Arrêt de la source du média</span><span class="sxs-lookup"><span data-stu-id="ab8e5-260">Shutting Down the Media Source</span></span>

<span data-ttu-id="ab8e5-261">Lorsque le client a terminé à l’aide de la source du média, il appelle [**IMFMediaSource :: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span><span class="sxs-lookup"><span data-stu-id="ab8e5-261">When the client is done using the media source, it calls [**IMFMediaSource::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span></span> <span data-ttu-id="ab8e5-262">Dans cette méthode, la source du média doit rompre les nombres de références circulaires.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-262">Inside this method, the media source should break any circular reference counts.</span></span> <span data-ttu-id="ab8e5-263">En règle générale, il y aura des références circulaires entre la source du média et les flux multimédias.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-263">Typically, there will be circular references between the media source and the media streams.</span></span>

<span data-ttu-id="ab8e5-264">Si vous utilisez la file d’attente d’événements pour implémenter [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), appelez [**IMFMediaEventQueue :: Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) dans la file d’attente d’événements.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-264">If you are using the event queue to implement [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) on the event queue.</span></span> <span data-ttu-id="ab8e5-265">Cette méthode arrête la file d’attente des événements et signale à tout appelant qui attend un événement.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-265">This method shuts down the event queue and signals any caller that is currently waiting for an event.</span></span>

<span data-ttu-id="ab8e5-266">Après l’arrêt, toutes les méthodes sur la source retournent l' **\_ \_ arrêt MF E**, à l’exception des méthodes **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-266">After shutdown, all methods on the source return **MF\_E\_SHUTDOWN**, with the exception of **IUnknown** methods.</span></span>

## <a name="live-sources"></a><span data-ttu-id="ab8e5-267">Sources en direct</span><span class="sxs-lookup"><span data-stu-id="ab8e5-267">Live Sources</span></span>

<span data-ttu-id="ab8e5-268">À partir de Windows 7, Media Foundation prend en charge automatiquement les périphériques de capture audio et vidéo.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-268">Starting in Windows 7, Media Foundation automatically supports audio and video capture devices.</span></span> <span data-ttu-id="ab8e5-269">Pour la vidéo, l’appareil doit fournir un minipilote de streaming de noyau (KS) dans la catégorie capture vidéo.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-269">For video, the device must provide a kernel streaming (KS) minidriver in the video capture category.</span></span> <span data-ttu-id="ab8e5-270">Media Foundation utilise le chemin PnP pour énumérer l’appareil.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-270">Media Foundation uses the PnP path to enumerate the device.</span></span> <span data-ttu-id="ab8e5-271">Pour le son, Media Foundation utilise l’API Windows Multimedia Device (MMDevice) pour énumérer les appareils de point de terminaison audio.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-271">For audio, Media Foundation uses the Windows Multimedia Device (MMDevice) API to enumerate audio endpoint devices.</span></span> <span data-ttu-id="ab8e5-272">Si l’appareil répond à ces critères, il n’est pas nécessaire d’implémenter une source de média personnalisée.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-272">If the device meets these criteria, there is no need to implement a custom media source.</span></span>

<span data-ttu-id="ab8e5-273">Toutefois, vous souhaiterez peut-être implémenter une source de média personnalisée pour un autre type d’appareil ou une autre source de données active.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-273">However, you might want to implement a custom media source for some other type of device or other live data source.</span></span> <span data-ttu-id="ab8e5-274">Il n’existe que quelques différences entre une source en direct et d’autres sources multimédias :</span><span class="sxs-lookup"><span data-stu-id="ab8e5-274">There are only a few differences between a live source and other media sources:</span></span>

-   <span data-ttu-id="ab8e5-275">Dans la méthode [**IMFMediaSource :: GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) , retourne le **MFMEDIASOURCE \_ indicateur \_ Live** .</span><span class="sxs-lookup"><span data-stu-id="ab8e5-275">In the [**IMFMediaSource::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) method, return the **MFMEDIASOURCE\_IS\_LIVE** flag.</span></span>
-   <span data-ttu-id="ab8e5-276">Le premier exemple doit avoir un horodatage égal à zéro.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-276">The first sample should have a time stamp of zero.</span></span>
-   <span data-ttu-id="ab8e5-277">Les États des événements et de la diffusion en continu sont gérés de la même façon que les sources de média, à l’exception de l’état suspendu.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-277">Events and streaming states are handled the same as media sources, with the exception of the paused state.</span></span>
-   <span data-ttu-id="ab8e5-278">Pendant la suspension, ne pas placer les exemples en file d’attente.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-278">While paused, do not queue samples.</span></span> <span data-ttu-id="ab8e5-279">Supprimer toutes les données générées pendant la suspension.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-279">Drop any data that is generated while paused.</span></span>
-   <span data-ttu-id="ab8e5-280">En règle générale, les sources en direct ne prennent pas en charge la recherche, la lecture inversée ou le contrôle du débit.</span><span class="sxs-lookup"><span data-stu-id="ab8e5-280">Live sources typically do not support seeking, reverse play, or rate control.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ab8e5-281">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="ab8e5-281">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ab8e5-282">Sources multimédias</span><span class="sxs-lookup"><span data-stu-id="ab8e5-282">Media Sources</span></span>](media-sources.md)
</dt> <dt>

[<span data-ttu-id="ab8e5-283">Didacticiel : écriture d’une source de média personnalisée</span><span class="sxs-lookup"><span data-stu-id="ab8e5-283">Tutorial: Writing a Custom Media Source</span></span>](tutorial--writing-a-custom-media-source.md)
</dt> </dl>

 

 



