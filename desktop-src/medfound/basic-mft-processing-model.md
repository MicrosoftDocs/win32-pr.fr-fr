---
description: Cette rubrique décrit comment un client utilise une transformation de Media Foundation (MFT) pour traiter les données. Le client est tout ce qui appelle directement des méthodes sur la table MFT. Il peut s’agir de l’application ou du pipeline Media Foundation.
ms.assetid: be977d75-999e-4e57-9672-00a89246a2c1
title: Modèle de traitement MFT de base
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ca54df6d9765aaf54456c3d9dc4461a82a93d41
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104033821"
---
# <a name="basic-mft-processing-model"></a><span data-ttu-id="72ede-105">Modèle de traitement MFT de base</span><span class="sxs-lookup"><span data-stu-id="72ede-105">Basic MFT Processing Model</span></span>

<span data-ttu-id="72ede-106">Cette rubrique décrit comment un client utilise une transformation de Media Foundation (MFT) pour traiter les données.</span><span class="sxs-lookup"><span data-stu-id="72ede-106">This topic describes how a client uses a Media Foundation transform (MFT) to process data.</span></span> <span data-ttu-id="72ede-107">Le *client* est tout ce qui appelle directement des méthodes sur la table MFT.</span><span class="sxs-lookup"><span data-stu-id="72ede-107">The *client* is anything that directly calls methods on the MFT.</span></span> <span data-ttu-id="72ede-108">Il peut s’agir de l’application ou du pipeline Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="72ede-108">This might be the application or the Media Foundation pipeline.</span></span>

<span data-ttu-id="72ede-109">Lisez cette rubrique si vous êtes :</span><span class="sxs-lookup"><span data-stu-id="72ede-109">Read this topic if you are:</span></span>

-   <span data-ttu-id="72ede-110">Écriture d’une application qui effectue des appels directs à un ou plusieurs MFTs.</span><span class="sxs-lookup"><span data-stu-id="72ede-110">Writing an application that makes direct calls to one or more MFTs.</span></span>
-   <span data-ttu-id="72ede-111">Écriture d’une table MFT personnalisée et compréhension du comportement attendu d’une table MFT.</span><span class="sxs-lookup"><span data-stu-id="72ede-111">Writing a custom MFT and want to understand the expected behavior of an MFT.</span></span>

<span data-ttu-id="72ede-112">Cette rubrique décrit un modèle de traitement *synchrone* .</span><span class="sxs-lookup"><span data-stu-id="72ede-112">This topic describes a *synchronous* processing model.</span></span> <span data-ttu-id="72ede-113">Dans ce modèle, toutes les méthodes de traitement des données sont bloquées jusqu’à ce qu’elles se terminent.</span><span class="sxs-lookup"><span data-stu-id="72ede-113">In this model, all data-processing methods block until they complete.</span></span> <span data-ttu-id="72ede-114">MFTs peut également prendre en charge un modèle *asynchrone* , qui est décrit dans la rubrique [MFTS asynchrone](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="72ede-114">MFTs can also support an *asynchronous* model, which is described in the topic [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

-   [<span data-ttu-id="72ede-115">Modèle de traitement de base</span><span class="sxs-lookup"><span data-stu-id="72ede-115">Basic Processing Model</span></span>](#basic-processing-model)
    -   [<span data-ttu-id="72ede-116">Créer la table MFT</span><span class="sxs-lookup"><span data-stu-id="72ede-116">Create the MFT</span></span>](#create-the-mft)
    -   [<span data-ttu-id="72ede-117">Obtient les identificateurs de flux</span><span class="sxs-lookup"><span data-stu-id="72ede-117">Get Stream Identifiers</span></span>](#get-stream-identifiers)
    -   [<span data-ttu-id="72ede-118">Définir les types de médias</span><span class="sxs-lookup"><span data-stu-id="72ede-118">Set Media Types</span></span>](#set-media-types)
    -   [<span data-ttu-id="72ede-119">Connaître les exigences du tampon</span><span class="sxs-lookup"><span data-stu-id="72ede-119">Get Buffer Requirements</span></span>](#get-buffer-requirements)
    -   [<span data-ttu-id="72ede-120">Traiter des données</span><span class="sxs-lookup"><span data-stu-id="72ede-120">Process Data</span></span>](#process-data)
-   [<span data-ttu-id="72ede-121">Extensions du modèle de base</span><span class="sxs-lookup"><span data-stu-id="72ede-121">Extensions to the Basic Model</span></span>](#extensions-to-the-basic-model)
-   [<span data-ttu-id="72ede-122">IMF2DBuffer</span><span class="sxs-lookup"><span data-stu-id="72ede-122">IMF2DBuffer</span></span>](#imf2dbuffer)
-   [<span data-ttu-id="72ede-123">Vidage d’une table MFT</span><span class="sxs-lookup"><span data-stu-id="72ede-123">Flushing an MFT</span></span>](#flushing-an-mft)
-   [<span data-ttu-id="72ede-124">Vidage d’une table MFT</span><span class="sxs-lookup"><span data-stu-id="72ede-124">Draining an MFT</span></span>](#draining-an-mft)
-   [<span data-ttu-id="72ede-125">Exemples d’attributs</span><span class="sxs-lookup"><span data-stu-id="72ede-125">Sample Attributes</span></span>](#sample-attributes)
-   [<span data-ttu-id="72ede-126">Discontinuités</span><span class="sxs-lookup"><span data-stu-id="72ede-126">Discontinuities</span></span>](#discontinuities)
-   [<span data-ttu-id="72ede-127">Modifications de format dynamique</span><span class="sxs-lookup"><span data-stu-id="72ede-127">Dynamic Format Changes</span></span>](#dynamic-format-changes)
-   [<span data-ttu-id="72ede-128">Événements de flux</span><span class="sxs-lookup"><span data-stu-id="72ede-128">Stream Events</span></span>](#stream-events)
-   [<span data-ttu-id="72ede-129">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="72ede-129">Related topics</span></span>](#related-topics)

## <a name="basic-processing-model"></a><span data-ttu-id="72ede-130">Modèle de traitement de base</span><span class="sxs-lookup"><span data-stu-id="72ede-130">Basic Processing Model</span></span>

### <a name="create-the-mft"></a><span data-ttu-id="72ede-131">Créer la table MFT</span><span class="sxs-lookup"><span data-stu-id="72ede-131">Create the MFT</span></span>

<span data-ttu-id="72ede-132">Il existe plusieurs façons de créer une table MFT :</span><span class="sxs-lookup"><span data-stu-id="72ede-132">There are several ways to create an MFT:</span></span>

-   <span data-ttu-id="72ede-133">Appelez la fonction [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) .</span><span class="sxs-lookup"><span data-stu-id="72ede-133">Call the [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) function.</span></span>
-   <span data-ttu-id="72ede-134">Appelez la fonction [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) .</span><span class="sxs-lookup"><span data-stu-id="72ede-134">Call the [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) function.</span></span>
-   <span data-ttu-id="72ede-135">Si vous connaissez déjà le CLSID de la MFT, appelez simplement **CoCreateInstance**.</span><span class="sxs-lookup"><span data-stu-id="72ede-135">If you already know the CLSID of the MFT, simply call **CoCreateInstance**.</span></span>

<span data-ttu-id="72ede-136">Certains MFTs peuvent fournir d’autres options, telles qu’une fonction de création spécialisée.</span><span class="sxs-lookup"><span data-stu-id="72ede-136">Some MFTs might provide other options, such as a specialized creation function.</span></span>

### <a name="get-stream-identifiers"></a><span data-ttu-id="72ede-137">Obtient les identificateurs de flux</span><span class="sxs-lookup"><span data-stu-id="72ede-137">Get Stream Identifiers</span></span>

<span data-ttu-id="72ede-138">Une table MFT possède un ou plusieurs *flux*.</span><span class="sxs-lookup"><span data-stu-id="72ede-138">An MFT has one or more *streams*.</span></span> <span data-ttu-id="72ede-139">Les flux d’entrée reçoivent des données d’entrée, et les flux de sortie génèrent des données de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-139">Input streams receive input data, and output streams generate output data.</span></span> <span data-ttu-id="72ede-140">Les flux ne sont pas représentés en tant qu’objets distincts.</span><span class="sxs-lookup"><span data-stu-id="72ede-140">Streams are not represented as distinct objects.</span></span> <span data-ttu-id="72ede-141">Au lieu de cela, différentes méthodes MFT prennent des identificateurs de flux en tant que paramètres.</span><span class="sxs-lookup"><span data-stu-id="72ede-141">Instead, various MFT methods take stream identifiers as parameters.</span></span>

<span data-ttu-id="72ede-142">Certains MFTs permettent au client d’ajouter ou de supprimer des flux d’entrée.</span><span class="sxs-lookup"><span data-stu-id="72ede-142">Some MFTs allow the client to add or remove input streams.</span></span> <span data-ttu-id="72ede-143">Pendant la diffusion en continu, une table MFT peut ajouter ou supprimer des flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-143">During streaming, an MFT can add or remove output streams.</span></span> <span data-ttu-id="72ede-144">(Le client ne peut pas ajouter ou supprimer des flux de sortie.)</span><span class="sxs-lookup"><span data-stu-id="72ede-144">(The client cannot add or remove output streams.)</span></span>

1.  <span data-ttu-id="72ede-145">(Facultatif.) Appelez [**IMFTransform :: GetStreamLimits**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamlimits) pour connaître le nombre minimal et maximal de flux que la MFT peut prendre en charge.</span><span class="sxs-lookup"><span data-stu-id="72ede-145">(Optional.) Call [**IMFTransform::GetStreamLimits**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamlimits) to get the minimum and maximum number of streams that the MFT can support.</span></span> <span data-ttu-id="72ede-146">Si les valeurs minimale et maximale sont identiques, la table MFT a un nombre fixe de flux.</span><span class="sxs-lookup"><span data-stu-id="72ede-146">If the minimum and maximum are the same, the MFT has a fixed number of streams.</span></span>
2.  <span data-ttu-id="72ede-147">Appelez [**IMFTransform :: GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) pour connaître le nombre initial de flux.</span><span class="sxs-lookup"><span data-stu-id="72ede-147">Call [**IMFTransform::GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) to get the initial number of streams.</span></span>
3.  <span data-ttu-id="72ede-148">Appelez [**IMFTransform :: GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) pour récupérer les identificateurs de flux.</span><span class="sxs-lookup"><span data-stu-id="72ede-148">Call [**IMFTransform::GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) to get the stream identifiers.</span></span> <span data-ttu-id="72ede-149">Si cette méthode retourne E \_ NOTIMPL, cela signifie que la table MFT a un nombre fixe de flux et que les identificateurs de flux sont consécutifs à partir de zéro.</span><span class="sxs-lookup"><span data-stu-id="72ede-149">If this method returns E\_NOTIMPL, it means the MFT has a fixed number of streams, and the stream identifiers are consecutive starting from zero.</span></span>
4.  <span data-ttu-id="72ede-150">(Facultatif.) Si la MFT n’a pas un nombre fixe de flux, appelez [**IMFTransform :: AddInputStreams**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-addinputstreams) pour ajouter d’autres flux d’entrée, ou [**IMFTransform ::D eleteinputstream**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-deleteinputstream) pour supprimer des flux d’entrée.</span><span class="sxs-lookup"><span data-stu-id="72ede-150">(Optional.) If the MFT does not have a fixed number of streams, call [**IMFTransform::AddInputStreams**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-addinputstreams) to add more input streams, or [**IMFTransform::DeleteInputStream**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-deleteinputstream) to remove input streams.</span></span> <span data-ttu-id="72ede-151">(Vous ne pouvez pas ajouter ou supprimer des flux de sortie.)</span><span class="sxs-lookup"><span data-stu-id="72ede-151">(You cannot add or remove output streams.)</span></span>

### <a name="set-media-types"></a><span data-ttu-id="72ede-152">Définir les types de médias</span><span class="sxs-lookup"><span data-stu-id="72ede-152">Set Media Types</span></span>

<span data-ttu-id="72ede-153">Avant qu’une table MFT puisse traiter des données, le client doit définir des types de médias pour chacun des flux de la table MFT.</span><span class="sxs-lookup"><span data-stu-id="72ede-153">Before an MFT can process data, the client must set a media types for each of the streams of the MFT.</span></span> <span data-ttu-id="72ede-154">Une table MFT peut nécessiter que le client définisse les types d’entrée avant de définir les types de sortie, ou qu’il ait besoin de l’ordre inverse (types de sortie en premier).</span><span class="sxs-lookup"><span data-stu-id="72ede-154">An MFT might require that the client set the input types before setting the output types, or might require the opposite order (output types first).</span></span> <span data-ttu-id="72ede-155">Certains MFTs n’ont pas d’exigence sur la commande.</span><span class="sxs-lookup"><span data-stu-id="72ede-155">Some MFTs do not have a requirement on the order.</span></span>

<span data-ttu-id="72ede-156">Une table MFT peut fournir une liste de types de médias préférés pour un flux.</span><span class="sxs-lookup"><span data-stu-id="72ede-156">An MFT can provide a list of preferred media types for a stream.</span></span> <span data-ttu-id="72ede-157">En outre, MFTs peut indiquer les formats généraux qu’ils prennent en charge en ajoutant ces informations au registre.</span><span class="sxs-lookup"><span data-stu-id="72ede-157">Also, MFTs can indicate the general formats that they support by adding this information to the registry.</span></span>

<span data-ttu-id="72ede-158">Pour définir les types de médias, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="72ede-158">To set the media types, do the following:</span></span>

1.  <span data-ttu-id="72ede-159">(Facultatif.) Pour chaque flux d’entrée, appelez [**IMFTransform :: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) pour obtenir la liste des types préférés pour ce flux.</span><span class="sxs-lookup"><span data-stu-id="72ede-159">(Optional.) For each input stream, call [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) to get the list of preferred types for that stream.</span></span>
    -   <span data-ttu-id="72ede-160">Si cette méthode retourne \_ \_ le type de transformation MF E \_ \_ non \_ défini, vous devez d’abord définir les types de sortie ; passez à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="72ede-160">If this method returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, you must set the output types first; skip to step 3.</span></span>
    -   <span data-ttu-id="72ede-161">Si la méthode retourne E \_ NOTIMPL, la MFT n’a pas de liste de types d’entrée préférés ; passez à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="72ede-161">If the method returns E\_NOTIMPL, the MFT does not have a list of preferred input types; skip to step 2.</span></span>
2.  <span data-ttu-id="72ede-162">Pour chaque flux d’entrée, appelez [**IMFTransform :: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) pour définir le type d’entrée.</span><span class="sxs-lookup"><span data-stu-id="72ede-162">For each input stream, call [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the input type.</span></span> <span data-ttu-id="72ede-163">Vous pouvez utiliser un type de média de l’étape 1 ou un type qui décrit vos données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="72ede-163">You can use a media type from step 1, or a type that describes your input data.</span></span> <span data-ttu-id="72ede-164">Si un flux retourne le \_ type de transformation MF E \_ \_ \_ non \_ défini, passez à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="72ede-164">If any stream returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, skip to step 3.</span></span>
3.  <span data-ttu-id="72ede-165">(Facultatif.) Pour chaque flux de sortie, appelez [**IMFTransform :: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) pour obtenir la liste des types préférés pour ce flux.</span><span class="sxs-lookup"><span data-stu-id="72ede-165">(Optional.) For each output stream, call [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) to get a list of preferred types for that stream.</span></span>
    -   <span data-ttu-id="72ede-166">Si cette méthode retourne \_ \_ le type de transformation MF E \_ \_ non \_ défini, vous devez d’abord définir les types d’entrée, puis revenir à l’étape 1.</span><span class="sxs-lookup"><span data-stu-id="72ede-166">If this method returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, you must set the input types first; go back to step 1.</span></span>
    -   <span data-ttu-id="72ede-167">Si un flux retourne E \_ NOTIMPL, la MFT n’a pas de liste de types de sortie préférés ; passez à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="72ede-167">If any stream returns E\_NOTIMPL, the MFT does not have a list of preferred output types; skip to step 4.</span></span>
4.  <span data-ttu-id="72ede-168">Pour chaque flux de sortie, appelez [**IMFTransform :: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) pour définir le type de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-168">For each output stream, call [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) to set the output type.</span></span> <span data-ttu-id="72ede-169">Vous pouvez utiliser un type de média de l’étape 3 ou un type qui décrit le format de sortie requis.</span><span class="sxs-lookup"><span data-stu-id="72ede-169">You can use a media type from step 3, or a type that describes your required output format.</span></span>
5.  <span data-ttu-id="72ede-170">Si des flux d’entrée n’ont pas de type de média, revenez à l’étape 1.</span><span class="sxs-lookup"><span data-stu-id="72ede-170">If any input streams do not have a media type, go back to step 1.</span></span>

### <a name="get-buffer-requirements"></a><span data-ttu-id="72ede-171">Connaître les exigences du tampon</span><span class="sxs-lookup"><span data-stu-id="72ede-171">Get Buffer Requirements</span></span>

<span data-ttu-id="72ede-172">Une fois que le client a défini les types de médias, il doit obtenir les exigences de mémoire tampon pour chaque flux :</span><span class="sxs-lookup"><span data-stu-id="72ede-172">After the client sets the media types, it should get the buffer requirements for each stream:</span></span>

-   <span data-ttu-id="72ede-173">Pour chaque flux d’entrée, appelez [**IMFTransform :: GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo).</span><span class="sxs-lookup"><span data-stu-id="72ede-173">For each input stream, call [**IMFTransform::GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo).</span></span>
-   <span data-ttu-id="72ede-174">Pour chaque flux de sortie, appelez [**IMFTransform :: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo).</span><span class="sxs-lookup"><span data-stu-id="72ede-174">For each output stream, call [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo).</span></span>

### <a name="process-data"></a><span data-ttu-id="72ede-175">Traiter les données</span><span class="sxs-lookup"><span data-stu-id="72ede-175">Process Data</span></span>

<span data-ttu-id="72ede-176">Un MFT est conçu pour être un ordinateur d’état fiable.</span><span class="sxs-lookup"><span data-stu-id="72ede-176">An MFT is designed to be a reliable state machine.</span></span> <span data-ttu-id="72ede-177">Il n’effectue aucun rappel au client.</span><span class="sxs-lookup"><span data-stu-id="72ede-177">It does not make any calls back to the client.</span></span>

1.  <span data-ttu-id="72ede-178">Appelez [**IMFTransform ::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) avec le message [**MFT \_ message de début de diffusion en \_ \_ \_ continu**](mft-message-notify-begin-streaming.md) .</span><span class="sxs-lookup"><span data-stu-id="72ede-178">Call [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_NOTIFY\_BEGIN\_STREAMING**](mft-message-notify-begin-streaming.md) message.</span></span> <span data-ttu-id="72ede-179">Ce message demande à la MFT d’allouer toutes les ressources dont elle a besoin lors de la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="72ede-179">This message requests the MFT to allocate any resources it needs during streaming.</span></span>
2.  <span data-ttu-id="72ede-180">Appelez [**IMFTransform ::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) sur au moins un flux d’entrée pour remettre un exemple d’entrée à la table MFT.</span><span class="sxs-lookup"><span data-stu-id="72ede-180">Call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) on at least one input stream to deliver an input sample to the MFT.</span></span>
3.  <span data-ttu-id="72ede-181">(Facultatif.) Appelez [**IMFTransform :: GetOutputStatus**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstatus) pour demander si la table MFT peut générer un exemple de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-181">(Optional.) Call [**IMFTransform::GetOutputStatus**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstatus) to query whether the MFT can generate an output sample.</span></span> <span data-ttu-id="72ede-182">Si la méthode retourne la valeur \_ OK, vérifiez le paramètre *pdwFlags* .</span><span class="sxs-lookup"><span data-stu-id="72ede-182">If the method returns S\_OK, check the *pdwFlags* parameter.</span></span> <span data-ttu-id="72ede-183">Si *pdwFlags* contient l’indicateur de préparation de l' **\_ exemple d’état de sortie \_ \_ \_ MFT** , passez à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="72ede-183">If *pdwFlags* contains the **MFT\_OUTPUT\_STATUS\_SAMPLE\_READY** flag, go to step 4.</span></span> <span data-ttu-id="72ede-184">Si *pdwFlags* est égal à zéro, revenez à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="72ede-184">If *pdwFlags* is zero, go back to step 2.</span></span> <span data-ttu-id="72ede-185">Si la méthode retourne E \_ NOTIMPL, passez à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="72ede-185">If the method returns E\_NOTIMPL, go to step 4.</span></span>
4.  <span data-ttu-id="72ede-186">Appelez [**IMFTransform ::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) pour accéder aux données de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-186">Call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get output data.</span></span>
    -   <span data-ttu-id="72ede-187">Si la méthode retourne **la \_ transformation MF E nécessite \_ \_ \_ plus \_ d’entrées**, cela signifie que la table MFT requiert davantage de données d’entrée ; revenez à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="72ede-187">If the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**, it means the MFT requires more input data; go back to step 2.</span></span>
    -   <span data-ttu-id="72ede-188">Si la méthode retourne **la \_ \_ modification du \_ flux \_ de transformation MF E**, cela signifie que le nombre de flux de sortie a changé ou que le format de sortie a changé.</span><span class="sxs-lookup"><span data-stu-id="72ede-188">If the method returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**, it means the number of output streams has changed, or the output format has changed.</span></span> <span data-ttu-id="72ede-189">Le client peut avoir besoin d’interroger de nouveaux identificateurs de flux ou de définir de nouveaux types de médias.</span><span class="sxs-lookup"><span data-stu-id="72ede-189">The client might need to query for new stream identifiers or set new media types.</span></span> <span data-ttu-id="72ede-190">Pour plus d’informations, consultez la documentation de [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="72ede-190">For more information, see the documentation for [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>
5.  <span data-ttu-id="72ede-191">Si des données sont toujours entrées à traiter, passez à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="72ede-191">If there is still input data to process, go to step 2.</span></span> <span data-ttu-id="72ede-192">Si la MFT a consommé toutes les données d’entrée disponibles, passez à l’étape 6.</span><span class="sxs-lookup"><span data-stu-id="72ede-192">If the MFT has consumed all of the available input data, proceed to step 6.</span></span>
6.  <span data-ttu-id="72ede-193">Appelez [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) avec le [**message \_ \_ de la \_ fin de la notification de la fin \_ du \_ flux du message MFT**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="72ede-193">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_NOTIFY\_END\_OF\_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>
7.  <span data-ttu-id="72ede-194">Appelez [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) avec le message de [**\_ drainage de \_ commande \_ de message MFT**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="72ede-194">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span>
8.  <span data-ttu-id="72ede-195">Appelez [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) pour récupérer la sortie restante.</span><span class="sxs-lookup"><span data-stu-id="72ede-195">Call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get the remaining output.</span></span> <span data-ttu-id="72ede-196">Répétez cette étape jusqu’à ce que la méthode retourne **MF \_ E \_ Transform \_ ait besoin \_ d’une \_ entrée supplémentaire**.</span><span class="sxs-lookup"><span data-stu-id="72ede-196">Repeat this step until the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span> <span data-ttu-id="72ede-197">Cette valeur de retour signale que toutes les sorties ont été vidées de la MFT.</span><span class="sxs-lookup"><span data-stu-id="72ede-197">This return value signals that all of the output has been drained from the MFT.</span></span> <span data-ttu-id="72ede-198">(Ne traitez pas ceci comme une condition d’erreur.)</span><span class="sxs-lookup"><span data-stu-id="72ede-198">(Do not treat this as an error condition.)</span></span>

<span data-ttu-id="72ede-199">La séquence décrite ici conserve le moins de données possible dans la table MFT.</span><span class="sxs-lookup"><span data-stu-id="72ede-199">The sequence described here keeps as little data as possible in the MFT.</span></span> <span data-ttu-id="72ede-200">Après chaque appel à [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput), le client tente d’accéder à la sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-200">After every call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput), the client attempts to get output.</span></span> <span data-ttu-id="72ede-201">Plusieurs exemples d’entrée peuvent être nécessaires pour produire un échantillon de sortie, ou un exemple d’entrée unique peut générer plusieurs exemples de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-201">Several input samples might be needed to produce one output sample, or a single input sample might generate several output samples.</span></span> <span data-ttu-id="72ede-202">Le comportement optimal pour le client consiste à extraire des échantillons de sortie de la MFT jusqu’à ce que la MFT nécessite davantage d’entrées.</span><span class="sxs-lookup"><span data-stu-id="72ede-202">The optimal behavior for the client is to pull output samples from the MFT until the MFT requires more input.</span></span>

<span data-ttu-id="72ede-203">Toutefois, la table MFT doit pouvoir gérer un ordre différent des appels de méthode par le client.</span><span class="sxs-lookup"><span data-stu-id="72ede-203">However, the MFT should be able to handle a different order of method calls by the client.</span></span> <span data-ttu-id="72ede-204">Par exemple, le client peut simplement alterner entre les appels à [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) et [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="72ede-204">For example, the client might simply alternate between calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="72ede-205">La table MFT doit limiter la quantité d’entrée qu’elle obtient en retournant **MF \_ E \_ NOTACCEPTING** à partir de **ProcessInput** chaque fois qu’elle a une sortie à produire.</span><span class="sxs-lookup"><span data-stu-id="72ede-205">The MFT should restrict the amount of input that it gets by returning **MF\_E\_NOTACCEPTING** from **ProcessInput** whenever it has some output to produce.</span></span>

<span data-ttu-id="72ede-206">L’ordre des appels de méthode décrits ici n’est pas la seule séquence d’événements valide.</span><span class="sxs-lookup"><span data-stu-id="72ede-206">The order of method calls described here is not the only valid sequence of events.</span></span> <span data-ttu-id="72ede-207">Par exemple, les étapes 3 et 4 supposent que le client commence par les types d’entrée, puis essaie les types de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-207">For example, steps 3 and 4 assume that the client starts with the input types and then tries the output types.</span></span> <span data-ttu-id="72ede-208">Le client peut également inverser cet ordre et démarrer avec les types de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-208">The client can also reverse this order and start with the output types.</span></span> <span data-ttu-id="72ede-209">Dans les deux cas, si la table MFT requiert l’ordre inverse, elle doit retourner le code d’erreur « \_ type de transformation MF E \_ \_ \_ non défini » \_ .</span><span class="sxs-lookup"><span data-stu-id="72ede-209">In either case, if the MFT requires the opposite order, it should return the error code MF\_E\_TRANSFORM\_TYPE\_NOT\_SET.</span></span>

<span data-ttu-id="72ede-210">Le client peut appeler des méthodes d’information, telles que [**GetInputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputcurrenttype) et [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo), à tout moment pendant la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="72ede-210">The client can call informational methods, such as [**GetInputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputcurrenttype) and [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo), at any time during streaming.</span></span> <span data-ttu-id="72ede-211">Le client peut également tenter de modifier les types de média à tout moment.</span><span class="sxs-lookup"><span data-stu-id="72ede-211">The client can also attempt to change the media types at any time.</span></span> <span data-ttu-id="72ede-212">La table MFT doit retourner un code d’erreur s’il ne s’agit pas d’une opération valide.</span><span class="sxs-lookup"><span data-stu-id="72ede-212">The MFT should return an error code if this is not a valid operation.</span></span> <span data-ttu-id="72ede-213">En bref, MFTs doit assumer très peu l’ordre des opérations, à l’exception de ce qui est documenté dans les appels eux-mêmes.</span><span class="sxs-lookup"><span data-stu-id="72ede-213">In short, MFTs should assume very little about the order of operations, other than what is documented in the calls themselves.</span></span>

<span data-ttu-id="72ede-214">Le diagramme suivant montre un organigramme des procédures décrites dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="72ede-214">The following diagram shows a flow chart of the procedures described in this topic.</span></span>

![organigramme qui amène à recevoir des identificateurs de flux par le biais de boucles qui définissent les types d’entrée, obtiennent une entrée et traitent la sortie](images/mft-processing.gif)

## <a name="extensions-to-the-basic-model"></a><span data-ttu-id="72ede-216">Extensions du modèle de base</span><span class="sxs-lookup"><span data-stu-id="72ede-216">Extensions to the Basic Model</span></span>

<span data-ttu-id="72ede-217">Éventuellement, une table MFT peut prendre en charge certaines extensions du modèle de diffusion en continu de base.</span><span class="sxs-lookup"><span data-stu-id="72ede-217">Optionally, an MFT can support some extensions to the basic streaming model.</span></span>

-   <span data-ttu-id="72ede-218">Flux de lecture tardive.</span><span class="sxs-lookup"><span data-stu-id="72ede-218">Lazy-read streams.</span></span> <span data-ttu-id="72ede-219">Si la méthode [**IMFTransform :: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) retourne l’indicateur de **\_ \_ \_ \_ lecture tardive du flux de sortie MFT** pour un flux de sortie, le client n’a pas besoin de collecter des données à partir de ce flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-219">If the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_LAZY\_READ** flag for an output stream, the client does not have to collect data from that output stream.</span></span> <span data-ttu-id="72ede-220">La table MFT continue d’accepter les entrées et, à un moment donné, la table MFT ignore les données de sortie de ce flux.</span><span class="sxs-lookup"><span data-stu-id="72ede-220">The MFT continues to accept input, and at some point the MFT will discard the output data from that stream.</span></span> <span data-ttu-id="72ede-221">Si tous les flux de sortie ont cet indicateur, le MFT n’arrivera jamais à accepter l’entrée.</span><span class="sxs-lookup"><span data-stu-id="72ede-221">If all of the output streams have this flag, the MFT will never fail to accept input.</span></span> <span data-ttu-id="72ede-222">Il peut s’agir, par exemple, d’une transformation de visualisation, où le client obtient la sortie uniquement lorsqu’elle a des cycles d’UC de rechange pour dessiner la visualisation.</span><span class="sxs-lookup"><span data-stu-id="72ede-222">An example might be a visualization transform, where the client gets the output only when it has spare CPU cycles to draw the visualization.</span></span>
-   <span data-ttu-id="72ede-223">Flux ignorables.</span><span class="sxs-lookup"><span data-stu-id="72ede-223">Discardable streams.</span></span> <span data-ttu-id="72ede-224">Si la méthode [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) retourne l’indicateur de suppression de **\_ \_ flux \_ de sortie MFT** pour un flux de sortie, le client peut demander à la MFT d’ignorer la sortie, mais la table MFT n’ignore aucune sortie, sauf si elle est demandée.</span><span class="sxs-lookup"><span data-stu-id="72ede-224">If the [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_DISCARDABLE** flag for an output stream, the client can request the MFT to discard output, but the MFT will not discard any output unless requested.</span></span> <span data-ttu-id="72ede-225">Lorsque la table MFT atteint sa mémoire tampon d’entrée maximale, le client doit collecter des données de sortie ou demander à la MFT d’ignorer la sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-225">When the MFT reaches its maximum input buffer, the client must either collect some output data or request the MFT to discard the output.</span></span>
-   <span data-ttu-id="72ede-226">Flux facultatifs.</span><span class="sxs-lookup"><span data-stu-id="72ede-226">Optional streams.</span></span> <span data-ttu-id="72ede-227">Si la méthode [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) retourne l' **indicateur \_ \_ \_ facultatif du flux de sortie MFT** pour un flux de sortie, ou si la méthode [**IMFTransform :: GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo) retourne l’indicateur **\_ \_ \_ facultatif de flux d’entrée MFT** pour un flux d’entrée, ce flux est facultatif.</span><span class="sxs-lookup"><span data-stu-id="72ede-227">If the [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_OPTIONAL** flag for an output stream, or the [**IMFTransform::GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo) method returns the **MFT\_INPUT\_STREAM\_OPTIONAL** flag for an input stream, that stream is optional.</span></span> <span data-ttu-id="72ede-228">Le client n’a pas besoin de définir un type de média sur le flux.</span><span class="sxs-lookup"><span data-stu-id="72ede-228">The client does not have to set a media type on the stream.</span></span> <span data-ttu-id="72ede-229">Si le client ne définit pas le type, le flux est désélectionné.</span><span class="sxs-lookup"><span data-stu-id="72ede-229">If the client does not set the type, the stream is deselected.</span></span> <span data-ttu-id="72ede-230">Un flux de sortie désélectionné ne produit pas d’exemples et le client ne fournit pas de mémoire tampon pour le flux lors de l’appel de [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="72ede-230">A deselected output stream does not produce samples, and the client does not provide a buffer for the stream when it calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="72ede-231">Un flux d’entrée désélectionné n’accepte pas les données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="72ede-231">A deselected input stream does not accept input data.</span></span> <span data-ttu-id="72ede-232">Une table MFT peut marquer tous ses flux d’entrée et de sortie comme facultatifs.</span><span class="sxs-lookup"><span data-stu-id="72ede-232">An MFT can mark all of its input and output streams as optional.</span></span> <span data-ttu-id="72ede-233">Toutefois, il est prévu qu’au moins une entrée et une sortie doivent être sélectionnées pour que la MFT fonctionne.</span><span class="sxs-lookup"><span data-stu-id="72ede-233">However, it is expected that at least one input and one output must be selected for the MFT to work.</span></span>
-   <span data-ttu-id="72ede-234">Traitement asynchrone.</span><span class="sxs-lookup"><span data-stu-id="72ede-234">Asynchronous processing.</span></span> <span data-ttu-id="72ede-235">Le modèle de traitement asynchrone a été introduit dans Windows 7.</span><span class="sxs-lookup"><span data-stu-id="72ede-235">The asynchronous processing model was introduced in Windows 7.</span></span> <span data-ttu-id="72ede-236">Elle est décrite dans la rubrique [MFTS asynchrone](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="72ede-236">It is described in the topic [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

## <a name="imf2dbuffer"></a><span data-ttu-id="72ede-237">IMF2DBuffer</span><span class="sxs-lookup"><span data-stu-id="72ede-237">IMF2DBuffer</span></span>

<span data-ttu-id="72ede-238">Si une table MFT traite des données vidéo non compressées, elle doit utiliser l’interface [**IMF2DBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imf2dbuffer) pour manipuler les exemples de mémoires tampons.</span><span class="sxs-lookup"><span data-stu-id="72ede-238">If an MFT processes uncompressed video data, it should use the [**IMF2DBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imf2dbuffer) interface to manipulate the sample buffers.</span></span> <span data-ttu-id="72ede-239">Pour obtenir cette interface, interrogez l’interface [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) sur n’importe quelle mémoire tampon d’entrée ou de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-239">To get this interface, query the [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) interface on any input or output buffer.</span></span> <span data-ttu-id="72ede-240">Si cette interface n’est pas utilisée, cela peut entraîner des copies supplémentaires de la mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="72ede-240">Not using this interface when it is available may result in additional buffer copies.</span></span> <span data-ttu-id="72ede-241">Pour utiliser correctement cette interface, la transformation ne doit pas verrouiller la mémoire tampon à l’aide de l’interface **IMFMediaBuffer** lorsque **IMF2DBuffer** est disponible.</span><span class="sxs-lookup"><span data-stu-id="72ede-241">To make proper use of this interface, the transform should not lock the buffer using the **IMFMediaBuffer** interface when **IMF2DBuffer** is available.</span></span>

<span data-ttu-id="72ede-242">Pour plus d’informations sur le traitement des données vidéo, consultez [mémoires tampons vidéo non compressées](uncompressed-video-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="72ede-242">For more information about processing video data, see [Uncompressed Video Buffers](uncompressed-video-buffers.md).</span></span>

## <a name="flushing-an-mft"></a><span data-ttu-id="72ede-243">Vidage d’une table MFT</span><span class="sxs-lookup"><span data-stu-id="72ede-243">Flushing an MFT</span></span>

<span data-ttu-id="72ede-244">Le *vidage* d’une table MFT entraîne l’annulation de toutes ses données d’entrée par la MFT.</span><span class="sxs-lookup"><span data-stu-id="72ede-244">*Flushing* an MFT causes the MFT to discard all of its input data.</span></span> <span data-ttu-id="72ede-245">Cela peut provoquer une rupture dans le flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-245">This can cause a break in the output stream.</span></span> <span data-ttu-id="72ede-246">Un client vide généralement un MFT avant de rechercher un nouveau point dans le flux d’entrée ou de basculer vers un nouveau flux d’entrée, lorsque le client ne se soucie pas de la perte de données.</span><span class="sxs-lookup"><span data-stu-id="72ede-246">A client would typically flush an MFT before seeking to a new point in the input stream or switching to a new input stream, when the client does not care about losing data.</span></span>

<span data-ttu-id="72ede-247">Pour vider une table MFT, appelez [**IMFTransform ::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) avec le message de vidage de la [**\_ \_ commande \_ MFT message**](mft-message-command-flush.md) .</span><span class="sxs-lookup"><span data-stu-id="72ede-247">To flush an MFT, call [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_FLUSH**](mft-message-command-flush.md) message.</span></span>

## <a name="draining-an-mft"></a><span data-ttu-id="72ede-248">Vidage d’une table MFT</span><span class="sxs-lookup"><span data-stu-id="72ede-248">Draining an MFT</span></span>

<span data-ttu-id="72ede-249">Le *vidage* d’une table MFT fait que la table MFT produit autant de sortie que possible, quelles que soient les données d’entrée déjà envoyées.</span><span class="sxs-lookup"><span data-stu-id="72ede-249">*Draining* an MFT causes the MFT to produce as much output as it can from whatever input data has already been sent.</span></span> <span data-ttu-id="72ede-250">Si la table MFT ne peut pas générer un exemple complet de sortie à partir de l’entrée disponible, elle supprimera les données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="72ede-250">If the MFT cannot produce a complete output sample from the available input, it will drop input data.</span></span> <span data-ttu-id="72ede-251">Un client draine généralement une table MFT lorsqu’elle a atteint la fin du flux source, ou immédiatement avant une modification de format dans le flux source.</span><span class="sxs-lookup"><span data-stu-id="72ede-251">A client would typically drain an MFT when it reached the end of the source stream, or immediately before a format change in the source stream.</span></span> <span data-ttu-id="72ede-252">Pour vider une table MFT, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="72ede-252">To drain an MFT, do the following:</span></span>

1.  <span data-ttu-id="72ede-253">Appelez [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) avec le message de [**\_ drainage de \_ commande \_ de message MFT**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="72ede-253">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span> <span data-ttu-id="72ede-254">Ce message indique au MFT qu’il doit fournir autant de données de sortie qu’il le peut à partir des données d’entrée qui ont déjà été envoyées.</span><span class="sxs-lookup"><span data-stu-id="72ede-254">This message notifies the MFT that it should deliver as much output data as it can from the input data that has already been sent.</span></span>
2.  <span data-ttu-id="72ede-255">Appelez [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) pour obtenir les données de sortie, jusqu’à ce que la méthode retourne **MF \_ E \_ Transform \_ nécessite \_ plus \_ d’entrée**.</span><span class="sxs-lookup"><span data-stu-id="72ede-255">Call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get output data, until the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span>

<span data-ttu-id="72ede-256">Pendant que la MFT est vidée, elle n’accepte plus d’entrée.</span><span class="sxs-lookup"><span data-stu-id="72ede-256">While the MFT is being drained, it will not accept any more input.</span></span>

## <a name="sample-attributes"></a><span data-ttu-id="72ede-257">Exemples d’attributs</span><span class="sxs-lookup"><span data-stu-id="72ede-257">Sample Attributes</span></span>

<span data-ttu-id="72ede-258">Les exemples d’entrée peuvent avoir des attributs qui doivent être copiés dans les exemples de sortie correspondants.</span><span class="sxs-lookup"><span data-stu-id="72ede-258">The input samples might have attributes that must be copied to the corresponding output samples.</span></span>

-   <span data-ttu-id="72ede-259">Si la table MFT retourne la **\_ valeur variant true** pour la propriété [**MFPKEY \_ exattribute \_ pris en charge**](mfpkey-exattribute-supported-property.md) , la table MFT doit copier les attributs.</span><span class="sxs-lookup"><span data-stu-id="72ede-259">If the MFT returns **VARIANT\_TRUE** for the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property, the MFT must copy the attributes.</span></span>
-   <span data-ttu-id="72ede-260">Si la propriété [**MFPKEY \_ exattribute \_ prise en charge**](mfpkey-exattribute-supported-property.md) est de **type Variant \_ false** ou n’est pas définie, le client doit copier les attributs.</span><span class="sxs-lookup"><span data-stu-id="72ede-260">If the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property is either **VARIANT\_FALSE** or is not set, the client must copy the attributes.</span></span>

<span data-ttu-id="72ede-261">Pour une table MFT avec une entrée et une sortie, vous pouvez utiliser la règle générale suivante :</span><span class="sxs-lookup"><span data-stu-id="72ede-261">For an MFT with one input and one output, you can use the following general rule:</span></span>

-   <span data-ttu-id="72ede-262">Si chaque exemple d’entrée produit exactement un échantillon de sortie, vous pouvez laisser le client copier les attributs.</span><span class="sxs-lookup"><span data-stu-id="72ede-262">If each input sample produces exactly one output sample, you can let the client copy the attributes.</span></span> <span data-ttu-id="72ede-263">Laissez la [**propriété \_ \_ prise en charge MFPKEY exattribute**](mfpkey-exattribute-supported-property.md) non définie.</span><span class="sxs-lookup"><span data-stu-id="72ede-263">Leave the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property unset.</span></span>
-   <span data-ttu-id="72ede-264">S’il n’existe pas de correspondance un-à-un entre les exemples d’entrée et les exemples de sortie, la MFT doit déterminer les attributs corrects pour les exemples de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-264">If there is not a one-to-one correspondence between input samples and output samples, the MFT must determine the correct attributes for output samples.</span></span> <span data-ttu-id="72ede-265">Affectez à la propriété [**MFPKEY des \_ attributs \_ pris en charge**](mfpkey-exattribute-supported-property.md) la **\_ valeur variant true**.</span><span class="sxs-lookup"><span data-stu-id="72ede-265">Set the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property to **VARIANT\_TRUE**.</span></span>

## <a name="discontinuities"></a><span data-ttu-id="72ede-266">Discontinuités</span><span class="sxs-lookup"><span data-stu-id="72ede-266">Discontinuities</span></span>

<span data-ttu-id="72ede-267">Une discontinuation est une rupture dans un flux audio ou vidéo.</span><span class="sxs-lookup"><span data-stu-id="72ede-267">A discontinuity is a break in an audio or video stream.</span></span> <span data-ttu-id="72ede-268">Les discontinuités peuvent être provoquées par des paquets supprimés sur une connexion réseau, des données de fichier endommagées, un basculement d’un flux source à un autre ou une large gamme d’autres causes.</span><span class="sxs-lookup"><span data-stu-id="72ede-268">Discontinuities can be caused by dropped packets on a network connection, corrupt file data, a switch from one source stream to another, or a wide range of other causes.</span></span> <span data-ttu-id="72ede-269">Les discontinuités sont signalées en définissant l’attribut de [**\_ discontinuité MFSampleExtension**](mfsampleextension-discontinuity-attribute.md) sur le premier échantillon après la discontinuation.</span><span class="sxs-lookup"><span data-stu-id="72ede-269">Discontinuities are signaled by setting the [**MFSampleExtension\_Discontinuity**](mfsampleextension-discontinuity-attribute.md) attribute on the first sample after the discontinuity.</span></span> <span data-ttu-id="72ede-270">Il n’est pas possible de signaler une discontinuité au milieu d’un exemple.</span><span class="sxs-lookup"><span data-stu-id="72ede-270">It is not possible to signal a discontinuity in the middle of a sample.</span></span> <span data-ttu-id="72ede-271">Par conséquent, toutes les données discontinues doivent être envoyées dans des exemples séparés.</span><span class="sxs-lookup"><span data-stu-id="72ede-271">Therefore, any discontinuous data should be sent in separate samples.</span></span>

<span data-ttu-id="72ede-272">Certaines transformations, en particulier celles qui gèrent des données non compressées, telles que des effets audio et vidéo, doivent ignorer les discontinuités lorsqu’elles traitent des données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="72ede-272">Some transforms, especially those that handle uncompressed data, such as audio and video effects, should ignore discontinuities when they process input data.</span></span> <span data-ttu-id="72ede-273">Ces MFTs sont généralement conçues pour gérer des données continues et doivent traiter toutes les données qu’elles reçoivent comme continues, même après une discontinuité.</span><span class="sxs-lookup"><span data-stu-id="72ede-273">These MFTs are generally designed to handle continuous data, and should treat any data they receive as continuous, even after a discontinuity.</span></span>

<span data-ttu-id="72ede-274">Si une table MFT ignore une discontinuité sur les données d’entrée, elle doit toujours définir l’indicateur de discontinuité sur l’exemple de sortie, si l’exemple de sortie a le même horodatage que l’exemple d’entrée.</span><span class="sxs-lookup"><span data-stu-id="72ede-274">If an MFT ignores a discontinuity on input data, it should still set the discontinuity flag on the output sample, if the output sample has the same time stamp as the input sample.</span></span> <span data-ttu-id="72ede-275">Toutefois, si l’exemple de sortie a un horodatage différent, la table MFT ne doit pas propager la discontinuité.</span><span class="sxs-lookup"><span data-stu-id="72ede-275">If the output sample has a different time stamp, however, the MFT should not propagate the discontinuity.</span></span> <span data-ttu-id="72ede-276">(Cela peut être le cas dans certains rééchantillonneurs audio, par exemple). Une discontinuité au mauvais endroit dans le flux est plus mauvais qu’aucune discontinuation.</span><span class="sxs-lookup"><span data-stu-id="72ede-276">(This would be the case in some audio resamplers, for example.) A discontinuity at the wrong place in the stream is worse than no discontinuity.</span></span>

<span data-ttu-id="72ede-277">La plupart des décodeurs ne peuvent pas ignorer les discontinuités, car une discontinuation affecte l’interprétation de l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="72ede-277">Most decoders cannot ignore discontinuities, because a discontinuity affects the interpretation of the next sample.</span></span> <span data-ttu-id="72ede-278">Toute technologie d’encodage qui utilise la compression inter-frame, telle que MPEG-2, est incluse dans cette catégorie.</span><span class="sxs-lookup"><span data-stu-id="72ede-278">Any encoding technology that uses inter-frame compression, such as MPEG-2, falls into this category.</span></span> <span data-ttu-id="72ede-279">Certains schémas d’encodage utilisent uniquement la compression intra-image, par exemple DV et MJPEG.</span><span class="sxs-lookup"><span data-stu-id="72ede-279">Some encoding schemes use only intra-frame compression, such as DV and MJPEG.</span></span> <span data-ttu-id="72ede-280">Ces décodeurs peuvent ignorer en toute sécurité les discontinuités.</span><span class="sxs-lookup"><span data-stu-id="72ede-280">These decoders can safely ignore discontinuities.</span></span>

<span data-ttu-id="72ede-281">Les transformations qui répondent aux discontinuités doivent généralement sortir autant de données avant la discontinuation qu’elles le peuvent et ignorer le reste.</span><span class="sxs-lookup"><span data-stu-id="72ede-281">Transforms that respond to discontinuities should generally output as much of the data before the discontinuity as they can, and discard the rest.</span></span> <span data-ttu-id="72ede-282">L’exemple d’entrée avec l’indicateur de discontinuation doit être traité comme s’il s’agissait du premier exemple dans le flux.</span><span class="sxs-lookup"><span data-stu-id="72ede-282">The input sample with the discontinuity flag should be processed as though it were the first sample in the stream.</span></span> <span data-ttu-id="72ede-283">(Ce comportement correspond à ce qui est spécifié pour le message de drainage de la [**\_ commande de message \_ \_ MFT**](mft-message-command-drain.md) .) Toutefois, les détails exacts dépendent du format du média.</span><span class="sxs-lookup"><span data-stu-id="72ede-283">(This behavior matches what is specified for the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.) However, the exact details will depend on the media format.</span></span>

<span data-ttu-id="72ede-284">Si un décodeur ne fait rien pour atténuer une discontinuité, il doit copier l’indicateur de discontinuité dans les données de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-284">If a decoder does nothing to mitigate a discontinuity, it should copy the discontinuity flag to the output data.</span></span> <span data-ttu-id="72ede-285">Les démultiplexeurs et les autres MFTs qui fonctionnent entièrement avec des données compressées doivent copier les discontinuités dans leurs flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="72ede-285">Demultiplexers and other MFTs that work entirely with compressed data must copy any discontinuities to their output streams.</span></span> <span data-ttu-id="72ede-286">Dans le cas contraire, les composants en aval ne seront peut-être pas en mesure de décoder correctement les données compressées.</span><span class="sxs-lookup"><span data-stu-id="72ede-286">Otherwise, the downstream components may not be able to decode the compressed data correctly.</span></span> <span data-ttu-id="72ede-287">En général, il est presque toujours correct de passer les discontinuités en aval, à moins que la table MFT contienne du code explicite pour atténuer les discontinuités.</span><span class="sxs-lookup"><span data-stu-id="72ede-287">In general, it is almost always correct to pass discontinuities downstream, unless the MFT contains explicit code to smooth out discontinuities.</span></span>

## <a name="dynamic-format-changes"></a><span data-ttu-id="72ede-288">Modifications de format dynamique</span><span class="sxs-lookup"><span data-stu-id="72ede-288">Dynamic Format Changes</span></span>

<span data-ttu-id="72ede-289">Les formats peuvent changer pendant la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="72ede-289">Formats can change during streaming.</span></span> <span data-ttu-id="72ede-290">Par exemple, les proportions peuvent changer au milieu d’un flux vidéo.</span><span class="sxs-lookup"><span data-stu-id="72ede-290">For example, aspect ratio can change in the middle of a video stream.</span></span>

<span data-ttu-id="72ede-291">Pour plus d’informations sur la façon dont les modifications de flux de données sont gérées par une table MFT, consultez [gestion des modifications de flux](handling-stream-changes.md).</span><span class="sxs-lookup"><span data-stu-id="72ede-291">For details about how stream changes are handled by an MFT, see [Handling Stream Changes](handling-stream-changes.md).</span></span>

## <a name="stream-events"></a><span data-ttu-id="72ede-292">Événements de flux</span><span class="sxs-lookup"><span data-stu-id="72ede-292">Stream Events</span></span>

<span data-ttu-id="72ede-293">Pour envoyer un événement à une table MFT, appelez [**IMFTransform ::P rocessevent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span><span class="sxs-lookup"><span data-stu-id="72ede-293">To send an event to an MFT, call [**IMFTransform::ProcessEvent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span></span> <span data-ttu-id="72ede-294">Si la méthode retourne **l' \_ événement de transformation MF S \_ \_ ne \_ pas se \_ propager \_**, la table MFT retourne l’événement à l’appelant lors d’un appel ultérieur à [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="72ede-294">If the method returns **MF\_S\_TRANSFORM\_DO\_NOT\_PROPAGATE\_EVENT**, the MFT will return the event to the caller on a subsequent call to [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="72ede-295">Si la méthode retourne une autre valeur **HRESULT** , la table MFT ne retourne pas l’événement au client dans **ProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="72ede-295">If the method returns any other **HRESULT** value, the MFT will not return the event to the client in **ProcessOutput**.</span></span> <span data-ttu-id="72ede-296">Dans ce cas, le client est chargé de propager l’événement en aval au composant suivant dans le pipeline, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="72ede-296">In that case, the client is responsible for propagating the event downstream to the next component in the pipeline, if applicable.</span></span> <span data-ttu-id="72ede-297">Pour plus d’informations, consultez [**IMFTransform ::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="72ede-297">For more information, see [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

## <a name="related-topics"></a><span data-ttu-id="72ede-298">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="72ede-298">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="72ede-299">Transformations de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="72ede-299">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



