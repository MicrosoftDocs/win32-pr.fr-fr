---
description: Horloge de présentation
ms.assetid: cb8bb62a-ef80-4de0-9a44-3bb77edc9dd5
title: Horloge de présentation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f61ad02537a2591c681db78721376651f7854ec
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104114374"
---
# <a name="presentation-clock"></a><span data-ttu-id="cd1e3-103">Horloge de présentation</span><span class="sxs-lookup"><span data-stu-id="cd1e3-103">Presentation Clock</span></span>

<span data-ttu-id="cd1e3-104">L' *horloge de présentation* est un objet qui génère l’heure de l’horloge d’une présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-104">The *presentation clock* is an object that generates the clock time for a presentation.</span></span> <span data-ttu-id="cd1e3-105">L’heure indiquée par l’horloge de la présentation est appelée heure de la *Présentation*.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-105">The time reported by the presentation clock is called the *presentation time*.</span></span> <span data-ttu-id="cd1e3-106">Tous les flux d’une présentation sont synchronisés avec l’heure de la présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-106">All streams in a presentation are synchronized to the presentation time.</span></span> <span data-ttu-id="cd1e3-107">L’horloge de présentation expose les interfaces suivantes.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-107">The presentation clock exposes the following interfaces.</span></span>



| <span data-ttu-id="cd1e3-108">Interface</span><span class="sxs-lookup"><span data-stu-id="cd1e3-108">Interface</span></span>                                            | <span data-ttu-id="cd1e3-109">Description</span><span class="sxs-lookup"><span data-stu-id="cd1e3-109">Description</span></span>                                         |
|------------------------------------------------------|-----------------------------------------------------|
| [<span data-ttu-id="cd1e3-110">**IMFPresentationClock**</span><span class="sxs-lookup"><span data-stu-id="cd1e3-110">**IMFPresentationClock**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationclock) | <span data-ttu-id="cd1e3-111">Interface principale pour l’utilisation de l’horloge de présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-111">Primary interface for using the presentation clock.</span></span> |
| [<span data-ttu-id="cd1e3-112">**IMFRateControl**</span><span class="sxs-lookup"><span data-stu-id="cd1e3-112">**IMFRateControl**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol)             | <span data-ttu-id="cd1e3-113">Contrôle le taux d’horloge.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-113">Controls the clock rate.</span></span>                            |
| [<span data-ttu-id="cd1e3-114">**IMFTimer**</span><span class="sxs-lookup"><span data-stu-id="cd1e3-114">**IMFTimer**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imftimer)                         | <span data-ttu-id="cd1e3-115">Fournit un rappel de minuterie.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-115">Provides a timer callback.</span></span>                          |
| [<span data-ttu-id="cd1e3-116">**IMFShutdown**</span><span class="sxs-lookup"><span data-stu-id="cd1e3-116">**IMFShutdown**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown)                   | <span data-ttu-id="cd1e3-117">Arrête l’horloge de la présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-117">Shuts down the presentation clock.</span></span>                  |



 

<span data-ttu-id="cd1e3-118">Les récepteurs multimédias utilisent l’heure de présentation pour planifier le moment du rendu des exemples.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-118">Media sinks use the presentation time to schedule when to render samples.</span></span> <span data-ttu-id="cd1e3-119">Chaque fois qu’un récepteur multimédia reçoit un nouvel exemple, il obtient l’horodatage de l’échantillon et restitue l’échantillon à l’heure indiquée, ou aussi près que possible de cette heure.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-119">Whenever a media sink receives a new sample, it gets the time stamp from the sample and renders the sample at the indicated time, or as close to that time as possible.</span></span> <span data-ttu-id="cd1e3-120">Étant donné que tous les récepteurs multimédia d’une topologie partagent la même horloge de présentation, plusieurs flux (tels que l’audio et la vidéo) sont synchronisés.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-120">Because all of the media sinks in a topology share the same presentation clock, multiple streams (such as audio and video) are synchronized.</span></span> <span data-ttu-id="cd1e3-121">Les sources et les transformations multimédias n’utilisent pas l’horloge de présentation, car elles ne planifient pas le moment où les exemples doivent être fournis.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-121">Media sources and transforms do not use the presentation clock, because they do not schedule when to deliver samples.</span></span> <span data-ttu-id="cd1e3-122">Au lieu de cela, ils produisent des exemples chaque fois que le pipeline demande un nouvel échantillon.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-122">Instead, they produce samples whenever the pipeline requests a new sample.</span></span>

<span data-ttu-id="cd1e3-123">Si vous utilisez la session multimédia pour la lecture, la session multimédia gère tous les détails de la création de l’horloge de présentation, la sélection d’une source de temps et la notification des récepteurs de médias.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-123">If you are using the Media Session for playback, the Media Session handles all of the details of creating the presentation clock, selecting a time source, and notifying the media sinks.</span></span> <span data-ttu-id="cd1e3-124">Votre application peut utiliser l’horloge de présentation pour atteindre l’heure de présentation actuelle pendant la lecture, mais elle n’appelle aucune méthode sur l’horloge de présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-124">Your application might use the presentation clock to get the current presentation time during playback, but otherwise will not call any methods on the presentation clock.</span></span>

## <a name="clock-time-and-clock-states"></a><span data-ttu-id="cd1e3-125">Horloge et état de l’horloge</span><span class="sxs-lookup"><span data-stu-id="cd1e3-125">Clock Time and Clock States</span></span>

<span data-ttu-id="cd1e3-126">Pour vous procurer l’heure de l’horloge la plus récente à partir de l’horloge de présentation, appelez [**IMFPresentationClock :: getTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime).</span><span class="sxs-lookup"><span data-stu-id="cd1e3-126">To get the latest clock time from the presentation clock, call [**IMFPresentationClock::GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime).</span></span> <span data-ttu-id="cd1e3-127">Les temps d’horloge sont toujours en unités de 100 nanosecondes, donc une seconde est 10 millions (10 ^ 7) cycles.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-127">Clock times are always in 100-nanosecond units, so one second is 10,000,000 (10^7) ticks.</span></span> <span data-ttu-id="cd1e3-128">Cela correspond à une fréquence de 10 MHz.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-128">This corresponds to a frequency of 10 MHz.</span></span>

<span data-ttu-id="cd1e3-129">L’horloge de la présentation a trois États : en cours d’exécution, en pause et arrêtée.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-129">The presentation clock has three states: Running, paused, and stopped.</span></span>

-   <span data-ttu-id="cd1e3-130">Pour exécuter l’horloge, appelez [**IMFPresentationClock :: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-start).</span><span class="sxs-lookup"><span data-stu-id="cd1e3-130">To run the clock, call [**IMFPresentationClock::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-start).</span></span> <span data-ttu-id="cd1e3-131">La méthode **Start** spécifie l’heure de début de l’horloge.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-131">The **Start** method specifies the clock's starting time.</span></span> <span data-ttu-id="cd1e3-132">Lorsque l’horloge est en cours d’exécution, l’heure de l’horloge s’incrémente de l’heure de début, à la fréquence d’horloge actuelle.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-132">While the clock is running, the clock time increments from the starting time, at the current clock rate.</span></span>
-   <span data-ttu-id="cd1e3-133">Pour suspendre l’horloge, appelez [**IMFPresentationClock ::P ause**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-pause).</span><span class="sxs-lookup"><span data-stu-id="cd1e3-133">To pause the clock, call [**IMFPresentationClock::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-pause).</span></span> <span data-ttu-id="cd1e3-134">Lorsque l’horloge est suspendue, l’heure de l’horloge n’avance pas, et [**getTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) retourne l’heure à laquelle l’horloge a été suspendue.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-134">While the clock is paused, the clock time does not advance, and [**GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) returns the time at which the clock was paused.</span></span>
-   <span data-ttu-id="cd1e3-135">Pour arrêter l’horloge, appelez [**IMFPresentationClock :: Stop**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-stop).</span><span class="sxs-lookup"><span data-stu-id="cd1e3-135">To stop the clock, call [**IMFPresentationClock::Stop**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-stop).</span></span> <span data-ttu-id="cd1e3-136">Lorsque l’horloge est arrêtée, l’heure de l’horloge n’avance pas et la fonction [**getTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) retourne la valeur zéro.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-136">When the clock is stopped, the clock time does not advance, and [**GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) returns zero.</span></span>

<span data-ttu-id="cd1e3-137">Par défaut, l’horloge avance à un taux de 1,0, ce qui signifie 1 graduation par 100 nanosecondes.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-137">By default, the clock advances at a rate of 1.0, meaning 1 tick per 100 nanoseconds.</span></span> <span data-ttu-id="cd1e3-138">Pour modifier la vitesse d’avance de l’horloge, interrogez l’horloge de présentation pour l’interface [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) et appelez [**IMFRateControl ::**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate)se.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-138">To change the rate at which the clock advances, query the presentation clock for the [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) interface and call [**IMFRateControl::SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate).</span></span>

<span data-ttu-id="cd1e3-139">Les objets peuvent recevoir des notifications de changements d’État (y compris les changements de taux) à partir de l’horloge de la présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-139">Objects can receive notifications of state changes (including rate changes) from the presentation clock.</span></span> <span data-ttu-id="cd1e3-140">Pour recevoir des notifications, implémentez l’interface [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) et appelez [**IMFPresentationClock :: AddClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-addclockstatesink) sur l’horloge de présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-140">To receive notifications, implement the [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) interface and call [**IMFPresentationClock::AddClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-addclockstatesink) on the presentation clock.</span></span> <span data-ttu-id="cd1e3-141">Avant de fermer, appelez [**IMFPresentationClock :: RemoveClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-removeclockstatesink) pour annuler l’inscription de l’objet.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-141">Before shutting down, call [**IMFPresentationClock::RemoveClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-removeclockstatesink) to unregister the object.</span></span> <span data-ttu-id="cd1e3-142">Les récepteurs de médias utilisent ce mécanisme pour recevoir des notifications de l’horloge.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-142">Media sinks use this mechanism to receive notifications from the clock.</span></span>

## <a name="presentation-times"></a><span data-ttu-id="cd1e3-143">Durées de présentation</span><span class="sxs-lookup"><span data-stu-id="cd1e3-143">Presentation Times</span></span>

<span data-ttu-id="cd1e3-144">Un récepteur multimédia tente de planifier chaque exemple afin que l’exemple soit rendu à l’heure correcte ou aussi près que possible de l’heure correcte.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-144">A media sink tries to schedule each sample so that the sample is rendered at the correct time, or as close to the correct time as possible.</span></span> <span data-ttu-id="cd1e3-145">Les définitions suivantes s’appliquent :</span><span class="sxs-lookup"><span data-stu-id="cd1e3-145">The following definitions apply:</span></span>

-   <span data-ttu-id="cd1e3-146">*Heure de la présentation.*</span><span class="sxs-lookup"><span data-stu-id="cd1e3-146">*Presentation time.*</span></span> <span data-ttu-id="cd1e3-147">Heure à laquelle un échantillon doit être rendu.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-147">The time when a sample should be rendered.</span></span> <span data-ttu-id="cd1e3-148">L’heure est donnée en unités de nanosecondes de 100.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-148">Time is given in units of 100 nanoseconds.</span></span>
-   <span data-ttu-id="cd1e3-149">*Heure du média.*</span><span class="sxs-lookup"><span data-stu-id="cd1e3-149">*Media time.*</span></span> <span data-ttu-id="cd1e3-150">Heure relative au début du contenu.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-150">Time relative to the start of the content.</span></span> <span data-ttu-id="cd1e3-151">Par exemple, si un fichier vidéo a une longueur de 10 secondes, le point moyen du fichier est de 5 secondes.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-151">For example, if a video file is 10 seconds long, the point half way through the file has a media time of 5 seconds.</span></span>
-   <span data-ttu-id="cd1e3-152">*Horodatage.*</span><span class="sxs-lookup"><span data-stu-id="cd1e3-152">*Time stamp.*</span></span> <span data-ttu-id="cd1e3-153">Heure marquée sur un échantillon de média.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-153">The time marked on a media sample.</span></span> <span data-ttu-id="cd1e3-154">Pour connaître l’horodatage, appelez [**IMFSample :: GetSampleTime**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-getsampletime).</span><span class="sxs-lookup"><span data-stu-id="cd1e3-154">To get the time stamp, call [**IMFSample::GetSampleTime**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-getsampletime).</span></span> <span data-ttu-id="cd1e3-155">Lorsqu’une source de média produit un exemple, elle définit l’horodatage comme étant égal à l’heure du support.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-155">When a media source produces a sample, it sets the time stamp equal to the media time.</span></span> <span data-ttu-id="cd1e3-156">La session multimédia traduit la date et l’heure de la présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-156">The Media Session translates the time stamp into presentation time.</span></span>

<span data-ttu-id="cd1e3-157">Par défaut, l’heure du média et l’heure de la présentation sont les mêmes, par exemple, si une image vidéo apparaît 5 secondes dans le fichier source, l’heure du support et l’heure de la présentation sont toutes les cinq secondes.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-157">By default, media time and presentation time are the same, For example, if a video frame appears 5 seconds into the source file, the media time and the presentation time are both 5 seconds.</span></span> <span data-ttu-id="cd1e3-158">Si vous utilisez la [source Sequencer](sequencer-source.md), le modèle de minutage est un peu plus compliqué pour permettre des transitions lisses entre les segments.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-158">If you are using the [Sequencer Source](sequencer-source.md), the timing model is somewhat more complicated, to enable smooth transitions between segments.</span></span> <span data-ttu-id="cd1e3-159">Pour plus d’informations sur le modèle de minutage de la source de Sequencer, consultez [durée de présentation des séquences](sequence-presentation-times.md).</span><span class="sxs-lookup"><span data-stu-id="cd1e3-159">For more information about the sequencer source's timing model, see [Sequence Presentation Times](sequence-presentation-times.md).</span></span>

<span data-ttu-id="cd1e3-160">La source du média définit toujours l’horodatage comme étant égal à l’heure du support.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-160">The media source always sets the time stamp equal to the media time.</span></span> <span data-ttu-id="cd1e3-161">Si l’heure de présentation n’est pas alignée sur l’heure du média, la session multimédia convertit les horodatages sur les échantillons de support.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-161">If presentation time is not aligned with media time, the Media Session converts the time stamps on the media samples.</span></span> <span data-ttu-id="cd1e3-162">Au moment où le récepteur reçoit un échantillon, l’horodatage de l’exemple a été converti en heure de présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-162">By the time the sink receives a sample, the sample's time stamp has been converted to presentation time.</span></span> <span data-ttu-id="cd1e3-163">Le récepteur planifie l’exemple en fonction de l’heure actuelle de l’horloge de la présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-163">The sink schedules the sample against the presentation clock's current time.</span></span> <span data-ttu-id="cd1e3-164">(Les récepteurs de débit sont une exception, car ils ignorent l’horloge de présentation.)</span><span class="sxs-lookup"><span data-stu-id="cd1e3-164">(Rateless sinks are an exception, because they ignore the presentation clock.)</span></span>

<span data-ttu-id="cd1e3-165">Si l’application cherche à une nouvelle position, la session multimédia redémarre l’horloge de la présentation à l’heure de recherche spécifiée.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-165">If the application seeks to a new position, the Media Session restarts the presentation clock at the specified seek time.</span></span> <span data-ttu-id="cd1e3-166">Par exemple, si l’application cherche à la position de 5 secondes dans le fichier, la session multimédia démarre l’horloge à 5 secondes.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-166">For example, if the application seeks to the 5-second position in the file, the Media Session starts the clock at 5 seconds.</span></span> <span data-ttu-id="cd1e3-167">La source du média peut fournir des échantillons avec un horodatage légèrement antérieur si le temps de recherche ne se situe pas dans une limite d’image clé.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-167">The media source might deliver samples with a slightly earlier time stamp if the seek time does not fall on a key-frame boundary.</span></span> <span data-ttu-id="cd1e3-168">Cela est nécessaire pour que les décodeurs puissent décoder tous les frames.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-168">This is required so that the decoders can decode all of the frames.</span></span> <span data-ttu-id="cd1e3-169">La session multimédia supprime ou tronque les échantillons avant qu’ils n’atteignent les récepteurs multimédia, afin de correspondre à l’heure de recherche demandée.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-169">The Media Session drops or trims samples before they reach the media sinks, in order to match the requested seek time.</span></span> <span data-ttu-id="cd1e3-170">Par exemple, si le temps de recherche est de 5 secondes, le premier échantillon audio peut commencer à 4,5 secondes.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-170">For example, if the seek time is 5 seconds, the first audio sample might start at 4.5 seconds.</span></span> <span data-ttu-id="cd1e3-171">La session multimédia découpera les 0,5 premières secondes du premier exemple audio décodé.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-171">The Media Session will trim the first 0.5 seconds from the first decoded audio sample.</span></span>

## <a name="creating-the-presentation-clock"></a><span data-ttu-id="cd1e3-172">Création de l’horloge de présentation</span><span class="sxs-lookup"><span data-stu-id="cd1e3-172">Creating the Presentation Clock</span></span>

<span data-ttu-id="cd1e3-173">Pour créer l’horloge de présentation, appelez [**MFCreatePresentationClock**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationclock).</span><span class="sxs-lookup"><span data-stu-id="cd1e3-173">To create the presentation clock, call [**MFCreatePresentationClock**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationclock).</span></span> <span data-ttu-id="cd1e3-174">Pour arrêter l’horloge, interrogez l’interface [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) et appelez [**IMFShutdown :: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown).</span><span class="sxs-lookup"><span data-stu-id="cd1e3-174">To shut down the clock, query for the [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) interface and call [**IMFShutdown::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown).</span></span> <span data-ttu-id="cd1e3-175">L’appelant de **MFCreatePresentationClock** est chargé d’appeler **Shutdown**; dans la plupart des cas, il s’agit de la session multimédia plutôt que de l’application.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-175">The caller of **MFCreatePresentationClock** is responsible for calling **Shutdown**; in most cases, this is the Media Session rather than the application.</span></span>

## <a name="presentation-time-sources"></a><span data-ttu-id="cd1e3-176">Sources de temps de présentation</span><span class="sxs-lookup"><span data-stu-id="cd1e3-176">Presentation Time Sources</span></span>

<span data-ttu-id="cd1e3-177">En dépit de son nom, l’horloge de présentation n’implémente pas réellement une horloge.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-177">Despite its name, the presentation clock does not actually implement a clock.</span></span> <span data-ttu-id="cd1e3-178">Au lieu de cela, il obtient les heures d’horloge d’un autre objet, appelé *source de temps de présentation*.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-178">Instead, it gets the clock times from another object, called a *presentation time source*.</span></span> <span data-ttu-id="cd1e3-179">La source de temps peut être n’importe quel objet qui génère des battements d’horloge précis et expose l’interface [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) .</span><span class="sxs-lookup"><span data-stu-id="cd1e3-179">The time source can be any object that generates accurate clock ticks and exposes the [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="cd1e3-180">L'illustration ci-dessous montre ce processus.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-180">The following illustration shows this process.</span></span>

![Diagramme montrant la relation entre l’horloge de présentation et la source de temps de présentation](images/dedc255c-eb6d-49fc-8892-7b6076ed4488.gif)

<span data-ttu-id="cd1e3-182">Lorsque l’horloge de présentation est créée pour la première fois, elle n’a pas de source de temps.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-182">When the presentation clock is first created, it does not have a time source.</span></span> <span data-ttu-id="cd1e3-183">Pour définir la source de temps, appelez [**IMFPresentationClock :: SetTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-settimesource) avec un pointeur vers l’interface [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) de la source de temps.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-183">To set the time source, call [**IMFPresentationClock::SetTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-settimesource) with a pointer to the time source's [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="cd1e3-184">Une source de temps prend en charge les mêmes États que l’horloge de présentation (en cours d’exécution, suspendue et arrêt) et doit implémenter l’interface [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) .</span><span class="sxs-lookup"><span data-stu-id="cd1e3-184">A time source supports the same states as the presentation clock (running, paused, and stop), and must implement the [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) interface.</span></span> <span data-ttu-id="cd1e3-185">L’horloge de présentation utilise cette interface pour notifier la source de temps quand modifier l’État.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-185">The presentation clock uses this interface to notify the time source when to change state.</span></span> <span data-ttu-id="cd1e3-186">De cette façon, la source de temps fournit les battements d’horloge, mais l’horloge de présentation lance les changements d’état de l’horloge.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-186">In this way, the time source provides the clock ticks, but the presentation clock initiates state changes in the clock.</span></span>

<span data-ttu-id="cd1e3-187">Certains récepteurs multimédias ont accès à une horloge précise et, par conséquent, exposent l’interface [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) .</span><span class="sxs-lookup"><span data-stu-id="cd1e3-187">Some media sinks have access to an accurate clock, and therefore expose the [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="cd1e3-188">En particulier, le convertisseur audio peut utiliser la fréquence de la carte audio comme une horloge.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-188">In particular, the audio renderer can use the frequency of the sound card as a clock.</span></span> <span data-ttu-id="cd1e3-189">Dans la lecture audio, il est utile que le convertisseur audio agisse en tant que source de temps, de sorte que la vidéo est synchronisée avec la vitesse de lecture audio.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-189">In audio playback, it is useful for the audio renderer to act as the time source, so that video is synchronized to the audio playback rate.</span></span> <span data-ttu-id="cd1e3-190">Cela produit généralement de meilleurs résultats que de tenter de faire correspondre l’audio à une horloge externe.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-190">This generally produces better results than attempting to match the audio to an external clock.</span></span>

<span data-ttu-id="cd1e3-191">Media Foundation fournit également une source de temps de présentation basée sur l’horloge système.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-191">Media Foundation also provides a presentation time source based on the system clock.</span></span> <span data-ttu-id="cd1e3-192">Pour créer cet objet, appelez [**MFCreateSystemTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatesystemtimesource).</span><span class="sxs-lookup"><span data-stu-id="cd1e3-192">To create this object, call [**MFCreateSystemTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatesystemtimesource).</span></span> <span data-ttu-id="cd1e3-193">La source de temps système peut être utilisée quand aucun récepteur multimédia ne fournit de source de temps.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-193">The system time source can be used when no media sinks provide a time source.</span></span>

<span data-ttu-id="cd1e3-194">En général, un récepteur multimédia doit utiliser l’horloge de présentation qui lui est fournie, quelle que soit la source de temps utilisée par l’horloge de présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-194">In general, a media sink must use the presentation clock provided to it, regardless of which time source the presentation clock uses.</span></span> <span data-ttu-id="cd1e3-195">Cette règle s’applique même lorsqu’un récepteur multimédia implémente [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource).</span><span class="sxs-lookup"><span data-stu-id="cd1e3-195">This rule applies even when a media sink implements [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource).</span></span> <span data-ttu-id="cd1e3-196">Si l’horloge de la présentation utilise une autre source de temps, le récepteur multimédia doit suivre cette source de temps, et non sa propre horloge interne.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-196">If the presentation clock uses some other time source, the media sink must follow that time source, not its own internal clock.</span></span>

<span data-ttu-id="cd1e3-197">Il existe deux situations dans lesquelles un récepteur multimédia ne suivra pas l’horloge de présentation :</span><span class="sxs-lookup"><span data-stu-id="cd1e3-197">There are two situations when a media sink will not follow the presentation clock:</span></span>

-   <span data-ttu-id="cd1e3-198">Certains récepteurs multimédias ne sont pas *débités*.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-198">Some media sinks are *rateless*.</span></span> <span data-ttu-id="cd1e3-199">Si un récepteur multimédia est sans débit, il consomme les échantillons le plus rapidement possible, sans les planifier en fonction de l’horloge de la présentation.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-199">If a media sink is rateless, it consumes samples as quickly as possible, without scheduling them according to the presentation clock.</span></span> <span data-ttu-id="cd1e3-200">En règle générale, les récepteurs de débit écrivent les données dans un fichier. il est donc préférable d’effectuer l’opération aussi rapidement que possible.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-200">Typically, rateless sinks write data to a file, so it is desirable to complete the operation as quickly as possible.</span></span> <span data-ttu-id="cd1e3-201">Un récepteur sans débit retourne l’indicateur MEDIASINK sans \_ débit dans sa méthode [**IMFMediaSink :: GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) .</span><span class="sxs-lookup"><span data-stu-id="cd1e3-201">A rateless sink returns the MEDIASINK\_RATELESS flag in its [**IMFMediaSink::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) method.</span></span> <span data-ttu-id="cd1e3-202">Lorsque tous les récepteurs d’une topologie sont sans débit, la session de média transmet les données via le pipeline aussi rapidement que possible.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-202">When all the sinks in a topology are rateless, the Media Session pushes data through the pipeline as quickly as possible.</span></span>

-   <span data-ttu-id="cd1e3-203">Certains récepteurs multimédias ne peuvent pas faire correspondre les taux à une source de temps autre qu’eux-mêmes.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-203">Some media sinks cannot match rates with a time source other than themselves.</span></span> <span data-ttu-id="cd1e3-204">Si c’est le cas, le récepteur retourne l' \_ indicateur MEDIASINK ne peut pas correspondre à l' \_ \_ indicateur Clock dans sa méthode [**GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) .</span><span class="sxs-lookup"><span data-stu-id="cd1e3-204">If so, the sink returns the MEDIASINK\_CANNOT\_MATCH\_CLOCK flag in its [**GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) method.</span></span> <span data-ttu-id="cd1e3-205">Le pipeline peut toujours utiliser une autre source de temps, mais les résultats ne seront pas optimaux.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-205">The pipeline can still use another time source, but the results will be less than optimal.</span></span> <span data-ttu-id="cd1e3-206">Le récepteur sera probablement en retard et provoquera des problèmes lors de la lecture.</span><span class="sxs-lookup"><span data-stu-id="cd1e3-206">The sink will likely fall behind and cause glitches during playback.</span></span>

## <a name="related-topics"></a><span data-ttu-id="cd1e3-207">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="cd1e3-207">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cd1e3-208">API de plateforme Media Foundation</span><span class="sxs-lookup"><span data-stu-id="cd1e3-208">Media Foundation Platform APIs</span></span>](media-foundation-platform-apis.md)
</dt> </dl>

 

 



