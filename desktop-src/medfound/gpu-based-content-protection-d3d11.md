---
description: Cette rubrique décrit le contenu vidéo&\# 8211 ; fonctionnalités de protection qu’un pilote Graphics peut fournir.
ms.assetid: 3FDB4908-C75D-4AE0-B32E-93F840E4F30A
title: GPU-Based protection du contenu avec la vidéo D3D11
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78097492d375d50688f2472f5d2de99cc21f8594
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104033798"
---
# <a name="gpu-based-content-protection-with-d3d11-video"></a><span data-ttu-id="b1540-103">GPU-Based protection du contenu avec la vidéo D3D11</span><span class="sxs-lookup"><span data-stu-id="b1540-103">GPU-Based Content Protection with D3D11 Video</span></span>

<span data-ttu-id="b1540-104">Cette rubrique décrit les fonctionnalités de protection du contenu vidéo qu’un pilote Graphics peut fournir.</span><span class="sxs-lookup"><span data-stu-id="b1540-104">This topic describes video content–protection capabilities that a graphics driver can provide.</span></span>

-   [<span data-ttu-id="b1540-105">Introduction</span><span class="sxs-lookup"><span data-stu-id="b1540-105">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="b1540-106">Vue d’ensemble du processus de décodage</span><span class="sxs-lookup"><span data-stu-id="b1540-106">Overview of the Decoding Process</span></span>](#overview-of-the-decoding-process)
-   [<span data-ttu-id="b1540-107">Chiffrement de mémoires tampons vidéo compressées pour le décodeur</span><span class="sxs-lookup"><span data-stu-id="b1540-107">Encrypting Compressed Video Buffers for the Decoder</span></span>](#encrypting-compressed-video-buffers-for-the-decoder)
    -   [<span data-ttu-id="b1540-108">1. interroger les fonctionnalités protection du contenu du pilote</span><span class="sxs-lookup"><span data-stu-id="b1540-108">1. Query the Content Protection Capabilities of the Driver</span></span>](#1-query-the-content-protection-capabilities-of-the-driver)
    -   [<span data-ttu-id="b1540-109">2. configurer le canal authentifié</span><span class="sxs-lookup"><span data-stu-id="b1540-109">2. Configure the Authenticated Channel</span></span>](#2-configure-the-authenticated-channel)
    -   [<span data-ttu-id="b1540-110">3. configurer la session de chiffrement</span><span class="sxs-lookup"><span data-stu-id="b1540-110">3. Configure the Cryptographic Session</span></span>](#3-configure-the-cryptographic-session)
    -   [<span data-ttu-id="b1540-111">4. associer le décodeur à la session de chiffrement</span><span class="sxs-lookup"><span data-stu-id="b1540-111">4. Associate the decoder with the Cryptographic Session</span></span>](#4-associate-the-decoder-with-the-cryptographic-session)
-   [<span data-ttu-id="b1540-112">Envoi de commandes de canal authentifié</span><span class="sxs-lookup"><span data-stu-id="b1540-112">Sending Authenticated Channel Commands</span></span>](#sending-authenticated-channel-commands)
-   [<span data-ttu-id="b1540-113">Envoi de requêtes de canal authentifié</span><span class="sxs-lookup"><span data-stu-id="b1540-113">Sending Authenticated Channel Queries</span></span>](#sending-authenticated-channel-queries)
-   [<span data-ttu-id="b1540-114">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="b1540-114">Related topics</span></span>](#related-topics)

## <a name="introduction"></a><span data-ttu-id="b1540-115">Introduction</span><span class="sxs-lookup"><span data-stu-id="b1540-115">Introduction</span></span>

<span data-ttu-id="b1540-116">Le diagramme suivant montre une vue simplifiée de la façon dont le contenu de la vidéo protégée transite par le pipeline pour être rendu.</span><span class="sxs-lookup"><span data-stu-id="b1540-116">The following diagram shows a simplified view of how protected video content travels through the pipeline to be rendered.</span></span>

![diagramme qui affiche le contenu vidéo protégé.](images/d3d9video01.png)

> [!Note]
>
> <span data-ttu-id="b1540-118">Le [chemin d’accès au média protégé](protected-media-path.md) (PMP) n’est pas représenté dans ce diagramme.</span><span class="sxs-lookup"><span data-stu-id="b1540-118">The [Protected Media Path](protected-media-path.md) (PMP) is not depicted in this diagram.</span></span> <span data-ttu-id="b1540-119">Le workflow illustré ici peut se produire dans un processus PMP ou dans un processus d’application.</span><span class="sxs-lookup"><span data-stu-id="b1540-119">The data flow that is shown here might occur within a PMP process, or within an application process.</span></span>

 

<span data-ttu-id="b1540-120">Le décodeur reçoit des données vidéo chiffrées et compressées à partir d’une source externe.</span><span class="sxs-lookup"><span data-stu-id="b1540-120">The decoder receives encrypted, compressed video data from an external source.</span></span> <span data-ttu-id="b1540-121">Il est supposé également que le décodeur reçoit également une clé de chiffrement pour déchiffrer ces données.</span><span class="sxs-lookup"><span data-stu-id="b1540-121">It is assumed also the decoder also receives a cryptographic key to decrypt this data.</span></span> <span data-ttu-id="b1540-122">Cette rubrique ne décrit pas l’échange de clés entre la source et le décodeur vidéo, mais le PMP définit un mécanisme possible.</span><span class="sxs-lookup"><span data-stu-id="b1540-122">This topic does not describe the key exchange between the video source and decoder, but the PMP defines one possible mechanism.</span></span> <span data-ttu-id="b1540-123">Le GPU n’est pas impliqué à ce niveau.</span><span class="sxs-lookup"><span data-stu-id="b1540-123">The GPU is not involved at this stage.</span></span>

<span data-ttu-id="b1540-124">Pour le décodage à accélération matérielle, le décodeur logiciel transmet le contenu vidéo compressé au GPU.</span><span class="sxs-lookup"><span data-stu-id="b1540-124">For hardware-accelerated decoding, the software decoder passes compressed video content to the GPU.</span></span> <span data-ttu-id="b1540-125">Pour protéger ce contenu, le décodeur rechiffre les données, généralement en utilisant AES-CTR, avant de les transmettre à l’accélérateur matériel.</span><span class="sxs-lookup"><span data-stu-id="b1540-125">To protect this content, the decoder re-encrypts the data, typically using AES-CTR, before passing it to the hardware accelerator.</span></span> <span data-ttu-id="b1540-126">Un mécanisme d’échange de clés est défini entre le décodeur et le pilote Graphics.</span><span class="sxs-lookup"><span data-stu-id="b1540-126">A key-exchange mechanism is defined between the decoder and the graphics driver.</span></span>

<span data-ttu-id="b1540-127">Les trames vidéo décodées sont stockées dans la mémoire vidéo, généralement en clair.</span><span class="sxs-lookup"><span data-stu-id="b1540-127">Decoded video frames are stored in video memory, generally in the clear.</span></span> <span data-ttu-id="b1540-128">À ce stade, les trames sont traitées et présentées.</span><span class="sxs-lookup"><span data-stu-id="b1540-128">At this point, the frames are processed and then presented.</span></span> <span data-ttu-id="b1540-129">Il existe deux options principales pour la présentation.</span><span class="sxs-lookup"><span data-stu-id="b1540-129">There are two main options for presentation.</span></span>

-   <span data-ttu-id="b1540-130">Lorsque vous utilisez l’API D3D9, vous pouvez présenter des frames à l’aide d’une superposition matérielle.</span><span class="sxs-lookup"><span data-stu-id="b1540-130">When using the D3D9 API, frames can be presented using a hardware overlay.</span></span> <span data-ttu-id="b1540-131">Le matériel n’est pas pris en charge dans D3D11.</span><span class="sxs-lookup"><span data-stu-id="b1540-131">Hardware overly is not supported in D3D11.</span></span> <span data-ttu-id="b1540-132">Pour plus d’informations, consultez [prise en charge de la superposition matérielle](hardware-overlay-support.md).</span><span class="sxs-lookup"><span data-stu-id="b1540-132">For more information, see [Hardware Overlay Support](hardware-overlay-support.md).</span></span>
-   <span data-ttu-id="b1540-133">Les frames peuvent être présentés par la gestion de la fenêtre du Bureau (DWM) à l’aide d’une surface partagée.</span><span class="sxs-lookup"><span data-stu-id="b1540-133">Frames can be presented by the Desktop Window Manage (DWM) using a shared surface.</span></span>

<span data-ttu-id="b1540-134">La dernière étape consiste à afficher le cadre sur le moniteur, ce qui peut nécessiter une protection de liaison entre la carte graphique et le périphérique d’affichage.</span><span class="sxs-lookup"><span data-stu-id="b1540-134">The last step is to display the frame on the monitor, which may require link protection between the graphics card and the display device.</span></span> <span data-ttu-id="b1540-135">Un exemple de protection de liaison est High-Bandwidth la protection du contenu numérique (HDCP).</span><span class="sxs-lookup"><span data-stu-id="b1540-135">An example of link protection is High-Bandwidth Digital Content Protection (HDCP).</span></span> <span data-ttu-id="b1540-136">La protection de liaison est configurée à l’aide de la protection de [sortie](output-protection-manager.md) (OPM).</span><span class="sxs-lookup"><span data-stu-id="b1540-136">Link protection is configured using [Output Protection Manager](output-protection-manager.md) (OPM).</span></span> <span data-ttu-id="b1540-137">Cette rubrique ne décrit pas OPM ; Pour plus d’informations, consultez [utilisation de Output Protection Manager](using-output-protection-manager.md).</span><span class="sxs-lookup"><span data-stu-id="b1540-137">This topic does not describe OPM; for more information, see [Using Output Protection Manager](using-output-protection-manager.md).</span></span>

## <a name="overview-of-the-decoding-process"></a><span data-ttu-id="b1540-138">Vue d’ensemble du processus de décodage</span><span class="sxs-lookup"><span data-stu-id="b1540-138">Overview of the Decoding Process</span></span>

<span data-ttu-id="b1540-139">Lors du décodage accéléré par le matériel, le décodeur logiciel doit transmettre les données vidéo compressées à la carte graphique.</span><span class="sxs-lookup"><span data-stu-id="b1540-139">During hardware-accelerated decoding, the software decoder must pass compressed video data to the graphics card.</span></span> <span data-ttu-id="b1540-140">Pour le contenu Premium, ces données doivent généralement être chiffrées, à l’aide d’un chiffrement à clé symétrique, avant d’être envoyées au GPU.</span><span class="sxs-lookup"><span data-stu-id="b1540-140">For premium content, this data typically must be encrypted, using symmetric-key encryption, before it is sent to the GPU.</span></span>

<span data-ttu-id="b1540-141">Pour chiffrer la vidéo en vue du décodage, le décodeur logiciel utilise les interfaces suivantes :</span><span class="sxs-lookup"><span data-stu-id="b1540-141">To encrypt the video for decoding, the software decoder uses the following interfaces:</span></span>

-   <span data-ttu-id="b1540-142">[**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder).</span><span class="sxs-lookup"><span data-stu-id="b1540-142">[**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder).</span></span> <span data-ttu-id="b1540-143">Représente l’appareil décodeur, également appelé accélérateur.</span><span class="sxs-lookup"><span data-stu-id="b1540-143">Represents the decoder device, also called the accelerator.</span></span>
-   <span data-ttu-id="b1540-144">[**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession).</span><span class="sxs-lookup"><span data-stu-id="b1540-144">[**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession).</span></span> <span data-ttu-id="b1540-145">Représente une session de chiffrement, qui fournit la clé de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="b1540-145">Represents a cryptographic session, which provides the encryption key.</span></span>
-   <span data-ttu-id="b1540-146">[**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="b1540-146">[**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel).</span></span> <span data-ttu-id="b1540-147">Représente un canal authentifié qui permet au décodeur logiciel d’associer la session de chiffrement au décodeur.</span><span class="sxs-lookup"><span data-stu-id="b1540-147">Represents an authenticated channel, which enables the software decoder to associate the cryptographic session with the decoder.</span></span>

![diagramme qui montre les interfaces de décodage Direct3D9.](images/d3d9video02.png)

<span data-ttu-id="b1540-149">Toutes ces interfaces sont obtenues à partir de l’appareil Direct3D11, comme suit :</span><span class="sxs-lookup"><span data-stu-id="b1540-149">All of these interfaces are obtained from the Direct3D11 device, as follows:</span></span>



| <span data-ttu-id="b1540-150">Interface</span><span class="sxs-lookup"><span data-stu-id="b1540-150">Interface</span></span>                                                        | <span data-ttu-id="b1540-151">Création</span><span class="sxs-lookup"><span data-stu-id="b1540-151">Creation</span></span>                                                                                                                                                |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="b1540-152">**ID3D11VideoDecoder**</span><span class="sxs-lookup"><span data-stu-id="b1540-152">**ID3D11VideoDecoder**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder)                 | <span data-ttu-id="b1540-153">Appelez [**ID3D11VideoDevice :: CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview).</span><span class="sxs-lookup"><span data-stu-id="b1540-153">Call [**ID3D11VideoDevice::CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview).</span></span> <span data-ttu-id="b1540-154">Le type de décodeur est identifié par un GUID de profil.</span><span class="sxs-lookup"><span data-stu-id="b1540-154">The decoder type is identified by a profile GUID.</span></span> |
| [<span data-ttu-id="b1540-155">**ID3D11CryptoSession**</span><span class="sxs-lookup"><span data-stu-id="b1540-155">**ID3D11CryptoSession**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession)               | <span data-ttu-id="b1540-156">Appelez [**ID3D11VideoDevice :: CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession).</span><span class="sxs-lookup"><span data-stu-id="b1540-156">Call [**ID3D11VideoDevice::CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession).</span></span>                                                           |
| [<span data-ttu-id="b1540-157">**ID3D11AuthenticatedChannel**</span><span class="sxs-lookup"><span data-stu-id="b1540-157">**ID3D11AuthenticatedChannel**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) | <span data-ttu-id="b1540-158">Appelez [**ID3D11VideoDevice :: CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="b1540-158">Call [**ID3D11VideoDevice::CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel).</span></span>                                             |



 

> [!Note]  
> <span data-ttu-id="b1540-159">Pour obtenir un pointeur vers l’interface [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) , appelez [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) sur l’interface [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) .</span><span class="sxs-lookup"><span data-stu-id="b1540-159">To get a pointer to the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface, call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) interface.</span></span>

 

<span data-ttu-id="b1540-160">Le canal authentifié fournit un canal de communication approuvé entre le décodeur logiciel et le pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-160">The authenticated channel provides a trusted communication channel between the software decoder and the driver.</span></span> <span data-ttu-id="b1540-161">Le canal de communication fonctionne comme suit :</span><span class="sxs-lookup"><span data-stu-id="b1540-161">The communication channel works as follows:</span></span>

-   <span data-ttu-id="b1540-162">Le pilote fournit une chaîne de certificat X. 509 dont le certificat racine est signé par Microsoft.</span><span class="sxs-lookup"><span data-stu-id="b1540-162">The driver provides an X.509 certificate chain whose root certificate is signed by Microsoft.</span></span>
-   <span data-ttu-id="b1540-163">Le certificat contient une clé publique RSA pour le pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-163">The certificate contains an RSA public key for the driver.</span></span>
-   <span data-ttu-id="b1540-164">Le décodeur logiciel utilise la clé publique pour envoyer au pilote une clé de session AES 128 bits.</span><span class="sxs-lookup"><span data-stu-id="b1540-164">The software decoder uses the public key to send the driver a 128-bit AES session key.</span></span>
-   <span data-ttu-id="b1540-165">Le décodeur logiciel envoie des requêtes et des commandes au canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-165">The software decoder sends queries and commands to the authenticated channel.</span></span>
-   <span data-ttu-id="b1540-166">La clé de session est utilisée pour calculer les codes d’authentification de message (Mac) pour les requêtes et les commandes.</span><span class="sxs-lookup"><span data-stu-id="b1540-166">The session key is used to compute message authentication codes (MACs) for the queries and commands.</span></span> <span data-ttu-id="b1540-167">Le pilote utilise les Mac pour vérifier l’intégrité des données de requête/commande, et le décodeur logiciel les utilise pour vérifier l’intégrité des données de réponse du pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-167">The driver uses the MACs to verify the integrity of the query/command data, and the software decoder uses them to verify the integrity of the response data from the driver.</span></span>

## <a name="encrypting-compressed-video-buffers-for-the-decoder"></a><span data-ttu-id="b1540-168">Chiffrement de mémoires tampons vidéo compressées pour le décodeur</span><span class="sxs-lookup"><span data-stu-id="b1540-168">Encrypting Compressed Video Buffers for the Decoder</span></span>

<span data-ttu-id="b1540-169">Voici une vue d’ensemble de haut niveau du processus de chiffrement et de décodage :</span><span class="sxs-lookup"><span data-stu-id="b1540-169">Here is a high-level overview of the encryption and decoding process:</span></span>

1.  <span data-ttu-id="b1540-170">Le décodeur logiciel reçoit un flux de données chiffrées à partir de la source vidéo.</span><span class="sxs-lookup"><span data-stu-id="b1540-170">The software decoder receives a stream of encrypted data from the video source.</span></span> <span data-ttu-id="b1540-171">Le décodeur déchiffre ce flux.</span><span class="sxs-lookup"><span data-stu-id="b1540-171">The decoder decrypts this stream.</span></span>
2.  <span data-ttu-id="b1540-172">Le décodeur logiciel négocie une clé de session avec la session de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="b1540-172">The software decoder negotiates a session key with the cryptographic session.</span></span>
3.  <span data-ttu-id="b1540-173">Le décodeur logiciel utilise le canal authentifié pour associer la session de chiffrement à l’appareil de décodage.</span><span class="sxs-lookup"><span data-stu-id="b1540-173">The software decoder uses the authenticated channel to associate the cryptographic session with the decoder device.</span></span>
4.  <span data-ttu-id="b1540-174">Le décodeur logiciel place des données compressées dans des mémoires tampons qu’il obtient à partir de l’appareil de décodage (Accélérateur).</span><span class="sxs-lookup"><span data-stu-id="b1540-174">The software decoder puts compressed data in buffers that it gets from the decoder device (accelerator).</span></span> <span data-ttu-id="b1540-175">Pour le contenu protégé, l’encodeur logiciel chiffre les données qui sont placées dans les tampons, à l’aide de la clé de session du chiffrement.</span><span class="sxs-lookup"><span data-stu-id="b1540-175">For protected content, the software encoder encrypts the data that is puts into the buffers, using the session key for the encryption.</span></span>
    > [!Note]  
    > <span data-ttu-id="b1540-176">Certains pilotes utilisent une clé de contenu, au lieu de la clé de session, pour le chiffrement.</span><span class="sxs-lookup"><span data-stu-id="b1540-176">Some drivers use a content key, instead of the session key, for encryption.</span></span> <span data-ttu-id="b1540-177">La clé de contenu peut passer d’une image à l’autre.</span><span class="sxs-lookup"><span data-stu-id="b1540-177">The content key could change from one frame to the next.</span></span>

     

5.  <span data-ttu-id="b1540-178">Le décodeur envoie les mémoires tampons compressées chiffrées à l’accélérateur.</span><span class="sxs-lookup"><span data-stu-id="b1540-178">The decoder submits the encrypted compressed buffers to the accelerator.</span></span> <span data-ttu-id="b1540-179">Pour AES-CTR, le décodeur passe également le vecteur d’initialisation.</span><span class="sxs-lookup"><span data-stu-id="b1540-179">For AES-CTR, the decoder also passes the initialization vector.</span></span> <span data-ttu-id="b1540-180">Si une clé de contenu est utilisée, le décodeur passe la clé de contenu, chiffrée à l’aide de la clé de session.</span><span class="sxs-lookup"><span data-stu-id="b1540-180">If a content key is used, the decoder passes the content key, encrypted using the session key.</span></span>

<span data-ttu-id="b1540-181">Direct3D11 offre une prise en charge standard de l’AES-CTR 128 bits, mais est conçu pour s’étendre à des types de chiffrement supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="b1540-181">Direct3D11 has standard support for 128-bit AES-CTR, but is designed to extend to additional encryption types.</span></span>

<span data-ttu-id="b1540-182">Les cinq sections suivantes fournissent des instructions plus détaillées.</span><span class="sxs-lookup"><span data-stu-id="b1540-182">The next five sections give more detailed steps.</span></span>

-   [<span data-ttu-id="b1540-183">1. interroger les fonctionnalités protection du contenu du pilote</span><span class="sxs-lookup"><span data-stu-id="b1540-183">1. Query the Content Protection Capabilities of the Driver</span></span>](#1-query-the-content-protection-capabilities-of-the-driver)
-   [<span data-ttu-id="b1540-184">2. configurer le canal authentifié</span><span class="sxs-lookup"><span data-stu-id="b1540-184">2. Configure the Authenticated Channel</span></span>](#2-configure-the-authenticated-channel)
-   [<span data-ttu-id="b1540-185">3. configurer la session de chiffrement</span><span class="sxs-lookup"><span data-stu-id="b1540-185">3. Configure the Cryptographic Session</span></span>](#3-configure-the-cryptographic-session)
-   [<span data-ttu-id="b1540-186">4. associer le décodeur à la session de chiffrement</span><span class="sxs-lookup"><span data-stu-id="b1540-186">4. Associate the decoder with the Cryptographic Session</span></span>](#4-associate-the-decoder-with-the-cryptographic-session)

### <a name="1-query-the-content-protection-capabilities-of-the-driver"></a><span data-ttu-id="b1540-187">1. interroger les fonctionnalités protection du contenu du pilote</span><span class="sxs-lookup"><span data-stu-id="b1540-187">1. Query the Content Protection Capabilities of the Driver</span></span>

<span data-ttu-id="b1540-188">Avant de tenter d’appliquer le chiffrement, procurez-vous les fonctionnalités de protection du contenu du pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-188">Before attempting to apply encryption, get the content protection capabilities of the driver.</span></span>

1.  <span data-ttu-id="b1540-189">Obtient un pointeur vers l’interface ID3D11Device.</span><span class="sxs-lookup"><span data-stu-id="b1540-189">Get a pointer to the ID3D11Device interface.</span></span>
2.  <span data-ttu-id="b1540-190">Appelez [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) pour l’interface [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) .</span><span class="sxs-lookup"><span data-stu-id="b1540-190">Call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) for the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface.</span></span>
3.  <span data-ttu-id="b1540-191">Appelez [**ID3D11VideoDevice :: GetContentProtectionCaps**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getcontentprotectioncaps).</span><span class="sxs-lookup"><span data-stu-id="b1540-191">Call [**ID3D11VideoDevice::GetContentProtectionCaps**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getcontentprotectioncaps).</span></span> <span data-ttu-id="b1540-192">Cette méthode remplit une structure [**D3D11_VIDEO_CONTENT_PROTECTION_CAPS**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_content_protection_caps) avec les fonctionnalités de protection du contenu du pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-192">This method fills in a [**D3D11_VIDEO_CONTENT_PROTECTION_CAPS**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_content_protection_caps) structure with the driver’s content protection capabilities.</span></span>

<span data-ttu-id="b1540-193">En particulier, recherchez les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="b1540-193">In particular, look for the following capabilities:</span></span>

-   <span data-ttu-id="b1540-194">Si le membre **Caps** contient l’indicateur **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE** ou **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE** , le pilote peut effectuer le chiffrement.</span><span class="sxs-lookup"><span data-stu-id="b1540-194">If the **Caps** member contains the **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE** or **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE** flag, the driver can perform encryption.</span></span>
-   <span data-ttu-id="b1540-195">Si le membre **Caps** contient l’indicateur **D3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** , le pilote utilise une clé de contenu distincte pour le déchiffrement.</span><span class="sxs-lookup"><span data-stu-id="b1540-195">If the **Caps** member contains the **D3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** flag, the driver uses a separate content key for decryption.</span></span>
-   <span data-ttu-id="b1540-196">Appelez [**ID3D11VideoDevice :: CheckCryptoKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkcryptokeyexchange) pour déterminer les types d’échange de clés pris en charge par le pilote pour la génération de la clé de session.</span><span class="sxs-lookup"><span data-stu-id="b1540-196">Call [**ID3D11VideoDevice::CheckCryptoKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkcryptokeyexchange) to determine which types of key exchanges the driver supports for generating the session key.</span></span>

<span data-ttu-id="b1540-197">Les fonctionnalités supplémentaires sont indiquées dans le membre **Caps** .</span><span class="sxs-lookup"><span data-stu-id="b1540-197">Additional capabilities are indicated in the **Caps** member.</span></span>

### <a name="2-configure-the-authenticated-channel"></a><span data-ttu-id="b1540-198">2. configurer le canal authentifié</span><span class="sxs-lookup"><span data-stu-id="b1540-198">2. Configure the Authenticated Channel</span></span>

<span data-ttu-id="b1540-199">L’étape suivante consiste à configurer le canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-199">The next step is to configure the authenticated channel.</span></span>

1.  <span data-ttu-id="b1540-200">Appelez [**ID3D11VideoDevice :: CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel) pour créer le canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-200">Call [**ID3D11VideoDevice::CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel) to create the authenticated channel.</span></span> <span data-ttu-id="b1540-201">Pour le paramètre *ChannelType* , spécifiez un type de canal qui correspond aux fonctionnalités du pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-201">For the *ChannelType* parameter, specify a channel type that matches the capabilities of the driver.</span></span>
    -   <span data-ttu-id="b1540-202">Le type de canal **D3D11_AUTHENTICATED_CHANNEL_DRIVER_SOFTWARE** correspond à **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE**.</span><span class="sxs-lookup"><span data-stu-id="b1540-202">The **D3D11_AUTHENTICATED_CHANNEL_DRIVER_SOFTWARE** channel type corresponds to **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE**.</span></span>
    -   <span data-ttu-id="b1540-203">Le type de canal **D3D11_AUTHENTICATED_CHANNEL_DRIVER_HARDWARE** correspond à **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE**.</span><span class="sxs-lookup"><span data-stu-id="b1540-203">The **D3D11_AUTHENTICATED_CHANNEL_DRIVER_HARDWARE** channel type corresponds to **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE**.</span></span>

    <span data-ttu-id="b1540-204">La méthode **CreateAuthenticatedChannel** retourne un pointeur vers l’interface [**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) .</span><span class="sxs-lookup"><span data-stu-id="b1540-204">The **CreateAuthenticatedChannel** method returns a pointer to the [**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) interface.</span></span>
2.  <span data-ttu-id="b1540-205">Appelez [**ID3D11AuthenticatedChannel :: GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificatesize) pour connaître la taille du certificat X. 509 du pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-205">Call [**ID3D11AuthenticatedChannel::GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificatesize) to get the size of the driver's X.509 certificate.</span></span> <span data-ttu-id="b1540-206">Allouez une mémoire tampon de la taille requise.</span><span class="sxs-lookup"><span data-stu-id="b1540-206">Allocate a buffer of the required size.</span></span>
3.  <span data-ttu-id="b1540-207">Appelez [**ID3D11AuthenticatedChannel :: GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificate) pour récupérer le certificat.</span><span class="sxs-lookup"><span data-stu-id="b1540-207">Call [**ID3D11AuthenticatedChannel::GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificate) to get the certificate.</span></span> <span data-ttu-id="b1540-208">La méthode copie le certificat dans la mémoire tampon qui a été allouée à l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="b1540-208">The method copies the certificate into the buffer that was allocated in the previous step.</span></span>
4.  <span data-ttu-id="b1540-209">Vérifiez que le certificat du pilote a été signé par Microsoft et qu’il n’a pas été révoqué.</span><span class="sxs-lookup"><span data-stu-id="b1540-209">Verify that the driver’s certificate was signed by Microsoft and has not been revoked.</span></span>
5.  <span data-ttu-id="b1540-210">Récupérez la clé publique à partir du certificat.</span><span class="sxs-lookup"><span data-stu-id="b1540-210">Get the public key from the certificate.</span></span>
6.  <span data-ttu-id="b1540-211">Générez une clé de session RSA aléatoire.</span><span class="sxs-lookup"><span data-stu-id="b1540-211">Generate a random RSA session key.</span></span> <span data-ttu-id="b1540-212">Cette clé de session est utilisée pour signer les données envoyées au canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-212">This session key is used to sign data that is sent to the authenticated channel.</span></span> <span data-ttu-id="b1540-213">Chiffrez la clé de session à l’aide de la clé publique du pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-213">Encrypt the session key using the driver's public key.</span></span>
7.  <span data-ttu-id="b1540-214">Appelez [**ID3D11VideoContext :: NegotiateAuthenticatedChannelKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiateauthenticatedchannelkeyexchange) pour envoyer la clé de session chiffrée au pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-214">Call [**ID3D11VideoContext::NegotiateAuthenticatedChannelKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiateauthenticatedchannelkeyexchange) to send the encrypted session key to the driver.</span></span>
8.  <span data-ttu-id="b1540-215">Initialisez le canal sécurisé comme suit :</span><span class="sxs-lookup"><span data-stu-id="b1540-215">Initialize the secure channel as follows:</span></span>
    1.  <span data-ttu-id="b1540-216">Remplissez une structure [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) comme décrit dans la documentation.</span><span class="sxs-lookup"><span data-stu-id="b1540-216">Fill in a [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) structure as described in the documentation.</span></span>
    2.  <span data-ttu-id="b1540-217">Envoyez la commande [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) en appelant [**ID3D11VideoContext :: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) comme décrit dans la section [envoi de commandes de canal authentifié](#sending-authenticated-channel-commands).</span><span class="sxs-lookup"><span data-stu-id="b1540-217">Send the [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) command by calling [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) as described in the section [Sending Authenticated Channel Commands](#sending-authenticated-channel-commands).</span></span> <span data-ttu-id="b1540-218">Cette commande contient les numéros de séquence de départ pour les commandes et les requêtes qui sont envoyées au canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-218">This command contains the starting sequence numbers for the commands and queries that are sent to the authenticated channel.</span></span>
9.  <span data-ttu-id="b1540-219">Vérifiez le type de canal en envoyant une requête [**D3D11_AUTHENTICATED_QUERY_CHANNEL_TYPE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_channel_type_output) au canal authentifié, comme décrit dans la section [envoi de requêtes de canal authentifié](#sending-authenticated-channel-queries).</span><span class="sxs-lookup"><span data-stu-id="b1540-219">Verify the channel type by sending a [**D3D11_AUTHENTICATED_QUERY_CHANNEL_TYPE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_channel_type_output) query to the authenticated channel, as described in the section [Sending Authenticated Channel Queries](#sending-authenticated-channel-queries).</span></span> <span data-ttu-id="b1540-220">Vérifiez que le type de canal correspond à ce que vous avez spécifié dans la méthode [**CreateAuthenticatedChannel**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9video-createauthenticatedchannel) .</span><span class="sxs-lookup"><span data-stu-id="b1540-220">Check that the channel type matches what you specified in the [**CreateAuthenticatedChannel**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9video-createauthenticatedchannel) method.</span></span>

### <a name="3-configure-the-cryptographic-session"></a><span data-ttu-id="b1540-221">3. configurer la session de chiffrement</span><span class="sxs-lookup"><span data-stu-id="b1540-221">3. Configure the Cryptographic Session</span></span>

<span data-ttu-id="b1540-222">Ensuite, configurez la session de chiffrement et établissez la clé de session.</span><span class="sxs-lookup"><span data-stu-id="b1540-222">Next, configure the cryptographic session and establish the session key.</span></span>

1.  <span data-ttu-id="b1540-223">Appelez [**ID3D11VideoDevice :: CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession) pour créer la session de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="b1540-223">Call [**ID3D11VideoDevice::CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession) to create the cryptographic session.</span></span> <span data-ttu-id="b1540-224">Cette méthode retourne un pointeur vers l’interface [**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession) .</span><span class="sxs-lookup"><span data-stu-id="b1540-224">This method returns a pointer to the [**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession) interface.</span></span>
2.  <span data-ttu-id="b1540-225">Appelez [**ID3D11CryptoSession :: GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificatesize) pour connaître la taille du certificat X. 509 du pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-225">Call [**ID3D11CryptoSession::GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificatesize) to get the size of the driver's X.509 certificate.</span></span> <span data-ttu-id="b1540-226">Allouez une mémoire tampon de la taille requise.</span><span class="sxs-lookup"><span data-stu-id="b1540-226">Allocate a buffer of the required size.</span></span>
3.  <span data-ttu-id="b1540-227">Appelez [**ID3D11CryptoSession :: GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificate) pour récupérer le certificat.</span><span class="sxs-lookup"><span data-stu-id="b1540-227">Call [**ID3D11CryptoSession::GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificate) to get the certificate.</span></span> <span data-ttu-id="b1540-228">La méthode copie le certificat dans la mémoire tampon qui a été allouée à l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="b1540-228">The method copies the certificate into the buffer that was allocated in the previous step.</span></span>
4.  <span data-ttu-id="b1540-229">Vérifiez que le certificat du pilote a été signé par Microsoft et qu’il n’a pas été révoqué.</span><span class="sxs-lookup"><span data-stu-id="b1540-229">Verify that the driver’s certificate was signed by Microsoft and has not been revoked.</span></span>
5.  <span data-ttu-id="b1540-230">Récupérez la clé publique à partir du certificat.</span><span class="sxs-lookup"><span data-stu-id="b1540-230">Get the public key from the certificate.</span></span>
6.  <span data-ttu-id="b1540-231">Générez une clé de session RSA aléatoire.</span><span class="sxs-lookup"><span data-stu-id="b1540-231">Generate a random RSA session key.</span></span> <span data-ttu-id="b1540-232">Il s’agit d’une clé de session distincte de la clé de session du canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-232">This is a separate session key from the authenticated channel session key.</span></span> <span data-ttu-id="b1540-233">Chiffrez la clé de session à l’aide de la clé publique du pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-233">Encrypt the session key using the driver's public key.</span></span>
7.  <span data-ttu-id="b1540-234">Appelez [**ID3D11VideoContext :: NegotiateCryptoSessionKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiatecryptosessionkeyexchange) pour envoyer la clé de session chiffrée au pilote.</span><span class="sxs-lookup"><span data-stu-id="b1540-234">Call [**ID3D11VideoContext::NegotiateCryptoSessionKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiatecryptosessionkeyexchange) to send the encrypted session key to the driver.</span></span>
8.  <span data-ttu-id="b1540-235">Si les fonctionnalités de protection du contenu incluent **3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY**, créez une clé de contenu RSA aléatoire.</span><span class="sxs-lookup"><span data-stu-id="b1540-235">If the content protection capabilities include **3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY**, create a random RSA content key.</span></span> <span data-ttu-id="b1540-236">Ce sera utilisé ultérieurement dans le processus de décodage.</span><span class="sxs-lookup"><span data-stu-id="b1540-236">This will be used later in the decoding process.</span></span>

### <a name="4-associate-the-decoder-with-the-cryptographic-session"></a><span data-ttu-id="b1540-237">4. associer le décodeur à la session de chiffrement</span><span class="sxs-lookup"><span data-stu-id="b1540-237">4. Associate the decoder with the Cryptographic Session</span></span>

<span data-ttu-id="b1540-238">Ensuite, associez l’appareil du décodeur à l’appareil Direct3D11 et à la session de chiffrement, comme suit :</span><span class="sxs-lookup"><span data-stu-id="b1540-238">Next, associate the decoder device with the Direct3D11 device and the cryptographic session, as follows:</span></span>

1.  <span data-ttu-id="b1540-239">Obtenir un descripteur de l’appareil Direct3D11, en envoyant une requête [**D3D11_AUTHENTICATED_QUERY_DEVICE_HANDLE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_device_handle_output) au canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-239">Get a handle to the Direct3D11 device, by sending a [**D3D11_AUTHENTICATED_QUERY_DEVICE_HANDLE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_device_handle_output) query to the authenticated channel.</span></span>
2.  <span data-ttu-id="b1540-240">Remplissez une structure [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) avec les informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="b1540-240">Fill in a [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) structure with the following information:</span></span>
    -   <span data-ttu-id="b1540-241">Définissez le membre **DecodeHandle** sur le handle retourné par [**ID3D11VideoDecoder :: GetDriverHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodecoder-getdriverhandle).</span><span class="sxs-lookup"><span data-stu-id="b1540-241">Set the **DecodeHandle** member to the handle returned from [**ID3D11VideoDecoder::GetDriverHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodecoder-getdriverhandle).</span></span>
    -   <span data-ttu-id="b1540-242">Définissez le membre **CryptoSessionHandle** sur le handle retourné par [**ID3D11CryptoSession :: GetCryptoSessionHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcryptosessionhandle).</span><span class="sxs-lookup"><span data-stu-id="b1540-242">Set the **CryptoSessionHandle** member to the handle returned from [**ID3D11CryptoSession::GetCryptoSessionHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcryptosessionhandle).</span></span>
    -   <span data-ttu-id="b1540-243">Définissez le membre **DeviceHandle** sur le descripteur de l’appareil Direct3D11.</span><span class="sxs-lookup"><span data-stu-id="b1540-243">Set the **DeviceHandle** member to the Direct3D11 device handle.</span></span>
3.  <span data-ttu-id="b1540-244">Appelez [**ID3D11VideoContext :: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) pour envoyer une commande [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) au canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-244">Call [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) to send a [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) command to the authenticated channel.</span></span>

<span data-ttu-id="b1540-245">Le diagramme suivant illustre l’échange de handles :</span><span class="sxs-lookup"><span data-stu-id="b1540-245">The following diagram illustrates the exchange of handles:</span></span>

![diagramme qui montre comment le décodeur DXVA est associé à la session de chiffrement.](images/d3d9video03.png)

<span data-ttu-id="b1540-247">Le décodeur logiciel peut désormais utiliser la clé de session de chiffrement pour chiffrer les mémoires tampons vidéo compressées.</span><span class="sxs-lookup"><span data-stu-id="b1540-247">The software decoder can now use the cryptographic session key to encrypt the compressed video buffers.</span></span> <span data-ttu-id="b1540-248">Chaque mémoire tampon compressée aura son propre vecteur d’initialisation (IV) spécifié dans le membre **pIV** de la structure [**D3D11_VIDEO_DECODER_BUFFER_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_buffer_desc) .</span><span class="sxs-lookup"><span data-stu-id="b1540-248">Each compressed buffer will have its own initialization vector (IV) specified in the **pIV** member of the [**D3D11_VIDEO_DECODER_BUFFER_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_buffer_desc) structure.</span></span>

## <a name="sending-authenticated-channel-commands"></a><span data-ttu-id="b1540-249">Envoi de commandes de canal authentifié</span><span class="sxs-lookup"><span data-stu-id="b1540-249">Sending Authenticated Channel Commands</span></span>

<span data-ttu-id="b1540-250">Un ensemble de commandes est défini pour la configuration du canal authentifié et la définition de diverses protections de contenu.</span><span class="sxs-lookup"><span data-stu-id="b1540-250">A set of commands are defined for configuring the authenticated channel and setting various content protections.</span></span> <span data-ttu-id="b1540-251">Pour obtenir la liste des commandes, consultez [protection du contenu des commandes](content-protection-commands.md).</span><span class="sxs-lookup"><span data-stu-id="b1540-251">For a list of commands, see [Content Protection Commands](content-protection-commands.md).</span></span>

<span data-ttu-id="b1540-252">Pour envoyer une commande au canal authentifié, procédez comme suit.</span><span class="sxs-lookup"><span data-stu-id="b1540-252">To send a command to the authenticated channel, perform the following steps.</span></span>

1.  <span data-ttu-id="b1540-253">Renseignez la structure des données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="b1540-253">Fill in the input data structure.</span></span> <span data-ttu-id="b1540-254">Cette structure de données est toujours une structure [**D3D11_AUTHENTICATED_CONFIGURE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_input) suivie de champs supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="b1540-254">This data structure is always a [**D3D11_AUTHENTICATED_CONFIGURE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_input) structure followed by additional fields.</span></span> <span data-ttu-id="b1540-255">Renseignez la structure **D3D11_AUTHENTICATED_CONFIGURE_INPUT** comme indiqué dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="b1540-255">Fill in the **D3D11_AUTHENTICATED_CONFIGURE_INPUT** structure as shown in the following table.</span></span>

    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><span data-ttu-id="b1540-256">Membre</span><span class="sxs-lookup"><span data-stu-id="b1540-256">Member</span></span></th>
    <th><span data-ttu-id="b1540-257">Description</span><span class="sxs-lookup"><span data-stu-id="b1540-257">Description</span></span></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><span data-ttu-id="b1540-258"><strong>omac</strong></span><span class="sxs-lookup"><span data-stu-id="b1540-258"><strong>omac</strong></span></span></td>
    <td><span data-ttu-id="b1540-259">Ignorez ce champ pour l’instant.</span><span class="sxs-lookup"><span data-stu-id="b1540-259">Skip this field for now.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="b1540-260"><strong>ConfigureType</strong></span><span class="sxs-lookup"><span data-stu-id="b1540-260"><strong>ConfigureType</strong></span></span></td>
    <td><span data-ttu-id="b1540-261">GUID qui identifie la commande.</span><span class="sxs-lookup"><span data-stu-id="b1540-261">GUID that identifies the command.</span></span> <span data-ttu-id="b1540-262">Pour obtenir la liste des commandes, consultez <a href="content-protection-commands.md">protection du contenu des commandes</a>.</span><span class="sxs-lookup"><span data-stu-id="b1540-262">For a list of commands, see <a href="content-protection-commands.md">Content Protection Commands</a>.</span></span></td>
    </tr>
    <tr class="odd">
    <td><span data-ttu-id="b1540-263"><strong>hChannel</strong></span><span class="sxs-lookup"><span data-stu-id="b1540-263"><strong>hChannel</strong></span></span></td>
    <td><span data-ttu-id="b1540-264">Handle du canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-264">The handle to the authenticated channel.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="b1540-265"><strong>SequenceNumber</strong></span><span class="sxs-lookup"><span data-stu-id="b1540-265"><strong>SequenceNumber</strong></span></span></td>
    <td><span data-ttu-id="b1540-266">Numéro séquentiel.</span><span class="sxs-lookup"><span data-stu-id="b1540-266">The sequence number.</span></span> <span data-ttu-id="b1540-267">Le premier numéro de séquence est spécifié par l’envoi d’une commande <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="b1540-267">The first sequence number is specified by sending a <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> command.</span></span> <span data-ttu-id="b1540-268">Chaque fois que vous envoyez une autre commande, incrémentez ce nombre de 1.</span><span class="sxs-lookup"><span data-stu-id="b1540-268">Each time you send another command, increment this number by 1.</span></span> <span data-ttu-id="b1540-269">Le numéro de séquence protège contre les attaques par relecture.</span><span class="sxs-lookup"><span data-stu-id="b1540-269">The sequence number guards against replay attacks.</span></span>
    <blockquote>
    [!Note]<br />
<span data-ttu-id="b1540-270">Deux numéros de séquence distincts sont utilisés, un pour les commandes et un pour les requêtes.</span><span class="sxs-lookup"><span data-stu-id="b1540-270">Two separate sequence numbers are used, one for commands and one for queries.</span></span>
    </blockquote>
    <br/> <br/></td>
    </tr>
    </tbody>
    </table>

    

     

2.  <span data-ttu-id="b1540-271">Calculez la balise OMAC pour le bloc de données qui apparaît après le membre **OMAC** de la structure d’entrée.</span><span class="sxs-lookup"><span data-stu-id="b1540-271">Calculate the OMAC tag for the block of data that appears after the **omac** member of the input structure.</span></span> <span data-ttu-id="b1540-272">Copiez ensuite cette valeur de balise dans le membre **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="b1540-272">Then copy this tag value into the **omac** member.</span></span>
3.  <span data-ttu-id="b1540-273">Appelez [**ID3D11VideoContext :: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="b1540-273">Call [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel).</span></span>
4.  <span data-ttu-id="b1540-274">Le pilote place la sortie de la commande dans la structure [**D3D11_AUTHENTICATED_CONFIGURE_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_output) .</span><span class="sxs-lookup"><span data-stu-id="b1540-274">The driver places the output from the command in the [**D3D11_AUTHENTICATED_CONFIGURE_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_output) structure.</span></span>
5.  <span data-ttu-id="b1540-275">Calculez la balise OMAC pour le bloc de données qui apparaît après le membre **OMAC** de la structure de sortie.</span><span class="sxs-lookup"><span data-stu-id="b1540-275">Calculate the OMAC tag for the block of data that appears after the **omac** member of the output structure.</span></span> <span data-ttu-id="b1540-276">Comparez ceci avec la valeur du membre **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="b1540-276">Compare this with the value of the **omac** member.</span></span> <span data-ttu-id="b1540-277">Échouent s’ils ne correspondent pas.</span><span class="sxs-lookup"><span data-stu-id="b1540-277">Fail if they do not match.</span></span>
6.  <span data-ttu-id="b1540-278">Comparez les valeurs des membres **ConfigureType**, **hChannel** et de la structure de sortie à vos valeurs pour **ces membres.**</span><span class="sxs-lookup"><span data-stu-id="b1540-278">Compare the values of the **ConfigureType**, **hChannel**, and **SequenceNumber** members in the output structure against your values for those members.</span></span> <span data-ttu-id="b1540-279">Échouent s’ils ne correspondent pas.</span><span class="sxs-lookup"><span data-stu-id="b1540-279">Fail if they do not match.</span></span>
7.  <span data-ttu-id="b1540-280">Incrémentez le numéro de séquence de la commande suivante.</span><span class="sxs-lookup"><span data-stu-id="b1540-280">Increment the sequence number for the next command.</span></span>

## <a name="sending-authenticated-channel-queries"></a><span data-ttu-id="b1540-281">Envoi de requêtes de canal authentifié</span><span class="sxs-lookup"><span data-stu-id="b1540-281">Sending Authenticated Channel Queries</span></span>

<span data-ttu-id="b1540-282">Un ensemble de requêtes est défini pour la récupération d’informations sur le canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-282">A set of queries are defined for retrieving information about the authenticated channel.</span></span> <span data-ttu-id="b1540-283">Pour obtenir la liste des requêtes, consultez [protection du contenu des requêtes](content-protection-queries.md).</span><span class="sxs-lookup"><span data-stu-id="b1540-283">For a list of queries, see [Content Protection Queries](content-protection-queries.md).</span></span>

<span data-ttu-id="b1540-284">Pour envoyer une commande au canal authentifié, procédez comme suit.</span><span class="sxs-lookup"><span data-stu-id="b1540-284">To send a command to the authenticated channel, perform the following steps.</span></span>

1.  <span data-ttu-id="b1540-285">Renseignez la structure des données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="b1540-285">Fill in the input data structure.</span></span> <span data-ttu-id="b1540-286">Cette structure de données est toujours une structure [**D3D11_AUTHENTICATED_QUERY_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_input) , éventuellement suivie de champs supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="b1540-286">This data structure is always a [**D3D11_AUTHENTICATED_QUERY_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_input) structure, possibly followed by additional fields.</span></span> <span data-ttu-id="b1540-287">Renseignez la structure **D3D11_AUTHENTICATED_QUERY_INPUT** comme indiqué dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="b1540-287">Fill in the **D3D11_AUTHENTICATED_QUERY_INPUT** structure as shown in the following table.</span></span>

    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><span data-ttu-id="b1540-288">Membre</span><span class="sxs-lookup"><span data-stu-id="b1540-288">Member</span></span></th>
    <th><span data-ttu-id="b1540-289">Description</span><span class="sxs-lookup"><span data-stu-id="b1540-289">Description</span></span></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><span data-ttu-id="b1540-290"><strong>Affectée</strong></span><span class="sxs-lookup"><span data-stu-id="b1540-290"><strong>QueryType</strong></span></span></td>
    <td><span data-ttu-id="b1540-291">GUID qui identifie la requête.</span><span class="sxs-lookup"><span data-stu-id="b1540-291">GUID that identifies the query.</span></span> <span data-ttu-id="b1540-292">Pour obtenir la liste des requêtes, consultez <a href="content-protection-queries.md">protection du contenu des requêtes</a>.</span><span class="sxs-lookup"><span data-stu-id="b1540-292">For a list of queries, see <a href="content-protection-queries.md">Content Protection Queries</a>.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="b1540-293"><strong>hChannel</strong></span><span class="sxs-lookup"><span data-stu-id="b1540-293"><strong>hChannel</strong></span></span></td>
    <td><span data-ttu-id="b1540-294">Handle du canal authentifié.</span><span class="sxs-lookup"><span data-stu-id="b1540-294">The handle to the authenticated channel.</span></span></td>
    </tr>
    <tr class="odd">
    <td><span data-ttu-id="b1540-295"><strong>SequenceNumber</strong></span><span class="sxs-lookup"><span data-stu-id="b1540-295"><strong>SequenceNumber</strong></span></span></td>
    <td><span data-ttu-id="b1540-296">Numéro séquentiel.</span><span class="sxs-lookup"><span data-stu-id="b1540-296">The sequence number.</span></span> <span data-ttu-id="b1540-297">Le premier numéro de séquence est spécifié par l’envoi d’une commande <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="b1540-297">The first sequence number is specified by sending a <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> command.</span></span> <span data-ttu-id="b1540-298">Chaque fois que vous envoyez une autre requête, incrémentez ce nombre de 1.</span><span class="sxs-lookup"><span data-stu-id="b1540-298">Each time you send another query, increment this number by 1.</span></span> <span data-ttu-id="b1540-299">Le numéro de séquence protège contre les attaques par relecture.</span><span class="sxs-lookup"><span data-stu-id="b1540-299">The sequence number guards against replay attacks.</span></span>
    <blockquote>
    [!Note]<br />
<span data-ttu-id="b1540-300">Deux numéros de séquence distincts sont utilisés, un pour les commandes et un pour les requêtes.</span><span class="sxs-lookup"><span data-stu-id="b1540-300">Two separate sequence numbers are used, one for commands and one for queries.</span></span>
    </blockquote>
    <br/> <br/></td>
    </tr>
    </tbody>
    </table>

    

     

2.  <span data-ttu-id="b1540-301">Appelez [**ID3D11VideoContext :: QueryAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-queryauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="b1540-301">Call [**ID3D11VideoContext::QueryAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-queryauthenticatedchannel).</span></span>
3.  <span data-ttu-id="b1540-302">Le pilote place la sortie de la requête dans une structure [**D3D11_AUTHENTICATED_QUERY_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_output) .</span><span class="sxs-lookup"><span data-stu-id="b1540-302">The driver places the output from the query in a [**D3D11_AUTHENTICATED_QUERY_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_output) structure.</span></span> <span data-ttu-id="b1540-303">Cette structure est suivie de champs supplémentaires, selon le type de requête.</span><span class="sxs-lookup"><span data-stu-id="b1540-303">This structure is followed by additional fields, depending on the query type.</span></span>
4.  <span data-ttu-id="b1540-304">Calculez la balise OMAC pour le bloc de données qui apparaît après le membre **OMAC** de la structure de sortie.</span><span class="sxs-lookup"><span data-stu-id="b1540-304">Calculate the OMAC tag for the block of data that appears after the **omac** member of the output structure.</span></span> <span data-ttu-id="b1540-305">Comparez ceci avec la valeur du membre **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="b1540-305">Compare this with the value of the **omac** member.</span></span> <span data-ttu-id="b1540-306">Échouent s’ils ne correspondent pas.</span><span class="sxs-lookup"><span data-stu-id="b1540-306">Fail if they do not match.</span></span>
5.  <span data-ttu-id="b1540-307">Comparez les valeurs des membres **ConfigureType**, **hChannel** et de la structure de sortie à vos valeurs pour **ces membres.**</span><span class="sxs-lookup"><span data-stu-id="b1540-307">Compare the values of the **ConfigureType**, **hChannel**, and **SequenceNumber** members in the output structure against your values for those members.</span></span> <span data-ttu-id="b1540-308">Échouent s’ils ne correspondent pas.</span><span class="sxs-lookup"><span data-stu-id="b1540-308">Fail if they do not match.</span></span>
6.  <span data-ttu-id="b1540-309">Incrémentez le numéro de séquence de la requête suivante.</span><span class="sxs-lookup"><span data-stu-id="b1540-309">Increment the sequence number for the next query.</span></span>

## <a name="related-topics"></a><span data-ttu-id="b1540-310">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="b1540-310">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b1540-311">API vidéo Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="b1540-311">Direct3D 11 Video APIs</span></span>](direct3d-11-video-apis.md)
</dt> </dl>

 

 
