---
description: À propos de MFTs
ms.assetid: ca9cef70-b897-4fd5-9a13-8bf1c2b84b00
title: À propos de MFTs
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 09adce4bc93c110cf98e4fd8ed427ffcd009c3c1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103862754"
---
# <a name="about-mfts"></a><span data-ttu-id="55c9a-103">À propos de MFTs</span><span class="sxs-lookup"><span data-stu-id="55c9a-103">About MFTs</span></span>

<span data-ttu-id="55c9a-104">Les transformations de Media Foundation (MFTs) fournissent un modèle générique pour le traitement des données multimédias.</span><span class="sxs-lookup"><span data-stu-id="55c9a-104">Media Foundation transforms (MFTs) provide a generic model for processing media data.</span></span> <span data-ttu-id="55c9a-105">Les MFTs sont utilisés pour les décodeurs, les encodeurs et les processeurs de signal numérique (DSP).</span><span class="sxs-lookup"><span data-stu-id="55c9a-105">MFTs are used for decoders, encoders, and digital signal processors (DSPs).</span></span> <span data-ttu-id="55c9a-106">En bref, tout ce qui se trouve dans le pipeline de média entre la source du média et le récepteur multimédia est une table MFT.</span><span class="sxs-lookup"><span data-stu-id="55c9a-106">In short, anything that sits in the media pipeline between the media source and the media sink is an MFT.</span></span>

<span data-ttu-id="55c9a-107">Pour la plupart des applications, les détails du traitement des données MFT sont masqués par les couches supérieures de l’architecture Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="55c9a-107">For most applications, the details of MFT data processing are hidden by higher layers of the Media Foundation architecture.</span></span> <span data-ttu-id="55c9a-108">De nombreuses applications Media Foundation n’effectuent jamais un appel direct à une table MFT.</span><span class="sxs-lookup"><span data-stu-id="55c9a-108">Many Media Foundation applications will never make a direct call to an MFT.</span></span> <span data-ttu-id="55c9a-109">Toutefois, il est certainement possible d’héberger une table MFT directement dans votre application.</span><span class="sxs-lookup"><span data-stu-id="55c9a-109">However, it is certainly possible to host an MFT directly in your application.</span></span>

<span data-ttu-id="55c9a-110">Les MFTs sont une évolution du modèle de transformation introduit pour la première fois avec DirectX Media Objects (DMOs).</span><span class="sxs-lookup"><span data-stu-id="55c9a-110">MFTs are an evolution of the transform model first introduced with DirectX Media Objects (DMOs).</span></span> <span data-ttu-id="55c9a-111">En fait, il est relativement facile de créer une transformation qui prend en charge les deux modèles.</span><span class="sxs-lookup"><span data-stu-id="55c9a-111">In fact, it is relatively easy to create a transform that supports both models.</span></span> <span data-ttu-id="55c9a-112">Par rapport à DMOs, les comportements requis de MFTs sont plus clairement spécifiés, ce qui facilite l’écriture d’une implémentation correcte.</span><span class="sxs-lookup"><span data-stu-id="55c9a-112">Compared with DMOs, the required behaviors of MFTs are more clearly specified, which makes it easier to write a correct implementation.</span></span> <span data-ttu-id="55c9a-113">En outre, MFTs peut prendre en charge le traitement vidéo accéléré par le matériel.</span><span class="sxs-lookup"><span data-stu-id="55c9a-113">In addition, MFTs can support hardware-accelerated video processing.</span></span>

<span data-ttu-id="55c9a-114">Cette rubrique donne un bref aperçu du modèle de traitement MFT, en se concentrant sur la conception globale plutôt que sur des appels de méthode spécifiques.</span><span class="sxs-lookup"><span data-stu-id="55c9a-114">This topic gives a brief overview of the MFT processing model, focusing on the overall design rather than specific method calls.</span></span> <span data-ttu-id="55c9a-115">Pour obtenir une description pas à pas plus détaillée, consultez modèle de [traitement MFT de base](basic-mft-processing-model.md).</span><span class="sxs-lookup"><span data-stu-id="55c9a-115">For a more detailed, step-by-step description, see [Basic MFT Processing Model](basic-mft-processing-model.md).</span></span>

## <a name="streams"></a><span data-ttu-id="55c9a-116">Flux</span><span class="sxs-lookup"><span data-stu-id="55c9a-116">Streams</span></span>

<span data-ttu-id="55c9a-117">Une table MFT contient des flux d’entrée et des flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="55c9a-117">An MFT has input streams and output streams.</span></span> <span data-ttu-id="55c9a-118">Les flux d’entrée reçoivent des données, et les flux de sortie produisent des données.</span><span class="sxs-lookup"><span data-stu-id="55c9a-118">Input streams receive data, and output streams produce data.</span></span> <span data-ttu-id="55c9a-119">Par exemple, un décodeur possède un flux d’entrée, qui reçoit les données encodées, et un flux de sortie, qui produit les données décodées.</span><span class="sxs-lookup"><span data-stu-id="55c9a-119">For example, a decoder has one input stream, which receives the encoded data, and one output stream, which produces the decoded data.</span></span>

<span data-ttu-id="55c9a-120">Les flux sur une table MFT ne sont pas représentés en tant qu’objets COM distincts.</span><span class="sxs-lookup"><span data-stu-id="55c9a-120">The streams on an MFT are not represented as distinct COM objects.</span></span> <span data-ttu-id="55c9a-121">Au lieu de cela, chaque flux a un identificateur de flux désigné, et les méthodes de l’interface [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) prennent des identificateurs de flux en tant que paramètres d’entrée.</span><span class="sxs-lookup"><span data-stu-id="55c9a-121">Instead, each stream has a designated stream identifier, and the methods in the [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) interface take stream identifiers as input parameters.</span></span>

<span data-ttu-id="55c9a-122">Certains MFTs ont un nombre fixe de flux.</span><span class="sxs-lookup"><span data-stu-id="55c9a-122">Some MFTs have a fixed number of streams.</span></span> <span data-ttu-id="55c9a-123">Par exemple, les décodeurs et les encodeurs ont normalement une seule entrée et une sortie.</span><span class="sxs-lookup"><span data-stu-id="55c9a-123">For example, decoders and encoders normally have exactly one input and one output.</span></span> <span data-ttu-id="55c9a-124">D’autres MFTs ont un nombre dynamique de flux.</span><span class="sxs-lookup"><span data-stu-id="55c9a-124">Other MFTs have a dynamic number of streams.</span></span> <span data-ttu-id="55c9a-125">Si une table MFT prend en charge les flux dynamiques, le client peut ajouter de nouveaux flux d’entrée.</span><span class="sxs-lookup"><span data-stu-id="55c9a-125">If an MFT supports dynamic streams, the client can add new input streams.</span></span> <span data-ttu-id="55c9a-126">Le client ne peut pas ajouter des flux de sortie, mais la table MFT peut ajouter ou supprimer des flux de sortie pendant le traitement.</span><span class="sxs-lookup"><span data-stu-id="55c9a-126">The client cannot add output streams, but the MFT might add or remove output streams during processing.</span></span> <span data-ttu-id="55c9a-127">Par exemple, les multiplexeurs permettent généralement au client d’ajouter des flux d’entrée et d’avoir une sortie pour le flux multiplexé.</span><span class="sxs-lookup"><span data-stu-id="55c9a-127">For example, multiplexers typically allow the client to add input streams and have one output for the multiplexed stream.</span></span> <span data-ttu-id="55c9a-128">Les démultiplexeurs sont l’inverse, avec une entrée, mais un nombre dynamique de flux de sortie, selon le contenu du flux d’entrée.</span><span class="sxs-lookup"><span data-stu-id="55c9a-128">Demultiplexers are the reverse, with one input but a dynamic number of output streams, depending on the contents of the input stream.</span></span> <span data-ttu-id="55c9a-129">L’illustration suivante montre la différence entre multiplexeur et démultiplexeur.</span><span class="sxs-lookup"><span data-stu-id="55c9a-129">The following illustration shows the difference between multiplexer and demultiplexer.</span></span>

![Diagramme montrant un encodeur/décodeur (1 entrée, 1 sortie), un multiplexeur (2 entrées, 1 sortie) et un démultiplexeur (1 entrée, 2 sorties)](images/f2b95bd5-f862-4d66-9d75-550a90f6cc97.gif)

## <a name="media-types"></a><span data-ttu-id="55c9a-131">Types de médias</span><span class="sxs-lookup"><span data-stu-id="55c9a-131">Media Types</span></span>

<span data-ttu-id="55c9a-132">Quand une table MFT est créée pour la première fois, aucun des flux n’a un format établi.</span><span class="sxs-lookup"><span data-stu-id="55c9a-132">When an MFT is first created, none of the streams has an established format.</span></span> <span data-ttu-id="55c9a-133">Avant que la MFT puisse traiter des données, le client doit définir les formats des flux.</span><span class="sxs-lookup"><span data-stu-id="55c9a-133">Before the MFT can process data, the client must set the formats for the streams.</span></span> <span data-ttu-id="55c9a-134">Par exemple, avec un décodeur, le format d’entrée est le format de compression utilisé dans le fichier source d’origine, et le format de sortie est un format non compressé, tel qu’une vidéo PCM audio ou RVB.</span><span class="sxs-lookup"><span data-stu-id="55c9a-134">For example, with a decoder, the input format is the compression format used in the original source file, and the output format is an uncompressed format, such as PCM audio or RGB video.</span></span> <span data-ttu-id="55c9a-135">Les formats de flux sont décrits à l’aide des [types de médias](media-types.md).</span><span class="sxs-lookup"><span data-stu-id="55c9a-135">The stream formats are described using [Media Types](media-types.md).</span></span>

<span data-ttu-id="55c9a-136">En fonction de l’état interne de la MFT, elle peut fournir une liste de types de média possibles pour chaque flux.</span><span class="sxs-lookup"><span data-stu-id="55c9a-136">Depending on the internal state of the MFT, it might provide a list of possible media types for each stream.</span></span> <span data-ttu-id="55c9a-137">Vous pouvez utiliser cette liste comme indication lorsque vous définissez les types de médias.</span><span class="sxs-lookup"><span data-stu-id="55c9a-137">You can use this list as a hint when you set the media types.</span></span> <span data-ttu-id="55c9a-138">La définition du type de média sur un flux peut modifier la liste des types possibles pour un autre flux.</span><span class="sxs-lookup"><span data-stu-id="55c9a-138">Setting the media type on one stream can change the list of possible types for a another stream.</span></span> <span data-ttu-id="55c9a-139">Par exemple, un décodeur ne peut généralement pas fournir de types de sortie tant que le client n’a pas défini le type d’entrée.</span><span class="sxs-lookup"><span data-stu-id="55c9a-139">For example, a decoder typically cannot provide any output types until the client sets the input type.</span></span> <span data-ttu-id="55c9a-140">Le type d’entrée contient les informations dont le décodeur a besoin pour retourner une liste de types de sortie possibles.</span><span class="sxs-lookup"><span data-stu-id="55c9a-140">The input type contains the information that the decoder needs to return a list of possible output types.</span></span>

<span data-ttu-id="55c9a-141">Pour définir le type de média sur un flux, appelez [**IMFTransform :: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) ou [**IMFTransform :: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="55c9a-141">To set the media type on a stream, call [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) or [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span> <span data-ttu-id="55c9a-142">Pour obtenir la liste des types de média possibles pour un flux, appelez [**IMFTransform :: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) ou [**IMFTransform :: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span><span class="sxs-lookup"><span data-stu-id="55c9a-142">To get the list of possible media types for a stream, call [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) or [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span></span>

## <a name="processing-data"></a><span data-ttu-id="55c9a-143">Traitement des données</span><span class="sxs-lookup"><span data-stu-id="55c9a-143">Processing Data</span></span>

<span data-ttu-id="55c9a-144">Une fois que le client a défini les types de média sur les flux, la MFT est prête à traiter les données.</span><span class="sxs-lookup"><span data-stu-id="55c9a-144">After the client sets the media types on the streams, the MFT is ready to process data.</span></span> <span data-ttu-id="55c9a-145">Pour ce faire, le client alterne entre la fourniture de données d’entrée à la MFT et l’obtention des données de sortie de la MFT :</span><span class="sxs-lookup"><span data-stu-id="55c9a-145">To make this happen, the client alternates between providing input data to the MFT and getting output data from the MFT:</span></span>

-   <span data-ttu-id="55c9a-146">Pour fournir des données d’entrée à la MFT, appelez [**IMFTransform ::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="55c9a-146">To give input data to the MFT, call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>
-   <span data-ttu-id="55c9a-147">Pour extraire des données de sortie de la table MFT, appelez [**IMFTransform ::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="55c9a-147">To pull output data from the MFT, call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="55c9a-148">La méthode [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) prend un pointeur vers un exemple de support alloué par le client.</span><span class="sxs-lookup"><span data-stu-id="55c9a-148">The [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) method takes a pointer to a media sample allocated by the client.</span></span> <span data-ttu-id="55c9a-149">L’exemple de support contient une ou plusieurs mémoires tampons, et chaque mémoire tampon contient des données d’entrée pour le traitement de la table MFT.</span><span class="sxs-lookup"><span data-stu-id="55c9a-149">The media sample contains one or more buffers, and each buffer contains input data for the MFT to process.</span></span>

<span data-ttu-id="55c9a-150">La méthode [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) prend en charge deux modèles d’allocation différents : soit le MFT alloue les mémoires tampons de sortie, soit le client alloue les mémoires tampons de sortie.</span><span class="sxs-lookup"><span data-stu-id="55c9a-150">The [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method supports two different allocation models: Either the MFT allocates the output buffers, or the client allocates the output buffers.</span></span> <span data-ttu-id="55c9a-151">Certains MFTs prennent en charge les deux modèles d’allocation, mais il n’est pas nécessaire qu’un MFT prenne en charge les deux.</span><span class="sxs-lookup"><span data-stu-id="55c9a-151">Some MFTs support both allocation models, but it is not required for an MFT to support both.</span></span> <span data-ttu-id="55c9a-152">Par exemple, une table MFT peut nécessiter que le client alloue les tampons de sortie.</span><span class="sxs-lookup"><span data-stu-id="55c9a-152">For example, an MFT might require the client to allocate the output buffers.</span></span> <span data-ttu-id="55c9a-153">La méthode [**IMFTransform :: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) retourne des informations sur un flux de sortie, notamment le modèle d’allocation pris en charge par la table MFT.</span><span class="sxs-lookup"><span data-stu-id="55c9a-153">The [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns information about an output stream, including which allocation model the MFT supports.</span></span>

<span data-ttu-id="55c9a-154">Les MFTs sont conçus pour mettre en mémoire tampon le moins de données possible, afin de réduire la latence dans le pipeline.</span><span class="sxs-lookup"><span data-stu-id="55c9a-154">MFTs are designed to buffer as little data as possible, in order to minimize latency in the pipeline.</span></span> <span data-ttu-id="55c9a-155">Par conséquent, à un moment donné, la table MFT peut signaler l’une des conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="55c9a-155">Therefore, at any given time, the MFT can signal one of the following conditions:</span></span>

-   <span data-ttu-id="55c9a-156">La table MFT requiert davantage de données d’entrée.</span><span class="sxs-lookup"><span data-stu-id="55c9a-156">The MFT requires more input data.</span></span> <span data-ttu-id="55c9a-157">Dans cet État, la table MFT ne peut pas produire de sortie tant que le client n’a pas appelé [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) au moins une fois.</span><span class="sxs-lookup"><span data-stu-id="55c9a-157">In this state, the MFT cannot produce output until the client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) at least once.</span></span>
-   <span data-ttu-id="55c9a-158">La MFT n’acceptera plus d’entrée tant que le client n’aura pas appelé [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) au moins une fois.</span><span class="sxs-lookup"><span data-stu-id="55c9a-158">The MFT will not accept any more input until the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at least once.</span></span>

<span data-ttu-id="55c9a-159">Par exemple, supposons que vous utilisez un décodeur vidéo pour décoder un flux vidéo contenant un mélange d’images clés et d’images Delta.</span><span class="sxs-lookup"><span data-stu-id="55c9a-159">For example, suppose that you are using a video decoder to decode a video stream that contains a mix of key frames and delta frames.</span></span> <span data-ttu-id="55c9a-160">Au départ, la table MFT requiert une entrée avant de pouvoir décoder des frames.</span><span class="sxs-lookup"><span data-stu-id="55c9a-160">Initially, the MFT requires some input before it can decode any frames.</span></span> <span data-ttu-id="55c9a-161">Le client appelle [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) pour remettre le premier frame.</span><span class="sxs-lookup"><span data-stu-id="55c9a-161">The client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) to deliver the first frame.</span></span> <span data-ttu-id="55c9a-162">Supposons que la première image est une image Delta (illustrée dans le diagramme suivant comme « P » pour le cadre prédit).</span><span class="sxs-lookup"><span data-stu-id="55c9a-162">Suppose that the first frame is a delta frame (shown in the following diagram as 'P' for predicted frame).</span></span> <span data-ttu-id="55c9a-163">Le décodeur conserve sur ce frame, mais ne peut pas produire de sortie tant qu’il n’a pas obtenu l’image clé suivante.</span><span class="sxs-lookup"><span data-stu-id="55c9a-163">The decoder holds onto this frame, but it cannot produce any output until it gets the next key frame.</span></span>

![Diagramme montrant la MFT qui nécessite une entrée, pointant vers un frame prédit](images/f5a88ac6-24da-40e5-b356-649aa6f811c3.gif)

<span data-ttu-id="55c9a-165">Le client continue d’appeler [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) et finit par atteindre la prochaine image clé (illustrée dans le schéma suivant sous le terme « I » pour le frame à code interne).</span><span class="sxs-lookup"><span data-stu-id="55c9a-165">The client continues to call [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and eventually reaches the next key frame (shown in the next diagram as 'I' for intra-coded frame).</span></span> <span data-ttu-id="55c9a-166">À présent, le décodeur a suffisamment d’images pour démarrer le décodage.</span><span class="sxs-lookup"><span data-stu-id="55c9a-166">Now the decoder has enough frames to start decoding.</span></span> <span data-ttu-id="55c9a-167">À ce stade, il cesse d’accepter l’entrée et le client doit appeler [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) pour récupérer les frames décodés.</span><span class="sxs-lookup"><span data-stu-id="55c9a-167">At this point it stops accepting input, and the client must call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get the decoded frames.</span></span>

![Diagramme montrant une table MFT qui n’accepte pas d’entrée, pointant vers une image intra-codée et trois frames prédites](images/ae014a1a-9d03-4cfa-a04d-4a63bdc83f73.gif)

<span data-ttu-id="55c9a-169">L’approche la plus simple pour le client est simplement d’alterner les appels à [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) et [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="55c9a-169">The simplest approach for the client is simply to alternate calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="55c9a-170">Un algorithme plus sophistiqué est décrit dans la rubrique [modèle de traitement MFT de base](basic-mft-processing-model.md).</span><span class="sxs-lookup"><span data-stu-id="55c9a-170">A more sophisticated algorithm is described in the topic [Basic MFT Processing Model](basic-mft-processing-model.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="55c9a-171">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="55c9a-171">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="55c9a-172">Transformations de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="55c9a-172">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



