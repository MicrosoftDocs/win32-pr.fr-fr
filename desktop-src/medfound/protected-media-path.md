---
description: 'Cette rubrique présente trois rubriques connexes : environnement protégé, passerelle d’interopérabilité des médias, révocation et renouvellement.'
ms.assetid: e88806ae-0041-4b4a-a8df-69718a651e82
title: Chemin du média protégé
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7304edadf1623d41bc2f1f5c6b2b4cda2dd5f598
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/03/2021
ms.locfileid: "104560003"
---
# <a name="protected-media-path"></a><span data-ttu-id="70558-103">Chemin du média protégé</span><span class="sxs-lookup"><span data-stu-id="70558-103">Protected Media Path</span></span>

<span data-ttu-id="70558-104">Cette rubrique présente trois rubriques connexes : environnement protégé, passerelle d’interopérabilité des médias, révocation et renouvellement.</span><span class="sxs-lookup"><span data-stu-id="70558-104">This topic discusses three interrelated topics: protected environment, media interoperability gateway, and revocation and renewal.</span></span>

-   <span data-ttu-id="70558-105">Un environnement protégé (PE) est un ensemble de technologies qui permet au contenu protégé de circuler à partir de Windows Vista de manière protégée.</span><span class="sxs-lookup"><span data-stu-id="70558-105">A protected environment (PE) is a set of technologies that enables protected content to flow from and through Windows Vista in a protected fashion.</span></span> <span data-ttu-id="70558-106">Tous les composants à l’intérieur d’un environnement protégé sont approuvés et le processus est protégé contre la falsification.</span><span class="sxs-lookup"><span data-stu-id="70558-106">All components inside a protected environment are trusted and the process is protected against tampering.</span></span>
-   <span data-ttu-id="70558-107">Le chemin d’accès au média protégé (PMP) est un fichier exécutable qui s’exécute dans un environnement protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-107">The protected media path (PMP) is an executable that runs in a protected environment.</span></span>
-   <span data-ttu-id="70558-108">Si un composant approuvé dans le PE devient compromis, une fois le processus en cours, il est révoqué.</span><span class="sxs-lookup"><span data-stu-id="70558-108">If a trusted component in the PE becomes compromised, after due process it will be revoked.</span></span> <span data-ttu-id="70558-109">Toutefois, Microsoft fournit un mécanisme de renouvellement pour installer une version fiable plus récente du composant lorsqu’il est disponible.</span><span class="sxs-lookup"><span data-stu-id="70558-109">However, Microsoft provides a renewal mechanism to install a newer trusted version of the component when one becomes available.</span></span>

<span data-ttu-id="70558-110">Pour plus d’informations sur la signature de code des composants multimédias protégés, consultez le livre blanc [Signing Code Signing for protected Media Components in Windows Vista (en](/windows-hardware/test/hlk/)anglais).</span><span class="sxs-lookup"><span data-stu-id="70558-110">For information about code signing protected media components, see the white paper [Code Signing for Protected Media Components in Windows Vista](/windows-hardware/test/hlk/).</span></span>

<span data-ttu-id="70558-111">Cette rubrique contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="70558-111">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="70558-112">Environnement protégé</span><span class="sxs-lookup"><span data-stu-id="70558-112">Protected Environment</span></span>](#protected-environment)
-   [<span data-ttu-id="70558-113">Conception de l’environnement protégé</span><span class="sxs-lookup"><span data-stu-id="70558-113">Design of the Protected Environment</span></span>](#design-of-the-protected-environment)
-   [<span data-ttu-id="70558-114">Chemin du média protégé</span><span class="sxs-lookup"><span data-stu-id="70558-114">Protected Media Path</span></span>](#protected-media-path)
    -   [<span data-ttu-id="70558-115">Autorités d’approbation d’entrée</span><span class="sxs-lookup"><span data-stu-id="70558-115">Input Trust Authorities</span></span>](#input-trust-authorities)
    -   [<span data-ttu-id="70558-116">Autorités de confiance de sortie</span><span class="sxs-lookup"><span data-stu-id="70558-116">Output Trust Authorities</span></span>](#output-trust-authorities)
    -   [<span data-ttu-id="70558-117">Objets de stratégie</span><span class="sxs-lookup"><span data-stu-id="70558-117">Policy Objects</span></span>](#policy-objects)
    -   [<span data-ttu-id="70558-118">Création d’objets dans l’PMP</span><span class="sxs-lookup"><span data-stu-id="70558-118">Creating Objects in the PMP</span></span>](#creating-objects-in-the-pmp)
-   [<span data-ttu-id="70558-119">Vue d’ensemble de la négociation de stratégie</span><span class="sxs-lookup"><span data-stu-id="70558-119">Overview of Policy Negotiation</span></span>](#overview-of-policy-negotiation)
-   [<span data-ttu-id="70558-120">Révocation et renouvellement</span><span class="sxs-lookup"><span data-stu-id="70558-120">Revocation and Renewal</span></span>](#revocation-and-renewal)
-   [<span data-ttu-id="70558-121">Protection des liens de sortie</span><span class="sxs-lookup"><span data-stu-id="70558-121">Output Link Protection</span></span>](#output-link-protection)
-   [<span data-ttu-id="70558-122">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="70558-122">Related topics</span></span>](#related-topics)

## <a name="protected-environment"></a><span data-ttu-id="70558-123">Environnement protégé</span><span class="sxs-lookup"><span data-stu-id="70558-123">Protected Environment</span></span>

<span data-ttu-id="70558-124">La protection du contenu englobe plusieurs technologies, chacune essayant de s’assurer que le contenu ne peut pas être utilisé d’une manière qui n’est pas cohérente avec l’intention du propriétaire ou du fournisseur du contenu.</span><span class="sxs-lookup"><span data-stu-id="70558-124">Content protection encompasses multiple technologies, each of which attempts to ensure that content cannot be used in a way that is inconsistent with the intent of the content owner or provider.</span></span> <span data-ttu-id="70558-125">Ces technologies incluent la protection contre la copie, la protection des liens, l’accès conditionnel et la gestion des droits numériques (DRM).</span><span class="sxs-lookup"><span data-stu-id="70558-125">These technologies include copy protection, link protection, conditional access, and digital rights management (DRM).</span></span> <span data-ttu-id="70558-126">La Fondation de chaque est approuvée : l’accès au contenu est accordé uniquement aux composants logiciels qui adhèrent aux conditions d’utilisation affectées à ce contenu.</span><span class="sxs-lookup"><span data-stu-id="70558-126">The foundation of each is trust: Access to the content is granted only to software components that adhere to the terms of use assigned to that content.</span></span>

<span data-ttu-id="70558-127">Pour réduire les menaces contre le contenu protégé, Windows Vista et les logiciels Media Foundation permettent l’exécution de code de confiance dans un environnement protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-127">To minimize threats against protected content, Windows Vista and Media Foundation Software enable trusted code to run in a protected environment.</span></span> <span data-ttu-id="70558-128">Un PE est un ensemble de composants, de recommandations et d’outils conçus pour améliorer la protection contre le piratage de contenu.</span><span class="sxs-lookup"><span data-stu-id="70558-128">A PE is a set of components, guidelines, and tools designed to increase protection against content piracy.</span></span>

<span data-ttu-id="70558-129">Avant d’examiner le PE plus en détail, il est important de comprendre les menaces qu’il est prévu de réduire.</span><span class="sxs-lookup"><span data-stu-id="70558-129">Before examining the PE more closely, it is important to understand the threats it is designed to minimize.</span></span> <span data-ttu-id="70558-130">Supposons que vous exécutez une application multimédia dans un processus en mode utilisateur.</span><span class="sxs-lookup"><span data-stu-id="70558-130">Suppose you are running a media application in a user-mode process.</span></span> <span data-ttu-id="70558-131">L’application est liée aux différentes bibliothèques de liens dynamiques (dll) qui contiennent des plug-ins multimédias, tels que des décodeurs.</span><span class="sxs-lookup"><span data-stu-id="70558-131">The application is linked to the various dynamic link libraries (DLLs) that contain media plug-ins, such as decoders.</span></span> <span data-ttu-id="70558-132">D’autres processus sont également exécutés en mode utilisateur et différents pilotes sont chargés dans le noyau.</span><span class="sxs-lookup"><span data-stu-id="70558-132">Other processes are also running in user mode, and various drivers are loaded in the kernel.</span></span> <span data-ttu-id="70558-133">Si aucun mécanisme d’approbation n’est en place, les menaces suivantes existent :</span><span class="sxs-lookup"><span data-stu-id="70558-133">If no trust mechanism is in place, the following threats exist:</span></span>

-   <span data-ttu-id="70558-134">L’application peut accéder directement à des médias protégés ou pirater la mémoire de processus.</span><span class="sxs-lookup"><span data-stu-id="70558-134">The application can access protected media directly or hack the process memory.</span></span>
-   <span data-ttu-id="70558-135">Les plug-ins peuvent accéder directement au contenu ou pirater la mémoire du processus.</span><span class="sxs-lookup"><span data-stu-id="70558-135">Plug-ins can access the content directly or hack the process memory.</span></span>
-   <span data-ttu-id="70558-136">D’autres processus peuvent pirater la mémoire du processus multimédia soit directement, soit en injectant du code.</span><span class="sxs-lookup"><span data-stu-id="70558-136">Other processes can hack the media process memory either directly or by injecting code.</span></span>
-   <span data-ttu-id="70558-137">Les pilotes de noyau peuvent pirater la mémoire du processus multimédia.</span><span class="sxs-lookup"><span data-stu-id="70558-137">Kernel drivers can hack the media process memory.</span></span>
-   <span data-ttu-id="70558-138">Le contenu peut être envoyé à l’extérieur du système via un support non protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-138">Content might be sent outside the system over an unprotected medium.</span></span> <span data-ttu-id="70558-139">(La protection de la liaison est conçue pour atténuer cette menace.)</span><span class="sxs-lookup"><span data-stu-id="70558-139">(Link protection is designed to mitigate against this threat.)</span></span>

## <a name="design-of-the-protected-environment"></a><span data-ttu-id="70558-140">Conception de l’environnement protégé</span><span class="sxs-lookup"><span data-stu-id="70558-140">Design of the Protected Environment</span></span>

<span data-ttu-id="70558-141">Un environnement protégé s’exécute dans un processus protégé distinct de l’application multimédia.</span><span class="sxs-lookup"><span data-stu-id="70558-141">A protected environment runs in a separate protected process from the media application.</span></span> <span data-ttu-id="70558-142">La fonctionnalité de processus protégé de Windows Vista empêche d’autres processus d’accéder au processus protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-142">The protected process feature of Windows Vista stops other processes from accessing the protected process.</span></span>

<span data-ttu-id="70558-143">Lorsqu’un processus protégé est créé, les principaux composants du noyau identifient les composants non fiables et les plug-ins afin que l’environnement protégé puisse refuser de les charger.</span><span class="sxs-lookup"><span data-stu-id="70558-143">When a protected process is created, core kernel components identify untrusted components and plug-ins so that the protected environment can refuse to load them.</span></span> <span data-ttu-id="70558-144">Un composant approuvé est un composant qui a été correctement signé par Microsoft.</span><span class="sxs-lookup"><span data-stu-id="70558-144">A trusted component is one that has been appropriately signed by Microsoft.</span></span> <span data-ttu-id="70558-145">Le noyau effectue également le suivi des modules qui s’y chargent, ce qui permet à l’environnement protégé d’arrêter la lecture du contenu protégé si un module non approuvé est chargé.</span><span class="sxs-lookup"><span data-stu-id="70558-145">The kernel also tracks modules that load into it, enabling the protected environment to stop playback of protected content if an untrusted module is loaded.</span></span> <span data-ttu-id="70558-146">Avant le chargement d’un composant de noyau, le noyau vérifie s’il est approuvé.</span><span class="sxs-lookup"><span data-stu-id="70558-146">Before a kernel component is loaded, the kernel checks to determine whether it is trusted.</span></span> <span data-ttu-id="70558-147">Si ce n’est pas le cas, les composants de confiance déjà présents dans le PE refusent de traiter le contenu protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-147">If it is not, trusted components already in the PE refuse to process protected content.</span></span> <span data-ttu-id="70558-148">Pour ce faire, les composants PE effectuent périodiquement une liaison sécurisée par chiffrement avec le noyau.</span><span class="sxs-lookup"><span data-stu-id="70558-148">To enable this, PE components periodically perform a cryptographically-protected handshake with the kernel.</span></span> <span data-ttu-id="70558-149">Si un composant en mode noyau non fiable est présent, le protocole de transfert échoue et indique au PE qu’il existe un composant non approuvé.</span><span class="sxs-lookup"><span data-stu-id="70558-149">If an untrusted kernel mode component is present, the handshake fails and indicates to the PE that an untrusted component exists.</span></span>

<span data-ttu-id="70558-150">Si un composant approuvé devient compromis, une fois le processus en retard, il peut être révoqué.</span><span class="sxs-lookup"><span data-stu-id="70558-150">If a trusted component becomes compromised, after due process it can be revoked.</span></span> <span data-ttu-id="70558-151">Microsoft fournit un mécanisme de renouvellement pour installer une nouvelle version approuvée quand elle est disponible.</span><span class="sxs-lookup"><span data-stu-id="70558-151">Microsoft provides a renewal mechanism to install a newer trusted version when available.</span></span>

## <a name="protected-media-path"></a><span data-ttu-id="70558-152">Chemin du média protégé</span><span class="sxs-lookup"><span data-stu-id="70558-152">Protected Media Path</span></span>

<span data-ttu-id="70558-153">Le chemin d’accès au média protégé (PMP) est le fichier exécutable PE principal pour Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="70558-153">The protected media path (PMP) is the primary PE executable for Media Foundation.</span></span> <span data-ttu-id="70558-154">Le PMP est extensible, de sorte que les mécanismes de protection de contenu tiers peuvent être pris en charge.</span><span class="sxs-lookup"><span data-stu-id="70558-154">The PMP is extensible, so that third-party content protection mechanisms can be supported.</span></span>

<span data-ttu-id="70558-155">Le PMP accepte le contenu protégé et les stratégies associées de toute source de Media Foundation à l’aide d’un système de protection du contenu, y compris ceux fournis par des tiers.</span><span class="sxs-lookup"><span data-stu-id="70558-155">The PMP accepts protected content and associated policies from any Media Foundation source using any content protection system, including those provided by third parties.</span></span> <span data-ttu-id="70558-156">Il envoie le contenu à n’importe quel récepteur de Media Foundation, à condition que le récepteur soit conforme aux stratégies spécifiées par la source.</span><span class="sxs-lookup"><span data-stu-id="70558-156">It sends content to any Media Foundation sink, as long as the sink complies with the policies specified by the source.</span></span> <span data-ttu-id="70558-157">Il prend également en charge les transformations entre la source et le récepteur, y compris les transformations tierces, à condition qu’elles soient approuvées.</span><span class="sxs-lookup"><span data-stu-id="70558-157">It also supports transforms between the source and the sink, including third-party transforms, as long as they are trusted.</span></span>

<span data-ttu-id="70558-158">Le PMP s’exécute dans un processus protégé isolé de l’application multimédia.</span><span class="sxs-lookup"><span data-stu-id="70558-158">The PMP runs in a protected process isolated from the media application.</span></span> <span data-ttu-id="70558-159">L’application a uniquement la possibilité d’échanger des messages de commande et de contrôle avec l’PMP, mais elle n’a pas accès au contenu une fois qu’elle est passée à l’PMP.</span><span class="sxs-lookup"><span data-stu-id="70558-159">The application only has the ability to exchange command and control messages with the PMP, but does not have access to content after it is passed to the PMP.</span></span> <span data-ttu-id="70558-160">Le diagramme suivant illustre ce processus.</span><span class="sxs-lookup"><span data-stu-id="70558-160">The following diagram illustrates this process.</span></span>

![diagramme du chemin d’accès du média protégé](images/pmp04.png)

<span data-ttu-id="70558-162">Les zones ombrées représentent des composants qui peuvent être fournis par des tiers.</span><span class="sxs-lookup"><span data-stu-id="70558-162">Shaded boxes represent components that might be provided by third parties.</span></span> <span data-ttu-id="70558-163">Tous les composants créés à l’intérieur du processus protégé doivent être signés et approuvés.</span><span class="sxs-lookup"><span data-stu-id="70558-163">All components created inside the protected process must be signed and trusted.</span></span>

<span data-ttu-id="70558-164">L’application crée une instance de la session multimédia à l’intérieur du processus protégé et reçoit un pointeur vers une session de média proxy, qui marshale les pointeurs d’interface à travers la limite de processus.</span><span class="sxs-lookup"><span data-stu-id="70558-164">The application creates an instance of the Media Session inside the protected process and receives a pointer to a proxy Media Session, which marshals interface pointers across the process boundary.</span></span>

<span data-ttu-id="70558-165">La source du média peut être créée dans le processus d’application, comme illustré ici, ou à l’intérieur du processus protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-165">The media source can be created either within the application process, as shown here, or inside the protected process.</span></span> <span data-ttu-id="70558-166">Si la source du média est créée à l’intérieur du processus d’application, la source crée un proxy pour lui-même dans le processus protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-166">If the media source is created inside the application process, the source creates a proxy for itself in the protected process.</span></span>

<span data-ttu-id="70558-167">Tous les autres composants de pipeline, tels que les décodeurs et les récepteurs multimédias, sont créés dans le processus protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-167">All other pipeline components, such as decoders and media sinks, are created in the protected process.</span></span> <span data-ttu-id="70558-168">Si ces objets exposent des interfaces personnalisées pour les applications, ils doivent fournir un proxy/stub DCOM pour marshaler l’interface.</span><span class="sxs-lookup"><span data-stu-id="70558-168">If these objects expose any custom interfaces for applications, they must provide a DCOM proxy/stub to marshal the interface.</span></span>

<span data-ttu-id="70558-169">Pour appliquer la stratégie au contenu protégé lorsqu’il transite par le pipeline, le PMP utilise trois types de composants : les autorités d’approbation d’entrée (ITAs), les autorités de confiance de sortie (OTAs) et les objets de stratégie.</span><span class="sxs-lookup"><span data-stu-id="70558-169">To enforce policy on protected content as it flows through the pipeline, the PMP uses three types of components: input trust authorities (ITAs), output trust authorities (OTAs), and policy objects.</span></span> <span data-ttu-id="70558-170">Ces composants fonctionnent ensemble pour accorder ou limiter les droits d’utilisation du contenu, et pour spécifier les protections de liaison qui doivent être utilisées lors de la diffusion de contenu, telles que la fonction de protection du contenu numérique à bande passante élevée (HDCP).</span><span class="sxs-lookup"><span data-stu-id="70558-170">These components work together to grant or restrict rights to use content, and to specify the link protections that must be employed when playing content, such as High-bandwidth Digital Content Protection (HDCP).</span></span>

### <a name="input-trust-authorities"></a><span data-ttu-id="70558-171">Autorités d’approbation d’entrée</span><span class="sxs-lookup"><span data-stu-id="70558-171">Input Trust Authorities</span></span>

<span data-ttu-id="70558-172">Un ITA est créé par une source multimédia approuvée et exécute plusieurs fonctions :</span><span class="sxs-lookup"><span data-stu-id="70558-172">An ITA is created by a trusted media source, and performs several functions:</span></span>

-   <span data-ttu-id="70558-173">Spécifie les droits d’utilisation du contenu.</span><span class="sxs-lookup"><span data-stu-id="70558-173">Specifies rights to use content.</span></span> <span data-ttu-id="70558-174">Les droits peuvent inclure le droit de lire le contenu, le transférer vers un appareil, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="70558-174">Rights can include the right to play content, transfer it to a device, and so on.</span></span> <span data-ttu-id="70558-175">Il définit une liste triée des systèmes de protection de sortie approuvés et les stratégies de sortie correspondantes pour chaque système.</span><span class="sxs-lookup"><span data-stu-id="70558-175">It defines an ordered list of approved output protection systems and the corresponding output policies for each system.</span></span> <span data-ttu-id="70558-176">L’ITA stocke ces informations dans un objet de stratégie.</span><span class="sxs-lookup"><span data-stu-id="70558-176">The ITA stores this information in a policy object.</span></span>
-   <span data-ttu-id="70558-177">Fournit le déchiffreur nécessaire pour déchiffrer le contenu.</span><span class="sxs-lookup"><span data-stu-id="70558-177">Provides the decryptor needed to decrypt the content.</span></span>
-   <span data-ttu-id="70558-178">Établit une relation de confiance avec le module de noyau dans l’environnement protégé pour s’assurer que l’ITA s’exécute dans un environnement approuvé.</span><span class="sxs-lookup"><span data-stu-id="70558-178">Establishes trust with the kernel module in the protected environment, to ensure that the ITA is running inside a trusted environment.</span></span>

<span data-ttu-id="70558-179">Une ITA est associée à un flux individuel contenant du contenu protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-179">An ITA is associated with an individual stream containing protected content.</span></span> <span data-ttu-id="70558-180">Un flux ne peut avoir qu’un seul ITA, et une instance d’ITA ne peut être associée qu’à un seul flux.</span><span class="sxs-lookup"><span data-stu-id="70558-180">A stream can have only one ITA, and an instance of an ITA can be associated with only one stream.</span></span>

### <a name="output-trust-authorities"></a><span data-ttu-id="70558-181">Autorités de confiance de sortie</span><span class="sxs-lookup"><span data-stu-id="70558-181">Output Trust Authorities</span></span>

<span data-ttu-id="70558-182">Un OTA est associé à une sortie approuvée.</span><span class="sxs-lookup"><span data-stu-id="70558-182">An OTA is associated with a trusted output.</span></span> <span data-ttu-id="70558-183">Le OTA expose une action que la sortie approuvée peut effectuer sur le contenu, par exemple la lecture ou la copie.</span><span class="sxs-lookup"><span data-stu-id="70558-183">The OTA exposes an action that the trusted output can perform on the content, such as playback or copying.</span></span> <span data-ttu-id="70558-184">Son rôle consiste à appliquer un ou plusieurs systèmes de protection de sortie requis par l’ITA.</span><span class="sxs-lookup"><span data-stu-id="70558-184">Its role is to enforce one or more output protection systems that are required by the ITA.</span></span> <span data-ttu-id="70558-185">Le OTA interroge l’objet de stratégie fourni par ITA pour déterminer le système de protection qu’il doit appliquer.</span><span class="sxs-lookup"><span data-stu-id="70558-185">The OTA queries the policy object provided by ITA to determine which protection system it must enforce.</span></span>

### <a name="policy-objects"></a><span data-ttu-id="70558-186">Objets de stratégie</span><span class="sxs-lookup"><span data-stu-id="70558-186">Policy Objects</span></span>

<span data-ttu-id="70558-187">Un objet de stratégie encapsule les exigences de protection de contenu d’un ITA.</span><span class="sxs-lookup"><span data-stu-id="70558-187">A policy object encapsulates the content protection requirements of an ITA.</span></span> <span data-ttu-id="70558-188">Il est utilisé par le moteur de stratégie pour négocier la prise en charge de la protection du contenu avec un OTA.</span><span class="sxs-lookup"><span data-stu-id="70558-188">It is used by the policy engine to negotiate content protection support with an OTA.</span></span> <span data-ttu-id="70558-189">OTAs les objets de stratégie de requête pour déterminer les systèmes de protection qu’ils doivent appliquer à chaque sortie du contenu actuel.</span><span class="sxs-lookup"><span data-stu-id="70558-189">OTAs query policy objects to determine what protection systems they must enforce on each output of the current content.</span></span>

### <a name="creating-objects-in-the-pmp"></a><span data-ttu-id="70558-190">Création d’objets dans l’PMP</span><span class="sxs-lookup"><span data-stu-id="70558-190">Creating Objects in the PMP</span></span>

<span data-ttu-id="70558-191">Pour créer un objet dans le chemin d’accès de média protégé (PMP), [**IMFMediaSource**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) appelle [**IMFPMPHostApp :: ActivateClassById**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphostapp-activateclassbyid), avec le **IStream** d’entrée spécifié de la façon suivante :</span><span class="sxs-lookup"><span data-stu-id="70558-191">To create an object in the protected media path (PMP), the [**IMFMediaSource**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) calls [**IMFPMPHostApp::ActivateClassById**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphostapp-activateclassbyid), with the specified input **IStream** formatted in the following way:</span></span>

``` syntax
Format: (All DWORD values are serialized in little-endian order)
[GUID (content protection system guid, obtained from Windows.Media.Protection.MediaProtectionSystemId)]
[DWORD (track count, use the actual track count even if all tracks are encrypted using the same data, note that zero is invalid)]
[DWORD (next track ID, use -1 if all remaining tracks are encrypted using the same data)]
[DWORD (next track's binary data size)]
[BYTE* (next track's binary data)]
{ Repeat from "next track ID" above for each stream }
```

## <a name="overview-of-policy-negotiation"></a><span data-ttu-id="70558-192">Vue d’ensemble de la négociation de stratégie</span><span class="sxs-lookup"><span data-stu-id="70558-192">Overview of Policy Negotiation</span></span>

<span data-ttu-id="70558-193">Trois exigences fondamentales doivent être respectées pour que le contenu protégé puisse être traité dans le PMP.</span><span class="sxs-lookup"><span data-stu-id="70558-193">There are three fundamental requirements that must be met before protected content can be processed in the PMP.</span></span> <span data-ttu-id="70558-194">Tout d’abord, le contenu protégé doit être envoyé uniquement aux sorties approuvées.</span><span class="sxs-lookup"><span data-stu-id="70558-194">First, protected content must be sent only to trusted outputs.</span></span> <span data-ttu-id="70558-195">Deuxièmement, seules les actions autorisées doivent être appliquées à un flux.</span><span class="sxs-lookup"><span data-stu-id="70558-195">Second, only permitted actions must be applied to a stream.</span></span> <span data-ttu-id="70558-196">Troisièmement, seuls les systèmes de protection de sortie approuvés doivent être utilisés pour lire un flux.</span><span class="sxs-lookup"><span data-stu-id="70558-196">Third, only approved output protection systems must be used to play a stream.</span></span> <span data-ttu-id="70558-197">Le moteur de stratégie coordonne entre ITAs et OTAs pour s’assurer que ces exigences sont satisfaites.</span><span class="sxs-lookup"><span data-stu-id="70558-197">The policy engine coordinates between ITAs and OTAs to ensure that these requirements are met.</span></span>

<span data-ttu-id="70558-198">Le moyen le plus simple de comprendre le processus consiste à parcourir un exemple simplifié qui identifie les étapes nécessaires pour lire le contenu ASF (Advanced System format) protégé par Windows Media Digital Rights Management (WMDRM).</span><span class="sxs-lookup"><span data-stu-id="70558-198">The easiest way to understand process is to walk through a simplified example that identifies the steps necessary to play Advanced System Format (ASF) content protected by Windows Media Digital Rights Management (WMDRM).</span></span>

<span data-ttu-id="70558-199">Quand un utilisateur lance une application de lecteur et ouvre un fichier ASF avec un flux audio protégé et un flux vidéo protégé, les étapes suivantes doivent être effectuées :</span><span class="sxs-lookup"><span data-stu-id="70558-199">When a user launches a player application and opens an ASF file that has a protected audio stream and a protected video stream, the following steps must be performed:</span></span>

1.  <span data-ttu-id="70558-200">L’application crée la source de média ASF et la session de chemin d’accès de média protégée (PMP).</span><span class="sxs-lookup"><span data-stu-id="70558-200">The application creates the ASF media source and the protected media path (PMP) session.</span></span> <span data-ttu-id="70558-201">Media Foundation crée un processus PMP.</span><span class="sxs-lookup"><span data-stu-id="70558-201">Media Foundation creates a PMP process.</span></span>
2.  <span data-ttu-id="70558-202">L’application crée une topologie partielle qui contient un nœud source audio connecté au convertisseur audio, et un nœud source vidéo connecté au convertisseur vidéo amélioré (EVR).</span><span class="sxs-lookup"><span data-stu-id="70558-202">The application creates a partial topology that contains an audio source node connected to the audio renderer, and a video source node connected to the enhanced video renderer (EVR).</span></span> <span data-ttu-id="70558-203">Pour les convertisseurs, l’application ne crée pas directement le convertisseur.</span><span class="sxs-lookup"><span data-stu-id="70558-203">For the renderers, the application does not directly create the renderer.</span></span> <span data-ttu-id="70558-204">Au lieu de cela, l’application crée dans le processus non protégé un objet appelé *objet d’activation*.</span><span class="sxs-lookup"><span data-stu-id="70558-204">Instead, the application creates in the unprotected process an object known as an *activation object*.</span></span> <span data-ttu-id="70558-205">Le PMP utilise l’objet d’activation pour créer les convertisseurs dans le processus protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-205">The PMP uses the activation object to create the renderers in the protected process.</span></span> <span data-ttu-id="70558-206">(Pour plus d’informations sur les objets d’activation, consultez [objets d’activation](activation-objects.md).)</span><span class="sxs-lookup"><span data-stu-id="70558-206">(For more information about activation objects, see [Activation Objects](activation-objects.md).)</span></span>
3.  <span data-ttu-id="70558-207">L’application définit la topologie partielle sur la session PMP.</span><span class="sxs-lookup"><span data-stu-id="70558-207">The application sets the partial topology on the PMP session.</span></span>
4.  <span data-ttu-id="70558-208">La session PMP sérialise la topologie et la transmet à l’hôte PMP dans le processus protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-208">The PMP session serializes the topology and passes it to the PMP host in the protected process.</span></span> <span data-ttu-id="70558-209">L’hôte PMP envoie la topologie au moteur de stratégie.</span><span class="sxs-lookup"><span data-stu-id="70558-209">The PMP host sends the topology to the policy engine.</span></span>
5.  <span data-ttu-id="70558-210">Le chargeur de topologie appelle [**IMFInputTrustAuthority :: GetDecrypter**](/windows/desktop/api/mfidl/nf-mfidl-imfinputtrustauthority-getdecrypter) sur le ITAS et insère les déchiffreurs dans la topologie immédiatement en aval des nœuds sources correspondants.</span><span class="sxs-lookup"><span data-stu-id="70558-210">The topology loader calls [**IMFInputTrustAuthority::GetDecrypter**](/windows/desktop/api/mfidl/nf-mfidl-imfinputtrustauthority-getdecrypter) on the ITAs and inserts the decrypters into the topology immediately downstream of the corresponding source nodes.</span></span>
6.  <span data-ttu-id="70558-211">Le chargeur de topologie insère les décodeurs audio et vidéo en aval des nœuds Decrypter.</span><span class="sxs-lookup"><span data-stu-id="70558-211">The topology loader inserts the audio and video decoders downstream of the decrypter nodes.</span></span>
7.  <span data-ttu-id="70558-212">Le moteur de stratégie analyse les nœuds insérés pour déterminer s’ils implémentent l’interface [**IMFTrustedOutput**](/windows/desktop/api/mfidl/nn-mfidl-imftrustedoutput) .</span><span class="sxs-lookup"><span data-stu-id="70558-212">The policy engine scans the inserted nodes to determine whether any implement the [**IMFTrustedOutput**](/windows/desktop/api/mfidl/nn-mfidl-imftrustedoutput) interface.</span></span> <span data-ttu-id="70558-213">Le EVR et le convertisseur audio implémentent tous deux **IMFTrustedOutput**, car ils envoient des données en dehors du PMP.</span><span class="sxs-lookup"><span data-stu-id="70558-213">The EVR and the audio renderer both implement **IMFTrustedOutput**, because they send data outside the PMP.</span></span>
8.  <span data-ttu-id="70558-214">Chaque ITA confirme qu’il s’exécute dans un processus protégé en effectuant une négociation de chiffrement avec un module noyau de l’environnement protégé.</span><span class="sxs-lookup"><span data-stu-id="70558-214">Each ITA confirms that it is running inside a protected process by performing a cryptographic handshake with a protected environment kernel module.</span></span>
9.  <span data-ttu-id="70558-215">Pour chaque flux, le moteur de stratégie négocie la stratégie en obtenant un objet de stratégie de l’ITA et en le passant à OTA.</span><span class="sxs-lookup"><span data-stu-id="70558-215">For each stream, the policy engine negotiates policy by getting a policy object from the ITA and passing it to the OTA.</span></span> <span data-ttu-id="70558-216">Le OTA fournit une liste des systèmes de protection qu’il prend en charge, et l’objet de stratégie indique les systèmes de protection qui doivent être appliqués, ainsi que les paramètres corrects.</span><span class="sxs-lookup"><span data-stu-id="70558-216">The OTA provides a list of the protection systems that it supports, and the policy object indicates which protection systems must be applied, along with the correct settings.</span></span> <span data-ttu-id="70558-217">Le OTA applique ensuite ces paramètres.</span><span class="sxs-lookup"><span data-stu-id="70558-217">The OTA then applies these settings.</span></span> <span data-ttu-id="70558-218">Si ce n’est pas le cas, le contenu est bloqué.</span><span class="sxs-lookup"><span data-stu-id="70558-218">If it cannot do so, the content is blocked.</span></span>

## <a name="revocation-and-renewal"></a><span data-ttu-id="70558-219">Révocation et renouvellement</span><span class="sxs-lookup"><span data-stu-id="70558-219">Revocation and Renewal</span></span>

<span data-ttu-id="70558-220">Un composant approuvé peut être révoqué s’il est compromis ou s’il est découvert comme violant les contrats de licence dans lesquels il a été initialement approuvé.</span><span class="sxs-lookup"><span data-stu-id="70558-220">A trusted component can be revoked if it becomes compromised or is discovered to be violating the license agreements under which it was initially trusted.</span></span> <span data-ttu-id="70558-221">Il existe un mécanisme de renouvellement pour installer une version plus récente et plus fiable du composant.</span><span class="sxs-lookup"><span data-stu-id="70558-221">A renewal mechanism exists to install a newer, more trusted version of the component.</span></span>

<span data-ttu-id="70558-222">Les composants approuvés sont signés à l’aide d’un certificat de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="70558-222">Trusted components are signed using a cryptographic certificate.</span></span> <span data-ttu-id="70558-223">Microsoft publie une liste de révocation globale (GRL) qui identifie les composants qui ont été révoqués.</span><span class="sxs-lookup"><span data-stu-id="70558-223">Microsoft publishes a global revocation list (GRL) which identifies components that have been revoked.</span></span> <span data-ttu-id="70558-224">Le GRL est signé numériquement pour garantir son authenticité.</span><span class="sxs-lookup"><span data-stu-id="70558-224">The GRL is digitally signed to ensure its authenticity.</span></span> <span data-ttu-id="70558-225">Les propriétaires de contenu peuvent garantir, par le biais du mécanisme de stratégie, que la version actuelle du GRL est présente sur l’ordinateur de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="70558-225">Content owners can ensure, through the policy mechanism, that the current version of the GRL is present on the user's computer.</span></span>

## <a name="output-link-protection"></a><span data-ttu-id="70558-226">Protection des liens de sortie</span><span class="sxs-lookup"><span data-stu-id="70558-226">Output Link Protection</span></span>

<span data-ttu-id="70558-227">Quand le contenu vidéo Premium est affiché, les images déchiffrées et non compressées se déplacent sur un connecteur physique du périphérique d’affichage.</span><span class="sxs-lookup"><span data-stu-id="70558-227">When premium video content is viewed, the decrypted, uncompressed frames travel across a physical connector to the display device.</span></span> <span data-ttu-id="70558-228">Les fournisseurs de contenu peuvent exiger que les images vidéo soient protégées à ce stade, lors de leur déplacement sur le connecteur physique.</span><span class="sxs-lookup"><span data-stu-id="70558-228">Content providers may require the video frames to be protected at this point, as they travel across the physical connector.</span></span> <span data-ttu-id="70558-229">Il existe différents mécanismes de protection à cet effet, y compris High-Bandwidth Digital protection du contenu (HDCP) et DisplayPort protection du contenu (DPCP).</span><span class="sxs-lookup"><span data-stu-id="70558-229">Various protection mechanisms exist for this purpose, including High-Bandwidth Digital Content Protection (HDCP) and DisplayPort Content Protection (DPCP).</span></span> <span data-ttu-id="70558-230">La vidéo OTA applique ces protections à l’aide du [Gestionnaire de protection de sortie](output-protection-manager.md) (OPM).</span><span class="sxs-lookup"><span data-stu-id="70558-230">The video OTA enforces these protections by using the [Output Protection Manager](output-protection-manager.md) (OPM).</span></span> <span data-ttu-id="70558-231">Le gestionnaire de protection de sortie envoie des commandes au pilote Graphics, et le pilote Graphics applique tous les mécanismes de protection de liaison requis par la stratégie.</span><span class="sxs-lookup"><span data-stu-id="70558-231">The Output Protection Manager sends commands to the graphics driver, and the graphics driver enforces whatever link protection mechanisms are required by the policy.</span></span>

![diagramme qui montre la relation entre la vidéo OTA et OPM.](images/pmp05.png)

## <a name="related-topics"></a><span data-ttu-id="70558-233">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="70558-233">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="70558-234">À propos de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="70558-234">About Media Foundation</span></span>](about-the-media-foundation-sdk.md)
</dt> <dt>

[<span data-ttu-id="70558-235">Architecture Media Foundation</span><span class="sxs-lookup"><span data-stu-id="70558-235">Media Foundation Architecture</span></span>](media-foundation-architecture.md)
</dt> <dt>

[<span data-ttu-id="70558-236">protection du contenu basé sur GPU</span><span class="sxs-lookup"><span data-stu-id="70558-236">GPU-Based Content Protection</span></span>](gpu-based-content-protection.md)
</dt> <dt>

[<span data-ttu-id="70558-237">Gestionnaire de protection de sortie</span><span class="sxs-lookup"><span data-stu-id="70558-237">Output Protection Manager</span></span>](output-protection-manager.md)
</dt> <dt>

[<span data-ttu-id="70558-238">Session média PMP</span><span class="sxs-lookup"><span data-stu-id="70558-238">PMP Media Session</span></span>](pmp-media-session.md)
</dt> </dl>

 

 
