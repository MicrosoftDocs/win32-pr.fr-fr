---
description: Cette rubrique décrit les améliorations apportées à Windows 8 pour les files d’attente de travail et les threads dans la plateforme Microsoft Media Foundation.
ms.assetid: 9E2A1D94-BF82-488E-8297-D524683ABE17
title: Améliorations de la file d’attente de travail et du thread
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 07b307cb00316696e075e9e9cc2a138e98e149be
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/03/2021
ms.locfileid: "104042962"
---
# <a name="work-queue-and-threading-improvements"></a><span data-ttu-id="d66d5-103">Améliorations de la file d’attente de travail et du thread</span><span class="sxs-lookup"><span data-stu-id="d66d5-103">Work Queue and Threading Improvements</span></span>

<span data-ttu-id="d66d5-104">Cette rubrique décrit les améliorations apportées à Windows 8 pour les files d’attente de travail et les threads dans la plateforme Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="d66d5-104">This topic describes improvements in Windows 8 for work queues and threading in the Microsoft Media Foundation platform.</span></span>

-   [<span data-ttu-id="d66d5-105">Comportement de Windows 7</span><span class="sxs-lookup"><span data-stu-id="d66d5-105">Windows 7 Behavior</span></span>](#windows-7-behavior)
    -   [<span data-ttu-id="d66d5-106">Files d’attente de travail</span><span class="sxs-lookup"><span data-stu-id="d66d5-106">Work Queues</span></span>](#work-queues)
    -   [<span data-ttu-id="d66d5-107">Prise en charge de MMCSS</span><span class="sxs-lookup"><span data-stu-id="d66d5-107">MMCSS Support</span></span>](#mmcss-support)
    -   [<span data-ttu-id="d66d5-108">IMFRealTimeClient</span><span class="sxs-lookup"><span data-stu-id="d66d5-108">IMFRealTimeClient</span></span>](#imfrealtimeclientex)
-   [<span data-ttu-id="d66d5-109">Améliorations de Windows 8</span><span class="sxs-lookup"><span data-stu-id="d66d5-109">Windows 8 Improvements</span></span>](#windows-8-improvements)
    -   [<span data-ttu-id="d66d5-110">Files d’attente de travail multithread</span><span class="sxs-lookup"><span data-stu-id="d66d5-110">Multithreaded Work Queues</span></span>](#multithreaded-work-queues)
    -   [<span data-ttu-id="d66d5-111">Files d’attente de travail des tâches partagées</span><span class="sxs-lookup"><span data-stu-id="d66d5-111">Shared Task Work Queues</span></span>](#shared-task-work-queues)
    -   [<span data-ttu-id="d66d5-112">File d’attente</span><span class="sxs-lookup"><span data-stu-id="d66d5-112">Wait Queue</span></span>](#wait-queue)
    -   [<span data-ttu-id="d66d5-113">Améliorations apportées à la prise en charge de MMCSS</span><span class="sxs-lookup"><span data-stu-id="d66d5-113">Enhancements to MMCSS Support</span></span>](#enhancements-to-mmcss-support)
    -   [<span data-ttu-id="d66d5-114">IMFRealTimeClientEx</span><span class="sxs-lookup"><span data-stu-id="d66d5-114">IMFRealTimeClientEx</span></span>](#imfrealtimeclientex)
    -   [<span data-ttu-id="d66d5-115">Branches de topologie</span><span class="sxs-lookup"><span data-stu-id="d66d5-115">Topology Branches</span></span>](#topology-branches)
-   [<span data-ttu-id="d66d5-116">Recommandations</span><span class="sxs-lookup"><span data-stu-id="d66d5-116">Recommendations</span></span>](#recommendations)
-   [<span data-ttu-id="d66d5-117">Résumé</span><span class="sxs-lookup"><span data-stu-id="d66d5-117">Summary</span></span>](#summary)
-   [<span data-ttu-id="d66d5-118">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="d66d5-118">Related topics</span></span>](#related-topics)

## <a name="windows-7-behavior"></a><span data-ttu-id="d66d5-119">Comportement de Windows 7</span><span class="sxs-lookup"><span data-stu-id="d66d5-119">Windows 7 Behavior</span></span>

<span data-ttu-id="d66d5-120">Cette section résume le comportement de Media Foundation files d’attente de travail dans Windows 7.</span><span class="sxs-lookup"><span data-stu-id="d66d5-120">This section summarizes the behavior of Media Foundation work queues in Windows 7.</span></span>

### <a name="work-queues"></a><span data-ttu-id="d66d5-121">Files d’attente de travail</span><span class="sxs-lookup"><span data-stu-id="d66d5-121">Work Queues</span></span>

<span data-ttu-id="d66d5-122">La plateforme Media Foundation crée plusieurs files d’attente de travail standard.</span><span class="sxs-lookup"><span data-stu-id="d66d5-122">The Media Foundation platform creates several standard work queues.</span></span> <span data-ttu-id="d66d5-123">Seules deux sont documentées comme étant destinées à une utilisation générale des applications :</span><span class="sxs-lookup"><span data-stu-id="d66d5-123">Only two are documented as being for general application use:</span></span>

-   <span data-ttu-id="d66d5-124">**\_ \_ file d’attente de rappel MFASYNC \_ standard**</span><span class="sxs-lookup"><span data-stu-id="d66d5-124">**MFASYNC\_CALLBACK\_QUEUE\_STANDARD**</span></span>
-   <span data-ttu-id="d66d5-125">**\_fonction longue de la \_ file d’attente de rappel MFASYNC \_ \_**</span><span class="sxs-lookup"><span data-stu-id="d66d5-125">**MFASYNC\_CALLBACK\_QUEUE\_LONG\_FUNCTION**</span></span>

<span data-ttu-id="d66d5-126">Une application ou un composant peut allouer de nouvelles files d’attente de travail en appelant [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) ou [**MFAllocateWorkQueueEx**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueueex).</span><span class="sxs-lookup"><span data-stu-id="d66d5-126">An application or component can allocate new work queues by calling [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) or [**MFAllocateWorkQueueEx**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueueex).</span></span> <span data-ttu-id="d66d5-127">La fonction **MFAllocateWorkQueueEx** définit deux types de file d’attente de travail :</span><span class="sxs-lookup"><span data-stu-id="d66d5-127">The **MFAllocateWorkQueueEx** function defines two types of work queue:</span></span>

-   <span data-ttu-id="d66d5-128">**MF \_ \_WORKQUEUE standard** crée une file d’attente de travail sans boucle de message.</span><span class="sxs-lookup"><span data-stu-id="d66d5-128">**MF\_STANDARD\_WORKQUEUE** creates a work queue without a message loop.</span></span>
-   <span data-ttu-id="d66d5-129">**MF \_ La fenêtre \_ WORKQUEUE** crée une file d’attente de travail avec une boucle de message.</span><span class="sxs-lookup"><span data-stu-id="d66d5-129">**MF\_WINDOW\_WORKQUEUE** creates a work queue with a message loop.</span></span>

<span data-ttu-id="d66d5-130">Pour effectuer la mise en file d’attente d’un élément de travail, appelez [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) ou [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span><span class="sxs-lookup"><span data-stu-id="d66d5-130">To queue a work item, call [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) or [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span></span> <span data-ttu-id="d66d5-131">La plateforme exécute l’élément de travail en appelant l’implémentation fournie par l’appelant de [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback).</span><span class="sxs-lookup"><span data-stu-id="d66d5-131">The platform executes the work item by invoking the caller-provided implementation of [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback).</span></span> <span data-ttu-id="d66d5-132">Dans Windows 7 et les versions antérieures, la plateforme crée un thread par file d’attente de travail.</span><span class="sxs-lookup"><span data-stu-id="d66d5-132">In Windows 7 and earlier, the platform creates one thread per work queue.</span></span>

### <a name="mmcss-support"></a><span data-ttu-id="d66d5-133">Prise en charge de MMCSS</span><span class="sxs-lookup"><span data-stu-id="d66d5-133">MMCSS Support</span></span>

<span data-ttu-id="d66d5-134">Le [service Planificateur de classes multimédias](../procthread/multimedia-class-scheduler-service.md) (MMCSS) gère les priorités des threads afin que les applications multimédias reçoivent des tranches régulières du temps processeur, sans refuser les ressources du processeur aux applications de faible priorité.</span><span class="sxs-lookup"><span data-stu-id="d66d5-134">The [Multimedia Class Scheduler Service](../procthread/multimedia-class-scheduler-service.md) (MMCSS) manages thread priorities so that multimedia applications get regular slices of CPU time, without denying CPU resources to lower-priority applications.</span></span> <span data-ttu-id="d66d5-135">MMCSS définit un ensemble de *tâches* qui ont des profils d’utilisation de l’UC différents.</span><span class="sxs-lookup"><span data-stu-id="d66d5-135">MMCSS defines a set of *tasks* that have different CPU utilization profiles.</span></span> <span data-ttu-id="d66d5-136">Quand un thread rejoint une tâche MMCSS, MMCSS définit la priorité du thread en fonction de plusieurs facteurs :</span><span class="sxs-lookup"><span data-stu-id="d66d5-136">When a thread joins an MMCSS task, MMCSS sets the priority of the thread based on several factors:</span></span>

-   <span data-ttu-id="d66d5-137">Priorité de base de la tâche, qui est définie dans le registre.</span><span class="sxs-lookup"><span data-stu-id="d66d5-137">The base priority of the task, which is set in the registry.</span></span>
-   <span data-ttu-id="d66d5-138">Priorité de thread relative, qui est définie au moment de l’exécution en appelant [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span><span class="sxs-lookup"><span data-stu-id="d66d5-138">The relative thread priority, which is set at run time by calling [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span></span>
-   <span data-ttu-id="d66d5-139">Différentes caractéristiques d’exécution, par exemple si l’application est au premier plan, et la quantité de temps processeur consommée par les threads dans chaque classe MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-139">Various run-time characteristics, such as whether the application is in the foreground, and how much CPU time is being consumed by the threads in each MMCSS class.</span></span>

<span data-ttu-id="d66d5-140">Une application peut inscrire une file d’attente de travail avec MMCSS en appelant [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss).</span><span class="sxs-lookup"><span data-stu-id="d66d5-140">An application can register a work queue with MMCSS by calling [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss).</span></span> <span data-ttu-id="d66d5-141">Cette fonction prend un ID de file d’attente de travail, une classe MMCSS (nom de tâche) et l’identificateur de tâche MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-141">This function takes a work queue ID, an MMCSS class (task name), and the MMCSS task identifier.</span></span> <span data-ttu-id="d66d5-142">En interne, il appelle [**AvSetMmThreadCharacteristics**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadcharacteristicsa) avec le nom de tâche et l’ID de tâche.</span><span class="sxs-lookup"><span data-stu-id="d66d5-142">Internally, it calls [**AvSetMmThreadCharacteristics**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadcharacteristicsa) with the task name and task ID.</span></span> <span data-ttu-id="d66d5-143">Une fois qu’une file d’attente de travail est inscrite auprès de MMCSS, vous pouvez obtenir la classe et l’ID de tâche en appelant [**MFGetWorkQueueMMCSSClass**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcssclass) et [**MFGetWorkQueueMMCSSTaskId**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsstaskid).</span><span class="sxs-lookup"><span data-stu-id="d66d5-143">After a work queue is registered with MMCSS, you can get the class and task ID by calling [**MFGetWorkQueueMMCSSClass**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcssclass) and [**MFGetWorkQueueMMCSSTaskId**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsstaskid).</span></span>

<span data-ttu-id="d66d5-144">La [session multimédia](media-session.md) fournit un accès de niveau plus élevé à ces API, via l’interface [**IMFWorkQueueServices**](/windows/desktop/api/mfidl/nn-mfidl-imfworkqueueservices) .</span><span class="sxs-lookup"><span data-stu-id="d66d5-144">The [Media Session](media-session.md) provides somewhat higher-level access to these APIs, through the [**IMFWorkQueueServices**](/windows/desktop/api/mfidl/nn-mfidl-imfworkqueueservices) interface.</span></span> <span data-ttu-id="d66d5-145">Cette interface fournit deux méthodes principales :</span><span class="sxs-lookup"><span data-stu-id="d66d5-145">This interface provides two primary methods:</span></span>

| <span data-ttu-id="d66d5-146">Méthode</span><span class="sxs-lookup"><span data-stu-id="d66d5-146">Method</span></span>                                                                                                            | <span data-ttu-id="d66d5-147">Description</span><span class="sxs-lookup"><span data-stu-id="d66d5-147">Description</span></span>                                                                                                                                                                                                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="d66d5-148">**BeginRegisterPlatformWorkQueueWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="d66d5-148">**BeginRegisterPlatformWorkQueueWithMMCSS**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss)   | <span data-ttu-id="d66d5-149">Inscrit une file d’attente de travail avec une tâche MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-149">Registers a work queue with an MMCSS task.</span></span> <span data-ttu-id="d66d5-150">Cette méthode est essentiellement un wrapper fin autour de [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss), mais vous pouvez passer la valeur MFASYNC de la **\_ \_ file d’attente de rappel \_ All** pour inscrire toutes les files d’attente de travail de la plateforme à la fois.</span><span class="sxs-lookup"><span data-stu-id="d66d5-150">This method is essentially a thin wrapper around [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss), but you can pass the value **MFASYNC\_CALLBACK\_QUEUE\_ALL** to register all of the platform work queues at once.</span></span> |
| [<span data-ttu-id="d66d5-151">**BeginRegisterTopologyWorkQueuesWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="d66d5-151">**BeginRegisterTopologyWorkQueuesWithMMCSS**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) | <span data-ttu-id="d66d5-152">Inscrit une branche de la topologie avec une file d’attente de travail.</span><span class="sxs-lookup"><span data-stu-id="d66d5-152">Registers a branch of the topology with a work queue.</span></span>                                                                                                                                                                                                                                         |



 

<span data-ttu-id="d66d5-153">Pour inscrire une branche de topologie, procédez comme suit.</span><span class="sxs-lookup"><span data-stu-id="d66d5-153">To register a topology branch, do the following.</span></span>

1.  <span data-ttu-id="d66d5-154">Définissez l’attribut [MF \_ TOPONODE \_ WORKQUEUE \_ ID](mf-toponode-workqueue-id-attribute.md) sur le nœud source de la branche.</span><span class="sxs-lookup"><span data-stu-id="d66d5-154">Set the [MF\_TOPONODE\_WORKQUEUE\_ID](mf-toponode-workqueue-id-attribute.md) attribute on the source node for the branch.</span></span> <span data-ttu-id="d66d5-155">Utilisez n’importe quelle valeur définie par l’application.</span><span class="sxs-lookup"><span data-stu-id="d66d5-155">Use any application-defined value.</span></span>
2.  <span data-ttu-id="d66d5-156">Si vous le souhaitez, définissez la **\_ classe MF TOPONODE \_ WORKQUEUE \_ MMCSS \_** pour joindre la file d’attente de travail à une tâche mmcss.</span><span class="sxs-lookup"><span data-stu-id="d66d5-156">Optionally, set the **MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS** to join the work queue to an MMCSS task.</span></span>
3.  <span data-ttu-id="d66d5-157">Appelez [**BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) sur la topologie résolue.</span><span class="sxs-lookup"><span data-stu-id="d66d5-157">Call [**BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) on the resolved topology.</span></span>

<span data-ttu-id="d66d5-158">La session multimédia alloue une nouvelle file d’attente de travail pour chaque valeur unique de l' [ \_ \_ \_ ID MF TOPONODE WORKQUEUE](mf-toponode-workqueue-id-attribute.md).</span><span class="sxs-lookup"><span data-stu-id="d66d5-158">The Media Session allocates a new work queue for each unique value of [MF\_TOPONODE\_WORKQUEUE\_ID](mf-toponode-workqueue-id-attribute.md).</span></span> <span data-ttu-id="d66d5-159">Pour chaque branche de topologie, les opérations de pipeline asynchrones sont effectuées sur la file d’attente de travail qui est assignée à la branche.</span><span class="sxs-lookup"><span data-stu-id="d66d5-159">For each topology branch, asynchronous pipeline operations are performed on the work queue that is assigned to the branch.</span></span>

### <a name="imfrealtimeclient"></a><span data-ttu-id="d66d5-160">IMFRealTimeClient</span><span class="sxs-lookup"><span data-stu-id="d66d5-160">IMFRealTimeClient</span></span>

<span data-ttu-id="d66d5-161">L’interface [**IMFRealTimeClient**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclient) est destinée aux composants de pipeline qui créent leurs propres threads ou utilisent des files d’attente de travail pour les opérations asynchrones.</span><span class="sxs-lookup"><span data-stu-id="d66d5-161">The [**IMFRealTimeClient**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclient) interface is intended for pipeline components that either create their own threads or use work queues for asynchronous operations.</span></span> <span data-ttu-id="d66d5-162">La session multimédia utilise cette interface pour notifier le composant de pipeline du comportement correct, comme suit :</span><span class="sxs-lookup"><span data-stu-id="d66d5-162">The Media Session uses this interface to notify the pipeline component of the correct behavior, as follows:</span></span>

-   <span data-ttu-id="d66d5-163">Si le composant de pipeline crée un thread de travail, la méthode [**IMFRealTimeClient :: RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads) avertit le composant de la classe MMCSS à joindre.</span><span class="sxs-lookup"><span data-stu-id="d66d5-163">If the pipeline component creates a worker thread, the [**IMFRealTimeClient::RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads) method notifies the component which MMCSS class to join.</span></span>
-   <span data-ttu-id="d66d5-164">Si le composant de pipeline utilise une file d’attente de travail, la méthode [**IMFRealTimeClient :: SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue) indique au composant la file d’attente de travail à utiliser.</span><span class="sxs-lookup"><span data-stu-id="d66d5-164">If the pipeline component uses a work queue, the [**IMFRealTimeClient::SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue) method tells the component which work queue to use.</span></span>

<span data-ttu-id="d66d5-165">En règle générale, un composant de pipeline utilise un thread ou une file d’attente de travail pour effectuer des tâches asynchrones, mais pas les deux.</span><span class="sxs-lookup"><span data-stu-id="d66d5-165">Typically, a pipeline component uses either a thread or a work queue to perform asynchronous tasks, but not both.</span></span>

## <a name="windows-8-improvements"></a><span data-ttu-id="d66d5-166">Améliorations de Windows 8</span><span class="sxs-lookup"><span data-stu-id="d66d5-166">Windows 8 Improvements</span></span>

### <a name="multithreaded-work-queues"></a><span data-ttu-id="d66d5-167">Files d’attente de travail multithread</span><span class="sxs-lookup"><span data-stu-id="d66d5-167">Multithreaded Work Queues</span></span>

<span data-ttu-id="d66d5-168">Dans Windows 8, Media Foundation prend en charge un nouveau type de file d’attente de travail appelé *file d’attente multithread*.</span><span class="sxs-lookup"><span data-stu-id="d66d5-168">In Windows 8, Media Foundation supports a new type of work queue called the *multithreaded queue*.</span></span> <span data-ttu-id="d66d5-169">Une file d’attente multithread utilise un pool de threads système pour distribuer des éléments de travail.</span><span class="sxs-lookup"><span data-stu-id="d66d5-169">A multithreaded queue uses a system thread pool to dispatch work items.</span></span> <span data-ttu-id="d66d5-170">La file d’attente multithread est mieux adaptée que les files d’attente monothread précédentes.</span><span class="sxs-lookup"><span data-stu-id="d66d5-170">The multithreaded queue scales better than the previous single-threaded queues.</span></span> <span data-ttu-id="d66d5-171">Par exemple,</span><span class="sxs-lookup"><span data-stu-id="d66d5-171">For example,</span></span>

-   <span data-ttu-id="d66d5-172">Plusieurs composants peuvent partager une file d’attente multithread sans se bloquer l’un l’autre, ce qui nécessite la création de moins de threads.</span><span class="sxs-lookup"><span data-stu-id="d66d5-172">Several components can share a multithreaded queue without blocking one another, requiring the creation of fewer threads.</span></span>

-   <span data-ttu-id="d66d5-173">Les éléments de travail sont optimisés pour éviter les changements de contexte si un événement est déjà défini.</span><span class="sxs-lookup"><span data-stu-id="d66d5-173">Work items are optimized to avoid context switches if an event is already set.</span></span> <span data-ttu-id="d66d5-174">Cela est plus efficace que la création de vos propres threads pour attendre les événements.</span><span class="sxs-lookup"><span data-stu-id="d66d5-174">This is more efficient than creating your own threads to wait on events.</span></span>

<span data-ttu-id="d66d5-175">Quand vous utilisez [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex), les applications doivent éviter de tourner les threads et doivent utiliser les files d’attente de travail.</span><span class="sxs-lookup"><span data-stu-id="d66d5-175">When using [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex), applications should avoid spinning up threads and instead should use the work queues.</span></span> <span data-ttu-id="d66d5-176">Pour ce faire, les applications doivent implémenter [**SetWorkQueueEx**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex) et ne pas utiliser [**RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) et [**UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads).</span><span class="sxs-lookup"><span data-stu-id="d66d5-176">To accomplish this, applications should implement [**SetWorkQueueEx**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex) and not use [**RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) and [**UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads).</span></span>

<span data-ttu-id="d66d5-177">Lorsque la plateforme Media Foundation est initialisée, elle crée une file d’attente multithread avec l’identificateur **MFASYNC de \_ la \_ file \_ d’attente de rappel multithread**.</span><span class="sxs-lookup"><span data-stu-id="d66d5-177">When the Media Foundation platform is initialized, it creates a multithreaded queue with the identifier **MFASYNC\_CALLBACK\_QUEUE\_MULTITHREADED**.</span></span>

<span data-ttu-id="d66d5-178">Une file d’attente multithread ne sérialise pas les éléments de travail.</span><span class="sxs-lookup"><span data-stu-id="d66d5-178">A multithreaded queue does not serialize work items.</span></span> <span data-ttu-id="d66d5-179">Chaque fois qu’un thread du pool de threads devient disponible, l’élément de travail suivant de la file d’attente est distribué.</span><span class="sxs-lookup"><span data-stu-id="d66d5-179">Whenever a thread from the thread pool becomes available, the next work item on the queue is dispatched.</span></span> <span data-ttu-id="d66d5-180">L’appelant doit s’assurer que le travail est correctement sérialisé.</span><span class="sxs-lookup"><span data-stu-id="d66d5-180">The caller must ensure that work is serialized correctly.</span></span> <span data-ttu-id="d66d5-181">Pour faciliter cette opération, Media Foundation définit une *file d’attente de travail en série*.</span><span class="sxs-lookup"><span data-stu-id="d66d5-181">To make this easier, Media Foundation defines a *serial work queue*.</span></span> <span data-ttu-id="d66d5-182">Une file d’attente série encapsule une autre file d’attente de travail, mais garantit une exécution entièrement sérialisée.</span><span class="sxs-lookup"><span data-stu-id="d66d5-182">A serial queue wraps another work queue but guarantees fully serialized execution.</span></span> <span data-ttu-id="d66d5-183">L’élément suivant de la file d’attente n’est pas distribué tant que l’élément précédent n’est pas terminé.</span><span class="sxs-lookup"><span data-stu-id="d66d5-183">The next item on the queue is not dispatched until the previous item completes.</span></span>

<span data-ttu-id="d66d5-184">Le code suivant crée une file d’attente de sérialiseur sur la file d’attente multithread de la plateforme.</span><span class="sxs-lookup"><span data-stu-id="d66d5-184">The following code creates a serializer queue over the platform multithreaded queue.</span></span>


```C++
DWORD workQueueID;
hr = MFAllocateSerialWorkQueue(MFASYNC_CALLBACK_QUEUE_MULTITHREADED, &workQueueID); 
```



<span data-ttu-id="d66d5-185">Plusieurs files d’attente série peuvent encapsuler la même file d’attente multithread.</span><span class="sxs-lookup"><span data-stu-id="d66d5-185">More than one serial queue can wrap the same multithreaded queue.</span></span> <span data-ttu-id="d66d5-186">Les files d’attente série partagent ensuite le même pool de threads, et l’exécution sérialisée est appliquée dans chaque file d’attente.</span><span class="sxs-lookup"><span data-stu-id="d66d5-186">The serial queues then share the same thread pool, and serialized execution is enforced within each queue.</span></span>

<span data-ttu-id="d66d5-187">Les files d’attente de travail standard qui existaient avant Windows 8 sont désormais implémentées en tant que files d’attente de travail en série qui encapsulent la file d’attente multithread de la plateforme.</span><span class="sxs-lookup"><span data-stu-id="d66d5-187">The standard work queues that existed prior to Windows 8 are now implemented as serial work queues that wrap the platform multithreaded queue.</span></span> <span data-ttu-id="d66d5-188">Cette modification préserve la compatibilité descendante.</span><span class="sxs-lookup"><span data-stu-id="d66d5-188">This change preserves backward compatibility.</span></span>

### <a name="shared-task-work-queues"></a><span data-ttu-id="d66d5-189">Files d’attente de travail des tâches partagées</span><span class="sxs-lookup"><span data-stu-id="d66d5-189">Shared Task Work Queues</span></span>

<span data-ttu-id="d66d5-190">Pour fonctionner correctement avec le planificateur de noyau, il doit y avoir une file d’attente de travail multithread pour chaque tâche MMCSS que vous utilisez.</span><span class="sxs-lookup"><span data-stu-id="d66d5-190">To work correctly with the kernel scheduler, there should be one multithreaded work queue for each MMCSS task that you use.</span></span> <span data-ttu-id="d66d5-191">La plate-forme Media Foundation les alloue en fonction des besoins, jusqu’à un par tâche MMCSS, par processus.</span><span class="sxs-lookup"><span data-stu-id="d66d5-191">The Media Foundation platform allocates these as needed, up to one per MMCSS task, per process.</span></span> <span data-ttu-id="d66d5-192">Pour obtenir la file d’attente de travail partagée pour une tâche MMCSS particulière, appelez [**MFLockSharedWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue) et spécifiez le nom de la tâche.</span><span class="sxs-lookup"><span data-stu-id="d66d5-192">To get the shared work queue for a particular MMCSS task, call [**MFLockSharedWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue) and specify the task name.</span></span> <span data-ttu-id="d66d5-193">La fonction recherche le nom de la tâche dans une table.</span><span class="sxs-lookup"><span data-stu-id="d66d5-193">The function looks up the task name in a table.</span></span> <span data-ttu-id="d66d5-194">Si une file d’attente de travail n’existe pas déjà pour cette tâche, la fonction alloue une nouvelle file d’attente de travail MT et la joint immédiatement à la tâche MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-194">If a work queue does not already exist for this task, the function allocates a new MT work queue and immediately joins it to the MMCSS task.</span></span> <span data-ttu-id="d66d5-195">Si une file d’attente de travail existe déjà pour cette tâche, la fonction retourne l’identificateur de la file d’attente de travail existante.</span><span class="sxs-lookup"><span data-stu-id="d66d5-195">If a work queue already exists for that task, the function returns the identifier of the existing work queue.</span></span>

### <a name="wait-queue"></a><span data-ttu-id="d66d5-196">File d’attente</span><span class="sxs-lookup"><span data-stu-id="d66d5-196">Wait Queue</span></span>

<span data-ttu-id="d66d5-197">La *file d'* attente est une file d’attente de travail de plateforme spéciale qui attend les événements à signaler.</span><span class="sxs-lookup"><span data-stu-id="d66d5-197">The *wait queue* is a special platform work queue that waits on events to be signaled.</span></span> <span data-ttu-id="d66d5-198">Si un composant doit attendre qu’un événement soit signalé, il peut utiliser la file d’attente au lieu de créer un thread de travail pour attendre l’événement.</span><span class="sxs-lookup"><span data-stu-id="d66d5-198">If a component needs to wait for an event to be signaled, it can use the wait queue instead of creating a worker thread to wait on the event.</span></span>

<span data-ttu-id="d66d5-199">Pour utiliser la file d’attente, appelez [**MFPutWaitingWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem).</span><span class="sxs-lookup"><span data-stu-id="d66d5-199">To use the wait queue, call [**MFPutWaitingWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem).</span></span> <span data-ttu-id="d66d5-200">Les paramètres incluent le descripteur d’événement et un pointeur [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) .</span><span class="sxs-lookup"><span data-stu-id="d66d5-200">The parameters include the event handle and an [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) pointer.</span></span> <span data-ttu-id="d66d5-201">Lorsque l’événement est signalé, la file d’attente d’attente appelle votre rappel.</span><span class="sxs-lookup"><span data-stu-id="d66d5-201">When the event is signaled, the wait queue invokes your callback.</span></span> <span data-ttu-id="d66d5-202">Il existe une seule file d’attente de la plateforme. les applications ne peuvent pas créer leurs propres files d’attente d’attente.</span><span class="sxs-lookup"><span data-stu-id="d66d5-202">There is a single platform wait queue; applications cannot create their own wait queues.</span></span>

### <a name="enhancements-to-mmcss-support"></a><span data-ttu-id="d66d5-203">Améliorations apportées à la prise en charge de MMCSS</span><span class="sxs-lookup"><span data-stu-id="d66d5-203">Enhancements to MMCSS Support</span></span>

<span data-ttu-id="d66d5-204">Les nouvelles fonctions de plateforme de Media Foundation suivantes sont liées à MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-204">The following new Media Foundation platform functions relate to MMCSS.</span></span>



| <span data-ttu-id="d66d5-205">Fonction</span><span class="sxs-lookup"><span data-stu-id="d66d5-205">Function</span></span>                                                                           | <span data-ttu-id="d66d5-206">Description</span><span class="sxs-lookup"><span data-stu-id="d66d5-206">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="d66d5-207">**MFBeginRegisterWorkQueueWithMMCSSEx**</span><span class="sxs-lookup"><span data-stu-id="d66d5-207">**MFBeginRegisterWorkQueueWithMMCSSEx**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcssex) | <span data-ttu-id="d66d5-208">Inscrit une file d’attente de travail avec MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-208">Registers a work queue with MMCSS.</span></span> <span data-ttu-id="d66d5-209">Cette fonction comprend un paramètre permettant de spécifier la priorité relative des threads.</span><span class="sxs-lookup"><span data-stu-id="d66d5-209">This function includes a parameter to specify relative thread priority.</span></span> <span data-ttu-id="d66d5-210">En interne, cette valeur est convertie en un appel à [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span><span class="sxs-lookup"><span data-stu-id="d66d5-210">Internally, this value is translated into a call to [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span></span>                                                                                                                                                                               |
| [<span data-ttu-id="d66d5-211">**MFGetWorkQueueMMCSSPriority**</span><span class="sxs-lookup"><span data-stu-id="d66d5-211">**MFGetWorkQueueMMCSSPriority**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsspriority)                 | <span data-ttu-id="d66d5-212">Interroge la priorité d’une file d’attente de travail.</span><span class="sxs-lookup"><span data-stu-id="d66d5-212">Queries the priority of a work queue.</span></span>                                                                                                                                                                                                                                                                                                                                                                 |
| [<span data-ttu-id="d66d5-213">**MFRegisterPlatformWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="d66d5-213">**MFRegisterPlatformWithMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfregisterplatformwithmmcss)                 | <span data-ttu-id="d66d5-214">Inscrit toutes les files d’attente de travail de plateforme avec une tâche MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-214">Registers all of the platform work queues with an MMCSS task.</span></span> <span data-ttu-id="d66d5-215">Cette fonction est similaire à la méthode [**IMFWorkQueueServices :: BeginRegisterPlatformWorkQueueWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss) , mais elle peut être utilisée sans créer d’instance de la session multimédia.</span><span class="sxs-lookup"><span data-stu-id="d66d5-215">This function is similar to the [**IMFWorkQueueServices::BeginRegisterPlatformWorkQueueWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss) method, but it can be used without creating an instance of the Media Session.</span></span> <span data-ttu-id="d66d5-216">En outre, la fonction comprend un paramètre pour spécifier la priorité de thread de base.</span><span class="sxs-lookup"><span data-stu-id="d66d5-216">In addition, the function includes a parameter to specify the base thread priority.</span></span> |



 

<span data-ttu-id="d66d5-217">Les applications qui utilisent la session multimédia doivent définir l’attribut de [ \_ classe MF TOPONODE \_ WORKQUEUE \_ MMCSS \_ ](mf-toponode-workqueue-mmcss-class-attribute.md) sur « audio » pour la branche de rendu audio.</span><span class="sxs-lookup"><span data-stu-id="d66d5-217">Applications that use the Media Session should set the [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) attribute to "Audio" for the audio rendering branch.</span></span> <span data-ttu-id="d66d5-218">Affectez à l’attribut la valeur « playback » pour la branche de rendu vidéo.</span><span class="sxs-lookup"><span data-stu-id="d66d5-218">Set the attribute to "Playback" for the video rendering branch.</span></span>

### <a name="imfrealtimeclientex"></a><span data-ttu-id="d66d5-219">IMFRealTimeClientEx</span><span class="sxs-lookup"><span data-stu-id="d66d5-219">IMFRealTimeClientEx</span></span>

<span data-ttu-id="d66d5-220">L’interface [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex) pour remplacer IMFRealTimeClient, pour les composants de pipeline qui effectuent des opérations asynchrones.</span><span class="sxs-lookup"><span data-stu-id="d66d5-220">The [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex) interface to replaces IMFRealTimeClient, for pipeline components that perform asynchronous operations.</span></span>



| <span data-ttu-id="d66d5-221">Méthode</span><span class="sxs-lookup"><span data-stu-id="d66d5-221">Method</span></span>                                                             | <span data-ttu-id="d66d5-222">Description</span><span class="sxs-lookup"><span data-stu-id="d66d5-222">Description</span></span>                                                                                                                                                                                                                    |
|--------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="d66d5-223">**RegisterThreadsEx**</span><span class="sxs-lookup"><span data-stu-id="d66d5-223">**RegisterThreadsEx**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) | <span data-ttu-id="d66d5-224">Notifie le composant d’inscrire ses threads avec MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-224">Notifies the component to register its threads with MMCSS.</span></span> <span data-ttu-id="d66d5-225">Cette méthode est équivalente à [**IMFRealTimeClient :: RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads), mais elle ajoute un paramètre pour la priorité de thread de base.</span><span class="sxs-lookup"><span data-stu-id="d66d5-225">This method is equivalent to [**IMFRealTimeClient::RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads), but it adds a parameter for the base thread priority.</span></span> |
| [<span data-ttu-id="d66d5-226">**SetWorkQueueEx**</span><span class="sxs-lookup"><span data-stu-id="d66d5-226">**SetWorkQueueEx**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex)       | <span data-ttu-id="d66d5-227">Notifie le composant d’utiliser une file d’attente de travail spécifique.</span><span class="sxs-lookup"><span data-stu-id="d66d5-227">Notifies the component to use a specific work queue.</span></span> <span data-ttu-id="d66d5-228">Cette méthode est équivalente à [**IMFReadTimeClient :: SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue), mais elle ajoute un paramètre pour la priorité de l’élément de travail.</span><span class="sxs-lookup"><span data-stu-id="d66d5-228">This method is equivalent to [**IMFReadTimeClient::SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue), but it adds a parameter for the work item priority.</span></span>               |
| [<span data-ttu-id="d66d5-229">**UnregisterThreads**</span><span class="sxs-lookup"><span data-stu-id="d66d5-229">**UnregisterThreads**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads) | <span data-ttu-id="d66d5-230">Indique au composant d’annuler l’inscription de ses threads dans MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-230">Notifies the component to unregister its threads from MMCSS.</span></span> <span data-ttu-id="d66d5-231">Cette méthode est identique à la méthode [**IMFRealTimeClient :: UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-unregisterthreads) .</span><span class="sxs-lookup"><span data-stu-id="d66d5-231">This method is identical to the [**IMFRealTimeClient::UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-unregisterthreads) method.</span></span>                                       |



 

<span data-ttu-id="d66d5-232">Les composants de pipeline doivent utiliser des files d’attente de travail et ne doivent pas créer de threads de travail, pour les raisons suivantes :</span><span class="sxs-lookup"><span data-stu-id="d66d5-232">Pipeline components should use work queues, and should not create worker threads, for the following reasons:</span></span>

-   <span data-ttu-id="d66d5-233">Les files d’attente de travail évoluent mieux, car elles utilisent les pools de threads du système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="d66d5-233">Work queues scale better, because they use the OS thread pools.</span></span>
-   <span data-ttu-id="d66d5-234">La plateforme gère les détails de l’inscription des files d’attente de travail avec MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-234">The platform handles the details of registering work queues with MMCSS.</span></span>
-   <span data-ttu-id="d66d5-235">Un thread de travail peut facilement provoquer un blocage difficile à déboguer.</span><span class="sxs-lookup"><span data-stu-id="d66d5-235">A worker thread can easily cause a deadlock that is hard to debug.</span></span>

<span data-ttu-id="d66d5-236">En outre, envisagez d’utiliser la file d’attente de travail du sérialiseur si vous devez sérialiser vos opérations asynchrones.</span><span class="sxs-lookup"><span data-stu-id="d66d5-236">Also, consider using the serializer work queue if you need to serialize your asynchronous operations.</span></span>

### <a name="topology-branches"></a><span data-ttu-id="d66d5-237">Branches de topologie</span><span class="sxs-lookup"><span data-stu-id="d66d5-237">Topology Branches</span></span>

<span data-ttu-id="d66d5-238">Si l’attribut de [ \_ classe TOPONODE MF \_ WORKQUEUE \_ MMCSS \_ ](mf-toponode-workqueue-mmcss-class-attribute.md) inscrit une branche de topologie avec MMCSS, dans Windows 8, la session multimédia utilise les files d’attente de travail MT partagées.</span><span class="sxs-lookup"><span data-stu-id="d66d5-238">If the [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) attribute registers a topology branch with MMCSS, in Windows 8 the Media Session uses the shared MT work queues.</span></span> <span data-ttu-id="d66d5-239">Dans les versions antérieures de Windows, la session multimédia a alloué une nouvelle file d’attente de travail.</span><span class="sxs-lookup"><span data-stu-id="d66d5-239">In earlier versions of Windows, the Media Session allocated a new work queue.</span></span>

<span data-ttu-id="d66d5-240">Deux nouveaux attributs sont définis pour inscrire une branche de topologie avec MMCSS.</span><span class="sxs-lookup"><span data-stu-id="d66d5-240">Two new attributes are defined for registering a topology branch with MMCSS.</span></span>



| <span data-ttu-id="d66d5-241">Attribut</span><span class="sxs-lookup"><span data-stu-id="d66d5-241">Attribute</span></span>                                                                            | <span data-ttu-id="d66d5-242">Description</span><span class="sxs-lookup"><span data-stu-id="d66d5-242">Description</span></span>                         |
|--------------------------------------------------------------------------------------|-------------------------------------|
| [<span data-ttu-id="d66d5-243">MF \_ TOPONODE \_ WORKQUEUE \_ MMCSS \_ Priority</span><span class="sxs-lookup"><span data-stu-id="d66d5-243">MF\_TOPONODE\_WORKQUEUE\_MMCSS\_PRIORITY</span></span>](mf-toponode-workqueue-mmcss-priority.md) | <span data-ttu-id="d66d5-244">Spécifie la priorité de thread de base.</span><span class="sxs-lookup"><span data-stu-id="d66d5-244">Specifies the base thread priority.</span></span> |
| [<span data-ttu-id="d66d5-245">\_priorité de \_ l' \_ élément WORKQUEUE TOPONODE \_ MF</span><span class="sxs-lookup"><span data-stu-id="d66d5-245">MF\_TOPONODE\_WORKQUEUE\_ITEM\_PRIORITY</span></span>](mf-toponode-workqueue-item-priority.md)   | <span data-ttu-id="d66d5-246">Spécifie la priorité de l’élément de travail.</span><span class="sxs-lookup"><span data-stu-id="d66d5-246">Specifies the work item priority.</span></span>   |



 

## <a name="recommendations"></a><span data-ttu-id="d66d5-247">Recommandations</span><span class="sxs-lookup"><span data-stu-id="d66d5-247">Recommendations</span></span>

-   <span data-ttu-id="d66d5-248">Les applications qui utilisent la session multimédia doivent définir la [ \_ classe MF TOPONODE \_ WORKQUEUE \_ MMCSS \_ ](mf-toponode-workqueue-mmcss-class-attribute.md) sur « audio » pour la branche de rendu audio et la « lecture » pour la branche de rendu vidéo.</span><span class="sxs-lookup"><span data-stu-id="d66d5-248">Applications that use the Media Session should set [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) to "Audio" for the audio rendering branch and "Playback" for the video rendering branch.</span></span>
-   <span data-ttu-id="d66d5-249">Les applications qui utilisent la session multimédia doivent appeler [**IMFWorkQueueServices :: BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) sur la topologie.</span><span class="sxs-lookup"><span data-stu-id="d66d5-249">Applications that use the Media Session should call [**IMFWorkQueueServices::BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) on the topology.</span></span>
-   <span data-ttu-id="d66d5-250">Pour les composants de pipeline, les files d’attente de travail sont recommandées plutôt que les threads de travail.</span><span class="sxs-lookup"><span data-stu-id="d66d5-250">For pipeline components, work queues are recommended instead of worker threads.</span></span> <span data-ttu-id="d66d5-251">Si le composant utilise des files d’attente de travail ou des threads de travail, implémentez [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex).</span><span class="sxs-lookup"><span data-stu-id="d66d5-251">If the component uses either work queues or worker threads, implement [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex).</span></span>
-   <span data-ttu-id="d66d5-252">Ne créez pas de files d’attente de travail privées, car cela a pour effet de détourner l’objectif des files d’attente de travail de la plateforme.</span><span class="sxs-lookup"><span data-stu-id="d66d5-252">Do not create private work queues, as this defeats the purpose of the platform work queues.</span></span> <span data-ttu-id="d66d5-253">Utilisez la file d’attente multithread de la plateforme ou une file d’attente série qui encapsule la file d’attente multithread de la plateforme.</span><span class="sxs-lookup"><span data-stu-id="d66d5-253">Use either the platform multithreaded queue or a serial queue that wraps the platform multithreaded queue.</span></span>
-   <span data-ttu-id="d66d5-254">Si vous devez sérialiser des opérations asynchrones, utilisez une file d’attente série.</span><span class="sxs-lookup"><span data-stu-id="d66d5-254">If you need to serialize asynchronous operations, use a serial queue.</span></span>

## <a name="summary"></a><span data-ttu-id="d66d5-255">Résumé</span><span class="sxs-lookup"><span data-stu-id="d66d5-255">Summary</span></span>

<span data-ttu-id="d66d5-256">Les API de plateforme de Media Foundation suivantes relatives aux threads et aux files d’attente de travail sont nouvelles pour Windows 8.</span><span class="sxs-lookup"><span data-stu-id="d66d5-256">The following Media Foundation platform APIs that relate to threads and work queues are new for Windows 8.</span></span>

-   [<span data-ttu-id="d66d5-257">\_priorité de \_ l' \_ élément WORKQUEUE TOPONODE \_ MF</span><span class="sxs-lookup"><span data-stu-id="d66d5-257">MF\_TOPONODE\_WORKQUEUE\_ITEM\_PRIORITY</span></span>](mf-toponode-workqueue-item-priority.md)
-   [<span data-ttu-id="d66d5-258">MF \_ TOPONODE \_ WORKQUEUE \_ MMCSS \_ Priority</span><span class="sxs-lookup"><span data-stu-id="d66d5-258">MF\_TOPONODE\_WORKQUEUE\_MMCSS\_PRIORITY</span></span>](mf-toponode-workqueue-mmcss-priority.md)
-   [<span data-ttu-id="d66d5-259">**MFAllocateSerialWorkQueue**</span><span class="sxs-lookup"><span data-stu-id="d66d5-259">**MFAllocateSerialWorkQueue**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfallocateserialworkqueue)
-   [<span data-ttu-id="d66d5-260">**MFBeginRegisterWorkQueueWithMMCSSEx**</span><span class="sxs-lookup"><span data-stu-id="d66d5-260">**MFBeginRegisterWorkQueueWithMMCSSEx**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcssex)
-   [<span data-ttu-id="d66d5-261">**MFGetWorkQueueMMCSSPriority**</span><span class="sxs-lookup"><span data-stu-id="d66d5-261">**MFGetWorkQueueMMCSSPriority**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsspriority)
-   [<span data-ttu-id="d66d5-262">**MFPutWaitingWorkItem**</span><span class="sxs-lookup"><span data-stu-id="d66d5-262">**MFPutWaitingWorkItem**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem)
-   [<span data-ttu-id="d66d5-263">**MFPutWorkItem2**</span><span class="sxs-lookup"><span data-stu-id="d66d5-263">**MFPutWorkItem2**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem2)
-   [<span data-ttu-id="d66d5-264">**MFPutWorkItemEx2**</span><span class="sxs-lookup"><span data-stu-id="d66d5-264">**MFPutWorkItemEx2**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex2)
-   [<span data-ttu-id="d66d5-265">**MFRegisterPlatformWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="d66d5-265">**MFRegisterPlatformWithMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfregisterplatformwithmmcss)
-   [<span data-ttu-id="d66d5-266">**MFUnregisterPlatformFromMMCSS**</span><span class="sxs-lookup"><span data-stu-id="d66d5-266">**MFUnregisterPlatformFromMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfunregisterplatformfrommmcss)
-   [<span data-ttu-id="d66d5-267">**MFLockSharedWorkQueue**</span><span class="sxs-lookup"><span data-stu-id="d66d5-267">**MFLockSharedWorkQueue**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue)
-   [<span data-ttu-id="d66d5-268">**IMFRealTimeClientEx**</span><span class="sxs-lookup"><span data-stu-id="d66d5-268">**IMFRealTimeClientEx**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex)

## <a name="related-topics"></a><span data-ttu-id="d66d5-269">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="d66d5-269">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d66d5-270">Files d’attente de travail</span><span class="sxs-lookup"><span data-stu-id="d66d5-270">Work Queues</span></span>](work-queues.md)
</dt> </dl>

 

 
