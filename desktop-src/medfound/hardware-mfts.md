---
description: Cette rubrique explique comment écrire une Media Foundation transformation (MFT) qui agit en tant que proxy à un encodeur, à un décodeur ou à un processeur de signal numérique (DSP) matériel.
ms.assetid: 9922d403-5d0d-433f-ad9f-c86142ac0f46
title: Matériel MFTs
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ac5ce05b4fdad6040b51f66f543c1737fc3918d2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104201804"
---
# <a name="hardware-mfts"></a><span data-ttu-id="4d608-103">Matériel MFTs</span><span class="sxs-lookup"><span data-stu-id="4d608-103">Hardware MFTs</span></span>

> [!Note]  
> <span data-ttu-id="4d608-104">Cette rubrique s’applique à Windows 7 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="4d608-104">This topic applies to Windows 7 or later.</span></span>

 

<span data-ttu-id="4d608-105">Cette rubrique explique comment écrire une Media Foundation transformation (MFT) qui agit en tant que proxy à un encodeur, à un décodeur ou à un processeur de signal numérique (DSP) matériel.</span><span class="sxs-lookup"><span data-stu-id="4d608-105">This topic describes how to write a Media Foundation transform (MFT) that acts as a proxy to a hardware encoder, decoder, or digital signal processor (DSP).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4d608-106">Si un codec matériel utilise le pilote de classe multimédia AVStream, il ne nécessite pas de MFT personnalisé.</span><span class="sxs-lookup"><span data-stu-id="4d608-106">If a hardware codec uses the AVStream multimedia class driver, it does not require a custom MFT.</span></span> <span data-ttu-id="4d608-107">Media Foundation fournit un proxy AVStream à cet effet.</span><span class="sxs-lookup"><span data-stu-id="4d608-107">Media Foundation provides an AVStream proxy for this purpose.</span></span> <span data-ttu-id="4d608-108">Les informations contenues dans cette rubrique s’appliquent uniquement dans le cas particulier où le codec matériel n’utilise pas AVStream.</span><span class="sxs-lookup"><span data-stu-id="4d608-108">The information in this topic applies only in the special case where the hardware codec does not use AVStream.</span></span> <span data-ttu-id="4d608-109">Pour plus d’informations, consultez [prise en charge du codec matériel dans AVStream](https://msdn.microsoft.com/library/dd568169.aspx).</span><span class="sxs-lookup"><span data-stu-id="4d608-109">For more information, see [Hardware Codec Support in AVStream](https://msdn.microsoft.com/library/dd568169.aspx).</span></span>

 

<span data-ttu-id="4d608-110">Cette rubrique contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="4d608-110">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="4d608-111">Introduction</span><span class="sxs-lookup"><span data-stu-id="4d608-111">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="4d608-112">Attributs MFT du matériel</span><span class="sxs-lookup"><span data-stu-id="4d608-112">Hardware MFT Attributes</span></span>](#hardware-mft-attributes)
-   [<span data-ttu-id="4d608-113">Séquence de négociation matérielle</span><span class="sxs-lookup"><span data-stu-id="4d608-113">Hardware Handshake Sequence</span></span>](#hardware-handshake-sequence)
-   [<span data-ttu-id="4d608-114">Traitement des données</span><span class="sxs-lookup"><span data-stu-id="4d608-114">Data Processing</span></span>](#data-processing)
-   [<span data-ttu-id="4d608-115">Décodeur/encodeur couplé</span><span class="sxs-lookup"><span data-stu-id="4d608-115">Paired Decoder/Encoder</span></span>](#paired-decoderencoder)
-   [<span data-ttu-id="4d608-116">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="4d608-116">Related topics</span></span>](#related-topics)

## <a name="introduction"></a><span data-ttu-id="4d608-117">Introduction</span><span class="sxs-lookup"><span data-stu-id="4d608-117">Introduction</span></span>

<span data-ttu-id="4d608-118">Tout codec matériel qui n’est pas basé sur AVStream doit fournir sa propre table MFT pour agir en tant que proxy du pilote.</span><span class="sxs-lookup"><span data-stu-id="4d608-118">Any hardware codec that is not based on AVStream must provide its own MFT to act as a proxy to the driver.</span></span> <span data-ttu-id="4d608-119">Un codec matériel peut incorporer plusieurs blocs fonctionnels distincts :</span><span class="sxs-lookup"><span data-stu-id="4d608-119">A hardware codec might incorporate several distinct functional blocks:</span></span>

-   <span data-ttu-id="4d608-120">Encodeur</span><span class="sxs-lookup"><span data-stu-id="4d608-120">Encoder</span></span>
-   <span data-ttu-id="4d608-121">Décodeur</span><span class="sxs-lookup"><span data-stu-id="4d608-121">Decoder</span></span>
-   <span data-ttu-id="4d608-122">Mise à l’échelle des frames/conversion de format</span><span class="sxs-lookup"><span data-stu-id="4d608-122">Frame scaling/format conversion</span></span>

<span data-ttu-id="4d608-123">Chacune de ces fonctions doit être gérée par une table MFT distincte.</span><span class="sxs-lookup"><span data-stu-id="4d608-123">Each of these functions should be managed by a separate MFT.</span></span> <span data-ttu-id="4d608-124">Une table MFT matérielle ne doit jamais jouer le rôle d’un « transcodeur polyvalent ».</span><span class="sxs-lookup"><span data-stu-id="4d608-124">A hardware MFT should never act as a multi-purpose "transcoder."</span></span> <span data-ttu-id="4d608-125">Au lieu de cela, placez les fonctions d’encodage dans un encodeur MFT et décodez les fonctions dans une table MFT de décodage.</span><span class="sxs-lookup"><span data-stu-id="4d608-125">Instead, put encoding functions into an encoder MFT and decoding functions into a decoder MFT.</span></span> <span data-ttu-id="4d608-126">Si le matériel offre des conversions de format et de mise à l’échelle des frames, placez ces fonctions dans un processeur vidéo distinct, inscrit dans la catégorie de **\_ \_ \_ processeur vidéo de catégorie MFT** .</span><span class="sxs-lookup"><span data-stu-id="4d608-126">If the hardware offers frame scaling and format conversions, place those functions in a separate video processor, registered in the **MFT\_CATEGORY\_VIDEO\_PROCESSOR** category.</span></span> <span data-ttu-id="4d608-127">Si le matériel ne prend pas en charge la mise à l’échelle des cadres ou la conversion de format, Media Foundation fournit un processeur vidéo logiciel.</span><span class="sxs-lookup"><span data-stu-id="4d608-127">If the hardware does not support frame scaling or format conversion, Media Foundation provides a software video processor.</span></span>

<span data-ttu-id="4d608-128">Les MFTs matériels présentent les conditions générales suivantes :</span><span class="sxs-lookup"><span data-stu-id="4d608-128">Hardware MFTs have the following general requirements:</span></span>

-   <span data-ttu-id="4d608-129">Le matériel MFTs doit utiliser le nouveau modèle de traitement asynchrone, comme décrit dans [MFTS asynchrone](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="4d608-129">Hardware MFTs must use the new asynchronous processing model, as described in [Asynchronous MFTs](asynchronous-mfts.md).</span></span>
-   <span data-ttu-id="4d608-130">Le matériel MFTs doit prendre en charge les modifications de format dynamique, comme décrit dans [modifications de format dynamique](basic-mft-processing-model.md).</span><span class="sxs-lookup"><span data-stu-id="4d608-130">Hardware MFTs must support dynamic format changes, as described in [Dynamic Format Changes](basic-mft-processing-model.md).</span></span>

## <a name="hardware-mft-attributes"></a><span data-ttu-id="4d608-131">Attributs MFT du matériel</span><span class="sxs-lookup"><span data-stu-id="4d608-131">Hardware MFT Attributes</span></span>

<span data-ttu-id="4d608-132">Une table MFT matérielle doit implémenter les méthodes suivantes liées aux attributs :</span><span class="sxs-lookup"><span data-stu-id="4d608-132">A hardware MFT must implement following methods related to attributes:</span></span>

-   <span data-ttu-id="4d608-133">[**IMFTransform :: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes): retourne un magasin d’attributs pour les attributs MFT globaux.</span><span class="sxs-lookup"><span data-stu-id="4d608-133">[**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes): Returns an attribute store for global MFT attributes.</span></span>
-   <span data-ttu-id="4d608-134">[**IMFTransform :: GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes): retourne un magasin d’attributs pour un flux d’entrée.</span><span class="sxs-lookup"><span data-stu-id="4d608-134">[**IMFTransform::GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes): Returns an attribute store for an input stream.</span></span>
-   <span data-ttu-id="4d608-135">[**IMFTransform :: GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes): retourne un magasin d’attributs pour un flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="4d608-135">[**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes): Returns an attribute store for an output stream.</span></span>

<span data-ttu-id="4d608-136">Lorsque la table MFT est créée pour la première fois, elle doit définir les attributs suivants sur son propre magasin d’attributs global (autrement dit, le magasin d’attributs retourné par [**GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes)) :</span><span class="sxs-lookup"><span data-stu-id="4d608-136">When the MFT is first created, it must set the following attributes on its own global attribute store (that is, the attribute store returned by [**GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes)):</span></span>



| <span data-ttu-id="4d608-137">Attribut</span><span class="sxs-lookup"><span data-stu-id="4d608-137">Attribute</span></span>                                                                                    | <span data-ttu-id="4d608-138">Description</span><span class="sxs-lookup"><span data-stu-id="4d608-138">Description</span></span>                                                                                                                                                                            |
|----------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="4d608-139">\_transformation MF \_ asynchrone</span><span class="sxs-lookup"><span data-stu-id="4d608-139">MF\_TRANSFORM\_ASYNC</span></span>](mf-transform-async.md)                                               | <span data-ttu-id="4d608-140">Doit avoir la valeur **true**.</span><span class="sxs-lookup"><span data-stu-id="4d608-140">Must be set to **TRUE**.</span></span> <span data-ttu-id="4d608-141">Indique que la table MFT effectue un traitement asynchrone.</span><span class="sxs-lookup"><span data-stu-id="4d608-141">Indicates that the MFT performs asynchronous processing.</span></span>                                                                                                      |
| [<span data-ttu-id="4d608-142">Attribut de l' \_ \_ URL matérielle de l’ÉNUMÉRation MFT \_ \_</span><span class="sxs-lookup"><span data-stu-id="4d608-142">MFT\_ENUM\_HARDWARE\_URL\_Attribute</span></span>](mft-enum-hardware-url-attribute.md)                   | <span data-ttu-id="4d608-143">Contient le lien symbolique pour le périphérique matériel.</span><span class="sxs-lookup"><span data-stu-id="4d608-143">Contains the symbolic link for the hardware device.</span></span><br/> <span data-ttu-id="4d608-144">Le chargeur de topologie utilise la présence de cet attribut pour déterminer si un MFT représente un périphérique matériel.</span><span class="sxs-lookup"><span data-stu-id="4d608-144">The topology loader uses the presence of this attribute to test whether an MFT represents a hardware device.</span></span><br/> |
| [<span data-ttu-id="4d608-145">**\_modification du \_ format dynamique de la prise en charge de \_ MFT \_**</span><span class="sxs-lookup"><span data-stu-id="4d608-145">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**</span></span>](mft-support-dynamic-format-change-attribute.md) | <span data-ttu-id="4d608-146">Doit avoir la valeur **true**.</span><span class="sxs-lookup"><span data-stu-id="4d608-146">Must be set to **TRUE**.</span></span> <span data-ttu-id="4d608-147">Indique que la table MFT prend en charge les modifications de format dynamiques.</span><span class="sxs-lookup"><span data-stu-id="4d608-147">Indicates that the MFT supports dynamic format changes.</span></span>                                                                                                       |



 

## <a name="hardware-handshake-sequence"></a><span data-ttu-id="4d608-148">Séquence de négociation matérielle</span><span class="sxs-lookup"><span data-stu-id="4d608-148">Hardware Handshake Sequence</span></span>

<span data-ttu-id="4d608-149">Si deux MFTs représentent le même appareil physique, ils peuvent échanger des données au sein du matériel, par exemple sur un bus matériel.</span><span class="sxs-lookup"><span data-stu-id="4d608-149">If two MFTs represent the same physical device, they can exchange data within the hardware—for example, over a hardware bus.</span></span> <span data-ttu-id="4d608-150">Il n’est pas nécessaire de copier les données dans la mémoire système, puis de les replacer sur l’appareil.</span><span class="sxs-lookup"><span data-stu-id="4d608-150">There is no need to copy the data into system memory and then back to the device.</span></span>

<span data-ttu-id="4d608-151">Dans le diagramme suivant, le MFTs intitulé « A » et « B » représentent des blocs fonctionnels au sein du même matériel.</span><span class="sxs-lookup"><span data-stu-id="4d608-151">In the following diagram, the MFTs labeled "A" and "B" represent functional blocks within the same hardware.</span></span> <span data-ttu-id="4d608-152">Par exemple, dans un scénario de transcodage, « A » peut représenter un décodeur matériel et « B » peut représenter un encodeur matériel.</span><span class="sxs-lookup"><span data-stu-id="4d608-152">For example, in a transcoding scenario, "A" might represent a hardware decoder and "B" might represent a hardware encoder.</span></span> <span data-ttu-id="4d608-153">Le passage de données entre « A » et « B » se produit au sein du matériel.</span><span class="sxs-lookup"><span data-stu-id="4d608-153">The data flow between "A" and "B" occurs within the hardware.</span></span> <span data-ttu-id="4d608-154">La table MFT intitulée « C » est une table MFT de logiciel.</span><span class="sxs-lookup"><span data-stu-id="4d608-154">The MFT labeled "C" is a software MFT.</span></span> <span data-ttu-id="4d608-155">Le passage de données de « B » à « C » utilise la mémoire système.</span><span class="sxs-lookup"><span data-stu-id="4d608-155">Data flow from "B" to "C" uses system memory.</span></span>

![Diagramme montrant des zones étiquetées a à c et un codec matériel : un point vers b et le codec, le codec pointe vers b et b pointe vers c](images/proxy-mft.png)

<span data-ttu-id="4d608-157">Pour établir une connexion matérielle, les deux MFTs matériels doivent utiliser un canal de communication privé.</span><span class="sxs-lookup"><span data-stu-id="4d608-157">To establish a hardware connection, the two hardware MFTs must use a private communication channel.</span></span> <span data-ttu-id="4d608-158">Cette connexion est établie lors de la négociation de format, avant que les types de média ne soient définis et avant le premier appel à [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="4d608-158">This connection is established during format negotiation, before the media types are set and before the first call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span> <span data-ttu-id="4d608-159">Le processus de connexion fonctionne comme suit :</span><span class="sxs-lookup"><span data-stu-id="4d608-159">The connection process works as follows:</span></span>

1.  <span data-ttu-id="4d608-160">Le chargeur de topologie vérifie à la fois MFTs la présence de l’attribut d' [ \_ \_ \_ \_ attribut d’URL matériel de l’énumération MFT](mft-enum-hardware-url-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="4d608-160">The topology loader checks both MFTs for the presence of the [MFT\_ENUM\_HARDWARE\_URL\_Attribute](mft-enum-hardware-url-attribute.md) attribute.</span></span> <span data-ttu-id="4d608-161">Notez qu’elle n’examine pas la valeur de cet attribut.</span><span class="sxs-lookup"><span data-stu-id="4d608-161">Note that it does not examine the value of this attribute.</span></span>
2.  <span data-ttu-id="4d608-162">Si l’attribut de l' [ \_ \_ \_ \_ URL matérielle de l’énumération MFT](mft-enum-hardware-url-attribute.md) est présent sur les deux MFTS, le chargeur de topologie effectue les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="4d608-162">If [MFT\_ENUM\_HARDWARE\_URL\_Attribute](mft-enum-hardware-url-attribute.md) is present on both MFTs, the topology loader does the following:</span></span>
    1.  <span data-ttu-id="4d608-163">Le chargeur de topologie appelle [**IMFTransform :: GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes) sur la table MFT en amont (A).</span><span class="sxs-lookup"><span data-stu-id="4d608-163">The topology loader calls [**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes) on the upstream MFT (A).</span></span> <span data-ttu-id="4d608-164">Cette méthode retourne un pointeur [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) .</span><span class="sxs-lookup"><span data-stu-id="4d608-164">This method returns an [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer.</span></span> <span data-ttu-id="4d608-165">Laissez ce pointeur dénoté *pUpstream*.</span><span class="sxs-lookup"><span data-stu-id="4d608-165">Let this pointer be denoted *pUpstream*.</span></span>
    2.  <span data-ttu-id="4d608-166">Le chargeur de topologie appelle [**IMFTransform :: GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes) sur la MFT en aval (B).</span><span class="sxs-lookup"><span data-stu-id="4d608-166">The topology loader calls [**IMFTransform::GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes) on the downstream MFT (B).</span></span> <span data-ttu-id="4d608-167">Cet appel retourne également un pointeur [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) .</span><span class="sxs-lookup"><span data-stu-id="4d608-167">This call also returns an [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer.</span></span> <span data-ttu-id="4d608-168">Laissez ce pointeur dénoté *pDownstream*.</span><span class="sxs-lookup"><span data-stu-id="4d608-168">Let this pointer be denoted *pDownstream*.</span></span>
    3.  <span data-ttu-id="4d608-169">Le chargeur de topologie définit l’attribut [d' \_ \_ \_ attribut de flux connecté MFT](mft-connected-stream-attribute.md) sur *PDownstream* en appelant [**IMFAttributes :: setunknown,**](/windows/desktop/api/mfobjects/nf-mfobjects-imfattributes-setunknown).</span><span class="sxs-lookup"><span data-stu-id="4d608-169">The topology loader sets the [MFT\_CONNECTED\_STREAM\_ATTRIBUTE](mft-connected-stream-attribute.md) attribute on *pDownstream* by calling [**IMFAttributes::SetUnknown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfattributes-setunknown).</span></span> <span data-ttu-id="4d608-170">La valeur de l’attribut est le pointeur *pUpstream* .</span><span class="sxs-lookup"><span data-stu-id="4d608-170">The value of the attribute is the *pUpstream* pointer.</span></span>
    4.  <span data-ttu-id="4d608-171">Le chargeur de topologie affecte la **valeur true** à l’attribut [MFT \_ Connected \_ to \_ HW \_ Stream](mft-connected-to-hw-stream.md) sur *pDownstream* et *pUpstream*.</span><span class="sxs-lookup"><span data-stu-id="4d608-171">The topology loader sets the [MFT\_CONNECTED\_TO\_HW\_STREAM](mft-connected-to-hw-stream.md) attribute to **TRUE** on both *pDownstream* and *pUpstream*.</span></span>
3.  <span data-ttu-id="4d608-172">À ce stade, la table MFT en aval a un pointeur vers le magasin d’attributs de la MFT en amont, comme indiqué dans le diagramme suivant.</span><span class="sxs-lookup"><span data-stu-id="4d608-172">At this point, the downstream MFT has a pointer to the upstream MFT's attribute store, as shown in the following diagram.</span></span>

    ![diagramme avec chaque MFTS pointant vers son flux, chaque flux pointant vers son magasin et le magasin d’entrée avec une ligne en pointillés dans le magasin de sortie](images/proxy-mft2.png)

    > [!Note]  
    > <span data-ttu-id="4d608-174">Par souci de clarté, ce diagramme montre les flux et les magasins d’attributs en tant qu’objets distincts, mais cela n’est pas nécessaire pour l’implémentation.</span><span class="sxs-lookup"><span data-stu-id="4d608-174">For clarity, this diagram shows the streams and the attribute stores as distinct objects, but that is not required for the implementation.</span></span>

     

4.  <span data-ttu-id="4d608-175">La table MFT en aval utilise le pointeur [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pour établir un canal de communication privé avec la table MFT en amont.</span><span class="sxs-lookup"><span data-stu-id="4d608-175">The downstream MFT uses the [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer to establish a private communication channel with the upstream MFT.</span></span> <span data-ttu-id="4d608-176">Étant donné que le canal est privé, le mécanisme exact est défini par l’implémentation.</span><span class="sxs-lookup"><span data-stu-id="4d608-176">Because the channel is private, the exact mechanism is defined by the implementation.</span></span> <span data-ttu-id="4d608-177">Par exemple, la table MFT peut demander une interface COM privée.</span><span class="sxs-lookup"><span data-stu-id="4d608-177">For example, the MFT might query for a private COM interface.</span></span>

<span data-ttu-id="4d608-178">À l’étape 4, la MFT en aval doit vérifier si les deux MFTs partagent le même appareil physique.</span><span class="sxs-lookup"><span data-stu-id="4d608-178">During step 4, the downstream MFT must verify whether the two MFTs share the same physical device.</span></span> <span data-ttu-id="4d608-179">Si ce n’est pas le cas, ils doivent revenir à l’utilisation de la mémoire système pour le transport des données.</span><span class="sxs-lookup"><span data-stu-id="4d608-179">If not, they must fall back to using system memory for data transport.</span></span> <span data-ttu-id="4d608-180">Cela permet à la MFT de fonctionner correctement avec les MFTs logicielles et d’autres périphériques matériels.</span><span class="sxs-lookup"><span data-stu-id="4d608-180">This enables the MFT to operate correctly with software MFTs and other hardware devices.</span></span>

<span data-ttu-id="4d608-181">Si le protocole de transfert s’effectue correctement et que les deux MFTs partagent un canal de données privé, ils n’utilisent pas le modèle de traitement de données standard (décrit dans la section suivante) au niveau du point de connexion.</span><span class="sxs-lookup"><span data-stu-id="4d608-181">If the handshake succeeds and the two MFTs share a private data channel, they do not use the standard data processing model (described in the next section) at the connection point.</span></span> <span data-ttu-id="4d608-182">Plus précisément, la MFT en aval n’envoie pas d’événements [METransformNeedInput](metransformneedinput.md) ; Pour plus d’informations, reportez-vous à la section suivante de cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="4d608-182">Specifically, the downstream MFT does not send [METransformNeedInput](metransformneedinput.md) events; for more details, refer to the next section in this topic.</span></span>

## <a name="data-processing"></a><span data-ttu-id="4d608-183">Traitement des données</span><span class="sxs-lookup"><span data-stu-id="4d608-183">Data Processing</span></span>

<span data-ttu-id="4d608-184">Lorsqu’une table MFT matérielle utilise la mémoire système pour le transport de données, le processus fonctionne comme suit :</span><span class="sxs-lookup"><span data-stu-id="4d608-184">When a hardware MFT uses system memory for data transport, the process works as follows:</span></span>

1.  <span data-ttu-id="4d608-185">Pour demander plus d’entrées, la table MFT envoie un événement [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="4d608-185">To request more input, the MFT sends an [METransformNeedInput](metransformneedinput.md) event.</span></span>
2.  <span data-ttu-id="4d608-186">L’événement [METransformNeedInput](metransformneedinput.md) fait en sorte que le pipeline appelle [**IMFTransform ::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="4d608-186">The [METransformNeedInput](metransformneedinput.md) event causes the pipeline to call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>
3.  <span data-ttu-id="4d608-187">Lorsque la table MFT contient des données de sortie, la table MFT envoie un événement [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="4d608-187">When the MFT has output data, the MFT sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
4.  <span data-ttu-id="4d608-188">L’événement [METransformHaveOutput](metransformhaveoutput.md) fait en sorte que le pipeline appelle [**IMFTransform ::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="4d608-188">The [METransformHaveOutput](metransformhaveoutput.md) event causes the pipeline to call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="4d608-189">Pour plus d’informations, consultez [MFTS asynchrone](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="4d608-189">For details, refer to [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

<span data-ttu-id="4d608-190">Toutefois, si la table MFT utilise un canal matériel, elle n’envoie pas ces événements au point de connexion matériel, car tous les transferts de données s’effectuent en interne au sein du matériel.</span><span class="sxs-lookup"><span data-stu-id="4d608-190">If the MFT uses a hardware channel, however, it does not send these events at the hardware connection point, because all data transfer happens internally within the hardware.</span></span> <span data-ttu-id="4d608-191">Par conséquent, le pipeline n’appelle pas [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) ou [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) sur le point de connexion.</span><span class="sxs-lookup"><span data-stu-id="4d608-191">Therefore, the pipeline does not call [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) or [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at the connection point.</span></span>

<span data-ttu-id="4d608-192">Par exemple, considérons le premier diagramme de cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="4d608-192">For example, consider the first diagram in this topic.</span></span> <span data-ttu-id="4d608-193">Compte tenu de cette configuration, le traitement des données se produit comme suit :</span><span class="sxs-lookup"><span data-stu-id="4d608-193">Given this configuration, data processing would occur as follows:</span></span>

1.  <span data-ttu-id="4d608-194">« A » envoie [METransformNeedInput](metransformneedinput.md) pour demander des données.</span><span class="sxs-lookup"><span data-stu-id="4d608-194">"A" sends [METransformNeedInput](metransformneedinput.md) to request data.</span></span>
2.  <span data-ttu-id="4d608-195">Le pipeline appelle [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) sur « A ».</span><span class="sxs-lookup"><span data-stu-id="4d608-195">The pipeline calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) on "A".</span></span>
3.  <span data-ttu-id="4d608-196">« A » et « B » traitent les données dans le matériel.</span><span class="sxs-lookup"><span data-stu-id="4d608-196">"A" and "B" process the data in hardware.</span></span>
4.  <span data-ttu-id="4d608-197">Une fois le traitement terminé, « B » envoie un événement [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="4d608-197">When the processing is complete, "B" sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
5.  <span data-ttu-id="4d608-198">Le pipeline appelle [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) sur « B ».</span><span class="sxs-lookup"><span data-stu-id="4d608-198">The pipeline calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) on "B".</span></span>

## <a name="paired-decoderencoder"></a><span data-ttu-id="4d608-199">Décodeur/encodeur couplé</span><span class="sxs-lookup"><span data-stu-id="4d608-199">Paired Decoder/Encoder</span></span>

<span data-ttu-id="4d608-200">Si un décodeur et un encodeur se trouvent sur la même puce matérielle, il peut être préférable de les utiliser ensemble lors du transcodage.</span><span class="sxs-lookup"><span data-stu-id="4d608-200">If a decoder and encoder are located on the same hardware chip, it may be preferable to use them together when transcoding.</span></span> <span data-ttu-id="4d608-201">Autrement dit, la sélection de l’une d’entre elles doit entraîner la sélection de l’autre dans le pipeline de transcodage.</span><span class="sxs-lookup"><span data-stu-id="4d608-201">That is, selecting one should cause the other to be selected in the transcoding pipeline.</span></span> <span data-ttu-id="4d608-202">Pour vous assurer que les codecs matériels correspondants sont choisis, les MFTs de codec doivent offrir un type de média personnalisé.</span><span class="sxs-lookup"><span data-stu-id="4d608-202">To ensure that matching hardware codecs are chosen, both codec MFTs should offer a custom media type.</span></span> <span data-ttu-id="4d608-203">Pour créer un type de média personnalisé :</span><span class="sxs-lookup"><span data-stu-id="4d608-203">To create a custom media type:</span></span>

-   <span data-ttu-id="4d608-204">Définissez l’attribut de [**\_ type de \_ majeure \_ série MF MT**](mf-mt-major-type-attribute.md) sur **MFMediaType \_ audio** ou **MFMediaType \_ Video**, selon le cas.</span><span class="sxs-lookup"><span data-stu-id="4d608-204">Set the [**MF\_MT\_MAJOR\_TYPE**](mf-mt-major-type-attribute.md) attribute to **MFMediaType\_Audio** or **MFMediaType\_Video**, as appropriate.</span></span>
-   <span data-ttu-id="4d608-205">Définissez l’attribut de [**\_ sous- \_ type MF MT**](mf-mt-subtype-attribute.md) sur une valeur Guid personnalisée.</span><span class="sxs-lookup"><span data-stu-id="4d608-205">Set the [**MF\_MT\_SUBTYPE**](mf-mt-subtype-attribute.md) attribute to a custom GUID value.</span></span>

<span data-ttu-id="4d608-206">Les autres attributs de type sont facultatifs.</span><span class="sxs-lookup"><span data-stu-id="4d608-206">Other type attributes are optional.</span></span> <span data-ttu-id="4d608-207">Le décodeur retourne le type personnalisé à partir de son [**IMFTransform :: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype), et l’encodeur retourne le type personnalisé à partir de sa méthode [**IMFTransform :: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) .</span><span class="sxs-lookup"><span data-stu-id="4d608-207">The decoder returns the custom type from its [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype), and the encoder returns the custom type from its [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) method.</span></span> <span data-ttu-id="4d608-208">Dans les deux cas, le type personnalisé doit être la première entrée de la liste (*dwTypeIndex* = 0).</span><span class="sxs-lookup"><span data-stu-id="4d608-208">In both cases, the custom type must be the first entry in the list (*dwTypeIndex* = 0).</span></span>

<span data-ttu-id="4d608-209">Pour fonctionner avec les codecs logiciels, le codec doit également retourner au moins un format standard, tel que NV12 pour la vidéo.</span><span class="sxs-lookup"><span data-stu-id="4d608-209">To work with software codecs, the codec should also return at least one standard format, such as NV12 for video.</span></span> <span data-ttu-id="4d608-210">Les formats standard doivent apparaître après le type personnalisé (*dwTypeIndex* > 0).</span><span class="sxs-lookup"><span data-stu-id="4d608-210">Standard formats should appear after the custom type (*dwTypeIndex* > 0).</span></span> <span data-ttu-id="4d608-211">Si les deux codecs doivent toujours être couplés et ne peuvent pas interagir avec les codecs logiciels, MFTs doit retourner uniquement le format personnalisé et ne retourne pas de formats standard.</span><span class="sxs-lookup"><span data-stu-id="4d608-211">If the two codecs must always be paired and cannot interoperate with software codecs, the MFTs should return only the custom format and not return any standard formats.</span></span>

> [!Note]  
> <span data-ttu-id="4d608-212">Si un décodeur ne retourne pas de formats standard, il ne peut pas être utilisé pour la lecture avec le [convertisseur vidéo amélioré](enhanced-video-renderer.md).</span><span class="sxs-lookup"><span data-stu-id="4d608-212">If a decoder does not return any standard formats, it cannot be used for playback with the [Enhanced Video Renderer](enhanced-video-renderer.md).</span></span> <span data-ttu-id="4d608-213">Dans ce cas, elle doit être inscrite en tant que décodeur de transcodage uniquement.</span><span class="sxs-lookup"><span data-stu-id="4d608-213">In that case, it should be registered as a transcode-only decoder.</span></span> <span data-ttu-id="4d608-214">Consultez [décodeurs de transcodage uniquement](implementing-a-codec-mft.md).</span><span class="sxs-lookup"><span data-stu-id="4d608-214">See [Transcode-Only Decoders](implementing-a-codec-mft.md).</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="4d608-215">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="4d608-215">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4d608-216">Écriture d’une table MFT personnalisée</span><span class="sxs-lookup"><span data-stu-id="4d608-216">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> <dt>

[<span data-ttu-id="4d608-217">Implémentation d’une table MFT de codec</span><span class="sxs-lookup"><span data-stu-id="4d608-217">Implementing a Codec MFT</span></span>](implementing-a-codec-mft.md)
</dt> <dt>

[<span data-ttu-id="4d608-218">Transformations de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="4d608-218">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 




