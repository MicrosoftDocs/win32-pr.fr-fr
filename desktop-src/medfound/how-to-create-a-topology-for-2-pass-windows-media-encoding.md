---
description: Les modes d’encodage en deux passes sont pris en charge par certains encodeurs Windows Media et Media Foundation au niveau de la couche de pipeline.
ms.assetid: 3fd5baff-142f-453e-bb97-b355ee6678fc
title: Comment créer une topologie pour Two-Pass l’encodage Windows Media
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c813b9a3c31fafaa3efbea83180c997bc46079d
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/03/2021
ms.locfileid: "103953383"
---
# <a name="how-to-create-a-topology-for-two-pass-windows-media-encoding"></a><span data-ttu-id="8dd67-103">Comment créer une topologie pour Two-Pass l’encodage Windows Media</span><span class="sxs-lookup"><span data-stu-id="8dd67-103">How to Create a Topology for Two-Pass Windows Media Encoding</span></span>

<span data-ttu-id="8dd67-104">Les modes d’encodage en deux passes sont pris en charge par certains encodeurs Windows Media et Media Foundation au niveau de la couche de pipeline.</span><span class="sxs-lookup"><span data-stu-id="8dd67-104">Two-pass encoding modes are supported by certain Windows Media encoders and Media Foundation at the pipeline layer.</span></span> <span data-ttu-id="8dd67-105">L’application doit configurer et configurer la topologie d’encodage de la même manière que dans l’encodage à passage unique, mais en mode d’encodage en 2 passes, l’application doit exécuter la session d’encodage à deux reprises.</span><span class="sxs-lookup"><span data-stu-id="8dd67-105">The application must configure and set up the encoding topology similar to that in single-pass encoding but in the 2-pass encoding mode, the application must run the encoding session twice.</span></span> <span data-ttu-id="8dd67-106">Lors du premier passage, l’encodeur recueille des informations sur le contenu du flux.</span><span class="sxs-lookup"><span data-stu-id="8dd67-106">On the first pass, the encoder gathers information about the content of the stream.</span></span> <span data-ttu-id="8dd67-107">Lors de la deuxième passe, en utilisant les informations collectées lors du premier passage, le fichier de sortie final est généré.</span><span class="sxs-lookup"><span data-stu-id="8dd67-107">On the second pass, by using the information gathered on the first pass, the final output file is generated.</span></span> <span data-ttu-id="8dd67-108">En traitant les exemples du flux à deux reprises, l’encodage en deux passes optimise le processus d’encodage et produit des fichiers encodés de qualité supérieure.</span><span class="sxs-lookup"><span data-stu-id="8dd67-108">By processing the samples for the stream twice, two-pass encoding optimizes the encoding process and produces higher quality encoded files.</span></span> <span data-ttu-id="8dd67-109">Les modes d’encodage à deux passes ne peuvent pas être utilisés sur des flux dynamiques.</span><span class="sxs-lookup"><span data-stu-id="8dd67-109">Two-pass encoding modes cannot be used on live streams.</span></span>

<span data-ttu-id="8dd67-110">Media Foundation prend en charge les modes d’encodage à deux passes suivants :</span><span class="sxs-lookup"><span data-stu-id="8dd67-110">Media Foundation supports the following two-pass encoding modes:</span></span>

-   [<span data-ttu-id="8dd67-111">Encodage de la vitesse de transmission variable sans contrainte</span><span class="sxs-lookup"><span data-stu-id="8dd67-111">Unconstrained Variable Bit Rate Encoding</span></span>](unconstrained-variable-bit-rate--vbr--encoding.md)
-   [<span data-ttu-id="8dd67-112">Chiffrement à vitesse de transmission variable à forte limite</span><span class="sxs-lookup"><span data-stu-id="8dd67-112">Peak-Constrained Variable Bit Rate Encoding</span></span>](peak-constrained-variable-bit-rate--vbr--encoding.md)

<span data-ttu-id="8dd67-113">La création d’une topologie d’encodage pour l’encodage en deux passes est similaire aux modes de passe unique.</span><span class="sxs-lookup"><span data-stu-id="8dd67-113">Building an encoding topology for two-pass encoding is similar to single pass modes.</span></span> <span data-ttu-id="8dd67-114">La liste suivante présente les principales différences.</span><span class="sxs-lookup"><span data-stu-id="8dd67-114">The following list shows the key differences.</span></span>

-   <span data-ttu-id="8dd67-115">La configuration de l’encodeur doit inclure la propriété [**MFPKEY \_ PASSESUSED**](mfpkey-passesusedproperty.md) qui a la valeur 2 et la propriété [**MFPKEY \_ VBRENABLED**](mfpkey-vbrenabledproperty.md) la \_ valeur variant true.</span><span class="sxs-lookup"><span data-stu-id="8dd67-115">Encoder configuration must include the [**MFPKEY\_PASSESUSED**](mfpkey-passesusedproperty.md) property that is set to 2 and the [**MFPKEY\_VBRENABLED**](mfpkey-vbrenabledproperty.md) property to VARIANT\_TRUE.</span></span> <span data-ttu-id="8dd67-116">Cela permet de filtrer les fonctionnalités de l’encodeur en modes à deux passes.</span><span class="sxs-lookup"><span data-stu-id="8dd67-116">This filters the encoder’s capabilities to two-pass modes.</span></span> <span data-ttu-id="8dd67-117">Si vous utilisez des objets d’activation, transmettez ces propriétés à [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) ou [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span><span class="sxs-lookup"><span data-stu-id="8dd67-117">If you are using activation objects, pass these properties to [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) or [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span></span>
-   <span data-ttu-id="8dd67-118">Pour la première passe, utilisez un récepteur de médias factices dans le nœud de sortie, car les exemples générés dans ce test ne sont pas ajoutés au fichier final.</span><span class="sxs-lookup"><span data-stu-id="8dd67-118">For the first pass, use a dummy media sink in the output node because the samples that are generated in this pass are not added to the final file.</span></span>
-   <span data-ttu-id="8dd67-119">Pour la deuxième passe, interrogez l’encodeur pour les propriétés de recodage requises et remplacez le nœud du récepteur de média factice par le récepteur de média ASF avec les propriétés définies.</span><span class="sxs-lookup"><span data-stu-id="8dd67-119">For the second pass, query the encoder for the required post-encoding properties and replace the dummy media sink node with the ASF media sink with these properties set.</span></span>

<span data-ttu-id="8dd67-120">Pour plus d’informations sur la configuration d’une topologie d’encodage, consultez [Didacticiel : encodage Windows Media à passage unique](tutorial--1-pass-windows-media-encoding.md).</span><span class="sxs-lookup"><span data-stu-id="8dd67-120">For more information about setting up an encoding topology see, [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span></span>

<span data-ttu-id="8dd67-121">La procédure suivante résume les étapes d’encodage du contenu Windows Media dans un conteneur ASF à l’aide d’un mode d’encodage en deux passes.</span><span class="sxs-lookup"><span data-stu-id="8dd67-121">The following procedure summarizes the steps for encoding Windows Media content in an ASF container by using a two-pass encoding mode.</span></span>

1.  <span data-ttu-id="8dd67-122">Créer une source de média pour le spécifié à l’aide du programme de résolution source.</span><span class="sxs-lookup"><span data-stu-id="8dd67-122">Create a media source for the specified by using the source resolver.</span></span>
2.  <span data-ttu-id="8dd67-123">Énumérer les flux dans la source du média.</span><span class="sxs-lookup"><span data-stu-id="8dd67-123">Enumerate the streams in the media source.</span></span>
3.  <span data-ttu-id="8dd67-124">Créez le récepteur de média ASF et ajoutez des récepteurs de flux en fonction des flux de la source du média qui doivent être encodés.</span><span class="sxs-lookup"><span data-stu-id="8dd67-124">Create the ASF media sink and add stream sinks depending on the streams in the media source that need to be encoded.</span></span>
4.  <span data-ttu-id="8dd67-125">Créez le récepteur multimédia.</span><span class="sxs-lookup"><span data-stu-id="8dd67-125">Create the media sink.</span></span>
5.  <span data-ttu-id="8dd67-126">Créez les encodeurs Windows Media pour les flux dans le fichier de sortie.</span><span class="sxs-lookup"><span data-stu-id="8dd67-126">Create the Windows Media encoders for the streams in the output file.</span></span>
6.  <span data-ttu-id="8dd67-127">Configurez les encodeurs avec les propriétés d’encodage à 2 passes.</span><span class="sxs-lookup"><span data-stu-id="8dd67-127">Configure the encoders with the 2-pass encoding properties.</span></span>
7.  <span data-ttu-id="8dd67-128">Générez une topologie d’encodage partielle en connectant la source, les encodeurs et le récepteur multimédia.</span><span class="sxs-lookup"><span data-stu-id="8dd67-128">Build a partial encoding topology by connecting the source, encoders, and the media sink.</span></span>
8.  <span data-ttu-id="8dd67-129">Instanciez la session multimédia et définissez la topologie sur la session multimédia.</span><span class="sxs-lookup"><span data-stu-id="8dd67-129">Instantiate the Media Session and set the topology on the Media Session.</span></span>
9.  <span data-ttu-id="8dd67-130">Exécutez la première passe d’encodage en contrôlant la session multimédia et en obtenant tous les événements pertinents à partir de la session multimédia.</span><span class="sxs-lookup"><span data-stu-id="8dd67-130">Run the first encoding pass by controlling the Media Session and getting all the relevant events from the Media Session.</span></span>
10. <span data-ttu-id="8dd67-131">Fermez et arrêtez la session d’encodage.</span><span class="sxs-lookup"><span data-stu-id="8dd67-131">Close and shutdown the encoding session.</span></span>
11. <span data-ttu-id="8dd67-132">Interrogez l’encodeur pour les propriétés suivantes selon le type d’encodage :</span><span class="sxs-lookup"><span data-stu-id="8dd67-132">Query the encoder for the following properties depending on the type of encoding:</span></span> 

    | <span data-ttu-id="8dd67-133">Type d’encodage</span><span class="sxs-lookup"><span data-stu-id="8dd67-133">Encoding type</span></span>                                                                                        | <span data-ttu-id="8dd67-134">Nom de la propriété</span><span class="sxs-lookup"><span data-stu-id="8dd67-134">Property name</span></span>                                                                                                                                                                                                                                                                                                                                                     |
    |------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | [<span data-ttu-id="8dd67-135">Encodage de la vitesse de transmission variable sans contrainte</span><span class="sxs-lookup"><span data-stu-id="8dd67-135">Unconstrained Variable Bit Rate Encoding</span></span>](unconstrained-variable-bit-rate--vbr--encoding.md)       | [<span data-ttu-id="8dd67-136">**MFPKEY \_ PASSESUSED**</span><span class="sxs-lookup"><span data-stu-id="8dd67-136">**MFPKEY\_PASSESUSED**</span></span>](mfpkey-passesusedproperty.md)<br/> [<span data-ttu-id="8dd67-137">**MFPKEY \_ VBRENABLED**</span><span class="sxs-lookup"><span data-stu-id="8dd67-137">**MFPKEY\_VBRENABLED**</span></span>](mfpkey-vbrenabledproperty.md)<br/> [<span data-ttu-id="8dd67-138">**MFPKEY \_ BAVG**</span><span class="sxs-lookup"><span data-stu-id="8dd67-138">**MFPKEY\_BAVG**</span></span>](mfpkey-bavgproperty.md)<br/> [<span data-ttu-id="8dd67-139">**MFPKEY \_ RAVG**</span><span class="sxs-lookup"><span data-stu-id="8dd67-139">**MFPKEY\_RAVG**</span></span>](mfpkey-ravgproperty.md)<br/>                                                                                                               |
    | [<span data-ttu-id="8dd67-140">Chiffrement à vitesse de transmission variable à forte limite</span><span class="sxs-lookup"><span data-stu-id="8dd67-140">Peak-Constrained Variable Bit Rate Encoding</span></span>](peak-constrained-variable-bit-rate--vbr--encoding.md) | [<span data-ttu-id="8dd67-141">**MFPKEY \_ PASSESUSED**</span><span class="sxs-lookup"><span data-stu-id="8dd67-141">**MFPKEY\_PASSESUSED**</span></span>](mfpkey-passesusedproperty.md)<br/> [<span data-ttu-id="8dd67-142">**MFPKEY \_ VBRENABLED**</span><span class="sxs-lookup"><span data-stu-id="8dd67-142">**MFPKEY\_VBRENABLED**</span></span>](mfpkey-vbrenabledproperty.md)<br/> [<span data-ttu-id="8dd67-143">**MFPKEY \_ BAVG**</span><span class="sxs-lookup"><span data-stu-id="8dd67-143">**MFPKEY\_BAVG**</span></span>](mfpkey-bavgproperty.md)<br/> [<span data-ttu-id="8dd67-144">**MFPKEY \_ RAVG**</span><span class="sxs-lookup"><span data-stu-id="8dd67-144">**MFPKEY\_RAVG**</span></span>](mfpkey-ravgproperty.md)<br/> [<span data-ttu-id="8dd67-145">**MFPKEY \_ BMAX**</span><span class="sxs-lookup"><span data-stu-id="8dd67-145">**MFPKEY\_BMAX**</span></span>](mfpkey-bmaxproperty.md)<br/> [<span data-ttu-id="8dd67-146">**MFPKEY \_ Rmax**</span><span class="sxs-lookup"><span data-stu-id="8dd67-146">**MFPKEY\_RMAX**</span></span>](mfpkey-rmaxproperty.md)<br/> |

    

     

12. <span data-ttu-id="8dd67-147">Créez le récepteur de fichiers ASF et ajoutez les récepteurs de flux requis en fonction des flux que vous souhaitez inclure dans le fichier de sortie final.</span><span class="sxs-lookup"><span data-stu-id="8dd67-147">Create the ASF file sink and add the required stream sinks depending on the streams you want to include in the final output file.</span></span>
13. <span data-ttu-id="8dd67-148">Définissez les propriétés de l’encodeur récupérées à l’étape 11 sur le récepteur de fichiers.</span><span class="sxs-lookup"><span data-stu-id="8dd67-148">Set the encoder properties retrieved in step 11 on the file sink.</span></span>
14. <span data-ttu-id="8dd67-149">Remplacez le récepteur multimédia du nœud de sortie par le récepteur de fichiers nouvellement créé.</span><span class="sxs-lookup"><span data-stu-id="8dd67-149">Replace the media sink in the output node with the newly created file sink.</span></span>
15. <span data-ttu-id="8dd67-150">Instanciez la session multimédia et définissez la topologie mise à jour sur la session de média.</span><span class="sxs-lookup"><span data-stu-id="8dd67-150">Instantiate the Media Session and set the updated topology on the Media Session.</span></span>
16. <span data-ttu-id="8dd67-151">Exécutez la deuxième passe d’encodage en contrôlant la session multimédia et en obtenant tous les événements pertinents à partir de la session multimédia.</span><span class="sxs-lookup"><span data-stu-id="8dd67-151">Run second encoding pass by controlling the Media Session and getting all the relevant events from the Media Session.</span></span>
17. <span data-ttu-id="8dd67-152">Attendez que l’événement [MEEndOfPresentation](meendofpresentation.md) de la session multimédia et dans le gestionnaire d’événements récupère les valeurs de propriété d’encodage de l’encodeur et définissez-les sur le récepteur de fichiers.</span><span class="sxs-lookup"><span data-stu-id="8dd67-152">Wait for the [MEEndOfPresentation](meendofpresentation.md) event from the Media Session and in the event handler get the encoding property values from the encoder and set them on the file sink.</span></span> <span data-ttu-id="8dd67-153">Pour plus d’informations, consultez « mettre à jour les propriétés d’encodage dans le récepteur de fichiers » dans le [Didacticiel : encodage Windows Media à passage unique](tutorial--1-pass-windows-media-encoding.md).</span><span class="sxs-lookup"><span data-stu-id="8dd67-153">For more information, see "Update Encoding Properties in the File Sink" in [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span></span>
18. <span data-ttu-id="8dd67-154">Fermez et arrêtez la session d’encodage.</span><span class="sxs-lookup"><span data-stu-id="8dd67-154">Close and shutdown the encoding session.</span></span>

## <a name="related-topics"></a><span data-ttu-id="8dd67-155">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="8dd67-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8dd67-156">Composants ASF de couche de pipeline</span><span class="sxs-lookup"><span data-stu-id="8dd67-156">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> </dl>

 

 




