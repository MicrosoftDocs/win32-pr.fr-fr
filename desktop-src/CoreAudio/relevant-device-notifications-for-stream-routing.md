---
description: Dans Windows 7, les API de plateforme de haut niveau qui utilisent des API audio de base, telles que Media Foundation, DirectSound et les API Wave, implémentent la fonctionnalité de routage de flux en gérant le basculement de flux d’un appareil existant vers un nouveau point de terminaison audio par défaut.
ms.assetid: caf831bb-b8de-467f-bdb4-f9f8991dc7a8
title: Notifications appropriées pour le routage de flux
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ef3d253ce2ec5d6e3bef025a33233a9d377ca44b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104110778"
---
# <a name="relevant-notifications-for-stream-routing"></a><span data-ttu-id="de573-103">Notifications appropriées pour le routage de flux</span><span class="sxs-lookup"><span data-stu-id="de573-103">Relevant Notifications for Stream Routing</span></span>

<span data-ttu-id="de573-104">Dans Windows 7, les API de plateforme de haut niveau qui utilisent des API audio de base, telles que Media Foundation, DirectSound et les API Wave, implémentent la fonctionnalité de routage de flux en gérant le basculement de flux d’un appareil existant vers un nouveau point de terminaison audio par défaut.</span><span class="sxs-lookup"><span data-stu-id="de573-104">In Windows 7, high-level platform APIs that use Core Audio APIs, such as Media Foundation, DirectSound, and Wave APIs, implement the stream routing feature by handling stream switching from an existing device to a new default audio endpoint.</span></span> <span data-ttu-id="de573-105">Les applications multimédias qui utilisent ces API utilisent le comportement de routage de flux sans aucune modification de la source.</span><span class="sxs-lookup"><span data-stu-id="de573-105">Media applications that use these APIs use the stream routing behavior without any modifications to the source.</span></span> <span data-ttu-id="de573-106">Les clients WASAPI directs peuvent utiliser les notifications envoyées par les composants audio principaux et implémenter la fonctionnalité de routage de flux.</span><span class="sxs-lookup"><span data-stu-id="de573-106">Direct WASAPI clients can use the notifications sent by Core Audio components and implement the stream routing feature.</span></span>

<span data-ttu-id="de573-107">Pour implémenter la fonctionnalité de routage de flux, un client doit écouter deux types d’événements : les notifications de modification de l’appareil et les notifications de déconnexion de la session.</span><span class="sxs-lookup"><span data-stu-id="de573-107">To implement the stream routing feature, a client must listen for two types of events: device change notifications and session disconnect notifications.</span></span> <span data-ttu-id="de573-108">Dans l’implémentation fournie par les API de haut niveau, ces événements sont envoyés pour les points de terminaison de périphérique par défaut créés en appelant [**IMMDeviceEnumerator :: GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span><span class="sxs-lookup"><span data-stu-id="de573-108">In the implementation provided by the high-level APIs, these events are sent for default device endpoints created by calling [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span></span> <span data-ttu-id="de573-109">Pour plus d’informations, consultez [obtention du point de terminaison de l’appareil pour le routage de flux](getting-the-default-device-endpoint-for-stream-routing.md).</span><span class="sxs-lookup"><span data-stu-id="de573-109">For more information, see [Getting the Device Endpoint for Stream Routing](getting-the-default-device-endpoint-for-stream-routing.md).</span></span>

<span data-ttu-id="de573-110">Le composant audio principal MMDeviceAPI fournit des rappels de notification lors de l’ajout, de la suppression ou de la modification de périphériques audio.</span><span class="sxs-lookup"><span data-stu-id="de573-110">The Core Audio component MMDeviceAPI delivers notification callbacks when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="de573-111">Les modifications de format et de session audio sont signalées en tant qu’événements via WASAPI.</span><span class="sxs-lookup"><span data-stu-id="de573-111">The format and audio session changes are reported as events through WASAPI.</span></span>

## <a name="device-change-notifications"></a><span data-ttu-id="de573-112">Notifications de modification d’appareil</span><span class="sxs-lookup"><span data-stu-id="de573-112">Device Change Notifications</span></span>

<span data-ttu-id="de573-113">MMDeviceAPI déclenche des événements lors de l’ajout, de la suppression ou de la modification de périphériques audio.</span><span class="sxs-lookup"><span data-stu-id="de573-113">MMDeviceAPI raises events when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="de573-114">Si le client doit fournir la fonctionnalité de routage de flux, il doit implémenter l’interface [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) et inscrire son implémentation auprès de MMDeviceAPI.</span><span class="sxs-lookup"><span data-stu-id="de573-114">If the client is to provide stream routing functionality, it must implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface and register its implementation with MMDeviceAPI.</span></span>

<span data-ttu-id="de573-115">Pour recevoir des notifications de changement d’appareil, le client doit effectuer les tâches suivantes :</span><span class="sxs-lookup"><span data-stu-id="de573-115">To get device change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="de573-116">Implémentez l’interface [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) pour gérer les notifications de modification d’appareil envoyées par MMDeviceAPI.</span><span class="sxs-lookup"><span data-stu-id="de573-116">Implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface to handle device change notifications sent by MMDeviceAPI.</span></span>
-   <span data-ttu-id="de573-117">Enregistrez l’implémentation de [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) avec MMDeviceAPI en appelant la méthode [**IMMDeviceEnumerator :: RegisterEndpointNotificationCallback**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) .</span><span class="sxs-lookup"><span data-stu-id="de573-117">Register the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) implementation with MMDeviceAPI by calling the [**IMMDeviceEnumerator::RegisterEndpointNotificationCallback**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) method.</span></span>

<span data-ttu-id="de573-118">Une fois que l’implémentation de ces interfaces du client est inscrite, le client reçoit des notifications sous la forme de rappels via les méthodes de ces interfaces.</span><span class="sxs-lookup"><span data-stu-id="de573-118">After the client's implementation of these interfaces is registered, the client receives notifications in the form of callbacks through the methods of these interfaces.</span></span> <span data-ttu-id="de573-119">Les méthodes [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) sont appelées par MMDeviceAPI lorsqu’elles déclenchent des événements au niveau du point de terminaison (modifications d’état de point de terminaison, nouvelles arrivées de point de terminaison, suppressions de point de terminaison, modifications de point de terminaison par défaut et modifications de propriété de point</span><span class="sxs-lookup"><span data-stu-id="de573-119">[**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) methods are called by MMDeviceAPI when it raises endpoint-level events (endpoint state changes, new endpoint arrivals, endpoint deletions, default endpoint changes, and endpoint property changes).</span></span>

<span data-ttu-id="de573-120">Si le client souhaite fournir le routage de flux pour l’appareil par défaut, le client doit implémenter le comportement de changement d’appareil lorsqu’il reçoit la notification via le rappel [**IMMNotificationClient :: OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) .</span><span class="sxs-lookup"><span data-stu-id="de573-120">If the client wants to provide stream routing for the default device, the client must implement the device change behavior when it receives the notification through the [**IMMNotificationClient::OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) callback.</span></span>

## <a name="audio-session-change-notifications"></a><span data-ttu-id="de573-121">Notifications de modification de session audio</span><span class="sxs-lookup"><span data-stu-id="de573-121">Audio Session Change Notifications</span></span>

<span data-ttu-id="de573-122">Les modifications apportées aux sessions audio et aux formats sont signalées comme des événements de session audio via WASAPI.</span><span class="sxs-lookup"><span data-stu-id="de573-122">Audio session changes and format changes are reported as audio session events through WASAPI.</span></span> <span data-ttu-id="de573-123">Un client WASAPI implémente l’interface [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) et enregistre l’implémentation avec WASAPI.</span><span class="sxs-lookup"><span data-stu-id="de573-123">A WASAPI client implements the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and registers the implementation with WASAPI.</span></span>

<span data-ttu-id="de573-124">Pour recevoir des notifications de changement de session audio, le client doit effectuer les tâches suivantes :</span><span class="sxs-lookup"><span data-stu-id="de573-124">To get audio session change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="de573-125">Implémentez l’interface [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) pour gérer les notifications de modification de format envoyées par WASAPI.</span><span class="sxs-lookup"><span data-stu-id="de573-125">Implement the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface to handle format change notifications sent by WASAPI.</span></span>
-   <span data-ttu-id="de573-126">Enregistrez l’implémentation de [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) avec WASAPI en appelant la méthode [**IAudioSessionControl :: RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) .</span><span class="sxs-lookup"><span data-stu-id="de573-126">Register the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) implementation with WASAPI by calling the [**IAudioSessionControl::RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) method.</span></span>

<span data-ttu-id="de573-127">Les méthodes [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) sont appelées par WASAPI lorsque des modifications de session audio se produisent.</span><span class="sxs-lookup"><span data-stu-id="de573-127">[**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) methods are called by WASAPI when audio session changes occur.</span></span> <span data-ttu-id="de573-128">Ces événements sont déclenchés lorsque le nom complet de la session, le chemin d’accès de l’icône, le volume, le paramètre de regroupement ou l’état change.</span><span class="sxs-lookup"><span data-stu-id="de573-128">These events are raised when the session's display name, icon path, volume, grouping parameter, or state changes.</span></span>

<span data-ttu-id="de573-129">Pour implémenter la fonctionnalité de routage de flux, le client doit attendre la notification de déconnexion de session.</span><span class="sxs-lookup"><span data-stu-id="de573-129">To implement the stream routing feature, the client must wait for the session-disconnect notification.</span></span> <span data-ttu-id="de573-130">Lorsqu’une session audio est déconnectée ou que le format d’un appareil est modifié, WASAPI envoie les notifications du client sous la forme de rappels via [**IAudioSessionEvents :: OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span><span class="sxs-lookup"><span data-stu-id="de573-130">When an audio session is disconnected or a device's format is changed, WASAPI sends the client notifications in the form of callbacks through [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span></span> <span data-ttu-id="de573-131">Avec la notification de déconnexion, WASAPI envoie également une valeur qui indique la raison pour laquelle la session a été déconnectée.</span><span class="sxs-lookup"><span data-stu-id="de573-131">With the disconnection notification, WASAPI also sends a value that indicates why the session was disconnected.</span></span> <span data-ttu-id="de573-132">Cela peut se produire pour plusieurs raisons, par exemple lorsque l’appareil a été supprimé, que le serveur s’est arrêté, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="de573-132">This can occur for several reasons, such as the device was removed, the server stopped, and so on.</span></span> <span data-ttu-id="de573-133">Pour obtenir la liste complète des raisons, consultez l’énumération **AudioSessionDisconnectReason** définie dans AudioPolicy. h.</span><span class="sxs-lookup"><span data-stu-id="de573-133">For the complete list of reasons, see the **AudioSessionDisconnectReason** enumeration defined in AudioPolicy.h.</span></span> <span data-ttu-id="de573-134">Si l’appareil par défaut change, le client doit attendre les notifications (si elles n’ont pas déjà été reçues) qui sont accompagnées d’une valeur **DisconnectReasonDeviceRemoval** .</span><span class="sxs-lookup"><span data-stu-id="de573-134">If the default device changes, the client must wait for the notifications (if they have not already been received) that are accompanied with a **DisconnectReasonDeviceRemoval** value.</span></span> <span data-ttu-id="de573-135">En réponse à ces notifications, le client peut rouvrir le flux sur le nouvel appareil par défaut.</span><span class="sxs-lookup"><span data-stu-id="de573-135">In response to such notifications, the client might reopen the stream on the new default device.</span></span>

<span data-ttu-id="de573-136">Étant donné que toutes ces opérations sont asynchrone, l’ordre dans lequel l’application reçoit les notifications ne peut pas être prédit.</span><span class="sxs-lookup"><span data-stu-id="de573-136">Because all of these operations are asychronous, the order in which the application receives notifications cannnot be predicted.</span></span> <span data-ttu-id="de573-137">Toutefois, en général, l’application reçoit la valeur **AudioSessionDisconnect** avant la notification de modification d’appareil par défaut.</span><span class="sxs-lookup"><span data-stu-id="de573-137">However, typically, the application receives **AudioSessionDisconnect** value before the default device change notification.</span></span>

### <a name="format-change-notifications"></a><span data-ttu-id="de573-138">Mettre en forme les notifications de modification</span><span class="sxs-lookup"><span data-stu-id="de573-138">Format Change Notifications</span></span>

<span data-ttu-id="de573-139">Les modifications de format audio se produisent lorsque le format du flux de données change.</span><span class="sxs-lookup"><span data-stu-id="de573-139">Audio format changes occur when the format of the stream changes.</span></span> <span data-ttu-id="de573-140">Cela peut se produire lorsque l’utilisateur sélectionne un nouveau format dans le panneau de configuration du **son** , ou le nouvel appareil par défaut prend en charge un nouveau format (par exemple, HDMI ou certaines interfaces audio professionnelles avec un réglage manuel de l’échantillonnage).</span><span class="sxs-lookup"><span data-stu-id="de573-140">This can occur when the user selects a new format in the **Sound** control panel or the new default device supports a new format (for example, HDMI or certain professional audio interfaces with a manual sample-rate adjustment).</span></span> <span data-ttu-id="de573-141">Pour notifier le client de ces types de modifications de format, WASAPI envoie une notification de session par l’implémentation inscrite de [**IAudioSessionEvents :: OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) avec une raison de déconnexion de **DisconnectReasonFormatChanged**.</span><span class="sxs-lookup"><span data-stu-id="de573-141">To notify the client about these types of format changes, WASAPI sends a session notification by the registered implementation of [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) with a disconnect reason of **DisconnectReasonFormatChanged**.</span></span> <span data-ttu-id="de573-142">Le client peut gérer la notification en réouvrant le flux dans le nouveau format.</span><span class="sxs-lookup"><span data-stu-id="de573-142">The client can handle the notification by reopening the stream in the new format.</span></span>

## <a name="related-topics"></a><span data-ttu-id="de573-143">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="de573-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="de573-144">À propos de l’API MMDevice</span><span class="sxs-lookup"><span data-stu-id="de573-144">About MMDevice API</span></span>](mmdevice-api.md)
</dt> <dt>

[<span data-ttu-id="de573-145">À propos de WASAPI</span><span class="sxs-lookup"><span data-stu-id="de573-145">About WASAPI</span></span>](wasapi.md)
</dt> <dt>

[<span data-ttu-id="de573-146">Routage de flux</span><span class="sxs-lookup"><span data-stu-id="de573-146">Stream Routing</span></span>](stream-routing.md)
</dt> </dl>

 

 



