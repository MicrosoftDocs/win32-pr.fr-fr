---
description: Utilisation de l’interface IKsControl pour accéder aux propriétés audio
ms.assetid: 72bf9164-96c6-4543-b858-19480b032fdb
title: Utilisation de l’interface IKsControl pour accéder aux propriétés audio
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a67639a0e51334da80b7bff88293414a58bb204c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104201042"
---
# <a name="using-the-ikscontrol-interface-to-access-audio-properties"></a><span data-ttu-id="5840a-103">Utilisation de l’interface IKsControl pour accéder aux propriétés audio</span><span class="sxs-lookup"><span data-stu-id="5840a-103">Using the IKsControl Interface to Access Audio Properties</span></span>

<span data-ttu-id="5840a-104">Dans de rares cas, une application audio spécialisée peut nécessiter l’utilisation de l’interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) pour accéder à certaines fonctionnalités matérielles d’une carte audio qui ne sont pas exposées par l' [API DEVICETOPOLOGY](devicetopology-api.md) ou l' [API MMDevice](mmdevice-api.md).</span><span class="sxs-lookup"><span data-stu-id="5840a-104">In rare cases, a specialized audio application might need to use the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface to access certain hardware capabilities of an audio adapter that are not exposed by the [DeviceTopology API](devicetopology-api.md) or the [MMDevice API](mmdevice-api.md).</span></span> <span data-ttu-id="5840a-105">L’interface **IKsControl** rend les propriétés, les événements et les méthodes des appareils de streaming noyau (KS) disponibles pour les applications en mode utilisateur.</span><span class="sxs-lookup"><span data-stu-id="5840a-105">The **IKsControl** interface makes the properties, events, and methods of kernel-streaming (KS) devices available to user-mode applications.</span></span> <span data-ttu-id="5840a-106">L’intérêt principal des applications audio est les propriétés KS.</span><span class="sxs-lookup"><span data-stu-id="5840a-106">Of primary interest to audio applications are KS properties.</span></span> <span data-ttu-id="5840a-107">L’interface **IKsControl** peut être utilisée conjointement avec l’API DeviceTopology et l’API MMDevice pour accéder aux propriétés KS des adaptateurs audio.</span><span class="sxs-lookup"><span data-stu-id="5840a-107">The **IKsControl** interface can be used in conjunction with the DeviceTopology API and the MMDevice API to access the KS properties of audio adapters.</span></span>

<span data-ttu-id="5840a-108">L’interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) est destinée principalement à être utilisée par des fournisseurs de matériel qui écrivent des applications de panneau de contrôle pour gérer leur matériel audio.</span><span class="sxs-lookup"><span data-stu-id="5840a-108">The [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface is intended primarily for use by hardware vendors who write control-panel applications to manage their audio hardware.</span></span> <span data-ttu-id="5840a-109">**IKsControl** est moins utile pour les applications audio à usage général qui ne sont pas liées à des périphériques matériels particuliers.</span><span class="sxs-lookup"><span data-stu-id="5840a-109">**IKsControl** is less useful for general-purpose audio applications that are not tied to particular hardware devices.</span></span> <span data-ttu-id="5840a-110">La raison en est que les fournisseurs de matériel implémentent fréquemment des mécanismes propriétaires pour accéder aux propriétés audio de leurs appareils.</span><span class="sxs-lookup"><span data-stu-id="5840a-110">The reason is that hardware vendors frequently implement proprietary mechanisms to access the audio properties of their devices.</span></span> <span data-ttu-id="5840a-111">Contrairement à l’API DeviceTopology, qui masque les caractéristiques des pilotes spécifiques au matériel et fournit une interface relativement uniforme pour accéder aux propriétés audio, les applications utilisent **IKsControl** pour communiquer directement avec les pilotes.</span><span class="sxs-lookup"><span data-stu-id="5840a-111">In contrast to the DeviceTopology API, which hides hardware-specific driver quirks and provides a relatively uniform interface for accessing audio properties, applications use **IKsControl** to communicate directly with drivers.</span></span> <span data-ttu-id="5840a-112">Pour plus d’informations sur **IKsControl**, consultez la documentation de Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="5840a-112">For more information about **IKsControl**, see the Windows DDK documentation.</span></span>

<span data-ttu-id="5840a-113">Comme indiqué dans [topologies d’appareils](device-topologies.md), une sous-unité dans la topologie d’un périphérique d’adaptateur peut prendre en charge une ou plusieurs des interfaces de contrôle spécifiques à la fonction affichées dans la colonne de gauche du tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="5840a-113">As discussed in [Device Topologies](device-topologies.md), a subunit in the topology of an adapter device might support one or more of the function-specific control interfaces shown in the left column of the following table.</span></span> <span data-ttu-id="5840a-114">Chaque entrée dans la colonne de droite de la table est la propriété KS qui correspond à l’interface de contrôle à gauche.</span><span class="sxs-lookup"><span data-stu-id="5840a-114">Each entry in the right column of the table is the KS property that corresponds to the control interface on the left.</span></span> <span data-ttu-id="5840a-115">L’interface de contrôle fournit un accès pratique à la propriété.</span><span class="sxs-lookup"><span data-stu-id="5840a-115">The control interface provides convenient access to the property.</span></span> <span data-ttu-id="5840a-116">La plupart des pilotes audio utilisent les propriétés KS pour représenter les fonctionnalités de traitement spécifiques aux fonctions des sous-unités (également appelées nœuds KS) dans les topologies de leurs adaptateurs audio.</span><span class="sxs-lookup"><span data-stu-id="5840a-116">Most audio drivers use KS properties to represent the function-specific processing capabilities of the subunits (also referred to as KS nodes) in the topologies of their audio adapters.</span></span> <span data-ttu-id="5840a-117">Pour plus d’informations sur les propriétés KS et les nœuds KS, consultez la documentation de Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="5840a-117">For more information about KS properties and KS nodes, see the Windows DDK documentation.</span></span>



| <span data-ttu-id="5840a-118">Interface de contrôle</span><span class="sxs-lookup"><span data-stu-id="5840a-118">Control interface</span></span>                                          | <span data-ttu-id="5840a-119">Propriété KS</span><span class="sxs-lookup"><span data-stu-id="5840a-119">KS property</span></span>                        |
|------------------------------------------------------------|------------------------------------|
| [<span data-ttu-id="5840a-120">**IAudioAutoGainControl**</span><span class="sxs-lookup"><span data-stu-id="5840a-120">**IAudioAutoGainControl**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioautogaincontrol)     | <span data-ttu-id="5840a-121">\_AGC audio \_ KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="5840a-121">KSPROPERTY\_AUDIO\_AGC</span></span>             |
| [<span data-ttu-id="5840a-122">**IAudioBass**</span><span class="sxs-lookup"><span data-stu-id="5840a-122">**IAudioBass**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiobass)                           | <span data-ttu-id="5840a-123">\_basses audio \_ KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="5840a-123">KSPROPERTY\_AUDIO\_BASS</span></span>            |
| [<span data-ttu-id="5840a-124">**IAudioChannelConfig**</span><span class="sxs-lookup"><span data-stu-id="5840a-124">**IAudioChannelConfig**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiochannelconfig)         | <span data-ttu-id="5840a-125">\_configuration du \_ canal \_ audio KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="5840a-125">KSPROPERTY\_AUDIO\_CHANNEL\_CONFIG</span></span> |
| [<span data-ttu-id="5840a-126">**IAudioInputSelector**</span><span class="sxs-lookup"><span data-stu-id="5840a-126">**IAudioInputSelector**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioinputselector)         | <span data-ttu-id="5840a-127">\_ \_ source mux audio \_ KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="5840a-127">KSPROPERTY\_AUDIO\_MUX\_SOURCE</span></span>     |
| [<span data-ttu-id="5840a-128">**IAudioLoudness**</span><span class="sxs-lookup"><span data-stu-id="5840a-128">**IAudioLoudness**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioloudness)                   | <span data-ttu-id="5840a-129">KSPROPERTY \_ audio \_</span><span class="sxs-lookup"><span data-stu-id="5840a-129">KSPROPERTY\_AUDIO\_LOUDNESS</span></span>        |
| [<span data-ttu-id="5840a-130">**IAudioMidrange**</span><span class="sxs-lookup"><span data-stu-id="5840a-130">**IAudioMidrange**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiomidrange)                   | <span data-ttu-id="5840a-131">KSPROPERTY \_ audio \_ Mid</span><span class="sxs-lookup"><span data-stu-id="5840a-131">KSPROPERTY\_AUDIO\_MID</span></span>             |
| [<span data-ttu-id="5840a-132">**IAudioMute**</span><span class="sxs-lookup"><span data-stu-id="5840a-132">**IAudioMute**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiomute)                           | <span data-ttu-id="5840a-133">KSPROPERTY \_ audio \_ muet</span><span class="sxs-lookup"><span data-stu-id="5840a-133">KSPROPERTY\_AUDIO\_MUTE</span></span>            |
| [<span data-ttu-id="5840a-134">**IAudioOutputSelector**</span><span class="sxs-lookup"><span data-stu-id="5840a-134">**IAudioOutputSelector**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiooutputselector)       | <span data-ttu-id="5840a-135">KSPROPERTY \_ audio \_ DEMUX \_ dest</span><span class="sxs-lookup"><span data-stu-id="5840a-135">KSPROPERTY\_AUDIO\_DEMUX\_DEST</span></span>     |
| [<span data-ttu-id="5840a-136">**IAudioPeakMeter**</span><span class="sxs-lookup"><span data-stu-id="5840a-136">**IAudioPeakMeter**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiopeakmeter)                 | <span data-ttu-id="5840a-137">KSPROPERTY \_ audio \_ PEAKMETER</span><span class="sxs-lookup"><span data-stu-id="5840a-137">KSPROPERTY\_AUDIO\_PEAKMETER</span></span>       |
| [<span data-ttu-id="5840a-138">**IAudioTreble**</span><span class="sxs-lookup"><span data-stu-id="5840a-138">**IAudioTreble**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiotreble)                       | <span data-ttu-id="5840a-139">\_ \_ aigus audio KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="5840a-139">KSPROPERTY\_AUDIO\_TREBLE</span></span>          |
| [<span data-ttu-id="5840a-140">**IAudioVolumeLevel**</span><span class="sxs-lookup"><span data-stu-id="5840a-140">**IAudioVolumeLevel**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiovolumelevel)             | <span data-ttu-id="5840a-141">KSPROPERTY \_ audio \_ VOLUMELEVEL</span><span class="sxs-lookup"><span data-stu-id="5840a-141">KSPROPERTY\_AUDIO\_VOLUMELEVEL</span></span>     |
| [<span data-ttu-id="5840a-142">**IDeviceSpecificProperty**</span><span class="sxs-lookup"><span data-stu-id="5840a-142">**IDeviceSpecificProperty**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicespecificproperty) | <span data-ttu-id="5840a-143">\_spécifique au \_ dev \_ audio KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="5840a-143">KSPROPERTY\_AUDIO\_DEV\_SPECIFIC</span></span>   |



 

<span data-ttu-id="5840a-144">Les topologies de certains adaptateurs audio peuvent contenir des sous-unités qui ont des propriétés KS qui ne sont pas répertoriées dans le tableau précédent.</span><span class="sxs-lookup"><span data-stu-id="5840a-144">The topologies of some audio adapters might contain subunits that have KS properties that are not listed in the preceding table.</span></span> <span data-ttu-id="5840a-145">Par exemple, supposons qu’un appel à la méthode [**IPart :: GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) pour une sous-unité particulière récupère la valeur Guid KSNODETYPE \_ tonal.</span><span class="sxs-lookup"><span data-stu-id="5840a-145">For example, assume that a call to the [**IPart::GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) method for a particular subunit retrieves the GUID value KSNODETYPE\_TONE.</span></span> <span data-ttu-id="5840a-146">Ce GUID de sous-type indique que la sous-unité prend en charge une ou plusieurs des propriétés KS suivantes :</span><span class="sxs-lookup"><span data-stu-id="5840a-146">This subtype GUID indicates that the subunit supports one or more of the following KS properties:</span></span>

-   <span data-ttu-id="5840a-147">\_basses audio \_ KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="5840a-147">KSPROPERTY\_AUDIO\_BASS</span></span>
-   <span data-ttu-id="5840a-148">KSPROPERTY \_ audio \_ Mid</span><span class="sxs-lookup"><span data-stu-id="5840a-148">KSPROPERTY\_AUDIO\_MID</span></span>
-   <span data-ttu-id="5840a-149">\_ \_ aigus audio KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="5840a-149">KSPROPERTY\_AUDIO\_TREBLE</span></span>
-   <span data-ttu-id="5840a-150">KSPROPERTY \_ audio \_ - \_ Booster</span><span class="sxs-lookup"><span data-stu-id="5840a-150">KSPROPERTY\_AUDIO\_BASS\_BOOST</span></span>

<span data-ttu-id="5840a-151">Les trois premières propriétés de cette liste sont accessibles par le biais des interfaces de contrôle qui s’affichent dans le tableau précédent, mais la \_ propriété KSPROPERTY audio \_ Bass \_ Boost n’a pas d’interface de contrôle correspondante dans l’API DeviceTopology.</span><span class="sxs-lookup"><span data-stu-id="5840a-151">The first three properties in this list can be accessed through the control interfaces that appear in the preceding table, but the KSPROPERTY\_AUDIO\_BASS\_BOOST property has no corresponding control interface in the DeviceTopology API.</span></span> <span data-ttu-id="5840a-152">Toutefois, une application peut utiliser l’interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) pour accéder à cette propriété, si la sous-unité prend en charge la propriété.</span><span class="sxs-lookup"><span data-stu-id="5840a-152">However, an application can use the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface to access this property, if the subunit supports the property.</span></span>

<span data-ttu-id="5840a-153">Les étapes suivantes sont requises pour accéder à la \_ propriété KSPROPERTY audio \_ Bass \_ Boost d’une sous-unité de sous-type KSNODETYPE \_ tonal :</span><span class="sxs-lookup"><span data-stu-id="5840a-153">The following steps are required to access the KSPROPERTY\_AUDIO\_BASS\_BOOST property of a subunit of subtype KSNODETYPE\_TONE:</span></span>

1.  <span data-ttu-id="5840a-154">Appelez la méthode [**IConnector :: GetDeviceIdConnectedTo**](/windows/desktop/api/Devicetopology/nf-devicetopology-iconnector-getdeviceidconnectedto) ou [**IDeviceTopology :: GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) pour obtenir la chaîne d’ID d’appareil qui identifie l’appareil d’adaptateur.</span><span class="sxs-lookup"><span data-stu-id="5840a-154">Call the [**IConnector::GetDeviceIdConnectedTo**](/windows/desktop/api/Devicetopology/nf-devicetopology-iconnector-getdeviceidconnectedto) or [**IDeviceTopology::GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) method to obtain the device ID string that identifies the adapter device.</span></span> <span data-ttu-id="5840a-155">Cette chaîne est similaire à une [chaîne d’ID de point de terminaison](endpoint-id-strings.md), à ceci près qu’elle identifie un périphérique d’adaptateur au lieu d’un périphérique de point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="5840a-155">This string is similar to an [endpoint ID string](endpoint-id-strings.md), except that it identifies an adapter device instead of an endpoint device.</span></span> <span data-ttu-id="5840a-156">Pour plus d’informations sur la différence entre un périphérique d’adaptateur et un périphérique de point de terminaison, consultez [périphériques de point de terminaison audio](audio-endpoint-devices.md).</span><span class="sxs-lookup"><span data-stu-id="5840a-156">For more information about the difference between an adapter device and an endpoint device, see [Audio Endpoint Devices](audio-endpoint-devices.md).</span></span>
2.  <span data-ttu-id="5840a-157">Obtenez l’interface [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) de l’adaptateur en appelant la méthode [**IMMDeviceEnumerator :: GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) avec la chaîne d’ID de l’appareil.</span><span class="sxs-lookup"><span data-stu-id="5840a-157">Obtain the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface of the adapter device by calling the [**IMMDeviceEnumerator::GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) method with the device ID string.</span></span> <span data-ttu-id="5840a-158">Cette interface **IMMDevice** est identique à l’interface décrite dans **interface IMMDevice**, mais elle représente un périphérique adaptateur au lieu d’un périphérique de point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="5840a-158">This **IMMDevice** interface is the same as the interface described in **IMMDevice Interface**, but it represents an adapter device instead of an endpoint device.</span></span>
3.  <span data-ttu-id="5840a-159">Obtenez l’interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) sur la sous-unité en appelant la méthode [**IMMDevice :: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) avec l' *IID* de paramètre défini sur **REFIID** IID \_ IKsControl.</span><span class="sxs-lookup"><span data-stu-id="5840a-159">Obtain the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface on the subunit by calling the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method with parameter *iid* set to **REFIID** IID\_IKsControl.</span></span> <span data-ttu-id="5840a-160">Notez que les interfaces prises en charge par cette méthode **Activate** , qui est destinée à un périphérique d’adaptateur, sont différentes des interfaces prises en charge par la méthode **Activate** pour un appareil de point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="5840a-160">Note that the interfaces supported by this **Activate** method, which is for an adapter device, are different from the interfaces supported by the **Activate** method for an endpoint device.</span></span> <span data-ttu-id="5840a-161">En particulier, la méthode **Activate** pour un appareil d’adaptateur prend en charge **IKsControl**.</span><span class="sxs-lookup"><span data-stu-id="5840a-161">In particular, the **Activate** method for an adapter device supports **IKsControl**.</span></span>
4.  <span data-ttu-id="5840a-162">Appelez la méthode [**IPart :: GetLocalId**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getlocalid) pour obtenir l’ID local de la sous-unité.</span><span class="sxs-lookup"><span data-stu-id="5840a-162">Call the [**IPart::GetLocalId**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getlocalid) method to obtain the local ID of the subunit.</span></span>
5.  <span data-ttu-id="5840a-163">Construit une demande de propriété KS.</span><span class="sxs-lookup"><span data-stu-id="5840a-163">Construct a KS property request.</span></span> <span data-ttu-id="5840a-164">L’ID de nœud KS requis pour la requête est contenu dans les 16 bits les moins significatifs de l’ID local obtenu à l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="5840a-164">The KS node ID required for the request is contained in the 16 least-significant bits of the local ID obtained in the previous step.</span></span>
6.  <span data-ttu-id="5840a-165">Envoyez la demande de propriété KS au pilote audio en appelant la méthode [**IKsControl :: KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) .</span><span class="sxs-lookup"><span data-stu-id="5840a-165">Send the KS property request to the audio driver by calling the [**IKsControl::KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) method.</span></span> <span data-ttu-id="5840a-166">Pour plus d’informations sur cette méthode, consultez la documentation de Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="5840a-166">For more information about this method, see the Windows DDK documentation.</span></span>

<span data-ttu-id="5840a-167">L’exemple de code suivant récupère la valeur de la \_ propriété KSPROPERTY audio \_ Bass \_ Boost à partir d’une sous-unité de sous-type KSNODETYPE \_ Tone :</span><span class="sxs-lookup"><span data-stu-id="5840a-167">The following code example retrieves the value of the KSPROPERTY\_AUDIO\_BASS\_BOOST property from a subunit of subtype KSNODETYPE\_TONE:</span></span>


```C++
//-----------------------------------------------------------
// This function calls the IKsControl::Property method to get
// the value of the KSPROPERTY_AUDIO_BASS_BOOST property of
// a subunit. Parameter pPart should point to a part that is
// a subunit with a subtype GUID value of KSNODETYPE_TONE.
//-----------------------------------------------------------
#define PARTID_MASK 0x0000ffff
#define EXIT_ON_ERROR(hres)  \
              if (FAILED(hres)) { goto Exit; }
#define SAFE_RELEASE(punk)  \
              if ((punk) != NULL)  \
                { (punk)->Release(); (punk) = NULL; }

const IID IID_IKsControl = __uuidof(IKsControl);

HRESULT GetBassBoost(IMMDeviceEnumerator *pEnumerator,
                     IPart *pPart, BOOL *pbValue)
{
    HRESULT hr;
    IDeviceTopology *pTopology = NULL;
    IMMDevice *pPnpDevice = NULL;
    IKsControl *pKsControl = NULL;
    LPWSTR pwszDeviceId = NULL;

    if (pEnumerator == NULL || pPart == NULL || pbValue == NULL)
    {
        return E_INVALIDARG;
    }

    // Get the topology object for the adapter device that contains
    // the subunit represented by the IPart interface.
    hr = pPart->GetTopologyObject(&pTopology);
    EXIT_ON_ERROR(hr)

    // Get the device ID string that identifies the adapter device.
    hr = pTopology->GetDeviceId(&pwszDeviceId);
    EXIT_ON_ERROR(hr)

    // Get the IMMDevice interface of the adapter device object.
    hr = pEnumerator->GetDevice(pwszDeviceId, &pPnpDevice);
    EXIT_ON_ERROR(hr)

    // Activate an IKsControl interface on the adapter device object.
    hr = pPnpDevice->Activate(IID_IKsControl, CLSCTX_ALL, NULL, (void**)&pKsControl);
    EXIT_ON_ERROR(hr)

    // Get the local ID of the subunit (contains the KS node ID).
    UINT localId = 0;
    hr = pPart->GetLocalId(&localId);
    EXIT_ON_ERROR(hr)

    KSNODEPROPERTY_AUDIO_CHANNEL ksprop;
    ZeroMemory(&ksprop, sizeof(ksprop));
    ksprop.NodeProperty.Property.Set = KSPROPSETID_Audio;
    ksprop.NodeProperty.Property.Id = KSPROPERTY_AUDIO_BASS_BOOST;
    ksprop.NodeProperty.Property.Flags = KSPROPERTY_TYPE_GET | KSPROPERTY_TYPE_TOPOLOGY;
    ksprop.NodeProperty.NodeId = localId & PARTID_MASK;
    ksprop.Channel = 0;

    // Send the property request.to the device driver.
    BOOL bValue = FALSE;
    ULONG valueSize;
    hr = pKsControl->KsProperty(
                         &ksprop.NodeProperty.Property, sizeof(ksprop),
                         &bValue, sizeof(bValue), &valueSize);
    EXIT_ON_ERROR(hr)

    *pbValue = bValue;

Exit:
    SAFE_RELEASE(pTopology)
    SAFE_RELEASE(pPnpDevice)
    SAFE_RELEASE(pKsControl)
    CoTaskMemFree(pwszDeviceId);
    return hr;
}

```



<span data-ttu-id="5840a-168">Dans l’exemple de code précédent, la fonction GetBassBoost prend les trois paramètres suivants :</span><span class="sxs-lookup"><span data-stu-id="5840a-168">In the preceding code example, the GetBassBoost function takes the following three parameters:</span></span>

-   <span data-ttu-id="5840a-169">`pEnumerator` pointe vers l’interface [**IMMDeviceEnumerator**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdeviceenumerator) d’un énumérateur de point de terminaison audio.</span><span class="sxs-lookup"><span data-stu-id="5840a-169">`pEnumerator` points to the [**IMMDeviceEnumerator**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdeviceenumerator) interface of an audio endpoint enumerator.</span></span>
-   <span data-ttu-id="5840a-170">`pPart` pointe vers l’interface [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) d’une sous-unité qui a un sous-type de KSNODETYPE \_ Tone.</span><span class="sxs-lookup"><span data-stu-id="5840a-170">`pPart` points to the [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) interface of a subunit that has a subtype of KSNODETYPE\_TONE.</span></span>
-   <span data-ttu-id="5840a-171">`pbValue` pointe vers une variable **booléenne** dans laquelle la fonction écrit la valeur de la propriété.</span><span class="sxs-lookup"><span data-stu-id="5840a-171">`pbValue` points to a **BOOL** variable into which the function writes the property value.</span></span>

<span data-ttu-id="5840a-172">Un programme appelle GetBassBoost uniquement après avoir appelé [**IPart :: GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) et détermine que le sous-type de la sous-unité est KSNODETYPE \_ Tone.</span><span class="sxs-lookup"><span data-stu-id="5840a-172">A program calls GetBassBoost only after it calls [**IPart::GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) and determines that the subtype of the subunit is KSNODETYPE\_TONE.</span></span> <span data-ttu-id="5840a-173">La valeur de la propriété est **true** si la Booster est activée.</span><span class="sxs-lookup"><span data-stu-id="5840a-173">The property value is **TRUE** if bass boost is enabled.</span></span> <span data-ttu-id="5840a-174">La **valeur est false** si l’augmentation des basses est désactivée.</span><span class="sxs-lookup"><span data-stu-id="5840a-174">It is **FALSE** if bass boost is disabled.</span></span>

<span data-ttu-id="5840a-175">Au début de la fonction GetBassBoost, l’appel à la méthode [**IPart :: GetTopologyObject**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-gettopologyobject) obtient l’interface [**IDeviceTopology**](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicetopology) du périphérique adaptateur qui contient la sous-unité de \_ ton KSNODETYPE.</span><span class="sxs-lookup"><span data-stu-id="5840a-175">At the beginning of the GetBassBoost function, the call to the [**IPart::GetTopologyObject**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-gettopologyobject) method obtains the [**IDeviceTopology**](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicetopology) interface of the adapter device that contains the KSNODETYPE\_TONE subunit.</span></span> <span data-ttu-id="5840a-176">L’appel de la méthode [**IDeviceTopology :: GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) récupère la chaîne d’ID de l’appareil qui identifie l’appareil de l’adaptateur.</span><span class="sxs-lookup"><span data-stu-id="5840a-176">The [**IDeviceTopology::GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) method call retrieves the device ID string that identifies the adapter device.</span></span> <span data-ttu-id="5840a-177">L’appel de la méthode [**IMMDeviceEnumerator :: GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) prend la chaîne d’ID de l’appareil comme paramètre d’entrée et récupère l’interface [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) de l’appareil de l’adaptateur.</span><span class="sxs-lookup"><span data-stu-id="5840a-177">The [**IMMDeviceEnumerator::GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) method call takes the device ID string as an input parameter, and retrieves the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface of the adapter device.</span></span> <span data-ttu-id="5840a-178">Ensuite, l’appel de la méthode [**IMMDevice :: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) récupère l’interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) de la sous-unité.</span><span class="sxs-lookup"><span data-stu-id="5840a-178">Next, the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method call retrieves the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface of the subunit.</span></span> <span data-ttu-id="5840a-179">Pour plus d’informations sur l’interface **IKsControl** , consultez la documentation de Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="5840a-179">For more information about the **IKsControl** interface, see the Windows DDK documentation.</span></span>

<span data-ttu-id="5840a-180">Ensuite, l’exemple de code précédent crée une structure de [**\_ \_ canal audio KSNODEPROPERTY**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) qui décrit la propriété Bass-Boost.</span><span class="sxs-lookup"><span data-stu-id="5840a-180">Next, the preceding code example creates a [**KSNODEPROPERTY\_AUDIO\_CHANNEL**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) structure that describes the bass-boost property.</span></span> <span data-ttu-id="5840a-181">L’exemple de code passe un pointeur vers la structure à la méthode [**IKsControl :: KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) , qui utilise les informations de la structure pour récupérer la valeur de la propriété.</span><span class="sxs-lookup"><span data-stu-id="5840a-181">The code example passes a pointer to the structure to the [**IKsControl::KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) method, which uses the information in the structure to retrieve the property value.</span></span> <span data-ttu-id="5840a-182">Pour plus d’informations sur la structure de **\_ \_ canaux audio KSNODEPROPERTY** et la méthode **IKsControl :: KsProperty** , consultez la documentation de Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="5840a-182">For more information about the **KSNODEPROPERTY\_AUDIO\_CHANNEL** structure and the **IKsControl::KsProperty** method, see the Windows DDK documentation.</span></span>

<span data-ttu-id="5840a-183">Le matériel audio affecte généralement un état d’amélioration des basses à chaque canal dans un flux audio.</span><span class="sxs-lookup"><span data-stu-id="5840a-183">Audio hardware typically assigns a separate bass-boost state to each channel in an audio stream.</span></span> <span data-ttu-id="5840a-184">En principe, la Booster de basses peut être activée pour certains canaux et désactivée pour d’autres.</span><span class="sxs-lookup"><span data-stu-id="5840a-184">In principle, bass boost can be enabled for some channels and disabled for others.</span></span> <span data-ttu-id="5840a-185">La structure de [**\_ \_ canal audio KSNODEPROPERTY**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) contient un membre de **canal** qui spécifie le numéro de canal.</span><span class="sxs-lookup"><span data-stu-id="5840a-185">The [**KSNODEPROPERTY\_AUDIO\_CHANNEL**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) structure contains a **Channel** member that specifies the channel number.</span></span> <span data-ttu-id="5840a-186">Si un flux contient *n* canaux, les canaux sont numérotés de 0 à *n*— 1.</span><span class="sxs-lookup"><span data-stu-id="5840a-186">If a stream contains *N* channels, the channels are numbered from 0 to *N*— 1.</span></span> <span data-ttu-id="5840a-187">L’exemple de code précédent obtient la valeur de la propriété Bass-Boost pour le canal 0 uniquement.</span><span class="sxs-lookup"><span data-stu-id="5840a-187">The preceding code example gets the value of the bass-boost property for channel 0 only.</span></span> <span data-ttu-id="5840a-188">Cette implémentation suppose implicitement que les propriétés d’augmentation des basses pour tous les canaux sont définies uniformément dans le même État.</span><span class="sxs-lookup"><span data-stu-id="5840a-188">This implementation implicitly assumes that the bass-boost properties for all of the channels are set uniformly to the same state.</span></span> <span data-ttu-id="5840a-189">Par conséquent, la lecture de la propriété Bass-Boost pour le canal 0 suffit pour déterminer la valeur de la propriété de l’augmentation du nombre de basses pour le flux.</span><span class="sxs-lookup"><span data-stu-id="5840a-189">Thus, reading the bass-boost property for channel 0 is sufficient to determine the bass-boost property value for the stream.</span></span> <span data-ttu-id="5840a-190">Pour être cohérente avec cette hypothèse, une fonction correspondante permettant de définir la propriété Bass-Boost définit tous les canaux sur la même valeur de propriété Bass-Boost.</span><span class="sxs-lookup"><span data-stu-id="5840a-190">To be consistent with this assumption, a corresponding function to set the bass-boost property would set all channels to the same bass-boost property value.</span></span> <span data-ttu-id="5840a-191">Il s’agit de conventions raisonnables, mais tous les fournisseurs de matériel ne les suivent pas nécessairement.</span><span class="sxs-lookup"><span data-stu-id="5840a-191">These are reasonable conventions, but not all hardware vendors necessarily follow them.</span></span> <span data-ttu-id="5840a-192">Par exemple, un fournisseur peut fournir une application de panneau de configuration qui active le suramplificateur de basses uniquement pour les canaux qui dirigent des orateurs à plage complète.</span><span class="sxs-lookup"><span data-stu-id="5840a-192">For example, a vendor might supply a control-panel application that enables bass boost only for channels that drive full-range speakers.</span></span> <span data-ttu-id="5840a-193">(Un conférencier complet est en train de jouer des sons sur toute la plage de basses à des aigus.) Dans ce cas, la valeur de propriété récupérée par l’exemple de code précédent peut ne pas représenter avec précision l’état de booster (Bass-Boost) du flux.</span><span class="sxs-lookup"><span data-stu-id="5840a-193">(A full-range speaker is capable of playing sounds over the full range from bass to treble.) In that case, the property value retrieved by the preceding code example might not accurately represent the bass-boost state of the stream.</span></span>

<span data-ttu-id="5840a-194">Les clients qui utilisent les interfaces de contrôle figurant dans le tableau précédent peuvent appeler la méthode [**IPart :: RegisterControlChangeCallback**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-registercontrolchangecallback) pour s’inscrire aux notifications lorsque la valeur d’un paramètre de contrôle change.</span><span class="sxs-lookup"><span data-stu-id="5840a-194">Clients that use the control interfaces listed in the preceding table can call the [**IPart::RegisterControlChangeCallback**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-registercontrolchangecallback) method to register for notifications when the value of a control parameter changes.</span></span> <span data-ttu-id="5840a-195">Notez que l’interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) ne fournit pas un moyen similaire pour que les clients s’inscrivent pour les notifications lorsqu’une valeur de propriété change.</span><span class="sxs-lookup"><span data-stu-id="5840a-195">Note that the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface does not provide a similar means for clients to register for notifications when a property value changes.</span></span> <span data-ttu-id="5840a-196">Si **IKsControl** prenait en charge les notifications de modification de propriété, il peut informer une application qu’une autre application a modifié une valeur de propriété.</span><span class="sxs-lookup"><span data-stu-id="5840a-196">If **IKsControl** did support property-change notifications, it could inform an application when another application changed a property value.</span></span> <span data-ttu-id="5840a-197">Toutefois, contrairement aux contrôles les plus couramment utilisés qui sont surveillés par le biais de notifications [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) , les propriétés gérées par **IKsControl** sont principalement destinées à être utilisées par les fournisseurs de matériel, et ces propriétés sont susceptibles d’être modifiées uniquement par les applications du panneau de configuration écrites par les fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="5840a-197">However, in contrast to the more commonly used controls that are monitored through [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) notifications, the properties managed by **IKsControl** are intended primarily for use by hardware vendors, and those properties are likely to be changed only by control-panel applications written by the vendors.</span></span> <span data-ttu-id="5840a-198">Si une application doit détecter les modifications de propriété apportées par une autre application, elle peut détecter les modifications en interrogeant régulièrement la valeur de la propriété par le biais de **IKsControl**.</span><span class="sxs-lookup"><span data-stu-id="5840a-198">If an application must detect property changes made by another application, it can detect the changes by periodically polling the property value through **IKsControl**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="5840a-199">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="5840a-199">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5840a-200">Guide de programmation</span><span class="sxs-lookup"><span data-stu-id="5840a-200">Programming Guide</span></span>](programming-guide.md)
</dt> </dl>

 

 
