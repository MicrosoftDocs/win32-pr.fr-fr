---
description: Composants audio User-Mode
ms.assetid: b240b629-5bb6-4b07-95be-8ca5a14a3567
title: Composants audio User-Mode
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 18715db2d32be3c4a70182571028acbfca411539
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103861293"
---
# <a name="user-mode-audio-components"></a><span data-ttu-id="493f3-103">Composants audio User-Mode</span><span class="sxs-lookup"><span data-stu-id="493f3-103">User-Mode Audio Components</span></span>

<span data-ttu-id="493f3-104">Dans Windows Vista, les API audio principales jouent le rôle de base du sous-système audio en mode utilisateur.</span><span class="sxs-lookup"><span data-stu-id="493f3-104">In Windows Vista, the core audio APIs serve as the foundation of the user-mode audio subsystem.</span></span> <span data-ttu-id="493f3-105">Les API audio de base sont implémentées sous la forme d’une couche fine de composants système en mode utilisateur qui séparent les clients en mode utilisateur des pilotes audio en mode noyau et du matériel audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-105">The core audio APIs are implemented as a thin layer of user-mode system components that separate user-mode clients from kernel-mode audio drivers and audio hardware.</span></span> <span data-ttu-id="493f3-106">Les API audio de niveau supérieur, telles que DirectSound et les fonctions multimédias de Windows, accèdent aux périphériques audio via les API audio de base.</span><span class="sxs-lookup"><span data-stu-id="493f3-106">Higher-level audio APIs, such as DirectSound and the Windows multimedia functions, access audio devices through the core audio APIs.</span></span> <span data-ttu-id="493f3-107">De plus, certaines applications audio communiquent directement avec les API audio de base.</span><span class="sxs-lookup"><span data-stu-id="493f3-107">In addition, some audio applications communicate directly with the core audio APIs.</span></span>

<span data-ttu-id="493f3-108">Les API audio de base prennent en charge la notion conviviale d’un périphérique de point de terminaison audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-108">The core audio APIs support the user-friendly notion of an audio endpoint device.</span></span> <span data-ttu-id="493f3-109">Un périphérique de point de terminaison audio est une abstraction logicielle qui représente un appareil physique que l’utilisateur manipule directement.</span><span class="sxs-lookup"><span data-stu-id="493f3-109">An audio endpoint device is a software abstraction that represents a physical device that the user manipulates directly.</span></span> <span data-ttu-id="493f3-110">Les haut-parleurs, les casques et les microphones sont des exemples d’appareils de point de terminaison audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-110">Examples of audio endpoint devices are speakers, headphones, and microphones.</span></span> <span data-ttu-id="493f3-111">Pour plus d’informations, consultez [périphériques de point de terminaison audio](audio-endpoint-devices.md).</span><span class="sxs-lookup"><span data-stu-id="493f3-111">For more information, see [Audio Endpoint Devices](audio-endpoint-devices.md).</span></span>

<span data-ttu-id="493f3-112">Le diagramme suivant montre les API audio principales et leurs relations avec les autres composants audio en mode utilisateur de Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="493f3-112">The following diagram shows the core audio APIs and their relationship to the other user-mode audio components in Windows Vista.</span></span>

![diagramme des composants de rendu audio en mode utilisateur](images/fig1.jpg)

<span data-ttu-id="493f3-114">Par souci de simplicité, le diagramme ci-dessus affiche uniquement un chemin de données de rendu audio vers l’appareil de point de terminaison : le diagramme n’affiche pas de chemin de données de capture audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-114">For simplicity, the preceding diagram shows only an audio-rendering data path to the endpoint device—the diagram does not show an audio-capture data path.</span></span> <span data-ttu-id="493f3-115">Les API audio principales incluent l' [API MMDevice](mmdevice-api.md), [WASAPI](wasapi.md), l' [API DeviceTopology](devicetopology-api.md)et l' [API EndpointVolume](endpointvolume-api.md), qui sont implémentées dans le Audioses.dll et Mmdevapi.dll les modules système en mode utilisateur.</span><span class="sxs-lookup"><span data-stu-id="493f3-115">The core audio APIs include the [MMDevice API](mmdevice-api.md), [WASAPI](wasapi.md), the [DeviceTopology API](devicetopology-api.md), and the [EndpointVolume API](endpointvolume-api.md), which are implemented in the Audioses.dll and Mmdevapi.dll user-mode system modules.</span></span>

<span data-ttu-id="493f3-116">Comme indiqué dans le diagramme précédent, les API audio principales constituent une base pour les API de niveau supérieur suivantes :</span><span class="sxs-lookup"><span data-stu-id="493f3-116">As shown in the preceding diagram, the core audio APIs provide a foundation for the following higher-level APIs:</span></span>

-   <span data-ttu-id="493f3-117">Media Foundation</span><span class="sxs-lookup"><span data-stu-id="493f3-117">Media Foundation</span></span>
-   <span data-ttu-id="493f3-118">Fonctions **waveXxx** et **mixerXxx** Windows Multimedia</span><span class="sxs-lookup"><span data-stu-id="493f3-118">Windows multimedia **waveXxx** and **mixerXxx** functions</span></span>
-   <span data-ttu-id="493f3-119">DirectSound</span><span class="sxs-lookup"><span data-stu-id="493f3-119">DirectSound</span></span>
-   <span data-ttu-id="493f3-120">DirectMusic</span><span class="sxs-lookup"><span data-stu-id="493f3-120">DirectMusic</span></span>

<span data-ttu-id="493f3-121">DirectSound, les fonctions audio Windows Multimedia et Media Foundation (via son convertisseur audio de streaming, ou le composant SAR) communiquent directement avec les API audio de base.</span><span class="sxs-lookup"><span data-stu-id="493f3-121">DirectSound, the Windows multimedia audio functions, and Media Foundation (through its streaming audio renderer, or SAR, component) communicate directly with the core audio APIs.</span></span> <span data-ttu-id="493f3-122">DirectMusic communique avec les API audio de base indirectement via DirectSound.</span><span class="sxs-lookup"><span data-stu-id="493f3-122">DirectMusic communicates with the core audio APIs indirectly through DirectSound.</span></span>

<span data-ttu-id="493f3-123">Un client de WASAPI transmet des données à un appareil de point de terminaison par le biais d’une *mémoire tampon de point de terminaison*.</span><span class="sxs-lookup"><span data-stu-id="493f3-123">A client of WASAPI passes data to an endpoint device through an *endpoint buffer*.</span></span> <span data-ttu-id="493f3-124">Les composants matériels et logiciels système gèrent le déplacement des données de la mémoire tampon du point de terminaison vers l’appareil de point de terminaison d’une manière largement transparente pour le client.</span><span class="sxs-lookup"><span data-stu-id="493f3-124">System software and hardware components manage the movement of data from the endpoint buffer to the endpoint device in a manner that is largely transparent to the client.</span></span> <span data-ttu-id="493f3-125">En outre, pour un périphérique de point de terminaison qui se connecte à un adaptateur audio avec la détection de présence jack-Jack, le client peut créer une mémoire tampon de point de terminaison uniquement pour un périphérique de point de terminaison qui est physiquement présent.</span><span class="sxs-lookup"><span data-stu-id="493f3-125">Furthermore, for an endpoint device that plugs into an audio adapter with jack-presence detection, the client can create an endpoint buffer only for an endpoint device that is physically present.</span></span> <span data-ttu-id="493f3-126">Pour plus d’informations sur la détection de la présence des jacks, consultez [périphériques de point de terminaison audio](audio-endpoint-devices.md).</span><span class="sxs-lookup"><span data-stu-id="493f3-126">For more information about jack-presence detection, see [Audio Endpoint Devices](audio-endpoint-devices.md).</span></span>

<span data-ttu-id="493f3-127">Le diagramme précédent montre deux types de tampons de point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="493f3-127">The preceding diagram shows two types of endpoint buffer.</span></span> <span data-ttu-id="493f3-128">Si un client de WASAPI ouvre un flux en *mode partagé*, le client écrit des données audio dans le tampon de point de terminaison et le moteur audio Windows lit les données à partir de la mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="493f3-128">If a client of WASAPI opens a stream in *shared mode*, then the client writes audio data to the endpoint buffer and the Windows audio engine reads the data from the buffer.</span></span> <span data-ttu-id="493f3-129">Dans ce mode, le client partage le matériel audio avec d’autres applications qui s’exécutent dans d’autres processus.</span><span class="sxs-lookup"><span data-stu-id="493f3-129">In this mode, the client shares the audio hardware with other applications running in other processes.</span></span> <span data-ttu-id="493f3-130">Le moteur audio mélange les flux de ces applications et lit le mélange résultant via le matériel.</span><span class="sxs-lookup"><span data-stu-id="493f3-130">The audio engine mixes the streams from these applications and plays the resulting mix through the hardware.</span></span> <span data-ttu-id="493f3-131">Le moteur audio est un composant système en mode utilisateur (Audiodg.dll) qui effectue toutes ses opérations de traitement de flux dans le logiciel.</span><span class="sxs-lookup"><span data-stu-id="493f3-131">The audio engine is a user-mode system component (Audiodg.dll) that performs all of its stream-processing operations in software.</span></span> <span data-ttu-id="493f3-132">En revanche, si un client ouvre un flux en *mode exclusif*, le client dispose d’un accès exclusif au matériel audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-132">In contrast, if a client opens a stream in *exclusive mode*, the client has exclusive access to the audio hardware.</span></span> <span data-ttu-id="493f3-133">En règle générale, seul un petit nombre d’applications « Pro audio » ou RTC nécessitent le mode exclusif.</span><span class="sxs-lookup"><span data-stu-id="493f3-133">Typically, only a small number of "pro audio" or RTC applications require exclusive mode.</span></span> <span data-ttu-id="493f3-134">Bien que le diagramme affiche à la fois les flux en mode partagé et en mode exclusif, un seul de ces deux flux (et sa mémoire tampon de point de terminaison correspondante) existe, selon que le client ouvre ou non le flux en mode partagé ou en mode exclusif.</span><span class="sxs-lookup"><span data-stu-id="493f3-134">Although the diagram shows both the shared-mode and exclusive-mode streams, only one of these two streams (and its corresponding endpoint buffer) exists, depending on whether the client opens the stream in shared mode or in exclusive mode.</span></span>

<span data-ttu-id="493f3-135">En mode exclusif, le client peut choisir d’ouvrir le flux dans n’importe quel format audio pris en charge par l’appareil de point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="493f3-135">In exclusive mode, the client can choose to open the stream in any audio format that the endpoint device supports.</span></span> <span data-ttu-id="493f3-136">En mode partagé, le client doit ouvrir le flux au format Mix qui est actuellement utilisé par le moteur audio (ou un format similaire au format Mix).</span><span class="sxs-lookup"><span data-stu-id="493f3-136">In shared mode, the client must open the stream in the mix format that is currently in use by the audio engine (or a format that is similar to the mix format).</span></span> <span data-ttu-id="493f3-137">Les flux d’entrée du moteur audio et la combinaison de sortie du moteur sont tous dans ce format.</span><span class="sxs-lookup"><span data-stu-id="493f3-137">The audio engine's input streams and the output mix from the engine are all in this format.</span></span>

<span data-ttu-id="493f3-138">Dans Windows 7, une nouvelle fonctionnalité appelée *mode à faible latence* a été ajoutée pour les flux en mode partage.</span><span class="sxs-lookup"><span data-stu-id="493f3-138">In Windows 7, a new feature called *low-latence mode* has been added for streams in share mode.</span></span> <span data-ttu-id="493f3-139">Dans ce mode, le moteur audio s’exécute en mode par extraction, ce qui réduit considérablement la latence.</span><span class="sxs-lookup"><span data-stu-id="493f3-139">In this mode, the audio engine runs in pull mode, in which there a significant reduction in latency.</span></span> <span data-ttu-id="493f3-140">Cela est très utile pour les applications de communication qui nécessitent une faible latence de flux audio pour accélérer la diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="493f3-140">This is very useful for communication applications that require low audio stream latency for faster streaming.</span></span>

<span data-ttu-id="493f3-141">Les applications qui gèrent des flux audio à faible latence peuvent utiliser le service Planificateur de classes multimédias (MMCSS) dans Windows Vista pour augmenter la priorité des threads d’application qui accèdent aux mémoires tampons de point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="493f3-141">Applications that manage low-latency audio streams can use the Multimedia Class Scheduler Service (MMCSS) in Windows Vista to increase the priority of application threads that access endpoint buffers.</span></span> <span data-ttu-id="493f3-142">MMCSS permet aux applications audio de s’exécuter avec une priorité élevée sans refuser les ressources du processeur aux applications de faible priorité.</span><span class="sxs-lookup"><span data-stu-id="493f3-142">MMCSS enables audio applications to run at high priority without denying CPU resources to lower-priority applications.</span></span> <span data-ttu-id="493f3-143">MMCSS affecte une priorité à un thread en fonction de son nom de tâche.</span><span class="sxs-lookup"><span data-stu-id="493f3-143">MMCSS assigns a priority to a thread based on its task name.</span></span> <span data-ttu-id="493f3-144">Par exemple, Windows Vista prend en charge les noms de tâches « audio » et « audio pro » pour les threads qui gèrent des flux audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-144">For example, Windows Vista supports the task names "Audio" and "Pro Audio" for threads that manage audio streams.</span></span> <span data-ttu-id="493f3-145">Par défaut, la priorité d’un thread « audio Pro » est supérieure à celle d’un thread « audio ».</span><span class="sxs-lookup"><span data-stu-id="493f3-145">By default, the priority of a "Pro Audio" thread is higher than that of an "Audio" thread.</span></span> <span data-ttu-id="493f3-146">Pour plus d’informations sur MMCSS, consultez la documentation SDK Windows.</span><span class="sxs-lookup"><span data-stu-id="493f3-146">For more information about MMCSS, see the Windows SDK documentation.</span></span>

<span data-ttu-id="493f3-147">Les API audio principales prennent en charge les formats de flux PCM et non-PCM.</span><span class="sxs-lookup"><span data-stu-id="493f3-147">The core audio APIs support both PCM and non-PCM stream formats.</span></span> <span data-ttu-id="493f3-148">Toutefois, le moteur audio ne peut mélanger que des flux PCM.</span><span class="sxs-lookup"><span data-stu-id="493f3-148">However, the audio engine can mix only PCM streams.</span></span> <span data-ttu-id="493f3-149">Ainsi, seuls les flux en mode exclusif peuvent avoir des formats non-PCM.</span><span class="sxs-lookup"><span data-stu-id="493f3-149">Thus, only exclusive-mode streams can have non-PCM formats.</span></span> <span data-ttu-id="493f3-150">Pour plus d’informations, consultez [formats de périphérique](device-formats.md).</span><span class="sxs-lookup"><span data-stu-id="493f3-150">For more information, see [Device Formats](device-formats.md).</span></span>

<span data-ttu-id="493f3-151">Le moteur audio s’exécute dans son propre processus protégé, qui est distinct du processus dans lequel l’application s’exécute.</span><span class="sxs-lookup"><span data-stu-id="493f3-151">The audio engine runs in its own protected process, which is separate from the process that the application runs in.</span></span> <span data-ttu-id="493f3-152">Pour prendre en charge un flux en mode partagé, le service audio Windows (la zone intitulée « service audio » dans le diagramme précédent) alloue un tampon de point de terminaison inter-processus accessible à la fois à l’application et au moteur audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-152">To support a shared-mode stream, the Windows audio service (the box labeled "Audio Service" in the preceding diagram) allocates a cross-process endpoint buffer that is accessible to both the application and the audio engine.</span></span> <span data-ttu-id="493f3-153">Pour le mode exclusif, la mémoire tampon du point de terminaison réside dans la mémoire qui est accessible à la fois à l’application et au matériel audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-153">For exclusive mode, the endpoint buffer resides in memory that is accessible to both the application and the audio hardware.</span></span>

<span data-ttu-id="493f3-154">Le service audio Windows est le module qui implémente la stratégie audio Windows.</span><span class="sxs-lookup"><span data-stu-id="493f3-154">The Windows audio service is the module that implements Windows audio policy.</span></span> <span data-ttu-id="493f3-155">La stratégie audio est un ensemble de règles internes que le système applique aux interactions entre les flux audio de plusieurs applications qui partagent et rivalisent pour l’utilisation du même matériel audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-155">Audio policy is a set of internal rules that the system applies to the interactions between audio streams from multiple applications that share and compete for use of the same audio hardware.</span></span> <span data-ttu-id="493f3-156">Le service audio Windows implémente la stratégie audio en définissant les paramètres de contrôle du moteur audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-156">The Windows audio service implements audio policy by setting the control parameters for the audio engine.</span></span> <span data-ttu-id="493f3-157">Les tâches du service audio sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="493f3-157">The duties of the audio service include:</span></span>

-   <span data-ttu-id="493f3-158">Assurer le suivi des périphériques audio que l’utilisateur ajoute ou supprime du système.</span><span class="sxs-lookup"><span data-stu-id="493f3-158">Keeping track of the audio devices that the user adds to or removes from the system.</span></span>
-   <span data-ttu-id="493f3-159">Surveillance des rôles affectés aux périphériques audio dans le système.</span><span class="sxs-lookup"><span data-stu-id="493f3-159">Monitoring the roles that are assigned to the audio devices in the system.</span></span>
-   <span data-ttu-id="493f3-160">Gestion des flux audio à partir de groupes de tâches qui produisent des classes similaires de contenu audio (console, multimédia et communications).</span><span class="sxs-lookup"><span data-stu-id="493f3-160">Managing the audio streams from groups of tasks that produce similar classes of audio content (console, multimedia, and communications).</span></span>
-   <span data-ttu-id="493f3-161">Contrôle du niveau de volume du flux de sortie combiné (« mixage secondaire ») pour chacun des différents types de contenu audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-161">Controlling the volume level of the combined output stream ("submix") for each of the various types of audio content.</span></span>
-   <span data-ttu-id="493f3-162">En informant le moteur audio sur les éléments de traitement dans les chemins de données pour les flux audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-162">Informing the audio engine about the processing elements in the data paths for the audio streams.</span></span>

<span data-ttu-id="493f3-163">Dans certaines versions de Windows, le service audio Windows est désactivé par défaut et doit être explicitement activé pour que le système puisse lire des données audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-163">In some versions of Windows, the Windows audio service is disabled by default and must be explicitly turned on before the system can play audio.</span></span>

<span data-ttu-id="493f3-164">Dans l’exemple illustré dans le diagramme précédent, l’appareil de point de terminaison est un ensemble de haut-parleurs branchés dans la carte audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-164">In the example shown in the preceding diagram, the endpoint device is a set of speakers that are plugged into the audio adapter.</span></span> <span data-ttu-id="493f3-165">L’application cliente écrit des données audio dans la mémoire tampon du point de terminaison, et le moteur audio gère les détails du transport des données de la mémoire tampon vers l’appareil de point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="493f3-165">The client application writes audio data to the endpoint buffer, and the audio engine handles the details of transporting the data from the buffer to the endpoint device.</span></span>

<span data-ttu-id="493f3-166">La zone nommée « pilote audio » dans le diagramme précédent peut être une combinaison de composants de pilote fournis par le système et fournis par le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="493f3-166">The box labeled "Audio Driver" in the preceding diagram might be a combination of system-supplied and vendor-supplied driver components.</span></span> <span data-ttu-id="493f3-167">Dans le cas d’une carte audio sur un bus PCI ou PCI Express, le système fournit le pilote de système de classe de port (Portcls.sys), qui implémente un ensemble de pilotes de port pour les différentes fonctions audio de l’adaptateur, et le fabricant de matériel fournit un pilote de carte qui implémente un ensemble de pilotes miniport pour gérer les opérations spécifiques aux périphériques pour les pilotes de port</span><span class="sxs-lookup"><span data-stu-id="493f3-167">In the case of an audio adapter on a PCI or PCI Express bus, the system supplies the Port Class system driver (Portcls.sys), which implements a set of port drivers for the various audio functions in the adapter, and the hardware vendor supplies an adapter driver that implements a set of miniport drivers to handle device-specific operations for the port drivers.</span></span> <span data-ttu-id="493f3-168">Dans le cas d’un contrôleur audio haute définition et d’un codec sur un bus PCI ou PCI Express, le système fournit le pilote de carte (Hdaudio.sys) et aucun pilote fourni par le fournisseur n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="493f3-168">In the case of a High Definition Audio controller and codec on a PCI or PCI Express bus, the system supplies the adapter driver (Hdaudio.sys), and no vendor-supplied driver is needed.</span></span> <span data-ttu-id="493f3-169">Dans le cas d’une carte audio sur un bus USB, le système fournit le pilote du système de classe AVStream (Ks.sys) et le pilote audio USB (Usbaudio.sys); là encore, aucun pilote fourni par le fournisseur n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="493f3-169">In the case of an audio adapter on a USB bus, the system supplies the AVStream class system driver (Ks.sys) plus the USB Audio driver (Usbaudio.sys); again, no vendor-supplied driver is needed.</span></span>

<span data-ttu-id="493f3-170">Par souci de simplicité, le diagramme ci-dessus affiche uniquement les flux de rendu.</span><span class="sxs-lookup"><span data-stu-id="493f3-170">For simplicity, the preceding diagram shows only rendering streams.</span></span> <span data-ttu-id="493f3-171">Toutefois, les API audio principales prennent également en charge la capture de flux.</span><span class="sxs-lookup"><span data-stu-id="493f3-171">However, the core audio APIs support capture streams as well.</span></span> <span data-ttu-id="493f3-172">En mode partagé, plusieurs clients peuvent partager le flux capturé à partir d’un périphérique matériel audio.</span><span class="sxs-lookup"><span data-stu-id="493f3-172">In shared mode, several clients can share the captured stream from an audio hardware device.</span></span> <span data-ttu-id="493f3-173">En mode exclusif, un client dispose d’un accès exclusif au flux capturé à partir de l’appareil.</span><span class="sxs-lookup"><span data-stu-id="493f3-173">In exclusive mode, one client has exclusive access to the captured stream from the device.</span></span>

## <a name="related-topics"></a><span data-ttu-id="493f3-174">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="493f3-174">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="493f3-175">Guide de programmation</span><span class="sxs-lookup"><span data-stu-id="493f3-175">Programming Guide</span></span>](programming-guide.md)
</dt> </dl>

 

 



