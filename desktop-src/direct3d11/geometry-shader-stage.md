---
title: Étape de nuanceur Geometry
description: L’étape Geometry-Shader (GS) exécute un code de nuanceur spécifié par l’application avec des vertex comme entrée et la possibilité de générer des vertex sur la sortie.
ms.assetid: F3208862-980E-403F-9154-13B34A882787
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3099ed5ede8dd89dc607ed838ff6e3fabfb16a69
ms.sourcegitcommit: ca37395fd832e798375e81142b97cffcffabf184
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/24/2021
ms.locfileid: "110335363"
---
# <a name="geometry-shader-stage"></a><span data-ttu-id="5688d-103">Étape de nuanceur Geometry</span><span class="sxs-lookup"><span data-stu-id="5688d-103">Geometry Shader Stage</span></span>

<span data-ttu-id="5688d-104">L’étape Geometry-Shader (GS) exécute un code de nuanceur spécifié par l’application avec des vertex comme entrée et la possibilité de générer des vertex sur la sortie.</span><span class="sxs-lookup"><span data-stu-id="5688d-104">The geometry-shader (GS) stage runs application-specified shader code with vertices as input and the ability to generate vertices on output.</span></span>

## <a name="the-geometry-shader"></a><span data-ttu-id="5688d-105">Nuanceur Geometry</span><span class="sxs-lookup"><span data-stu-id="5688d-105">The Geometry Shader</span></span>

<span data-ttu-id="5688d-106">Contrairement aux nuanceurs de vertex, qui opèrent sur un seul vertex, les entrées du nuanceur Geometry sont les vertex pour une primitive complète (deux sommets pour les lignes, trois vertex pour les triangles ou un seul vertex pour le point).</span><span class="sxs-lookup"><span data-stu-id="5688d-106">Unlike vertex shaders, which operate on a single vertex, the geometry shader's inputs are the vertices for a full primitive (two vertices for lines, three vertices for triangles, or single vertex for point).</span></span> <span data-ttu-id="5688d-107">Les nuanceurs de géométrie peuvent également intégrer les données de vertex pour les primitives adjacentes à la périphérie comme entrée (deux sommets supplémentaires pour une ligne, trois supplémentaires pour un triangle).</span><span class="sxs-lookup"><span data-stu-id="5688d-107">Geometry shaders can also bring in the vertex data for the edge-adjacent primitives as input (an additional two vertices for a line, an additional three for a triangle).</span></span> <span data-ttu-id="5688d-108">L’illustration suivante montre un triangle et une ligne avec des vertex adjacents.</span><span class="sxs-lookup"><span data-stu-id="5688d-108">The following illustration shows a triangle and a line with adjacent vertices.</span></span>

![illustration d’un triangle et d’une ligne avec des vertex adjacents](images/d3d10-gs.png)

|     | <span data-ttu-id="5688d-110">Type</span><span class="sxs-lookup"><span data-stu-id="5688d-110">Type</span></span>                |
|-----|-----------------|
| <span data-ttu-id="5688d-111">**TV**</span><span class="sxs-lookup"><span data-stu-id="5688d-111">**TV**</span></span>  | <span data-ttu-id="5688d-112">Sommet de triangle</span><span class="sxs-lookup"><span data-stu-id="5688d-112">Triangle vertex</span></span> |
| <span data-ttu-id="5688d-113">**ALTERNATIF**</span><span class="sxs-lookup"><span data-stu-id="5688d-113">**AV**</span></span>  | <span data-ttu-id="5688d-114">Sommet adjacent</span><span class="sxs-lookup"><span data-stu-id="5688d-114">Adjacent vertex</span></span> |
| <span data-ttu-id="5688d-115">**BASSE**</span><span class="sxs-lookup"><span data-stu-id="5688d-115">**LV**</span></span>  | <span data-ttu-id="5688d-116">Sommet de ligne</span><span class="sxs-lookup"><span data-stu-id="5688d-116">Line vertex</span></span>     |



 

<span data-ttu-id="5688d-117">L’étape Geometry-shader peut utiliser la \_ [valeur générée](d3d10-graphics-programming-guide-input-assembler-stage-using.md) par le système SV PrimitiveID qui est générée automatiquement par l’IA.</span><span class="sxs-lookup"><span data-stu-id="5688d-117">The geometry-shader stage can consume the SV\_PrimitiveID [system-generated value](d3d10-graphics-programming-guide-input-assembler-stage-using.md) that is auto-generated by the IA.</span></span> <span data-ttu-id="5688d-118">Cela permet de récupérer ou de calculer des données par primitives si vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="5688d-118">This allows per-primitive data to be fetched or computed if desired.</span></span>

<span data-ttu-id="5688d-119">L’étape Geometry-Shader est en charge de la génération de plusieurs vertex formant une seule topologie sélectionnée (les topologies de sortie de l’étape GS disponibles sont : tristrip, linestrip et PointList).</span><span class="sxs-lookup"><span data-stu-id="5688d-119">The geometry-shader stage is capable of outputting multiple vertices forming a single selected topology (GS stage output topologies available are: tristrip, linestrip, and pointlist).</span></span> <span data-ttu-id="5688d-120">Le nombre de primitives émises peut varier librement au sein de n’importe quel appel du nuanceur Geometry, bien que le nombre maximal de vertex pouvant être émis doive être déclaré statiquement.</span><span class="sxs-lookup"><span data-stu-id="5688d-120">The number of primitives emitted can vary freely within any invocation of the geometry shader, though the maximum number of vertices that could be emitted must be declared statically.</span></span> <span data-ttu-id="5688d-121">Les longueurs de bande émises à partir d’un appel de nuanceur Geometry peuvent être arbitraires et de nouvelles bandes peuvent être créées via la fonction HLSL [RestartStrip](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-so-restartstrip) .</span><span class="sxs-lookup"><span data-stu-id="5688d-121">Strip lengths emitted from a geometry shader invocation can be arbitrary, and new strips can be created via the [RestartStrip](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-so-restartstrip) HLSL function.</span></span>

<span data-ttu-id="5688d-122">La sortie du nuanceur Geometry peut être alimentée à l’étape de rastérisation et/ou à une mémoire tampon de vertex en mémoire via l’étape de sortie de flux.</span><span class="sxs-lookup"><span data-stu-id="5688d-122">Geometry shader output may be fed to the rasterizer stage and/or to a vertex buffer in memory via the stream output stage.</span></span> <span data-ttu-id="5688d-123">La sortie alimentée en mémoire est étendue à des listes point/ligne/triangle individuelles (exactement telles qu’elles sont transmises au rastériseur).</span><span class="sxs-lookup"><span data-stu-id="5688d-123">Output fed to memory is expanded to individual point/line/triangle lists (exactly as they would be passed to the rasterizer).</span></span>

<span data-ttu-id="5688d-124">Lorsqu’un nuanceur Geometry est actif, il est appelé une fois pour chaque primitive passée ou générée précédemment dans le pipeline.</span><span class="sxs-lookup"><span data-stu-id="5688d-124">When a geometry shader is active, it is invoked once for every primitive passed down or generated earlier in the pipeline.</span></span> <span data-ttu-id="5688d-125">Chaque appel du nuanceur Geometry considère comme entrée les données pour l’appel de la primitive, qu’il s’agisse d’un point unique, d’une ligne unique ou d’un triangle unique.</span><span class="sxs-lookup"><span data-stu-id="5688d-125">Each invocation of the geometry shader sees as input the data for the invoking primitive, whether that is a single point, a single line, or a single triangle.</span></span> <span data-ttu-id="5688d-126">Une bande de triangles de plus tôt dans le pipeline se traduirait par un appel du nuanceur Geometry pour chaque triangle de la bande (comme si la bande était développée dans une liste de triangles).</span><span class="sxs-lookup"><span data-stu-id="5688d-126">A triangle strip from earlier in the pipeline would result in an invocation of the geometry shader for each individual triangle in the strip (as if the strip were expanded out into a triangle list).</span></span> <span data-ttu-id="5688d-127">Toutes les données d’entrée pour chaque vertex de la primitive individuelle sont disponibles (par exemple, 3 sommets pour triangle), ainsi que les données adjacentes du vertex, le cas échéant/disponibles.</span><span class="sxs-lookup"><span data-stu-id="5688d-127">All the input data for each vertex in the individual primitive is available (i.e. 3 vertices for triangle), plus adjacent vertex data if applicable/available.</span></span>

<span data-ttu-id="5688d-128">Un nuanceur Geometry génère des données d’un vertex à la fois en ajoutant des sommets à un objet de flux de sortie.</span><span class="sxs-lookup"><span data-stu-id="5688d-128">A geometry shader outputs data one vertex at a time by appending vertices to an output stream object.</span></span> <span data-ttu-id="5688d-129">La topologie des flux est déterminée par une déclaration fixe, en choisissant l’une des suivantes : PointStream, LineStream ou TriangleStream comme sortie de l’étape GS.</span><span class="sxs-lookup"><span data-stu-id="5688d-129">The topology of the streams is determined by a fixed declaration, choosing one of: PointStream, LineStream, or TriangleStream as the output for the GS stage.</span></span> <span data-ttu-id="5688d-130">Il existe trois types d’objets de flux disponibles, PointStream, LineStream et TriangleStream, qui sont tous des objets basés sur un modèle.</span><span class="sxs-lookup"><span data-stu-id="5688d-130">There are three types of stream objects available, PointStream, LineStream and TriangleStream which are all templated objects.</span></span> <span data-ttu-id="5688d-131">La topologie de la sortie est déterminée par le type d’objet respectif, tandis que le format des vertex ajoutés au flux est déterminé par le type de modèle.</span><span class="sxs-lookup"><span data-stu-id="5688d-131">The topology of the output is determined by their respective object type, while the format of the vertices appended to the stream is determined by the template type.</span></span> <span data-ttu-id="5688d-132">L’exécution d’une instance geometry Shader est atomique d’autres appels, à ceci près que les données ajoutées aux flux sont en série.</span><span class="sxs-lookup"><span data-stu-id="5688d-132">Execution of a geometry shader instance is atomic from other invocations, except that data added to the streams is serial.</span></span> <span data-ttu-id="5688d-133">Les sorties d’un appel donné d’un nuanceur Geometry sont indépendantes des autres appels (bien que le classement soit respecté).</span><span class="sxs-lookup"><span data-stu-id="5688d-133">The outputs of a given invocation of a geometry shader are independent of other invocations (though ordering is respected).</span></span> <span data-ttu-id="5688d-134">Un nuanceur de géométrie qui génère des bandes de triangle démarre une nouvelle bande à chaque appel.</span><span class="sxs-lookup"><span data-stu-id="5688d-134">A geometry shader generating triangle strips will start a new strip on every invocation.</span></span>

<span data-ttu-id="5688d-135">Quand une sortie de nuanceur Geometry est identifiée comme une valeur interprétée par le système (par exemple \_ , SV RenderTargetArrayIndex ou SV \_ position), le matériel examine ces données et effectue un comportement dépendant de la valeur, en plus de pouvoir passer les données elles-mêmes à l’étape de nuanceur suivante pour l’entrée.</span><span class="sxs-lookup"><span data-stu-id="5688d-135">When a geometry shader output is identified as a System Interpreted Value (e.g. SV\_RenderTargetArrayIndex or SV\_Position), hardware looks at this data and performs some behavior dependent on the value, in addition to being able to pass the data itself to the next shader stage for input.</span></span> <span data-ttu-id="5688d-136">Lorsque la sortie de ce type de données du nuanceur Geometry a un sens pour le matériel au niveau de la primitive (par exemple, SV \_ RenderTargetArrayIndex ou SV \_ ViewportArrayIndex), \_ \[ \] \_ les données par primitives sont extraites du sommet de début émis pour la primitive, et non de la même façon.</span><span class="sxs-lookup"><span data-stu-id="5688d-136">When such data output from the geometry shader has meaning to the hardware on a per-primitive basis (such as SV\_RenderTargetArrayIndex or SV\_ViewportArrayIndex), rather than on a per-vertex basis (such as SV\_ClipDistance\[n\] or SV\_Position), the per-primitive data is taken from the leading vertex emitted for the primitive.</span></span>

<span data-ttu-id="5688d-137">Les primitives partiellement terminées peuvent être générées par le nuanceur Geometry si le nuanceur Geometry se termine et que la primitive est incomplète.</span><span class="sxs-lookup"><span data-stu-id="5688d-137">Partially completed primitives could be generated by the geometry shader if the geometry shader ends and the primitive is incomplete.</span></span> <span data-ttu-id="5688d-138">Les primitives incomplètes sont ignorées silencieusement.</span><span class="sxs-lookup"><span data-stu-id="5688d-138">Incomplete primitives are silently discarded.</span></span> <span data-ttu-id="5688d-139">Cela est similaire à la façon dont l’IA traite les primitives partiellement terminées.</span><span class="sxs-lookup"><span data-stu-id="5688d-139">This is similar to the way the IA treats partially completed primitives.</span></span>

<span data-ttu-id="5688d-140">Le nuanceur Geometry peut effectuer des opérations d’échantillonnage de charge et de texture où les dérivés de l’espace écran ne sont pas nécessaires (samplelevel, samplecmplevelzero, samplegrad).</span><span class="sxs-lookup"><span data-stu-id="5688d-140">The geometry shader can perform load and texture sampling operations where screen-space derivatives are not required (samplelevel, samplecmplevelzero, samplegrad).</span></span>

<span data-ttu-id="5688d-141">Les algorithmes qui peuvent être implémentés dans le nuanceur Geometry sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="5688d-141">Algorithms that can be implemented in the geometry shader include:</span></span>

-   <span data-ttu-id="5688d-142">Expansion point Sprite</span><span class="sxs-lookup"><span data-stu-id="5688d-142">Point Sprite Expansion</span></span>
-   <span data-ttu-id="5688d-143">Systèmes de particule dynamiques</span><span class="sxs-lookup"><span data-stu-id="5688d-143">Dynamic Particle Systems</span></span>
-   <span data-ttu-id="5688d-144">Génération de fourrure/fin</span><span class="sxs-lookup"><span data-stu-id="5688d-144">Fur/Fin Generation</span></span>
-   <span data-ttu-id="5688d-145">Génération du volume de cliché instantané</span><span class="sxs-lookup"><span data-stu-id="5688d-145">Shadow Volume Generation</span></span>
-   <span data-ttu-id="5688d-146">Rendu à passage unique-à-carte cubique</span><span class="sxs-lookup"><span data-stu-id="5688d-146">Single Pass Render-to-Cubemap</span></span>
-   <span data-ttu-id="5688d-147">Échange de matériel Per-Primitive</span><span class="sxs-lookup"><span data-stu-id="5688d-147">Per-Primitive Material Swapping</span></span>
-   <span data-ttu-id="5688d-148">Per-Primitive la configuration des matériaux, y compris la génération de coordonnées Barycentric en tant que données primitives afin qu’un nuanceur de pixels puisse effectuer une interpolation d’attributs personnalisés (pour obtenir un exemple d’interpolation normale d’ordre supérieur, consultez l' [exemple CubeMapGS](https://msdn.microsoft.com/library/Ee416398(v=VS.85).aspx)).</span><span class="sxs-lookup"><span data-stu-id="5688d-148">Per-Primitive Material Setup - Including generation of barycentric coordinates as primitive data so that a pixel shader can perform custom attribute interpolation (for an example of higher-order normal interpolation, see [CubeMapGS Sample](https://msdn.microsoft.com/library/Ee416398(v=VS.85).aspx)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="5688d-149">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="5688d-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5688d-150">Pipeline graphique</span><span class="sxs-lookup"><span data-stu-id="5688d-150">Graphics Pipeline</span></span>](overviews-direct3d-11-graphics-pipeline.md)
</dt> <dt>

[<span data-ttu-id="5688d-151">Étapes de pipeline (Direct3D 10)</span><span class="sxs-lookup"><span data-stu-id="5688d-151">Pipeline Stages (Direct3D 10)</span></span>](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-pipeline-stages)
</dt> </dl>

 

 