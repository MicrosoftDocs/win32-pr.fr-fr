---
title: Cache de fragments
description: L’API du serveur HTTP fournit des fonctionnalités permettant aux utilisateurs de stocker des fragments de données dans un cache pour les utiliser dans la formation rapide des réponses HTTP.
ms.assetid: 0f9a768e-723c-4c7b-a746-6b817441409c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a3979fb03c4f8898644329fd27eafb7007adbcc9
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103939752"
---
# <a name="fragment-cache"></a><span data-ttu-id="8342b-103">Cache de fragments</span><span class="sxs-lookup"><span data-stu-id="8342b-103">Fragment Cache</span></span>

<span data-ttu-id="8342b-104">L’API du serveur HTTP fournit des fonctionnalités permettant aux utilisateurs de stocker des fragments de données dans un cache pour les utiliser dans la formation rapide des réponses HTTP.</span><span class="sxs-lookup"><span data-stu-id="8342b-104">The HTTP Server API provides functionality for users to store data fragments in a cache for use in rapidly forming HTTP responses.</span></span>

<span data-ttu-id="8342b-105">Les fragments peuvent être ajoutés au cache en appelant la fonction [**HttpAddFragmentToCache**](/windows/desktop/api/Http/nf-http-httpaddfragmenttocache) .</span><span class="sxs-lookup"><span data-stu-id="8342b-105">Fragments can be added to the cache by calling the [**HttpAddFragmentToCache**](/windows/desktop/api/Http/nf-http-httpaddfragmenttocache) function.</span></span> <span data-ttu-id="8342b-106">Un fragment est identifié par une URL contenue dans le paramètre *pUrlPrefix* .</span><span class="sxs-lookup"><span data-stu-id="8342b-106">A Fragment is identified by a URL contained in the *pUrlPrefix* parameter.</span></span> <span data-ttu-id="8342b-107">Un appel à cette fonction avec l’URL d’un fragment existant remplace le fragment existant.</span><span class="sxs-lookup"><span data-stu-id="8342b-107">A call to this function with the URL of an existing fragment overwrites the existing fragment.</span></span>

<span data-ttu-id="8342b-108">Un fragment peut être supprimé ou remplacé par le propriétaire de la file d’attente de demandes qui a ajouté le fragment pour la première fois.</span><span class="sxs-lookup"><span data-stu-id="8342b-108">A fragment can be deleted or overwritten by the owner of the request queue that initially added the fragment.</span></span> <span data-ttu-id="8342b-109">La fonction [**HttpFlushResponseCache**](/windows/desktop/api/Http/nf-http-httpflushresponsecache) appelée avec un URLPrefix supprime tous les fragments de ce préfixe, ainsi que les descendants hiérarchiques de ce URLPrefix.</span><span class="sxs-lookup"><span data-stu-id="8342b-109">The [**HttpFlushResponseCache**](/windows/desktop/api/Http/nf-http-httpflushresponsecache) function called with a UrlPrefix deletes all fragments within that prefix as well as the hierarchical descendants of that UrlPrefix.</span></span> <span data-ttu-id="8342b-110">La fonction [**HttpReadFragmentFromCache**](/windows/desktop/api/Http/nf-http-httpreadfragmentfromcache) lit le fragment entier ou une plage d’octets spécifiée dans le fragment.</span><span class="sxs-lookup"><span data-stu-id="8342b-110">The [**HttpReadFragmentFromCache**](/windows/desktop/api/Http/nf-http-httpreadfragmentfromcache) function reads in the entire fragment or a specified byte range within the fragment.</span></span>

> [!Note]  
> <span data-ttu-id="8342b-111">L’ajout d’un fragment au cache ne garantit pas qu’il est disponible pour les appels ultérieurs pour envoyer une réponse.</span><span class="sxs-lookup"><span data-stu-id="8342b-111">Adding a fragment to the cache does not guarantee that it is available for future calls to send a response.</span></span> <span data-ttu-id="8342b-112">Les entrées du cache de fragments peuvent devenir indisponibles à tout moment.</span><span class="sxs-lookup"><span data-stu-id="8342b-112">Fragment cache entries can become unavailable at any time.</span></span> <span data-ttu-id="8342b-113">Un appel qui utilise un fragment qui n’est pas disponible échoue.</span><span class="sxs-lookup"><span data-stu-id="8342b-113">A call that uses a fragment that is not available fails.</span></span> <span data-ttu-id="8342b-114">Les applications qui utilisent le cache de fragments doivent être préparées pour gérer cet échec.</span><span class="sxs-lookup"><span data-stu-id="8342b-114">Applications that use the fragment cache must be prepared to handle this failure.</span></span>

 

## <a name="sending-a-response-with-a-fragment"></a><span data-ttu-id="8342b-115">Envoi d’une réponse avec un fragment</span><span class="sxs-lookup"><span data-stu-id="8342b-115">Sending a Response With a Fragment</span></span>

<span data-ttu-id="8342b-116">Les fragments peuvent être utilisés pour former la totalité ou une partie d’un corps d’entité de réponse HTTP.</span><span class="sxs-lookup"><span data-stu-id="8342b-116">Fragments can be used to form all or portions of an HTTP responses entity body.</span></span> <span data-ttu-id="8342b-117">Vous pouvez envoyer une réponse et un corps d’entité dans un appel à la fonction [**HttpSendHttpResponse**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) en spécifiant un tableau de structures de [**\_ \_ blocs de données http**](/windows/desktop/api/Http/ns-http-http_data_chunk) dans la structure de [**\_ réponse http**](http-response.md) .</span><span class="sxs-lookup"><span data-stu-id="8342b-117">You can send a response and entity body in one call to the [**HttpSendHttpResponse**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) function by specifying an array of [**HTTP\_DATA\_CHUNK**](/windows/desktop/api/Http/ns-http-http_data_chunk) structures in the [**HTTP\_RESPONSE**](http-response.md) structure.</span></span>

<span data-ttu-id="8342b-118">Un [**\_ \_ segment de données http**](/windows/desktop/api/Http/ns-http-http_data_chunk) peut spécifier un bloc de mémoire, un descripteur d’un fichier déjà ouvert ou une entrée de cache de fragments.</span><span class="sxs-lookup"><span data-stu-id="8342b-118">An [**HTTP\_DATA\_CHUNK**](/windows/desktop/api/Http/ns-http-http_data_chunk) can specify a block of memory, a handle to an already opened file or a fragment cache entry.</span></span> <span data-ttu-id="8342b-119">Celles-ci correspondent aux types de **\_ \_ blocs de données http** : **HttpDataChunkFromMemory**, **HttpDataChunkFromFileHandle** et **HttpDataChunkFromFragmentCache**, respectivement.</span><span class="sxs-lookup"><span data-stu-id="8342b-119">These correspond to the **HTTP\_DATA\_CHUNK** types: **HttpDataChunkFromMemory**, **HttpDataChunkFromFileHandle**, and **HttpDataChunkFromFragmentCache**, respectively.</span></span> <span data-ttu-id="8342b-120">Les réponses complètes dans le cache HTTP peuvent également être utilisées comme fragments dans la structure de [**\_ réponse http**](http-response.md) , bien que cette pratique ne soit pas recommandée.</span><span class="sxs-lookup"><span data-stu-id="8342b-120">Full responses in the HTTP cache can also be used as fragments in the [**HTTP\_RESPONSE**](http-response.md) structure, although this practice is not recommended.</span></span>

<span data-ttu-id="8342b-121">La structure de [**\_ réponse http**](http-response.md) contient un pointeur vers un tableau de structures de [**\_ \_ blocs de données http**](/windows/desktop/api/Http/ns-http-http_data_chunk) qui constituent le corps d’entité de la réponse.</span><span class="sxs-lookup"><span data-stu-id="8342b-121">The [**HTTP\_RESPONSE**](http-response.md) structure contains a pointer to an array of [**HTTP\_DATA\_CHUNK**](/windows/desktop/api/Http/ns-http-http_data_chunk) structures that comprise the entity body of the response.</span></span> <span data-ttu-id="8342b-122">La structure de **\_ réponse http** contient également un nombre correspondant qui spécifie la dimension du tableau de structures de **\_ \_ blocs de données http** .</span><span class="sxs-lookup"><span data-stu-id="8342b-122">The **HTTP\_RESPONSE** structure also contains a matching count which specifies the dimension of the array of **HTTP\_DATA\_CHUNK** structures.</span></span> <span data-ttu-id="8342b-123">La valeur HttpDataChunkFromFragmentCache dans la structure de **\_ \_ segment de données http** spécifie le type de cache de fragment du segment de données.</span><span class="sxs-lookup"><span data-stu-id="8342b-123">The HttpDataChunkFromFragmentCache value in the **HTTP\_DATA\_CHUNK** structure specifies the fragment cache type of the data chunk.</span></span> <span data-ttu-id="8342b-124">La structure de **\_ \_ segment de données http** spécifie également le nom du fragment.</span><span class="sxs-lookup"><span data-stu-id="8342b-124">The **HTTP\_DATA\_CHUNK** structure also specifies the fragment name.</span></span>

<span data-ttu-id="8342b-125">Une réponse qui contient un fragment mis en cache échoue avec un \_ chemin d’erreur \_ \_ introuvable si l’une des entrées du cache de fragments n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="8342b-125">A response that contains a cached fragment fails with an ERROR\_PATH\_NOT\_FOUND if any of the fragment cache entries are not available.</span></span> <span data-ttu-id="8342b-126">Étant donné que les entrées du cache de fragments ne sont pas nécessairement disponibles, les applications doivent être préparées pour gérer ce cas.</span><span class="sxs-lookup"><span data-stu-id="8342b-126">Since the fragment cache entries are not guaranteed to be available, applications must be prepared to handle this case.</span></span> <span data-ttu-id="8342b-127">Pour gérer ce cas, vous pouvez essayer d’ajouter à nouveau l’entrée du cache de fragment et de renvoyer la réponse.</span><span class="sxs-lookup"><span data-stu-id="8342b-127">One way to handle this case is to attempt to re-add the fragment cache entry and resend the response.</span></span> <span data-ttu-id="8342b-128">En cas de défaillances répétées, l’application peut utiliser des blocs de données stockés dans des mémoires tampons au lieu d’entrées de fragment du cache.</span><span class="sxs-lookup"><span data-stu-id="8342b-128">If repeated failures occur, the application can use data chunks stored in memory buffers instead of fragment cache entries.</span></span>

<span data-ttu-id="8342b-129">Les entrées du cache de fragments peuvent également être spécifiées dans la fonction [**HttpSendResponseEntityBody**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) .</span><span class="sxs-lookup"><span data-stu-id="8342b-129">Fragment cache entries can also be specified in the [**HttpSendResponseEntityBody**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) function.</span></span> <span data-ttu-id="8342b-130">Le fragment est ajouté au corps d’entité dans la structure de [**\_ \_ segment de données http**](/windows/desktop/api/Http/ns-http-http_data_chunk) comme décrit ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="8342b-130">The fragment is added to the entity body in the [**HTTP\_DATA\_CHUNK**](/windows/desktop/api/Http/ns-http-http_data_chunk) structure as described above.</span></span> <span data-ttu-id="8342b-131">Là encore, l’envoi peut échouer si l’une des entrées du cache de fragments spécifiée n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="8342b-131">Again, the send can fail if any of the specified fragment cache entries are not available.</span></span>

 

 




