---
title: Routines de saisie semi-automatique HTTP
description: Les applications disposent de plusieurs options pour recevoir des indications d’achèvement et offrir une certaine flexibilité aux développeurs.
ms.assetid: c48a64d2-b6c8-4694-8600-f84751954bad
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8aee05efc8284cb29130efae4bcaefb4834a3fb4
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "103940975"
---
# <a name="http-completion-routines"></a><span data-ttu-id="2ae12-103">Routines de saisie semi-automatique HTTP</span><span class="sxs-lookup"><span data-stu-id="2ae12-103">HTTP Completion Routines</span></span>

<span data-ttu-id="2ae12-104">Les applications disposent de plusieurs options pour recevoir des indications d’achèvement et offrir une certaine flexibilité aux développeurs.</span><span class="sxs-lookup"><span data-stu-id="2ae12-104">Applications have several options for receiving completion indications and providing some flexibility for developers.</span></span> <span data-ttu-id="2ae12-105">Les options doivent être bloquées en attendant la fin d’un appel d’API ou l’utilisation de routines de saisie semi-automatique pour les opérations asynchrones.</span><span class="sxs-lookup"><span data-stu-id="2ae12-105">The options are to block while waiting for an API call to complete or to use completion routines for asynchronous operations.</span></span> <span data-ttu-id="2ae12-106">L’avantage de l’utilisation des opérations asynchrones est l’augmentation de la réactivité de l’application.</span><span class="sxs-lookup"><span data-stu-id="2ae12-106">The advantage of using asynchronous operations is an increase in responsiveness of the application.</span></span>

## <a name="blocked-io"></a><span data-ttu-id="2ae12-107">E/s bloquées</span><span class="sxs-lookup"><span data-stu-id="2ae12-107">Blocked I/O</span></span>

<span data-ttu-id="2ae12-108">Les applications peuvent se bloquer en attendant la fin de l’appel d’API en affectant à la structure [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) la **valeur null**.</span><span class="sxs-lookup"><span data-stu-id="2ae12-108">Applications can block while waiting for the API call to complete by setting the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure to **NULL**.</span></span> <span data-ttu-id="2ae12-109">Cela bloque véritablement toutes les opérations sur le thread.</span><span class="sxs-lookup"><span data-stu-id="2ae12-109">This truly blocks all operations on the thread.</span></span> <span data-ttu-id="2ae12-110">Par exemple, dans les appels à [**HttpWaitForDisconnect**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect), l’appel est bloqué jusqu’à ce que la connexion soit interrompue.</span><span class="sxs-lookup"><span data-stu-id="2ae12-110">For example, in calls to [**HttpWaitForDisconnect**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect), the call blocks until the connection is broken.</span></span>

## <a name="asynchronous-io"></a><span data-ttu-id="2ae12-111">E/s asynchrones</span><span class="sxs-lookup"><span data-stu-id="2ae12-111">Asynchronous I/O</span></span>

<span data-ttu-id="2ae12-112">Les applications qui préfèrent ne pas bloquer peuvent utiliser la structure [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) pour obtenir les résultats de la saisie semi-automatique.</span><span class="sxs-lookup"><span data-stu-id="2ae12-112">Applications that prefer not to block can use the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure to obtain the completion results.</span></span> <span data-ttu-id="2ae12-113">L’application fournit un pointeur vers une structure **OVERLAPPED** , qui est utilisée avec un objet d’événement ou un port de terminaison.</span><span class="sxs-lookup"><span data-stu-id="2ae12-113">The application supplies a pointer to an **OVERLAPPED** structure, which is used with an event object or a completion port.</span></span> <span data-ttu-id="2ae12-114">Avec un port de terminaison d’e/s, un descripteur HTTP est utilisé comme handle de fichier dans une opération d’e/s de fichier asynchrone.</span><span class="sxs-lookup"><span data-stu-id="2ae12-114">With an I/O completion port, an HTTP handle is used as a file handle would be in an asynchronous file I/O operation.</span></span> <span data-ttu-id="2ae12-115">Le tableau suivant récapitule les options de saisie semi-automatique disponibles pour les applications.</span><span class="sxs-lookup"><span data-stu-id="2ae12-115">The following table summarizes the completion options available to the applications.</span></span>



| <span data-ttu-id="2ae12-116">Structure OVERLAPPED</span><span class="sxs-lookup"><span data-stu-id="2ae12-116">Overlapped structure</span></span> | <span data-ttu-id="2ae12-117">Objet d’événement</span><span class="sxs-lookup"><span data-stu-id="2ae12-117">Event object</span></span>   | <span data-ttu-id="2ae12-118">Port de terminaison</span><span class="sxs-lookup"><span data-stu-id="2ae12-118">Completion port</span></span> | <span data-ttu-id="2ae12-119">Completion</span><span class="sxs-lookup"><span data-stu-id="2ae12-119">Completion</span></span>                                                                                                   |
|----------------------|----------------|-----------------|--------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="2ae12-120">**NULL**</span><span class="sxs-lookup"><span data-stu-id="2ae12-120">**NULL**</span></span>             | <span data-ttu-id="2ae12-121">Non applicable</span><span class="sxs-lookup"><span data-stu-id="2ae12-121">Not Applicable</span></span> | <span data-ttu-id="2ae12-122">Ignoré</span><span class="sxs-lookup"><span data-stu-id="2ae12-122">Ignored</span></span>         | <span data-ttu-id="2ae12-123">L’opération se termine de façon synchrone.</span><span class="sxs-lookup"><span data-stu-id="2ae12-123">Operation completes synchronously.</span></span>                                                                           |
| <span data-ttu-id="2ae12-124">Non **null**</span><span class="sxs-lookup"><span data-stu-id="2ae12-124">Non-**NULL**</span></span>         | <span data-ttu-id="2ae12-125">Non **null**</span><span class="sxs-lookup"><span data-stu-id="2ae12-125">Non-**NULL**</span></span>   | <span data-ttu-id="2ae12-126">**NULL**</span><span class="sxs-lookup"><span data-stu-id="2ae12-126">**NULL**</span></span>        | <span data-ttu-id="2ae12-127">L’opération se termine de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="2ae12-127">Operation completes asynchronously.</span></span> <span data-ttu-id="2ae12-128">Une notification Overlapped est effectuée en signalant un objet d’événement.</span><span class="sxs-lookup"><span data-stu-id="2ae12-128">Overlapped notification is performed by signaling an event object.</span></span>       |
| <span data-ttu-id="2ae12-129">Non **null**</span><span class="sxs-lookup"><span data-stu-id="2ae12-129">Non-**NULL**</span></span>         | <span data-ttu-id="2ae12-130">Ignoré</span><span class="sxs-lookup"><span data-stu-id="2ae12-130">Ignored</span></span>        | <span data-ttu-id="2ae12-131">Non **null**</span><span class="sxs-lookup"><span data-stu-id="2ae12-131">Non-**NULL**</span></span>    | <span data-ttu-id="2ae12-132">L’opération se termine de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="2ae12-132">Operation completes asynchronously.</span></span> <span data-ttu-id="2ae12-133">Une notification Overlapped est effectuée en planifiant une routine de saisie semi-automatique.</span><span class="sxs-lookup"><span data-stu-id="2ae12-133">Overlapped notification is performed by scheduling a completion routine.</span></span> |



 

## <a name="returning-the-number-of-bytes-read"></a><span data-ttu-id="2ae12-134">Retour du nombre d’octets lus</span><span class="sxs-lookup"><span data-stu-id="2ae12-134">Returning the Number of Bytes Read</span></span>

<span data-ttu-id="2ae12-135">Certaines des fonctions qui utilisent la structure [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) pour la saisie semi-automatique asynchrone retournent un paramètre *PBytesReceived* (ou *pBytesSent* ou *pBytesRead*) qui indique le nombre d’octets transférés de façon synchrone.</span><span class="sxs-lookup"><span data-stu-id="2ae12-135">Some of the functions that use the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure for asynchronous completion return a *pBytesReceived* (or *pBytesSent* or *pBytesRead*) parameter that indicates the number of bytes transferred synchronously.</span></span> <span data-ttu-id="2ae12-136">Pour les appels asynchrones, ce paramètre doit avoir la valeur **null**.</span><span class="sxs-lookup"><span data-stu-id="2ae12-136">For asynchronous calls, this parameter should be set to **NULL**.</span></span> <span data-ttu-id="2ae12-137">Pour les appels synchrones, le paramètre *pBytesReceived* est facultatif et peut avoir la **valeur null** ou non **null**.</span><span class="sxs-lookup"><span data-stu-id="2ae12-137">For synchronous calls, the *pBytesReceived* parameter is optional and can be either **NULL** or non-**NULL**.</span></span>

<span data-ttu-id="2ae12-138">Si l’objet d’événement est utilisé pour la saisie semi-automatique asynchrone, la fonction [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) est appelée pour déterminer le nombre d’octets lus.</span><span class="sxs-lookup"><span data-stu-id="2ae12-138">If the event object is used for asynchronous completion, the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function is called to determine the number of bytes read.</span></span> <span data-ttu-id="2ae12-139">Si le port de terminaison est utilisé (le paramètre *hFile* est associé à un port de terminaison d’e/s), l’application appelle la fonction [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) pour déterminer le nombre d’octets lus.</span><span class="sxs-lookup"><span data-stu-id="2ae12-139">If the completion port is used (the *hFile* parameter is associated with an I/O completion port), the application calls the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function to determine the number of bytes read.</span></span> <span data-ttu-id="2ae12-140">Si les opérations asynchrones ne sont pas terminées, les applications peuvent appeler la fonction [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) pour obtenir des informations d’erreur étendues.</span><span class="sxs-lookup"><span data-stu-id="2ae12-140">If the asynchronous operations have not completed, applications can call the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function to obtain extended error information.</span></span>

<span data-ttu-id="2ae12-141">Le tableau suivant résume le comportement de la saisie semi-automatique synchrone et asynchrone dans des fonctions telles que [**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) qui utilisent le paramètre *pBytesReceived* .</span><span class="sxs-lookup"><span data-stu-id="2ae12-141">The following table summarizes the completion behavior for synchronous and asynchronous completion in functions such as [**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) that use the *pBytesReceived* parameter.</span></span>



| <span data-ttu-id="2ae12-142">pBytesReceived\*</span><span class="sxs-lookup"><span data-stu-id="2ae12-142">pBytesReceived\*</span></span> | <span data-ttu-id="2ae12-143">pOverlapped</span><span class="sxs-lookup"><span data-stu-id="2ae12-143">pOverlapped</span></span>  | <span data-ttu-id="2ae12-144">Description</span><span class="sxs-lookup"><span data-stu-id="2ae12-144">Description</span></span>                                                                             |
|------------------|--------------|-----------------------------------------------------------------------------------------|
| <span data-ttu-id="2ae12-145">**NULL**</span><span class="sxs-lookup"><span data-stu-id="2ae12-145">**NULL**</span></span>         | <span data-ttu-id="2ae12-146">**NULL**</span><span class="sxs-lookup"><span data-stu-id="2ae12-146">**NULL**</span></span>     | <span data-ttu-id="2ae12-147">L’application ne reçoit pas d’informations sur le nombre d’octets retournés.</span><span class="sxs-lookup"><span data-stu-id="2ae12-147">The application does not receive information on the number of bytes returned.</span></span>           |
| <span data-ttu-id="2ae12-148">**NULL**</span><span class="sxs-lookup"><span data-stu-id="2ae12-148">**NULL**</span></span>         | <span data-ttu-id="2ae12-149">Non **null**</span><span class="sxs-lookup"><span data-stu-id="2ae12-149">Non-**NULL**</span></span> | <span data-ttu-id="2ae12-150">Opération asynchrone, *pBytesReceived* est inutile.</span><span class="sxs-lookup"><span data-stu-id="2ae12-150">Asynchronous operation, *pBytesReceived* is meaningless.</span></span>                                |
| <span data-ttu-id="2ae12-151">Non **null**</span><span class="sxs-lookup"><span data-stu-id="2ae12-151">Non-**NULL**</span></span>     | <span data-ttu-id="2ae12-152">**NULL**</span><span class="sxs-lookup"><span data-stu-id="2ae12-152">**NULL**</span></span>     | <span data-ttu-id="2ae12-153">Opération synchrone, nombre d’octets retournés dans *pBytesReceived*.</span><span class="sxs-lookup"><span data-stu-id="2ae12-153">Synchronous operation, number of bytes returned in *pBytesReceived*.</span></span>                    |
| <span data-ttu-id="2ae12-154">Non **null**</span><span class="sxs-lookup"><span data-stu-id="2ae12-154">Non-**NULL**</span></span>     | <span data-ttu-id="2ae12-155">Non **null**</span><span class="sxs-lookup"><span data-stu-id="2ae12-155">Non-**NULL**</span></span> | <span data-ttu-id="2ae12-156">Opération asynchrone, *pBytesReceived* est ignoré, même s’il n’est pas **null**.\*\*</span><span class="sxs-lookup"><span data-stu-id="2ae12-156">Asynchronous operation, *pBytesReceived* is ignored even though it is not **NULL**.\*\*</span></span> |



 

> [!Note]  
> <span data-ttu-id="2ae12-157">\*Ce paramètre peut également être *pBytesSent* ou *pBytesRead*.</span><span class="sxs-lookup"><span data-stu-id="2ae12-157">\*This parameter can also be *pBytesSent* or *pBytesRead*.</span></span>

 

> [!Note]  
> <span data-ttu-id="2ae12-158">\*\*Il est recommandé que les applications passent une **valeur null** dans *pBytesReceived* pour les opérations asynchrones et obtiennent le nombre d’octets reçus à partir de [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) ou [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus).</span><span class="sxs-lookup"><span data-stu-id="2ae12-158">\*\*It is recommended that applications pass a **NULL** in *pBytesReceived* for asynchronous operations and obtain the number of bytes received from either [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus).</span></span>

 

## <a name="return-codes"></a><span data-ttu-id="2ae12-159">Codes de retour</span><span class="sxs-lookup"><span data-stu-id="2ae12-159">Return Codes</span></span>

<span data-ttu-id="2ae12-160">L’API du serveur HTTP retourne trois classes de codes pour les appels de fonction asynchrones.</span><span class="sxs-lookup"><span data-stu-id="2ae12-160">The HTTP Server API returns three classes of codes for asynchronous function calls.</span></span>

-   <span data-ttu-id="2ae12-161">AUCUNE \_ erreur</span><span class="sxs-lookup"><span data-stu-id="2ae12-161">NO\_ERROR</span></span>
-   <span data-ttu-id="2ae12-162">ERREUR d' \_ e/s \_ en attente</span><span class="sxs-lookup"><span data-stu-id="2ae12-162">ERROR\_IO\_PENDING</span></span>
-   <span data-ttu-id="2ae12-163">Tout autre [code d’erreur système](/windows/desktop/Debug/system-error-codes).</span><span class="sxs-lookup"><span data-stu-id="2ae12-163">Any other [system error code](/windows/desktop/Debug/system-error-codes).</span></span>

<span data-ttu-id="2ae12-164">Quand les \_ e/s \_ d’erreur en attente ou aucune \_ erreur sont retournées par l’appel de fonction asynchrone, les utilisateurs doivent s’attendre à ce que l’événement ou la routine de saisie semi-automatique soit signalé.</span><span class="sxs-lookup"><span data-stu-id="2ae12-164">When ERROR\_IO\_PENDING or NO\_ERROR are returned from the asynchronous function call, users should expect the event or completion routine to be signaled.</span></span> <span data-ttu-id="2ae12-165">L’appel de la fonction [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) pour l’événement ou la fonction [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) pour le port de terminaison retourne l’état d’achèvement.</span><span class="sxs-lookup"><span data-stu-id="2ae12-165">Calling the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function for the event or the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function for the completion port returns the completion status.</span></span> <span data-ttu-id="2ae12-166">En outre, si aucune \_ erreur n’est retournée, les applications peuvent effectuer un traitement postérieur sur le thread qui a effectué l’appel d’API.</span><span class="sxs-lookup"><span data-stu-id="2ae12-166">In addition, if NO\_ERROR is returned, applications can perform post-processing on the same thread that made the API call.</span></span>

<span data-ttu-id="2ae12-167">Si l’API du serveur HTTP retourne autre chose que l’erreur \_ e/s \_ en attente ou aucune \_ erreur, à partir de l’appel de fonction asynchrone, la routine d’achèvement n’est pas signalée et l’erreur est retournée directement par l’API.</span><span class="sxs-lookup"><span data-stu-id="2ae12-167">If the HTTP Server API returns anything other than ERROR\_IO\_PENDING or NO\_ERROR, from the asynchronous function call, the completion routine is not signaled, and the error is directly returned by the API.</span></span>

 

 