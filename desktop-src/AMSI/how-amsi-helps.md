---
title: Comment AMSI vous protège contre les programmes malveillants
description: En tant que développeur d’applications, vous pouvez participer activement à la défense contre les programmes malveillants. Plus précisément, vous pouvez protéger vos clients contre les programmes malveillants basés sur des scripts dynamiques et à partir de voies non traditionnelles de cyberattaque.
ms.topic: article
ms.date: 02/27/2019
ms.openlocfilehash: 0d6aee30034312073123f5ab14b1924fd01e6eac
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103671633"
---
# <a name="how-the-antimalware-scan-interface-amsi-helps-you-defend-against-malware"></a><span data-ttu-id="f5987-104">Comment l’interface d’analyse anti-programme malveillant (AMSI) vous permet de vous défendre contre les programmes malveillants</span><span class="sxs-lookup"><span data-stu-id="f5987-104">How the Antimalware Scan Interface (AMSI) helps you defend against malware</span></span>

<span data-ttu-id="f5987-105">Pour une introduction à l’interface de l’analyse anti-programme malveillant de Windows (AMSI), consultez [interface d’analyse anti-programme malveillant (AMSI)](antimalware-scan-interface-portal.md).</span><span class="sxs-lookup"><span data-stu-id="f5987-105">For an introduction to the Windows Antimalware Scan Interface (AMSI), see [Antimalware Scan Interface (AMSI)](antimalware-scan-interface-portal.md).</span></span>

<span data-ttu-id="f5987-106">En tant que développeur d’applications, vous pouvez participer activement à la défense contre les programmes malveillants.</span><span class="sxs-lookup"><span data-stu-id="f5987-106">As an application developer, you can actively participate in malware defense.</span></span> <span data-ttu-id="f5987-107">Plus précisément, vous pouvez protéger vos clients contre les programmes malveillants basés sur des scripts dynamiques et à partir de voies non traditionnelles de cyberattaque.</span><span class="sxs-lookup"><span data-stu-id="f5987-107">Specifically, you can help protect your customers from dynamic script-based malware, and from non-traditional avenues of cyberattack.</span></span>

<span data-ttu-id="f5987-108">Par exemple, supposons que votre application soit scriptable : elle accepte le script arbitraire et l’exécute via un moteur de script.</span><span class="sxs-lookup"><span data-stu-id="f5987-108">By way of an example, let's say that your application is scriptable: it accepts arbitrary script, and executes it via a scripting engine.</span></span> <span data-ttu-id="f5987-109">À l’endroit où un script est prêt à être fourni au moteur de script, votre application peut appeler les API AMSI Windows pour demander une analyse du contenu.</span><span class="sxs-lookup"><span data-stu-id="f5987-109">At the point when a script is ready to be supplied to the scripting engine, your application can call the Windows AMSI APIs to request a scan of the content.</span></span> <span data-ttu-id="f5987-110">De cette façon, vous pouvez déterminer en toute sécurité si le script est malveillant avant de décider de l’exécuter.</span><span class="sxs-lookup"><span data-stu-id="f5987-110">That way, you can safely determine whether or not the script is malicious before you decide to go ahead and execute it.</span></span>

<span data-ttu-id="f5987-111">Cela est vrai même si le script a été généré au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="f5987-111">This is true even if the script was generated at runtime.</span></span> <span data-ttu-id="f5987-112">Le script (malveillant ou autre) peut passer par plusieurs passages de débrouillage.</span><span class="sxs-lookup"><span data-stu-id="f5987-112">Script (malicious or otherwise), might go through several passes of de-obfuscation.</span></span> <span data-ttu-id="f5987-113">Mais vous devez finalement fournir le moteur de script avec du code brut et non masqué.</span><span class="sxs-lookup"><span data-stu-id="f5987-113">But you ultimately need to supply the scripting engine with plain, un-obfuscated code.</span></span> <span data-ttu-id="f5987-114">C’est là que vous appelez les API AMSI.</span><span class="sxs-lookup"><span data-stu-id="f5987-114">And that's the point at which you invoke the AMSI APIs.</span></span>

<span data-ttu-id="f5987-115">Voici une illustration de l’architecture AMSI, où votre propre application est représentée par l’une des zones « autres applications ».</span><span class="sxs-lookup"><span data-stu-id="f5987-115">Here's an illustration of the AMSI architecture, where your own application is represented by one of the "Other Application" boxes.</span></span>

![architecture AMSI](images/AMSI7Archi.jpg)

<span data-ttu-id="f5987-117">L’interface Windows AMSI est ouverte.</span><span class="sxs-lookup"><span data-stu-id="f5987-117">The Windows AMSI interface is open.</span></span> <span data-ttu-id="f5987-118">Ce qui signifie que toute application peut l’appeler ; et tout moteur anti-programme malveillant inscrit peut traiter le contenu qui lui est soumis.</span><span class="sxs-lookup"><span data-stu-id="f5987-118">Which means that any application can call it; and any registered Antimalware engine can process the content submitted to it.</span></span>

<span data-ttu-id="f5987-119">Nous n’avons pas besoin de limiter la discussion aux moteurs de script.</span><span class="sxs-lookup"><span data-stu-id="f5987-119">We needn't limit the discussion to scripting engines, either.</span></span> <span data-ttu-id="f5987-120">Par exemple, votre application est une application de communication et elle analyse les messages instantanés à la recherche de virus avant de les afficher à vos clients.</span><span class="sxs-lookup"><span data-stu-id="f5987-120">Perhaps your application is a communication app, and it scans instant messages for viruses before it shows them to your customers.</span></span> <span data-ttu-id="f5987-121">Ou peut-être votre logiciel est un jeu qui valide les plug-ins avant de les installer.</span><span class="sxs-lookup"><span data-stu-id="f5987-121">Or maybe your software is a game that validates plugins before installing them.</span></span> <span data-ttu-id="f5987-122">Il existe de nombreuses opportunités et scénarios pour l’utilisation de AMSI.</span><span class="sxs-lookup"><span data-stu-id="f5987-122">There are plenty of opportunities and scenarios for using AMSI.</span></span>

## <a name="amsi-in-action"></a><span data-ttu-id="f5987-123">AMSI en action</span><span class="sxs-lookup"><span data-stu-id="f5987-123">AMSI in action</span></span>

<span data-ttu-id="f5987-124">Jetons un coup d’œil à AMSI en action.</span><span class="sxs-lookup"><span data-stu-id="f5987-124">Let's take a look at AMSI in action.</span></span> <span data-ttu-id="f5987-125">Dans cet exemple, Windows Defender est l’application qui appelle les API AMSI.</span><span class="sxs-lookup"><span data-stu-id="f5987-125">In this example, Windows Defender is the application that's calling AMSI APIs.</span></span> <span data-ttu-id="f5987-126">Toutefois, vous pouvez appeler les mêmes API à partir de votre propre application.</span><span class="sxs-lookup"><span data-stu-id="f5987-126">But you can call the same APIs from within your own application.</span></span>

<span data-ttu-id="f5987-127">Voici un exemple de script qui utilise la technique XOR-Encoding pour masquer son intention (que cette intention soit bénigne ou non).</span><span class="sxs-lookup"><span data-stu-id="f5987-127">Here's a sample of a script that uses the XOR-encoding technique to hide its intent (whether that intent is benign or not).</span></span> <span data-ttu-id="f5987-128">Pour cette illustration, nous pouvons imaginer que ce script a été téléchargé à partir d’Internet.</span><span class="sxs-lookup"><span data-stu-id="f5987-128">For this illustration, we can imagine that this script was downloaded from the Internet.</span></span>

![exemple de script encodé en base64](images/AMSI8.png)

<span data-ttu-id="f5987-130">Pour rendre les choses plus intéressantes, nous pouvons entrer ce script manuellement sur la ligne de commande afin qu’il n’y ait pas de fichier réel à analyser.</span><span class="sxs-lookup"><span data-stu-id="f5987-130">To make things more interesting, we can enter this script manually at the command line so that there is no actual file to monitor.</span></span> <span data-ttu-id="f5987-131">Cela reflète ce que l’on appelle une « menace de fichier ».</span><span class="sxs-lookup"><span data-stu-id="f5987-131">This mirrors what's known as a "fileless threat".</span></span> <span data-ttu-id="f5987-132">Ce n’est pas aussi simple que d’analyser des fichiers sur disque.</span><span class="sxs-lookup"><span data-stu-id="f5987-132">It's not as simple as scanning files on disk.</span></span> <span data-ttu-id="f5987-133">La menace peut être une porte dérobée qui réside uniquement dans la mémoire d’un ordinateur.</span><span class="sxs-lookup"><span data-stu-id="f5987-133">The threat might be a backdoor that lives only in the memory of a machine.</span></span>

<span data-ttu-id="f5987-134">Ci-dessous, nous voyons le résultat de l’exécution du script dans Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f5987-134">Below, we see the result of running the script in Windows PowerShell.</span></span> <span data-ttu-id="f5987-135">Vous verrez que Windows Defender est en mesure de détecter l’exemple de test AMSI dans ce scénario compliqué, simplement à l’aide de la signature d’exemple de test AMSI standard.</span><span class="sxs-lookup"><span data-stu-id="f5987-135">You'll see that Windows Defender is able to detect the AMSI test sample in this complicated scenario, merely by using the standard AMSI test sample signature.</span></span>

![Windows Defender-détection de l’exemple de test AMSI](images/AMSI9proper.png)

## <a name="amsi-integration-with-javascriptvba"></a><span data-ttu-id="f5987-137">Intégration de AMSI avec JavaScript/VBA</span><span class="sxs-lookup"><span data-stu-id="f5987-137">AMSI integration with JavaScript/VBA</span></span>

<span data-ttu-id="f5987-138">Le flux de travail illustré ci-dessous décrit le flux de bout en bout d’un autre exemple, dans lequel nous illustrerons l’intégration de AMSI avec l’exécution de macros dans Microsoft Office.</span><span class="sxs-lookup"><span data-stu-id="f5987-138">The illustrated workflow below describes the end-to-end flow of another example, in which we demonstrate AMSI's integration with macro execution within Microsoft Office.</span></span>

![Intégration de AMSI avec JavaScript/VBA](images/integ-js-vba.png)

- <span data-ttu-id="f5987-140">L’utilisateur reçoit un document contenant une macro (malveillante) qui échappe aux analyses logicielles antivirus statiques en employant des techniques telles que l’obscurcissement, les fichiers protégés par mot de passe ou autres.</span><span class="sxs-lookup"><span data-stu-id="f5987-140">The user receives a document containing a (malicious) macro, which evades static antivirus software scans by employing techniques such as obfuscation, password-protected files, or other.</span></span>
- <span data-ttu-id="f5987-141">L’utilisateur ouvre ensuite le document contenant la macro (malveillante).</span><span class="sxs-lookup"><span data-stu-id="f5987-141">The user then opens the document containing the (malicious) macro.</span></span> <span data-ttu-id="f5987-142">Si le document s’ouvre en mode protégé, l’utilisateur clique sur **activer la modification** pour quitter le mode protégé.</span><span class="sxs-lookup"><span data-stu-id="f5987-142">If the document opens in Protected View, then the user clicks **Enable Editing** to exit Protected View.</span></span>
- <span data-ttu-id="f5987-143">L’utilisateur clique sur **activer les macros** pour permettre l’exécution des macros.</span><span class="sxs-lookup"><span data-stu-id="f5987-143">The user clicks **Enable Macros** to allow macros to run.</span></span>
- <span data-ttu-id="f5987-144">À mesure que la macro s’exécute, le runtime VBA utilise une mémoire tampon circulaire pour enregistrer \[ 1 \] données et paramètres liés aux appels aux API Win32, com et VBA.</span><span class="sxs-lookup"><span data-stu-id="f5987-144">As the macro runs, the VBA runtime uses a circular buffer to log \[1\] data and parameters related to calls to Win32, COM, and VBA APIs.</span></span>
- <span data-ttu-id="f5987-145">Lorsque des API Win32 ou COM spécifiques considérées comme étant à haut risque (également appelées *déclencheurs*) \[ 2 \] sont observées, l’exécution de la macro est interrompue et le contenu de la mémoire tampon circulaire est transmis à AMSI.</span><span class="sxs-lookup"><span data-stu-id="f5987-145">When specific Win32 or COM APIs that are considered high risk (also known as *triggers*) \[2\] are observed, macro execution is halted, and the contents of the circular buffer are passed to AMSI.</span></span>
- <span data-ttu-id="f5987-146">Le fournisseur de services anti-programmes malveillants AMSI inscrit répond avec un verdict pour indiquer si le comportement de la macro est malveillant.</span><span class="sxs-lookup"><span data-stu-id="f5987-146">The registered AMSI anti-malware service provider responds with a verdict to indicate whether or not the macro behavior is malicious.</span></span>
- <span data-ttu-id="f5987-147">Si le comportement est non malveillant, l’exécution de la macro se poursuit.</span><span class="sxs-lookup"><span data-stu-id="f5987-147">If the behavior is non-malicious, then macro execution proceeds.</span></span>
- <span data-ttu-id="f5987-148">Dans le cas contraire, si le comportement est malveillant, Microsoft Office ferme la session en réponse à l’alerte \[ 3 \] , et l’antivirus peut mettre le fichier en quarantaine.</span><span class="sxs-lookup"><span data-stu-id="f5987-148">Otherwise, if the behavior is malicious, then Microsoft Office closes the session in response to the alert \[3\], and the AV can quarantine the file.</span></span>

## <a name="what-does-this-mean-for-you"></a><span data-ttu-id="f5987-149">Qu’est-ce que cela signifie pour vous ?</span><span class="sxs-lookup"><span data-stu-id="f5987-149">What does this mean for you?</span></span>

<span data-ttu-id="f5987-150">Pour les utilisateurs de Windows, tout logiciel malveillant qui utilise des techniques d’obscurcissement et de fraude sur les hôtes de script intégrés de Windows 10 est automatiquement inspecté à un niveau plus approfondi que jamais, offrant ainsi des niveaux de protection supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="f5987-150">For Windows users, any malicious software that uses obfuscation and evasion techniques on Windows 10's built-in scripting hosts is automatically inspected at a much deeper level than ever before, providing additional levels of protection.</span></span>

<span data-ttu-id="f5987-151">Pour vous, en tant que développeur d’applications, vous devez faire appel à votre application pour appeler l’interface AMSI de Windows si vous souhaitez tirer parti de l’analyse et de l’analyse supplémentaires du contenu potentiellement malveillant.</span><span class="sxs-lookup"><span data-stu-id="f5987-151">For you as an application developer, consider having your application call the Windows AMSI interface if you want to benefit from (and protect your customers with) extra scanning and analysis of potentially malicious content.</span></span>

<span data-ttu-id="f5987-152">En tant que fournisseur de logiciels antivirus, vous pouvez envisager d’implémenter la prise en charge de l’interface AMSI.</span><span class="sxs-lookup"><span data-stu-id="f5987-152">As an antivirus software vendor, you can consider implementing support for the AMSI interface.</span></span> <span data-ttu-id="f5987-153">Dans ce cas, votre moteur aura un aperçu plus approfondi des données que les applications (y compris les hôtes de script intégrés à Windows 10) sont potentiellement malveillantes.</span><span class="sxs-lookup"><span data-stu-id="f5987-153">When you do, your engine will have much deeper insight into the data that applications (including Windows 10's built-in scripting hosts) consider to be potentially malicious.</span></span>

## <a name="more-background-info-about-fileless-threats"></a><span data-ttu-id="f5987-154">Plus d’informations générales sur les menaces de fichiers</span><span class="sxs-lookup"><span data-stu-id="f5987-154">More background info about fileless threats</span></span>

<span data-ttu-id="f5987-155">Vous pouvez être curieux d’obtenir plus d’informations générales sur les types de menaces sans fichier que Windows AMSI est conçu pour vous aider à vous défendre contre.</span><span class="sxs-lookup"><span data-stu-id="f5987-155">You may be curious for more background info about the kinds of fileless threats that Windows AMSI is designed to help you defend against.</span></span> <span data-ttu-id="f5987-156">Dans cette section, nous allons jeter un coup d’œil au jeu de chat et de souris traditionnel qui s’exécute dans l’écosystème des logiciels malveillants.</span><span class="sxs-lookup"><span data-stu-id="f5987-156">In this section, we'll take a look at the traditional cat-and-mouse game that plays out in the malware ecosystem.</span></span>

<span data-ttu-id="f5987-157">Nous allons utiliser PowerShell comme exemple.</span><span class="sxs-lookup"><span data-stu-id="f5987-157">We'll use PowerShell as an example.</span></span> <span data-ttu-id="f5987-158">Mais vous pouvez tirer parti des mêmes techniques et processus que nous allons démontrer avec les langages &mdash; VBScript, Perl, Python, Ruby et bien plus encore.</span><span class="sxs-lookup"><span data-stu-id="f5987-158">But you can leverage the same techniques and processes we'll demonstrate with any dynamic language&mdash;VBScript, Perl, Python, Ruby, and more.</span></span>

<span data-ttu-id="f5987-159">Voici un exemple de script PowerShell malveillant.</span><span class="sxs-lookup"><span data-stu-id="f5987-159">Here's an example of a malicious PowerShell script.</span></span>

![exemple de script PowerShell malveillant](images/AMSI1.png)

<span data-ttu-id="f5987-161">Bien que ce script écrive simplement un message à l’écran, le programme malveillant est généralement plus être mal intentionné.</span><span class="sxs-lookup"><span data-stu-id="f5987-161">While this script simply writes a message to the screen, malware is typically more nefarious.</span></span> <span data-ttu-id="f5987-162">Mais vous pouvez facilement écrire une signature pour détecter celle-ci.</span><span class="sxs-lookup"><span data-stu-id="f5987-162">But you could easily write a signature to detect this one.</span></span> <span data-ttu-id="f5987-163">Par exemple, la signature peut rechercher la chaîne « Write-Host’pwnd ! ' »</span><span class="sxs-lookup"><span data-stu-id="f5987-163">For example, the signature could search for the string "Write-Host 'pwnd!'"</span></span> <span data-ttu-id="f5987-164">dans un fichier ouvert par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f5987-164">in any file that the user opens.</span></span> <span data-ttu-id="f5987-165">Parfait : nous avons détecté nos premiers programmes malveillants !</span><span class="sxs-lookup"><span data-stu-id="f5987-165">Great: we've detected our first malware!</span></span>

<span data-ttu-id="f5987-166">Après avoir été détecté par notre première signature, les auteurs de programmes malveillants répondront.</span><span class="sxs-lookup"><span data-stu-id="f5987-166">After being detected by our first signature, though, malware authors will respond.</span></span> <span data-ttu-id="f5987-167">Ils répondent en créant des scripts dynamiques tels que cet exemple.</span><span class="sxs-lookup"><span data-stu-id="f5987-167">They respond by creating dynamic scripts such as this example.</span></span>

![exemple de script dynamique](images/AMSI2.png)

<span data-ttu-id="f5987-169">Dans ce scénario, les auteurs de programmes malveillants créent une chaîne représentant le script PowerShell à exécuter.</span><span class="sxs-lookup"><span data-stu-id="f5987-169">In that scenario, malware authors create a string representing the PowerShell script to run.</span></span> <span data-ttu-id="f5987-170">Mais elles utilisent une technique simple de concaténation de chaînes pour rompre la signature précédente.</span><span class="sxs-lookup"><span data-stu-id="f5987-170">But they use a simple string concatenation technique to break our earlier signature.</span></span> <span data-ttu-id="f5987-171">Si vous affichez la source d’une page Web à charge Active Directory, vous verrez que de nombreuses instances de cette technique sont utilisées pour éviter les logiciels de blocage publicitaire.</span><span class="sxs-lookup"><span data-stu-id="f5987-171">If you ever view the source of an ad-laden web page, you'll see many instances of this technique being used to avoid ad-blocking software.</span></span>

<span data-ttu-id="f5987-172">Enfin, l’auteur du programme malveillant passe cette chaîne concaténée au `Invoke-Expression` mécanisme de l’applet de commande &mdash; PowerShell pour évaluer les scripts composés ou créés au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="f5987-172">Finally, the malware author passes this concatenated string to the `Invoke-Expression` cmdlet&mdash;PowerShell's mechanism to evaluate scripts that are composed or created at runtime.</span></span>

<span data-ttu-id="f5987-173">En réponse, un logiciel anti-programme malveillant commence à effectuer une émulation de langage de base.</span><span class="sxs-lookup"><span data-stu-id="f5987-173">In response, antimalware software starts to do basic language emulation.</span></span> <span data-ttu-id="f5987-174">Par exemple, si deux chaînes sont concaténées, nous émulons la concaténation de ces deux chaînes, puis nous exécutons nos signatures sur le résultat.</span><span class="sxs-lookup"><span data-stu-id="f5987-174">For example, if we see two strings being concatenated, then we emulate the concatenation of those two strings, and then run our signatures on the result.</span></span> <span data-ttu-id="f5987-175">Malheureusement, il s’agit d’une approche relativement délicate, car les langages ont tendance à avoir de nombreuses façons de représenter et de concaténer des chaînes.</span><span class="sxs-lookup"><span data-stu-id="f5987-175">Unfortunately, this is a fairly fragile approach, because languages tend to have a lot of ways to represent and concatenate strings.</span></span>

<span data-ttu-id="f5987-176">Par conséquent, après avoir été intercepté par cette signature, les auteurs de programmes malveillants seront plus compliqués &mdash; par exemple, en encodant le contenu du script en base64, comme dans l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="f5987-176">So, after being caught by this signature, malware authors will move to something more complicated&mdash;for example, encoding script content in Base64, as in this next example.</span></span>

![exemple de contenu de script en base64](images/AMSI3.png)

<span data-ttu-id="f5987-178">En ingénieux, la plupart des moteurs anti-programme malveillant implémentent également l’émulation de décodage base64.</span><span class="sxs-lookup"><span data-stu-id="f5987-178">Being resourceful, most antimalware engines implement Base64 decoding emulation, as well.</span></span> <span data-ttu-id="f5987-179">Par conséquent, puisque nous implémentons également l’émulation de décodage base64, nous sommes anticipés pour une heure.</span><span class="sxs-lookup"><span data-stu-id="f5987-179">So, since we also implement Base64 decoding emulation, we're ahead for a time.</span></span>

<span data-ttu-id="f5987-180">En réponse, les auteurs de programmes malveillants passent à l’obscurcissement algorithmique &mdash; comme un simple mécanisme d’encodage XOR dans les scripts qu’ils exécutent.</span><span class="sxs-lookup"><span data-stu-id="f5987-180">In response, malware authors move to algorithmic obfuscation&mdash;such as a simple XOR-encoding mechanism in the scripts they run.</span></span>

![exemple de script d’obscurcissement algorithmique](images/AMSI4.png)

<span data-ttu-id="f5987-182">À ce stade, nous avons généralement dépassé les moteurs antivirus qui seront émulés ou détectés. nous ne détectons donc pas nécessairement ce que ce script fait.</span><span class="sxs-lookup"><span data-stu-id="f5987-182">At this point, we're generally past what antivirus engines will emulate or detect, so we won't necessarily detect what this script is doing.</span></span> <span data-ttu-id="f5987-183">Toutefois, nous pouvons commencer à écrire des signatures sur les techniques d’obscurcissement et d’encodage.</span><span class="sxs-lookup"><span data-stu-id="f5987-183">However, we can start to write signatures against the obfuscation and encoding techniques.</span></span> <span data-ttu-id="f5987-184">En fait, c’est ce qui compte pour la grande majorité des signatures pour les programmes malveillants basés sur des scripts.</span><span class="sxs-lookup"><span data-stu-id="f5987-184">In fact, that's what accounts for the vast majority of signatures for script-based malware.</span></span>

<span data-ttu-id="f5987-185">Mais que se passe-t-il si l’obscurcissement est tellement trivial qu’il ressemble à de nombreux scripts corrects ?</span><span class="sxs-lookup"><span data-stu-id="f5987-185">But what if the obfuscator is so trivial that it looks like many well-behaved scripts?</span></span> <span data-ttu-id="f5987-186">Une signature pour cela générerait un nombre inacceptable de faux positifs.</span><span class="sxs-lookup"><span data-stu-id="f5987-186">A signature for it would generate an unacceptable number of false positives.</span></span> <span data-ttu-id="f5987-187">Voici un exemple de script *intermédiaire* trop Bénin pour la détection autonome.</span><span class="sxs-lookup"><span data-stu-id="f5987-187">Here's a sample *stager* script that's too benign to detect on its own.</span></span>

![exemple de script intermédiaire trop Bénin pour la détection autonome](images/AMSI5.png)

<span data-ttu-id="f5987-189">Dans cet exemple, nous téléchargeons une page Web et appelons du contenu à partir de celle-ci.</span><span class="sxs-lookup"><span data-stu-id="f5987-189">In that example, we're downloading a web page, and invoking some content from it.</span></span> <span data-ttu-id="f5987-190">Voici l’équivalent dans Visual Basic Script.</span><span class="sxs-lookup"><span data-stu-id="f5987-190">Here's the equivalent in Visual Basic script.</span></span>

![équivalent dans Visual Basic Script](images/AMSI6.png)

<span data-ttu-id="f5987-192">Ce qui complique ces deux exemples, c’est que le moteur antivirus inspecte les fichiers ouverts par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f5987-192">What makes things worse in both of these examples is that the antivirus engine inspects files being opened by the user.</span></span> <span data-ttu-id="f5987-193">Si le contenu malveillant se trouve uniquement dans la mémoire, l’attaque peut potentiellement passer inaperçue.</span><span class="sxs-lookup"><span data-stu-id="f5987-193">If the malicious content lives only in memory, then the attack can potentially go undetected.</span></span>

<span data-ttu-id="f5987-194">Cette section a montré les limitations de la détection à l’aide de signatures traditionnelles.</span><span class="sxs-lookup"><span data-stu-id="f5987-194">This section showed the limitations of detection using traditional signatures.</span></span> <span data-ttu-id="f5987-195">Toutefois, si un script malveillant peut traverser plusieurs passages de débrouillage, il doit finalement fournir le moteur de script avec du code brut et non brouillé.</span><span class="sxs-lookup"><span data-stu-id="f5987-195">But, while a malicious script might go through several passes of de-obfuscation, it ultimately needs to supply the scripting engine with plain, unobfuscated code.</span></span> <span data-ttu-id="f5987-196">Et à ce stade &mdash; , comme nous l’avons décrit dans la première section ci-dessus, &mdash; les hôtes de script intégrés de Windows 10 appellent les API AMSI pour demander une analyse de ce contenu non protégé.</span><span class="sxs-lookup"><span data-stu-id="f5987-196">And at that point&mdash;as we described in the first section above&mdash;Windows 10's built-in scripting hosts call the AMSI APIs to request a scan of this unprotected content.</span></span> <span data-ttu-id="f5987-197">Et votre application peut faire la même chose.</span><span class="sxs-lookup"><span data-stu-id="f5987-197">And your application can do the same thing.</span></span>

## <a name="related-resources"></a><span data-ttu-id="f5987-198">Ressources associées</span><span class="sxs-lookup"><span data-stu-id="f5987-198">Related resources</span></span>

* [<span data-ttu-id="f5987-199">Menaces de fichiers</span><span class="sxs-lookup"><span data-stu-id="f5987-199">Fileless threats</span></span>](/windows/security/threat-protection/intelligence/fileless-threats)
* [<span data-ttu-id="f5987-200">Office VBA + AMSI : présentation du voile sur les macros malveillantes</span><span class="sxs-lookup"><span data-stu-id="f5987-200">Office VBA + AMSI: Parting the veil on malicious macros</span></span>](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/)
* [<span data-ttu-id="f5987-201">Prêt à l’emploi, mais pas invisible : déchargement de logiciels malveillants sans fichier avec surveillance du comportement, AMSI et AV nouvelle génération</span><span class="sxs-lookup"><span data-stu-id="f5987-201">Out of sight but not invisible: Defeating fileless malware with behavior monitoring, AMSI, and next-gen AV</span></span>](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/27/out-of-sight-but-not-invisible-defeating-fileless-malware-with-behavior-monitoring-amsi-and-next-gen-av/)
