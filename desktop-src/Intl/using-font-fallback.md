---
description: Utilisation de la police de secours
ms.assetid: 952f33b6-ca52-40a2-b914-52c1c62ae0e0
title: Utilisation de la police de secours
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9afb073a01cc1c5b90d4a4861a973846d3ae9ae1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103760485"
---
# <a name="using-font-fallback"></a><span data-ttu-id="e1acd-103">Utilisation de la police de secours</span><span class="sxs-lookup"><span data-stu-id="e1acd-103">Using Font Fallback</span></span>

> [!Note]  
> <span data-ttu-id="e1acd-104">Dans cette rubrique, toutes les remarques sur [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) s’appliquent également à [**ScriptShapeOpenType**](/windows/desktop/api/Usp10/nf-usp10-scriptshapeopentype).</span><span class="sxs-lookup"><span data-stu-id="e1acd-104">In this topic, all remarks about [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) apply equally to [**ScriptShapeOpenType**](/windows/desktop/api/Usp10/nf-usp10-scriptshapeopentype).</span></span>

 

<span data-ttu-id="e1acd-105">Votre application doit utiliser la police de secours pendant l’affichage du texte si certains caractères d’une chaîne ne sont pas pris en charge dans la police, ou si l’application utilise un [script complexe](uniscribe-glossary.md) non pris en charge par la police.</span><span class="sxs-lookup"><span data-stu-id="e1acd-105">Your application must use font fallback during text display if some characters in a string are not supported in the font, or if the application uses a [complex script](uniscribe-glossary.md) not supported by the font.</span></span> <span data-ttu-id="e1acd-106">La spécification de la police de secours est détectée pendant le processus de disposition du texte, lorsque l’application appelle la fonction [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) .</span><span class="sxs-lookup"><span data-stu-id="e1acd-106">The requirement for font fallback is detected during the layout process for text, when the application calls the [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) function.</span></span> <span data-ttu-id="e1acd-107">Pour plus d’informations sur l’affichage de texte, consultez [affichage de texte avec Uniscribe](displaying-text-with-uniscribe.md).</span><span class="sxs-lookup"><span data-stu-id="e1acd-107">For information about text display, see [Displaying Text with Uniscribe](displaying-text-with-uniscribe.md).</span></span>

## <a name="determine-the-need-for-font-fallback-for-unsupported-characters"></a><span data-ttu-id="e1acd-108">Déterminer la nécessité d’une police de secours pour les caractères non pris en charge</span><span class="sxs-lookup"><span data-stu-id="e1acd-108">Determine the Need for Font Fallback for Unsupported Characters</span></span>

<span data-ttu-id="e1acd-109">Si certains caractères d’une chaîne ne sont pas pris en charge dans une police demandée, l’appel d’une application à [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) s’effectue correctement.</span><span class="sxs-lookup"><span data-stu-id="e1acd-109">If some of the characters in a string are not supported in a requested font, an application call to [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) succeeds.</span></span> <span data-ttu-id="e1acd-110">Toutefois, l’application doit analyser la mémoire tampon de sortie de glyphe pour déterminer la présence de glyphes manquants.</span><span class="sxs-lookup"><span data-stu-id="e1acd-110">However, the application must scan the glyph output buffer for the presence of missing glyphs.</span></span> <span data-ttu-id="e1acd-111">L’index de glyphe du glyphe manquant peut être déterminé pour une police spécifique en appelant [**ScriptGetFontProperties**](/windows/desktop/api/Usp10/nf-usp10-scriptgetfontproperties).</span><span class="sxs-lookup"><span data-stu-id="e1acd-111">The glyph index of the missing glyph can be determined for a specific font by calling [**ScriptGetFontProperties**](/windows/desktop/api/Usp10/nf-usp10-scriptgetfontproperties).</span></span> <span data-ttu-id="e1acd-112">Si un glyphe particulier n’est pas disponible, l’application doit soit revenir à une police différente pour un glyphe, soit restituer un symbole graphique qui indique qu’aucun glyphe n’est disponible.</span><span class="sxs-lookup"><span data-stu-id="e1acd-112">If a particular glyph is unavailable, the application must either fall back to a different font for a glyph or render a graphic symbol that indicates that no glyph is available.</span></span>

## <a name="determine-the-need-for-font-fallback-for-unsupported-complex-scripts"></a><span data-ttu-id="e1acd-113">Déterminer le besoin de police de secours pour les scripts complexes non pris en charge</span><span class="sxs-lookup"><span data-stu-id="e1acd-113">Determine the Need for Font Fallback for Unsupported Complex Scripts</span></span>

<span data-ttu-id="e1acd-114">La police qu’une application préfère pour l’affichage peut ne pas prendre en charge un script complexe qui est requis par le texte.</span><span class="sxs-lookup"><span data-stu-id="e1acd-114">The font that an application prefers for display might not support a complex script that is required by the text.</span></span> <span data-ttu-id="e1acd-115">Dans ce cas, l’appel de l’application à [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) échoue avec le code d’erreur E le \_ script \_ n’est pas dans la \_ \_ police.</span><span class="sxs-lookup"><span data-stu-id="e1acd-115">In this case, the application call to [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) fails with the error code E\_SCRIPT\_NOT\_IN\_FONT.</span></span>

## <a name="assign-a-fallback-font"></a><span data-ttu-id="e1acd-116">Assigner une police de secours</span><span class="sxs-lookup"><span data-stu-id="e1acd-116">Assign a Fallback Font</span></span>

<span data-ttu-id="e1acd-117">Une fois qu’il a déterminé que la police de secours est requise, l’application doit assigner une police de secours.</span><span class="sxs-lookup"><span data-stu-id="e1acd-117">Once it has determined that font fallback is required, the application must assign a fallback font.</span></span> <span data-ttu-id="e1acd-118">L’application peut essayer les techniques suivantes :</span><span class="sxs-lookup"><span data-stu-id="e1acd-118">The application can try the following techniques:</span></span>

-   <span data-ttu-id="e1acd-119">Appelez [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) pour chaque police d’une liste de polices jusqu’à ce qu’un appel ait un retour acceptable.</span><span class="sxs-lookup"><span data-stu-id="e1acd-119">Call [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) for each font in a font list until one call has an acceptable return.</span></span>
-   <span data-ttu-id="e1acd-120">Appelez [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) avec chaque police d’une liste jusqu’à ce qu’il soit possible de déterminer qu’aucune police ne fonctionnera correctement.</span><span class="sxs-lookup"><span data-stu-id="e1acd-120">Call [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) with each font in a list until it can be determined that no font will succeed.</span></span> <span data-ttu-id="e1acd-121">Si le code d’erreur est toujours \_ E \_ \_ , le script n’est pas dans \_ la police, un script complexe n’est pas pris en charge par les polices.</span><span class="sxs-lookup"><span data-stu-id="e1acd-121">If the error code is always E\_SCRIPT\_NOT\_IN\_FONT, a complex script is not supported by the fonts.</span></span> <span data-ttu-id="e1acd-122">Effectuez le rendu d’un symbole graphique qui indique qu’aucun glyphe n’est disponible, ou spécifiez à nouveau le script comme non défini (aucun traitement de script) et recommencez.</span><span class="sxs-lookup"><span data-stu-id="e1acd-122">Either render a graphic symbol that indicates that no glyph is available, or re-specify the script as undefined (no script processing) and start again.</span></span> <span data-ttu-id="e1acd-123">Pour définir le script comme non défini, définissez le membre **escript** de la structure [**d' \_ analyse des scripts**](/windows/win32/api/usp10/ns-usp10-script_analysis) sur le script \_ non défini.</span><span class="sxs-lookup"><span data-stu-id="e1acd-123">To set the script as undefined, set the **eScript** member of the [**SCRIPT\_ANALYSIS**](/windows/win32/api/usp10/ns-usp10-script_analysis) structure to SCRIPT\_UNDEFINED.</span></span>
-   <span data-ttu-id="e1acd-124">Appelez [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) avec chaque police d’une liste jusqu’à ce qu’il soit possible de déterminer qu’aucune police ne fonctionnera correctement.</span><span class="sxs-lookup"><span data-stu-id="e1acd-124">Call [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) with each font in a list until it can be determined that no font will succeed.</span></span> <span data-ttu-id="e1acd-125">Si le code d’erreur indique que certains caractères sont mappés à des glyphes manquants, divisez la chaîne en plages plus petites.</span><span class="sxs-lookup"><span data-stu-id="e1acd-125">If the error code indicates that some of the characters are mapping to missing glyphs, break up the string into smaller ranges.</span></span> <span data-ttu-id="e1acd-126">Des polices différentes peuvent être assignées à des sous-plages afin que d’autres caractères puissent être rendus.</span><span class="sxs-lookup"><span data-stu-id="e1acd-126">Different fonts can be assigned to subranges so that more of the characters can be rendered.</span></span>

## <a name="generate-glyph-information"></a><span data-ttu-id="e1acd-127">Générer des informations de glyphe</span><span class="sxs-lookup"><span data-stu-id="e1acd-127">Generate Glyph Information</span></span>

<span data-ttu-id="e1acd-128">Une fois que l’application a affecté une police qui parvient aux appels à [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape), elle peut effectuer des appels à [**ScriptPlace**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) pour générer des informations de largeur avancée de glyphe et de décalage à deux dimensions à partir de la sortie de **ScriptShape**.</span><span class="sxs-lookup"><span data-stu-id="e1acd-128">Once the application has assigned a font that succeeds in calls to [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape), it can make calls to [**ScriptPlace**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) to generate glyph advance width and two-dimensional offset information from the output of **ScriptShape**.</span></span> <span data-ttu-id="e1acd-129">La police doit être correctement exécutée dans ces appels.</span><span class="sxs-lookup"><span data-stu-id="e1acd-129">The font should succeed in these calls.</span></span> <span data-ttu-id="e1acd-130">Une erreur de police dans un appel à **ScriptPlace** après un succès dans un appel **ScriptShape** indique une police rompue.</span><span class="sxs-lookup"><span data-stu-id="e1acd-130">A font failure in a call to **ScriptPlace** after success in a **ScriptShape** call indicates a broken font.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e1acd-131">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="e1acd-131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e1acd-132">Utilisation de Uniscribe</span><span class="sxs-lookup"><span data-stu-id="e1acd-132">Using Uniscribe</span></span>](using-uniscribe.md)
</dt> </dl>

 

 



