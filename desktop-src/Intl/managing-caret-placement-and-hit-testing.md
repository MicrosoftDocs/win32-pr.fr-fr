---
description: Les langages de script complexes sont divisés en clusters par ScriptShape. La réorganisation des caractères se produit toujours dans les limites du cluster. Les clusters eux-mêmes sont assurés d’avancer dans le sens de l’ordre de lecture.
ms.assetid: 50b4b643-af96-4a6f-80f9-27a71ce16b0e
title: Gestion de l’emplacement du signe insertion et du test de positionnement
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 60396a668c89f7392b28adde0bb123060bf50348
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106520399"
---
# <a name="managing-caret-placement-and-hit-testing"></a><span data-ttu-id="066c8-105">Gestion de l’emplacement du signe insertion et du test de positionnement</span><span class="sxs-lookup"><span data-stu-id="066c8-105">Managing Caret Placement and Hit Testing</span></span>

<span data-ttu-id="066c8-106">Les langages de script complexes sont divisés en [clusters](uniscribe-glossary.md) par [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape).</span><span class="sxs-lookup"><span data-stu-id="066c8-106">Complex script languages are broken into [clusters](uniscribe-glossary.md) by [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape).</span></span> <span data-ttu-id="066c8-107">La réorganisation des caractères se produit toujours dans les limites du cluster.</span><span class="sxs-lookup"><span data-stu-id="066c8-107">Character reordering always occurs within cluster boundaries.</span></span> <span data-ttu-id="066c8-108">Les clusters eux-mêmes sont assurés d’avancer dans le sens de l’ordre de lecture.</span><span class="sxs-lookup"><span data-stu-id="066c8-108">The clusters themselves are guaranteed to advance in the direction of the reading order.</span></span>

<span data-ttu-id="066c8-109">Les informations de cluster dans le groupe de clusters logiques sont utilisées pour partager la largeur d’un cluster de glyphes de manière égale entre les caractères logiques qu’ils représentent.</span><span class="sxs-lookup"><span data-stu-id="066c8-109">Cluster information in the logical cluster array is used to share the width of a cluster of glyphs equally among the logical characters they represent.</span></span> <span data-ttu-id="066c8-110">Par exemple, le glyphe Lam Lam est divisé en quatre zones :</span><span class="sxs-lookup"><span data-stu-id="066c8-110">For example, the lam alef glyph is divided into four areas:</span></span>

-   <span data-ttu-id="066c8-111">La moitié principale du Lam.</span><span class="sxs-lookup"><span data-stu-id="066c8-111">The leading half of the lam.</span></span>
-   <span data-ttu-id="066c8-112">La moitié de fin du Lam.</span><span class="sxs-lookup"><span data-stu-id="066c8-112">The trailing half of the lam.</span></span>
-   <span data-ttu-id="066c8-113">Moitié gauche de l’Alef.</span><span class="sxs-lookup"><span data-stu-id="066c8-113">The leading half of the alef.</span></span>
-   <span data-ttu-id="066c8-114">La moitié de la fin de l’Alef.</span><span class="sxs-lookup"><span data-stu-id="066c8-114">The trailing half of the alef.</span></span>

<span data-ttu-id="066c8-115">Les conventions d’emplacement du signe insertion au sein des clusters dépendent du script.</span><span class="sxs-lookup"><span data-stu-id="066c8-115">Conventions for caret placement within clusters depend on the script.</span></span> <span data-ttu-id="066c8-116">Pour le script arabe, si la position du signe insertion est définie entre un caractère de base et sa marque de combinaison, le signe insertion est affiché à mi-chemin dans le caractère de base.</span><span class="sxs-lookup"><span data-stu-id="066c8-116">For the Arabic script, if the caret position is set between a base character and its combining mark, the caret is displayed halfway through the base character.</span></span> <span data-ttu-id="066c8-117">Pour le script thaï, le signe insertion ne peut pas être positionné au sein d’un cluster.</span><span class="sxs-lookup"><span data-stu-id="066c8-117">For the Thai script, the caret cannot be positioned within a cluster.</span></span> <span data-ttu-id="066c8-118">Ainsi, lorsque l’utilisateur avance le signe insertion, l’application doit avancer tous les glyphes qui composent le cluster.</span><span class="sxs-lookup"><span data-stu-id="066c8-118">Thus, when the user advances the caret, the application must advance past all the glyphs that make up the cluster.</span></span>

<span data-ttu-id="066c8-119">Les fonctions [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) et [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) se traduisent entre les positions du signe insertion (en pixels de décalage de point de code) et les positions x (en pixels).</span><span class="sxs-lookup"><span data-stu-id="066c8-119">The [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) and [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) functions translate between caret positions (in code point offsets) and x positions (in pixels).</span></span> <span data-ttu-id="066c8-120">La fonction **ScriptXtoCP** a connaissance des conventions de position du signe insertion de chaque script :</span><span class="sxs-lookup"><span data-stu-id="066c8-120">The **ScriptXtoCP** function has knowledge of the caret position conventions of each script:</span></span>

-   <span data-ttu-id="066c8-121">Pour l’Inde et le thaï, les positions du signe insertion sont alignées sur les limites du cluster.</span><span class="sxs-lookup"><span data-stu-id="066c8-121">For Indian and Thai, caret positions are snapped to cluster boundaries.</span></span>
-   <span data-ttu-id="066c8-122">Pour l’arabe, les positions du signe insertion sont interpolées avec les clusters.</span><span class="sxs-lookup"><span data-stu-id="066c8-122">For Arabic, caret positions are interpolated with clusters.</span></span>
-   <span data-ttu-id="066c8-123">Pour l’hébreu, dans les versions antérieures à Usp10.dll, la version 1,420, les positions du signe insertion sont interpolées avec les clusters.</span><span class="sxs-lookup"><span data-stu-id="066c8-123">For Hebrew, in versions prior to Usp10.dll, version 1.420, caret positions are interpolated with clusters.</span></span> <span data-ttu-id="066c8-124">À partir de Usp10.dll, version 1,420, les positions du signe insertion sont alignées sur les limites du cluster.</span><span class="sxs-lookup"><span data-stu-id="066c8-124">Beginning with Usp10.dll, version 1.420, caret positions are snapped to cluster boundaries.</span></span>

<span data-ttu-id="066c8-125">[**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) et [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) fonctionnent uniquement dans les exécutions.</span><span class="sxs-lookup"><span data-stu-id="066c8-125">Both [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) and [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) operate only within runs.</span></span> <span data-ttu-id="066c8-126">Les fonctions requièrent que certains paramètres proviennent d’appels Uniscribe antérieurs, comme indiqué dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="066c8-126">The functions require that certain parameters come from earlier Uniscribe calls, as shown in the following table.</span></span>



| <span data-ttu-id="066c8-127">Paramètre</span><span class="sxs-lookup"><span data-stu-id="066c8-127">Parameter</span></span>                                        | <span data-ttu-id="066c8-128">Source</span><span class="sxs-lookup"><span data-stu-id="066c8-128">Source</span></span>                                                 |
|--------------------------------------------------|--------------------------------------------------------|
| <span data-ttu-id="066c8-129">*tests*</span><span class="sxs-lookup"><span data-stu-id="066c8-129">*psa*</span></span>                                            | <span data-ttu-id="066c8-130">Tel qu’il est retourné par [**ScriptItemize**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize).</span><span class="sxs-lookup"><span data-stu-id="066c8-130">As returned by [**ScriptItemize**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize).</span></span> |
| <span data-ttu-id="066c8-131">*cGlyphspwLogClust*</span><span class="sxs-lookup"><span data-stu-id="066c8-131">*cGlyphspwLogClust*</span></span><br/> <span data-ttu-id="066c8-132">*psva*</span><span class="sxs-lookup"><span data-stu-id="066c8-132">*psva*</span></span><br/> | <span data-ttu-id="066c8-133">Tel qu’il est retourné par [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape).</span><span class="sxs-lookup"><span data-stu-id="066c8-133">As returned by [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape).</span></span>     |
| <span data-ttu-id="066c8-134">*piAdvance*</span><span class="sxs-lookup"><span data-stu-id="066c8-134">*piAdvance*</span></span>                                      | <span data-ttu-id="066c8-135">Tel qu’il est retourné par [**ScriptPlace**](/windows/desktop/api/Usp10/nf-usp10-scriptplace).</span><span class="sxs-lookup"><span data-stu-id="066c8-135">As returned by [**ScriptPlace**](/windows/desktop/api/Usp10/nf-usp10-scriptplace).</span></span>     |



 

<span data-ttu-id="066c8-136">L’application doit établir la série dans laquelle un décalage de signe insertion ou une position x donnée avant de passer les informations à [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) ou [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp).</span><span class="sxs-lookup"><span data-stu-id="066c8-136">The application must establish the run in which a given caret offset or x position is before passing the information to [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) or [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp).</span></span> <span data-ttu-id="066c8-137">Si l’application n’enregistre pas les informations de largeur, elle peut effectuer un test de positionnement et un placement de signe insertion après l’affichage de chaque exécution.</span><span class="sxs-lookup"><span data-stu-id="066c8-137">If the application does not save the width information, it can do hit testing and caret placement after displaying each run.</span></span> <span data-ttu-id="066c8-138">En guise d’alternative, l’application peut mettre en cache suffisamment d’informations pour effectuer des tests de positionnement et placer le curseur sur la ligne active sans nécessiter de retraitement du paragraphe.</span><span class="sxs-lookup"><span data-stu-id="066c8-138">As an alternative, the application can cache enough information to do hit testing and caret placement on the current line without requiring reprocessing of the paragraph.</span></span>

<span data-ttu-id="066c8-139">[**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) retourne une valeur de bord de fin pour que l’application sache le côté du caractère ou du cluster sur lequel l’utilisateur a cliqué.</span><span class="sxs-lookup"><span data-stu-id="066c8-139">[**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) returns a trailing edge value so that the application knows the side of the character or cluster on which the user has clicked.</span></span> <span data-ttu-id="066c8-140">La valeur est égale à 0 ou à la largeur du caractère ou du cluster en points de code.</span><span class="sxs-lookup"><span data-stu-id="066c8-140">The value is either 0 or the width of the character or cluster in code points.</span></span> <span data-ttu-id="066c8-141">La position de caractère retournée correspond à la position du caractère sur lequel l’utilisateur a cliqué.</span><span class="sxs-lookup"><span data-stu-id="066c8-141">The returned character position is the position of the character on which the user clicked.</span></span> <span data-ttu-id="066c8-142">Pour plus d’informations, consultez [affichage du signe insertion dans les chaînes bidirectionnelles](displaying-the-caret-in-bidirectional-strings.md).</span><span class="sxs-lookup"><span data-stu-id="066c8-142">For more information, see [Displaying the Caret in Bidirectional Strings](displaying-the-caret-in-bidirectional-strings.md).</span></span>

<span data-ttu-id="066c8-143">Pour les langues telles que le thaï, pour lesquelles l’utilisateur ne souhaite pas placer le signe insertion dans un cluster, [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) définit l’indicateur côté fin sur 0 ou sur la largeur du cluster.</span><span class="sxs-lookup"><span data-stu-id="066c8-143">For languages such as Thai, for which the user conventionally does not want to place the caret into a cluster, [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) sets the trailing side flag to 0 or to the cluster width.</span></span> <span data-ttu-id="066c8-144">Pour les langues telles que l’arabe, pour lesquelles l’utilisateur s’attend à pouvoir effectuer des modifications au sein d’un cluster, **ScriptXtoCP** affecte à l’indicateur de fin de fin la valeur 0 ou 1.</span><span class="sxs-lookup"><span data-stu-id="066c8-144">For languages such as Arabic, for which the user expects to be able to edit within a cluster, **ScriptXtoCP** sets the trailing side flag to 0 or to 1.</span></span>

<span data-ttu-id="066c8-145">Pour aider l’application à établir des emplacements valides pour le signe insertion lors du traitement des touches de direction, Uniscribe fournit des informations sur les positions de signe insertion valides dans le membre **fCharStop** dans les attributs logiques retournés par [**ScriptBreak**](/windows/desktop/api/Usp10/nf-usp10-scriptbreak).</span><span class="sxs-lookup"><span data-stu-id="066c8-145">To help the application establish valid locations for the caret when handling the arrow keys, Uniscribe provides information on valid caret positions in the **fCharStop** member in the logical attributes returned by [**ScriptBreak**](/windows/desktop/api/Usp10/nf-usp10-scriptbreak).</span></span> <span data-ttu-id="066c8-146">La **valeur true** est retournée pour la plupart des caractères et **false** pour les caractères interclusters dans les scripts tels que le thaï.</span><span class="sxs-lookup"><span data-stu-id="066c8-146">**TRUE** is returned for most characters and **FALSE** for intercluster characters in scripts such as Thai.</span></span> <span data-ttu-id="066c8-147">L’application doit vérifier la valeur **fNeedsCaretInfo** dans la structure des [**\_ Propriétés de script**](/windows/desktop/api/Usp10/ns-usp10-script_properties) pour un élément afin de déterminer s’il est nécessaire d’appeler **ScriptBreak** pour vérifier les positions de signe insertion valides.</span><span class="sxs-lookup"><span data-stu-id="066c8-147">The application should check the **fNeedsCaretInfo** value in the [**SCRIPT\_PROPERTIES**](/windows/desktop/api/Usp10/ns-usp10-script_properties) structure for an item to see if it is necessary to call **ScriptBreak** to check for valid caret positions.</span></span> <span data-ttu-id="066c8-148">Si la valeur **fNeedsCaretInfo** est **false**, tous les points de code sont des positions de signe insertion valides.</span><span class="sxs-lookup"><span data-stu-id="066c8-148">If the **fNeedsCaretInfo** value is **FALSE**, all code points are valid caret positions.</span></span>

## <a name="related-topics"></a><span data-ttu-id="066c8-149">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="066c8-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="066c8-150">Utilisation de Uniscribe</span><span class="sxs-lookup"><span data-stu-id="066c8-150">Using Uniscribe</span></span>](using-uniscribe.md)
</dt> </dl>

 

 




