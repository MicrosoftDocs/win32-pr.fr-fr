---
title: Surface de la composition
description: Cette rubrique décrit les types de surfaces pris en charge par Microsoft DirectComposition.
ms.assetid: E19B4F0E-1CFA-4E93-BB6A-BFB701BC72CA
keywords:
- surface de la composition
- Surface logique DirectComposition
- Surface virtuelle DirectComposition
- mise à jour d’une surface logique
- surface logique, mise à jour
- découpage d’une surface virtuelle
- surface virtuelle, découpage
- supprimer la surface virtuelle
- redimensionnement d’une surface virtuelle
- Surace virtuel, redimensionnement
- redimensionner la surface virtuelle
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f4bd30bfbd1de91444b7076184db597cd7a8c82
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104031417"
---
# <a name="composition-surface"></a><span data-ttu-id="2fc9f-114">Surface de la composition</span><span class="sxs-lookup"><span data-stu-id="2fc9f-114">Composition surface</span></span>

> [!NOTE]
> <span data-ttu-id="2fc9f-115">Pour les applications sur Windows 10, nous vous recommandons d’utiliser des API Windows. UI. composition au lieu de DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-115">For apps on Windows 10, we recommend using Windows.UI.Composition APIs instead of DirectComposition.</span></span> <span data-ttu-id="2fc9f-116">Pour plus d’informations, consultez [moderniser votre application de bureau à l’aide de la couche visuelle](/windows/uwp/composition/visual-layer-in-desktop-apps).</span><span class="sxs-lookup"><span data-stu-id="2fc9f-116">For more info, see [Modernize your desktop app using the Visual layer](/windows/uwp/composition/visual-layer-in-desktop-apps).</span></span>

<span data-ttu-id="2fc9f-117">Cette rubrique décrit les types de surfaces pris en charge par Microsoft DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-117">This topic describes the types of types of surfaces that Microsoft DirectComposition supports.</span></span>

-   [<span data-ttu-id="2fc9f-118">Surface logique DirectComposition</span><span class="sxs-lookup"><span data-stu-id="2fc9f-118">DirectComposition logical surface</span></span>](#directcomposition-logical-surface)
    -   [<span data-ttu-id="2fc9f-119">Mise à jour d’une surface logique</span><span class="sxs-lookup"><span data-stu-id="2fc9f-119">Updating a logical surface</span></span>](#updating-a-logical-surface)
    -   [<span data-ttu-id="2fc9f-120">Interruption des mises à jour d’une surface logique</span><span class="sxs-lookup"><span data-stu-id="2fc9f-120">Suspending updates to a logical surface</span></span>](#suspending-updates-to-a-logical-surface)
    -   [<span data-ttu-id="2fc9f-121">Reprise des mises à jour sur une surface logique</span><span class="sxs-lookup"><span data-stu-id="2fc9f-121">Resuming updates to a logical surface</span></span>](#resuming-updates-to-a-logical-surface)
    -   [<span data-ttu-id="2fc9f-122">Fin des mises à jour d’une surface logique</span><span class="sxs-lookup"><span data-stu-id="2fc9f-122">Ending updates to a logical surface</span></span>](#suspending-updates-to-a-logical-surface)
    -   [<span data-ttu-id="2fc9f-123">Exemple d’utilisation d’une surface logique</span><span class="sxs-lookup"><span data-stu-id="2fc9f-123">Example of using a logical surface</span></span>](#example-of-using-a-logical-surface)
-   [<span data-ttu-id="2fc9f-124">Surface virtuelle DirectComposition</span><span class="sxs-lookup"><span data-stu-id="2fc9f-124">DirectComposition virtual surface</span></span>](#directcomposition-virtual-surface)
    -   [<span data-ttu-id="2fc9f-125">Redimensionnement d’une surface virtuelle</span><span class="sxs-lookup"><span data-stu-id="2fc9f-125">Resizing a virtual surface</span></span>](#resizing-a-virtual-surface)
    -   [<span data-ttu-id="2fc9f-126">Découpage d’une surface virtuelle</span><span class="sxs-lookup"><span data-stu-id="2fc9f-126">Trimming a virtual surface</span></span>](#trimming-a-virtual-surface)
-   [<span data-ttu-id="2fc9f-127">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="2fc9f-127">Related topics</span></span>](#related-topics)

## <a name="directcomposition-logical-surface"></a><span data-ttu-id="2fc9f-128">Surface logique DirectComposition</span><span class="sxs-lookup"><span data-stu-id="2fc9f-128">DirectComposition logical surface</span></span>

<span data-ttu-id="2fc9f-129">DirectComposition expose l’objet [**IDCompositionSurface**](/windows/win32/api/dcomp/nn-dcomp-idcompositionsurface) pour représenter une surface de composition logique.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-129">DirectComposition exposes the [**IDCompositionSurface**](/windows/win32/api/dcomp/nn-dcomp-idcompositionsurface) object to represent a logical composition surface.</span></span> <span data-ttu-id="2fc9f-130">DirectComposition expose les API que vous pouvez utiliser pour créer, mettre à jour et supprimer ces surfaces logiques.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-130">DirectComposition exposes APIs that you can use to create, update, and delete these logical surfaces.</span></span> <span data-ttu-id="2fc9f-131">Chaque surface peut être associée à un ou plusieurs visuels.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-131">Each surface can be associated with one or more visuals.</span></span> <span data-ttu-id="2fc9f-132">Une application est responsable de la gestion de la durée de vie des surfaces logiques.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-132">An application is responsible for managing the lifetime of logical surfaces.</span></span>

### <a name="updating-a-logical-surface"></a><span data-ttu-id="2fc9f-133">Mise à jour d’une surface logique</span><span class="sxs-lookup"><span data-stu-id="2fc9f-133">Updating a logical surface</span></span>

<span data-ttu-id="2fc9f-134">Une application peut mettre à jour une surface logique en appelant [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) et en spécifiant la taille et le décalage du rectangle sur la surface logique que l’application veut mettre à jour.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-134">An application can update a logical surface by calling [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) and specifying the size and offset of the rectangle on the logical surface that the app wants to update.</span></span> <span data-ttu-id="2fc9f-135">DirectComposition alloue un rectangle de la taille spécifiée, puis retourne la surface et le décalage correspondant que l’application doit dessiner ou mettre à jour.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-135">DirectComposition allocates a rectangle of the specified size, and then returns the surface and the corresponding offset that the application needs to draw or update.</span></span> <span data-ttu-id="2fc9f-136">Les limites du rectangle de mise à jour sont liées par la taille de la surface.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-136">The update rectangle’s limits are bound by the surface size.</span></span> <span data-ttu-id="2fc9f-137">Par exemple, le rectangle de mise à jour d’une surface de pixels de 40 par 100 peut atteindre (0, 0, 40100).</span><span class="sxs-lookup"><span data-stu-id="2fc9f-137">For example, the update rectangle for a 40-by-100 pixel surface can be up to (0,0,40,100).</span></span> <span data-ttu-id="2fc9f-138">En outre, la région pouvant être mise à jour est appliquée par un rectangle de protection.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-138">Also, the updatable region is enforced by a guard rectangle.</span></span> <span data-ttu-id="2fc9f-139">Étant donné qu’il ne peut y avoir qu’un seul rectangle de protection à la fois, une seule surface logique peut être mise à jour à la fois.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-139">Because there can be only one guard rectangle at a time, only one logical surface can be updated at a time.</span></span> <span data-ttu-id="2fc9f-140">**BeginDraw** retourne un code d’erreur si [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) ou [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) n’a pas été appelé après un appel précédent à **BeginDraw**.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-140">**BeginDraw** returns an error code if [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) or [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) has not been called after a previous call to **BeginDraw**.</span></span> <span data-ttu-id="2fc9f-141">Une application peut ajouter un appel validé à **BeginDraw** à un lot, mais elle ne prend pas effet tant que **EndDraw** n’est pas appelé et validé.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-141">An application can add a committed call to **BeginDraw** to a batch, but it does not take effect until **EndDraw** is called and committed.</span></span>

### <a name="suspending-updates-to-a-logical-surface"></a><span data-ttu-id="2fc9f-142">Interruption des mises à jour d’une surface logique</span><span class="sxs-lookup"><span data-stu-id="2fc9f-142">Suspending updates to a logical surface</span></span>

<span data-ttu-id="2fc9f-143">Une application qui doit mettre à jour des surfaces différentes peut appeler [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) sur la mise à jour actuelle, puis appeler [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) pour commencer une nouvelle mise à jour.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-143">An application that needs to update different surfaces can call [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) on the current update, and then call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) to begin a new update.</span></span> <span data-ttu-id="2fc9f-144">Microsoft DirectComposition autorise plusieurs mises à jour, mais une seule peut être active à la fois.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-144">Microsoft DirectComposition allows multiple updates, but only one can be active at a time.</span></span> <span data-ttu-id="2fc9f-145">Cela signifie que vous devez appeler **SuspendDraw** ou [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) sur une surface avant d’appeler **BeginDraw** sur la suivante.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-145">This means that you need to call **SuspendDraw** or [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on one surface before calling **BeginDraw** on the next one.</span></span> <span data-ttu-id="2fc9f-146">Contrairement à **EndDraw**, un lot validé peut contenir une surface qui est dans un état **SuspendDraw** , mais ces mises à jour ne s’affichent pas à l’écran tant que **EndDraw** n’est pas appelé.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-146">Unlike **EndDraw**, a committed batch can contain a surface that is in a **SuspendDraw** state, but such updates won’t be shown on the screen until **EndDraw** is called.</span></span>

### <a name="resuming-updates-to-a-logical-surface"></a><span data-ttu-id="2fc9f-147">Reprise des mises à jour sur une surface logique</span><span class="sxs-lookup"><span data-stu-id="2fc9f-147">Resuming updates to a logical surface</span></span>

<span data-ttu-id="2fc9f-148">Une application peut reprendre une mise à jour d’une surface qui est dans un état [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) en appelant [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw).</span><span class="sxs-lookup"><span data-stu-id="2fc9f-148">An application can resume an update to a surface that is in a [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) state by calling [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw).</span></span> <span data-ttu-id="2fc9f-149">Cette méthode peut être appelée uniquement sur une surface suspendue.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-149">This method can be called only on a suspended surface.</span></span>

### <a name="ending-updates-to-a-logical-surface"></a><span data-ttu-id="2fc9f-150">Fin des mises à jour d’une surface logique</span><span class="sxs-lookup"><span data-stu-id="2fc9f-150">Ending updates to a logical surface</span></span>

<span data-ttu-id="2fc9f-151">L’appel de [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) et de [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) est le seul moyen d’afficher les modifications de mise à jour bitmap à l’écran.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-151">Calling [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) and [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) is the only way to see bitmap update changes on the screen.</span></span> <span data-ttu-id="2fc9f-152">Chaque appel à **EndDraw** doit avoir un appel correspondant à [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) pour supprimer le rectangle de garde.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-152">Each call to **EndDraw** must have a corresponding call to [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) to remove the guard rectangle.</span></span> <span data-ttu-id="2fc9f-153">La surface logique conserve toutes les mises à jour jusqu’à ce que la **validation** soit appelée.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-153">The logical surface retains all the updates until **Commit** is called.</span></span> <span data-ttu-id="2fc9f-154">Vous pouvez également appeler **EndDraw** sur une surface qui se trouve dans l’état [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) , car **EndDraw** est une reprise/fin implicite.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-154">You can also call **EndDraw** on a surface that is in the [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) state because **EndDraw** is an implied resume/end.</span></span> <span data-ttu-id="2fc9f-155">Une fois que vous avez appelé **EndDraw**, le contenu mis à jour est présenté à l’écran et ignoré afin que la mémoire pour la mise à jour puisse être réutilisée pour une mise à jour ultérieure.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-155">After you call **EndDraw**, the updated content is presented to the screen and discarded so that the memory for the update can be reused for a later update.</span></span>

### <a name="example-of-using-a-logical-surface"></a><span data-ttu-id="2fc9f-156">Exemple d’utilisation d’une surface logique</span><span class="sxs-lookup"><span data-stu-id="2fc9f-156">Example of using a logical surface</span></span>

<span data-ttu-id="2fc9f-157">L’exemple suivant décrit les étapes qu’une application doit suivre si elle a créé une arborescence d’éléments visuels composée de deux éléments visuels, puis si nécessaire pour mettre à jour des régions spécifiques des deux surfaces logiques associées aux visuels :</span><span class="sxs-lookup"><span data-stu-id="2fc9f-157">The following example describes the steps that an application would take if it created a visual tree consisting of two visuals, and then needed to update specific regions of the two logical surfaces associated with the visuals:</span></span>

1.  <span data-ttu-id="2fc9f-158">Créez un appareil DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-158">Create a DirectComposition device.</span></span>
2.  <span data-ttu-id="2fc9f-159">Créez l’arborescence d’éléments visuels composée d’un nœud racine et de visuels 1 et 2.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-159">Create the visual tree consisting of a root node and visuals 1 and 2.</span></span>
3.  <span data-ttu-id="2fc9f-160">Créez des surfaces logiques 1 et 2.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-160">Create logical surfaces 1 and 2.</span></span>
4.  <span data-ttu-id="2fc9f-161">Appelez [**SetContent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcontent) pour associer une surface logique aux éléments visuels 1 et 2.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-161">Call [**SetContent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcontent) to associate a logical surface with visuals 1 and 2.</span></span>
5.  <span data-ttu-id="2fc9f-162">Appelez [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) sur un sous-rectangle de la surface logique 1.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-162">Call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) on a sub-rectangle of logical surface 1.</span></span>
6.  <span data-ttu-id="2fc9f-163">Mettez à jour la surface au décalage retourné par DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-163">Update the surface at the offset returned by DirectComposition.</span></span>
7.  <span data-ttu-id="2fc9f-164">Étapes facultatives :</span><span class="sxs-lookup"><span data-stu-id="2fc9f-164">Optional steps:</span></span>
    1.  <span data-ttu-id="2fc9f-165">Appelez [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) sur la surface logique 1.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-165">Call [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) on logical surface 1.</span></span>
    2.  <span data-ttu-id="2fc9f-166">Appelez [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) sur le sous-rectangle de la surface logique 2.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-166">Call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) on sub-rect of logical surface 2.</span></span>
    3.  <span data-ttu-id="2fc9f-167">Mettez à jour la surface au décalage retourné par DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-167">Update the surface at the offset returned by DirectComposition.</span></span>
    4.  <span data-ttu-id="2fc9f-168">Appelez [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) sur la surface logique 2.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-168">Call [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on logical surface 2.</span></span>
    5.  <span data-ttu-id="2fc9f-169">Appelez [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) sur la surface logique 1.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-169">Call [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) on logical surface 1.</span></span>
8.  <span data-ttu-id="2fc9f-170">Mettez à jour la surface au décalage retourné par DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-170">Update the surface at the offset returned by DirectComposition.</span></span>
9.  <span data-ttu-id="2fc9f-171">Appelez [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) sur la surface logique 1.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-171">Call [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on logical surface 1.</span></span>
10. <span data-ttu-id="2fc9f-172">Appel de [**validation**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span><span class="sxs-lookup"><span data-stu-id="2fc9f-172">Call [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span></span>

## <a name="directcomposition-virtual-surface"></a><span data-ttu-id="2fc9f-173">Surface virtuelle DirectComposition</span><span class="sxs-lookup"><span data-stu-id="2fc9f-173">DirectComposition virtual surface</span></span>

<span data-ttu-id="2fc9f-174">DirectComposition expose l’interface [**IDCompositionVirtualSurface**](/windows/win32/api/dcomp/nn-dcomp-idcompositionvirtualsurface) pour représenter une surface virtuelle, qui est une collection de surfaces logiques (vignettes) organisées dans une grille fixe avec des vignettes d’une taille fixe.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-174">DirectComposition exposes the [**IDCompositionVirtualSurface**](/windows/win32/api/dcomp/nn-dcomp-idcompositionvirtualsurface) interface to represent a virtual surface, which is a collection of logical surfaces (tiles) arranged in a fixed grid with tiles of a fixed size.</span></span> <span data-ttu-id="2fc9f-175">L’application spécifie la taille de la texture virtuelle au moment de la création.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-175">The application specifies the size of the virtual texture at creation time.</span></span> <span data-ttu-id="2fc9f-176">La taille établit les limites de la surface virtuelle.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-176">The size establishes the boundaries for the virtual surface.</span></span> <span data-ttu-id="2fc9f-177">La surface peut être associée à un ou plusieurs visuels.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-177">The surface can be associated with one or more visuals.</span></span>

<span data-ttu-id="2fc9f-178">Lorsqu’une surface virtuelle est initialisée, elle n’est pas sauvegardée par des allocations réelles.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-178">When a virtual surface is initialized, it is not backed by actual allocations.</span></span> <span data-ttu-id="2fc9f-179">En d’autres termes, il ne contient aucun bit.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-179">In other words, it doesn’t hold any bits.</span></span> <span data-ttu-id="2fc9f-180">DirectComposition alloue des vignettes (autrement dit, des objets de surface de composition) après que l’application a démarré la mise à jour de l’aire.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-180">DirectComposition allocates tiles (that is, composition surface objects) after the application starts updating the surface.</span></span> <span data-ttu-id="2fc9f-181">L’application met à jour la surface virtuelle en appelant [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) et en spécifiant la zone d’intérêt en ce qui concerne les coordonnées de la surface virtuelle.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-181">The application updates the virtual surface by calling [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) and specifying the region of interest with respect to the coordinates of the virtual surface.</span></span> <span data-ttu-id="2fc9f-182">Ensuite, DirectComposition alloue les vignettes nécessaires pour contenir la mise à jour et retourne la surface et le décalage de la composition à mettre à jour.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-182">Then, DirectComposition allocates the necessary tiles to hold the update, and returns the composition surface and offset to update.</span></span>

<span data-ttu-id="2fc9f-183">Comme avec les surfaces logiques, vous pouvez appeler [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw), [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw), [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) et [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) sur une surface virtuelle.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-183">As with logical surfaces, you can call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw), [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw), [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) and [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on a virtual surface.</span></span> <span data-ttu-id="2fc9f-184">En outre, DirectComposition expose les méthodes que vous pouvez utiliser pour redimensionner et supprimer une surface virtuelle existante.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-184">In addition, DirectComposition exposes methods that you can use to resize and trim an existing virtual surface.</span></span>

### <a name="resizing-a-virtual-surface"></a><span data-ttu-id="2fc9f-185">Redimensionnement d’une surface virtuelle</span><span class="sxs-lookup"><span data-stu-id="2fc9f-185">Resizing a virtual surface</span></span>

<span data-ttu-id="2fc9f-186">La méthode [**Resize**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-resize) modifie les limites de la surface virtuelle, ce qui signifie que toutes les nouvelles mises à jour ou allocations doivent se situer dans les limites définies par la nouvelle taille.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-186">The [**Resize**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-resize) method changes the boundaries of the virtual surface, meaning that any new updates or allocations must fall in the boundaries set by the new size.</span></span> <span data-ttu-id="2fc9f-187">Une application utilise **redimensionnement** pour indiquer à DirectComposition qu’une région particulière de la surface virtuelle n’est plus nécessaire et peut être récupérée.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-187">An application uses **Resize** to tell DirectComposition that a particular region of the virtual surface is no longer needed and can be reclaimed.</span></span> <span data-ttu-id="2fc9f-188">Si le **redimensionnement** réduit la surface virtuelle, l’application ne peut plus mettre à jour les régions en dehors des nouvelles limites.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-188">If **Resize** shrinks the virtual surface, the application can no longer update the regions outside the new boundaries.</span></span>

<span data-ttu-id="2fc9f-189">L’illustration suivante montre une surface virtuelle 3 par 3 redimensionnée à 2 par 2.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-189">The following illustration shows a 3-by-3 virtual surface resized to 2-by-2.</span></span> <span data-ttu-id="2fc9f-190">La région rouge représente les vignettes qui sont ignorées dans le cadre de l’opération de redimensionnement, et la mémoire est récupérée par DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-190">The red region represents tiles that are discarded as part of the resize operation, and the memory is reclaimed by DirectComposition.</span></span> <span data-ttu-id="2fc9f-191">Après le redimensionnement, l’application ne peut pas mettre à jour la région rouge sans redimensionner à nouveau la surface virtuelle.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-191">After the resize, the application can't make updates to the red region without resizing the virtual surface again.</span></span>

![<span data-ttu-id="2fc9f-192">redimensionnement d’une surface virtuelle</span><span class="sxs-lookup"><span data-stu-id="2fc9f-192">resizing a virtual surface</span></span> ](images/resize-virtual-surface.png)

<span data-ttu-id="2fc9f-193">L’opération de redimensionnement prend effet immédiatement.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-193">The resize operation takes effect immediately.</span></span> <span data-ttu-id="2fc9f-194">DirectComposition n’attend pas que l’application appelle la [**validation**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) pour effectuer les mises à jour de redimensionnement.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-194">DirectComposition doesn't wait for the application to call [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) to make the resize updates.</span></span> <span data-ttu-id="2fc9f-195">Par exemple, supposons qu’une application effectue la séquence d’appels suivante.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-195">For example, suppose an application makes the following sequence of calls.</span></span>


```
pVirtualSurface->Resize(0, 0);
pVirtualSurface->Resize(INT_MAX, INT_MAX);
pDevice->Commit();
```



<span data-ttu-id="2fc9f-196">Dans cet exemple, l’application perd tout le contenu lors du premier redimensionnement.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-196">In this example, the application loses all content on the first resize.</span></span> <span data-ttu-id="2fc9f-197">Le deuxième redimensionnement n’a aucun effet bien qu’il ait été appelé avant la [**validation**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span><span class="sxs-lookup"><span data-stu-id="2fc9f-197">The second resize has no effect even though it was called before [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span></span> <span data-ttu-id="2fc9f-198">Dans ce cas, rien ne s’affiche à l’écran.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-198">In this case nothing shows on the screen.</span></span>

### <a name="trimming-a-virtual-surface"></a><span data-ttu-id="2fc9f-199">Découpage d’une surface virtuelle</span><span class="sxs-lookup"><span data-stu-id="2fc9f-199">Trimming a virtual surface</span></span>

<span data-ttu-id="2fc9f-200">La méthode [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) identifie la région de la surface virtuelle dont l’application a besoin.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-200">The [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) method identifies the region of the virtual surface that the application needs.</span></span> <span data-ttu-id="2fc9f-201">Elle ne redimensionne pas les limites de la surface virtuelle, mais elle indique à DirectComposition les surfaces logiques qui doivent être allouées.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-201">It doesn't resize the boundaries of the virtual surface, but it does tell DirectComposition which logical surfaces currently need to be allocated.</span></span>

<span data-ttu-id="2fc9f-202">Dans l’illustration suivante, le carré vert est la fenêtre d’affichage de l’application.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-202">In the following illustration, the green square is the application’s viewport.</span></span> <span data-ttu-id="2fc9f-203">L’application est initialement rendue aux six premières mosaïques (bleues) de la surface virtuelle (gris clair) qui se trouvent dans la fenêtre d’affichage.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-203">The application initially renders to the first six tiles (blue) of the virtual surface (light gray) that are in the viewport.</span></span> <span data-ttu-id="2fc9f-204">Comme la page qui est représentée par la surface virtuelle fait défiler, l’application doit afficher les six dernières vignettes.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-204">As the page that is represented by the virtual surface scrolls, the application needs to render the last six tiles.</span></span> <span data-ttu-id="2fc9f-205">L’application appelle [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) pour indiquer que la région définie par les six dernières vignettes correspond à l’emplacement du contenu et que le reste n’est pas nécessaire pour le moment.</span><span class="sxs-lookup"><span data-stu-id="2fc9f-205">The application calls [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) to indicate that the region defined by the last six tiles is where the content is, and the rest is not needed at the moment.</span></span> <span data-ttu-id="2fc9f-206">DirectComposition peut ensuite choisir de recycler les surfaces logiques qui représentaient à l’origine les six premières vignettes (gris foncé).</span><span class="sxs-lookup"><span data-stu-id="2fc9f-206">DirectComposition can then choose to recycle the logical surfaces that originally represented the first six tiles (dark gray).</span></span>

![découpage d’une surface virtuelle](images/trim-virtual-surface.png)

## <a name="related-topics"></a><span data-ttu-id="2fc9f-208">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="2fc9f-208">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2fc9f-209">Concepts DirectComposition</span><span class="sxs-lookup"><span data-stu-id="2fc9f-209">DirectComposition Concepts</span></span>](directcomposition-concepts.md)
</dt> </dl>

 

 