---
description: 'L’arrêt d’un processus a les résultats suivants : tous les threads restants dans le processus sont marqués pour l’arrêt. Toutes les ressources allouées par le processus sont libérées. Tous les objets de noyau sont fermés. Le code de processus est supprimé de la mémoire. Le code de sortie du processus est défini. L’objet processus est signalé.'
ms.assetid: af24d157-2719-4052-8029-1eb8010047cc
title: Arrêt d’un processus
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2010f1d4332a575c8ee94cf1b0f196e00ba7fb9f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106518470"
---
# <a name="terminating-a-process"></a><span data-ttu-id="f7b17-103">Arrêt d’un processus</span><span class="sxs-lookup"><span data-stu-id="f7b17-103">Terminating a Process</span></span>

<span data-ttu-id="f7b17-104">L’arrêt d’un processus a les résultats suivants :</span><span class="sxs-lookup"><span data-stu-id="f7b17-104">Terminating a process has the following results:</span></span>

-   <span data-ttu-id="f7b17-105">Les threads restants dans le processus sont marqués pour l’arrêt.</span><span class="sxs-lookup"><span data-stu-id="f7b17-105">Any remaining threads in the process are marked for termination.</span></span>
-   <span data-ttu-id="f7b17-106">Toutes les ressources allouées par le processus sont libérées.</span><span class="sxs-lookup"><span data-stu-id="f7b17-106">Any resources allocated by the process are freed.</span></span>
-   <span data-ttu-id="f7b17-107">Tous les objets de noyau sont fermés.</span><span class="sxs-lookup"><span data-stu-id="f7b17-107">All kernel objects are closed.</span></span>
-   <span data-ttu-id="f7b17-108">Le code de processus est supprimé de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="f7b17-108">The process code is removed from memory.</span></span>
-   <span data-ttu-id="f7b17-109">Le code de sortie du processus est défini.</span><span class="sxs-lookup"><span data-stu-id="f7b17-109">The process exit code is set.</span></span>
-   <span data-ttu-id="f7b17-110">L’objet processus est signalé.</span><span class="sxs-lookup"><span data-stu-id="f7b17-110">The process object is signaled.</span></span>

<span data-ttu-id="f7b17-111">Alors que les handles ouverts aux objets noyau sont fermés automatiquement lorsqu’un processus se termine, les objets eux-mêmes existent jusqu’à ce que tous les descripteurs ouverts soient fermés.</span><span class="sxs-lookup"><span data-stu-id="f7b17-111">While open handles to kernel objects are closed automatically when a process terminates, the objects themselves exist until all open handles to them are closed.</span></span> <span data-ttu-id="f7b17-112">Par conséquent, un objet reste valide après qu’un processus qui l’utilise se termine si un autre processus y a un handle ouvert.</span><span class="sxs-lookup"><span data-stu-id="f7b17-112">Therefore, an object will remain valid after a process that is using it terminates if another process has an open handle to it.</span></span>

<span data-ttu-id="f7b17-113">La fonction [**GetExitCodeProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodeprocess) retourne l’état d’arrêt d’un processus.</span><span class="sxs-lookup"><span data-stu-id="f7b17-113">The [**GetExitCodeProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodeprocess) function returns the termination status of a process.</span></span> <span data-ttu-id="f7b17-114">Lorsqu’un processus est en cours d’exécution, son état d’arrêt est toujours \_ actif.</span><span class="sxs-lookup"><span data-stu-id="f7b17-114">While a process is executing, its termination status is STILL\_ACTIVE.</span></span> <span data-ttu-id="f7b17-115">Lorsqu’un processus se termine, son état d’arrêt passe de toujours \_ actif au code de sortie du processus.</span><span class="sxs-lookup"><span data-stu-id="f7b17-115">When a process terminates, its termination status changes from STILL\_ACTIVE to the exit code of the process.</span></span>

<span data-ttu-id="f7b17-116">Lorsqu’un processus se termine, l’état de l’objet de processus devient signalé, libérant tous les threads en attente de l’arrêt du processus.</span><span class="sxs-lookup"><span data-stu-id="f7b17-116">When a process terminates, the state of the process object becomes signaled, releasing any threads that had been waiting for the process to terminate.</span></span> <span data-ttu-id="f7b17-117">Pour plus d’informations sur la synchronisation, consultez [synchronisation de plusieurs threads](synchronizing-execution-of-multiple-threads.md).</span><span class="sxs-lookup"><span data-stu-id="f7b17-117">For more about synchronization, see [Synchronizing Execution of Multiple Threads](synchronizing-execution-of-multiple-threads.md).</span></span>

<span data-ttu-id="f7b17-118">Lorsque le système met fin à un processus, il n’arrête pas les processus enfants que le processus a créés.</span><span class="sxs-lookup"><span data-stu-id="f7b17-118">When the system is terminating a process, it does not terminate any child processes that the process has created.</span></span> <span data-ttu-id="f7b17-119">L’arrêt d’un processus ne génère pas de notifications pour les \_ procédures de hook CBT.</span><span class="sxs-lookup"><span data-stu-id="f7b17-119">Terminating a process does not generate notifications for WH\_CBT hook procedures.</span></span>

<span data-ttu-id="f7b17-120">Utilisez la fonction [**SetProcessShutdownParameters**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessshutdownparameters) pour spécifier certains aspects de l’arrêt du processus lors de l’arrêt du système, par exemple lorsqu’un processus doit se terminer par rapport aux autres processus du système.</span><span class="sxs-lookup"><span data-stu-id="f7b17-120">Use the [**SetProcessShutdownParameters**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessshutdownparameters) function to specify certain aspects of the process termination at system shutdown, such as when a process should terminate relative to the other processes in the system.</span></span>

## <a name="how-processes-are-terminated"></a><span data-ttu-id="f7b17-121">Comment les processus sont terminés</span><span class="sxs-lookup"><span data-stu-id="f7b17-121">How Processes are Terminated</span></span>

<span data-ttu-id="f7b17-122">Un processus s’exécute jusqu’à ce que l’un des événements suivants se produise :</span><span class="sxs-lookup"><span data-stu-id="f7b17-122">A process executes until one of the following events occurs:</span></span>

-   <span data-ttu-id="f7b17-123">Tout thread du processus appelle la fonction [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) .</span><span class="sxs-lookup"><span data-stu-id="f7b17-123">Any thread of the process calls the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function.</span></span> <span data-ttu-id="f7b17-124">Notez qu’une implémentation de la bibliothèque Runtime C (CRT) appelle **ExitProcess** si le thread principal du processus retourne.</span><span class="sxs-lookup"><span data-stu-id="f7b17-124">Note that some implementation of the C run-time library (CRT) call **ExitProcess** if the primary thread of the process returns.</span></span>
-   <span data-ttu-id="f7b17-125">Le dernier thread du processus se termine.</span><span class="sxs-lookup"><span data-stu-id="f7b17-125">The last thread of the process terminates.</span></span>
-   <span data-ttu-id="f7b17-126">Tout thread appelle la fonction [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) avec un handle vers le processus.</span><span class="sxs-lookup"><span data-stu-id="f7b17-126">Any thread calls the [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) function with a handle to the process.</span></span>
-   <span data-ttu-id="f7b17-127">Pour les processus de console, le [Gestionnaire de contrôle de console](/windows/console/console-control-handlers) par défaut appelle [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) lorsque la console reçoit un signal CTRL + C ou CTRL + ATTN.</span><span class="sxs-lookup"><span data-stu-id="f7b17-127">For console processes, the default [console control handler](/windows/console/console-control-handlers) calls [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) when the console receives a CTRL+C or CTRL+BREAK signal.</span></span>
-   <span data-ttu-id="f7b17-128">L’utilisateur arrête le système ou se déconnecte.</span><span class="sxs-lookup"><span data-stu-id="f7b17-128">The user shuts down the system or logs off.</span></span>

<span data-ttu-id="f7b17-129">Ne terminez pas un processus, sauf si ses threads se trouvent dans des États connus.</span><span class="sxs-lookup"><span data-stu-id="f7b17-129">Do not terminate a process unless its threads are in known states.</span></span> <span data-ttu-id="f7b17-130">Si un thread attend un objet de noyau, il ne se termine pas tant que l’attente n’est pas terminée.</span><span class="sxs-lookup"><span data-stu-id="f7b17-130">If a thread is waiting on a kernel object, it will not be terminated until the wait has completed.</span></span> <span data-ttu-id="f7b17-131">Cela peut entraîner l’arrêt de la réponse de l’application.</span><span class="sxs-lookup"><span data-stu-id="f7b17-131">This can cause the application to stop responding.</span></span>

<span data-ttu-id="f7b17-132">Le thread principal peut éviter d’arrêter d’autres threads en les dirigeant à appeler [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) avant de provoquer l’arrêt du processus (pour plus d’informations, consultez [arrêt d’un thread](terminating-a-thread.md)).</span><span class="sxs-lookup"><span data-stu-id="f7b17-132">The primary thread can avoid terminating other threads by directing them to call [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) before causing the process to terminate (for more information, see [Terminating a Thread](terminating-a-thread.md)).</span></span> <span data-ttu-id="f7b17-133">Le thread principal peut toujours appeler [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) par la suite pour s’assurer que tous les threads sont terminés.</span><span class="sxs-lookup"><span data-stu-id="f7b17-133">The primary thread can still call [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) afterwards to ensure that all threads are terminated.</span></span>

<span data-ttu-id="f7b17-134">Le code de sortie d’un processus est soit la valeur spécifiée dans l’appel à [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) , soit [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), soit la valeur retournée par la fonction main ou [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) du processus.</span><span class="sxs-lookup"><span data-stu-id="f7b17-134">The exit code for a process is either the value specified in the call to [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) or [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), or the value returned by the main or [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) function of the process.</span></span> <span data-ttu-id="f7b17-135">Si un processus est arrêté en raison d’une exception irrécupérable, le code de sortie est la valeur de l’exception à l’origine de l’arrêt.</span><span class="sxs-lookup"><span data-stu-id="f7b17-135">If a process is terminated due to a fatal exception, the exit code is the value of the exception that caused the termination.</span></span> <span data-ttu-id="f7b17-136">En outre, cette valeur est utilisée comme code de sortie pour tous les threads qui étaient en cours d’exécution lorsque l’exception s’est produite.</span><span class="sxs-lookup"><span data-stu-id="f7b17-136">In addition, this value is used as the exit code for all the threads that were executing when the exception occurred.</span></span>

<span data-ttu-id="f7b17-137">Si un processus se termine par [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), le système appelle la fonction de point d’entrée de chaque dll attachée avec une valeur indiquant que le processus est détaché de la dll.</span><span class="sxs-lookup"><span data-stu-id="f7b17-137">If a process is terminated by [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), the system calls the entry-point function of each attached DLL with a value indicating that the process is detaching from the DLL.</span></span> <span data-ttu-id="f7b17-138">Les dll ne sont pas notifiées lorsqu’un processus est terminé par [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span><span class="sxs-lookup"><span data-stu-id="f7b17-138">DLLs are not notified when a process is terminated by [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span></span> <span data-ttu-id="f7b17-139">Pour plus d’informations sur les dll, consultez [bibliothèques de liens dynamiques](../dlls/dynamic-link-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="f7b17-139">For more information about DLLs, see [Dynamic-Link Libraries](../dlls/dynamic-link-libraries.md).</span></span>

<span data-ttu-id="f7b17-140">Si un processus se termine par [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), tous les threads du processus sont terminés immédiatement, sans possibilité d’exécuter du code supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="f7b17-140">If a process is terminated by [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), all threads of the process are terminated immediately with no chance to run additional code.</span></span> <span data-ttu-id="f7b17-141">Cela signifie que le thread n’exécute pas de code dans les blocs du gestionnaire de terminaisons.</span><span class="sxs-lookup"><span data-stu-id="f7b17-141">This means that the thread does not execute code in termination handler blocks.</span></span> <span data-ttu-id="f7b17-142">En outre, aucune dll attachée n’est notifiée que le processus est en cours de détachement.</span><span class="sxs-lookup"><span data-stu-id="f7b17-142">In addition, no attached DLLs are notified that the process is detaching.</span></span> <span data-ttu-id="f7b17-143">Si vous avez besoin d’un processus qui termine un autre processus, les étapes suivantes fournissent une meilleure solution :</span><span class="sxs-lookup"><span data-stu-id="f7b17-143">If you need to have one process terminate another process, the following steps provide a better solution:</span></span>

-   <span data-ttu-id="f7b17-144">Faire en sorte que les deux processus appellent la fonction [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) pour créer un message privé.</span><span class="sxs-lookup"><span data-stu-id="f7b17-144">Have both processes call the [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) function to create a private message.</span></span>
-   <span data-ttu-id="f7b17-145">Un processus peut mettre fin à l’autre processus en diffusant un message privé à l’aide de la fonction [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) , comme suit :</span><span class="sxs-lookup"><span data-stu-id="f7b17-145">One process can terminate the other process by broadcasting a private message using the [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) function as follows:</span></span>

    ``` syntax
     DWORD dwRecipients = BSM_APPLICATIONS;
        UINT uMessage = PM_MYMSG;
        WPARAM wParam = 0;
        LPARAM lParam = 0;

        BroadcastSystemMessage( 
            BSF_IGNORECURRENTTASK, // do not send message to this process
            &dwRecipients,         // broadcast only to applications
            uMessage,              // registered private message
            wParam,                // message-specific value
            lParam );              // message-specific value
    ```

-   <span data-ttu-id="f7b17-146">Le processus recevant le message privé appelle [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) pour terminer son exécution.</span><span class="sxs-lookup"><span data-stu-id="f7b17-146">The process receiving the private message calls [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) to terminate its execution.</span></span>

<span data-ttu-id="f7b17-147">L’exécution des fonctions [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)et [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) est sérialisée dans un espace d’adressage.</span><span class="sxs-lookup"><span data-stu-id="f7b17-147">The execution of the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread), and [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) functions is serialized within an address space.</span></span> <span data-ttu-id="f7b17-148">Les restrictions suivantes s’appliquent :</span><span class="sxs-lookup"><span data-stu-id="f7b17-148">The following restrictions apply:</span></span>

-   <span data-ttu-id="f7b17-149">Lors du démarrage du processus et des routines d’initialisation des DLL, de nouveaux threads peuvent être créés, mais ils ne commencent pas à s’exécuter tant que l’initialisation de la DLL n’est pas terminée pour le processus.</span><span class="sxs-lookup"><span data-stu-id="f7b17-149">During process startup and DLL initialization routines, new threads can be created, but they do not begin execution until DLL initialization is finished for the process.</span></span>
-   <span data-ttu-id="f7b17-150">Un seul thread à la fois peut être dans une routine d’initialisation ou de détachement de DLL.</span><span class="sxs-lookup"><span data-stu-id="f7b17-150">Only one thread at a time can be in a DLL initialization or detach routine.</span></span>
-   <span data-ttu-id="f7b17-151">La fonction [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) ne retourne pas jusqu’à ce qu’il n’y ait pas de threads dans leurs routines d’initialisation ou de détachement de dll.</span><span class="sxs-lookup"><span data-stu-id="f7b17-151">The [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function does not return until there are no threads are in their DLL initialization or detach routines.</span></span>

 

 
