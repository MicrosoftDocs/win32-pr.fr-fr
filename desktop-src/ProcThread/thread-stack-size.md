---
description: Chaque nouveau thread ou fibre reçoit son propre espace de pile constitué de la mémoire réservée et de la mémoire initialement validée.
ms.assetid: abb2d5c1-040b-4c36-aae5-3517b6a8c540
title: Taille de la pile des threads
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f4204e0bffa13fb43b6ea9520b60c0505372bad6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103952171"
---
# <a name="thread-stack-size"></a><span data-ttu-id="a4f97-103">Taille de la pile des threads</span><span class="sxs-lookup"><span data-stu-id="a4f97-103">Thread Stack Size</span></span>

<span data-ttu-id="a4f97-104">Chaque nouveau thread ou fibre reçoit son propre espace de pile constitué de la mémoire réservée et de la mémoire initialement validée.</span><span class="sxs-lookup"><span data-stu-id="a4f97-104">Each new thread or fiber receives its own stack space consisting of both reserved and initially committed memory.</span></span> <span data-ttu-id="a4f97-105">La taille de mémoire réservée représente le nombre total d’allocations de piles dans la mémoire virtuelle.</span><span class="sxs-lookup"><span data-stu-id="a4f97-105">The reserved memory size represents the total stack allocation in virtual memory.</span></span> <span data-ttu-id="a4f97-106">Par conséquent, la taille réservée est limitée à la plage d’adresses virtuelles.</span><span class="sxs-lookup"><span data-stu-id="a4f97-106">As such, the reserved size is limited to the virtual address range.</span></span> <span data-ttu-id="a4f97-107">Les pages initialement validées n’utilisent pas de mémoire physique tant qu’elles ne sont pas référencées ; Toutefois, ils suppriment les pages de la limite de validation totale du système, qui est la taille du fichier d’échange et la taille de la mémoire physique.</span><span class="sxs-lookup"><span data-stu-id="a4f97-107">The initially committed pages do not utilize physical memory until they are referenced; however, they do remove pages from the system total commit limit, which is the size of the page file plus the size of the physical memory.</span></span> <span data-ttu-id="a4f97-108">Le système valide les pages supplémentaires à partir de la mémoire réservée de la pile lorsqu’elles sont nécessaires, jusqu’à ce que la pile atteigne la taille réservée moins une page (qui est utilisée comme page de garde pour empêcher le dépassement de capacité de la pile) ou que le système manque de mémoire en cas d’échec de l’opération.</span><span class="sxs-lookup"><span data-stu-id="a4f97-108">The system commits additional pages from the reserved stack memory as they are needed, until either the stack reaches the reserved size minus one page (which is used as a guard page to prevent stack overflow) or the system is so low on memory that the operation fails.</span></span>

<span data-ttu-id="a4f97-109">Il est préférable de choisir une taille de pile aussi petite que possible et de valider la pile nécessaire au thread ou à la fibre pour s’exécuter de manière fiable.</span><span class="sxs-lookup"><span data-stu-id="a4f97-109">It is best to choose as small a stack size as possible and commit the stack that is needed for the thread or fiber to run reliably.</span></span> <span data-ttu-id="a4f97-110">Chaque page réservée pour la pile ne peut pas être utilisée à d’autres fins.</span><span class="sxs-lookup"><span data-stu-id="a4f97-110">Every page that is reserved for the stack cannot be used for any other purpose.</span></span>

<span data-ttu-id="a4f97-111">Une pile est libérée lorsque son thread se termine.</span><span class="sxs-lookup"><span data-stu-id="a4f97-111">A stack is freed when its thread exits.</span></span> <span data-ttu-id="a4f97-112">Elle n’est pas libérée si le thread est arrêté par un autre thread.</span><span class="sxs-lookup"><span data-stu-id="a4f97-112">It is not freed if the thread is terminated by another thread.</span></span>

<span data-ttu-id="a4f97-113">La taille par défaut de la mémoire de pile réservée et initialement validée est spécifiée dans l’en-tête du fichier exécutable.</span><span class="sxs-lookup"><span data-stu-id="a4f97-113">The default size for the reserved and initially committed stack memory is specified in the executable file header.</span></span> <span data-ttu-id="a4f97-114">La création d’un thread ou d’une fibre échoue s’il n’y a pas assez de mémoire pour réserver ou valider le nombre d’octets demandés.</span><span class="sxs-lookup"><span data-stu-id="a4f97-114">Thread or fiber creation fails if there is not enough memory to reserve or commit the number of bytes requested.</span></span> <span data-ttu-id="a4f97-115">La taille de réservation de pile par défaut utilisée par l’éditeur de liens est de 1 Mo.</span><span class="sxs-lookup"><span data-stu-id="a4f97-115">The default stack reservation size used by the linker is 1 MB.</span></span> <span data-ttu-id="a4f97-116">Pour spécifier une autre taille de réservation de pile par défaut pour tous les threads et les fibres, utilisez l’instruction STACKSIZE dans le fichier de définition de module (. def).</span><span class="sxs-lookup"><span data-stu-id="a4f97-116">To specify a different default stack reservation size for all threads and fibers, use the STACKSIZE statement in the module definition (.def) file.</span></span> <span data-ttu-id="a4f97-117">Le système d’exploitation arrondit la taille spécifiée au multiple le plus proche de la granularité d’allocation du système (en général 64 Ko).</span><span class="sxs-lookup"><span data-stu-id="a4f97-117">The operating system rounds up the specified size to the nearest multiple of the system's allocation granularity (typically 64 KB).</span></span> <span data-ttu-id="a4f97-118">Pour récupérer la granularité d’allocation du système actuel, utilisez la fonction [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) .</span><span class="sxs-lookup"><span data-stu-id="a4f97-118">To retrieve the allocation granularity of the current system, use the [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) function.</span></span>

<span data-ttu-id="a4f97-119">Pour modifier l’espace de pile initialement validé, utilisez le paramètre *dwStackSize* de la fonction [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)ou [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) .</span><span class="sxs-lookup"><span data-stu-id="a4f97-119">To change the initially committed stack space, use the *dwStackSize* parameter of the [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread), or [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) function.</span></span> <span data-ttu-id="a4f97-120">Cette valeur est arrondie à la page la plus proche.</span><span class="sxs-lookup"><span data-stu-id="a4f97-120">This value is rounded up to the nearest page.</span></span> <span data-ttu-id="a4f97-121">En règle générale, la taille de réserve correspond à la taille de réserve par défaut spécifiée dans l’en-tête de l’exécutable.</span><span class="sxs-lookup"><span data-stu-id="a4f97-121">Generally, the reserve size is the default reserve size specified in the executable header.</span></span> <span data-ttu-id="a4f97-122">Toutefois, si la taille initialement validée spécifiée par *dwStackSize* est supérieure ou égale à la taille de réserve par défaut, la taille de réserve est cette nouvelle taille de validation arrondie au multiple le plus proche de 1 Mo.</span><span class="sxs-lookup"><span data-stu-id="a4f97-122">However, if the initially committed size specified by *dwStackSize* is larger than or equal to the default reserve size, the reserve size is this new commit size rounded up to the nearest multiple of 1 MB.</span></span>

<span data-ttu-id="a4f97-123">Pour modifier la taille de pile réservée, définissez le paramètre *dwCreationFlags* de [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) ou [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) sur Stack \_ size \_ param \_ est \_ une \_ réservation et utilisez le paramètre *dwStackSize* .</span><span class="sxs-lookup"><span data-stu-id="a4f97-123">To change the reserved stack size, set the *dwCreationFlags* parameter of [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) or [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) to STACK\_SIZE\_PARAM\_IS\_A\_RESERVATION and use the *dwStackSize* parameter.</span></span> <span data-ttu-id="a4f97-124">Dans ce cas, la taille initialement validée est la taille par défaut spécifiée dans l’en-tête de l’exécutable.</span><span class="sxs-lookup"><span data-stu-id="a4f97-124">In this case, the initially committed size is the default size specified in the executable header.</span></span> <span data-ttu-id="a4f97-125">Pour les fibres, utilisez le paramètre *dwStackReserveSize* de [**CreateFiberEx**](/windows/desktop/api/WinBase/nf-winbase-createfiberex).</span><span class="sxs-lookup"><span data-stu-id="a4f97-125">For fibers, use the *dwStackReserveSize* parameter of [**CreateFiberEx**](/windows/desktop/api/WinBase/nf-winbase-createfiberex).</span></span> <span data-ttu-id="a4f97-126">La taille validée est spécifiée dans le paramètre *dwStackCommitSize* .</span><span class="sxs-lookup"><span data-stu-id="a4f97-126">The committed size is specified in the *dwStackCommitSize* parameter.</span></span>

<span data-ttu-id="a4f97-127">La fonction [**SetThreadStackGuarantee**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadstackguarantee) définit la taille minimale de la pile associée au thread appelant ou à la fibre qui sera disponible pendant les exceptions de dépassement de capacité de la pile.</span><span class="sxs-lookup"><span data-stu-id="a4f97-127">The [**SetThreadStackGuarantee**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadstackguarantee) function sets the minimum size of the stack associated with the calling thread or fiber that will be available during any stack overflow exceptions.</span></span>

 

 
