---
description: Une application peut utiliser des tâches imbriquées pour gérer des sous-ensembles de processus. Les travaux imbriqués activent également une application qui utilise des travaux pour héberger d’autres applications qui utilisent également des travaux.
ms.assetid: FA22493B-CD29-49A7-BDAC-349FA96B8C9E
title: Tâches imbriquées
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: abf105c70ec8e83b395fcce56c6274d4838358bc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104563628"
---
# <a name="nested-jobs"></a><span data-ttu-id="70855-104">Tâches imbriquées</span><span class="sxs-lookup"><span data-stu-id="70855-104">Nested Jobs</span></span>

<span data-ttu-id="70855-105">Une application peut utiliser des tâches imbriquées pour gérer des sous-ensembles de processus.</span><span class="sxs-lookup"><span data-stu-id="70855-105">An application can use nested jobs to manage subsets of processes.</span></span> <span data-ttu-id="70855-106">Les travaux imbriqués activent également une application qui utilise des travaux pour héberger d’autres applications qui utilisent également des travaux.</span><span class="sxs-lookup"><span data-stu-id="70855-106">Nested jobs also enable an application that uses jobs to host other applications that also use jobs.</span></span>

<span data-ttu-id="70855-107">**Windows 7, Windows server 2008 R2, Windows XP avec SP3, Windows server 2008, Windows Vista et Windows server 2003 :** Un processus ne peut être associé qu’à un seul travail.</span><span class="sxs-lookup"><span data-stu-id="70855-107">**Windows 7, Windows Server 2008 R2, Windows XP with SP3, Windows Server 2008, Windows Vista and Windows Server 2003:** A process can be associated with only a single job.</span></span> <span data-ttu-id="70855-108">Des tâches imbriquées ont été introduites dans Windows 8 et Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="70855-108">Nested jobs were introduced in Windows 8 and Windows Server 2012.</span></span>

<span data-ttu-id="70855-109">Cette rubrique fournit une vue d’ensemble de l’imbrication et du comportement des tâches imbriquées :</span><span class="sxs-lookup"><span data-stu-id="70855-109">This topic provides an overview of job nesting and behavior of nested jobs:</span></span>

-   [<span data-ttu-id="70855-110">Hiérarchies de tâches imbriquées</span><span class="sxs-lookup"><span data-stu-id="70855-110">Nested Job Hierarchies</span></span>](#nested-job-hierarchies)
-   [<span data-ttu-id="70855-111">Création d’une hiérarchie de travaux imbriqués</span><span class="sxs-lookup"><span data-stu-id="70855-111">Creating a Nested Job Hierarchy</span></span>](#creating-a-nested-job-hierarchy)
-   [<span data-ttu-id="70855-112">Limites du travail et notifications pour les travaux imbriqués</span><span class="sxs-lookup"><span data-stu-id="70855-112">Job Limits and Notifications for Nested Jobs</span></span>](#job-limits-and-notifications-for-nested-jobs)
-   [<span data-ttu-id="70855-113">Comptabilisation des ressources pour les travaux imbriqués</span><span class="sxs-lookup"><span data-stu-id="70855-113">Resource Accounting for Nested Jobs</span></span>](#resource-accounting-for-nested-jobs)
-   [<span data-ttu-id="70855-114">Fin des tâches imbriquées</span><span class="sxs-lookup"><span data-stu-id="70855-114">Termination of Nested Jobs</span></span>](#termination-of-nested-jobs)

<span data-ttu-id="70855-115">Pour obtenir des informations générales sur les travaux et les objets de travail, consultez [objets de traitement](job-objects.md).</span><span class="sxs-lookup"><span data-stu-id="70855-115">For general information about jobs and job objects, see [Job Objects](job-objects.md).</span></span>

## <a name="nested-job-hierarchies"></a><span data-ttu-id="70855-116">Hiérarchies de tâches imbriquées</span><span class="sxs-lookup"><span data-stu-id="70855-116">Nested Job Hierarchies</span></span>

<span data-ttu-id="70855-117">Les travaux imbriqués ont une relation parent-enfant dans laquelle chaque travail enfant contient un sous-ensemble des processus dans son travail parent.</span><span class="sxs-lookup"><span data-stu-id="70855-117">Nested jobs have a parent-child relationship in which each child job contains a subset of the processes in its parent job.</span></span> <span data-ttu-id="70855-118">Si un processus qui est déjà dans un travail est ajouté à un autre travail, les travaux sont imbriqués par défaut si le système peut former une hiérarchie de travaux valide et que ni le travail ne définit des limites d’interface utilisateur ([**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) avec **JobObjectBasicUIRestrictions**).</span><span class="sxs-lookup"><span data-stu-id="70855-118">If a process that is already in a job is added to another job, the jobs are nested by default if the system can form a valid job hierarchy and neither job sets UI limits ([**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) with **JobObjectBasicUIRestrictions**).</span></span>

<span data-ttu-id="70855-119">La figure 1 montre une hiérarchie de travaux qui contient une arborescence de processus étiquetés P0 à P7.</span><span class="sxs-lookup"><span data-stu-id="70855-119">Figure 1 shows a job hierarchy that contains a tree of processes labeled P0 through P7.</span></span> <span data-ttu-id="70855-120">Le travail 1 est le *travail parent* du travail 2 et du travail 4, et il s’agit d’un *ancêtre* du travail 3.</span><span class="sxs-lookup"><span data-stu-id="70855-120">Job 1 is the *parent job* of Job 2 and Job 4, and it is an *ancestor* of Job 3.</span></span> <span data-ttu-id="70855-121">Le travail 2 est le *parent immédiat* du travail 3 ; Le travail 3 est l' *enfant immédiat* du travail 2.</span><span class="sxs-lookup"><span data-stu-id="70855-121">Job 2 is the *immediate parent* of Job 3; Job 3 is the *immediate child* of Job 2.</span></span> <span data-ttu-id="70855-122">Les travaux 1, 2 et 3 forment une *chaîne de travail* dans laquelle les travaux 1 et 2 sont la *chaîne de travail parent* du travail 3.</span><span class="sxs-lookup"><span data-stu-id="70855-122">Jobs 1, 2, and 3 form a *job chain* in which Jobs 1 and 2 are the *parent job chain* of Job 3.</span></span> <span data-ttu-id="70855-123">La tâche de fin dans une chaîne de travaux est le *travail immédiat* des processus de cette tâche.</span><span class="sxs-lookup"><span data-stu-id="70855-123">The end job in a job chain is the *immediate job* of the processes in that job.</span></span> <span data-ttu-id="70855-124">Dans la figure 1, le travail 3 est le travail immédiat des processus P2, P3 et P4.</span><span class="sxs-lookup"><span data-stu-id="70855-124">In Figure 1, Job 3 is the immediate job of processes P2, P3, and P4.</span></span>

![Figure 1.](images/nested-jobs-a.png)

<span data-ttu-id="70855-127">Les tâches imbriquées peuvent également être utilisées pour gérer des groupes de processus homologues.</span><span class="sxs-lookup"><span data-stu-id="70855-127">Nested jobs can also be used to manage groups of peer processes.</span></span> <span data-ttu-id="70855-128">Dans la hiérarchie des travaux illustrée à la figure 2, le travail 1 est le travail parent du travail 2.</span><span class="sxs-lookup"><span data-stu-id="70855-128">In the job hierarchy shown in Figure 2, Job 1 is the parent job of Job 2.</span></span> <span data-ttu-id="70855-129">Notez qu’une hiérarchie de travaux ne peut contenir qu’une partie d’une arborescence de processus.</span><span class="sxs-lookup"><span data-stu-id="70855-129">Note that a job hierarchy might contain only part of a process tree.</span></span> <span data-ttu-id="70855-130">Dans la figure 2, P0 n’est pas dans la hiérarchie, mais ses processus enfants P1 à P5 sont.</span><span class="sxs-lookup"><span data-stu-id="70855-130">In Figure 2, P0 is not in the hierarchy, but its child processes P1 through P5 are.</span></span>

![Figure 2.](images/nested-jobs-b.png)

## <a name="creating-a-nested-job-hierarchy"></a><span data-ttu-id="70855-133">Création d’une hiérarchie de travaux imbriqués</span><span class="sxs-lookup"><span data-stu-id="70855-133">Creating a Nested Job Hierarchy</span></span>

<span data-ttu-id="70855-134">Les processus d’une hiérarchie de travaux sont soit explicitement associés à un objet de traitement à l’aide de la fonction [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) , soit implicitement associé pendant la création du processus, comme pour les travaux autonomes.</span><span class="sxs-lookup"><span data-stu-id="70855-134">Processes in a job hierarchy are either explicitly associated with a job object using the [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) function or implicitly associated during process creation, same as for standalone jobs.</span></span> <span data-ttu-id="70855-135">L’ordre dans lequel les travaux sont créés et les processus attribués détermine si une hiérarchie peut être créée.</span><span class="sxs-lookup"><span data-stu-id="70855-135">The order in which jobs are created and processes are assigned determines whether a hierarchy can be created.</span></span>

<span data-ttu-id="70855-136">Pour créer une hiérarchie de travaux à l’aide de l’Association explicite, tous les objets de tâche doivent être créés à l’aide de [**CreateJobObject**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta), puis [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) doit être appelé plusieurs fois pour chaque processus afin d’associer le processus à chaque travail auquel il doit appartenir.</span><span class="sxs-lookup"><span data-stu-id="70855-136">To build a job hierarchy using explicit association, all job objects must be created using [**CreateJobObject**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta), then [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) must be called multiple times for each process to associate the process with each job it should belong to.</span></span> <span data-ttu-id="70855-137">Pour vous assurer que la hiérarchie des travaux est valide, attribuez tout d’abord tous les processus à la tâche à la racine de la hiérarchie, puis affectez un sous-ensemble de processus à l’objet de tâche enfant immédiat, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="70855-137">To ensure that the job hierarchy is valid, first assign all processes to the job at the root of the hierarchy, then assign a subset of processes to the immediate child job object, and so on.</span></span> <span data-ttu-id="70855-138">Si des processus sont affectés à des travaux dans cet ordre, un travail enfant aura toujours un sous-ensemble de processus dans son travail parent lors de la création de la hiérarchie, ce qui est nécessaire pour l’imbrication.</span><span class="sxs-lookup"><span data-stu-id="70855-138">If processes are assigned to jobs in this order, a child job will always have a subset of processes in its parent job while the hierarchy is being created, which is required for nesting.</span></span> <span data-ttu-id="70855-139">Si des processus sont affectés à des travaux dans un ordre aléatoire, à un moment donné, un travail enfant aura des processus qui ne se trouvent pas dans son travail parent.</span><span class="sxs-lookup"><span data-stu-id="70855-139">If processes are assigned to jobs in random order, at some point a child job will have processes that are not in its parent job.</span></span> <span data-ttu-id="70855-140">Cela n’est pas autorisé par l’imbrication et entraîne l’échec de **AssignProcessToJobObject** .</span><span class="sxs-lookup"><span data-stu-id="70855-140">This is not allowed by nesting and it will cause **AssignProcessToJobObject** to fail.</span></span>

<span data-ttu-id="70855-141">Lorsque des processus sont implicitement associés à un travail lors de la création du processus, un processus enfant est associé à chaque travail dans la chaîne de travail de son processus parent.</span><span class="sxs-lookup"><span data-stu-id="70855-141">When processes are implicitly associated with a job during process creation, a child process is associated with every job in the job chain of its parent process.</span></span> <span data-ttu-id="70855-142">Si l’objet de travail immédiat autorise la dissociation, le processus enfant s’interrompt de l’objet de traitement immédiat et de chaque travail dans la chaîne de travail parente, en se déplaçant vers le haut de la hiérarchie jusqu’à ce qu’il atteigne un travail qui n’autorise pas la dissociation.</span><span class="sxs-lookup"><span data-stu-id="70855-142">If the immediate job object allows breakaway, the child process breaks away from the immediate job object and from each job in the parent job chain, moving up the hierarchy until it reaches a job that does not permit breakaway.</span></span> <span data-ttu-id="70855-143">Si l’objet de traitement immédiat n’autorise pas la dissociation, le processus enfant n’est pas supprimé même si les travaux dans sa chaîne de travail parent l’autorisent.</span><span class="sxs-lookup"><span data-stu-id="70855-143">If the immediate job object does not allow breakaway, the child process does not break away even if jobs in its parent job chain allow it.</span></span>

## <a name="job-limits-and-notifications-for-nested-jobs"></a><span data-ttu-id="70855-144">Limites du travail et notifications pour les travaux imbriqués</span><span class="sxs-lookup"><span data-stu-id="70855-144">Job Limits and Notifications for Nested Jobs</span></span>

<span data-ttu-id="70855-145">Pour certaines limites de ressources, la limite définie pour les travaux dans une chaîne de travail parente détermine la *limite effective* appliquée pour un travail enfant.</span><span class="sxs-lookup"><span data-stu-id="70855-145">For certain resource limits, the limit set for jobs in a parent job chain determine the *effective limit* that is enforced for a child job.</span></span> <span data-ttu-id="70855-146">La limite effective du travail enfant peut être plus restrictive que la limite de son parent, mais il ne peut pas être moins restrictif.</span><span class="sxs-lookup"><span data-stu-id="70855-146">The effective limit for child job can be more restrictive than the limit of its parent, but it cannot be less restrictive.</span></span> <span data-ttu-id="70855-147">Par exemple, si la classe de priorité d’un travail enfant est supérieure à la classe de \_ \_ priorité normale et que la classe \_ de priorité de sa tâche parente est la classe de priorité normale \_ \_ , la limite effective des processus dans le travail enfant est la \_ classe de priorité normale \_ .</span><span class="sxs-lookup"><span data-stu-id="70855-147">For example, if a child job's priority class is ABOVE\_NORMAL\_PRIORITY\_CLASS and its parent job's priority class is NORMAL\_PRIORITY\_CLASS, the effective limit for processes in the child job is NORMAL\_PRIORITY\_CLASS.</span></span> <span data-ttu-id="70855-148">Toutefois, si la classe de priorité du travail enfant est inférieure à la \_ \_ classe de priorité normale \_ , la limite effective des processus dans le travail enfant est inférieure à la \_ classe de priorité normale \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="70855-148">However, if the child job's priority class is BELOW\_NORMAL\_PRIORITY\_CLASS, the effective limit for processes in the child job is BELOW\_NORMAL\_PRIORITY\_CLASS.</span></span> <span data-ttu-id="70855-149">Les limites effectives sont appliquées pour la classe de priorité, l’affinité, les frais de validation, la limite de durée d’exécution par processus, la limite de classe de planification et la plage de travail minimale et maximale.</span><span class="sxs-lookup"><span data-stu-id="70855-149">Effective limits are enforced for priority class, affinity, commit charge, per-process execution time limit, scheduling class limit, and working set minimum and maximum.</span></span> <span data-ttu-id="70855-150">Pour plus d’informations sur les limites de ressources spécifiques, consultez [ **SetInformationJobObject.**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject)</span><span class="sxs-lookup"><span data-stu-id="70855-150">For more information about specific resource limits, see [**SetInformationJobObject.**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject)</span></span>

<span data-ttu-id="70855-151">Lorsque certains événements se produisent, tels que la création d’un nouveau processus ou la violation de limite des ressources, un message est envoyé au port de terminaison d’e/s associé à un travail.</span><span class="sxs-lookup"><span data-stu-id="70855-151">When certain events occur, such as new process creation or resource limit violation, a message is sent to the I/O completion port associated with a job.</span></span> <span data-ttu-id="70855-152">Un travail peut également s’inscrire pour recevoir des notifications lorsque certaines limites sont dépassées.</span><span class="sxs-lookup"><span data-stu-id="70855-152">A job can also register to receive notifications when certain limits are exceeded.</span></span> <span data-ttu-id="70855-153">Pour un travail non imbriqué, le message est envoyé au port de terminaison d’e/s associé au travail.</span><span class="sxs-lookup"><span data-stu-id="70855-153">For a non-nested job, the message is sent to the I/O completion port associated with the job.</span></span> <span data-ttu-id="70855-154">Pour un travail imbriqué, le message est envoyé à chaque port de terminaison d’e/s associé à n’importe quel travail dans la chaîne de travail parent du travail qui a déclenché le message.</span><span class="sxs-lookup"><span data-stu-id="70855-154">For a nested job, the message is sent to every I/O completion port associated with any job in the parent job chain of the job that triggered the message.</span></span> <span data-ttu-id="70855-155">Un travail enfant n’a pas besoin d’un port de terminaison d’e/s associé pour les messages qu’il déclenche à envoyer aux ports de terminaison d’e/s des tâches parentes plus haut dans la chaîne de travaux.</span><span class="sxs-lookup"><span data-stu-id="70855-155">A child job does not need to have an associated I/O completion port for messages it triggers to be sent to the I/O completion ports of parent jobs higher in the job chain.</span></span> <span data-ttu-id="70855-156">Pour plus d’informations sur les messages spécifiques, consultez [**JOBOBJECT \_ Associate \_ Complete \_ port**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port).</span><span class="sxs-lookup"><span data-stu-id="70855-156">For more information about specific messages, see [**JOBOBJECT\_ASSOCIATE\_COMPLETION\_PORT**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port).</span></span>

## <a name="resource-accounting-for-nested-jobs"></a><span data-ttu-id="70855-157">Comptabilisation des ressources pour les travaux imbriqués</span><span class="sxs-lookup"><span data-stu-id="70855-157">Resource Accounting for Nested Jobs</span></span>

<span data-ttu-id="70855-158">Les informations de gestion des ressources pour un travail imbriqué décrivent l’utilisation de chaque processus associé à ce travail, y compris les processus des tâches enfants.</span><span class="sxs-lookup"><span data-stu-id="70855-158">Resource accounting information for a nested job describes the usage of every process associated with that job, including processes in child jobs.</span></span> <span data-ttu-id="70855-159">Chaque travail d’une chaîne de travail représente par conséquent les ressources agrégées utilisées par ses propres processus et les processus de chaque travail enfant situé au-dessous de lui dans la chaîne de travaux.</span><span class="sxs-lookup"><span data-stu-id="70855-159">Each job in a job chain therefore represents the aggregated resources used by its own processes and the processes of every child job below it in the job chain.</span></span>

## <a name="termination-of-nested-jobs"></a><span data-ttu-id="70855-160">Fin des tâches imbriquées</span><span class="sxs-lookup"><span data-stu-id="70855-160">Termination of Nested Jobs</span></span>

<span data-ttu-id="70855-161">Lorsqu’un travail dans une hiérarchie de travaux est terminé, le système arrête les processus de ce travail et de tous ses travaux enfants, en commençant par le travail enfant en bas de la hiérarchie.</span><span class="sxs-lookup"><span data-stu-id="70855-161">When a job in a job hierarchy is terminated, the system terminates processes in that job and all of its child jobs, starting with the child job at the bottom of the hierarchy.</span></span> <span data-ttu-id="70855-162">Les ressources en suspens utilisées par chaque processus terminé sont facturées au travail parent.</span><span class="sxs-lookup"><span data-stu-id="70855-162">Outstanding resources used by each terminated process are charged to the parent job.</span></span>

<span data-ttu-id="70855-163">Le descripteur de travail doit avoir le \_ \_ droit d’accès arrêter l’objet de travail, comme pour les travaux autonomes.</span><span class="sxs-lookup"><span data-stu-id="70855-163">The job handle must have the JOB\_OBJECT\_TERMINATE access right, same as for standalone jobs.</span></span>

 

 
