---
description: Un processus enfant peut hériter de plusieurs propriétés et ressources de son processus parent.
ms.assetid: c530e723-2d40-4022-a259-dfc650604e44
title: Héritage (processus et threads)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4713fe398360b510fab3c66f5cf74dc07b642dac
ms.sourcegitcommit: 3d718d8f69d3f86eaecf94c5705d761c5a9ef4a1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/20/2020
ms.locfileid: "106513563"
---
# <a name="inheritance"></a><span data-ttu-id="95ab2-103">Héritage</span><span class="sxs-lookup"><span data-stu-id="95ab2-103">Inheritance</span></span>

<span data-ttu-id="95ab2-104">Un processus enfant peut hériter de plusieurs propriétés et ressources de son processus parent.</span><span class="sxs-lookup"><span data-stu-id="95ab2-104">A child process can inherit several properties and resources from its parent process.</span></span> <span data-ttu-id="95ab2-105">Vous pouvez également empêcher un processus enfant d’hériter des propriétés de son processus parent.</span><span class="sxs-lookup"><span data-stu-id="95ab2-105">You can also prevent a child process from inheriting properties from its parent process.</span></span> <span data-ttu-id="95ab2-106">Les éléments suivants peuvent être hérités :</span><span class="sxs-lookup"><span data-stu-id="95ab2-106">The following can be inherited:</span></span>

-   <span data-ttu-id="95ab2-107">Handles ouverts retournés par la fonction [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="95ab2-107">Open handles returned by the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="95ab2-108">Cela comprend les descripteurs des fichiers, les mémoires tampons d’entrée de la console, les mémoires tampons d’écran de la console, les canaux nommés, les périphériques de communication série et les mailslots.</span><span class="sxs-lookup"><span data-stu-id="95ab2-108">This includes handles to files, console input buffers, console screen buffers, named pipes, serial communication devices, and mailslots.</span></span>
-   <span data-ttu-id="95ab2-109">Handles ouverts pour traiter, thread, mutex, événement, sémaphore, canal nommé, canal anonyme et objets de mappage de fichiers.</span><span class="sxs-lookup"><span data-stu-id="95ab2-109">Open handles to process, thread, mutex, event, semaphore, named-pipe, anonymous-pipe, and file-mapping objects.</span></span> <span data-ttu-id="95ab2-110">Celles-ci sont retournées par les fonctions [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateMutex**](/windows/desktop/api/synchapi/nf-synchapi-createmutexa), [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), [**CreateSemaphore,**](/windows/desktop/api/winbase/nf-winbase-createsemaphorea), [**CreateNamedPipe**](/windows/desktop/api/winbase/nf-winbase-createnamedpipea), [**CreatePipe**](/windows/desktop/api/namedpipeapi/nf-namedpipeapi-createpipe)et [**CreateFileMapping**](/windows/desktop/api/winbase/nf-winbase-createfilemappinga) , respectivement.</span><span class="sxs-lookup"><span data-stu-id="95ab2-110">These are returned by the [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateMutex**](/windows/desktop/api/synchapi/nf-synchapi-createmutexa), [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), [**CreateSemaphore**](/windows/desktop/api/winbase/nf-winbase-createsemaphorea), [**CreateNamedPipe**](/windows/desktop/api/winbase/nf-winbase-createnamedpipea), [**CreatePipe**](/windows/desktop/api/namedpipeapi/nf-namedpipeapi-createpipe), and [**CreateFileMapping**](/windows/desktop/api/winbase/nf-winbase-createfilemappinga) functions, respectively.</span></span>
-   <span data-ttu-id="95ab2-111">Variables d'environnement.</span><span class="sxs-lookup"><span data-stu-id="95ab2-111">Environment variables.</span></span>
-   <span data-ttu-id="95ab2-112">Le répertoire actif.</span><span class="sxs-lookup"><span data-stu-id="95ab2-112">The current directory.</span></span>
-   <span data-ttu-id="95ab2-113">La console, sauf si le processus est détaché ou si une nouvelle console est créée.</span><span class="sxs-lookup"><span data-stu-id="95ab2-113">The console, unless the process is detached or a new console is created.</span></span> <span data-ttu-id="95ab2-114">Un processus de console enfant peut également hériter des handles standard du parent, ainsi qu’un accès à la mémoire tampon d’entrée et à la mémoire tampon d’écran active.</span><span class="sxs-lookup"><span data-stu-id="95ab2-114">A child console process can also inherit the parent's standard handles, as well as access to the input buffer and the active screen buffer.</span></span>
-   <span data-ttu-id="95ab2-115">Le mode d’erreur, tel que défini par la fonction [**SetErrorMode**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-seterrormode) .</span><span class="sxs-lookup"><span data-stu-id="95ab2-115">The error mode, as set by the [**SetErrorMode**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-seterrormode) function.</span></span>
-   <span data-ttu-id="95ab2-116">Masque d’affinité du processeur.</span><span class="sxs-lookup"><span data-stu-id="95ab2-116">The processor affinity mask.</span></span>
-   <span data-ttu-id="95ab2-117">Association avec un travail.</span><span class="sxs-lookup"><span data-stu-id="95ab2-117">The association with a job.</span></span>

<span data-ttu-id="95ab2-118">Le processus enfant n’hérite pas des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="95ab2-118">The child process does not inherit the following:</span></span>

-   <span data-ttu-id="95ab2-119">Classe de priorité.</span><span class="sxs-lookup"><span data-stu-id="95ab2-119">Priority class.</span></span>
-   <span data-ttu-id="95ab2-120">Handles retournés par [**LocalAlloc**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**HeapCreate**](/windows/desktop/api/heapapi/nf-heapapi-heapcreate)et [**HeapAlloc**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc).</span><span class="sxs-lookup"><span data-stu-id="95ab2-120">Handles returned by [**LocalAlloc**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**HeapCreate**](/windows/desktop/api/heapapi/nf-heapapi-heapcreate), and [**HeapAlloc**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc).</span></span>
-   <span data-ttu-id="95ab2-121">Les Pseudo-Handles, comme dans les descripteurs retournés par la fonction [**GetCurrentProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentprocess) ou [**GetCurrentThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthread) .</span><span class="sxs-lookup"><span data-stu-id="95ab2-121">Pseudo handles, as in the handles returned by the [**GetCurrentProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentprocess) or [**GetCurrentThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthread) function.</span></span> <span data-ttu-id="95ab2-122">Ces handles ne sont valides que pour le processus appelant.</span><span class="sxs-lookup"><span data-stu-id="95ab2-122">These handles are valid only for the calling process.</span></span>
-   <span data-ttu-id="95ab2-123">Descripteurs de module DLL retournés par la fonction [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) .</span><span class="sxs-lookup"><span data-stu-id="95ab2-123">DLL module handles returned by the [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) function.</span></span>
-   <span data-ttu-id="95ab2-124">Des handles GDI ou utilisateur, tels que **HBITMAP** ou **HMENU**.</span><span class="sxs-lookup"><span data-stu-id="95ab2-124">GDI or USER handles, such as **HBITMAP** or **HMENU**.</span></span>

## <a name="inheriting-handles"></a><span data-ttu-id="95ab2-125">Hériter des handles</span><span class="sxs-lookup"><span data-stu-id="95ab2-125">Inheriting Handles</span></span>

<span data-ttu-id="95ab2-126">Un processus enfant peut hériter de certains des handles de son parent, mais ne pas en hériter d’autres.</span><span class="sxs-lookup"><span data-stu-id="95ab2-126">A child process can inherit some of its parent's handles, but not inherit others.</span></span> <span data-ttu-id="95ab2-127">Pour faire en sorte qu’un handle soit hérité, vous devez effectuer deux opérations :</span><span class="sxs-lookup"><span data-stu-id="95ab2-127">To cause a handle to be inherited, you must do two things:</span></span>

-   <span data-ttu-id="95ab2-128">Spécifie que le handle doit être hérité lorsque vous créez, ouvrez ou dupliquez le handle.</span><span class="sxs-lookup"><span data-stu-id="95ab2-128">Specify that the handle is to be inherited when you create, open, or duplicate the handle.</span></span> <span data-ttu-id="95ab2-129">Les fonctions de création utilisent généralement le membre **bInheritHandle** d’une structure d' [**\_ attributs de sécurité**](/previous-versions/windows/desktop/legacy/aa379560(v=vs.85)) à cet effet.</span><span class="sxs-lookup"><span data-stu-id="95ab2-129">Creation functions typically use the **bInheritHandle** member of a [**SECURITY\_ATTRIBUTES**](/previous-versions/windows/desktop/legacy/aa379560(v=vs.85)) structure for this purpose.</span></span> <span data-ttu-id="95ab2-130">[**DuplicateHandle**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) utilise le paramètre *bInheritHandles* .</span><span class="sxs-lookup"><span data-stu-id="95ab2-130">[**DuplicateHandle**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) uses the *bInheritHandles* parameter.</span></span>
-   <span data-ttu-id="95ab2-131">Spécifiez que les handles pouvant être hérités doivent être hérités en définissant le paramètre *bInheritHandles* sur true lors de l’appel de la fonction [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) .</span><span class="sxs-lookup"><span data-stu-id="95ab2-131">Specify that inheritable handles are to be inherited by setting the *bInheritHandles* parameter to TRUE when calling the [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) function.</span></span> <span data-ttu-id="95ab2-132">En outre, pour hériter des handles d’entrée standard, de sortie standard et d’erreur standard, le membre **dwFlags** de la structure [**STARTUPINFO**](/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa) doit inclure STARTF \_ USESTDHANDLES.</span><span class="sxs-lookup"><span data-stu-id="95ab2-132">Additionally, to inherit the standard input, standard output, and standard error handles, the **dwFlags** member of the [**STARTUPINFO**](/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa) structure must include STARTF\_USESTDHANDLES.</span></span>

<span data-ttu-id="95ab2-133">Pour spécifier une liste des descripteurs qui doivent être hérités par un processus enfant spécifique, appelez la fonction [**UpdateProcThreadAttribute**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute) avec l’indicateur *PROC_THREAD_ATTRIBUTE_HANDLE_LIST* .</span><span class="sxs-lookup"><span data-stu-id="95ab2-133">To specify a list of the handles that should be inherited by a specific child process, call the [**UpdateProcThreadAttribute**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute) function with the *PROC_THREAD_ATTRIBUTE_HANDLE_LIST* flag.</span></span>

<span data-ttu-id="95ab2-134">Un handle hérité fait référence au même objet dans le processus enfant que dans le processus parent.</span><span class="sxs-lookup"><span data-stu-id="95ab2-134">An inherited handle refers to the same object in the child process as it does in the parent process.</span></span> <span data-ttu-id="95ab2-135">Elle a également la même valeur et les mêmes privilèges d’accès.</span><span class="sxs-lookup"><span data-stu-id="95ab2-135">It also has the same value and access privileges.</span></span> <span data-ttu-id="95ab2-136">Par conséquent, lorsqu’un processus modifie l’état de l’objet, la modification affecte les deux processus.</span><span class="sxs-lookup"><span data-stu-id="95ab2-136">Therefore, when one process changes the state of the object, the change affects both processes.</span></span> <span data-ttu-id="95ab2-137">Pour utiliser un handle, le processus enfant doit récupérer la valeur du handle et « connaître » l’objet auquel il fait référence.</span><span class="sxs-lookup"><span data-stu-id="95ab2-137">To use a handle, the child process must retrieve the handle value and "know" the object to which it refers.</span></span> <span data-ttu-id="95ab2-138">En règle générale, le processus parent communique ces informations au processus enfant par le biais de sa ligne de commande, d’un bloc d’environnement ou d’une certaine forme de [communication entre processus](/windows/desktop/ipc/interprocess-communications).</span><span class="sxs-lookup"><span data-stu-id="95ab2-138">Usually, the parent process communicates this information to the child process through its command line, environment block, or some form of [interprocess communication](/windows/desktop/ipc/interprocess-communications).</span></span>

<span data-ttu-id="95ab2-139">Utilisez la fonction [**SetHandleInformation**](/windows/win32/api/handleapi/nf-handleapi-sethandleinformation) pour contrôler si un handle existant peut ou non être hérité.</span><span class="sxs-lookup"><span data-stu-id="95ab2-139">Use the [**SetHandleInformation**](/windows/win32/api/handleapi/nf-handleapi-sethandleinformation) function to control if an existing handle is inheritable or not.</span></span>

## <a name="inheriting-environment-variables"></a><span data-ttu-id="95ab2-140">Héritage de variables d’environnement</span><span class="sxs-lookup"><span data-stu-id="95ab2-140">Inheriting Environment Variables</span></span>

<span data-ttu-id="95ab2-141">Par défaut, un processus enfant hérite des variables d’environnement de son processus parent.</span><span class="sxs-lookup"><span data-stu-id="95ab2-141">A child process inherits the environment variables of its parent process by default.</span></span> <span data-ttu-id="95ab2-142">Toutefois, [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) permet au processus parent de spécifier un autre bloc de variables d’environnement.</span><span class="sxs-lookup"><span data-stu-id="95ab2-142">However, [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) enables the parent process to specify a different block of environment variables.</span></span> <span data-ttu-id="95ab2-143">Pour plus d’informations, consultez [variables d’environnement](environment-variables.md).</span><span class="sxs-lookup"><span data-stu-id="95ab2-143">For more information, see [Environment Variables](environment-variables.md).</span></span>

## <a name="inheriting-the-current-directory"></a><span data-ttu-id="95ab2-144">Héritage du répertoire actif</span><span class="sxs-lookup"><span data-stu-id="95ab2-144">Inheriting the Current Directory</span></span>

<span data-ttu-id="95ab2-145">La fonction [**GetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory) récupère le répertoire actif du processus appelant.</span><span class="sxs-lookup"><span data-stu-id="95ab2-145">The [**GetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory) function retrieves the current directory of the calling process.</span></span> <span data-ttu-id="95ab2-146">Par défaut, un processus enfant hérite le répertoire actuel de son processus parent.</span><span class="sxs-lookup"><span data-stu-id="95ab2-146">A child process inherits the current directory of its parent process by default.</span></span> <span data-ttu-id="95ab2-147">Toutefois, [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) permet au processus parent de spécifier un répertoire actif différent pour le processus enfant.</span><span class="sxs-lookup"><span data-stu-id="95ab2-147">However, [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) enables the parent process to specify a different current directory for the child process.</span></span> <span data-ttu-id="95ab2-148">Pour modifier le répertoire actif du processus appelant, utilisez la fonction [**SetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory) .</span><span class="sxs-lookup"><span data-stu-id="95ab2-148">To change the current directory of the calling process, use the [**SetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory) function.</span></span>
