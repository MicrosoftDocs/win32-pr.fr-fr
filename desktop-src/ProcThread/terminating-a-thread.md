---
description: 'L’arrêt d’un thread a les résultats suivants : toutes les ressources détenues par le thread, telles que les fenêtres et les raccordements, sont libérées. Le code de sortie du thread est défini. L’objet thread est signalé. Si le thread est le seul thread actif dans le processus, le processus est arrêté. Pour plus d’informations, consultez arrêt d’un processus.'
ms.assetid: 633e5d0c-e9d8-4f9a-9411-17cbe9e2e6e4
title: Arrêt d’un thread
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ada421356666316072aabff8281787cc140ad114
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106518250"
---
# <a name="terminating-a-thread"></a><span data-ttu-id="3ba1f-104">Arrêt d’un thread</span><span class="sxs-lookup"><span data-stu-id="3ba1f-104">Terminating a Thread</span></span>

<span data-ttu-id="3ba1f-105">L’arrêt d’un thread a les résultats suivants :</span><span class="sxs-lookup"><span data-stu-id="3ba1f-105">Terminating a thread has the following results:</span></span>

-   <span data-ttu-id="3ba1f-106">Toutes les ressources détenues par le thread, telles que les fenêtres et les raccordements, sont libérées.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-106">Any resources owned by the thread, such as windows and hooks, are freed.</span></span>
-   <span data-ttu-id="3ba1f-107">Le code de sortie du thread est défini.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-107">The thread exit code is set.</span></span>
-   <span data-ttu-id="3ba1f-108">L’objet thread est signalé.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-108">The thread object is signaled.</span></span>
-   <span data-ttu-id="3ba1f-109">Si le thread est le seul thread actif dans le processus, le processus est arrêté.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-109">If the thread is the only active thread in the process, the process is terminated.</span></span> <span data-ttu-id="3ba1f-110">Pour plus d’informations, consultez [arrêt d’un processus](terminating-a-process.md).</span><span class="sxs-lookup"><span data-stu-id="3ba1f-110">For more information, see [Terminating a Process](terminating-a-process.md).</span></span>

<span data-ttu-id="3ba1f-111">La fonction [**GetExitCodeThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodethread) retourne l’état d’arrêt d’un thread.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-111">The [**GetExitCodeThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodethread) function returns the termination status of a thread.</span></span> <span data-ttu-id="3ba1f-112">Pendant l’exécution d’un thread, son état d’arrêt est toujours \_ actif.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-112">While a thread is executing, its termination status is STILL\_ACTIVE.</span></span> <span data-ttu-id="3ba1f-113">Lorsqu’un thread se termine, son état d’arrêt passe de toujours \_ actif au code de sortie du thread.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-113">When a thread terminates, its termination status changes from STILL\_ACTIVE to the exit code of the thread.</span></span>

<span data-ttu-id="3ba1f-114">Lorsqu’un thread se termine, l’état de l’objet thread devient signalé, libérant tout autre thread en attente de l’arrêt du thread.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-114">When a thread terminates, the state of the thread object changes to signaled, releasing any other threads that had been waiting for the thread to terminate.</span></span> <span data-ttu-id="3ba1f-115">Pour plus d’informations sur la synchronisation, consultez [synchronisation de plusieurs threads](synchronizing-execution-of-multiple-threads.md).</span><span class="sxs-lookup"><span data-stu-id="3ba1f-115">For more about synchronization, see [Synchronizing Execution of Multiple Threads](synchronizing-execution-of-multiple-threads.md).</span></span>

<span data-ttu-id="3ba1f-116">Lorsqu’un thread se termine, son objet thread n’est pas libéré tant que tous les descripteurs ouverts du thread ne sont pas fermés.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-116">When a thread terminates, its thread object is not freed until all open handles to the thread are closed.</span></span>

## <a name="how-threads-are-terminated"></a><span data-ttu-id="3ba1f-117">Arrêt des threads</span><span class="sxs-lookup"><span data-stu-id="3ba1f-117">How Threads are Terminated</span></span>

<span data-ttu-id="3ba1f-118">Un thread s’exécute jusqu’à ce que l’un des événements suivants se produise :</span><span class="sxs-lookup"><span data-stu-id="3ba1f-118">A thread executes until one of the following events occurs:</span></span>

-   <span data-ttu-id="3ba1f-119">Le thread appelle la fonction [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) .</span><span class="sxs-lookup"><span data-stu-id="3ba1f-119">The thread calls the [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) function.</span></span>
-   <span data-ttu-id="3ba1f-120">Tout thread du processus appelle la fonction [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) .</span><span class="sxs-lookup"><span data-stu-id="3ba1f-120">Any thread of the process calls the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function.</span></span>
-   <span data-ttu-id="3ba1f-121">La fonction de thread retourne.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-121">The thread function returns.</span></span>
-   <span data-ttu-id="3ba1f-122">Tout thread appelle la fonction [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) avec un handle vers le thread.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-122">Any thread calls the [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) function with a handle to the thread.</span></span>
-   <span data-ttu-id="3ba1f-123">Tout thread appelle la fonction [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) avec un handle vers le processus.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-123">Any thread calls the [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) function with a handle to the process.</span></span>

<span data-ttu-id="3ba1f-124">Le code de sortie d’un thread est soit la valeur spécifiée dans l’appel à [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread), soit [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), soit la valeur retournée par la fonction de thread.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-124">The exit code for a thread is either the value specified in the call to [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread), or [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), or the value returned by the thread function.</span></span>

<span data-ttu-id="3ba1f-125">Si un thread se termine par [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), le système appelle la fonction de point d’entrée de chaque dll attachée avec une valeur indiquant que le thread se détache de la dll (sauf si vous appelez la fonction [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) ).</span><span class="sxs-lookup"><span data-stu-id="3ba1f-125">If a thread is terminated by [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), the system calls the entry-point function of each attached DLL with a value indicating that the thread is detaching from the DLL (unless you call the [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) function).</span></span> <span data-ttu-id="3ba1f-126">Si un thread se termine par [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), les fonctions de point d’entrée dll sont appelées une fois pour indiquer que le processus est en cours de détachement.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-126">If a thread is terminated by [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), the DLL entry-point functions are invoked once, to indicate that the process is detaching.</span></span> <span data-ttu-id="3ba1f-127">Les dll ne sont pas notifiées lorsqu’un thread se termine par [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) ou [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span><span class="sxs-lookup"><span data-stu-id="3ba1f-127">DLLs are not notified when a thread is terminated by [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) or [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span></span> <span data-ttu-id="3ba1f-128">Pour plus d’informations sur les dll, consultez [bibliothèques de liens dynamiques](../dlls/dynamic-link-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="3ba1f-128">For more information about DLLs, see [Dynamic-Link Libraries](../dlls/dynamic-link-libraries.md).</span></span>

<span data-ttu-id="3ba1f-129">Les fonctions [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) et [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) doivent être utilisées uniquement dans des circonstances extrêmes, dans la mesure où elles n’autorisent pas le nettoyage des threads, ne notifient pas les dll attachées et ne libèrent pas la pile initiale.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-129">The [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) and [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) functions should be used only in extreme circumstances, since they do not allow threads to clean up, do not notify attached DLLs, and do not free the initial stack.</span></span> <span data-ttu-id="3ba1f-130">En outre, les handles des objets détenus par le thread ne sont pas fermés tant que le processus n’est pas terminé.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-130">In addition, handles to objects owned by the thread are not closed until the process terminates.</span></span> <span data-ttu-id="3ba1f-131">Les étapes suivantes fournissent une meilleure solution :</span><span class="sxs-lookup"><span data-stu-id="3ba1f-131">The following steps provide a better solution:</span></span>

-   <span data-ttu-id="3ba1f-132">Créez un objet d’événement à l’aide de la fonction [**CreateEvent**](/windows/win32/api/synchapi/nf-synchapi-createeventa) .</span><span class="sxs-lookup"><span data-stu-id="3ba1f-132">Create an event object using the [**CreateEvent**](/windows/win32/api/synchapi/nf-synchapi-createeventa) function.</span></span>
-   <span data-ttu-id="3ba1f-133">Créez les threads.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-133">Create the threads.</span></span>
-   <span data-ttu-id="3ba1f-134">Chaque thread surveille l’état de l’événement en appelant la fonction [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) .</span><span class="sxs-lookup"><span data-stu-id="3ba1f-134">Each thread monitors the event state by calling the [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) function.</span></span> <span data-ttu-id="3ba1f-135">Utilisez un intervalle de délai d’attente de zéro.</span><span class="sxs-lookup"><span data-stu-id="3ba1f-135">Use a wait time-out interval of zero.</span></span>
-   <span data-ttu-id="3ba1f-136">Chaque thread met fin à sa propre exécution lorsque l’événement est défini sur l’état signalé ([**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) retourne l' \_ objet wait \_ 0).</span><span class="sxs-lookup"><span data-stu-id="3ba1f-136">Each thread terminates its own execution when the event is set to the signaled state ([**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) returns WAIT\_OBJECT\_0).</span></span>

 

 
