---
title: Comptes de service et BITS
description: Vous pouvez utiliser BITS pour transférer des fichiers à partir d’un service. Le service doit utiliser le compte système LocalSystem, LocalService ou NetworkService. Ces comptes sont toujours connectés ; par conséquent, les travaux soumis par un service à l’aide de ces comptes s’exécutent toujours.
ms.assetid: 43fb58d6-3a99-488f-ab43-dbb4a794fc2f
keywords:
- BITS de comptes de service
- transférer les BITS du travail, la propriété, le compte de service
- BITS de proxy, comptes de service
- informations d’identification pour transférer les BITS de travail
ms.topic: article
ms.date: 10/04/2018
ms.openlocfilehash: 475a623e6b105d3ef2bdc6586db613c010fe8923
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104101808"
---
# <a name="service-accounts-and-bits"></a><span data-ttu-id="bf7a4-109">Comptes de service et BITS</span><span class="sxs-lookup"><span data-stu-id="bf7a4-109">Service Accounts and BITS</span></span>

<span data-ttu-id="bf7a4-110">Vous pouvez utiliser BITS pour transférer des fichiers à partir d’un service.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-110">You can use BITS to transfer files from a service.</span></span> <span data-ttu-id="bf7a4-111">Le service doit utiliser le compte système LocalSystem, LocalService ou NetworkService.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-111">The service must use the LocalSystem, LocalService, or NetworkService system account.</span></span> <span data-ttu-id="bf7a4-112">Ces comptes sont toujours connectés ; par conséquent, les travaux soumis par un service à l’aide de ces comptes s’exécutent toujours.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-112">These accounts are always logged on; therefore, jobs submitted by a service using these accounts always run.</span></span>

<span data-ttu-id="bf7a4-113">Si un service s’exécutant sous un compte système emprunte l’identité de l’utilisateur avant d’appeler BITS, le service BITS répond comme pour n’importe quel compte d’utilisateur (par exemple, l’utilisateur doit être connecté à l’ordinateur pour que le transfert se produise).</span><span class="sxs-lookup"><span data-stu-id="bf7a4-113">If a service running under a system account impersonates the user before calling BITS, BITS responds as it would for any user account (for example, the user needs to be logged on to the computer for the transfer to occur).</span></span> <span data-ttu-id="bf7a4-114">Le service doit également utiliser le masquage dynamique avec les pointeurs d’interface BITS lors de l’emprunt de l’identité de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-114">The service should also use dynamic cloaking with the BITS interface pointers when impersonating the user.</span></span> <span data-ttu-id="bf7a4-115">Le masquage n’étant pas hérité, vous devez appeler la fonction [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) sur chaque pointeur d’interface que vous recevez de bits (par exemple, le pointeur de travail retourné par l’appel de la méthode [**IBackgroundCopyManager :: createJob**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopymanager-createjob) ); Il n’est pas suffisant de définir le masquage sur le pointeur d’interface du gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-115">Cloaking is not inherited, therefore you must call the [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) function on each interface pointer that you receive from BITS (for example, the job pointer returned from calling the [**IBackgroundCopyManager::CreateJob**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopymanager-createjob) method); it is not enough to set cloaking on the manager interface pointer.</span></span> <span data-ttu-id="bf7a4-116">Vous pouvez également appeler la fonction [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) pour le processus au lieu d’appeler la fonction **CoSetProxyBlanket** sur chaque pointeur d’interface.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-116">You can also call the [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) function for the process instead of calling the **CoSetProxyBlanket** function on each interface pointer.</span></span>

<span data-ttu-id="bf7a4-117">Toutefois, si le service n’emprunte pas l’identité de l’utilisateur, les comportements suivants s’appliquent :</span><span class="sxs-lookup"><span data-stu-id="bf7a4-117">However, if the service does not impersonate the user, the following behaviors apply:</span></span>

- <span data-ttu-id="bf7a4-118">Les travaux créés par le compte de service sont détenus par ce compte.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-118">Jobs created by the service account are owned by that account.</span></span> <span data-ttu-id="bf7a4-119">Étant donné que les comptes système sont toujours connectés, BITS transfère les fichiers tant que l’ordinateur est en cours d’exécution et qu’il existe une connexion réseau.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-119">Because system accounts are always logged on, BITS transfers the files as long as the computer is running and there is a network connection.</span></span>
- <span data-ttu-id="bf7a4-120">Les comptes système ne doivent pas utiliser de lettres de lecteurs réseau mappés, car les lettres de lecteur sont spécifiques à une session et le mappage peut être perdu après le redémarrage de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-120">System accounts should not use mapped network drive letters because the drive letters are specific to a session and the mapping may be lost after a computer restart.</span></span>
- <span data-ttu-id="bf7a4-121">En l’absence d’un [jeton d’assistance](helper-tokens-for-bits-transfer-jobs.md), l’authentification réseau utilise les informations d’identification de l’ordinateur pour les comptes LocalSystem et NetworkService et les informations d’identification anonymes pour le compte LocalService.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-121">In the absence of a [Helper Token](helper-tokens-for-bits-transfer-jobs.md), network authentication uses computer credentials for LocalSystem and NetworkService accounts and anonymous credentials for the LocalService account.</span></span> <span data-ttu-id="bf7a4-122">BITS retourne « accès refusé » si la liste de contrôle d’accès (ACL) pour le fichier source limite l’accès à un compte d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-122">BITS returns "access denied" if the access control list (ACL) for the source file limits access to a user account.</span></span>
- <span data-ttu-id="bf7a4-123">Pour plus d’informations sur le fonctionnement de l’authentification en présence d’un [jeton d’assistance](helper-tokens-for-bits-transfer-jobs.md), consultez [authentification](authentication.md).</span><span class="sxs-lookup"><span data-stu-id="bf7a4-123">For details on how authentication works in the presence of a [Helper Token](helper-tokens-for-bits-transfer-jobs.md), see [Authentication](authentication.md).</span></span>
- <span data-ttu-id="bf7a4-124">Les paramètres de proxy de Microsoft Internet Explorer sont stockés par utilisateur et ne sont pas définis pour les comptes système.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-124">Microsoft Internet Explorer proxy settings are stored per-user and are not set for system accounts.</span></span> <span data-ttu-id="bf7a4-125">Envisagez de configurer un jeton d’assistance sur vos travaux BITS ou de définir explicitement les paramètres de proxy appropriés en appelant [**méthode ibackgroundcopyjob :: setproxysettings n'**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) with **BG \_ Job \_ proxy \_ usage \_ override**.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-125">Consider configuring a helper token on your BITS jobs, or explicitly setting the correct proxy settings by calling [**IBackgroundCopyJob::SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) with **BG\_JOB\_PROXY\_USAGE\_OVERRIDE**.</span></span> <span data-ttu-id="bf7a4-126">Vous pouvez également utiliser les commutateurs **/util/SetIEProxy** de BitsAdmin.exe pour définir les paramètres de proxy d’Internet Explorer pour le compte système LocalSystem, LocalService ou NetworkService.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-126">Alternatively, you can use the **/Util /SetIEProxy** switches of BitsAdmin.exe to set Internet Explorer proxy settings for the LocalSystem, LocalService, or NetworkService system account.</span></span> <span data-ttu-id="bf7a4-127">Pour plus d’informations, consultez [BitsAdmin Tool](bitsadmin-tool.md).</span><span class="sxs-lookup"><span data-stu-id="bf7a4-127">For details, see [BitsAdmin Tool](bitsadmin-tool.md).</span></span>

<span data-ttu-id="bf7a4-128">Notez que le service BITS ne reconnaît pas les paramètres de proxy qui sont définis à l’aide du fichier Proxycfg.exe.</span><span class="sxs-lookup"><span data-stu-id="bf7a4-128">Note that BITS does not recognize the proxy settings that are set using the Proxycfg.exe file.</span></span>