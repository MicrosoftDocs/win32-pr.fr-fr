---
title: Principaux problèmes pour les titres Windows
description: Cet article présente un grand nombre des problèmes courants que nous avons rencontrés dans les jeux de PC actuels.
ms.assetid: 89b83473-1aa9-9a2d-8778-15cfb91cdea4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 547c977f7d8e4895ef73ba229a9012854a7c6d27
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "106509867"
---
# <a name="top-issues-for-windows-titles"></a><span data-ttu-id="6f8c3-103">Principaux problèmes pour les titres Windows</span><span class="sxs-lookup"><span data-stu-id="6f8c3-103">Top Issues for Windows Titles</span></span>

<span data-ttu-id="6f8c3-104">Le groupe Microsoft Windows Gaming and Graphics Developers Group relations effectue une analyse des performances pour de nombreux jeux Windows chaque année.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-104">The Microsoft Windows Gaming and Graphics Technologies Developer Relations group performs performance analysis for many Windows games each year.</span></span> <span data-ttu-id="6f8c3-105">Pendant ces sessions, nous obtenons une expérience pratique pour associer les commentaires des développeurs et les requêtes que nous recevons quotidiennement.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-105">During these sessions, we get hands-on experience to tie into the developer feedback and queries we receive daily.</span></span> <span data-ttu-id="6f8c3-106">Parfois, nous pouvons vous aider à identifier un incident mystérieux ou tout autre problème dans un titre, ce qui nous permet d’approfondir vos connaissances sur les problèmes que les développeurs rencontrent.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-106">Occasionally we help track down a mysterious crash or other problem in a title, which gives us further insight into problems that developers are encountering.</span></span>

<span data-ttu-id="6f8c3-107">Cet article présente un grand nombre des problèmes courants que nous avons rencontrés dans les jeux de PC actuels.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-107">This article highlights many of the common issues we've seen in current-generation PC games.</span></span>

-   [<span data-ttu-id="6f8c3-108">Performances limitées du processeur</span><span class="sxs-lookup"><span data-stu-id="6f8c3-108">CPU-Limited Performance</span></span>](#cpu-limited-performance)
-   [<span data-ttu-id="6f8c3-109">Gestion des lots médiocre</span><span class="sxs-lookup"><span data-stu-id="6f8c3-109">Poor Batch Management</span></span>](#poor-batch-management)
-   [<span data-ttu-id="6f8c3-110">Copie excessive de la mémoire</span><span class="sxs-lookup"><span data-stu-id="6f8c3-110">Excessive Memory Copying</span></span>](#excessive-memory-copying)
-   [<span data-ttu-id="6f8c3-111">Utilisation excessive de l’envoi de dessin dynamique</span><span class="sxs-lookup"><span data-stu-id="6f8c3-111">Excessive Use of Dynamic Draw Submission</span></span>](#excessive-use-of-dynamic-draw-submission)
-   [<span data-ttu-id="6f8c3-112">Surcharge élevée dans le traitement des fichiers</span><span class="sxs-lookup"><span data-stu-id="6f8c3-112">High Overhead in File Processing</span></span>](#high-overhead-in-file-processing)
-   [<span data-ttu-id="6f8c3-113">Installation lente et frustrante</span><span class="sxs-lookup"><span data-stu-id="6f8c3-113">Slow and Frustrating Installation</span></span>](#slow-and-frustrating-installation)
-   [<span data-ttu-id="6f8c3-114">Manque de considérations sur la mémoire physique</span><span class="sxs-lookup"><span data-stu-id="6f8c3-114">Lack of Consideration of Physical Memory</span></span>](#lack-of-consideration-of-physical-memory)
-   [<span data-ttu-id="6f8c3-115">Dépendance excessive sur Real-Time conversion du taux d’échantillonnage audio</span><span class="sxs-lookup"><span data-stu-id="6f8c3-115">Over-Reliance on Real-Time Audio Sample Rate Conversion</span></span>](#over-reliance-on-real-time-audio-sample-rate-conversion)
-   [<span data-ttu-id="6f8c3-116">Fragmentation de la mémoire virtuelle</span><span class="sxs-lookup"><span data-stu-id="6f8c3-116">Fragmention of Virtual Memory</span></span>](#fragmention-of-virtual-memory)
-   [<span data-ttu-id="6f8c3-117">Manipulation du mot de contrôle Floating-Point</span><span class="sxs-lookup"><span data-stu-id="6f8c3-117">Manipulation of the Floating-Point Control Word</span></span>](#manipulation-of-the-floating-point-control-word)
-   [<span data-ttu-id="6f8c3-118">Installation facultative du runtime DirectX</span><span class="sxs-lookup"><span data-stu-id="6f8c3-118">Optional Installation of the DirectX Runtime</span></span>](#optional-installation-of-the-directx-runtime)
-   [<span data-ttu-id="6f8c3-119">Utilisation excessive de la synchronisation des threads</span><span class="sxs-lookup"><span data-stu-id="6f8c3-119">Excessive Use of Thread Synchronization</span></span>](#excessive-use-of-thread-synchronization)
-   [<span data-ttu-id="6f8c3-120">Utilisation de RDTSC</span><span class="sxs-lookup"><span data-stu-id="6f8c3-120">Use of RDTSC</span></span>](#use-of-rdtsc)

## <a name="cpu-limited-performance"></a><span data-ttu-id="6f8c3-121">Performances de CPU-Limited</span><span class="sxs-lookup"><span data-stu-id="6f8c3-121">CPU-Limited Performance</span></span>

<span data-ttu-id="6f8c3-122">La grande majorité des jeux est limitée par les performances de l’UC sur les systèmes dotés d’unités de traitement graphique (GPU) hautes performances.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-122">The vast majority of games are limited by CPU performance on systems with high-performance graphics processing units (GPUs).</span></span> <span data-ttu-id="6f8c3-123">Cela est parfois dû à une mauvaise utilisation du traitement par lot pour les envois de tirage, mais plus généralement, cela est dû au fait que d’autres systèmes de jeux consomment une grande partie des cycles d’UC disponibles.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-123">This is sometimes due to poor use of batching for draw submissions, but more typically, this is due to other game systems consuming a large portion of the available CPU cycles.</span></span> <span data-ttu-id="6f8c3-124">Dans les rares cas où nous avons vu la limitation du GPU, la cause est un taux de remplissage très élevé ou une demande de nuanceur de pixels, des paramètres haute résolution ou des performances de nuanceur de sommets réduites par une carte vidéo.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-124">In the few cases in which we have seen the GPU as the limitation, the cause is very high fill rates or pixel shader demand, in high-resolution settings, or low vertex-shader performance by a video card.</span></span>

<span data-ttu-id="6f8c3-125">Étant donné que la plupart des titres sont limités au processeur, les performances les plus importantes gagnent de l’optimisation des systèmes de jeux gourmands en ressources processeur.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-125">Because most titles are CPU-limited, the biggest performance wins come from optimizing CPU-intensive game systems.</span></span> <span data-ttu-id="6f8c3-126">En règle générale, les systèmes d’intelligence artificielle et physique, ainsi que la logique de détection des collisions associée, sont les principaux consommateurs de cycles de processeur dans le même temps que les applications Microsoft Direct3D.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-126">Typically, the AI or physics systems and the associated collision-detection logic are the primary consumers of CPU cycles in well-behaving Microsoft Direct3D applications.</span></span> <span data-ttu-id="6f8c3-127">Tout travail d’amélioration de ces systèmes peut améliorer les performances globales du jeu.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-127">Any work to improve these systems can improve the overall performance of the game.</span></span>

## <a name="poor-batch-management"></a><span data-ttu-id="6f8c3-128">Gestion des lots médiocre</span><span class="sxs-lookup"><span data-stu-id="6f8c3-128">Poor Batch Management</span></span>

<span data-ttu-id="6f8c3-129">L’obtention d’un bon parallélisme avec le GPU nécessite que les lots de dessin contiennent suffisamment de géométrie et que les nuanceurs aient la complexité appropriée, afin que la carte vidéo reste occupée, tout en n’utilisant pas autant de lots que le tampon de commande est submergé.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-129">Achieving good parallelism with the GPU requires that draw batches contain enough geometry — and the shaders have the right complexity — to keep the video card busy, while not using so many batches that the command buffer is flooded.</span></span> <span data-ttu-id="6f8c3-130">Sur le matériel de la génération actuelle, nous vous recommandons d’environ 300 ou moins de tirages par lot de tirages par trame (moins de processeurs moins performants) pour empêcher le traitement du pilote du tampon de commande de devenir un goulot d’étranglement de performances.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-130">On current-generation hardware, we recommend approximately 300 or fewer draw-batch submissions per frame (fewer on lower-performance CPUs) to prevent the driver's processing of the command-buffer from becoming a performance bottleneck.</span></span> <span data-ttu-id="6f8c3-131">Certains autres appels d’état d’API et combinaisons de pilotes peuvent entraîner un traitement coûteux du processeur (compilation du pilote des nuanceurs, par exemple). nous vous recommandons donc vivement d’analyser les performances de routine.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-131">Some other API state calls and driver combinations can result in costly CPU processing (driver compiling of shaders, for example), so we highly recommend routine performance analysis.</span></span>

## <a name="excessive-memory-copying"></a><span data-ttu-id="6f8c3-132">Copie excessive de la mémoire</span><span class="sxs-lookup"><span data-stu-id="6f8c3-132">Excessive Memory Copying</span></span>

<span data-ttu-id="6f8c3-133">Lors du développement de la plupart des titres de PC, les développeurs utilisent des structures de données et des chaînes pratiques pour la gestion de contenu.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-133">During the development of most PC titles, developers use convenient data structures and strings for content management.</span></span> <span data-ttu-id="6f8c3-134">Le travail du processeur requis pour la comparaison de chaînes, la copie et d’autres manipulations a souvent une surcharge mesurable, en particulier lors de la mise en compte des résultats de performance associés au cache et au sous-système de mémoire.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-134">The CPU work required for string comparison, copying, and other manipulations often has a measurable overhead, particularly when taking into account the performance hits associated with the cache and memory subsystem.</span></span> <span data-ttu-id="6f8c3-135">Les plans doivent être établis lors du développement de ces systèmes pour supprimer ou réduire la dépendance au traitement des chaînes une fois que le produit entre dans les phases de test et de mise en production principales.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-135">Plans should be made when developing these systems for removing or minimizing the reliance on string processing once the product enters into the primary testing and release phases.</span></span>

## <a name="excessive-use-of-dynamic-draw-submission"></a><span data-ttu-id="6f8c3-136">Utilisation excessive de l’envoi de dessin dynamique</span><span class="sxs-lookup"><span data-stu-id="6f8c3-136">Excessive Use of Dynamic Draw Submission</span></span>

<span data-ttu-id="6f8c3-137">Le matériel vidéo moderne fonctionne bien lorsque vous traitez des données statiques.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-137">Modern video hardware performs well when dealing with static data.</span></span> <span data-ttu-id="6f8c3-138">Les adaptateurs haut de gamme disposent souvent d’une très grande quantité de mémoire vidéo, mais cette mémoire ne peut pas être utilisée efficacement par Dynamic Data.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-138">High-end adapters often have a very large amount of video memory, but this memory cannot be effectively utilized by dynamic data.</span></span>

<span data-ttu-id="6f8c3-139">Bien que les modèles d’utilisation raisonnablement efficaces des tampons de vertex/tampons d’index dynamiques puissent être implémentés pour le contenu dynamique, de nombreux titres surveillent cet idiome pour ce qui est du contenu statique.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-139">While reasonably efficient usage patterns of dynamic vertex buffers/index buffers can be implemented for dynamic content, many titles overuse this idiom for what is otherwise static content.</span></span> <span data-ttu-id="6f8c3-140">Nous le voyons le plus souvent avec des arbres de partitionnement d’espace binaire (BSP) et des systèmes basés sur le portail qui stockent la géométrie dans une structure de données qui ne mappe pas au matériel et qui doit être traitée dans des mémoires tampons pour chaque trame.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-140">We most often see this with binary space partitioning (BSP) trees and portal-based systems that store geometry in a data structure that does not map to the hardware and must be processed into buffers for every frame.</span></span> <span data-ttu-id="6f8c3-141">Le fait de placer autant de contenu que possible dans les ressources statiques peut considérablement réduire la surcharge de bande passante liée au transfert de données vers la carte vidéo, améliorer l’utilisation de la mémoire VRAM intégrée et réduire la surcharge du processeur/cache impliquée dans le traitement de ce contenu.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-141">Putting as much content into static resources as possible can greatly reduce the bandwidth overhead of transferring data to the video card, make better use of on-board VRAM, and reduce the CPU/cache overhead involved in processing this content.</span></span>

## <a name="high-overhead-in-file-processing"></a><span data-ttu-id="6f8c3-142">Surcharge élevée dans le traitement des fichiers</span><span class="sxs-lookup"><span data-stu-id="6f8c3-142">High Overhead in File Processing</span></span>

<span data-ttu-id="6f8c3-143">Les jeux de PC ont obtenu une réputation pour des temps de chargement longs, en particulier lorsqu’ils sont comparés aux titres de console avec des exigences de temps de chargement strictes.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-143">PC games have gotten a reputation for long loading times, particular when compared with console titles with strict loading-time requirements.</span></span> <span data-ttu-id="6f8c3-144">Notre analyse de la façon dont de nombreux titres utilisent le sous-système de fichiers révèle certains problèmes courants.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-144">Our analysis of the way that many titles make use of the file subsystem reveals some common issues.</span></span>

<span data-ttu-id="6f8c3-145">La surcharge liée à l’ouverture d’un fichier est généralement bien supérieure à celle que les développeurs attendent.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-145">The overhead of opening a file is usually much higher than developers expect.</span></span> <span data-ttu-id="6f8c3-146">Avec les scanneurs de virus à la demande dans un usage répandu et les fonctionnalités supplémentaires de NTFS, l’ouverture d’un fichier est une opération relativement coûteuse.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-146">With on-demand virus scanners in widespread use, and the additional functionality of NTFS, opening a file is a fairly expensive operation.</span></span> <span data-ttu-id="6f8c3-147">L’ouverture de nombreux fichiers à la fois, ou l’ouverture et la fermeture du même fichier à plusieurs reprises, constituent donc une mauvaise méthode de gestion des fichiers.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-147">Opening many files at once or opening and closing the same file repeatedly is therefore a poor method of dealing with file management.</span></span> <span data-ttu-id="6f8c3-148">Certains jeux ont tenté de réduire ce coût de performance en testant l’existence d’un fichier avant de l’ouvrir.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-148">Some games have attempted to mitigate this performance cost by testing for the existence of a file before opening it.</span></span> <span data-ttu-id="6f8c3-149">En réalité, le test de l’existence d’un fichier sur NTFS nécessite l’ouverture du fichier. ainsi, le test avant d’ouvrir entraîne le paiement de deux fois le coût.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-149">The reality is that testing for the existence of a file on NTFS requires opening the file, so testing before opening results in paying the cost twice.</span></span>

<span data-ttu-id="6f8c3-150">Les jeux qui autorisent les modifications du module complémentaire, ou mods, ou qui incluent toujours la génération de modèles automatique de développement pour vérifier les fichiers de données de remplacement, peuvent entraîner des retards importants lors du chargement du jeu en raison de la vérification de ces fichiers, même si ces fichiers ne sont pas présents.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-150">Games that allow add-on modifications, or mods, or that still include development scaffolding to check for override data files, can have significant delays in loading the game because of checking for these files, even when those files are not present.</span></span> <span data-ttu-id="6f8c3-151">Nous recommandons que les jeux vérifient uniquement ces fichiers lorsqu’ils sont exécutés avec un commutateur de ligne de commande spécial, ou à l’aide d’un autre indicateur de mode, afin que seuls les utilisateurs qui utilisent cette fonctionnalité paient en fait le coût des performances de ces contrôles (souvent étendus).</span><span class="sxs-lookup"><span data-stu-id="6f8c3-151">We recommend that games only check for these files when run with a special command-line switch, or other mode indicator, so that only those users who make use of this functionality actually pay the performance cost of these (often extensive) checks.</span></span>

<span data-ttu-id="6f8c3-152">Des performances supplémentaires peuvent être obtenues à partir du système de fichiers de la façon suivante :</span><span class="sxs-lookup"><span data-stu-id="6f8c3-152">Additional performance can be obtained from the file system by the following:</span></span>

-   <span data-ttu-id="6f8c3-153">Utilisation appropriée de l’indicateur de fichier indicateurs de fichier d' \_ indicateur d' \_ accès aléatoire et d’indicateur de \_ fichier \_ \_ \_ analyse séquentielle</span><span class="sxs-lookup"><span data-stu-id="6f8c3-153">Appropriate use of the file system hints FILE\_FLAG\_RANDOM\_ACCESS and FILE\_FLAG\_SEQUENTIAL\_SCAN</span></span>
-   <span data-ttu-id="6f8c3-154">Dimensionnement des mémoires tampons pour éviter un grand nombre d’appels aux API de lecture/écriture du système d’exploitation</span><span class="sxs-lookup"><span data-stu-id="6f8c3-154">Sizing buffers to avoid a large quantity of calls to the read/write APIs of the OS</span></span>
-   <span data-ttu-id="6f8c3-155">Accès asynchrone aux fichiers</span><span class="sxs-lookup"><span data-stu-id="6f8c3-155">Accessing files asynchronously</span></span>
-   <span data-ttu-id="6f8c3-156">Chargement des threads en arrière-plan</span><span class="sxs-lookup"><span data-stu-id="6f8c3-156">Loading threads in the background</span></span>

<span data-ttu-id="6f8c3-157">Nous vous recommandons également de convertir les données hors connexion (au moment de la génération ou de l’installation) au lieu de vous appuyer sur la conversion lorsque le jeu est exécuté pour la première fois, ce qui permet d’imposer des taxes de performances significatives pour chaque utilisateur.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-157">We also strongly recommend converting data offline (at build or installation time) rather than relying on conversion when the game is first run, as doing so imposes a significant performance tax for every user.</span></span>

## <a name="slow-and-frustrating-installation"></a><span data-ttu-id="6f8c3-158">Installation lente et frustrante</span><span class="sxs-lookup"><span data-stu-id="6f8c3-158">Slow and Frustrating Installation</span></span>

<span data-ttu-id="6f8c3-159">Un autre problème courant que nous avons rencontré est le temps d’installation très long requis pour de nombreux jeux de PC modernes.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-159">Another common issue we've seen is very long installation times required for many modern PC games.</span></span> <span data-ttu-id="6f8c3-160">Les programmes d’installation invitent l’utilisateur plusieurs fois, parfois simplement à indiquer à l’utilisateur, par exemple, « vous n’avez pas besoin d’installer DirectX ».</span><span class="sxs-lookup"><span data-stu-id="6f8c3-160">The installers prompt the user many times, sometimes simply to tell the user, for example, "You do not need DirectX installed."</span></span> <span data-ttu-id="6f8c3-161">En règle générale, ces programmes d’installation malveillants nécessitent que l’utilisateur sélectionne **suivant** ou **OK** à plusieurs moments avant que l’installation du jeu commence réellement.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-161">Generally, these offending installers require the user to select **Next** or **OK** many times before installation of the game actually begins.</span></span> <span data-ttu-id="6f8c3-162">Une fois qu’il a commencé, nous avons vu certains titres prendre une heure ou plus avant que l’utilisateur ait l’opportunité de jouer le jeu.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-162">Once it does begin, we've seen some titles take an hour or more before the user gets the opportunity to play the game.</span></span> <span data-ttu-id="6f8c3-163">Nous pensons que la première heure de l’expérience de jeu ne doit pas être l’installation.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-163">We feel strongly that the first hour of game play experience should not be the installation.</span></span>

<span data-ttu-id="6f8c3-164">Nous vous recommandons d’utiliser un certain nombre d’approches pour traiter l’installation.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-164">We recommend a number of approaches for dealing with installation.</span></span> <span data-ttu-id="6f8c3-165">Tout d’abord, laissez les invites simples et au minimum.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-165">First, keep the prompts simple and to a minimum.</span></span> <span data-ttu-id="6f8c3-166">Deuxièmement, concevez vos données de jeu de sorte que certains ou l’ensemble des fichiers de données puissent être utilisés directement à partir du disque de distribution, dans la mesure du possible. les lecteurs de DVD modernes ont une très grande bande passante.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-166">Second, architect your game data such that some or all the data files can be used directly from the distribution disk where possible — modern DVD drives have very high bandwidth.</span></span> <span data-ttu-id="6f8c3-167">Troisièmement, envisagez d’implémenter Install-on-Demand dans vos titres pour réduire ou éliminer le processus d’installation et permettre aux utilisateurs d’accéder au jeu aussi rapidement que possible.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-167">Third, consider implementing install-on-demand in your titles to reduce or eliminate the installation process and allow users to get into the game as quickly as possible.</span></span> <span data-ttu-id="6f8c3-168">(Pour plus d’informations sur l’installation à la demande, consultez [installation à la demande pour les jeux](/windows/desktop/DxTechArts/install-on-demand-for-games).)</span><span class="sxs-lookup"><span data-stu-id="6f8c3-168">(For more information about installing on demand, see [Install-on-Demand for Games](/windows/desktop/DxTechArts/install-on-demand-for-games).)</span></span>

<span data-ttu-id="6f8c3-169">Pour plus d’informations sur l’installation de jeux, consultez [simplification de l’installation de jeux](/windows/desktop/DxTechArts/simplifying-game-installation).</span><span class="sxs-lookup"><span data-stu-id="6f8c3-169">For more recommendations about game installation, see [Simplifying Game Installation](/windows/desktop/DxTechArts/simplifying-game-installation).</span></span>

## <a name="lack-of-consideration-of-physical-memory"></a><span data-ttu-id="6f8c3-170">Manque de considérations sur la mémoire physique</span><span class="sxs-lookup"><span data-stu-id="6f8c3-170">Lack of Consideration of Physical Memory</span></span>

<span data-ttu-id="6f8c3-171">En raison de la grande variabilité du matériel PC sur le marché, les titres utilisent généralement des tests de configuration ad hoc pour sélectionner les paramètres par défaut pour le niveau de détail graphique.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-171">Because of the wide variability of PC hardware in the market, titles typically make use of ad hoc configuration tests to select default settings for the level of graphical detail.</span></span> <span data-ttu-id="6f8c3-172">Certains des titres que nous avons vus utilisent la taille de la mémoire vidéo dans ces tests, mais ne parviennent pas à les mettre en corrélation avec la taille de la mémoire physique.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-172">Some of the titles we've seen are using video memory size in these tests, but failing to correlate this with physical memory size.</span></span> <span data-ttu-id="6f8c3-173">Pour gérer les situations de périphériques perdus, la majeure partie de la mémoire vidéo (VRAM locale sur la carte et ouverture de mémoire AGP non locale) doit être sauvegardée par la mémoire physique, soit à l’aide de ressources managées, soit en utilisant des structures de données personnalisées.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-173">In order to handle lost-device situations, the majority of the video memory (both local VRAM on the card and the non-local AGP memory aperture) must be backed by physical memory, either through the use of managed resources or custom data structures.</span></span> <span data-ttu-id="6f8c3-174">Certaines cartes vidéo haut de gamme ont des tailles VRAM qui rivalisent avec la taille des mémoires d’UC de bas de gamme.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-174">Some high-end video cards have VRAM sizes rivaling the size of low-end CPU memories.</span></span> <span data-ttu-id="6f8c3-175">Dans les situations où le système dispose d’une mémoire physique limitée par rapport à la carte vidéo, la plupart de ces VRAMs ne peuvent pas être utilisés efficacement et des paramètres de détail inférieurs doivent être configurés.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-175">In situations where the system has limited physical memory compared to the video card, most of that VRAM cannot be effectively utilized, and lower detail settings should be configured.</span></span>

## <a name="over-reliance-on-real-time-audio-sample-rate-conversion"></a><span data-ttu-id="6f8c3-176">Over-Reliance sur Real-Time conversion du taux d’échantillonnage audio</span><span class="sxs-lookup"><span data-stu-id="6f8c3-176">Over-Reliance on Real-Time Audio Sample Rate Conversion</span></span>

<span data-ttu-id="6f8c3-177">Une autre source courante de la gravure de cycle d’UC que nous avons constatée se produit lorsque le système audio est nécessaire pour convertir la vitesse de lecture pendant la combinaison dans le tampon matériel.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-177">Another common source of CPU cycle burn we've seen occurs when the audio system is required to convert the playback rate during mix into the hardware buffer.</span></span> <span data-ttu-id="6f8c3-178">Avec les pilotes Windows Driver Model (WDM), le format de mémoire tampon matérielle n’est pas contrôlé par l’application directe, car il s’agit d’une ressource de niveau noyau. au lieu de cela, le format est sélectionné en fonction du format de qualité la plus élevée de toutes les sources et des capacités du matériel.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-178">With Windows Driver Model (WDM) drivers, the hardware buffer format is not under direct application control, because it is a kernel-level resource; instead, the format is selected based on the highest-quality format of all sources and the capabilities of the hardware.</span></span> <span data-ttu-id="6f8c3-179">Par défaut, Windows XP utilise une conversion de taux d’échantillonnage de haute qualité pour ce processus, et si la majorité des exemples audio requièrent une conversion de taux, une partie importante des cycles de l’UC est consommée.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-179">By default, Windows XP uses a high-quality sample rate conversion for this process, and if the majority of the audio samples require a rate conversion, a significant portion of the CPU cycles will be consumed.</span></span>

<span data-ttu-id="6f8c3-180">Nous vous recommandons de créer toutes vos mémoires tampons DirectSound avec le même taux d’échantillonnage.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-180">We recommend creating all of your DirectSound buffers with the same sample rate.</span></span> <span data-ttu-id="6f8c3-181">Si vous utilisez des fonctions Microsoft Win32 **WaveOut** , vous devez également utiliser un taux d’échantillonnage cohérent.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-181">If you make any use of Microsoft Win32 **waveOut** functions, you should use a consistent sample rate with these, too.</span></span> <span data-ttu-id="6f8c3-182">Avec les pilotes WDM, les mémoires tampons sont toutes mélangées par le noyau, et si vous utilisez un taux d’échantillonnage plus élevé sur certains d’entre eux, les taux d’échantillonnage de tous les REST sont convertis en correspondance.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-182">With WDM drivers, the buffers will all be mixed by the kernel, and if you use a higher sampling rate on some of them, the sample rates of all of the rest will be converted to match.</span></span> <span data-ttu-id="6f8c3-183">Notez que cela implique l’utilisation du même taux de lecture pour tous vos échantillons audio, y compris les mémoires tampons de décompression audio en continu.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-183">Note that this implies using the same playback rate for all your audio samples, including any streaming audio decompression buffers.</span></span> <span data-ttu-id="6f8c3-184">La définition du taux de mémoire tampon principale n’a aucun effet, sauf si vous ciblez Windows 98 ou Windows Millennium Edition.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-184">Setting the primary buffer rate has no effect unless you are targeting either Windows 98 or Windows Millennium Edition.</span></span>

> [!Note]  
> <span data-ttu-id="6f8c3-185">Sur Windows Vista et les versions ultérieures du système d’exploitation, DirectSound et **WaveOut** utilisent l' [API de session audio Windows (WASAPI)](/windows/desktop/CoreAudio/wasapi) pour toute la sortie audio.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-185">On Windows Vista and later versions of the operating system, DirectSound and **waveOut** use the [Windows Audio Session API (WASAPI)](/windows/desktop/CoreAudio/wasapi) for all audio output.</span></span>

 

## <a name="fragmention-of-virtual-memory"></a><span data-ttu-id="6f8c3-186">Fragmentation de la mémoire virtuelle</span><span class="sxs-lookup"><span data-stu-id="6f8c3-186">Fragmention of Virtual Memory</span></span>

<span data-ttu-id="6f8c3-187">Nous avons vu un certain nombre de problèmes récents liés à la limite de 32 bits sur l’espace mémoire du processus.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-187">We've seen a number of recent issues related to the 32-bit limit on process memory space.</span></span> <span data-ttu-id="6f8c3-188">Alors que 2 Go d’espace d’adressage virtuel pour les processus en mode utilisateur ont été plus qu’un historique suffisant, l’utilisation accrue de fichiers mappés en mémoire volumineux, d’allocateurs de mémoire personnalisés et de l’augmentation de la taille de VRAM (qui doit être mappée dans l’espace de processus) a commencé à provoquer des situations où les allocations d’espace mémoire virtuelle échouent</span><span class="sxs-lookup"><span data-stu-id="6f8c3-188">While 2 GB of virtual address space for user-mode processes has been more than adequate historically, the increased use of large memory-mapped files, custom memory allocators, and increasing VRAM size (which must be mapped into process space) has started to cause situations where allocations of virtual memory space are failing.</span></span> <span data-ttu-id="6f8c3-189">Certaines dll non-Microsoft utilisent des emplacements à démarrage fixe au milieu de l’espace d’adressage virtuel, ce qui entraîne une fragmentation qui entraîne des échecs d’allocation.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-189">Some non-Microsoft DLLs are using fixed-start locations in the middle of the virtual address space, which is causing fragmentation that results in failed allocations.</span></span>

<span data-ttu-id="6f8c3-190">Ces problèmes s’affichent le plus souvent lorsque le jeu utilise un schéma d’allocation de mémoire personnalisé qui tente d’allouer un grand segment continu d’espace de mémoire virtuelle.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-190">These problems most often appear when the game makes use of a custom memory allocation scheme that attempts to allocate a large continuous chunk of virtual memory space.</span></span> <span data-ttu-id="6f8c3-191">Nous vous recommandons d’écrire des allocateurs de sorte qu’ils demandent des parties de l’espace d’adressage virtuel plus raisonnablement, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-191">Our recommendation is to write allocators such that they request more reasonably sized portions of the virtual address space as needed.</span></span> <span data-ttu-id="6f8c3-192">Par exemple, en demandant 64 ou 256 Mo à la fois, mais pas 1 Go.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-192">For example, requesting 64 or 256 MB at a time, but not 1 GB.</span></span> <span data-ttu-id="6f8c3-193">Toutefois, il convient de veiller à ne pas provoquer une fragmentation supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-193">However, care should be taken to not cause further fragmentation.</span></span> <span data-ttu-id="6f8c3-194">L’avènement des systèmes d’exploitation et du matériel 64 bits contribuera beaucoup à ces problèmes à l’avenir, mais vous devez veiller à ce que les systèmes 32 bits de génération actuelle soient pris en compte.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-194">The advent of 64-bit operating systems and hardware will greatly help these issues in the future, but care must be taken on current-generation 32-bit systems.</span></span>

## <a name="manipulation-of-the-floating-point-control-word"></a><span data-ttu-id="6f8c3-195">Manipulation du mot de contrôle Floating-Point</span><span class="sxs-lookup"><span data-stu-id="6f8c3-195">Manipulation of the Floating-Point Control Word</span></span>

<span data-ttu-id="6f8c3-196">En guise d’aide au débogage, certains développeurs ont activé des exceptions sur l’unité de virgule flottante (FPU) via des manipulations du mot de contrôle à virgule flottante.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-196">As a debugging aid, some developers have been enabling exceptions on the floating-point unit (FPU) via manipulations of the floating-point control word.</span></span> <span data-ttu-id="6f8c3-197">Cette opération est très problématique et risque d’entraîner un blocage du processus.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-197">Doing this is highly problematic and will likely cause the process to crash.</span></span> <span data-ttu-id="6f8c3-198">Tout comme la Convention d’appel exige que le registre ebx soit préservé, la majorité du système suppose que le FPU est dans un État par défaut, donne des résultats raisonnables et ne génère pas d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-198">Just like the calling convention requires that the ebx register be preserved, the majority of the system assumes that the FPU is in a default state, will give reasonable results, and won't generate exceptions.</span></span> <span data-ttu-id="6f8c3-199">Les pilotes et autres composants système calculent souvent des résultats en partant de l’hypothèse que les valeurs d’erreur standard apparaissent dans les registres pour des conditions erronées, mais si les exceptions sont activées, elles ne sont pas gérées et entraînent des blocages.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-199">Drivers and other system components will often compute results based on the assumption that standard error values will appear in the registers for bad conditions, but if exceptions are enabled, these will go unhandled and result in crashes.</span></span>

<span data-ttu-id="6f8c3-200">Direct3D définit l’unité à virgule flottante sur simple précision, en arrondissant à la valeur la plus proche dans le cadre de l’initialisation du thread appelant, sauf si l' \_ indicateur D3DCREATE FPU \_ Preserve est utilisé, auquel cas le mot de contrôle à virgule flottante est intact.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-200">Direct3D will set the floating-point unit to single-precision, round-to-nearest as part of initialization for the calling thread, unless the D3DCREATE\_FPU\_PRESERVE flag is used, in which case, the floating-point control word is untouched.</span></span> <span data-ttu-id="6f8c3-201">Dans la mesure où le mot de contrôle est un paramètre par thread, garantir que tous les threads de votre application sont définis en mode de précision simple peut optimiser les performances.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-201">Since the control word is a per-thread setting, ensuring that all of your application threads are set to single-precision mode may optimize performance.</span></span> <span data-ttu-id="6f8c3-202">N’oubliez pas que l’appel de [**\_ CONTROL87**](https://msdn.microsoft.com/library/e9b52ceh(v=VS.71).aspx) n’est pas valide pour le codage natif x64, qui utilise exclusivement SSE à la place, et il est extrêmement onéreux sur l’architecture PowerPC de l’UC Xbox 360.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-202">Remember that calling [**\_control87**](https://msdn.microsoft.com/library/e9b52ceh(v=VS.71).aspx) is not valid for x64-native coding, which uses SSE exclusively instead, and it is extremely expensive on the PowerPC-based architecture of the Xbox 360 CPU.</span></span>

> [!Note]  
> <span data-ttu-id="6f8c3-203">Si vous modifiez le mot de contrôle, utilisez [**\_ controlfp \_**](https://msdn.microsoft.com/library/c9676k6h(v=VS.80).aspx) et sachez que pour les plateformes x64, vous ne pouvez pas modifier la précision à virgule flottante via le mot de contrôle.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-203">If you modify the control word, use [**\_controlfp\_s**](https://msdn.microsoft.com/library/c9676k6h(v=VS.80).aspx) and be aware that for x64 platforms you can't change the floating-point precision via the control word.</span></span>

 

<span data-ttu-id="6f8c3-204">Dans toutes les bibliothèques où nous avons besoin d’utiliser des règles d’arrondi ou d’autres comportements différents, par exemple pour gérer les nuanceurs de vertex logiciels ou la compilation, nous enregistrons et restaurons le mot de contrôle.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-204">In any libraries where we need to have different rounding rules or other behavior — such as dealing with software vertex shaders or compilation — we save and restore the control word.</span></span> <span data-ttu-id="6f8c3-205">Si un jeu doit utiliser des exceptions d’arrondi non standard ou FPU, il doit enregistrer et restaurer le mot de contrôle à virgule flottante, et vous devez vous assurer qu’il n’appelle pas de code externe qui n’a pas été prouvé comme étant à l’abri de ces problèmes, y compris les API système.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-205">If a game needs to make use of non-standard rounding or FPU exceptions, it should save and restore the floating-point control word, and you should be sure that it does not call any external code that has not been proven to be safe from these problems, including system APIs.</span></span>

## <a name="optional-installation-of-the-directx-runtime"></a><span data-ttu-id="6f8c3-206">Installation facultative du runtime DirectX</span><span class="sxs-lookup"><span data-stu-id="6f8c3-206">Optional Installation of the DirectX Runtime</span></span>

<span data-ttu-id="6f8c3-207">Un certain nombre de jeux demandent à l’utilisateur s’il faut installer DirectX.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-207">A number of games ask the user whether to install DirectX.</span></span> <span data-ttu-id="6f8c3-208">Cela peut entraîner des problèmes si l’utilisateur suppose que le package redistribuable DirectX le plus récent est installé et qu’il ignore l’installation et, par la suite, l’installation se poursuit correctement.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-208">This can cause problems if the user assumes that the system has the latest DirectX redistributable installed and skips installation, and subsequently, the installation continues successfully.</span></span> <span data-ttu-id="6f8c3-209">Si le jeu requiert une version spécifique de D3DX ou d’autres fonctionnalités mises à jour qui n’ont pas été installées, le jeu ne fonctionnera pas et l’utilisateur sera très frustré.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-209">If the game requires a specific version of D3DX, or other updated functionality that was not installed, then the game won't work, and the user will get very frustrated.</span></span>

<span data-ttu-id="6f8c3-210">Il est fortement recommandé que le programme d’installation du jeu installe en mode silencieux le package redistribuable DirectX sur lequel le jeu a été créé.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-210">It is strongly recommended that the game's installer silently install the DirectX redistributable that the game was built against.</span></span> <span data-ttu-id="6f8c3-211">Le processus d’installation de DirectX est conçu pour vérifier si quelque chose doit être mis à jour et retourne rapidement si ce n’est pas le cas.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-211">The DirectX installation process is designed so that it verifies whether anything needs to be updated and quickly returns if it doesn't.</span></span> <span data-ttu-id="6f8c3-212">Par conséquent, il n’est pas nécessaire de demander à l’utilisateur l’installation de DirectX.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-212">So, there is no need to ask the user about installing DirectX.</span></span>

<span data-ttu-id="6f8c3-213">Une installation sans assistance de DirectX peut être effectuée en exécutant cette commande à partir de votre package d’installation : **dxsetup.exe/Silent**</span><span class="sxs-lookup"><span data-stu-id="6f8c3-213">A silent installation of DirectX can be done by running this command from your installation package: **dxsetup.exe /silent**</span></span>

<span data-ttu-id="6f8c3-214">En outre, la taille réelle du dossier redistribuable peut être configurée pour inclure uniquement les fichiers CAB (. cab) qui sont réellement nécessaires pour les plateformes et l’utilisation cibles du jeu.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-214">Furthermore, the actual size of the redistributable folder can be configured to include only those cabinet files (.cab) that are actually needed for the game's target platforms and usage.</span></span>

> [!Note]  
> <span data-ttu-id="6f8c3-215">Avant d’utiliser **Dxsetup**, lisez- [le de façon indirecte](https://walbourn.github.io/).</span><span class="sxs-lookup"><span data-stu-id="6f8c3-215">Before you use **dxsetup**, read [Not So Direct Setup](https://walbourn.github.io/).</span></span>

 

## <a name="excessive-use-of-thread-synchronization"></a><span data-ttu-id="6f8c3-216">Utilisation excessive de la synchronisation des threads</span><span class="sxs-lookup"><span data-stu-id="6f8c3-216">Excessive Use of Thread Synchronization</span></span>

<span data-ttu-id="6f8c3-217">Lors du profilage des jeux, les zones réactives principales sont souvent liées à l’entrée et à la sortie des sections critiques.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-217">When profiling games, the top hotspots are often found to be related to entering and leaving critical sections.</span></span> <span data-ttu-id="6f8c3-218">Avec la prévalence des UC multicœur, l’utilisation du multithreading dans les jeux a considérablement augmenté, et de nombreuses implémentations s’appuient sur une utilisation intensive de la synchronisation des threads.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-218">With the prevalence of multi-core CPUs, the use of multithreading in games has increased dramatically, and many implementations rely on heavy use of thread synchronization.</span></span> <span data-ttu-id="6f8c3-219">Le temps processeur nécessaire pour prendre une section critique même sans aucune contention est tout à fait significatif, et toutes les autres formes de synchronisation des threads sont encore plus coûteuses.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-219">The CPU time to take a critical section even without any contention is quite significant, and all other forms of thread synchronization are even more expensive.</span></span> <span data-ttu-id="6f8c3-220">Vous devez donc veiller à réduire l’utilisation de ces Primitives.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-220">So, care must be taken to minimize the use of these primitives.</span></span>

<span data-ttu-id="6f8c3-221">Une source courante de synchronisation excessive dans les jeux est l’utilisation de [D3DCREATE \_ multithread](/windows/desktop/direct3d9/d3dcreate).</span><span class="sxs-lookup"><span data-stu-id="6f8c3-221">A common source of excessive synchronization in games is the use of [D3DCREATE\_MULTITHREADED](/windows/desktop/direct3d9/d3dcreate).</span></span> <span data-ttu-id="6f8c3-222">Cet indicateur, tout en rendant Direct3D thread-safe pour le rendu à partir de plusieurs threads, adopte une approche très prudente, ce qui entraîne une surcharge de synchronisation élevée.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-222">This flag, while making Direct3D thread-safe for rendering from multiple threads, takes a very conservative approach, resulting in high synchronization overhead.</span></span> <span data-ttu-id="6f8c3-223">Les jeux doivent éviter cet indicateur.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-223">Games should avoid this flag.</span></span> <span data-ttu-id="6f8c3-224">Au lieu de cela, concevez le moteur de sorte que toutes les communications avec Direct3D proviennent d’un thread unique et que toutes les communications entre les threads soient traitées directement.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-224">Instead, architect the engine so that all communication with Direct3D is from a single thread and any communication between threads is handled directly.</span></span> <span data-ttu-id="6f8c3-225">Pour plus d’informations sur la conception de jeux multithread, consultez l’article [codage de plusieurs cœurs sur Xbox 360 et Microsoft Windows](/windows/desktop/DxTechArts/coding-for-multiple-cores).</span><span class="sxs-lookup"><span data-stu-id="6f8c3-225">For more information about designing multi-threaded games, see the article [Coding For Multiple Cores on Xbox 360 and Microsoft Windows](/windows/desktop/DxTechArts/coding-for-multiple-cores).</span></span>

## <a name="use-of-rdtsc"></a><span data-ttu-id="6f8c3-226">Utilisation de RDTSC</span><span class="sxs-lookup"><span data-stu-id="6f8c3-226">Use of RDTSC</span></span>

<span data-ttu-id="6f8c3-227">L’utilisation de l’instruction **RDTSC** x86 n’est pas recommandée.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-227">Use of the x86 instruction **RDTSC** is not recommended.</span></span> <span data-ttu-id="6f8c3-228">**RDTSC** ne parvient pas à calculer correctement le minutage sur certains schémas de gestion de l’alimentation qui modifient la fréquence de l’UC de manière dynamique et sur de nombreux processeurs multicœurs pour lesquels le compteur de cycle n’est pas synchronisé entre les cœurs.</span><span class="sxs-lookup"><span data-stu-id="6f8c3-228">**RDTSC** fails to correctly compute timing on some power management schemes that change the CPU frequency dynamically and on many multi-core CPUs for which the cycle counter is not synchronized between cores.</span></span> <span data-ttu-id="6f8c3-229">Les jeux doivent à la place utiliser l’API [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) .</span><span class="sxs-lookup"><span data-stu-id="6f8c3-229">Games should instead use the [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) API.</span></span> <span data-ttu-id="6f8c3-230">Pour plus d’informations sur les problèmes liés à **RDTSC** et l’implémentation du minutage haute résolution avec **QueryPerformanceCounter**, consultez l’article [synchronisation des jeux et processeurs multicœurs](/windows/desktop/DxTechArts/game-timing-and-multicore-processors).</span><span class="sxs-lookup"><span data-stu-id="6f8c3-230">For more information about issues with **RDTSC** and implementing high-resolution timing with **QueryPerformanceCounter**, see the article [Game Timing and Multicore Processors](/windows/desktop/DxTechArts/game-timing-and-multicore-processors).</span></span>

 

 