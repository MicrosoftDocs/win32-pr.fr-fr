---
title: Contrôle de compte d’utilisateur pour les développeurs de jeux
description: Cet article décrit les recommandations et les meilleures pratiques permettant aux développeurs de jeux de travailler efficacement avec la fonctionnalité de sécurité contrôle de compte d’utilisateur (UAC) introduite dans Windows Vista.
ms.assetid: dbac1c07-73dd-f2bc-3c5c-d6160368a88f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57d5533a3fbdd349cc25dfde501a234bbd7b05b1
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104382264"
---
# <a name="user-account-control-for-game-developers"></a><span data-ttu-id="893af-103">Contrôle de compte d’utilisateur pour les développeurs de jeux</span><span class="sxs-lookup"><span data-stu-id="893af-103">User Account Control for Game Developers</span></span>

<span data-ttu-id="893af-104">Cet article décrit les recommandations et les meilleures pratiques permettant aux développeurs de jeux de travailler efficacement avec la fonctionnalité de sécurité contrôle de compte d’utilisateur (UAC) introduite dans Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="893af-104">This article describes the guidelines and best practices for game developers to work effectively with the User Account Control (UAC) security feature introduced in Windows Vista.</span></span>

-   [<span data-ttu-id="893af-105">Vue d’ensemble du contrôle de compte d’utilisateur</span><span class="sxs-lookup"><span data-stu-id="893af-105">Overview of User Account Control</span></span>](#overview-of-user-account-control)
-   [<span data-ttu-id="893af-106">Comptes d’utilisateur dans Windows Vista</span><span class="sxs-lookup"><span data-stu-id="893af-106">User Accounts in Windows Vista</span></span>](#user-accounts-in-windows-vista)
-   [<span data-ttu-id="893af-107">Accès aux fichiers en tant qu’utilisateur standard</span><span class="sxs-lookup"><span data-stu-id="893af-107">File Access as a Standard User</span></span>](#file-access-as-a-standard-user)
-   [<span data-ttu-id="893af-108">Accès au registre en tant qu’utilisateur standard</span><span class="sxs-lookup"><span data-stu-id="893af-108">Registry Access as a Standard User</span></span>](#registry-access-as-a-standard-user)
-   [<span data-ttu-id="893af-109">Privilege Elevation (élévation des privilèges)</span><span class="sxs-lookup"><span data-stu-id="893af-109">Privilege Elevation</span></span>](#privilege-elevation)
-   [<span data-ttu-id="893af-110">Implications du contrôle de compte d’utilisateur avec CreateProcess ()</span><span class="sxs-lookup"><span data-stu-id="893af-110">UAC Implications with CreateProcess()</span></span>](#uac-implications-with-createprocess)
-   [<span data-ttu-id="893af-111">Définition du niveau d’exécution dans le manifeste de l’application</span><span class="sxs-lookup"><span data-stu-id="893af-111">Setting the Execution Level in the Application Manifest</span></span>](#setting-the-execution-level-in-the-application-manifest)
-   [<span data-ttu-id="893af-112">Incorporation d’un manifeste dans Visual Studio</span><span class="sxs-lookup"><span data-stu-id="893af-112">Embedding a Manifest in Visual Studio</span></span>](#embedding-a-manifest-in-visual-studio)
-   [<span data-ttu-id="893af-113">Compatibilité UAC avec les anciens jeux</span><span class="sxs-lookup"><span data-stu-id="893af-113">UAC Compatibility with Older Games</span></span>](#uac-compatibility-with-older-games)
-   [<span data-ttu-id="893af-114">Scénarios et manifestes hérités</span><span class="sxs-lookup"><span data-stu-id="893af-114">Legacy Scenarios and Manifests</span></span>](#legacy-scenarios-and-manifests)
-   [<span data-ttu-id="893af-115">Conclusion</span><span class="sxs-lookup"><span data-stu-id="893af-115">Conclusion</span></span>](#conclusion)
-   [<span data-ttu-id="893af-116">Autres lectures</span><span class="sxs-lookup"><span data-stu-id="893af-116">Further Reading</span></span>](#further-reading)

## <a name="overview-of-user-account-control"></a><span data-ttu-id="893af-117">Vue d’ensemble du contrôle de compte d’utilisateur</span><span class="sxs-lookup"><span data-stu-id="893af-117">Overview of User Account Control</span></span>

<span data-ttu-id="893af-118">Le contrôle de compte d’utilisateur (UAC), introduit dans Windows Vista, est une fonctionnalité de sécurité conçue pour empêcher les attaquants malveillants d’utiliser des faiblesses ou des bogues détectés dans des applications largement utilisées pour modifier le système d’exploitation ou d’autres programmes installés.</span><span class="sxs-lookup"><span data-stu-id="893af-118">User Account Control (UAC), introduced in Windows Vista, is a security feature that is designed to help prevent malicious attackers from using weaknesses or bugs found in widely-used applications to alter the operating system or other installed programs.</span></span> <span data-ttu-id="893af-119">Pour ce faire, vous devez exécuter la grande majorité des programmes et processus en tant qu’utilisateur standard (également appelé utilisateur limité, utilisateur restreint ou Least-Privileged utilisateur), même si le compte de l’utilisateur actuel dispose d’informations d’identification d’administration.</span><span class="sxs-lookup"><span data-stu-id="893af-119">This is accomplished by running the vast majority of programs and processes as a Standard User (also known as a Limited User, Restricted User, or Least-Privileged User) even if the current user's account has administrative credentials.</span></span> <span data-ttu-id="893af-120">Un processus avec des privilèges d’utilisateur standard a de nombreuses restrictions inhérentes qui l’empêchent d’effectuer des modifications à l’ensemble du système.</span><span class="sxs-lookup"><span data-stu-id="893af-120">A process with standard user privileges has many inherent restrictions that prevent it from making system-wide changes.</span></span>

<span data-ttu-id="893af-121">Le contrôle de compte d’utilisateur est également responsable de l’élévation des privilèges d’un processus à l’aide d’un schéma d’authentification basé sur des boîtes de dialogue, lancé à l’exécution de certains processus qui sont désignés comme nécessitant des privilèges d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="893af-121">UAC is also responsible for privilege elevation of a process by use of a dialog-based, authentication scheme initiated upon execution of certain processes that are designated as requiring administrative privileges.</span></span> <span data-ttu-id="893af-122">L’élévation des privilèges permet aux administrateurs d’exécuter la majorité de leurs applications à un niveau de privilège sécurisé (identique à tout autre utilisateur standard), mais également d’autoriser les processus et les opérations qui requièrent des privilèges d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="893af-122">Privilege elevation allows administrators to run the majority of their applications at a safe privilege level (the same as any other standard user), but also allow processes and operations that require administrative privileges.</span></span> <span data-ttu-id="893af-123">Le contrôle de compte d’utilisateur prend en charge l’authentification par procuration afin qu’un administrateur puisse accorder des privilèges élevés à un programme pendant qu’un utilisateur standard est actuellement connecté au système.</span><span class="sxs-lookup"><span data-stu-id="893af-123">UAC supports over-the-shoulder authentication so that an administrator can grant elevated privileges to a program while a standard user is currently logged onto the system.</span></span>

<span data-ttu-id="893af-124">La fonctionnalité UAC est activée par défaut.</span><span class="sxs-lookup"><span data-stu-id="893af-124">The UAC feature is enabled by default.</span></span> <span data-ttu-id="893af-125">Bien qu’il soit possible pour un administrateur de désactiver l’UAC à l’ensemble du système, cela a un certain nombre de ramifications négatives.</span><span class="sxs-lookup"><span data-stu-id="893af-125">While it is possible for an administrator to disable UAC system-wide, doing so has a number of negative ramifications.</span></span> <span data-ttu-id="893af-126">Tout d’abord, cela affaiblit la sécurité de tous les comptes d’administration, car tous les processus seraient exécutés avec des informations d’identification d’administration, même si la plupart des applications n’en ont pas besoin.</span><span class="sxs-lookup"><span data-stu-id="893af-126">First, this weakens the security of all administrative accounts, as all processes would be run with administrative credentials, even when most applications do not actually require them.</span></span> <span data-ttu-id="893af-127">Si le contrôle de compte d’utilisateur est désactivé, une application utilisateur standard qui expose une vulnérabilité exploitable dans la sécurité peut être utilisée pour voler des informations privées, installer des rootkits ou des logiciels espions, détruire l’intégrité du système ou héberger des attaques Zombie sur d’autres systèmes.</span><span class="sxs-lookup"><span data-stu-id="893af-127">With UAC disabled, a standard user application that exposes an exploitable vulnerability in security can potentially be used to steal private information, install rootkits or spyware, destroy the system integrity, or host zombie attacks on other systems.</span></span> <span data-ttu-id="893af-128">Tandis que avec le contrôle de compte d’utilisateur activé, l’exécution de la majorité des logiciels en tant qu’utilisateur standard limite les dommages potentiels à un tel bogue.</span><span class="sxs-lookup"><span data-stu-id="893af-128">Whereas with UAC enabled, running the majority of software as a standard user greatly limits the potential damage from such a bug.</span></span> <span data-ttu-id="893af-129">Deuxièmement, la désactivation du contrôle de compte d’utilisateur désactive la plupart des solutions de contournement pour la compatibilité des applications qui permettent aux véritables utilisateurs standard d’exécuter avec succès un large éventail d’applications.</span><span class="sxs-lookup"><span data-stu-id="893af-129">Secondly, turning off UAC disables many of the workarounds for application compatibility that allow true standard users to successfully run a broad range of applications.</span></span> <span data-ttu-id="893af-130">La désactivation du contrôle de compte d’utilisateur ne doit jamais être recommandée comme solution de contournement de compatibilité.</span><span class="sxs-lookup"><span data-stu-id="893af-130">Disabling UAC should never be recommended as a compatibility workaround.</span></span>

<span data-ttu-id="893af-131">Il est important de noter que les applications doivent s’efforcer d’utiliser uniquement des droits d’utilisateur standard, si possible.</span><span class="sxs-lookup"><span data-stu-id="893af-131">It is important to note that applications should strive to only use standard user rights if at all possible.</span></span> <span data-ttu-id="893af-132">Alors que les administrateurs peuvent facilement élever les privilèges d’un processus, l’élévation requiert toujours l’intervention de l’utilisateur et l’accusé de réception chaque fois qu’une application est exécutée, ce qui nécessite des informations d’identification d’administration.</span><span class="sxs-lookup"><span data-stu-id="893af-132">While administrators can easily elevate the privileges of a process, the elevation still requires user interaction and acknowledgement every time that an application is run that requires administrative credentials.</span></span> <span data-ttu-id="893af-133">Cette élévation doit également être effectuée au moment du démarrage du programme. par conséquent, exiger des informations d’identification d’administration même pour une seule opération nécessite d’exposer le système à un risque plus élevé pour l’ensemble de la durée d’exécution de l’application.</span><span class="sxs-lookup"><span data-stu-id="893af-133">This elevation must also be done at the time that the program starts, so requiring administrative credentials   even for a single operation   requires exposing the system to greater risk for the entire running time of the application.</span></span> <span data-ttu-id="893af-134">Les utilisateurs standard sans pouvoir élever leurs privilèges sont également courants dans les paramètres de la famille et de l’entreprise.</span><span class="sxs-lookup"><span data-stu-id="893af-134">Standard users without any ability to elevate their privileges are also common in family and business settings.</span></span> <span data-ttu-id="893af-135">« Exécuter en tant qu’administrateur » n’est pas une bonne solution de contournement pour la compatibilité, expose l’utilisateur et le système à un risque de sécurité plus élevé et crée des frustrations pour les utilisateurs dans de nombreuses situations.</span><span class="sxs-lookup"><span data-stu-id="893af-135">"Run As Administrator" is not a good workaround for compatibility, exposes the user and the system to greater security risk, and creates frustration for users in many situations.</span></span>

> [!Note]  
> <span data-ttu-id="893af-136">La fonctionnalité de contrôle de compte d’utilisateur introduite dans Windows Vista est également présente dans Windows 7.</span><span class="sxs-lookup"><span data-stu-id="893af-136">The User Account Control feature introduced in Windows Vista is also present in Windows 7.</span></span> <span data-ttu-id="893af-137">Tandis que l’expérience utilisateur qui utilise les différentes fonctionnalités du système a été améliorée par rapport au contrôle de compte d’utilisateur, l’impact sur les applications est fondamentalement le même.</span><span class="sxs-lookup"><span data-stu-id="893af-137">While the user experience working with the various system features has been improved with respect to User Account Control, the impact on applications is basically the same.</span></span> <span data-ttu-id="893af-138">Toutes les recommandations de Windows Vista présentées dans cet article s’appliquent également à Windows 7.</span><span class="sxs-lookup"><span data-stu-id="893af-138">All of the Windows Vista recommendations in this article apply to Windows 7 as well.</span></span> <span data-ttu-id="893af-139">Pour plus d’informations sur les modifications de l’interface utilisateur UAC pour Windows 7, consultez l' [interface utilisateur-mises à jour de la boîte de dialogue contrôle de compte d’utilisateur](../win7appqual/user-interface---user-account-control-dialog-updates.md).</span><span class="sxs-lookup"><span data-stu-id="893af-139">For details on the UAC UI changes for Windows 7, see [User Interface - User Account Control Dialog Updates](../win7appqual/user-interface---user-account-control-dialog-updates.md).</span></span>

 

## <a name="user-accounts-in-windows-vista"></a><span data-ttu-id="893af-140">Comptes d’utilisateur dans Windows Vista</span><span class="sxs-lookup"><span data-stu-id="893af-140">User Accounts in Windows Vista</span></span>

<span data-ttu-id="893af-141">Windows Vista classe chaque utilisateur en deux types de comptes d’utilisateur : les administrateurs et les utilisateurs standard.</span><span class="sxs-lookup"><span data-stu-id="893af-141">Windows Vista categorizes every user into two user account types: administrators and standard users.</span></span>

<span data-ttu-id="893af-142">Un compte d’utilisateur standard est semblable à un compte d’utilisateur limité sous Windows XP.</span><span class="sxs-lookup"><span data-stu-id="893af-142">A standard user account is similar to a limited-user account in Windows XP.</span></span> <span data-ttu-id="893af-143">Comme dans Windows XP, un utilisateur standard ne peut pas écrire dans le dossier Program Files, ne peut pas écrire dans la \_ partie HKEY local \_ machine du Registre et ne peut pas effectuer de tâches qui modifient le système, telles que l’installation d’un pilote en mode noyau ou l’accès aux espaces de processus au niveau du système.</span><span class="sxs-lookup"><span data-stu-id="893af-143">Like in Windows XP, a standard user cannot write to the Program Files folder, cannot write to the HKEY\_LOCAL\_MACHINE portion of the registry, and cannot perform tasks that alter the system, such as installing a kernel-mode driver or accessing system-level process spaces.</span></span>

<span data-ttu-id="893af-144">Le compte administrateur a été considérablement modifié depuis la sortie de Windows XP.</span><span class="sxs-lookup"><span data-stu-id="893af-144">The Administrator account has significantly changed since Windows XP was released.</span></span> <span data-ttu-id="893af-145">Auparavant, tous les processus lancés par un membre du groupe administrateurs recevaient des privilèges d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="893af-145">Previously, all processes launched by a member of the Administrators group were given administrative privileges.</span></span> <span data-ttu-id="893af-146">Si le contrôle de compte d’utilisateur est activé, tous les processus s’exécutent avec des privilèges d’utilisateur standard, sauf s’ils sont spécifiquement élevés par un administrateur.</span><span class="sxs-lookup"><span data-stu-id="893af-146">With UAC enabled, all processes execute with standard user privileges, unless specifically elevated by an administrator.</span></span> <span data-ttu-id="893af-147">Cette différence rend les comptes du groupe administrateurs plus sécurisés en réduisant le risque de sécurité posé par les bogues potentiels dans la plupart des programmes.</span><span class="sxs-lookup"><span data-stu-id="893af-147">This difference makes accounts in the Administrators group more secure by reducing the security risk posed by potential bugs in most programs.</span></span>

<span data-ttu-id="893af-148">Il est important que toutes les applications, en particulier les jeux, fonctionnent efficacement et de manière responsable lorsqu’elles sont exécutées en tant que processus utilisateur standard.</span><span class="sxs-lookup"><span data-stu-id="893af-148">It is important that all applications, especially games, operate effectively and responsibly when run as a standard user process.</span></span> <span data-ttu-id="893af-149">Toutes les opérations qui requièrent des privilèges d’administration doivent être effectuées au moment de l’installation ou par des programmes auxiliaires qui demandent explicitement des informations d’identification d’administration.</span><span class="sxs-lookup"><span data-stu-id="893af-149">All operations that require administrative privileges should be done either at installation time or by auxiliary programs that explicitly request administrative credentials.</span></span> <span data-ttu-id="893af-150">Bien que l’élévation des privilèges soit assez simple pour un membre du groupe administrateurs, les utilisateurs standard doivent s’en remettre à une personne disposant d’informations d’identification d’administration pour entrer physiquement leur mot de passe pour élever les privilèges.</span><span class="sxs-lookup"><span data-stu-id="893af-150">While privilege elevation is fairly trivial for a member of the Administrators group, standard users must defer to someone with administrative credentials to physically enter their password to elevate privileges.</span></span> <span data-ttu-id="893af-151">Étant donné que les comptes protégés par les contrôles parentaux doivent être des utilisateurs standard, il s’agit d’une situation très courante pour les joueurs qui utilisent Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="893af-151">Since accounts protected by parental controls must be standard users, this will be a very common situation for gamers who are using Windows Vista.</span></span>

<span data-ttu-id="893af-152">Si votre jeu travaille déjà sur Windows XP avec des comptes d’utilisateurs limités, le passage au contrôle de compte d’utilisateur sur Windows Vista doit être très simple.</span><span class="sxs-lookup"><span data-stu-id="893af-152">If your game is already working on Windows XP with limited-user accounts, then the move to User Account Control on Windows Vista should be very easy.</span></span> <span data-ttu-id="893af-153">La plupart de ces applications fonctionneront en l’opération, bien que l’ajout d’un manifeste d’application soit fortement recommandé.</span><span class="sxs-lookup"><span data-stu-id="893af-153">The majority of such applications will work as-is, although adding an application manifest is highly recommended.</span></span> <span data-ttu-id="893af-154">(Les manifestes sont décrits plus loin dans cette rubrique dans [définition du niveau d’exécution dans le manifeste de l’application](#setting-the-execution-level-in-the-application-manifest).)</span><span class="sxs-lookup"><span data-stu-id="893af-154">(Manifests are described later in this topic in [Setting the Execution Level in the Application Manifest](#setting-the-execution-level-in-the-application-manifest).)</span></span>

## <a name="file-access-as-a-standard-user"></a><span data-ttu-id="893af-155">Accès aux fichiers en tant qu’utilisateur standard</span><span class="sxs-lookup"><span data-stu-id="893af-155">File Access as a Standard User</span></span>

<span data-ttu-id="893af-156">L’aspect de votre jeu le plus affecté par les restrictions d’utilisateur standard est l’organisation et l’accessibilité du système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="893af-156">The aspect of your game most affected by standard user restrictions is file system organization and accessibility.</span></span> <span data-ttu-id="893af-157">Vous ne devez jamais supposer que votre jeu peut écrire des fichiers dans le dossier d’installation de votre jeu.</span><span class="sxs-lookup"><span data-stu-id="893af-157">You should never assume that your game can write files to the folder where your game is installed.</span></span> <span data-ttu-id="893af-158">Dans Windows Vista, par exemple, les privilèges des utilisateurs doivent être élevés par le système d’exploitation avant qu’une application puisse écrire dans le dossier Program Files.</span><span class="sxs-lookup"><span data-stu-id="893af-158">In Windows Vista for instance, a user s privileges must be elevated by the operating system before an application can write to the Program Files folder.</span></span> <span data-ttu-id="893af-159">Pour éviter cela, vous devez classer vos fichiers de données de jeu par portée et accessibilité, et utiliser la fonction [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) , ainsi que les constantes CSIDL fournies par le shell Windows, pour générer les chemins d’accès aux fichiers appropriés.</span><span class="sxs-lookup"><span data-stu-id="893af-159">To avoid this, you should categorize your game s data files by scope and accessibility, and use the [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) function, along with the CSIDL constants provided by the Windows shell, to generate the appropriate file paths.</span></span> <span data-ttu-id="893af-160">Les constantes CSIDL correspondent aux dossiers connus dans le système de fichiers que le système d’exploitation utilise et promeut pour partitionner les fichiers globaux et spécifiques à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="893af-160">The CSIDL constants correspond to known folders in the file system that the operating system uses and promotes to partition global and user-specific files.</span></span>

<span data-ttu-id="893af-161">Toute tentative de création ou d’écriture d’un fichier ou d’un répertoire sous un dossier qui n’accorde pas d’autorisation d’écriture au processus échoue sous Windows Vista si l’application ne dispose pas de privilèges d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="893af-161">Attempting to create or write a file or directory under a folder which does not grant write permission to the process will fail under Windows Vista if the application does not have administrative privileges.</span></span> <span data-ttu-id="893af-162">Si votre exécutable de jeu 32 bits s’exécute en mode hérité, car il n’a pas déclaré de niveau d’exécution demandé, ses opérations d’écriture aboutissent, mais elles sont soumises à la virtualisation, comme décrit dans la section « compatibilité UAC avec les anciens jeux », plus loin dans cet article.</span><span class="sxs-lookup"><span data-stu-id="893af-162">If your 32-bit game executable is running in legacy mode, because it did not declare a requested execution level, its write operations will succeed, but they will be subjected to virtualization as described in the section "UAC Compatibility with Older Games" later in this article.</span></span>

<span data-ttu-id="893af-163">**Tableau 1. Dossiers connus**</span><span class="sxs-lookup"><span data-stu-id="893af-163">**Table 1. Known Folders**</span></span>



| <span data-ttu-id="893af-164">Nom de CSIDL</span><span class="sxs-lookup"><span data-stu-id="893af-164">CSIDL Name</span></span>             | <span data-ttu-id="893af-165">Chemin d’accès standard (Windows Vista)</span><span class="sxs-lookup"><span data-stu-id="893af-165">Typical Path (Windows Vista)</span></span>                                                   | <span data-ttu-id="893af-166">Droits d’utilisateur standard</span><span class="sxs-lookup"><span data-stu-id="893af-166">Standard User Rights</span></span> | <span data-ttu-id="893af-167">Droits d'administrateur</span><span class="sxs-lookup"><span data-stu-id="893af-167">Administrator Rights</span></span> | <span data-ttu-id="893af-168">Étendue de l’accès</span><span class="sxs-lookup"><span data-stu-id="893af-168">Access Scope</span></span> | <span data-ttu-id="893af-169">Description</span><span class="sxs-lookup"><span data-stu-id="893af-169">Description</span></span>                                                                                                                      | <span data-ttu-id="893af-170">Exemples</span><span class="sxs-lookup"><span data-stu-id="893af-170">Examples</span></span>                                                          |
|------------------------|--------------------------------------------------------------------------------|----------------------|----------------------|--------------|----------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
| <span data-ttu-id="893af-171">CSIDL \_ personnel</span><span class="sxs-lookup"><span data-stu-id="893af-171">CSIDL\_PERSONAL</span></span>        | <span data-ttu-id="893af-172">C : \\ utilisateurs \\ nom de l’utilisateur \\ documents</span><span class="sxs-lookup"><span data-stu-id="893af-172">C:\\Users\\user name\\Documents</span></span>                                                | <span data-ttu-id="893af-173">Lecture/écriture</span><span class="sxs-lookup"><span data-stu-id="893af-173">Read/Write</span></span>           | <span data-ttu-id="893af-174">Lecture/écriture</span><span class="sxs-lookup"><span data-stu-id="893af-174">Read/Write</span></span>           | <span data-ttu-id="893af-175">Per-User</span><span class="sxs-lookup"><span data-stu-id="893af-175">Per-User</span></span>     | <span data-ttu-id="893af-176">Fichiers de jeu spécifiques à l’utilisateur qui sont lus et modifiés et peuvent être manipulés en dehors du contexte du jeu.</span><span class="sxs-lookup"><span data-stu-id="893af-176">User-specific game files that are read and modified and can be manipulated outside of the game context.</span></span>                          | <span data-ttu-id="893af-177">Captures d’écran.</span><span class="sxs-lookup"><span data-stu-id="893af-177">Screen shots.</span></span> <span data-ttu-id="893af-178">Fichiers de jeu enregistrés avec une association d’extension de fichier.</span><span class="sxs-lookup"><span data-stu-id="893af-178">Saved game files with a file extension association.</span></span> |
| <span data-ttu-id="893af-179">CSIDL \_ local \_ AppData</span><span class="sxs-lookup"><span data-stu-id="893af-179">CSIDL\_LOCAL\_APPDATA</span></span>  | <span data-ttu-id="893af-180">C : \\ Users \\ nom d’utilisateur \\ AppData \\ local</span><span class="sxs-lookup"><span data-stu-id="893af-180">C:\\Users\\user name\\AppData\\Local</span></span>                                           | <span data-ttu-id="893af-181">Lecture/écriture</span><span class="sxs-lookup"><span data-stu-id="893af-181">Read/Write</span></span>           | <span data-ttu-id="893af-182">Lecture/écriture</span><span class="sxs-lookup"><span data-stu-id="893af-182">Read/Write</span></span>           | <span data-ttu-id="893af-183">Per-User</span><span class="sxs-lookup"><span data-stu-id="893af-183">Per-User</span></span>     | <span data-ttu-id="893af-184">Fichiers de jeu spécifiques à l’utilisateur qui sont lus et modifiés et sont uniquement utilisés dans le contexte du jeu.</span><span class="sxs-lookup"><span data-stu-id="893af-184">User-specific game files that are read and modified and are of use only within the game context.</span></span>                                 | <span data-ttu-id="893af-185">Fichiers du cache de jeu.</span><span class="sxs-lookup"><span data-stu-id="893af-185">Game cache files.</span></span> <span data-ttu-id="893af-186">Configurations de lecteur.</span><span class="sxs-lookup"><span data-stu-id="893af-186">Player configurations.</span></span>                          |
| <span data-ttu-id="893af-187">CSIDL \_ Common \_ AppData</span><span class="sxs-lookup"><span data-stu-id="893af-187">CSIDL\_COMMON\_APPDATA</span></span> | <span data-ttu-id="893af-188">C : \\ ProgramData</span><span class="sxs-lookup"><span data-stu-id="893af-188">C:\\ProgramData</span></span>                                                                | <span data-ttu-id="893af-189">Lecture/écriture si propriétaire</span><span class="sxs-lookup"><span data-stu-id="893af-189">Read/Write if owner</span></span>  | <span data-ttu-id="893af-190">Lecture/écriture</span><span class="sxs-lookup"><span data-stu-id="893af-190">Read/Write</span></span>           | <span data-ttu-id="893af-191">Tous les utilisateurs</span><span class="sxs-lookup"><span data-stu-id="893af-191">All Users</span></span>    | <span data-ttu-id="893af-192">Fichiers de jeu qui peuvent être créés par un utilisateur et lus par tous les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="893af-192">Game files that can be created by a user and read by all users.</span></span> <span data-ttu-id="893af-193">L’accès en écriture est accordé uniquement au créateur du fichier (propriétaire).</span><span class="sxs-lookup"><span data-stu-id="893af-193">Write access is granted only to the creator of the file (owner).</span></span> | <span data-ttu-id="893af-194">Profils utilisateur</span><span class="sxs-lookup"><span data-stu-id="893af-194">User Profiles</span></span>                                                     |
| <span data-ttu-id="893af-195">\_fichiers programme \_ CSIDL</span><span class="sxs-lookup"><span data-stu-id="893af-195">CSIDL\_PROGRAM\_FILES</span></span>  | <span data-ttu-id="893af-196">C : \\ Program Files</span><span class="sxs-lookup"><span data-stu-id="893af-196">C:\\Program Files</span></span><br/> <span data-ttu-id="893af-197">ou</span><span class="sxs-lookup"><span data-stu-id="893af-197">or</span></span><br/> <span data-ttu-id="893af-198">C : \\ Program Files (x86)</span><span class="sxs-lookup"><span data-stu-id="893af-198">C:\\Program Files (x86)</span></span> <br/> | <span data-ttu-id="893af-199">Lecture seule</span><span class="sxs-lookup"><span data-stu-id="893af-199">Read only</span></span>            | <span data-ttu-id="893af-200">Lecture/écriture</span><span class="sxs-lookup"><span data-stu-id="893af-200">Read/Write</span></span>           | <span data-ttu-id="893af-201">Tous les utilisateurs</span><span class="sxs-lookup"><span data-stu-id="893af-201">All Users</span></span>    | <span data-ttu-id="893af-202">Fichiers de jeux statiques écrits par le programme d’installation du jeu qui sont lus par tous les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="893af-202">Static game files written by the game s installer that are read by all users.</span></span>                                                    | <span data-ttu-id="893af-203">Ressources de jeu, telles que des matériaux et des mailles.</span><span class="sxs-lookup"><span data-stu-id="893af-203">Game assets, such as materials and meshes.</span></span>                        |



 

<span data-ttu-id="893af-204">Votre jeu est généralement installé dans un dossier sous le dossier représenté par la \_ \_ constante fichiers programmes CSIDL.</span><span class="sxs-lookup"><span data-stu-id="893af-204">Your game will typically be installed in a folder under the folder represented by the CSIDL\_PROGRAM\_FILES constant.</span></span> <span data-ttu-id="893af-205">Toutefois, ce n'est pas toujours le cas.</span><span class="sxs-lookup"><span data-stu-id="893af-205">However, this is not always the case.</span></span> <span data-ttu-id="893af-206">Au lieu de cela, vous devez utiliser un chemin d’accès relatif à partir de votre fichier exécutable lors de la génération de chaînes de chemin d’accès aux fichiers ou répertoires situés sous votre dossier d’installation.</span><span class="sxs-lookup"><span data-stu-id="893af-206">You should instead use a relative path from your executable file when generating path strings to files or directories located under your installation folder.</span></span>

<span data-ttu-id="893af-207">Vous devez également vous abstenir des hypothèses codées en dur sur les chemins d’accès aux dossiers connus.</span><span class="sxs-lookup"><span data-stu-id="893af-207">You should also refrain from hard-coded assumptions about the known folder paths.</span></span> <span data-ttu-id="893af-208">Par exemple, sur Windows XP Professionnel 64-bit Edition et Windows Vista x64, le chemin d’accès aux fichiers programme est C : \\ Program Files (x86) pour les programmes 32 bits et c : \\ Program Files pour les programmes 64 bits.</span><span class="sxs-lookup"><span data-stu-id="893af-208">For example, on Windows XP Professional 64-bit Edition and Windows Vista x64, the program files path is C:\\Program Files (x86) for 32-bit programs and C:\\Program Files for 64-bit programs.</span></span> <span data-ttu-id="893af-209">Ces chemins d’accès connus sont modifiés par rapport à Windows XP, et les utilisateurs peuvent reconfigurer l’emplacement d’un grand nombre de ces dossiers et même les localiser sur des lecteurs différents.</span><span class="sxs-lookup"><span data-stu-id="893af-209">These known paths are changed from Windows XP, and users can reconfigure the location of many of these folders and even locate them on different drives.</span></span> <span data-ttu-id="893af-210">Par conséquent, utilisez toujours les constantes CSIDL pour éviter les confusions et les problèmes potentiels.</span><span class="sxs-lookup"><span data-stu-id="893af-210">So, always use the CSIDL constants to avoid confusion and potential problems.</span></span> <span data-ttu-id="893af-211">Installation de Windows comprend ces emplacements de dossiers connus et déplace les données lors de la mise à niveau du système d’exploitation à partir de Windows XP. en revanche, l’utilisation d’emplacements non standard ou de chemins d’accès codés en dur peut échouer après une mise à niveau du système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="893af-211">Windows Setup understands these known folder locations and will move the data when upgrading the operating system from Windows XP; in contrast, use of non-standard locations or hard-coded paths may well fail after an OS upgrade.</span></span>

<span data-ttu-id="893af-212">Une attention particulière doit être accordée aux différences discrètes d’utilisation entre les dossiers spécifiques à l’utilisateur spécifiés par CSIDL \_ Personal et CSIDL \_ local \_ AppData.</span><span class="sxs-lookup"><span data-stu-id="893af-212">Attention should be given to the subtle usability differences between the user-specific folders specified by CSIDL\_PERSONAL and CSIDL\_LOCAL\_APPDATA.</span></span> <span data-ttu-id="893af-213">La pratique recommandée pour la sélection de la constante CSIDL à utiliser pour l’écriture d’un fichier consiste à utiliser le paramètre CSIDL \_ Personal si l’utilisateur doit interagir avec le fichier, par exemple en double-cliquant dessus pour l’ouvrir dans un outil ou une application, et pour utiliser CSIDL \_ local \_ AppData pour d’autres fichiers.</span><span class="sxs-lookup"><span data-stu-id="893af-213">The recommended practice for selecting the CSIDL constant to use for writing a file is to use CSIDL\_PERSONAL if the user is expected to interact with the file, such as double-clicking on it to open it in a tool or application, and to use CSIDL\_LOCAL\_APPDATA for other files.</span></span> <span data-ttu-id="893af-214">Les deux dossiers peuvent être exploités par votre application pour stocker et organiser les fichiers de données spécifiques à l’utilisateur, car il n’existe aucune différence au niveau de leur étendue d’accès ou de leurs privilèges.</span><span class="sxs-lookup"><span data-stu-id="893af-214">Both folders can be leveraged by your application to store and organize user-specific data files, as there is no difference in their access scope or privilege level.</span></span> <span data-ttu-id="893af-215">Veillez à créer des noms de chemin d’accès qui sont suffisamment uniques pour ne pas entrer en conflit avec d’autres applications, mais suffisamment court pour conserver le nombre de caractères dans le chemin d’accès complet inférieur à la valeur du \_ chemin d’accès maximal, 260.</span><span class="sxs-lookup"><span data-stu-id="893af-215">Care should be taken to create path names that are unique enough to not collide with other applications, but short enough to keep the number of characters in the full path fewer than the value of MAX\_PATH, 260.</span></span>

<span data-ttu-id="893af-216">Le code suivant fournit un exemple d’écriture d’un fichier dans un dossier connu :</span><span class="sxs-lookup"><span data-stu-id="893af-216">The following code provides an example of how to write a file to a known folder:</span></span>

``` syntax
#include <windows.h>
#include <shlobj.h>
#include <shlwapi.h>
        ...
        ...
        ...
        TCHAR strPath[MAX_PATH];
        if( SUCCEEDED(
        SHGetFolderPath( NULL, CSIDL_PERSONAL, NULL, SHGFP_TYPE_CURRENT, strPath ) ) )
        {
        PathAppend( strPath, TEXT( "Company Name\\Title" ) );

        if( !PathFileExists( strPath ) )
        {
        if( ERROR_SUCCESS != SHCreateDirectoryEx( NULL, strPath, NULL ) )
        return E_FAIL;
        }

        PathAppend( strPath, TEXT( "gamefile.txt" ) );

        // strPath is now something like:
        // C:\Users\<current user>\Documents\Company Name\Title\gamefile.txt
        // Open the file for writing
        HANDLE hFile = CreateFile(strPath, GENERIC_WRITE, NULL, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);

        if( INVALID_HANDLE_VALUE != hFile )
        {
        // TODO: Write to file
        CloseHandle(hFile);
        }
        }
```

## <a name="registry-access-as-a-standard-user"></a><span data-ttu-id="893af-217">Accès au registre en tant qu’utilisateur standard</span><span class="sxs-lookup"><span data-stu-id="893af-217">Registry Access as a Standard User</span></span>

<span data-ttu-id="893af-218">L’accès au registre par un utilisateur standard est limité de la même façon que le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="893af-218">Registry access by a standard user is restricted in a similar fashion as the file system.</span></span> <span data-ttu-id="893af-219">Un utilisateur standard est autorisé à accéder en lecture à toutes les clés dans le registre ; Toutefois, l’accès en écriture est accordé uniquement à \_ la \_ sous-arborescence HKEY CURRENT USER (HKCU), qui est mappée en interne à la sous-clé spécifique à l’utilisateur HKEY \_ Users \\ ID de sécurité (SID) de l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="893af-219">A standard user is permitted read access to all keys in the registry; however, write access is only granted to the HKEY\_CURRENT\_USER (HKCU) subtree, which is mapped internally to the user-specific subkey HKEY\_USERS\\Security ID (SID) of current user.</span></span> <span data-ttu-id="893af-220">Une application qui doit écrire dans n’importe quel emplacement du Registre autre que HKEY \_ Current \_ User requiert des privilèges d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="893af-220">An application that needs to write to any registry location other than HKEY\_CURRENT\_USER requires administrative privileges.</span></span>

<span data-ttu-id="893af-221">Si l’application 32 bits ne contient pas de niveau d’exécution demandé dans son manifeste, toutes les écritures dans HKEY \_ local \_ machine \\ Software sont virtualisées, alors que les écritures dans d’autres emplacements en dehors de HKEY \_ Current \_ User échouent.</span><span class="sxs-lookup"><span data-stu-id="893af-221">If the 32-bit application does not contain a requested execution level in its manifest, then all writes to HKEY\_LOCAL\_MACHINE\\Software will be virtualized, while writes to other locations outside of HKEY\_CURRENT\_USER will fail.</span></span>

<span data-ttu-id="893af-222">Le stockage de données persistantes dans le registre, comme la configuration d’un utilisateur, n’est pas recommandé.</span><span class="sxs-lookup"><span data-stu-id="893af-222">Storing persistent data in the registry, like a user's configuration, is not recommended.</span></span> <span data-ttu-id="893af-223">La méthode recommandée pour le stockage des données persistantes à partir de votre jeu consiste à écrire les données dans le système de fichiers en appelant [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) et à obtenir la valeur d’une constante CSIDL, décrite dans la section précédente.</span><span class="sxs-lookup"><span data-stu-id="893af-223">The preferred method of storing persistent data from your game is to write the data to the file system by calling [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) and to get the value of a CSIDL constant, described in the previous section.</span></span>

## <a name="privilege-elevation"></a><span data-ttu-id="893af-224">Privilege Elevation (élévation des privilèges)</span><span class="sxs-lookup"><span data-stu-id="893af-224">Privilege Elevation</span></span>

<span data-ttu-id="893af-225">Dans Windows Vista, toute application nécessitant des privilèges d’administrateur doit déclarer une demande de niveau d’exécution d’administration dans son manifeste (décrit dans la section suivante, [définition du niveau d’exécution dans le manifeste de l’application](#setting-the-execution-level-in-the-application-manifest)).</span><span class="sxs-lookup"><span data-stu-id="893af-225">In Windows Vista, any application that requires administrative privileges must declare a request for an administrative execution level in its manifest (described in the next section, [Setting the Execution Level in the Application Manifest](#setting-the-execution-level-in-the-application-manifest)).</span></span>

<span data-ttu-id="893af-226">L’élévation, telle qu’elle est connue, est la procédure pilotée par UAC pour promouvoir un processus en processus d’administration.</span><span class="sxs-lookup"><span data-stu-id="893af-226">Elevation, as it is known, is the procedure driven by UAC to promote a process to an administrative process.</span></span> <span data-ttu-id="893af-227">Les privilèges d’un processus ne peuvent être élevés qu’au moment de la création.</span><span class="sxs-lookup"><span data-stu-id="893af-227">The privileges of a process can only be elevated at creation time.</span></span> <span data-ttu-id="893af-228">Une fois créé, un processus n’est jamais promu à un niveau de privilège supérieur.</span><span class="sxs-lookup"><span data-stu-id="893af-228">Once created, a process will never be promoted to a higher privilege level.</span></span> <span data-ttu-id="893af-229">Pour cette raison.</span><span class="sxs-lookup"><span data-stu-id="893af-229">For this reason.</span></span> <span data-ttu-id="893af-230">les opérations qui requièrent des informations d’identification d’administration doivent être isolées dans des programmes d’installation distincts et d’autres programmes auxiliaires.</span><span class="sxs-lookup"><span data-stu-id="893af-230">operations that require administrative credentials should be isolated to separate installers and other auxiliary programs.</span></span>

<span data-ttu-id="893af-231">Lors de l’exécution d’un programme, le contrôle de compte d’utilisateur inspecte le niveau d’exécution demandé dans le manifeste et, si des privilèges élevés sont requis, invite l’utilisateur actuel à l’une des deux boîtes de dialogue standard : l’une pour un utilisateur standard et l’autre pour un administrateur.</span><span class="sxs-lookup"><span data-stu-id="893af-231">Upon execution of a program, UAC inspects the requested execution level in the manifest, and if elevated privileges are required, prompts the current user with one of two standard dialog boxes: one for a standard user and one for an administrator.</span></span>

<span data-ttu-id="893af-232">Si l’utilisateur actuel est un utilisateur standard, le contrôle de compte d’utilisateur invite l’utilisateur à fournir les informations d’identification d’un administrateur avant d’autoriser l’exécution du programme.</span><span class="sxs-lookup"><span data-stu-id="893af-232">If the current user is a standard user, UAC prompts the user for the credentials of an administrator before allowing the program to run.</span></span>

<span data-ttu-id="893af-233">**Figure 1. Demander à un utilisateur standard d’entrer les informations d’identification d’un compte d’administration**</span><span class="sxs-lookup"><span data-stu-id="893af-233">**Figure 1. Prompt for a Standard User to enter credentials for an administrative account**</span></span>

![demander à un utilisateur standard d’entrer les informations d’identification d’un compte d’administration](images/uac-prompt-elevation.jpg)

<span data-ttu-id="893af-235">Si l’utilisateur actuel est un administrateur, le contrôle de compte d’utilisateur demande l’autorisation à l’utilisateur avant d’autoriser son exécution.</span><span class="sxs-lookup"><span data-stu-id="893af-235">If the current user is an administrator, UAC prompts the user for permission before allowing the program to run.</span></span>

<span data-ttu-id="893af-236">**Figure 2. Demander à un administrateur d’autoriser les modifications apportées à l’ordinateur**</span><span class="sxs-lookup"><span data-stu-id="893af-236">**Figure 2. Prompt for an Administrator to authorize changes to the computer**</span></span>

![demander à un administrateur d’autoriser les modifications apportées à l’ordinateur](images/uac-prompt-authorization.jpg)

<span data-ttu-id="893af-238">L’application reçoit uniquement des privilèges d’administrateur si un utilisateur standard fournit les informations d’identification d’administration appropriées ou si un utilisateur administratif fournit un accusé de réception. tout autre résultat entraîne l’arrêt de l’application.</span><span class="sxs-lookup"><span data-stu-id="893af-238">The application will only be granted administrative privileges if a standard user provides the proper administrative credentials or an administrative user provides acknowledgement; anything else will cause the application to terminate.</span></span>

<span data-ttu-id="893af-239">Il est important de noter qu’un processus avec des privilèges élevés s’exécute en tant qu’utilisateur administratif qui a entré les informations d’identification dans l’invite UAC plutôt qu’en tant qu’utilisateur standard actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="893af-239">It is important to note that a process with elevated privileges runs as the administrative user who entered credentials in the UAC prompt rather than as the standard user who is currently logged in.</span></span> <span data-ttu-id="893af-240">Cela est similaire à **runas** dans Windows XP. le processus avec élévation de privilèges obtient le dossier et les clés de registre de l’administrateur lors de l’accès aux données par utilisateur, et tous les programmes lancés par le processus avec élévation de privilèges héritent également des droits d’administration et des emplacements de compte d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="893af-240">This is similar to **RunAs** in Windows XP   the elevated process gets the administrator's folder and registry keys when accessing per-user data, and all programs that the elevated process launches also inherit both the administrative rights and user account locations.</span></span> <span data-ttu-id="893af-241">Pour les administrateurs qui sont invités à accepter un accusé de réception (**Continuer** ou **Annuler**), ces emplacements correspondent aux emplacements de l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="893af-241">For administrators who are prompted for acknowledgement (**Continue** or **Cancel**), these locations will match the currently user's locations.</span></span> <span data-ttu-id="893af-242">En général, toutefois, les processus qui nécessitent une élévation ne doivent pas fonctionner sur les données par utilisateur.</span><span class="sxs-lookup"><span data-stu-id="893af-242">In general, however, processes that require elevation should not operate on per-user data.</span></span> <span data-ttu-id="893af-243">Notez que cela peut avoir un impact considérable sur la façon dont votre programme d’installation doit fonctionner.</span><span class="sxs-lookup"><span data-stu-id="893af-243">Note that this can substantially affect how your installer must operate!</span></span> <span data-ttu-id="893af-244">Si le programme d’installation, exécuté en tant qu’administrateur, écrit dans HKCU ou dans le profil d’un utilisateur, il peut très bien écrire dans un emplacement incorrect.</span><span class="sxs-lookup"><span data-stu-id="893af-244">If the installer, running as an administrator, writes to HKCU or to a user's profile, it may very well be writing to the wrong location.</span></span> <span data-ttu-id="893af-245">Envisagez de créer ces valeurs par utilisateur lors de la première exécution du jeu.</span><span class="sxs-lookup"><span data-stu-id="893af-245">Consider creating these per-user values upon the first run of the game.</span></span>

## <a name="uac-implications-with-createprocess"></a><span data-ttu-id="893af-246">Implications du contrôle de compte d’utilisateur avec CreateProcess ()</span><span class="sxs-lookup"><span data-stu-id="893af-246">UAC Implications with CreateProcess()</span></span>

<span data-ttu-id="893af-247">Le mécanisme d’élévation du contrôle de compte d’utilisateur ne sera pas appelé à partir d’un appel à la fonction Win32 [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa)() pour démarrer un exécutable configuré pour exiger un niveau d’exécution plus élevé que le processus actuel.</span><span class="sxs-lookup"><span data-stu-id="893af-247">The UAC elevation mechanism will not be invoked from a call to the Win32 [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa)() function to start an executable which is configured to require a higher execution level than the current process.</span></span> <span data-ttu-id="893af-248">Par conséquent, l’appel à **CreateProcess**() échouera avec [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror)() qui retournerait l’élévation d’erreurs \_ \_ requise.</span><span class="sxs-lookup"><span data-stu-id="893af-248">As a result, the call to **CreateProcess**() will fail with [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror)() returning ERROR\_ELEVATION\_REQUIRED.</span></span> <span data-ttu-id="893af-249">**CreateProcess**() ne fonctionnera que si le niveau d’exécution de l’appelé est égal à ou inférieur à celui de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="893af-249">**CreateProcess**() will only succeed when the execution level of the callee is equal-to or less-than that of the caller.</span></span> <span data-ttu-id="893af-250">Un processus non élevé qui doit générer des processus élevés doit le faire à l’aide de la fonction [**ShellExecute**](/windows/win32/api/shellapi/nf-shellapi-shellexecutea)(), ce qui entraîne le déclenchement du mécanisme d’élévation du contrôle de compte d’utilisateur au moyen de l’interpréteur de commandes.</span><span class="sxs-lookup"><span data-stu-id="893af-250">A non-elevated process that must spawn elevated processes should do so using the [**ShellExecute**](/windows/win32/api/shellapi/nf-shellapi-shellexecutea)() function, which will cause the UAC elevation mechanism to be triggered by means of the shell.</span></span>

## <a name="setting-the-execution-level-in-the-application-manifest"></a><span data-ttu-id="893af-251">Définition du niveau d’exécution dans le manifeste de l’application</span><span class="sxs-lookup"><span data-stu-id="893af-251">Setting the Execution Level in the Application Manifest</span></span>

<span data-ttu-id="893af-252">Vous déclarez le niveau d’exécution demandé de votre jeu en ajoutant une extension au manifeste de l’application.</span><span class="sxs-lookup"><span data-stu-id="893af-252">You declare the requested execution level of your game by adding an extension to the application s manifest.</span></span> <span data-ttu-id="893af-253">Le code XML suivant montre la configuration minimale requise pour définir le niveau d’exécution d’une application :</span><span class="sxs-lookup"><span data-stu-id="893af-253">The following XML code shows the minimal configuration required to set the execution level for an application:</span></span>

``` syntax
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <ms_asmv2:trustInfo xmlns:ms_asmv2="urn:schemas-microsoft-com:asm.v2">
        <ms_asmv2:security>
            <ms_asmv2:requestedPrivileges>
                <ms_asmv2:requestedExecutionLevel level="asInvoker" uiAccess="false" />
            </ms_asmv2:requestedPrivileges>
        </ms_asmv2:security>
    </ms_asmv2:trustInfo>
</assembly>
```

<span data-ttu-id="893af-254">Dans le code précédent, le système d’exploitation est informé que le jeu nécessite uniquement des privilèges d’utilisateur standard à l’aide de la balise suivante :</span><span class="sxs-lookup"><span data-stu-id="893af-254">In the preceding code, the operating system is informed that the game only requires standard user privileges by the following tag:</span></span>

``` syntax
<ms_asmv2:requestedExecutionLevel level="asInvoker" uiAccess="false" />
```

<span data-ttu-id="893af-255">En affectant explicitement à requestedExecutionLevel la valeur « asInvoker », cet exemple déclare au système d’exploitation que le jeu se comportera correctement sans privilèges administratifs.</span><span class="sxs-lookup"><span data-stu-id="893af-255">By explicitly setting requestedExecutionLevel to "asInvoker", this example asserts to the operating system that the game will behave properly without administrative privileges.</span></span> <span data-ttu-id="893af-256">Par conséquent, le contrôle de compte d’utilisateur désactive la virtualisation et exécute le jeu avec les mêmes privilèges que le demandeur, qui est généralement des privilèges utilisateur standard, puisque l’Explorateur Windows s’exécute en tant qu’utilisateur standard.</span><span class="sxs-lookup"><span data-stu-id="893af-256">As a result, UAC disables virtualization and runs the game with the same privileges as the invoker   which is typically standard user privileges, since Windows Explorer runs as standard user.</span></span>

<span data-ttu-id="893af-257">Le système d’exploitation peut être informé qu’un jeu requiert une élévation aux privilèges d’administrateur en remplaçant « asInvoker » par « requireAdministrator » pour créer la balise suivante :</span><span class="sxs-lookup"><span data-stu-id="893af-257">The operating system can be informed a game requires elevation to administrative privileges by replacing "asInvoker" with "requireAdministrator", to create the following tag:</span></span>

``` syntax
<ms_asmv2:requestedExecutionLevel level="requireAdministrator" uiAccess="false" />
```

<span data-ttu-id="893af-258">Avec cette configuration, le système d’exploitation invite l’utilisateur actuel à utiliser l’une des boîtes de dialogue d’élévation du contrôle de compte d’utilisateur standard chaque fois que le jeu est exécuté.</span><span class="sxs-lookup"><span data-stu-id="893af-258">With this configuration, the operating system prompts the current user with one of the standard UAC elevation dialogs every time that the game is executed.</span></span> <span data-ttu-id="893af-259">Il est fortement recommandé qu’aucun jeu ne requière des privilèges d’administrateur pour s’exécuter, car non seulement cette boîte de dialogue devient rapidement gênante, mais elle rend également le jeu incompatible avec les contrôles parentaux.</span><span class="sxs-lookup"><span data-stu-id="893af-259">It is highly recommended that no game require administrator privileges to run, because not only will this dialog quickly become annoying, but it also makes the game incompatible with parental controls.</span></span> <span data-ttu-id="893af-260">Réfléchissez soigneusement avant d’ajouter cette exigence à n’importe quel exécutable.</span><span class="sxs-lookup"><span data-stu-id="893af-260">Think very carefully before adding this requirement to any executable.</span></span>

<span data-ttu-id="893af-261">Une idée fausse courante est que l’ajout d’un manifeste qui affecte à requestedExecutionLevel la valeur « requireAdministrator » ignore la nécessité d’une invite d’élévation.</span><span class="sxs-lookup"><span data-stu-id="893af-261">A common misconception is that adding a manifest that sets requestedExecutionLevel to "requireAdministrator" bypasses the need for an elevation prompt.</span></span> <span data-ttu-id="893af-262">Ce n’est pas vrai.</span><span class="sxs-lookup"><span data-stu-id="893af-262">This is not true.</span></span> <span data-ttu-id="893af-263">Cela évite simplement au système d’exploitation de deviner si votre application de mise à jour ou de configuration a besoin de privilèges d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="893af-263">It simply prevents the operating system from guessing whether your setup or update application needs administrative privileges.</span></span> <span data-ttu-id="893af-264">L’utilisateur est toujours invité à autoriser l’élévation.</span><span class="sxs-lookup"><span data-stu-id="893af-264">The user is still prompted to authorize elevation.</span></span>

<span data-ttu-id="893af-265">Windows vérifie la signature de toute application marquée pour l’élévation avant d’afficher l’invite UAC.</span><span class="sxs-lookup"><span data-stu-id="893af-265">Windows checks the signature of any application that is marked for elevation before it displays the UAC prompt.</span></span> <span data-ttu-id="893af-266">Un exécutable volumineux marqué pour l’élévation prend plus de temps que le nombre de petits exécutables et plus long qu’un exécutable marqué comme « asInvoker ».</span><span class="sxs-lookup"><span data-stu-id="893af-266">A large executable that is marked for elevation takes longer to check than a small executable and longer than an executable that is marked as "asInvoker".</span></span> <span data-ttu-id="893af-267">Les exécutables d’installation qui sont à extraction automatique doivent, par conséquent, être marqués comme « asInvoker » et toute partie qui doit être marquée comme « requireAdministrator » doit être placée dans un exécutable d’assistance séparé.</span><span class="sxs-lookup"><span data-stu-id="893af-267">Setup executables that are self-extracting should, therefore, be marked as "asInvoker", and any portion that needs to be marked as "requireAdministrator" should be placed in a separate helper executable.</span></span>

<span data-ttu-id="893af-268">L’attribut uiAccess, présenté dans les exemples précédents, doit toujours avoir la valeur FALSe pour les jeux.</span><span class="sxs-lookup"><span data-stu-id="893af-268">The uiAccess attribute, shown in the preceding examples, should always be FALSE for games.</span></span> <span data-ttu-id="893af-269">Cet attribut spécifie si les clients UI Automation ont accès à l’interface utilisateur du système protégé et qu’ils ont des implications spéciales en matière de sécurité si la valeur est TRUE.</span><span class="sxs-lookup"><span data-stu-id="893af-269">This attribute specifies whether UI automation clients have access to the protected system UI, and it has special security implications if set to TRUE.</span></span>

## <a name="embedding-a-manifest-in-visual-studio"></a><span data-ttu-id="893af-270">Incorporation d’un manifeste dans Visual Studio</span><span class="sxs-lookup"><span data-stu-id="893af-270">Embedding a Manifest in Visual Studio</span></span>

<span data-ttu-id="893af-271">La prise en charge du manifeste a été ajoutée pour la première fois à Visual Studio à partir d’VS2005.</span><span class="sxs-lookup"><span data-stu-id="893af-271">Manifest support was first added to Visual Studio beginning in VS2005.</span></span> <span data-ttu-id="893af-272">Par défaut, un fichier exécutable créé dans Visual Studio 2005 (ou une version ultérieure) aura un manifeste généré automatiquement incorporé dans le cadre du processus de génération.</span><span class="sxs-lookup"><span data-stu-id="893af-272">By default, an executable built in Visual Studio 2005 (or newer) will have an auto-generated manifest embedded in it as part of the build process.</span></span> <span data-ttu-id="893af-273">Le contenu du manifeste généré automatiquement dépend de certaines configurations de projet que vous spécifiez dans la boîte de dialogue Propriétés du projet.</span><span class="sxs-lookup"><span data-stu-id="893af-273">The contents of the auto-generated manifest are dependent on certain project configurations that you specify in the project properties dialog.</span></span>

<span data-ttu-id="893af-274">Le manifeste généré automatiquement par Visual Studio 2005 ne contient pas de <trustInfo> bloc, car il n’existe aucun moyen de configurer le niveau d’exécution du contrôle de compte d’utilisateur dans les propriétés du projet.</span><span class="sxs-lookup"><span data-stu-id="893af-274">The manifest that is auto-generated by Visual Studio 2005 will not contain a <trustInfo> block as there is no way to configure the UAC execution level in the project properties.</span></span> <span data-ttu-id="893af-275">La meilleure façon d’ajouter ces informations est de laisser VS2005 fusionner un manifeste défini par l’utilisateur contenant le <trustInfo> bloc avec le manifeste généré automatiquement.</span><span class="sxs-lookup"><span data-stu-id="893af-275">The preferred way to add this information is to let VS2005 merge a user-defined manifest containing the <trustInfo> block with the auto-generated manifest.</span></span> <span data-ttu-id="893af-276">C’est aussi simple que d’ajouter un \* fichier. manifest à votre solution qui contient le code XML mentionné dans la section précédente.</span><span class="sxs-lookup"><span data-stu-id="893af-276">This is as simple as adding a \*.manifest file to your solution that contains the XML listed in the previous section.</span></span> <span data-ttu-id="893af-277">Lorsque Visual Studio rencontre un fichier. manifest dans votre solution, il appellera automatiquement l’outil manifeste (mt.exe) pour fusionner les fichiers. manifest avec l’objet généré automatiquement.</span><span class="sxs-lookup"><span data-stu-id="893af-277">When Visual Studio encounters a .manifest file in your solution, it will automatically invoke the Manifest Tool (mt.exe) to merge the .manifest files with the auto-generated one.</span></span>

> [!Note]  
> <span data-ttu-id="893af-278">Il existe un bogue dans l’outil Manifest (mt.exe) fourni par Visual Studio 2005 qui produit un manifeste fusionné et incorporé qui peut provoquer des problèmes lorsque l’exécutable est exécuté sur Windows XP avant SP3.</span><span class="sxs-lookup"><span data-stu-id="893af-278">There is a bug in the Manifest Tool (mt.exe) provided by Visual Studio 2005 that results in a merged and embedded manifest which can cause problems when the executable is run on Windows XP prior to SP3.</span></span> <span data-ttu-id="893af-279">Le bogue est dû à la manière dont l’outil redéfinit l’espace de noms par défaut lors de la déclaration du <trustInfo> bloc.</span><span class="sxs-lookup"><span data-stu-id="893af-279">The bug is a result of how the tool redefines the default namespace upon declaration of the <trustInfo> block.</span></span> <span data-ttu-id="893af-280">Heureusement, il est facile de contourner le problème en déclarant explicitement un espace de noms différent dans le <trustInfo> bloc et en établissant une portée des nœuds enfants pour le nouvel espace de noms.</span><span class="sxs-lookup"><span data-stu-id="893af-280">Fortunately, it is easy to bypass the issue entirely by explicitly declaring a different namespace in the <trustInfo> block and by scoping the child nodes to the new namespace.</span></span> <span data-ttu-id="893af-281">Le code XML fourni dans la section précédente illustre ce correctif.</span><span class="sxs-lookup"><span data-stu-id="893af-281">The XML provided in the previous section demonstrates this fix.</span></span>

 

<span data-ttu-id="893af-282">L’inconvénient de l’utilisation de l’outil mt.exe inclus dans Visual Studio 2005 est qu’il génère un avertissement lors du traitement du <trustInfo> bloc, car l’outil ne contient pas de schéma mis à jour pour valider le code XML.</span><span class="sxs-lookup"><span data-stu-id="893af-282">A caveat in using the mt.exe tool included in Visual Studio 2005 is that it will generate a warning when processing the <trustInfo> block as the tool does not contain an updated schema to validate the XML against.</span></span> <span data-ttu-id="893af-283">Pour remédier à cet avertissement, il est recommandé de remplacer tous les fichiers mt.exe sous le répertoire d’installation de Visual Studio 2005 (plusieurs instances) par le mt.exe fourni dans le SDK Windows le plus récent.</span><span class="sxs-lookup"><span data-stu-id="893af-283">To remedy this warning, it is recommended that you replace all mt.exe files under the Visual Studio 2005 install directory (there are multiple instances) with the mt.exe provided in the latest Windows SDK.</span></span>

<span data-ttu-id="893af-284">À compter de Visual Studio 2008, vous pouvez maintenant spécifier le niveau d’exécution d’une application à partir de la boîte de dialogue des propriétés du projet (figure 3) ou à l’aide de l’indicateur de l’éditeur de liens/MANIFESTUAC.</span><span class="sxs-lookup"><span data-stu-id="893af-284">Beginning in Visual Studio 2008, you can now specify an application's execution level from within the project properties dialog (Figure 3), or by using the /MANIFESTUAC linker flag.</span></span> <span data-ttu-id="893af-285">La définition de ces options entraîne la génération automatique par Visual Studio 2008 et l’incorporation d’un manifeste avec le <trustInfo> bloc approprié dans l’exécutable.</span><span class="sxs-lookup"><span data-stu-id="893af-285">Setting these options will cause Visual Studio 2008 to auto-generate and embed a manifest with the appropriate <trustInfo> block into the executable.</span></span>

<span data-ttu-id="893af-286">**Figure 3. Définition du niveau d’exécution dans Visual Studio 2008**</span><span class="sxs-lookup"><span data-stu-id="893af-286">**Figure 3. Setting the execution level in Visual Studio 2008**</span></span>

![définition du niveau d’exécution dans Visual Studio 2008](images/setting-execution-level-in-vs2008.jpg)

<span data-ttu-id="893af-288">L’incorporation d’un manifeste dans les anciennes versions de Visual Studio sans prise en charge du manifeste est toujours possible, mais nécessite davantage de travail du développeur.</span><span class="sxs-lookup"><span data-stu-id="893af-288">Embedding a manifest in older versions of Visual Studio without manifest support is still possible, but does require more work from the developer.</span></span> <span data-ttu-id="893af-289">Pour obtenir un exemple sur la façon de procéder, consultez le projet Visual Studio 2003 inclus dans un exemple du kit de développement logiciel (SDK) DirectX antérieur à la version de mars 2008.</span><span class="sxs-lookup"><span data-stu-id="893af-289">For an example on how to do this, please examine the Visual Studio 2003 project included in any sample in the DirectX SDK prior to the March 2008 release.</span></span>

## <a name="uac-compatibility-with-older-games"></a><span data-ttu-id="893af-290">Compatibilité UAC avec les anciens jeux</span><span class="sxs-lookup"><span data-stu-id="893af-290">UAC Compatibility with Older Games</span></span>

<span data-ttu-id="893af-291">Si votre jeu semble enregistrer et charger correctement un fichier dans le répertoire Program Files, mais pas de preuve du fichier sous Windows Vista, toute application 32 bits qui ne contient pas de niveau d’exécution demandé dans son manifeste est considérée comme une application héritée.</span><span class="sxs-lookup"><span data-stu-id="893af-291">If your game appears to be saving and loading a file successfully to the Program Files directory, yet no evidence of the file iOn Windows Vista, any 32-bit application that does not contain a requested execution level in its manifest is considered a legacy application.</span></span> <span data-ttu-id="893af-292">Avant Windows Vista, la plupart des applications étaient généralement exécutées par des utilisateurs disposant de privilèges d’administration.</span><span class="sxs-lookup"><span data-stu-id="893af-292">Prior to Windows Vista, most applications were typically run by users with administrative privileges.</span></span> <span data-ttu-id="893af-293">Par conséquent, ces applications pouvaient lire et écrire librement des fichiers système et des clés de Registre, et de nombreux développeurs n’ont pas effectué les modifications nécessaires pour fonctionner correctement sur les comptes d’utilisateurs limités sur Windows XP.</span><span class="sxs-lookup"><span data-stu-id="893af-293">As a result, these applications could freely read and write system files and registry keys, and many developers did not make the changes needed to work properly on Limited User Accounts on Windows XP.</span></span> <span data-ttu-id="893af-294">Toutefois, sur Windows Vista, ces mêmes applications échouent désormais en raison de privilèges d’accès insuffisants dans le nouveau modèle de sécurité, qui applique l’exécution d’utilisateur standard pour les applications héritées.</span><span class="sxs-lookup"><span data-stu-id="893af-294">However on Windows Vista, these same applications would now fail due to insufficient access privileges under the new security model, which enforces standard user execution for legacy applications.</span></span> <span data-ttu-id="893af-295">Pour atténuer l’impact de cela, la virtualisation a également été ajoutée à Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="893af-295">To mitigate the impact of this, virtualization was also added to Windows Vista.</span></span> <span data-ttu-id="893af-296">La virtualisation conservera des milliers d’applications héritées qui fonctionnent bien sur Windows Vista sans que ces applications aient besoin de privilèges élevés à tout moment pour mener à bien des opérations mineures.</span><span class="sxs-lookup"><span data-stu-id="893af-296">Virtualization will keep thousands of legacy applications working well on Windows Vista without requiring those applications to have elevated privileges at all times simply to succeed at a few minor operations.</span></span> <span data-ttu-id="893af-297">s trouvés, votre jeu est probablement exécuté en mode hérité et a été soumis à la virtualisation.</span><span class="sxs-lookup"><span data-stu-id="893af-297">s found, chances are your game is running in legacy mode and was subjected to virtualization.</span></span>

<span data-ttu-id="893af-298">La virtualisation affecte le système de fichiers et le registre en redirigeant les écritures sensibles au système (et les opérations de fichier ou de Registre suivantes) vers un emplacement par utilisateur dans le profil de l’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="893af-298">Virtualization affects the file system and registry by redirecting system-sensitive writes (and subsequent file or registry operations) to a per-user location within the current user's profile.</span></span> <span data-ttu-id="893af-299">Par exemple, si une application tente d’écrire dans le fichier suivant :</span><span class="sxs-lookup"><span data-stu-id="893af-299">For example, if an application attempts to write to the following file:</span></span>

<dl> <span data-ttu-id="893af-300">C : \\ Program Files \\ nom de la société \\ titre \\config.ini</span><span class="sxs-lookup"><span data-stu-id="893af-300">C:\\Program Files\\Company Name\\Title\\config.ini</span></span>  
</dl>

<span data-ttu-id="893af-301">l’écriture est automatiquement redirigée vers :</span><span class="sxs-lookup"><span data-stu-id="893af-301">the write is automatically redirected to:</span></span>

<dl> <span data-ttu-id="893af-302">C : \\ Users \\ nom d’utilisateur \\ AppData \\ local \\ VirtualStore \\ Program Files nom de la \\ société \\ titre \\config.ini</span><span class="sxs-lookup"><span data-stu-id="893af-302">C:\\Users\\user name\\AppData\\Local\\VirtualStore\\Program Files\\Company Name\\Title\\config.ini</span></span>  
</dl>

<span data-ttu-id="893af-303">De même, si une application tente d’écrire une valeur de Registre comme suit :</span><span class="sxs-lookup"><span data-stu-id="893af-303">Likewise, if an application attempts to write a registry value like the following:</span></span>

<dl> <span data-ttu-id="893af-304">HKEY \_ local \_ machine \\ Software \\ Company Name \\</span><span class="sxs-lookup"><span data-stu-id="893af-304">HKEY\_LOCAL\_MACHINE\\Software\\Company Name\\Title</span></span>  
</dl>

<span data-ttu-id="893af-305">elle est redirigée au lieu de :</span><span class="sxs-lookup"><span data-stu-id="893af-305">it will be redirected instead to:</span></span>

<dl> <span data-ttu-id="893af-306">HKEY \_ Current \_ User, \\ classes de logiciels \\ \\ VirtualStore \\ machine \\ Software \\ nom \\ de l’entreprise</span><span class="sxs-lookup"><span data-stu-id="893af-306">HKEY\_CURRENT\_USER\\Software\\Classes\\VirtualStore\\MACHINE\\Software\\Company Name\\Title</span></span>  
</dl>

<span data-ttu-id="893af-307">Les fichiers et les clés de Registre affectés par la virtualisation sont accessibles uniquement par les opérations de fichier et de Registre à partir d’applications virtualisées qui s’exécutent en tant qu’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="893af-307">Files and registry keys affected by virtualization are only be accessed by file and registry operations from virtualized applications that are running as the current user.</span></span>

<span data-ttu-id="893af-308">Toutefois, il existe de nombreuses restrictions à la virtualisation.</span><span class="sxs-lookup"><span data-stu-id="893af-308">However, there are many restrictions to virtualization.</span></span> <span data-ttu-id="893af-309">L’une est que les applications 64 bits ne sont jamais exécutées en mode hérité pour les opérations de compatibilité soumises à la virtualisation dans les applications 32 bits échouent simplement en 64 bits.</span><span class="sxs-lookup"><span data-stu-id="893af-309">One is that 64-bit applications are never run in legacy mode for compatibility   operations subjected to virtualization in 32-bit applications will just fail in 64-bit.</span></span> <span data-ttu-id="893af-310">De même, si une application héritée s’exécutant en tant qu’utilisateur standard tente d’écrire n’importe quel type de fichier exécutable dans un emplacement qui nécessite des informations d’identification d’administration, la virtualisation ne se produit pas et l’écriture échoue.</span><span class="sxs-lookup"><span data-stu-id="893af-310">Also if a legacy application running as a standard user tries to write any type of executable file to a location that requires administrative credentials, then virtualization will not occur and the write will fail.</span></span>

<span data-ttu-id="893af-311">**Figure 4. Processus de virtualisation**</span><span class="sxs-lookup"><span data-stu-id="893af-311">**Figure 4. Virtualization Process**</span></span>

![processus de virtualisation](images/uac-virtualization-process.jpg)

<span data-ttu-id="893af-313">Lorsqu’une application héritée tente une opération de lecture sur des emplacements sensibles au système dans le système de fichiers ou le registre, les emplacements virtuels sont recherchés en premier.</span><span class="sxs-lookup"><span data-stu-id="893af-313">When a legacy application attempts a read operation on system-sensitive locations in the file system or registry, the virtual locations are searched first.</span></span> <span data-ttu-id="893af-314">Si le fichier ou la clé de Registre est introuvable, le système d’exploitation accède aux emplacements système par défaut.</span><span class="sxs-lookup"><span data-stu-id="893af-314">If the file or registry key is not found, then the operating system accesses the default system locations.</span></span>

<span data-ttu-id="893af-315">La virtualisation sera supprimée des versions ultérieures de Windows. il est donc important de ne pas s’appuyer sur cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="893af-315">Virtualization will be removed from subsequent versions of Windows so it important not to rely on this feature.</span></span> <span data-ttu-id="893af-316">Au lieu de cela, vous devez configurer explicitement votre manifeste d’application pour les privilèges d’administrateur ou d’utilisateur standard, car cela désactive la virtualisation.</span><span class="sxs-lookup"><span data-stu-id="893af-316">Instead, you should explicitly configure your application manifest for either standard user or administrative privileges, as this will disable virtualization.</span></span> <span data-ttu-id="893af-317">La virtualisation n’est pas non plus évidente pour les utilisateurs finaux. ainsi, même si la virtualisation peut permettre à votre application de s’exécuter, elle peut générer des appels de support et compliquer la résolution des problèmes pour ces clients.</span><span class="sxs-lookup"><span data-stu-id="893af-317">Virtualization is also not obvious to end users, so even though virtualization may allow your application to run, it can generate support calls and make it difficult to trouble-shoot for these customers.</span></span>

<span data-ttu-id="893af-318">Notez que si le contrôle de compte d’utilisateur est désactivé, la virtualisation est également désactivée.</span><span class="sxs-lookup"><span data-stu-id="893af-318">Note that if UAC is disabled, then virtualization is also disabled.</span></span> <span data-ttu-id="893af-319">Si la virtualisation est désactivée, les comptes d’utilisateurs standard se comportent exactement comme des comptes d’utilisateurs limités dans Windows XP, et les applications héritées peuvent ne pas fonctionner correctement pour les utilisateurs standard qui auraient pu aboutir à cause de la virtualisation.</span><span class="sxs-lookup"><span data-stu-id="893af-319">If virtualization is disabled, standard user accounts behave exactly like limited user accounts in Windows XP, and legacy applications may not function correctly for standard users that would otherwise have succeeded due to virtualization.</span></span>

## <a name="legacy-scenarios-and-manifests"></a><span data-ttu-id="893af-320">Scénarios et manifestes hérités</span><span class="sxs-lookup"><span data-stu-id="893af-320">Legacy Scenarios and Manifests</span></span>

<span data-ttu-id="893af-321">Pour la majorité des scénarios d’utilisation, le fait de marquer simplement le. exe avec les éléments de manifeste UAC appropriés et de s’assurer que l’application fonctionne correctement comme un utilisateur standard est suffisant pour une excellente compatibilité avec le contrôle de compte d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="893af-321">For the majority of usage scenarios, simply marking the .exe with the correct UAC manifest elements and ensuring the application works correctly as a Standard User is sufficient for excellent UAC compatibility.</span></span> <span data-ttu-id="893af-322">La plupart des joueurs exécutent Windows Vista ou Windows 7 avec le contrôle de compte d’utilisateur activé.</span><span class="sxs-lookup"><span data-stu-id="893af-322">Most gamers are running Windows Vista or Windows 7 with User Account Control enabled.</span></span> <span data-ttu-id="893af-323">Pour Windows XP et les utilisateurs sur Windows Vista ou la fonctionnalité de contrôle de compte d’utilisateur avec la fonctionnalité contrôle de compte d’utilisateur désactivée, ils s’exécutent généralement à l’aide de comptes administrateur</span><span class="sxs-lookup"><span data-stu-id="893af-323">For Windows XP and users on Windows Vista or Windows7 with the User Account Control feature disabled, they typically run using administrator accounts.</span></span> <span data-ttu-id="893af-324">Bien qu’il s’agisse d’un mode de fonctionnement moins sécurisé, il ne s’exécute généralement pas dans des problèmes de compatibilité supplémentaires, mais comme indiqué ci-dessus, la désactivation du contrôle de compte d’utilisateur désactive également la virtualisation.</span><span class="sxs-lookup"><span data-stu-id="893af-324">While this is a less secure mode of operation, it will generally not run into any additional compatibility issues although as noted above, disabling UAC disables virtualization as well.</span></span>

<span data-ttu-id="893af-325">Il existe un cas particulier à noter lorsque le programme est marqué comme « requireAdministrator » dans le manifeste de contrôle de compte d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="893af-325">There is a special case worth noting when the program is marked as "requireAdministrator" in the UAC manifest.</span></span> <span data-ttu-id="893af-326">Sur Windows XP et sur Windows Vista ou Windows 7 avec le contrôle de compte d’utilisateur désactivé, les éléments du manifeste UAC sont ignorés par le système.</span><span class="sxs-lookup"><span data-stu-id="893af-326">On Windows XP and on Windows Vista or Windows 7 with User Account Control disabled, the UAC manifest elements are ignored by the system.</span></span> <span data-ttu-id="893af-327">Dans ce cas, les utilisateurs disposant de comptes d’administrateur exécuteront toujours tous les programmes avec des droits d’administrateur complets, et ces programmes fonctionneront donc comme prévu.</span><span class="sxs-lookup"><span data-stu-id="893af-327">In this situation, users with administrator accounts will always run all programs with full administrator rights, and thus these programs will function as expected.</span></span> <span data-ttu-id="893af-328">Toutefois, les utilisateurs limités de Windows XP et les utilisateurs standard s’exécutant sous Windows Vista ou Windows 7 exécutent toujours ces programmes avec des droits restreints et toutes les opérations de niveau administrateur échouent.</span><span class="sxs-lookup"><span data-stu-id="893af-328">Windows XP Restricted Users and Standard Users running on Windows Vista or Windows 7, however, will always run these programs with restricted rights and all administrator-level operations will fail.</span></span> <span data-ttu-id="893af-329">Par conséquent, il est recommandé que les programmes marqués comme « requiretAdministrator » appellent [**IsUserAnAdmin**](/windows/win32/api/shlobj_core/nf-shlobj_core-isuseranadmin) au démarrage et affichent un message d’erreur irrécupérable s’ils retournent la valeur false.</span><span class="sxs-lookup"><span data-stu-id="893af-329">It is therefore recommended that programs marked as "requiretAdministrator" call [**IsUserAnAdmin**](/windows/win32/api/shlobj_core/nf-shlobj_core-isuseranadmin) on startup, and display a fatal error message if it returns FALSE.</span></span> <span data-ttu-id="893af-330">Pour la majorité des scénarios ci-dessus, cette opération est toujours réussie, mais offre une meilleure expérience utilisateur et un message d’erreur clair pour cette situation rare.</span><span class="sxs-lookup"><span data-stu-id="893af-330">For the majority scenario above, this will always succeed, but provides a better user experience and a clear error message for this rare situation.</span></span>

## <a name="conclusion"></a><span data-ttu-id="893af-331">Conclusion</span><span class="sxs-lookup"><span data-stu-id="893af-331">Conclusion</span></span>

<span data-ttu-id="893af-332">En tant que développeur de jeux ciblant l’environnement multi-utilisateur Windows, il est impératif que vous conceviez votre jeu pour qu’il fonctionne de manière efficace et responsable.</span><span class="sxs-lookup"><span data-stu-id="893af-332">As a game developer targeting the Windows multi-user environment, it is imperative that you design your game to operate effectively and responsibly.</span></span> <span data-ttu-id="893af-333">Le fichier exécutable principal de votre jeu ne doit pas dépendre des privilèges d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="893af-333">Your game's main executable file should not be dependent on administrative privileges.</span></span> <span data-ttu-id="893af-334">Cela empêche non seulement l’apparition d’invites d’élévation chaque fois que votre jeu est exécuté, ce qui peut avoir un impact négatif sur l’expérience globale de l’utilisateur, mais il permet également à votre jeu de tirer parti d’autres fonctionnalités qui nécessitent une exécution avec des privilèges d’utilisateur standard, tels que les contrôles de contrôle parental.</span><span class="sxs-lookup"><span data-stu-id="893af-334">This not only prevents the appearance of prompts for elevation every time that your game is run   which can negatively impact the overall user experience   but it also enables your game to take advantage of other features that require execution with standard user privileges, such as Parental Controls.</span></span>

<span data-ttu-id="893af-335">Les applications qui sont correctement conçues pour fonctionner comme avec les informations d’identification d’un utilisateur standard (ou utilisateur limité) dans les versions précédentes de Windows ne seront pas affectées par l’UAC qu’elles s’exécuteront sans élévation.</span><span class="sxs-lookup"><span data-stu-id="893af-335">Applications that are properly designed to operate as with the credentials of a standard user (or limited user) under previous versions of Windows will not be impacted by UAC   they will run without elevation.</span></span> <span data-ttu-id="893af-336">Toutefois, ils doivent inclure un manifeste dont le niveau d’exécution demandé est défini sur « asInvoker » pour se conformer aux normes d’application pour Vista.</span><span class="sxs-lookup"><span data-stu-id="893af-336">However, they should include a manifest with their requested execution level set to "asInvoker" to conform to application standards for Vista.</span></span>

## <a name="further-reading"></a><span data-ttu-id="893af-337">En savoir plus</span><span class="sxs-lookup"><span data-stu-id="893af-337">Further Reading</span></span>

<span data-ttu-id="893af-338">Pour obtenir de l’aide sur la conception d’applications pour Windows Vista conformes au contrôle de compte d’utilisateur, téléchargez le livre blanc suivant : [exigences de développement d’applications Windows Vista pour la compatibilité du contrôle de compte d’utilisateur](/previous-versions/dotnet/articles/bb530410(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="893af-338">For assistance with designing applications for Windows Vista that are compliant with User Account Control, download the following white paper: [Windows Vista Application Development Requirements for User Account Control Compatibility](/previous-versions/dotnet/articles/bb530410(v=msdn.10)).</span></span>

<span data-ttu-id="893af-339">Ce livre blanc fournit des étapes détaillées sur le processus de conception, ainsi que des exemples de code, des exigences et des meilleures pratiques.</span><span class="sxs-lookup"><span data-stu-id="893af-339">This white paper provides detailed steps about the design process, along with code samples, requirements, and best practices.</span></span> <span data-ttu-id="893af-340">Ce document décrit également les mises à jour techniques et les modifications apportées à l’expérience utilisateur dans Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="893af-340">This paper also details the technical updates and changes to the user experience in Windows Vista.</span></span>

<span data-ttu-id="893af-341">Pour plus d’informations sur le contrôle de compte d’utilisateur, consultez [Windows Vista : contrôle de compte d’utilisateur](https://www.microsoft.com/technet/windowsvista/security/uac.mspx) sur [Microsoft TechNet](https://www.microsoft.com/technet/).</span><span class="sxs-lookup"><span data-stu-id="893af-341">For more information about User Account Control, visit [Windows Vista: User Account Control](https://www.microsoft.com/technet/windowsvista/security/uac.mspx) on [Microsoft TechNet](https://www.microsoft.com/technet/).</span></span>

<span data-ttu-id="893af-342">Une autre ressource utile est l’article [apprendre à vos applications à jouer un regard avec le contrôle de compte d’utilisateur Windows Vista](/archive/msdn-magazine/2007/january/teach-your-apps-to-work-with-windows-vista-user-account-control), du [magazine MSDN](/archive/msdn-magazine/msdn-magazine-issues), du 2007 janvier.</span><span class="sxs-lookup"><span data-stu-id="893af-342">Another useful resource is the article [Teach Your Apps To Play Nicely with Windows Vista User Account Control](/archive/msdn-magazine/2007/january/teach-your-apps-to-work-with-windows-vista-user-account-control), from [MSDN Magazine](/archive/msdn-magazine/msdn-magazine-issues), January 2007.</span></span> <span data-ttu-id="893af-343">Cet article aborde les problèmes généraux de compatibilité des applications, ainsi que les avantages et les problèmes liés à l’utilisation de packages Windows Installer sur Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="893af-343">This article discusses general issues of application compatibility, as well as the advantages and issues of using Windows Installer packages on Windows Vista.</span></span>

<span data-ttu-id="893af-344">Pour plus d’informations sur le bogue et le correctif pour mt.exe, l’outil utilisé par Visual Studio 2005 pour fusionner et incorporer automatiquement un manifeste dans un fichier exécutable, consultez [exploration des manifestes partie 2 : espaces de noms par défaut et manifestes de contrôle de compte d’utilisateur dans Windows Vista](https://techcommunity.microsoft.com/t5/Windows-Blog-Archive/bg-p/Windows-Blog-Archive/2006/09/08/exploring-manifests-part-2-default-namespaces-and-uac-manifests-in-windows-vista/) sur le blog de Chris Jackson sur [MSDN](/archive/blogs/).</span><span class="sxs-lookup"><span data-stu-id="893af-344">For more information about the bug and the fix for mt.exe, the tool used by Visual Studio 2005 to automatically merge and embed a manifest into an executable, see [Exploring Manifests Part 2: Default Namespaces and UAC Manifests in Windows Vista](https://techcommunity.microsoft.com/t5/Windows-Blog-Archive/bg-p/Windows-Blog-Archive/2006/09/08/exploring-manifests-part-2-default-namespaces-and-uac-manifests-in-windows-vista/) on Chris Jackson's blog on [MSDN](/archive/blogs/).</span></span>

 

