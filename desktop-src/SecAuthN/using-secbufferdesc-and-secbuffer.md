---
description: La communication implique souvent des quantités potentiellement volumineuses de données ou de données de longueur inconnue.
ms.assetid: e7b12b9e-8caa-4dad-b81f-b609ccb92c9f
title: Utilisation de SecBufferDesc et SecBuffer
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ca7d8155a610263838d2baf2a7d1c8fc96ec874
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103867237"
---
# <a name="using-secbufferdesc-and-secbuffer"></a><span data-ttu-id="14f0a-103">Utilisation de SecBufferDesc et SecBuffer</span><span class="sxs-lookup"><span data-stu-id="14f0a-103">Using SecBufferDesc and SecBuffer</span></span>

<span data-ttu-id="14f0a-104">La communication implique souvent des quantités potentiellement volumineuses de données ou de données de longueur inconnue.</span><span class="sxs-lookup"><span data-stu-id="14f0a-104">Communication often involves potentially large amounts of data or data of unknown length.</span></span> <span data-ttu-id="14f0a-105">L’envoi et la réception de données s’effectuent de manière similaire ou identique dans les deux cas.</span><span class="sxs-lookup"><span data-stu-id="14f0a-105">Sending and receiving data is done in similar or identical fashion in both of these cases.</span></span> <span data-ttu-id="14f0a-106">Pour traiter une longueur inconnue et potentiellement de grandes quantités de données, la communication SSPI s’effectue à l’aide de deux structures, [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) et [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).</span><span class="sxs-lookup"><span data-stu-id="14f0a-106">To deal with unknown length and potentially large amounts of data, SSPI communication is done using two structures, [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) and [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).</span></span>

<span data-ttu-id="14f0a-107">Une structure [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) est un conteneur pour un tableau de structures [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="14f0a-107">A [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) structure is a container for an array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures.</span></span> <span data-ttu-id="14f0a-108">Une structure **SecBufferDesc** contient les membres suivants :</span><span class="sxs-lookup"><span data-stu-id="14f0a-108">A **SecBufferDesc** structure has the following members:</span></span>

-   <span data-ttu-id="14f0a-109">Numéro de version</span><span class="sxs-lookup"><span data-stu-id="14f0a-109">Version number</span></span>
-   <span data-ttu-id="14f0a-110">Nombre d’éléments [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)</span><span class="sxs-lookup"><span data-stu-id="14f0a-110">Number of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) elements</span></span>
-   <span data-ttu-id="14f0a-111">Adresse du tableau de structures [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)</span><span class="sxs-lookup"><span data-stu-id="14f0a-111">Address of the array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures</span></span>

<span data-ttu-id="14f0a-112">Une structure [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) contient les trois membres suivants :</span><span class="sxs-lookup"><span data-stu-id="14f0a-112">A [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structure contains the following three members:</span></span>

-   <span data-ttu-id="14f0a-113">Nombre d’octets dans la mémoire tampon</span><span class="sxs-lookup"><span data-stu-id="14f0a-113">Number of bytes in the buffer</span></span>
-   <span data-ttu-id="14f0a-114">Type d’informations contenues dans l’élément de données</span><span class="sxs-lookup"><span data-stu-id="14f0a-114">Type of information contained in the data item</span></span>
-   <span data-ttu-id="14f0a-115">Octets eux-mêmes</span><span class="sxs-lookup"><span data-stu-id="14f0a-115">The bytes themselves</span></span>

<span data-ttu-id="14f0a-116">Un message SSPI entier se compose souvent d’un tableau de structures [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="14f0a-116">A whole SSPI message often consists of an array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures.</span></span>

<span data-ttu-id="14f0a-117">Les types de données de mémoire tampon suivants sont définis comme suit.</span><span class="sxs-lookup"><span data-stu-id="14f0a-117">The following buffer data types are defined as follows.</span></span>



| <span data-ttu-id="14f0a-118">Type de mémoire tampon</span><span class="sxs-lookup"><span data-stu-id="14f0a-118">Buffer type</span></span>                | <span data-ttu-id="14f0a-119">Signification</span><span class="sxs-lookup"><span data-stu-id="14f0a-119">Meaning</span></span>                                                                                                                                |
|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="14f0a-120">SECBUFFER \_ vide</span><span class="sxs-lookup"><span data-stu-id="14f0a-120">SECBUFFER\_EMPTY</span></span>           | <span data-ttu-id="14f0a-121">Non défini, remplacé par la fonction de [*package de sécurité*](../secgloss/s-gly.md)</span><span class="sxs-lookup"><span data-stu-id="14f0a-121">Undefined, replaced by the [*security package*](../secgloss/s-gly.md) function</span></span> |
| <span data-ttu-id="14f0a-122">\_données SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="14f0a-122">SECBUFFER\_DATA</span></span>            | <span data-ttu-id="14f0a-123">Données du paquet</span><span class="sxs-lookup"><span data-stu-id="14f0a-123">Packet data</span></span>                                                                                                                            |
| <span data-ttu-id="14f0a-124">\_jeton SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="14f0a-124">SECBUFFER\_TOKEN</span></span>           | <span data-ttu-id="14f0a-125">Jeton de sécurité</span><span class="sxs-lookup"><span data-stu-id="14f0a-125">Security token</span></span>                                                                                                                         |
| <span data-ttu-id="14f0a-126">\_paramètres SECBUFFER pkg \_</span><span class="sxs-lookup"><span data-stu-id="14f0a-126">SECBUFFER\_PKG\_PARAMS</span></span>     | <span data-ttu-id="14f0a-127">Paramètres spécifiques au package</span><span class="sxs-lookup"><span data-stu-id="14f0a-127">Package-specific parameters</span></span>                                                                                                            |
| <span data-ttu-id="14f0a-128">SECBUFFER \_ manquant</span><span class="sxs-lookup"><span data-stu-id="14f0a-128">SECBUFFER\_MISSING</span></span>         | <span data-ttu-id="14f0a-129">Indicateur de données manquant</span><span class="sxs-lookup"><span data-stu-id="14f0a-129">Missing data indicator</span></span>                                                                                                                 |
| <span data-ttu-id="14f0a-130">SECBUFFER \_ extra</span><span class="sxs-lookup"><span data-stu-id="14f0a-130">SECBUFFER\_EXTRA</span></span>           | <span data-ttu-id="14f0a-131">Données supplémentaires</span><span class="sxs-lookup"><span data-stu-id="14f0a-131">Extra data</span></span>                                                                                                                             |
| <span data-ttu-id="14f0a-132">\_flux SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="14f0a-132">SECBUFFER\_STREAM</span></span>          | <span data-ttu-id="14f0a-133">Données de flux de sécurité</span><span class="sxs-lookup"><span data-stu-id="14f0a-133">Security stream data</span></span>                                                                                                                   |
| <span data-ttu-id="14f0a-134">Code de fin de \_ flux SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="14f0a-134">SECBUFFER\_STREAM\_TRAILER</span></span> | <span data-ttu-id="14f0a-135">Code de fin de flux de sécurité</span><span class="sxs-lookup"><span data-stu-id="14f0a-135">Security stream trailer</span></span>                                                                                                                |
| <span data-ttu-id="14f0a-136">\_ \_ en-tête de flux SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="14f0a-136">SECBUFFER\_STREAM\_HEADER</span></span>  | <span data-ttu-id="14f0a-137">En-tête de flux de sécurité</span><span class="sxs-lookup"><span data-stu-id="14f0a-137">Security stream header</span></span>                                                                                                                 |



 

<span data-ttu-id="14f0a-138">Les types de tampons ci-dessus peuvent être combinés à l’aide d'**une opération or au niveau** du bit avec l’un des types de mémoires tampons suivants.</span><span class="sxs-lookup"><span data-stu-id="14f0a-138">The buffer types above can be combined using a bitwise-**OR** operation with either of the following buffer types.</span></span>



| <span data-ttu-id="14f0a-139">Type de mémoire tampon</span><span class="sxs-lookup"><span data-stu-id="14f0a-139">Buffer type</span></span>         | <span data-ttu-id="14f0a-140">Signification</span><span class="sxs-lookup"><span data-stu-id="14f0a-140">Meaning</span></span>                                                                          |
|---------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="14f0a-141">SECBUFFER \_ ATTRMASK</span><span class="sxs-lookup"><span data-stu-id="14f0a-141">SECBUFFER\_ATTRMASK</span></span> | <span data-ttu-id="14f0a-142">Masquez les attributs de sécurité en séparant les indicateurs d’attribut du type de mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="14f0a-142">Mask security attributes by separating the attribute flags from the buffer type.</span></span> |
| <span data-ttu-id="14f0a-143">SECBUFFER en \_ lecture seule</span><span class="sxs-lookup"><span data-stu-id="14f0a-143">SECBUFFER\_READONLY</span></span> | <span data-ttu-id="14f0a-144">La mémoire tampon est en lecture seule</span><span class="sxs-lookup"><span data-stu-id="14f0a-144">Buffer is read-only</span></span>                                                              |



 

<span data-ttu-id="14f0a-145">Avant chaque appel à une API SSPI qui requiert un paramètre [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) , un ou plusieurs éléments de tableau [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) sont déclarés et initialisés.</span><span class="sxs-lookup"><span data-stu-id="14f0a-145">Before each call to an SSPI API that requires a [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) parameter, one or more [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) array elements are declared and initialized.</span></span> <span data-ttu-id="14f0a-146">Par exemple, il peut y avoir deux mémoires tampons de sécurité : une qui contient les données de message d’entrée et l’autre pour le jeton de sécurité opaque de sortie retourné par le package de sécurité.</span><span class="sxs-lookup"><span data-stu-id="14f0a-146">For example, there can be two security buffers: one that contains input message data and the other for the output opaque security token returned by the security package.</span></span> <span data-ttu-id="14f0a-147">L’ordre des tampons de sécurité dans le descripteur de mémoire tampon de sécurité n’est pas important, mais chaque mémoire tampon doit être marquée avec le type approprié.</span><span class="sxs-lookup"><span data-stu-id="14f0a-147">The order of security buffers in the security buffer descriptor is not important, but each buffer must be tagged with its appropriate type.</span></span> <span data-ttu-id="14f0a-148">Une balise en lecture seule peut être utilisée avec n’importe quelle mémoire tampon d’entrée qui ne doit pas être modifiée par le [*package de sécurité*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="14f0a-148">A read-only tag can be used with any input buffer that must not be modified by the [*security package*](../secgloss/s-gly.md).</span></span>

<span data-ttu-id="14f0a-149">La taille de la mémoire tampon de sortie supposée contenir le jeton de sécurité est importante.</span><span class="sxs-lookup"><span data-stu-id="14f0a-149">The size of the output buffer that is expected to contain the security token is important.</span></span> <span data-ttu-id="14f0a-150">Une application peut trouver la taille de jeton maximale pour un package de sécurité lors de l’installation initiale.</span><span class="sxs-lookup"><span data-stu-id="14f0a-150">An application can find the maximum token size for a security package during initial setup.</span></span> <span data-ttu-id="14f0a-151">L’appel à [**EnumerateSecurityPackages**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) retourne un tableau de pointeurs vers les informations de package de sécurité.</span><span class="sxs-lookup"><span data-stu-id="14f0a-151">The call to [**EnumerateSecurityPackages**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) returns an array of pointers to security package information.</span></span> <span data-ttu-id="14f0a-152">La structure d’informations du package de sécurité contient la taille de jeton maximale pour chaque package.</span><span class="sxs-lookup"><span data-stu-id="14f0a-152">The security package information structure contains the maximum token size for each package.</span></span> <span data-ttu-id="14f0a-153">Dans l’exemple, les informations se trouvent dans le membre **cbMaxToken** de la structure [**SecPkgInfo**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) .</span><span class="sxs-lookup"><span data-stu-id="14f0a-153">In the example, the information is in the **cbMaxToken** member of the [**SecPkgInfo**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) structure.</span></span> <span data-ttu-id="14f0a-154">Les mêmes informations peuvent être obtenues ultérieurement à l’aide de [**QuerySecurityPackageInfo**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).</span><span class="sxs-lookup"><span data-stu-id="14f0a-154">The same information can be obtained later using [**QuerySecurityPackageInfo**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).</span></span>

<span data-ttu-id="14f0a-155">L’application initialise les pointeurs et les tailles de tampon dans la description de la mémoire tampon pour indiquer l’emplacement des données de message et d’autres informations.</span><span class="sxs-lookup"><span data-stu-id="14f0a-155">The application initializes the buffer pointers and sizes in the buffer description to indicate where message data and other information can be found.</span></span>

<span data-ttu-id="14f0a-156">Pour plus d’informations, consultez [exemple de code SecBuffer et SecBufferDesc](secbuffer-and-secbufferdesc-example-code.md).</span><span class="sxs-lookup"><span data-stu-id="14f0a-156">For details, see [SecBuffer and SecBufferDesc Example Code](secbuffer-and-secbufferdesc-example-code.md).</span></span>

 

 
