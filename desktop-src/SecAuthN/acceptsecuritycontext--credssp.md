---
description: Permet au composant serveur d’une application de transport d’établir un contexte de sécurité entre le serveur et un client distant.
ms.assetid: a53f733e-b646-4431-b021-a2c446308849
title: AcceptSecurityContext (CredSSP) (fonction)
ms.topic: article
ms.date: 07/25/2019
ms.openlocfilehash: 681e03ea15729cc8726d63551e8b7b0a2b39ecac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106545823"
---
# <a name="acceptsecuritycontext-credssp-function"></a><span data-ttu-id="6d0c3-103">AcceptSecurityContext (CredSSP) (fonction)</span><span class="sxs-lookup"><span data-stu-id="6d0c3-103">AcceptSecurityContext (CredSSP) function</span></span>

<span data-ttu-id="6d0c3-104">La fonction **AcceptSecurityContext (CredSSP)** permet au composant serveur d’une application de transport d’établir un contexte de sécurité entre le serveur et un client distant.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-104">The **AcceptSecurityContext (CredSSP)** function lets the server component of a transport application establish a security context between the server and a remote client.</span></span> <span data-ttu-id="6d0c3-105">Le client distant appelle la fonction [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) pour démarrer le processus d’établissement d’un contexte de sécurité.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-105">The remote client calls the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function to start the process of establishing a security context.</span></span> <span data-ttu-id="6d0c3-106">Le serveur peut exiger un ou plusieurs jetons de réponse du client distant pour terminer l’établissement du contexte de sécurité.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-106">The server can require one or more reply tokens from the remote client to complete establishing the security context.</span></span>

## <a name="syntax"></a><span data-ttu-id="6d0c3-107">Syntaxe</span><span class="sxs-lookup"><span data-stu-id="6d0c3-107">Syntax</span></span>

```C++
SECURITY_STATUS SEC_ENTRY AcceptSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _In_opt_    PCtxtHandle    phContext,
  _In_opt_    PSecBufferDesc pInput,
  _In_        unsigned long  fContextReq,
  _In_        unsigned long  TargetDataRep,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       unsigned long  *pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```

## <a name="parameters"></a><span data-ttu-id="6d0c3-108">Paramètres</span><span class="sxs-lookup"><span data-stu-id="6d0c3-108">Parameters</span></span>

<span data-ttu-id="6d0c3-109">*phCredential* \[ dans, facultatif\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-109">*phCredential* \[in, optional\]</span></span>

<span data-ttu-id="6d0c3-110">Handle vers les informations d’identification du serveur.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-110">A handle to the server credentials.</span></span> <span data-ttu-id="6d0c3-111">Pour récupérer ce handle, le serveur appelle la fonction [**CredSSP (AcquireCredentialsHandle)**](acquirecredentialshandle--credssp.md) avec l’indicateur SECPKG \_ cred \_ entrant ou SECPKG \_ cred \_ défini.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-111">To retrieve this handle, the server calls the [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) function with either the SECPKG\_CRED\_INBOUND or SECPKG\_CRED\_BOTH flag set.</span></span>

<span data-ttu-id="6d0c3-112">*phContext* \[ dans, facultatif\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-112">*phContext* \[in, optional\]</span></span>

<span data-ttu-id="6d0c3-113">Pointeur vers une structure [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="6d0c3-113">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="6d0c3-114">Lors du premier appel à **AcceptSecurityContext (CredSSP)**, ce pointeur est **null**.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-114">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer is **NULL**.</span></span> <span data-ttu-id="6d0c3-115">Lors des appels suivants, *phContext* spécifie le contexte partiellement formé retourné dans le paramètre *phNewContext* par le premier appel.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-115">On subsequent calls, *phContext* specifies the partially formed context returned in the *phNewContext* parameter by the first call.</span></span>

<span data-ttu-id="6d0c3-116">*pInput* \[ dans, facultatif\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-116">*pInput* \[in, optional\]</span></span>

<span data-ttu-id="6d0c3-117">Pointeur vers une structure [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) générée par un appel client à [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="6d0c3-117">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure generated by a client call to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="6d0c3-118">La structure contient le descripteur de mémoire tampon d’entrée.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-118">The structure contains the input buffer descriptor.</span></span>

<span data-ttu-id="6d0c3-119">La première mémoire tampon doit être de **type \_ jeton SECBUFFER** et contenir le jeton de sécurité reçu du client.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-119">The first buffer must be of type **SECBUFFER\_TOKEN** and contain the security token received from the client.</span></span> <span data-ttu-id="6d0c3-120">La deuxième mémoire tampon doit être de type **SECBUFFER \_ vide**.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-120">The second buffer should be of type **SECBUFFER\_EMPTY**.</span></span>

<span data-ttu-id="6d0c3-121">*fContextReq* \[ dans\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-121">*fContextReq* \[in\]</span></span>

<span data-ttu-id="6d0c3-122">Bits indicateurs qui spécifient les attributs requis par le serveur pour établir le contexte.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-122">-Bit flags that specify the attributes required by the server to establish the context.</span></span> <span data-ttu-id="6d0c3-123">**Les indicateurs de bits** peuvent être combinés à l’aide d’opérations or au niveau du bit.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-123">Bit flags can be combined by using bitwise-**OR** operations.</span></span> <span data-ttu-id="6d0c3-124">Ce paramètre peut être une ou plusieurs des valeurs suivantes.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-124">This parameter can be one or more of the following values.</span></span>

| <span data-ttu-id="6d0c3-125">Valeur</span><span class="sxs-lookup"><span data-stu-id="6d0c3-125">Value</span></span>                          | <span data-ttu-id="6d0c3-126">Signification</span><span class="sxs-lookup"><span data-stu-id="6d0c3-126">Meaning</span></span>                                                                                                                                                                                                        |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="6d0c3-127">**\_demande ASC \_ allouer de la \_ mémoire**</span><span class="sxs-lookup"><span data-stu-id="6d0c3-127">**ASC\_REQ\_ALLOCATE\_MEMORY**</span></span> | <span data-ttu-id="6d0c3-128">CredSSP (Credential Security Support Provider) alloue des tampons de sortie.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-128">Credential Security Support Provider (CredSSP) will allocate output buffers.</span></span> <span data-ttu-id="6d0c3-129">Lorsque vous avez fini d’utiliser les tampons de sortie, libérez-les en appelant la fonction [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .</span><span class="sxs-lookup"><span data-stu-id="6d0c3-129">When you have finished using the output buffers, free them by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span> |
| <span data-ttu-id="6d0c3-130">**connexion à la \_ demande ASC \_**</span><span class="sxs-lookup"><span data-stu-id="6d0c3-130">**ASC\_REQ\_CONNECTION**</span></span>       | <span data-ttu-id="6d0c3-131">Le contexte de sécurité ne gère pas les messages de mise en forme.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-131">The security context will not handle formatting messages.</span></span>                                                                                                                                                      |
| <span data-ttu-id="6d0c3-132">**\_délégué req \_ ASC**</span><span class="sxs-lookup"><span data-stu-id="6d0c3-132">**ASC\_REQ\_DELEGATE**</span></span>         | <span data-ttu-id="6d0c3-133">Le serveur est autorisé à emprunter l’identité du client.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-133">The server is allowed to impersonate the client.</span></span> <span data-ttu-id="6d0c3-134">Ignorez cet indicateur pour la délégation avec restriction.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-134">Ignore this flag for constrained delegation.</span></span>                                                         |
| <span data-ttu-id="6d0c3-135">**\_ \_ erreur étendue ASC \_ req**</span><span class="sxs-lookup"><span data-stu-id="6d0c3-135">**ASC\_REQ\_EXTENDED\_ERROR**</span></span>  | <span data-ttu-id="6d0c3-136">Lorsque des erreurs se produisent, le tiers distant est averti.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-136">When errors occur, the remote party will be notified.</span></span>                                                                                                                                                          |
| <span data-ttu-id="6d0c3-137">**détection de la \_ RElecture de la demande ASC \_ \_**</span><span class="sxs-lookup"><span data-stu-id="6d0c3-137">**ASC\_REQ\_REPLAY\_DETECT**</span></span>   | <span data-ttu-id="6d0c3-138">Détecter les paquets relus.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-138">Detect replayed packets.</span></span>                                                                                                                                                                                       |
| <span data-ttu-id="6d0c3-139">**détection de la \_ séquence de demande ASC \_ \_**</span><span class="sxs-lookup"><span data-stu-id="6d0c3-139">**ASC\_REQ\_SEQUENCE\_DETECT**</span></span> | <span data-ttu-id="6d0c3-140">Détecte les messages reçus en dehors de la séquence.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-140">Detect messages received out of sequence.</span></span>                                                                                                                                                                      |
| <span data-ttu-id="6d0c3-141">**\_flux de demande ASC \_**</span><span class="sxs-lookup"><span data-stu-id="6d0c3-141">**ASC\_REQ\_STREAM**</span></span>           | <span data-ttu-id="6d0c3-142">Prend en charge une connexion orientée flux.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-142">Support a stream-oriented connection.</span></span>                                                                                                                                                                          |

<span data-ttu-id="6d0c3-143">Pour connaître les indicateurs d’attribut possibles et leurs significations, consultez [spécifications de contexte](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="6d0c3-143">For possible attribute flags and their meanings, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="6d0c3-144">Les indicateurs utilisés pour ce paramètre sont préfixés avec ASC \_ req, par exemple ASC \_ req \_ Delegate.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-144">Flags used for this parameter are prefixed with ASC\_REQ, for example, ASC\_REQ\_DELEGATE.</span></span>

<span data-ttu-id="6d0c3-145">Les attributs demandés ne sont peut-être pas pris en charge par le client.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-145">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="6d0c3-146">Pour plus d’informations, consultez le paramètre *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="6d0c3-146">For more information, see the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="6d0c3-147">*TargetDataRep* \[ dans\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-147">*TargetDataRep* \[in\]</span></span>

<span data-ttu-id="6d0c3-148">Représentation des données, telle que l’ordonnancement des octets, sur la cible.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-148">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="6d0c3-149">Ce paramètre peut être **Security \_ native \_ DREP** ou **Security \_ Network \_ DREP**.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-149">This parameter can be either **SECURITY\_NATIVE\_DREP** or **SECURITY\_NETWORK\_DREP**.</span></span>

<span data-ttu-id="6d0c3-150">*phNewContext* \[ in, out, facultatif\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-150">*phNewContext* \[in, out, optional\]</span></span>

<span data-ttu-id="6d0c3-151">Pointeur vers une structure [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="6d0c3-151">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="6d0c3-152">Lors du premier appel à **AcceptSecurityContext (CredSSP)**, ce pointeur reçoit le nouveau handle de contexte.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-152">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="6d0c3-153">Lors des appels suivants, *phNewContext* peut être le même que le handle spécifié dans le paramètre *phContext* .</span><span class="sxs-lookup"><span data-stu-id="6d0c3-153">On subsequent calls, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

<span data-ttu-id="6d0c3-154">*pOutput* \[ in, out, facultatif\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-154">*pOutput* \[in, out, optional\]</span></span>

<span data-ttu-id="6d0c3-155">Pointeur vers une structure [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) qui contient le descripteur de mémoire tampon de sortie.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-155">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains the output buffer descriptor.</span></span> <span data-ttu-id="6d0c3-156">Cette mémoire tampon est envoyée au client pour l’entrée dans des appels supplémentaires à [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="6d0c3-156">This buffer is sent to the client for input into additional calls to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="6d0c3-157">Une mémoire tampon de sortie peut être générée même si la fonction retourne SEC \_ E \_ OK.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-157">An output buffer may be generated even if the function returns SEC\_E\_OK.</span></span> <span data-ttu-id="6d0c3-158">Toute mémoire tampon générée doit être renvoyée à l’application cliente.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-158">Any buffer generated must be sent back to the client application.</span></span>

<span data-ttu-id="6d0c3-159">Lors de la sortie, cette mémoire tampon reçoit un jeton pour le contexte de sécurité.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-159">On output, this buffer receives a token for the security context.</span></span> <span data-ttu-id="6d0c3-160">Le jeton doit être envoyé au client.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-160">The token must be sent to the client.</span></span> <span data-ttu-id="6d0c3-161">La fonction peut également retourner une mémoire tampon de type SECBUFFER \_ extra.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-161">The function can also return a buffer of type SECBUFFER\_EXTRA.</span></span>

<span data-ttu-id="6d0c3-162">*pfContextAttr* \[ à\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-162">*pfContextAttr* \[out\]</span></span>

<span data-ttu-id="6d0c3-163">Pointeur vers un jeu d’indicateurs binaires qui indiquent les attributs du contexte établi.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-163">A pointer to a set of bit flags that indicate the attributes of the established context.</span></span> <span data-ttu-id="6d0c3-164">Pour obtenir une description des différents attributs, consultez [spécifications de contexte](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="6d0c3-164">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="6d0c3-165">Les indicateurs utilisés pour ce paramètre sont préfixés par ASC \_ RET, par exemple ASC \_ RET \_ Delegate.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-165">Flags used for this parameter are prefixed with ASC\_RET, for example, ASC\_RET\_DELEGATE.</span></span>

<span data-ttu-id="6d0c3-166">Ne vérifiez pas les attributs liés à la sécurité jusqu’à ce que l’appel de fonction final soit retourné avec succès.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-166">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="6d0c3-167">Les indicateurs d’attribut non liés à la sécurité, tels que l' \_ indicateur ASC RET \_ allouée la \_ mémoire, peuvent être vérifiés avant le retour final.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-167">Attribute flags not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

<span data-ttu-id="6d0c3-168">*ptsExpiry* \[ out, facultatif\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-168">*ptsExpiry* \[out, optional\]</span></span>

<span data-ttu-id="6d0c3-169">Pointeur vers une structure d' [**horodatage**](timestamp.md) qui reçoit l’heure d’expiration du contexte.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-169">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="6d0c3-170">Nous recommandons que le package de sécurité retourne toujours cette valeur en heure locale.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-170">We recommend that the security package always return this value in local time.</span></span>

> [!Note]  
> <span data-ttu-id="6d0c3-171">Jusqu’au dernier appel du processus d’authentification, l’heure d’expiration du contexte peut être incorrecte, car des informations supplémentaires seront fournies lors des étapes ultérieures de la négociation.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-171">Until the last call of the authentication process, the expiration time for the context can be incorrect because more information will be provided during later stages of the negotiation.</span></span> <span data-ttu-id="6d0c3-172">Par conséquent, *ptsTimeStamp* doit avoir la **valeur null** jusqu’au dernier appel à la fonction.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-172">Therefore, *ptsTimeStamp* must be **NULL** until the last call to the function.</span></span>

## <a name="return-value"></a><span data-ttu-id="6d0c3-173">Valeur retournée</span><span class="sxs-lookup"><span data-stu-id="6d0c3-173">Return value</span></span>

<span data-ttu-id="6d0c3-174">Cette fonction retourne l’une des valeurs suivantes.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-174">This function returns one of the following values.</span></span>

| <span data-ttu-id="6d0c3-175">Code/valeur de retour</span><span class="sxs-lookup"><span data-stu-id="6d0c3-175">Return code/value</span></span>                                   | <span data-ttu-id="6d0c3-176">Description</span><span class="sxs-lookup"><span data-stu-id="6d0c3-176">Description</span></span>                                                                                                                                                                 |
|-----------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="6d0c3-177">SEC_E_INCOMPLETE_MESSAGE</span><span class="sxs-lookup"><span data-stu-id="6d0c3-177">SEC_E_INCOMPLETE_MESSAGE</span></span> <br/> <span data-ttu-id="6d0c3-178">0x80090318L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-178">0x80090318L</span></span>          | <span data-ttu-id="6d0c3-179">La fonction a réussi.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-179">The function succeeded.</span></span> <span data-ttu-id="6d0c3-180">Les données de la mémoire tampon d’entrée sont incomplètes.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-180">The data in the input buffer is incomplete.</span></span> <span data-ttu-id="6d0c3-181">L’application doit lire à nouveau les données supplémentaires du client et appeler [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) .</span><span class="sxs-lookup"><span data-stu-id="6d0c3-181">The application must read additional data from the client and call [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) again.</span></span> |
| <span data-ttu-id="6d0c3-182">SEC_E_INSUFFICIENT_MEMORY</span><span class="sxs-lookup"><span data-stu-id="6d0c3-182">SEC_E_INSUFFICIENT_MEMORY</span></span> <br/> <span data-ttu-id="6d0c3-183">0x80090300L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-183">0x80090300L</span></span>         | <span data-ttu-id="6d0c3-184">Échec de la fonction.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-184">The function failed.</span></span> <span data-ttu-id="6d0c3-185">La mémoire disponible est insuffisante pour terminer l’action demandée.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-185">There is not enough memory available to complete the requested action.</span></span>                                                                                 |
| <span data-ttu-id="6d0c3-186">SEC_E_INTERNAL_ERROR</span><span class="sxs-lookup"><span data-stu-id="6d0c3-186">SEC_E_INTERNAL_ERROR</span></span> <br/> <span data-ttu-id="6d0c3-187">0x80090304L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-187">0x80090304L</span></span>              | <span data-ttu-id="6d0c3-188">Échec de la fonction.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-188">The function failed.</span></span> <span data-ttu-id="6d0c3-189">Une erreur qui n’a pas été mappée à un code d’erreur SSPI s’est produite.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-189">An error occurred that did not map to an SSPI error code.</span></span>                                                                                              |
| <span data-ttu-id="6d0c3-190">SEC_E_INVALID_HANDLE</span><span class="sxs-lookup"><span data-stu-id="6d0c3-190">SEC_E_INVALID_HANDLE</span></span> <br/> <span data-ttu-id="6d0c3-191">0x80100003L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-191">0x80100003L</span></span>              | <span data-ttu-id="6d0c3-192">Échec de la fonction.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-192">The function failed.</span></span> <span data-ttu-id="6d0c3-193">Le handle passé à la fonction n’est pas valide.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-193">The handle passed to the function is not valid.</span></span>                                                                                                        |
| <span data-ttu-id="6d0c3-194">SEC_E_INVALID_TOKEN</span><span class="sxs-lookup"><span data-stu-id="6d0c3-194">SEC_E_INVALID_TOKEN</span></span> <br/> <span data-ttu-id="6d0c3-195">0x80090308L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-195">0x80090308L</span></span>               | <span data-ttu-id="6d0c3-196">Échec de la fonction.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-196">The function failed.</span></span> <span data-ttu-id="6d0c3-197">Le jeton passé à la fonction n’est pas valide.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-197">The token passed to the function is not valid.</span></span>                                                                                                         |
| <span data-ttu-id="6d0c3-198">SEC_E_LOGON_DENIED</span><span class="sxs-lookup"><span data-stu-id="6d0c3-198">SEC_E_LOGON_DENIED</span></span> <br/> <span data-ttu-id="6d0c3-199">0x8009030CL</span><span class="sxs-lookup"><span data-stu-id="6d0c3-199">0x8009030CL</span></span>                | <span data-ttu-id="6d0c3-200">L’ouverture de session a échoué.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-200">The logon failed.</span></span>                                                                                                                                                           |
| <span data-ttu-id="6d0c3-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span><span class="sxs-lookup"><span data-stu-id="6d0c3-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span></span> <br/> <span data-ttu-id="6d0c3-202">0x80090311L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-202">0x80090311L</span></span> | <span data-ttu-id="6d0c3-203">Échec de la fonction.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-203">The function failed.</span></span> <span data-ttu-id="6d0c3-204">Aucune autorité n’a pu être contactée pour l’authentification.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-204">No authority could be contacted for authentication.</span></span> <span data-ttu-id="6d0c3-205">Cela peut être dû aux conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="6d0c3-205">This could be due to the following conditions:</span></span><br/><ul><li><span data-ttu-id="6d0c3-206">Le nom de domaine du tiers d’authentification est incorrect.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-206">The domain name of the authenticating party is incorrect.</span></span></li><li><span data-ttu-id="6d0c3-207">Le domaine n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-207">The domain is unavailable.</span></span></li><li><span data-ttu-id="6d0c3-208">La relation d’approbation a échoué.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-208">The trust relationship has failed.</span></span> |
| <span data-ttu-id="6d0c3-209">SEC_E_NO_CREDENTIALS</span><span class="sxs-lookup"><span data-stu-id="6d0c3-209">SEC_E_NO_CREDENTIALS</span></span> <br/><span data-ttu-id="6d0c3-210">0x8009030EL</span><span class="sxs-lookup"><span data-stu-id="6d0c3-210">0x8009030EL</span></span>               | <span data-ttu-id="6d0c3-211">Échec de la fonction.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-211">The function failed.</span></span> <span data-ttu-id="6d0c3-212">Le descripteur des informations d’identification spécifié dans le paramètre *phCredential* n’est pas valide.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-212">The credentials handle specified in the *phCredential* parameter is not valid.</span></span>                            |
| <span data-ttu-id="6d0c3-213">SEC_E_OK</span><span class="sxs-lookup"><span data-stu-id="6d0c3-213">SEC_E_OK</span></span> <br/> <span data-ttu-id="6d0c3-214">0x00000000L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-214">0x00000000L</span></span>                          | <span data-ttu-id="6d0c3-215">La fonction a réussi.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-215">The function succeeded.</span></span> <span data-ttu-id="6d0c3-216">Le contexte de sécurité reçu du client a été accepté.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-216">The security context received from the client was accepted.</span></span> <span data-ttu-id="6d0c3-217">Si la fonction a généré un jeton de sortie, le jeton doit être envoyé au processus client.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-217">If the function generated an output token, the token must be sent to the client process.</span></span> |
| <span data-ttu-id="6d0c3-218">SEC_E_UNSUPPORTED_FUNCTION</span><span class="sxs-lookup"><span data-stu-id="6d0c3-218">SEC_E_UNSUPPORTED_FUNCTION</span></span> <br/> <span data-ttu-id="6d0c3-219">0x80090302L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-219">0x80090302L</span></span>        | <span data-ttu-id="6d0c3-220">Échec de la fonction.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-220">The function failed.</span></span> <span data-ttu-id="6d0c3-221">Le paramètre *fContextReq* a spécifié un indicateur d’attribut de contexte (ASC_REQ_DELEGATE ou ASC_REQ_PROMPT_FOR_CREDS) qui n’était pas valide.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-221">The *fContextReq* parameter specified a context attribute flag (ASC_REQ_DELEGATE or ASC_REQ_PROMPT_FOR_CREDS) that was not valid.</span></span>                       |
| <span data-ttu-id="6d0c3-222">SEC_I_COMPLETE_AND_CONTINUE</span><span class="sxs-lookup"><span data-stu-id="6d0c3-222">SEC_I_COMPLETE_AND_CONTINUE</span></span> <br/> <span data-ttu-id="6d0c3-223">0x00090314L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-223">0x00090314L</span></span>       | <span data-ttu-id="6d0c3-224">La fonction a réussi.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-224">The function succeeded.</span></span> <span data-ttu-id="6d0c3-225">Le serveur doit appeler [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) et transmettre le jeton de sortie au client.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-225">The server must call [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and pass the output token to the client.</span></span> <span data-ttu-id="6d0c3-226">Le serveur doit ensuite attendre un jeton de retour du client avant d’effectuer un autre appel à [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="6d0c3-226">The server must then wait for a return token from the client before making another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span> |
| <span data-ttu-id="6d0c3-227">SEC_I_COMPLETE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="6d0c3-227">SEC_I_COMPLETE_NEEDED</span></span> <br/> <span data-ttu-id="6d0c3-228">0x00090313L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-228">0x00090313L</span></span>             | <span data-ttu-id="6d0c3-229">La fonction a réussi.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-229">The function succeeded.</span></span> <span data-ttu-id="6d0c3-230">Le serveur doit terminer la génération du message à partir du client avant d’appeler [ **CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span><span class="sxs-lookup"><span data-stu-id="6d0c3-230">The server must finish building the message from the client before calling [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span></span>                             |
| <span data-ttu-id="6d0c3-231">SEC_I_CONTINUE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="6d0c3-231">SEC_I_CONTINUE_NEEDED</span></span> <br/> <span data-ttu-id="6d0c3-232">0x00090312L</span><span class="sxs-lookup"><span data-stu-id="6d0c3-232">0x00090312L</span></span>             | <span data-ttu-id="6d0c3-233">La fonction a réussi.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-233">The function succeeded.</span></span> <span data-ttu-id="6d0c3-234">Le serveur doit envoyer le jeton de sortie au client et attendre un jeton retourné.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-234">The server must send the output token to the client and wait for a returned token.</span></span> <span data-ttu-id="6d0c3-235">Le jeton retourné doit être passé dans *pInput* pour un autre appel à [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="6d0c3-235">The returned token should be passed in *pInput* for another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span>


## <a name="remarks"></a><span data-ttu-id="6d0c3-236">Notes</span><span class="sxs-lookup"><span data-stu-id="6d0c3-236">Remarks</span></span>

<span data-ttu-id="6d0c3-237">La fonction **AcceptSecurityContext (CredSSP)** est l’équivalent serveur de la fonction [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) .</span><span class="sxs-lookup"><span data-stu-id="6d0c3-237">The **AcceptSecurityContext (CredSSP)** function is the server counterpart to the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function.</span></span>

<span data-ttu-id="6d0c3-238">Lorsque le serveur reçoit une demande d’un client, il utilise le paramètre *fContextReq* pour spécifier ce qu’il requiert de la session.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-238">When the server receives a request from a client, it uses the *fContextReq* parameter to specify what it requires of the session.</span></span> <span data-ttu-id="6d0c3-239">De cette manière, un serveur peut exiger que les clients soient en mesure d’utiliser une session confidentielle ou contrôlée par [*l’intégrité*](../secgloss/i-gly.md); Il peut rejeter les clients qui ne peuvent pas répondre à cette demande.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-239">In this fashion, a server can require that clients be capable of using a confidential or [*integrity*](../secgloss/i-gly.md)-checked session; it can reject clients that cannot meet that demand.</span></span> <span data-ttu-id="6d0c3-240">Une autre solution consiste à ne pas avoir besoin d’un serveur. ce que le client requiert ou peut fournir est retourné dans le paramètre *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="6d0c3-240">Alternatively, a server can require nothing; whatever the client requires or can provide is returned in the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="6d0c3-241">Les paramètres *fContextReq* et *pfContextAttr* sont des masques de masques qui représentent différents attributs de contexte.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-241">The *fContextReq* and *pfContextAttr* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="6d0c3-242">Pour obtenir une description des différents attributs, consultez [spécifications de contexte](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="6d0c3-242">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

> [!Note]  
> <span data-ttu-id="6d0c3-243">Tandis que le paramètre *pfContextAttr* est valide en cas de retour correct, vous devez examiner les indicateurs relatifs aux aspects de sécurité du contexte uniquement lors du retour final réussi.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-243">While the *pfContextAttr* parameter is valid on any successful return, you should examine the flags pertaining to security aspects of the context only on the final successful return.</span></span> <span data-ttu-id="6d0c3-244">Les retours intermédiaires peuvent définir, par exemple, \_ l' \_ indicateur ISC RET allouée \_ Memory.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-244">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

<span data-ttu-id="6d0c3-245">L’appelant est chargé de déterminer si les attributs de contexte finaux sont suffisants.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-245">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="6d0c3-246">Par exemple, si la confidentialité (chiffrement) a été demandée mais n’a pas pu être établie, certaines applications peuvent choisir d’arrêter immédiatement la connexion.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-246">For example, if confidentiality (encryption) was requested but could not be established, some applications may choose to shut down the connection immediately.</span></span> <span data-ttu-id="6d0c3-247">Si le contexte de sécurité ne peut pas être établi, le serveur doit libérer le contexte partiellement créé en appelant la fonction [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="6d0c3-247">If the security context cannot be established, the server must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span> <span data-ttu-id="6d0c3-248">Pour plus d’informations sur l’appel de la fonction **DeleteSecurityContext** , consultez **DeleteSecurityContext**.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-248">For information about when to call the **DeleteSecurityContext** function, see **DeleteSecurityContext**.</span></span>

<span data-ttu-id="6d0c3-249">Une fois le contexte de sécurité établi, l’application serveur peut utiliser la fonction [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) pour récupérer un handle vers le compte d’utilisateur auquel le certificat client a été mappé.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-249">After the security context has been established, the server application can use the [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) function to retrieve a handle to the user account to which the client certificate was mapped.</span></span> <span data-ttu-id="6d0c3-250">En outre, le serveur peut utiliser la fonction [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) pour emprunter l’identité de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="6d0c3-250">Also, the server can use the [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) function to impersonate the user.</span></span>

## <a name="requirements"></a><span data-ttu-id="6d0c3-251">Configuration requise</span><span class="sxs-lookup"><span data-stu-id="6d0c3-251">Requirements</span></span>

| <span data-ttu-id="6d0c3-252">Condition requise</span><span class="sxs-lookup"><span data-stu-id="6d0c3-252">Requirement</span></span> | <span data-ttu-id="6d0c3-253">Valeur</span><span class="sxs-lookup"><span data-stu-id="6d0c3-253">Value</span></span> |
|--------------------------|-------------------------------------------|
| <span data-ttu-id="6d0c3-254">Client minimal pris en charge</span><span class="sxs-lookup"><span data-stu-id="6d0c3-254">Minimum supported client</span></span> | <span data-ttu-id="6d0c3-255">Applications de \[ Bureau Windows Vista uniquement\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-255">Windows�Vista \[desktop apps only\]</span></span>       |
| <span data-ttu-id="6d0c3-256">Serveur minimal pris en charge</span><span class="sxs-lookup"><span data-stu-id="6d0c3-256">Minimum supported server</span></span> | <span data-ttu-id="6d0c3-257">Applications de bureau Windows Server 2008 \[ uniquement\]</span><span class="sxs-lookup"><span data-stu-id="6d0c3-257">Windows Server�2008 \[desktop apps only\]</span></span> |
| <span data-ttu-id="6d0c3-258">En-tête</span><span class="sxs-lookup"><span data-stu-id="6d0c3-258">Header</span></span>                   | <span data-ttu-id="6d0c3-259">SSPI. h (include Security. h)</span><span class="sxs-lookup"><span data-stu-id="6d0c3-259">Sspi.h (include Security.h)</span></span>               |
| <span data-ttu-id="6d0c3-260">Bibliothèque</span><span class="sxs-lookup"><span data-stu-id="6d0c3-260">Library</span></span>                  | <span data-ttu-id="6d0c3-261">Secur32. lib</span><span class="sxs-lookup"><span data-stu-id="6d0c3-261">Secur32.lib</span></span>                               |
| <span data-ttu-id="6d0c3-262">DLL</span><span class="sxs-lookup"><span data-stu-id="6d0c3-262">DLL</span></span>                      | <span data-ttu-id="6d0c3-263">Secur32.dll</span><span class="sxs-lookup"><span data-stu-id="6d0c3-263">Secur32.dll</span></span>                               |

## <a name="see-also"></a><span data-ttu-id="6d0c3-264">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="6d0c3-264">See also</span></span>

- [<span data-ttu-id="6d0c3-265">Fonctions SSPI</span><span class="sxs-lookup"><span data-stu-id="6d0c3-265">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
- [<span data-ttu-id="6d0c3-266">**DeleteSecurityContext**</span><span class="sxs-lookup"><span data-stu-id="6d0c3-266">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
- [<span data-ttu-id="6d0c3-267">**InitializeSecurityContext (CredSSP)**</span><span class="sxs-lookup"><span data-stu-id="6d0c3-267">**InitializeSecurityContext (CredSSP)**</span></span>](initializesecuritycontext--credssp.md)
