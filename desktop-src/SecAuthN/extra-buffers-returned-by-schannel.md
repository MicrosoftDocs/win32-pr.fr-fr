---
description: Schannel possède un ensemble bien défini de comportements pour les informations incomplètes ou excédentaires incluses dans les mémoires tampons d’entrée de ces fonctions.
ms.assetid: 5fad1e76-6520-4ff7-b2b0-2cc2061062a1
title: Mémoires tampons supplémentaires retournées par Schannel
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5b0c9ce7a468b1b04389ad19f91785b64fb50e74
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106545850"
---
# <a name="extra-buffers-returned-by-schannel"></a><span data-ttu-id="8911b-103">Mémoires tampons supplémentaires retournées par Schannel</span><span class="sxs-lookup"><span data-stu-id="8911b-103">Extra Buffers Returned by Schannel</span></span>

<span data-ttu-id="8911b-104">Les informations doivent être envoyées entre le client et le serveur lors de l’établissement d’un [*contexte de sécurité*](/windows/desktop/SecGloss/s-gly) et par la suite, car les messages sécurisés sont échangés à l’aide des fonctionnalités de chiffrement et de déchiffrement fournies par Schannel.</span><span class="sxs-lookup"><span data-stu-id="8911b-104">Information must be sent between the client and server while a [*security context*](/windows/desktop/SecGloss/s-gly) is being established and afterward because secure messages are exchanged by using the encryption and decryption features provided by Schannel.</span></span> <span data-ttu-id="8911b-105">Les fonctions suivantes sont utilisées pour accomplir ces tâches :</span><span class="sxs-lookup"><span data-stu-id="8911b-105">The following functions are used to accomplish these tasks:</span></span>

-   [<span data-ttu-id="8911b-106">**AcceptSecurityContext (général)**</span><span class="sxs-lookup"><span data-stu-id="8911b-106">**AcceptSecurityContext (General)**</span></span>](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext)
-   [<span data-ttu-id="8911b-107">**InitializeSecurityContext (général)**</span><span class="sxs-lookup"><span data-stu-id="8911b-107">**InitializeSecurityContext (General)**</span></span>](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta)
-   [<span data-ttu-id="8911b-108">**DecryptMessage (général)**</span><span class="sxs-lookup"><span data-stu-id="8911b-108">**DecryptMessage (General)**</span></span>](/windows/win32/api/sspi/nf-sspi-decryptmessage)

<span data-ttu-id="8911b-109">Schannel possède un ensemble bien défini de comportements pour les informations incomplètes ou excédentaires incluses dans les mémoires tampons d’entrée de ces fonctions.</span><span class="sxs-lookup"><span data-stu-id="8911b-109">Schannel has a well-defined set of behaviors for incomplete or excess information included in the input buffers to these functions.</span></span> <span data-ttu-id="8911b-110">Les informations sont échangées entre le client et le serveur de la manière suivante :</span><span class="sxs-lookup"><span data-stu-id="8911b-110">Information is exchanged between the client and server in the following manner:</span></span>

1.  <span data-ttu-id="8911b-111">Le tiers local interagit avec Schannel en appelant une fonction SSPI et en transmettant les informations.</span><span class="sxs-lookup"><span data-stu-id="8911b-111">The local party interacts with Schannel by calling an SSPI function and passing in information.</span></span> <span data-ttu-id="8911b-112">En règle générale, les informations ont été reçues du tiers distant.</span><span class="sxs-lookup"><span data-stu-id="8911b-112">Typically, the information was received from the remote party.</span></span>
2.  <span data-ttu-id="8911b-113">La fonction retourne un code d’État et des mémoires tampons de sortie contenant des informations.</span><span class="sxs-lookup"><span data-stu-id="8911b-113">The function returns a status code and output buffers containing information.</span></span>
3.  <span data-ttu-id="8911b-114">En fonction du code d’État, les mémoires tampons de sortie sont envoyées au tiers distant au moyen d’un mécanisme de communication.</span><span class="sxs-lookup"><span data-stu-id="8911b-114">Depending on the status code, the output buffers are sent to the remote party by means of some communication mechanism.</span></span>
4.  <span data-ttu-id="8911b-115">Le tiers distant lit les informations envoyées par le tiers local.</span><span class="sxs-lookup"><span data-stu-id="8911b-115">The remote party reads information sent by the local party.</span></span>
5.  <span data-ttu-id="8911b-116">La boucle se répète, avec les parties locales et distantes interchangeables.</span><span class="sxs-lookup"><span data-stu-id="8911b-116">The loop repeats, with the local and remote parties interchanged.</span></span> <span data-ttu-id="8911b-117">(Le tiers distant appelle une fonction SSPI et transmet les informations lues à l’étape précédente.)</span><span class="sxs-lookup"><span data-stu-id="8911b-117">(The remote party calls an SSPI function and passes in the information read in the previous step.)</span></span>

<span data-ttu-id="8911b-118">Tout fonctionne comme prévu lorsque la mémoire tampon d’entrée de la fonction SSPI contient exactement les informations nécessaires.</span><span class="sxs-lookup"><span data-stu-id="8911b-118">Everything works as expected when the input buffer to the SSPI function contains exactly the information needed.</span></span> <span data-ttu-id="8911b-119">Toutefois, en raison de la nature orientée flux de certains protocoles de communication, ce n’est peut-être pas le cas. un bloc d’informations reçues d’un tiers distant peut contenir moins de données que le nombre requis ou plus de données qu’il n’est possible de traiter par Schannel dans un appel de fonction unique.</span><span class="sxs-lookup"><span data-stu-id="8911b-119">However, due to the stream-oriented nature of some communications protocols this may not be the case; a block of information received from a remote party may contain less data than is required or more data than can be processed by Schannel in a single function call.</span></span>

<span data-ttu-id="8911b-120">Si la mémoire tampon d’entrée contient trop peu d’informations, le message Functions Return s \_ E \_ incomplet \_ .</span><span class="sxs-lookup"><span data-stu-id="8911b-120">If the input buffer contains too little information, the functions return SEC\_E\_INCOMPLETE\_MESSAGE.</span></span> <span data-ttu-id="8911b-121">L’appelant doit obtenir des données supplémentaires du tiers distant et appeler à nouveau la fonction.</span><span class="sxs-lookup"><span data-stu-id="8911b-121">The caller must obtain additional data from the remote party and call the function again.</span></span>

<span data-ttu-id="8911b-122">Lorsque les mémoires tampons d’entrée contiennent trop d’informations, Schannel ne traite pas ce problème comme une erreur.</span><span class="sxs-lookup"><span data-stu-id="8911b-122">When the input buffers contains too much information, Schannel does not treat this as an error.</span></span> <span data-ttu-id="8911b-123">La fonction traite autant de l’entrée que possible, et retourne le code d’État pour cette activité de traitement.</span><span class="sxs-lookup"><span data-stu-id="8911b-123">The function processes as much of the input as it can, and returns the status code for that processing activity.</span></span> <span data-ttu-id="8911b-124">En outre, Schannel indique la présence d’informations non traitées dans les tampons d’entrée en retournant une mémoire tampon de sortie de type SECBUFFER \_ extra.</span><span class="sxs-lookup"><span data-stu-id="8911b-124">In addition, Schannel indicates the presence of unprocessed information in the input buffers by returning an output buffer of type SECBUFFER\_EXTRA.</span></span> <span data-ttu-id="8911b-125">Le test des tampons de sortie pour ce type de mémoire tampon est le seul moyen de détecter cette situation.</span><span class="sxs-lookup"><span data-stu-id="8911b-125">Testing the output buffers for this type of buffer is the only way to detect this situation.</span></span> <span data-ttu-id="8911b-126">Le champ **cbBuffer** de la structure de mémoire tampon supplémentaire indique le nombre d’octets d’entrée qui n’ont pas été traités.</span><span class="sxs-lookup"><span data-stu-id="8911b-126">The **cbBuffer** field of the extra buffer structure indicates how many bytes of input were not processed.</span></span>

> [!Note]  
> <span data-ttu-id="8911b-127">Le champ **pvBuffer** de la mémoire tampon supplémentaire ne contient pas de copie des données excédentaires.</span><span class="sxs-lookup"><span data-stu-id="8911b-127">The **pvBuffer** field of the extra buffer does not contain a copy of the excess data.</span></span>

 

<span data-ttu-id="8911b-128">Si vous recevez une mémoire tampon supplémentaire à partir d’une fonction SSPI, vous devez supprimer les informations déjà traitées de la mémoire tampon d’entrée et appeler à nouveau la fonction.</span><span class="sxs-lookup"><span data-stu-id="8911b-128">If you receive an extra buffer from a SSPI function, you must remove the already processed information from the input buffer and call the function again.</span></span> <span data-ttu-id="8911b-129">Schannel peut et, souvent, retourne uniquement la mémoire tampon supplémentaire et rien d’autre dans les tampons de sortie.</span><span class="sxs-lookup"><span data-stu-id="8911b-129">Schannel can, and often does, return only the extra buffer and nothing else in the output buffers.</span></span>

 

 
