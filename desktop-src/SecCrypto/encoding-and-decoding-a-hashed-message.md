---
description: Décrit les tâches requises pour encoder un message haché.
ms.assetid: c1a65452-c634-4cc6-9afe-d6bf11d999d1
title: Encodage et décodage d’un message haché
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d91d165634c1ae00a59f2c77b1fc5a36b53dbd96
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106536188"
---
# <a name="encoding-and-decoding-a-hashed-message"></a><span data-ttu-id="6a90c-103">Encodage et décodage d’un message haché</span><span class="sxs-lookup"><span data-stu-id="6a90c-103">Encoding and Decoding a Hashed Message</span></span>

<span data-ttu-id="6a90c-104">Les données hachées se composent d’un contenu de tout type et d’un [*hachage*](../secgloss/h-gly.md) du contenu.</span><span class="sxs-lookup"><span data-stu-id="6a90c-104">Hashed data consists of content of any type and a [*hash*](../secgloss/h-gly.md) of the content.</span></span> <span data-ttu-id="6a90c-105">Il peut être utilisé lorsqu’il est nécessaire uniquement de confirmer que le contenu du message n’a pas été modifié depuis la création du hachage.</span><span class="sxs-lookup"><span data-stu-id="6a90c-105">It can be used when it is only necessary to confirm that the message content has not been modified since the hash was created.</span></span>

<span data-ttu-id="6a90c-106">Lors de la création d’un message haché, il peut y avoir plusieurs algorithmes de hachage et plusieurs hachages.</span><span class="sxs-lookup"><span data-stu-id="6a90c-106">When creating a hashed message, there can be multiple hash algorithms and multiple hashes.</span></span> <span data-ttu-id="6a90c-107">L’illustration suivante représente les tâches requises pour encoder un message haché.</span><span class="sxs-lookup"><span data-stu-id="6a90c-107">The following illustration depicts the tasks required to encode a hashed message.</span></span> <span data-ttu-id="6a90c-108">La procédure est décrite dans le texte qui suit l’illustration.</span><span class="sxs-lookup"><span data-stu-id="6a90c-108">The procedure is described in the text that follows the illustration.</span></span>

![création d’un message haché](images/hashmsg.png)

<span data-ttu-id="6a90c-110">**Pour créer un message haché**</span><span class="sxs-lookup"><span data-stu-id="6a90c-110">**To create a hashed message**</span></span>

1.  <span data-ttu-id="6a90c-111">Obtient un pointeur vers les données à hacher.</span><span class="sxs-lookup"><span data-stu-id="6a90c-111">Get a pointer to the data to be hashed.</span></span>
2.  <span data-ttu-id="6a90c-112">Sélectionnez l’algorithme de hachage à utiliser.</span><span class="sxs-lookup"><span data-stu-id="6a90c-112">Select the hash algorithm to be used.</span></span>
3.  <span data-ttu-id="6a90c-113">Placez les données à l’aide d’une fonction de hachage à l’aide de l’algorithme de hachage.</span><span class="sxs-lookup"><span data-stu-id="6a90c-113">Put the data through a hashing function using the hash algorithm.</span></span>
4.  <span data-ttu-id="6a90c-114">Incluez les données d’origine à hacher, les algorithmes de hachage et les hachages dans le message encodé.</span><span class="sxs-lookup"><span data-stu-id="6a90c-114">Include the original data to be hashed, the hashing algorithms, and the hashes in the encoded message.</span></span>

<span data-ttu-id="6a90c-115">Pour utiliser les fonctions de message de bas niveau pour accomplir les tâches présentées ci-dessous, utilisez la procédure suivante.</span><span class="sxs-lookup"><span data-stu-id="6a90c-115">To use low-level message functions to accomplish the tasks just outlined, use the following procedure.</span></span>

<span data-ttu-id="6a90c-116">**Pour hacher et encoder un message à l’aide de fonctions de message de bas niveau**</span><span class="sxs-lookup"><span data-stu-id="6a90c-116">**To hash and encode a message using low-level message functions**</span></span>

1.  <span data-ttu-id="6a90c-117">Créez ou récupérez le contenu à hacher.</span><span class="sxs-lookup"><span data-stu-id="6a90c-117">Create or retrieve the content to be hashed.</span></span>
2.  <span data-ttu-id="6a90c-118">Obtenir un fournisseur de services de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="6a90c-118">Get a cryptographic provider.</span></span>
3.  <span data-ttu-id="6a90c-119">Initialisez la structure d' [**\_ \_ \_ informations de codage hachée CMSG**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) .</span><span class="sxs-lookup"><span data-stu-id="6a90c-119">Initialize the [**CMSG\_HASHED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) structure.</span></span>
4.  <span data-ttu-id="6a90c-120">Appelez [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) pour connaître la taille de l’objet blob de message encodé.</span><span class="sxs-lookup"><span data-stu-id="6a90c-120">Call [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) to get the size of the encoded message BLOB.</span></span> <span data-ttu-id="6a90c-121">Allouez de la mémoire pour celui-ci.</span><span class="sxs-lookup"><span data-stu-id="6a90c-121">Allocate memory for it.</span></span>
5.  <span data-ttu-id="6a90c-122">Appelez [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), en transmettant CMSG \_ haché pour le paramètre *dwMsgType* et un pointeur vers les [**\_ \_ \_ informations de codage hachées CMSG**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) pour le paramètre *pvMsgEncodeInfo* .</span><span class="sxs-lookup"><span data-stu-id="6a90c-122">Call [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passing in CMSG\_HASHED for the *dwMsgType* parameter and a pointer to [**CMSG\_HASHED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) for the *pvMsgEncodeInfo* parameter.</span></span> <span data-ttu-id="6a90c-123">À la suite de cet appel, vous obtenez un handle pour le message ouvert.</span><span class="sxs-lookup"><span data-stu-id="6a90c-123">As a result of this call, you get a handle to the opened message.</span></span>
6.  <span data-ttu-id="6a90c-124">Appelez [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), en passant le handle récupéré à l’étape 5 et un pointeur vers les données à hacher et à encoder.</span><span class="sxs-lookup"><span data-stu-id="6a90c-124">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), passing in the handle retrieved in step 5 and a pointer to the data that is to be hashed and encoded.</span></span> <span data-ttu-id="6a90c-125">Cette fonction peut être appelée autant de fois que nécessaire pour terminer le processus d’encodage.</span><span class="sxs-lookup"><span data-stu-id="6a90c-125">This function can be called as many times as necessary to complete the encoding process.</span></span>
7.  <span data-ttu-id="6a90c-126">Appelez [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), en passant le handle récupéré à l’étape 5 et les types de paramètres appropriés pour accéder aux données encodées souhaitées.</span><span class="sxs-lookup"><span data-stu-id="6a90c-126">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 5 and the appropriate parameter types to access the desired, encoded data.</span></span> <span data-ttu-id="6a90c-127">Par exemple, transmettez \_ le paramètre de contenu CMSG \_ pour obtenir un pointeur vers l’intégralité du message [*PKCS \# 7*](../secgloss/p-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="6a90c-127">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the entire [*PKCS \#7*](../secgloss/p-gly.md) message.</span></span>

    <span data-ttu-id="6a90c-128">Si le résultat de cet encodage doit être utilisé comme [*données internes*](../secgloss/i-gly.md) pour un autre message encodé, tel qu’un message enveloppé, le \_ paramètre CMSG Bare \_ Content \_ doit être passé.</span><span class="sxs-lookup"><span data-stu-id="6a90c-128">If the result of this encoding is to be used as the [*inner data*](../secgloss/i-gly.md) for another encoded message, such as an enveloped message, CMSG\_BARE\_CONTENT\_PARAM must be passed.</span></span> <span data-ttu-id="6a90c-129">Pour obtenir un exemple qui illustre cela, consultez [autre code pour l’encodage d’un message enveloppé](alternate-code-for-encoding-an-enveloped-message.md).</span><span class="sxs-lookup"><span data-stu-id="6a90c-129">For an example showing this, see [Alternate Code for Encoding an Enveloped Message](alternate-code-for-encoding-an-enveloped-message.md).</span></span>

8.  <span data-ttu-id="6a90c-130">Fermez le message en appelant [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span><span class="sxs-lookup"><span data-stu-id="6a90c-130">Close the message by calling [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span></span>

<span data-ttu-id="6a90c-131">Le résultat de cette procédure est un message encodé qui contient les données d’origine, les algorithmes de hachage et le [*hachage*](../secgloss/h-gly.md) de ces données.</span><span class="sxs-lookup"><span data-stu-id="6a90c-131">The result of this procedure is an encoded message that contains the original data, the hashing algorithms, and the [*hash*](../secgloss/h-gly.md) of that data.</span></span> <span data-ttu-id="6a90c-132">Un pointeur vers l' [*objet BLOB*](../secgloss/b-gly.md) de message encodé est obtenu à l’étape 7.</span><span class="sxs-lookup"><span data-stu-id="6a90c-132">A pointer to the encoded message [*BLOB*](../secgloss/b-gly.md) is obtained in step 7.</span></span>

<span data-ttu-id="6a90c-133">Les deux procédures suivantes décodent puis vérifient les données hachées.</span><span class="sxs-lookup"><span data-stu-id="6a90c-133">The following two procedures decode and then verify hashed data.</span></span>

<span data-ttu-id="6a90c-134">**Pour décoder des données hachées**</span><span class="sxs-lookup"><span data-stu-id="6a90c-134">**To decode hashed data**</span></span>

1.  <span data-ttu-id="6a90c-135">Obtient un pointeur vers l’objet BLOB encodé.</span><span class="sxs-lookup"><span data-stu-id="6a90c-135">Get a pointer to the encoded BLOB.</span></span>
2.  <span data-ttu-id="6a90c-136">Appelez [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), en passant les arguments nécessaires.</span><span class="sxs-lookup"><span data-stu-id="6a90c-136">Call [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passing the necessary arguments.</span></span>
3.  <span data-ttu-id="6a90c-137">Appelez [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) une fois, en passant le handle récupéré à l’étape 2 et un pointeur vers les données qui doivent être décodées.</span><span class="sxs-lookup"><span data-stu-id="6a90c-137">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) once, passing in the handle retrieved in step 2 and a pointer to the data that is to be decoded.</span></span> <span data-ttu-id="6a90c-138">Cela entraîne le suivi des actions appropriées sur le message, en fonction du type de message.</span><span class="sxs-lookup"><span data-stu-id="6a90c-138">This causes the appropriate actions to be taken on the message, depending on the message type.</span></span>
4.  <span data-ttu-id="6a90c-139">Appelez [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), en passant le handle récupéré à l’étape 2, et les types de paramètres appropriés pour accéder aux données décodées souhaitées.</span><span class="sxs-lookup"><span data-stu-id="6a90c-139">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 2, and the appropriate parameter types to access the desired, decoded data.</span></span> <span data-ttu-id="6a90c-140">Par exemple, transmettez \_ le paramètre de contenu CMSG \_ pour obtenir un pointeur vers le contenu décodé.</span><span class="sxs-lookup"><span data-stu-id="6a90c-140">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the decoded content.</span></span>

<span data-ttu-id="6a90c-141">**Pour vérifier le hachage**</span><span class="sxs-lookup"><span data-stu-id="6a90c-141">**To verify the hash**</span></span>

1.  <span data-ttu-id="6a90c-142">Appelez [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), en passant \_ \_ le hachage CMSG Ctrl Verify \_ pour vérifier les hachages.</span><span class="sxs-lookup"><span data-stu-id="6a90c-142">Call [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passing in CMSG\_CTRL\_VERIFY\_HASH to verify the hashes.</span></span>
2.  <span data-ttu-id="6a90c-143">Appelez [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) pour fermer le message.</span><span class="sxs-lookup"><span data-stu-id="6a90c-143">Call [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) to close the message.</span></span>

<span data-ttu-id="6a90c-144">Pour obtenir un exemple de programme, consultez [exemple de programme C : encodage et décodage d’un message haché](example-c-program-encoding-and-decoding-a-hashed-message.md).</span><span class="sxs-lookup"><span data-stu-id="6a90c-144">For an example program, see [Example C Program: Encoding and Decoding a Hashed Message](example-c-program-encoding-and-decoding-a-hashed-message.md).</span></span>

 

 
