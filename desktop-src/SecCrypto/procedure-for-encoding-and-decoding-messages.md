---
description: Détaille la procédure d’encodage d’un message général.
ms.assetid: 554cab0d-cfa2-46a7-80d9-f41430eb4b47
title: Procédure d’encodage et de décodage des messages
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 49da09c2318fffd3d1c92d6012055172709609a7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106517020"
---
# <a name="procedure-for-encoding-and-decoding-messages"></a><span data-ttu-id="644c6-103">Procédure d’encodage et de décodage des messages</span><span class="sxs-lookup"><span data-stu-id="644c6-103">Procedure for Encoding and Decoding Messages</span></span>

<span data-ttu-id="644c6-104">La procédure d’encodage d’un message général est la suivante.</span><span class="sxs-lookup"><span data-stu-id="644c6-104">The procedure for encoding a general message is as follows.</span></span>

<span data-ttu-id="644c6-105">**Pour encoder un message**</span><span class="sxs-lookup"><span data-stu-id="644c6-105">**To encode a message**</span></span>

1.  <span data-ttu-id="644c6-106">Initialisez les structures de données appropriées pour le type de données souhaité.</span><span class="sxs-lookup"><span data-stu-id="644c6-106">Initialize the appropriate data structures for the desired data type.</span></span>
2.  <span data-ttu-id="644c6-107">Appelez [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), en passant les arguments nécessaires.</span><span class="sxs-lookup"><span data-stu-id="644c6-107">Call [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passing the necessary arguments.</span></span> <span data-ttu-id="644c6-108">Lors de l’appel de **CryptMsgOpenToEncode**, si les données qui doivent être fournies à [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) ont déjà été codées en message, transmettez l’identificateur d’objet approprié dans *pszInnerContentObjID* (par exemple, « 1.2.840.113549.1.7.2 » pour szOID \_ RSA \_ SignedData).</span><span class="sxs-lookup"><span data-stu-id="644c6-108">When calling **CryptMsgOpenToEncode**, if the data that is to be provided to [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) has already been message-encoded, pass the appropriate object identifier in *pszInnerContentObjID* (for example, "1.2.840.113549.1.7.2" for szOID\_RSA\_signedData).</span></span> <span data-ttu-id="644c6-109">Si *pszInnerContentObjID* a la **valeur null**, le type de [*contenu interne*](../secgloss/i-gly.md) est supposé ne pas avoir été précédemment encodé et traité correctement.</span><span class="sxs-lookup"><span data-stu-id="644c6-109">If *pszInnerContentObjID* is **NULL**, the [*inner content*](../secgloss/i-gly.md) type is assumed not to have been previously encoded and is processed appropriately.</span></span>
3.  <span data-ttu-id="644c6-110">Appelez [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) autant de fois que nécessaire pour terminer le message.</span><span class="sxs-lookup"><span data-stu-id="644c6-110">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) as many times as necessary to complete the message.</span></span> <span data-ttu-id="644c6-111">Lors du dernier appel, définissez le paramètre *fFinal* sur **true**.</span><span class="sxs-lookup"><span data-stu-id="644c6-111">On the last call, set the *fFinal* parameter to **TRUE**.</span></span> <span data-ttu-id="644c6-112">(Pour plus d’informations, consultez **CryptMsgUpdate**).</span><span class="sxs-lookup"><span data-stu-id="644c6-112">(For details, see **CryptMsgUpdate**).</span></span>
4.  <span data-ttu-id="644c6-113">Appelez [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) pour obtenir un pointeur vers les paramètres souhaités, tels que le contenu.</span><span class="sxs-lookup"><span data-stu-id="644c6-113">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) to get a pointer to the desired parameters, such as the content.</span></span> <span data-ttu-id="644c6-114">Pour l’encodage de données simples et générales, utilisez \_ \_ le paramètre de contenu CMSG pour *dwParamtype*.</span><span class="sxs-lookup"><span data-stu-id="644c6-114">For encoding simple, general data, use CMSG\_CONTENT\_PARAM for the *dwParamtype*.</span></span>
5.  <span data-ttu-id="644c6-115">Fermez le message en appelant [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span><span class="sxs-lookup"><span data-stu-id="644c6-115">Close the message by calling [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span></span>

<span data-ttu-id="644c6-116">Cette procédure génère un message encodé d’un type spécifié dans les appels de fonction.</span><span class="sxs-lookup"><span data-stu-id="644c6-116">This procedure results in an encoded message of a type specified in the function calls.</span></span>

<span data-ttu-id="644c6-117">La procédure de décodage d’un message général se présente comme suit.</span><span class="sxs-lookup"><span data-stu-id="644c6-117">The procedure for decoding a general message is as follows.</span></span>

<span data-ttu-id="644c6-118">**Pour décoder un message**</span><span class="sxs-lookup"><span data-stu-id="644c6-118">**To decode a message**</span></span>

1.  <span data-ttu-id="644c6-119">Déterminez la longueur nécessaire pour que la mémoire tampon contienne les données encodées à l’aide de [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength).</span><span class="sxs-lookup"><span data-stu-id="644c6-119">Determine the length needed for the buffer to hold the encoded data using [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength).</span></span>
2.  <span data-ttu-id="644c6-120">Appelez [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), en passant les arguments nécessaires.</span><span class="sxs-lookup"><span data-stu-id="644c6-120">Call [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passing the necessary arguments.</span></span> <span data-ttu-id="644c6-121">Pour assurer la compatibilité avec Internet Explorer version 3,0, le paramètre *dwMsgType* est fourni.</span><span class="sxs-lookup"><span data-stu-id="644c6-121">To maintain compatibility with Internet Explorer version 3.0, the *dwMsgType* parameter is provided.</span></span> <span data-ttu-id="644c6-122">Les données signées créées dans Internet Explorer 3,0 ne contiennent pas d’informations d’en-tête.</span><span class="sxs-lookup"><span data-stu-id="644c6-122">Signed data created in Internet Explorer 3.0 does not contain header information.</span></span> <span data-ttu-id="644c6-123">Par conséquent, si un tel message est extrait des signatures de fichier, le type de message doit être passé dans la fonction.</span><span class="sxs-lookup"><span data-stu-id="644c6-123">Therefore, if such a message is extracted from file signatures, the message type must be passed into the function.</span></span> <span data-ttu-id="644c6-124">Si la valeur zéro est passée dans le paramètre *dwMsgType* , la fonction lira le type de message dans l’en-tête du message.</span><span class="sxs-lookup"><span data-stu-id="644c6-124">If zero is passed into the *dwMsgType* parameter, the function will read the message type from the header on the message.</span></span> <span data-ttu-id="644c6-125">Si l’en-tête est manquant, l’appel de fonction échoue.</span><span class="sxs-lookup"><span data-stu-id="644c6-125">If the header is missing, the function call will fail.</span></span> <span data-ttu-id="644c6-126">En cas de réussite, un descripteur du message ouvert est retourné.</span><span class="sxs-lookup"><span data-stu-id="644c6-126">If successful, a handle to the opened message is returned.</span></span>
3.  <span data-ttu-id="644c6-127">Appelez [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) une fois.</span><span class="sxs-lookup"><span data-stu-id="644c6-127">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) once.</span></span> <span data-ttu-id="644c6-128">Cela entraîne le suivi des actions appropriées sur le message, en fonction du type de message.</span><span class="sxs-lookup"><span data-stu-id="644c6-128">This causes the appropriate actions to be taken on the message, depending on the message type.</span></span>
4.  <span data-ttu-id="644c6-129">Pour un traitement supplémentaire du message, tel qu’un déchiffrement ou une vérification de signature supplémentaire, appelez [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), en passant l’action souhaitée dans *dwCtrlType*.</span><span class="sxs-lookup"><span data-stu-id="644c6-129">For additional processing of the message, such as additional decryption or signature verification, call [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passing the desired action in *dwCtrlType*.</span></span>
5.  <span data-ttu-id="644c6-130">Appelez [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) pour obtenir un pointeur vers les paramètres souhaités, tels que le contenu.</span><span class="sxs-lookup"><span data-stu-id="644c6-130">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) to get a pointer to the desired parameters, such as the content.</span></span> <span data-ttu-id="644c6-131">Pour décoder des données générales simples, utilisez CMSG \_ Content \_ param pour le paramètre *dwParamtype* .</span><span class="sxs-lookup"><span data-stu-id="644c6-131">To decode simple general data, use CMSG\_CONTENT\_PARAM for the *dwParamtype* parameter.</span></span>
6.  <span data-ttu-id="644c6-132">Appelez [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) pour fermer le message.</span><span class="sxs-lookup"><span data-stu-id="644c6-132">Call [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) to close the message.</span></span>

<span data-ttu-id="644c6-133">Pour obtenir un exemple qui implémente ces étapes, consultez [exemple de programme C : encodage et décodage de données](example-c-program-encoding-and-decoding-data.md).</span><span class="sxs-lookup"><span data-stu-id="644c6-133">For an example that implements these steps, see [Example C Program: Encoding and Decoding Data](example-c-program-encoding-and-decoding-data.md).</span></span> <span data-ttu-id="644c6-134">Pour obtenir des procédures et un exemple illustrant le processus d’encodage, de décodage et de vérification de la signature d’un message signé, consultez [exemple de programme C : signature, encodage, décodage et vérification d’un message](example-c-program-signing-encoding-decoding-and-verifying-a-message.md).</span><span class="sxs-lookup"><span data-stu-id="644c6-134">For procedures and an example demonstrating the process of encoding, decoding, and verifying the signature of a signed message, see [Example C Program: Signing, Encoding, Decoding, and Verifying a Message](example-c-program-signing-encoding-decoding-and-verifying-a-message.md).</span></span>

 

 
