---
description: Affiche la relation entre les paramètres de fonction qui pointent vers des structures ou des tableaux et leurs données initialisées.
ms.assetid: 89caf4d3-727f-472b-9a09-e81b4ff4d127
title: Procédure de signature des données
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba289928ab39c690e1c44bdbf65c77c18b7edab3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106519140"
---
# <a name="procedure-for-signing-data"></a><span data-ttu-id="adff0-103">Procédure de signature des données</span><span class="sxs-lookup"><span data-stu-id="adff0-103">Procedure for Signing Data</span></span>

<span data-ttu-id="adff0-104">Une seule fonction, [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage), effectue toutes les tâches listées dans la [création d’un message signé](creating-a-signed-message.md).</span><span class="sxs-lookup"><span data-stu-id="adff0-104">A single function, [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage), performs all of the tasks listed in [Creating a Signed Message](creating-a-signed-message.md).</span></span> <span data-ttu-id="adff0-105">Toutefois, l’initialisation des structures et d’autres données est toujours nécessaire.</span><span class="sxs-lookup"><span data-stu-id="adff0-105">However, initialization of structures and other data is still necessary.</span></span> <span data-ttu-id="adff0-106">L’illustration suivante montre la relation entre les paramètres de fonction qui pointent vers des structures ou des tableaux et leurs données initialisées.</span><span class="sxs-lookup"><span data-stu-id="adff0-106">The following illustration shows the relationship between those function parameters that point to structures or arrays and their initialized data.</span></span> <span data-ttu-id="adff0-107">L’illustration montre uniquement les paramètres de fonction et les membres de structure dérivés d’autres structures ou fonctions.</span><span class="sxs-lookup"><span data-stu-id="adff0-107">The illustration shows only the function parameters and structure members that are derived from other structures or functions.</span></span> <span data-ttu-id="adff0-108">Les autres paramètres sont des initialisations simples.</span><span class="sxs-lookup"><span data-stu-id="adff0-108">The rest of the parameters are straightforward initializations.</span></span>

![mappage d’initialisation pour un appel à cryptsignmessage](images/crypsign.png)

<span data-ttu-id="adff0-110">**Pour signer des données à l’aide de CryptSignMessage**</span><span class="sxs-lookup"><span data-stu-id="adff0-110">**To sign data using CryptSignMessage**</span></span>

1.  <span data-ttu-id="adff0-111">Obtient un pointeur vers les données à signer.</span><span class="sxs-lookup"><span data-stu-id="adff0-111">Get a pointer to the data that is to be signed.</span></span>
2.  <span data-ttu-id="adff0-112">Assignez le pointeur aux données pour indexer zéro d’un tableau de « données à signer ».</span><span class="sxs-lookup"><span data-stu-id="adff0-112">Assign the pointer to the data to index zero of a "data to be signed" array.</span></span>
3.  <span data-ttu-id="adff0-113">Obtenir un handle pour le fournisseur de services de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="adff0-113">Get a handle to the cryptographic provider.</span></span>
4.  <span data-ttu-id="adff0-114">Ouvrez un [*magasin de certificats*](../secgloss/c-gly.md) qui contient le certificat du signataire.</span><span class="sxs-lookup"><span data-stu-id="adff0-114">Open a [*certificate store*](../secgloss/c-gly.md) that contains the signer's certificate.</span></span>
5.  <span data-ttu-id="adff0-115">Procurez-vous une adresse dans le certificat du signataire.</span><span class="sxs-lookup"><span data-stu-id="adff0-115">Get an address to the signer's certificate.</span></span>
6.  <span data-ttu-id="adff0-116">Assignez l’adresse du certificat à l’index zéro du tableau *MsgCert* .</span><span class="sxs-lookup"><span data-stu-id="adff0-116">Assign the address of the certificate to the zero index of the *MsgCert* array.</span></span>
7.  <span data-ttu-id="adff0-117">Assignez les adresses de tous les autres certificats à inclure avec le message dans le tableau *MsgCert* .</span><span class="sxs-lookup"><span data-stu-id="adff0-117">Assign the addresses of any other certificates to be included with the message to the *MsgCert* array.</span></span>
8.  <span data-ttu-id="adff0-118">Initialisez la structure d' [**\_ \_ identificateur d’algorithme**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) de chiffre, en initialisant le membre **pszObjId** avec l’algorithme de hachage souhaité et les autres membres, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="adff0-118">Initialize the [**CRYPT\_ALGORITHM\_IDENTIFIER**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) structure, initializing the **pszObjId** member to the desired hash algorithm and the other members as appropriate.</span></span>
9.  <span data-ttu-id="adff0-119">Initialisez la structure du [**\_ \_ message \_ de signature**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) du chiffre, en initialisant le membre **pSigningCert** sur l’adresse du certificat du signataire, le membre du tableau **MsgCert** sur l’adresse du signataire et les certificats de l’autre, le membre **HashAlgorithm** à l’adresse de la structure de l’identificateur de l' [**\_ algorithme \_**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) de chiffrement et les autres membres, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="adff0-119">Initialize the [**CRYPT\_SIGN\_MESSAGE\_PARA**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) structure, initializing the **pSigningCert** member to the address of the signer's certificate, the **MsgCert** array member to the address of the signer's and other's certificates, the **HashAlgorithm** member to the address of the [**CRYPT\_ALGORITHM\_IDENTIFIER**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) structure, and the other members as appropriate.</span></span>
10. <span data-ttu-id="adff0-120">Appelez la fonction [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage) , en passant la structure du [**\_ \_ message \_ de signature**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) de chiffre pour le paramètre *pSignPara* , l’adresse du tableau « données à signer » pour le paramètre *rgpbToBeSigned* , une adresse pour le paramètre de sortie *pbSignedBlob* et des valeurs pour les autres paramètres, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="adff0-120">Call the [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage) function, passing the [**CRYPT\_SIGN\_MESSAGE\_PARA**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) structure for the *pSignPara* parameter, the address of the "data to be signed" array for the *rgpbToBeSigned* parameter, an address for the *pbSignedBlob* output parameter, and values for the other parameters as appropriate.</span></span>

 

 
