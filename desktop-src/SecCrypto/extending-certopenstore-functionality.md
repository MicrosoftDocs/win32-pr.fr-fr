---
description: Le magasin de certificats est central pour toutes les opérations de gestion des certificats.
ms.assetid: e5c7c882-cbfc-4343-952c-b13c67326756
title: Extension de la fonctionnalité CertOpenStore
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4cce198578cc482ba0488bd97ae0f1d7f923511b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104564557"
---
# <a name="extending-certopenstore-functionality"></a><span data-ttu-id="23050-103">Extension de la fonctionnalité CertOpenStore</span><span class="sxs-lookup"><span data-stu-id="23050-103">Extending CertOpenStore Functionality</span></span>

<span data-ttu-id="23050-104">Le [*magasin de certificats*](../secgloss/c-gly.md) est central pour toutes les opérations de gestion des certificats.</span><span class="sxs-lookup"><span data-stu-id="23050-104">The [*certificate store*](../secgloss/c-gly.md) is central to all certificate management operations.</span></span> <span data-ttu-id="23050-105">Les fonctionnalités de la fonction [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) peuvent être étendues à l’aide d’une fonction de fournisseur de magasin de certificats installable (ou inscrite).</span><span class="sxs-lookup"><span data-stu-id="23050-105">The functionality of the [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) function can be extended through the use of an installable (or registered) certificate-store-provider function.</span></span> <span data-ttu-id="23050-106">Pour obtenir une vue d’ensemble de l’installation ou de l’inscription des fonctions à utiliser avec CryptoAPI, consultez [vue d’ensemble des OID](oid-overview.md).</span><span class="sxs-lookup"><span data-stu-id="23050-106">For an overview of how to install or register functions for use with the CryptoAPI, see [OID Overview](oid-overview.md).</span></span>

> [!Note]  
> <span data-ttu-id="23050-107">Les magasins de certificats personnalisés ne sont pas automatiquement migrés lors de l’exécution de déploiements automatisés.</span><span class="sxs-lookup"><span data-stu-id="23050-107">Custom certificate stores are not automatically migrated when performing automated deployments.</span></span> <span data-ttu-id="23050-108">Pour migrer des magasins de certificats personnalisés, vous devez créer un manifeste pour la migration des magasins personnalisés et utiliser le Outil de migration utilisateur Windows (USMT).</span><span class="sxs-lookup"><span data-stu-id="23050-108">To migrate custom certificate stores, you must create a manifest for migrating the custom stores and use the Windows User State Migration Tool (USMT).</span></span> <span data-ttu-id="23050-109">L’outil USMT peut être téléchargé à partir du centre de téléchargement Microsoft à l’adresse <https://www.microsoft.com/download/details.aspx?id=10837> .</span><span class="sxs-lookup"><span data-stu-id="23050-109">The USMT is available for download from the Microsoft Download Center at <https://www.microsoft.com/download/details.aspx?id=10837>.</span></span>

 

<span data-ttu-id="23050-110">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) ouvre un magasin vide en mémoire et appelle la fonction du fournisseur de magasin (s’il est inscrit ou installé) à l’aide de l' [*identificateur d’objet*](../secgloss/o-gly.md) (OID) qui a été transmis dans le paramètre *lpszStoreProvider* .</span><span class="sxs-lookup"><span data-stu-id="23050-110">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) opens an empty store in memory and calls the store provider function (if it is registered or installed) by using the [*object identifier*](../secgloss/o-gly.md) (OID) that was passed in the *lpszStoreProvider* parameter.</span></span> <span data-ttu-id="23050-111">Pour obtenir la liste des types de fournisseurs prédéfinis fournis avec l’CryptoAPI, consultez **CertOpenStore**.</span><span class="sxs-lookup"><span data-stu-id="23050-111">For a list of the predefined provider types that are supplied with the CryptoAPI, see **CertOpenStore**.</span></span>

<span data-ttu-id="23050-112">La fonction du fournisseur de magasin copie ses certificats et [*listes de révocation de certificats*](../secgloss/c-gly.md) (CRL) vers le magasin en mémoire spécifié par le handle *hCertStore* qui lui est passé.</span><span class="sxs-lookup"><span data-stu-id="23050-112">The store provider function copies its certificates and [*certificate revocation lists*](../secgloss/c-gly.md) (CRLs) to the in-memory store specified by the *hCertStore* handle passed to it.</span></span> <span data-ttu-id="23050-113">La nouvelle fonction de fournisseur de magasin peut utiliser toutes les fonctions du magasin de certificats CryptoAPI, telles que [**CertAddCertificateContextToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddcertificatecontexttostore) ou [**CertAddSerializedElementToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddserializedelementtostore), pour ajouter ses certificats et listes de révocation de certificats au magasin en mémoire.</span><span class="sxs-lookup"><span data-stu-id="23050-113">The new store provider function can use any of the CryptoAPI certificate store functions, such as, [**CertAddCertificateContextToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddcertificatecontexttostore) or [**CertAddSerializedElementToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddserializedelementtostore), to add its certificates and CRLs to the in-memory store.</span></span> <span data-ttu-id="23050-114">En outre, la fonction du fournisseur de magasin retourne éventuellement des valeurs pour tous les membres de données de la structure d' [**\_ \_ \_ informations Prov du magasin de certificats**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) .</span><span class="sxs-lookup"><span data-stu-id="23050-114">In addition, the store-provider function optionally returns values for all of the data members of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure.</span></span> <span data-ttu-id="23050-115">La fonction doit uniquement mettre à jour cette structure si elle prend en charge des fonctions de rappel supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="23050-115">The function only needs to update this structure if it supports additional callback functions.</span></span> <span data-ttu-id="23050-116">Par exemple, si le magasin doit être un magasin en lecture seule, la prise en charge d’autres fonctions de rappel n’est probablement pas nécessaire.</span><span class="sxs-lookup"><span data-stu-id="23050-116">For example, if the store was to be a read-only store, the support of other callback functions probably would not be needed.</span></span> <span data-ttu-id="23050-117">Pour plus d’informations et pour les prototypes des fonctions de rappel possibles, consultez [fonctions de rappel du fournisseur du magasin de certificats](cryptography-functions.md).</span><span class="sxs-lookup"><span data-stu-id="23050-117">For details and prototypes of the possible callback functions, see [Certificate Store Provider Callback Functions](cryptography-functions.md).</span></span>

<span data-ttu-id="23050-118">Le magasin TrustedPeople par utilisateur est limité aux magasins physiques prédéfinis.</span><span class="sxs-lookup"><span data-stu-id="23050-118">The per user TrustedPeople store is restricted to predefined physical stores.</span></span> <span data-ttu-id="23050-119">Vous ne pouvez pas étendre le magasin TrustedPeople par utilisateur.</span><span class="sxs-lookup"><span data-stu-id="23050-119">You cannot extend the per user TrustedPeople store.</span></span> <span data-ttu-id="23050-120">Toutefois, vous pouvez étendre le magasin TrustedPeople de l’ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="23050-120">However, you can extend the local machine TrustedPeople store.</span></span>

<span data-ttu-id="23050-121">**Windows XP et Windows Server 2003 :** Le magasin TrustedPeople par utilisateur n’est pas limité aux magasins physiques prédéfinis.</span><span class="sxs-lookup"><span data-stu-id="23050-121">**Windows XP and Windows Server 2003:** The per user TrustedPeople store is not restricted to predefined physical stores.</span></span>

<span data-ttu-id="23050-122">L’un des membres de données de la structure [**\_ \_ Prov \_ info du magasin de certificats**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) est le tableau *rgpvStoreProvFunc* .</span><span class="sxs-lookup"><span data-stu-id="23050-122">One of the data members of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure is the *rgpvStoreProvFunc* array.</span></span> <span data-ttu-id="23050-123">Si la fonction du fournisseur de magasin doit prendre en charge une ou plusieurs des fonctions de rappel, elle doit fournir des pointeurs pour ce tableau.</span><span class="sxs-lookup"><span data-stu-id="23050-123">If the store provider function needs to support one or more of the callback functions, it must provide pointers for this array.</span></span> <span data-ttu-id="23050-124">Ces pointeurs doivent pointer vers les fonctions de rappel qui doivent être utilisées pour d’autres activités de magasin de certificats (telles que la fermeture du magasin).</span><span class="sxs-lookup"><span data-stu-id="23050-124">These pointers must point to the callback functions that are to be used for other certificate-store activities (such as closing the store).</span></span> <span data-ttu-id="23050-125">L’illustration suivante montre le déroulement de ce processus.</span><span class="sxs-lookup"><span data-stu-id="23050-125">The following illustration shows the flow of this process.</span></span>

![fonctionnalité CertOpenStore](images/openstor.png)

<span data-ttu-id="23050-127">Comme indiqué dans l’illustration suivante, une fois le magasin ouvert, les autres fonctions CryptoAPI (telles que [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)) utilisent le tableau de pointeurs pour accéder aux fonctions de rappel qui exécutent la tâche prévue.</span><span class="sxs-lookup"><span data-stu-id="23050-127">As shown in the following illustration, after the store has been opened, other CryptoAPI functions (such as [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)) use the array of pointers to access the callback functions that perform the intended task.</span></span> <span data-ttu-id="23050-128">La définition de la [**structure \_ \_ Prov \_ info du magasin**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) de certificats et les prototypes des fonctions de rappel par défaut qui sont fournies avec l’CryptoAPI sont affichées dans les fonctions de rappel du fournisseur du magasin de [certificats](cryptography-functions.md).</span><span class="sxs-lookup"><span data-stu-id="23050-128">The definition of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure and the prototypes of the default callback functions that are supplied with the CryptoAPI are shown in [Certificate Store Provider Callback Functions](cryptography-functions.md).</span></span>

![fonctionnalité certclosestore](images/closstor.png)

<span data-ttu-id="23050-130">Les API de stockage permettent à un fournisseur de magasins de conserver les certificats, les listes de révocation de certificats et les listes de certificats de [*confiance*](../secgloss/c-gly.md) (CTL) à l’extérieur du cache du magasin (par exemple, une base de données externe de certificats, telle que fournie par la base de données du serveur de certificats Microsoft).</span><span class="sxs-lookup"><span data-stu-id="23050-130">The store APIs allow a store provider to maintain the certificates, CRLs, and [*certificate trust lists*](../secgloss/c-gly.md) (CTLs) outside the cache of the store (for example, an external database of certificates, such as provided by the Microsoft Certificate Server Database).</span></span>

<span data-ttu-id="23050-131">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) distribue via le paramètre *pszStoreProvider* à la fonction de fournisseur d’installation [**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) appropriée.</span><span class="sxs-lookup"><span data-stu-id="23050-131">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) dispatches through the *pszStoreProvider* parameter to the appropriate [**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) installable provider function.</span></span> <span data-ttu-id="23050-132">Le fournisseur retourne des informations dans le paramètre *pStoreProvInfo* qui pointe vers une structure [**\_ \_ Prov \_ info de magasin de certificats**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) .</span><span class="sxs-lookup"><span data-stu-id="23050-132">The provider returns information in the *pStoreProvInfo* parameter that points to a [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure.</span></span> <span data-ttu-id="23050-133">La structure de l' **\_ \_ \_ information Prov Store store** contient un membre **dwStoreProvFlags** .</span><span class="sxs-lookup"><span data-stu-id="23050-133">The **CERT\_STORE\_PROV\_INFO** structure contains a **dwStoreProvFlags** member.</span></span> <span data-ttu-id="23050-134">L’indicateur de l' \_ indicateur externe Prov. du magasin de certificats \_ \_ \_ a été ajouté pour permettre au fournisseur d’indiquer que les certificats, les listes de révocation de certificats et les listes de certificats de confiance sont externes au cache du magasin.</span><span class="sxs-lookup"><span data-stu-id="23050-134">The CERT\_STORE\_PROV\_EXTERNAL\_FLAG flag was added to allow the provider to indicate that the certificates, CRLs, and CTLs are external to the cache of the store.</span></span>

<span data-ttu-id="23050-135">[**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) retourne un tableau de fonctions de rappel.</span><span class="sxs-lookup"><span data-stu-id="23050-135">[**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) returns an array of callback functions.</span></span> <span data-ttu-id="23050-136">Un fournisseur peut implémenter les fonctions de rappel suivantes :</span><span class="sxs-lookup"><span data-stu-id="23050-136">A provider can implement the following callback functions:</span></span>

-   <span data-ttu-id="23050-137">fin de la fonction de clôture du magasin de certificats \_ \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-137">CERT\_STORE\_PROV\_CLOSE\_FUNC</span></span>
-   <span data-ttu-id="23050-138">certificat du magasin de certificats \_ \_ Proven \_ lire le \_ certificat \_</span><span class="sxs-lookup"><span data-stu-id="23050-138">CERT\_STORE\_PROV\_READ\_CERT\_FUNC</span></span>
-   <span data-ttu-id="23050-139">certificat du magasin de certificats \_ \_ Proven \_ Write \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-139">CERT\_STORE\_PROV\_WRITE\_CERT\_FUNC</span></span>
-   <span data-ttu-id="23050-140">certificat du magasin de certificats \_ \_ Prov \_ supprimer le \_ certificat \_</span><span class="sxs-lookup"><span data-stu-id="23050-140">CERT\_STORE\_PROV\_DELETE\_CERT\_FUNC</span></span>
-   <span data-ttu-id="23050-141">propriété de certificat du magasin de certificats \_ \_ Prov \_ Set \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-141">CERT\_STORE\_PROV\_SET\_CERT\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="23050-142">\_ \_ \_ lecture \_ de la liste de révocation de certificats \_ du magasin de certificats</span><span class="sxs-lookup"><span data-stu-id="23050-142">CERT\_STORE\_PROV\_READ\_CRL\_FUNC</span></span>
-   <span data-ttu-id="23050-143">\_Func d' \_ \_ écriture de la \_ liste de révocation de certificats \_ CERT Store</span><span class="sxs-lookup"><span data-stu-id="23050-143">CERT\_STORE\_PROV\_WRITE\_CRL\_FUNC</span></span>
-   <span data-ttu-id="23050-144">fonction \_ \_ \_ \_ de suppression de la liste de révocation de certificats \_ CERT Store Prov</span><span class="sxs-lookup"><span data-stu-id="23050-144">CERT\_STORE\_PROV\_DELETE\_CRL\_FUNC</span></span>
-   <span data-ttu-id="23050-145">\_ \_ \_ valeur \_ de la propriété de la liste de révocation de certificats \_ \_ du magasin de certificats</span><span class="sxs-lookup"><span data-stu-id="23050-145">CERT\_STORE\_PROV\_SET\_CRL\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="23050-146">\_mode de \_ \_ lecture \_ CTL \_ PROVen du magasin de certificats</span><span class="sxs-lookup"><span data-stu-id="23050-146">CERT\_STORE\_PROV\_READ\_CTL\_FUNC</span></span>
-   <span data-ttu-id="23050-147">fonction \_ \_ CTL d' \_ écriture \_ CTL \_ du magasin de certificats</span><span class="sxs-lookup"><span data-stu-id="23050-147">CERT\_STORE\_PROV\_WRITE\_CTL\_FUNC</span></span>
-   <span data-ttu-id="23050-148">Banque de certificats \_ \_ Prov- \_ Delete \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="23050-148">CERT\_STORE\_PROV\_DELETE\_CTL\_FUNC</span></span>
-   <span data-ttu-id="23050-149">propriété de la liste de certificats de confiance du magasin de certificats \_ \_ \_ \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-149">CERT\_STORE\_PROV\_SET\_CTL\_PROPERTY\_FUNC</span></span>

<span data-ttu-id="23050-150">Sur les appels au certificat d’écriture, à la \_ \_ liste de révocation des certificats d’écriture et aux fonctions de rappel d’écriture \_ CTL lorsque l' \_ indicateur d' \_ écriture Proven Write du magasin \_ de certificats \_ \_ est défini, les 16 bits supérieurs du paramètre *dwFlags* contiennent la valeur *dwAddDisposition* .</span><span class="sxs-lookup"><span data-stu-id="23050-150">On calls to the WRITE\_CERT, WRITE\_CRL, and WRITE\_CTL callback functions when the CERT\_STORE\_PROV\_WRITE\_ADD\_FLAG is set, the upper 16 bits of the *dwFlags* parameter contains the *dwAddDisposition* value.</span></span> <span data-ttu-id="23050-151">Pour prendre en charge les magasins externes, un fournisseur peut implémenter les fonctions de rappel suivantes :</span><span class="sxs-lookup"><span data-stu-id="23050-151">To support external stores, a provider can implement the following callback functions:</span></span>

-   <span data-ttu-id="23050-152">CERT \_ Store \_ Prov \_ Rechercher \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="23050-152">CERT\_STORE\_PROV\_FIND\_CERT\_FUNC</span></span>
-   <span data-ttu-id="23050-153">CERT \_ Store \_ Prov \_ gratuit \_ trouver le \_ certificat \_</span><span class="sxs-lookup"><span data-stu-id="23050-153">CERT\_STORE\_PROV\_FREE\_FIND\_CERT\_FUNC</span></span>
-   <span data-ttu-id="23050-154">propriété d’extraction de certificat de la Banque de certificats \_ \_ Prov \_ \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-154">CERT\_STORE\_PROV\_GET\_CERT\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="23050-155">fonction \_ \_ de la \_ \_ liste de révocation de certificats \_ du magasin de certificats Prov</span><span class="sxs-lookup"><span data-stu-id="23050-155">CERT\_STORE\_PROV\_FIND\_CRL\_FUNC</span></span>
-   <span data-ttu-id="23050-156">la \_ \_ \_ \_ \_ liste de révocation de certificats du magasin de certificats Prov gratuit Find \_</span><span class="sxs-lookup"><span data-stu-id="23050-156">CERT\_STORE\_PROV\_FREE\_FIND\_CRL\_FUNC</span></span>
-   <span data-ttu-id="23050-157">\_ \_ \_ \_ propriété de la liste de révocation des certificats du magasin de certificats \_ Prov \_</span><span class="sxs-lookup"><span data-stu-id="23050-157">CERT\_STORE\_PROV\_GET\_CRL\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="23050-158">\_Banque CERT \_ Store \_ Prov \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-158">CERT\_STORE\_PROV\_FIND\_CTL\_FUNC</span></span>
-   <span data-ttu-id="23050-159">\_liste CTL de la \_ \_ \_ recherche \_ gratuite \_ de la boutique du magasin de certificats</span><span class="sxs-lookup"><span data-stu-id="23050-159">CERT\_STORE\_PROV\_FREE\_FIND\_CTL\_FUNC</span></span>
-   <span data-ttu-id="23050-160">propriété d’extraction de la liste de certificats de confiance du magasin de certificats \_ \_ \_ \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-160">CERT\_STORE\_PROV\_GET\_CTL\_PROPERTY\_FUNC</span></span>

<span data-ttu-id="23050-161">Les fonctions de rappel de certificat ont les signatures suivantes :</span><span class="sxs-lookup"><span data-stu-id="23050-161">The certificate callback functions have the following signatures:</span></span>

``` syntax
typedef struct _CERT_STORE_PROV_FIND_INFO {
    DWORD               cbSize;
    DWORD               dwMsgAndCertEncodingType;
    DWORD               dwFindFlags;
    DWORD               dwFindType;
    const void          *pvFindPara;
} CERT_STORE_PROV_FIND_INFO, *PCERT_STORE_PROV_FIND_INFO;
typedef const CERT_STORE_PROV_FIND_INFO CCERT_STORE_PROV_FIND_INFO,
    *PCCERT_STORE_PROV_FIND_INFO;

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_FIND_CERT)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_STORE_PROV_FIND_INFO pFindInfo,
        IN PCCERT_CONTEXT pPrevCertContext,
        IN DWORD dwFlags,
        IN OUT void **ppvStoreProvFindInfo,
        OUT PCCERT_CONTEXT *ppProvCertContext
        );

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_FREE_FIND_CERT)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_CONTEXT pCertContext,
        IN void *pvStoreProvFindInfo,
        IN DWORD dwFlags
        );

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_GET_CERT_PROPERTY)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_CONTEXT pCertContext,
        IN DWORD dwPropId,
        IN DWORD dwFlags,
        OUT void *pvData,
        IN OUT DWORD *pcbData
        );
```

<span data-ttu-id="23050-162">Les signatures de la liste de révocation de certificats et des fonctions de rappel CTL sont identiques à celles ci-dessus avec le pointeur vers le [**\_ contexte de certificat**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) remplacé par un pointeur vers un contexte [**de liste de révocation de certificats \_**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) ou un [**\_ contexte**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context)de liste CTL.</span><span class="sxs-lookup"><span data-stu-id="23050-162">The signatures for the CRL and CTL callback functions are identical to the above with the pointer to the [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) replaced with a pointer to a [**CRL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) or [**CTL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context).</span></span>

<span data-ttu-id="23050-163">Le rappel de la recherche de \_ certificat est appelé quand les API du Store énumèrent, recherchent ou ajoutent des certificats.</span><span class="sxs-lookup"><span data-stu-id="23050-163">The FIND\_CERT callback is called when the store APIs enumerate, find, or add certificates.</span></span> <span data-ttu-id="23050-164">*pPrevCertContext* et *ppvStoreProvFindInfo* ont la valeur **null** pour lancer une nouvelle recherche.</span><span class="sxs-lookup"><span data-stu-id="23050-164">*pPrevCertContext* and *ppvStoreProvFindInfo* are set to **NULL** to initiate a new FIND.</span></span> <span data-ttu-id="23050-165">Le *ppvStoreProvFindInfo* retourné est retransmis à la prochaine recherche, à laquelle il peut être libéré par le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="23050-165">The returned *ppvStoreProvFindInfo* is passed back on the next find at which time it may be freed by the provider.</span></span> <span data-ttu-id="23050-166">Le fournisseur peut définir tout, une partie ou aucune des propriétés du certificat.</span><span class="sxs-lookup"><span data-stu-id="23050-166">The provider may set all, some, or none of the certificate properties.</span></span> <span data-ttu-id="23050-167">Le fournisseur a la possibilité de différer jusqu’à ce que le rappel de propriété obtention du \_ certificat \_ soit appelé.</span><span class="sxs-lookup"><span data-stu-id="23050-167">The provider has the option to defer until the GET\_CERT\_PROPERTY callback is called.</span></span> <span data-ttu-id="23050-168">Il est recommandé aux fournisseurs de définir autant de propriétés que possible pour permettre la copie dans un autre magasin.</span><span class="sxs-lookup"><span data-stu-id="23050-168">It is recommended for providers to set as many properties as possible to allow copying to another store.</span></span>

<span data-ttu-id="23050-169">Les types de recherche de certificat suivants sont pris en charge dans [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore):</span><span class="sxs-lookup"><span data-stu-id="23050-169">The following certificate find types are supported in [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore):</span></span>

-   <span data-ttu-id="23050-170">CERTIFICAT \_ trouvé \_ tout</span><span class="sxs-lookup"><span data-stu-id="23050-170">CERT\_FIND\_ANY</span></span>
-   <span data-ttu-id="23050-171">CERT- \_ Rechercher le \_ \_ hachage SHA1</span><span class="sxs-lookup"><span data-stu-id="23050-171">CERT\_FIND\_SHA1\_HASH</span></span>
-   <span data-ttu-id="23050-172">\_ \_ Hachage MD5 de la recherche de certificat \_</span><span class="sxs-lookup"><span data-stu-id="23050-172">CERT\_FIND\_MD5\_HASH</span></span>
-   <span data-ttu-id="23050-173">\_propriété de recherche de certificat \_</span><span class="sxs-lookup"><span data-stu-id="23050-173">CERT\_FIND\_PROPERTY</span></span>
-   <span data-ttu-id="23050-174">\_ \_ clé publique de recherche de certificat \_</span><span class="sxs-lookup"><span data-stu-id="23050-174">CERT\_FIND\_PUBLIC\_KEY</span></span>
-   <span data-ttu-id="23050-175">nom de l’objet de recherche de certificat \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-175">CERT\_FIND\_SUBJECT\_NAME</span></span>
-   <span data-ttu-id="23050-176">ATTR de l’objet de recherche de certificat \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-176">CERT\_FIND\_SUBJECT\_ATTR</span></span>
-   <span data-ttu-id="23050-177">nom de l’émetteur de recherche de certificat \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-177">CERT\_FIND\_ISSUER\_NAME</span></span>
-   <span data-ttu-id="23050-178">CERT \_ Rechercher l' \_ émetteur \_ attr</span><span class="sxs-lookup"><span data-stu-id="23050-178">CERT\_FIND\_ISSUER\_ATTR</span></span>
-   <span data-ttu-id="23050-179">CERT \_ Rechercher l' \_ objet \_ Str \_ A</span><span class="sxs-lookup"><span data-stu-id="23050-179">CERT\_FIND\_SUBJECT\_STR\_A</span></span>
-   <span data-ttu-id="23050-180">chaîne d’objet de recherche de CERT \_ \_ \_ \_ W</span><span class="sxs-lookup"><span data-stu-id="23050-180">CERT\_FIND\_SUBJECT\_STR\_W</span></span>
-   <span data-ttu-id="23050-181">CERT \_ Rechercher l' \_ émetteur \_ Str \_ A</span><span class="sxs-lookup"><span data-stu-id="23050-181">CERT\_FIND\_ISSUER\_STR\_A</span></span>
-   <span data-ttu-id="23050-182">CERT- \_ Rechercher l' \_ émetteur \_ Str \_ W</span><span class="sxs-lookup"><span data-stu-id="23050-182">CERT\_FIND\_ISSUER\_STR\_W</span></span>
-   <span data-ttu-id="23050-183">spécification de la clé de recherche de certificat \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="23050-183">CERT\_FIND\_KEY\_SPEC</span></span>
-   <span data-ttu-id="23050-184">\_ \_ utilisation ENHKEY de la recherche de certificat \_</span><span class="sxs-lookup"><span data-stu-id="23050-184">CERT\_FIND\_ENHKEY\_USAGE</span></span>

<span data-ttu-id="23050-185">Le rappel de la recherche de \_ certificat est appelé pour chacun des types de recherche ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="23050-185">The FIND\_CERT callback is called for each of the above find types.</span></span> <span data-ttu-id="23050-186">Les paramètres passés à [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore) sont copiés directement dans la \_ structure de la prove du magasin de certificats \_ \_ \_ avant l’appel de la recherche de \_ rappel de certificat.</span><span class="sxs-lookup"><span data-stu-id="23050-186">The parameters passed to [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore) are copied directly to the CERT\_STORE\_PROV\_FIND\_INFO structure before the FIND\_CERT callback is called.</span></span> <span data-ttu-id="23050-187">Pour plus d’informations sur les valeurs de champ pour les différents types de recherche de la \_ \_ structure PROV (informations de recherche) du magasin de certificats \_ \_ , consultez **CertFindCertificateInStore**.</span><span class="sxs-lookup"><span data-stu-id="23050-187">For details about the field values for the different find types of the CERT\_STORE\_PROV\_FIND\_INFO structure, see **CertFindCertificateInStore**.</span></span>

<span data-ttu-id="23050-188">Les types de recherche de certificat suivants prennent en charge les API [**CertGetSubjectCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetsubjectcertificatefromstore) et [**CertGetIssuerCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetissuercertificatefromstore) et aident à déterminer si le certificat existe déjà dans le magasin avant d’ajouter :</span><span class="sxs-lookup"><span data-stu-id="23050-188">The following certificate find types support the [**CertGetSubjectCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetsubjectcertificatefromstore) and [**CertGetIssuerCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetissuercertificatefromstore) APIs and help determine whether the certificate already exists in the store before adding:</span></span>

-   <span data-ttu-id="23050-189">CERT- \_ Rechercher le \_ sujet du \_ certificat</span><span class="sxs-lookup"><span data-stu-id="23050-189">CERT\_FIND\_SUBJECT\_CERT</span></span>
-   <span data-ttu-id="23050-190">CERT \_ Find \_ émetteur \_ de</span><span class="sxs-lookup"><span data-stu-id="23050-190">CERT\_FIND\_ISSUER\_OF</span></span>
-   <span data-ttu-id="23050-191">Rechercher le certificat \_ \_ existant</span><span class="sxs-lookup"><span data-stu-id="23050-191">CERT\_FIND\_EXISTING</span></span>

<span data-ttu-id="23050-192">Pour le \_ certificat de l’objet CERT Find \_ \_ , le paramètre *pvFindPara* pointe vers une structure d' [**\_ informations de certificat**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_info) qui contient l’émetteur et le numéro de série de l’objet.</span><span class="sxs-lookup"><span data-stu-id="23050-192">For CERT\_FIND\_SUBJECT\_CERT, the *pvFindPara* parameter points to a [**CERT\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_info) structure that contains the Issuer and SerialNumber of the subject.</span></span> <span data-ttu-id="23050-193">Pour \_ l’émetteur de la recherche de certificat, \_ \_ *pvFindPara* pointe vers une structure de [**\_ contexte de certificat**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) , de l’objet.</span><span class="sxs-lookup"><span data-stu-id="23050-193">For CERT\_FIND\_ISSUER\_OF, *pvFindPara* points to a [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) structure, of the subject.</span></span> <span data-ttu-id="23050-194">Pour CERT \_ Find \_ existing, *pvFindPara* pointe vers **un \_ contexte** de certificat du certificat afin de vérifier son existence dans le magasin.</span><span class="sxs-lookup"><span data-stu-id="23050-194">For CERT\_FIND\_EXISTING, *pvFindPara* points to a **CERT\_CONTEXT** of the certificate to check for its existence in the store.</span></span>

<span data-ttu-id="23050-195">Le rappel de certificat gratuit de \_ recherche \_ est appelé lorsque le certificat retourné par le rappel de la recherche de certificat \_ n’a pas été libéré en étant utilisé dans un autre certificat de recherche suivant \_ , dont le [*nombre de références*](../secgloss/r-gly.md) est décrémenté à zéro, ou en étant libéré par un appel à [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore).</span><span class="sxs-lookup"><span data-stu-id="23050-195">The FREE\_FIND\_CERT callback is called when the certificate returned by the FIND\_CERT callback was not released by being used in a subsequent next FIND\_CERT, thus having its [*reference count*](../secgloss/r-gly.md) decremented to zero, or by being released by a call to [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore).</span></span> <span data-ttu-id="23050-196">Avant que le rappel de fermeture ne soit appelé, tous les certificats retournés par le \_ rappel de recherche de certificat doivent être libérés pour le fournisseur en passant à un appel au rappel de recherche de \_ certificat ou à un appel au \_ rappel de certificat de recherche libre \_ .</span><span class="sxs-lookup"><span data-stu-id="23050-196">Before the CLOSE callback is called, all certificates returned by the FIND\_CERT callback should be released to the provider by being passed to a call to the FIND\_CERT callback or a call to the FREE\_FIND\_CERT callback.</span></span> <span data-ttu-id="23050-197">Il en va de même pour la liste de révocation de certificats et les rappels CTL.</span><span class="sxs-lookup"><span data-stu-id="23050-197">The same applies to the CRL and CTL callbacks.</span></span>

<span data-ttu-id="23050-198">Le \_ rappel de \_ propriété obtenir le certificat est appelé par [**CertGetCertificateContextProperty**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetcertificatecontextproperty) s’il ne peut pas trouver la propriété spécifiée pour le paramètre *pCertContext* .</span><span class="sxs-lookup"><span data-stu-id="23050-198">The GET\_CERT\_PROPERTY callback is called by [**CertGetCertificateContextProperty**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetcertificatecontextproperty) if it cannot find the specified property for the *pCertContext* parameter.</span></span> <span data-ttu-id="23050-199">Il en va de même pour les propriétés obtenir la \_ liste de révocation de certificats \_ et obtenir la liste \_ CTL \_ .</span><span class="sxs-lookup"><span data-stu-id="23050-199">The same is true for GET\_CRL\_PROPERTY and GET\_CTL\_PROPERTY.</span></span>

<span data-ttu-id="23050-200">Le rappel Rechercher une \_ liste de révocation de certificats est appelé quand les API du Store énumèrent ou obtiennent des listes de révocation de certificats et avant d’ajouter une liste</span><span class="sxs-lookup"><span data-stu-id="23050-200">The FIND\_CRL callback is called when the store APIs enumerate or get CRLs and before adding a CRL.</span></span> <span data-ttu-id="23050-201">Les types de recherche de la liste de révocation de certificats suivants sont définis :</span><span class="sxs-lookup"><span data-stu-id="23050-201">The following CRL find types will be defined:</span></span>

<span data-ttu-id="23050-202">Pour la recherche de liste de révocation de certificats \_ \_ émise \_ par, *pvFindPara* est un pointeur vers un [**\_ contexte de certificat**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) de l’émetteur de la liste de révocation de certificats.</span><span class="sxs-lookup"><span data-stu-id="23050-202">For CRL\_FIND\_ISSUED\_BY, *pvFindPara* is a pointer to a [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) of the CRL issuer.</span></span> <span data-ttu-id="23050-203">Pour la liste de révocation de certificats \_ \_ existante, *pvFindPara* est un pointeur vers un [**\_ contexte de liste**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) de révocation de certificats de la liste de révocation de certificats pour déterminer si elle existe déjà dans le magasin.</span><span class="sxs-lookup"><span data-stu-id="23050-203">For CRL\_FIND\_EXISTING, *pvFindPara* is a pointer to a [**CRL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) of the CRL to determine whether it already exists in the store.</span></span>

<span data-ttu-id="23050-204">Le rappel de la \_ liste de certificats de confiance est appelé quand les API du magasin énumèrent ou recherchent des listes CTL.</span><span class="sxs-lookup"><span data-stu-id="23050-204">The FIND\_CTL callback is called when the store APIs enumerate or find CTLs.</span></span> <span data-ttu-id="23050-205">Les types de listes de certificats de confiance suivants sont pris en charge dans [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore):</span><span class="sxs-lookup"><span data-stu-id="23050-205">The following CTL find types are supported in [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore):</span></span>

-   <span data-ttu-id="23050-206">liste CTL \_ Rechercher \_</span><span class="sxs-lookup"><span data-stu-id="23050-206">CTL\_FIND\_ANY</span></span>
-   <span data-ttu-id="23050-207">CTL \_ Rechercher \_ le \_ hachage SHA1</span><span class="sxs-lookup"><span data-stu-id="23050-207">CTL\_FIND\_SHA1\_HASH</span></span>
-   <span data-ttu-id="23050-208">CTL \_ Rechercher \_ le \_ hachage MD5</span><span class="sxs-lookup"><span data-stu-id="23050-208">CTL\_FIND\_MD5\_HASH</span></span>
-   <span data-ttu-id="23050-209">liste CTL \_ Rechercher \_ l’utilisation</span><span class="sxs-lookup"><span data-stu-id="23050-209">CTL\_FIND\_USAGE</span></span>
-   <span data-ttu-id="23050-210">liste CTL \_ Rechercher l' \_ objet</span><span class="sxs-lookup"><span data-stu-id="23050-210">CTL\_FIND\_SUBJECT</span></span>
-   <span data-ttu-id="23050-211">liste CTL \_ Rechercher l' \_ existante</span><span class="sxs-lookup"><span data-stu-id="23050-211">CTL\_FIND\_EXISTING</span></span>

<span data-ttu-id="23050-212">Le rappel de la liste de certificats de recherche \_ est appelé pour chacun des types de recherche ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="23050-212">The FIND\_CTL callback is called for each of the above find types.</span></span> <span data-ttu-id="23050-213">Les paramètres passés à [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore) sont copiés directement dans la structure de la prove de la boutique du magasin de certificats \_ \_ \_ \_ avant l’appel du rappel de la \_ liste de certificats de confiance.</span><span class="sxs-lookup"><span data-stu-id="23050-213">The parameters passed to [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore) are copied directly to the CERT\_STORE\_PROV\_FIND\_INFO structure before the FIND\_CTL callback is called.</span></span> <span data-ttu-id="23050-214">Pour plus d’informations sur les valeurs de champ pour les différents types de recherche de la \_ \_ structure PROV (informations de recherche) du magasin de certificats \_ \_ , consultez **CertFindCTLInStore**.</span><span class="sxs-lookup"><span data-stu-id="23050-214">For details about the field values for the different find types of the CERT\_STORE\_PROV\_FIND\_INFO structure, see **CertFindCTLInStore**.</span></span>

<span data-ttu-id="23050-215">Le type de liste CTL \_ Rechercher un \_ type de liste CTL existant permet de déterminer si la liste CTL existe déjà dans le magasin avant d’ajouter une liste de certificats de confiance.</span><span class="sxs-lookup"><span data-stu-id="23050-215">The CTL\_FIND\_EXISTING CTL find type helps determine whether the CTL already exists in the store before doing a CTL add.</span></span>

<span data-ttu-id="23050-216">Pour la liste de certificats de confiance \_ \_ existante, *pvFindPara* est un pointeur vers la structure de [**\_ contexte CTL**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context) de la liste CTL pour déterminer si elle existe déjà dans le magasin.</span><span class="sxs-lookup"><span data-stu-id="23050-216">For CTL\_FIND\_EXISTING, *pvFindPara* is a pointer to the [**CTL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context) structure of the CTL to determine whether it already exists in the store.</span></span>

 

 
