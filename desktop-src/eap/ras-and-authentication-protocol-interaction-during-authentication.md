---
title: Interaction du point d’accès et du protocole d’authentification pendant l’authentification
description: La fonction RasEapMakeMessage contrôle la majorité de l’interaction entre le protocole d’authentification et le point d’accès.
ms.assetid: edc128e0-3104-4df9-80f4-b2aebcfe1087
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0e486e3a10e323f28bc2f6fef4c131acfc095b48
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104031080"
---
# <a name="access-point-and-authentication-protocol-interaction-during-authentication"></a><span data-ttu-id="68b0f-103">Interaction du point d’accès et du protocole d’authentification pendant l’authentification</span><span class="sxs-lookup"><span data-stu-id="68b0f-103">Access Point and Authentication Protocol Interaction During Authentication</span></span>

<span data-ttu-id="68b0f-104">La fonction [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) contrôle la majorité de l’interaction entre le protocole d’authentification et le point d’accès.</span><span class="sxs-lookup"><span data-stu-id="68b0f-104">The [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) function controls the majority of the interaction between the authentication protocol and the Access Point (AP).</span></span> <span data-ttu-id="68b0f-105">**RasEapMakeMessage** traite les paquets EAP entrants et crée des paquets EAP à transmettre à l’homologue distant.</span><span class="sxs-lookup"><span data-stu-id="68b0f-105">**RasEapMakeMessage** processes incoming EAP packets and creates EAP packets for transmission to the remote peer.</span></span> <span data-ttu-id="68b0f-106">Il traite également les événements tels que les délais d’expiration et l’exécution de l’authentification.</span><span class="sxs-lookup"><span data-stu-id="68b0f-106">It also processes events such as time outs and authentication completion.</span></span>

<span data-ttu-id="68b0f-107">Si un message est reçu de l’homologue distant, le service d’authentification AP appelle [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), en passant un pointeur vers le message reçu dans le paramètre *pReceivePacket* .</span><span class="sxs-lookup"><span data-stu-id="68b0f-107">If a message is received from the remote peer, the AP authentication service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), passing a pointer to the received message in the *pReceivePacket* parameter.</span></span>

<span data-ttu-id="68b0f-108">Si le service appelle [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) avec *PReceivePacket* défini sur **null**, le point d’accès est en cours de lancement de la boîte de dialogue avec le protocole d’authentification ou en demandant que le protocole renvoie le dernier paquet.</span><span class="sxs-lookup"><span data-stu-id="68b0f-108">If the service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) with *pReceivePacket* set to **NULL**, the AP is either initiating the dialog with the authentication protocol, or requesting that the protocol resend the last packet.</span></span> <span data-ttu-id="68b0f-109">Le protocole d’authentification doit déterminer l’action que le service prend en fonction de son état et du contexte du message.</span><span class="sxs-lookup"><span data-stu-id="68b0f-109">The authentication protocol should determine which action the service is taking based on its state and from the message context.</span></span>

<span data-ttu-id="68b0f-110">Au retour de [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), la valeur du membre **action** de la structure [**de \_ \_ sortie EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) indique l’action que le service d’authentification effectue, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="68b0f-110">On return from [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), the value of the **Action** member of the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure indicates what action, if any, the authentication service takes.</span></span> <span data-ttu-id="68b0f-111">Le membre **action** prend des valeurs du type énuméré de l' [**\_ \_ action EAP PPP**](/windows/desktop/api/Raseapif/ne-raseapif-ppp_eap_action) .</span><span class="sxs-lookup"><span data-stu-id="68b0f-111">The **Action** member takes values from the [**PPP\_EAP\_ACTION**](/windows/desktop/api/Raseapif/ne-raseapif-ppp_eap_action) enumerated type.</span></span>

<span data-ttu-id="68b0f-112">Si **action** est **EAPACTION \_ Send**, **EAPACTION \_ SendAndDone**, **EAPACTION \_ SendWithTimeout** ou **EAPACTION \_ SendWithTimeoutInteractive**, le service transmet le paquet désigné par le paramètre *pSendPacket* à l’homologue distant.</span><span class="sxs-lookup"><span data-stu-id="68b0f-112">If **Action** is **EAPACTION\_Send**, **EAPACTION\_SendAndDone**, **EAPACTION\_SendWithTimeout**, or **EAPACTION\_SendWithTimeoutInteractive**, the service transmits the packet that is pointed to by the *pSendPacket* parameter to the remote peer.</span></span>

<span data-ttu-id="68b0f-113">La valeur **EAPACTION \_ SendWithTimeout** permet d’obtenir un délai d’expiration, après quoi le service d’authentification suppose que le lien a été perdu et déconnecte la session.</span><span class="sxs-lookup"><span data-stu-id="68b0f-113">The **EAPACTION\_SendWithTimeout** value allows for a time out, after which time the authentication service assumes the link was lost, and disconnects the session.</span></span>

<span data-ttu-id="68b0f-114">La valeur **EAPACTION \_ SendWithTimeoutInteractive** permet d’effectuer un laps de temps infini.</span><span class="sxs-lookup"><span data-stu-id="68b0f-114">The **EAPACTION\_SendWithTimeoutInteractive** value allows an infinite amount of time out to occur.</span></span> <span data-ttu-id="68b0f-115">L’authentificateur doit utiliser cette valeur lors de l’entrée d’utilisateur sur le client.</span><span class="sxs-lookup"><span data-stu-id="68b0f-115">The authenticator should use this value when expecting user input on the client.</span></span> <span data-ttu-id="68b0f-116">Ce délai permet à l’utilisateur d’effectuer une durée non spécifiée pour terminer l’entrée requise.</span><span class="sxs-lookup"><span data-stu-id="68b0f-116">This time out allows the user an unspecified amount of time to complete the required input.</span></span>

<span data-ttu-id="68b0f-117">Si **action** est **EAPACTION \_ SendWithTimeout** ou **EAPACTION \_ SendWithTimeoutInteractive**, le protocole d’authentification doit définir le membre **dwIdExpected** de la structure de [**\_ \_ sortie EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) sur l’identificateur du paquet suivant attendu de l’homologue distant.</span><span class="sxs-lookup"><span data-stu-id="68b0f-117">If **Action** is **EAPACTION\_SendWithTimeout** or **EAPACTION\_SendWithTimeoutInteractive**, the authentication protocol should set the **dwIdExpected** member of the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure to the identifier of the next packet that is expected from the remote peer.</span></span> <span data-ttu-id="68b0f-118">Même si le paquet suivant reçu de l’homologue correspond à cette valeur, le service d’authentification transmet le paquet au protocole d’authentification lors d’un appel ultérieur à [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="68b0f-118">Regardless of whether the next packet received from the peer matches this value, the authentication service passes the packet to the authentication protocol in a subsequent call to [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)).</span></span> <span data-ttu-id="68b0f-119">Le protocole d’authentification peut ignorer silencieusement le paquet en renvoyant simplement une **erreur de \_ \_ \_ paquet non valide PPP**.</span><span class="sxs-lookup"><span data-stu-id="68b0f-119">The authentication protocol may silently discard the packet by simply returning **ERROR\_PPP\_INVALID\_PACKET**.</span></span> <span data-ttu-id="68b0f-120">Si un paquet avec l’identificateur attendu n’est pas reçu dans le délai d’attente configuré, le service d’authentification appelle toujours **RasEapMakeMessage**.</span><span class="sxs-lookup"><span data-stu-id="68b0f-120">If a packet with the expected identifier is not received within the configured time-out period, the authentication service still calls **RasEapMakeMessage**.</span></span> <span data-ttu-id="68b0f-121">Dans ce cas, l’appel est effectué avec le paramètre *pReceivePacket* défini sur **null** pour indiquer que le paquet précédent doit être renvoyé.</span><span class="sxs-lookup"><span data-stu-id="68b0f-121">In this case, the call is made with the *pReceivePacket* parameter set to **NULL**, to indicate that the previous packet needs to be sent again.</span></span>

<span data-ttu-id="68b0f-122">Si le membre d' **action** est **EAPACTION \_ terminé** ou **EAPACTION \_ SendAndDone**, le service d’authentification examine le membre **dwAuthResultCode** de la [**\_ \_ sortie EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span><span class="sxs-lookup"><span data-stu-id="68b0f-122">If the **Action** member is **EAPACTION\_Done** or **EAPACTION\_SendAndDone**, the authentication service examines the **dwAuthResultCode** member of [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span></span> <span data-ttu-id="68b0f-123">Si **dwAuthResultCode** n’est pas une \_ erreur, l’authentification a réussi.</span><span class="sxs-lookup"><span data-stu-id="68b0f-123">If **dwAuthResultCode** is NO\_ERROR, the authentication succeeded.</span></span> <span data-ttu-id="68b0f-124">Si **dwAuthResultCode** est une valeur autre qu’aucune \_ erreur, l’authentification a échoué.</span><span class="sxs-lookup"><span data-stu-id="68b0f-124">If **dwAuthResultCode** is a value other than NO\_ERROR, the authentication failed.</span></span> <span data-ttu-id="68b0f-125">Le code d’erreur retourné pour le cas d’échec doit provenir de Raserror. h, Mprerror. h ou winerror. h.</span><span class="sxs-lookup"><span data-stu-id="68b0f-125">The error code returned for the failure case should come from Raserror.h, Mprerror.h, or Winerror.h.</span></span> <span data-ttu-id="68b0f-126">Les codes de retour possibles incluent, mais ne sont pas limités à, les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="68b0f-126">Possible return codes include, but are not limited to, the following:</span></span>

-   <span data-ttu-id="68b0f-127">ERREUR \_ aucune \_ autorisation de numérotation \_</span><span class="sxs-lookup"><span data-stu-id="68b0f-127">ERROR\_NO\_DIALIN\_PERMISSION</span></span>
-   <span data-ttu-id="68b0f-128">ERREUR \_ passwd \_ expirée</span><span class="sxs-lookup"><span data-stu-id="68b0f-128">ERROR\_PASSWD\_EXPIRED</span></span>
-   <span data-ttu-id="68b0f-129">compte d’erreur \_ \_ désactivé</span><span class="sxs-lookup"><span data-stu-id="68b0f-129">ERROR\_ACCT\_DISABLED</span></span>
-   <span data-ttu-id="68b0f-130">\_ \_ heures d’ouverture de session limitées à l’erreur \_</span><span class="sxs-lookup"><span data-stu-id="68b0f-130">ERROR\_RESTRICTED\_LOGON\_HOURS</span></span>
-   <span data-ttu-id="68b0f-131">ERREUR d' \_ authentification \_ interne</span><span class="sxs-lookup"><span data-stu-id="68b0f-131">ERROR\_AUTH\_INTERNAL</span></span>

<span data-ttu-id="68b0f-132">Dans le cas où l' **action** est **EAPACTION \_ effectuée** ou **EAPACTION \_ SendAndDone**, le membre **pUserAttributes** doit pointer vers des attributs qui remplacent les attributs du même type qui ont été transmis au serveur dans l’appel à [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="68b0f-132">In the case where **Action** is **EAPACTION\_Done** or **EAPACTION\_SendAndDone**, the **pUserAttributes** member should point to attributes that override attributes of the same type that were passed to the server in the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span>

<span data-ttu-id="68b0f-133">Le protocole d’authentification sur le serveur peut demander à ce que le service d’authentification appelle le fournisseur d’authentification actuel en retournant **EAPACTION \_ Authenticate** dans le membre **action** dans la [**\_ \_ sortie EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span><span class="sxs-lookup"><span data-stu-id="68b0f-133">The authentication protocol on the server can request that the authentication service invoke the current authentication provider by returning **EAPACTION\_Authenticate** in the **Action** member in [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span></span> <span data-ttu-id="68b0f-134">Dans ce cas, le pointeur **pUserAttributes** dans **le \_ \_ résultat EAP PPP** pointe uniquement vers les attributs qui ont été générés par le protocole d’authentification sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="68b0f-134">In this case, the **pUserAttributes** pointer in **PPP\_EAP\_OUTPUT** points only to attributes that were generated by the authentication protocol on the server.</span></span> <span data-ttu-id="68b0f-135">Elle n’inclut pas les attributs passés au serveur dans l’appel à [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="68b0f-135">It does not include any of the attributes that were passed to the server in the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span> <span data-ttu-id="68b0f-136">Le fournisseur d’authentification n’a pas besoin de ces attributs initiaux, car les informations d’authentification se trouvent dans le message EAP lui-même et non dans un attribut RADIUS distinct.</span><span class="sxs-lookup"><span data-stu-id="68b0f-136">The authentication provider does not require these initial attributes because the authentication credentials are inside the EAP message itself, not in a separate RADIUS attribute.</span></span> <span data-ttu-id="68b0f-137">Lorsque le service d’authentification répond à l’action d’authentification **EAPACTION \_** , **pUserAttributes** dans l' [**\_ \_ entrée EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input), pointe vers tous les attributs générés pendant l’authentification.</span><span class="sxs-lookup"><span data-stu-id="68b0f-137">When the authentication service responds to the **EAPACTION\_Authenticate** action, **pUserAttributes** in [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input), points to all attributes generated during authentication.</span></span> <span data-ttu-id="68b0f-138">Ces attributs sont retournés au protocole d’authentification sur le client.</span><span class="sxs-lookup"><span data-stu-id="68b0f-138">These attributes are returned to the authentication protocol on the client.</span></span>

<span data-ttu-id="68b0f-139">Si le protocole d’authentification utilise **EAPACTION \_ Authenticate**, le fournisseur d’authentification exécute PAP ou MD5-chap.</span><span class="sxs-lookup"><span data-stu-id="68b0f-139">If the authentication protocol uses **EAPACTION\_Authenticate**, the authentication provider performs either PAP or MD5-CHAP.</span></span> <span data-ttu-id="68b0f-140">Cette méthode d’authentification ne peut être utilisée qu’avec les clients Windows.</span><span class="sxs-lookup"><span data-stu-id="68b0f-140">This authentication method can be used only with Windows clients.</span></span>

<span data-ttu-id="68b0f-141">Si le protocole d’authentification authentifie l’utilisateur sans s’appuyer sur un fournisseur d’authentification, le protocole n’a pas besoin de définir d' **action** pour l’authentification **EAPACTION \_**.</span><span class="sxs-lookup"><span data-stu-id="68b0f-141">If the authentication protocol authenticates the user without relying on an authentication provider, there is no need for the protocol to ever set **Action** to **EAPACTION\_Authenticate**.</span></span> <span data-ttu-id="68b0f-142">Un exemple de ce cas de figure est EAP-Transport la sécurité de couche (TLS).</span><span class="sxs-lookup"><span data-stu-id="68b0f-142">An example of this case is EAP-Transport Layer Security (TLS).</span></span>

<span data-ttu-id="68b0f-143">Le paquet de réussite EAP est un paquet non reconnu.</span><span class="sxs-lookup"><span data-stu-id="68b0f-143">The EAP success packet is a non-acknowledged packet.</span></span> <span data-ttu-id="68b0f-144">Par conséquent, il peut être perdu et n’est pas renvoyé par le serveur.</span><span class="sxs-lookup"><span data-stu-id="68b0f-144">Therefore, it can be lost and not resent by the server.</span></span> <span data-ttu-id="68b0f-145">Si le service d’authentification sur le client reçoit un paquet NCP (Network Control Protocol), le service d’authentification côté serveur se poursuit comme si l’authentification était réussie.</span><span class="sxs-lookup"><span data-stu-id="68b0f-145">If the authentication service on the client receives a Network Control Protocol (NCP) packet, the server-side authentication service proceeds as though the authentication was successful.</span></span> <span data-ttu-id="68b0f-146">Cela est dû au fait que le serveur est passé à la phase NCP de PPP.</span><span class="sxs-lookup"><span data-stu-id="68b0f-146">This is because the server has moved on to the NCP phase of PPP.</span></span> <span data-ttu-id="68b0f-147">En conséquence, le service d’authentification appelle [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) avec le membre **fSuccessPacketReceived** de la structure [**\_ \_ d’entrée EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) ayant la valeur **true**.</span><span class="sxs-lookup"><span data-stu-id="68b0f-147">Accordingly, the authentication service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) with the **fSuccessPacketReceived** member of the [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure set to **TRUE**.</span></span>

<span data-ttu-id="68b0f-148">Au cours de la session d’authentification, le protocole d’authentification peut nécessiter une interaction directe avec l’utilisateur sur le client.</span><span class="sxs-lookup"><span data-stu-id="68b0f-148">During the course of the authentication session, the authentication protocol may require interaction directly with the user on the client.</span></span> <span data-ttu-id="68b0f-149">Le fournisseur du protocole d’authentification peut fournir une interface utilisateur interactive à cet effet.</span><span class="sxs-lookup"><span data-stu-id="68b0f-149">The authentication protocol vendor can provide an interactive user interface for this purpose.</span></span> <span data-ttu-id="68b0f-150">Le protocole d’authentification peut demander que le service affiche l’interface utilisateur interactive en définissant les membres **fInvokeInteractiveUI**, **pUIContextData** et **dwSizeOfUIContextData** dans la structure de [**\_ \_ sortie EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) .</span><span class="sxs-lookup"><span data-stu-id="68b0f-150">The authentication protocol can request that the service display the interactive UI by setting the **fInvokeInteractiveUI**, **pUIContextData**, and **dwSizeOfUIContextData** members in the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure.</span></span> <span data-ttu-id="68b0f-151">Pour plus d’informations sur l’utilisation d’une interface utilisateur interactive, consultez [interface utilisateur interactive](interactive-user-interface.md).</span><span class="sxs-lookup"><span data-stu-id="68b0f-151">For more information on using an interactive UI, see [Interactive User Interface](interactive-user-interface.md).</span></span>

<span data-ttu-id="68b0f-152">Le protocole d’authentification doit afficher une interface utilisateur uniquement via le mécanisme décrit sous [interface utilisateur interactive](interactive-user-interface.md).</span><span class="sxs-lookup"><span data-stu-id="68b0f-152">The authentication protocol should display a user interface only through the mechanism described under [Interactive User Interface](interactive-user-interface.md).</span></span> <span data-ttu-id="68b0f-153">Si le protocole d’authentification affiche lui-même l’interface utilisateur, le thread PPP se bloque jusqu’à ce que l’interface utilisateur soit fermée.</span><span class="sxs-lookup"><span data-stu-id="68b0f-153">If the authentication protocol itself displays the user interface, the PPP thread blocks until the user interface is dismissed.</span></span>

<span data-ttu-id="68b0f-154">Si, au cours du processus d’authentification, [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) retourne une valeur autre qu' **aucune \_ erreur** ou une **erreur de \_ \_ \_ paquet PPP non valide**, la session est déconnectée et l’erreur est consignée (sur le serveur) ou affichée à l’utilisateur (sur le client).</span><span class="sxs-lookup"><span data-stu-id="68b0f-154">If during the authentication process, [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) returns any value other than **NO\_ERROR** or **ERROR\_PPP\_INVALID\_PACKET**, the session is disconnected and the error is logged (on the server) or displayed to the user (on the client).</span></span>

 

 