---
description: cette section décrit les messages Windows et les files d’attente de messages.
ms.assetid: 21a4d40b-52da-49e4-a374-afc4927e96e8
title: À propos des messages et des files d’attente de messages
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b237b13447abf6a1db2edc698e84755d44b6b3859714ad11af1184c6121ae7be
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/11/2021
ms.locfileid: "118200855"
---
# <a name="about-messages-and-message-queues"></a>À propos des messages et des files d’attente de messages

contrairement aux applications basées sur MS DOS, les applications basées sur des Windows sont pilotées par les événements. Ils n’effectuent pas d’appels de fonction explicites (tels que les appels de la bibliothèque Runtime C) pour obtenir une entrée. Au lieu de cela, ils attendent que le système leur transmette leur entrée.

Le système transmet toutes les entrées d’une application aux différentes fenêtres de l’application. Chaque fenêtre possède une fonction, appelée procédure de fenêtre, que le système appelle chaque fois qu’elle a une entrée pour la fenêtre. La procédure de fenêtre traite l’entrée et retourne le contrôle au système. Pour plus d’informations sur les procédures de fenêtre, consultez [procédures de fenêtre](window-procedures.md).

Si une fenêtre de niveau supérieur cesse de répondre aux messages pendant plus de plusieurs secondes, le système considère que la fenêtre ne répond pas. Dans ce cas, le système masque la fenêtre et la remplace par une fenêtre fantôme qui a les mêmes attributs de l’ordre de plan, de l’emplacement, de la taille et de l’affichage. Cela permet à l’utilisateur de le déplacer, de le redimensionner ou même de fermer l’application. Toutefois, il s’agit des seules actions disponibles parce que l’application ne répond pas réellement. En mode débogueur, le système ne génère pas de fenêtre fantôme.

Cette section aborde les sujets suivants :

-   [Windows Messages](#windows-messages)
-   [Types de messages](#message-types)
    -   [Messages définis par le système](#system-defined-messages)
    -   [Messages définis par l’application](#application-defined-messages)
-   [Routage des messages](#message-routing)
    -   [Messages mis en file d’attente](#queued-messages)
    -   [Messages qui ne sont pas mis en file d’attente](#nonqueued-messages)
-   [Gestion des messages](#message-handling)
    -   [Boucle de messages](#message-loop)
    -   [Procédure de fenêtre](#window-procedure)
-   [Filtrage des messages](#message-filtering)
-   [Publication et envoi de messages](#posting-and-sending-messages)
    -   [Publication des messages](#posting-messages)
    -   [Envoi de messages](#sending-messages)
-   [Blocages de messages](#message-deadlocks)
-   [Diffusion de messages](#broadcasting-messages)
-   [Messages de requête](#query-messages)

## <a name="windows-messages"></a>Windows Messages

Le système passe l’entrée à une procédure de fenêtre sous la forme d’un *message*. Les messages sont générés par le système et les applications. Le système génère un message à chaque événement d’entrée, par exemple, lorsque l’utilisateur tape, déplace la souris ou clique sur un contrôle tel qu’une barre de défilement. Le système génère également des messages en réponse aux modifications apportées au système par une application, par exemple lorsqu’une application modifie le pool de ressources de police système ou redimensionne l’une de ses fenêtres. Une application peut générer des messages pour diriger ses propres fenêtres afin d’effectuer des tâches ou de communiquer avec Windows dans d’autres applications.

Le système envoie un message à une procédure de fenêtre avec un ensemble de quatre paramètres : un handle de fenêtre, un identificateur de message et deux valeurs appelées *paramètres de message*. Le *handle de fenêtre* identifie la fenêtre pour laquelle le message est destiné. Le système l’utilise pour déterminer la procédure de fenêtre qui doit recevoir le message.

Un *identificateur de message* est une constante nommée qui identifie l’objectif d’un message. Lorsqu’une procédure de fenêtre reçoit un message, elle utilise un identificateur de message pour déterminer comment traiter le message. Par exemple, l’identificateur de message [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) indique à la procédure de fenêtre que la zone cliente de la fenêtre a changé et doit être repeinte.

Les paramètres de message spécifient les données ou l’emplacement des données utilisées par une procédure de fenêtre lors du traitement d’un message. La signification et la valeur des paramètres de message dépendent du message. Un paramètre de message peut contenir un entier, des indicateurs binaires compressés, un pointeur vers une structure contenant des données supplémentaires, et ainsi de suite. Lorsqu’un message n’utilise pas de paramètres de message, il est généralement défini sur la **valeur null**. Une procédure de fenêtre doit vérifier l’identificateur de message pour déterminer comment interpréter les paramètres de message.

## <a name="message-types"></a>Types de messages

Cette section décrit les deux types de messages :

-   [Messages définis par le système](#system-defined-messages)
-   [Messages définis par l’application](#application-defined-messages)

### <a name="system-defined-messages"></a>Messages System-Defined

Le système envoie ou publie un *message défini par le système* lorsqu’il communique avec une application. Il utilise ces messages pour contrôler les opérations des applications et fournir des informations d’entrée et d’autres informations à traiter par les applications. Une application peut également envoyer ou poster des messages définis par le système. Les applications utilisent généralement ces messages pour contrôler le fonctionnement des fenêtres de contrôle créées à l’aide des classes de fenêtre préinscrites.

Chaque message défini par le système possède un identificateur de message unique et une constante symbolique correspondante (définie dans les fichiers d’en-tête du kit de développement logiciel (SDK)) qui indique l’objectif du message. Par exemple, la constante [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) demande qu’une fenêtre peint son contenu.

Les constantes symboliques spécifient la catégorie à laquelle les messages définis par le système appartiennent. Le préfixe de la constante identifie le type de fenêtre qui peut interpréter et traiter le message. Voici les préfixes et les catégories de messages qui leur sont associées.



| Préfixe                               | Catégorie de message             | Documentation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|--------------------------------------|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ABM** et **ABN**                  | Barre d’outils application Desktop  | [Messages et notifications de l’interpréteur de commandes](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **ACM** et **ACN**                  | Contrôle Animation            | [Messages de contrôle d’animation](/windows/desktop/Controls/bumper-animation-control-reference-messages) et [notifications de contrôle d’animation](/windows/desktop/Controls/bumper-animation-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **BCM**, **BCN**, **BM** **et l'** un | contrôle bouton               | [Messages de contrôle de bouton](/windows/desktop/Controls/bumper-button-control-reference-messages) et [notifications de contrôle de bouton](/windows/desktop/Controls/bumper-button-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **CB** et **CBN**                   | ComboBox (contrôle)             | [Messages de contrôle de zone de liste déroulante](/windows/desktop/Controls/bumper-combobox-control-reference-messages) et [notifications de contrôle ComboBox](/windows/desktop/Controls/bumper-combobox-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **CBEM** et **CBEN**                | Contrôle ComboBoxEx           | [Messages ComboBoxEx](/windows/desktop/Controls/bumper-comboboxex-control-reference-messages) et [notifications ComboBoxEx](/windows/desktop/Controls/bumper-comboboxex-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **DÉCLIN**                              | Contrôle général              | [Messages de contrôle](/windows/desktop/Controls/bumper-general-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **CDM**                              | Boîte de dialogue commune            | [Messages de boîte de dialogue commune](/windows/desktop/dlgbox/common-dialog-box-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **DFM**                              | Menu contextuel par défaut         | [Messages et notifications de l’interpréteur de commandes](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **DL**                               | Faire glisser la zone de liste                | [Faire glisser les notifications de zone de liste](/previous-versions//ff485914(v=vs.85))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **DM**                               | Contrôle de bouton de commande par défaut  | [Messages de boîte de dialogue](/windows/desktop/dlgbox/dialog-box-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **DTM** et **DTN**                  | Contrôle de sélecteur de date et heure | [Messages du sélecteur de date et heure](/windows/desktop/Controls/bumper-date-and-time-picker-control-reference-messages) et [notifications du sélecteur de date et heure](/windows/desktop/Controls/bumper-date-and-time-picker-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Em** et **fr**                    | Contrôle Edit                 | [Modifier les messages de contrôle](/windows/desktop/Controls/bumper-edit-control-reference-messages), [modifier les notifications de contrôle](/windows/desktop/Controls/bumper-edit-control-reference-notifications), [les messages de modification enrichis](/windows/desktop/Controls/bumper-rich-edit-control-reference-messages)et les [notifications de modification enrichie](/windows/desktop/Controls/bumper-rich-edit-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **HDM** et **HDN**                  | Contrôle header               | [Messages de contrôle d’en-tête](/windows/desktop/Controls/bumper-header-control-reference-messages) et [notifications de contrôle d’en-tête](/windows/desktop/Controls/bumper-header-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **HKM**                              | Contrôle de touche d’accès rapide              | [Messages de contrôle de touche d’accès rapide](/windows/desktop/Controls/bumper-hot-key-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **IPM** et **IPN**                  | IP address (contrôle)           | [Messages d’adresse IP](/windows/desktop/Controls/bumper-ip-address-control-reference-messages) et [notifications d’adresse IP](/windows/desktop/Controls/bumper-ip-address-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Lb** et **LBN**                   | Contrôle de zone de liste             | [Messages de zone de liste](/windows/desktop/Controls/bumper-list-box-control-reference-messages) et [notifications de zone de liste](/windows/desktop/Controls/bumper-list-box-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **NTLM**                               | Contrôle SysLink              | [Messages de contrôle SysLink](/windows/desktop/Controls/bumper-syslink-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **LVM** et **LVN**                  | Contrôle List View            | [Liste des messages d’affichage de liste](/windows/desktop/Controls/bumper-list-view-control-reference-messages) et [des notifications de liste](/windows/desktop/Controls/bumper-list-view-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **MCM** et **MCN**                  | Month Calendar (contrôle)       | [Messages du calendrier mensuel](/windows/desktop/Controls/bumper-month-calendar-control-reference-messages) et [notifications du calendrier mensuel](/windows/desktop/Controls/bumper-month-calendar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **PBM**                              | Barre de progression                 | [Messages de la barre de progression](/windows/desktop/Controls/bumper-progress-bar-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **PGM** et **PGN**                  | Contrôle de pagineur                | [Messages de contrôle de pagineur](/windows/desktop/Controls/bumper-pager-control-reference-messages) et [notifications de contrôle de radiomessagerie](/windows/desktop/Controls/bumper-pager-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **PSM** et **PSN**                  | Feuille de propriétés               | [Messages de feuille de propriétés](/windows/desktop/Controls/bumper-property-sheets-reference-messages) et [notifications de feuille de propriétés](/windows/desktop/Controls/bumper-property-sheets-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **RB** et **RBN**                   | Contrôle rebar                | [Messages de contrôle rebar](/windows/desktop/Controls/bumper-rebar-control-reference-messages) et [notifications de contrôle rebar](/windows/desktop/Controls/bumper-rebar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **SB** et **SBN**                   | Fenêtre barre d’État            | [Messages de barre d’État](/windows/desktop/Controls/bumper-status-bars-reference-messages) et [notifications de barre d’État](/windows/desktop/Controls/bumper-status-bars-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **SBM**                              | Contrôle de barre de défilement           | [Messages de la barre de défilement](/windows/desktop/Controls/bumper-scroll-bars-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **CARTE**                              | Menu Shell                   | [Messages et notifications de l’interpréteur de commandes](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **STM** et **STN**                  | Contrôle statique               | [Messages de contrôle statique](/windows/desktop/Controls/bumper-static-control-reference-messages) et [notifications de contrôle statique](/windows/desktop/Controls/bumper-static-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **To** et **TBN**                   | Barre d’outils                      | [Messages de contrôle de barre d’outils](/windows/desktop/Controls/bumper-toolbar-control-reference-messages) et [notifications de contrôle de barre d’outils](/windows/desktop/Controls/bumper-toolbar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TBM** et **TRBN**                 | TrackBar, contrôle             | [Messages de contrôle TrackBar](/windows/desktop/Controls/bumper-trackbar-control-reference-messages) et [notifications de contrôle TrackBar](/windows/desktop/Controls/bumper-trackbar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **TCM** et **TCN**                  | Contrôle Tab                  | [Messages de contrôle d’onglet](/windows/desktop/Controls/bumper-tab-control-reference-messages) et [notifications de contrôle d’onglet](/windows/desktop/Controls/bumper-tab-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TDM** et **TDN**                  | Boîte de dialogue de tâches                  | [Messages de boîte de dialogue de tâche](/windows/desktop/Controls/bumper-task-dialogs-reference-messages) et [notifications de boîte de dialogue de tâche](/windows/desktop/Controls/bumper-task-dialogs-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Atténuation** et **ttn**                  | ToolTip, contrôle              | [Messages de contrôle ToolTip](/windows/desktop/Controls/bumper-tooltip-control-reference-messages) et [notifications de contrôle ToolTip](/windows/desktop/Controls/bumper-tooltip-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TVM** et **TVN**                  | Contrôle Tree-View            | [Messages](/windows/desktop/Controls/bumper-tree-view-control-reference-messages) de l’arborescence et [notifications](/windows/desktop/Controls/bumper-tree-view-control-reference-notifications) de l’arborescence                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **UDM** et **UDN**                  | Contrôle up-out              | [Messages up-](/windows/desktop/Controls/bumper-up-down-control-reference-messages) out et [notifications up-](/windows/desktop/Controls/bumper-up-down-control-reference-notifications) out                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **WM**                               | Général                      | <dl> <dt>[presse-papiers Messages](/windows/desktop/dataxchg/clipboard-messages)</dt> <dt>[presse-papiers notifications](/windows/desktop/dataxchg/clipboard-notifications)</dt> <dt>[boîte de dialogue](/windows/desktop/dlgbox/common-dialog-box-notifications)</dt> notifications <dt>[](window-notifications.md)</dt> <dt>[curseurs](/windows/desktop/menurc/cursor-notifications)</dt> <dt>[](/windows/desktop/Controls/bumper-scroll-bars-reference-notifications)</dt> <dt>[](timer-notifications.md)</dt> notifications de <dt>[données Message](/windows/desktop/dataxchg/wm-copydata)</dt> de la <dt>[Gestionnaire de fenêtrage messages de](/windows/desktop/dwm/dwm-messages)</dt> <dt>[gestion des appareils](/windows/desktop/DevIO/device-management-messages)</dt> messages de gestion <dt>[échange dynamique de données](/windows/desktop/dataxchg/dynamic-data-exchange-messages)</dt> <dt>[des](/windows/desktop/dlgbox/dialog-box-notifications)</dt> messages de notifications de notifications <dt>[échange dynamique de données](/windows/desktop/dataxchg/dynamic-data-exchange-notifications)</dt> <dt>[](hook-notifications.md)</dt> <dt>[notifications de](/windows/desktop/menurc/keyboard-accelerator-messages)</dt> notifications <dt>[](/windows/desktop/inputdev/keyboard-input-notifications)</dt> de <dt>[la souris](/windows/desktop/inputdev/mouse-input-notifications)</dt> <dt>[](multiple-document-interface-messages.md)</dt> <dt>[](/windows/desktop/inputdev/raw-input-notifications)</dt> <dt>[fenêtres](/windows/desktop/menurc/menu-notifications)</dt> notifications de la fenêtre <dt>[messages](window-messages.md)</dt> d' <dt>[entrée de clavier](/windows/desktop/menurc/keyboard-accelerator-notifications)</dt> <dt>[](/windows/desktop/inputdev/keyboard-input-messages)</dt> </dl> |



 

les messages de fenêtre générale couvrent un large éventail d’informations et de demandes, y compris des messages pour les entrées de souris et de clavier, l’entrée de menu et de boîte de dialogue, la création et la gestion de fenêtres et l’échange dynamique de données (DDE).

### <a name="application-defined-messages"></a>Messages Application-Defined

Une application peut créer des messages à utiliser par ses propres fenêtres ou pour communiquer avec Windows dans d’autres processus. Si une application crée ses propres messages, la procédure de fenêtre qui les reçoit doit interpréter les messages et fournir le traitement approprié.

Les valeurs d’identificateur de message sont utilisées comme suit :

-   Le système réserve des valeurs d’identificateur de message dans la plage 0x0000 à 0x03FF (la valeur de [**WM \_ User**](wm-user.md)  – 1) pour les messages définis par le système. Les applications ne peuvent pas utiliser ces valeurs pour les messages privés.
-   Les valeurs de la plage 0x0400 (la valeur de l' [**\_ utilisateur WM**](wm-user.md)) par le biais de 0x7FFF sont disponibles pour les identificateurs de message pour les classes de fenêtre privées.
-   Si votre application est marquée comme version 4,0, vous pouvez utiliser des valeurs d’identificateur de message dans la plage 0x8000 ([**\_ application WM**](wm-app.md)) via 0xBFFF pour les messages privés.
-   Le système renvoie un identificateur de message dans la plage 0xC000 à 0xFFFF lorsqu’une application appelle la fonction [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) pour enregistrer un message. L’identificateur de message retourné par cette fonction est garanti comme étant unique dans tout le système. L’utilisation de cette fonction empêche les conflits qui peuvent se produire si d’autres applications utilisent le même identificateur de message à des fins différentes.

## <a name="message-routing"></a>Routage des messages

Le système utilise deux méthodes pour acheminer les messages vers une procédure de fenêtre : la publication de messages dans une file d’attente premier sorti, première sortie appelée *file d’attente de messages*, un objet mémoire défini par le système qui stocke temporairement les messages et l’envoi de messages directement à une procédure de fenêtre.

Les messages qui sont publiés dans une file d’attente de messages sont appelés *messages mis en file d’attente*. Il s’agit principalement du résultat d’une entrée utilisateur entrée via la souris ou le clavier, par exemple [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove), [**WM \_ LBUTTONDOWN**](/windows/desktop/inputdev/wm-lbuttondown), [**WM \_ keyverse**](/windows/desktop/inputdev/wm-keydown)et les messages [**WM \_ char**](/windows/desktop/inputdev/wm-char) . Les autres messages mis en file d’attente incluent les messages Timer, Paint et Quit : le [**\_ minuteur WM**](wm-timer.md), [**WM \_ Paint**](/windows/desktop/gdi/wm-paint)et [**WM \_ Quit**](wm-quit.md). La plupart des autres messages, qui sont envoyés directement à une procédure de fenêtre, sont appelés *messages non mis en file d’attente*.

-   [Messages mis en file d’attente](#queued-messages)
-   [Messages qui ne sont pas mis en file d’attente](#nonqueued-messages)

### <a name="queued-messages"></a>Messages mis en file d’attente

Le système peut afficher un nombre quelconque de fenêtres à la fois. Pour acheminer les entrées de souris et de clavier vers la fenêtre appropriée, le système utilise les files d’attente de messages.

Le système gère une file d’attente de messages système unique et une file d’attente de messages spécifique à un thread pour chaque thread d’interface utilisateur graphique. Pour éviter la surcharge liée à la création d’une file d’attente de messages pour les threads non-GUI, tous les threads sont créés initialement sans file d’attente de messages. Le système crée une file d’attente de messages spécifique au thread uniquement lorsque le thread effectue son premier appel à l’une des fonctions utilisateur spécifiques ; aucun appel de fonction d’interface utilisateur n’entraîne la création d’une file d’attente de messages.

Chaque fois que l’utilisateur déplace la souris, clique sur les boutons de la souris ou sur les types du clavier, le pilote de périphérique de la souris ou du clavier convertit l’entrée en messages et les place dans la file d’attente des messages du système. Le système supprime les messages, un à la fois, de la file d’attente des messages système, les examine pour déterminer la fenêtre de destination, puis les publie dans la file d’attente de messages du thread qui a créé la fenêtre de destination. La file d’attente de messages d’un thread reçoit tous les messages de la souris et du clavier pour les fenêtres créées par le thread. Le thread supprime les messages de sa file d’attente et indique au système de les envoyer à la procédure de fenêtre appropriée pour traitement.

À l’exception du message [**de \_ peinture WM**](/windows/desktop/gdi/wm-paint) , du message de [**\_ minuteur WM**](wm-timer.md) et du message [**WM \_ Quit**](wm-quit.md) , le système publie toujours les messages à la fin d’une file d’attente de messages. Cela garantit qu’une fenêtre reçoit ses messages d’entrée dans la séquence FIFO (First in, First Out) appropriée. Toutefois, le message de **\_ peinture WM** , le message de **\_ minuteur WM** et le message **WM \_ Quit** sont conservés dans la file d’attente et sont transmis à la procédure de fenêtre uniquement lorsque la file d’attente ne contient aucun autre message. En outre, plusieurs messages **WM \_ Paint** pour la même fenêtre sont combinés en un seul message de **\_ peinture WM** , consolidant toutes les parties non valides de la zone cliente en une seule zone. La combinaison de messages **WM \_ Paint** réduit le nombre de fois où une fenêtre doit redessiner le contenu de sa zone cliente.

Le système publie un message dans la file d’attente de messages d’un thread en remplissant une structure [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) et en la copiant dans la file d’attente de messages. Les informations contenues dans **MSG** incluent : le handle de la fenêtre pour laquelle le message est destiné, l’identificateur de message, les deux paramètres de message, l’heure à laquelle le message a été publié et la position du curseur de la souris. Un thread peut envoyer un message à sa propre file d’attente de messages ou à la file d’attente d’un autre thread à l’aide de la fonction [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) ou [**PostThreadMessage**](/windows/win32/api/winuser/nf-winuser-postthreadmessagea) .

Une application peut supprimer un message de sa file d’attente à l’aide de la fonction [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) . Pour examiner un message sans le supprimer de sa file d’attente, une application peut utiliser la fonction [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea) . Cette fonction remplit [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) avec les informations relatives au message.

Après la suppression d’un message de sa file d’attente, une application peut utiliser la fonction [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) pour indiquer au système d’envoyer le message à une procédure de fenêtre pour traitement. **DispatchMessage** prend un pointeur vers le [**message**](/windows/win32/api/winuser/ns-winuser-msg) qui a été rempli par un appel précédent à la fonction [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) ou [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea) . **DispatchMessage** transmet le handle de fenêtre, l’identificateur de message et les deux paramètres de message à la procédure de fenêtre, mais il ne passe pas l’heure à laquelle le message a été publié ou la position du curseur de la souris. Une application peut récupérer ces informations en appelant les fonctions [**GetMessageTime**](/windows/win32/api/winuser/nf-winuser-getmessagetime) et [**GetMessagePos**](/windows/win32/api/winuser/nf-winuser-getmessagepos) lors du traitement d’un message.

Un thread peut utiliser la fonction [**WaitMessage**](/windows/win32/api/winuser/nf-winuser-waitmessage) pour donner le contrôle à d’autres threads lorsqu’il n’a aucun message dans sa file d’attente de messages. La fonction interrompt le thread et ne retourne pas tant qu’un nouveau message n’a pas été placé dans la file d’attente de messages du thread.

Vous pouvez appeler la fonction [**SetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-setmessageextrainfo) pour associer une valeur à la file d’attente de messages du thread actif. Appelez ensuite la fonction [**GetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-getmessageextrainfo) pour récupérer la valeur associée au dernier message récupéré par la fonction [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) ou [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea) .

### <a name="nonqueued-messages"></a>Messages qui ne sont pas mis en file d’attente

Les messages non mis en file d’attente sont envoyés immédiatement à la procédure de fenêtre de destination, en ignorant la file d’attente de messages système et la file d’attente de messages de thread. Le système envoie généralement des messages sans file d’attente pour notifier une fenêtre d’événements qui l’affectent. Par exemple, lorsque l’utilisateur active une nouvelle fenêtre d’application, le système envoie une série de messages à la fenêtre, notamment [**WM \_ Activate**](/windows/desktop/inputdev/wm-activate), [**WM \_ SetFocus**](/windows/desktop/inputdev/wm-setfocus)et [**WM \_ SETCURSOR**](/windows/desktop/menurc/wm-setcursor). Ces messages informent la fenêtre qu’elle a été activée, que l’entrée au clavier est dirigée vers la fenêtre et que le curseur de la souris a été déplacé dans les bordures de la fenêtre. Les messages non mis en file d’attente peuvent également se produire lorsqu’une application appelle certaines fonctions système. Par exemple, le système envoie le message [**WM \_ WINDOWPOSCHANGED**](wm-windowposchanged.md) après qu’une application a utilisé la fonction [**SetWindowPos**](/windows/win32/api/winuser/nf-winuser-setwindowpos) pour déplacer une fenêtre.

Certaines fonctions qui envoient des messages qui ne sont pas mis en file d’attente sont [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage), [**BroadcastSystemMessageEx**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessageexa), [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage), [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta)et [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea).

## <a name="message-handling"></a>Gestion des messages

Une application doit supprimer et traiter les messages publiés dans les files d’attente de messages de ses threads. Une application à thread unique utilise généralement une *boucle de message* dans sa fonction [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) pour supprimer et envoyer des messages aux procédures de fenêtre appropriées à des fins de traitement. Les applications avec plusieurs threads peuvent inclure une boucle de message dans chaque thread qui crée une fenêtre. Les sections suivantes décrivent le fonctionnement d’une boucle de message et expliquent le rôle d’une procédure de fenêtre :

-   [Boucle de messages](#message-loop)
-   [Procédure de fenêtre](#window-procedure)

### <a name="message-loop"></a>Boucle de messages

Une boucle de message simple se compose d’un appel de fonction à chacune de ces trois fonctions : [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage), [**TranslateMessage**](/windows/win32/api/winuser/nf-winuser-translatemessage)et [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage). Notez que, en cas d’erreur, **GetMessage** retourne – 1, ce qui nécessite un test spécial.


```
MSG msg;
BOOL bRet;

while( (bRet = GetMessage( &msg, NULL, 0, 0 )) != 0)
{ 
    if (bRet == -1)
    {
        // handle the error and possibly exit
    }
    else
    {
        TranslateMessage(&msg); 
        DispatchMessage(&msg); 
    }
}
```



La fonction [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) extrait un message de la file d’attente et le copie dans une structure de type [**MSG**](/windows/win32/api/winuser/ns-winuser-msg). Elle retourne une valeur différente de zéro, sauf si elle rencontre le message [**WM \_ Quit**](wm-quit.md) , auquel cas elle retourne **false** et met fin à la boucle. Dans une application à thread unique, le fait de mettre fin à la boucle de message est souvent la première étape de la fermeture de l’application. Une application peut mettre fin à sa propre boucle à l’aide de la fonction [**PostQuitMessage**](/windows/win32/api/winuser/nf-winuser-postquitmessage) , généralement en réponse au message [**WM \_ Destroy**](wm-destroy.md) dans la procédure de fenêtre de la fenêtre principale de l’application.

Si vous spécifiez un handle de fenêtre comme deuxième paramètre de [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage), seuls les messages de la fenêtre spécifiée sont récupérés à partir de la file d’attente. **GetMessage** peut également filtrer les messages dans la file d’attente, en extrayant uniquement les messages qui se trouvent dans une plage spécifiée. Pour plus d’informations sur le filtrage des messages, consultez [filtrage](#message-filtering)des messages.

La boucle de message d’un thread doit inclure [**TranslateMessage**](/windows/win32/api/winuser/nf-winuser-translatemessage) si le thread doit recevoir l’entrée de caractères à partir du clavier. Le système génère des messages de clé virtuelle ([**WM \_ keyverse**](/windows/desktop/inputdev/wm-keydown) et [**WM \_ KEYUP**](/windows/desktop/inputdev/wm-keyup)) chaque fois que l’utilisateur appuie sur une touche. Un message de clé virtuelle contient un code de clé virtuelle qui identifie la touche qui a été enfoncée, mais pas sa valeur de caractère. Pour récupérer cette valeur, la boucle de message doit contenir **TranslateMessage**, qui convertit le message de clé virtuelle en message de [**\_ type**](/windows/desktop/inputdev/wm-char)caractère (WM) et le replace dans la file d’attente de messages d’application. Le message de caractères peut ensuite être supprimé lors de l’itération suivante de la boucle de message et distribué à une procédure de fenêtre.

La fonction [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) envoie un message à la procédure de fenêtre associée au handle de fenêtre spécifié dans la structure [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) . Si le handle de fenêtre est HWND au niveau le **\_ plus** élevé, **DispatchMessage** envoie le message aux procédures de fenêtre de toutes les fenêtres de niveau supérieur dans le système. Si le handle de fenêtre a la **valeur null**, **DispatchMessage** ne fait rien avec le message.

Le thread principal d’une application démarre sa boucle de messages après l’initialisation de l’application et la création d’au moins une fenêtre. Une fois démarrée, la boucle de message continue de récupérer les messages de la file d’attente de messages du thread et de les distribuer aux fenêtres appropriées. La boucle de message se termine lorsque la fonction [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) supprime le message de [**\_ fermeture WM**](wm-quit.md) de la file d’attente de messages.

Une seule boucle de message est nécessaire pour une file d’attente de messages, même si une application contient de nombreuses fenêtres. [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) distribue toujours le message à la fenêtre appropriée ; Cela est dû au fait que chaque message de la file d’attente est une structure [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) contenant le descripteur de la fenêtre à laquelle le message appartient.

Vous pouvez modifier une boucle de messages de différentes façons. Par exemple, vous pouvez récupérer des messages de la file d’attente sans les distribuer à une fenêtre. Cela est utile pour les applications qui publient des messages qui ne spécifient pas de fenêtre. Vous pouvez également diriger [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) pour rechercher des messages spécifiques, en laissant les autres messages dans la file d’attente. Cela est utile si vous devez ignorer provisoirement l’ordre FIFO habituel de la file d’attente de messages.

Une application qui utilise des touches accélérateur doit pouvoir traduire les messages de clavier en messages de commande. Pour ce faire, la boucle de message de l’application doit inclure un appel à la fonction [**TranslateAccelerator**](/windows/desktop/api/winuser/nf-winuser-translateacceleratora) . Pour plus d’informations sur les touches d’accès rapide, consultez [accélérateurs clavier](/windows/desktop/menurc/keyboard-accelerators).

Si un thread utilise une boîte de dialogue non modale, la boucle de message doit inclure la fonction [**IsDialogMessage**](/windows/desktop/api/winuser/nf-winuser-isdialogmessagea) pour que la boîte de dialogue puisse recevoir une entrée au clavier.

### <a name="window-procedure"></a>Procédure de fenêtre

Une procédure de fenêtre est une fonction qui reçoit et traite tous les messages envoyés à la fenêtre. Chaque classe de fenêtre a une procédure de fenêtre, et chaque fenêtre créée avec cette classe utilise cette même procédure de fenêtre pour répondre aux messages.

Le système envoie un message à une procédure de fenêtre en passant les données de message en tant qu’arguments à la procédure. La procédure de fenêtre exécute ensuite une action appropriée pour le message ; Il vérifie l’identificateur de message et, lors du traitement du message, utilise les informations spécifiées par les paramètres de message.

Une procédure de fenêtre n’ignore généralement pas un message. S’il ne traite pas un message, il doit renvoyer le message au système pour le traitement par défaut. Pour ce faire, la procédure de fenêtre appelle la fonction [**DefWindowProc**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) , qui exécute une action par défaut et retourne un résultat de message. La procédure de fenêtre doit ensuite retourner cette valeur en tant que résultat de message propre. La plupart des procédures de fenêtre traitent simplement quelques messages et les transmettent sur le système en appelant **DefWindowProc**.

Étant donné qu’une procédure de fenêtre est partagée par toutes les fenêtres appartenant à la même classe, elle peut traiter des messages pour plusieurs fenêtres différentes. Pour identifier la fenêtre spécifique affectée par le message, une procédure de fenêtre peut examiner le handle de fenêtre passé avec un message. Pour plus d’informations sur les procédures de fenêtre, consultez [procédures de fenêtre](window-procedures.md).

## <a name="message-filtering"></a>Filtrage des messages

Une application peut choisir des messages spécifiques à récupérer à partir de la file d’attente de messages (tout en ignorant les autres messages) à l’aide de la fonction [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) ou [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea) pour spécifier un filtre de messages. Le filtre est une plage d’identificateurs de message (spécifiée par un premier et un dernier identificateur), un handle de fenêtre, ou les deux. **GetMessage** et **PeekMessage** utilisent un filtre de messages pour sélectionner les messages à récupérer de la file d’attente. Le filtrage des messages est utile si une application doit rechercher les messages arrivés plus tard dans la file d’attente dans la file d’attente de messages. Elle est également utile si une application doit traiter des messages d’entrée (matériel) avant de traiter les messages publiés.

Les constantes **WM \_ keyfirst** et **WM \_ keylast** peuvent être utilisées comme valeurs de filtre pour récupérer tous les messages de clavier. les constantes **WM \_ MOUSEFIRST** et **WM \_ MOUSELAST** peuvent être utilisées pour récupérer tous les messages de la souris.

Toute application qui filtre des messages doit s’assurer qu’un message qui satisfait au filtre de message peut être publié. Par exemple, si une application filtre un message [**WM \_**](/windows/desktop/inputdev/wm-char) dans une fenêtre qui ne reçoit pas d’entrée au clavier, la fonction [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) ne retourne pas. Cela a pour effet de « bloquer » l’application.

## <a name="posting-and-sending-messages"></a>Publication et envoi de messages

Toute application peut poster et envoyer des messages. Comme le système, une application publie un message en la copiant dans une file d’attente de messages et envoie un message en passant les données de message en tant qu’arguments à une procédure de fenêtre. Pour envoyer des messages, une application utilise la fonction [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) . Une application peut envoyer un message en appelant la fonction [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage), [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage), [**SendMessageCallback**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka), [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta), [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea)ou [**SendDlgItemMessage**](/windows/desktop/api/winuser/nf-winuser-senddlgitemmessagea) .

### <a name="posting-messages"></a>Publication des messages

Une application publie généralement un message pour notifier une fenêtre spécifique afin d’effectuer une tâche. [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) crée une structure [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) pour le message et copie le message dans la file d’attente de messages. La boucle de message de l’application récupère ensuite le message et le distribue à la procédure de fenêtre appropriée.

Une application peut poster un message sans spécifier de fenêtre. Si l’application fournit un handle de fenêtre **null** lors de l’appel de [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea), le message est publié dans la file d’attente associée au thread actuel. Comme aucun descripteur de fenêtre n’est spécifié, l’application doit traiter le message dans la boucle de message. Il s’agit d’une façon de créer un message qui s’applique à l’application entière, plutôt qu’à une fenêtre spécifique.

Il peut arriver que vous souhaitiez poster un message à toutes les fenêtres de niveau supérieur du système. Une application peut envoyer un message à toutes les fenêtres de niveau supérieur en appelant [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) et en spécifiant HWND au niveau le **\_ plus** élevé dans le paramètre *HWND* .

Une erreur de programmation courante consiste à supposer que la fonction [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) publie toujours un message. Cela n’est pas vrai lorsque la file d’attente de messages est pleine. Une application doit vérifier la valeur de retour de la fonction **PostMessage** pour déterminer si le message a été publié et, si ce n’est pas le cas, la republier.

### <a name="sending-messages"></a>sending messages

Une application envoie généralement un message pour notifier une procédure de fenêtre à l’exécution immédiate d’une tâche. La fonction [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) envoie le message à la procédure de fenêtre correspondant à la fenêtre spécifiée. La fonction attend que la procédure de fenêtre termine le traitement, puis retourne le résultat du message. Les fenêtres parent et enfant communiquent souvent en envoyant des messages entre eux. Par exemple, une fenêtre parente dotée d’un contrôle d’édition comme fenêtre enfant peut définir le texte du contrôle en lui envoyant un message. Le contrôle peut notifier la fenêtre parente des modifications apportées au texte par l’utilisateur en renvoyant des messages au parent.

La fonction [**SendMessageCallback**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka) envoie également un message à la procédure de fenêtre correspondant à la fenêtre donnée. Toutefois, cette fonction est retournée immédiatement. Une fois que la procédure de fenêtre a traité le message, le système appelle la fonction de rappel spécifiée. Pour plus d’informations sur la fonction de rappel, consultez la fonction [**SendAsyncProc**](/windows/win32/api/winuser/nc-winuser-sendasyncproc) .

Il peut arriver que vous souhaitiez envoyer un message à toutes les fenêtres de niveau supérieur du système. Par exemple, si l’application modifie l’heure système, elle doit notifier à toutes les fenêtres de niveau supérieur la modification en envoyant un message [**WM \_ TIMECHANGE**](../sysinfo/wm-timechange.md) . Une application peut envoyer un message à toutes les fenêtres de niveau supérieur en appelant [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) et en spécifiant HWND en haut du paramètre *HWND* . **\_** Vous pouvez également diffuser un message à toutes les applications en appelant la fonction [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) et en spécifiant des **\_ applications BSM** dans le paramètre *lpdwRecipients* .

À l’aide de la fonction [**InSendMessage**](/windows/win32/api/winuser/nf-winuser-insendmessage) ou [**InSendMessageEx**](/windows/win32/api/winuser/nf-winuser-insendmessageex) , une procédure de fenêtre peut déterminer si elle traite un message envoyé par un autre thread. Cette fonctionnalité est utile lorsque le traitement des messages dépend de l’origine du message.

## <a name="message-deadlocks"></a>Blocages de messages

Un thread qui appelle la fonction [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) pour envoyer un message à un autre thread ne peut pas continuer à s’exécuter tant que la procédure de fenêtre qui reçoit le message n’est pas retournée. Si le thread de réception produit le contrôle lors du traitement du message, le thread d’envoi ne peut pas continuer à s’exécuter, car il attend que **SendMessage** retourne. Si le thread de réception est attaché à la même file d’attente que l’expéditeur, il peut provoquer un blocage de l’application. (Notez que les crochets de journal attachent des threads à la même file d’attente.)

Notez que le thread de réception n’a pas besoin d’obtenir un contrôle explicite ; l’appel de l’une des fonctions suivantes peut provoquer le contrôle implicite d’un thread.

-   [**DialogBox**](/windows/desktop/api/winuser/nf-winuser-dialogboxa)
-   [**DialogBoxIndirect**](/windows/desktop/api/winuser/nf-winuser-dialogboxindirecta)
-   [**DialogBoxIndirectParam**](/windows/desktop/api/winuser/nf-winuser-dialogboxindirectparama)
-   [**DialogBoxParam**](/windows/desktop/api/winuser/nf-winuser-dialogboxparama)
-   [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage)
-   [**MessageBox**](/windows/desktop/api/winuser/nf-winuser-messagebox)
-   [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea)
-   [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage)

Pour éviter les interblocages potentiels dans votre application, envisagez d’utiliser les fonctions [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea) ou [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta) . Dans le cas contraire, une procédure de fenêtre peut déterminer si un message reçu a été envoyé par un autre thread en appelant la fonction [**InSendMessage**](/windows/win32/api/winuser/nf-winuser-insendmessage) ou [**InSendMessageEx**](/windows/win32/api/winuser/nf-winuser-insendmessageex) . Avant d’appeler l’une des fonctions de la liste précédente lors du traitement d’un message, la procédure de fenêtre doit d’abord appeler **InSendMessage** ou **InSendMessageEx**. Si cette fonction retourne la **valeur true**, la procédure de fenêtre doit appeler la fonction [**replyMessage**](/windows/win32/api/winuser/nf-winuser-replymessage) avant toute fonction qui amène le thread à donner le contrôle.

## <a name="broadcasting-messages"></a>Diffusion de messages

Chaque message se compose d’un identificateur de message et de deux paramètres, *wParam* et *lParam*. L’identificateur de message est une valeur unique qui spécifie l’objet du message. Les paramètres fournissent des informations supplémentaires spécifiques au message, mais le paramètre *wParam* est généralement une valeur de type qui fournit des informations supplémentaires sur le message.

La *diffusion* d’un message est simplement l’envoi d’un message à plusieurs destinataires dans le système. Pour diffuser un message à partir d’une application, utilisez la fonction [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) , en spécifiant les destinataires du message. Au lieu de spécifier des destinataires individuels, vous devez spécifier un ou plusieurs types de destinataires. Ces types sont les applications, les pilotes installables, les pilotes réseau et les pilotes de périphérique au niveau du système. Le système envoie des messages de diffusion à tous les membres de chaque type spécifié.

En général, le système diffuse des messages en réponse à des modifications qui ont lieu dans des pilotes de périphérique au niveau du système ou des composants associés. Le pilote ou le composant associé diffuse le message aux applications et autres composants pour les notifier de la modification. Par exemple, le composant responsable des lecteurs de disque diffuse un message chaque fois que le pilote de périphérique pour le lecteur de disquette détecte un changement de support, par exemple lorsque l’utilisateur insère un disque dans le lecteur.

Le système diffuse les messages aux destinataires dans l’ordre suivant : pilotes de périphérique au niveau système, pilotes réseau, pilotes installables et applications. Cela signifie que les pilotes de périphérique au niveau du système, s’ils sont choisis comme destinataires, ont toujours la première opportunité de répondre à un message. Dans un type de destinataire donné, il n’est pas garanti que le pilote reçoive un message donné avant tout autre pilote. Cela signifie qu’un message destiné à un pilote spécifique doit avoir un identificateur de message global unique, de sorte qu’aucun autre pilote ne le traite involontairement.

Vous pouvez également diffuser des messages à toutes les fenêtres de niveau supérieur en spécifiant la **\_ diffusion HWND** dans la fonction [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage), [**SendMessageCallback**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka), [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta)ou [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea) .

Les applications reçoivent des messages via la procédure de fenêtre de leurs fenêtres de niveau supérieur. Les messages ne sont pas envoyés aux fenêtres enfants. Les services peuvent recevoir des messages par le biais d’une procédure de fenêtre ou de leurs gestionnaires de contrôle de service.

> [!Note]  
> Les pilotes de périphérique au niveau système utilisent une fonction de niveau système associée pour diffuser les messages système.

 

## <a name="query-messages"></a>Messages de requête

Vous pouvez créer vos propres messages personnalisés et les utiliser pour coordonner les activités entre vos applications et d’autres composants du système. Cela s’avère particulièrement utile si vous avez créé vos propres pilotes installables ou pilotes de périphérique au niveau du système. Vos messages personnalisés peuvent transporter des informations vers et à partir de votre pilote et des applications qui utilisent le pilote.

Pour interroger les destinataires afin d’obtenir l’autorisation d’effectuer une action donnée, utilisez un *message de requête*. Vous pouvez générer vos propres messages de requête en définissant la valeur de **\_ requête BSF** dans le paramètre *dwFlags* lors de l’appel de [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage). Chaque destinataire du message de requête doit retourner la **valeur true** pour que la fonction envoie le message au destinataire suivant. Si un destinataire retourne **la \_ requête \_ de diffusion Deny**, la diffusion se termine immédiatement et la fonction retourne un zéro.

 

 
