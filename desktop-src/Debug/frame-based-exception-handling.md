---
description: Un gestionnaire d’exceptions basé sur des frames vous permet de gérer la possibilité qu’une exception se produise dans une certaine séquence de code. Un gestionnaire d’exceptions basé sur des frames se compose des éléments suivants.
ms.assetid: 07aac772-f917-48b7-91a9-3b5d4cb43600
title: Gestion des exceptions basée sur des frames
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12b268b5d02de83bca22a1d3311905b05be1f748
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104483505"
---
# <a name="frame-based-exception-handling"></a><span data-ttu-id="c07c8-104">Gestion des exceptions basée sur des frames</span><span class="sxs-lookup"><span data-stu-id="c07c8-104">Frame-based Exception Handling</span></span>

<span data-ttu-id="c07c8-105">Un *Gestionnaire d’exceptions basé sur des frames* vous permet de gérer la possibilité qu’une exception se produise dans une certaine séquence de code.</span><span class="sxs-lookup"><span data-stu-id="c07c8-105">A *frame-based exception handler* allows you to deal with the possibility that an exception may occur in a certain sequence of code.</span></span> <span data-ttu-id="c07c8-106">Un gestionnaire d’exceptions basé sur des frames se compose des éléments suivants.</span><span class="sxs-lookup"><span data-stu-id="c07c8-106">A frame-based exception handler consists of the following elements.</span></span>

-   <span data-ttu-id="c07c8-107">Corps protégé du code</span><span class="sxs-lookup"><span data-stu-id="c07c8-107">A guarded body of code</span></span>
-   <span data-ttu-id="c07c8-108">Expression de filtre</span><span class="sxs-lookup"><span data-stu-id="c07c8-108">A filter expression</span></span>
-   <span data-ttu-id="c07c8-109">Bloc de gestionnaire d’exceptions</span><span class="sxs-lookup"><span data-stu-id="c07c8-109">An exception-handler block</span></span>

<span data-ttu-id="c07c8-110">Les gestionnaires d’exceptions basés sur des frames sont déclarés dans une syntaxe spécifique au langage.</span><span class="sxs-lookup"><span data-stu-id="c07c8-110">Frame-based exception handlers are declared in language-specific syntax.</span></span> <span data-ttu-id="c07c8-111">Par exemple, dans le compilateur d’optimisation Microsoft C/C++, elles sont implémentées à l’aide de **\_ \_ try** et **\_ \_ except**.</span><span class="sxs-lookup"><span data-stu-id="c07c8-111">For example, in the Microsoft C/C++ Optimizing Compiler, they are implemented using **\_\_try** and **\_\_except**.</span></span> <span data-ttu-id="c07c8-112">Pour plus d’informations, consultez [syntaxe du gestionnaire](handler-syntax.md).</span><span class="sxs-lookup"><span data-stu-id="c07c8-112">For more information, see [Handler Syntax](handler-syntax.md).</span></span>

<span data-ttu-id="c07c8-113">Le *corps de code gardé* est un ensemble d’une ou plusieurs instructions pour lesquelles l’expression de filtre et le bloc de gestionnaire d’exceptions fournissent une protection de gestion des exceptions.</span><span class="sxs-lookup"><span data-stu-id="c07c8-113">The *guarded body of code* is a set of one or more statements for which the filter expression and the exception-handler block provide exception-handling protection.</span></span> <span data-ttu-id="c07c8-114">Le corps protégé peut être un bloc de code, un ensemble de blocs imbriqués ou une procédure ou une fonction entière.</span><span class="sxs-lookup"><span data-stu-id="c07c8-114">The guarded body can be a block of code, a set of nested blocks, or an entire procedure or function.</span></span> <span data-ttu-id="c07c8-115">À l’aide du compilateur d’optimisation Microsoft C/C++, un corps protégé est placé entre accolades ( {} ) à la suite du mot clé **\_ \_ try** .</span><span class="sxs-lookup"><span data-stu-id="c07c8-115">Using the Microsoft C/C++ Optimizing Compiler, a guarded body is enclosed by braces ({}) following the **\_\_try** keyword.</span></span>

<span data-ttu-id="c07c8-116">L' *expression de filtre* d’un gestionnaire d’exceptions basé sur des frames est une expression qui est évaluée par le système lorsqu’une exception se produit dans le corps protégé.</span><span class="sxs-lookup"><span data-stu-id="c07c8-116">The *filter expression* of a frame-based exception handler is an expression that is evaluated by the system when an exception occurs within the guarded body.</span></span> <span data-ttu-id="c07c8-117">Cette évaluation produit l’une des actions suivantes par le système.</span><span class="sxs-lookup"><span data-stu-id="c07c8-117">This evaluation results in one of the following actions by the system.</span></span>

-   <span data-ttu-id="c07c8-118">Le système arrête la recherche d’un gestionnaire d’exceptions, restaure l’état de l’ordinateur et continue l’exécution du thread au point où l’exception s’est produite.</span><span class="sxs-lookup"><span data-stu-id="c07c8-118">The system stops its search for an exception handler, restores the machine state, and continues thread execution at the point at which the exception occurred.</span></span>
-   <span data-ttu-id="c07c8-119">Le système poursuit la recherche d’un gestionnaire d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="c07c8-119">The system continues its search for an exception handler.</span></span>
-   <span data-ttu-id="c07c8-120">Le système transfère le contrôle au gestionnaire d’exceptions, et l’exécution du thread continue de manière séquentielle dans le frame de pile dans lequel le gestionnaire d’exceptions est trouvé.</span><span class="sxs-lookup"><span data-stu-id="c07c8-120">The system transfers control to the exception handler, and thread execution continues sequentially in the stack frame in which the exception handler is found.</span></span> <span data-ttu-id="c07c8-121">Si le gestionnaire n’est pas dans le frame de pile dans lequel l’exception s’est produite, le système déroule la pile, en laissant le frame de pile actuel et tous les autres frames de pile jusqu’à ce qu’il soit renvoyé au frame de pile du gestionnaire d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="c07c8-121">If the handler is not in the stack frame in which the exception occurred, the system unwinds the stack, leaving the current stack frame and any other stack frames until it is back to the exception handler's stack frame.</span></span> <span data-ttu-id="c07c8-122">Avant l’exécution d’un gestionnaire d’exceptions, les gestionnaires de terminaisons sont exécutés pour tous les corps protégés du code qui se sont terminés suite au transfert de contrôle au gestionnaire d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="c07c8-122">Before an exception handler is executed, termination handlers are executed for any guarded bodies of code that terminated as a result of the transfer of control to the exception handler.</span></span> <span data-ttu-id="c07c8-123">Pour plus d’informations sur les gestionnaires de terminaisons, reportez-vous à [gestion des arrêts](termination-handling.md).</span><span class="sxs-lookup"><span data-stu-id="c07c8-123">For more information about termination handlers, refer to [Termination Handling](termination-handling.md).</span></span>

<span data-ttu-id="c07c8-124">L’expression de filtre peut être une expression simple, ou elle peut appeler une *fonction de filtre* qui tente de gérer l’exception.</span><span class="sxs-lookup"><span data-stu-id="c07c8-124">The filter expression can be a simple expression, or it can invoke a *filter function* that attempts to handle the exception.</span></span> <span data-ttu-id="c07c8-125">Vous pouvez appeler les fonctions [**GetExceptionCode**](getexceptioncode.md) et [**GetExceptionInformation**](getexceptioninformation.md) à partir d’une expression de filtre pour obtenir des informations sur l’exception filtrée.</span><span class="sxs-lookup"><span data-stu-id="c07c8-125">You can call the [**GetExceptionCode**](getexceptioncode.md) and [**GetExceptionInformation**](getexceptioninformation.md) functions from within a filter expression to get information about the exception being filtered.</span></span> <span data-ttu-id="c07c8-126">**GetExceptionCode** retourne un code qui identifie le type d’exception et **GetExceptionInformation** retourne un pointeur vers une structure [**de \_ pointeurs d’exception**](/windows/desktop/api/WinNT/ns-winnt-exception_pointers) qui contient des pointeurs vers des structures d' [**\_ enregistrement**](/windows/desktop/api/WinNT/ns-winnt-exception_record) de [**contexte**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) et d’exception.</span><span class="sxs-lookup"><span data-stu-id="c07c8-126">**GetExceptionCode** returns a code that identifies the type of exception, and **GetExceptionInformation** returns a pointer to an [**EXCEPTION\_POINTERS**](/windows/desktop/api/WinNT/ns-winnt-exception_pointers) structure that contains pointers to [**CONTEXT**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) and [**EXCEPTION\_RECORD**](/windows/desktop/api/WinNT/ns-winnt-exception_record) structures.</span></span>

<span data-ttu-id="c07c8-127">Ces fonctions ne peuvent pas être appelées à partir d’une fonction de filtre, mais leurs valeurs de retour peuvent être passées comme paramètres à une fonction de filtre.</span><span class="sxs-lookup"><span data-stu-id="c07c8-127">These functions cannot be called from within a filter function, but their return values can be passed as parameters to a filter function.</span></span> <span data-ttu-id="c07c8-128">[**GetExceptionCode**](getexceptioncode.md) peut être utilisé dans le bloc de gestionnaire d’exceptions, mais [**GetExceptionInformation**](getexceptioninformation.md) ne peut pas être, car les informations vers lesquelles il pointe se trouvent généralement sur la pile et sont détruites lorsque le contrôle est transféré à un gestionnaire d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="c07c8-128">[**GetExceptionCode**](getexceptioncode.md) can be used within the exception-handler block, but [**GetExceptionInformation**](getexceptioninformation.md) cannot because the information it points to is typically on the stack and is destroyed when control is transferred to an exception handler.</span></span> <span data-ttu-id="c07c8-129">Toutefois, une application peut copier les informations dans un stockage sécurisé pour les mettre à la disposition du gestionnaire d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="c07c8-129">However, an application can copy the information to safe storage to make it available to the exception handler.</span></span>

<span data-ttu-id="c07c8-130">L’avantage d’une fonction de filtre est qu’elle peut gérer une exception et retourner une valeur qui amène le système à continuer l’exécution à partir du point auquel l’exception s’est produite.</span><span class="sxs-lookup"><span data-stu-id="c07c8-130">The advantage of a filter function is that it can handle an exception and return a value that causes the system to continue execution from the point at which the exception occurred.</span></span> <span data-ttu-id="c07c8-131">Avec un bloc de gestionnaire d’exceptions, en revanche, l’exécution continue de manière séquentielle à partir du gestionnaire d’exceptions plutôt qu’à partir du point de l’exception.</span><span class="sxs-lookup"><span data-stu-id="c07c8-131">With an exception-handler block, in contrast, execution continues sequentially from the exception handler rather than from the point of the exception.</span></span>

<span data-ttu-id="c07c8-132">La gestion d’une exception peut être aussi simple qu’une erreur et la définition d’un indicateur qui sera examiné ultérieurement, en imprimant un message d’avertissement ou d’erreur, ou en effectuant une autre action limitée.</span><span class="sxs-lookup"><span data-stu-id="c07c8-132">Handling an exception may be as simple as noting an error and setting a flag that will be examined later, printing a warning or error message, or taking some other limited action.</span></span> <span data-ttu-id="c07c8-133">Si l’exécution peut être poursuivie, il peut également être nécessaire de modifier l’état de l’ordinateur en modifiant l’enregistrement de contexte.</span><span class="sxs-lookup"><span data-stu-id="c07c8-133">If execution can be continued, it may also be necessary to change the machine state by modifying the context record.</span></span> <span data-ttu-id="c07c8-134">Pour obtenir un exemple de fonction de filtre qui gère une exception de défaut de page, consultez [utilisation des fonctions de mémoire virtuelle](../memory/using-the-memory-management-functions.md).</span><span class="sxs-lookup"><span data-stu-id="c07c8-134">For an example of a filter function that handles a page fault exception, see [Using the Virtual Memory Functions](../memory/using-the-memory-management-functions.md).</span></span>

<span data-ttu-id="c07c8-135">La fonction [**UnhandledExceptionFilter**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-unhandledexceptionfilter) peut être utilisée comme fonction de filtre dans une expression de filtre.</span><span class="sxs-lookup"><span data-stu-id="c07c8-135">The [**UnhandledExceptionFilter**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-unhandledexceptionfilter) function can be used as a filter function in a filter expression.</span></span> <span data-ttu-id="c07c8-136">Elle retourne \_ \_ le gestionnaire d’exécution d’exception, sauf si le processus est en cours de débogage. dans ce cas, elle retourne l’exception \_ Continuer la \_ recherche.</span><span class="sxs-lookup"><span data-stu-id="c07c8-136">It returns EXCEPTION\_EXECUTE\_HANDLER unless the process is being debugged, in which case it returns EXCEPTION\_CONTINUE\_SEARCH.</span></span>

 

 
