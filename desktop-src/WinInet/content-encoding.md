---
title: Encodage du contenu
description: À compter de Windows Server 2008 et Windows Vista, l’application peut diriger WinINet pour effectuer le décodage de contenu pour les schémas d’encodage de contenu gzip et deflate.
ms.assetid: 136f22a6-e5ca-41c5-8651-6e132655d268
keywords:
- Encodage du contenu
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 09b089ae2aa4cbacdfc9b6ebefe5cbdfc1bfc10e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104031724"
---
# <a name="content-encoding"></a><span data-ttu-id="35cfc-104">Encodage du contenu</span><span class="sxs-lookup"><span data-stu-id="35cfc-104">Content Encoding</span></span>

<span data-ttu-id="35cfc-105">Comme spécifié dans les applications de protocole HTTP (RFC 2616) peuvent demander que le serveur retourne les réponses HTTP dans un format encodé.</span><span class="sxs-lookup"><span data-stu-id="35cfc-105">As specified in the HTTP protocol (RFC 2616) applications can request that the server return HTTP responses in encoded format.</span></span> <span data-ttu-id="35cfc-106">Avant Windows Server 2008 et Windows Vista, les demandes avec encodage de contenu étaient envoyées à l’application à des fins de traitement à leur niveau.</span><span class="sxs-lookup"><span data-stu-id="35cfc-106">Prior to Windows Server 2008 and Windows Vista, requests with content encoding were sent to the application for processing at their level.</span></span> <span data-ttu-id="35cfc-107">À compter de Windows Server 2008 et Windows Vista, l’application peut diriger WinINet pour effectuer le décodage de contenu pour les schémas d’encodage de contenu gzip et deflate.</span><span class="sxs-lookup"><span data-stu-id="35cfc-107">Starting in Windows Server 2008 and Windows Vista, the application can direct WinINet to perform content decoding for the gzip and deflate content encoding schemes.</span></span>

<span data-ttu-id="35cfc-108">Pour activer le décodage du contenu, l’application définit l’option de décodage demandant à ce que WinINet effectue le décodage en son nom.</span><span class="sxs-lookup"><span data-stu-id="35cfc-108">To enable content decoding, the application sets the decoding option requesting that WinINet perform decoding on their behalf.</span></span> <span data-ttu-id="35cfc-109">Toutefois, l’activation du décodage ne garantit pas que WinINet effectue le décodage du contenu et que l’application doit être préparée à gérer le décodage.</span><span class="sxs-lookup"><span data-stu-id="35cfc-109">However, enabling decoding does not guarantee that WinINet will perform content decoding, and the application should be prepared to handle decoding.</span></span> <span data-ttu-id="35cfc-110">WinINet supprime l’en-tête Content-Encoding de la réponse lorsque le décodage du contenu est correctement effectué.</span><span class="sxs-lookup"><span data-stu-id="35cfc-110">WinINet strips the content-encoding header from the response when content decoding is successfully performed.</span></span> <span data-ttu-id="35cfc-111">Les applications sont censées gérer le décodage du contenu, que l’option de décodage soit activée ou désactivée lorsque l’en-tête Content-Encoding est présent dans la réponse.</span><span class="sxs-lookup"><span data-stu-id="35cfc-111">Applications are expected to handle content decoding regardless of whether the decoding option is enabled or disabled when the content-encoding header is present in the response.</span></span>

<span data-ttu-id="35cfc-112">Lorsque le décodage est activé, l’application doit spécifier la liste des encodages pris en charge dans l’en-tête Accept-Encoding de la requête.</span><span class="sxs-lookup"><span data-stu-id="35cfc-112">When decoding is enabled, the application must specify the list of supported encodings in the Accept-Encoding header of the request.</span></span> <span data-ttu-id="35cfc-113">Toutefois, l’en-tête Accept-Encoding n’oblige pas le serveur à envoyer une réponse encodée.</span><span class="sxs-lookup"><span data-stu-id="35cfc-113">The Accept-Encoding header, however, does not obligate the server to send an encoded response.</span></span> <span data-ttu-id="35cfc-114">WinINet envoie les réponses qui ne correspondent pas à la liste des encodages acceptables à l’application.</span><span class="sxs-lookup"><span data-stu-id="35cfc-114">WinINet will send responses that do not match the list of acceptable encodings back to the application.</span></span>

<span data-ttu-id="35cfc-115">La liste suivante décrit les conditions dans lesquelles WinINet effectue le décodage du contenu lorsque l’option est activée :</span><span class="sxs-lookup"><span data-stu-id="35cfc-115">The following list describes the conditions under which WinINet will perform content decoding when the option is enabled:</span></span>

-   <span data-ttu-id="35cfc-116">L’en-tête Accept-Encoding doit être présent dans la demande et doit spécifier les schémas d’encodage gzip, deflate ou gzip et deflate.</span><span class="sxs-lookup"><span data-stu-id="35cfc-116">The Accept-Encoding header must be present in the request, and it must specify the gzip, deflate, or both gzip and deflate encoding schemes.</span></span>
-   <span data-ttu-id="35cfc-117">Le schéma d’encodage spécifié dans l’en-tête Content-Encoding doit correspondre à l’un des schémas d’encodage spécifiés dans l’en-tête Accept-Encoding.</span><span class="sxs-lookup"><span data-stu-id="35cfc-117">The encoding scheme specified in the Content-Encoding header must match one of the encoding schemes specified in the Accept-Encoding header.</span></span>
-   <span data-ttu-id="35cfc-118">L’en-tête Content-Encoding dans la réponse spécifie un seul schéma d’encodage.</span><span class="sxs-lookup"><span data-stu-id="35cfc-118">The Content-Encoding header in the response specifies only one encoding scheme.</span></span>
-   <span data-ttu-id="35cfc-119">La réponse ne doit contenir qu’un seul en-tête Content-Encoding.</span><span class="sxs-lookup"><span data-stu-id="35cfc-119">The response must contain only one Content- Encoding header.</span></span> <span data-ttu-id="35cfc-120">WinINet décode le contenu encodé avec un seul schéma d’encodage.</span><span class="sxs-lookup"><span data-stu-id="35cfc-120">WinINet decodes content that is encoded with only one encoding scheme.</span></span>
-   <span data-ttu-id="35cfc-121">L’en-tête Cache-Control ne doit pas contenir la directive no-Transform.</span><span class="sxs-lookup"><span data-stu-id="35cfc-121">The Cache-Control header must not contain the no-transform directive.</span></span>
-   <span data-ttu-id="35cfc-122">L’en-tête Content-Range ne doit pas être présent dans la réponse.</span><span class="sxs-lookup"><span data-stu-id="35cfc-122">The Content-Range header must not be present in the response.</span></span>

## <a name="setting-the-decompression-option"></a><span data-ttu-id="35cfc-123">Définition de l’option de décompression</span><span class="sxs-lookup"><span data-stu-id="35cfc-123">Setting the Decompression Option</span></span>

<span data-ttu-id="35cfc-124">L’option de décodage peut être définie sur le descripteur de session, le handle de demande ou le handle de connexion.</span><span class="sxs-lookup"><span data-stu-id="35cfc-124">The decoding option can be set on the session handle, the request handle or the connection handle.</span></span> <span data-ttu-id="35cfc-125">Handle sur lequel l’option de décodage est définie, définit la portée de l’option de décodage.</span><span class="sxs-lookup"><span data-stu-id="35cfc-125">The handle on which the decoding option is set, defines the scope of the decoding option.</span></span> <span data-ttu-id="35cfc-126">Par exemple, la définition du décodage sur la session permet de décoder une partie des connexions et des demandes créées sous ce descripteur.</span><span class="sxs-lookup"><span data-stu-id="35cfc-126">For example, setting decoding on the session will enable decoding an all connections and requests created under that handle.</span></span>

<span data-ttu-id="35cfc-127">Pour définir l’option de décodage, l’application appelle [**InternetSetOption**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) avec le descripteur retourné par [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena), [**internetconnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta)ou [**HttpOpenRequest**](/windows/desktop/api/Wininet/nf-wininet-httpopenrequesta).</span><span class="sxs-lookup"><span data-stu-id="35cfc-127">To set the decoding option, the application calls [**InternetSetOption**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) with the handle returned from [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena), [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta), or [**HttpOpenRequest**](/windows/desktop/api/Wininet/nf-wininet-httpopenrequesta).</span></span> <span data-ttu-id="35cfc-128">L’option **Internet \_ encodage \_ http \_** est spécifiée dans le paramètre *valeur dwOption* et le paramètre *lpBuffer* pointe vers une variable booléenne définie sur true.</span><span class="sxs-lookup"><span data-stu-id="35cfc-128">The **INTERNET\_OPTION\_HTTP\_DECODING** option is specified in the *dwOption* parameter, and the *lpBuffer* parameter points to a boolean variable set to true.</span></span> <span data-ttu-id="35cfc-129">Pour désactiver le décodage, l’application appelle **InternetSetOption** avec l’option **Internet \_ \_ \_ décodage http** et la variable booléenne définie sur false.</span><span class="sxs-lookup"><span data-stu-id="35cfc-129">To disable decoding, the application calls **InternetSetOption** with the **INTERNET\_OPTION\_HTTP\_DECODING** option and the boolean variable set to false.</span></span>

<span data-ttu-id="35cfc-130">Lorsque l’option de décodage est définie, WinINet effectue le décodage sur la demande lorsque l’application appelle [**InternetReadFile**](/windows/desktop/api/Wininet/nf-wininet-internetreadfile).</span><span class="sxs-lookup"><span data-stu-id="35cfc-130">When the decoding option is set, WinINet performs decoding on the request when the application calls [**InternetReadFile**](/windows/desktop/api/Wininet/nf-wininet-internetreadfile).</span></span> <span data-ttu-id="35cfc-131">Si WinINet rencontre une erreur lors du décodage du contenu, l’appel à **InternetReadFile** échoue avec une **erreur le \_ \_ décodage Internet \_ a échoué**.</span><span class="sxs-lookup"><span data-stu-id="35cfc-131">If WinINet encounters an error while performing content decoding, the call to **InternetReadFile** fails with an **ERROR\_INTERNET\_DECODING\_FAILED**.</span></span> <span data-ttu-id="35cfc-132">Lorsque le décodage échoue, l’application dispose de deux options : elle peut supprimer l’en-tête Accept-Encoding et renvoyer la demande, ou il peut définir l’option **Internet \_ \_ \_ décodage http** de la demande sur false, puis renvoyer la demande.</span><span class="sxs-lookup"><span data-stu-id="35cfc-132">When decoding fails, the application has two options: it can remove the Accept-Encoding header and resend the request, or it can set the **INTERNET\_OPTION\_HTTP\_DECODING** option on the request to false and then resend the request.</span></span> <span data-ttu-id="35cfc-133">Si l’option de décodage est définie sur false, l’application doit vérifier l’en-tête Content-Encoding et effectuer tout décodage au niveau de l’application.</span><span class="sxs-lookup"><span data-stu-id="35cfc-133">If the decoding option is set to false, the application must check the Content-Encoding header and perform any decoding at the application level.</span></span>

> [!Note]  
> <span data-ttu-id="35cfc-134">WinINet ne prend pas en charge les implémentations de serveur.</span><span class="sxs-lookup"><span data-stu-id="35cfc-134">WinINet does not support server implementations.</span></span> <span data-ttu-id="35cfc-135">En outre, il ne doit pas être utilisé à partir d’un service.</span><span class="sxs-lookup"><span data-stu-id="35cfc-135">In addition, it should not be used from a service.</span></span> <span data-ttu-id="35cfc-136">Pour les implémentations de serveur ou les services, utilisez les [services http Microsoft Windows (WinHTTP)](/windows/desktop/WinHttp/winhttp-start-page).</span><span class="sxs-lookup"><span data-stu-id="35cfc-136">For server implementations or services use [Microsoft Windows HTTP Services (WinHTTP)](/windows/desktop/WinHttp/winhttp-start-page).</span></span>

 

 

 