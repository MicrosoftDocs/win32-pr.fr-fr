---
description: Les mappages de déplacement sont similaires aux cartes de texture, mais sont accessibles par le moteur de vertex.
ms.assetid: d6f16ff2-5a66-48a3-82c4-523faaafa6ae
title: Mappage de déplacement (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b687583b0109223d8c2dac807425e235ddf280e4
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104482080"
---
# <a name="displacement-mapping-direct3d-9"></a><span data-ttu-id="ec82a-103">Mappage de déplacement (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="ec82a-103">Displacement Mapping (Direct3D 9)</span></span>

<span data-ttu-id="ec82a-104">Les mappages de déplacement sont similaires aux cartes de texture, mais sont accessibles par le moteur de vertex.</span><span class="sxs-lookup"><span data-stu-id="ec82a-104">Displacement maps are similar to texture maps but are accessed by the vertex engine.</span></span>

## <a name="block-diagram"></a><span data-ttu-id="ec82a-105">Diagramme de blocs</span><span class="sxs-lookup"><span data-stu-id="ec82a-105">Block Diagram</span></span>

<span data-ttu-id="ec82a-106">Une étape supplémentaire de l’échantillonneur est présente dans la partie précoce du canal de vertex, comme illustré dans le diagramme suivant, qui peut échantillonner un mappage de déplacement pour fournir des données de déplacement de vertex.</span><span class="sxs-lookup"><span data-stu-id="ec82a-106">An additional sampler stage is present in the early part of the vertex pipe, as shown in the following diagram, which can sample a displacement map to provide vertex displacement data.</span></span>

![diagramme de l’étape de l’échantillonneur dans le canal de vertex](images/tessellatordx9.png)

<span data-ttu-id="ec82a-108">L’état de l’échantillonneur de mappage de décalage peut être défini par [**SetSamplerState**](/windows/desktop/api) à l’aide du numéro de phase 256, qui est un nouveau numéro de phase.</span><span class="sxs-lookup"><span data-stu-id="ec82a-108">The displacement map sampler state can be set by the [**SetSamplerState**](/windows/desktop/api) using stage number 256, which is a new stage number.</span></span> <span data-ttu-id="ec82a-109">La texture de la carte de déplacement est définie par [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).</span><span class="sxs-lookup"><span data-stu-id="ec82a-109">The displacement map texture is set by [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).</span></span>

<span data-ttu-id="ec82a-110">La carte peut être prééchantillonnée ou non, ce qui signifie qu’elle peut être classée de façon à permettre la recherche des valeurs de déplacement sans filtrage.</span><span class="sxs-lookup"><span data-stu-id="ec82a-110">The map can be presampled or not, which means that it can be ordered in a way that enables the lookup of the displacement values without filtering.</span></span>

-   <span data-ttu-id="ec82a-111">Les mappages de déplacements sont analogues aux cartes de texture, mais sont accessibles par le moteur de vertex.</span><span class="sxs-lookup"><span data-stu-id="ec82a-111">Displacement maps are analogous to texture maps but are accessed by the vertex engine.</span></span>
-   <span data-ttu-id="ec82a-112">Une étape supplémentaire de l’échantillonneur est présente dans la partie précoce du canal de vertex qui peut échantillonner un mappage de déplacement.</span><span class="sxs-lookup"><span data-stu-id="ec82a-112">An additional sampler stage is present in the early part of the vertex pipe that can sample a displacement map.</span></span> <span data-ttu-id="ec82a-113">Cette étape est accessible par l’API SetSamplerState habituelle, mais le numéro intermédiaire est D3DDMAPSAMPLER = 256.</span><span class="sxs-lookup"><span data-stu-id="ec82a-113">This stage is accessed by the usual SetSamplerState API but the stage number is D3DDMAPSAMPLER = 256.</span></span>
-   <span data-ttu-id="ec82a-114">L’état de l’échantillonneur de mappage de décalage peut être défini par SetSamplerState (D3DDMAPSAMPLER,...) MobileVBActiveX.</span><span class="sxs-lookup"><span data-stu-id="ec82a-114">The displacement map sampler state can be set by the SetSamplerState(D3DDMAPSAMPLER, ...) API.</span></span>
-   <span data-ttu-id="ec82a-115">La texture de la carte de déplacement est définie par l’API SetTexture (D3DDMAPSAMPLER, texture).</span><span class="sxs-lookup"><span data-stu-id="ec82a-115">The displacement map texture is set by the SetTexture(D3DDMAPSAMPLER, texture) API.</span></span>
-   <span data-ttu-id="ec82a-116">La carte peut être prééchantillonnée ou non.</span><span class="sxs-lookup"><span data-stu-id="ec82a-116">The map can be pre-sampled or not.</span></span> <span data-ttu-id="ec82a-117">Cela signifie qu’elle peut être ordonnée d’une manière particulière qui permet la recherche des valeurs de déplacement sans filtrage.</span><span class="sxs-lookup"><span data-stu-id="ec82a-117">This means that it can be ordered in a particular way that enables the lookup of the displacement values without filtering.</span></span>
-   <span data-ttu-id="ec82a-118">Les modifications apportées à la structure de la déclaration autorisent la spécification de la coordonnée de texture utilisée pour rechercher la carte de texture.</span><span class="sxs-lookup"><span data-stu-id="ec82a-118">The changes in the declaration structure allow the specification of the texture coordinate used to look up the texture map.</span></span> <span data-ttu-id="ec82a-119">Par exemple, Stream0, offset, FLOAT2, LOOKUP, valeur de déplacement \_ .</span><span class="sxs-lookup"><span data-stu-id="ec82a-119">For example, Stream0, Offset, FLOAT2, LOOKUP, Displacement\_value.</span></span> <span data-ttu-id="ec82a-120">Cela indique à du paveur d’utiliser le vecteur de virgule flottante 2D dans stream0 à un certain décalage comme une coordonnée de texture pour rechercher la carte de décalage et associer la \_ sémantique d’utilisation de la valeur de remplacement à celle-ci.</span><span class="sxs-lookup"><span data-stu-id="ec82a-120">This tells the tessellator to use the 2D float vector in stream0 at a certain offset as a texture coordinate to look up the displacement map and associate the Displacement\_value usage semantic to it.</span></span> <span data-ttu-id="ec82a-121">La déclaration du nuanceur de sommets contient une ligne similaire à {DCL \_ Texture0, V0} indiquant que la sémantique Texture0 doit être associée au registre d’entrée v0.</span><span class="sxs-lookup"><span data-stu-id="ec82a-121">The vertex shader declaration would contain a line similar to {dcl\_texture0, v0} indicating that the texture0 semantic is to be associated with the v0 input register.</span></span> <span data-ttu-id="ec82a-122">La valeur de déplacement recherchée est copiée dans le registre d’entrée v0.</span><span class="sxs-lookup"><span data-stu-id="ec82a-122">The displacement value looked up is copied into input register v0.</span></span>
-   <span data-ttu-id="ec82a-123">Il existe un type spécial de mappage de déplacement, lorsque la carte de texture est prééchantillonnée.</span><span class="sxs-lookup"><span data-stu-id="ec82a-123">There is a special type of displacement mapping, when the texture map is pre-sampled.</span></span> <span data-ttu-id="ec82a-124">L’index séquentiel des vertex générés est utilisé comme coordonnée de texture sur une carte de texture.</span><span class="sxs-lookup"><span data-stu-id="ec82a-124">Sequential index of generated vertices is used as a texture coordinate to a texture map.</span></span> <span data-ttu-id="ec82a-125">Par exemple, 0, 0, (D3DDECLTYPE) 0, D3DDECLMETHOD \_ LOOKUPPRESAMPLED, usage, UsageIndex.</span><span class="sxs-lookup"><span data-stu-id="ec82a-125">For example, 0,0,(D3DDECLTYPE)0,D3DDECLMETHOD\_LOOKUPPRESAMPLED, Usage, UsageIndex.</span></span>
-   <span data-ttu-id="ec82a-126">La sortie de la recherche est de 4 valeurs à virgule flottante.</span><span class="sxs-lookup"><span data-stu-id="ec82a-126">The output of the lookup is 4 floats.</span></span>
-   <span data-ttu-id="ec82a-127">Le mappage de déplacement est pris en charge uniquement avec N-patchs.</span><span class="sxs-lookup"><span data-stu-id="ec82a-127">Displacement mapping is supported only with N-patches.</span></span>
-   <span data-ttu-id="ec82a-128">Les pilotes doivent ignorer D3DDMAPSAMPLER dans SetTextureStageState s’ils ne gèrent pas les mappages de déplacement.</span><span class="sxs-lookup"><span data-stu-id="ec82a-128">Drivers need to ignore D3DDMAPSAMPLER in SetTextureStageState if they do not handle displacement maps.</span></span>
-   <span data-ttu-id="ec82a-129">Le \_ mode de filtre anisotrope D3DTEXF n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="ec82a-129">D3DTEXF\_ANISOTROPIC filter mode is not supported.</span></span>
-   <span data-ttu-id="ec82a-130">Lorsque D3DSAMP \_ MIPFILTER dans l’échantillonneur de mappage de déplacement n’est pas D3DTEXF \_ aucun, le niveau de détail est calculé comme suit (Notez que l’état de pavage adaptatif est utilisé même si le D3DRS \_ ENABLEADAPTIVETESSELLATION est **false**) : Tmax = état de rendu D3DRS \_ MAXTESSELLATIONLEVEL</span><span class="sxs-lookup"><span data-stu-id="ec82a-130">When D3DSAMP\_MIPFILTER in the displacement map sampler is not D3DTEXF\_NONE, the level of detail is computed as follows (Note that the adaptive tessellation state is used even if the D3DRS\_ENABLEADAPTIVETESSELLATION is **FALSE**): Tmax = render state D3DRS\_MAXTESSELLATIONLEVEL</span></span>
-   <span data-ttu-id="ec82a-131">Calculer le niveau de pavage pour un vertex VI : (XI, Yi, ZI) de la même façon que décrit dans la section « pavage adaptative ».</span><span class="sxs-lookup"><span data-stu-id="ec82a-131">Compute tessellation level Te for a vertex Vi: (Xi, Yi, Zi) the same way as described in the "Adaptive tessellation" section.</span></span> <span data-ttu-id="ec82a-132">Niveau de détail L = Log2 (Tmax)-Log2 (te).</span><span class="sxs-lookup"><span data-stu-id="ec82a-132">Level of detail L = log2(Tmax) - log2 (Te).</span></span>
-   <span data-ttu-id="ec82a-133">Les opérations de filtrage et d’échantillonnage de texture suivent les mêmes règles que le pipeline de pixel (le niveau de détail (LOD) est appliqué, etc.).</span><span class="sxs-lookup"><span data-stu-id="ec82a-133">Texture filtering and sampling operations follow the same rules as the pixel pipeline (level of detail (LOD) bias is applied, etc.).</span></span>
-   <span data-ttu-id="ec82a-134">Tous les formats ne peuvent pas être utilisés comme mappages de déplacement, mais uniquement ceux qui prennent en charge le \_ DMAP D3DUSAGE.</span><span class="sxs-lookup"><span data-stu-id="ec82a-134">Not all formats can be used as displacement maps but only those that support the D3DUSAGE\_DMAP.</span></span> <span data-ttu-id="ec82a-135">L’application peut interroger avec le [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat)CheckDeviceFormat.</span><span class="sxs-lookup"><span data-stu-id="ec82a-135">The application can query that with the CheckDeviceFormat [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat).</span></span>
-   <span data-ttu-id="ec82a-136">D3DUSAGE \_ DMAP doit être spécifié dans [**CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) pour indiquer au pilote que cette texture doit être utilisée comme mappage de déplacement.</span><span class="sxs-lookup"><span data-stu-id="ec82a-136">D3DUSAGE\_DMAP must be specified in [**CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) to notify the driver that this texture is to be used as a displacement map.</span></span>
-   <span data-ttu-id="ec82a-137">D3DUSAGE \_ DMAP peut uniquement être utilisé avec des textures.</span><span class="sxs-lookup"><span data-stu-id="ec82a-137">D3DUSAGE\_DMAP can only be used with textures.</span></span> <span data-ttu-id="ec82a-138">Elle ne peut pas être utilisée avec des mappages ou des volumes de cube.</span><span class="sxs-lookup"><span data-stu-id="ec82a-138">It cannot be used with cube maps or volumes.</span></span>
-   <span data-ttu-id="ec82a-139">Les textures et les cibles de rendu créées avec D3DUSAGE \_ DMAP peuvent être définies au niveau des étapes d’échantillonnage normales et en tant que cibles de rendu.</span><span class="sxs-lookup"><span data-stu-id="ec82a-139">Textures and render targets created with D3DUSAGE\_DMAP can be set at regular sampler stages and as render targets.</span></span>
-   <span data-ttu-id="ec82a-140">Les États de rendu permettant de définir le mode de renvoi à la ligne pour les coordonnées de texture sont ignorés dans le mappage de déplacement.</span><span class="sxs-lookup"><span data-stu-id="ec82a-140">The render states to set the wrap mode for the texture coordinates are ignored in displacement mapping.</span></span> <span data-ttu-id="ec82a-141">En général, il n’y a pas de mode de retour à la ligne pour le moteur du paveur.</span><span class="sxs-lookup"><span data-stu-id="ec82a-141">In general, there are no wrap modes for the tessellator engine.</span></span>
-   <span data-ttu-id="ec82a-142">Un échantillonneur de mappage de déplacement a un comportement identique à celui des échantillonneurs de texture de pixels.</span><span class="sxs-lookup"><span data-stu-id="ec82a-142">A displacement map sampler has behavior identical to that of the pixel texture samplers.</span></span> <span data-ttu-id="ec82a-143">Si une texture avec moins de quatre canaux (comme R32f) est recherchée, les valeurs recherchées sont dirigées vers les canaux appropriés du registre de destination (le registre d’entrée du nuanceur de sommets marqué avec l' \_ exemple de sémantique), tandis que les autres canaux ont par défaut la valeur (1, 1, 1).</span><span class="sxs-lookup"><span data-stu-id="ec82a-143">If a texture with less than four channels (like R32f) is looked up, the looked-up values go to the appropriate channels of the destination register (the vertex shader input register tagged with the \_sample semantic), while the other channels default to (1, 1, 1).</span></span> <span data-ttu-id="ec82a-144">Lors de \_ la recherche, D3DFMT N8 est diffusé dans les canaux R, G, B et A une valeur par défaut de 1.</span><span class="sxs-lookup"><span data-stu-id="ec82a-144">When looked up, D3DFMT\_L8 gets broadcast into the R, G, B channels and A defaults to 1.</span></span> <span data-ttu-id="ec82a-145">Le rastériseur de référence contient les détails de l’implémentation complète.</span><span class="sxs-lookup"><span data-stu-id="ec82a-145">The reference rasterizer has the full implementation details.</span></span>

## <a name="pre-sampled-displacement-mapping"></a><span data-ttu-id="ec82a-146">Mappage de déplacement pré-échantillonné</span><span class="sxs-lookup"><span data-stu-id="ec82a-146">Pre-Sampled Displacement Mapping</span></span>

-   <span data-ttu-id="ec82a-147">Nouvel état de l’échantillonneur introduit : D3DSAMP \_ DMAPOFFSET (DWORD)-offset (en vertex) dans un mappage de déplacement pré-échantillonné.</span><span class="sxs-lookup"><span data-stu-id="ec82a-147">New sampler state is introduced: D3DSAMP\_DMAPOFFSET (DWORD) - offset (in vertices) in a pre-sampled displacement map.</span></span>
-   <span data-ttu-id="ec82a-148">Nouvelle méthode de déclaration introduite : D3DDECLMETHOD \_ LOOKUPPRESAMPLED.</span><span class="sxs-lookup"><span data-stu-id="ec82a-148">New declaration method is introduced: D3DDECLMETHOD\_LOOKUPPRESAMPLED.</span></span>
-   <span data-ttu-id="ec82a-149">Le pavage adaptatif doit être désactivé.</span><span class="sxs-lookup"><span data-stu-id="ec82a-149">Adaptive tessellation should be disabled.</span></span>
-   <span data-ttu-id="ec82a-150">Les paramètres de filtre de texture sont ignorés.</span><span class="sxs-lookup"><span data-stu-id="ec82a-150">Texture filter settings are ignored.</span></span> <span data-ttu-id="ec82a-151">L’échantillonnage des points est effectué.</span><span class="sxs-lookup"><span data-stu-id="ec82a-151">Point sampling is done.</span></span> <span data-ttu-id="ec82a-152">Le filtre de texture MIP est supposé être D3DTEXF \_ aucun.</span><span class="sxs-lookup"><span data-stu-id="ec82a-152">The mip texture filter is assumed to be D3DTEXF\_NONE.</span></span> <span data-ttu-id="ec82a-153">Tous les autres modes de filtre de texture sont supposés être D3DTEXF \_ point.</span><span class="sxs-lookup"><span data-stu-id="ec82a-153">All other texture filter modes are assumed to be D3DTEXF\_POINT.</span></span>
-   <span data-ttu-id="ec82a-154">Les coordonnées de la texture sont calculées comme suit : U = (index% TextureWidthInPixeles)/(float) (TextureWidthInPixeles) V = (index/TextureWidthInPixeles)/(float) (TextureHeightInPixeles), où index est un index séquentiel des vertex générés plus TSS D3DSAMP DMAPOFFSET \[ \_ \] .</span><span class="sxs-lookup"><span data-stu-id="ec82a-154">Texture coordinates are computed as: U = (Index % TextureWidthInPixeles) / (float)(TextureWidthInPixeles) V = (Index / TextureWidthInPixeles) / (float)(TextureHeightInPixeles) where Index is a sequential index of generated vertices plus TSS\[D3DSAMP\_DMAPOFFSET\].</span></span> <span data-ttu-id="ec82a-155">L’index séquentiel est défini à zéro au début de chaque primitive et est augmenté après la génération d’un vertex.</span><span class="sxs-lookup"><span data-stu-id="ec82a-155">The sequential index is set to zero at the start of each primitive and is increased after a vertex is generated.</span></span>

<span data-ttu-id="ec82a-156">Il s’agit des modifications d’API qui prennent en charge le mappage de déplacement.</span><span class="sxs-lookup"><span data-stu-id="ec82a-156">These are the API changes that support displacement mapping.</span></span>

-   <span data-ttu-id="ec82a-157">Un format de canal unique ajouté, D3DFMT \_ L16.</span><span class="sxs-lookup"><span data-stu-id="ec82a-157">A single channel format added, D3DFMT\_L16.</span></span>
-   <span data-ttu-id="ec82a-158">Un nouvel indicateur d’utilisation, D3DUSAGE \_ DMAP.</span><span class="sxs-lookup"><span data-stu-id="ec82a-158">A new usage flag, D3DUSAGE\_DMAP.</span></span>
-   <span data-ttu-id="ec82a-159">Étape de texture spéciale, utilisée pour définir une texture de mappage de déplacement, D3DDMAPSAMPLER.</span><span class="sxs-lookup"><span data-stu-id="ec82a-159">A special texture stage, used to set a displacement map texture, D3DDMAPSAMPLER.</span></span>
-   <span data-ttu-id="ec82a-160">De nouvelles extrémités matérielles ont été ajoutées, D3DDEVCAPS2 \_ DMAPNPATCH et D3DDEVCAPS2 \_ PRESAMPLEDDMAPNPATCH.</span><span class="sxs-lookup"><span data-stu-id="ec82a-160">New hardware caps have been added, D3DDEVCAPS2\_DMAPNPATCH and D3DDEVCAPS2\_PRESAMPLEDDMAPNPATCH.</span></span> <span data-ttu-id="ec82a-161">Consultez [D3DDEVCAPS2](d3ddevcaps2.md).</span><span class="sxs-lookup"><span data-stu-id="ec82a-161">See [D3DDEVCAPS2](d3ddevcaps2.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="ec82a-162">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="ec82a-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ec82a-163">Pipeline de vertex</span><span class="sxs-lookup"><span data-stu-id="ec82a-163">Vertex Pipeline</span></span>](vertex-pipeline.md)
</dt> </dl>

 

 
