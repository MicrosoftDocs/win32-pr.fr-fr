---
description: 'Vous pouvez accéder directement à la mémoire de surface à l’aide de la méthode IDirect3DSurface9 :: LockRect.'
ms.assetid: ad669c22-6163-4fbb-bad0-160ced5bc558
title: Accès direct à la mémoire de surface (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e7ed9a65265671e6509172eccd9a1b66ea91507f
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104317865"
---
# <a name="accessing-surface-memory-directly-direct3d-9"></a><span data-ttu-id="e070a-103">Accès direct à la mémoire de surface (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="e070a-103">Accessing Surface Memory Directly (Direct3D 9)</span></span>

<span data-ttu-id="e070a-104">Vous pouvez accéder directement à la mémoire de surface à l’aide de la méthode [**IDirect3DSurface9 :: LockRect**](/windows/desktop/api) .</span><span class="sxs-lookup"><span data-stu-id="e070a-104">You can directly access the surface memory by using the [**IDirect3DSurface9::LockRect**](/windows/desktop/api) method.</span></span> <span data-ttu-id="e070a-105">Quand vous appelez cette méthode, le paramètre pRect est un pointeur vers une structure [**Rect**](/previous-versions//dd162897(v=vs.85)) qui décrit le rectangle sur la surface auquel accéder directement.</span><span class="sxs-lookup"><span data-stu-id="e070a-105">When you call this method, the pRect parameter is a pointer to a [**RECT**](/previous-versions//dd162897(v=vs.85)) structure that describes the rectangle on the surface to access directly.</span></span> <span data-ttu-id="e070a-106">Pour demander que la surface entière soit verrouillée, affectez à pRect la **valeur null**.</span><span class="sxs-lookup"><span data-stu-id="e070a-106">To request that the entire surface be locked, set pRect to **NULL**.</span></span> <span data-ttu-id="e070a-107">En outre, vous pouvez spécifier un **Rect** qui couvre uniquement une partie de la surface.</span><span class="sxs-lookup"><span data-stu-id="e070a-107">Also, you can specify a **RECT** that covers only a portion of the surface.</span></span> <span data-ttu-id="e070a-108">Si deux rectangles ne se chevauchent pas, deux threads ou processus peuvent verrouiller simultanément plusieurs rectangles dans une surface.</span><span class="sxs-lookup"><span data-stu-id="e070a-108">Providing that no two rectangles overlap, two threads or processes can simultaneously lock multiple rectangles in a surface.</span></span> <span data-ttu-id="e070a-109">Notez qu’un tampon d’arrière-plan à échantillonnage ne peut pas être verrouillé.</span><span class="sxs-lookup"><span data-stu-id="e070a-109">Note that a multisample back buffer cannot be locked.</span></span>

<span data-ttu-id="e070a-110">La méthode [**IDirect3DSurface9 :: LockRect**](/windows/desktop/api) remplit une structure [**\_ Rect D3DLOCKED**](d3dlocked-rect.md) avec toutes les informations pour accéder correctement à la mémoire de l’aire.</span><span class="sxs-lookup"><span data-stu-id="e070a-110">The [**IDirect3DSurface9::LockRect**](/windows/desktop/api) method fills a [**D3DLOCKED\_RECT**](d3dlocked-rect.md) structure with all the information to properly access the surface memory.</span></span> <span data-ttu-id="e070a-111">La structure inclut des informations sur le pas à pas et a un pointeur vers les bits verrouillés.</span><span class="sxs-lookup"><span data-stu-id="e070a-111">The structure includes information about the pitch and has a pointer to the locked bits.</span></span> <span data-ttu-id="e070a-112">Lorsque vous avez terminé d’accéder à la mémoire d’exposition, appelez la méthode [**IDirect3DSurface9 :: UnlockRect**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dsurface9-unlockrect) pour la déverrouiller.</span><span class="sxs-lookup"><span data-stu-id="e070a-112">When you finish accessing the surface memory, call the [**IDirect3DSurface9::UnlockRect**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dsurface9-unlockrect) method to unlock it.</span></span>

<span data-ttu-id="e070a-113">Si une surface est verrouillée, vous pouvez manipuler directement son contenu.</span><span class="sxs-lookup"><span data-stu-id="e070a-113">While you have a surface locked, you can directly manipulate the contents.</span></span> <span data-ttu-id="e070a-114">La liste suivante décrit quelques conseils pour éviter les problèmes courants liés au rendu direct de la mémoire de surface.</span><span class="sxs-lookup"><span data-stu-id="e070a-114">The following list describes some tips for avoiding common problems with directly rendering surface memory.</span></span>

-   <span data-ttu-id="e070a-115">Ne jamais supposer une tonalité d’affichage constante.</span><span class="sxs-lookup"><span data-stu-id="e070a-115">Never assume a constant display pitch.</span></span> <span data-ttu-id="e070a-116">Examinez toujours les informations de pas retournées par la méthode [**IDirect3DSurface9 :: LockRect**](/windows/desktop/api) .</span><span class="sxs-lookup"><span data-stu-id="e070a-116">Always examine the pitch information returned by the [**IDirect3DSurface9::LockRect**](/windows/desktop/api) method.</span></span> <span data-ttu-id="e070a-117">Ce pas à pas peut varier pour plusieurs raisons, notamment l’emplacement de la mémoire d’exposition, le type de carte d’affichage ou même la version du pilote Direct3D.</span><span class="sxs-lookup"><span data-stu-id="e070a-117">This pitch can vary for a number of reasons, including the location of the surface memory, the display card type, or even the version of the Direct3D driver.</span></span> <span data-ttu-id="e070a-118">Pour plus d’informations, consultez [largeur et tangage (Direct3D 9)](width-vs--pitch.md).</span><span class="sxs-lookup"><span data-stu-id="e070a-118">For more information, see [Width vs. Pitch (Direct3D 9)](width-vs--pitch.md).</span></span>
-   <span data-ttu-id="e070a-119">Veillez à copier les surfaces déverrouillées.</span><span class="sxs-lookup"><span data-stu-id="e070a-119">Make certain you copy to unlocked surfaces.</span></span> <span data-ttu-id="e070a-120">Les méthodes de copie Direct3D échouent si elles sont appelées sur une surface verrouillée.</span><span class="sxs-lookup"><span data-stu-id="e070a-120">Direct3D copy methods will fail if called on a locked surface.</span></span>
-   <span data-ttu-id="e070a-121">Limitez l’activité de votre application lorsqu’une surface est verrouillée.</span><span class="sxs-lookup"><span data-stu-id="e070a-121">Limit your application's activity while a surface is locked.</span></span>
-   <span data-ttu-id="e070a-122">Toujours copier les données alignées pour afficher la mémoire.</span><span class="sxs-lookup"><span data-stu-id="e070a-122">Always copy data aligned to display memory.</span></span> <span data-ttu-id="e070a-123">Windows 98 utilise un gestionnaire d’erreurs de page, Vflatd. 386, pour implémenter une mémoire tampon d’image plate virtuelle pour les cartes d’affichage avec mémoire commutée.</span><span class="sxs-lookup"><span data-stu-id="e070a-123">Windows 98 uses a page fault handler, Vflatd.386, to implement a virtual flat-frame buffer for display cards with bank-switched memory.</span></span> <span data-ttu-id="e070a-124">Le gestionnaire permet à ces appareils d’affichage de présenter une mémoire tampon de trame linéaire à Direct3D.</span><span class="sxs-lookup"><span data-stu-id="e070a-124">The handler allows these display devices to present a linear frame buffer to Direct3D.</span></span> <span data-ttu-id="e070a-125">La copie de données non alignées sur la mémoire d’affichage peut entraîner l’interruption des opérations par le système si la copie s’étend sur des banques de mémoire.</span><span class="sxs-lookup"><span data-stu-id="e070a-125">Copying data unaligned to display memory can cause the system to suspend operations if the copy spans memory banks.</span></span>
-   <span data-ttu-id="e070a-126">Une surface peut ne pas être verrouillée si elle appartient à une ressource affectée au \_ pool de mémoire D3DPOOL par défaut, sauf s’il s’agit d’une texture dynamique ou d’une surface créée à l’aide de [**IDirect3DDevice9 :: CreateOffscreenPlainSurface**](/windows/desktop/api).</span><span class="sxs-lookup"><span data-stu-id="e070a-126">A surface may not be locked if it belongs to a resource assigned to the D3DPOOL\_DEFAULT memory pool unless it is a dynamic texture or a surface created using [**IDirect3DDevice9::CreateOffscreenPlainSurface**](/windows/desktop/api).</span></span> <span data-ttu-id="e070a-127">Les surfaces de mémoire tampon d’arrière-plan, accessibles à l’aide des méthodes [**IDirect3DDevice9 :: GetBackBuffer**](/windows/desktop/api) et [**IDirect3DSwapChain9 :: GetBackBuffer**](/windows/desktop/api) , peuvent être verrouillées uniquement si la chaîne de permutation a été créée avec le membre Flags des [**\_ paramètres D3DPRESENT**](d3dpresent-parameters.md) pour inclure la mémoire tampon d’arrière-plan D3DPRESENTFLAG \_ verrouillable \_ .</span><span class="sxs-lookup"><span data-stu-id="e070a-127">Back buffer surfaces, which may be accessed using the [**IDirect3DDevice9::GetBackBuffer**](/windows/desktop/api) and [**IDirect3DSwapChain9::GetBackBuffer**](/windows/desktop/api) methods, may be locked only if the swap chain was created with the Flags member of [**D3DPRESENT\_PARAMETERS**](d3dpresent-parameters.md) to include D3DPRESENTFLAG\_LOCKABLE\_BACKBUFFER.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e070a-128">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="e070a-128">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e070a-129">Surfaces Direct3D</span><span class="sxs-lookup"><span data-stu-id="e070a-129">Direct3D Surfaces</span></span>](direct3d-surfaces.md)
</dt> </dl>

 

 
