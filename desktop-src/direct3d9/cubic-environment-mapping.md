---
description: Les cartes d’environnement cubiques, parfois appelées « mappages de cube », sont des textures qui contiennent des données d’image représentant la scène entourant un objet, comme si l’objet était au centre d’un cube.
ms.assetid: 4879d59b-e6d3-4811-ab2c-bcce8f214e1c
title: Mappage d’environnement cubique (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cecac83db067224195883485bcbd282aa82ae4b5
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104393211"
---
# <a name="cubic-environment-mapping-direct3d-9"></a><span data-ttu-id="214ee-103">Mappage d’environnement cubique (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="214ee-103">Cubic Environment Mapping (Direct3D 9)</span></span>

<span data-ttu-id="214ee-104">Les cartes d’environnement cubiques, parfois appelées « mappages de cube », sont des textures qui contiennent des données d’image représentant la scène entourant un objet, comme si l’objet était au centre d’un cube.</span><span class="sxs-lookup"><span data-stu-id="214ee-104">Cubic environment maps - sometimes referred to as cube maps - are textures that contain image data representing the scene surrounding an object, as if the object were in the center of a cube.</span></span> <span data-ttu-id="214ee-105">Chaque face de la carte d’environnement cubique couvre un champ de vue de 90 degré dans le sens horizontal et vertical, et il existe six visages par mappage de cube.</span><span class="sxs-lookup"><span data-stu-id="214ee-105">Each face of the cubic environment map covers a 90-degree field of view in the horizontal and vertical, and there are six faces per cube map.</span></span> <span data-ttu-id="214ee-106">L’orientation des visages est présentée dans l’illustration suivante.</span><span class="sxs-lookup"><span data-stu-id="214ee-106">The orientation of the faces is shown in the following illustration.</span></span>

![illustration d’un cube avec des axes de coordonnées centrales perpendiculaires aux visages de cube](images/cubemap-cube.png)

<span data-ttu-id="214ee-108">Chaque face du cube est orientée perpendiculairement au plan x/y, y/z ou x/z, dans l’espace universel.</span><span class="sxs-lookup"><span data-stu-id="214ee-108">Each face of the cube is oriented perpendicular to the x/y, y/z, or x/z plane, in world space.</span></span> <span data-ttu-id="214ee-109">L’illustration suivante montre comment chaque plan correspond à un visage.</span><span class="sxs-lookup"><span data-stu-id="214ee-109">The following illustration shows how each plane corresponds to a face.</span></span>

![illustration de faces de cube avec des projections de coordonnées à partir de plans](images/cube-faces.png)

<span data-ttu-id="214ee-111">Les mappages d’environnement cubiques sont implémentés sous la forme d’une série d’objets texture.</span><span class="sxs-lookup"><span data-stu-id="214ee-111">Cubic environment maps are implemented as a series of texture objects.</span></span> <span data-ttu-id="214ee-112">Les applications peuvent utiliser des images statiques pour le mappage d’environnement cubique, ou elles peuvent être rendues dans les faces du mappage de cube pour effectuer un mappage d’environnement dynamique.</span><span class="sxs-lookup"><span data-stu-id="214ee-112">Applications can use static images for cubic environment mapping, or they can render into the faces of the cube map to perform dynamic environment mapping.</span></span> <span data-ttu-id="214ee-113">Cette technique exige que les surfaces du mappage de cube soient des surfaces de cible de rendu valides, créées avec l' \_ indicateur D3DUSAGE RENDERTARGET défini.</span><span class="sxs-lookup"><span data-stu-id="214ee-113">This technique requires that the cube-map surfaces be valid render-target surfaces, created with the D3DUSAGE\_RENDERTARGET flag set.</span></span>

<span data-ttu-id="214ee-114">Les visages d’un mappage de cube n’ont pas besoin de contenir des rendus extrêmement détaillés de la scène environnante.</span><span class="sxs-lookup"><span data-stu-id="214ee-114">The faces of a cube map don't need to contain extremely detailed renderings of the surrounding scene.</span></span> <span data-ttu-id="214ee-115">Dans la plupart des cas, les mappages d’environnement sont appliqués à des surfaces courbées.</span><span class="sxs-lookup"><span data-stu-id="214ee-115">In most cases, environment maps are applied to curved surfaces.</span></span> <span data-ttu-id="214ee-116">Compte tenu de la quantité de courbure utilisée par la plupart des applications, la distorsion réfléchissante résultante est beaucoup plus détaillée dans la cartographie des environnements, en termes de mémoire et de charge de rendu.</span><span class="sxs-lookup"><span data-stu-id="214ee-116">Given the amount of curvature used by most applications, the resulting reflective distortion makes extreme detail in the environment map wasteful in terms of memory and rendering overhead.</span></span>

## <a name="mipmapped-cubic-environment-maps"></a><span data-ttu-id="214ee-117">Cartes de l’environnement cubique Mipmapped</span><span class="sxs-lookup"><span data-stu-id="214ee-117">Mipmapped Cubic Environment Maps</span></span>

<span data-ttu-id="214ee-118">Les mappages de cube peuvent être mipmapped.</span><span class="sxs-lookup"><span data-stu-id="214ee-118">Cube maps can be mipmapped.</span></span> <span data-ttu-id="214ee-119">Pour créer un mappage de cube mipmapped, définissez le paramètre levels de la méthode [**CreateCubeTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createcubetexture) sur le nombre de niveaux souhaité.</span><span class="sxs-lookup"><span data-stu-id="214ee-119">To create a mipmapped cube map, set the Levels parameter of the [**CreateCubeTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createcubetexture) method to the number of levels that you want.</span></span> <span data-ttu-id="214ee-120">Vous pouvez envisager la topographie de ces surfaces comme indiqué dans le diagramme suivant.</span><span class="sxs-lookup"><span data-stu-id="214ee-120">You can envision the topography of these surfaces as shown in the following diagram.</span></span>

![diagramme d’un mappage de cube mipmapped avec n niveaux MIP](images/cubemap-mipped.png)

<span data-ttu-id="214ee-122">Les applications qui créent des cartes d’environnement cubiques mipmapped peuvent accéder à chaque visage en appelant la méthode [**GetCubeMapSurface**](/windows/desktop/api) .</span><span class="sxs-lookup"><span data-stu-id="214ee-122">Applications that create mipmapped cubic environment maps can access each face by calling the [**GetCubeMapSurface**](/windows/desktop/api) method.</span></span> <span data-ttu-id="214ee-123">Commencez par définir la valeur appropriée à partir du type énuméré [**D3DCUBEMAP \_ faces**](./d3dcubemap-faces.md) , comme indiqué dans [création de surfaces de mappage d’environnement cubique (Direct3D 9)](creating-cubic-environment-map-surfaces.md).</span><span class="sxs-lookup"><span data-stu-id="214ee-123">Start by setting the appropriate value from the [**D3DCUBEMAP\_FACES**](./d3dcubemap-faces.md) enumerated type, as discussed in [Creating Cubic Environment Map Surfaces (Direct3D 9)](creating-cubic-environment-map-surfaces.md).</span></span> <span data-ttu-id="214ee-124">Ensuite, sélectionnez le niveau à récupérer en définissant le paramètre de niveau **GetCubeMapSurface** sur le niveau de mipmap souhaité.</span><span class="sxs-lookup"><span data-stu-id="214ee-124">Next, select the level to retrieve by setting the **GetCubeMapSurface** level parameter to the mipmap level that you want.</span></span> <span data-ttu-id="214ee-125">N’oubliez pas que 0 correspond à l’image de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="214ee-125">Remember that 0 corresponds with the top-level image.</span></span>

## <a name="texture-coordinates-for-cubic-environment-maps"></a><span data-ttu-id="214ee-126">Coordonnées de texture pour les mappages d’environnement cubiques</span><span class="sxs-lookup"><span data-stu-id="214ee-126">Texture Coordinates for Cubic Environment Maps</span></span>

<span data-ttu-id="214ee-127">Les coordonnées de texture qui indexent une carte d’environnement cubique ne sont pas des coordonnées de style u, v simples, telles qu’elles sont utilisées lorsque les textures standard sont appliquées.</span><span class="sxs-lookup"><span data-stu-id="214ee-127">Texture coordinates that index a cubic environment map aren't simple u, v style coordinates, as used when standard textures are applied.</span></span> <span data-ttu-id="214ee-128">En fait, les mappages d’environnement cubique n’utilisent pas du tout des coordonnées de texture.</span><span class="sxs-lookup"><span data-stu-id="214ee-128">In fact, cubic environment maps don't use texture coordinates at all.</span></span> <span data-ttu-id="214ee-129">À la place d’un ensemble de coordonnées de texture, les mappages d’environnement cubique requièrent un vecteur 3D.</span><span class="sxs-lookup"><span data-stu-id="214ee-129">In place of a set of texture coordinates, cubic environment maps require a 3D vector.</span></span> <span data-ttu-id="214ee-130">Vous devez veiller à spécifier un format de vertex correct.</span><span class="sxs-lookup"><span data-stu-id="214ee-130">You must take care to specify a proper vertex format.</span></span> <span data-ttu-id="214ee-131">En plus d’indiquer au système le nombre de jeux de coordonnées de texture que votre application utilise, vous devez fournir des informations sur le nombre d’éléments dans chaque ensemble.</span><span class="sxs-lookup"><span data-stu-id="214ee-131">In addition to telling the system how many sets of texture coordinates your application uses, you must provide information about how many elements are in each set.</span></span> <span data-ttu-id="214ee-132">Direct3D offre le jeu de macros [**\_ TEXCOORDSIZEN D3DFVF**](d3dfvf-texcoordsizen.md) à cet effet.</span><span class="sxs-lookup"><span data-stu-id="214ee-132">Direct3D offers the [**D3DFVF\_TEXCOORDSIZEN**](d3dfvf-texcoordsizen.md) set of macros for this purpose.</span></span> <span data-ttu-id="214ee-133">Ces macros acceptent un seul paramètre, identifiant l’index du jeu de coordonnées de texture pour lequel la taille est décrite.</span><span class="sxs-lookup"><span data-stu-id="214ee-133">These macros accept a single parameter, identifying the index of the texture coordinate set for which the size is being described.</span></span> <span data-ttu-id="214ee-134">Dans le cas d’un vecteur 3D, vous incluez le modèle binaire créé par la \_ macro D3DFVF TEXCOORDSIZE3.</span><span class="sxs-lookup"><span data-stu-id="214ee-134">In the case of a 3D vector, you include the bit pattern created by the D3DFVF\_TEXCOORDSIZE3 macro.</span></span> <span data-ttu-id="214ee-135">L’exemple de code suivant montre comment cette macro est utilisée.</span><span class="sxs-lookup"><span data-stu-id="214ee-135">The following code example shows how this macro is used.</span></span>


```
// Create a flexible vertex format descriptor for a vertex that contains
//   a position, normal, and one set of 3D texture coordinates.

DWORD dwFVF = D3DFVF_XYZ | D3DFVF_NORMAL | D3DFVF_TEX1 | D3DFVF_TEXCOORDSIZE3(0); 
```



<span data-ttu-id="214ee-136">Dans certains cas, tels que le mappage de lumière diffuse, vous utilisez la normale de vertex d’espace de caméra pour le vecteur.</span><span class="sxs-lookup"><span data-stu-id="214ee-136">In some cases, such as diffuse light mapping, you use the camera-space vertex normal for the vector.</span></span> <span data-ttu-id="214ee-137">Dans d’autres cas, comme le mappage d’environnement spéculaire, vous utilisez un vecteur de réflexion.</span><span class="sxs-lookup"><span data-stu-id="214ee-137">In other cases, like specular environment mapping, you use a reflection vector.</span></span> <span data-ttu-id="214ee-138">Étant donné que les normales des sommets transformés sont largement comprises, les informations qui se concentrent sur le calcul d’un vecteur de réflexion.</span><span class="sxs-lookup"><span data-stu-id="214ee-138">Because transformed vertex normals are widely understood, the information here concentrates on computing a reflection vector.</span></span>

<span data-ttu-id="214ee-139">Le calcul d’un vecteur de réflexion par vous-même nécessite une compréhension de la position de chaque vertex et d’un vecteur du point de vue de ce vertex.</span><span class="sxs-lookup"><span data-stu-id="214ee-139">Computing a reflection vector on your own requires understanding of the position of each vertex, and of a vector from the viewpoint to that vertex.</span></span> <span data-ttu-id="214ee-140">Direct3D peut calculer automatiquement les vecteurs de réflexion pour votre géométrie.</span><span class="sxs-lookup"><span data-stu-id="214ee-140">Direct3D can automatically compute the reflection vectors for your geometry.</span></span> <span data-ttu-id="214ee-141">L’utilisation de cette fonctionnalité permet d’économiser de la mémoire, car vous n’avez pas besoin d’inclure des coordonnées de texture pour la carte d’environnement.</span><span class="sxs-lookup"><span data-stu-id="214ee-141">Using this feature saves memory because you don't need to include texture coordinates for the environment map.</span></span> <span data-ttu-id="214ee-142">Cela réduit également la bande passante et, dans le cas d’un appareil de la couche d’abstraction T&L, il peut être beaucoup plus rapide que les calculs que votre application peut créer de manière autonome.</span><span class="sxs-lookup"><span data-stu-id="214ee-142">It also reduces bandwidth and, in the case of a T&L HAL Device, it can be significantly faster than the computations that your application can make on its own.</span></span> <span data-ttu-id="214ee-143">Pour utiliser cette fonctionnalité, dans l’étape de texture qui contient le mappage d’environnement cubique, définissez l’état de l' \_ étape de texture D3DTSS TEXCOORDINDEX sur une combinaison du \_ membre D3DTSS TCI \_ CAMERASPACEREFLECTIONVECTOR de [**D3DTEXTURESTAGESTATETYPE**](./d3dtexturestagestatetype.md) et l’index d’un jeu de coordonnées de texture.</span><span class="sxs-lookup"><span data-stu-id="214ee-143">To use this feature, in the texture stage that contains the cubic environment map, set the D3DTSS\_TEXCOORDINDEX texture stage state to a combination of the D3DTSS\_TCI\_CAMERASPACEREFLECTIONVECTOR member of [**D3DTEXTURESTAGESTATETYPE**](./d3dtexturestagestatetype.md) and the index of a texture coordinate set.</span></span> <span data-ttu-id="214ee-144">Dans certaines situations, comme le mappage de lumière diffuse, vous pouvez utiliser \_ le \_ membre D3DTSS TCI CAMERASPACENORMAL de **D3DTEXTURESTAGESTATETYPE**, ce qui amène le système à utiliser le vecteur d’adressage de la texture transformé, espace caméra, normal.</span><span class="sxs-lookup"><span data-stu-id="214ee-144">In some situations, like diffuse light mapping, you might use the D3DTSS\_TCI\_CAMERASPACENORMAL member of **D3DTEXTURESTAGESTATETYPE**, which causes the system to use the transformed, camera-space, vertex normal as the addressing vector for the texture.</span></span> <span data-ttu-id="214ee-145">L’index est utilisé uniquement par le système pour déterminer le mode d’habillage de la texture.</span><span class="sxs-lookup"><span data-stu-id="214ee-145">The index is only used by the system to determine the wrapping mode for the texture.</span></span>

<span data-ttu-id="214ee-146">L’exemple de code suivant montre comment cette valeur est utilisée.</span><span class="sxs-lookup"><span data-stu-id="214ee-146">The following code example shows how this value is used.</span></span>


```
// The m_d3dDevice variable is a valid pointer
// to an IDirect3DDevice9 interface.

// Automatically generate texture coordinates for stage 2.
// This assumes that stage 2 is assigned a cube map.
// Use the wrap mode from the texture coordinate set at index 1.

m_d3dDevice->SetTextureStageState( 2, D3DTSS_TEXCOORDINDEX,
                                   D3DTSS_TCI_CAMERASPACEREFLECTIONVECTOR | 1); 
```



<span data-ttu-id="214ee-147">Lorsque vous activez la génération automatique de coordonnées de texture, le système utilise l’une des deux formules pour calculer le vecteur de réflexion pour chaque vertex.</span><span class="sxs-lookup"><span data-stu-id="214ee-147">When you enable automatic texture coordinate generation, the system uses one of two formulas to compute the reflection vector for each vertex.</span></span> <span data-ttu-id="214ee-148">Lorsque l' \_ État de rendu D3DRS LOCALVIEWER est défini sur **true**, la formule suivante est utilisée.</span><span class="sxs-lookup"><span data-stu-id="214ee-148">When the D3DRS\_LOCALVIEWER render state is set to **TRUE**, the following formula is used.</span></span>

![formule du vecteur de réflexion (r = 2 (exn) n-e)](images/reflection-vector-local.png)

<span data-ttu-id="214ee-150">Dans la formule précédente, R est le vecteur de réflexion qui est calculé, E est le vecteur de position à œil normalisé, et N est le vertex de l’espace de caméra normal.</span><span class="sxs-lookup"><span data-stu-id="214ee-150">In the preceding formula, R is the reflection vector being computed, E is the normalized position-to-eye vector, and N is the camera-space vertex normal.</span></span>

<span data-ttu-id="214ee-151">Lorsque l' \_ État de rendu D3DRS LOCALVIEWER est défini sur **false**, le système utilise la formule suivante.</span><span class="sxs-lookup"><span data-stu-id="214ee-151">When the D3DRS\_LOCALVIEWER render state is set to **FALSE**, the system uses the following formula.</span></span>

![formule du vecteur de réflexion (r = 2nzn-i)](images/reflection-vector-nonlocal.png)

<span data-ttu-id="214ee-153">Les éléments R et N de cette formule sont identiques à la formule précédente.</span><span class="sxs-lookup"><span data-stu-id="214ee-153">The R and N elements in this formula are identical to the previous formula.</span></span> <span data-ttu-id="214ee-154">L’élément N<sub>z</sub> est l’espace universel Z du vertex normal, et I est le vecteur (0, 0, 1) d’un point de vue distant infini.</span><span class="sxs-lookup"><span data-stu-id="214ee-154">The N<sub>Z</sub> element is the world-space z of the vertex normal, and I is the vector (0,0,1) of an infinitely distant viewpoint.</span></span> <span data-ttu-id="214ee-155">Le système utilise le vecteur de réflexion de l’une des formules pour sélectionner et traiter la face appropriée du mappage de cube.</span><span class="sxs-lookup"><span data-stu-id="214ee-155">The system uses the reflection vector from either formula to select and address the appropriate face of the cube map.</span></span>

> [!Note]  
> <span data-ttu-id="214ee-156">Dans la plupart des cas, les applications doivent activer la normalisation automatique des normales des vertex.</span><span class="sxs-lookup"><span data-stu-id="214ee-156">In most cases, applications should enable automatic normalization of vertex normals.</span></span> <span data-ttu-id="214ee-157">Pour ce faire, affectez \_ à D3DRS NORMALIZENORMALS la **valeur true**.</span><span class="sxs-lookup"><span data-stu-id="214ee-157">To do this, set D3DRS\_NORMALIZENORMALS to **TRUE**.</span></span> <span data-ttu-id="214ee-158">Si vous n’activez pas cet état de rendu, l’apparence de la carte d’environnement sera radicalement différente de ce que vous pourriez vous attendre.</span><span class="sxs-lookup"><span data-stu-id="214ee-158">If you do not enable this render state, the appearance of the environment map will be drastically different than you might expect.</span></span>

 

<span data-ttu-id="214ee-159">Des informations supplémentaires sont fournies dans la rubrique suivante.</span><span class="sxs-lookup"><span data-stu-id="214ee-159">Additional information is contained in the following topic.</span></span>

-   [<span data-ttu-id="214ee-160">Création de surfaces de mappage d’environnement cubique (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="214ee-160">Creating Cubic Environment Map Surfaces (Direct3D 9)</span></span>](creating-cubic-environment-map-surfaces.md)

## <a name="related-topics"></a><span data-ttu-id="214ee-161">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="214ee-161">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="214ee-162">Mappage d’environnement</span><span class="sxs-lookup"><span data-stu-id="214ee-162">Environment Mapping</span></span>](environment-mapping.md)
</dt> </dl>

 

 
