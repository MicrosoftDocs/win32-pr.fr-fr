---
description: Les modifications apportées à la palette système pour le périphérique d’affichage peuvent avoir des effets spectaculaires et parfois indésirables sur les couleurs utilisées dans Windows sur le bureau.
ms.assetid: 9c470b6f-c0d3-462e-9649-1f39b06bd543
title: Messages de palette
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f19a5458ec89d8d9a0524fd2ec383de740c0179
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104972598"
---
# <a name="palette-messages"></a><span data-ttu-id="75cc1-103">Messages de palette</span><span class="sxs-lookup"><span data-stu-id="75cc1-103">Palette Messages</span></span>

<span data-ttu-id="75cc1-104">Les modifications apportées à la palette système pour le périphérique d’affichage peuvent avoir des effets spectaculaires et parfois indésirables sur les couleurs utilisées dans Windows sur le bureau.</span><span class="sxs-lookup"><span data-stu-id="75cc1-104">Changes to the system palette for the display device can have dramatic and sometimes undesirable effects on the colors used in windows on the desktop.</span></span> <span data-ttu-id="75cc1-105">Pour réduire l’impact de ces modifications, le système fournit un ensemble de messages qui permettent aux applications de gérer leurs palettes logiques tout en veillant à ce que les couleurs de la fenêtre active soient aussi proches que possible des couleurs prévues.</span><span class="sxs-lookup"><span data-stu-id="75cc1-105">To minimize the impact of these changes, the system provides a set of messages that help applications manage their logical palettes while ensuring that colors in the active window are as close as possible to the colors intended.</span></span>

<span data-ttu-id="75cc1-106">Le système envoie un message [**WM \_ QUERYNEWPALETTE**](wm-querynewpalette.md) à une fenêtre de niveau supérieur ou Overlapped juste avant d’activer la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="75cc1-106">The system sends a [**WM\_QUERYNEWPALETTE**](wm-querynewpalette.md) message to a top-level or overlapped window just before activating the window.</span></span> <span data-ttu-id="75cc1-107">Ce message donne à une application la possibilité de sélectionner et de réaliser sa palette logique afin qu’elle reçoive le meilleur mappage possible des couleurs pour sa palette logique.</span><span class="sxs-lookup"><span data-stu-id="75cc1-107">This message gives an application the opportunity to select and realize its logical palette so that it receives the best possible mapping of colors for its logical palette.</span></span> <span data-ttu-id="75cc1-108">Lorsque l’application reçoit le message, elle doit utiliser les fonctions [**SelectPalette**](/windows/desktop/api/Wingdi/nf-wingdi-selectpalette), [**UnrealizeObject**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject)et [**RealizePalette**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) pour sélectionner et réaliser la palette logique.</span><span class="sxs-lookup"><span data-stu-id="75cc1-108">When the application receives the message, it should use the [**SelectPalette**](/windows/desktop/api/Wingdi/nf-wingdi-selectpalette), [**UnrealizeObject**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject), and [**RealizePalette**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) functions to select and realize the logical palette.</span></span> <span data-ttu-id="75cc1-109">Cela permet au système de mettre à jour les couleurs de la palette système de sorte que ses couleurs correspondent autant de couleurs que possible dans la palette logique.</span><span class="sxs-lookup"><span data-stu-id="75cc1-109">Doing so directs the system to update colors in the system palette so that its colors match as many colors in the logical palette as possible.</span></span>

<span data-ttu-id="75cc1-110">Lorsqu’une application entraîne des modifications de la palette système suite à la réalisation de sa palette logique, le système envoie un message [**WM \_ PALETTECHANGED**](wm-palettechanged.md) à toutes les fenêtres superposées et de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="75cc1-110">When an application causes changes to the system palette as a result of realizing its logical palette, the system sends a [**WM\_PALETTECHANGED**](wm-palettechanged.md) message to all top-level and overlapped windows.</span></span> <span data-ttu-id="75cc1-111">Ce message donne aux applications la possibilité de mettre à jour les couleurs des zones clientes de leurs fenêtres, en remplaçant les couleurs qui ont changé par des couleurs qui correspondent davantage aux couleurs prévues.</span><span class="sxs-lookup"><span data-stu-id="75cc1-111">This message gives applications the opportunity to update the colors in the client areas of their windows, replacing colors that have changed with colors that more closely match the intended colors.</span></span> <span data-ttu-id="75cc1-112">Une application qui reçoit le **message WM \_ PALETTECHANGED** doit utiliser [**UnrealizeObject**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject) et [**RealizePalette**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) pour réinitialiser les palettes logiques associées à toutes les fenêtres inactives, puis mettre à jour les couleurs dans la zone cliente pour chaque fenêtre inactive à l’aide de la fonction [**UpdateColors**](/windows/desktop/api/Wingdi/nf-wingdi-updatecolors) .</span><span class="sxs-lookup"><span data-stu-id="75cc1-112">An application that receives the **WM\_PALETTECHANGED** message should use [**UnrealizeObject**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject) and [**RealizePalette**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) to reset the logical palettes associated with all inactive windows and then update the colors in the client area for each inactive window by using the [**UpdateColors**](/windows/desktop/api/Wingdi/nf-wingdi-updatecolors) function.</span></span> <span data-ttu-id="75cc1-113">Cette technique ne garantit pas le plus grand nombre de correspondances de couleurs exactes. Toutefois, cela permet de s’assurer que les couleurs de la palette logique sont mappées à des couleurs raisonnables dans la palette du système.</span><span class="sxs-lookup"><span data-stu-id="75cc1-113">This technique does not guarantee the greatest number of exact color matches; however, it does ensure that colors in the logical palette are mapped to reasonable colors in the system palette.</span></span>

> [!Note]  
> <span data-ttu-id="75cc1-114">Pour éviter de créer une boucle infinie, une application ne doit jamais se rendre compte de la palette de la fenêtre dont le descripteur correspond au descripteur passé dans le paramètre *wParam* du message [**WM \_ PALETTECHANGED**](wm-palettechanged.md) .</span><span class="sxs-lookup"><span data-stu-id="75cc1-114">To avoid creating an infinite loop, an application should never realize the palette for the window whose handle matches the handle passed in the *wParam* parameter of the [**WM\_PALETTECHANGED**](wm-palettechanged.md) message.</span></span>

 

<span data-ttu-id="75cc1-115">La fonction [**UpdateColors**](/windows/desktop/api/Wingdi/nf-wingdi-updatecolors) met généralement à jour une zone cliente d’une fenêtre inactive plus rapidement que le rafraîchissement de la zone.</span><span class="sxs-lookup"><span data-stu-id="75cc1-115">The [**UpdateColors**](/windows/desktop/api/Wingdi/nf-wingdi-updatecolors) function typically updates a client area of an inactive window faster than redrawing the area.</span></span> <span data-ttu-id="75cc1-116">Toutefois, étant donné que **UpdateColors** effectue la traduction des couleurs en fonction de la couleur de chaque pixel avant la modification de la palette du système, chaque appel à cette fonction entraîne une perte de précision de la couleur.</span><span class="sxs-lookup"><span data-stu-id="75cc1-116">However, because **UpdateColors** performs color translation based on the color of each pixel before the system palette changed, each call to this function results in the loss of some color accuracy.</span></span> <span data-ttu-id="75cc1-117">Cela signifie que **UpdateColors** ne peut pas être utilisé pour mettre à jour les couleurs quand la fenêtre devient active.</span><span class="sxs-lookup"><span data-stu-id="75cc1-117">This means **UpdateColors** cannot be used to update colors when the window becomes active.</span></span> <span data-ttu-id="75cc1-118">Dans ce cas, l’application doit redessiner la zone cliente.</span><span class="sxs-lookup"><span data-stu-id="75cc1-118">In such cases, the application should redraw the client area.</span></span>

<span data-ttu-id="75cc1-119">Le système peut envoyer le message [**WM \_ QUERYNEWPALETTE**](wm-querynewpalette.md) lorsque des modifications sont apportées à la palette logique.</span><span class="sxs-lookup"><span data-stu-id="75cc1-119">The system may send the [**WM\_QUERYNEWPALETTE**](wm-querynewpalette.md) message when changes to the logical palette are made.</span></span> <span data-ttu-id="75cc1-120">En outre, le système peut envoyer le message [**WM \_ PALETTEISCHANGING**](wm-paletteischanging.md) à toutes les fenêtres superposées et de niveau supérieur lorsque la palette du système va être modifiée.</span><span class="sxs-lookup"><span data-stu-id="75cc1-120">Also, the system may send the [**WM\_PALETTEISCHANGING**](wm-paletteischanging.md) message to all top-level and overlapped windows when the system palette is about to change.</span></span>

 

 



