---
description: Un contexte de périphérique privé permet à une application d’éviter de récupérer et d’initialiser un contexte de périphérique d’affichage chaque fois que l’application doit dessiner dans une fenêtre.
ms.assetid: 8de5a14b-a8b3-42a5-81f3-bf3c357052cb
title: Contextes de périphérique d’affichage privé
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 451dbd3c0a232610026740d0ea0fa817ea2034b8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104528287"
---
# <a name="private-display-device-contexts"></a><span data-ttu-id="63977-103">Contextes de périphérique d’affichage privé</span><span class="sxs-lookup"><span data-stu-id="63977-103">Private Display Device Contexts</span></span>

<span data-ttu-id="63977-104">Un *contexte de périphérique privé* permet à une application d’éviter de récupérer et d’initialiser un contexte de périphérique d’affichage chaque fois que l’application doit dessiner dans une fenêtre.</span><span class="sxs-lookup"><span data-stu-id="63977-104">A *private device context* enables an application to avoid retrieving and initializing a display device context each time the application must draw in a window.</span></span> <span data-ttu-id="63977-105">Les contextes de périphérique privé sont utiles pour Windows qui nécessitent de nombreuses modifications des valeurs des attributs du contexte de périphérique pour le préparer au dessin.</span><span class="sxs-lookup"><span data-stu-id="63977-105">Private device contexts are useful for windows that require many changes to the values of the attributes of the device context to prepare it for drawing.</span></span> <span data-ttu-id="63977-106">Les contextes de périphérique privé réduisent le temps nécessaire pour préparer le contexte de périphérique et, par conséquent, le temps nécessaire pour effectuer le dessin dans la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="63977-106">Private device contexts reduce the time required to prepare the device context and therefore the time needed to carry out drawing in the window.</span></span>

<span data-ttu-id="63977-107">Une application indique au système de créer un contexte de périphérique privé pour une fenêtre en spécifiant le \_ style cs OWNDC dans la classe de fenêtre.</span><span class="sxs-lookup"><span data-stu-id="63977-107">An application directs the system to create a private device context for a window by specifying the CS\_OWNDC style in the window class.</span></span> <span data-ttu-id="63977-108">Le système crée un contexte de périphérique privé unique chaque fois qu’il crée une nouvelle fenêtre appartenant à la classe.</span><span class="sxs-lookup"><span data-stu-id="63977-108">The system creates a unique private device context each time it creates a new window belonging to the class.</span></span> <span data-ttu-id="63977-109">Initialement, le contexte de périphérique privé a les mêmes valeurs par défaut pour les attributs qu’un contexte de périphérique courant, mais l’application peut les modifier à tout moment.</span><span class="sxs-lookup"><span data-stu-id="63977-109">Initially, the private device context has the same default values for attributes as a common device context, but the application can modify these at any time.</span></span> <span data-ttu-id="63977-110">Le système conserve les modifications apportées au contexte de périphérique pendant toute la durée de vie de la fenêtre ou jusqu’à ce que l’application apporte des modifications supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="63977-110">The system preserves changes to the device context for the life of the window or until the application makes additional changes.</span></span>

<span data-ttu-id="63977-111">Une application peut récupérer un handle vers le contexte de périphérique privé à l’aide de la fonction [**GetDC**](/windows/desktop/api/Winuser/nf-winuser-getdc) à tout moment après la création de la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="63977-111">An application can retrieve a handle to the private device context by using the [**GetDC**](/windows/desktop/api/Winuser/nf-winuser-getdc) function any time after the window is created.</span></span> <span data-ttu-id="63977-112">L’application ne doit récupérer le handle qu’une seule fois.</span><span class="sxs-lookup"><span data-stu-id="63977-112">The application must retrieve the handle only once.</span></span> <span data-ttu-id="63977-113">Ensuite, il peut conserver et utiliser le handle autant de fois que possible.</span><span class="sxs-lookup"><span data-stu-id="63977-113">Thereafter, it can keep and use the handle any number of times.</span></span> <span data-ttu-id="63977-114">Étant donné qu’un contexte de périphérique privé ne fait pas partie du cache du contexte de périphérique d’affichage, une application n’a pas besoin de libérer le contexte de périphérique à l’aide de la fonction [**ReleaseDC**](/windows/desktop/api/Winuser/nf-winuser-releasedc) .</span><span class="sxs-lookup"><span data-stu-id="63977-114">Because a private device context is not part of the display device context cache, an application need never release the device context by using the [**ReleaseDC**](/windows/desktop/api/Winuser/nf-winuser-releasedc) function.</span></span>

<span data-ttu-id="63977-115">Le système ajuste automatiquement le contexte de périphérique pour refléter les modifications apportées à la fenêtre, telles que le déplacement ou le redimensionnement.</span><span class="sxs-lookup"><span data-stu-id="63977-115">The system automatically adjusts the device context to reflect changes to the window, such as moving or sizing.</span></span> <span data-ttu-id="63977-116">Cela garantit que toutes les fenêtres qui se chevauchent sont toujours correctement découpées. autrement dit, aucune action n’est requise par l’application pour garantir le découpage.</span><span class="sxs-lookup"><span data-stu-id="63977-116">This ensures that any overlapping windows are always properly clipped; that is, no action is required by the application to ensure clipping.</span></span> <span data-ttu-id="63977-117">Toutefois, le système ne révise pas le contexte de périphérique pour inclure la région de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="63977-117">However, the system does not revise the device context to include the update region.</span></span> <span data-ttu-id="63977-118">Par conséquent, lors du traitement d’un message [**WM \_ Paint**](wm-paint.md) , l’application doit incorporer la région de mise à jour en appelant [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) ou en extrayant la région de mise à jour et en l’coupant avec la région de découpage actuelle.</span><span class="sxs-lookup"><span data-stu-id="63977-118">Therefore, when processing a [**WM\_PAINT**](wm-paint.md) message, the application must incorporate the update region either by calling [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) or by retrieving the update region and intersecting it with the current clipping region.</span></span> <span data-ttu-id="63977-119">Si l’application n’appelle pas **BeginPaint**, elle doit valider explicitement la région de mise à jour à l’aide de la fonction [**ValidateRect**](/windows/desktop/api/Winuser/nf-winuser-validaterect) ou [**ValidateRgn**](/windows/desktop/api/Winuser/nf-winuser-validatergn) .</span><span class="sxs-lookup"><span data-stu-id="63977-119">If the application does not call **BeginPaint**, it must explicitly validate the update region by using the [**ValidateRect**](/windows/desktop/api/Winuser/nf-winuser-validaterect) or [**ValidateRgn**](/windows/desktop/api/Winuser/nf-winuser-validatergn) function.</span></span> <span data-ttu-id="63977-120">Si l’application ne valide pas la région de mise à jour, la fenêtre reçoit une série infinie de messages de **\_ peinture WM** .</span><span class="sxs-lookup"><span data-stu-id="63977-120">If the application does not validate the update region, the window receives an endless series of **WM\_PAINT** messages.</span></span>

<span data-ttu-id="63977-121">Étant donné que [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) masque le signe insertion si une fenêtre l’affiche, une application qui appelle **BeginPaint** doit également appeler la fonction [**EndPaint**](/windows/desktop/api/Winuser/nf-winuser-endpaint) pour restaurer le signe insertion.</span><span class="sxs-lookup"><span data-stu-id="63977-121">Because [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) hides the caret if a window is showing it, an application that calls **BeginPaint** should also call the [**EndPaint**](/windows/desktop/api/Winuser/nf-winuser-endpaint) function to restore the caret.</span></span> <span data-ttu-id="63977-122">**EndPaint** n’a aucun autre effet sur un contexte de périphérique privé.</span><span class="sxs-lookup"><span data-stu-id="63977-122">**EndPaint** has no other effect on a private device context.</span></span>

<span data-ttu-id="63977-123">Bien qu’un contexte de périphérique privé soit pratique à utiliser, il utilise beaucoup de mémoire en termes de ressources système, ce qui nécessite 800 ou plus d’octets à stocker.</span><span class="sxs-lookup"><span data-stu-id="63977-123">Although a private device context is convenient to use, it is memory-intensive in terms of system resources, requiring 800 or more bytes to store.</span></span> <span data-ttu-id="63977-124">Les contextes de périphérique privé sont recommandés lorsque les considérations relatives aux performances dépassent les coûts de stockage.</span><span class="sxs-lookup"><span data-stu-id="63977-124">Private device contexts are recommended when performance considerations outweigh storage costs.</span></span>

<span data-ttu-id="63977-125">Le système comprend le contexte de périphérique privé lors de l’envoi du message [**WM \_ ERASEBKGND**](../winmsg/wm-erasebkgnd.md) à l’application.</span><span class="sxs-lookup"><span data-stu-id="63977-125">The system includes the private device context when sending the [**WM\_ERASEBKGND**](../winmsg/wm-erasebkgnd.md) message to the application.</span></span> <span data-ttu-id="63977-126">Les sélections actuelles du contexte de périphérique privé, y compris le mode de mappage, sont appliquées lorsque l’application ou le système traite ces messages.</span><span class="sxs-lookup"><span data-stu-id="63977-126">The current selections of the private device context, including mapping mode, are in effect when the application or the system processes these messages.</span></span> <span data-ttu-id="63977-127">Pour éviter les effets indésirables, le système utilise des coordonnées logiques lors de l’effacement de l’arrière-plan. par exemple, elle utilise la fonction [**GetClipBox**](/windows/desktop/api/Wingdi/nf-wingdi-getclipbox) pour récupérer les coordonnées logiques de la zone à effacer et transmet ces coordonnées à la fonction [**fillRect**](/windows/desktop/api/Winuser/nf-winuser-fillrect) .</span><span class="sxs-lookup"><span data-stu-id="63977-127">To avoid undesirable effects, the system uses logical coordinates when erasing the background; for example, it uses the [**GetClipBox**](/windows/desktop/api/Wingdi/nf-wingdi-getclipbox) function to retrieve the logical coordinates of the area to erase and passes these coordinates to the [**FillRect**](/windows/desktop/api/Winuser/nf-winuser-fillrect) function.</span></span> <span data-ttu-id="63977-128">Les applications qui traitent ces messages peuvent utiliser des techniques similaires.</span><span class="sxs-lookup"><span data-stu-id="63977-128">Applications that process these messages can use similar techniques.</span></span>

<span data-ttu-id="63977-129">Une application peut utiliser la fonction [**GetDCEx**](/windows/desktop/api/Winuser/nf-winuser-getdcex) pour forcer le système à retourner un contexte de périphérique courant pour la fenêtre qui possède un contexte de périphérique privé.</span><span class="sxs-lookup"><span data-stu-id="63977-129">An application can use the [**GetDCEx**](/windows/desktop/api/Winuser/nf-winuser-getdcex) function to force the system to return a common device context for the window that has a private device context.</span></span> <span data-ttu-id="63977-130">Cela est utile pour effectuer des touches rapides dans une fenêtre sans modifier les valeurs actuelles des attributs du contexte de périphérique privé.</span><span class="sxs-lookup"><span data-stu-id="63977-130">This is useful for carrying out quick touch-ups to a window without changing the current values of the attributes of the private device context.</span></span>

 

 
