---
description: Windows 8 ajoute la prise en charge du modèle de retournement de présentation et de ses statistiques actuelles associées dans DXGI 1,2.
ms.assetid: E132DAF5-80B7-4C52-A760-3779CC140CE7
title: DXGI Flip Model
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 49ee82febd13a3b57a06d93fd01eb8d230d6b78a
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "103846405"
---
# <a name="dxgi-flip-model"></a><span data-ttu-id="6dcaa-103">DXGI Flip Model</span><span class="sxs-lookup"><span data-stu-id="6dcaa-103">DXGI flip model</span></span>

<span data-ttu-id="6dcaa-104">Windows 8 ajoute la prise en charge du modèle de retournement de présentation et de ses statistiques actuelles associées dans DXGI 1,2.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-104">Windows 8 adds support for flip presentation model and its associated present statistics in DXGI 1.2.</span></span> <span data-ttu-id="6dcaa-105">Le modèle de retournement de DXGI de Windows 8 est similaire à la [Présentation du mode de basculement Direct3D 9Ex](../direct3darticles/direct3d-9ex-improvements.md)de Windows 7.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-105">Windows 8’s DXGI flip presentation model is similar to Windows 7’s [Direct3D 9EX Flip Mode Presentation](../direct3darticles/direct3d-9ex-improvements.md).</span></span> <span data-ttu-id="6dcaa-106">Les applications de présentation basées sur la fréquence d’images ou la vidéo, comme les jeux, peuvent tirer le meilleur parti en utilisant le modèle de retournement de présentation.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-106">Video or frame rate-based presentation apps such as games can benefit most by using flip presentation model.</span></span> <span data-ttu-id="6dcaa-107">Les applications qui utilisent DXGI retournent le modèle de présentation réduisent la charge des ressources système et améliorent les performances.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-107">Apps that use DXGI flip presentation model reduce the system resource load and increase performance.</span></span> <span data-ttu-id="6dcaa-108">Les applications peuvent également utiliser l’amélioration de la présentation des statistiques avec la fonction retourner le modèle de présentation pour mieux contrôler le taux de présentation en fournissant des mécanismes de commentaires et de correction en temps réel.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-108">Apps can also use present statistics enhancements with flip presentation model to better control the rate of presentation by providing real-time feedback and correction mechanisms.</span></span>

-   [<span data-ttu-id="6dcaa-109">Comparaison du modèle de retournement DXGI et du modèle BitBlt</span><span class="sxs-lookup"><span data-stu-id="6dcaa-109">Comparing the DXGI flip model and the BitBlt model</span></span>](#comparing-the-dxgi-flip-model-and-the-bitblt-model)
-   [<span data-ttu-id="6dcaa-110">Guide pratique pour utiliser DXGI Flip Model</span><span class="sxs-lookup"><span data-stu-id="6dcaa-110">How to use DXGI flip model</span></span>](#how-to-use-dxgi-flip-model)
-   [<span data-ttu-id="6dcaa-111">Synchronisation des frames des applications DXGI Flip Model</span><span class="sxs-lookup"><span data-stu-id="6dcaa-111">Frame synchronization of DXGI flip model apps</span></span>](#frame-synchronization-of-dxgi-flip-model-apps)
-   [<span data-ttu-id="6dcaa-112">Prévention, détection et récupération à partir de problèmes</span><span class="sxs-lookup"><span data-stu-id="6dcaa-112">Avoiding, detecting, and recovering from glitches</span></span>](#avoiding-detecting-and-recovering-from-glitches)
-   [<span data-ttu-id="6dcaa-113">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="6dcaa-113">Related topics</span></span>](#related-topics)

## <a name="comparing-the-dxgi-flip-model-and-the-bitblt-model"></a><span data-ttu-id="6dcaa-114">Comparaison du modèle de retournement DXGI et du modèle BitBlt</span><span class="sxs-lookup"><span data-stu-id="6dcaa-114">Comparing the DXGI flip model and the BitBlt model</span></span>

<span data-ttu-id="6dcaa-115">Le runtime utilise le transfert de bloc de bits (BitBlt) et retournent les modèles de présentation pour présenter le contenu graphique sur les moniteurs d’affichage.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-115">The runtime uses the bit-block transfer (bitblt) and flip presentation models to present graphics content on display monitors.</span></span> <span data-ttu-id="6dcaa-116">La plus grande différence entre BitBlt et retourner les modèles de présentation est la façon dont le contenu de la mémoire tampon d’arrière-plan est obtenu dans le DWM Windows 8 pour la composition.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-116">The biggest difference between bitblt and flip presentation models is how back-buffer contents get to the Windows 8 DWM for composition.</span></span> <span data-ttu-id="6dcaa-117">Dans le modèle BitBlt, le contenu de la mémoire tampon d’arrière-plan est copié dans la surface de redirection de chaque appel à [**IDXGISwapChain1 ::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span><span class="sxs-lookup"><span data-stu-id="6dcaa-117">In the bitblt model, contents of the back buffer are copied into the redirection surface on each call to [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span></span> <span data-ttu-id="6dcaa-118">Dans le modèle de retournement, toutes les mémoires tampons d’arrière-plan sont partagées avec le Gestionnaire de fenêtrage (DWM).</span><span class="sxs-lookup"><span data-stu-id="6dcaa-118">In the flip model, all back buffers are shared with the Desktop Window Manager (DWM).</span></span> <span data-ttu-id="6dcaa-119">Par conséquent, le DWM peut composer directement à partir de ces mémoires tampons d’arrière-plan sans aucune autre opération de copie.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-119">Therefore, the DWM can compose straight from those back buffers without any additional copy operations.</span></span> <span data-ttu-id="6dcaa-120">En général, le modèle de retournement est plus efficace.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-120">In general, the flip model is more efficient.</span></span> <span data-ttu-id="6dcaa-121">Le modèle de retournement fournit également plus de fonctionnalités, telles que les statistiques actuelles améliorées.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-121">The flip model also provides more features, such as enhanced present statistics.</span></span>

<span data-ttu-id="6dcaa-122">Si vous avez des composants hérités qui utilisent Windows Graphics Device Interface (GDI) pour écrire directement dans un [**HWND**](../winprog/windows-data-types.md) , utilisez le modèle BitBlt.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-122">If you have legacy components that use Windows Graphics Device Interface (GDI) to write to an [**HWND**](../winprog/windows-data-types.md) directly, use the bitblt model.</span></span>

<span data-ttu-id="6dcaa-123">Les améliorations des performances du modèle de basculement DXGI sont significatives quand l’application est en mode fenêtre.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-123">Performance improvements of DXGI flip model are significant when the app is in windowed mode.</span></span> <span data-ttu-id="6dcaa-124">La séquence de ce tableau et l’illustration comparent les utilisations de la bande passante de mémoire et les lectures et écritures système des applications Windows qui choisissent le modèle Flip Model et le modèle BitBlt.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-124">The sequence in this table and the illustration compare memory bandwidth usages and system reads and writes of windowed apps that choose flip model versus the bitblt model.</span></span>



| <span data-ttu-id="6dcaa-125">Étape</span><span class="sxs-lookup"><span data-stu-id="6dcaa-125">Step</span></span> | <span data-ttu-id="6dcaa-126">Modèle BitBlt présent dans DWM</span><span class="sxs-lookup"><span data-stu-id="6dcaa-126">BitBlt model present to DWM</span></span>                                                                               | <span data-ttu-id="6dcaa-127">DXGI Flip Model est présent dans DWM</span><span class="sxs-lookup"><span data-stu-id="6dcaa-127">DXGI flip model present to DWM</span></span>                                   |
|------|-----------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
| <span data-ttu-id="6dcaa-128">1.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-128">1.</span></span>   | <span data-ttu-id="6dcaa-129">L’application met à jour son Frame (écriture)</span><span class="sxs-lookup"><span data-stu-id="6dcaa-129">The app updates its frame (Write)</span></span><br/>                                                              | <span data-ttu-id="6dcaa-130">L’application met à jour son Frame (écriture)</span><span class="sxs-lookup"><span data-stu-id="6dcaa-130">The app updates its frame (Write)</span></span><br/>                     |
| <span data-ttu-id="6dcaa-131">2.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-131">2.</span></span>   | <span data-ttu-id="6dcaa-132">Le runtime Direct3D copie le contenu de la surface dans une surface de redirection DWM (lecture, écriture)</span><span class="sxs-lookup"><span data-stu-id="6dcaa-132">Direct3D runtime copies surface contents to a DWM redirection surface (Read, Write)</span></span><br/>            | <span data-ttu-id="6dcaa-133">Le runtime Direct3D passe l’aire de l’application à DWM</span><span class="sxs-lookup"><span data-stu-id="6dcaa-133">Direct3D runtime passes the app surface to DWM</span></span><br/>        |
| <span data-ttu-id="6dcaa-134">3.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-134">3.</span></span>   | <span data-ttu-id="6dcaa-135">Une fois la copie de la surface partagée terminée, DWM restitue l’aire de l’application sur l’écran (lecture, écriture)</span><span class="sxs-lookup"><span data-stu-id="6dcaa-135">After the shared surface copy completes, DWM renders the app surface onto screen (Read, Write)</span></span><br/> | <span data-ttu-id="6dcaa-136">DWM affiche l’aire de l’application sur l’écran (lecture, écriture)</span><span class="sxs-lookup"><span data-stu-id="6dcaa-136">DWM renders the app surface onto screen (Read, Write)</span></span><br/> |



 

![illustration d’une comparaison entre le modèle BLT et le modèle Flip](images/blt-flip-mode-present.png)

<span data-ttu-id="6dcaa-138">Flip Model réduit l’utilisation de la mémoire système en réduisant le nombre de lectures et d’écritures par le runtime Direct3D pour la composition de frame avec fenêtres par DWM.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-138">Flip model reduces system memory usage by reducing the number of reads and writes by the Direct3D runtime for the windowed frame composition by DWM.</span></span>

## <a name="how-to-use-dxgi-flip-model"></a><span data-ttu-id="6dcaa-139">Guide pratique pour utiliser DXGI Flip Model</span><span class="sxs-lookup"><span data-stu-id="6dcaa-139">How to use DXGI flip model</span></span>

<span data-ttu-id="6dcaa-140">Les applications Direct3D 11,1 qui ciblent Windows 8 utilisent Flip Model en créant la chaîne de permutation avec l' [**effet d’échange dxgi retourner une valeur d’énumération \_ \_ \_ \_ séquentielle**](/windows/desktop/api/DXGI/ne-dxgi-dxgi_swap_effect) définie dans le membre **SwapEffect** de la structure DESC1 de la [**\_ \_ chaîne \_ de permutation dxgi**](/windows/desktop/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1) .</span><span class="sxs-lookup"><span data-stu-id="6dcaa-140">Direct3D 11.1 apps that target Windows 8 use flip model by creating the swap chain with the [**DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**](/windows/desktop/api/DXGI/ne-dxgi-dxgi_swap_effect) enumeration value set in the **SwapEffect** member of the [**DXGI\_SWAP\_CHAIN\_DESC1**](/windows/desktop/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1) structure.</span></span> <span data-ttu-id="6dcaa-141">Quand vous définissez **SwapEffect** sur **dxgi \_ swap \_ Effect, \_ retournez \_ séquentiellement**, définissez également les membres de la **chaîne de \_ permutation dxgi \_ \_ DESC1** sur les valeurs indiquées :</span><span class="sxs-lookup"><span data-stu-id="6dcaa-141">When you set **SwapEffect** to **DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**, also set these members of **DXGI\_SWAP\_CHAIN\_DESC1** to the indicated values:</span></span>

-   <span data-ttu-id="6dcaa-142">**BufferCount** à une valeur comprise entre 2 et 16 pour empêcher une baisse des performances due à l’attente de la libération du tampon de présentation précédent par le DWM.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-142">**BufferCount** to a value between 2 and 16 to prevent a performance penalty as a result of waiting on DWM to release the previous presentation buffer.</span></span>
-   <span data-ttu-id="6dcaa-143">**Formatez** -le au format dxgi \_ \_ R16G16B16A16 \_ float, DXGI \_ format \_ B8G8R8A8 \_ UNORM ou dxgi R8G8B8A8 \_ \_ \_ UNORM</span><span class="sxs-lookup"><span data-stu-id="6dcaa-143">**Format** to DXGI\_FORMAT\_R16G16B16A16\_FLOAT, DXGI\_FORMAT\_B8G8R8A8\_UNORM, or DXGI\_FORMAT\_R8G8B8A8\_UNORM</span></span>
-   <span data-ttu-id="6dcaa-144">Membre **Count** de la structure dxgi de l' [**\_ exemple \_ desc**](/windows/desktop/api/dxgicommon/ns-dxgicommon-dxgi_sample_desc) que le membre **SampleDesc** spécifie à un et le membre **Quality** de **dxgi \_ exemple \_ desc** à zéro parce que le multiple Sample anticrénelage (MSAA) n’est pas pris en charge</span><span class="sxs-lookup"><span data-stu-id="6dcaa-144">**Count** member of the [**DXGI\_SAMPLE\_DESC**](/windows/desktop/api/dxgicommon/ns-dxgicommon-dxgi_sample_desc) structure that the **SampleDesc** member specifies to one and the **Quality** member of **DXGI\_SAMPLE\_DESC** to zero because multiple sample antialiasing (MSAA) is not supported</span></span>

<span data-ttu-id="6dcaa-145">Si vous utilisez [**l' \_ effet d’échange dxgi, \_ \_ retournez \_ séquentiellement**](/windows/desktop/api/DXGI/ne-dxgi-dxgi_swap_effect) sur le système d’exploitation Windows 7 ou antérieur, la création de l’appareil échoue.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-145">If you use [**DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**](/windows/desktop/api/DXGI/ne-dxgi-dxgi_swap_effect) on Windows 7 or earlier operating system, device creation fails.</span></span> <span data-ttu-id="6dcaa-146">Lorsque vous utilisez Flip Model, vous pouvez utiliser les statistiques de plein écran en mode fenêtre.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-146">When you use flip model, you can use full-screen present statistics in windowed mode.</span></span> <span data-ttu-id="6dcaa-147">Le comportement de plein écran n’est pas affecté.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-147">Full-screen behavior is not affected.</span></span> <span data-ttu-id="6dcaa-148">Si vous passez la **valeur null** au paramètre *pFullscreenDesc* de [**IDXGIFactory2 :: CreateSwapChainForHwnd**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgifactory2-createswapchainforhwnd) pour une chaîne de permutation avec fenêtres et que vous définissez **SwapEffect** sur **dxgi \_ swap \_ Effect \_ Flip \_ Sequential**, le runtime crée une mémoire tampon d’arrière-plan supplémentaire et fait pivoter le handle qui appartient à la mémoire tampon qui devient la mémoire tampon d’arrière-plan au moment de la présentation.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-148">If you pass **NULL** to the *pFullscreenDesc* parameter of [**IDXGIFactory2::CreateSwapChainForHwnd**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgifactory2-createswapchainforhwnd) for a windowed swap chain and set **SwapEffect** to **DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**, the runtime creates one extra back buffer and rotates whichever handle belongs to the buffer that becomes the front buffer at presentation time.</span></span>

<span data-ttu-id="6dcaa-149">Quand vous utilisez Flip Model, tenez compte des conseils suivants :</span><span class="sxs-lookup"><span data-stu-id="6dcaa-149">When you use flip model, consider these tips:</span></span>

-   <span data-ttu-id="6dcaa-150">Utilisez une chaîne de permutation de modèle par [**HWND**](../winprog/windows-data-types.md).</span><span class="sxs-lookup"><span data-stu-id="6dcaa-150">Use one flip model swap chain per [**HWND**](../winprog/windows-data-types.md).</span></span> <span data-ttu-id="6dcaa-151">Ne ciblez pas plusieurs chaînes de basculement de modèle vers le même **HWND**.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-151">Do not target multiple flip model swap chains to the same **HWND**.</span></span>
-   <span data-ttu-id="6dcaa-152">N’utilisez pas Flip Model swap Chain avec la fonction [**ScrollWindow**](/windows/win32/api/winuser/nf-winuser-scrollwindow) ou [**ScrollWindowEx**](/windows/win32/api/winuser/nf-winuser-scrollwindowex) de GDI.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-152">Do not use flip model swap chain with GDI's [**ScrollWindow**](/windows/win32/api/winuser/nf-winuser-scrollwindow) or [**ScrollWindowEx**](/windows/win32/api/winuser/nf-winuser-scrollwindowex) function.</span></span> <span data-ttu-id="6dcaa-153">Certaines applications Direct3D utilisent les fonctions **ScrollWindow** et **ScrollWindowEx** de GDI pour mettre à jour le contenu de la fenêtre après qu’un événement de défilement utilisateur s’est produit.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-153">Some Direct3D apps use GDI's **ScrollWindow** and **ScrollWindowEx** functions to update window contents after a user scroll event occurs.</span></span> <span data-ttu-id="6dcaa-154">**ScrollWindow** et **ScrollWindowEx** effectuent le bitblts du contenu des fenêtres à l’écran lorsque l’utilisateur fait défiler une fenêtre.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-154">**ScrollWindow** and **ScrollWindowEx** perform bitblts of window contents on screen as the user scrolls a window.</span></span> <span data-ttu-id="6dcaa-155">Ces fonctions nécessitent également des mises à jour du modèle BitBlt pour le contenu GDI et Direct3D.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-155">These functions also require bitblt model updates for GDI and Direct3D content.</span></span> <span data-ttu-id="6dcaa-156">Les applications qui utilisent l’une ou l’autre des fonctions n’affichent pas nécessairement le contenu visible des fenêtres à l’écran quand l’application est en mode fenêtre.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-156">Apps that use either function will not necessarily display visible window contents scrolling on screen when the app is in windowed mode.</span></span> <span data-ttu-id="6dcaa-157">Nous vous recommandons de ne pas utiliser les fonctions **ScrollWindow** et **ScrollWindowEx** de GDI, et à la place de redessiner le contenu GDI et Direct3D à l’écran en réponse au défilement.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-157">We recommend that you not use GDI's **ScrollWindow** and **ScrollWindowEx** functions, and instead redraw GDI and Direct3D contents on screen in response to scrolling.</span></span>
-   <span data-ttu-id="6dcaa-158">Utilisez Flip Model dans un [**HWND**](../winprog/windows-data-types.md) qui n’est pas également ciblé par d’autres API, y compris le modèle de présentation dxgi BitBlt, d’autres versions de Direct3D ou GDI.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-158">Use flip model in an [**HWND**](../winprog/windows-data-types.md) that is not also targeted by other APIs, including DXGI bitblt presentation model, other versions of Direct3D, or GDI.</span></span> <span data-ttu-id="6dcaa-159">Étant donné que le modèle BitBlt gère une copie supplémentaire de la surface, vous pouvez ajouter GDI et d’autres contenus Direct3D au même **HWND** par le biais de mises à jour ponctuelles à partir de Direct3D et GDI.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-159">Because bitblt model maintains an additional copy of the surface, you can add GDI and other Direct3D contents to the same **HWND** through piecemeal updates from Direct3D and GDI.</span></span> <span data-ttu-id="6dcaa-160">Lorsque vous utilisez le modèle de retournement, seul le contenu Direct3D dans le modèle de retournement de chaînes que le runtime passe à DWM est visible.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-160">When you use the flip model, only Direct3D content in flip model swap chains that the runtime passes to DWM are visible.</span></span> <span data-ttu-id="6dcaa-161">Le runtime ignore toutes les autres mises à jour du contenu Direct3D ou GDI du modèle BitBlt.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-161">The runtime ignores all other bitblt model Direct3D or GDI content updates.</span></span>

## <a name="frame-synchronization-of-dxgi-flip-model-apps"></a><span data-ttu-id="6dcaa-162">Synchronisation des frames des applications DXGI Flip Model</span><span class="sxs-lookup"><span data-stu-id="6dcaa-162">Frame synchronization of DXGI flip model apps</span></span>

<span data-ttu-id="6dcaa-163">Les statistiques présentent les informations de minutage des trames utilisées par les applications multimédias pour synchroniser les flux vidéo et audio et récupérer des problèmes de lecture vidéo.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-163">Present statistics are frame-timing information that media apps use to synchronize video and audio streams and recover from video playback glitches.</span></span> <span data-ttu-id="6dcaa-164">Les applications peuvent utiliser les informations de minutage de trame dans les statistiques actuelles pour ajuster la vitesse de présentation de leurs images vidéo pour une présentation plus lisse.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-164">Apps can use the frame-timing information in present statistics to adjust the presentation rate of their video frames for smoother presentation.</span></span> <span data-ttu-id="6dcaa-165">Pour obtenir les informations statistiques de présentation, appelez la méthode [**IDXGISwapChain :: GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics) pour obtenir la structure des [**\_ \_ statistiques du frame dxgi**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) .</span><span class="sxs-lookup"><span data-stu-id="6dcaa-165">To obtain present statistics information, call the [**IDXGISwapChain::GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics) method to obtain the [**DXGI\_FRAME\_STATISTICS**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) structure.</span></span> <span data-ttu-id="6dcaa-166">**Dxgi \_ Les \_ statistiques de frame** contiennent des statistiques sur [**IDXGISwapChain1 : les appels resent1 :P**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) .</span><span class="sxs-lookup"><span data-stu-id="6dcaa-166">**DXGI\_FRAME\_STATISTICS** contains statistics about [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) calls.</span></span> <span data-ttu-id="6dcaa-167">Une chaîne de permuter le modèle fournit des informations statistiques en mode fenêtre et plein écran.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-167">A flip model swap chain provides present statistics information in both windowed and full-screen modes.</span></span> <span data-ttu-id="6dcaa-168">Pour les chaînes d’échange de modèle BitBlt en mode fenêtre, toutes les valeurs des **\_ \_ statistiques de frame dxgi** sont des zéros.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-168">For bitblt model swap chains in windowed mode, all **DXGI\_FRAME\_STATISTICS** values are zeroes.</span></span>

<span data-ttu-id="6dcaa-169">Pour les statistiques de modèle de retournement, [**IDXGISwapChain :: GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics) retourne les **statistiques de \_ trame d’erreur dxgi \_ \_ \_ disjointes** dans les situations suivantes :</span><span class="sxs-lookup"><span data-stu-id="6dcaa-169">For flip model present statistics, [**IDXGISwapChain::GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics) returns **DXGI\_ERROR\_FRAME\_STATISTICS\_DISJOINT** in these situations:</span></span>

-   <span data-ttu-id="6dcaa-170">Premier appel à [**GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics), qui indique le début d’une séquence</span><span class="sxs-lookup"><span data-stu-id="6dcaa-170">First call to [**GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics), which indicates the beginning of a sequence</span></span>
-   <span data-ttu-id="6dcaa-171">Changement de mode : mode avec fenêtre, en mode plein écran ou plein écran pour les transitions en plein écran</span><span class="sxs-lookup"><span data-stu-id="6dcaa-171">Mode change: either windowed mode to or from full screen or full screen to full screen transitions</span></span>

<span data-ttu-id="6dcaa-172">Les valeurs des membres **PresentRefreshCount**, **SyncRefreshCount** et **SyncQPCTime** des [**\_ \_ statistiques de frame dxgi**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) présentent les caractéristiques suivantes :</span><span class="sxs-lookup"><span data-stu-id="6dcaa-172">The values in **PresentRefreshCount**, **SyncRefreshCount**, and **SyncQPCTime** members of [**DXGI\_FRAME\_STATISTICS**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) have the following characteristics:</span></span>

-   <span data-ttu-id="6dcaa-173">**PresentRefreshCount** est égal à **SyncRefreshCount** lorsque l’application présente sur chaque Vsync.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-173">**PresentRefreshCount** is equal to **SyncRefreshCount** when the app presents on every vsync.</span></span>
-   <span data-ttu-id="6dcaa-174">**SyncRefreshCount** est obtenu à l’intervalle Vsync lorsque le présent a été envoyé, **SyncQPCTime** est approximativement l’heure associée à l’intervalle de Vsync.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-174">**SyncRefreshCount** is obtained on the vsync interval when the present was submitted, **SyncQPCTime** is approximately the time associated with the vsync interval.</span></span>

<span data-ttu-id="6dcaa-175">La méthode [**IDXGISwapChain :: GetLastPresentCount**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getlastpresentcount) retourne le dernier nombre présent, autrement dit, l’ID actuel du dernier IDXGISwapChain1 réussi [**::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) appel effectué par un périphérique d’affichage associé à la chaîne de permutation.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-175">The [**IDXGISwapChain::GetLastPresentCount**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getlastpresentcount) method returns the last present count, that is, the present ID of the last successful [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) call made by a display device that is associated with the swap chain.</span></span> <span data-ttu-id="6dcaa-176">Cet ID est la valeur du membre **PresentCount** de la structure de [**\_ \_ statistiques de frame dxgi**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) .</span><span class="sxs-lookup"><span data-stu-id="6dcaa-176">This present ID is the value of the **PresentCount** member of the [**DXGI\_FRAME\_STATISTICS**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) structure.</span></span> <span data-ttu-id="6dcaa-177">Pour les chaînes de swap du modèle BitBlt, en mode fenêtre, toutes les valeurs des **\_ \_ statistiques de frame dxgi** sont des zéros.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-177">For bitblt model swap chains, while in windowed mode, all **DXGI\_FRAME\_STATISTICS** values are zeroes.</span></span>

## <a name="avoiding-detecting-and-recovering-from-glitches"></a><span data-ttu-id="6dcaa-178">Prévention, détection et récupération à partir de problèmes</span><span class="sxs-lookup"><span data-stu-id="6dcaa-178">Avoiding, detecting, and recovering from glitches</span></span>

<span data-ttu-id="6dcaa-179">Procédez comme suit pour éviter, détecter et récupérer des problèmes dans la présentation du cadre :</span><span class="sxs-lookup"><span data-stu-id="6dcaa-179">Perform these steps to avoid, detect, and recover from glitches in frame presentation:</span></span>

1.  <span data-ttu-id="6dcaa-180">Queue [**IDXGISwapChain1 ::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) appelle (autrement dit, appelez **IDXGISwapChain1 ::P resent1** plusieurs fois, ce qui entraîne leur collecte dans une file d’attente).</span><span class="sxs-lookup"><span data-stu-id="6dcaa-180">Queue [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) calls (that is, call **IDXGISwapChain1::Present1** multiple times, which causes them to collect in a queue).</span></span>
2.  <span data-ttu-id="6dcaa-181">Créez une structure de file d’attente présente pour stocker tous les [**:P IDXGISwapChain1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1)de mise à l’erreur de l’resent1 de l’ID actuel (retourné par [**IDXGISwapChain :: GetLastPresentCount**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getlastpresentcount)) et les valeurs de **PresentRefreshCount** associées, calculées/attendues.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-181">Create a present-queue structure to store all successfully submitted [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1)'s present ID (returned by [**IDXGISwapChain::GetLastPresentCount**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getlastpresentcount)) and associated, calculated/expected **PresentRefreshCount** values.</span></span>
3.  <span data-ttu-id="6dcaa-182">Pour détecter un problème :</span><span class="sxs-lookup"><span data-stu-id="6dcaa-182">To detect a glitch:</span></span>

    -   <span data-ttu-id="6dcaa-183">Appelez [**IDXGISwapChain :: GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics).</span><span class="sxs-lookup"><span data-stu-id="6dcaa-183">Call [**IDXGISwapChain::GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics).</span></span>
    -   <span data-ttu-id="6dcaa-184">Pour ce frame, récupérez l’ID actuel (**PresentCount**) et le nombre de Vsync où le système d’exploitation a présenté la dernière image au moniteur (**PresentRefreshCount**).</span><span class="sxs-lookup"><span data-stu-id="6dcaa-184">For this frame, get the present ID (**PresentCount**) and vsync count where the operating system presented the last image to the monitor (**PresentRefreshCount**).</span></span>
    -   <span data-ttu-id="6dcaa-185">Récupérez le **PresentRefreshCount** attendu qui est associé à l’ID présent et que vous avez précédemment stocké dans la structure de la file d’attente actuelle.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-185">Retrieve the expected **PresentRefreshCount** that is associated with the present ID and that you previously stored in the present-queue structure.</span></span>
    -   <span data-ttu-id="6dcaa-186">Si le **PresentRefreshCount** réel est postérieur au **PresentRefreshCount** attendu, un problème s’est produit.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-186">If the actual **PresentRefreshCount** is later than the expected **PresentRefreshCount**, a glitch has occurred.</span></span>

4.  <span data-ttu-id="6dcaa-187">Pour récupérer à partir du problème :</span><span class="sxs-lookup"><span data-stu-id="6dcaa-187">To recover from the glitch:</span></span>

    -   <span data-ttu-id="6dcaa-188">Calculez le nombre de trames à ignorer pour récupérer du problème.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-188">Calculate the number of frames to skip to recover from the glitch.</span></span> <span data-ttu-id="6dcaa-189">Par exemple, si l’étape 3 révèle que le nombre Vsync attendu (**PresentRefreshCount**) pour un ID actuel (**PresentCount**) est 5 et que le nombre réel de Vsync pour l’ID actuel est de 8, le nombre de frames à ignorer pour récupérer du problème est de 3 frames.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-189">For example, if step 3 reveals that the expected vsync count (**PresentRefreshCount**) for a present ID (**PresentCount**) is 5 and the actual vsync count for the present ID is 8, the number of frames to skip to recover from the glitch is 3 frames.</span></span>
    -   <span data-ttu-id="6dcaa-190">Passez 0 au paramètre *SyncInterval* dans ce nombre d’appels à [**IDXGISwapChain1 ::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) pour ignorer ce nombre de frames.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-190">Pass 0 to the *SyncInterval* parameter in this number of calls to [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) to discard and skip this number of frames.</span></span>

        > [!Note]  
        > <span data-ttu-id="6dcaa-191">Si le problème est constitué d’un grand nombre de frames, appelez [**IDXGISwapChain1 ::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) avec le paramètre *Flags* défini à [**dxgi \_ \_ restart**](dxgi-present.md) pour ignorer et ignorer tous les cadeaux en attente.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-191">If the glitch consists of a large number of frames, call [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) with the *Flags* parameter set to [**DXGI\_PRESENT\_RESTART**](dxgi-present.md) to discard and skip all outstanding queued presents.</span></span>

         

<span data-ttu-id="6dcaa-192">Voici un exemple de scénario de récupération à partir de défauts dans une présentation de cadre :</span><span class="sxs-lookup"><span data-stu-id="6dcaa-192">Here is an example scenario of recovering from glitches in frame presentation:</span></span>

![illustration d’un exemple de scénario de récupération à partir de défauts dans une présentation de cadre](images/frame-sync-glitch-recover.png)

<span data-ttu-id="6dcaa-194">Dans l’exemple de scénario, vous vous attendez à ce que frame A s’affiche à l’écran sur un nombre Vsync de 1.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-194">In the example scenario, you expect frame A to go on screen on a vsync count of 1.</span></span> <span data-ttu-id="6dcaa-195">Toutefois, vous détectez en fait le nombre de Vsync que le frame A affiche à l’écran 4.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-195">But you actually detect the vsync count that frame A appears on screen as 4.</span></span> <span data-ttu-id="6dcaa-196">Par conséquent, vous déterminez qu’un problème s’est produit.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-196">Therefore, you determine that a glitch occurred.</span></span> <span data-ttu-id="6dcaa-197">Vous pouvez ensuite ignorer 3 frames, autrement dit, vous pouvez passer 0 au paramètre *SyncInterval* dans 3 appels à [**IDXGISwapChain1 ::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span><span class="sxs-lookup"><span data-stu-id="6dcaa-197">You can then discard 3 frames, that is, you can pass 0 to the *SyncInterval* parameter in 3 calls to [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span></span> <span data-ttu-id="6dcaa-198">Dans l’exemple de scénario précédent, pour récupérer du problème, vous avez besoin d’un total de 8 **IDXGISwapChain1 ::P appels resent1** .</span><span class="sxs-lookup"><span data-stu-id="6dcaa-198">In the preceding example scenario, to recover from the glitch, you need a total of 8 **IDXGISwapChain1::Present1** calls.</span></span> <span data-ttu-id="6dcaa-199">Le 9e frame est ensuite visible selon le nombre de Vsync que vous attendez.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-199">The 9th frame is then visible as per the vsync count that you expect.</span></span>

<span data-ttu-id="6dcaa-200">Voici une chronologie des événements de présentation.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-200">Here's a time line of presentation events.</span></span> <span data-ttu-id="6dcaa-201">Chaque ligne verticale représente un Vsync.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-201">Each vertical line represents a vsync.</span></span> <span data-ttu-id="6dcaa-202">Le sens horizontal est l’heure, qui s’étend vers la droite.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-202">The horizontal direction is time, which increases to the right.</span></span> <span data-ttu-id="6dcaa-203">Vous pouvez utiliser la figure pour imaginer comment les problèmes peuvent se produire.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-203">You can use the figure to imagine how glitches can occur.</span></span>

![illustration d’une chronologie d’événements de présentation](images/present-timeline.png)

<span data-ttu-id="6dcaa-205">La figure illustre cette séquence :</span><span class="sxs-lookup"><span data-stu-id="6dcaa-205">The figure illustrates this sequence:</span></span>

1.  <span data-ttu-id="6dcaa-206">L’application est en éveil sur Vsync, restitue le bleu, appelle [**IDXGISwapChain1 ::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), puis revient en mode veille.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-206">The app wakes up on vsync, renders blue, calls [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), and then goes back to sleep.</span></span>
2.  <span data-ttu-id="6dcaa-207">L’unité de traitement graphique (GPU) sort de l’inactivité, effectue le rendu en bleu, puis revient en mode veille.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-207">The graphics processing unit (GPU) wakes up from idle, performs the render to blue, and then goes back to sleep.</span></span>
3.  <span data-ttu-id="6dcaa-208">Le DWM se réveille à la Vsync suivante, compose le bleu dans sa mémoire tampon d’arrière-plan, appelle [**IDXGISwapChain1 ::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), puis revient en mode veille.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-208">The DWM wakes up at the next vsync, composes blue into its back buffer, calls [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), and then goes back to sleep.</span></span>
4.  <span data-ttu-id="6dcaa-209">L’application est en éveil, restitue le vert, appelle [**IDXGISwapChain1 ::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), puis revient en mode veille.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-209">The app wakes up, renders green, calls [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), and then goes back to sleep.</span></span>
    > [!Note]  
    > <span data-ttu-id="6dcaa-210">L’application s’exécute simultanément pendant que le GPU effectue le compose du bleu.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-210">The app concurrently executes while the GPU performs the compose of blue.</span></span>

     

5.  <span data-ttu-id="6dcaa-211">Ensuite, le GPU restitue le vert pour l’application.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-211">Next, the GPU renders green for the app.</span></span>
6.  <span data-ttu-id="6dcaa-212">Enfin, le convertisseur numérique à analogique (DAC) affiche les résultats de la composition DWM sur le moniteur sur le Vsync suivant.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-212">Finally, the digital to analog converter (DAC) shows results of the DWM composition on the monitor on the next vsync.</span></span>

<span data-ttu-id="6dcaa-213">À partir de la chronologie, vous pouvez imaginer la latence des statistiques actuelles et la façon dont les problèmes peuvent se produire.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-213">From the time line, you can imagine the latency of present statistics and how glitches can occur.</span></span> <span data-ttu-id="6dcaa-214">Par exemple, pour afficher un problème DWM pour la couleur verte apparaissant à l’écran, Imaginez l’élargissement de la zone verte/rouge afin que le côté droit de la zone verte/rouge corresponde à l’extrémité droite de la zone violette/rouge.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-214">For example, to show a DWM glitch for the green color appearing on screen, imagine widening the green/red box so that the right side of the green/red box matches up to the right side of the purple/red box.</span></span> <span data-ttu-id="6dcaa-215">Dans ce scénario, la DAC affiche deux frames bleus, puis le cadre vert.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-215">In this scenario, the DAC shows two frames of blue and then the green frame.</span></span> <span data-ttu-id="6dcaa-216">Vous pouvez voir que ce problème s’est produit lors de la lecture des statistiques actuelles.</span><span class="sxs-lookup"><span data-stu-id="6dcaa-216">You can see that this glitch occurred from reading present statistics.</span></span>

## <a name="related-topics"></a><span data-ttu-id="6dcaa-217">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="6dcaa-217">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="6dcaa-218">Amélioration de la présentation avec le modèle de retournement, les rectangles modifiés et les zones défilantes</span><span class="sxs-lookup"><span data-stu-id="6dcaa-218">Enhancing presentation with the flip model, dirty rectangles, and scrolled areas</span></span>](dxgi-1-2-presentation-improvements.md)
</dt> </dl>

 

 
