---
title: MPIO (Multipath I/O) prend désormais en charge les blocs de demande de stockage étendu
description: MPIO (Multipath I/O) prend désormais en charge les blocs de demande de stockage étendu
ms.assetid: 5373D9ED-34AF-4D66-8888-49F1EBF768F4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f558f8088b5066b51447c5f2ea23edd5154d5c10
ms.sourcegitcommit: 46376be61d3fa308f9b1a06d7e2fa122a39755af
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/10/2020
ms.locfileid: "104316656"
---
# <a name="multipath-io-now-supports-extended-storage-request-blocks"></a><span data-ttu-id="032e1-103">MPIO (Multipath I/O) prend désormais en charge les blocs de demande de stockage étendu</span><span class="sxs-lookup"><span data-stu-id="032e1-103">Multipath I/O now supports extended storage request blocks</span></span>

## <a name="platforms"></a><span data-ttu-id="032e1-104">Plateformes</span><span class="sxs-lookup"><span data-stu-id="032e1-104">Platforms</span></span>

<span data-ttu-id="032e1-105">**Serveurs** – Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="032e1-105">**Servers** – Windows Server 2012</span></span> 

## <a name="description"></a><span data-ttu-id="032e1-106">Description</span><span class="sxs-lookup"><span data-stu-id="032e1-106">Description</span></span>

<span data-ttu-id="032e1-107">Dans Windows Server 2012, une nouvelle structure, le bloc de demande de stockage \_ \_ (SRB étendu) remplace \_ le \_ bloc de requête SCSI (SRB hérité) dans la pile de stockage de base.</span><span class="sxs-lookup"><span data-stu-id="032e1-107">In Windows Server 2012, a new structure, the STORAGE\_REQUEST\_BLOCK (extended SRB) replaces the SCSI\_REQUEST\_BLOCK (legacy SRB) in the core storage stack.</span></span> <span data-ttu-id="032e1-108">Les SRBs étendus répliquent les fonctionnalités des SRBs hérités, mais sont également extensibles et évolutives.</span><span class="sxs-lookup"><span data-stu-id="032e1-108">Extended SRBs replicate the functionality of the legacy SRBs, but are also extensible and scalable.</span></span>

<span data-ttu-id="032e1-109">MPIO (Multipath I/O) prend en charge les SRBs étendus et permet aux modules DSM (Device Specific modules) de spécifier également la prise en charge de SRB étendue.</span><span class="sxs-lookup"><span data-stu-id="032e1-109">Multipath I/O (MPIO) supports extended SRBs and allows Device Specific Modules (DSMs) to specify extended SRB support as well.</span></span> <span data-ttu-id="032e1-110">Toutefois, pour que la pile de stockage d’un appareil à chemins d’accès multiples utilise des SRBs étendus, **tous les composants de la pile doivent prendre en charge les SRBs étendus, y compris le module DSM**.</span><span class="sxs-lookup"><span data-stu-id="032e1-110">However, in order for a multipath device’s storage stack to use extended SRBs, **all components in the stack must support extended SRBs, including the DSM**.</span></span> <span data-ttu-id="032e1-111">Notez que le module de la compatibilité des boîtiers Microsoft, MSDSM, prend en charge les SRBs étendus.</span><span class="sxs-lookup"><span data-stu-id="032e1-111">Note that the Microsoft in-box DSM, MSDSM, does support extended SRBs.</span></span>

<span data-ttu-id="032e1-112">La \_ structure SCSI pass-through ne \_ \_ fait pas partie de la structure de transfert MPIO étendu, car la transmission SCSI étendue peut être de taille variable, en fonction du débogueur de ligne de commande (CDB).</span><span class="sxs-lookup"><span data-stu-id="032e1-112">The SCSI\_PASS\_THROUGH\_EX structure is not part of the extended MPIO pass through structure since the extended SCSI pass through can be of a variable size, depending on the command line debugger (CDB).</span></span> <span data-ttu-id="032e1-113">Au lieu de cela, le transfert MPIO étendu a un champ qui décrit le décalage entre le début de la structure de transfert MPIO étendu et \_ la \_ structure pass-through SCSI \_ .</span><span class="sxs-lookup"><span data-stu-id="032e1-113">Instead, the extended MPIO pass through has a field that describes the offset from the beginning of the extended MPIO pass through structure to the SCSI\_PASS\_THROUGH\_EX structure.</span></span> <span data-ttu-id="032e1-114">L’appelant doit s’assurer qu’il alloue une mémoire tampon de la taille appropriée et définir correctement le décalage de passage SCSI.</span><span class="sxs-lookup"><span data-stu-id="032e1-114">The caller must make sure they allocate a buffer of the appropriate size and set the SCSI pass through offset correctly.</span></span> <span data-ttu-id="032e1-115">Tant que l’appelant respecte les règles pour les passes SCSI étendues, il ne doit pas y avoir de travail supplémentaire pour utiliser le transfert MPIO étendu.</span><span class="sxs-lookup"><span data-stu-id="032e1-115">As long as the caller follows the rules for extended SCSI pass-throughs, then there should not be any extra work for them to use the extended MPIO pass through.</span></span>

> [!Note]  
> <span data-ttu-id="032e1-116">Si le module DSM ne prend pas en charge les SRBs étendus, MPIO échouera avec les demandes de transfert MPIO étendu qui ont l’indicateur \_ \_ \_ DSM IOCTL \_ défini.</span><span class="sxs-lookup"><span data-stu-id="032e1-116">If the DSM does not support extended SRBs, MPIO will fail extended MPIO pass through requests that have the MPIO\_IOCTL\_FLAG\_INVOLVE\_DSM flag set.</span></span>

 

## <a name="manifestation"></a><span data-ttu-id="032e1-117">Manifestation</span><span class="sxs-lookup"><span data-stu-id="032e1-117">Manifestation</span></span>

<span data-ttu-id="032e1-118">Si une partie de la pile de stockage de l’appareil, y compris le DSM, ne prend pas en charge les SRBs étendus, la pile de stockage est restaurée en utilisant des SRBs hérités.</span><span class="sxs-lookup"><span data-stu-id="032e1-118">If any part of the device’s storage stack, including DSM, does not support extended SRBs, the storage stack will revert to using legacy SRBs.</span></span>

## <a name="solution"></a><span data-ttu-id="032e1-119">Solution</span><span class="sxs-lookup"><span data-stu-id="032e1-119">Solution</span></span>

<span data-ttu-id="032e1-120">Il n’existe que deux exigences MPIO pour qu’un module DSM prenne en charge les blocs de demande de stockage \_ \_ :</span><span class="sxs-lookup"><span data-stu-id="032e1-120">There are only two MPIO requirements for a DSM to support STORAGE\_REQUEST\_BLOCKS:</span></span>

-   <span data-ttu-id="032e1-121">Le DSM doit signaler son type en tant que DsmType6</span><span class="sxs-lookup"><span data-stu-id="032e1-121">The DSM must report its type as DsmType6</span></span>
-   <span data-ttu-id="032e1-122">Le module DSM doit fournir la \_ \_ \_ fonction prise en charge du type d’adresse DSM</span><span class="sxs-lookup"><span data-stu-id="032e1-122">The DSM must provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function</span></span>

<span data-ttu-id="032e1-123">Si le DSM ne signale pas DsmType6 ou s’il signale DsmType6 mais ne fournit pas la \_ fonction de type d’adresse DSM \_ \_ prise en charge, MPIO suppose que le module DSM ne prend pas en charge les SRBs étendus.</span><span class="sxs-lookup"><span data-stu-id="032e1-123">If the DSM does not report DsmType6 or if it reports DsmType6 but does not provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function, MPIO will assume the DSM does not support extended SRBs.</span></span>

<span data-ttu-id="032e1-124">La \_ \_ fonction de type d’adresse DSM \_ pris en charge accepte deux paramètres, dont l’un est un type d’adresse.</span><span class="sxs-lookup"><span data-stu-id="032e1-124">The DSM\_ADDRESS\_TYPE\_SUPPORTED function accepts two parameters, one of which is an address type.</span></span> <span data-ttu-id="032e1-125">Ce type d’adresse doit être l’une des \_ valeurs de type d’adresse de stockage \_ \_ \* définies dans SRB. h.</span><span class="sxs-lookup"><span data-stu-id="032e1-125">This address type must be one of the STORAGE\_ADDRESS\_TYPE\_\* values defined in srb.h.</span></span> <span data-ttu-id="032e1-126">Le module DSM doit retourner la valeur TRUE s’il prend en charge le type d’adresse donné et FALSe dans le cas contraire.</span><span class="sxs-lookup"><span data-stu-id="032e1-126">The DSM must return TRUE if it supports the given address type and FALSE if it does not.</span></span> <span data-ttu-id="032e1-127">La définition de « support » correspond finalement au DSM.</span><span class="sxs-lookup"><span data-stu-id="032e1-127">The definition of “support” is ultimately up to the DSM.</span></span> <span data-ttu-id="032e1-128">MPIO utilise cette fonction pour s’assurer que le module DSM ne se comportera pas de façon incorrecte s’il reçoit un SRB étendu avec une \_ structure d’adresse Stor du type donné.</span><span class="sxs-lookup"><span data-stu-id="032e1-128">MPIO uses this function to ensure that the DSM will not misbehave if it is handed an extended SRB with a STOR\_ADDRESS structure of the given type.</span></span> <span data-ttu-id="032e1-129">Par conséquent, MPIO appelle généralement cette fonction lorsqu’un périphérique à chemins d’accès multiples est énuméré, mais que la fonction peut être appelée à tout moment.</span><span class="sxs-lookup"><span data-stu-id="032e1-129">As such, MPIO generally calls this function when a multipath device is being enumerated, but the function could be called at any time.</span></span>

<span data-ttu-id="032e1-130">Si un DSM ne touche pas l’adresse STOR d’un service SRB étendu \_ , il peut retourner la valeur true pour toute valeur de type d’adresse de stockage valide \_ \_ \_ \* .</span><span class="sxs-lookup"><span data-stu-id="032e1-130">If a DSM never touches an extended SRB’s STOR\_ADDRESS, then it can return TRUE for any valid STORAGE\_ADDRESS\_TYPE\_\* value.</span></span> <span data-ttu-id="032e1-131">Examinez l’exemple de DSM dans le kit WDK.</span><span class="sxs-lookup"><span data-stu-id="032e1-131">Review the sample DSM in the WDK.</span></span>

<span data-ttu-id="032e1-132">**Autres remarques importantes**</span><span class="sxs-lookup"><span data-stu-id="032e1-132">**Other important notes**</span></span>

-   <span data-ttu-id="032e1-133">Les DSM qui prennent en charge les SRBs étendus doivent pouvoir gérer à la fois les structures \_ \_ de bloc de requête SCSI et les structures de bloc de demande de stockage \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="032e1-133">DSMs that support extended SRBs must be able to handle both SCSI\_REQUEST\_BLOCK structures and STORAGE\_REQUEST\_BLOCK structures.</span></span> <span data-ttu-id="032e1-134">La seule raison pour laquelle un DSM signale qu’il prend en charge le SRBs étendu ne signifie pas qu’il recevra exclusivement des SRBs étendus.</span><span class="sxs-lookup"><span data-stu-id="032e1-134">Just because a DSM reports that it supports extended SRBs does not mean that it will exclusively receive extended SRBs.</span></span> <span data-ttu-id="032e1-135">Il peut toujours recevoir un nombre quelconque de SRBs hérités en plus des SRBs étendus, et doit donc être en mesure de gérer les deux.</span><span class="sxs-lookup"><span data-stu-id="032e1-135">It may still receive any number of legacy SRBs in addition to extended SRBs, and therefore must be able to handle both.</span></span>
-   <span data-ttu-id="032e1-136">Nous avons fourni un fichier d’en-tête dans le kit WDK appelé srbhelper. h, qui contient des fonctions inline pour aider les pilotes qui doivent gérer à la fois les SRBs étendus et les hérités.</span><span class="sxs-lookup"><span data-stu-id="032e1-136">We have provided a header file in the WDK called srbhelper.h that contains inline functions to help drivers that must handle both extended and legacy SRBs.</span></span> <span data-ttu-id="032e1-137">Notre exemple de DSM utilise cet en-tête, ce qui vous permet de l’utiliser comme exemple d’utilisation de ces fonctions.</span><span class="sxs-lookup"><span data-stu-id="032e1-137">Our sample DSM uses this header so you can use it as an example of how to use these functions.</span></span>
-   <span data-ttu-id="032e1-138">Un module DSM qui ne prend pas en charge les SRBs étendus ne doit jamais gérer les SRBs étendus.</span><span class="sxs-lookup"><span data-stu-id="032e1-138">A DSM that does not support extended SRBs will never have to handle extended SRBs.</span></span>
-   <span data-ttu-id="032e1-139">Il est possible qu’une MPIO fasse basculer la pile de stockage sur les SRBs hérités dans le cas où le DSM ne prend pas en charge un type d’adresse de stockage donné \_ \_ \_ \* (mais prend en charge les SRBs étendus).</span><span class="sxs-lookup"><span data-stu-id="032e1-139">It’s possible that a MPIO will cause the storage stack to fall back on legacy SRBs in the event that the DSM does not support a given STORAGE\_ADDRESS\_TYPE\_\* (but otherwise supports extended SRBs).</span></span>
-   <span data-ttu-id="032e1-140">« BTL8 » est le seul \_ \_ type d’adresse \_ \* de stockage actuellement défini pour Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="032e1-140">“BTL8” is the only STORAGE\_ADDRESS\_TYPE\_\*currently defined for Windows Server 2012.</span></span>

 

 




