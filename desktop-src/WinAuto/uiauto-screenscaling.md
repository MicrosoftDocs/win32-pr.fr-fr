---
title: Compréhension des problèmes de mise à l’échelle de l’écran
description: Windows Vista et les versions ultérieures du système d’exploitation permettent aux utilisateurs de modifier le paramètre de points par pouce (dpi) pour que la plupart des éléments d’interface utilisateur de l’écran apparaissent plus grands.
ms.assetid: 27dc49e7-2466-4ea3-a6d9-5ea86d6b4c60
keywords:
- clients, mise à l’échelle de l’écran UI Automation
- clients, mise à l’échelle de l’écran
- clients, mise à l’échelle
- UI Automation, mise à l’échelle de l’écran
- Automation d’interface utilisateur, mise à l’échelle
- mise à l’échelle de l’écran
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 05d790ee7747f258847cd23aea8bbbe8c25813fe
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104382480"
---
# <a name="understanding-screen-scaling-issues"></a><span data-ttu-id="2c9f9-109">Compréhension des problèmes de mise à l’échelle de l’écran</span><span class="sxs-lookup"><span data-stu-id="2c9f9-109">Understanding Screen Scaling Issues</span></span>

<span data-ttu-id="2c9f9-110">Windows Vista et les versions ultérieures du système d’exploitation permettent aux utilisateurs de modifier le paramètre de points par pouce (dpi) pour que la plupart des éléments d’interface utilisateur de l’écran apparaissent plus grands.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-110">Windows Vista and later versions of the operating system enable users to change the dots per inch (dpi) setting so that most UI elements on the screen appear larger.</span></span> <span data-ttu-id="2c9f9-111">Dans les versions antérieures de Windows, la mise à l’échelle devait être implémentée par les applications.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-111">In earlier versions of Windows, the scaling had to be implemented by applications.</span></span> <span data-ttu-id="2c9f9-112">Dans Windows Vista et versions ultérieures, le Gestionnaire de fenêtrage (DWM) effectue une mise à l’échelle par défaut pour toutes les applications qui ne gèrent pas leur propre mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-112">In Windows Vista and later, the Desktop Window Manager (DWM) performs default scaling for all applications that do not handle their own scaling.</span></span> <span data-ttu-id="2c9f9-113">Les applications clientes Microsoft UI Automation doivent prendre en compte cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-113">Microsoft UI Automation client applications must take this feature into account.</span></span>

<span data-ttu-id="2c9f9-114">Cette rubrique contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="2c9f9-114">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="2c9f9-115">Mise à l’échelle dans Windows Vista et versions ultérieures</span><span class="sxs-lookup"><span data-stu-id="2c9f9-115">Scaling in Windows Vista and Later</span></span>](#scaling-in-windows-vista-and-later)
-   [<span data-ttu-id="2c9f9-116">Mise à l’échelle dans les clients UI Automation</span><span class="sxs-lookup"><span data-stu-id="2c9f9-116">Scaling in UI Automation Clients</span></span>](#scaling-in-ui-automation-clients)

## <a name="scaling-in-windows-vista-and-later"></a><span data-ttu-id="2c9f9-117">Mise à l’échelle dans Windows Vista et versions ultérieures</span><span class="sxs-lookup"><span data-stu-id="2c9f9-117">Scaling in Windows Vista and Later</span></span>

<span data-ttu-id="2c9f9-118">Le paramètre PPP par défaut est 96, ce qui signifie que 96 pixels occupent la largeur ou la hauteur d’un pouce notionnel.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-118">The default dpi setting is 96, which means that 96 pixels occupy a width or height of one notional inch.</span></span> <span data-ttu-id="2c9f9-119">La mesure exacte d’un « pouce » dépend de la taille et de la résolution physique du moniteur.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-119">The exact measure of an "inch" depends on the size and physical resolution of the monitor.</span></span> <span data-ttu-id="2c9f9-120">Par exemple, sur un moniteur d’une largeur de 12 pouces, pour une résolution horizontale de 1 280 pixels, une ligne horizontale de 96 pixels s’étend sur 9/10e de pouce.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-120">For example, on a monitor 12 inches wide, at a horizontal resolution of 1280 pixels, a horizontal line of 96 pixels extends about 9/10 of an inch.</span></span>

<span data-ttu-id="2c9f9-121">La modification du paramètre PPP n’est pas la même que la modification de la résolution de l’écran.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-121">Changing the dpi setting is not the same as changing the screen resolution.</span></span> <span data-ttu-id="2c9f9-122">Avec la mise à l’échelle PPP, le nombre de pixels physiques sur l’écran reste le même.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-122">With dpi scaling, the number of physical pixels on the screen remains the same.</span></span> <span data-ttu-id="2c9f9-123">Toutefois, la mise à l’échelle est appliquée à la taille et à l’emplacement des éléments d’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-123">However, scaling is applied to the size and location of UI elements.</span></span> <span data-ttu-id="2c9f9-124">Cette mise à l’échelle peut être effectuée automatiquement par le DWM pour le bureau et pour les applications qui ne demandent pas explicitement à ne pas être mises à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-124">This scaling can be performed automatically by the DWM for the desktop and for applications that do not explicitly ask not to be scaled.</span></span>

<span data-ttu-id="2c9f9-125">En effet, lorsque l’utilisateur définit le facteur d’échelle sur 120 ppp, un pouce vertical ou horizontal sur l’écran augmente de 25%.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-125">In effect, when the user sets the scale factor to 120 dpi, a vertical or horizontal inch on the screen becomes bigger by 25 percent.</span></span> <span data-ttu-id="2c9f9-126">Toutes les dimensions sont ajustées en conséquence.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-126">All dimensions are scaled accordingly.</span></span> <span data-ttu-id="2c9f9-127">Le décalage d’une fenêtre d’application à partir du bord supérieur et du bord gauche de l’écran augmente de 25%.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-127">The offset of an application window from the top edge and left edge of the screen increases by 25 percent.</span></span> <span data-ttu-id="2c9f9-128">Si la mise à l’échelle de l’application est activée et que l’application n’a pas de prise en charge dpi, la taille de la fenêtre augmente dans la même proportion, avec les décalages et les tailles de tous les éléments d’interface qu’elle contient.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-128">If application scaling is enabled and the application is not dpi-aware, the size of the window increases in the same proportion, along with the offsets and sizes of all UI elements it contains.</span></span>

> [!Note]  
> <span data-ttu-id="2c9f9-129">Par défaut, le DWM n’effectue pas de mise à l’échelle pour les applications qui ne prennent pas en charge la résolution lorsque l’utilisateur définit la valeur PPP sur 120, mais effectue une mise à l’échelle lorsque la valeur PPP est définie sur 144 ou une valeur supérieure.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-129">By default, the DWM does not perform scaling for non-dpi-aware applications when the user sets the dpi to 120, but does perform scaling when the dpi is set to a custom value of 144 or higher.</span></span> <span data-ttu-id="2c9f9-130">Toutefois, l’utilisateur peut remplacer le comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-130">However, the user can override the default behavior.</span></span>

 

<span data-ttu-id="2c9f9-131">La mise à l’échelle de l’écran pose de nouveaux défis pour les applications qui sont concernées d’une manière ou d’une autre par les coordonnées d’écran.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-131">Screen scaling creates new challenges for applications that are concerned in any way with screen coordinates.</span></span> <span data-ttu-id="2c9f9-132">L’écran contient maintenant deux systèmes de coordonnées : l’un physique et l’autre logique.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-132">The screen now contains two coordinate systems: physical and logical.</span></span> <span data-ttu-id="2c9f9-133">Les coordonnées physiques d’un point correspondent au décalage réel, en pixels, par rapport à l’angle supérieur gauche du point d’origine.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-133">The physical coordinates of a point are the actual offset in pixels from the upper-left of the origin point.</span></span> <span data-ttu-id="2c9f9-134">Les coordonnées logiques correspondent aux décalages tels qu’ils seraient si les pixels eux-mêmes étaient mis à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-134">The logical coordinates are the offsets as they would be if the pixels themselves were scaled.</span></span>

<span data-ttu-id="2c9f9-135">Supposons que vous concevez une boîte de dialogue avec un bouton aux coordonnées (100, 48).</span><span class="sxs-lookup"><span data-stu-id="2c9f9-135">Suppose you design a dialog box with a button at coordinates (100, 48).</span></span> <span data-ttu-id="2c9f9-136">Lorsque cette boîte de dialogue est affichée avec la valeur par défaut de 96 dpi, le bouton se trouve aux coordonnées physiques de (100, 48).</span><span class="sxs-lookup"><span data-stu-id="2c9f9-136">When this dialog box is displayed at the default 96 dpi, the button is located at physical coordinates of (100, 48).</span></span> <span data-ttu-id="2c9f9-137">À 120 ppp, il se trouve aux coordonnées physiques de (125, 60).</span><span class="sxs-lookup"><span data-stu-id="2c9f9-137">At 120 dpi, it is located at physical coordinates of (125, 60).</span></span> <span data-ttu-id="2c9f9-138">Toutefois, les coordonnées logiques sont les mêmes à n’importe quel paramètre PPP : (100, 48).</span><span class="sxs-lookup"><span data-stu-id="2c9f9-138">But the logical coordinates are the same at any dpi setting: (100, 48).</span></span>

<span data-ttu-id="2c9f9-139">Les coordonnées logiques sont importantes, car elles rendent cohérent le comportement du système d’exploitation et des applications, quel que soit le paramètre PPP.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-139">Logical coordinates are important, because they make the behavior of the operating system and applications consistent, regardless of the dpi setting.</span></span> <span data-ttu-id="2c9f9-140">Par exemple, en général, la fonction [**GetCursorPos**](/windows/desktop/api/winuser/nf-winuser-getcursorpos) retourne les coordonnées logiques.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-140">For example, typically, the [**GetCursorPos**](/windows/desktop/api/winuser/nf-winuser-getcursorpos) function returns the logical coordinates.</span></span> <span data-ttu-id="2c9f9-141">Si vous déplacez le curseur sur un élément dans une boîte de dialogue, les mêmes coordonnées sont retournées, quel que soit le paramètre PPP.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-141">If you move the cursor over an element in a dialog box, the same coordinates are returned, regardless of the dpi setting.</span></span> <span data-ttu-id="2c9f9-142">Si vous dessinez un contrôle à l’emplacement (100, 100), il est dessiné à ces coordonnées logiques et occupera la même position relative à n’importe quel paramètre PPP.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-142">If you draw a control at (100, 100), it is drawn to those logical coordinates, and will occupy the same relative position at any dpi setting.</span></span>

## <a name="scaling-in-ui-automation-clients"></a><span data-ttu-id="2c9f9-143">Mise à l’échelle dans les clients UI Automation</span><span class="sxs-lookup"><span data-stu-id="2c9f9-143">Scaling in UI Automation Clients</span></span>

<span data-ttu-id="2c9f9-144">L’API UI Automation n’utilise pas de coordonnées logiques.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-144">The UI Automation API does not use logical coordinates.</span></span> <span data-ttu-id="2c9f9-145">Les méthodes et propriétés suivantes retournent des coordonnées physiques ou prennent des coordonnées physiques comme paramètres.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-145">The following methods and properties return physical coordinates or take physical coordinates as parameters.</span></span>

-   [<span data-ttu-id="2c9f9-146">**IUIAutomation::ElementFromPoint**</span><span class="sxs-lookup"><span data-stu-id="2c9f9-146">**IUIAutomation::ElementFromPoint**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-elementfrompoint)
-   [<span data-ttu-id="2c9f9-147">**IUIAutomation::ElementFromPointBuildCache**</span><span class="sxs-lookup"><span data-stu-id="2c9f9-147">**IUIAutomation::ElementFromPointBuildCache**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-elementfrompointbuildcache)
-   [<span data-ttu-id="2c9f9-148">**IUIAutomationElement::GetClickablePoint**</span><span class="sxs-lookup"><span data-stu-id="2c9f9-148">**IUIAutomationElement::GetClickablePoint**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getclickablepoint)
-   [<span data-ttu-id="2c9f9-149">**IUIAutomationElement::CurrentBoundingRectangle**</span><span class="sxs-lookup"><span data-stu-id="2c9f9-149">**IUIAutomationElement::CurrentBoundingRectangle**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-get_currentboundingrectangle)
-   [<span data-ttu-id="2c9f9-150">**IUIAutomationElement::CachedBoundingRectangle**</span><span class="sxs-lookup"><span data-stu-id="2c9f9-150">**IUIAutomationElement::CachedBoundingRectangle**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-get_cachedboundingrectangle)
-   [<span data-ttu-id="2c9f9-151">**IRawElementProviderFragment::BoundingRectangle**</span><span class="sxs-lookup"><span data-stu-id="2c9f9-151">**IRawElementProviderFragment::BoundingRectangle**</span></span>](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-irawelementproviderfragment-get_boundingrectangle)

<span data-ttu-id="2c9f9-152">Par défaut, les applications UI Automation qui s’exécutent dans un environnement qui n’a pas la valeur 96 ppp n’obtiendront pas les résultats corrects à partir de ces méthodes et propriétés.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-152">By default, UI Automation applications that are running in an environment that is not set to 96 dpi will not obtain correct results from these methods and properties.</span></span> <span data-ttu-id="2c9f9-153">Par exemple, étant donné que la position du curseur est en coordonnées logiques, le client ne peut pas passer ces coordonnées à [**IUIAutomation :: ElementFromPoint**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-elementfrompoint) pour obtenir l’élément qui se trouve sous le curseur.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-153">For example, because the cursor position is in logical coordinates, the client cannot pass these coordinates to [**IUIAutomation::ElementFromPoint**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-elementfrompoint) to obtain the element that is under the cursor.</span></span> <span data-ttu-id="2c9f9-154">En outre, l’application n’est pas en mesure de placer correctement les fenêtres en dehors de sa zone cliente.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-154">In addition, the application will not be able to correctly place windows outside its client area.</span></span>

<span data-ttu-id="2c9f9-155">La solution comporte deux parties.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-155">The solution has two parts.</span></span>

<span data-ttu-id="2c9f9-156">Tout d’abord, assurez-vous que l’application cliente prend en charge dpi.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-156">First, make the client application dpi-aware.</span></span> <span data-ttu-id="2c9f9-157">Pour ce faire, appelez la fonction [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) au démarrage.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-157">To do this, call the [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) function at startup.</span></span> <span data-ttu-id="2c9f9-158">Cette fonction rend la prise en charge DPI du processus entier, ce qui signifie que toutes les fenêtres qui appartiennent au processus ne sont pas mises à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="2c9f9-158">This function makes the entire process dpi-aware, meaning that all windows that belong to the process are unscaled.</span></span>

<span data-ttu-id="2c9f9-159">Deuxièmement, pour connaître les coordonnées du curseur, appelez la fonction [**GetPhysicalCursorPos**](/windows/desktop/api/winuser/nf-winuser-getphysicalcursorpos) .</span><span class="sxs-lookup"><span data-stu-id="2c9f9-159">Second, to get cursor coordinates, call the [**GetPhysicalCursorPos**](/windows/desktop/api/winuser/nf-winuser-getphysicalcursorpos) function.</span></span>

 

 