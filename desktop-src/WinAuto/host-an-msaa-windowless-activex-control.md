---
title: Comment héberger un contrôle ActiveX sans fenêtre MSAA
description: Découvrez comment créer un conteneur de contrôle qui peut héberger des contrôles Microsoft ActiveX sans fenêtre qui implémentent Microsoft Active Accessibility.
ms.assetid: 9497561C-37ED-4094-A6B0-C219F63C04B6
keywords:
- MSAA, contrôle ActiveX sans fenêtre
- Contrôle ActiveX sans fenêtre, MSAA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9de45313b19490af3c3fffb633f3822ad93d25a4
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103727524"
---
# <a name="how-to-host-an-msaa-windowless-activex-control"></a><span data-ttu-id="c3a7a-105">Comment héberger un contrôle ActiveX sans fenêtre MSAA</span><span class="sxs-lookup"><span data-stu-id="c3a7a-105">How to Host an MSAA Windowless ActiveX Control</span></span>

<span data-ttu-id="c3a7a-106">Découvrez comment créer un conteneur de contrôle qui peut héberger des contrôles Microsoft ActiveX sans fenêtre qui implémentent Microsoft Active Accessibility.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-106">Learn how to create a control container that can host windowless Microsoft ActiveX controls that implement Microsoft Active Accessibility.</span></span> <span data-ttu-id="c3a7a-107">En suivant les étapes décrites ici, vous pouvez vous assurer que tous les contrôles sans fenêtre basés sur Microsoft Active Accessibility hébergés dans votre conteneur de contrôle sont accessibles aux applications clientes de la technologie d’assistance (AT).</span><span class="sxs-lookup"><span data-stu-id="c3a7a-107">By following the steps described here, you can ensure that any Microsoft Active Accessibility-based windowless controls that are hosted in your control container are accessible to assistive technology (AT) client applications.</span></span>

## <a name="what-you-need-to-know"></a><span data-ttu-id="c3a7a-108">Ce que vous devez savoir</span><span class="sxs-lookup"><span data-stu-id="c3a7a-108">What you need to know</span></span>

### <a name="technologies"></a><span data-ttu-id="c3a7a-109">Technologies</span><span class="sxs-lookup"><span data-stu-id="c3a7a-109">Technologies</span></span>

-   [<span data-ttu-id="c3a7a-110">Contrôles ActiveX</span><span class="sxs-lookup"><span data-stu-id="c3a7a-110">ActiveX Controls</span></span>](/windows/desktop/com/activex-controls)
-   [<span data-ttu-id="c3a7a-111">Microsoft Active Accessibility</span><span class="sxs-lookup"><span data-stu-id="c3a7a-111">Microsoft Active Accessibility</span></span>](microsoft-active-accessibility.md)

### <a name="prerequisites"></a><span data-ttu-id="c3a7a-112">Prérequis</span><span class="sxs-lookup"><span data-stu-id="c3a7a-112">Prerequisites</span></span>

-   <span data-ttu-id="c3a7a-113">C/C++</span><span class="sxs-lookup"><span data-stu-id="c3a7a-113">C/C++</span></span>
-   <span data-ttu-id="c3a7a-114">Programmation Microsoft Win32 et COM (Component Object Model)</span><span class="sxs-lookup"><span data-stu-id="c3a7a-114">Microsoft Win32 and Component Object Model (COM) programming</span></span>
-   <span data-ttu-id="c3a7a-115">Contrôles ActiveX sans fenêtre</span><span class="sxs-lookup"><span data-stu-id="c3a7a-115">Windowless ActiveX controls</span></span>
-   <span data-ttu-id="c3a7a-116">Serveurs Microsoft Active Accessibility</span><span class="sxs-lookup"><span data-stu-id="c3a7a-116">Microsoft Active Accessibility servers</span></span>

## <a name="instructions"></a><span data-ttu-id="c3a7a-117">Instructions</span><span class="sxs-lookup"><span data-stu-id="c3a7a-117">Instructions</span></span>

### <a name="step-1-provide-the-root-iaccessible-interface-on-behalf-of-the-windowless-control"></a><span data-ttu-id="c3a7a-118">Étape 1 : fournissez l’interface IAccessible racine pour le compte du contrôle sans fenêtre.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-118">Step 1: Provide the root IAccessible interface on behalf of the windowless control.</span></span>

<span data-ttu-id="c3a7a-119">Chaque fois que le système a besoin du pointeur [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) pour la racine d’un contrôle sans fenêtre, le système interroge le conteneur de contrôle.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-119">Whenever the system needs the [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) pointer for the root of a windowless control, the system queries the control container.</span></span> <span data-ttu-id="c3a7a-120">Pour récupérer le pointeur, le conteneur appelle l’implémentation du contrôle sans fenêtre de la méthode [**IServiceProvider :: QueryService**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/cc678966(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="c3a7a-120">To retrieve the pointer, the container calls the windowless control's implementation of the [**IServiceProvider::QueryService**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/cc678966(v=vs.85)) method.</span></span>

<span data-ttu-id="c3a7a-121">Si le conteneur de contrôle a une implémentation Microsoft Active Accessibility, il peut retourner le pointeur [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) du contrôle sans fenêtre au système.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-121">If the control container has a Microsoft Active Accessibility implementation, it can return the windowless control's [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) pointer to the system.</span></span>

<span data-ttu-id="c3a7a-122">Si le conteneur de contrôle a une implémentation de Microsoft UI Automation, appelez la fonction [**UiaProviderFromIAccessible**](/windows/desktop/api/UIAutomationCoreApi/nf-uiautomationcoreapi-uiaproviderfromiaccessible) pour obtenir un pointeur d’interface [**IRawElementProviderSimple**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-irawelementprovidersimple) qui représente le contrôle, puis retournez le pointeur d’interface **IRawElementProviderSimple** au système.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-122">If the control container has a Microsoft UI Automation implementation, call the [**UiaProviderFromIAccessible**](/windows/desktop/api/UIAutomationCoreApi/nf-uiautomationcoreapi-uiaproviderfromiaccessible) function to obtain an [**IRawElementProviderSimple**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-irawelementprovidersimple) interface pointer that represents the control, and then return the **IRawElementProviderSimple** interface pointer to the system.</span></span>

### <a name="step-2-respond-to-the-wm_getobject-message-on-behalf-of-the-windowless-control"></a><span data-ttu-id="c3a7a-123">Étape 2 : répondre au message WM \_ GETOBJECT pour le compte du contrôle sans fenêtre.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-123">Step 2: Respond to the WM\_GETOBJECT message on behalf of the windowless control.</span></span>

<span data-ttu-id="c3a7a-124">Lorsqu’une application cliente répond à un WinEvent déclenché par un contrôle sans fenêtre, le conteneur de contrôle reçoit un message [**WM \_ GETOBJECT**](wm-getobject.md) pour le compte du contrôle.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-124">When a client application responds to a WinEvent raised by a windowless control, the control container receives a [**WM\_GETOBJECT**](wm-getobject.md) message on behalf of the control.</span></span> <span data-ttu-id="c3a7a-125">Le message contient l’ID d’objet du contrôle sans fenêtre qui a déclenché l’événement.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-125">The message includes the object ID of the windowless control that raised the event.</span></span>

<span data-ttu-id="c3a7a-126">Le conteneur de contrôle répond en recherchant le contrôle sans fenêtre qui « possède » l’ID de l’objet, puis en appelant la méthode [**IAccessibleHandler :: AccessibleObjectFromID**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessiblehandler-accessibleobjectfromid) de ce contrôle.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-126">The control container responds by looking up the windowless control that "owns" the object ID, and then calling that control's [**IAccessibleHandler::AccessibleObjectFromID**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessiblehandler-accessibleobjectfromid) method.</span></span> <span data-ttu-id="c3a7a-127">La méthode **AccessibleObjectFromID** retourne le pointeur d’interface [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) pour l’élément d’interface utilisateur, et le conteneur de contrôle retourne le pointeur vers le système, qui le transfère à l’application cliente.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-127">The **AccessibleObjectFromID** method returns the [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) interface pointer for the UI item, and the control container returns the pointer to the system, which forwards it to the client application.</span></span>

### <a name="step-3-implement-the-iaccessiblewindowlesssite-interface"></a><span data-ttu-id="c3a7a-128">Étape 3 : implémenter l’interface IAccessibleWindowlessSite.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-128">Step 3: Implement the IAccessibleWindowlessSite interface.</span></span>

1.  <span data-ttu-id="c3a7a-129">Implémentez la méthode [**IAccessibleWindowlessSite :: GetParentAccessible**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-getparentaccessible) .</span><span class="sxs-lookup"><span data-stu-id="c3a7a-129">Implement the [**IAccessibleWindowlessSite::GetParentAccessible**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-getparentaccessible) method.</span></span>

    <span data-ttu-id="c3a7a-130">Lorsqu’une application cliente a besoin d’informations d’accessibilité sur le parent du fournisseur racine du contrôle sans fenêtre, le système appelle la méthode [**IAccessible :: obtenir \_ accParent**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-get_accparent) du contrôle sans fenêtre.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-130">When a client application needs accessibility information about the parent of the windowless control's root provider, the system calls the windowless control's [**IAccessible::get\_accParent**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-get_accparent) method.</span></span> <span data-ttu-id="c3a7a-131">Le contrôle répond en appelant la méthode [**IAccessibleWindowlessSite :: GetParentAccessible**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-getparentaccessible) du conteneur de contrôle, qui fournit le pointeur [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) du parent du contrôle sans fenêtre.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-131">The control responds by calling the control container's [**IAccessibleWindowlessSite::GetParentAccessible**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-getparentaccessible) method, which provides the [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) pointer of the windowless control's parent.</span></span>

2.  <span data-ttu-id="c3a7a-132">Implémentez les méthodes [**IAccessibleWindowlessSite :: AcquireObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-acquireobjectidrange), [**QueryObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-queryobjectidranges)et [**ReleaseObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-releaseobjectidrange) .</span><span class="sxs-lookup"><span data-stu-id="c3a7a-132">Implement the [**IAccessibleWindowlessSite::AcquireObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-acquireobjectidrange), [**QueryObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-queryobjectidranges), and [**ReleaseObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-releaseobjectidrange) methods.</span></span>

    <span data-ttu-id="c3a7a-133">Votre conteneur de contrôle doit conserver un mappage des plages d’ID d’objet aux contrôles sans fenêtre.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-133">Your control container must maintain a mapping of object ID ranges to windowless controls.</span></span> <span data-ttu-id="c3a7a-134">Le mappage permet au conteneur de contrôle d’identifier le contrôle qui doit répondre à une demande particulière pour un ID d’objet.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-134">The mapping enables the control container to identify the control that should respond to a particular request for an object ID.</span></span> <span data-ttu-id="c3a7a-135">Le tableau suivant montre un exemple de mappage d’ID d’objet à des contrôles sans fenêtre.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-135">The following table shows an example of mapping object ID ranges to windowless controls.</span></span>

    

    | <span data-ttu-id="c3a7a-136">Base de plage</span><span class="sxs-lookup"><span data-stu-id="c3a7a-136">Range base</span></span> | <span data-ttu-id="c3a7a-137">Taille de la plage</span><span class="sxs-lookup"><span data-stu-id="c3a7a-137">Range size</span></span> | <span data-ttu-id="c3a7a-138">Contrôler</span><span class="sxs-lookup"><span data-stu-id="c3a7a-138">Control</span></span>   |
    |------------|------------|-----------|
    | <span data-ttu-id="c3a7a-139">1 000</span><span class="sxs-lookup"><span data-stu-id="c3a7a-139">1000</span></span>       | <span data-ttu-id="c3a7a-140">500</span><span class="sxs-lookup"><span data-stu-id="c3a7a-140">500</span></span>        | <span data-ttu-id="c3a7a-141">Contrôle 1</span><span class="sxs-lookup"><span data-stu-id="c3a7a-141">Control 1</span></span> |
    | <span data-ttu-id="c3a7a-142">1500</span><span class="sxs-lookup"><span data-stu-id="c3a7a-142">1500</span></span>       | <span data-ttu-id="c3a7a-143">1 000</span><span class="sxs-lookup"><span data-stu-id="c3a7a-143">1000</span></span>       | <span data-ttu-id="c3a7a-144">Contrôle 2</span><span class="sxs-lookup"><span data-stu-id="c3a7a-144">Control 2</span></span> |
    | <span data-ttu-id="c3a7a-145">2 500</span><span class="sxs-lookup"><span data-stu-id="c3a7a-145">2500</span></span>       | <span data-ttu-id="c3a7a-146">2000</span><span class="sxs-lookup"><span data-stu-id="c3a7a-146">2000</span></span>       | <span data-ttu-id="c3a7a-147">Contrôle 1</span><span class="sxs-lookup"><span data-stu-id="c3a7a-147">Control 1</span></span> |

    

     

    <span data-ttu-id="c3a7a-148">Le conteneur de contrôle doit conserver le mappage entre les plages d’ID d’objet et les contrôles sans fenêtre pour lui-même et tous les enfants sans fenêtre.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-148">The control container must maintain the mapping of object ID ranges to windowless controls for itself and all windowless children.</span></span> <span data-ttu-id="c3a7a-149">Les plages d’ID de l’objet n’ont pas besoin d’être adjacentes les unes aux autres.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-149">The object ID ranges do not need to be adjacent to one another.</span></span> <span data-ttu-id="c3a7a-150">En outre, pour éviter les attaques par déni de service, le conteneur de contrôle peut placer des limites sur le nombre de plages accordées à un contrôle particulier.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-150">Also, to avoid denial-of-service attacks, the control container can place limits on the number of ranges that are granted to a particular control.</span></span> <span data-ttu-id="c3a7a-151">Toutefois, il est utile d’autoriser plus d’une plage par contrôle pour permettre à un contrôle de croître.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-151">However, it is useful to allow more than one range per control, to enable a control to grow.</span></span>

### <a name="step-4-optional-implement-the-iaccessiblehostingelementproviders-interface"></a><span data-ttu-id="c3a7a-152">Étape 4 : facultatif : implémentez l’interface IAccessibleHostingElementProviders.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-152">Step 4: Optional: Implement the IAccessibleHostingElementProviders interface.</span></span>

<span data-ttu-id="c3a7a-153">Implémentez l’interface [**IAccessibleHostingElementProviders**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-iaccessiblehostingelementproviders) si votre conteneur de contrôle a une implémentation de Microsoft Active Accessibility Server et que le serveur est la racine d’une arborescence d’accessibilité qui inclut des contrôles ActiveX sans fenêtre qui prennent en charge l’Automation d’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-153">Implement the [**IAccessibleHostingElementProviders**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-iaccessiblehostingelementproviders) interface if your control container has a Microsoft Active Accessibility server implementation and the server is the root of an accessibility tree that includes windowless ActiveX controls that support UI Automation.</span></span> <span data-ttu-id="c3a7a-154">L’interface **IAccessibleHostingElementProviders** possède une méthode unique, [**GetEmbeddedFragmentRoots**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-irawelementproviderfragment-getembeddedfragmentroots), qui récupère les pointeurs d’interface [**IRawElementProviderFragmentRoot**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-irawelementproviderfragmentroot) de tous les contrôles ActiveX UI Automation qui sont hébergés par votre conteneur de contrôle.</span><span class="sxs-lookup"><span data-stu-id="c3a7a-154">The **IAccessibleHostingElementProviders** interface has a single method, [**GetEmbeddedFragmentRoots**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-irawelementproviderfragment-getembeddedfragmentroots), which retrieves the [**IRawElementProviderFragmentRoot**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-irawelementproviderfragmentroot) interface pointers of all UI Automation windowless ActiveX controls that are hosted by your control container.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c3a7a-155">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="c3a7a-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c3a7a-156">Comment héberger un contrôle ActiveX UI Automation sans fenêtre</span><span class="sxs-lookup"><span data-stu-id="c3a7a-156">How to Host a UI Automation Windowless ActiveX Control</span></span>](host-a-ui-automation-windowless-activex-control.md)
</dt> <dt>

[<span data-ttu-id="c3a7a-157">Accessibilité des contrôles ActiveX sans fenêtre</span><span class="sxs-lookup"><span data-stu-id="c3a7a-157">Windowless ActiveX Control Accessibility</span></span>](windowless-activex-control-accessibility.md)
</dt> </dl>

 

 