---
description: Une application serveur peut appeler la fonction CreateProcessAsUser pour créer un nouveau processus qui s’exécute dans un contexte de sécurité clients.
ms.assetid: bd416109-fe76-4d55-bc63-3ebbcf32b92a
title: Processus dans le contexte de sécurité du client
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 29c9bafb576bd0d195ae762c69be885ac32f1071
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "106529686"
---
# <a name="processes-in-the-client-security-context"></a><span data-ttu-id="8dbe8-103">Processus dans le contexte de sécurité du client</span><span class="sxs-lookup"><span data-stu-id="8dbe8-103">Processes in the Client Security Context</span></span>

<span data-ttu-id="8dbe8-104">Une application serveur peut appeler la fonction [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) pour créer un nouveau processus qui s’exécute dans le [*contexte de sécurité*](/windows/desktop/SecGloss/s-gly)d’un client.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-104">A server application can call the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function to create a new process that runs in a client's [*security context*](/windows/desktop/SecGloss/s-gly).</span></span> <span data-ttu-id="8dbe8-105">Lorsqu’elle est appelée avec un [*jeton d’accès*](/windows/desktop/SecGloss/a-gly)client, **CreateProcessAsUser** requiert le \_ nom du ASSIGNPRIMARYTOKEN se et les privilèges d' \_ \_ augmentation \_ des noms de quotas \_ , qui sont conservés par les services Windows exécutés dans le [compte LocalSystem](/windows/desktop/Services/localsystem-account).</span><span class="sxs-lookup"><span data-stu-id="8dbe8-105">When called with a client's [*access token*](/windows/desktop/SecGloss/a-gly), **CreateProcessAsUser** requires the SE\_ASSIGNPRIMARYTOKEN\_NAME and SE\_INCREASE\_QUOTA\_NAME privileges, which are held by Windows services running in the [LocalSystem Account](/windows/desktop/Services/localsystem-account).</span></span>

<span data-ttu-id="8dbe8-106">La fonction [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) requiert également un [*jeton d’accès principal*](/windows/desktop/SecGloss/p-gly).</span><span class="sxs-lookup"><span data-stu-id="8dbe8-106">The [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function also requires a [*primary access token*](/windows/desktop/SecGloss/p-gly).</span></span> <span data-ttu-id="8dbe8-107">Un serveur peut obtenir un jeton d’accès principal pour un client en [démarrant une session de connexion](client-logon-sessions.md) pour le client ou en [usurpant l’identité du client](client-impersonation.md) et en dupliquant le [*jeton d’emprunt d’identité*](/windows/desktop/SecGloss/i-gly).</span><span class="sxs-lookup"><span data-stu-id="8dbe8-107">A server can get a primary access token for a client either by [starting a logon session](client-logon-sessions.md) for the client or by [impersonating the client](client-impersonation.md) and duplicating the [*impersonation token*](/windows/desktop/SecGloss/i-gly).</span></span>

<span data-ttu-id="8dbe8-108">Les procédures suivantes décrivent deux façons de créer un processus client.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-108">The following procedures describe two ways to create a client process.</span></span>

<span data-ttu-id="8dbe8-109">**Pour créer un processus client en ouvrant une session sur le client**</span><span class="sxs-lookup"><span data-stu-id="8dbe8-109">**To create a client process by logging on to the client**</span></span>

1.  <span data-ttu-id="8dbe8-110">Consignez le client sur l’ordinateur local à l’aide des [*informations d’identification*](/windows/desktop/SecGloss/c-gly) du client dans un appel à [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera).</span><span class="sxs-lookup"><span data-stu-id="8dbe8-110">Log the client on to the local computer using the client's [*credentials*](/windows/desktop/SecGloss/c-gly) in a call to [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera).</span></span> <span data-ttu-id="8dbe8-111">**LogonUser** produit un jeton principal pour la session de [*connexion*](/windows/desktop/SecGloss/l-gly)du client.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-111">**LogonUser** produces a primary token for the client's [*logon session*](/windows/desktop/SecGloss/l-gly).</span></span>
2.  <span data-ttu-id="8dbe8-112">Si le serveur doit utiliser le contexte de sécurité du client, accédez au fichier exécutable du [*processus*](/windows/desktop/SecGloss/p-gly) client à l’aide du jeton principal dans un appel à la fonction [**ImpersonateLoggedOnUser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) .</span><span class="sxs-lookup"><span data-stu-id="8dbe8-112">If the server needs to use the client's security context, get access to the executable file for the client [*process*](/windows/desktop/SecGloss/p-gly) by using the primary token in a call to the [**ImpersonateLoggedOnUser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) function.</span></span>
3.  <span data-ttu-id="8dbe8-113">Créez un processus dans le contexte de sécurité du client à l’aide du jeton principal dans un appel à [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera).</span><span class="sxs-lookup"><span data-stu-id="8dbe8-113">Create a process in the client's security context by using the primary token in a call to [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera).</span></span>

> [!Note]  
> <span data-ttu-id="8dbe8-114">Un processus créé à l’aide de la technique suivante peut ne pas être en mesure d’accéder aux ressources réseau, sauf s’il dispose des [*informations d’identification*](/windows/desktop/SecGloss/c-gly)du client.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-114">A process created by using the following technique may not be able to access network resources unless it has the client's [*credentials*](/windows/desktop/SecGloss/c-gly).</span></span>

 

<span data-ttu-id="8dbe8-115">**Pour créer un processus client en empruntant l’identité du client**</span><span class="sxs-lookup"><span data-stu-id="8dbe8-115">**To create a client process by impersonating the client**</span></span>

1.  <span data-ttu-id="8dbe8-116">Démarrez l’emprunt d’identité à l’aide d’une fonction d’emprunt d’identité, telle que [**ImpersonateNamedPipeClient**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-impersonatenamedpipeclient).</span><span class="sxs-lookup"><span data-stu-id="8dbe8-116">Start the impersonation by using an impersonation function, such as [**ImpersonateNamedPipeClient**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-impersonatenamedpipeclient).</span></span>
2.  <span data-ttu-id="8dbe8-117">Appelez la fonction [**OpenThreadToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) pour récupérer un jeton d’emprunt d’identité qui a le contexte de sécurité du client.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-117">Call the [**OpenThreadToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) function to get an impersonation token that has the security context of the client.</span></span>
3.  <span data-ttu-id="8dbe8-118">Appelez la fonction [**DuplicateTokenEx**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex) pour convertir le jeton d’emprunt d’identité en jeton principal.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-118">Call the [**DuplicateTokenEx**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex) function to convert the impersonation token into a primary token.</span></span>
4.  <span data-ttu-id="8dbe8-119">Utilisez le jeton principal dans un appel à la fonction [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) pour créer un processus dans le contexte de sécurité du client.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-119">Use the primary token in a call to the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function to create a process in the client's security context.</span></span>

<span data-ttu-id="8dbe8-120">Par défaut, [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) crée le [*processus*](/windows/desktop/SecGloss/p-gly) client sur un poste de travail et une station Windows non interactive.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-120">By default, [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) creates the client [*process*](/windows/desktop/SecGloss/p-gly) on a noninteractive window station and desktop.</span></span> <span data-ttu-id="8dbe8-121">Pour créer un processus interactif, le serveur doit d’abord définir les listes de contrôle d’accès discrétionnaire (DACL, [*Discretionary Access Control List*](/windows/desktop/SecGloss/d-gly) ) de la station et du bureau interactif pour s’assurer que le client est autorisé à y accéder.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-121">To create an interactive process, the server must first set the [*discretionary access control lists*](/windows/desktop/SecGloss/d-gly) (DACLs) of the interactive window station and desktop to ensure that the client is allowed access to them.</span></span> <span data-ttu-id="8dbe8-122">Pour ce faire, la meilleure méthode consiste à enregistrer le client sur, à [récupérer l’identificateur de sécurité (SID) de la session de connexion du client](/previous-versions//aa446670(v=vs.85)), puis à utiliser ce SID dans les ACE access-allowed sur le poste de travail et la station de fenêtre interactive.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-122">The preferred way to do this is to log the client on, [get the security identifier (SID) of the client's logon session](/previous-versions//aa446670(v=vs.85)), and then use that SID in access-allowed ACEs on both the interactive window station and desktop.</span></span> <span data-ttu-id="8dbe8-123">Le serveur peut ensuite appeler **CreateProcessAsUser**, en spécifiant la station de fenêtre interactive et le winsta0 de bureau \\ par défaut.</span><span class="sxs-lookup"><span data-stu-id="8dbe8-123">The server can then call **CreateProcessAsUser**, specifying the interactive window station and desktop winsta0\\default.</span></span> <span data-ttu-id="8dbe8-124">Pour obtenir un exemple qui illustre cette procédure, consultez [démarrage d’un processus client interactif en C++](/previous-versions//aa379608(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="8dbe8-124">For an example that shows this procedure, see [Starting an Interactive Client Process in C++](/previous-versions//aa379608(v=vs.85)).</span></span>

 

 
