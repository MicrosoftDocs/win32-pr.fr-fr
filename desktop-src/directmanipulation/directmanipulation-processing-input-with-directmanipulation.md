---
description: Cette section fournit une vue d’ensemble du modèle de thread de manipulation directe, du mode de traitement des messages de fenêtre par manipulation directe et de la façon dont l’état d’une fenêtre d’affichage est modifié à mesure qu’une entrée est mappée aux mouvements de sortie.
ms.assetid: 0818E34E-990E-4C36-9954-EF87EB226AF6
title: Traitement des entrées avec DirectManipulation
ms.topic: article
ms.date: 02/03/2020
ms.openlocfilehash: 284a0a1866a2082e2c34c65de347b0dcdfab3a64
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/06/2021
ms.locfileid: "106536939"
---
# <a name="processing-input-with-directmanipulation"></a><span data-ttu-id="4f223-103">Traitement des entrées avec DirectManipulation</span><span class="sxs-lookup"><span data-stu-id="4f223-103">Processing input with DirectManipulation</span></span>

<span data-ttu-id="4f223-104">Cette section fournit une vue d’ensemble du modèle de thread de [manipulation directe](direct-manipulation-portal.md) , du mode de traitement des messages de fenêtre par manipulation directe et de la façon dont l’état d’une fenêtre d’affichage est modifié à mesure qu’une entrée est mappée aux mouvements de sortie.</span><span class="sxs-lookup"><span data-stu-id="4f223-104">This section provides an overview of the [Direct Manipulation](direct-manipulation-portal.md) threading model, how window messages are processed by Direct Manipulation, and how the state of a viewport changes as input is mapped to output motions.</span></span>

- [<span data-ttu-id="4f223-105">Workflow d’entrée</span><span class="sxs-lookup"><span data-stu-id="4f223-105">Input flow</span></span>](#input-flow)
- [<span data-ttu-id="4f223-106">Remarques</span><span class="sxs-lookup"><span data-stu-id="4f223-106">Remarks</span></span>](#remarks)

<span data-ttu-id="4f223-107">[La manipulation directe](direct-manipulation-portal.md) utilise deux threads pour coordonner les opérations asynchrones :</span><span class="sxs-lookup"><span data-stu-id="4f223-107">[Direct Manipulation](direct-manipulation-portal.md) uses two threads to coordinate asynchronous operations:</span></span>

<span data-ttu-id="4f223-108">*Thread d’interface utilisateur* : thread qui possède le **HWND** associé à l’entrée.</span><span class="sxs-lookup"><span data-stu-id="4f223-108">*UI thread* - the thread that owns the **HWND** associated with input.</span></span> <span data-ttu-id="4f223-109">Ce thread est propriétaire de l’initialisation de [la manipulation directe](direct-manipulation-portal.md).</span><span class="sxs-lookup"><span data-stu-id="4f223-109">This thread owns initialization of [Direct Manipulation](direct-manipulation-portal.md).</span></span> <span data-ttu-id="4f223-110">Le traitement des entrées de la souris et du clavier se produit également sur le thread d’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4f223-110">Mouse and keyboard input processing also happens on the UI thread.</span></span>

<span data-ttu-id="4f223-111">*Thread délégué* : thread créé et détenu par [manipulation directe](direct-manipulation-portal.md).</span><span class="sxs-lookup"><span data-stu-id="4f223-111">*Delegate thread* - the thread created and owned by [Direct Manipulation](direct-manipulation-portal.md).</span></span> <span data-ttu-id="4f223-112">Le traitement des entrées tactiles se produit sur le thread délégué.</span><span class="sxs-lookup"><span data-stu-id="4f223-112">Touch input processing happens on the delegate thread.</span></span>

## <a name="input-flow"></a><span data-ttu-id="4f223-113">Workflow d’entrée</span><span class="sxs-lookup"><span data-stu-id="4f223-113">Input flow</span></span>

<span data-ttu-id="4f223-114">Dans une configuration classique où le test de positionnement est effectué sur le thread d’interface utilisateur, les messages de fenêtre sont traités par [manipulation directe](direct-manipulation-portal.md) dans l’ordre suivant :</span><span class="sxs-lookup"><span data-stu-id="4f223-114">In a typical configuration where hit testing is done on the UI thread, window messages are processed by [Direct Manipulation](direct-manipulation-portal.md) in the following order:</span></span>

![Diagramme montrant l’ordre dans lequel les messages sont traités.](images/inputprocessing.png)

<span data-ttu-id="4f223-116">Pour une fenêtre d’affichage au repos :</span><span class="sxs-lookup"><span data-stu-id="4f223-116">For a viewport at rest:</span></span>

1. <span data-ttu-id="4f223-117">Une série de messages de fenêtre atteint le thread délégué.</span><span class="sxs-lookup"><span data-stu-id="4f223-117">A series of window messages reach the delegate thread.</span></span>
2. <span data-ttu-id="4f223-118">Les messages [WM_POINTERDOWN](../inputmsg/wm-pointerdown.md) et [DM_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) sont envoyés par le thread délégué au thread de test de positionnement indépendant (IHT).</span><span class="sxs-lookup"><span data-stu-id="4f223-118">[WM_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages are sent by the delegate thread to the Independent Hit Test (IHT) thread.</span></span>
3. <span data-ttu-id="4f223-119">Si [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) est appelé à partir du thread IHT, les messages peuvent être envoyés au thread d’interface utilisateur par le thread délégué, en fonction de la valeur du [**\_ \_ type de DIRECTMANIPULATION HITTEST**](/windows/win32/api/directmanipulation/ne-directmanipulation-directmanipulation_hittest_type) lors de l’appel de [**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget) .</span><span class="sxs-lookup"><span data-stu-id="4f223-119">If [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is called from the IHT thread, messages might get sent to the UI thread by the delegate thread, depending on the value of [**DIRECTMANIPULATION\_HITTEST\_TYPE**](/windows/win32/api/directmanipulation/ne-directmanipulation-directmanipulation_hittest_type) when [**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget) was called.</span></span>
4. <span data-ttu-id="4f223-120">Si [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) n’est pas appelé à partir du thread IHT, les messages sont toujours envoyés par le thread délégué au thread d’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4f223-120">If [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is not called from the IHT thread, messages are always sent by the delegate thread to the UI thread.</span></span>
5. <span data-ttu-id="4f223-121">Le client peut appeler [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) à partir du thread d’interface utilisateur pour permettre à la [manipulation directe](direct-manipulation-portal.md) de détecter une manipulation.</span><span class="sxs-lookup"><span data-stu-id="4f223-121">The client can call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) from the UI thread to let [Direct Manipulation](direct-manipulation-portal.md) detect a manipulation.</span></span>
6. <span data-ttu-id="4f223-122">Si une manipulation est détectée, la [manipulation directe](direct-manipulation-portal.md) envoie un message [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) pour notifier au client que l’entrée est gérée par manipulation directe.</span><span class="sxs-lookup"><span data-stu-id="4f223-122">If a manipulation is detected, [Direct Manipulation](direct-manipulation-portal.md) sends a [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) message to notify the client that the input is being handled by Direct Manipulation.</span></span> <span data-ttu-id="4f223-123">L’état de la fenêtre d’affichage est défini sur **en cours d’exécution** et la transformation de sortie est mise à jour.</span><span class="sxs-lookup"><span data-stu-id="4f223-123">The viewport status is set to **RUNNING** and the output transform will be updated.</span></span>
7. <span data-ttu-id="4f223-124">Si une interaction autre qu’une manipulation est détectée, la [manipulation directe](direct-manipulation-portal.md) envoie les messages restants au thread d’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4f223-124">If an interaction other than a manipulation is detected, [Direct Manipulation](direct-manipulation-portal.md) sends remaining messages to the UI thread.</span></span>

<span data-ttu-id="4f223-125">Pour une fenêtre d’affichage en mouvement (avec un État en cours d’exécution ou d’INERTIe), le message de fenêtre atteint d’abord le thread délégué, où la [manipulation directe](direct-manipulation-portal.md) effectue des tests sur toutes les fenêtres d’affichage en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="4f223-125">For a viewport in motion (with a status of RUNNING or INERTIA), the window message reaches the delegate thread first, where [Direct Manipulation](direct-manipulation-portal.md) hit tests against all running viewports.</span></span> <span data-ttu-id="4f223-126">La manipulation directe affecte automatiquement le contact aux fenêtres d’affichage appropriées identifiées par le test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="4f223-126">Direct Manipulation automatically assigns the contact to the appropriate viewports identified by hit testing.</span></span> <span data-ttu-id="4f223-127">L’état de la fenêtre d’affichage est RUNNING et la transformation de sortie est mise à jour.</span><span class="sxs-lookup"><span data-stu-id="4f223-127">The viewport status is RUNNING and the output transform will be updated.</span></span>

<span data-ttu-id="4f223-128">Dans certains cas, un thread d’interface utilisateur d’application peut être trop lent pour répondre au test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="4f223-128">In some cases, an application UI thread may be too slow to respond to hit testing.</span></span> <span data-ttu-id="4f223-129">Un thread de test de positionnement peut être utilisé ([**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget)) pour permettre au client de déplacer les messages [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) et [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) vers un thread spécifique afin d’autoriser le test de positionnement.</span><span class="sxs-lookup"><span data-stu-id="4f223-129">A hit test thread may be used ([**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget)) to allow the client to move [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages to a specific thread to allow for hit testing.</span></span>

## <a name="remarks"></a><span data-ttu-id="4f223-130">Notes</span><span class="sxs-lookup"><span data-stu-id="4f223-130">Remarks</span></span>

<span data-ttu-id="4f223-131">En règle générale, la [manipulation directe](direct-manipulation-portal.md) envoie uniquement des messages [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) et [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) au thread d’interface utilisateur, en préservant les messages ultérieurs en attendant une réponse du client.</span><span class="sxs-lookup"><span data-stu-id="4f223-131">Typically, [Direct Manipulation](direct-manipulation-portal.md) sends only [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages to the UI thread, withholding later messages while waiting for a response from the client.</span></span> <span data-ttu-id="4f223-132">Si le client appelle [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact), les seuls messages reçus par le thread d’interface utilisateur lorsqu’une manipulation est détectée sont [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) et [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md)et le [message WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md).</span><span class="sxs-lookup"><span data-stu-id="4f223-132">If the client calls [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact), the only messages the UI thread receives when a manipulation is detected are [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md), and [WM/_POINTERCAPTURECHANGED message](../inputmsg/wm-pointercapturechanged.md).</span></span>

<span data-ttu-id="4f223-133">Le client peut ne pas appeler [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) lors du traitement des messages [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) et [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) .</span><span class="sxs-lookup"><span data-stu-id="4f223-133">The client might not call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) when processing [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages.</span></span> <span data-ttu-id="4f223-134">Dans ce cas, la [manipulation directe](direct-manipulation-portal.md) envoie tous les messages au thread d’interface utilisateur sans analyser les messages pour voir s’il existe une manipulation.</span><span class="sxs-lookup"><span data-stu-id="4f223-134">In this case, [Direct Manipulation](direct-manipulation-portal.md) sends all messages to the UI thread without analyzing the messages to see if there is a manipulation.</span></span> <span data-ttu-id="4f223-135">Le client peut ensuite choisir n’importe quel point pour appeler **SetContact** et faire en sorte que la manipulation directe démarre la détection des manipulations et envoie des messages de [message WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) lorsqu’un message est détecté.</span><span class="sxs-lookup"><span data-stu-id="4f223-135">The client can then choose any point to call **SetContact** and have Direct Manipulation start detecting manipulations, and send [WM/_POINTERCAPTURECHANGED message](../inputmsg/wm-pointercapturechanged.md) messages when one is detected.</span></span>

<span data-ttu-id="4f223-136">**Windows 10 et versions ultérieures :** Vous pouvez choisir les manipulations que vous souhaitez gérer en appelant [**DeferContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationdefercontactservice-defercontact) avant d’appeler [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) sur un message [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) ou [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) .</span><span class="sxs-lookup"><span data-stu-id="4f223-136">**Windows 10 and later:** You can decide which manipulations you want to handle by calling [**DeferContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationdefercontactservice-defercontact) before calling [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) on a [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) or [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) message.</span></span> <span data-ttu-id="4f223-137">**DeferContact** garantit que tous les messages suivants sont envoyés au thread d’interface utilisateur pour la période spécifiée.</span><span class="sxs-lookup"><span data-stu-id="4f223-137">**DeferContact** ensures all subsequent messages are sent to the UI thread for the specified period of time.</span></span>
