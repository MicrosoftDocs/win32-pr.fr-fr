---
description: CNG fournit un modèle de stockage de clés privées qui permet de s’adapter aux demandes actuelles et futures de la création d’applications qui utilisent des fonctionnalités de chiffrement, telles que le chiffrement à clé publique ou privée, ainsi que les exigences de stockage du matériel de clé.
ms.assetid: 95e5750f-fdc5-41f3-a4ce-9593a7081e95
title: Stockage et récupération de clés
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5abfd6319353440c580d53990075a71613a1eba9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104320078"
---
# <a name="key-storage-and-retrieval"></a><span data-ttu-id="9e6b9-103">Stockage et récupération de clés</span><span class="sxs-lookup"><span data-stu-id="9e6b9-103">Key Storage and Retrieval</span></span>

-   [<span data-ttu-id="9e6b9-104">Architecture de stockage de clés</span><span class="sxs-lookup"><span data-stu-id="9e6b9-104">Key Storage Architecture</span></span>](#key-storage-architecture)
-   [<span data-ttu-id="9e6b9-105">Types de clés</span><span class="sxs-lookup"><span data-stu-id="9e6b9-105">Key Types</span></span>](#key-types)
-   [<span data-ttu-id="9e6b9-106">Algorithmes pris en charge</span><span class="sxs-lookup"><span data-stu-id="9e6b9-106">Supported Algorithms</span></span>](#supported-algorithms)
-   [<span data-ttu-id="9e6b9-107">Répertoires et fichiers de clé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-107">Key Directories and Files</span></span>](#key-directories-and-files)

## <a name="key-storage-architecture"></a><span data-ttu-id="9e6b9-108">Architecture de stockage de clés</span><span class="sxs-lookup"><span data-stu-id="9e6b9-108">Key Storage Architecture</span></span>

<span data-ttu-id="9e6b9-109">CNG fournit un modèle de stockage de clés privées qui permet de s’adapter aux demandes actuelles et futures de la création d’applications qui utilisent des fonctionnalités de chiffrement, telles que le chiffrement à clé publique ou privée, ainsi que les exigences de stockage du matériel de clé.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-109">CNG provides a model for private key storage that allows adapting to the current and future demands of creating applications that use cryptography features such as public or private key encryption, as well as the demands of the storage of key material.</span></span> <span data-ttu-id="9e6b9-110">Le routeur de stockage de clés est la routine centrale de ce modèle et est implémenté dans Ncrypt.dll.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-110">The key storage router is the central routine in this model and is implemented in Ncrypt.dll.</span></span> <span data-ttu-id="9e6b9-111">Une application accède aux fournisseurs de stockage de clés (KSP) sur le système via le routeur de stockage de clés, qui masque les détails, tels que l’isolation des clés, à la fois par l’application et le fournisseur de stockage.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-111">An application accesses the key storage providers (KSPs) on the system through the key storage router, which conceals details, such as key isolation, from both the application and the storage provider itself.</span></span> <span data-ttu-id="9e6b9-112">L’illustration suivante montre la conception et la fonction de l’architecture d’isolation de clé CNG.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-112">The following illustration shows the design and function of the CNG key isolation architecture.</span></span>

![fournisseur de stockage de clés CNG](images/cng-key-storage-provider.png)

<span data-ttu-id="9e6b9-114">Pour respecter les exigences de critères communs (CC), les clés à long terme doivent être isolées afin qu’elles ne soient jamais présentes dans le processus d’application.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-114">To comply with common criteria (CC) requirements, the long-lived keys must be isolated so that they are never present in the application process.</span></span> <span data-ttu-id="9e6b9-115">Le CNG prend actuellement en charge le stockage des clés privées asymétriques à l’aide du logiciel Microsoft KSP inclus avec Windows Server 2008 et Windows Vista et installé par défaut.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-115">CNG currently supports the storage of asymmetric private keys by using the Microsoft software KSP that is included with Windows Server 2008 and Windows Vista and installed by default.</span></span>

<span data-ttu-id="9e6b9-116">L’isolation de clé est activée par défaut dans Windows Server 2008 et Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-116">Key isolation is enabled by default in Windows Server 2008 and Windows Vista.</span></span> <span data-ttu-id="9e6b9-117">La fonctionnalité d’isolation de clé n’est pas disponible sur les plateformes antérieures à celles-ci.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-117">The key isolation feature is not available on platforms prior to these.</span></span> <span data-ttu-id="9e6b9-118">En outre, les KSP tiers ne sont pas chargés dans le service d’isolation de clé (processus LSA).</span><span class="sxs-lookup"><span data-stu-id="9e6b9-118">Also, third party KSPs are not loaded in the key isolation service (LSA process).</span></span> <span data-ttu-id="9e6b9-119">Seul le KSP Microsoft est chargé dans le service d’isolation de clé.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-119">Only the Microsoft KSP is loaded in the key isolation service.</span></span>

<span data-ttu-id="9e6b9-120">Le processus LSA est utilisé comme processus d’isolation de clé pour optimiser les performances.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-120">The LSA process is used as the key isolation process to maximize performance.</span></span> <span data-ttu-id="9e6b9-121">Tout accès aux clés privées passe par le routeur de stockage de clés, qui expose un ensemble complet de fonctions pour la gestion et l’utilisation des clés privées.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-121">All access to private keys goes through the key storage router, which exposes a comprehensive set of functions for managing and using private keys.</span></span>

<span data-ttu-id="9e6b9-122">CNG stocke la partie publique de la clé stockée séparément de la partie privée.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-122">CNG stores the public portion of the stored key separately from the private portion.</span></span> <span data-ttu-id="9e6b9-123">La partie publique d’une paire de clés est également gérée dans le service d’isolation de clé et est accessible à l’aide d’un appel de procédure distante (LRPC) local.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-123">The public portion of a key pair is also maintained in the key isolation service and is accessed by using local remote procedure call (LRPC).</span></span> <span data-ttu-id="9e6b9-124">Le routeur de stockage de clés utilise les appels LRPC lors de l’appel au processus d’isolation de clé.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-124">The key storage router uses LRPC when calling into the key isolation process.</span></span> <span data-ttu-id="9e6b9-125">Tout accès aux clés privées passe par le routeur de clé privée et est audité par CNG.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-125">All access to private keys goes through the private key router and is audited by CNG.</span></span>

<span data-ttu-id="9e6b9-126">Comme décrit ci-dessus, un large éventail de dispositifs de stockage matériel peut être pris en charge.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-126">As described above, a wide range of hardware storage devices can be supported.</span></span> <span data-ttu-id="9e6b9-127">Dans chaque cas, l’interface à tous ces périphériques de stockage est identique.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-127">In each case, the interface to all of these storage devices is identical.</span></span> <span data-ttu-id="9e6b9-128">Il comprend des fonctions permettant d’effectuer diverses opérations de clé privée, ainsi que des fonctions relatives au stockage et à la gestion des clés.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-128">It includes functions to perform various private key operations as well as functions that pertain to key storage and management.</span></span>

<span data-ttu-id="9e6b9-129">CNG fournit un ensemble d’API qui permettent de créer, de stocker et de récupérer des clés de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-129">CNG provides a set of APIs that are used to create, store, and retrieve cryptographic keys.</span></span> <span data-ttu-id="9e6b9-130">Pour obtenir la liste de ces API, consultez [fonctions de stockage de clés CNG](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="9e6b9-130">For a list of these APIs, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="key-types"></a><span data-ttu-id="9e6b9-131">Types de clés</span><span class="sxs-lookup"><span data-stu-id="9e6b9-131">Key Types</span></span>

<span data-ttu-id="9e6b9-132">CNG prend en charge les types de clés suivants :</span><span class="sxs-lookup"><span data-stu-id="9e6b9-132">CNG supports the following key types:</span></span>

-   <span data-ttu-id="9e6b9-133">Diffie-Hellman des clés publiques et privées.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-133">Diffie-Hellman public and private keys.</span></span>
-   <span data-ttu-id="9e6b9-134">Clés publiques et privées de l’algorithme de signature numérique (DSA, FIPS 186-2).</span><span class="sxs-lookup"><span data-stu-id="9e6b9-134">Digital Signature Algorithm (DSA, FIPS 186-2) public and private keys.</span></span>
-   <span data-ttu-id="9e6b9-135">\#Clés publiques et privées RSA (PKCS 1).</span><span class="sxs-lookup"><span data-stu-id="9e6b9-135">RSA (PKCS \#1) public and private keys.</span></span>
-   <span data-ttu-id="9e6b9-136">Plusieurs clés publiques et privées héritées (CryptoAPI).</span><span class="sxs-lookup"><span data-stu-id="9e6b9-136">Several legacy (CryptoAPI) public and private keys.</span></span>
-   <span data-ttu-id="9e6b9-137">Clés publiques et privées de chiffrement à courbe elliptique.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-137">Elliptic Curve Cryptography public and private keys.</span></span>

## <a name="supported-algorithms"></a><span data-ttu-id="9e6b9-138">Algorithmes pris en charge</span><span class="sxs-lookup"><span data-stu-id="9e6b9-138">Supported Algorithms</span></span>

<span data-ttu-id="9e6b9-139">CNG prend en charge les algorithmes de clé suivants.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-139">CNG supports the following key algorithms.</span></span>

| <span data-ttu-id="9e6b9-140">Algorithm</span><span class="sxs-lookup"><span data-stu-id="9e6b9-140">Algorithm</span></span> | <span data-ttu-id="9e6b9-141">Longueur de clé/hachage (bits)</span><span class="sxs-lookup"><span data-stu-id="9e6b9-141">Key/hash length (bits)</span></span>             |
|-----------|------------------------------------|
| <span data-ttu-id="9e6b9-142">RSA</span><span class="sxs-lookup"><span data-stu-id="9e6b9-142">RSA</span></span>       | <span data-ttu-id="9e6b9-143">512 à 16384, en incréments de 64 bits</span><span class="sxs-lookup"><span data-stu-id="9e6b9-143">512 to 16384, in 64 bit increments</span></span> |
| <span data-ttu-id="9e6b9-144">VA</span><span class="sxs-lookup"><span data-stu-id="9e6b9-144">DH</span></span>        | <span data-ttu-id="9e6b9-145">512 à 16384, en incréments de 64 bits</span><span class="sxs-lookup"><span data-stu-id="9e6b9-145">512 to 16384, in 64 bit increments</span></span> |
| <span data-ttu-id="9e6b9-146">DSA</span><span class="sxs-lookup"><span data-stu-id="9e6b9-146">DSA</span></span>       | <span data-ttu-id="9e6b9-147">512 à 1024, en incréments de 64 bits</span><span class="sxs-lookup"><span data-stu-id="9e6b9-147">512 to 1024, in 64 bit increments</span></span>  |
| <span data-ttu-id="9e6b9-148">ECDSA</span><span class="sxs-lookup"><span data-stu-id="9e6b9-148">ECDSA</span></span>     | <span data-ttu-id="9e6b9-149">P-256, P-384, P-521 (courbes NIST)</span><span class="sxs-lookup"><span data-stu-id="9e6b9-149">P-256, P-384, P-521 (NIST Curves)</span></span>  |
| <span data-ttu-id="9e6b9-150">ECDH</span><span class="sxs-lookup"><span data-stu-id="9e6b9-150">ECDH</span></span>      | <span data-ttu-id="9e6b9-151">P-256, P-384, P-521 (courbes NIST)</span><span class="sxs-lookup"><span data-stu-id="9e6b9-151">P-256, P-384, P-521 (NIST Curves)</span></span>  |
| <span data-ttu-id="9e6b9-152">MD2</span><span class="sxs-lookup"><span data-stu-id="9e6b9-152">MD2</span></span>       | <span data-ttu-id="9e6b9-153">128</span><span class="sxs-lookup"><span data-stu-id="9e6b9-153">128</span></span>                                |
| <span data-ttu-id="9e6b9-154">MD4</span><span class="sxs-lookup"><span data-stu-id="9e6b9-154">MD4</span></span>       | <span data-ttu-id="9e6b9-155">128</span><span class="sxs-lookup"><span data-stu-id="9e6b9-155">128</span></span>                                |
| <span data-ttu-id="9e6b9-156">MD5</span><span class="sxs-lookup"><span data-stu-id="9e6b9-156">MD5</span></span>       | <span data-ttu-id="9e6b9-157">128</span><span class="sxs-lookup"><span data-stu-id="9e6b9-157">128</span></span>                                |
| <span data-ttu-id="9e6b9-158">SHA-1</span><span class="sxs-lookup"><span data-stu-id="9e6b9-158">SHA-1</span></span>     | <span data-ttu-id="9e6b9-159">160</span><span class="sxs-lookup"><span data-stu-id="9e6b9-159">160</span></span>                                |
| <span data-ttu-id="9e6b9-160">SHA-256</span><span class="sxs-lookup"><span data-stu-id="9e6b9-160">SHA-256</span></span>   | <span data-ttu-id="9e6b9-161">256</span><span class="sxs-lookup"><span data-stu-id="9e6b9-161">256</span></span>                                |
| <span data-ttu-id="9e6b9-162">SHA-384</span><span class="sxs-lookup"><span data-stu-id="9e6b9-162">SHA-384</span></span>   | <span data-ttu-id="9e6b9-163">384</span><span class="sxs-lookup"><span data-stu-id="9e6b9-163">384</span></span>                                |
| <span data-ttu-id="9e6b9-164">SHA-512</span><span class="sxs-lookup"><span data-stu-id="9e6b9-164">SHA-512</span></span>   | <span data-ttu-id="9e6b9-165">512</span><span class="sxs-lookup"><span data-stu-id="9e6b9-165">512</span></span>                                |



 

## <a name="key-directories-and-files"></a><span data-ttu-id="9e6b9-166">Répertoires et fichiers de clé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-166">Key Directories and Files</span></span>

<span data-ttu-id="9e6b9-167">Les fournisseurs de services de chiffrement de clés privées Microsoft hérités de Microsoft stockent les clés privées dans les répertoires</span><span class="sxs-lookup"><span data-stu-id="9e6b9-167">The Microsoft legacy CryptoAPI CSPs store private keys in the following directories.</span></span>

| <span data-ttu-id="9e6b9-168">Type de clé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-168">Key type</span></span>                | <span data-ttu-id="9e6b9-169">Répertoires</span><span class="sxs-lookup"><span data-stu-id="9e6b9-169">Directories</span></span>                                                                                                                                                 |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="9e6b9-170">Utilisateur privé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-170">User private</span></span>            | <span data-ttu-id="9e6b9-171">% APPDATA% \\ Microsoft \\ crypto \\ RSA \\ *User sid*</span><span class="sxs-lookup"><span data-stu-id="9e6b9-171">%APPDATA%\\Microsoft\\Crypto\\RSA\\*User SID*</span></span>\\<br/><span data-ttu-id="9e6b9-172">% APPDATA% \\ SID de l' \\ \\ \\ *utilisateur* Microsoft crypto DSS</span><span class="sxs-lookup"><span data-stu-id="9e6b9-172">%APPDATA%\\Microsoft\\Crypto\\DSS\\*User SID*</span></span>\\<br/>                                                   |
| <span data-ttu-id="9e6b9-173">Système local privé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-173">Local system private</span></span>    | <span data-ttu-id="9e6b9-174">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ crypto \\ RSA \\ S-1-5-18</span><span class="sxs-lookup"><span data-stu-id="9e6b9-174">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-18</span></span>\\<br/><span data-ttu-id="9e6b9-175">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ crypto \\ DSS \\ S-1-5-18</span><span class="sxs-lookup"><span data-stu-id="9e6b9-175">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-18</span></span>\\<br/>   |
| <span data-ttu-id="9e6b9-176">Service local privé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-176">Local service private</span></span>   | <span data-ttu-id="9e6b9-177">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ crypto \\ RSA \\ S-1-5-19</span><span class="sxs-lookup"><span data-stu-id="9e6b9-177">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-19</span></span>\\<br/><span data-ttu-id="9e6b9-178">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ crypto \\ DSS \\ S-1-5-19</span><span class="sxs-lookup"><span data-stu-id="9e6b9-178">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-19</span></span>\\<br/>   |
| <span data-ttu-id="9e6b9-179">Service réseau privé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-179">Network service private</span></span> | <span data-ttu-id="9e6b9-180">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ crypto \\ RSA \\ S-1-5-20</span><span class="sxs-lookup"><span data-stu-id="9e6b9-180">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-20</span></span>\\<br/><span data-ttu-id="9e6b9-181">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ crypto \\ DSS \\ S-1-5-20</span><span class="sxs-lookup"><span data-stu-id="9e6b9-181">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-20</span></span>\\<br/>   |
| <span data-ttu-id="9e6b9-182">Privé partagé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-182">Shared private</span></span>          | <span data-ttu-id="9e6b9-183">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ crypto \\ RSA \\ MachineKeys</span><span class="sxs-lookup"><span data-stu-id="9e6b9-183">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\MachineKeys</span></span><br/><span data-ttu-id="9e6b9-184">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ crypto \\ DSS \\ MachineKeys</span><span class="sxs-lookup"><span data-stu-id="9e6b9-184">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\MachineKeys</span></span><br/> |



 

<span data-ttu-id="9e6b9-185">CNG stocke les clés privées dans les répertoires suivants.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-185">CNG stores private keys in the following directories.</span></span>

| <span data-ttu-id="9e6b9-186">Type de clé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-186">Key type</span></span>                | <span data-ttu-id="9e6b9-187">Répertoire</span><span class="sxs-lookup"><span data-stu-id="9e6b9-187">Directory</span></span>                                                          |
|-------------------------|--------------------------------------------------------------------|
| <span data-ttu-id="9e6b9-188">Utilisateur privé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-188">User private</span></span>            | <span data-ttu-id="9e6b9-189">% APPDATA% \\ des \\ clés de chiffrement Microsoft \\</span><span class="sxs-lookup"><span data-stu-id="9e6b9-189">%APPDATA%\\Microsoft\\Crypto\\Keys</span></span>                                 |
| <span data-ttu-id="9e6b9-190">Système local privé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-190">Local system private</span></span>    | <span data-ttu-id="9e6b9-191">% ALLUSERSPROFILE% de \\ données d’application \\ Microsoft \\ crypto \\ SystemKeys</span><span class="sxs-lookup"><span data-stu-id="9e6b9-191">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\SystemKeys</span></span> |
| <span data-ttu-id="9e6b9-192">Service local privé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-192">Local service private</span></span>   | <span data-ttu-id="9e6b9-193">% WINDIR% \\ ServiceProfiles \\ LocalService</span><span class="sxs-lookup"><span data-stu-id="9e6b9-193">%WINDIR%\\ServiceProfiles\\LocalService</span></span>                            |
| <span data-ttu-id="9e6b9-194">Service réseau privé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-194">Network service private</span></span> | <span data-ttu-id="9e6b9-195">% WINDIR% \\ ServiceProfiles \\ NetworkService</span><span class="sxs-lookup"><span data-stu-id="9e6b9-195">%WINDIR%\\ServiceProfiles\\NetworkService</span></span>                          |
| <span data-ttu-id="9e6b9-196">Privé partagé</span><span class="sxs-lookup"><span data-stu-id="9e6b9-196">Shared private</span></span>          | <span data-ttu-id="9e6b9-197">% ALLUSERSPROFILE% des \\ clés de \\ \\ chiffrement Microsoft des données d’application \\</span><span class="sxs-lookup"><span data-stu-id="9e6b9-197">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\Keys</span></span>       |



 

<span data-ttu-id="9e6b9-198">Voici quelques-unes des différences entre les conteneurs de clé CryptoAPI et CNG.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-198">The following are some of the differences between the CryptoAPI and CNG key containers.</span></span>

-   <span data-ttu-id="9e6b9-199">CNG utilise des noms de fichiers différents pour les fichiers de clé que les fichiers de clé créés par le Rsaenh.dll et Dssenh.dll les fournisseurs de services de chiffrement hérités.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-199">CNG uses different file names for key files than key files that are created by the Rsaenh.dll and Dssenh.dll legacy CSPs.</span></span> <span data-ttu-id="9e6b9-200">Les fichiers de clés hérités ont également l’extension. Key, mais les fichiers de clé CNG n’ont pas l’extension. Key.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-200">The legacy key files also have the .key extension, but CNG key files do not have the .key extension.</span></span>
-   <span data-ttu-id="9e6b9-201">CNG prend entièrement en charge les noms de conteneurs de clés Unicode. CNG utilise un hachage du nom de conteneur Unicode, tandis que CryptoAPI utilise un hachage du nom de conteneur ANSI.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-201">CNG fully supports Unicode key container names; CNG uses a hash of the Unicode container name, whereas CryptoAPI uses a hash of the ANSI container name.</span></span>
-   <span data-ttu-id="9e6b9-202">CNG est plus flexible en ce qui concerne les paires de clés RSA.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-202">CNG is more flexible with regard to RSA key pairs.</span></span> <span data-ttu-id="9e6b9-203">Par exemple, CNG prend en charge les exposants publics d’une longueur supérieure à 32 bits et prend en charge les clés dans lesquelles p et q sont des longueurs différentes.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-203">For example, CNG supports public exponents larger than 32-bits in length, and it supports keys in which p and q are different lengths.</span></span>
-   <span data-ttu-id="9e6b9-204">Dans CryptoAPI, le fichier de conteneur de clé est stocké dans un répertoire dont le nom est l’équivalent textuel du SID de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-204">In CryptoAPI, the key container file is stored in a directory whose name is the textual equivalent of the user's SID.</span></span> <span data-ttu-id="9e6b9-205">Ce n’est plus le cas dans CNG, ce qui élimine la difficulté de déplacer des utilisateurs d’un domaine à un autre sans perdre toutes leurs clés privées.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-205">This is no longer the case in CNG, which removes the difficulty of moving users from one domain to another without losing all of their private keys.</span></span>
-   <span data-ttu-id="9e6b9-206">Le KSP et les noms de clé CNG sont limités aux caractères Unicode du **\_ chemin d’accès maximal** .</span><span class="sxs-lookup"><span data-stu-id="9e6b9-206">The CNG KSP and key names are limited to **MAX\_PATH** Unicode characters.</span></span> <span data-ttu-id="9e6b9-207">Le fournisseur de services de chiffrement CryptoAPI et les noms de clé sont limités aux caractères ANSI du **\_ chemin d’accès maximal** .</span><span class="sxs-lookup"><span data-stu-id="9e6b9-207">The CryptoAPI CSP and key names are limited to **MAX\_PATH** ANSI characters.</span></span>
-   <span data-ttu-id="9e6b9-208">CNG offre des propriétés de clé définies par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-208">CNG offers the capability of user-defined key properties.</span></span> <span data-ttu-id="9e6b9-209">Les utilisateurs peuvent créer et associer des propriétés personnalisées à des clés et les stocker avec des clés persistantes.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-209">Users can create and associate custom properties with keys, and have them stored with persisted keys.</span></span>

<span data-ttu-id="9e6b9-210">Lors de la persistance d’une clé, CNG peut créer deux fichiers.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-210">When persisting a key, CNG can create two files.</span></span> <span data-ttu-id="9e6b9-211">Le premier fichier contient la clé privée dans le nouveau format CNG et est toujours créé.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-211">The first file contains the private key in the new CNG format and is always created.</span></span> <span data-ttu-id="9e6b9-212">Ce fichier n’est pas utilisable par les fournisseurs de services de chiffrement CryptoAPI hérités.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-212">This file is not usable by the legacy CryptoAPI CSPs.</span></span> <span data-ttu-id="9e6b9-213">Le deuxième fichier contient la même clé privée dans le conteneur de clé CryptoAPI hérité.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-213">The second file contains the same private key in the legacy CryptoAPI key container.</span></span> <span data-ttu-id="9e6b9-214">Le deuxième fichier est conforme au format et à l’emplacement utilisés par Rsaenh.dll.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-214">The second file conforms to the format and location used by Rsaenh.dll.</span></span> <span data-ttu-id="9e6b9-215">La création du deuxième fichier se produit uniquement si l’indicateur **\_ \_ de clé d’écriture NCRYPT de l’indicateur \_ de \_ \_ magasin \_ hérité** est spécifié lors de l’appel de la fonction [**NCryptFinalizeKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) pour finaliser une clé RSA.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-215">Creation of the second file only occurs if the **NCRYPT\_WRITE\_KEY\_TO\_LEGACY\_STORE\_FLAG** flag is specified when the [**NCryptFinalizeKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) function is called to finalize an RSA key.</span></span> <span data-ttu-id="9e6b9-216">Cette fonctionnalité n’est pas prise en charge pour les clés DSA et DH.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-216">This feature is not supported for DSA and DH keys.</span></span>

<span data-ttu-id="9e6b9-217">Lorsqu’une application tente d’ouvrir une clé persistante existante, CNG tente d’abord d’ouvrir le fichier CNG natif.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-217">When an application attempts to open an existing persisted key, CNG first attempts to open the native CNG file.</span></span> <span data-ttu-id="9e6b9-218">Si ce fichier n’existe pas, CNG tente de localiser une clé correspondante dans le conteneur de clé CryptoAPI hérité.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-218">If this file does not exist, then CNG attempts to locate a matching key in the legacy CryptoAPI key container.</span></span>

<span data-ttu-id="9e6b9-219">Lorsque vous déplacez ou copiez des clés CryptoAPI d’un ordinateur source vers un ordinateur cible avec Outil de migration utilisateur Windows (USMT), CNG ne parvient pas à accéder aux clés sur l’ordinateur cible.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-219">When you move or copy CryptoAPI keys from a source machine to a target machine with Windows User State Migration Tool (USMT), CNG will fail to access the keys on the target machine.</span></span> <span data-ttu-id="9e6b9-220">Pour accéder à ces clés migrées, vous devez utiliser l’CryptoAPI.</span><span class="sxs-lookup"><span data-stu-id="9e6b9-220">To access such migrated keys, you must use the CryptoAPI.</span></span>

 

 




