---
description: L’API CNG implémente un modèle de fournisseur extensible qui vous permet de charger un fournisseur en spécifiant l’algorithme de chiffrement requis plutôt qu’un fournisseur particulier.
ms.assetid: a88a089b-4afe-4201-96f7-97f19bce18a1
title: Programmation CNG classique
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1119da63ca1ea0613444b150914c06664f36c121
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103751660"
---
# <a name="typical-cng-programming"></a><span data-ttu-id="023e4-103">Programmation CNG classique</span><span class="sxs-lookup"><span data-stu-id="023e4-103">Typical CNG Programming</span></span>

<span data-ttu-id="023e4-104">L’API CNG implémente un modèle de fournisseur extensible qui vous permet de charger un fournisseur en spécifiant l’algorithme de chiffrement requis plutôt qu’un fournisseur particulier.</span><span class="sxs-lookup"><span data-stu-id="023e4-104">The CNG API implements an extensible provider model that lets you load a provider by specifying the required cryptographic algorithm rather than a particular provider.</span></span> <span data-ttu-id="023e4-105">L’avantage est qu’un fournisseur d’algorithme peut être remplacé ou mis à niveau et que vous n’aurez pas à modifier votre code de quelque façon que ce soit pour utiliser le nouveau fournisseur.</span><span class="sxs-lookup"><span data-stu-id="023e4-105">The advantage is that an algorithm provider can be replaced or upgraded and you will not have to change your code in any way to use the new provider.</span></span> <span data-ttu-id="023e4-106">En outre, si un algorithme est considéré comme non sécurisé à l’avenir, une version plus sécurisée de cet algorithme peut être installée sans affecter votre code.</span><span class="sxs-lookup"><span data-stu-id="023e4-106">Also, if some algorithm is determined to be unsafe in the future, a more secure version of that algorithm can be installed without affecting your code.</span></span> <span data-ttu-id="023e4-107">La plupart des API CNG requièrent un fournisseur ou un objet créé par un fournisseur.</span><span class="sxs-lookup"><span data-stu-id="023e4-107">Most of the CNG APIs require a provider or an object created by a provider.</span></span>

<span data-ttu-id="023e4-108">Les étapes typiques de l’utilisation de l’API CNG pour les opérations primitives de chiffrement sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="023e4-108">The typical steps involved in using the CNG API for cryptographic primitive operations are as follows:</span></span>

1.  <span data-ttu-id="023e4-109">Ouverture du fournisseur d’algorithme</span><span class="sxs-lookup"><span data-stu-id="023e4-109">Opening the Algorithm Provider</span></span>
2.  <span data-ttu-id="023e4-110">Obtention ou définition des propriétés de l’algorithme</span><span class="sxs-lookup"><span data-stu-id="023e4-110">Getting or Setting Algorithm Properties</span></span>
3.  <span data-ttu-id="023e4-111">Création ou importation d’une clé</span><span class="sxs-lookup"><span data-stu-id="023e4-111">Creating or Importing a Key</span></span>
4.  <span data-ttu-id="023e4-112">Exécution d’opérations de chiffrement</span><span class="sxs-lookup"><span data-stu-id="023e4-112">Performing Cryptographic Operations</span></span>
5.  <span data-ttu-id="023e4-113">Fermeture du fournisseur d’algorithme</span><span class="sxs-lookup"><span data-stu-id="023e4-113">Closing the Algorithm Provider</span></span>

<span data-ttu-id="023e4-114">Pour plus d’informations, consultez Exemples de programmation.</span><span class="sxs-lookup"><span data-stu-id="023e4-114">For more information, see Programming Examples.</span></span>

## <a name="opening-the-algorithm-provider"></a><span data-ttu-id="023e4-115">Ouverture du fournisseur d’algorithme</span><span class="sxs-lookup"><span data-stu-id="023e4-115">Opening the Algorithm Provider</span></span>

<span data-ttu-id="023e4-116">La fonction [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) fournit un handle de fournisseur d’algorithme qui est utilisé dans les API CNG ultérieures, telles que [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) ou [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span><span class="sxs-lookup"><span data-stu-id="023e4-116">The [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) function provides you with an algorithm provider handle that is used in subsequent CNG APIs, such as [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) or [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span></span>

## <a name="getting-or-setting-algorithm-properties"></a><span data-ttu-id="023e4-117">Obtention ou définition des propriétés de l’algorithme</span><span class="sxs-lookup"><span data-stu-id="023e4-117">Getting or Setting Algorithm Properties</span></span>

<span data-ttu-id="023e4-118">Vous pouvez utiliser le handle du fournisseur d’algorithme pour obtenir les détails d’implémentation de l’algorithme, tels que la taille de la clé ou le mode actuel de l’opération.</span><span class="sxs-lookup"><span data-stu-id="023e4-118">You can use the algorithm provider handle to get implementation details for the algorithm, such as the key size or the current mode of operation.</span></span> <span data-ttu-id="023e4-119">Vous utilisez la fonction [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) pour obtenir des propriétés spécifiques.</span><span class="sxs-lookup"><span data-stu-id="023e4-119">You use the [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) function to obtain specific properties.</span></span>

<span data-ttu-id="023e4-120">Vous pouvez également modifier les propriétés de l’algorithme.</span><span class="sxs-lookup"><span data-stu-id="023e4-120">You can also modify the properties of the algorithm.</span></span> <span data-ttu-id="023e4-121">Par exemple, si vous souhaitez utiliser le chaînage de chiffrement par bloc ECB avec AES, vous définissez la propriété **\_ \_ mode de chaînage bcrypt** d’un algorithme AES sur le **mode de \_ chaîne bcrypt \_ \_ BCE**. la propriété est affectée à toutes les clés AES créées à l’aide de ce handle d’algorithme, sans qu’il soit nécessaire de configurer chaque clé AES.</span><span class="sxs-lookup"><span data-stu-id="023e4-121">For example, If you want to use ECB block cipher chaining with AES, you set the **BCRYPT\_CHAINING\_MODE** property of an AES algorithm to **BCRYPT\_CHAIN\_MODE\_ECB**; the property is assigned to all AES keys created using this algorithm handle, without the need to configure each and every AES key.</span></span> <span data-ttu-id="023e4-122">Vous utilisez la fonction [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) pour modifier ces propriétés.</span><span class="sxs-lookup"><span data-stu-id="023e4-122">You use the [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) function to modify these properties.</span></span>

## <a name="creating-or-importing-a-key"></a><span data-ttu-id="023e4-123">Création ou importation d’une clé</span><span class="sxs-lookup"><span data-stu-id="023e4-123">Creating or Importing a Key</span></span>

<span data-ttu-id="023e4-124">Selon le type d’algorithme que vous utilisez, vous devrez peut-être créer ou charger une clé.</span><span class="sxs-lookup"><span data-stu-id="023e4-124">Depending on the type of algorithm you use, you may need to create or load a key.</span></span> <span data-ttu-id="023e4-125">Par exemple, la fonction [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) prend un handle de clé pour le premier paramètre.</span><span class="sxs-lookup"><span data-stu-id="023e4-125">For example, the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) function takes a key handle for the first parameter.</span></span> <span data-ttu-id="023e4-126">Si vous souhaitez que cette fonction chiffre les données avec un algorithme de chiffrement symétrique tel qu’AES, vous devez d’abord obtenir une clé.</span><span class="sxs-lookup"><span data-stu-id="023e4-126">If you want that function to encrypt data with a symmetric encryption algorithm such as AES, you must first obtain a key.</span></span> <span data-ttu-id="023e4-127">La façon dont vous obtenez la clé dépend du type d’algorithme utilisé et de la source de la clé.</span><span class="sxs-lookup"><span data-stu-id="023e4-127">How you obtain the key depends on the type of algorithm being used and the source of the key.</span></span>

<span data-ttu-id="023e4-128">Vous pouvez créer des clés éphémères avec les fonctions [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) et [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) .</span><span class="sxs-lookup"><span data-stu-id="023e4-128">You can create ephemeral keys with the [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) and [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) functions.</span></span> <span data-ttu-id="023e4-129">Vous pouvez également importer des clés éphémères à partir d’un objet BLOB de mémoire avec les fonctions [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) et [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) .</span><span class="sxs-lookup"><span data-stu-id="023e4-129">You can also import ephemeral keys from a memory BLOB with the [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) and [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) functions.</span></span>

<span data-ttu-id="023e4-130">Pour les clés persistantes, utilisez les fonctions de stockage de clés pour charger un fournisseur de stockage de clés, puis créez ou chargez les clés.</span><span class="sxs-lookup"><span data-stu-id="023e4-130">For persisted keys, you use the key storage functions to load a key storage provider, and then create or load the keys.</span></span> <span data-ttu-id="023e4-131">Vous pouvez également utiliser ces fonctions pour créer ou charger des clés éphémères en transmettant la **valeur null** pour tous les noms de conteneurs.</span><span class="sxs-lookup"><span data-stu-id="023e4-131">You can also use these functions to create or load ephemeral keys by passing **NULL** for any container names.</span></span> <span data-ttu-id="023e4-132">Pour plus d’informations sur les fonctions de stockage de clés, consultez [fonctions de stockage de clés CNG](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="023e4-132">For more information about the key storage functions, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="performing-cryptographic-operations"></a><span data-ttu-id="023e4-133">Exécution d’opérations de chiffrement</span><span class="sxs-lookup"><span data-stu-id="023e4-133">Performing Cryptographic Operations</span></span>

<span data-ttu-id="023e4-134">Vous êtes maintenant prêt à effectuer l’opération de chiffrement, comme le chiffrement ou le déchiffrement des données à l’aide des fonctions [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) ou [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) , respectivement.</span><span class="sxs-lookup"><span data-stu-id="023e4-134">You are now ready to perform the cryptographic operation, such as encrypting or decrypting data by using the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) or [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) functions, respectively.</span></span>

## <a name="closing-the-algorithm-provider"></a><span data-ttu-id="023e4-135">Fermeture du fournisseur d’algorithme</span><span class="sxs-lookup"><span data-stu-id="023e4-135">Closing the Algorithm Provider</span></span>

<span data-ttu-id="023e4-136">Lorsque le fournisseur n’est plus nécessaire, vous devez passer le handle à la fonction [**BCryptCloseAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) pour fermer le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="023e4-136">When the provider is no longer needed, you must pass the handle to the [**BCryptCloseAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) function to close the provider.</span></span> <span data-ttu-id="023e4-137">Cela amène le fournisseur à libérer toutes les ressources qui ont été allouées pour cette instance du fournisseur d’algorithme.</span><span class="sxs-lookup"><span data-stu-id="023e4-137">This causes the provider to release any resources that have been allocated for that algorithm provider instance.</span></span> <span data-ttu-id="023e4-138">Une fois qu’un descripteur de fournisseur est fermé, il ne peut pas être réutilisé.</span><span class="sxs-lookup"><span data-stu-id="023e4-138">After a provider handle is closed, it cannot be reused.</span></span>

<span data-ttu-id="023e4-139">Le chargement d’un fournisseur peut être un processus relativement fastidieux.</span><span class="sxs-lookup"><span data-stu-id="023e4-139">Loading a provider can be a relatively time-intensive process.</span></span> <span data-ttu-id="023e4-140">Par conséquent, vous devez mettre en cache tous les descripteurs de fournisseur que vous référencerez plusieurs fois pendant la durée de vie de votre application.</span><span class="sxs-lookup"><span data-stu-id="023e4-140">You should therefore cache any provider handles that you will reference multiple times during the lifetime of your application.</span></span>

## <a name="programming-examples"></a><span data-ttu-id="023e4-141">Exemples de programmation</span><span class="sxs-lookup"><span data-stu-id="023e4-141">Programming Examples</span></span>

<span data-ttu-id="023e4-142">Les exemples suivants décrivent comment effectuer des opérations de chiffrement spécifiques à l’aide de CNG.</span><span class="sxs-lookup"><span data-stu-id="023e4-142">The following examples describe how to perform specific cryptographic operations using CNG.</span></span>

-   [<span data-ttu-id="023e4-143">Création d’un hachage avec CNG</span><span class="sxs-lookup"><span data-stu-id="023e4-143">Creating a Hash with CNG</span></span>](creating-a-hash-with-cng.md)
-   [<span data-ttu-id="023e4-144">Signature de données avec CNG</span><span class="sxs-lookup"><span data-stu-id="023e4-144">Signing Data with CNG</span></span>](signing-data-with-cng.md)
-   [<span data-ttu-id="023e4-145">Chiffrement des données avec CNG</span><span class="sxs-lookup"><span data-stu-id="023e4-145">Encrypting Data with CNG</span></span>](encrypting-data-with-cng.md)

 

 



