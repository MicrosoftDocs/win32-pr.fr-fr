---
title: Méthodes recommandées pour l’infrastructure DirectX Graphics (DXGI)
description: Cet article aborde les principaux problèmes de Portage.
ms.assetid: 2df92ffe-1bfc-d682-2770-20cf0c831c9b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f576368674d05af74e3161d4251301ebc066a489
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104382412"
---
# <a name="directx-graphics-infrastructure-dxgi-best-practices"></a><span data-ttu-id="162f5-103">DirectX Graphics infrastructure (DXGI) : meilleures pratiques</span><span class="sxs-lookup"><span data-stu-id="162f5-103">DirectX Graphics Infrastructure (DXGI): Best Practices</span></span>

<span data-ttu-id="162f5-104">Microsoft DirectX Graphics infrastructure (DXGI) est un nouveau sous-système qui a été introduit avec Windows Vista, qui encapsule certaines des tâches de bas niveau requises par Direct3D 10, 10,1, 11 et 11,1.</span><span class="sxs-lookup"><span data-stu-id="162f5-104">Microsoft DirectX Graphics Infrastructure (DXGI) is a new subsystem that was introduced with Windows Vista that encapsulates some of the low-level tasks that are needed by Direct3D 10, 10.1, 11, and 11.1.</span></span> <span data-ttu-id="162f5-105">Du point de vue d’un programmeur Direct3D 9, DXGI englobe la majeure partie du code pour l’énumération, la création de chaîne d’échange et la présentation précédemment compressées dans les API Direct3D 9.</span><span class="sxs-lookup"><span data-stu-id="162f5-105">From the perspective of a Direct3D 9 programmer, DXGI encompasses most of the code for enumeration, swap-chain creation, and presentation that previously was packed into the Direct3D 9 APIs.</span></span> <span data-ttu-id="162f5-106">Lorsque vous portez une application sur DXGI et Direct3D 10. x et Direct3D 11. x, vous devez prendre en compte certaines considérations pour vous assurer que le processus s’exécute correctement.</span><span class="sxs-lookup"><span data-stu-id="162f5-106">When you port an app to DXGI and Direct3D 10.x and Direct3D 11.x, you need to take some considerations into account to ensure that the process runs smoothly.</span></span>

<span data-ttu-id="162f5-107">Cet article aborde les principaux problèmes de Portage.</span><span class="sxs-lookup"><span data-stu-id="162f5-107">This article discusses key porting issues.</span></span>

-   [<span data-ttu-id="162f5-108">Problèmes liés à l’écran complet</span><span class="sxs-lookup"><span data-stu-id="162f5-108">Full-Screen Issues</span></span>](#full-screen-issues)
-   [<span data-ttu-id="162f5-109">Moniteurs multiples</span><span class="sxs-lookup"><span data-stu-id="162f5-109">Multiple Monitors</span></span>](#multiple-monitors)
-   [<span data-ttu-id="162f5-110">Styles de fenêtre et DXGI</span><span class="sxs-lookup"><span data-stu-id="162f5-110">Window Styles and DXGI</span></span>](#window-styles-and-dxgi)
-   [<span data-ttu-id="162f5-111">Multithread et DXGI</span><span class="sxs-lookup"><span data-stu-id="162f5-111">Multithreading and DXGI</span></span>](#multithreading-and-dxgi)
-   [<span data-ttu-id="162f5-112">Gamma et DXGI</span><span class="sxs-lookup"><span data-stu-id="162f5-112">Gamma and DXGI</span></span>](#gamma-and-dxgi)
-   [<span data-ttu-id="162f5-113">DXGI 1,1</span><span class="sxs-lookup"><span data-stu-id="162f5-113">DXGI 1.1</span></span>](#dxgi-11)
-   [<span data-ttu-id="162f5-114">DXGI 1,2</span><span class="sxs-lookup"><span data-stu-id="162f5-114">DXGI 1.2</span></span>](#dxgi-12)

## <a name="full-screen-issues"></a><span data-ttu-id="162f5-115">Problèmes de Full-Screen</span><span class="sxs-lookup"><span data-stu-id="162f5-115">Full-Screen Issues</span></span>

<span data-ttu-id="162f5-116">Dans le portage de Direct3D 9 vers DXGI et vers Direct3D 10. x ou Direct3D 11. x, les problèmes liés au passage d’une fenêtre à l’autres en mode plein écran peuvent souvent provoquer des tracas pour les développeurs.</span><span class="sxs-lookup"><span data-stu-id="162f5-116">In porting from Direct3D 9 to DXGI and to Direct3D 10.x or Direct3D 11.x, issues associated with moving from windowing to full-screen mode often may cause headaches for developers.</span></span> <span data-ttu-id="162f5-117">Les principaux problèmes sont dus au fait que les applications Direct3D 9, contrairement aux applications DXGI, nécessitent une approche plus pratique pour suivre les styles de fenêtre et les États de fenêtre.</span><span class="sxs-lookup"><span data-stu-id="162f5-117">The main problems arise because Direct3D 9 applications, unlike DXGI applications, require a more hands-on approach to tracking window styles and window states.</span></span> <span data-ttu-id="162f5-118">Lorsque le code de modification en mode est porté pour s’exécuter sur DXGI, il provoque souvent un comportement inattendu.</span><span class="sxs-lookup"><span data-stu-id="162f5-118">When the mode-changing code is ported to run on DXGI, it often causes unexpected behavior.</span></span>

<span data-ttu-id="162f5-119">Souvent, les applications Direct3D 9 géraient la transition en mode plein écran en définissant la résolution du tampon avant, en forçant l’appareil en mode exclusif plein écran, puis en définissant les résolutions de la mémoire tampon d’arrière-plan en conséquence.</span><span class="sxs-lookup"><span data-stu-id="162f5-119">Often, Direct3D 9 applications handled the transition into full-screen mode by setting the resolution of the front buffer, forcing the device into full-screen exclusive mode, and then setting the back buffer resolutions to match.</span></span> <span data-ttu-id="162f5-120">Un chemin d’accès distinct a été utilisé pour les modifications apportées à la taille de la fenêtre, car elles devaient être gérées à partir du processus de fenêtre chaque fois que l’application a reçu un \_ message de taille WM.</span><span class="sxs-lookup"><span data-stu-id="162f5-120">A separate path was used for changes to window size because they had to be managed from the window process whenever the application received a WM\_SIZE message.</span></span>

<span data-ttu-id="162f5-121">DXGI tente de simplifier cette approche en combinant les deux cas.</span><span class="sxs-lookup"><span data-stu-id="162f5-121">DXGI attempts to simplify this approach by combining the two cases.</span></span> <span data-ttu-id="162f5-122">Par exemple, lorsque vous faites glisser la bordure de la fenêtre en mode fenêtre, l’application reçoit un \_ message de taille WM.</span><span class="sxs-lookup"><span data-stu-id="162f5-122">For example, when the window border is dragged in windowed mode, the application receives a WM\_SIZE message.</span></span> <span data-ttu-id="162f5-123">DXGI intercepte ce message et redimensionne automatiquement le tampon d’avant.</span><span class="sxs-lookup"><span data-stu-id="162f5-123">DXGI intercepts this message and automatically resizes the front buffer.</span></span> <span data-ttu-id="162f5-124">L’application a uniquement besoin d’appeler [**IDXGISwapChain :: ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) pour redimensionner la mémoire tampon d’arrière-plan en fonction de la taille transmise en tant que paramètres dans la taille de WM \_ .</span><span class="sxs-lookup"><span data-stu-id="162f5-124">All that the application needs to do is call [**IDXGISwapChain::ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) to resize the back buffer to the size that was passed as parameters in WM\_SIZE.</span></span> <span data-ttu-id="162f5-125">De même, lorsque l’application doit basculer entre le mode plein écran et le mode fenêtre, l’application peut simplement appeler [**IDXGISwapChain :: SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate).</span><span class="sxs-lookup"><span data-stu-id="162f5-125">Similarly, when the application needs to switch between full-screen and windowed mode, the application can simply call [**IDXGISwapChain::SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate).</span></span> <span data-ttu-id="162f5-126">DXGI redimensionne la mémoire tampon d’attente pour qu’elle corresponde au mode plein écran sélectionné et envoie un \_ message de taille WM à l’application.</span><span class="sxs-lookup"><span data-stu-id="162f5-126">DXGI resizes the front buffer to match the newly selected full-screen mode, and it sends a WM\_SIZE message to the application.</span></span> <span data-ttu-id="162f5-127">L’application appelle à nouveau **ResizeBuffers**, comme c’est le cas si la bordure de la fenêtre a été déplacée.</span><span class="sxs-lookup"><span data-stu-id="162f5-127">The application again calls **ResizeBuffers**, just as it would if the window border was dragged.</span></span>

<span data-ttu-id="162f5-128">La méthodologie de l’explication précédente suit un chemin d’accès très particulier.</span><span class="sxs-lookup"><span data-stu-id="162f5-128">The methodology of the preceding explanation follows a very particular path.</span></span> <span data-ttu-id="162f5-129">DXGI définit la résolution de l’écran complet sur la résolution du bureau par défaut.</span><span class="sxs-lookup"><span data-stu-id="162f5-129">DXGI set the full-screen resolution to the desktop resolution by default.</span></span> <span data-ttu-id="162f5-130">De nombreuses applications, toutefois, basculent vers une résolution à l’écran par défaut.</span><span class="sxs-lookup"><span data-stu-id="162f5-130">Many applications, however, switch to a preferred full-screen resolution.</span></span> <span data-ttu-id="162f5-131">Dans ce cas, DXGI fournit [**IDXGISwapChain :: ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget).</span><span class="sxs-lookup"><span data-stu-id="162f5-131">In such a case, DXGI provides [**IDXGISwapChain::ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget).</span></span> <span data-ttu-id="162f5-132">Cette méthode doit être appelée avant d’appeler [**SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate).</span><span class="sxs-lookup"><span data-stu-id="162f5-132">This should be called before calling [**SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate).</span></span> <span data-ttu-id="162f5-133">Bien que ces méthodes puissent être appelées dans l’ordre inverse (**SetFullscreenState** en premier, suivi par **ResizeTarget**), cela entraîne l’envoi d’un message de taille WM supplémentaire \_ à l’application.</span><span class="sxs-lookup"><span data-stu-id="162f5-133">Although these methods can be called in the opposite order (**SetFullscreenState** first, followed by **ResizeTarget**), doing so causes an extra WM\_SIZE message to be sent to the application.</span></span> <span data-ttu-id="162f5-134">(Cela peut également provoquer un scintillement, car DXGI peut être forcé à effectuer deux modifications de mode.) Après l’appel de **SetFullscreenState**, il est recommandé d’appeler à nouveau **ResizeTarget** avec le membre **RefreshRate** du [**\_ mode dxgi \_ desc**](/previous-versions/windows/desktop/legacy/bb173064(v=vs.85)) mis à zéro. Il s’agit d’une instruction de non-opération dans DXGI, mais elle peut éviter des problèmes liés à la fréquence d’actualisation, qui sont abordés ci-après.</span><span class="sxs-lookup"><span data-stu-id="162f5-134">(Doing so can also cause flickering, since DXGI could be forced to perform two mode changes.) After calling **SetFullscreenState**, it is advisable to call **ResizeTarget** again with the **RefreshRate** member of [**DXGI\_MODE\_DESC**](/previous-versions/windows/desktop/legacy/bb173064(v=vs.85)) zeroed out. This amounts to a no-operation instruction in DXGI, but it can avoid issues with the refresh rate, which are discussed next.</span></span>

<span data-ttu-id="162f5-135">En mode plein écran, le Gestionnaire de fenêtrage (DWM) est désactivé.</span><span class="sxs-lookup"><span data-stu-id="162f5-135">When in full-screen mode, the Desktop Window Manager (DWM) is disabled.</span></span> <span data-ttu-id="162f5-136">DXGI peut effectuer un retournement pour présenter le contenu de la mémoire tampon d’arrière-plan au lieu d’effectuer un blit, ce qui serait le cas en mode fenêtre.</span><span class="sxs-lookup"><span data-stu-id="162f5-136">DXGI can perform a flip to present the back buffer contents instead of doing a blit, which it would do in windowed mode.</span></span> <span data-ttu-id="162f5-137">Ce gain de performance peut cependant être annulé si certaines exigences ne sont pas satisfaites.</span><span class="sxs-lookup"><span data-stu-id="162f5-137">This performance gain can be undone, however, if certain requirements are not met.</span></span> <span data-ttu-id="162f5-138">Pour vous assurer que DXGI effectue un retournement au lieu d’un blit, le tampon d’avant et l’arrière-plan doivent être dimensionnés de façon identique.</span><span class="sxs-lookup"><span data-stu-id="162f5-138">To ensure that DXGI does a flip instead of a blit, the front buffer and back buffer must be sized identically.</span></span> <span data-ttu-id="162f5-139">Si l’application gère correctement ses \_ messages de taille WM, cela ne doit pas être un problème.</span><span class="sxs-lookup"><span data-stu-id="162f5-139">If the application correctly handles its WM\_SIZE messages, this should not be a problem.</span></span> <span data-ttu-id="162f5-140">En outre, les formats doivent être identiques.</span><span class="sxs-lookup"><span data-stu-id="162f5-140">Also, the formats must be identical.</span></span>

<span data-ttu-id="162f5-141">Le problème pour la plupart des applications est la fréquence d’actualisation.</span><span class="sxs-lookup"><span data-stu-id="162f5-141">The problem for most applications is the refresh rate.</span></span> <span data-ttu-id="162f5-142">La fréquence d’actualisation spécifiée dans l’appel à [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) doit être un taux d’actualisation qui est énuméré par l’objet [**IDXGIOutput**](/windows/desktop/api/dxgi/nn-dxgi-idxgioutput) que la chaîne de permutation utilise.</span><span class="sxs-lookup"><span data-stu-id="162f5-142">The refresh rate that is specified in the call to [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) must be a refresh rate that is enumerated by the [**IDXGIOutput**](/windows/desktop/api/dxgi/nn-dxgi-idxgioutput) object that the swap chain is using.</span></span> <span data-ttu-id="162f5-143">DXGI peut calculer automatiquement cette valeur si l’application revient au membre **RefreshRate** du [**\_ mode dxgi \_ desc**](/previous-versions/windows/desktop/legacy/bb173064(v=vs.85)) passé dans **ResizeTarget**.</span><span class="sxs-lookup"><span data-stu-id="162f5-143">DXGI can automatically calculate this value if the application zeroes out the **RefreshRate** member of [**DXGI\_MODE\_DESC**](/previous-versions/windows/desktop/legacy/bb173064(v=vs.85)) that is passed into **ResizeTarget**.</span></span> <span data-ttu-id="162f5-144">Il est important de ne pas supposer que certains taux d’actualisation seront toujours pris en charge et de coder en dur une valeur.</span><span class="sxs-lookup"><span data-stu-id="162f5-144">It is important not to assume that certain refresh rates will always be supported and to simply hard-code a value.</span></span> <span data-ttu-id="162f5-145">Souvent, les développeurs choisissent 60 Hz comme taux d’actualisation, sans savoir que le taux d’actualisation énuméré du moniteur est approximativement de 60 000/1 001 Hz à partir du moniteur.</span><span class="sxs-lookup"><span data-stu-id="162f5-145">Often, developers choose 60 Hz as the refresh rate, not knowing that the enumerated refresh rate from the monitor is approximately 60,000 / 1,001 Hz from the monitor.</span></span> <span data-ttu-id="162f5-146">Si la fréquence d’actualisation ne correspond pas au taux d’actualisation attendu de 60, DXGI est forcé d’effectuer un blit en mode plein écran au lieu d’un retournement.</span><span class="sxs-lookup"><span data-stu-id="162f5-146">If the refresh rate does not match the expected refresh rate of 60, DXGI is forced to perform a blit in full-screen mode instead of a flip.</span></span>

<span data-ttu-id="162f5-147">Le dernier problème que rencontrent souvent les développeurs est la modification des résolutions en plein écran, tout en restant en mode plein écran.</span><span class="sxs-lookup"><span data-stu-id="162f5-147">The last issue that developers often face is how to change full-screen resolutions while remaining in full-screen mode.</span></span> <span data-ttu-id="162f5-148">L’appel de [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) et de [**SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) peut parfois aboutir, mais la résolution plein écran reste la résolution du bureau.</span><span class="sxs-lookup"><span data-stu-id="162f5-148">Calling [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) and [**SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) sometimes succeeds, but the full-screen resolution remains the desktop resolution.</span></span> <span data-ttu-id="162f5-149">En outre, les développeurs peuvent créer une chaîne d’échange plein écran et fournir une résolution spécifique, uniquement pour déterminer que DXGI a comme valeur par défaut la résolution du bureau, quels que soient les nombres transmis.</span><span class="sxs-lookup"><span data-stu-id="162f5-149">Also, developers may create a full-screen swap chain and give a specific resolution, only to find that DXGI defaults to the desktop resolution regardless of the numbers passed in.</span></span> <span data-ttu-id="162f5-150">Sauf instruction contraire, DXGI est défini par défaut sur la résolution du Bureau pour les chaînes d’échange plein écran.</span><span class="sxs-lookup"><span data-stu-id="162f5-150">Unless otherwise instructed, DXGI defaults to the desktop resolution for full-screen swap chains.</span></span> <span data-ttu-id="162f5-151">Lors de la création d’une chaîne de permutation plein écran, le membre **Flags** de la structure DESC de la [**\_ \_ chaîne \_ de permutation dxgi**](/windows/desktop/api/dxgi/ns-dxgi-dxgi_swap_chain_desc) doit être défini sur le [**\_ \_ \_ \_ \_ \_ basculement du mode allow**](/windows/desktop/api/dxgi/ne-dxgi-dxgi_swap_chain_flag) de la chaîne de permutation DXGI pour remplacer le comportement par défaut de DXGI.</span><span class="sxs-lookup"><span data-stu-id="162f5-151">When creating a full-screen swap chain, the **Flags** member of the [**DXGI\_SWAP\_CHAIN\_DESC**](/windows/desktop/api/dxgi/ns-dxgi-dxgi_swap_chain_desc) structure must be set to [**DXGI\_SWAP\_CHAIN\_FLAG\_ALLOW\_MODE\_SWITCH**](/windows/desktop/api/dxgi/ne-dxgi-dxgi_swap_chain_flag) to override DXGI's default behavior.</span></span> <span data-ttu-id="162f5-152">Cet indicateur peut également être passé à **ResizeTarget** pour activer ou désactiver cette fonctionnalité de manière dynamique.</span><span class="sxs-lookup"><span data-stu-id="162f5-152">This flag also can be passed to **ResizeTarget** to enable or disable this functionality dynamically.</span></span>

## <a name="multiple-monitors"></a><span data-ttu-id="162f5-153">Moniteurs multiples</span><span class="sxs-lookup"><span data-stu-id="162f5-153">Multiple Monitors</span></span>

<span data-ttu-id="162f5-154">Lorsque vous utilisez DXGI avec plusieurs moniteurs, vous pouvez suivre deux règles.</span><span class="sxs-lookup"><span data-stu-id="162f5-154">When using DXGI with multiple monitors, there are two rules to follow.</span></span>

<span data-ttu-id="162f5-155">La première règle s’applique à la création d’au moins deux chaînes d’échange plein écran sur plusieurs moniteurs.</span><span class="sxs-lookup"><span data-stu-id="162f5-155">The first rule applies to the creation of two or more full-screen swap chains on multiple monitors.</span></span> <span data-ttu-id="162f5-156">Lors de la création de chaînes de permutation, il est préférable de créer toutes les chaînes de permutation sous forme de fenêtre, puis de les définir en plein écran.</span><span class="sxs-lookup"><span data-stu-id="162f5-156">When creating such swap chains, it is best to create all swap chains as windowed, and then to set them to full-screen.</span></span> <span data-ttu-id="162f5-157">Si les chaînes d’échange sont créées en mode plein écran, la création d’une deuxième chaîne de permutation entraîne l’envoi d’une modification de mode à la première chaîne de permutation, ce qui peut entraîner l’arrêt du mode plein écran.</span><span class="sxs-lookup"><span data-stu-id="162f5-157">If swap chains are created in full-screen mode, the creation of a second swap chain causes a mode change to be sent to the first swap chain, which could cause termination of full-screen mode.</span></span>

<span data-ttu-id="162f5-158">La deuxième règle s’applique aux sorties.</span><span class="sxs-lookup"><span data-stu-id="162f5-158">The second rule applies to outputs.</span></span> <span data-ttu-id="162f5-159">Watchful des sorties utilisées lors de la création de chaînes de permutation.</span><span class="sxs-lookup"><span data-stu-id="162f5-159">Be watchful of outputs used when creating swap chains.</span></span> <span data-ttu-id="162f5-160">Avec DXGI, l’objet [**IDXGIOutput**](/windows/desktop/api/dxgi/nn-dxgi-idxgioutput) contrôle l’analyse que la chaîne de permutation utilise en mode plein écran.</span><span class="sxs-lookup"><span data-stu-id="162f5-160">With DXGI, the [**IDXGIOutput**](/windows/desktop/api/dxgi/nn-dxgi-idxgioutput) object controls which monitor the swap chain uses when becoming full-screen.</span></span> <span data-ttu-id="162f5-161">Contrairement à DXGI, Direct3D 9 n’avait aucun concept de sorties.</span><span class="sxs-lookup"><span data-stu-id="162f5-161">Unlike DXGI, Direct3D 9 had no concept of outputs.</span></span>

## <a name="window-styles-and-dxgi"></a><span data-ttu-id="162f5-162">Styles de fenêtre et DXGI</span><span class="sxs-lookup"><span data-stu-id="162f5-162">Window Styles and DXGI</span></span>

<span data-ttu-id="162f5-163">Les applications Direct3D 9 ont beaucoup de travail à effectuer lors du basculement entre les modes plein écran et fenêtre.</span><span class="sxs-lookup"><span data-stu-id="162f5-163">Direct3D 9 applications had a lot of work to do when switching between full-screen and windowed modes.</span></span> <span data-ttu-id="162f5-164">Une grande partie de ce travail impliquait de modifier les styles de fenêtre pour ajouter et supprimer des bordures, pour ajouter des barres de défilement, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="162f5-164">Much of this work involved changing window styles to add and remove borders, to add scrollbars, and so on.</span></span> <span data-ttu-id="162f5-165">Lorsque les applications sont portées dans DXGI et Direct3D 10. x ou Direct3D 11. x, ce code est souvent laissé en place.</span><span class="sxs-lookup"><span data-stu-id="162f5-165">When applications are ported to DXGI and Direct3D 10.x or Direct3D 11.x, this code often is left in place.</span></span> <span data-ttu-id="162f5-166">En fonction des modifications apportées, le basculement entre les modes peut entraîner un comportement inattendu.</span><span class="sxs-lookup"><span data-stu-id="162f5-166">Depending on the changes being made, switching between modes can cause unexpected behavior.</span></span> <span data-ttu-id="162f5-167">Par exemple, lorsque vous passez en mode fenêtre, l’application peut ne plus avoir de cadre de fenêtre ou de bordure de fenêtre malgré le fait que le code définisse spécifiquement ces styles.</span><span class="sxs-lookup"><span data-stu-id="162f5-167">For example, when switching to windowed mode, the application might no longer have a window frame or window border despite having code that specifically sets these styles.</span></span> <span data-ttu-id="162f5-168">Cela est dû au fait que DXGI gère à présent une grande partie de ce style qui change de manière autonome.</span><span class="sxs-lookup"><span data-stu-id="162f5-168">This occurs because DXGI now handles much of this style changing on its own.</span></span> <span data-ttu-id="162f5-169">La définition manuelle des styles de fenêtre peut interférer avec DXGI, ce qui peut provoquer un comportement inattendu.</span><span class="sxs-lookup"><span data-stu-id="162f5-169">Manual setting of window styles can interfere with DXGI, and this can cause unexpected behavior.</span></span>

<span data-ttu-id="162f5-170">Le comportement recommandé consiste à effectuer le moins de travail possible et à laisser DXGI gérer la majeure partie de l’interaction avec les fenêtres.</span><span class="sxs-lookup"><span data-stu-id="162f5-170">The recommended behavior is to do as little work as possible, and to let DXGI handle most of the interaction with the windows.</span></span> <span data-ttu-id="162f5-171">Toutefois, si l’application doit gérer son propre comportement de fenêtrage, [**IDXGIFactory :: MakeWindowAssociation**](/windows/desktop/api/dxgi/nf-dxgi-idxgifactory-makewindowassociation) peut être utilisé pour indiquer à dxgi de désactiver une partie de sa gestion automatique de fenêtre.</span><span class="sxs-lookup"><span data-stu-id="162f5-171">However, if the application needs to handle its own windowing behavior, [**IDXGIFactory::MakeWindowAssociation**](/windows/desktop/api/dxgi/nf-dxgi-idxgifactory-makewindowassociation) can be used to tell DXGI to disable some of its automatic window handling.</span></span>

## <a name="multithreading-and-dxgi"></a><span data-ttu-id="162f5-172">Multithread et DXGI</span><span class="sxs-lookup"><span data-stu-id="162f5-172">Multithreading and DXGI</span></span>

<span data-ttu-id="162f5-173">Une attention particulière doit être prise lors de l’utilisation de DXGI dans une application multithread pour s’assurer que les blocages ne se produisent pas.</span><span class="sxs-lookup"><span data-stu-id="162f5-173">Special care must be taken when using DXGI in a multithreaded application to ensure that deadlocks do not occur.</span></span> <span data-ttu-id="162f5-174">En raison de l’interaction étroite de DXGI avec la fenêtrage, il envoie parfois des messages de fenêtre à la fenêtre d’application associée.</span><span class="sxs-lookup"><span data-stu-id="162f5-174">Because of DXGI's close interaction with windowing, it occasionally sends window messages to the associated application window.</span></span> <span data-ttu-id="162f5-175">DXGI a besoin que les modifications de fenêtrage se produisent avant de pouvoir continuer. il utilisera donc [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage), qui est un appel synchrone.</span><span class="sxs-lookup"><span data-stu-id="162f5-175">DXGI needs the windowing changes to occur before it can continue, so it will use [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage), which is a synchronous call.</span></span> <span data-ttu-id="162f5-176">L’application doit traiter le message de fenêtre avant que **SendMessage** retourne.</span><span class="sxs-lookup"><span data-stu-id="162f5-176">The application must process the window message before **SendMessage** returns.</span></span>

<span data-ttu-id="162f5-177">Dans une application où les appels DXGI et la pompe de messages se trouvent sur le même thread (ou une application à thread unique), peu de choses doivent être effectuées.</span><span class="sxs-lookup"><span data-stu-id="162f5-177">In an application where DXGI calls and the message pump are on the same thread (or a single-threaded application), little needs to be done.</span></span> <span data-ttu-id="162f5-178">Lorsque l’appel DXGI se trouve sur le même thread que la pompe de messages, [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) appelle la fonction [*WindowProc*](/previous-versions/windows/desktop/legacy/ms633573(v=vs.85))de la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="162f5-178">When the DXGI call is on the same thread as the message pump, [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) calls the window's [*WindowProc*](/previous-versions/windows/desktop/legacy/ms633573(v=vs.85)).</span></span> <span data-ttu-id="162f5-179">Cela contourne la pompe de messages et permet à l’exécution de continuer après l’appel à **SendMessage**.</span><span class="sxs-lookup"><span data-stu-id="162f5-179">This bypasses the message pump, and allows execution to continue after the call to **SendMessage**.</span></span> <span data-ttu-id="162f5-180">N’oubliez pas que les appels [**IDXGISwapChain**](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain) , tels que [**IDXGISwapChain ::P renvoyés**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present), sont également considérés comme des appels DXGI. DXGI peut différer le travail de [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) ou [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) jusqu’à ce que le **présent** soit appelé.</span><span class="sxs-lookup"><span data-stu-id="162f5-180">Remember that [**IDXGISwapChain**](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain) calls, such as [**IDXGISwapChain::Present**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present), are also considered DXGI calls; DXGI may defer work from [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) or [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) until **Present** is called.</span></span>

<span data-ttu-id="162f5-181">Si l’appel DXGI et la pompe de messages se trouvent sur des threads différents, vous devez veiller à éviter les interblocages.</span><span class="sxs-lookup"><span data-stu-id="162f5-181">If the DXGI call and message pump are on different threads, care must be taken to avoid deadlocks.</span></span> <span data-ttu-id="162f5-182">Lorsque la pompe de messages et SendMessage se trouvent sur des threads différents, [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) ajoute un message à la file d’attente de messages de la fenêtre et attend que la fenêtre traite ce message.</span><span class="sxs-lookup"><span data-stu-id="162f5-182">When the message pump and SendMessage are on different threads, [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) adds a message to the window's message queue, and waits for the window to process that message.</span></span> <span data-ttu-id="162f5-183">Si la procédure de fenêtre est occupée ou n’est pas appelée par la pompe de messages, le message peut ne jamais être traité et DXGI attend indéfiniment.</span><span class="sxs-lookup"><span data-stu-id="162f5-183">If the window procedure is busy or is not called by the message pump, the message may never get processed and DXGI will wait indefinitely.</span></span>

<span data-ttu-id="162f5-184">Par exemple, si une application qui a sa pompe de messages sur un thread et son rendu sur un autre, il peut être utile de modifier les modes.</span><span class="sxs-lookup"><span data-stu-id="162f5-184">For example, if an application that has its message pump on one thread and its rendering on another, it may want to change modes.</span></span> <span data-ttu-id="162f5-185">Le thread de pompe de messages indique au thread de rendu de modifier les modes et attend la fin du changement de mode.</span><span class="sxs-lookup"><span data-stu-id="162f5-185">The message pump thread tells the rendering thread to change modes, and waits until the mode change is complete.</span></span> <span data-ttu-id="162f5-186">Toutefois, le thread de rendu appelle les fonctions DXGI, qui à leur tour appellent [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage), qui se bloque jusqu’à ce que la pompe de messages traite le message.</span><span class="sxs-lookup"><span data-stu-id="162f5-186">However, the rendering thread calls DXGI functions, which in turn call [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage), which blocks until the message pump processes the message.</span></span> <span data-ttu-id="162f5-187">Un blocage se produit parce que les deux threads sont désormais bloqués et attendent les uns les autres.</span><span class="sxs-lookup"><span data-stu-id="162f5-187">A deadlock occurs because both threads now are blocked, and are waiting on each other.</span></span> <span data-ttu-id="162f5-188">Pour éviter cela, ne bloquez jamais la pompe de messages.</span><span class="sxs-lookup"><span data-stu-id="162f5-188">To avoid this, never block the message pump.</span></span> <span data-ttu-id="162f5-189">Si un bloc est inévitable, toutes les interactions DXGI doivent se produire sur le même thread que la pompe de messages.</span><span class="sxs-lookup"><span data-stu-id="162f5-189">If a block is unavoidable, then all DXGI interaction should occur on the same thread as the message pump.</span></span>

## <a name="gamma-and-dxgi"></a><span data-ttu-id="162f5-190">Gamma et DXGI</span><span class="sxs-lookup"><span data-stu-id="162f5-190">Gamma and DXGI</span></span>

<span data-ttu-id="162f5-191">Bien que gamma puisse être mieux géré dans Direct3D 10. x ou Direct3D 11. x en utilisant des textures sRVB, la rampe gamma peut toujours être utile pour les développeurs qui souhaitent une valeur gamma différente de 2,2 ou qui utilisent un format de cible de rendu qui ne prend pas en charge SRGB.</span><span class="sxs-lookup"><span data-stu-id="162f5-191">Although gamma may be best handled in Direct3D 10.x or Direct3D 11.x by using SRGB textures, the gamma ramp still can be useful to developers who want a different gamma value than 2.2 or who are using a render target format that does not support SRGB.</span></span> <span data-ttu-id="162f5-192">Tenez compte de deux problèmes lors de la définition de la rampe gamma par le biais de DXGI.</span><span class="sxs-lookup"><span data-stu-id="162f5-192">Be aware of two issues when setting the gamma ramp through DXGI.</span></span> <span data-ttu-id="162f5-193">Le premier problème est que les valeurs de rampe passées dans [**IDXGIOutput :: SetGammaControl**](/windows/desktop/api/dxgi/nf-dxgi-idxgioutput-setgammacontrol) sont des valeurs float, et non des valeurs de **mot** .</span><span class="sxs-lookup"><span data-stu-id="162f5-193">The first issue is that the ramp values passed into [**IDXGIOutput::SetGammaControl**](/windows/desktop/api/dxgi/nf-dxgi-idxgioutput-setgammacontrol) are float values, not **WORD** values.</span></span> <span data-ttu-id="162f5-194">En outre, assurez-vous que le code porté à partir de Direct3D 9 ne tente pas de convertir en valeurs **Word** avant de les passer à **SetGammaControl**.</span><span class="sxs-lookup"><span data-stu-id="162f5-194">Also, ensure that code ported from Direct3D 9 does not try to convert to **WORD** values before passing these to **SetGammaControl**.</span></span>

<span data-ttu-id="162f5-195">Le deuxième problème est que, après avoir changé en mode plein écran, [**SetGammaControl**](/windows/desktop/api/dxgi/nf-dxgi-idxgioutput-setgammacontrol) peut ne pas sembler fonctionner, en fonction de l’objet [**IDXGIOutput**](/windows/desktop/api/dxgi/nn-dxgi-idxgioutput) utilisé.</span><span class="sxs-lookup"><span data-stu-id="162f5-195">The second issue is that, after changing to full-screen mode, [**SetGammaControl**](/windows/desktop/api/dxgi/nf-dxgi-idxgioutput-setgammacontrol) may not appear to work, dependent on the [**IDXGIOutput**](/windows/desktop/api/dxgi/nn-dxgi-idxgioutput) object being used.</span></span> <span data-ttu-id="162f5-196">Lors du passage en mode plein écran, DXGI crée un nouvel objet de sortie et utilise l’objet pour toutes les opérations suivantes sur la sortie.</span><span class="sxs-lookup"><span data-stu-id="162f5-196">When changing to full-screen mode, DXGI creates a new output object, and uses the object for all subsequent operations on the output.</span></span> <span data-ttu-id="162f5-197">Si vous appelez **SetGammaControl** sur une sortie énumérée avant un commutateur en mode plein écran, l’appel n’est pas dirigé vers la sortie actuellement utilisée par DXGI.</span><span class="sxs-lookup"><span data-stu-id="162f5-197">If calling **SetGammaControl** on an output that is enumerated before a full-screen mode switch, the call is not directed toward the output that DXGI is using currently.</span></span> <span data-ttu-id="162f5-198">Pour éviter cela, appelez [**IDXGISwapChain :: GetContainingOutput**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getcontainingoutput) pour accéder à la sortie actuelle, puis appelez **SetGammaControl** à partir de cette sortie pour connaître le comportement correct.</span><span class="sxs-lookup"><span data-stu-id="162f5-198">To avoid this, call [**IDXGISwapChain::GetContainingOutput**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getcontainingoutput) to get the current output, and then call **SetGammaControl** off this output to get the correct behavior.</span></span>

<span data-ttu-id="162f5-199">Pour plus d’informations sur l’utilisation de la correction gamma, consultez Utilisation de la [correction gamma](/windows/desktop/direct3ddxgi/using-gamma-correction).</span><span class="sxs-lookup"><span data-stu-id="162f5-199">For info about using gamma correction, see [Using gamma correction](/windows/desktop/direct3ddxgi/using-gamma-correction).</span></span>

## <a name="dxgi-11"></a><span data-ttu-id="162f5-200">DXGI 1,1</span><span class="sxs-lookup"><span data-stu-id="162f5-200">DXGI 1.1</span></span>

<span data-ttu-id="162f5-201">Le runtime Direct3D 11 inclus dans Windows 7 et installé sur Windows Vista (voir [KB971644](https://support.microsoft.com/kb/971644)) inclut la version 1,1 de DXGI.</span><span class="sxs-lookup"><span data-stu-id="162f5-201">The Direct3D 11 runtime included in Windows 7 and installed onto Windows Vista (see [KB971644](https://support.microsoft.com/kb/971644)) includes version 1.1 of DXGI.</span></span> <span data-ttu-id="162f5-202">Cette mise à jour ajoute des définitions pour un certain nombre de nouveaux formats (notamment BGRA, le biais de 10 bits x2 et la compression de texture BC6H et BC7 de Direct3D 11), ainsi qu’une nouvelle version de la fabrique DXGI et des interfaces d’adaptateur ([**CreateDXGIFactory1**](/windows/desktop/api/dxgi/nf-dxgi-createdxgifactory1), [**IDXGIFactory1**](/windows/desktop/api/dxgi/nn-dxgi-idxgifactory1), [**IDXGIAdapter1**](/windows/desktop/api/dxgi/nn-dxgi-idxgiadapter1)) pour l’énumération des connexions Bureau à distance.</span><span class="sxs-lookup"><span data-stu-id="162f5-202">This update adds definitions for a number of new formats (particularly BGRA, 10-bit X2 bias, and Direct3D 11's BC6H and BC7 texture compression), as well as a new version of the DXGI factory and adapter interfaces ([**CreateDXGIFactory1**](/windows/desktop/api/dxgi/nf-dxgi-createdxgifactory1), [**IDXGIFactory1**](/windows/desktop/api/dxgi/nn-dxgi-idxgifactory1), [**IDXGIAdapter1**](/windows/desktop/api/dxgi/nn-dxgi-idxgiadapter1)) for enumerating remote desktop connections.</span></span>

<span data-ttu-id="162f5-203">Lorsque vous utilisez Direct3D 11, le runtime utilise DXGI 1,1 par défaut lors de l’appel de [**D3D11CreateDevice**](/windows/desktop/api/d3d11/nf-d3d11-d3d11createdevice) ou [**D3D11CreateDeviceAndSwapChain**](/windows/desktop/api/d3d11/nf-d3d11-d3d11createdeviceandswapchain) avec un pointeur [**IDXGIAdapter**](/windows/desktop/api/dxgi/nn-dxgi-idxgiadapter) null.</span><span class="sxs-lookup"><span data-stu-id="162f5-203">When you use Direct3D 11, the runtime will use DXGI 1.1 by default when calling [**D3D11CreateDevice**](/windows/desktop/api/d3d11/nf-d3d11-d3d11createdevice) or [**D3D11CreateDeviceAndSwapChain**](/windows/desktop/api/d3d11/nf-d3d11-d3d11createdeviceandswapchain) with a NULL [**IDXGIAdapter**](/windows/desktop/api/dxgi/nn-dxgi-idxgiadapter) pointer.</span></span> <span data-ttu-id="162f5-204">Le mélange de l’utilisation de DXGI 1,0 et de DXGI 1,1 dans le même processus n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="162f5-204">Mixing use of DXGI 1.0 and DXGI 1.1 in the same process is not supported.</span></span> <span data-ttu-id="162f5-205">La combinaison d’instances d’objet DXGI de différentes fabriques dans le même processus n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="162f5-205">Mixing DXGI object instances from different factories in the same process also is not supported.</span></span> <span data-ttu-id="162f5-206">Par conséquent, lorsque vous utilisez DirectX 11, toute utilisation explicite des interfaces DXGI utilise un [**IDXGIFactory1**](/windows/desktop/api/dxgi/nn-dxgi-idxgifactory1) créé par le point d’entrée [**CreateDXGIFactory1**](/windows/desktop/api/dxgi/nf-dxgi-createdxgifactory1) dans « DXGI.DLL » pour s’assurer que l’application utilise toujours DXGI 1,1.</span><span class="sxs-lookup"><span data-stu-id="162f5-206">Therefore, when you use DirectX 11, any explicit use of the DXGI interfaces uses a [**IDXGIFactory1**](/windows/desktop/api/dxgi/nn-dxgi-idxgifactory1) created by the [**CreateDXGIFactory1**](/windows/desktop/api/dxgi/nf-dxgi-createdxgifactory1) entry-point in “DXGI.DLL” to ensure the application is always using DXGI 1.1.</span></span>

## <a name="dxgi-12"></a><span data-ttu-id="162f5-207">DXGI 1,2</span><span class="sxs-lookup"><span data-stu-id="162f5-207">DXGI 1.2</span></span>

<span data-ttu-id="162f5-208">Le runtime Direct3D 11,1 inclus dans Windows 8 inclut également la version 1,2 de DXGI.</span><span class="sxs-lookup"><span data-stu-id="162f5-208">The Direct3D 11.1 runtime that is included in Windows 8 also includes version 1.2 of DXGI.</span></span>

<span data-ttu-id="162f5-209">DXGI 1,2 active les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="162f5-209">DXGI 1.2 enables these features:</span></span>

-   <span data-ttu-id="162f5-210">rendu stéréo</span><span class="sxs-lookup"><span data-stu-id="162f5-210">stereo rendering</span></span>
-   <span data-ttu-id="162f5-211">formats 16 bits par pixel</span><span class="sxs-lookup"><span data-stu-id="162f5-211">16 bit-per-pixel formats</span></span>

    -   <span data-ttu-id="162f5-212">Les formats DXGI \_ \_ B5G6R5 \_ UNORM et \_ dxgi \_ B5G5R5A1 \_ UNORM sont désormais entièrement pris en charge</span><span class="sxs-lookup"><span data-stu-id="162f5-212">DXGI\_FORMAT\_B5G6R5\_UNORM and DXGI\_FORMAT\_B5G5R5A1\_UNORM are now fully supported</span></span>
    -   <span data-ttu-id="162f5-213">un nouveau \_ format dxgi \_ B5G5R5A1 \_ UNORM a été ajouté</span><span class="sxs-lookup"><span data-stu-id="162f5-213">a new DXGI\_FORMAT\_B5G5R5A1\_UNORM format was added</span></span>

-   <span data-ttu-id="162f5-214">formats vidéo</span><span class="sxs-lookup"><span data-stu-id="162f5-214">video formats</span></span>
-   <span data-ttu-id="162f5-215">nouvelles interfaces DXGI</span><span class="sxs-lookup"><span data-stu-id="162f5-215">new DXGI interfaces</span></span>

<span data-ttu-id="162f5-216">Pour plus d’informations sur les fonctionnalités de DXGI 1,2, consultez [améliorations apportées à DXGI 1,2](/windows/desktop/direct3ddxgi/dxgi-1-2-improvements).</span><span class="sxs-lookup"><span data-stu-id="162f5-216">For more info about DXGI 1.2 features, see [DXGI 1.2 Improvements](/windows/desktop/direct3ddxgi/dxgi-1-2-improvements).</span></span>

 

 