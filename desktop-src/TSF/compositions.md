---
title: Position
description: Une composition est un état d’entrée temporaire qui permet à un service de texte de spécifier à la fois à l’application et à l’utilisateur que le texte d’entrée est toujours dans un état de modification.
ms.assetid: 3d9da4f2-ceb9-4abc-8979-d3756d948a57
keywords:
- Text Services Framework (TSF), compositions
- TSF (Text Services Framework), compositions
- services de texte, compositions
- Applications compatibles TSF, compositions
- compositions
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0b03f3e991f76ee7c6dca3830267796576c7b842
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104382430"
---
# <a name="compositions"></a><span data-ttu-id="d4f4e-108">Position</span><span class="sxs-lookup"><span data-stu-id="d4f4e-108">Compositions</span></span>

<span data-ttu-id="d4f4e-109">Une composition est un état d’entrée temporaire qui permet à un service de texte de spécifier à la fois à l’application et à l’utilisateur que le texte d’entrée est toujours dans un état de modification.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-109">A composition is a temporary input state that enables a text service to specify both to the application and the user that the input text is still in a state of change.</span></span> <span data-ttu-id="d4f4e-110">Une application peut et doit obtenir des informations sur les attributs d’affichage sur la composition et utiliser ces informations pour afficher l’état de la composition à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-110">An application can and should obtain display attribute information about the composition and use this information to display the composition state to the user.</span></span>

<span data-ttu-id="d4f4e-111">Un exemple de l’utilisation d’une composition est l’entrée vocale.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-111">One example of the use of a composition is during speech input.</span></span> <span data-ttu-id="d4f4e-112">Pendant que l’utilisateur parle, le service de texte vocal crée une composition.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-112">While the user is speaking, the speech text service creates a composition.</span></span> <span data-ttu-id="d4f4e-113">Cette composition reste intacte jusqu’à ce que toute la saisie vocale soit terminée.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-113">This composition will remain intact until the entire speech input is complete.</span></span> <span data-ttu-id="d4f4e-114">À la fin de la session, le service de texte vocal met fin à la composition.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-114">When the session ends, the speech text service terminates the composition.</span></span>

<span data-ttu-id="d4f4e-115">Une application utilise la présence et l’absence d’une composition pour déterminer comment afficher du texte et ce qui, le cas échéant, le traitement doit être effectué sur le texte.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-115">An application uses the presence and absence of a composition to determine how to display text and what, if any, processing should be performed on the text.</span></span> <span data-ttu-id="d4f4e-116">Par exemple, si l’utilisateur utilise le moteur de reconnaissance vocale pour entrer du texte, l’application ne doit effectuer aucune vérification orthographique ou grammaticale sur un texte de composition.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-116">For example, if the user is using the speech engine to input text, the application should not perform any spelling or grammar checking on any composition text.</span></span> <span data-ttu-id="d4f4e-117">Le texte est considéré comme incomplet jusqu’à la fin de la composition.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-117">The text is considered incomplete until the composition is terminated.</span></span>

## <a name="text-services"></a><span data-ttu-id="d4f4e-118">Services de texte</span><span class="sxs-lookup"><span data-stu-id="d4f4e-118">Text Services</span></span>

<span data-ttu-id="d4f4e-119">Un service de texte crée une composition en appelant [ITfContextComposition :: StartComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextcomposition-startcomposition).</span><span class="sxs-lookup"><span data-stu-id="d4f4e-119">A text service creates a composition by calling [ITfContextComposition::StartComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextcomposition-startcomposition).</span></span> <span data-ttu-id="d4f4e-120">Le service de texte peut éventuellement implémenter un objet [ITfCompositionSink](/windows/desktop/api/msctf/nn-msctf-itfcompositionsink) qui reçoit des notifications d’événements de composition.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-120">The text service can optionally implement an [ITfCompositionSink](/windows/desktop/api/msctf/nn-msctf-itfcompositionsink) object that receives composition event notifications.</span></span> <span data-ttu-id="d4f4e-121">StartComposition retourne un objet [ITfComposition](/windows/desktop/api/msctf/nn-msctf-itfcomposition) auquel le service de texte conserve une référence et utilise pour modifier et terminer la composition.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-121">StartComposition returns an [ITfComposition](/windows/desktop/api/msctf/nn-msctf-itfcomposition) object that the text service keeps a reference to and uses to modify and terminate the composition.</span></span> <span data-ttu-id="d4f4e-122">Le service de texte met fin à la composition en appelant [ITfComposition :: EndComposition](/windows/desktop/api/msctf/nf-msctf-itfcomposition-endcomposition).</span><span class="sxs-lookup"><span data-stu-id="d4f4e-122">The text service terminates the composition by calling [ITfComposition::EndComposition](/windows/desktop/api/msctf/nf-msctf-itfcomposition-endcomposition).</span></span>

<span data-ttu-id="d4f4e-123">Si un service de texte va créer des compositions, il doit également prendre en charge les attributs d’affichage pour permettre à une application d’afficher du texte qui fait partie d’une composition différente du texte standard.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-123">If a text service is going to create compositions, it should also support display attributes to enable an application to display text that is part of a composition differently than standard text.</span></span> <span data-ttu-id="d4f4e-124">Pour plus d’informations, consultez [fourniture d’attributs d’affichage](providing-display-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="d4f4e-124">For more information, see [Providing Display Attributes](providing-display-attributes.md).</span></span>

## <a name="applications"></a><span data-ttu-id="d4f4e-125">Applications</span><span class="sxs-lookup"><span data-stu-id="d4f4e-125">Applications</span></span>

<span data-ttu-id="d4f4e-126">Une application peut surveiller la création, la modification et l’arrêt des compositions en installant un récepteur [ITfContextOwnerCompositionSink](/windows/desktop/api/msctf/nn-msctf-itfcontextownercompositionsink) .</span><span class="sxs-lookup"><span data-stu-id="d4f4e-126">An application can monitor the creation, change and termination of compositions by installing an [ITfContextOwnerCompositionSink](/windows/desktop/api/msctf/nn-msctf-itfcontextownercompositionsink) sink.</span></span> <span data-ttu-id="d4f4e-127">Quand une composition est démarrée, [ITfContextOwnerCompositionSink :: OnStartComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onstartcomposition) est appelée.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-127">When a composition is started, [ITfContextOwnerCompositionSink::OnStartComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onstartcomposition) is called.</span></span> <span data-ttu-id="d4f4e-128">De même, lorsqu’une composition est modifiée ou terminée, [ITfContextOwnerCompositionSink :: OnUpdateComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onupdatecomposition) et [ITfContextOwnerCompositionSink :: OnEndComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onendcomposition) sont appelés, respectivement.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-128">Likewise, when a composition is changed or terminated, [ITfContextOwnerCompositionSink::OnUpdateComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onupdatecomposition) and [ITfContextOwnerCompositionSink::OnEndComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onendcomposition) will be called, respectively.</span></span>

<span data-ttu-id="d4f4e-129">Voici une procédure classique pour mettre à jour un document à l’aide d’une composition.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-129">The following is a typical procedure to update a document using a composition.</span></span>

1.  <span data-ttu-id="d4f4e-130">[ITextStoreACP :: InsertTextAtSelection](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-inserttextatselection) ou [ITextStoreAnchor :: InsertTextAtSelection](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-inserttextatselection) sont généralement utilisés pour insérer le texte initial dans la composition.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-130">[ITextStoreACP::InsertTextAtSelection](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-inserttextatselection) or [ITextStoreAnchor::InsertTextAtSelection](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-inserttextatselection) are typically used to insert the initial text into the composition.</span></span>
2.  <span data-ttu-id="d4f4e-131">La composition est démarrée avec un appel à [ITfContextComposition :: StartComposition](/windows/desktop/api/Msctf/nf-msctf-itfcontextcomposition-startcomposition), à l’aide de la plage de texte retournée par **InsertTextAtSelection**.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-131">The composition is started with a call to [ITfContextComposition::StartComposition](/windows/desktop/api/Msctf/nf-msctf-itfcontextcomposition-startcomposition), using the range of text returned by **InsertTextAtSelection**.</span></span>
3.  <span data-ttu-id="d4f4e-132">Lorsqu’il reçoit une nouvelle entrée telle qu’une entrée vocale ou clavier, l’application met à jour la composition avec [ITextStoreACP :: SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-settext) ou [ITextStoreAnchor :: SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-settext).</span><span class="sxs-lookup"><span data-stu-id="d4f4e-132">When it receives new input such as speech or keyboard entry, the application updates the composition with [ITextStoreACP::SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-settext) or [ITextStoreAnchor::SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-settext).</span></span>
4.  <span data-ttu-id="d4f4e-133">Lorsque l’application détermine qu’il est temps de mettre fin à la composition, elle appelle [ITfComposition :: EndComposition](/windows/desktop/api/Msctf/nf-msctf-itfcomposition-endcomposition).</span><span class="sxs-lookup"><span data-stu-id="d4f4e-133">When the application determines that it is time to end the composition, it calls [ITfComposition::EndComposition](/windows/desktop/api/Msctf/nf-msctf-itfcomposition-endcomposition).</span></span>

<span data-ttu-id="d4f4e-134">L’application doit utiliser les attributs d’affichage fournis par le service de texte pour modifier l’affichage du texte à tout moment, et pas seulement quand une composition est active.</span><span class="sxs-lookup"><span data-stu-id="d4f4e-134">The application should use the display attributes provided by the text service to modify the display of text at all times and not just when a composition is active.</span></span> <span data-ttu-id="d4f4e-135">Pour plus d’informations, consultez [utilisation des attributs d’affichage](using-display-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="d4f4e-135">For more information, see [Using Display Attributes](using-display-attributes.md).</span></span>

<span data-ttu-id="d4f4e-136">Si nécessaire, une application peut arrêter une composition en appelant [ITfContextOwnerCompositionServices :: TerminateComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionservices-terminatecomposition).</span><span class="sxs-lookup"><span data-stu-id="d4f4e-136">If necessary, an application can terminate a composition by calling [ITfContextOwnerCompositionServices::TerminateComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionservices-terminatecomposition).</span></span>

 

 