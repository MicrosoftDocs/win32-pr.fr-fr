---
title: Traçage réseau dans l’architecture Windows 7
description: L’illustration suivante montre l’architecture de suivi réseau de base dans Windows 7.
ms.assetid: b3023469-0f98-451c-b39f-c3eae771eacc
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 41221ebf434c05a8c9b7c8489e861128029b5320
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "106513737"
---
# <a name="network-tracing-in-windows-7-architecture"></a><span data-ttu-id="4d161-103">Traçage réseau dans Windows 7 : architecture</span><span class="sxs-lookup"><span data-stu-id="4d161-103">Network Tracing in Windows 7: Architecture</span></span>

<span data-ttu-id="4d161-104">L’illustration suivante montre l’architecture de suivi réseau de base dans Windows 7.</span><span class="sxs-lookup"><span data-stu-id="4d161-104">The illustration below shows the basic network tracing architecture in Windows 7.</span></span>

![diagramme de l’architecture de suivi réseau](images/ut1.png)

<span data-ttu-id="4d161-106">Le suivi réseau utilise l’infrastructure Suivi d’v nements pour Windows (ETW) disponible dans Windows.</span><span class="sxs-lookup"><span data-stu-id="4d161-106">Network tracing utilizes the Event Tracing for Windows (ETW) framework available in Windows.</span></span> <span data-ttu-id="4d161-107">Les composants réseau (tels que Winsock, TCP/IP, NDIS, capture de paquets, etc.) s’inscrivent en tant que fournisseurs de suivi ETW et émettent des événements liés à l’activité réseau.</span><span class="sxs-lookup"><span data-stu-id="4d161-107">Network components (such as Winsock, TCP/IP, NDIS, packet-capture, and so on) register as ETW trace providers and emit events related to network activity.</span></span> <span data-ttu-id="4d161-108">Toute activité enregistrable de précision peut être un événement enregistré dans ETW.</span><span class="sxs-lookup"><span data-stu-id="4d161-108">Any recordable activity of significance can be an event logged to ETW.</span></span> <span data-ttu-id="4d161-109">Le suivi de ces composants réseau et captures de paquets peut être activé à l’aide du contexte de **trace netsh** qui agit comme un contrôleur ETW.</span><span class="sxs-lookup"><span data-stu-id="4d161-109">Tracing for these network components and packet captures can be enabled using the **netsh trace** context which acts as an ETW controller.</span></span>

<span data-ttu-id="4d161-110">Les traces générées sont collectées dans un fichier journal de suivi d’événements (ETL).</span><span class="sxs-lookup"><span data-stu-id="4d161-110">The generated traces are collected in an Event Trace Log (ETL) file.</span></span> <span data-ttu-id="4d161-111">Ces fichiers ETL peuvent ensuite être analysés à l’aide d’un certain nombre d’outils, tels que Moniteur réseau 3,2 et versions ultérieures, observateur d’événements, **netsh trace Convert** ou Tracerpt.exe.</span><span class="sxs-lookup"><span data-stu-id="4d161-111">These ETL files can then be analyzed using a number of tools, such as Network Monitor 3.2 and later, Event Viewer, **netsh trace convert**, or Tracerpt.exe.</span></span>

<span data-ttu-id="4d161-112">Chaque événement ETW possède un en-tête commun dans lequel ETW stocke des informations telles que les propriétés d’événement, les horodatages et l’ID d’activité.</span><span class="sxs-lookup"><span data-stu-id="4d161-112">Each ETW event has a common header where ETW stores information such as the event properties, time stamps, and activity ID.</span></span> <span data-ttu-id="4d161-113">(Pour plus d’informations sur les ID d’activité, consultez [écriture d’événements connexes dans un scénario de bout en bout](../etw/writing-related-events-in-an-end-to-end-scenario.md)).</span><span class="sxs-lookup"><span data-stu-id="4d161-113">(For more information about activity IDs, see [Writing Related Events in an End-to-End Scenario](../etw/writing-related-events-in-an-end-to-end-scenario.md)).</span></span> <span data-ttu-id="4d161-114">L’ID d’activité est utilisé pour corréler les événements.</span><span class="sxs-lookup"><span data-stu-id="4d161-114">The activity ID is used to correlate events.</span></span> <span data-ttu-id="4d161-115">En mode utilisateur, les ID d’activité sont stockés dans les threads, et tous les événements journalisés dans un thread sont automatiquement marqués avec le même ID d’activité.</span><span class="sxs-lookup"><span data-stu-id="4d161-115">In user mode, activity IDs are stored in threads, and all events logged in one thread will automatically be tagged with the same activity ID.</span></span> <span data-ttu-id="4d161-116">En mode noyau, l’ID d’activité doit être explicitement transmis lorsqu’un événement est enregistré.</span><span class="sxs-lookup"><span data-stu-id="4d161-116">In kernel mode, the activity ID must be explicitly passed when an event is logged.</span></span> <span data-ttu-id="4d161-117">Par défaut, les fichiers ETL sont corrélés pour regrouper les événements sous des ID d’activité spécifiques.</span><span class="sxs-lookup"><span data-stu-id="4d161-117">By default, ETL files are correlated to group events together under specific activity IDs.</span></span>

<span data-ttu-id="4d161-118">Pour plus d’informations sur les événements Windows et ETW, consultez [événements Windows](../events/windows-events.md).</span><span class="sxs-lookup"><span data-stu-id="4d161-118">For more information about Windows Events and ETW, see [Windows Events](../events/windows-events.md).</span></span>

## <a name="etw-components-in-network-tracing"></a><span data-ttu-id="4d161-119">Composants ETW dans le traçage réseau</span><span class="sxs-lookup"><span data-stu-id="4d161-119">ETW Components in Network Tracing</span></span>

<span data-ttu-id="4d161-120">Le suivi réseau utilise ETW comme mécanisme de suivi principal pour fournir des informations sur les opérations effectuées par les sous-systèmes de mise en réseau.</span><span class="sxs-lookup"><span data-stu-id="4d161-120">Network tracing uses ETW as its primary tracing mechanism to provide information about what the networking subsystems are doing.</span></span> <span data-ttu-id="4d161-121">Il existe quatre composants principaux dans ETW : les sessions de suivi d’événements, les fournisseurs d’événements, les contrôleurs d’événements et les consommateurs d’événements.</span><span class="sxs-lookup"><span data-stu-id="4d161-121">There are four main components in ETW: event trace sessions, event providers, event controllers and event consumers.</span></span>

<span data-ttu-id="4d161-122">La mise en mémoire tampon et la journalisation ont lieu dans les *sessions de suivi d’événements*, qui acceptent les événements des fournisseurs et crée des fichiers de trace.</span><span class="sxs-lookup"><span data-stu-id="4d161-122">Buffering and logging take place in *event trace sessions*, which accept events from providers and creates trace files.</span></span>

<span data-ttu-id="4d161-123">Un *fournisseur d’événements* est une entité logique qui écrit des événements dans des sessions ETW.</span><span class="sxs-lookup"><span data-stu-id="4d161-123">An *event provider* is a logical entity that writes events to ETW sessions.</span></span> <span data-ttu-id="4d161-124">Un fournisseur d’événements peut être une application en mode utilisateur, une application managée, un pilote ou toute autre entité logicielle.</span><span class="sxs-lookup"><span data-stu-id="4d161-124">An event provider can be a user-mode application, a managed application, a driver, or any other software entity.</span></span> <span data-ttu-id="4d161-125">Les fournisseurs d’événements s’inscrivent avec ETW et écrivent des événements à partir de différents points du code en appelant l’API de journalisation ETW.</span><span class="sxs-lookup"><span data-stu-id="4d161-125">Event providers register with ETW and write events from various points in the code by invoking the ETW logging API.</span></span> <span data-ttu-id="4d161-126">En raison de la croissance de l’instrumentation d’événements dans de nombreux composants du système d’exploitation, même une application ou un scénario simple dans Windows contiendra plusieurs composants qui sont des fournisseurs d’événements.</span><span class="sxs-lookup"><span data-stu-id="4d161-126">Due to the growing event instrumentation in many operating system components, even a simple application or scenario in Windows will contain several components that are event providers.</span></span>

<span data-ttu-id="4d161-127">Un *contrôleur d’événements* démarre et arrête les sessions de suivi d’événements et active les fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="4d161-127">An *event controller* starts and stops event trace sessions and enables providers.</span></span> <span data-ttu-id="4d161-128">Lorsqu’un fournisseur d’événements est activé dynamiquement par l’application du contrôleur d’événements, le fournisseur envoie des événements à une session de suivi d’événements spécifique désignée par le contrôleur d’événements.</span><span class="sxs-lookup"><span data-stu-id="4d161-128">When an event provider is enabled dynamically by the event controller application, the provider sends events to a specific event trace session designated by the event controller.</span></span> <span data-ttu-id="4d161-129">Chaque événement envoyé par le fournisseur d’événements à la session de suivi d’événements se compose d’un en-tête fixe, qui inclut les métadonnées d’événement et toutes les données personnalisées supplémentaires journalisées par le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="4d161-129">Each event sent by the event provider to the event trace session consists of a fixed header, which includes event metadata and any additional custom data logged by the provider.</span></span>

<span data-ttu-id="4d161-130">Un *consommateur d’événements* est une application qui lit les fichiers journaux ou qui écoute une session de suivi d’événements pour les événements en temps réel et les traite.</span><span class="sxs-lookup"><span data-stu-id="4d161-130">An *event consumer* is an application that reads log files or that listens to an event trace session for real-time events and processes them.</span></span> <span data-ttu-id="4d161-131">Un exemple de consommateur d’événements est Moniteur réseau Microsoft 3,2, qui comprend la capacité de lire et d’afficher les fichiers journaux générés par le traçage réseau dans Windows 7.</span><span class="sxs-lookup"><span data-stu-id="4d161-131">One example of an event consumer is Microsoft Network Monitor 3.2, which includes the capability to read and display log files produced by network tracing in Windows 7.</span></span>

<span data-ttu-id="4d161-132">Les événements sont remis aux consommateurs d’événements dans l’ordre chronologique, et il existe plusieurs applications consommateur d’événements qui affichent les événements dans des formats spécifiques.</span><span class="sxs-lookup"><span data-stu-id="4d161-132">Events are delivered to event consumers in chronological order, and there are various event consumer applications that display the events in specific formats.</span></span> <span data-ttu-id="4d161-133">Lorsqu’un événement est enregistré dans une session, ETW ajoute des informations supplémentaires à l’en-tête de l’événement, y compris l’horodatage, le processus et l’ID de thread, le numéro de processeur et les données d’utilisation de l’UC du thread de journalisation.</span><span class="sxs-lookup"><span data-stu-id="4d161-133">When an event is logged to a session, ETW adds additional information to the event header, including the timestamp, process and thread ID, processor number, and CPU usage data of the logging thread.</span></span> <span data-ttu-id="4d161-134">Ces données sont ensuite transmises aux consommateurs d’événements, ainsi que toutes les données personnalisées incluses par le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="4d161-134">This data is then passed on to event consumers, along with any custom data included by the provider.</span></span>

<span data-ttu-id="4d161-135">Les fournisseurs utilisant les nouvelles [API de journalisation des événements](/windows/win32/api/evntprov/nf-evntprov-eventwrite) sont censés fournir un fichier XML appelé « manifeste d' [événements](../wes/eventschema-schema.md)».</span><span class="sxs-lookup"><span data-stu-id="4d161-135">Providers using the new [Event Logging APIs](/windows/win32/api/evntprov/nf-evntprov-eventwrite) are expected to supply an XML file called the [event manifest](../wes/eventschema-schema.md).</span></span> <span data-ttu-id="4d161-136">Ce fichier fournit des métadonnées pour définir toutes les données personnalisées et les informations de mise en page pour les événements écrits par le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="4d161-136">This file provides metadata to define all of the custom data and layout information for the events written by the provider.</span></span> <span data-ttu-id="4d161-137">Une application consommateur à usage général utilise ensuite des API [TDH (Trace Data Helper)](/windows/win32/api/tdh/) pour récupérer les métadonnées d’événement, décoder les événements et les afficher.</span><span class="sxs-lookup"><span data-stu-id="4d161-137">A general purpose consumer application then uses [Trace Data Helper (TDH)](/windows/win32/api/tdh/) APIs to retrieve the event metadata, decode the events, and display them.</span></span>

<span data-ttu-id="4d161-138">Avec le suivi réseau dans Windows 7, le contrôleur d’événements/le côté consommateur comprend une prise en charge du suivi basé sur les scénarios de bout en bout, intégrée aux expériences de diagnostic et de support Windows globales.</span><span class="sxs-lookup"><span data-stu-id="4d161-138">With network tracing in Windows 7, the event controller/consumer side includes end-to-end scenario-based tracing support integrated with overall Windows diagnostic and support experiences.</span></span> <span data-ttu-id="4d161-139">Un scénario définit une collection de fournisseurs d’événements impliqués dans le scénario.</span><span class="sxs-lookup"><span data-stu-id="4d161-139">A scenario defines a collection of event providers involved in the scenario.</span></span> <span data-ttu-id="4d161-140">Le côté contrôleur/consommateur d’événements définit les scénarios (contextes) dans lesquels le suivi peut être utilisé, y compris les fournisseurs appropriés pour des scénarios donnés à travers les composants réseau.</span><span class="sxs-lookup"><span data-stu-id="4d161-140">The event controller/consumer side defines the scenarios (contexts) where tracing can be used, including the relevant providers for given scenarios across network components.</span></span> <span data-ttu-id="4d161-141">Le côté fournisseur d’événements comprend des événements de suivi réseau standardisés provenant de différents composants de la pile réseau, qui peuvent être corrélés via des ID d’activité ETW.</span><span class="sxs-lookup"><span data-stu-id="4d161-141">The event provider side includes standardized network tracing events from different components in the network stack, which can be correlated via ETW activity IDs.</span></span> <span data-ttu-id="4d161-142">Les fournisseurs utilisent un schéma réseau commun qui normalise l’utilisation de concepts ETW tels que des mots clés, des niveaux, des tâches et des OpCodes.</span><span class="sxs-lookup"><span data-stu-id="4d161-142">The providers use a common network schema that standardizes the use of ETW concepts such as keywords, levels, tasks, and opcodes.</span></span> <span data-ttu-id="4d161-143">Le schéma définit également des événements qui sont communs à de nombreux composants réseau, tels que les événements d’erreur, les événements de suppression de paquets, les événements de schéma et les événements de transition d’État.</span><span class="sxs-lookup"><span data-stu-id="4d161-143">The schema also defines events that are common for many network components such as error events, packet drop events, schema events, and state transition events.</span></span>

 

 