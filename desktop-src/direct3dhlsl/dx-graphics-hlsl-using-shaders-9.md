---
title: Utilisation de nuanceurs dans Direct3D 9
description: Utilisation de nuanceurs dans Direct3D 9
ms.assetid: 8d8f5124-fbf3-4af5-8399-43ba28aa6eb9
ms.topic: article
ms.date: 05/31/2018
topic_type:
- kbArticle
api_name: ''
api_type: ''
api_location: ''
ms.openlocfilehash: 6455b47d24c1c83683ce8b85c48990bb32e221ae
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104990904"
---
# <a name="using-shaders-in-direct3d-9"></a><span data-ttu-id="f34dd-103">Utilisation de nuanceurs dans Direct3D 9</span><span class="sxs-lookup"><span data-stu-id="f34dd-103">Using Shaders in Direct3D 9</span></span>

-   [<span data-ttu-id="f34dd-104">Compilation d’un nuanceur pour un matériel spécifique</span><span class="sxs-lookup"><span data-stu-id="f34dd-104">Compiling a Shader for Specific Hardware</span></span>](#compiling-a-shader-for-specific-hardware)
-   [<span data-ttu-id="f34dd-105">Initialisation des constantes de nuanceur</span><span class="sxs-lookup"><span data-stu-id="f34dd-105">Initializing Shader Constants</span></span>](#initializing-shader-constants)
-   [<span data-ttu-id="f34dd-106">Liaison d’un paramètre Shader à un registre particulier</span><span class="sxs-lookup"><span data-stu-id="f34dd-106">Binding a Shader Parameter to a Particular Register</span></span>](#binding-a-shader-parameter-to-a-particular-register)
-   [<span data-ttu-id="f34dd-107">Rendu d’un nuanceur programmable</span><span class="sxs-lookup"><span data-stu-id="f34dd-107">Rendering a Programmable Shader</span></span>](#rendering-a-programmable-shader)
-   [<span data-ttu-id="f34dd-108">Débogage des nuanceurs</span><span class="sxs-lookup"><span data-stu-id="f34dd-108">Debugging Shaders</span></span>](#debugging-shaders)
-   [<span data-ttu-id="f34dd-109">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="f34dd-109">Related topics</span></span>](#related-topics)

## <a name="compiling-a-shader-for-specific-hardware"></a><span data-ttu-id="f34dd-110">Compilation d’un nuanceur pour un matériel spécifique</span><span class="sxs-lookup"><span data-stu-id="f34dd-110">Compiling a Shader for Specific Hardware</span></span>

<span data-ttu-id="f34dd-111">Des nuanceurs ont été ajoutés pour la première fois à Microsoft DirectX dans DirectX 8,0.</span><span class="sxs-lookup"><span data-stu-id="f34dd-111">Shaders were first added to Microsoft DirectX in DirectX 8.0.</span></span> <span data-ttu-id="f34dd-112">À ce moment-là, plusieurs machines-nuanceurs virtuels ont été définies, chacune correspondant approximativement à un processeur graphique particulier produit par les principaux fournisseurs de graphiques 3D.</span><span class="sxs-lookup"><span data-stu-id="f34dd-112">At that time, several virtual shader machines were defined, each roughly corresponding to a particular graphics processor produced by the top 3D graphics vendors.</span></span> <span data-ttu-id="f34dd-113">Pour chacun de ces ordinateurs de nuanceur virtuel, un langage assembleur a été conçu.</span><span class="sxs-lookup"><span data-stu-id="f34dd-113">For each of these virtual shader machines, an assembly language was designed.</span></span> <span data-ttu-id="f34dd-114">Les programmes écrits dans les modèles de nuanceur (noms vs \_ 1 1 \_ et PS 1 \_ \_ 1-PS \_ 1 \_ 4) étaient relativement courts et étaient généralement écrits par les développeurs directement dans le langage d’assembly approprié.</span><span class="sxs-lookup"><span data-stu-id="f34dd-114">Programs written to the shader models (names vs\_1\_1 and ps\_1\_1 - ps\_1\_4) were relatively short and were generally written by developers directly in the appropriate assembly language.</span></span> <span data-ttu-id="f34dd-115">L’application transmet ce code de langage assembleur lisible à la bibliothèque D3DX à l’aide de [**D3DXAssembleShader**](/windows/desktop/direct3d9/d3dxassembleshader) et récupère une représentation binaire du nuanceur qui, à son tour, est passée à l’aide de [**CreateVertexShader**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createvertexshader) ou [**CreatePixelShader**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createpixelshader).</span><span class="sxs-lookup"><span data-stu-id="f34dd-115">The application would pass this human-readable assembly language code to the D3DX library using [**D3DXAssembleShader**](/windows/desktop/direct3d9/d3dxassembleshader) and get back a binary representation of the shader which would in turn get passed using [**CreateVertexShader**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createvertexshader) or [**CreatePixelShader**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createpixelshader).</span></span> <span data-ttu-id="f34dd-116">Pour plus d’informations, consultez le kit de développement logiciel (SDK).</span><span class="sxs-lookup"><span data-stu-id="f34dd-116">For more detail, see the software development kit (SDK).</span></span>

<span data-ttu-id="f34dd-117">La situation dans Direct3D 9 est similaire.</span><span class="sxs-lookup"><span data-stu-id="f34dd-117">The situation in Direct3D 9 is similar.</span></span> <span data-ttu-id="f34dd-118">Une application passe un nuanceur HLSL à D3DX à l’aide de [**D3DXCompileShader**](/windows/desktop/direct3d9/d3dxcompileshader) et récupère une représentation binaire du nuanceur compilé qui, à son tour, est transmise à Microsoft Direct3D à l’aide de [**CreatePixelShader**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createpixelshader) ou [**CreateVertexShader**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createvertexshader).</span><span class="sxs-lookup"><span data-stu-id="f34dd-118">An application passes an HLSL shader to D3DX using [**D3DXCompileShader**](/windows/desktop/direct3d9/d3dxcompileshader) and gets back a binary representation of the compiled shader which in turn is passed to Microsoft Direct3D using [**CreatePixelShader**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createpixelshader) or [**CreateVertexShader**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createvertexshader).</span></span> <span data-ttu-id="f34dd-119">Le runtime ne connaît rien du langage HLSL, mais uniquement les modèles de nuanceur d’assemblys binaires.</span><span class="sxs-lookup"><span data-stu-id="f34dd-119">The runtime does not know anything about HLSL, only the binary assembly shader models.</span></span> <span data-ttu-id="f34dd-120">C’est agréable, car cela signifie que le compilateur HLSL peut être mis à jour indépendamment du runtime Direct3D.</span><span class="sxs-lookup"><span data-stu-id="f34dd-120">This is nice because it means that the HLSL compiler can be updated independent of the Direct3D runtime.</span></span> <span data-ttu-id="f34dd-121">Vous pouvez également compiler les nuanceurs hors connexion à l’aide de [fxc](/windows/desktop/direct3dtools/fxc).</span><span class="sxs-lookup"><span data-stu-id="f34dd-121">You can also compile shaders offline using [fxc](/windows/desktop/direct3dtools/fxc).</span></span>

<span data-ttu-id="f34dd-122">En plus du développement du compilateur HLSL, Direct3D 9 introduit également les modèles de nuanceur au niveau de l’assembly pour exposer les fonctionnalités de la dernière génération de matériel graphique.</span><span class="sxs-lookup"><span data-stu-id="f34dd-122">In addition to the development of the HLSL compiler, Direct3D 9 also introduced the assembly-level shader models to expose the functionality of the latest generation of graphics hardware.</span></span> <span data-ttu-id="f34dd-123">Les développeurs d’applications peuvent travailler en assembly pour ces nouveaux modèles (vs \_ 2 \_ 0, vs \_ 3 \_ 0, PS \_ 2 \_ 0, PS \_ 3 \_ 0), mais nous pensons que la plupart des développeurs se déplaceront en HLSL pour le développement de nuanceur.</span><span class="sxs-lookup"><span data-stu-id="f34dd-123">Application developers can work in assembly for these new models (vs\_2\_0, vs\_3\_0, ps\_2\_0, ps\_3\_0) but we expect most developers to move to HLSL for shader development.</span></span>

<span data-ttu-id="f34dd-124">Bien entendu, la possibilité d’écrire un programme HLSL pour exprimer un algorithme d’ombrage particulier ne lui permet pas de s’exécuter automatiquement sur un matériel donné.</span><span class="sxs-lookup"><span data-stu-id="f34dd-124">Of course, the ability to write an HLSL program to express a particular shading algorithm does not automatically enable it to run on any given hardware.</span></span> <span data-ttu-id="f34dd-125">Une application appelle D3DX pour compiler un nuanceur dans du code assembleur binaire avec [**D3DXCompileShader**](/windows/desktop/direct3d9/d3dxcompileshader).</span><span class="sxs-lookup"><span data-stu-id="f34dd-125">An application calls D3DX to compile a shader into binary assembly code with [**D3DXCompileShader**](/windows/desktop/direct3d9/d3dxcompileshader).</span></span> <span data-ttu-id="f34dd-126">L’une des limitations de ce point d’entrée est un paramètre qui définit quels modèles au niveau de l’assembly (ou cibles de compilation) le compilateur HLSL doit utiliser pour exprimer le code du nuanceur final.</span><span class="sxs-lookup"><span data-stu-id="f34dd-126">One of the limitations with this entry point is a parameter that defines which of the assembly-level models (or compilation targets) the HLSL compiler should use to express the final shader code.</span></span> <span data-ttu-id="f34dd-127">Si une application exécute la compilation du nuanceur HLSL au moment de l’exécution (par opposition au temps de compilation ou hors connexion), l’application peut examiner les fonctionnalités du périphérique Direct3D et sélectionner la cible de compilation à faire correspondre.</span><span class="sxs-lookup"><span data-stu-id="f34dd-127">If an application is doing HLSL shader compilation at run time (as opposed to compile time or offline), the application could examine the capabilities of the Direct3D device and select the compilation target to match.</span></span> <span data-ttu-id="f34dd-128">Si l’algorithme exprimé dans le nuanceur HLSL est trop complexe pour s’exécuter sur la cible de compilation sélectionnée, la compilation échoue.</span><span class="sxs-lookup"><span data-stu-id="f34dd-128">If the algorithm expressed in the HLSL shader is too complex to execute on the selected compilation target, compilation will fail.</span></span> <span data-ttu-id="f34dd-129">Cela signifie que bien que le langage HLSL soit un énorme avantage pour le développement de nuanceur, il ne libère pas les développeurs des réalités de l’expédition de jeux à un public cible avec des appareils graphiques de fonctionnalités variables.</span><span class="sxs-lookup"><span data-stu-id="f34dd-129">This means that while HLSL is a huge benefit to shader development, it does not free developers from the realities of shipping games to a target audience with graphics devices of varying capabilities.</span></span> <span data-ttu-id="f34dd-130">En tant que développeur de jeux, vous devez toujours gérer une approche à plusieurs niveaux pour vos visuels. Cela signifie l’écriture de meilleurs nuanceurs pour les cartes graphiques plus performantes et l’écriture d’autres versions de base pour les cartes plus anciennes.</span><span class="sxs-lookup"><span data-stu-id="f34dd-130">As a game developer, you still have to manage a tiered approach to your visuals; this means writing better shaders for more capable graphics cards and writing more basic versions for older cards.</span></span> <span data-ttu-id="f34dd-131">Toutefois, avec un langage HLSL bien écrit, cette charge peut être considérablement allégée.</span><span class="sxs-lookup"><span data-stu-id="f34dd-131">With well written HLSL, however, this burden can be eased significantly.</span></span>

<span data-ttu-id="f34dd-132">Plutôt que de compiler des nuanceurs HLSL à l’aide de D3DX sur l’ordinateur du client au moment du chargement de l’application ou lors de la première utilisation, de nombreux développeurs choisissent de compiler leur nuanceur du langage HLSL en code assembleur binaire avant même d’être expédiés.</span><span class="sxs-lookup"><span data-stu-id="f34dd-132">Rather than compile HLSL shaders using D3DX on the customer's machine at application load time or on first use, many developers choose to compile their shader from HLSL to binary assembly code before they even ship.</span></span> <span data-ttu-id="f34dd-133">Cela permet de conserver le code source HLSL à l’écart des regards indiscrets et de s’assurer que tous les nuanceurs de leur application s’exécuteront dans le processus interne d’assurance qualité.</span><span class="sxs-lookup"><span data-stu-id="f34dd-133">This keeps their HLSL source code away from prying eyes and also ensures that all the shaders their application will ever run have gone through their internal quality assurance process.</span></span> <span data-ttu-id="f34dd-134">Un utilitaire pratique pour la compilation des nuanceurs hors connexion est [fxc](/windows/desktop/direct3dtools/fxc).</span><span class="sxs-lookup"><span data-stu-id="f34dd-134">A convenient utility for compiling shaders offline is [fxc](/windows/desktop/direct3dtools/fxc).</span></span> <span data-ttu-id="f34dd-135">Cet outil comporte un certain nombre d’options que vous pouvez utiliser pour compiler du code pour la cible de compilation spécifiée.</span><span class="sxs-lookup"><span data-stu-id="f34dd-135">This tool has a number of options that you can use to compile code for the specified compile target.</span></span> <span data-ttu-id="f34dd-136">L’étude de la sortie désassemblée peut être très utile lors du développement si vous souhaitez optimiser vos nuanceurs ou simplement connaître les fonctionnalités de l’ordinateur de nuanceur virtuel à un niveau plus détaillé.</span><span class="sxs-lookup"><span data-stu-id="f34dd-136">Studying the disassembled output can be very educational during development if you want to optimize your shaders or just generally get to know the virtual shader machine's capabilities at a more detailed level.</span></span> <span data-ttu-id="f34dd-137">Ces options sont résumées ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="f34dd-137">These options are summarized below:</span></span>

## <a name="initializing-shader-constants"></a><span data-ttu-id="f34dd-138">Initialisation des constantes de nuanceur</span><span class="sxs-lookup"><span data-stu-id="f34dd-138">Initializing Shader Constants</span></span>

<span data-ttu-id="f34dd-139">Les constantes de nuanceur sont contenues dans la table constante.</span><span class="sxs-lookup"><span data-stu-id="f34dd-139">Shader constants are contained in the constant table.</span></span> <span data-ttu-id="f34dd-140">Vous pouvez y accéder à l’aide de l’interface [**ID3DXConstantTable**](/windows/desktop/direct3d9/id3dxconstanttable) .</span><span class="sxs-lookup"><span data-stu-id="f34dd-140">This can be accessed with the [**ID3DXConstantTable**](/windows/desktop/direct3d9/id3dxconstanttable) interface.</span></span> <span data-ttu-id="f34dd-141">Les variables globales du nuanceur peuvent être initialisées dans le code du nuanceur.</span><span class="sxs-lookup"><span data-stu-id="f34dd-141">Global shader variables can be initialized in shader code.</span></span> <span data-ttu-id="f34dd-142">Celles-ci sont initialisées au moment de l’exécution en appelant [**SetDefaults**](/windows/desktop/direct3d9/id3dxconstanttable--setdefaults).</span><span class="sxs-lookup"><span data-stu-id="f34dd-142">These are initialized at run time by calling [**SetDefaults**](/windows/desktop/direct3d9/id3dxconstanttable--setdefaults).</span></span>

## <a name="binding-a-shader-parameter-to-a-particular-register"></a><span data-ttu-id="f34dd-143">Liaison d’un paramètre Shader à un registre particulier</span><span class="sxs-lookup"><span data-stu-id="f34dd-143">Binding a Shader Parameter to a Particular Register</span></span>

<span data-ttu-id="f34dd-144">Le compilateur assigne automatiquement les registres aux variables globales.</span><span class="sxs-lookup"><span data-stu-id="f34dd-144">The compiler will automatically assign registers to global variables.</span></span> <span data-ttu-id="f34dd-145">Le compilateur assignerait l’environnement au registre de l’échantillonneur S0, SparkleNoise au registre de l’échantillonneur S1 et k \_ s au registre de constante C0 (en supposant qu’aucun autre échantillon ou registre constant n’a déjà été affecté) pour les trois variables globales suivantes :</span><span class="sxs-lookup"><span data-stu-id="f34dd-145">The compiler would assign Environment to sampler register s0, SparkleNoise to sampler register s1, and k\_s to constant register c0 (assuming no other sampler or constant registers were already assigned) for the following three global variables:</span></span>


```
sampler Environment;
sampler SparkleNoise;
float4 k_s;
```



<span data-ttu-id="f34dd-146">Il est également possible de lier des variables à un registre spécifique.</span><span class="sxs-lookup"><span data-stu-id="f34dd-146">It is also possible to bind variables to a specific register.</span></span> <span data-ttu-id="f34dd-147">Pour forcer le compilateur à assigner à un registre particulier, utilisez la syntaxe suivante :</span><span class="sxs-lookup"><span data-stu-id="f34dd-147">To force the compiler to assign to a particular register, use the following syntax:</span></span>


```
register(RegisterName)
```



<span data-ttu-id="f34dd-148">où RegisterName est le nom du Registre spécifique.</span><span class="sxs-lookup"><span data-stu-id="f34dd-148">where RegisterName is the name of the specific register.</span></span> <span data-ttu-id="f34dd-149">Les exemples suivants illustrent la syntaxe d’affectation de Registre spécifique, où l’environnement de l’échantillonneur sera lié au registre de l’échantillonneur S1, SparkleNoise sera lié au registre d’échantillonnage S0, et k \_ s sera lié à un registre de C12 constant :</span><span class="sxs-lookup"><span data-stu-id="f34dd-149">The following examples demonstrate the specific register assignment syntax, where the sampler Environment will be bound to sampler register s1, SparkleNoise will be bound to sampler register s0, and k\_s will be bound to constant register c12:</span></span>


```
sampler Environment : register(s1);
sampler SparkleNoise : register(s0);
float4 k_s : register(c12);
```



## <a name="rendering-a-programmable-shader"></a><span data-ttu-id="f34dd-150">Rendu d’un nuanceur programmable</span><span class="sxs-lookup"><span data-stu-id="f34dd-150">Rendering a Programmable Shader</span></span>

<span data-ttu-id="f34dd-151">Un nuanceur est rendu en définissant le nuanceur actuel dans l’appareil, en initialisant les constantes du nuanceur, en indiquant l’appareil sur lequel proviennent les données d’entrée variables et enfin en rendant les primitives.</span><span class="sxs-lookup"><span data-stu-id="f34dd-151">A shader is rendered by setting the current shader in the device, initializing the shader constants, telling the device where the varying input data is coming from, and finally rendering the primitives.</span></span> <span data-ttu-id="f34dd-152">Chacun d’entre eux peut être obtenu en appelant les méthodes suivantes, respectivement :</span><span class="sxs-lookup"><span data-stu-id="f34dd-152">Each of these can be accomplished by calling the following methods respectively:</span></span>

-   [<span data-ttu-id="f34dd-153">**SetVertexShader**</span><span class="sxs-lookup"><span data-stu-id="f34dd-153">**SetVertexShader**</span></span>](/windows/desktop/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setvertexshader)
-   [<span data-ttu-id="f34dd-154">**SetVertexShaderConstantF**</span><span class="sxs-lookup"><span data-stu-id="f34dd-154">**SetVertexShaderConstantF**</span></span>](/windows/desktop/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setvertexshaderconstantf)
-   [<span data-ttu-id="f34dd-155">**SetStreamSource**</span><span class="sxs-lookup"><span data-stu-id="f34dd-155">**SetStreamSource**</span></span>](/windows/desktop/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setstreamsource)
-   [<span data-ttu-id="f34dd-156">**DrawPrimitive**</span><span class="sxs-lookup"><span data-stu-id="f34dd-156">**DrawPrimitive**</span></span>](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-drawprimitive)

## <a name="debugging-shaders"></a><span data-ttu-id="f34dd-157">Débogage des nuanceurs</span><span class="sxs-lookup"><span data-stu-id="f34dd-157">Debugging Shaders</span></span>

<span data-ttu-id="f34dd-158">L’extension DirectX pour Microsoft Visual Studio .NET fournit un débogueur HLSL entièrement intégré dans l’environnement de développement intégré (IDE) de Visual Studio .NET.</span><span class="sxs-lookup"><span data-stu-id="f34dd-158">The DirectX extension for Microsoft Visual Studio .NET is provides a fully integrated HLSL debugger within the Visual Studio .NET Integrated Development Environment (IDE).</span></span> <span data-ttu-id="f34dd-159">Pour préparer le débogage du nuanceur, vous devez installer les outils appropriés sur votre ordinateur (consultez [débogage des nuanceurs dans Visual Studio (Direct3D 9)](dx-graphics-hlsl-debug-visual-studio.md)).</span><span class="sxs-lookup"><span data-stu-id="f34dd-159">In order to prepare for shader debugging, you must install the right tools on your machine (see [Debugging Shaders in Visual Studio (Direct3D 9)](dx-graphics-hlsl-debug-visual-studio.md)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="f34dd-160">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="f34dd-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f34dd-161">Guide de programmation pour HLSL</span><span class="sxs-lookup"><span data-stu-id="f34dd-161">Programming Guide for HLSL</span></span>](dx-graphics-hlsl-pguide.md)
</dt> </dl>

 

 