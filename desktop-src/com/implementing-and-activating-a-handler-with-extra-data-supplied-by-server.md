---
title: Implémentation et activation d’un gestionnaire avec des données supplémentaires fournies par le serveur
description: Implémentation et activation d’un gestionnaire avec des données supplémentaires fournies par le serveur
ms.assetid: 5bbf81bd-430d-4008-b1cc-9ea91bb3b1e7
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db78a3e39c85c37c52dfa3f09ef41f0a71b5f431
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/03/2021
ms.locfileid: "104321322"
---
# <a name="implementing-and-activating-a-handler-with-extra-data-supplied-by-server"></a><span data-ttu-id="bb33e-103">Implémentation et activation d’un gestionnaire avec des données supplémentaires fournies par le serveur</span><span class="sxs-lookup"><span data-stu-id="bb33e-103">Implementing and Activating a Handler with Extra Data Supplied by Server</span></span>

<span data-ttu-id="bb33e-104">Si le serveur souhaite inclure des données supplémentaires dans le paquet à utiliser par le gestionnaire, le serveur doit implémenter les interfaces [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) et [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) .</span><span class="sxs-lookup"><span data-stu-id="bb33e-104">If the server wants to include some extra data in the packet for the handler to use, the server must implement both the [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) and the [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) interfaces.</span></span> <span data-ttu-id="bb33e-105">Le serveur doit agréger le marshaleur standard et doit déléguer la première partie du marshaling au marshaleur standard agrégé, y compris [**IMarshal :: GetUnmarshalClass**](/windows/desktop/api/ObjIdl/nf-objidl-imarshal-getunmarshalclass), et doit ajouter sa propre taille de données à la taille retournée par le [**IMarshal :: GetMarshalSizeMax**](/windows/desktop/api/ObjIdl/nf-objidl-imarshal-getmarshalsizemax)du marshaleur standard.</span><span class="sxs-lookup"><span data-stu-id="bb33e-105">The server must aggregate the standard marshaler and must delegate the first part of the marshaling to the aggregated standard marshaler, including [**IMarshal::GetUnmarshalClass**](/windows/desktop/api/ObjIdl/nf-objidl-imarshal-getunmarshalclass), and must add its own data size to the size returned by the standard marshaler's [**IMarshal::GetMarshalSizeMax**](/windows/desktop/api/ObjIdl/nf-objidl-imarshal-getmarshalsizemax).</span></span> <span data-ttu-id="bb33e-106">Le marshaleur standard appelle [**IStdMarshalInfo :: GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler) pour récupérer le CLSID du gestionnaire à créer.</span><span class="sxs-lookup"><span data-stu-id="bb33e-106">The standard marshaler calls [**IStdMarshalInfo::GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler) to get the CLSID of the handler to be created.</span></span> <span data-ttu-id="bb33e-107">Une fois que le marshaleur standard a effectué son marshaling, le serveur écrit ses propres données supplémentaires dans le flux.</span><span class="sxs-lookup"><span data-stu-id="bb33e-107">After the standard marshaler has done its marshaling, the server then writes its own extra data into the stream.</span></span> <span data-ttu-id="bb33e-108">Les structures résultantes, avec des données supplémentaires dans le flux, sont affichées dans l’illustration suivante :</span><span class="sxs-lookup"><span data-stu-id="bb33e-108">The resulting structures, with extra data in the stream, are shown in the following illustration:</span></span>

![Diagramme qui affiche des structures avec des données supplémentaires dans le flux.](images/4cff306b-bb82-4c05-8e64-7ca73731f265.png)

## <a name="server-side-structures-with-extra-data-in-stream"></a><span data-ttu-id="bb33e-110">Server-Side les structures avec des données supplémentaires dans le flux</span><span class="sxs-lookup"><span data-stu-id="bb33e-110">Server-Side Structures with Extra Data in Stream</span></span>

<span data-ttu-id="bb33e-111">Cela permet à l’appel de COM à [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) côté client d’ignorer les données non lues et de conserver le flux dans la position appropriée qui suit toutes les données d’interface marshalées si le gestionnaire ne peut pas être créé.</span><span class="sxs-lookup"><span data-stu-id="bb33e-111">This allows the call from COM to [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) on the client side the ability to skip over any unread data and leave the stream in the appropriate position following all the marshaled interface data if the handler cannot be created.</span></span>

## <a name="client-side-structures-with-extra-data-in-stream"></a><span data-ttu-id="bb33e-112">Client-Side les structures avec des données supplémentaires dans le flux</span><span class="sxs-lookup"><span data-stu-id="bb33e-112">Client-Side Structures with Extra Data in Stream</span></span>

<span data-ttu-id="bb33e-113">Comme dans le cas où il n’y a pas de données serveur supplémentaires dans le flux, l’appel COM côté client à [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) créera l’identité et le gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="bb33e-113">As in the case where there is no extra server data in the stream, the client-side COM call to [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) will create the identity and handler.</span></span> <span data-ttu-id="bb33e-114">Le gestionnaire doit implémenter [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) et doit déléguer d’abord les appels **IMarshal** au marshaleur standard agrégé, puis marshaler ou démarshaler les données supplémentaires fournies par le serveur.</span><span class="sxs-lookup"><span data-stu-id="bb33e-114">The handler must implement [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) and must delegate the **IMarshal** calls to the aggregated standard marshaler first and then marshal or unmarshal any extra data that the server provided.</span></span> <span data-ttu-id="bb33e-115">Le [**UnmarshalInterface**](/windows/win32/api/objidlbase/nf-objidlbase-imarshal-unmarshalinterface) du gestionnaire sera appelé pour chaque unmarshalé, qu’il ait ou non marshalé l’interface.</span><span class="sxs-lookup"><span data-stu-id="bb33e-115">The handler's [**UnmarshalInterface**](/windows/win32/api/objidlbase/nf-objidlbase-imarshal-unmarshalinterface) will be called for every unmarshal, regardless of whether it has unmarshaled the interface before or not.</span></span> <span data-ttu-id="bb33e-116">Dans ce cas, le serveur n’appelle pas [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) , mais le gestionnaire doit le faire.</span><span class="sxs-lookup"><span data-stu-id="bb33e-116">In this case, the server does not call [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) but the handler must.</span></span> <span data-ttu-id="bb33e-117">La structure résultante côté client est présentée dans l’illustration suivante.</span><span class="sxs-lookup"><span data-stu-id="bb33e-117">The resulting client-side structure is shown in the following illustration.</span></span>

![Diagramme qui montre la structure côté client.](images/053411c7-9d54-4ae5-bcb6-778454b1d86f.png)

## <a name="related-topics"></a><span data-ttu-id="bb33e-119">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="bb33e-119">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bb33e-120">Gestionnaire de Client-Side léger</span><span class="sxs-lookup"><span data-stu-id="bb33e-120">The Lightweight Client-Side Handler</span></span>](the-lightweight-client-side-handler.md)
</dt> </dl>

 

 