---
title: Masquage (COM)
description: Le masquage est une fonctionnalité de sécurité COM qui détermine l’identité que le client projette sur le serveur lors de l’emprunt d’identité.
ms.assetid: 5b97d9d6-8fa9-4da2-8351-64772227d9a2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 588651cfa37def4e174ef0f2fdba9b79b0c60ca8
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/03/2021
ms.locfileid: "103869317"
---
# <a name="cloaking-com"></a><span data-ttu-id="b1b73-103">Masquage (COM)</span><span class="sxs-lookup"><span data-stu-id="b1b73-103">Cloaking (COM)</span></span>

<span data-ttu-id="b1b73-104">Le masquage est une fonctionnalité de sécurité COM qui détermine l’identité que le client projette sur le serveur lors de l’emprunt d’identité.</span><span class="sxs-lookup"><span data-stu-id="b1b73-104">Cloaking is a COM security capability that determines what identity the client projects toward the server during impersonation.</span></span> <span data-ttu-id="b1b73-105">Lorsque le masquage est défini, le serveur intermédiaire masque sa propre identité et présente l’identité du client au serveur qu’il appelle au nom du client.</span><span class="sxs-lookup"><span data-stu-id="b1b73-105">When cloaking is set, the intermediate server masks its own identity and presents the client's identity to the server that it calls on the client's behalf.</span></span> <span data-ttu-id="b1b73-106">Directeur l’identité du client qui est affichée par le serveur est l’identité associée au proxy.</span><span class="sxs-lookup"><span data-stu-id="b1b73-106">Basically; the client identity that is seen by the server is the identity associated with the proxy.</span></span> <span data-ttu-id="b1b73-107">L’identité du proxy est déterminée par plusieurs facteurs, dont l’un est le type de masquage défini (le cas échéant).</span><span class="sxs-lookup"><span data-stu-id="b1b73-107">The proxy's identity is determined by several factors, one of which is the type of cloaking that is set (if any).</span></span> <span data-ttu-id="b1b73-108">Le masquage n’est pas pris en charge par le fournisseur de sécurité Schannel.</span><span class="sxs-lookup"><span data-stu-id="b1b73-108">Cloaking is not supported by the Schannel security provider.</span></span>

<span data-ttu-id="b1b73-109">Les rubriques suivantes fournissent plus d’informations sur le masquage :</span><span class="sxs-lookup"><span data-stu-id="b1b73-109">The following topics provide more information about cloaking:</span></span>

-   [<span data-ttu-id="b1b73-110">Types de masquage</span><span class="sxs-lookup"><span data-stu-id="b1b73-110">Types of Cloaking</span></span>](#types-of-cloaking)
-   [<span data-ttu-id="b1b73-111">Impact du masquage sur l’identité du client</span><span class="sxs-lookup"><span data-stu-id="b1b73-111">How Cloaking Affects Client Identity</span></span>](#how-cloaking-affects-client-identity)
-   [<span data-ttu-id="b1b73-112">Définir le masquage</span><span class="sxs-lookup"><span data-stu-id="b1b73-112">Setting Cloaking</span></span>](#setting-cloaking)
-   [<span data-ttu-id="b1b73-113">Masquage et niveaux d’emprunt d’identité</span><span class="sxs-lookup"><span data-stu-id="b1b73-113">Cloaking and Impersonation Levels</span></span>](#cloaking-and-impersonation-levels)
-   [<span data-ttu-id="b1b73-114">Scénarios de voilage</span><span class="sxs-lookup"><span data-stu-id="b1b73-114">Cloaking Scenarios</span></span>](#cloaking-scenarios)
-   [<span data-ttu-id="b1b73-115">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="b1b73-115">Related topics</span></span>](#related-topics)

## <a name="types-of-cloaking"></a><span data-ttu-id="b1b73-116">Types de masquage</span><span class="sxs-lookup"><span data-stu-id="b1b73-116">Types of Cloaking</span></span>

<span data-ttu-id="b1b73-117">Il existe deux types de masquage : le masquage *statique* et le masquage *dynamique* :</span><span class="sxs-lookup"><span data-stu-id="b1b73-117">There are two types of cloaking: *static* cloaking and *dynamic* cloaking:</span></span>

-   <span data-ttu-id="b1b73-118">Avec le masquage statique (EOAC \_ statique \_ ), le serveur voit le jeton de thread du premier appel d’un client au serveur.</span><span class="sxs-lookup"><span data-stu-id="b1b73-118">With static cloaking (EOAC\_STATIC\_CLOAKING), the server sees the thread token from the first call from a client to the server.</span></span> <span data-ttu-id="b1b73-119">Pour le premier appel, si l’identité du proxy a été définie précédemment lors d’un appel à [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), cette identité de proxy est utilisée.</span><span class="sxs-lookup"><span data-stu-id="b1b73-119">For the first call, if the proxy identity was previously set during a call to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), that proxy identity is used.</span></span> <span data-ttu-id="b1b73-120">Toutefois, si l’identité du proxy n’a pas été définie précédemment, le jeton de thread est utilisé.</span><span class="sxs-lookup"><span data-stu-id="b1b73-120">However, if the proxy identity was not previously set, the thread token is used.</span></span> <span data-ttu-id="b1b73-121">Si aucun jeton de thread n’est présent, le jeton de processus est utilisé.</span><span class="sxs-lookup"><span data-stu-id="b1b73-121">If no thread token is present, the process token is used.</span></span> <span data-ttu-id="b1b73-122">Pour tous les appels ultérieurs, l’identité définie sur le premier appel est utilisée.</span><span class="sxs-lookup"><span data-stu-id="b1b73-122">For all future calls, the identity set on the first call is used.</span></span>
-   <span data-ttu-id="b1b73-123">Avec le masquage dynamique (EOAC \_ Dynamic \_ voilage), à chaque appel, le jeton de thread actuel (s’il existe un jeton de thread) est utilisé pour déterminer l’identité du client.</span><span class="sxs-lookup"><span data-stu-id="b1b73-123">With dynamic cloaking (EOAC\_DYNAMIC\_CLOAKING), on each call the current thread token (if there is a thread token) is used to determine the client's identity.</span></span> <span data-ttu-id="b1b73-124">S’il n’y a aucun jeton de thread, le jeton de processus est utilisé.</span><span class="sxs-lookup"><span data-stu-id="b1b73-124">If there is no thread token, the process token is used.</span></span> <span data-ttu-id="b1b73-125">Cela signifie que les serveurs appelés au nom du client pendant l’emprunt d’identité voient l’identité du client COM à l’origine de l’appel, qui est généralement le comportement souhaité.</span><span class="sxs-lookup"><span data-stu-id="b1b73-125">This means that servers called on the client's behalf during impersonation see the identity of the COM client that originated the call, which is generally the desired behavior.</span></span> <span data-ttu-id="b1b73-126">(Bien sûr, pour que l’emprunt d’identité aboutisse, le client doit avoir donné l’autorité de serveur pour emprunter l’identité en définissant un niveau d’emprunt d’identité approprié.</span><span class="sxs-lookup"><span data-stu-id="b1b73-126">(Of course, for impersonation to succeed, the client must have given the server authority to impersonate by setting an appropriate impersonation level.</span></span> <span data-ttu-id="b1b73-127">Pour plus d’informations, consultez [niveaux d’emprunt d’identité](impersonation-levels.md).) Ce type de masquage est onéreux.</span><span class="sxs-lookup"><span data-stu-id="b1b73-127">For more information, see [Impersonation Levels](impersonation-levels.md).) This type of cloaking is expensive.</span></span>

## <a name="how-cloaking-affects-client-identity"></a><span data-ttu-id="b1b73-128">Impact du masquage sur l’identité du client</span><span class="sxs-lookup"><span data-stu-id="b1b73-128">How Cloaking Affects Client Identity</span></span>

<span data-ttu-id="b1b73-129">Lorsqu’un appel chiffré est effectué et que le serveur demande son identité au client, il obtient généralement l’identité associée au proxy.</span><span class="sxs-lookup"><span data-stu-id="b1b73-129">When an encrypted call is made and the server asks the client for its identity, it usually gets the identity tied to the proxy.</span></span> <span data-ttu-id="b1b73-130">(Parfois, le service d’authentification effectue une traduction à partir de l’identité réelle, mais en général, l’identité du proxy est l’identité que le serveur voit.) Le proxy présente une identité au serveur qui dépend du type de masquage défini et d’autres facteurs.</span><span class="sxs-lookup"><span data-stu-id="b1b73-130">(Sometimes the authentication service performs a translation from the real identity, but generally the proxy identity is the identity the server sees.) The proxy presents an identity to the server that depends on the type of cloaking that is set and other factors.</span></span>

<span data-ttu-id="b1b73-131">Pour résumer, l’identité du client est une fonction de l’indicateur de masquage défini, du jeton de processus, de la présence ou de l’absence d’un jeton de thread, et si l’identité du proxy a été définie précédemment.</span><span class="sxs-lookup"><span data-stu-id="b1b73-131">To summarize, the identity of the client is a function of the cloaking flag set, the process token, the presence or absence of a thread token, and whether the proxy identity has been previously set.</span></span> <span data-ttu-id="b1b73-132">Le tableau suivant indique l’identité du proxy qui en résulte (identité du client) lorsque ces facteurs varient.</span><span class="sxs-lookup"><span data-stu-id="b1b73-132">The following table shows the resulting proxy identity (client identity) when these factors vary.</span></span>



| <span data-ttu-id="b1b73-133">Masquage d’indicateurs</span><span class="sxs-lookup"><span data-stu-id="b1b73-133">Cloaking Flags</span></span>                     | <span data-ttu-id="b1b73-134">Présence du jeton de thread</span><span class="sxs-lookup"><span data-stu-id="b1b73-134">Thread Token Presence</span></span>  | <span data-ttu-id="b1b73-135">Identité du proxy précédemment définie</span><span class="sxs-lookup"><span data-stu-id="b1b73-135">Proxy Identity Previously Set</span></span> | <span data-ttu-id="b1b73-136">Identité du proxy (identité du client)</span><span class="sxs-lookup"><span data-stu-id="b1b73-136">Proxy Identity (Client Identity)</span></span>                    |
|------------------------------------|------------------------|-------------------------------|-----------------------------------------------------|
| <span data-ttu-id="b1b73-137">Masquage non défini</span><span class="sxs-lookup"><span data-stu-id="b1b73-137">Cloaking not set</span></span><br/>        | <span data-ttu-id="b1b73-138">Ne vous inquiétez pas</span><span class="sxs-lookup"><span data-stu-id="b1b73-138">Don't care</span></span><br/>  | <span data-ttu-id="b1b73-139">Ne vous inquiétez pas</span><span class="sxs-lookup"><span data-stu-id="b1b73-139">Don't care</span></span><br/>         | <span data-ttu-id="b1b73-140">Traiter le jeton ou l’identité d’authentification</span><span class="sxs-lookup"><span data-stu-id="b1b73-140">Process token or authentication identity</span></span><br/> |
| <span data-ttu-id="b1b73-141">\_ \_ masquage statique EOAC</span><span class="sxs-lookup"><span data-stu-id="b1b73-141">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="b1b73-142">Présent</span><span class="sxs-lookup"><span data-stu-id="b1b73-142">Present</span></span><br/>     | <span data-ttu-id="b1b73-143">Non</span><span class="sxs-lookup"><span data-stu-id="b1b73-143">No</span></span><br/>                 | <span data-ttu-id="b1b73-144">Jeton de thread</span><span class="sxs-lookup"><span data-stu-id="b1b73-144">Thread token</span></span><br/>                             |
| <span data-ttu-id="b1b73-145">\_ \_ masquage statique EOAC</span><span class="sxs-lookup"><span data-stu-id="b1b73-145">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="b1b73-146">Présent</span><span class="sxs-lookup"><span data-stu-id="b1b73-146">Present</span></span><br/>     | <span data-ttu-id="b1b73-147">Oui</span><span class="sxs-lookup"><span data-stu-id="b1b73-147">Yes</span></span><br/>                | <span data-ttu-id="b1b73-148">Identité du proxy actuel</span><span class="sxs-lookup"><span data-stu-id="b1b73-148">Current proxy identity</span></span><br/>                   |
| <span data-ttu-id="b1b73-149">\_ \_ masquage statique EOAC</span><span class="sxs-lookup"><span data-stu-id="b1b73-149">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="b1b73-150">Non présent</span><span class="sxs-lookup"><span data-stu-id="b1b73-150">Not present</span></span><br/> | <span data-ttu-id="b1b73-151">Non</span><span class="sxs-lookup"><span data-stu-id="b1b73-151">No</span></span><br/>                 | <span data-ttu-id="b1b73-152">Traiter le jeton</span><span class="sxs-lookup"><span data-stu-id="b1b73-152">Process token</span></span><br/>                            |
| <span data-ttu-id="b1b73-153">\_ \_ masquage statique EOAC</span><span class="sxs-lookup"><span data-stu-id="b1b73-153">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="b1b73-154">Non présent</span><span class="sxs-lookup"><span data-stu-id="b1b73-154">Not present</span></span><br/> | <span data-ttu-id="b1b73-155">Oui</span><span class="sxs-lookup"><span data-stu-id="b1b73-155">Yes</span></span><br/>                | <span data-ttu-id="b1b73-156">Identité du proxy actuel</span><span class="sxs-lookup"><span data-stu-id="b1b73-156">Current proxy identity</span></span><br/>                   |
| <span data-ttu-id="b1b73-157">\_ \_ voilage dynamique EOAC</span><span class="sxs-lookup"><span data-stu-id="b1b73-157">EOAC\_DYNAMIC\_CLOAKING</span></span><br/> | <span data-ttu-id="b1b73-158">Présent</span><span class="sxs-lookup"><span data-stu-id="b1b73-158">Present</span></span><br/>     | <span data-ttu-id="b1b73-159">Ne vous inquiétez pas</span><span class="sxs-lookup"><span data-stu-id="b1b73-159">Don't care</span></span><br/>         | <span data-ttu-id="b1b73-160">Jeton de thread</span><span class="sxs-lookup"><span data-stu-id="b1b73-160">Thread token</span></span><br/>                             |
| <span data-ttu-id="b1b73-161">\_ \_ voilage dynamique EOAC</span><span class="sxs-lookup"><span data-stu-id="b1b73-161">EOAC\_DYNAMIC\_CLOAKING</span></span><br/> | <span data-ttu-id="b1b73-162">Non présent</span><span class="sxs-lookup"><span data-stu-id="b1b73-162">Not present</span></span><br/> | <span data-ttu-id="b1b73-163">Ne vous inquiétez pas</span><span class="sxs-lookup"><span data-stu-id="b1b73-163">Don't care</span></span> <br/>        | <span data-ttu-id="b1b73-164">Traiter le jeton</span><span class="sxs-lookup"><span data-stu-id="b1b73-164">Process token</span></span><br/>                            |



 

<span data-ttu-id="b1b73-165">L’organigramme suivant illustre le mode de détermination de l’identité du proxy dans différentes situations.</span><span class="sxs-lookup"><span data-stu-id="b1b73-165">The following flowchart illustrates how the proxy identity is determined in different situations.</span></span>

![Diagramme qui montre le déroulement de la détermination de l’identité du proxy.](images/9e8409b7-8475-4824-bdff-cf6b09c139c5.png)

## <a name="setting-cloaking"></a><span data-ttu-id="b1b73-167">Définir le masquage</span><span class="sxs-lookup"><span data-stu-id="b1b73-167">Setting Cloaking</span></span>

<span data-ttu-id="b1b73-168">Le masquage est défini en tant qu’indicateur de fonctionnalité dans un appel à [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), qui définit le masquage pour l’ensemble du processus.</span><span class="sxs-lookup"><span data-stu-id="b1b73-168">Cloaking is set as a capability flag in a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), which sets cloaking for the entire process.</span></span> <span data-ttu-id="b1b73-169">La fonction de masquage est ensuite définie jusqu’à ce que le client la modifie par le biais d’un appel à IClientSecurity ::[**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) (ou à [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)), qui définit le masquage pour le proxy.</span><span class="sxs-lookup"><span data-stu-id="b1b73-169">The cloaking capability is then set until the client changes it through a call to IClientSecurity::[**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) (or to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)), which sets cloaking for the proxy.</span></span>

<span data-ttu-id="b1b73-170">Par défaut, le masquage n’est pas défini.</span><span class="sxs-lookup"><span data-stu-id="b1b73-170">By default, cloaking is not set.</span></span> <span data-ttu-id="b1b73-171">Pour le définir, transmettez \_ EOAC \_ static voiling ou EOAC \_ Dynamic \_ voiling au paramètre *pCapabilities* dans [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) ou [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span><span class="sxs-lookup"><span data-stu-id="b1b73-171">To set it, pass EOAC\_STATIC\_CLOAKING or EOAC\_DYNAMIC\_CLOAKING to the *pCapabilities* parameter in [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span></span>

<span data-ttu-id="b1b73-172">Lorsque le masquage statique est activé à l’aide de [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), chaque proxy récupère un jeton (thread ou processus) la première fois que vous effectuez un appel sur le proxy.</span><span class="sxs-lookup"><span data-stu-id="b1b73-172">When static cloaking is enabled using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), each proxy picks up a token (thread or process) the first time you make a call on the proxy.</span></span> <span data-ttu-id="b1b73-173">Lorsque le masquage statique est activé à l’aide de [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket), le proxy récupère le jeton sur le thread à ce moment-là.</span><span class="sxs-lookup"><span data-stu-id="b1b73-173">When static cloaking is enabled using [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket), the proxy picks up the token on the thread at that time.</span></span> <span data-ttu-id="b1b73-174">Si aucun jeton de thread n’est disponible lors de l’appel de **SetBlanket** , le jeton de processus est utilisé pour l’identité du proxy.</span><span class="sxs-lookup"><span data-stu-id="b1b73-174">If no thread token is available when **SetBlanket** is called, the process token is used for the proxy's identity.</span></span> <span data-ttu-id="b1b73-175">Fondamentalement, **SetBlanket** corrige l’identité du proxy.</span><span class="sxs-lookup"><span data-stu-id="b1b73-175">Basically, **SetBlanket** fixes the identity of the proxy.</span></span>

<span data-ttu-id="b1b73-176">Avec le masquage dynamique, l’identité du proxy est déterminée de la même façon que le masquage dynamique soit défini à l’aide de [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) ou de [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span><span class="sxs-lookup"><span data-stu-id="b1b73-176">With dynamic cloaking, the proxy's identity is determined the same way regardless of whether dynamic cloaking is set using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or with [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span></span> <span data-ttu-id="b1b73-177">Le jeton de thread actuel est utilisé, le cas échéant ; dans le cas contraire, le jeton de processus est utilisé.</span><span class="sxs-lookup"><span data-stu-id="b1b73-177">The current thread token is used if there is one; otherwise, the process token is used.</span></span>

<span data-ttu-id="b1b73-178">Si le masquage est défini pour l’ensemble du processus via un appel à [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) et que vous souhaitez effectuer des appels avec le jeton de processus, n’empruntez pas l’identité lors des appels.</span><span class="sxs-lookup"><span data-stu-id="b1b73-178">If cloaking is set for the entire process through a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) and you want to make calls with the process token, do not impersonate while making calls.</span></span>

## <a name="cloaking-and-impersonation-levels"></a><span data-ttu-id="b1b73-179">Masquage et niveaux d’emprunt d’identité</span><span class="sxs-lookup"><span data-stu-id="b1b73-179">Cloaking and Impersonation Levels</span></span>

<span data-ttu-id="b1b73-180">Comme indiqué précédemment, la fonctionnalité de voilage détermine l’identité qui est présentée à un serveur lors de l’emprunt d’identité.</span><span class="sxs-lookup"><span data-stu-id="b1b73-180">As mentioned previously, the cloaking capability determines what identity is presented to a server during impersonation.</span></span> <span data-ttu-id="b1b73-181">Le masquage permet à un serveur de projeter une identité autre que la sienne sur un autre serveur qu’il appelle pour le compte du client.</span><span class="sxs-lookup"><span data-stu-id="b1b73-181">Cloaking provides a way for a server to project an identity other than its own to another server it is calling on behalf of the client.</span></span> <span data-ttu-id="b1b73-182">Le niveau d’emprunt d’identité indique la quantité d’autorité que le client a donné au serveur.</span><span class="sxs-lookup"><span data-stu-id="b1b73-182">The impersonation level indicates how much authority the client has given the server.</span></span>

<span data-ttu-id="b1b73-183">L’emprunt d’identité sans masquage fonctionne, mais il n’est peut-être pas le meilleur choix car, dans certains cas, le serveur final doit connaître l’identité de l’appelant initial.</span><span class="sxs-lookup"><span data-stu-id="b1b73-183">Impersonation without cloaking works, but it may not be the best choice because, in some cases, the final server needs to know the identity of the initial caller.</span></span> <span data-ttu-id="b1b73-184">Cela ne peut pas être effectué sans utiliser le masquage, car il est difficile de s’assurer que seuls les clients autorisés peuvent accéder à un ordinateur distant.</span><span class="sxs-lookup"><span data-stu-id="b1b73-184">This cannot be achieved without using cloaking because it is difficult to ensure that only authorized clients can access a remote computer.</span></span> <span data-ttu-id="b1b73-185">Lorsque l’emprunt d’identité est utilisé sans voilage, l’identité présentée à un serveur en aval est celle du processus appelant immédiat.</span><span class="sxs-lookup"><span data-stu-id="b1b73-185">When impersonation is used without cloaking, the identity presented to a downstream server is that of the immediate calling process.</span></span>

<span data-ttu-id="b1b73-186">Toutefois, le masquage n’est pas utile sans emprunt d’identité.</span><span class="sxs-lookup"><span data-stu-id="b1b73-186">However, cloaking is not useful without impersonation.</span></span> <span data-ttu-id="b1b73-187">Le masquage n’a de sens que lorsque le client a défini un niveau d’emprunt d’identité pour l’emprunt d’identité ou le délégué.</span><span class="sxs-lookup"><span data-stu-id="b1b73-187">Cloaking makes sense only when the client has set an impersonation level of impersonate or delegate.</span></span> <span data-ttu-id="b1b73-188">(Avec des niveaux d’emprunt d’identité inférieurs, le serveur ne peut pas effectuer d’appels masqués.) La réussite du masquage dépend du nombre de limites de l’ordinateur franchies et du niveau d’emprunt d’identité, qui indique la quantité d’autorité que le serveur doit agir pour le compte du client.</span><span class="sxs-lookup"><span data-stu-id="b1b73-188">(With lower impersonation levels, the server cannot make cloaked calls.) Whether cloaking is successful depends on the number of computer boundaries crossed and on the impersonation level, which indicates how much authority the server has to act on behalf of the client.</span></span>

<span data-ttu-id="b1b73-189">Dans certains cas, il est logique pour le serveur de définir le masquage lorsque le client définit le niveau d’emprunt d’identité sur l' \_ emprunt d’identité RPC C \_ IMP \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="b1b73-189">In some situations, it makes sense for the server to set cloaking when the client sets the impersonation level to RPC\_C\_IMP\_LEVEL\_IMPERSONATE.</span></span> <span data-ttu-id="b1b73-190">Toutefois, certaines limitations sont appliquées.</span><span class="sxs-lookup"><span data-stu-id="b1b73-190">However, certain limitations are in effect.</span></span> <span data-ttu-id="b1b73-191">Si le client d’origine définit le niveau d’emprunt d’identité sur l' \_ emprunt d’identité RPC C \_ IMP \_ \_ , le serveur intermédiaire (agissant comme un client sur le même ordinateur) peut masquer sur une seule limite d’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="b1b73-191">If the original client sets the impersonation level to RPC\_C\_IMP\_LEVEL\_IMPERSONATE, the intermediate server (acting as a client on the same computer) can cloak across only one computer boundary.</span></span> <span data-ttu-id="b1b73-192">Cela est dû au fait qu’un jeton d’emprunt d’identité au niveau de l’emprunt d’identité peut être passé sur une seule limite d’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="b1b73-192">This is because an impersonate-level impersonation token can be passed across only one computer boundary.</span></span> <span data-ttu-id="b1b73-193">Une fois la limite de l’ordinateur franchie, seules les ressources locales sont accessibles.</span><span class="sxs-lookup"><span data-stu-id="b1b73-193">After the computer boundary has been crossed, only local resources can be accessed.</span></span> <span data-ttu-id="b1b73-194">L’identité présentée au serveur dépend du type de masquage défini.</span><span class="sxs-lookup"><span data-stu-id="b1b73-194">The identity presented to the server depends on the type of cloaking that is set.</span></span> <span data-ttu-id="b1b73-195">Si aucun voilage n’est défini, l’identité présentée à un serveur est celle du processus qui effectue l’appel immédiat.</span><span class="sxs-lookup"><span data-stu-id="b1b73-195">If no cloaking is set, the identity presented to a server will be that of the process making the immediate call.</span></span>

<span data-ttu-id="b1b73-196">Pour masquer sur plusieurs limites d’ordinateur, vous devez spécifier à la fois un indicateur de fonctionnalité de masquage approprié et un emprunt d’identité au niveau du délégué.</span><span class="sxs-lookup"><span data-stu-id="b1b73-196">To cloak over multiple computer boundaries, you must specify both an appropriate cloaking capability flag and delegate-level impersonation.</span></span> <span data-ttu-id="b1b73-197">Avec ce type d’emprunt d’identité, les informations d’identification locales et réseau du client sont fournies au serveur, de sorte que le jeton d’emprunt d’identité peut franchir n’importe quel nombre de limites de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="b1b73-197">With this type of impersonation, both the local and network credentials of the client are given to the server, so the impersonation token can cross any number of computer boundaries.</span></span> <span data-ttu-id="b1b73-198">Là encore, l’identité présentée au serveur dépend du type de masquage défini.</span><span class="sxs-lookup"><span data-stu-id="b1b73-198">Again, the identity presented to the server depends on the type of cloaking that is set.</span></span> <span data-ttu-id="b1b73-199">Si aucun voilage n’est défini avec l’emprunt d’identité au niveau du délégué, l’identité présentée à un serveur est celle du processus à l’origine de l’appel.</span><span class="sxs-lookup"><span data-stu-id="b1b73-199">If no cloaking is set with delegate-level impersonation, the identity presented to a server is that of the process making the call.</span></span>

<span data-ttu-id="b1b73-200">Par exemple, supposons que le processus A appelle B et que B appelle C. B a défini le masquage et a a défini le niveau d’emprunt d’identité sur emprunter l’identité.</span><span class="sxs-lookup"><span data-stu-id="b1b73-200">For example, suppose Process A calls B, and B calls C. B has set cloaking and A has set the impersonation level to impersonate.</span></span> <span data-ttu-id="b1b73-201">Si A, B et C se trouvent sur le même ordinateur, le passage du jeton d’emprunt d’identité de A à B, puis à C fonctionnera.</span><span class="sxs-lookup"><span data-stu-id="b1b73-201">If A, B, and C are on the same computer, passing the impersonation token from A to B and then to C will work.</span></span> <span data-ttu-id="b1b73-202">Toutefois, si A et C se trouvent sur le même ordinateur et que B ne l’est pas, le fait de passer le jeton fonctionne entre A et B, mais pas entre B et C. L’appel de B à C échoue, car B ne peut pas appeler C lors du masquage.</span><span class="sxs-lookup"><span data-stu-id="b1b73-202">But if A and C are on the same computer, and B is not, passing the token will work between A and B, but not from B to C. The call from B to C will fail because B cannot call C while cloaking.</span></span> <span data-ttu-id="b1b73-203">Toutefois, si A définit le niveau d’emprunt d’identité à déléguer, le jeton peut être passé de B à C et l’appel peut être réussi.</span><span class="sxs-lookup"><span data-stu-id="b1b73-203">However, if A sets the impersonation level to delegate, the token can be passed from B to C and the call may succeed.</span></span>

## <a name="cloaking-scenarios"></a><span data-ttu-id="b1b73-204">Scénarios de voilage</span><span class="sxs-lookup"><span data-stu-id="b1b73-204">Cloaking Scenarios</span></span>

<span data-ttu-id="b1b73-205">Dans l’illustration suivante, le processus A appelle B, appelle C, appelle D lorsque le masquage n’est pas défini.</span><span class="sxs-lookup"><span data-stu-id="b1b73-205">In the following illustration, Process A calls B, calls C, calls D when cloaking is not set.</span></span> <span data-ttu-id="b1b73-206">Par conséquent, chaque processus intermédiaire voit l’identité du processus qui l’a appelé.</span><span class="sxs-lookup"><span data-stu-id="b1b73-206">As a result, each intermediate process sees the identity of the process that called it.</span></span>

![Diagramme qui montre le processus lorsque le masquage n’est pas défini.](images/0d2eb6cf-97d6-4c4e-b97e-abad854b1120.png)

<span data-ttu-id="b1b73-208">Avec le masquage statique, le serveur voit l’identité de proxy qui a été définie lors du premier appel du client au serveur.</span><span class="sxs-lookup"><span data-stu-id="b1b73-208">With static cloaking, the server sees the proxy identity that was set during the first call from the client to the server.</span></span> <span data-ttu-id="b1b73-209">L’illustration suivante montre un exemple de l’identité de proxy définie lors d’un appel de B à C. Lors d’un appel ultérieur, le processus D voit l’identité de B lorsque le masquage statique est défini par B et C.</span><span class="sxs-lookup"><span data-stu-id="b1b73-209">The following figure shows an example of the proxy identity being set during a call from B to C. On a subsequent call, Process D sees B's identity when static cloaking is set by B and C.</span></span>

![Diagramme qui montre le processus de masquage statique.](images/520938e0-c4a6-4ac1-937d-02baf2007a27.png)

<span data-ttu-id="b1b73-211">Avec le masquage dynamique, l’identité de l’appelant pendant l’emprunt d’identité est basée sur le jeton de thread actuel, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="b1b73-211">With dynamic cloaking, the identity of the caller during impersonation is based on the current thread token, if there is one.</span></span> <span data-ttu-id="b1b73-212">L’illustration suivante montre la situation dans laquelle B et C définissent le masquage dynamique et que D voit l’identité d’un, en dépit d’un appel antérieur de B à C.</span><span class="sxs-lookup"><span data-stu-id="b1b73-212">The following illustration shows the situation where B and C set dynamic cloaking and D sees the identity of A, despite an earlier call from B to C.</span></span>

![Diagramme qui montre le processus de masquage dynamique.](images/d0848465-82f3-4d5a-851e-566d7800ada0.png)

## <a name="related-topics"></a><span data-ttu-id="b1b73-214">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="b1b73-214">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b1b73-215">Délégation et emprunt d’identité</span><span class="sxs-lookup"><span data-stu-id="b1b73-215">Delegation and Impersonation</span></span>](delegation-and-impersonation.md)
</dt> </dl>

 

