---
title: Persistance
description: Persistance
ms.assetid: 4916ea52-a21c-4938-81cb-392b5ca1f6c1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c6cffab1c9a0f2746e57e356a90698caf9903deb
ms.sourcegitcommit: f848119a8faa29b27585f4df53f6e50ee9666684
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/27/2021
ms.locfileid: "110549284"
---
# <a name="persistence"></a><span data-ttu-id="2a732-103">Persistance</span><span class="sxs-lookup"><span data-stu-id="2a732-103">Persistence</span></span>

<span data-ttu-id="2a732-104">Un contrôle implémente une ou plusieurs des différentes interfaces de persistance pour prendre en charge la persistance de son état.</span><span class="sxs-lookup"><span data-stu-id="2a732-104">A control implements one or more of several persistence interfaces to support persistence of its state.</span></span> <span data-ttu-id="2a732-105">Par exemple, l’interface [**IPersistStreamInit**](/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit) prend en charge la persistance basée sur le flux de l’état du contrôle.</span><span class="sxs-lookup"><span data-stu-id="2a732-105">For example, the [**IPersistStreamInit**](/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit) interface supports stream-based persistence of the control's state.</span></span> <span data-ttu-id="2a732-106">**IPersistStreamInit** remplace [**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream) et ajoute une méthode d’initialisation, [**InitNew**](/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-initnew).</span><span class="sxs-lookup"><span data-stu-id="2a732-106">**IPersistStreamInit** is a replacement for [**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream) and adds an initialization method, [**InitNew**](/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-initnew).</span></span> <span data-ttu-id="2a732-107">Les autres méthodes sont les mêmes dans les deux interfaces.</span><span class="sxs-lookup"><span data-stu-id="2a732-107">The other methods are the same in both interfaces.</span></span> <span data-ttu-id="2a732-108">**IPersistStreamInit** n’est pas dérivé de **IPersistStream**; un objet ne prend en charge qu’une seule des deux interfaces selon qu’il a besoin de pouvoir initialiser de nouvelles instances de lui-même.</span><span class="sxs-lookup"><span data-stu-id="2a732-108">**IPersistStreamInit** is not derived from **IPersistStream**; an object supports only one of the two interfaces based on whether it requires the ability to initialize new instances of itself.</span></span>

<span data-ttu-id="2a732-109">Les autres interfaces de persistance qu’un contrôle peut offrir incluent : [**IPersistStorage**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage), [**IPersistMemory**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85)), [**IPersistPropertyBag**](/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag), [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="2a732-109">Other persistence interfaces that a control can offer include: [**IPersistStorage**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage), [**IPersistMemory**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85)), [**IPersistPropertyBag**](/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag), [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)).</span></span> <span data-ttu-id="2a732-110">L’implémenteur de contrôle doit décider quels types de persistance sont les plus importants et implémenter les interfaces de persistance appropriées.</span><span class="sxs-lookup"><span data-stu-id="2a732-110">The control implementer must decide what kinds of persistence are most important and implement the appropriate persistence interfaces.</span></span> <span data-ttu-id="2a732-111">L’implémenteur de contrôle décide également ce qui doit être enregistré.</span><span class="sxs-lookup"><span data-stu-id="2a732-111">The control implementer also decides what to save.</span></span> <span data-ttu-id="2a732-112">Par exemple, un contrôle peut enregistrer les valeurs actuelles de ses propriétés ou son emplacement et sa taille dans son conteneur.</span><span class="sxs-lookup"><span data-stu-id="2a732-112">For example, a control can save the current values of its properties or its location and size within its container.</span></span> <span data-ttu-id="2a732-113">Le client décide de l’interface qu’il préfère utiliser.</span><span class="sxs-lookup"><span data-stu-id="2a732-113">The client decides which interface it prefers to use.</span></span>

<span data-ttu-id="2a732-114">Avant de charger un contrôle à partir de son état persistant, un client peut vérifier l' \_ indicateur OLEMISC SETCLIENTSITEFIRST pour déterminer si le contrôle prend en charge l’obtention de son site client et les propriétés ambiantes avant de charger son état persistant.</span><span class="sxs-lookup"><span data-stu-id="2a732-114">Before loading a control from its persistent state, a client can check the OLEMISC\_SETCLIENTSITEFIRST flag to determine if the control supports getting its client site and ambient properties before loading its persistent state.</span></span> <span data-ttu-id="2a732-115">Cette optimisation peut gagner du temps lors de l’instanciation d’un contrôle, car le contrôle est ensuite libre d’ignorer ses valeurs persistantes plutôt que de les charger uniquement pour qu’elles soient remplacées par les propriétés ambiantes fournies par le client.</span><span class="sxs-lookup"><span data-stu-id="2a732-115">This optimization can save time when instantiating a control since the control is then free to ignore its persistent values rather than loading them only to have them overridden by ambient properties supplied by the client.</span></span>

<span data-ttu-id="2a732-116">Un contrôle peut également prendre en charge l’enregistrement et la restauration de son état dans un jeu de propriétés OLE, un ensemble d’identificateurs et de valeurs dans un format spécifié.</span><span class="sxs-lookup"><span data-stu-id="2a732-116">A control can also support saving and restoring its state in an OLE property set, a set of identifiers and values in a specified format.</span></span> <span data-ttu-id="2a732-117">Cette fonctionnalité peut être utile avec les conteneurs tels que Visual Basic, qui enregistre ses programmes sous une forme textuelle.</span><span class="sxs-lookup"><span data-stu-id="2a732-117">This feature can be useful with containers such as Visual Basic, which saves its programs in a textual form.</span></span> <span data-ttu-id="2a732-118">Un contrôle qui souhaite prendre en charge cette fonctionnalité implémente [**IDataObject :: GetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-getdata) et [**IDataObject :: SetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-setdata) pour passer ses valeurs de propriété vers et à partir du conteneur, respectivement.</span><span class="sxs-lookup"><span data-stu-id="2a732-118">A control that wants to support this feature implements [**IDataObject::GetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-getdata) and [**IDataObject::SetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-setdata) to pass its property values to and from the container, respectively.</span></span> <span data-ttu-id="2a732-119">Il s’agit de la tâche du conteneur pour convertir ces informations en texte et les enregistrer.</span><span class="sxs-lookup"><span data-stu-id="2a732-119">It is the container's job to convert this information to text and save it.</span></span> <span data-ttu-id="2a732-120">Les identificateurs utilisés par le contrôle correspondent aux noms de propriété du contrôle et aux valeurs.</span><span class="sxs-lookup"><span data-stu-id="2a732-120">The identifiers used by the control correspond to the control's property names and the values.</span></span> <span data-ttu-id="2a732-121">Consultez le CDK OLE pour la définition de ce jeu de propriétés.</span><span class="sxs-lookup"><span data-stu-id="2a732-121">See the OLE CDK for the definition of this property set.</span></span>

## <a name="related-topics"></a><span data-ttu-id="2a732-122">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="2a732-122">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2a732-123">Contrôles ActiveX</span><span class="sxs-lookup"><span data-stu-id="2a732-123">ActiveX Controls</span></span>](activex-controls.md)
</dt> </dl>

 

 