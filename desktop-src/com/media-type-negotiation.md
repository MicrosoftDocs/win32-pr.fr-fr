---
title: Négociation Media-Type
description: De nombreux protocoles Internet de la couche application sont basés sur l’échange de messages dans un format simple et flexible appelé MIME (Multipurpose Internet Mail Extensions).
ms.assetid: 7a2c9d8f-639a-4865-a62b-63330175f5f0
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cb145fa3a76da6574172ddd24888f3b5da7ad85e
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/21/2020
ms.locfileid: "104382979"
---
# <a name="media-type-negotiation"></a><span data-ttu-id="5b7c4-103">Négociation Media-Type</span><span class="sxs-lookup"><span data-stu-id="5b7c4-103">Media-Type Negotiation</span></span>

<span data-ttu-id="5b7c4-104">De nombreux protocoles Internet de la couche application sont basés sur l’échange de messages dans un format simple et flexible appelé MIME (Multipurpose Internet Mail Extensions).</span><span class="sxs-lookup"><span data-stu-id="5b7c4-104">Many application-layer Internet protocols are based on the exchange of messages in a simple, flexible format called Multipurpose Internet Mail Extensions (MIME).</span></span> <span data-ttu-id="5b7c4-105">Bien que MIME soit un standard pour l’échange de messages électroniques, il est utilisé aujourd’hui par un large éventail d’applications pour spécifier des formats de données mutuellement comprises comme des types MIME (ou médias).</span><span class="sxs-lookup"><span data-stu-id="5b7c4-105">Although MIME originated as a standard for exchanging electronic mail messages, it is used today by a wide variety of applications to specify mutually understood data formats as MIME, or media, types.</span></span> <span data-ttu-id="5b7c4-106">Le processus est appelé *négociation de type de média*.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-106">The process is called *media-type negotiation*.</span></span>

<span data-ttu-id="5b7c4-107">Les types de média sont des chaînes simples qui désignent un type et un sous-type (par exemple, « text/plain » ou « Text/HTML »).</span><span class="sxs-lookup"><span data-stu-id="5b7c4-107">Media types are simple strings that denote a type and subtype (such as "text/plain" or "text/HTML").</span></span> <span data-ttu-id="5b7c4-108">Ils permettent d’étiqueter des données ou de qualifier une demande.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-108">They are used to label data or qualify a request.</span></span> <span data-ttu-id="5b7c4-109">Un navigateur Web, par exemple, dans le cadre d’une requête-pour-données HTTP ou d’une requête-pour-informations, spécifie qu’il demande les types de média « image/GIF » ou « image/JPEG », sur lesquels un serveur Web répond en renvoyant le type de média approprié et, si l’appel était une requête-pour les données, dans le format demandé</span><span class="sxs-lookup"><span data-stu-id="5b7c4-109">A Web browser, for example, as part of an HTTP request-for-data or request-for-info, specifies that it is requesting "image/gif" or "image/jpeg" Media Types, to which a web server responds by returning the appropriate media type and, if the call was a request-for-data, the data itself in the requested format.</span></span>

<span data-ttu-id="5b7c4-110">La négociation de type de média est souvent similaire à la façon dont les applications de bureau existantes négocient avec le presse-papiers du système pour déterminer le format de données à coller lorsqu’un utilisateur choisit modifier/coller ou des requêtes pour les formats lors de la réception d’un pointeur [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) pendant une opération de glisser-déplacer.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-110">Media-type negotiation is often similar to how existing desktop applications negotiate with the system clipboard to determine which data format to paste when a user chooses Edit/Paste or queries for formats when receiving an [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) pointer during a drag-and-drop operation.</span></span> <span data-ttu-id="5b7c4-111">La principale différence dans la négociation de type de média HTTP est que le client n’a pas connaissance à l’avance des formats disponibles pour le serveur.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-111">The subtle difference in HTTP media-type negotiation is that the client does not know ahead of time which formats the server has available.</span></span> <span data-ttu-id="5b7c4-112">Par conséquent, le client spécifie les types de médias qu’il prend en charge, dans l’ordre de la plus grande fidélité, et le serveur répond avec le meilleur format disponible.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-112">Therefore, the client specifies up-front the media types it supports, in order of greatest fidelity, and the server responds with the best available format.</span></span>

<span data-ttu-id="5b7c4-113">Les monikers d’URL prennent en charge la négociation de type de média comme un moyen pour les clients et les serveurs Internet de s’accorder sur les formats à utiliser lors du téléchargement de données dans des opérations [**BindToStorage**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage) .</span><span class="sxs-lookup"><span data-stu-id="5b7c4-113">URL monikers support media-type negotiation as a way for Internet clients and servers to agree upon formats to be used when downloading data in [**BindToStorage**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage) operations.</span></span> <span data-ttu-id="5b7c4-114">Pour prendre en charge la négociation de type de média, un client implémente l’interface [**IEnumFORMATETC**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) et appelle la fonction [**RegisterFormatEnumerator**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775116(v=vs.85)) pour l’inscrire auprès du contexte de liaison.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-114">To support media-type negotiation, a client implements the [**IEnumFORMATETC**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) interface and calls the [**RegisterFormatEnumerator**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775116(v=vs.85)) function to register it with the bind context.</span></span> <span data-ttu-id="5b7c4-115">L’énumérateur format répertorie les formats que le client peut accepter.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-115">The format enumerator lists the formats the client can accept.</span></span> <span data-ttu-id="5b7c4-116">Un moniker d’URL convertit ces formats en types de média lors de la liaison à des URL HTTP.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-116">A URL moniker translates these formats into media types when binding to HTTP URLs.</span></span>

<span data-ttu-id="5b7c4-117">Les types de média possibles demandés par le client sont représentés aux monikers d’URL via les structures [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) disponibles à partir de l’énumérateur [**IEnumFORMATETC**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) inscrit par l’appelant sur le contexte de liaison : chaque **FORMATETC** spécifie un format de presse-papiers identifiant le type de média.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-117">The possible media types requested by the client are represented to URL monikers through [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structures available from the [**IEnumFORMATETC**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) enumerator registered by the caller on the bind context: Each **FORMATETC** specifies a clipboard format identifying the media type.</span></span> <span data-ttu-id="5b7c4-118">Par exemple, le fragment de code suivant spécifie que le type de média est PostScript.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-118">For example, the following code fragment specifies that the media type is PostScript.</span></span>

``` syntax
FORMATETC fmtetc;
fmtetc.cfFormat = RegisterClipboardFormat(CF_MIME_POSTSCRIPT);
. . .
```

<span data-ttu-id="5b7c4-119">Un client peut définir le format du presse-papiers sur le type de support spécial CF \_ null pour indiquer que le type de média par défaut de la ressource vers laquelle pointe l’URL doit être récupéré.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-119">A client can set the clipboard format to the special media type CF\_NULL to indicate that the default media type of the resource pointed to by the URL should be retrieved.</span></span> <span data-ttu-id="5b7c4-120">Ce format est généralement le dernier qui est intéressé par le client.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-120">This format is usually the last one in which the client is interested.</span></span> <span data-ttu-id="5b7c4-121">Quand aucun énumérateur n’est inscrit avec le contexte de liaison, un moniker d’URL fonctionne comme si un énumérateur contenant un [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) unique avec **cfFormat**= CF \_ null est disponible, en téléchargeant automatiquement le type de média par défaut.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-121">When no enumerator is registered with the bind context, a URL moniker works as if an enumerator containing a single [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) with **cfFormat**=CF\_NULL is available, automatically downloading the default media-type.</span></span>

<span data-ttu-id="5b7c4-122">Quel que soit le type de support à utiliser, le client est informé du choix au moyen de l’argument *pFormatetc* sur sa méthode [**IBindStatusCallback :: ondataavailable**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775061(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="5b7c4-122">Whatever media type is to be used, the client is notified of the choice by means of the *pformatetc* argument on its [**IBindStatusCallback::OnDataAvailable**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775061(v=vs.85)) method.</span></span> <span data-ttu-id="5b7c4-123">Le rappel se produit dans le contexte de l’appel du client à [**BindToStorage**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage).</span><span class="sxs-lookup"><span data-stu-id="5b7c4-123">The callback occurs within the context of the client's call to [**BindToStorage**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage).</span></span>

> [!Note]  
> <span data-ttu-id="5b7c4-124">Si le contenu reçu est d’un type de média non reconnu, le client appelle automatiquement [**RegisterMediaTypes**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775118(v=vs.85)) pour inscrire le nouveau type.</span><span class="sxs-lookup"><span data-stu-id="5b7c4-124">If received content is of an unrecognized media-type, the client automatically calls [**RegisterMediaTypes**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775118(v=vs.85)) to register the new type.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="5b7c4-125">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="5b7c4-125">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5b7c4-126">Monikers d’URL</span><span class="sxs-lookup"><span data-stu-id="5b7c4-126">URL Monikers</span></span>](url-monikers.md)
</dt> </dl>

 

 