---
title: Exécution d’un appel asynchrone
description: 'La procédure de création d’un appel synchrone est simple : le client obtient un pointeur d’interface sur l’objet serveur et appelle des méthodes via ce pointeur. L’appel asynchrone implique un objet d’appel, donc il implique quelques étapes supplémentaires.'
ms.assetid: ab65d38d-836a-48d4-87c1-8812cbc8ff92
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 22dcd7a6509cd07e12357a96222baa04f9e4c942
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/21/2020
ms.locfileid: "104382996"
---
# <a name="making-an-asynchronous-call"></a><span data-ttu-id="3d3f7-104">Exécution d’un appel asynchrone</span><span class="sxs-lookup"><span data-stu-id="3d3f7-104">Making an Asynchronous Call</span></span>

<span data-ttu-id="3d3f7-105">La procédure de création d’un appel synchrone est simple : le client obtient un pointeur d’interface sur l’objet serveur et appelle des méthodes via ce pointeur.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-105">The procedure for making a synchronous call is straightforward: The client obtains an interface pointer on the server object and calls methods through that pointer.</span></span> <span data-ttu-id="3d3f7-106">L’appel asynchrone implique un objet d’appel, donc il implique quelques étapes supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-106">Asynchronous calling involves a call object, so it involves a few more steps.</span></span>

<span data-ttu-id="3d3f7-107">Pour chaque méthode sur une interface synchrone, l’interface asynchrone correspondante implémente deux méthodes.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-107">For each method on a synchronous interface, the corresponding asynchronous interface implements two methods.</span></span> <span data-ttu-id="3d3f7-108">Ces méthodes attachent les préfixes Begin \_ et Finish \_ au nom de la méthode synchrone.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-108">These methods attach the prefixes Begin\_ and Finish\_ to the name of the synchronous method.</span></span> <span data-ttu-id="3d3f7-109">Par exemple, si une interface nommée ISimpleStream a une méthode Read, l’interface AsyncISimpleStream aura une méthode de lecture Begin \_ Read et Finish \_ .</span><span class="sxs-lookup"><span data-stu-id="3d3f7-109">For example, if an interface named ISimpleStream has a Read method, the AsyncISimpleStream interface will have a Begin\_Read and a Finish\_Read method.</span></span> <span data-ttu-id="3d3f7-110">Pour commencer un appel asynchrone, le client appelle la \_ méthode Begin.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-110">To begin an asynchronous call, the client calls the Begin\_ method.</span></span>

<span data-ttu-id="3d3f7-111">**Pour commencer un appel asynchrone**</span><span class="sxs-lookup"><span data-stu-id="3d3f7-111">**To begin an asynchronous call**</span></span>

1.  <span data-ttu-id="3d3f7-112">Interrogez l’objet serveur pour l’interface [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory) .</span><span class="sxs-lookup"><span data-stu-id="3d3f7-112">Query the server object for the [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory) interface.</span></span> <span data-ttu-id="3d3f7-113">Si [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) retourne E \_ nointerface, l’objet serveur ne prend pas en charge l’appel asynchrone.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-113">If [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) returns E\_NOINTERFACE, the server object does not support asynchronous calling.</span></span>

2.  <span data-ttu-id="3d3f7-114">Appelez [**ICallFactory :: createCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) pour créer un objet d’appel correspondant à l’interface de votre choix, puis relâchez le pointeur vers [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory).</span><span class="sxs-lookup"><span data-stu-id="3d3f7-114">Call [**ICallFactory::CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) to create a call object corresponding to the interface you want, and then release the pointer to [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory).</span></span>

3.  <span data-ttu-id="3d3f7-115">Si vous n’avez pas demandé de pointeur vers l’interface asynchrone à partir de l’appel à [**createCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall), interrogez l’objet d’appel pour l’interface asynchrone.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-115">If you did not request a pointer to the asynchronous interface from the call to [**CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall), query the call object for the asynchronous interface.</span></span>

4.  <span data-ttu-id="3d3f7-116">Appelez la méthode Begin appropriée \_ .</span><span class="sxs-lookup"><span data-stu-id="3d3f7-116">Call the appropriate Begin\_ method.</span></span>

<span data-ttu-id="3d3f7-117">L’objet serveur est en train de traiter l’appel asynchrone et le client est libre d’effectuer d’autres tâches jusqu’à ce qu’il ait besoin des résultats de l’appel.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-117">The server object is now processing the asynchronous call, and the client is free to do other work until it needs the results of the call.</span></span>

<span data-ttu-id="3d3f7-118">Un objet d’appel ne peut traiter qu’un seul appel asynchrone à la fois.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-118">A call object can process only one asynchronous call at a time.</span></span> <span data-ttu-id="3d3f7-119">Si le même ou un deuxième client appelle une \_ méthode Begin avant la fin d’un appel asynchrone en attente, la \_ méthode Begin retourne l' \_ appel E RPC E \_ \_ en attente.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-119">If the same or a second client calls a Begin\_ method before a pending asynchronous call is finished, the Begin\_ method will return RPC\_E\_CALL\_PENDING.</span></span>

<span data-ttu-id="3d3f7-120">Si le client n’a pas besoin des résultats de la \_ méthode Begin, il peut libérer l’objet Call à la fin de cette procédure.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-120">If the client does not need the results of the Begin\_ method, it can release the call object at the end of this procedure.</span></span> <span data-ttu-id="3d3f7-121">COM détecte cette condition et nettoie l’appel.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-121">COM detects this condition and cleans up the call.</span></span> <span data-ttu-id="3d3f7-122">La \_ méthode Finish n’est pas appelée et le client n’obtient pas de paramètres de sortie ou de valeur de retour.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-122">The Finish\_ method is not called, and the client does not get any out parameters or a return value.</span></span>

<span data-ttu-id="3d3f7-123">Lorsque l’objet serveur est prêt à retourner à partir de la \_ méthode Begin, il signale l’objet d’appel qu’il a effectué.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-123">When the server object is ready to return from the Begin\_ method, it signals the call object that it is done.</span></span> <span data-ttu-id="3d3f7-124">Lorsque le client est prêt, il vérifie si l’objet d’appel a été signalé.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-124">When the client is ready, it checks to see whether the call object has been signaled.</span></span> <span data-ttu-id="3d3f7-125">Dans ce cas, le client peut terminer l’appel asynchrone.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-125">If so, the client can complete the asynchronous call.</span></span>

<span data-ttu-id="3d3f7-126">Le mécanisme de cette signalisation et de la vérification entre le client et le serveur est l’interface [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) sur l’objet d’appel.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-126">The mechanism for this signaling and checking between client and server is the [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) interface on the call object.</span></span> <span data-ttu-id="3d3f7-127">L’objet d’appel implémente normalement cette interface en agrégeant un objet de synchronisation fourni par le système.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-127">The call object normally implements this interface by aggregating a system-supplied synchronization object.</span></span> <span data-ttu-id="3d3f7-128">L’objet de synchronisation encapsule un handle d’événement, que le serveur signale juste avant de retourner à partir de la \_ méthode Begin en appelant [**ISynchronize :: signal**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-signal).</span><span class="sxs-lookup"><span data-stu-id="3d3f7-128">The synchronization object wraps an event handle, which the server signals just before returning from the Begin\_ method by calling [**ISynchronize::Signal**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-signal).</span></span>

<span data-ttu-id="3d3f7-129">**Pour effectuer un appel asynchrone**</span><span class="sxs-lookup"><span data-stu-id="3d3f7-129">**To complete an asynchronous call**</span></span>

1.  <span data-ttu-id="3d3f7-130">Interrogez l’objet d’appel pour l’interface [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) .</span><span class="sxs-lookup"><span data-stu-id="3d3f7-130">Query the call object for the [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) interface.</span></span>

2.  <span data-ttu-id="3d3f7-131">Appelez [**ISynchronize :: wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait).</span><span class="sxs-lookup"><span data-stu-id="3d3f7-131">Call [**ISynchronize::Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait).</span></span>

3.  <span data-ttu-id="3d3f7-132">Si [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) retourne \_ \_ un délai d’attente RPC E, la \_ méthode Begin n’a pas terminé le traitement.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-132">If [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) returns RPC\_E\_TIMEOUT, the Begin\_ method is not finished processing.</span></span> <span data-ttu-id="3d3f7-133">Le client peut continuer à exécuter d’autres tâches et appeler de nouveau **Wait** ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-133">The client can continue with other work and call **Wait** again later.</span></span> <span data-ttu-id="3d3f7-134">Elle ne peut pas appeler la \_ méthode Finish tant que **Wait** n’a pas la valeur \_ OK.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-134">It cannot call the Finish\_ method until **Wait** returns S\_OK.</span></span>

    <span data-ttu-id="3d3f7-135">Si [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) retourne \_ la valeur OK, la \_ méthode Begin est retournée.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-135">If [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) returns S\_OK, the Begin\_ method has returned.</span></span> <span data-ttu-id="3d3f7-136">Appelez la méthode Finish appropriée \_ .</span><span class="sxs-lookup"><span data-stu-id="3d3f7-136">Call the appropriate Finish\_ method.</span></span>

<span data-ttu-id="3d3f7-137">La \_ méthode Finish transmet les paramètres out au client.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-137">The Finish\_ method passes the client any out parameters.</span></span> <span data-ttu-id="3d3f7-138">Le comportement des méthodes asynchrones, y compris la valeur de retour de la \_ méthode Finish, doit correspondre exactement à celui de la méthode synchrone correspondante.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-138">The behavior of the asynchronous methods, including the return value of the Finish\_ method, should match exactly that of the corresponding synchronous method.</span></span>

<span data-ttu-id="3d3f7-139">Le client peut libérer l’objet d’appel dès que la méthode Finish est \_ retournée, ou il peut contenir un pointeur vers l’objet d’appel pour effectuer des appels supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-139">The client can release the call object as soon as the Finish\_ method returns, or it can hold a pointer to the call object to make additional calls.</span></span> <span data-ttu-id="3d3f7-140">Dans les deux cas, le client est responsable de la libération de l’objet d’appel lorsque l’objet n’est plus nécessaire.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-140">In either case, the client is responsible for releasing the call object when the object is no longer needed.</span></span>

<span data-ttu-id="3d3f7-141">Si vous appelez une \_ méthode Finish alors qu’aucun appel n’est en cours, la méthode retournera l’appel de RPC \_ E \_ \_ Complete.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-141">If you call a Finish\_ method when no call is in progress, the method will return RPC\_E\_CALL\_COMPLETE.</span></span>

> [!Note]  
> <span data-ttu-id="3d3f7-142">Si les objets client et serveur se trouvent dans le même cloisonnement, la réussite des appels à [**ICallFactory :: createCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) n’est pas garantie.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-142">If the client and server objects are in the same apartment, calls to [**ICallFactory::CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) are not guaranteed to succeed.</span></span> <span data-ttu-id="3d3f7-143">Si l’objet serveur ne prend pas en charge l’appel asynchrone sur une interface particulière, la tentative de création d’un objet d’appel échoue et le client doit utiliser l’interface synchrone.</span><span class="sxs-lookup"><span data-stu-id="3d3f7-143">If the server object does not support asynchronous calling on a particular interface, the attempt to create a call object will fail and the client must use the synchronous interface.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="3d3f7-144">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="3d3f7-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3d3f7-145">Annulation d’un appel asynchrone</span><span class="sxs-lookup"><span data-stu-id="3d3f7-145">Canceling an Asynchronous Call</span></span>](canceling-an-asynchronous-call.md)
</dt> <dt>

[<span data-ttu-id="3d3f7-146">Sécurité du client pendant un appel asynchrone</span><span class="sxs-lookup"><span data-stu-id="3d3f7-146">Client Security During an Asynchronous Call</span></span>](client-security-during-an-asynchronous-call.md)
</dt> <dt>

[<span data-ttu-id="3d3f7-147">Emprunt d’identité et appels asynchrones</span><span class="sxs-lookup"><span data-stu-id="3d3f7-147">Impersonation and Asynchronous Calls</span></span>](impersonation-and-asynchronous-calls.md)
</dt> </dl>

 

 