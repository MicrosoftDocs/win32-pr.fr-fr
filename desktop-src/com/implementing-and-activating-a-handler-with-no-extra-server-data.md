---
title: Implémentation et activation d’un gestionnaire sans données de serveur supplémentaires
description: Implémentation et activation d’un gestionnaire sans données de serveur supplémentaires
ms.assetid: 9d91260a-4cec-4a10-bb57-d02999efae47
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6866b40e1257a865aa5068ffd46611c411498877
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/03/2021
ms.locfileid: "103953291"
---
# <a name="implementing-and-activating-a-handler-with-no-extra-server-data"></a><span data-ttu-id="184a8-103">Implémentation et activation d’un gestionnaire sans données de serveur supplémentaires</span><span class="sxs-lookup"><span data-stu-id="184a8-103">Implementing and Activating a Handler with No Extra Server Data</span></span>

<span data-ttu-id="184a8-104">Pour créer une instance de votre gestionnaire, si ce n’est pas le cas, le serveur doit implémenter [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) mais pas [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span><span class="sxs-lookup"><span data-stu-id="184a8-104">To create an instance of your handler, if it is one that gets no extra server data, the server must implement [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) but not [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span></span> <span data-ttu-id="184a8-105">**IStdMarshalInfo** possède une méthode, [**GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), qui récupère le CLSID du gestionnaire d’objets à utiliser dans le processus de destination.</span><span class="sxs-lookup"><span data-stu-id="184a8-105">**IStdMarshalInfo** has one method, [**GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), which retrieves the CLSID of the object handler to be used in the destination process.</span></span> <span data-ttu-id="184a8-106">COM appelle cela quand il appelle [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) pour vous et active le gestionnaire côté client.</span><span class="sxs-lookup"><span data-stu-id="184a8-106">COM calls this when it calls [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) for you and activates the handler on the client side.</span></span>

<span data-ttu-id="184a8-107">Ensuite, les implémentations du serveur et du gestionnaire doivent appeler la fonction [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) .</span><span class="sxs-lookup"><span data-stu-id="184a8-107">Next, both the server and handler implementations must call the [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) function.</span></span> <span data-ttu-id="184a8-108">Cette fonction crée un marshaleur standard sur chaque côté (appelé gestionnaire proxy côté client et un gestionnaire de stub côté serveur).</span><span class="sxs-lookup"><span data-stu-id="184a8-108">This function creates a standard marshaler on each side (called a proxy manager on the client side and a stub manager on the server side).</span></span>

<span data-ttu-id="184a8-109">Le serveur appelle [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), en passant l’indicateur \_ Server SMEXF.</span><span class="sxs-lookup"><span data-stu-id="184a8-109">The server calls [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the flag SMEXF\_SERVER.</span></span> <span data-ttu-id="184a8-110">Cela crée un marshaleur standard côté serveur (gestionnaire stub).</span><span class="sxs-lookup"><span data-stu-id="184a8-110">This creates a server-side standard marshaler (stub manager).</span></span> <span data-ttu-id="184a8-111">La structure côté serveur est présentée dans l’illustration suivante :</span><span class="sxs-lookup"><span data-stu-id="184a8-111">The server-side structure is shown in the following illustration:</span></span>

![Diagramme qui montre la structure côté serveur.](images/b47b3bc0-3e7d-4be4-9767-7ae436bd1b21.png)

## <a name="server-side-structure"></a><span data-ttu-id="184a8-113">Structure Server-Side</span><span class="sxs-lookup"><span data-stu-id="184a8-113">Server-Side Structure</span></span>

<span data-ttu-id="184a8-114">Le gestionnaire appelle [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), en passant le gestionnaire d’indicateurs SMEXF \_ .</span><span class="sxs-lookup"><span data-stu-id="184a8-114">The handler calls [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the flag SMEXF\_HANDLER.</span></span> <span data-ttu-id="184a8-115">Cela crée un marshaleur standard côté client (gestionnaire proxy) et l’agrège avec le gestionnaire côté client.</span><span class="sxs-lookup"><span data-stu-id="184a8-115">This creates a client-side standard marshaler (proxy manager) and aggregates it with the handler on the client side.</span></span> <span data-ttu-id="184a8-116">La durée de vie des deux sont gérées par l’objet d’identité de contrôle (implémentation d' [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)) que le système implémente lorsque le gestionnaire appelle **CoGetStdMarshalEx**.</span><span class="sxs-lookup"><span data-stu-id="184a8-116">The lifetime of both are managed by the controlling identity object (implementing [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)) that the system implements when the handler calls **CoGetStdMarshalEx**.</span></span> <span data-ttu-id="184a8-117">La structure côté client est représentée dans l’illustration suivante.</span><span class="sxs-lookup"><span data-stu-id="184a8-117">The client-side structure is shown in the following illustration.</span></span>

![Diagramme qui montre la structure côté client.](images/24ae70ef-dfa8-4784-90ac-dc6cfb043ee5.png)

## <a name="client-side-structure"></a><span data-ttu-id="184a8-119">Structure Client-Side</span><span class="sxs-lookup"><span data-stu-id="184a8-119">Client-Side Structure</span></span>

<span data-ttu-id="184a8-120">Comme indiqué dans l’illustration précédente, le gestionnaire est en fait sandwich entre le gestionnaire proxy et l’identité/le contrôle inconnu.</span><span class="sxs-lookup"><span data-stu-id="184a8-120">As shown in the preceding illustration, the handler is actually sandwiched between the proxy manager and the identity/controlling unknown.</span></span> <span data-ttu-id="184a8-121">Cela permet au système de contrôler la durée de vie de l’objet tout en donnant au gestionnaire le contrôle sur les interfaces exposées.</span><span class="sxs-lookup"><span data-stu-id="184a8-121">This gives the system control over the lifetime of the object while giving the handler control over the exposed interfaces.</span></span> <span data-ttu-id="184a8-122">La ligne en pointillés entre l’identité et le gestionnaire proxy indique que les deux partagent une étroite intégration via des interfaces privées internes.</span><span class="sxs-lookup"><span data-stu-id="184a8-122">The dashed line between the Identity and Proxy Manager indicates that the two share tight integration through internal private interfaces.</span></span>

<span data-ttu-id="184a8-123">Quand COM appelle [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) pour le client, il crée l’instance de gestionnaire, en l’agrégeant avec l’identité.</span><span class="sxs-lookup"><span data-stu-id="184a8-123">When COM calls [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) for the client, it creates the handler instance, aggregating it with the Identity.</span></span> <span data-ttu-id="184a8-124">Le gestionnaire crée le marshaleur standard (par le biais de l’appel à [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), en passant le contrôle inconnu qu’il a reçu lors de sa création).</span><span class="sxs-lookup"><span data-stu-id="184a8-124">The handler will create the standard marshaler (through the call to [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the controlling unknown it received when it was created).</span></span> <span data-ttu-id="184a8-125">Le gestionnaire n’implémente pas [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) , mais retourne simplement **IMarshal** à partir du marshaleur standard.</span><span class="sxs-lookup"><span data-stu-id="184a8-125">The handler does not implement [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) but just returns **IMarshal** from the standard marshaler.</span></span> <span data-ttu-id="184a8-126">Même si le gestionnaire implémente **IMarshal**, il n’est pas appelé pendant un démarshaleur.</span><span class="sxs-lookup"><span data-stu-id="184a8-126">Even if the handler does implement **IMarshal**, it will not get called during an unmarshal.</span></span>

<span data-ttu-id="184a8-127">Si deux threads démarshalent simultanément le même objet pour la première fois, il est possible que deux gestionnaires soient créés temporairement.</span><span class="sxs-lookup"><span data-stu-id="184a8-127">If two threads simultaneously unmarshal the same object for the first time, it is possible for two handlers to get created temporarily.</span></span> <span data-ttu-id="184a8-128">Une version sera publiée par la suite.</span><span class="sxs-lookup"><span data-stu-id="184a8-128">One will subsequently be released.</span></span>

## <a name="related-topics"></a><span data-ttu-id="184a8-129">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="184a8-129">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="184a8-130">Gestionnaire de Client-Side léger</span><span class="sxs-lookup"><span data-stu-id="184a8-130">The Lightweight Client-Side Handler</span></span>](the-lightweight-client-side-handler.md)
</dt> </dl>

 

 