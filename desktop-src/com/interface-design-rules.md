---
title: Règles de conception d’interface
description: Cette section fournit un bref résumé des règles et des instructions de conception d’interface.
ms.assetid: c43fc385-bcd6-45fc-91b2-ad9827fdb15c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5c1cde73527ac79a2e4442910e3053ed96748337
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/21/2020
ms.locfileid: "104102384"
---
# <a name="interface-design-rules"></a><span data-ttu-id="6ed42-103">Règles de conception d’interface</span><span class="sxs-lookup"><span data-stu-id="6ed42-103">Interface Design Rules</span></span>

<span data-ttu-id="6ed42-104">Cette section fournit un bref résumé des règles et des instructions de conception d’interface.</span><span class="sxs-lookup"><span data-stu-id="6ed42-104">This section provides a short summary of interface design rules and guidelines.</span></span> <span data-ttu-id="6ed42-105">Certaines de ces règles sont spécifiques à l’architecture COM, tandis que d’autres sont des restrictions imposées par le langage de conception d’interface, MIDL.</span><span class="sxs-lookup"><span data-stu-id="6ed42-105">Some of these rules are specific to the COM architecture, while others are restrictions imposed by the interface design language, MIDL.</span></span> <span data-ttu-id="6ed42-106">Pour plus d’informations sur la conception de l’interface COM, consultez [anatomie d’un fichier IDL](anatomy-of-an-idl-file.md).</span><span class="sxs-lookup"><span data-stu-id="6ed42-106">For details of COM interface design, see [Anatomy of an IDL File](anatomy-of-an-idl-file.md).</span></span>

<span data-ttu-id="6ed42-107">Par définition, un objet n’est pas un objet COM, sauf s’il implémente l’interface [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) ou une interface dérivée de **IUnknown**.</span><span class="sxs-lookup"><span data-stu-id="6ed42-107">By definition, an object is not a COM object unless it implements either the [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) interface or an interface that is derived from **IUnknown**.</span></span> <span data-ttu-id="6ed42-108">En outre, les règles suivantes s’appliquent à toutes les interfaces implémentées sur un objet COM :</span><span class="sxs-lookup"><span data-stu-id="6ed42-108">In addition, the following rules apply to all interfaces implemented on a COM object:</span></span>

-   <span data-ttu-id="6ed42-109">Ils doivent avoir un identificateur d’interface (IID) unique.</span><span class="sxs-lookup"><span data-stu-id="6ed42-109">They must have a unique interface identifier (IID).</span></span>
-   <span data-ttu-id="6ed42-110">Ils doivent être immuables.</span><span class="sxs-lookup"><span data-stu-id="6ed42-110">They must be immutable.</span></span> <span data-ttu-id="6ed42-111">Une fois qu’elles ont été créées et publiées, aucune partie de leur définition ne peut changer.</span><span class="sxs-lookup"><span data-stu-id="6ed42-111">Once they are created and published, no part of their definition may change.</span></span>
-   <span data-ttu-id="6ed42-112">Toutes les méthodes d’interface doivent retourner une valeur **HRESULT** afin que les parties du système qui gèrent le traitement à distance puissent signaler des erreurs RPC.</span><span class="sxs-lookup"><span data-stu-id="6ed42-112">All interface methods must return an **HRESULT** value so that the portions of the system that handle remote processing can report RPC errors.</span></span>
-   <span data-ttu-id="6ed42-113">Tous les paramètres de chaîne dans les méthodes d’interface doivent être au format Unicode.</span><span class="sxs-lookup"><span data-stu-id="6ed42-113">All string parameters in interface methods must be Unicode.</span></span>
-   <span data-ttu-id="6ed42-114">Vos types de données doivent être accessibles à distance.</span><span class="sxs-lookup"><span data-stu-id="6ed42-114">Your data types must be remotable.</span></span> <span data-ttu-id="6ed42-115">Si vous ne pouvez pas convertir un type de données en un type accessible à distance, vous devrez créer vos propres routines de marshaling et de démarshaling.</span><span class="sxs-lookup"><span data-stu-id="6ed42-115">If you cannot convert a data type to a remotable type, you will have to create your own marshaling and unmarshaling routines.</span></span> <span data-ttu-id="6ed42-116">En outre, **LPVOID**, **ou \* void**, n’a aucune signification sur un ordinateur distant.</span><span class="sxs-lookup"><span data-stu-id="6ed42-116">Also, **LPVOID**, or **void \***, has no meaning on a remote computer.</span></span> <span data-ttu-id="6ed42-117">Utilisez un pointeur vers [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown), si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="6ed42-117">Use a pointer to [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown), if necessary.</span></span>

> [!Note]  
> <span data-ttu-id="6ed42-118">L’implémentation actuelle de MIDL ne gère pas la surcharge de fonction ou l’héritage multiple.</span><span class="sxs-lookup"><span data-stu-id="6ed42-118">The current implementation of MIDL does not handle function overloading or multiple inheritance.</span></span>

 

## <a name="other-interface-design-considerations"></a><span data-ttu-id="6ed42-119">Autres considérations relatives à la conception d’interface</span><span class="sxs-lookup"><span data-stu-id="6ed42-119">Other Interface Design Considerations</span></span>

<span data-ttu-id="6ed42-120">Utilisez des pointeurs vers des données très soigneusement.</span><span class="sxs-lookup"><span data-stu-id="6ed42-120">Use pointers to data very carefully.</span></span> <span data-ttu-id="6ed42-121">Pour recréer les données dans l’espace d’adressage du processus appelé, le temps d’exécution RPC doit connaître la taille exacte des données.</span><span class="sxs-lookup"><span data-stu-id="6ed42-121">To re-create the data in the address space of the process that is called, the RPC run time must know the exact size of the data.</span></span> <span data-ttu-id="6ed42-122">Si, par exemple, un **paramètre \* char** pointe vers une mémoire tampon de caractères plutôt qu’un caractère unique, les données ne peuvent pas être recréées correctement.</span><span class="sxs-lookup"><span data-stu-id="6ed42-122">If, for example, a **CHAR \*** parameter points to a buffer of characters rather than to a single character, the data cannot be correctly re-created.</span></span> <span data-ttu-id="6ed42-123">Utilisez la syntaxe disponible avec MIDL pour décrire avec précision les structures de données représentées par vos définitions de type.</span><span class="sxs-lookup"><span data-stu-id="6ed42-123">Use the syntax available with MIDL to accurately describe the data structures represented by your type definitions.</span></span>

<span data-ttu-id="6ed42-124">L’initialisation est essentielle pour les pointeurs qui sont incorporés dans les tableaux et les structures et passés au-delà des limites du processus.</span><span class="sxs-lookup"><span data-stu-id="6ed42-124">Initialization is essential for pointers that are embedded in arrays and structures and passed across process boundaries.</span></span> <span data-ttu-id="6ed42-125">Les pointeurs non initialisés peuvent fonctionner lorsqu’ils sont passés à un programme dans le même espace de processus, mais les proxies et les stubs partent du principe que tous les pointeurs sont initialisés avec des adresses valides ou qu’ils ont la valeur null.</span><span class="sxs-lookup"><span data-stu-id="6ed42-125">Uninitialized pointers may work when passed to a program in the same process space, but proxies and stubs assume that all pointers are initialized with valid addresses or are null.</span></span>

<span data-ttu-id="6ed42-126">Soyez prudent lors de l’alias des pointeurs (permettant aux pointeurs de pointer vers la même mémoire).</span><span class="sxs-lookup"><span data-stu-id="6ed42-126">Be careful when aliasing pointers (allowing pointers to point to the same piece of memory).</span></span> <span data-ttu-id="6ed42-127">Si l’alias est intentionnel, ces pointeurs doivent être déclarés avec un alias dans le fichier IDL.</span><span class="sxs-lookup"><span data-stu-id="6ed42-127">If the aliasing is intentional, these pointers should be declared aliased in the IDL file.</span></span> <span data-ttu-id="6ed42-128">Les pointeurs déclarés comme sans alias ne doivent jamais s’alias mutuellement.</span><span class="sxs-lookup"><span data-stu-id="6ed42-128">Pointers declared as nonaliased should never alias each other.</span></span>

<span data-ttu-id="6ed42-129">Soyez attentif à la façon dont vous allouez et libérez de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="6ed42-129">Pay attention to how you allocate and free memory.</span></span> <span data-ttu-id="6ed42-130">N’oubliez pas que, sauf si vous indiquez explicitement à un objet COM (à l’aide de l’attribut [**allocate**](/windows/desktop/Midl/allocate) ) de ne pas libérer une structure de données qui a été créée pendant un appel hors processus, cette structure sera détruite à la fin de l’appel.</span><span class="sxs-lookup"><span data-stu-id="6ed42-130">Remember that, unless you explicitly tell a COM object (by using the [**allocate**](/windows/desktop/Midl/allocate) attribute) not to free a data structure that was created during an out-of-process call, that structure will be destroyed when the call completes.</span></span> <span data-ttu-id="6ed42-131">Envisagez également la surcharge potentiellement destructrice créée par une allocation inefficace des structures de données qui doivent désormais être marshalées et démarshalées.</span><span class="sxs-lookup"><span data-stu-id="6ed42-131">Also, consider the potentially destructive overhead created by inefficient allocation of data structures that now need to be marshaled and unmarshaled.</span></span>

<span data-ttu-id="6ed42-132">Enfin, soyez prudent lors de la définition de vos valeurs de retour **HRESULT** afin de ne pas créer de codes d’erreur qui sont en conflit avec les codes ITF de l’infrastructure définie par com \_ (les valeurs entre 0x0000 et 0x01FF sont réservées) ou qui sont en conflit avec d’autres valeurs **HRESULT** ayant la même valeur.</span><span class="sxs-lookup"><span data-stu-id="6ed42-132">Finally, be careful when defining your **HRESULT** return values so that you don't create error codes that conflict with COM-defined FACILITY\_ITF codes (values between 0x0000 and 0x01FF are reserved) or that conflict with other **HRESULT** values with the same value.</span></span> <span data-ttu-id="6ed42-133">Dans la mesure du possible, utilisez les valeurs de retour de réussite et d’échec de COM universel, et utilisez un paramètre [**out**](/windows/desktop/Midl/out-idl) plutôt qu’un **HRESULT** pour retourner des informations spécifiques à l’appel de fonction.</span><span class="sxs-lookup"><span data-stu-id="6ed42-133">Whenever possible, use the universal COM success and failure return values, and use an [**out**](/windows/desktop/Midl/out-idl) parameter, rather than an **HRESULT**, to return information specific to the function call.</span></span>

<span data-ttu-id="6ed42-134">Pour plus d'informations, voir les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="6ed42-134">For more information, see the following topics:</span></span>

-   [<span data-ttu-id="6ed42-135">Conception d’interfaces accessibles à distance</span><span class="sxs-lookup"><span data-stu-id="6ed42-135">Designing Remotable Interfaces</span></span>](designing-remotable-interfaces.md)
-   [<span data-ttu-id="6ed42-136">Utilisation d’une interface COM</span><span class="sxs-lookup"><span data-stu-id="6ed42-136">Using a COM Interface</span></span>](using-a-com-interface.md)

## <a name="related-topics"></a><span data-ttu-id="6ed42-137">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="6ed42-137">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="6ed42-138">Définitions d’interface et bibliothèques de types</span><span class="sxs-lookup"><span data-stu-id="6ed42-138">Interface Definitions and Type Libraries</span></span>](/windows/desktop/Midl/interface-definitions-and-type-libraries)
</dt> </dl>

 

 