---
title: Détails du marshaling
description: Si vous utilisez le marshaling standard, COM gère tous les détails décrits ici pour vous.
ms.assetid: bf3fe212-648e-4d00-ad1d-43d2e5e6a7ae
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f4d0fd46ee29c712c6f2b5b286df76a30f1047e6
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/03/2021
ms.locfileid: "106523737"
---
# <a name="marshaling-details"></a><span data-ttu-id="6e5a1-103">Détails du marshaling</span><span class="sxs-lookup"><span data-stu-id="6e5a1-103">Marshaling Details</span></span>

<span data-ttu-id="6e5a1-104">Si vous utilisez le marshaling standard, COM gère tous les détails décrits ici pour vous.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-104">If you use standard marshaling, COM handles all of the details described here for you.</span></span> <span data-ttu-id="6e5a1-105">Toutefois, il existe des programmeurs qui ont besoin de ces informations et pour ceux qui s’intéressent aux informations sous-jacentes.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-105">However, there are those few programmers who need these details and for those interested in the underlying information.</span></span> <span data-ttu-id="6e5a1-106">Le marshaling est le processus d’empaquetage et de désassemblage des paramètres pour qu’un appel de procédure distante puisse avoir lieu.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-106">Marshaling is the process of packaging and unpackaging parameters so a remote procedure call can take place.</span></span>

<span data-ttu-id="6e5a1-107">Les différents types de paramètres sont marshalés de différentes façons.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-107">Different parameter types are marshaled in different ways.</span></span> <span data-ttu-id="6e5a1-108">Par exemple, le marshaling d’un paramètre entier implique simplement de copier la valeur dans la mémoire tampon des messages.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-108">For example, marshaling an integer parameter involves simply copying the value into the message buffer.</span></span> <span data-ttu-id="6e5a1-109">(Même si, même dans ce cas simple, il y a des problèmes tels que l’ordonnancement des octets pour traiter les appels entre ordinateurs.) Le marshaling d’un tableau est toutefois un processus plus complexe.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-109">(Although even in this simple case, there are issues such as byte ordering to deal with in cross-computer calls.) Marshaling an array, however, is a more complex process.</span></span> <span data-ttu-id="6e5a1-110">Les membres du tableau sont copiés dans un ordre spécifique afin que l’autre partie puisse reconstruire le tableau exactement.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-110">Array members are copied in a specific order so that the other side can reconstruct the array exactly.</span></span> <span data-ttu-id="6e5a1-111">Lorsqu’un pointeur est marshalé, les données vers lesquelles le pointeur pointe sont copiées et les règles et conventions suivantes pour traiter les pointeurs imbriqués dans les structures.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-111">When a pointer is marshaled, the data that the pointer is pointing to is copied following rules and conventions for dealing with nested pointers in structures.</span></span> <span data-ttu-id="6e5a1-112">Des fonctions uniques existent pour gérer le marshaling de chaque type de paramètre.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-112">Unique functions exist to handle the marshaling of each parameter type.</span></span>

<span data-ttu-id="6e5a1-113">Avec le marshaling standard, les proxies et les stubs sont des ressources à l’échelle du système pour l’interface et ils interagissent avec le canal via un protocole standard.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-113">With standard marshaling, the proxies and stubs are systemwide resources for the interface and they interact with the channel through a standard protocol.</span></span> <span data-ttu-id="6e5a1-114">Le marshaling standard peut être utilisé à la fois par les interfaces définies par COM standard et par les interfaces personnalisées, comme suit :</span><span class="sxs-lookup"><span data-stu-id="6e5a1-114">Standard marshaling can be used both by standard COM-defined interfaces and by custom interfaces, as follows:</span></span>

-   <span data-ttu-id="6e5a1-115">Dans le cas de la plupart des interfaces COM, les proxies et les stubs pour le marshaling standard sont des objets de composant in-process qui sont chargés à partir d’une DLL du système fournie par COM dans Ole32.dll.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-115">In the case of most COM interfaces, the proxies and stubs for standard marshaling are in-process component objects which are loaded from a systemwide DLL provided by COM in Ole32.dll.</span></span>
-   <span data-ttu-id="6e5a1-116">Dans le cas d’interfaces personnalisées, les proxies et les stubs pour le marshaling standard sont générés par le concepteur d’interface, en général avec MIDL.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-116">In the case of custom interfaces, the proxies and stubs for standard marshaling are generated by the interface designer, typically with MIDL.</span></span> <span data-ttu-id="6e5a1-117">Ces proxys et stubs étant configurés de manière statique dans le registre, tout client potentiel peut utiliser l’interface personnalisée à travers les limites du processus.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-117">These proxies and stubs are statically configured in the registry, so any potential client can use the custom interface across process boundaries.</span></span> <span data-ttu-id="6e5a1-118">Ces proxies et stubs sont chargés à partir d’une DLL localisée via le registre système, à l’aide de l’ID d’interface (IID) de l’interface personnalisée qu’ils marshalent.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-118">These proxies and stubs are loaded from a DLL that is located via the system registry, using the interface ID (IID) for the custom interface they marshal.</span></span>
-   <span data-ttu-id="6e5a1-119">Une alternative à l’utilisation de MIDL pour générer des proxies et des stubs pour les interfaces personnalisées, une bibliothèque de types peut être générée à la place et le système fourni, type-libraryâ, le moteur de marshaling piloté marshale l’interface.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-119">An alternative to using MIDL to generate proxies and stubs for custom interfaces, a type library can be generated instead and the system provided, type-libraryâ€“driven marshaling engine will marshal the interface.</span></span>

<span data-ttu-id="6e5a1-120">Comme alternative au marshaling standard, une interface (standard ou personnalisée) peut utiliser le marshaling personnalisé.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-120">As an alternative to standard marshaling, an interface (standard or custom) can use custom marshaling.</span></span> <span data-ttu-id="6e5a1-121">Avec le marshaling personnalisé, un objet implémente dynamiquement les proxies au moment de l’exécution pour chaque interface qu’il prend en charge.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-121">With custom marshaling, an object dynamically implements the proxies at run time for each interface that it supports.</span></span> <span data-ttu-id="6e5a1-122">Pour une interface donnée, l’objet peut sélectionner un marshaling standard fourni par COM ou un marshaling personnalisé.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-122">For any given interface, the object can select COM-provided standard marshaling or custom marshaling.</span></span> <span data-ttu-id="6e5a1-123">Ce choix est effectué par l’objet interface par interface.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-123">This choice is made by the object on an interface-by-interface basis.</span></span> <span data-ttu-id="6e5a1-124">Une fois le choix effectué pour une interface donnée, il reste en vigueur pendant la durée de vie de l’objet.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-124">Once the choice is made for a given interface, it remains in effect during the object's lifetime.</span></span> <span data-ttu-id="6e5a1-125">Toutefois, une interface sur un objet peut utiliser le marshaling personnalisé tandis qu’une autre utilise le marshaling standard.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-125">However, one interface on an object can use custom marshaling while another uses standard marshaling.</span></span>

<span data-ttu-id="6e5a1-126">Le marshaling personnalisé est fondamentalement unique pour l’objet qui l’implémente.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-126">Custom marshaling is inherently unique to the object that implements it.</span></span> <span data-ttu-id="6e5a1-127">Elle utilise des proxys implémentés par l’objet et fournis au système sur demande au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-127">It uses proxies implemented by the object and provided to the system on request at run time.</span></span> <span data-ttu-id="6e5a1-128">Les objets qui implémentent le marshaling personnalisé doivent implémenter l’interface [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) , contrairement aux objets qui prennent en charge le marshaling standard.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-128">Objects that implement custom marshaling must implement the [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) interface, whereas objects that support standard marshaling do not.</span></span>

<span data-ttu-id="6e5a1-129">Si vous décidez d’écrire une interface personnalisée, vous devez fournir une prise en charge du marshaling pour celle-ci.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-129">If you decide to write a custom interface, you must provide marshaling support for it.</span></span> <span data-ttu-id="6e5a1-130">En règle générale, vous allez fournir une DLL de marshaling standard pour l’interface que vous concevez.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-130">Typically, you will provide a standard marshaling DLL for the interface you design.</span></span> <span data-ttu-id="6e5a1-131">Vous pouvez créer le code proxy/stub et la DLL proxy/stub, ou vous pouvez créer une bibliothèque de types qui sera utilisée par COM pour effectuer un marshaling piloté par les données (à l’aide des données de la bibliothèque de types).</span><span class="sxs-lookup"><span data-stu-id="6e5a1-131">You can create the proxy/stub code and the proxy/stub DLL, or you can create a type library that COM will use to do data-driven marshaling (using the data in the type library).</span></span>

<span data-ttu-id="6e5a1-132">Pour qu’un client effectue un appel à une méthode d’interface dans un objet dans un autre processus, implique la coopération de plusieurs composants.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-132">For a client to make a call to an interface method in an object in another process involves the cooperation of several components.</span></span> <span data-ttu-id="6e5a1-133">Le proxy standard est un élément de code spécifique à l’interface qui réside dans l’espace de processus du client et prépare les paramètres d’interface pour la transmission.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-133">The standard proxy is a piece of interface-specific code that resides in the client's process space and prepares the interface parameters for transmittal.</span></span> <span data-ttu-id="6e5a1-134">Les packages informatiques, ou marshalés, peuvent être recréés et compris dans le processus de réception.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-134">It packages, or marshals, them in such a way that they can be re-created and understood in the receiving process.</span></span> <span data-ttu-id="6e5a1-135">Le stub standard, également un morceau de code spécifique à l’interface, réside dans l’espace de processus du serveur et inverse le travail du proxy.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-135">The standard stub, also a piece of interface-specific code, resides in the server's process space and reverses the work of the proxy.</span></span> <span data-ttu-id="6e5a1-136">Le stub décompresse, ou démarshale, les paramètres envoyés et les transfère à l’application objet.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-136">The stub unpackages, or unmarshals, the sent parameters and forwards them to the object application.</span></span> <span data-ttu-id="6e5a1-137">Il empaquette également les informations de réponse à renvoyer au client.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-137">It also packages reply information to send back to the client.</span></span>

> [!Note]  
> <span data-ttu-id="6e5a1-138">Les lecteurs qui sont plus familiarisés avec RPC que COM peuvent être utilisés pour voir les termes stub client et stub serveur.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-138">Readers more familiar with RPC than COM may be used to seeing the terms client stub and server stub.</span></span> <span data-ttu-id="6e5a1-139">Ces termes sont analogues au proxy et au stub.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-139">These terms are analogous to proxy and stub.</span></span>

 

## <a name="components-of-interprocess-communications"></a><span data-ttu-id="6e5a1-140">Composants des communications interprocessus</span><span class="sxs-lookup"><span data-stu-id="6e5a1-140">Components of Interprocess Communications</span></span>

<span data-ttu-id="6e5a1-141">Le diagramme suivant illustre le déroulement de la communication entre les composants impliqués.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-141">The following diagram shows the flow of communication between the components involved.</span></span> <span data-ttu-id="6e5a1-142">Du côté client de la limite de processus, l’appel de méthode du client passe par le proxy, puis sur le canal, qui fait partie de la bibliothèque COM.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-142">On the client side of the process boundary, the client's method call goes through the proxy and then onto the channel, which is part of the COM library.</span></span> <span data-ttu-id="6e5a1-143">Le canal envoie la mémoire tampon contenant les paramètres marshalés à la bibliothèque Runtime RPC, qui la transmet à travers la limite du processus.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-143">The channel sends the buffer containing the marshaled parameters to the RPC run-time library, which transmits it across the process boundary.</span></span> <span data-ttu-id="6e5a1-144">Le temps d’exécution RPC et les bibliothèques COM existent des deux côtés du processus.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-144">The RPC run time and the COM libraries exist on both sides of the process.</span></span> <span data-ttu-id="6e5a1-145">La distinction entre le canal et le temps d’exécution RPC est une caractéristique de cette implémentation et ne fait pas partie du modèle de programmation ou du modèle conceptuel pour les objets client/serveur COM.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-145">The distinction between the channel and the RPC run time is a characteristic of this implementation and is not part of the programming model or the conceptual model for COM client/server objects.</span></span> <span data-ttu-id="6e5a1-146">Les serveurs COM voient uniquement le proxy ou le stub et, indirectement, le canal.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-146">COM servers see only the proxy or stub and, indirectly, the channel.</span></span> <span data-ttu-id="6e5a1-147">Les implémentations futures peuvent utiliser des couches différentes sous le canal ou aucune couche.</span><span class="sxs-lookup"><span data-stu-id="6e5a1-147">Future implementations may use different layers below the channel or no layers.</span></span>

![Diagramme qui montre le Client.exe et Server.exe flux de chaque côté de la limite de processus.](images/457036c1-98b8-4f35-aebe-70de38112b83.png)

## <a name="related-topics"></a><span data-ttu-id="6e5a1-149">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="6e5a1-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="6e5a1-150">Channel</span><span class="sxs-lookup"><span data-stu-id="6e5a1-150">Channel</span></span>](channel.md)
</dt> <dt>

[<span data-ttu-id="6e5a1-151">Communication entre les objets</span><span class="sxs-lookup"><span data-stu-id="6e5a1-151">Inter-Object Communication</span></span>](inter-object-communication.md)
</dt> <dt>

[<span data-ttu-id="6e5a1-152">Microsoft RPC</span><span class="sxs-lookup"><span data-stu-id="6e5a1-152">Microsoft RPC</span></span>](microsoft-rpc.md)
</dt> <dt>

[<span data-ttu-id="6e5a1-153">Proxy</span><span class="sxs-lookup"><span data-stu-id="6e5a1-153">Proxy</span></span>](proxy.md)
</dt> <dt>

[<span data-ttu-id="6e5a1-154">Talon</span><span class="sxs-lookup"><span data-stu-id="6e5a1-154">Stub</span></span>](stub.md)
</dt> </dl>

 

 