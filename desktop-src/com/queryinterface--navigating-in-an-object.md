---
title: QueryInterface, navigation dans un objet
description: QueryInterface, navigation dans un objet
ms.assetid: 7dec015f-7609-40eb-a71e-f6e9c9b9f8ff
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3dbd44d200bf0a992f47bc375d0782bdadacf6a3
ms.sourcegitcommit: 85688bbfbe5b121bc05ddf112d54c23a469dfbc0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/29/2020
ms.locfileid: "104314077"
---
# <a name="queryinterface-navigating-in-an-object"></a><span data-ttu-id="be757-103">QueryInterface : navigation dans un objet</span><span class="sxs-lookup"><span data-stu-id="be757-103">QueryInterface: Navigating in an Object</span></span>

<span data-ttu-id="be757-104">Une fois que vous avez un pointeur initial vers une interface sur un objet, COM a un mécanisme très simple pour déterminer si l’objet prend en charge une autre interface spécifique et, si tel est le cas, pour obtenir un pointeur vers celui-ci.</span><span class="sxs-lookup"><span data-stu-id="be757-104">After you have an initial pointer to an interface on an object, COM has a very simple mechanism to find out whether the object supports another specific interface and, if so, to get a pointer to it.</span></span> <span data-ttu-id="be757-105">(Pour plus d’informations sur l’obtention d’un pointeur initial vers une interface sur un objet, consultez [obtention d’un pointeur vers un objet](getting-a-pointer-to-an-object.md).) Ce mécanisme est la méthode [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) de l’interface [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) .</span><span class="sxs-lookup"><span data-stu-id="be757-105">(For information about getting an initial pointer to an interface on an object, see [Getting a Pointer to an Object](getting-a-pointer-to-an-object.md).) This mechanism is the [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) method of the [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) interface.</span></span> <span data-ttu-id="be757-106">Si l’objet prend en charge l’interface demandée, la méthode doit retourner un pointeur vers cette interface.</span><span class="sxs-lookup"><span data-stu-id="be757-106">If the object supports the requested interface, the method must return a pointer to that interface.</span></span> <span data-ttu-id="be757-107">Cela permet à un objet de naviguer librement parmi les interfaces prises en charge par un objet.</span><span class="sxs-lookup"><span data-stu-id="be757-107">This permits an object to navigate freely through the interfaces that an object supports.</span></span> <span data-ttu-id="be757-108">**QueryInterface** sépare la demande « prenez-vous en charge un contrat donné ? »</span><span class="sxs-lookup"><span data-stu-id="be757-108">**QueryInterface** separates the request "Do you support a given contract?"</span></span> <span data-ttu-id="be757-109">de l’utilisation hautes performances de ce contrat une fois les négociations réussies.</span><span class="sxs-lookup"><span data-stu-id="be757-109">from the high-performance use of that contract once negotiations have been successful.</span></span>

<span data-ttu-id="be757-110">Lorsqu’un client accède initialement à un objet, ce client reçoit au minimum un pointeur d’interface [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) (l’interface la plus fondamentale) par le biais duquel il peut contrôler la durée de vie de l’objet, en disant à l’objet quand il a terminé d’utiliser l’objet, et appeler [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)).</span><span class="sxs-lookup"><span data-stu-id="be757-110">When a client initially gains access to an object, that client will receive, at a minimum, an [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) interface pointer (the most fundamental interface) through which it can control the lifetime of the object—by telling the object when it is done using the object—and invoke [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)).</span></span> <span data-ttu-id="be757-111">Le client est programmé pour demander à chaque objet qu’il gère d’effectuer certaines opérations, mais l’interface **IUnknown** n’a aucune fonction pour ces opérations.</span><span class="sxs-lookup"><span data-stu-id="be757-111">The client is programmed to ask each object it manages to perform some operations, but the **IUnknown** interface has no functions for those operations.</span></span> <span data-ttu-id="be757-112">Au lieu de cela, ces opérations sont exprimées par d’autres interfaces.</span><span class="sxs-lookup"><span data-stu-id="be757-112">Instead, those operations are expressed through other interfaces.</span></span> <span data-ttu-id="be757-113">Le client est donc programmé pour négocier avec des objets pour ces interfaces.</span><span class="sxs-lookup"><span data-stu-id="be757-113">The client is thus programmed to negotiate with objects for those interfaces.</span></span> <span data-ttu-id="be757-114">Plus précisément, le client appellera **QueryInterface** pour demander à un objet une interface par le biais de laquelle le client peut appeler les opérations souhaitées.</span><span class="sxs-lookup"><span data-stu-id="be757-114">Specifically, the client will call **QueryInterface** to ask an object for an interface through which the client may invoke the desired operations.</span></span>

<span data-ttu-id="be757-115">Étant donné que l’objet implémente [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), il a la possibilité d’accepter ou de rejeter la demande.</span><span class="sxs-lookup"><span data-stu-id="be757-115">Because the object implements [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), it has the ability to accept or reject the request.</span></span> <span data-ttu-id="be757-116">Si l’objet accepte la demande du client, **QueryInterface** retourne un nouveau pointeur vers l’interface demandée au client.</span><span class="sxs-lookup"><span data-stu-id="be757-116">If the object accepts the client's request, **QueryInterface** returns a new pointer to the requested interface to the client.</span></span> <span data-ttu-id="be757-117">Par le biais de ce pointeur d’interface, le client a accès aux méthodes de cette interface.</span><span class="sxs-lookup"><span data-stu-id="be757-117">Through that interface pointer, the client has access to the methods of that interface.</span></span> <span data-ttu-id="be757-118">Si, en revanche, l’objet rejette la demande du client, **QueryInterface** retourne un pointeur null (une erreur) et le client n’a aucun pointeur via lequel appeler les fonctions souhaitées.</span><span class="sxs-lookup"><span data-stu-id="be757-118">If, on the other hand, the object rejects the client's request, **QueryInterface** returns a null pointer—an error—and the client has no pointer through which to call the desired functions.</span></span> <span data-ttu-id="be757-119">Dans ce cas, le client doit s’adapter correctement à cette éventualité.</span><span class="sxs-lookup"><span data-stu-id="be757-119">In this case, the client must deal gracefully with that possibility.</span></span> <span data-ttu-id="be757-120">Par exemple, supposons qu’un client ait un pointeur vers l’interface A sur un objet et demande les interfaces B et C. Supposons également que l’objet prenne en charge l’interface B, mais ne prend pas en charge l’interface C. Le résultat est que l’objet retourne un pointeur vers B et signale que C n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="be757-120">For example, suppose a client has a pointer to interface A on an object and asks for interfaces B and C. Suppose also that the object supports interface B but does not support interface C. The result is that the object returns a pointer to B and reports that C is not supported.</span></span>

<span data-ttu-id="be757-121">Un point important est que lorsqu’un objet rejette un appel à [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), il est impossible pour le client de demander à l’objet d’effectuer les opérations exprimées par le biais de l’interface demandée.</span><span class="sxs-lookup"><span data-stu-id="be757-121">A key point is that when an object rejects a call to [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), it is impossible for the client to ask the object to perform the operations expressed through the requested interface.</span></span> <span data-ttu-id="be757-122">Un client doit avoir un pointeur d’interface pour appeler des méthodes dans cette interface.</span><span class="sxs-lookup"><span data-stu-id="be757-122">A client must have an interface pointer to invoke methods in that interface.</span></span> <span data-ttu-id="be757-123">Si l’objet refuse de fournir le pointeur demandé, le client doit être prêt à le faire sans, soit en n’utilisant pas tout ce qu’il avait prévu d’effectuer avec cet objet, soit en tentant de revenir sur un autre interface, peut-être moins puissante.</span><span class="sxs-lookup"><span data-stu-id="be757-123">If the object refuses to provide the requested pointer, the client must be prepared to do without, either by not doing whatever it had intended to do with that object or by attempting to fall back on another, perhaps less powerful, interface.</span></span> <span data-ttu-id="be757-124">Cette fonctionnalité de la fonctionnalité COM fonctionne bien en comparaison avec d’autres systèmes orientés objet dans lesquels vous ne pouvez pas savoir si une fonction fonctionnera tant que vous n’aurez pas appelé cette fonction, et même si la gestion de l’échec est incertaine.</span><span class="sxs-lookup"><span data-stu-id="be757-124">This feature of COM functionality works well in comparison with other object-oriented systems in which you cannot know whether a function will work until you call that function, and even then, handling failure is uncertain.</span></span> <span data-ttu-id="be757-125">**QueryInterface** offre un moyen fiable et cohérent de savoir si un objet prend en charge une interface avant de tenter d’appeler ses méthodes.</span><span class="sxs-lookup"><span data-stu-id="be757-125">**QueryInterface** provides a reliable and consistent way to know whether an object supports an interface before attempting to call its methods.</span></span>

<span data-ttu-id="be757-126">La méthode [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) offre également un moyen fiable et fiable pour un objet d’indiquer qu’il ne prend pas en charge un contrat donné.</span><span class="sxs-lookup"><span data-stu-id="be757-126">The [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) method also provides a robust and reliable way for an object to indicate that it does not support a given contract.</span></span> <span data-ttu-id="be757-127">Autrement dit, si dans un appel à **QueryInterface** , il demande un objet « Old », qu’il prenne en charge une interface « New » (par exemple, qui a été inventée après l’envoi de l’ancien objet), l’ancien objet sera fiable, sans provoquer de blocage, répondez « non ».</span><span class="sxs-lookup"><span data-stu-id="be757-127">That is, if in a call to **QueryInterface** one asks an "old" object whether it supports a "new" interface (one, for example, that was invented after the old object had been shipped), the old object will reliably, without causing a crash, answer "no."</span></span> <span data-ttu-id="be757-128">La technologie qui prend en charge cette technologie est l’algorithme par lequel les IID sont alloués.</span><span class="sxs-lookup"><span data-stu-id="be757-128">The technology that supports this is the algorithm by which IIDs are allocated.</span></span> <span data-ttu-id="be757-129">Bien que cela puisse paraître un petit point, il est extrêmement important de l’architecture globale du système, et la possibilité de rechercher des éléments hérités concernant les nouvelles fonctionnalités est, étonnamment, une fonctionnalité qui n’est pas présente dans la plupart des autres architectures d’objets.</span><span class="sxs-lookup"><span data-stu-id="be757-129">While this may seem like a small point, it is extremely important to the overall architecture of the system, and the ability to inquire of legacy elements about new functionality is, surprisingly, a feature not present in most other object architectures.</span></span>

## <a name="related-topics"></a><span data-ttu-id="be757-130">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="be757-130">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="be757-131">Utilisation et implémentation de IUnknown</span><span class="sxs-lookup"><span data-stu-id="be757-131">Using and Implementing IUnknown</span></span>](using-and-implementing-iunknown.md)
</dt> </dl>

 

 




