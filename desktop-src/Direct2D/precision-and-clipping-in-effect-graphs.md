---
title: Précision et découpage numérique dans les graphiques d’effet
description: Les applications qui restituent des effets à l’aide de Direct2D doivent veiller à atteindre le niveau souhaité de qualité et de prévisibilité en ce qui concerne la précision numérique.
ms.assetid: 6fd1d77f-e613-534f-3205-bad11fa24c30
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 90628661ec8cd3f16ff6a6149aecbb7e8be3e5a9
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104031696"
---
# <a name="precision-and-numerical-clipping-in-effect-graphs"></a><span data-ttu-id="e35a0-103">Précision et découpage numérique dans les graphiques d’effet</span><span class="sxs-lookup"><span data-stu-id="e35a0-103">Precision and numerical clipping in effect graphs</span></span>

<span data-ttu-id="e35a0-104">Les applications qui restituent des effets à l’aide de Direct2D doivent veiller à atteindre le niveau souhaité de qualité et de prévisibilité en ce qui concerne la précision numérique.</span><span class="sxs-lookup"><span data-stu-id="e35a0-104">Applications that render effects using Direct2D must take care to achieve the desired level of quality and predictability with respect to numerical precision.</span></span> <span data-ttu-id="e35a0-105">Cette rubrique décrit les meilleures pratiques et les paramètres pertinents dans Direct2D qui sont utiles dans les cas suivants :</span><span class="sxs-lookup"><span data-stu-id="e35a0-105">This topic describes best practices and relevant settings in Direct2D which are useful if:</span></span>

-   <span data-ttu-id="e35a0-106">Votre graphique d’effet repose sur une précision ou des couleurs numériques élevées en dehors de la \[ plage 0, 1 \] et vous voulez vous assurer que celles-ci seront toujours disponibles</span><span class="sxs-lookup"><span data-stu-id="e35a0-106">Your effect graph relies on high numerical precision or colors outside of the \[0, 1\] range, and you want to make sure these will always be available</span></span>
-   <span data-ttu-id="e35a0-107">Ou votre graphique d’effet repose sur l’implémentation de rendu pour fixer les couleurs intermédiaires à la \[ plage 0, 1 \] et vous voulez vous assurer que ce verrouillage se produit toujours</span><span class="sxs-lookup"><span data-stu-id="e35a0-107">Or, your effect graph relies on the rendering implementation to clamp intermediate colors to the \[0, 1\] range, and you want to ensure this clamping always occurs</span></span>

<span data-ttu-id="e35a0-108">Direct2D divise souvent un graphique d’effet en sections et restitue chaque section dans une étape distincte.</span><span class="sxs-lookup"><span data-stu-id="e35a0-108">Direct2D often divides an effect graph into sections, and renders each section in a separate step.</span></span> <span data-ttu-id="e35a0-109">La sortie de certaines étapes peut être stockée dans des textures Direct3D intermédiaires qui, par défaut, ont une plage numérique et une précision limitées.</span><span class="sxs-lookup"><span data-stu-id="e35a0-109">The output of some steps may be stored in intermediate Direct3D textures which by default have limited numerical range and precision.</span></span> <span data-ttu-id="e35a0-110">Direct2D n’apporte aucune garantie quant à l’utilisation ou l’emplacement de ces textures intermédiaires.</span><span class="sxs-lookup"><span data-stu-id="e35a0-110">Direct2D makes no guarantees about if or where these intermediate textures are used.</span></span> <span data-ttu-id="e35a0-111">Ce comportement peut varier en fonction des capacités du GPU, ainsi qu’entre les versions de Windows.</span><span class="sxs-lookup"><span data-stu-id="e35a0-111">This behavior may vary according to GPU capabilities as well as between Windows versions.</span></span>

<span data-ttu-id="e35a0-112">Dans Windows 10, Direct2D utilise moins de textures intermédiaires en raison de l’utilisation de la liaison de nuanceur.</span><span class="sxs-lookup"><span data-stu-id="e35a0-112">In Windows 10, Direct2D uses fewer intermediate textures due to its use of shader linking.</span></span> <span data-ttu-id="e35a0-113">Direct2D peut donc produire des résultats différents avec les paramètres par défaut par rapport aux versions précédentes de Windows.</span><span class="sxs-lookup"><span data-stu-id="e35a0-113">Direct2D may therefore produce different results with default settings than in prior Windows releases.</span></span> <span data-ttu-id="e35a0-114">Cela affecte principalement les scénarios où la liaison de nuanceur est possible dans un graphique d’effet, et ce graphique contient également des effets qui produisent des couleurs de sortie étendues.</span><span class="sxs-lookup"><span data-stu-id="e35a0-114">This primarily affects scenarios where shader linking is possible in an effect graph, and that graph also contains effects that produce extended-range output colors.</span></span>

## <a name="overview-of-effect-rendering-and-intermediates"></a><span data-ttu-id="e35a0-115">Vue d’ensemble du rendu des effets et des intermédiaires</span><span class="sxs-lookup"><span data-stu-id="e35a0-115">Overview of effect rendering and intermediates</span></span>

<span data-ttu-id="e35a0-116">Pour afficher un graphique d’effet, Direct2D commence par Rechercher le graphique sous-jacent des « transformations », où une transformation est un nœud graphique utilisé dans un effet.</span><span class="sxs-lookup"><span data-stu-id="e35a0-116">To render an effect graph, Direct2D first finds the underlying graph of “transforms,” where a transform is a graph node used within an effect.</span></span> <span data-ttu-id="e35a0-117">Il existe différents types de transformations, notamment ceux qui fournissent des nuanceurs Direct3D à utiliser par Direct2D.</span><span class="sxs-lookup"><span data-stu-id="e35a0-117">There are different types of transforms, including those which provide Direct3D shaders for Direct2D to use.</span></span>

<span data-ttu-id="e35a0-118">Par exemple, Direct2D peut afficher un graphique d’effet comme suit :</span><span class="sxs-lookup"><span data-stu-id="e35a0-118">For example, Direct2D may render an effect graph as follows:</span></span>

![graphique d’effet avec des textures intermédiaires](images/precision-and-clipping-1.png)

<span data-ttu-id="e35a0-120">Direct2D recherche les opportunités de réduction du nombre de textures intermédiaires utilisées pour le rendu du graphique d’effet ; Cette logique est opaque pour les applications.</span><span class="sxs-lookup"><span data-stu-id="e35a0-120">Direct2D looks for opportunities to reduce the number intermediate textures used to render the effect graph; this logic is opaque to applications.</span></span> <span data-ttu-id="e35a0-121">Par exemple, le graphique suivant peut être rendu par Direct2D à l’aide d’un appel de dessin Direct3D et sans texture intermédiaire :</span><span class="sxs-lookup"><span data-stu-id="e35a0-121">For example, the following graph can be rendered by Direct2D using one Direct3D draw call and no intermediate textures:</span></span>

![graphique d’effet sans texture intermédiaire](images/precision-and-clipping-2.png)

<span data-ttu-id="e35a0-123">Avant Windows 10, Direct2D utilise toujours des textures intermédiaires si plusieurs nuanceurs de pixels ont été utilisés dans le même graphique d’effet.</span><span class="sxs-lookup"><span data-stu-id="e35a0-123">Prior to Windows 10, Direct2D would always use intermediate textures if multiple pixels shaders were used within the same effect graph.</span></span> <span data-ttu-id="e35a0-124">La plupart des effets intégrés qui ajustent simplement les valeurs de couleur (par exemple, luminosité ou saturation) utilisent les nuanceurs de pixels.</span><span class="sxs-lookup"><span data-stu-id="e35a0-124">Most built-in effects that simply adjust color values (for example, Brightness or Saturation) do so using pixel shaders.</span></span>

<span data-ttu-id="e35a0-125">Dans Windows 10, Direct2D peut désormais éviter d’utiliser des textures intermédiaires dans de tels cas.</span><span class="sxs-lookup"><span data-stu-id="e35a0-125">In Windows 10, Direct2D may now avoid using intermediate textures in such cases.</span></span> <span data-ttu-id="e35a0-126">Pour ce faire, il lie en interne les nuanceurs de pixels adjacents.</span><span class="sxs-lookup"><span data-stu-id="e35a0-126">It does this by internally linking adjacent pixel shaders.</span></span> <span data-ttu-id="e35a0-127">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="e35a0-127">For example:</span></span>

![graphique des effets Windows 10 avec plusieurs nuanceurs de pixels et aucune texture intermédiaire](images/precision-and-clipping-3.png)

<span data-ttu-id="e35a0-129">Notez que tous les nuanceurs de pixels adjacents dans un graphique ne peuvent pas être liés et, par conséquent, seuls certains graphiques produiront une sortie différente sur Windows 10.</span><span class="sxs-lookup"><span data-stu-id="e35a0-129">Note that not all adjacent pixel shaders in a graph may be linked together, and therefore only certain graphs will produce different output on Windows 10.</span></span> <span data-ttu-id="e35a0-130">Pour obtenir des informations complètes, consultez [liaison de nuanceur Effect](effect-shader-linking.md).</span><span class="sxs-lookup"><span data-stu-id="e35a0-130">For full details see [Effect Shader Linking](effect-shader-linking.md).</span></span> <span data-ttu-id="e35a0-131">Les restrictions principales sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="e35a0-131">The primary restrictions are:</span></span>

-   <span data-ttu-id="e35a0-132">Un effet ne sera pas lié à des effets qui consomment sa sortie, si le premier effet est connecté en tant qu’entrée à plusieurs effets.</span><span class="sxs-lookup"><span data-stu-id="e35a0-132">An effect will not be linked with effects consuming its output, if the first effect is connected as an input to multiple effects.</span></span>
-   <span data-ttu-id="e35a0-133">Un effet ne sera pas lié à un jeu d’effets comme entrée, si le premier effet échantillonne son entrée à une position logique différente de celle de sa sortie.</span><span class="sxs-lookup"><span data-stu-id="e35a0-133">An effect will not be linked with an effect set as its input, if the first effect samples its input at a different logical position than its output.</span></span> <span data-ttu-id="e35a0-134">Par exemple, un effet de matrice de couleurs peut être lié à son entrée, mais aucun effet de convolution n’est.</span><span class="sxs-lookup"><span data-stu-id="e35a0-134">For example, a Color Matrix effect might be linked with its input, but a Convolution effect will not be.</span></span>

## <a name="built-in-effect-behavior"></a><span data-ttu-id="e35a0-135">Comportement d’effet intégré</span><span class="sxs-lookup"><span data-stu-id="e35a0-135">Built-in effect behavior</span></span>

<span data-ttu-id="e35a0-136">De nombreux effets intégrés peuvent produire des couleurs en dehors de la \[ plage 0, 1 \] dans l’espace de couleurs unpremultiplied, même lorsque leurs couleurs d’entrée sont comprises dans cette plage.</span><span class="sxs-lookup"><span data-stu-id="e35a0-136">Many built-in effects may produce colors outside of the \[0, 1\] range in the unpremultiplied color space, even when their input colors are within that range.</span></span> <span data-ttu-id="e35a0-137">Dans ce cas, ces couleurs peuvent être sujettes à un découpage numérique.</span><span class="sxs-lookup"><span data-stu-id="e35a0-137">When this happens, such colors may be subject to numerical clipping.</span></span> <span data-ttu-id="e35a0-138">Notez qu’il est important de prendre en compte la plage de couleurs dans l’espace unpremultiplied, même si les effets intégrés produisent généralement des couleurs dans l’espace prémultiplié.</span><span class="sxs-lookup"><span data-stu-id="e35a0-138">Note that it’s important to consider the color range in unpremultiplied space, even though built-in effects typically produce colors in premultiplied space.</span></span> <span data-ttu-id="e35a0-139">Cela permet de s’assurer que les couleurs restent dans le même intervalle, même si d’autres effets les unpremultiply par la suite.</span><span class="sxs-lookup"><span data-stu-id="e35a0-139">This ensures that colors stay within range, even if other effects subsequently unpremultiply them.</span></span>

<span data-ttu-id="e35a0-140">Certains des effets qui peuvent émettre ces couleurs hors limites offrent une propriété « ClampOutput ».</span><span class="sxs-lookup"><span data-stu-id="e35a0-140">Some of the effects which may emit these out-of-range colors offer a “ClampOutput” property.</span></span> <span data-ttu-id="e35a0-141">Il s’agit, entre autres, des suivantes :</span><span class="sxs-lookup"><span data-stu-id="e35a0-141">These include:</span></span>

-   [<span data-ttu-id="e35a0-142">Matrice de couleurs</span><span class="sxs-lookup"><span data-stu-id="e35a0-142">Color Matrix</span></span>](color-matrix.md)
-   [<span data-ttu-id="e35a0-143">Composite arithmétique</span><span class="sxs-lookup"><span data-stu-id="e35a0-143">Arithmetic Composite</span></span>](arithmetic-composite.md)
-   [<span data-ttu-id="e35a0-144">Convolve</span><span class="sxs-lookup"><span data-stu-id="e35a0-144">Convolve</span></span>](convolve-matrix.md)
-   [<span data-ttu-id="e35a0-145">Effets de transfert</span><span class="sxs-lookup"><span data-stu-id="e35a0-145">Transfer effects</span></span>](built-in-effects.md)

<span data-ttu-id="e35a0-146">Si vous affectez la valeur TRUE à la propriété ClampOutput sur ces effets, vous obtiendrez un résultat cohérent, quels que soient les facteurs tels que la liaison de nuanceur.</span><span class="sxs-lookup"><span data-stu-id="e35a0-146">Setting the ClampOutput property to TRUE on these effects ensures a consistent result will be achieved regardless of factors such as shader linking.</span></span> <span data-ttu-id="e35a0-147">Notez que la fixation se produit dans l’espace unpremultiplied.</span><span class="sxs-lookup"><span data-stu-id="e35a0-147">Note that clamping occurs in unpremultiplied space.</span></span>

<span data-ttu-id="e35a0-148">D’autres effets intégrés peuvent également produire des couleurs de sortie au-delà \[ de la plage de 0, 1 \] dans l’espace unpremultiplied, même lorsque leurs couleurs de couleur (et les propriétés de « couleur » le cas échéant) sont comprises dans cette plage.</span><span class="sxs-lookup"><span data-stu-id="e35a0-148">Other built-in effects may also produce output colors beyond the \[0, 1\] range in unpremultiplied space, even when their colors pixels (and “Color” properties if any) are within that range.</span></span> <span data-ttu-id="e35a0-149">Il s’agit, entre autres, des suivantes :</span><span class="sxs-lookup"><span data-stu-id="e35a0-149">These include:</span></span>

-   <span data-ttu-id="e35a0-150">[Effets de transformation et de mise à l’échelle](built-in-effects.md) (lorsque la propriété Mode d’interpolation est cubique ou de qualité supérieure)</span><span class="sxs-lookup"><span data-stu-id="e35a0-150">[Transforming and Scaling effects](built-in-effects.md) (When the Interpolation Mode property is Cubic or High Quality Cubic)</span></span>
-   [<span data-ttu-id="e35a0-151">Effets d’éclairage</span><span class="sxs-lookup"><span data-stu-id="e35a0-151">Lighting effects</span></span>](built-in-effects.md)
-   <span data-ttu-id="e35a0-152">[Détection des bords](edge-detection-effect.md) (lorsque la propriété superposition des bords est vraie)</span><span class="sxs-lookup"><span data-stu-id="e35a0-152">[Edge detection](edge-detection-effect.md) (When the Overlay Edges property is TRUE)</span></span>
-   [<span data-ttu-id="e35a0-153">Vulnérabilité</span><span class="sxs-lookup"><span data-stu-id="e35a0-153">Exposure</span></span>](exposure-effect.md)
-   <span data-ttu-id="e35a0-154">[Composite](composite.md) (lorsque la propriété mode est plus)</span><span class="sxs-lookup"><span data-stu-id="e35a0-154">[Composite](composite.md) (When the Mode property is Plus)</span></span>
-   [<span data-ttu-id="e35a0-155">Température et teinte</span><span class="sxs-lookup"><span data-stu-id="e35a0-155">Temperature and Tint</span></span>](temperature-and-tint-effect.md)
-   [<span data-ttu-id="e35a0-156">Sépia :</span><span class="sxs-lookup"><span data-stu-id="e35a0-156">Sepia</span></span>](sepia-effect.md)
-   [<span data-ttu-id="e35a0-157">Saturation</span><span class="sxs-lookup"><span data-stu-id="e35a0-157">Saturation</span></span>](saturation.md)

## <a name="forcing-numerical-clipping-within-an-effect-graph"></a><span data-ttu-id="e35a0-158">Forçage du découpage numérique dans un graphique d’effet</span><span class="sxs-lookup"><span data-stu-id="e35a0-158">Forcing numerical clipping within an effect graph</span></span>

<span data-ttu-id="e35a0-159">Si vous utilisez des effets listés ci-dessus qui n’ont pas de propriété ClampOutput, les applications doivent envisager de forcer le verrouillage numérique.</span><span class="sxs-lookup"><span data-stu-id="e35a0-159">While using effects listed above which do not have a ClampOutput property, applications should consider forcing numerical clamping.</span></span> <span data-ttu-id="e35a0-160">Cela peut être fait en insérant un effet supplémentaire dans le graphique qui fixe ses pixels.</span><span class="sxs-lookup"><span data-stu-id="e35a0-160">This can be done by inserting an additional effect into the graph that clamps its pixels.</span></span> <span data-ttu-id="e35a0-161">Un effet de matrice de couleurs peut être utilisé, avec sa propriété « ClampOutput » définie sur TRUE et en laissant la propriété « ColorMatrix » comme valeur par défaut (transfert direct).</span><span class="sxs-lookup"><span data-stu-id="e35a0-161">A Color Matrix effect may be used, with its ‘ClampOutput’ property set to TRUE and leaving the ‘ColorMatrix’ property as the default (pass-through) value.</span></span>

<span data-ttu-id="e35a0-162">Une deuxième option pour obtenir des résultats cohérents consiste à demander que Direct2D utilise des textures intermédiaires de plus grande précision.</span><span class="sxs-lookup"><span data-stu-id="e35a0-162">A second option to achieve consistent results is to request that Direct2D use intermediate textures which have greater precision.</span></span> <span data-ttu-id="e35a0-163">Cela est décrit ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="e35a0-163">This is described below.</span></span>

## <a name="controlling-precision-of-intermediate-textures"></a><span data-ttu-id="e35a0-164">Contrôle de la précision des textures intermédiaires</span><span class="sxs-lookup"><span data-stu-id="e35a0-164">Controlling precision of intermediate textures</span></span>

<span data-ttu-id="e35a0-165">Direct2D offre plusieurs moyens de contrôler la précision d’un graphique.</span><span class="sxs-lookup"><span data-stu-id="e35a0-165">Direct2D provides a few ways to control the precision of a graph.</span></span> <span data-ttu-id="e35a0-166">Avant d’utiliser des formats de haute précision dans Direct2D, les applications doivent s’assurer qu’elles sont prises en charge de manière suffisante par le GPU.</span><span class="sxs-lookup"><span data-stu-id="e35a0-166">Before using high precision formats in Direct2D, applications must ensure they are supported sufficiently by the GPU.</span></span> <span data-ttu-id="e35a0-167">Pour vérifier cela, utilisez [**ID2D1DeviceContext :: IsBufferPrecisionSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isbufferprecisionsupported).</span><span class="sxs-lookup"><span data-stu-id="e35a0-167">To check this, use [**ID2D1DeviceContext::IsBufferPrecisionSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isbufferprecisionsupported).</span></span>

<span data-ttu-id="e35a0-168">Les applications peuvent créer un appareil Direct3D à l’aide de WARP (émulation de logiciel) pour garantir que toutes les précisions de mémoire tampon sont prises en charge indépendamment du matériel de GPU réel sur l’appareil.</span><span class="sxs-lookup"><span data-stu-id="e35a0-168">Applications may create a Direct3D device using WARP (software emulation) to guarantee that all buffer precisions are supported independent of the actual GPU hardware on the device.</span></span> <span data-ttu-id="e35a0-169">Cela est recommandé dans les scénarios tels que l’application d’effets à une photo lors de l’enregistrement sur disque.</span><span class="sxs-lookup"><span data-stu-id="e35a0-169">This is recommended in scenarios such as applying effects to a photo while saving to disk.</span></span> <span data-ttu-id="e35a0-170">Même si Direct2D prend en charge les formats de mémoire tampon de haute précision sur le GPU, l’utilisation de WARP est recommandée dans ce scénario sur les GPU de niveau de fonctionnalité 9. X, en raison de la précision limitée de l’arithmétique et de l’échantillonnage des nuanceurs sur des GPU mobiles de faible puissance.</span><span class="sxs-lookup"><span data-stu-id="e35a0-170">Even if Direct2D supports high precision buffer formats on the GPU, using WARP is recommended in this scenario on feature level 9.X GPUs, due to the limited precision of shader arithmetic and sampling on some low-power mobile GPUs.</span></span>

<span data-ttu-id="e35a0-171">Dans chaque cas ci-dessous, la précision demandée est en fait le Direct2D de précision minimal qui sera utilisé par.</span><span class="sxs-lookup"><span data-stu-id="e35a0-171">In each case below, the requested precision is actually the minimum precision Direct2D will use.</span></span> <span data-ttu-id="e35a0-172">Une précision supérieure peut être utilisée si les intermédiaires ne sont pas requis.</span><span class="sxs-lookup"><span data-stu-id="e35a0-172">Higher precision may be used if intermediates are not required.</span></span> <span data-ttu-id="e35a0-173">Direct2D peut également partager des textures intermédiaires pour différentes parties du même graphique ou des graphiques différents.</span><span class="sxs-lookup"><span data-stu-id="e35a0-173">Direct2D may also share intermediate textures for different parts of the same graph or different graphs entirely.</span></span> <span data-ttu-id="e35a0-174">Dans ce cas, Direct2D utilise la précision maximale demandée pour toutes les opérations impliquées.</span><span class="sxs-lookup"><span data-stu-id="e35a0-174">In this case Direct2D uses the maximum precision requested for all involved operations.</span></span>

### <a name="precision-selection-from-id2d1devicecontextsetrenderingcontrols"></a><span data-ttu-id="e35a0-175">Sélection de précision dans ID2D1DeviceContext :: SetRenderingControls</span><span class="sxs-lookup"><span data-stu-id="e35a0-175">Precision selection from ID2D1DeviceContext::SetRenderingControls</span></span>

<span data-ttu-id="e35a0-176">La façon la plus simple de contrôler la précision des textures intermédiaires Direct2d consiste à utiliser [**ID2D1DeviceContext :: SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)).</span><span class="sxs-lookup"><span data-stu-id="e35a0-176">The simplest way to control the precision of Direct2D’s intermediate textures is to use [**ID2D1DeviceContext::SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)).</span></span> <span data-ttu-id="e35a0-177">Cela contrôle la précision de toutes les textures intermédiaires, tant qu’une précision n’est pas également définie manuellement sur des effets ou des transformations directement.</span><span class="sxs-lookup"><span data-stu-id="e35a0-177">This controls the precision of all intermediate textures, as long as a precision is not also set manually on effects or transforms directly.</span></span>


```cpp
if (Device->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  // Get the current rendering controls
  D2D1_RENDERING_CONTROLS renderingControls = {};
  Context->GetRenderingControls(&renderingControls);

  // Switch the precision within the rendering controls and set it
  renderingControls.bufferPrecision = D2D1_BUFFER_PRECISION_32BPC_FLOAT;
  Context->SetRenderingControls(&renderingControls);
}
              
```



### <a name="precision-selection-from-inputs-and-render-targets"></a><span data-ttu-id="e35a0-178">Sélection de la précision à partir des entrées et des cibles de rendu</span><span class="sxs-lookup"><span data-stu-id="e35a0-178">Precision selection from inputs and render targets</span></span>

<span data-ttu-id="e35a0-179">Les applications peuvent également reposer sur la précision des entrées sur un graphique d’effet pour contrôler la précision des textures intermédiaires.</span><span class="sxs-lookup"><span data-stu-id="e35a0-179">Applications may also rely on the precision of the inputs to an effect graph to control the precision of intermediate textures.</span></span> <span data-ttu-id="e35a0-180">Cela est vrai tant qu’une précision de mémoire tampon n’est pas spécifiée à l’aide de [**ID2D1DeviceContext :: SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls))et n’est pas définie manuellement sur Effects et Transform directement.</span><span class="sxs-lookup"><span data-stu-id="e35a0-180">This is true as long as a buffer precision is not specified using [**ID2D1DeviceContext::SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)), and is not set manually on effects and transform directly.</span></span>

<span data-ttu-id="e35a0-181">Les précisions des entrées pour les effets sont propagées par le biais du graphique pour sélectionner la précision des intermédiaires en aval.</span><span class="sxs-lookup"><span data-stu-id="e35a0-181">The precisions of inputs to effects are propagated through the graph to select the precision of downstream intermediates.</span></span> <span data-ttu-id="e35a0-182">Là où les différentes branches dans le graphique d’effet rencontrent, la plus grande précision d’une entrée est utilisée.</span><span class="sxs-lookup"><span data-stu-id="e35a0-182">Where different branches in the effect graph meet, the greatest precision of any input is used.</span></span>

<span data-ttu-id="e35a0-183">La précision sélectionnée en fonction d’une bitmap Direct2D est déterminée à partir de son format de pixel.</span><span class="sxs-lookup"><span data-stu-id="e35a0-183">The precision selected based on a Direct2D bitmap is determined from its pixel format.</span></span> <span data-ttu-id="e35a0-184">La précision sélectionnée pour un [**ID2D1ImageSource**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesource) est déterminée à partir du format de pixel WIC du IWICBitmapSource sous-jacent utilisé pour créer le **ID2D1ImageSource**.</span><span class="sxs-lookup"><span data-stu-id="e35a0-184">The precision selected for an [**ID2D1ImageSource**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesource) is determined from the WIC pixel format of the underlying IWICBitmapSource used to create the **ID2D1ImageSource**.</span></span> <span data-ttu-id="e35a0-185">Notez que Direct2D n’autorise pas la création de sources d’images avec des sources WIC utilisant des précisions non prises en charge par Direct2D et le GPU.</span><span class="sxs-lookup"><span data-stu-id="e35a0-185">Note that Direct2D doesn’t allow image sources to be created with WIC sources using precisions unsupported by Direct2D and the GPU.</span></span>

<span data-ttu-id="e35a0-186">Il est possible que Direct2D ne puisse pas assigner un effet à une précision en fonction de ses entrées.</span><span class="sxs-lookup"><span data-stu-id="e35a0-186">It is possible that Direct2D cannot assign an effect a precision based on its inputs.</span></span> <span data-ttu-id="e35a0-187">Cela se produit lorsqu’un effet n’a pas d’entrée, ou lorsqu’un [**ID2D1CommandList**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1commandlist) est utilisé, ce qui n’a pas de précision spécifique.</span><span class="sxs-lookup"><span data-stu-id="e35a0-187">This happens when an effect has no inputs, or when an [**ID2D1CommandList**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1commandlist) is used, which has no specific precision.</span></span> <span data-ttu-id="e35a0-188">Dans ce cas, la précision des textures intermédiaires est déterminée à partir de l’image bitmap définie en tant que cible de rendu actuelle du contexte.</span><span class="sxs-lookup"><span data-stu-id="e35a0-188">In this case, the precision of intermediate textures is determined from the bitmap set as the context’s current render target.</span></span>

### <a name="precision-selection-directly-on-the-effect-and-transforms"></a><span data-ttu-id="e35a0-189">Sélection de la précision directement sur l’effet et les transformations</span><span class="sxs-lookup"><span data-stu-id="e35a0-189">Precision selection directly on the effect and transforms</span></span>

<span data-ttu-id="e35a0-190">La précision minimale pour les textures intermédiaires peut également être définie à des emplacements explicites dans un graphique d’effet.</span><span class="sxs-lookup"><span data-stu-id="e35a0-190">The minimum precision for intermediate textures may also be set at explicit locations within an effect graph.</span></span> <span data-ttu-id="e35a0-191">Cela est recommandé uniquement pour les scénarios avancés.</span><span class="sxs-lookup"><span data-stu-id="e35a0-191">This is only recommended for advanced scenarios.</span></span>

<span data-ttu-id="e35a0-192">La précision minimale peut être définie à l’aide d’une propriété sur un effet comme suit :</span><span class="sxs-lookup"><span data-stu-id="e35a0-192">The minimum precision may be set using a property on an effect as follows:</span></span>


```cpp
if (Device->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  hr = Effect->SetValue(D2D1_PROPERTY_PRECISION, D2D1_BUFFER_PRECISION_32BPC_FLOAT);
}
              
```



<span data-ttu-id="e35a0-193">Dans une implémentation Effect, la précision minimale peut être définie à l’aide de ID2D1RenderInfo :: SetOutputPrecision, comme suit :</span><span class="sxs-lookup"><span data-stu-id="e35a0-193">Within an effect implementation, the minimum precision may be set using ID2D1RenderInfo::SetOutputPrecision as follows:</span></span>


```cpp
if (EffectContext->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  hr = RenderInfo->SetOutputBuffer(
  D2D1_BUFFER_PRECISION_32BPC_FLOAT,
  D2D1_CHANNEL_DEPTH_4);
}
              
```



<span data-ttu-id="e35a0-194">Notez que la précision définie sur un effet se propage aux effets en aval dans le même graphique d’effet, sauf si une précision différente est définie sur ces effets en aval.</span><span class="sxs-lookup"><span data-stu-id="e35a0-194">Note that the precision set on an effect will propagate to downstream effects in the same effect graph, unless a different precision is set on those downstream effects.</span></span> <span data-ttu-id="e35a0-195">La précision définie sur une transformation à l’intérieur d’un effet n’affecte pas la précision des nœuds de transformation en aval.</span><span class="sxs-lookup"><span data-stu-id="e35a0-195">The precision set on a transform within an effect does not affect the precision for downstream transform nodes.</span></span>

<span data-ttu-id="e35a0-196">Voici la logique récursive complète utilisée pour déterminer la précision minimale pour une mémoire tampon intermédiaire qui stocke la sortie d’un nœud de transformation donné :</span><span class="sxs-lookup"><span data-stu-id="e35a0-196">Below is the full recursive logic used to determine the minimum precision for an intermediate buffer storing the output of a given transform node:</span></span>

![Logique de précision minimale de la mémoire tampon intermédiaire](images/precision-and-clipping-4.png)

 

 