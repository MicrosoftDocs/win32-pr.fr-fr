---
title: Applications Direct2D multithread
description: Décrit les meilleures pratiques pour créer des applications Direct2D multithread.
ms.assetid: FDD770D4-817F-44D9-86C4-15DD04D214AE
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6be979b867edd6d36583959c4a595dbd507ca94f
ms.sourcegitcommit: c3243ec4ada05b7faf9d563853cb667ecef825e8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/03/2020
ms.locfileid: "103734789"
---
# <a name="multithreaded-direct2d-apps"></a><span data-ttu-id="a2953-103">Applications Direct2D multithread</span><span class="sxs-lookup"><span data-stu-id="a2953-103">Multithreaded Direct2D Apps</span></span>

<span data-ttu-id="a2953-104">Si vous développez des applications [Direct2D](./direct2d-portal.md) , vous devrez peut-être accéder aux ressources Direct2D à partir de plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="a2953-104">If you develop [Direct2D](./direct2d-portal.md) apps, you may need to access Direct2D resources from more than one thread.</span></span> <span data-ttu-id="a2953-105">Dans d’autres cas, vous pouvez utiliser le multithreading pour obtenir de meilleures performances ou une meilleure réactivité (comme l’utilisation d’un thread pour l’affichage à l’écran et d’un thread distinct pour le rendu hors connexion).</span><span class="sxs-lookup"><span data-stu-id="a2953-105">In other cases, you may want to use multi-threading to get better performance or better responsiveness (like using one thread for screen display and a separate thread for offline rendering).</span></span>

<span data-ttu-id="a2953-106">Cette rubrique décrit les meilleures pratiques pour le développement d’applications [Direct2D](./direct2d-portal.md) multithread avec peu ou pas de rendu [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) .</span><span class="sxs-lookup"><span data-stu-id="a2953-106">This topic describes the best practices for developing multithreaded [Direct2D](./direct2d-portal.md) apps with little to no [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) rendering.</span></span> <span data-ttu-id="a2953-107">Les défaillances logicielles causées par des problèmes d’accès concurrentiel peuvent être difficiles à détecter et il est utile de planifier votre stratégie de multithreading et de suivre les meilleures pratiques décrites ici.</span><span class="sxs-lookup"><span data-stu-id="a2953-107">Software defects caused by concurrency issues can be difficult to track down, and it is helpful to plan your multithreading policy and to follow the best practices described here.</span></span>

> [!Note]  
> <span data-ttu-id="a2953-108">Si vous accédez à deux ressources [Direct2D](./direct2d-portal.md) créées à partir de deux fabriques Direct2D à thread unique différentes, elles ne provoquent pas de conflits d’accès tant que les périphériques [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) sous-jacents et les contextes de périphérique sont également distincts.</span><span class="sxs-lookup"><span data-stu-id="a2953-108">If you access two [Direct2D](./direct2d-portal.md) resources created from two different single threaded Direct2D factories it doesn't cause access conflicts as long as the underlying [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) devices and device contexts are also distinct.</span></span> <span data-ttu-id="a2953-109">Lorsque l’on parle de « l’accès aux ressources Direct2D » dans cet article, cela signifie vraiment « l’accès aux ressources Direct2D créées à partir du même appareil Direct2D », sauf indication contraire.</span><span class="sxs-lookup"><span data-stu-id="a2953-109">When talking about "accessing Direct2D resources" in this article, it really means "accessing Direct2D resources created from the same Direct2D Device" unless stated otherwise.</span></span>

## <a name="developing-thread-safe-apps-that-call-only-direct2d-apis"></a><span data-ttu-id="a2953-110">Développement d’applications Thread-Safe qui appellent uniquement des API Direct2D</span><span class="sxs-lookup"><span data-stu-id="a2953-110">Developing Thread-Safe Apps that Call Only Direct2D APIs</span></span>

<span data-ttu-id="a2953-111">Vous pouvez créer une instance de fabrique [Direct2D](./direct2d-portal.md) multithread.</span><span class="sxs-lookup"><span data-stu-id="a2953-111">You can create a multithreaded [Direct2D](./direct2d-portal.md) factory instance.</span></span> <span data-ttu-id="a2953-112">Vous pouvez utiliser et partager une fabrique multithread et toutes ses ressources à partir de plusieurs threads, mais les accès à ces ressources (via les appels Direct2D) sont sérialisés par Direct2D, de sorte qu’aucun conflit d’accès ne se produit.</span><span class="sxs-lookup"><span data-stu-id="a2953-112">You can use and share a multithreaded factory and all its resources from more than one thread, but accesses to those resources (via Direct2D calls) are serialized by Direct2D, so no access conflicts occur.</span></span> <span data-ttu-id="a2953-113">Si votre application appelle uniquement des API Direct2D, cette protection est automatiquement effectuée par Direct2D à un niveau granulaire avec une surcharge minimale.</span><span class="sxs-lookup"><span data-stu-id="a2953-113">If your app calls only Direct2D APIs, such protection is automatically done by Direct2D in a granular level with minimum overhead.</span></span> <span data-ttu-id="a2953-114">Code permettant de créer une fabrique multithread ici.</span><span class="sxs-lookup"><span data-stu-id="a2953-114">The code to create a multithreaded factory here.</span></span>

```cpp
ID2D1Factory* m_D2DFactory;

// Create a Direct2D factory.
HRESULT hr = D2D1CreateFactory(
    D2D1_FACTORY_TYPE_MULTI_THREADED,
    &m_D2DFactory
);
```

<span data-ttu-id="a2953-115">L’image ici montre comment [Direct2D](./direct2d-portal.md) sérialise deux threads qui effectuent des appels à l’aide de l’API Direct2D uniquement.</span><span class="sxs-lookup"><span data-stu-id="a2953-115">The image here shows how [Direct2D](./direct2d-portal.md) serializes two threads that make calls using only the Direct2D API.</span></span>

![diagramme de deux threads sérialisés.](images/multi-thread.png)

## <a name="developing-thread-safe-direct2d-apps-with-minimal-direct3d-or-dxgi-calls"></a><span data-ttu-id="a2953-117">Développement d’applications Thread-Safe Direct2D avec des appels Direct3D ou DXGI minimes</span><span class="sxs-lookup"><span data-stu-id="a2953-117">Developing Thread-Safe Direct2D Apps with minimal Direct3D or DXGI Calls</span></span>

<span data-ttu-id="a2953-118">Il est fréquent qu’une application [Direct2D](./direct2d-portal.md) effectue également des appels [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) ou DXGI.</span><span class="sxs-lookup"><span data-stu-id="a2953-118">It is more than often that a [Direct2D](./direct2d-portal.md) app also makes some [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls.</span></span> <span data-ttu-id="a2953-119">Par exemple, un thread d’affichage est dessiné dans Direct2D, puis est présent à l’aide d’une [**chaîne de permutation dxgi**](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain).</span><span class="sxs-lookup"><span data-stu-id="a2953-119">For example, a display thread will draw in Direct2D then present using a [**DXGI swap chain**](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain).</span></span>

<span data-ttu-id="a2953-120">Dans ce cas, garantir la sécurité des threads est plus complexe : certains appels [Direct2D](./direct2d-portal.md) accèdent indirectement aux ressources [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) sous-jacentes, qui peuvent être accessibles simultanément par un autre thread qui appelle Direct3D ou DXGI.</span><span class="sxs-lookup"><span data-stu-id="a2953-120">In this case, assuring thread-safety is more complicated: some [Direct2D](./direct2d-portal.md) calls indirectly access the underlying [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) resources, which might be simultaneously accessed by another thread which calls Direct3D or DXGI.</span></span> <span data-ttu-id="a2953-121">Étant donné que ces appels Direct3D ou DXGI n’ont pas conscience de la Direct2d et du contrôle, vous devez créer une fabrique Direct2D multithread, mais vous devez effectuer des responsable Mor ajoutera pour éviter les conflits d’accès.</span><span class="sxs-lookup"><span data-stu-id="a2953-121">Since those Direct3D or DXGI calls are out of Direct2D’s awareness and control, you need to create a multithreaded Direct2D factory, but you must do mor to avoid access conflicts.</span></span>

<span data-ttu-id="a2953-122">Le diagramme ci-dessous montre un conflit d’accès aux ressources [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) en raison du thread T0 qui accède indirectement à une ressource via un appel [Direct2D](./direct2d-portal.md) et T2 qui accède à la même ressource directement via un appel Direct3D ou DXGI.</span><span class="sxs-lookup"><span data-stu-id="a2953-122">The diagram here shows a [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) resource access conflict due to thread T0 accessing a resource indirectly via a [Direct2D](./direct2d-portal.md) call and T2 accessing the same resource directly via a Direct3D or DXGI call.</span></span>

> [!Note]  
> <span data-ttu-id="a2953-123">La protection des threads fournie par [Direct2D](./direct2d-portal.md) (le verrou bleu dans cette image) n’est pas utile dans ce cas.</span><span class="sxs-lookup"><span data-stu-id="a2953-123">The thread protection that [Direct2D](./direct2d-portal.md) provides (the blue lock in this image) doesn't help in this case.</span></span>

 

![diagramme de protection des threads.](images/multi-thread2.png)

<span data-ttu-id="a2953-125">Pour éviter les conflits d’accès aux ressources ici, nous vous recommandons d’acquérir explicitement le verrou utilisé par [Direct2D](./direct2d-portal.md) pour la synchronisation d’accès interne, et d’appliquer ce verrou quand un thread doit effectuer des appels [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) ou dxgi susceptibles de provoquer un conflit d’accès comme indiqué ici.</span><span class="sxs-lookup"><span data-stu-id="a2953-125">To avoid resource access conflict here, we recommend you explicitly acquire the lock that [Direct2D](./direct2d-portal.md) uses for internal access synchronization, and apply that lock when a thread needs to make [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls that might cause access conflict as shown here.</span></span> <span data-ttu-id="a2953-126">En particulier, vous devez être particulièrement vigilant avec le code qui utilise des exceptions ou un système précoce en fonction des codes de retour HRESULT.</span><span class="sxs-lookup"><span data-stu-id="a2953-126">In particular, you should take special care with code that uses exceptions or an early out system based on HRESULT return codes.</span></span> <span data-ttu-id="a2953-127">Pour cette raison, nous vous recommandons d’utiliser un modèle RAII (Resource Acquisition Is Initialization) pour appeler les méthodes [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) et [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) .</span><span class="sxs-lookup"><span data-stu-id="a2953-127">For this reason, we recommend you use an RAII (Resource Acquisition Is Initialization) pattern to call the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods.</span></span>

> [!Note]  
> <span data-ttu-id="a2953-128">Il est important de coupler les appels aux méthodes [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) et [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) , sinon votre application peut se bloquer.</span><span class="sxs-lookup"><span data-stu-id="a2953-128">It is important that you pair up calls to the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods, otherwise your app can deadlock.</span></span>

 

<span data-ttu-id="a2953-129">Le code ci-dessous montre un exemple de verrouillage, puis déverrouillage autour des appels [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) ou DXGI.</span><span class="sxs-lookup"><span data-stu-id="a2953-129">The code here shows an example of when to lock and then and unlock around [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls.</span></span>


```C++
void MyApp::DrawFromThread2()
{
    // We are accessing Direct3D resources directly without Direct2D's knowledge, so we
    // must manually acquire and apply the Direct2D factory lock.
    ID2D1Multithread* m_D2DMultithread;
    m_D2DFactory->QueryInterface(IID_PPV_ARGS(&m_D2DMultithread));
    m_D2DMultithread->Enter();
    
    // Now it is safe to make Direct3D/DXGI calls, such as IDXGISwapChain::Present
    MakeDirect3DCalls();

    // It is absolutely critical that the factory lock be released upon
    // exiting this function, or else any consequent Direct2D calls will be blocked.
    m_D2DMultithread->Leave();
}
```



> [!Note]  
> <span data-ttu-id="a2953-130">Certains appels [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) ou dxgi (notamment [**IDXGISwapChain ::P**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present)renouvely) peuvent acquérir des verrous et/ou déclencher des rappels dans le code de la fonction ou de la méthode appelante.</span><span class="sxs-lookup"><span data-stu-id="a2953-130">Some [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls (notably [**IDXGISwapChain::Present**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present)) may acquire locks and/or trigger callbacks into the code of the calling function or method.</span></span> <span data-ttu-id="a2953-131">Vous devez être conscient de cela et vous assurer que ce comportement ne provoque pas de blocages.</span><span class="sxs-lookup"><span data-stu-id="a2953-131">You should be aware of this and make sure that such behavior doesn't cause deadlocks.</span></span> <span data-ttu-id="a2953-132">Pour plus d’informations, consultez la rubrique [vue d’ensemble de dxgi](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi) .</span><span class="sxs-lookup"><span data-stu-id="a2953-132">For more info, see the [DXGI Overview](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi) topic.</span></span>

 

![diagramme de verrouillage de threads Direct2D et Direct3D.](images/multi-thread3.png)

<span data-ttu-id="a2953-134">Lorsque vous utilisez les méthodes [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) et [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) , les appels sont protégés par le [Direct2D](./direct2d-portal.md) automatique et le verrou explicite, de sorte que l’application n’atteint pas le conflit d’accès.</span><span class="sxs-lookup"><span data-stu-id="a2953-134">When you use the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods, the calls are protected by the automatic [Direct2D](./direct2d-portal.md) and the explicit lock, so the app doesn't hit access conflict.</span></span>

<span data-ttu-id="a2953-135">Il existe d’autres approches pour contourner ce problème.</span><span class="sxs-lookup"><span data-stu-id="a2953-135">There are other approaches to work around this issue.</span></span> <span data-ttu-id="a2953-136">Toutefois, nous vous recommandons de protéger explicitement les appels [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) ou dxgi avec le verrou [Direct2D](./direct2d-portal.md) , car il offre généralement de meilleures performances, car il protège la concurrence à un niveau nettement plus fin et avec une surcharge inférieure sous Direct2D cover.</span><span class="sxs-lookup"><span data-stu-id="a2953-136">However, we recommend you explicitly guard [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls with the [Direct2D](./direct2d-portal.md) lock because it usually provides better performance as it protects concurrency at a much finer level and with lower overhead under Direct2D’s cover.</span></span>

## <a name="ensuring-atomicity-of-stateful-operations"></a><span data-ttu-id="a2953-137">Garantir l’atomicité des opérations avec état</span><span class="sxs-lookup"><span data-stu-id="a2953-137">Ensuring Atomicity of Stateful Operations</span></span>

<span data-ttu-id="a2953-138">Bien que les fonctionnalités de sécurité des threads de [DirectX](/previous-versions//ee663301(v=vs.85)) permettent de garantir que deux appels d’API individuels ne sont pas effectués simultanément, vous devez également vous assurer que les threads qui effectuent des appels d’API avec état n’interfèrent pas entre eux.</span><span class="sxs-lookup"><span data-stu-id="a2953-138">While thread-safety features of [DirectX](/previous-versions//ee663301(v=vs.85)) can help ensure that no two individual API calls are made concurrently, you must also ensure that threads that make stateful API calls don't interfere with each other.</span></span> <span data-ttu-id="a2953-139">Voici un exemple.</span><span class="sxs-lookup"><span data-stu-id="a2953-139">Here is an example.</span></span>

1.  <span data-ttu-id="a2953-140">Il y a deux lignes de texte que vous souhaitez afficher à la fois sur l’écran (par thread 0) et hors écran (par thread 1) : \# la ligne 1 est « un est plus élevé » et la ligne \# 2 est « à B », qui seront dessinées à l’aide d’un pinceau noir Uni.</span><span class="sxs-lookup"><span data-stu-id="a2953-140">There are two lines of text that you want to render to both on-screen (by Thread 0) and off-screen (by Thread 1): Line \#1 is "A is greater" and Line \#2 is "than B", both of which will be drawn using a solid black brush.</span></span>
2.  <span data-ttu-id="a2953-141">Le thread 1 dessine la première ligne de texte.</span><span class="sxs-lookup"><span data-stu-id="a2953-141">Thread 1 draws the first line of text.</span></span>
3.  <span data-ttu-id="a2953-142">Le thread 0 réagit à une entrée utilisateur, met à jour les deux lignes de texte en « B est plus petit » et « supérieur à », puis modifie la couleur du pinceau en rouge plein pour son propre dessin.</span><span class="sxs-lookup"><span data-stu-id="a2953-142">Thread 0 reacts to a user input, updates both text lines to "B is smaller" and "than A" respectively, and changed the brush color to solid red for its own drawing;</span></span>
4.  <span data-ttu-id="a2953-143">Le thread 1 continue à dessiner la deuxième ligne de texte, qui est maintenant « à un », avec le pinceau de couleur rouge ;</span><span class="sxs-lookup"><span data-stu-id="a2953-143">Thread 1 continues drawing the second line of text, which is now "than A", with the red color brush;</span></span>
5.  <span data-ttu-id="a2953-144">Enfin, nous obtenons deux lignes de texte sur la cible de dessin hors écran : « A est plus grand » en noir et « que A » en rouge.</span><span class="sxs-lookup"><span data-stu-id="a2953-144">Finally, we get two lines of text on the off-screen drawing target: "A is greater" in black and "than A" in red.</span></span>

![diagramme des threads d’écran activés et désactivés.](images/multi-thread4.png)

<span data-ttu-id="a2953-146">Dans la ligne supérieure, le thread 0 est dessiné avec les chaînes de texte actuelles et le pinceau noir actuel.</span><span class="sxs-lookup"><span data-stu-id="a2953-146">In the top row, Thread 0 draws with current text strings and the current black brush.</span></span> <span data-ttu-id="a2953-147">Thread 1 se termine uniquement par le dessin hors écran sur la moitié supérieure.</span><span class="sxs-lookup"><span data-stu-id="a2953-147">Thread 1 only finishes off-screen drawing on the top half.</span></span>

<span data-ttu-id="a2953-148">Dans la ligne du milieu, le thread 0 répond à l’interaction de l’utilisateur, met à jour les chaînes de texte et le pinceau, puis actualise l’écran.</span><span class="sxs-lookup"><span data-stu-id="a2953-148">In the middle row, Thread 0 responds to user interaction, updates the text strings and the brush, then refreshes the screen.</span></span> <span data-ttu-id="a2953-149">À ce stade, thread 1 est bloqué.</span><span class="sxs-lookup"><span data-stu-id="a2953-149">At this point, Thread 1 is blocked.</span></span> <span data-ttu-id="a2953-150">Dans la ligne inférieure, le rendu final hors écran après le thread 1 reprend le dessin de la moitié inférieure avec un pinceau modifié et une chaîne de texte modifiée.</span><span class="sxs-lookup"><span data-stu-id="a2953-150">In the bottom row, the final off-screen rendering after Thread 1 resumes drawing the bottom half with an altered brush and an altered text string.</span></span>

<span data-ttu-id="a2953-151">Pour résoudre ce problème, nous vous recommandons d’avoir un contexte distinct pour chaque thread, de sorte que :</span><span class="sxs-lookup"><span data-stu-id="a2953-151">To address this issue, we recommend you have a separate context for each thread, so that:</span></span>

-   <span data-ttu-id="a2953-152">Vous devez créer une copie du contexte de périphérique afin que les ressources mutables (c’est-à-dire les ressources qui peuvent varier au cours de l’affichage ou de l’impression, telles que le contenu texte ou le pinceau de couleur unie dans l’exemple) ne changent pas lors du rendu.</span><span class="sxs-lookup"><span data-stu-id="a2953-152">You should create a copy of the device context so that mutable resources (i.e. resources that may vary during display or printing, such as text contents or the solid color brush in the example) don't change when you render.</span></span> <span data-ttu-id="a2953-153">Dans cet exemple, vous devez conserver une copie de ces deux lignes de texte et du pinceau de couleur avant de dessiner.</span><span class="sxs-lookup"><span data-stu-id="a2953-153">In this sample, you should maintain a copy of those two lines of texts and the color brush before you draw.</span></span> <span data-ttu-id="a2953-154">En procédant ainsi, vous garantissez que chaque thread dispose d’un contenu complet et cohérent à dessiner et à présenter.</span><span class="sxs-lookup"><span data-stu-id="a2953-154">By doing so, you guarantee each thread has complete and consistent content to draw and present.</span></span>
-   <span data-ttu-id="a2953-155">Vous devez partager des ressources à poids élevé (telles que des bitmaps et des graphiques d’effets complexes) qui sont initialisées une seule fois, puis jamais modifiées sur les threads pour améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="a2953-155">You should share heavy-weight resources (like bitmaps and complex effect graphs) that are initialized once and then never modified across threads to increase performance.</span></span>
-   <span data-ttu-id="a2953-156">Vous pouvez partager des ressources légères (telles que des pinceaux de couleur unie et des formats de texte) qui sont initialisés une seule fois et qui ne sont jamais modifiés à travers les threads.</span><span class="sxs-lookup"><span data-stu-id="a2953-156">You can either share light-weight resources (like solid color brushes and text formats) that are initialized once and then never modified across threads or not</span></span>

## <a name="summary"></a><span data-ttu-id="a2953-157">Résumé</span><span class="sxs-lookup"><span data-stu-id="a2953-157">Summary</span></span>

<span data-ttu-id="a2953-158">Lorsque vous développez des applications [Direct2D](./direct2d-portal.md) multithread, vous devez créer une fabrique Direct2D multithread, puis dériver toutes les ressources Direct2D de cette fabrique.</span><span class="sxs-lookup"><span data-stu-id="a2953-158">When you develop multithreaded [Direct2D](./direct2d-portal.md) apps, you must create a multithreaded Direct2D factory then derive all Direct2D resources from that factory.</span></span> <span data-ttu-id="a2953-159">Si un thread effectue des appels [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) ou dxgi, vous devez également l’acquérir explicitement, puis appliquer le verrou Direct2D pour assurer la protection de ces appels Direct3D ou DXGI.</span><span class="sxs-lookup"><span data-stu-id="a2953-159">If a thread will make [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls, you also must explicitly acquire then apply the Direct2D lock to guard those Direct3D or DXGI calls.</span></span> <span data-ttu-id="a2953-160">En outre, vous devez garantir l’intégrité du contexte en utilisant une copie de ressources mutables pour chaque thread.</span><span class="sxs-lookup"><span data-stu-id="a2953-160">Moreover, you must ensure context integrity by having a copy of mutable resources for each thread.</span></span>
