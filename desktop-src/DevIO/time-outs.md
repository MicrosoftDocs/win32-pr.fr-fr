---
description: Un handle vers une ressource de communication est associé à un ensemble de paramètres de délai d’attente qui affectent le comportement des opérations de lecture et d’écriture.
ms.assetid: 271d4c68-1f6d-4483-a9a1-703220de761f
title: Délais d'expiration
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6db31fafc0f4d98832f1fb7fa5d22b32cba33d73
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103748333"
---
# <a name="time-outs"></a><span data-ttu-id="1ebb2-103">Délais d'expiration</span><span class="sxs-lookup"><span data-stu-id="1ebb2-103">Time-Outs</span></span>

<span data-ttu-id="1ebb2-104">Un handle vers une ressource de communication est associé à un ensemble de paramètres de délai d’attente qui affectent le comportement des opérations de lecture et d’écriture.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-104">A handle to a communications resource has an associated set of time-out parameters that affect the behavior of read and write operations.</span></span> <span data-ttu-id="1ebb2-105">Les délais d’attente peuvent entraîner la conclusion d’une opération [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile)ou [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) lorsqu’un intervalle de délai d’attente arrive à expiration, même si le nombre spécifié de caractères n’a pas été lu ou écrit.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-105">Time-outs can cause a [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), or [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) operation to conclude when a time-out interval elapses, even though the specified number of characters have not been read or written.</span></span> <span data-ttu-id="1ebb2-106">Elle n’est pas traitée comme une erreur lorsqu’un délai d’attente se produit pendant une opération de lecture ou d’écriture (autrement dit, la valeur de retour de la fonction de lecture ou d’écriture indique une réussite).</span><span class="sxs-lookup"><span data-stu-id="1ebb2-106">It is not treated as an error when a time-out occurs during a read or write operation (that is, the read or write function's return value indicates success).</span></span> <span data-ttu-id="1ebb2-107">Le nombre d’octets lus ou écrits est signalé par **ReadFile** ou **WriteFile** (ou par la fonction [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) ou [**FileIOCompletionRoutine**](/windows/desktop/api/minwinbase/nc-minwinbase-lpoverlapped_completion_routine) , si l’e/s a été effectuée comme une opération avec chevauchement).</span><span class="sxs-lookup"><span data-stu-id="1ebb2-107">The count of bytes actually read or written is reported by **ReadFile** or **WriteFile** (or by the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**FileIOCompletionRoutine**](/windows/desktop/api/minwinbase/nc-minwinbase-lpoverlapped_completion_routine) function, if the I/O was performed as an overlapped operation).</span></span>

<span data-ttu-id="1ebb2-108">Lorsqu’une application ouvre une ressource de communication, le système définit les valeurs de délai d’attente de la ressource en vigueur lors de la dernière utilisation de la ressource.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-108">When an application opens a communications resource, the system sets the resource's time-out values to the values in effect when the resource was last used.</span></span> <span data-ttu-id="1ebb2-109">Si la ressource de communication n’a jamais été ouverte, le système définit les valeurs de délai d’attente sur une valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-109">If the communications resource has never been opened, the system sets the time-out values to some default value.</span></span> <span data-ttu-id="1ebb2-110">Dans les deux cas, une application doit toujours déterminer les valeurs de délai d’attente actuelles après avoir ouvert la ressource, puis les définir explicitement pour répondre à ses exigences.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-110">In either case, an application should always determine the current time-out values after opening the resource, and then explicitly set them to meet its requirements.</span></span> <span data-ttu-id="1ebb2-111">Pour déterminer les valeurs de délai d’attente actuelles d’une ressource de communication, utilisez la fonction [**GetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) .</span><span class="sxs-lookup"><span data-stu-id="1ebb2-111">To determine the current time-out values of a communications resource, use the [**GetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) function.</span></span> <span data-ttu-id="1ebb2-112">Pour modifier les valeurs de délai d’attente, utilisez la fonction [**SetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) .</span><span class="sxs-lookup"><span data-stu-id="1ebb2-112">To change the time-out values, use the [**SetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) function.</span></span>

<span data-ttu-id="1ebb2-113">Deux types de délais d’expiration sont activés par les paramètres de délai d’attente.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-113">Two types of time-outs are enabled by the time-out parameters.</span></span> <span data-ttu-id="1ebb2-114">Un délai d’expiration de l’intervalle se produit lorsque la durée entre deux caractères au maximum est supérieure à un nombre spécifié de millisecondes.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-114">An interval time-out occurs when the time between the receipt of any two characters exceeds a specified number of milliseconds.</span></span> <span data-ttu-id="1ebb2-115">Le minutage commence lorsque le premier caractère est reçu et est redémarré à la réception de chaque nouveau caractère.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-115">Timing starts when the first character is received and is restarted when each new character is received.</span></span> <span data-ttu-id="1ebb2-116">Un délai d’attente total se produit lorsque la durée totale consommée par une opération de lecture dépasse un nombre calculé de millisecondes.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-116">A total time-out occurs when the total amount of time consumed by a read operation exceeds a calculated number of milliseconds.</span></span> <span data-ttu-id="1ebb2-117">Le minutage démarre immédiatement après le début de l’opération d’e/s.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-117">Timing starts immediately when the I/O operation begins.</span></span> <span data-ttu-id="1ebb2-118">Les opérations d’écriture prennent uniquement en charge les délais d’expiration totaux.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-118">Write operations support only total time-outs.</span></span> <span data-ttu-id="1ebb2-119">Les opérations de lecture prennent en charge l’intervalle et les délais d’expiration totaux, qui peuvent être utilisés séparément ou combinés.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-119">Read operations support both interval and total time-outs, which can be used separately or combined.</span></span>

<span data-ttu-id="1ebb2-120">Le temps, en millisecondes, du délai d’attente total pour une opération de lecture ou d’écriture est calculé à l’aide des valeurs de multiplicateur et constante de la structure [**COMMTIMEOUTS**](/windows/desktop/api/Winbase/ns-winbase-commtimeouts) spécifiée dans la fonction [**GetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) ou [**SetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) .</span><span class="sxs-lookup"><span data-stu-id="1ebb2-120">The time, in milliseconds, of the total time-out period for a read or write operation is calculated by using the multiplier and constant values from the [**COMMTIMEOUTS**](/windows/desktop/api/Winbase/ns-winbase-commtimeouts) structure specified in the [**GetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) or [**SetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) function.</span></span> <span data-ttu-id="1ebb2-121">La formule utilisée est la suivante :</span><span class="sxs-lookup"><span data-stu-id="1ebb2-121">The following formula is used:</span></span>


```C++
Timeout = (MULTIPLIER * number_of_bytes) + CONSTANT
```



<span data-ttu-id="1ebb2-122">L’utilisation d’un multiplicateur et d’une constante permet de modifier le délai d’attente total, en fonction de la quantité de données demandée.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-122">Using both a multiplier and a constant enables the total time-out period to vary, depending on the amount of data being requested.</span></span> <span data-ttu-id="1ebb2-123">Une application peut utiliser uniquement la constante en affectant la valeur zéro au multiplicateur, ou utiliser uniquement le multiplicateur en affectant à la constante la valeur zéro.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-123">An application can use only the constant by setting the multiplier to zero, or use only the multiplier by setting the constant to zero.</span></span> <span data-ttu-id="1ebb2-124">Si la constante et le multiplicateur sont tous deux nuls, le délai d’attente total n’est pas utilisé.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-124">If both the constant and multiplier are zero, total time-out is not used.</span></span>

<span data-ttu-id="1ebb2-125">Si tous les paramètres de délai d’attente de lecture sont nuls, les délais d’attente de lecture ne sont pas utilisés et une opération de lecture n’est pas terminée tant que le nombre d’octets demandé n’a pas été lu ou qu’une erreur se produit.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-125">If all read time-out parameters are zero, read time-outs are not used, and a read operation is not complete until the requested number of bytes have been read or an error occurs.</span></span> <span data-ttu-id="1ebb2-126">De même, si tous les paramètres de délai d’attente d’écriture sont nuls, une opération d’écriture n’est pas terminée tant que le nombre d’octets demandé n’a pas été écrit ou qu’une erreur se produit.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-126">Similarly, if all write time-out parameters are zero, a write operation is not completed until the requested number of bytes have been written or an error occurs.</span></span>

<span data-ttu-id="1ebb2-127">Si le paramètre de délai d’attente de l’intervalle de lecture est la valeur **MAXDWORD** et que les deux paramètres de délai d’attente du total de lecture sont nuls, une opération de lecture est effectuée immédiatement après la lecture des caractères disponibles dans la mémoire tampon d’entrée, même si elle est vide.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-127">If the read interval time-out parameter is the **MAXDWORD** value and both read total time-out parameters are zero, a read operation is completed immediately after reading whatever characters are available in the input buffer, even if it is empty.</span></span>

<span data-ttu-id="1ebb2-128">Le minutage de l’intervalle force une opération de lecture à retourner lorsqu’un accalmie est en cours de réception.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-128">Interval timing forces a read operation to return when there is a lull in reception.</span></span> <span data-ttu-id="1ebb2-129">Un processus utilisant des délais d’expiration de l’intervalle peut définir un paramètre d’intervalle assez court. il peut donc réagir rapidement aux petites rafales isolées d’un ou de plusieurs caractères, mais il peut quand même collecter de grandes mémoires tampons de caractères avec un seul appel lorsque les données sont reçues dans un flux stable.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-129">A process using interval time-outs can set a fairly short interval parameter, so it can respond quickly to small, isolated bursts of one or a few characters, yet it can still collect large buffers of characters with a single call when data is received in a steady stream.</span></span>

<span data-ttu-id="1ebb2-130">Les délais d’attente d’une opération d’écriture peuvent être utiles lorsque la transmission est bloquée par un type de contrôle de flow ou lorsque la fonction [**SetCommBreak**](/windows/desktop/api/Winbase/nf-winbase-setcommbreak) a été appelée pour suspendre la transmission de caractères.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-130">Time-outs for a write operation can be useful when transmission is blocked by some kind of flow control or when the [**SetCommBreak**](/windows/desktop/api/Winbase/nf-winbase-setcommbreak) function has been called to suspend character transmission.</span></span>

<span data-ttu-id="1ebb2-131">Le tableau suivant résume le comportement des opérations de lecture en fonction des valeurs spécifiées pour les délais d’expiration totaux et des intervalles.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-131">The following table summarizes the behavior of read operations based on the values specified for total and interval time-outs.</span></span>



| <span data-ttu-id="1ebb2-132">Total</span><span class="sxs-lookup"><span data-stu-id="1ebb2-132">Total</span></span> | <span data-ttu-id="1ebb2-133">Intervalle</span><span class="sxs-lookup"><span data-stu-id="1ebb2-133">Interval</span></span> | <span data-ttu-id="1ebb2-134">Comportement</span><span class="sxs-lookup"><span data-stu-id="1ebb2-134">Behavior</span></span>                                                                                                                                                                                 |
|-------|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="1ebb2-135">0</span><span class="sxs-lookup"><span data-stu-id="1ebb2-135">0</span></span>     | <span data-ttu-id="1ebb2-136">0</span><span class="sxs-lookup"><span data-stu-id="1ebb2-136">0</span></span>        | <span data-ttu-id="1ebb2-137">Retourne lorsque la mémoire tampon est entièrement remplie.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-137">Returns when the buffer is completely filled.</span></span> <span data-ttu-id="1ebb2-138">Les délais d’attente ne sont pas utilisés.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-138">Time-outs are not used.</span></span>                                                                                                                    |
| <span data-ttu-id="1ebb2-139">T</span><span class="sxs-lookup"><span data-stu-id="1ebb2-139">T</span></span>     | <span data-ttu-id="1ebb2-140">0</span><span class="sxs-lookup"><span data-stu-id="1ebb2-140">0</span></span>        | <span data-ttu-id="1ebb2-141">Retourne lorsque la mémoire tampon est entièrement remplie ou lorsque T millisecondes se sont écoulées depuis le début de l’opération.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-141">Returns when the buffer is completely filled or when T milliseconds have elapsed since the beginning of the operation.</span></span>                                                                   |
| <span data-ttu-id="1ebb2-142">0</span><span class="sxs-lookup"><span data-stu-id="1ebb2-142">0</span></span>     | <span data-ttu-id="1ebb2-143">O</span><span class="sxs-lookup"><span data-stu-id="1ebb2-143">Y</span></span>        | <span data-ttu-id="1ebb2-144">Retourne lorsque la mémoire tampon est entièrement remplie ou lorsque les millisecondes Y se sont écoulées entre la réception de deux caractères quelconques.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-144">Returns when the buffer is completely filled or when Y milliseconds have elapsed between the receipt of any two characters.</span></span> <span data-ttu-id="1ebb2-145">Le minutage ne commence pas tant que le premier caractère n’a pas été reçu.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-145">Timing does not begin until the first character is received.</span></span> |
| <span data-ttu-id="1ebb2-146">T</span><span class="sxs-lookup"><span data-stu-id="1ebb2-146">T</span></span>     | <span data-ttu-id="1ebb2-147">O</span><span class="sxs-lookup"><span data-stu-id="1ebb2-147">Y</span></span>        | <span data-ttu-id="1ebb2-148">Retourne lorsque la mémoire tampon est entièrement remplie ou lorsque l’un ou l’autre type de dépassement de délai se produit.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-148">Returns when the buffer is completely filled or when either type of time-out occurs.</span></span>                                                                                                     |



 

> [!Note]  
> <span data-ttu-id="1ebb2-149">Toutefois, cette synchronisation est relative au système qui contrôle l’appareil physique.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-149">However, that timing is relative to the system controlling the physical device.</span></span> <span data-ttu-id="1ebb2-150">Pour un appareil distant tel qu’un modem, le minutage est relatif au système serveur auquel le modem est attaché.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-150">For a remote device such as a modem, the timing is relative to the server system to which the modem is attached.</span></span> <span data-ttu-id="1ebb2-151">Tout délai de propagation réseau n’est pas pris en compte dans.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-151">Any network propagation delay is not factored in.</span></span> <span data-ttu-id="1ebb2-152">Par exemple, une application cliente peut spécifier un délai d’expiration total qui se calcule sur 500 millisecondes.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-152">For example, a client application might specify a total time-out that computes to be 500 milliseconds.</span></span> <span data-ttu-id="1ebb2-153">Lorsque 500 millisecondes se sont écoulées sur le serveur, une erreur de délai d’attente est retournée au client.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-153">When 500 milliseconds have elapsed at the server, a time-out error is returned to the client.</span></span> <span data-ttu-id="1ebb2-154">En cas de délai de propagation réseau de 50 millisecondes, le client n’est pas notifié du délai d’attente jusqu’à environ 50 millisecondes après l’expiration du délai d’attente.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-154">If there is a 50 milliseconds network propagation delay, the client will not be notified of the time-out until approximately 50 milliseconds after the time-out actually occurred.</span></span>

 

> [!Note]  
> <span data-ttu-id="1ebb2-155">Les paramètres de délai d’attente affectent le comportement des opérations de lecture et d’écriture avec chevauchement sur un appareil de communication.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-155">The time-out parameters affect the behavior of overlapped read and write operations on a communications device.</span></span> <span data-ttu-id="1ebb2-156">Avec les e/s avec chevauchement, la fonction [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex)ou [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) peut être renvoyée avant la fin de l’opération.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-156">With overlapped I/O, the [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex), or [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) function can return before the operation has been completed.</span></span> <span data-ttu-id="1ebb2-157">Les paramètres de délai d’attente peuvent déterminer à quel moment l’opération a été effectuée.</span><span class="sxs-lookup"><span data-stu-id="1ebb2-157">The time-out parameters can determine when the operation has been completed.</span></span>

 

 

 
