---
description: Lorsque la fonction CreateFile ouvre un handle vers une ressource de communication série, le système initialise et configure la ressource en fonction des valeurs configurées lors de la dernière ouverture de la ressource.
ms.assetid: a39881d8-32af-4846-a2d3-508f1945b666
title: Modification des paramètres des ressources de communication
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8658029470fae9ee2d70ffb1459312c3c4d80ecf
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104033682"
---
# <a name="modification-of-communications-resource-settings"></a><span data-ttu-id="fe684-103">Modification des paramètres des ressources de communication</span><span class="sxs-lookup"><span data-stu-id="fe684-103">Modification of Communications Resource Settings</span></span>

<span data-ttu-id="fe684-104">Lorsque la fonction [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) ouvre un handle vers une ressource de communication série, le système initialise et configure la ressource en fonction des valeurs configurées lors de la dernière ouverture de la ressource.</span><span class="sxs-lookup"><span data-stu-id="fe684-104">When the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function opens a handle to a serial communications resource, the system initializes and configures the resource according to the values set up the last time the resource was opened.</span></span> <span data-ttu-id="fe684-105">Conserver les paramètres précédents permet à l’utilisateur de conserver les paramètres spécifiés par le biais d’une commande **mode** lorsque l’appareil est rouvert.</span><span class="sxs-lookup"><span data-stu-id="fe684-105">Preserving the previous settings enables the user to retain the settings specified through a **mode** command when the device is reopened.</span></span> <span data-ttu-id="fe684-106">Les valeurs héritées de l’opération d’ouverture précédente incluent les paramètres de configuration du bloc de contrôle de périphérique (structure [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) ) et les valeurs de délai d’attente utilisées dans les opérations d’e/s.</span><span class="sxs-lookup"><span data-stu-id="fe684-106">The values inherited from the previous open operation include the configuration settings of the device control block (a [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure) and the time-out values used in I/O operations.</span></span> <span data-ttu-id="fe684-107">Si l’appareil n’a jamais été ouvert, il est configuré avec les paramètres par défaut du système.</span><span class="sxs-lookup"><span data-stu-id="fe684-107">If the device has never been opened, it is configured with the system defaults.</span></span>

<span data-ttu-id="fe684-108">Pour déterminer la configuration initiale d’une ressource de communication série, un processus appelle la fonction [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) , qui remplit une structure de port série [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) avec les paramètres de configuration actuels.</span><span class="sxs-lookup"><span data-stu-id="fe684-108">To determine the initial configuration of a serial communications resource, a process calls the [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) function, which fills in a serial port [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure with the current configuration settings.</span></span> <span data-ttu-id="fe684-109">Pour modifier cette configuration, un processus spécifie une structure **DCB** dans un appel à la fonction [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) .</span><span class="sxs-lookup"><span data-stu-id="fe684-109">To modify this configuration, a process specifies a **DCB** structure in a call to the [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) function.</span></span>

<span data-ttu-id="fe684-110">Les membres de la structure [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) spécifient les paramètres de configuration tels que la vitesse en bauds, le nombre de bits de données par octet et le nombre de bits d’arrêt par octet.</span><span class="sxs-lookup"><span data-stu-id="fe684-110">Members of the [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure specify the configuration settings such as the baud rate, the number of data bits per byte, and the number of stop bits per byte.</span></span> <span data-ttu-id="fe684-111">D’autres membres **DCB** spécifient des caractères spéciaux et activent la vérification de parité et le contrôle de Flow.</span><span class="sxs-lookup"><span data-stu-id="fe684-111">Other **DCB** members specify special characters and enable parity checking and flow control.</span></span> <span data-ttu-id="fe684-112">Lorsqu’un processus ne doit modifier que quelques-uns de ces paramètres de configuration, il doit d’abord appeler [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) pour remplir une structure **DCB** avec la configuration actuelle.</span><span class="sxs-lookup"><span data-stu-id="fe684-112">When a process needs to modify only a few of these configuration settings, it should first call [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) to fill in a **DCB** structure with the current configuration.</span></span> <span data-ttu-id="fe684-113">Le processus peut ensuite ajuster les valeurs importantes dans la structure **DCB** et reconfigurer l’appareil en appelant [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) et en spécifiant la structure **DCB** modifiée.</span><span class="sxs-lookup"><span data-stu-id="fe684-113">Then the process can adjust the important values in the **DCB** structure and reconfigure the device by calling [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) and specifying the modified **DCB** structure.</span></span> <span data-ttu-id="fe684-114">Cette procédure permet de s’assurer que les membres non modifiés de la structure **DCB** contiennent des valeurs appropriées.</span><span class="sxs-lookup"><span data-stu-id="fe684-114">This procedure ensures that the unmodified members of the **DCB** structure contain appropriate values.</span></span> <span data-ttu-id="fe684-115">Par exemple, une erreur courante consiste à configurer un appareil avec une structure **DCB** dans laquelle le membre **XonChar** de la structure est égal au membre **XoffChar** .</span><span class="sxs-lookup"><span data-stu-id="fe684-115">For example, a common error is to configure a device with a **DCB** structure in which the structure's **XonChar** member is equal to the **XoffChar** member.</span></span>

<span data-ttu-id="fe684-116">La fonction [**BuildCommDCB**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba) fournit une autre façon de modifier une structure [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) .</span><span class="sxs-lookup"><span data-stu-id="fe684-116">The [**BuildCommDCB**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba) function provides another way to modify a [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure.</span></span> <span data-ttu-id="fe684-117">**BuildCommDCB** utilise une chaîne ayant la même forme que les arguments de ligne de commande de la commande **mode** pour spécifier la vitesse en bauds, le schéma de parité, le nombre de bits d’arrêt et le nombre de bits de données.</span><span class="sxs-lookup"><span data-stu-id="fe684-117">**BuildCommDCB** uses a string with the same form as the command-line arguments of the **mode** command to specify the baud rate, parity scheme, number of stop bits, and number of data bits.</span></span> <span data-ttu-id="fe684-118">Les membres restants de [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) ne sont pas modifiés par cette fonction, sauf que les membres appropriés sont définis pour désactiver XON/XOFF et le contrôle de workflow matériel.</span><span class="sxs-lookup"><span data-stu-id="fe684-118">The remaining members of [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) are not changed by this function, except that the appropriate members are set to disable XON/XOFF and hardware flow control.</span></span> <span data-ttu-id="fe684-119">**BuildCommDCB** modifie uniquement une structure **DCB** ; elle ne reconfigure pas l’appareil.</span><span class="sxs-lookup"><span data-stu-id="fe684-119">**BuildCommDCB** only modifies a **DCB** structure; it does not reconfigure the device.</span></span>

<span data-ttu-id="fe684-120">Un processus peut reconfigurer une ressource de communication à l’aide de la fonction [**GetCommProperties**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) pour obtenir des informations à partir d’un pilote de périphérique sur les paramètres de configuration qu’il prend en charge.</span><span class="sxs-lookup"><span data-stu-id="fe684-120">A process can reconfigure a communications resource by using the [**GetCommProperties**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) function to get information from a device driver about the configuration settings that it supports.</span></span> <span data-ttu-id="fe684-121">Le processus peut utiliser ces informations pour éviter de spécifier une configuration qui n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="fe684-121">The process can use this information to avoid specifying a configuration that is not supported.</span></span>

<span data-ttu-id="fe684-122">La fonction [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) reconfigure la ressource de communication, mais elle n’affecte pas la sortie interne et les tampons d’entrée du pilote spécifié.</span><span class="sxs-lookup"><span data-stu-id="fe684-122">The [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) function reconfigures the communications resource, but it does not affect the internal output and input buffers of the specified driver.</span></span> <span data-ttu-id="fe684-123">Les mémoires tampons ne sont pas vidées et les opérations de lecture et d’écriture en attente ne sont pas terminées prématurément.</span><span class="sxs-lookup"><span data-stu-id="fe684-123">The buffers are not flushed, and pending read and write operations are not terminated prematurely.</span></span>

<span data-ttu-id="fe684-124">Un processus réinitialise une ressource de communication à l’aide de la fonction [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) , qui effectue les tâches suivantes :</span><span class="sxs-lookup"><span data-stu-id="fe684-124">A process reinitializes a communications resource by using the [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) function, which performs the following tasks:</span></span>

-   <span data-ttu-id="fe684-125">Termine les opérations de lecture et d’écriture en attente, même si elles n’ont pas été terminées.</span><span class="sxs-lookup"><span data-stu-id="fe684-125">Terminates pending read and write operations, even if they have not been completed.</span></span>
-   <span data-ttu-id="fe684-126">Ignore les caractères non lus et libère les mémoires tampons de sortie et d’entrée internes du pilote associé à la ressource spécifiée.</span><span class="sxs-lookup"><span data-stu-id="fe684-126">Discards unread characters and frees the internal output and input buffers of the driver associated with the specified resource.</span></span>
-   <span data-ttu-id="fe684-127">Réalloue la sortie interne et les mémoires tampons d’entrée.</span><span class="sxs-lookup"><span data-stu-id="fe684-127">Reallocates the internal output and input buffers.</span></span>

<span data-ttu-id="fe684-128">Un processus n’est pas obligatoire pour appeler [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm).</span><span class="sxs-lookup"><span data-stu-id="fe684-128">A process is not required to call [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm).</span></span> <span data-ttu-id="fe684-129">Si ce n’est pas le cas, le pilote de la ressource Initialise l’appareil avec les paramètres par défaut la première fois que le handle de ressource de communication est utilisé.</span><span class="sxs-lookup"><span data-stu-id="fe684-129">If it does not, the resource's driver initializes the device with the default settings the first time that the communications resource handle is used.</span></span>

 

 
