---
title: Utilisation des informations de version
description: Cette rubrique explique comment utiliser les fonctions d’informations de version.
ms.assetid: 447b57c9-9e94-4a28-897e-f7b87d9cb25a
keywords:
- ressources, informations sur la version
- informations de version
- informations sur le fichier d’installation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1a8785275f5aac69218989250d1c0f83e0a1ff9f
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/19/2020
ms.locfileid: "103725453"
---
# <a name="using-version-information"></a><span data-ttu-id="96291-106">Utilisation des informations de version</span><span class="sxs-lookup"><span data-stu-id="96291-106">Using Version Information</span></span>

<span data-ttu-id="96291-107">Un programme d’installation a généralement les objectifs suivants :</span><span class="sxs-lookup"><span data-stu-id="96291-107">An installation program typically has the following goals:</span></span>

-   <span data-ttu-id="96291-108">Pour placer les fichiers à l’emplacement approprié.</span><span class="sxs-lookup"><span data-stu-id="96291-108">To place files in the correct location.</span></span>
-   <span data-ttu-id="96291-109">Pour avertir l’utilisateur si le programme d’installation remplace un fichier existant par une version qui est très différente, par exemple, en remplaçant un fichier en allemand par un fichier de langue anglaise ou en remplaçant un fichier plus récent par un fichier plus ancien.</span><span class="sxs-lookup"><span data-stu-id="96291-109">To notify the user if the installation program is replacing an existing file with a version that is significantly different—for example, replacing a German-language file with an English-language file, or replacing a newer file with an older file.</span></span>

<span data-ttu-id="96291-110">Lors de l’écriture du programme d’installation, vous devez disposer des informations suivantes pour chaque fichier :</span><span class="sxs-lookup"><span data-stu-id="96291-110">When writing the installation program, you must have the following information for each file:</span></span>

-   <span data-ttu-id="96291-111">Nom et emplacement du fichier (appelé fichier source).</span><span class="sxs-lookup"><span data-stu-id="96291-111">The name and location of the file (referred to as the source file).</span></span>
-   <span data-ttu-id="96291-112">Nom du fichier équivalent sur le disque dur de l’utilisateur (connu sous le nom de fichier de destination).</span><span class="sxs-lookup"><span data-stu-id="96291-112">The name of the equivalent file on the user's hard disk (referred to as the destination file).</span></span> <span data-ttu-id="96291-113">Ce nom est généralement le même que le nom de fichier sur le disque d’installation.</span><span class="sxs-lookup"><span data-stu-id="96291-113">This name is usually the same as the filename on the installation disk.</span></span>
-   <span data-ttu-id="96291-114">État de partage du fichier, c’est-à-dire si le fichier est privé pour l’application en cours d’installation ou s’il peut être partagé par plusieurs applications.</span><span class="sxs-lookup"><span data-stu-id="96291-114">The sharing status of the file—that is, whether the file is private to the application being installed or could be shared by multiple applications.</span></span>

<span data-ttu-id="96291-115">Le programme d’installation peut utiliser la fonction [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea) pour déterminer l’emplacement où le fichier doit être copié sur le disque.</span><span class="sxs-lookup"><span data-stu-id="96291-115">The installation program can use the [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea) function to determine where the file should be copied on the disk.</span></span> <span data-ttu-id="96291-116">Cette fonction peut également être utilisée pour spécifier si le fichier est privé pour l’application ou s’il peut être partagé.</span><span class="sxs-lookup"><span data-stu-id="96291-116">This function can also be used to specify whether the file is private to the application or can be shared.</span></span> <span data-ttu-id="96291-117">Si un problème se produit lors de la recherche du fichier, **VerFindFile** retourne une valeur d’erreur.</span><span class="sxs-lookup"><span data-stu-id="96291-117">If a problem occurs in finding the file, **VerFindFile** returns an error value.</span></span> <span data-ttu-id="96291-118">Par exemple, si le système utilise le fichier de destination, **VerFindFile** retourne **VFF \_ FILEINUSE**.</span><span class="sxs-lookup"><span data-stu-id="96291-118">For example, if the system is using the destination file, **VerFindFile** returns **VFF\_FILEINUSE**.</span></span> <span data-ttu-id="96291-119">Le programme d’installation doit avertir l’utilisateur du problème et répondre à la décision de l’utilisateur de continuer ou de mettre fin à l’installation.</span><span class="sxs-lookup"><span data-stu-id="96291-119">The installation program must notify the user of the problem and respond to the user's decision to continue or to end the installation.</span></span>

<span data-ttu-id="96291-120">La fonction [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) copie le fichier source dans un fichier temporaire dans le répertoire spécifié par [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea).</span><span class="sxs-lookup"><span data-stu-id="96291-120">The [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) function copies the source file to a temporary file in the directory specified by [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea).</span></span> <span data-ttu-id="96291-121">Si nécessaire, **VerInstallFile** développe le fichier à l’aide des fonctions de la bibliothèque de décompression des données.</span><span class="sxs-lookup"><span data-stu-id="96291-121">If necessary, **VerInstallFile** expands the file by using the functions in the data decompression library.</span></span>

<span data-ttu-id="96291-122">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) compare les informations de version du fichier temporaire à celles du fichier de destination.</span><span class="sxs-lookup"><span data-stu-id="96291-122">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) compares the version information of the temporary file to that of the destination file.</span></span> <span data-ttu-id="96291-123">Si les deux diffèrent, **VerInstallFile** retourne une ou plusieurs valeurs d’erreur.</span><span class="sxs-lookup"><span data-stu-id="96291-123">If the two differ, **VerInstallFile** returns one or more error values.</span></span> <span data-ttu-id="96291-124">Par exemple, elle retourne **vif \_ SRCOLD** si le fichier temporaire est plus ancien que le fichier de destination et **vif \_ DIFFLANG** si les fichiers ont des identificateurs de langue ou des valeurs de page de codes différents.</span><span class="sxs-lookup"><span data-stu-id="96291-124">For example, it returns **VIF\_SRCOLD** if the temporary file is older than the destination file and **VIF\_DIFFLANG** if the files have different language identifiers or code-page values.</span></span> <span data-ttu-id="96291-125">Le programme d’installation doit avertir l’utilisateur du problème et répondre à la décision de l’utilisateur de continuer ou de mettre fin à l’installation.</span><span class="sxs-lookup"><span data-stu-id="96291-125">The installation program must notify the user of the problem and respond to the user's decision to continue or to end the installation.</span></span>

<span data-ttu-id="96291-126">Certaines erreurs de [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) sont récupérables.</span><span class="sxs-lookup"><span data-stu-id="96291-126">Some [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) errors are recoverable.</span></span> <span data-ttu-id="96291-127">Autrement dit, le programme d’installation peut appeler à nouveau **VerInstallFile** , en spécifiant l’option **VIFF \_ FORCEINSTALL** pour installer le fichier, quel que soit le conflit de version.</span><span class="sxs-lookup"><span data-stu-id="96291-127">That is, the installation program can call **VerInstallFile** again, specifying the **VIFF\_FORCEINSTALL** option, to install the file regardless of the version conflict.</span></span> <span data-ttu-id="96291-128">Si **VerInstallFile** retourne **vif \_ tempfile** et que l’utilisateur choisit de ne pas forcer l’installation, le programme d’installation doit supprimer le fichier temporaire.</span><span class="sxs-lookup"><span data-stu-id="96291-128">If **VerInstallFile** returns **VIF\_TEMPFILE** and the user chooses not to force the installation, the installation program should delete the temporary file.</span></span>

<span data-ttu-id="96291-129">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) peut rencontrer une erreur irrécupérable lors de la tentative de forcer l’installation, même si l’erreur n’existait pas précédemment.</span><span class="sxs-lookup"><span data-stu-id="96291-129">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) could encounter a nonrecoverable error when attempting to force installation, even though the error did not exist previously.</span></span> <span data-ttu-id="96291-130">Par exemple, le fichier peut être verrouillé par un autre utilisateur avant que le programme d’installation ne tente de forcer l’installation.</span><span class="sxs-lookup"><span data-stu-id="96291-130">For example, the file could be locked by another user before the installation program attempted to force installation.</span></span> <span data-ttu-id="96291-131">Si un programme d’installation tente de forcer l’installation après une erreur non récupérable, **VerInstallFile** échoue.</span><span class="sxs-lookup"><span data-stu-id="96291-131">If an installation program attempts to force installation after a non-recoverable error, **VerInstallFile** fails.</span></span> <span data-ttu-id="96291-132">Le programme d’installation doit contenir des routines pour effectuer une récupération à partir de ce type d’erreur.</span><span class="sxs-lookup"><span data-stu-id="96291-132">The installation program must contain routines to recover from this type of error.</span></span>

<span data-ttu-id="96291-133">La solution recommandée consiste à afficher une boîte de dialogue avec les boutons **installer**, **Ignorer** et **installer tout**.</span><span class="sxs-lookup"><span data-stu-id="96291-133">The recommended solution is to display a dialog box with the buttons **Install**, **Skip**, and **Install All**.</span></span> <span data-ttu-id="96291-134">(Une autre solution est une boîte de dialogue avec les boutons **Oui**, **Oui pour tout**, **Ignorer** et **Annuler**.) Le bouton **installer tout** doit empêcher le programme d’installation de demander à l’utilisateur des erreurs similaires en incluant l’option **VIFF \_ FORCEINSTALL** dans toutes les utilisations suivantes de [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea).</span><span class="sxs-lookup"><span data-stu-id="96291-134">(Another solution is a dialog box with the buttons **Yes**, **Yes to All**, **Skip**, and **Cancel**.) The **Install All** button should prevent the installation program from prompting the user about similar errors by including the **VIFF\_FORCEINSTALL** option in all subsequent uses of [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea).</span></span> <span data-ttu-id="96291-135">Pour les erreurs irrécupérables, les boutons **installer** et **installer tout** doivent être désactivés.</span><span class="sxs-lookup"><span data-stu-id="96291-135">For nonrecoverable errors, the **Install** and **Install All** buttons should be disabled.</span></span>

<span data-ttu-id="96291-136">Pour afficher un message d’erreur utile à l’utilisateur, le programme d’installation doit généralement récupérer des informations à partir des ressources de version des fichiers en conflit.</span><span class="sxs-lookup"><span data-stu-id="96291-136">To display a useful error message to the user, the installation program usually must retrieve information from the version resources of the conflicting files.</span></span> <span data-ttu-id="96291-137">Le programme d’installation peut utiliser quatre fonctions à cet effet :</span><span class="sxs-lookup"><span data-stu-id="96291-137">There are four functions the installation program can use for this purpose:</span></span>

-   [<span data-ttu-id="96291-138">**Échec GetFileVersionInfoSize**</span><span class="sxs-lookup"><span data-stu-id="96291-138">**GetFileVersionInfoSize**</span></span>](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea)
-   [<span data-ttu-id="96291-139">**GetFileVersionInfo**</span><span class="sxs-lookup"><span data-stu-id="96291-139">**GetFileVersionInfo**</span></span>](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa)
-   [<span data-ttu-id="96291-140">**VerQueryValue**</span><span class="sxs-lookup"><span data-stu-id="96291-140">**VerQueryValue**</span></span>](/windows/desktop/api/Winver/nf-winver-verqueryvaluea)
-   [<span data-ttu-id="96291-141">**VerLanguageName**</span><span class="sxs-lookup"><span data-stu-id="96291-141">**VerLanguageName**</span></span>](/windows/desktop/api/Winver/nf-winver-verlanguagenamea)

<span data-ttu-id="96291-142">[**Échec GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea) retourne la taille des informations de version.</span><span class="sxs-lookup"><span data-stu-id="96291-142">[**GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea) returns the size of the version information.</span></span> <span data-ttu-id="96291-143">[**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa) utilise les informations extraites par **échec GetFileVersionInfoSize** pour récupérer une structure qui contient les informations de version.</span><span class="sxs-lookup"><span data-stu-id="96291-143">[**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa) uses information retrieved by **GetFileVersionInfoSize** to retrieve a structure that contains the version information.</span></span> <span data-ttu-id="96291-144">[**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) récupère un membre spécifique de cette structure.</span><span class="sxs-lookup"><span data-stu-id="96291-144">[**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) retrieves a specific member from that structure.</span></span>

<span data-ttu-id="96291-145">Par exemple, si [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) retourne l' **erreur \_ vif DIFFTYPE** , le programme d’installation doit utiliser les fonctions [**échec GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea), [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa)et [**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) sur les fichiers temporaires et de destination pour obtenir le type général de chaque fichier.</span><span class="sxs-lookup"><span data-stu-id="96291-145">For example, if [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) returns the **VIF\_DIFFTYPE** error, the installation program should use the [**GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea), [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa), and [**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) functions on the temporary and destination files to obtain the general type of each file.</span></span> <span data-ttu-id="96291-146">Si les langues des fichiers sont en conflit, le programme d’installation doit également utiliser [**VerLanguageName**](/windows/desktop/api/Winver/nf-winver-verlanguagenamea) pour convertir l’identificateur de langue binaire en une représentation textuelle de la langue.</span><span class="sxs-lookup"><span data-stu-id="96291-146">If the languages of the files conflict, the installation program should also use [**VerLanguageName**](/windows/desktop/api/Winver/nf-winver-verlanguagenamea) to translate the binary language identifier into a text representation of the language.</span></span> <span data-ttu-id="96291-147">(Par exemple, 0x040C se traduit par la chaîne « French ».)</span><span class="sxs-lookup"><span data-stu-id="96291-147">(For example, 0x040C translates to the string "French.")</span></span>

<span data-ttu-id="96291-148">Si [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) retourne une erreur de fichier, par exemple **vif \_ ACCESSVIOLATION**, le programme d’installation doit utiliser la fonction [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) pour récupérer la valeur d’erreur la plus récente.</span><span class="sxs-lookup"><span data-stu-id="96291-148">If [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) returns a file error, such as **VIF\_ACCESSVIOLATION**, the installation program should use the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function to retrieve the most recent error value.</span></span> <span data-ttu-id="96291-149">Le programme doit traduire cette valeur en message d’information à afficher à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="96291-149">The program should translate this value into an informative message to display to the user.</span></span> <span data-ttu-id="96291-150">Le programme ne doit pas générer de contrôle entre les appels à **VerInstallFile** et **GetLastError**.</span><span class="sxs-lookup"><span data-stu-id="96291-150">The program must not yield control between the calls to **VerInstallFile** and **GetLastError**.</span></span>

 

 