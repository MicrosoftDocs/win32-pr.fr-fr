---
title: Implémentation de l’objet COM d’extension de création d’objet
description: Une extension de création d’objet est un objet COM implémenté en tant que serveur in-proc. Les extensions de création d’objet primaire et secondaire doivent implémenter l’interface IDsAdminNewObjExt.
ms.assetid: 0a8ed0ed-9dcb-4373-b549-7da3f3d9f641
ms.tgt_platform: multiple
keywords:
- Implémentation de l’objet COM d’extension de création d’objet AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 05c1a9da94caa300c1277cf6f6030357ca9d573d
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/17/2020
ms.locfileid: "104030999"
---
# <a name="implementing-the-object-creation-extension-com-object"></a><span data-ttu-id="1c795-105">Implémentation de l’objet COM d’extension de création d’objet</span><span class="sxs-lookup"><span data-stu-id="1c795-105">Implementing the Object Creation Extension COM Object</span></span>

<span data-ttu-id="1c795-106">Une extension de création d’objet est un objet COM implémenté en tant que serveur in-proc.</span><span class="sxs-lookup"><span data-stu-id="1c795-106">An object creation extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="1c795-107">Les extensions de création d’objet primaire et secondaire doivent implémenter l’interface [**IDsAdminNewObjExt**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) .</span><span class="sxs-lookup"><span data-stu-id="1c795-107">Both primary and secondary object creation extensions must implement the [**IDsAdminNewObjExt**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) interface.</span></span>

## <a name="implementing-idsadminnewobjext"></a><span data-ttu-id="1c795-108">Implémentation de IDsAdminNewObjExt</span><span class="sxs-lookup"><span data-stu-id="1c795-108">Implementing IDsAdminNewObjExt</span></span>

<span data-ttu-id="1c795-109">Lorsque l’Assistant Création d’objet est créé, il initialise chaque extension de création d’objet en appelant la méthode [**IDsAdminNewObjExt :: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) de l’extension.</span><span class="sxs-lookup"><span data-stu-id="1c795-109">When the object creation wizard is created, it initializes each object creation extension by calling the extension's [**IDsAdminNewObjExt::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) method.</span></span> <span data-ttu-id="1c795-110">La méthode **Initialize** fournit l’extension avec des informations sur le conteneur dans lequel l’objet est créé, le nom de classe du nouvel objet et des informations sur l’Assistant lui-même.</span><span class="sxs-lookup"><span data-stu-id="1c795-110">The **Initialize** method supplies the extension with information about the container the object is being created in, the class name of the new object and information about the wizard itself.</span></span> <span data-ttu-id="1c795-111">Si l’Assistant Création d’objet démarre pour créer un objet à partir d’un objet existant, le paramètre *pADsCopySource* n’est pas **null**.</span><span class="sxs-lookup"><span data-stu-id="1c795-111">If the object creation wizard is started to create a new object from an existing object, the *pADsCopySource* parameter will not be **NULL**.</span></span> <span data-ttu-id="1c795-112">Dans ce cas, l’extension doit tenter d’obtenir autant de données que possible de l’objet copié.</span><span class="sxs-lookup"><span data-stu-id="1c795-112">In this case, the extension should attempt to obtain as much data from the object being copied as is feasible.</span></span>

<span data-ttu-id="1c795-113">Une fois l’extension initialisée, la méthode [**IDsAdminNewObjExt :: AddPages**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) est appelée.</span><span class="sxs-lookup"><span data-stu-id="1c795-113">After the extension is initialized, the [**IDsAdminNewObjExt::AddPages**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) method is called.</span></span> <span data-ttu-id="1c795-114">L’extension doit ajouter la ou les pages à l’Assistant pendant cette méthode.</span><span class="sxs-lookup"><span data-stu-id="1c795-114">The extension must add the page or pages to the wizard during this method.</span></span> <span data-ttu-id="1c795-115">Une page d’Assistant est créée en remplissant une structure [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) , puis en passant cette structure à la fonction [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) .</span><span class="sxs-lookup"><span data-stu-id="1c795-115">A wizard page is created by filling in a [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and then passing this structure to the [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) function.</span></span> <span data-ttu-id="1c795-116">La page est ensuite ajoutée à l’Assistant en appelant la fonction de rappel transmise à **AddPages** dans le paramètre *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="1c795-116">The page is then added to the wizard by calling the callback function that is passed to **AddPages** in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="1c795-117">Avant l’affichage de la page d’extension, [**IDsAdminNewObjExt :: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) est appelée.</span><span class="sxs-lookup"><span data-stu-id="1c795-117">Before the extension page is displayed, [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) is called.</span></span> <span data-ttu-id="1c795-118">Cela fournit l’extension avec un pointeur d’interface [**IADs**](/windows/desktop/api/iads/nn-iads-iads) pour l’objet en cours de création.</span><span class="sxs-lookup"><span data-stu-id="1c795-118">This supplies the extension with an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer for the object being created.</span></span>

<span data-ttu-id="1c795-119">Lorsque la page de l’Assistant s’affiche, la page doit gérer et répondre aux messages de notification de l’Assistant nécessaires, tels que [**PSN \_ SetActive**](../controls/psn-setactive.md) et [**PSN \_ WIZNEXT**](../controls/psn-wiznext.md).</span><span class="sxs-lookup"><span data-stu-id="1c795-119">While the wizard page is displayed, the page should handle and respond to any necessary wizard notification messages, such as [**PSN\_SETACTIVE**](../controls/psn-setactive.md) and [**PSN\_WIZNEXT**](../controls/psn-wiznext.md).</span></span>

<span data-ttu-id="1c795-120">Lorsque l’utilisateur remplit toutes les pages de l’Assistant, l’Assistant affiche une page « terminer » qui fournit un résumé des données entrées.</span><span class="sxs-lookup"><span data-stu-id="1c795-120">When the user completes all of the wizard pages, the wizard will display a "Finish" page that provides a summary of the data entered.</span></span> <span data-ttu-id="1c795-121">L’Assistant obtient ces données en appelant la méthode [**IDsAdminNewObjExt :: GetSummaryInfo**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) pour chacune des extensions.</span><span class="sxs-lookup"><span data-stu-id="1c795-121">The wizard obtains this data by calling the [**IDsAdminNewObjExt::GetSummaryInfo**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) method for each of the extensions.</span></span> <span data-ttu-id="1c795-122">La méthode **GetSummaryInfo** fournit un **BSTR** qui contient les données texte affichées dans la page « Finish ».</span><span class="sxs-lookup"><span data-stu-id="1c795-122">The **GetSummaryInfo** method provides a **BSTR** that contains the text data displayed in the "Finish" page.</span></span> <span data-ttu-id="1c795-123">Une extension de création d’objet n’a pas besoin de fournir des données de synthèse.</span><span class="sxs-lookup"><span data-stu-id="1c795-123">An object creation extension does not have to supply summary data.</span></span> <span data-ttu-id="1c795-124">Dans ce cas, **GetSummaryInfo** doit retourner **E \_ NOTIMPL**.</span><span class="sxs-lookup"><span data-stu-id="1c795-124">In this case, **GetSummaryInfo** should return **E\_NOTIMPL**.</span></span> <span data-ttu-id="1c795-125">**GetSummaryInfo** est appelé une seule fois pour chaque extension, pas par page. par conséquent, si l’extension de création d’objet ajoute plusieurs pages, l’extension doit combiner les données de synthèse en une seule chaîne.</span><span class="sxs-lookup"><span data-stu-id="1c795-125">**GetSummaryInfo** is only called one time for each extension, not per page, so if the object creation extension adds more than one page, the extension must combine the summary data into one string.</span></span>

<span data-ttu-id="1c795-126">Quand l’utilisateur clique sur le bouton **Terminer** dans la page « terminer », l’Assistant appelle chacune des méthodes [**IDsAdminNewObjExt :: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) de l’extension avec le contexte de la **\_ \_ \_ prévalidation de DSA NEWOBJ CTX** .</span><span class="sxs-lookup"><span data-stu-id="1c795-126">When the user clicks the **Finish** button in the "Finish" page, the wizard calls each of the extension's [**IDsAdminNewObjExt::WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) methods with the **DSA\_NEWOBJ\_CTX\_PRECOMMIT** context.</span></span> <span data-ttu-id="1c795-127">Dans ce cas, l’extension doit écrire les données collectées dans les propriétés appropriées à l’aide de la méthode [**IADs ::P ut**](/windows/desktop/api/iads/nf-iads-iads-put) ou [**IADs ::P Utex**](/windows/desktop/api/iads/nf-iads-iads-putex) .</span><span class="sxs-lookup"><span data-stu-id="1c795-127">When this occurs, the extension should write the gathered data into the appropriate properties using the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) or [**IADs::PutEx**](/windows/desktop/api/iads/nf-iads-iads-putex) method.</span></span> <span data-ttu-id="1c795-128">L’interface [**IADs**](/windows/desktop/api/iads/nn-iads-iads) est fournie à l’extension dans la méthode [**IDsAdminNewObjExt :: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) .</span><span class="sxs-lookup"><span data-stu-id="1c795-128">The [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface is provided to the extension in the [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) method.</span></span> <span data-ttu-id="1c795-129">L’extension ne doit pas valider les propriétés mises en cache en appelant [**IADs :: setinfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo).</span><span class="sxs-lookup"><span data-stu-id="1c795-129">The extension should not commit the cached properties by calling [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo).</span></span> <span data-ttu-id="1c795-130">Lorsque toutes les propriétés ont été écrites, l’extension de création d’objet principal valide les modifications en appelant **IADs :: setinfo**.</span><span class="sxs-lookup"><span data-stu-id="1c795-130">When all of the properties have been written, the primary object creation extension commits the changes by calling **IADs::SetInfo**.</span></span> <span data-ttu-id="1c795-131">Ce sujet est abordé plus en détail ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="1c795-131">This is discussed in more detail below.</span></span>

<span data-ttu-id="1c795-132">Si une erreur se produit, l’extension est avertie de l’erreur et pendant quelle opération elle s’est produite lorsque la méthode [**IDsAdminNewObjExt :: OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) est appelée.</span><span class="sxs-lookup"><span data-stu-id="1c795-132">If an error occurs, the extension will be notified of the error and during which operation it occurred when the [**IDsAdminNewObjExt::OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) method is called.</span></span>

## <a name="implementing-a-primary-object-creation-wizard"></a><span data-ttu-id="1c795-133">Implémentation d’un assistant de création d’objet principal</span><span class="sxs-lookup"><span data-stu-id="1c795-133">Implementing a Primary Object Creation Wizard</span></span>

<span data-ttu-id="1c795-134">L’implémentation d’un assistant de création d’objet principal est identique à un assistant de création d’objet secondaire, à ceci près qu’un assistant de création d’objet principal doit exécuter quelques étapes supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="1c795-134">The implementation of a primary object creation wizard is identical to a secondary object creation wizard, except that a primary object creation wizard must perform a few more steps.</span></span>

<span data-ttu-id="1c795-135">Avant la fermeture de la première page, l’Assistant Création d’objet doit créer l’objet de répertoire temporaire.</span><span class="sxs-lookup"><span data-stu-id="1c795-135">Prior to the first page being dismissed, the object creation wizard must create the temporary directory object.</span></span> <span data-ttu-id="1c795-136">Pour ce faire, appelez la méthode [**IDsAdminNewObjPrimarySite :: CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) .</span><span class="sxs-lookup"><span data-stu-id="1c795-136">To do this, call the [**IDsAdminNewObjPrimarySite::CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) method.</span></span> <span data-ttu-id="1c795-137">Un pointeur vers l’interface [**IDsAdminNewObjPrimarySite**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) est obtenu en appelant [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) avec **IID \_ IDsAdminNewObjPrimarySite** sur l’interface [**IDsAdminNewObj**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) qui est passée à [**IDsAdminNewObjExt :: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize).</span><span class="sxs-lookup"><span data-stu-id="1c795-137">A pointer to the [**IDsAdminNewObjPrimarySite**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) interface is obtained by calling [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) with **IID\_IDsAdminNewObjPrimarySite** on the [**IDsAdminNewObj**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) interface that is passed to [**IDsAdminNewObjExt::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize).</span></span> <span data-ttu-id="1c795-138">La méthode **CreateNew** crée un nouvel objet temporaire et appelle [**IDsAdminNewObjExt :: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) pour chaque extension.</span><span class="sxs-lookup"><span data-stu-id="1c795-138">The **CreateNew** method creates a new temporary object and calls [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) for each extension.</span></span>

<span data-ttu-id="1c795-139">Quand un assistant de création d’objet contient plusieurs pages, le système met en œuvre une page « terminer » qui affiche un résumé des informations relatives aux objets à enregistrer.</span><span class="sxs-lookup"><span data-stu-id="1c795-139">When an object creation wizard contains more than one page, the system implements a "Finish" page that displays a summary of the object information to be saved.</span></span> <span data-ttu-id="1c795-140">Quand l’utilisateur clique sur le bouton **Terminer** sur la page « terminer », le système appelle chaque méthode [**IDsAdminNewObjExt :: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) de l’extension de création d’objet, puis valide l’objet temporaire dans la mémoire persistante.</span><span class="sxs-lookup"><span data-stu-id="1c795-140">When the **Finish** button on the "Finish" page is clicked, the system will call each of the object creation extension's [**IDsAdminNewObjExt::WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) method and then commit the temporary object to persistent memory.</span></span> <span data-ttu-id="1c795-141">Toutefois, si l’Assistant Création d’objet ne contient qu’une seule page, les boutons **OK** et **Annuler** s’affichent au lieu des boutons **précédent**, **suivant** et **Annuler** , normalement disponibles dans un Assistant et aucune page « terminer » n’est fournie.</span><span class="sxs-lookup"><span data-stu-id="1c795-141">If, however, the object creation wizard only contains one page, the page will have **OK** and **Cancel** buttons instead of the **Back**, **Next** and **Cancel** buttons normally found in a wizard and no "Finish" page is provided.</span></span> <span data-ttu-id="1c795-142">Pour cette raison, un Assistant extension de création d’objet à page unique doit appeler [**IDsAdminNewObjPrimarySite :: Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) pour effectuer les opérations d’écriture et d’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="1c795-142">Because of this, a single-page object creation extension wizard must call [**IDsAdminNewObjPrimarySite::Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) to perform the write and save operations.</span></span> <span data-ttu-id="1c795-143">Une extension de création d’objet principal d’une seule page doit appeler la **validation** en réponse à la notification [**PSN \_ WIZFINISH**](../controls/psn-wizfinish.md) .</span><span class="sxs-lookup"><span data-stu-id="1c795-143">A single-page primary object creation extension should call **Commit** in response to the [**PSN\_WIZFINISH**](../controls/psn-wizfinish.md) notification.</span></span>

<span data-ttu-id="1c795-144">Étant donné que d’autres extensions de création d’objets peuvent ajouter des pages à l’Assistant, l’extension de création d’objet principal peut ne pas savoir s’il y a plus d’une page dans l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="1c795-144">Because other object creation extensions can add pages to the wizard, the primary object creation extension may not know if there is more than one page in the wizard.</span></span> <span data-ttu-id="1c795-145">Ce n’est pas un problème pour deux raisons : tout d’abord, si le système implémente la page « terminer », l’extension de la création de l’objet principal recevra la notification [**PSN \_ WIZNEXT**](../controls/psn-wiznext.md) au lieu de la notification **\_ WIZNEXT PSN** .</span><span class="sxs-lookup"><span data-stu-id="1c795-145">This is not an issue for two reasons: First, if the system implements the "Finish" page, the primary object creation extension will receive the [**PSN\_WIZNEXT**](../controls/psn-wiznext.md) notification instead of the **PSN\_WIZNEXT** notification.</span></span> <span data-ttu-id="1c795-146">Deuxièmement, la [**validation**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) échouera sans danger si l’Assistant contient plus d’une page.</span><span class="sxs-lookup"><span data-stu-id="1c795-146">Second, [**Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) will fail harmlessly if the wizard contains more than one page.</span></span>

 

 