---
title: Implémentation de l’objet COM du menu contextuel
description: Une extension de menu contextuel est un objet COM implémenté en tant que serveur in-proc.
ms.assetid: 362dd8e5-1518-4bf4-ac53-115263cd6c62
ms.tgt_platform: multiple
keywords:
- objet COM du menu contextuel AD
- objet COM du menu contextuel AD, implémentation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a34d6b487d130327b379ed845f2d0157f2b28056
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/17/2020
ms.locfileid: "106512088"
---
# <a name="implementing-the-context-menu-com-object"></a><span data-ttu-id="b667b-105">Implémentation de l’objet COM du menu contextuel</span><span class="sxs-lookup"><span data-stu-id="b667b-105">Implementing the Context Menu COM Object</span></span>

<span data-ttu-id="b667b-106">Une extension de menu contextuel est un objet COM implémenté en tant que serveur in-proc.</span><span class="sxs-lookup"><span data-stu-id="b667b-106">A context menu extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="b667b-107">L’extension du menu contextuel doit implémenter les interfaces [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) et [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) .</span><span class="sxs-lookup"><span data-stu-id="b667b-107">The context menu extension must implement the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) and [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) interfaces.</span></span> <span data-ttu-id="b667b-108">Une extension de menu contextuel est instanciée lorsque l’utilisateur affiche le menu contextuel d’un objet d’une classe pour laquelle l’extension de menu contextuel a été inscrite.</span><span class="sxs-lookup"><span data-stu-id="b667b-108">A context menu extension is instantiated when the user displays the context menu for an object of a class for which the context menu extension has been registered.</span></span>

## <a name="implementing-ishellextinit"></a><span data-ttu-id="b667b-109">Implémentation de IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="b667b-109">Implementing IShellExtInit</span></span>

<span data-ttu-id="b667b-110">Après l’instanciation de l’objet COM de l’extension de menu contextuel, la méthode [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) est appelée.</span><span class="sxs-lookup"><span data-stu-id="b667b-110">After the context menu extension COM object is instantiated, the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method is called.</span></span> <span data-ttu-id="b667b-111">**IShellExtInit :: Initialize** fournit l’extension de menu contextuel avec un objet [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) qui contient les données pertinentes pour l’objet d’annuaire auquel le menu contextuel s’applique.</span><span class="sxs-lookup"><span data-stu-id="b667b-111">**IShellExtInit::Initialize** supplies the context menu extension with an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) object that contains data pertinent to the directory object that the context menu applies to.</span></span>

<span data-ttu-id="b667b-112">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contient des données au format [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) .</span><span class="sxs-lookup"><span data-stu-id="b667b-112">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contains data in the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) format.</span></span> <span data-ttu-id="b667b-113">Le format de données **CFSTR \_ DSOBJECTNAMES** est un **HGLOBAL** qui contient une structure [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) .</span><span class="sxs-lookup"><span data-stu-id="b667b-113">The **CFSTR\_DSOBJECTNAMES** data format is an **HGLOBAL** that contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure.</span></span> <span data-ttu-id="b667b-114">La structure **DSOBJECTNAMES** contient des données sur l’objet Directory auquel s’applique l’extension de la feuille de propriétés.</span><span class="sxs-lookup"><span data-stu-id="b667b-114">The **DSOBJECTNAMES** structure contains data about the directory object that the property sheet extension applies to.</span></span>

<span data-ttu-id="b667b-115">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contient également des données au format [**CFSTR \_ DS \_ Display \_ spec \_ options**](cfstr-ds-display-spec-options.md) .</span><span class="sxs-lookup"><span data-stu-id="b667b-115">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) also contains data in the [**CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS**](cfstr-ds-display-spec-options.md) format.</span></span> <span data-ttu-id="b667b-116">Le format de données **CFSTR \_ DS \_ Display \_ spec \_ options** est un **HGLOBAL** qui contient une structure [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) .</span><span class="sxs-lookup"><span data-stu-id="b667b-116">The **CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS** data format is an **HGLOBAL** that contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure.</span></span> <span data-ttu-id="b667b-117">Le **DSDISPLAYSPECOPTIONS** contient des données de configuration utilisables par l’extension.</span><span class="sxs-lookup"><span data-stu-id="b667b-117">The **DSDISPLAYSPECOPTIONS** contains configuration data for use by the extension.</span></span>

<span data-ttu-id="b667b-118">Si une valeur autre que **S \_ OK** est retournée à partir de [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), l’extension du menu contextuel ne sera pas utilisée.</span><span class="sxs-lookup"><span data-stu-id="b667b-118">If any value other than **S\_OK** is returned from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), the context menu extension will not be used.</span></span>

<span data-ttu-id="b667b-119">Les paramètres *pidlFolder* et *hkeyProgID* de la méthode [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) ne sont pas utilisés.</span><span class="sxs-lookup"><span data-stu-id="b667b-119">The *pidlFolder* and *hkeyProgID* parameters of the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method are not used.</span></span>

## <a name="implementing-icontextmenu"></a><span data-ttu-id="b667b-120">Implémentation de IContextMenu</span><span class="sxs-lookup"><span data-stu-id="b667b-120">Implementing IContextMenu</span></span>

<span data-ttu-id="b667b-121">Après que [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) retourne, la méthode [**IContextMenu :: QueryContextMenu**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) est appelée pour obtenir l’élément de menu ou les éléments que l’extension de menu contextuel ajoutera.</span><span class="sxs-lookup"><span data-stu-id="b667b-121">After [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) returns, the [**IContextMenu::QueryContextMenu**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) method is called to obtain the menu item or items that the context menu extension will add.</span></span> <span data-ttu-id="b667b-122">L’implémentation de **QueryContextMenu** est relativement simple.</span><span class="sxs-lookup"><span data-stu-id="b667b-122">The **QueryContextMenu** implementation is fairly straightforward.</span></span> <span data-ttu-id="b667b-123">L’extension du menu contextuel ajoute ses éléments de menu à l’aide de la fonction [**InsertMenuItem**](/windows/win32/api/winuser/nf-winuser-insertmenuitema) ou similaire.</span><span class="sxs-lookup"><span data-stu-id="b667b-123">The context menu extension adds its menu items using the [**InsertMenuItem**](/windows/win32/api/winuser/nf-winuser-insertmenuitema) or similar function.</span></span> <span data-ttu-id="b667b-124">Les identificateurs de commandes de menu doivent être supérieurs ou égaux à *idCmdFirst* et doivent être inférieurs à *idCmdLast*.</span><span class="sxs-lookup"><span data-stu-id="b667b-124">The menu command identifiers must be greater than or equal to *idCmdFirst* and must be less than *idCmdLast*.</span></span> <span data-ttu-id="b667b-125">**QueryContextMenu** doit retourner le plus grand identificateur numérique ajouté au menu plus un.</span><span class="sxs-lookup"><span data-stu-id="b667b-125">**QueryContextMenu** must return the greatest numeric identifier added to the menu plus one.</span></span> <span data-ttu-id="b667b-126">La meilleure façon d’affecter des identificateurs de commandes de menu consiste à commencer à zéro et à travailler en séquence.</span><span class="sxs-lookup"><span data-stu-id="b667b-126">The best way to assign menu command identifiers is to start at zero and work up in sequence.</span></span> <span data-ttu-id="b667b-127">Si l’extension du menu contextuel n’a besoin d’aucun élément de menu, elle ne doit tout simplement pas ajouter d’éléments au menu et retourner zéro à partir de **QueryContextMenu**.</span><span class="sxs-lookup"><span data-stu-id="b667b-127">If the context menu extension does not need to any menu items, it should simply not add any items to the menu and return zero from **QueryContextMenu**.</span></span>

<span data-ttu-id="b667b-128">[**IContextMenu :: GetCommandString**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-getcommandstring) est appelé pour extraire des données textuelles pour l’élément de menu, telles que le texte d’aide à afficher pour l’élément de menu.</span><span class="sxs-lookup"><span data-stu-id="b667b-128">[**IContextMenu::GetCommandString**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-getcommandstring) is called to retrieve textual data for the menu item, such as help text to be displayed for the menu item.</span></span> <span data-ttu-id="b667b-129">Il est possible que l’hôte de menu contextuel utilise des chaînes Unicode alors que l’extension utilise des chaînes ANSI.</span><span class="sxs-lookup"><span data-stu-id="b667b-129">It is possible that the context menu host will use Unicode strings while the extension uses ANSI strings.</span></span> <span data-ttu-id="b667b-130">Pour cette raison, les **cas \_ GC HELPTEXTA**, **GC \_ HELPTEXTW**, **GC \_ Verba** et **GC \_ VERBW** doivent être traités individuellement.</span><span class="sxs-lookup"><span data-stu-id="b667b-130">Because of this, the **GCS\_HELPTEXTA**, **GCS\_HELPTEXTW**, **GCS\_VERBA** and **GCS\_VERBW** cases must be handled individually.</span></span> <span data-ttu-id="b667b-131">L’implémentation de cette méthode est facultative.</span><span class="sxs-lookup"><span data-stu-id="b667b-131">Implementation of this method is optional.</span></span>

<span data-ttu-id="b667b-132">[**IContextMenu :: commande InvokeCommand**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) est appelé quand l’un des éléments de menu installés par l’extension de menu contextuel est sélectionné.</span><span class="sxs-lookup"><span data-stu-id="b667b-132">[**IContextMenu::InvokeCommand**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) is called when one of the menu items installed by the context menu extension is selected.</span></span> <span data-ttu-id="b667b-133">Le menu contextuel exécute ou initie les actions souhaitées en réponse à cette méthode.</span><span class="sxs-lookup"><span data-stu-id="b667b-133">The context menu performs or initiates the desired actions in response to this method.</span></span>

 

 