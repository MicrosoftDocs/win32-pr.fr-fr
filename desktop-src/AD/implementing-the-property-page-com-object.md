---
title: Implémentation de l’objet COM de la page de propriétés
description: Une extension de feuille de propriétés est un objet COM implémenté en tant que serveur in-proc.
ms.assetid: 77a71086-1949-4828-801e-073ea5a6838b
ms.tgt_platform: multiple
keywords:
- Implémentation de l’objet COM de la page de propriétés
- Objet COM page de propriétés, implémentation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 55962002ca059ad6e9c137925d1ba21ba9adc513
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/17/2020
ms.locfileid: "103842070"
---
# <a name="implementing-the-property-page-com-object"></a><span data-ttu-id="3a5c2-105">Implémentation de l’objet COM de la page de propriétés</span><span class="sxs-lookup"><span data-stu-id="3a5c2-105">Implementing the Property Page COM Object</span></span>

<span data-ttu-id="3a5c2-106">Une extension de feuille de propriétés est un objet COM implémenté en tant que serveur in-proc.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-106">A property sheet extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="3a5c2-107">L’extension de la feuille de propriétés doit implémenter les interfaces [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) et [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-107">The property sheet extension must implement the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) and [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) interfaces.</span></span> <span data-ttu-id="3a5c2-108">Une extension de feuille de propriétés est instanciée lorsque l’utilisateur affiche la feuille de propriétés d’un objet d’une classe pour laquelle l’extension de la feuille de propriétés a été inscrite dans le spécificateur d’affichage de la classe.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-108">A property sheet extension is instantiated when the user displays the property sheet for an object of a class for which the property sheet extension has been registered in the display specifier of the class.</span></span>

-   [<span data-ttu-id="3a5c2-109">Implémentation de IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="3a5c2-109">Implementing IShellExtInit</span></span>](#implementing-ishellextinit)
-   [<span data-ttu-id="3a5c2-110">Implémentation de IShellPropSheetExt</span><span class="sxs-lookup"><span data-stu-id="3a5c2-110">Implementing IShellPropSheetExt</span></span>](#implementing-ishellpropsheetext)
-   [<span data-ttu-id="3a5c2-111">Passage de l’objet d’extension à la page de propriétés</span><span class="sxs-lookup"><span data-stu-id="3a5c2-111">Passing the Extension Object to the Property Page</span></span>](#passing-the-extension-object-to-the-property-page)
-   [<span data-ttu-id="3a5c2-112">Utilisation de l’objet de notification</span><span class="sxs-lookup"><span data-stu-id="3a5c2-112">Working With the Notification Object</span></span>](#working-with-the-notification-object)
-   [<span data-ttu-id="3a5c2-113">Divers</span><span class="sxs-lookup"><span data-stu-id="3a5c2-113">Miscellaneous</span></span>](#miscellaneous)
-   [<span data-ttu-id="3a5c2-114">Feuilles de propriétés à sélection multiple</span><span class="sxs-lookup"><span data-stu-id="3a5c2-114">Multiple-Selection Property Sheets</span></span>](#multiple-selection-property-sheets)
-   [<span data-ttu-id="3a5c2-115">Nouveauté de Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="3a5c2-115">New with Windows Server 2003</span></span>](#new-with-windows-server-2003)
-   [<span data-ttu-id="3a5c2-116">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="3a5c2-116">Related topics</span></span>](#related-topics)

## <a name="implementing-ishellextinit"></a><span data-ttu-id="3a5c2-117">Implémentation de IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="3a5c2-117">Implementing IShellExtInit</span></span>

<span data-ttu-id="3a5c2-118">Après l’instanciation de l’objet COM de l’extension de feuille de propriétés, la méthode [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) est appelée.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-118">After the property sheet extension COM object is instantiated, the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method is called.</span></span> <span data-ttu-id="3a5c2-119">**IShellExtInit :: Initialize** fournit l’extension de la feuille de propriétés avec un objet [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) qui contient des données relatives à l’objet d’annuaire que la feuille de propriétés applique.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-119">**IShellExtInit::Initialize** supplies the property sheet extension with an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) object that contains data that pertains to the directory object that the property sheet applies.</span></span>

<span data-ttu-id="3a5c2-120">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contient des données au format [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-120">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contains data in the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) format.</span></span> <span data-ttu-id="3a5c2-121">Le format de données **CFSTR \_ DSOBJECTNAMES** est un **HGLOBAL** qui contient une structure [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-121">The **CFSTR\_DSOBJECTNAMES** data format is an **HGLOBAL** that contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure.</span></span> <span data-ttu-id="3a5c2-122">La structure **DSOBJECTNAMES** contient des données d’objet d’annuaire que l’extension de feuille de propriétés applique.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-122">The **DSOBJECTNAMES** structure contains directory object data that the property sheet extension applies.</span></span>

<span data-ttu-id="3a5c2-123">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contient également des données au format [**CFSTR \_ DS \_ Display \_ spec \_ options**](cfstr-ds-display-spec-options.md) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-123">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) also contains data in the [**CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS**](cfstr-ds-display-spec-options.md) format.</span></span> <span data-ttu-id="3a5c2-124">Le format de données **CFSTR \_ DS \_ Display \_ spec \_ options** est un **HGLOBAL** qui contient une structure [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-124">The **CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS** data format is an **HGLOBAL** that contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure.</span></span> <span data-ttu-id="3a5c2-125">Le **DSDISPLAYSPECOPTIONS** contient des données de configuration utilisables par l’extension.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-125">The **DSDISPLAYSPECOPTIONS** contains configuration data for use by the extension.</span></span>

<span data-ttu-id="3a5c2-126">Si une valeur autre que **S \_ OK** est retournée à partir de [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), la feuille de propriétés n’est pas affichée.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-126">If any value other than **S\_OK** is returned from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), the property sheet is not displayed.</span></span>

<span data-ttu-id="3a5c2-127">Les paramètres *pidlFolder* et *hkeyProgID* de la méthode [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) ne sont pas utilisés.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-127">The *pidlFolder* and *hkeyProgID* parameters of the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method are not used.</span></span>

<span data-ttu-id="3a5c2-128">Le pointeur [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) peut être enregistré par l’extension en incrémentant le décompte de références de l' **IDataObject**.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-128">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer can be saved by the extension by incrementing the reference count of the **IDataObject**.</span></span> <span data-ttu-id="3a5c2-129">Cette interface doit être libérée lorsque vous n’en avez plus besoin.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-129">This interface must be released when no longer required.</span></span>

## <a name="implementing-ishellpropsheetext"></a><span data-ttu-id="3a5c2-130">Implémentation de IShellPropSheetExt</span><span class="sxs-lookup"><span data-stu-id="3a5c2-130">Implementing IShellPropSheetExt</span></span>

<span data-ttu-id="3a5c2-131">Après que [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) retourne, la méthode [**IShellPropSheetExt :: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) est appelée.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-131">After [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) returns, the [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) method is called.</span></span> <span data-ttu-id="3a5c2-132">L’extension de la feuille de propriétés doit ajouter la ou les pages pendant cette méthode.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-132">The property sheet extension must add the page or pages during this method.</span></span> <span data-ttu-id="3a5c2-133">Une page de propriétés est créée en remplissant une structure [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) , puis en passant cette structure à la fonction [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-133">A property page is created by filling a [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and then passing this structure to the [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) function.</span></span> <span data-ttu-id="3a5c2-134">La page de propriétés est ensuite ajoutée à la feuille de propriétés en appelant la fonction de rappel transmise à **IShellPropSheetExt :: AddPages** dans le paramètre *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-134">The property page is then added to the property sheet by calling the callback function passed to **IShellPropSheetExt::AddPages** in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="3a5c2-135">Si une valeur autre que **S \_ OK** est retournée à partir de [**IShellPropSheetExt :: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages), la feuille de propriétés n’est pas affichée.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-135">If any value other than **S\_OK** is returned from [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages), the property sheet is not displayed.</span></span>

<span data-ttu-id="3a5c2-136">Si l’extension de la feuille de propriétés n’est pas requise pour ajouter des pages à la feuille de propriétés, elle ne doit pas appeler la fonction de rappel transmise à [**IShellPropSheetExt :: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) dans le paramètre *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-136">If the property sheet extension is not required to add any pages to the property sheet, it should not call the callback function passed to [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="3a5c2-137">La méthode [**IShellPropSheetExt :: ReplacePage**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-replacepage) n’est pas utilisée.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-137">The [**IShellPropSheetExt::ReplacePage**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-replacepage) method is not used.</span></span>

## <a name="passing-the-extension-object-to-the-property-page"></a><span data-ttu-id="3a5c2-138">Passage de l’objet d’extension à la page de propriétés</span><span class="sxs-lookup"><span data-stu-id="3a5c2-138">Passing the Extension Object to the Property Page</span></span>

<span data-ttu-id="3a5c2-139">L’objet d’extension de la feuille de propriétés est indépendant de la page de propriétés.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-139">The property sheet extension object is independent from the property page.</span></span> <span data-ttu-id="3a5c2-140">Dans de nombreux cas, il est préférable d’être en mesure d’utiliser l’objet d’extension, ou un autre objet, à partir de la page de propriétés.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-140">In many cases, it is desirable to be able to use the extension object, or some other object, from the property page.</span></span> <span data-ttu-id="3a5c2-141">Pour ce faire, définissez le membre **lParam** de la structure [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) sur le pointeur d’objet.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-141">To do this, set the **lParam** member of [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure to the object pointer.</span></span> <span data-ttu-id="3a5c2-142">La page de propriétés peut ensuite récupérer cette valeur lors du traitement du message [**WM \_ INITDIALOG**](../dlgbox/wm-initdialog.md) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-142">The property page can then retrieve this value when it processes the [**WM\_INITDIALOG**](../dlgbox/wm-initdialog.md) message.</span></span> <span data-ttu-id="3a5c2-143">Pour une page de propriétés, le paramètre *lParam* du message **WM \_ INITDIALOG** est un pointeur vers la structure **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-143">For a property page, the *lParam* parameter of the **WM\_INITDIALOG** message is a pointer to the **PROPSHEETPAGE** structure.</span></span> <span data-ttu-id="3a5c2-144">Récupérez le pointeur d’objet en castant le *lParam* du message **WM \_ INITDIALOG** en pointeur **PROPSHEETPAGE** , puis en récupérant le membre **lParam** de la structure **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-144">Retrieve the object pointer by casting the *lParam* of the **WM\_INITDIALOG** message to a **PROPSHEETPAGE** pointer and then retrieving the **lParam** member of the **PROPSHEETPAGE** structure.</span></span>

<span data-ttu-id="3a5c2-145">L’exemple de code C++ suivant montre comment passer un objet à une page de propriétés.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-145">The following C++ code example shows how to pass an object to a property page.</span></span>


```C++
case WM_INITDIALOG:
    {
        LPPROPSHEETPAGE pPage = (LPPROPSHEETPAGE)lParam;

        if(NULL != pPage)
        {
            CPropSheetExt *pPropSheetExt;
            pPropSheetExt = (CPropSheetExt*)pPage->lParam;

            if(pPropSheetExt)
            {
                return pPropSheetExt>OnInitDialog(wParam, lParam);
            }
        }
    }
    break;
```



<span data-ttu-id="3a5c2-146">Sachez qu’après l’appel de [**IShellPropSheetExt :: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) , la feuille de propriétés libère l’objet d’extension de la feuille de propriétés et ne l’utilise jamais.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-146">Be aware that after [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) is called, the property sheet will release the property sheet extension object and never use it again.</span></span> <span data-ttu-id="3a5c2-147">Cela signifie que l’objet d’extension est supprimé avant l’affichage de la page de propriétés.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-147">This means that the extension object would be deleted before the property page is displayed.</span></span> <span data-ttu-id="3a5c2-148">Lorsque la page tente d’accéder au pointeur d’objet, la mémoire est libérée et le pointeur n’est pas valide.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-148">When the page attempts to access the object pointer, the memory will have been freed and the pointer will not be valid.</span></span> <span data-ttu-id="3a5c2-149">Pour corriger cela, incrémentez le décompte de références pour l’objet d’extension lorsque la page est ajoutée, puis libérez l’objet lorsque la boîte de dialogue de la page de propriétés est détruite.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-149">To correct this, increment the reference count for the extension object when the page is added and then release the object when the property page dialog is destroyed.</span></span> <span data-ttu-id="3a5c2-150">Cela crée un autre problème, car la boîte de dialogue page de propriétés n’est pas créée tant que la page n’est pas affichée pour la première fois.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-150">This creates another issue because the property page dialog box is not created until the first time the page is displayed.</span></span> <span data-ttu-id="3a5c2-151">Si l’utilisateur ne sélectionne jamais la page d’extension, la page n’est jamais créée ni détruite.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-151">If the user never selects the extension page, the page never gets created and destroyed.</span></span> <span data-ttu-id="3a5c2-152">Cela a pour effet que l’objet d’extension n’est jamais libéré, ce qui entraîne une fuite de mémoire.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-152">This results in the extension object never getting released, so a memory leak occurs.</span></span> <span data-ttu-id="3a5c2-153">Pour éviter cela, implémentez une fonction de rappel de page de propriétés.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-153">To avoid this, implement a property page callback function.</span></span> <span data-ttu-id="3a5c2-154">Pour ce faire, ajoutez l' **indicateur PSP \_ USECALLBACK** au membre **DwFlags** de la structure [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) et définissez le membre **pfnCallback** de la structure **PROPSHEETPAGE** sur l’adresse de la fonction [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) implémentée.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-154">To do this, add the **PSP\_USECALLBACK** flag to the **dwFlags** member of the [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and set the **pfnCallback** member of the **PROPSHEETPAGE** structure to the address of the [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) function implemented.</span></span> <span data-ttu-id="3a5c2-155">Lorsque la fonction **PropSheetPageProc** reçoit la notification de **\_ publication PSPCB** , le paramètre *PPSP* de l' **PropSheetPageProc** contient un pointeur vers la structure **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-155">When the **PropSheetPageProc** function receives the **PSPCB\_RELEASE** notification, the *ppsp* parameter of the **PropSheetPageProc** contains a pointer to the **PROPSHEETPAGE** structure.</span></span> <span data-ttu-id="3a5c2-156">Le membre **lParam** de la structure **PROPSHEETPAGE** contient le pointeur d’extension qui peut être utilisé pour libérer l’objet.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-156">The **lParam** member of the **PROPSHEETPAGE** structure contains the extension pointer which can be used to release the object.</span></span>

<span data-ttu-id="3a5c2-157">L’exemple de code C++ suivant montre comment libérer un objet d’extension.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-157">The following C++ code example shows how to release an extension object.</span></span>


```C++
UINT CALLBACK CPropSheetExt::PageCallbackProc(  HWND hWnd,
                                                UINT uMsg,
                                                LPPROPSHEETPAGE ppsp)
{
    switch(uMsg)
    {
    case PSPCB_CREATE:
        // Must return TRUE to enable the page to be created.
        return TRUE;

    case PSPCB_RELEASE:
        {
            /*
            Release the object. This is called even if the page dialog box was 
            never actually created.
            */
            CPropSheetExt *pPropSheetExt = (CPropSheetExt*)ppsp->lParam;

            if(pPropSheetExt)
            {
                pPropSheetExt->Release();
            }
        }
        break;
    }

    return FALSE;
}
```



## <a name="working-with-the-notification-object"></a><span data-ttu-id="3a5c2-158">Utilisation de l’objet de notification</span><span class="sxs-lookup"><span data-stu-id="3a5c2-158">Working With the Notification Object</span></span>

<span data-ttu-id="3a5c2-159">Étant donné que les pages de l’extension de la feuille de propriétés sont affichées dans une feuille de propriétés créée par un composant inconnu de l’extension, il est nécessaire d’utiliser un « gestionnaire » pour gérer le transfert de données entre les pages d’extension et la feuille de propriétés.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-159">Because the property sheet extension pages are displayed within a property sheet created by a component unknown to the extension, it is necessary to use a "manager" to handle the data transfer between the extension pages and the property sheet.</span></span> <span data-ttu-id="3a5c2-160">Ce « gestionnaire » est appelé « objet de notification ».</span><span class="sxs-lookup"><span data-stu-id="3a5c2-160">This "manager" is called the notification object.</span></span> <span data-ttu-id="3a5c2-161">L’objet de notification agit comme un modérateur entre les pages individuelles et la feuille de propriétés.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-161">The notification object operates as a moderator between the individual pages and the property sheet.</span></span>

<span data-ttu-id="3a5c2-162">Lorsque l’objet d’extension de la feuille de propriétés est initialisé, l’extension doit créer un objet de notification en appelant [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj), en transmettant l' [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtenu à partir de [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) et le nom d’objet d’annuaire.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-162">When the property sheet extension object is initialized, the extension must create a notification object by calling [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj), passing the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtained from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) and the directory object name.</span></span> <span data-ttu-id="3a5c2-163">Il n’est pas nécessaire d’incrémenter le décompte de références de l’interface **IDataObject** , car l’objet de notification créé par la fonction **ADsPropCreateNotifyObj** effectue cette opération.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-163">It is not necessary to increment the reference count of the **IDataObject** interface, because the notification object created by **ADsPropCreateNotifyObj** function will do this.</span></span> <span data-ttu-id="3a5c2-164">Le descripteur d’objet de notification fourni par **ADsPropCreateNotifyObj** doit être enregistré pour une utilisation ultérieure.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-164">The notification object handle provided by **ADsPropCreateNotifyObj** should be saved for later use.</span></span> <span data-ttu-id="3a5c2-165">**ADsPropCreateNotifyObj** peut être appelé lors de **IShellExtInit :: Initialize** ou [**IShellPropSheetExt :: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages).</span><span class="sxs-lookup"><span data-stu-id="3a5c2-165">**ADsPropCreateNotifyObj** can be either called during **IShellExtInit::Initialize** or [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages).</span></span> <span data-ttu-id="3a5c2-166">Lorsque l’extension de la feuille de propriétés est arrêtée, elle doit envoyer un message de [**\_ \_ \_ sortie de notification WM ADSPROP**](wm-adsprop-notify-exit.md) à l’objet de notification.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-166">When the property sheet extension is shut down, it must send a [**WM\_ADSPROP\_NOTIFY\_EXIT**](wm-adsprop-notify-exit.md) message to the notification object.</span></span> <span data-ttu-id="3a5c2-167">L’objet de notification se détruit alors lui-même.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-167">This causes the notification object to destroy itself.</span></span> <span data-ttu-id="3a5c2-168">Cela s’effectue de façon optimale lorsque la fonction [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) reçoit la notification de **\_ publication PSPCB** .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-168">This is best done when the [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) function receives the **PSPCB\_RELEASE** notification.</span></span>

<span data-ttu-id="3a5c2-169">L’extension de la feuille de propriétés peut obtenir des données en plus de celles fournies par le format de presse-papiers [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) en appelant [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo).</span><span class="sxs-lookup"><span data-stu-id="3a5c2-169">The property sheet extension can obtain data in addition to that provided by the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard format by calling [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo).</span></span> <span data-ttu-id="3a5c2-170">L’un des avantages de l’utilisation de **ADsPropGetInitInfo** est qu’il fournit un objet [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) utilisé pour travailler par programmation avec l’objet Directory.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-170">One of the advantages of using **ADsPropGetInitInfo** is that it provides an [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) object used to programmatically work with the directory object.</span></span>

> [!Note]  
> <span data-ttu-id="3a5c2-171">Contrairement à la plupart des méthodes et des fonctions COM, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) n’incrémente pas le nombre de références pour l’objet [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-171">Unlike most COM methods and functions, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) does not increment the reference count for the [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) object.</span></span> <span data-ttu-id="3a5c2-172">Le **IDirectoryObject** ne doit pas être libéré, sauf si le nombre de références est incrémenté manuellement en premier.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-172">The **IDirectoryObject** must not be released unless the reference count is manually incremented first.</span></span>

 

<span data-ttu-id="3a5c2-173">Lorsque la page de propriétés est créée pour la première fois, l’extension doit inscrire la page avec l’objet de notification en appelant [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd) avec le handle de fenêtre de la page.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-173">When the property page is first created, the extension should register the page with the notification object by calling [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd) with the window handle of the page.</span></span>

<span data-ttu-id="3a5c2-174">[**ADsPropCheckIfWritable**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcheckifwritable) est une fonction utilitaire que l’extension de feuille de propriétés peut utiliser pour déterminer si une propriété peut être écrite.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-174">[**ADsPropCheckIfWritable**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcheckifwritable) is a utility function that the property sheet extension can use to determine if a property can be written.</span></span>

## <a name="miscellaneous"></a><span data-ttu-id="3a5c2-175">Divers</span><span class="sxs-lookup"><span data-stu-id="3a5c2-175">Miscellaneous</span></span>

<span data-ttu-id="3a5c2-176">Le handle de la page de propriétés est passé à la procédure de la boîte de dialogue de la page.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-176">The handle of the property page is passed to the page dialog box procedure.</span></span> <span data-ttu-id="3a5c2-177">La feuille de propriétés étant le parent direct de la page de propriétés, le handle de la feuille de propriétés peut être obtenu en appelant la fonction [**GetParent**](/windows/win32/api/winuser/nf-winuser-getparent) avec le handle de la page de propriétés.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-177">The property sheet is the direct parent of the property page, so the handle of the property sheet can be obtained by calling the [**GetParent**](/windows/win32/api/winuser/nf-winuser-getparent) function with the property page handle.</span></span>

<span data-ttu-id="3a5c2-178">Lorsque le contenu de la page d’extension change, l’extension doit utiliser la macro [**PropSheet \_ Changed**](/windows/win32/api/prsht/nf-prsht-propsheet_changed) pour notifier la feuille de propriétés des modifications.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-178">When the contents of the extension page changes, the extension should use the [**PropSheet\_Changed**](/windows/win32/api/prsht/nf-prsht-propsheet_changed) macro to notify the property sheet of changes.</span></span> <span data-ttu-id="3a5c2-179">La feuille de propriétés activera ensuite le bouton appliquer.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-179">The property sheet will then enable the Apply button.</span></span>

## <a name="multiple-selection-property-sheets"></a><span data-ttu-id="3a5c2-180">Multiple-Selection les feuilles de propriétés</span><span class="sxs-lookup"><span data-stu-id="3a5c2-180">Multiple-Selection Property Sheets</span></span>

<span data-ttu-id="3a5c2-181">Avec les systèmes d’exploitation Windows Server 2003 et versions ultérieures, le Active Directory composants logiciels enfichables MMC d’administration prennent en charge les extensions de feuille de propriétés pour plusieurs objets d’annuaire.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-181">With Windows Server 2003 and later operating systems, the Active Directory administrative MMC snap-ins support property sheet extensions for multiple directory objects.</span></span> <span data-ttu-id="3a5c2-182">Ces feuilles de propriétés s’affichent lorsque les propriétés sont affichées pour plusieurs éléments à la fois.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-182">These property sheets are displayed when the properties are viewed for more than one item at a time.</span></span> <span data-ttu-id="3a5c2-183">La principale différence entre une extension de feuille de propriétés à sélection unique et une extension de feuille de propriétés à sélection multiple est que la structure [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) fournie par le format de presse-papiers [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) dans [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) contient plus d’une structure [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-183">The primary difference between a single-selection property sheet extension and a multiple-selection property sheet extension is that the [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure supplied by the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard format in [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) will contain more than one [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) structure.</span></span>

<span data-ttu-id="3a5c2-184">Lorsque l’objet de notification est créé, une extension de feuille de propriétés à sélection multiple doit passer un nom unique fourni par le composant logiciel enfichable au lieu d’un nom créé par l’extension.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-184">When the notification object is created, a multi-selection property sheet extension must pass a unique name that is provided by the snap-in rather than a name created by the extension.</span></span> <span data-ttu-id="3a5c2-185">Pour obtenir le nom unique, demandez le format du presse-papiers [**CFSTR \_ DS \_ MULTISELECTPROPPAGE**](cfstr-ds-multiselectproppage.md) à partir de l' [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtenu auprès de [**IShellExtInit :: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span><span class="sxs-lookup"><span data-stu-id="3a5c2-185">To obtain the unique name, request the [**CFSTR\_DS\_MULTISELECTPROPPAGE**](cfstr-ds-multiselectproppage.md) clipboard format from the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtained from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span></span> <span data-ttu-id="3a5c2-186">Ces données sont un **HGLOBAL** qui contient une chaîne Unicode terminée par le caractère null qui est le nom unique.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-186">This data is an **HGLOBAL** that contains a null-terminated Unicode string that is the unique name.</span></span> <span data-ttu-id="3a5c2-187">Ce nom unique est ensuite transmis à la fonction [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj) pour créer l’objet de notification.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-187">This unique name is then passed to the [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj) function to create the notification object.</span></span> <span data-ttu-id="3a5c2-188">La fonction exemple **CreateADsNotificationObject** dans l' [exemple de code pour l’implémentation de l’objet com de la feuille de propriétés](example-code-for-implementation-of-the-property-sheet-com-object.md) montre comment effectuer cette opération correctement, ainsi que la compatibilité avec les versions antérieures du composant logiciel enfichable qui ne prennent pas en charge les feuilles de propriétés à sélection multiple.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-188">The **CreateADsNotificationObject** example function in [Example Code for Implementation of the Property Sheet COM Object](example-code-for-implementation-of-the-property-sheet-com-object.md) demonstrates how to do this correctly, as well as being compatible with earlier versions of the snap-in that do not support multi-selection property sheets.</span></span>

<span data-ttu-id="3a5c2-189">Pour les feuilles de propriétés à sélection multiple, le système se lie uniquement au premier objet dans le tableau [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-189">For multiple-selection property sheets, the system only binds to the first object in the [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) array.</span></span> <span data-ttu-id="3a5c2-190">Pour cette raison, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) fournit uniquement les attributs [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) et en écriture pour le premier objet du tableau.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-190">Because of this, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) only supplies the [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) and write-able attributes for the first object in the array.</span></span> <span data-ttu-id="3a5c2-191">Les autres objets dans le tableau ne sont pas liés à.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-191">The other objects in the array are not bound to.</span></span>

<span data-ttu-id="3a5c2-192">Une extension de feuille de propriétés à sélection multiple est inscrite sous l’attribut [**adminMultiselectPropertyPages**](/windows/desktop/ADSchema/a-adminmultiselectpropertypages) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-192">A multiple-selection property sheet extension is registered under the [**adminMultiselectPropertyPages**](/windows/desktop/ADSchema/a-adminmultiselectpropertypages) attribute.</span></span>

## <a name="new-with-windows-server-2003"></a><span data-ttu-id="3a5c2-193">Nouveauté de Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="3a5c2-193">New with Windows Server 2003</span></span>

<span data-ttu-id="3a5c2-194">Les fonctionnalités suivantes sont nouvelles dans Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-194">The following features are new with Windows Server 2003.</span></span>

<span data-ttu-id="3a5c2-195">Si la page de propriétés rencontre une erreur, [**ADsPropSendErrorMessage**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsenderrormessage) peut être appelée avec les données d’erreur appropriées.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-195">If the property page encounters an error, [**ADsPropSendErrorMessage**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsenderrormessage) can be called with the appropriate error data.</span></span> <span data-ttu-id="3a5c2-196">**ADsPropSendErrorMessage** stocke tous les messages d’erreur dans une file d’attente.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-196">**ADsPropSendErrorMessage** will store all error messages in a queue.</span></span> <span data-ttu-id="3a5c2-197">Ces messages seront affichés lors de l’appel suivant de [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-197">These messages will be displayed the next time [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) is called.</span></span> <span data-ttu-id="3a5c2-198">Quand **ADsPropShowErrorDialog** retourne, les messages mis en file d’attente sont supprimés.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-198">When **ADsPropShowErrorDialog** returns, the queued messages are deleted.</span></span>

<span data-ttu-id="3a5c2-199">Windows Server 2003 introduit la fonction [**ADsPropSetHwndWithTitle**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwndwithtitle) .</span><span class="sxs-lookup"><span data-stu-id="3a5c2-199">Windows Server 2003 introduces the [**ADsPropSetHwndWithTitle**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwndwithtitle) function.</span></span> <span data-ttu-id="3a5c2-200">Cette fonction est similaire à [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd), mais elle comprend le titre de la page.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-200">This function is similar to [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd), but includes the page title.</span></span> <span data-ttu-id="3a5c2-201">Cela active la boîte de dialogue d’erreur affichée par [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) pour fournir des données plus utiles à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-201">This enables the error dialog box displayed by [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) to provide more useful data to the user.</span></span> <span data-ttu-id="3a5c2-202">Si l’extension de la feuille de propriétés utilise la fonction **ADsPropShowErrorDialog** , l’extension doit utiliser **ADsPropSetHwndWithTitle** au lieu de **ADsPropSetHwnd**.</span><span class="sxs-lookup"><span data-stu-id="3a5c2-202">If the property sheet extension uses the **ADsPropShowErrorDialog** function, the extension should use **ADsPropSetHwndWithTitle** rather than **ADsPropSetHwnd**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3a5c2-203">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="3a5c2-203">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3a5c2-204">Exemple de code pour l’implémentation de l’objet COM de la feuille de propriétés</span><span class="sxs-lookup"><span data-stu-id="3a5c2-204">Example Code for Implementation of the Property Sheet COM Object</span></span>](example-code-for-implementation-of-the-property-sheet-com-object.md)
</dt> </dl>

 

 