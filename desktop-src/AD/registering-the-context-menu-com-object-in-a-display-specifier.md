---
title: Inscription de l’objet COM du menu contextuel dans un spécificateur d’affichage
description: Cette rubrique présente les clés de Registre qui doivent être modifiées pour inscrire un objet COM de menu contextuel.
ms.assetid: 389bc249-4849-4763-9d1b-b35598a51050
ms.tgt_platform: multiple
keywords:
- Inscription de l’objet COM du menu contextuel dans un spécificateur d’affichage
- objet COM du menu contextuel, inscription
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 62ae30c1a60a1a0bc5a8ec388a3578ab13829c95
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/17/2020
ms.locfileid: "104030987"
---
# <a name="registering-the-context-menu-com-object-in-a-display-specifier"></a><span data-ttu-id="ad340-105">Inscription de l’objet COM du menu contextuel dans un spécificateur d’affichage</span><span class="sxs-lookup"><span data-stu-id="ad340-105">Registering the Context Menu COM Object in a Display Specifier</span></span>

<span data-ttu-id="ad340-106">Lorsque vous utilisez COM pour créer une DLL d’extension de menu contextuel pour un service d’annuaire Active Directory, l’extension doit être inscrite auprès du Registre Windows et Active Directory Domain Services pour notifier les Active Directory composants logiciels enfichables MMC d’administration et le shell Windows de l’extension.</span><span class="sxs-lookup"><span data-stu-id="ad340-106">When you use COM to create a context menu extension DLL for an Active Directory directory service, the extension must be registered with the Windows registry and Active Directory Domain Services to notify the Active Directory administrative MMC snap-ins and the Windows shell of the extension.</span></span>

## <a name="registering-in-the-windows-registry"></a><span data-ttu-id="ad340-107">Inscription dans le Registre Windows</span><span class="sxs-lookup"><span data-stu-id="ad340-107">Registering in the Windows Registry</span></span>

<span data-ttu-id="ad340-108">Comme tous les serveurs COM, une extension de menu contextuel doit être inscrite dans le registre.</span><span class="sxs-lookup"><span data-stu-id="ad340-108">Like all COM servers, a context menu extension must be registered in the registry.</span></span> <span data-ttu-id="ad340-109">L’extension est inscrite sous la clé suivante.</span><span class="sxs-lookup"><span data-stu-id="ad340-109">The extension is registered under the following key.</span></span>

```
HKEY_CLASSES_ROOT
   CLSID
      <clsid>
```

<span data-ttu-id="ad340-110">*<clsid>* représentation sous forme de chaîne du CLSID telle qu’elle est produite par la fonction [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) .</span><span class="sxs-lookup"><span data-stu-id="ad340-110">*<clsid>* is the string representation of the CLSID as produced by the [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) function.</span></span> <span data-ttu-id="ad340-111">Sous la *<clsid>* clé, il existe une clé **InprocServer32** qui identifie l’objet en tant que serveur in-proc 32 bits.</span><span class="sxs-lookup"><span data-stu-id="ad340-111">Under the *<clsid>* key, there is an **InProcServer32** key that identifies the object as a 32-bit in-proc server.</span></span> <span data-ttu-id="ad340-112">Sous la clé **InprocServer32** , l’emplacement de la dll est spécifié dans la valeur par défaut et le modèle de thread est spécifié dans la valeur **ThreadingModel** .</span><span class="sxs-lookup"><span data-stu-id="ad340-112">Under the **InProcServer32** key, the location of the DLL is specified in the default value and the threading model is specified in the **ThreadingModel** value.</span></span> <span data-ttu-id="ad340-113">Toutes les extensions de menu contextuel doivent utiliser le modèle de thread « Apartment ».</span><span class="sxs-lookup"><span data-stu-id="ad340-113">All context menu extension must use the "Apartment" threading model.</span></span>

## <a name="registering-with-active-directory-domain-services"></a><span data-ttu-id="ad340-114">Inscription avec Active Directory Domain Services</span><span class="sxs-lookup"><span data-stu-id="ad340-114">Registering with Active Directory Domain Services</span></span>

<span data-ttu-id="ad340-115">L’inscription de l’extension du menu contextuel est spécifique à un paramètre régional.</span><span class="sxs-lookup"><span data-stu-id="ad340-115">Context menu extension registration is specific to one locale.</span></span> <span data-ttu-id="ad340-116">Si l’extension du menu contextuel s’applique à tous les paramètres régionaux, elle doit être inscrite dans l’objet [**displaySpecifier**](/windows/desktop/ADSchema/c-displayspecifier) de la classe d’objet dans tous les sous-conteneurs de paramètres régionaux dans le conteneur de spécificateurs d’affichage.</span><span class="sxs-lookup"><span data-stu-id="ad340-116">If the context menu extension applies to all locales, it must be registered in the object class [**displaySpecifier**](/windows/desktop/ADSchema/c-displayspecifier) object in all of the locale subcontainers in the Display Specifiers container.</span></span> <span data-ttu-id="ad340-117">Si l’extension de menu contextuel est localisée pour un certain nombre de paramètres régionaux, elle doit être inscrite dans l’objet **displaySpecifier** dans le sous-conteneur de ces paramètres régionaux.</span><span class="sxs-lookup"><span data-stu-id="ad340-117">If the context menu extension is localized for a certain locale, it must be registered in the **displaySpecifier** object in that locale's subcontainer.</span></span> <span data-ttu-id="ad340-118">Pour plus d’informations sur le conteneur et les paramètres régionaux des spécificateurs d’affichage, consultez [spécificateurs d’affichage](display-specifiers.md) et [conteneur DisplaySpecifiers](displayspecifiers-container.md).</span><span class="sxs-lookup"><span data-stu-id="ad340-118">For more information about the Display Specifiers container and locales, see [Display Specifiers](display-specifiers.md) and [DisplaySpecifiers Container](displayspecifiers-container.md).</span></span>

<span data-ttu-id="ad340-119">Il existe deux attributs de spécificateur d’affichage sous lesquels un élément d’extension de menu contextuel peut être inscrit.</span><span class="sxs-lookup"><span data-stu-id="ad340-119">There are two display specifier attributes that a context menu extension item can be registered under.</span></span> <span data-ttu-id="ad340-120">Il s’agit de [**adminContextMenu**](/windows/desktop/ADSchema/a-admincontextmenu) et [**shellContextMenu**](/windows/desktop/ADSchema/a-shellcontextmenu).</span><span class="sxs-lookup"><span data-stu-id="ad340-120">These are [**adminContextMenu**](/windows/desktop/ADSchema/a-admincontextmenu) and [**shellContextMenu**](/windows/desktop/ADSchema/a-shellcontextmenu).</span></span>

<span data-ttu-id="ad340-121">L’attribut [**adminContextMenu**](/windows/desktop/ADSchema/a-admincontextmenu) identifie les menus contextuels d’administration à afficher dans Active Directory composants logiciels enfichables d’administration. Le menu contextuel s’affiche lorsque l’utilisateur affiche le menu contextuel pour les objets de la classe appropriée dans l’un des composants logiciels enfichables MMC d’administration de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ad340-121">The [**adminContextMenu**](/windows/desktop/ADSchema/a-admincontextmenu) attribute identifies administrative context menus to display in Active Directory administrative snap-ins. The context menu appears when the user displays the context menu for objects of the appropriate class in one of the Active Directory administrative MMC snap-ins.</span></span>

<span data-ttu-id="ad340-122">L’attribut [**shellContextMenu**](/windows/desktop/ADSchema/a-shellcontextmenu) identifie les menus contextuels de l’utilisateur final à afficher dans le shell Windows.</span><span class="sxs-lookup"><span data-stu-id="ad340-122">The [**shellContextMenu**](/windows/desktop/ADSchema/a-shellcontextmenu) attribute identifies end-user context menus to display in the Windows shell.</span></span> <span data-ttu-id="ad340-123">Le menu contextuel s’affiche lorsque l’utilisateur consulte le menu contextuel des objets de la classe appropriée dans l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="ad340-123">The context menu appears when the user views the context menu for objects of the appropriate class in the Windows Explorer.</span></span> <span data-ttu-id="ad340-124">À partir de Windows Server 2003, l’interpréteur de commandes Windows n’affiche plus d’objets de Active Directory Domain Services.</span><span class="sxs-lookup"><span data-stu-id="ad340-124">Beginning with Windows Server 2003, the Windows shell no longer displays objects of Active Directory Domain Services.</span></span>

<span data-ttu-id="ad340-125">Tous ces attributs sont à valeurs multiples.</span><span class="sxs-lookup"><span data-stu-id="ad340-125">All of these attributes are multi-valued.</span></span>

<span data-ttu-id="ad340-126">Lors de l’inscription d’une extension de menu contextuel, les valeurs des attributs [**adminContextMenu**](/windows/desktop/ADSchema/a-admincontextmenu) et [**shellContextMenu**](/windows/desktop/ADSchema/a-shellcontextmenu) requièrent le format suivant.</span><span class="sxs-lookup"><span data-stu-id="ad340-126">When registering a context menu extension, the values for the [**adminContextMenu**](/windows/desktop/ADSchema/a-admincontextmenu) and [**shellContextMenu**](/windows/desktop/ADSchema/a-shellcontextmenu) attributes require the following format.</span></span>


```C++
<order number>,<clsid>
```



<span data-ttu-id="ad340-127">« &lt; Order Number &gt; » est un nombre non signé qui représente la position de l’élément dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="ad340-127">The "&lt;order number&gt;" is an unsigned number that represents the item position in the context menu.</span></span> <span data-ttu-id="ad340-128">Lorsqu’un menu contextuel s’affiche, les valeurs sont triées à l’aide d’une comparaison de la valeur « &lt; Order Number » de chaque valeur &gt; .</span><span class="sxs-lookup"><span data-stu-id="ad340-128">When a context menu is displayed, the values are sorted using a comparison of each value's "&lt;order number&gt;".</span></span> <span data-ttu-id="ad340-129">Si plusieurs valeurs ont le même « numéro de &lt; commande &gt; », ces extensions de menu contextuel sont chargées dans l’ordre dans lequel elles sont lues à partir du serveur de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ad340-129">If more than one value has the same "&lt;order number&gt;", those context menu extensions are loaded in the order they are read from the Active Directory server.</span></span> <span data-ttu-id="ad340-130">Si possible, utilisez un « numéro d’ordre » non existant &lt; &gt; , autrement dit un « numéro d’ordre » qui n’a pas été utilisé par d’autres valeurs de la propriété.</span><span class="sxs-lookup"><span data-stu-id="ad340-130">If possible, use a non-existing "&lt;order number&gt;", that is, one that has not been used by other values in the property.</span></span> <span data-ttu-id="ad340-131">Il n’existe pas de position de départ prescrite et les espaces sont autorisés dans la &lt; séquence « Order Number &gt; ».</span><span class="sxs-lookup"><span data-stu-id="ad340-131">There is no prescribed starting position and gaps are allowed in the "&lt;order number&gt;" sequence.</span></span>

<span data-ttu-id="ad340-132">Le &lt; CLSID &gt; est la représentation sous forme de chaîne du CLSID tel qu’il a été généré par la fonction [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) .</span><span class="sxs-lookup"><span data-stu-id="ad340-132">The "&lt;clsid&gt;" is the string representation of the CLSID as produced by the [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) function.</span></span>

<span data-ttu-id="ad340-133">Dans le shell Windows, les éléments de menu contextuel à sélection multiple sont pris en charge.</span><span class="sxs-lookup"><span data-stu-id="ad340-133">In the Windows shell, multiple-selection context menu items are supported.</span></span> <span data-ttu-id="ad340-134">Dans ce cas, l’extension du menu contextuel est appelée pour chaque objet sélectionné.</span><span class="sxs-lookup"><span data-stu-id="ad340-134">In this case, the context menu extension is invoked for each selected object.</span></span> <span data-ttu-id="ad340-135">Dans Active Directory composants logiciels enfichables d’administration, les éléments d’extension de menu contextuel à sélection multiple sont également pris en charge.</span><span class="sxs-lookup"><span data-stu-id="ad340-135">In Active Directory administrative snap-ins, multiple-selection context menu extension items are also supported.</span></span> <span data-ttu-id="ad340-136">Dans ce cas, la structure [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) contient une structure [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) pour chaque objet d’annuaire sélectionné.</span><span class="sxs-lookup"><span data-stu-id="ad340-136">In this case, the [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure will contain a [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) structure for each directory object selected.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ad340-137">Pour le shell Windows, les informations relatives au spécificateur d’affichage sont récupérées à l’ouverture de session de l’utilisateur et mises en cache pour la session de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ad340-137">For the Windows shell, display specifier information is retrieved at user logon and cached for the user's session.</span></span> <span data-ttu-id="ad340-138">Pour les composants logiciels enfichables d’administration, les données du spécificateur d’affichage sont récupérées lorsque le composant logiciel enfichable est chargé et mis en cache pour la durée du processus.</span><span class="sxs-lookup"><span data-stu-id="ad340-138">For the administrative snap-ins, the display specifier data is retrieved when the snap-in is loaded and is cached for the duration of the process.</span></span> <span data-ttu-id="ad340-139">Pour le shell Windows, cela signifie que les modifications apportées aux spécificateurs d’affichage prennent effet une fois qu’un utilisateur se déconnecte puis de nouveau.</span><span class="sxs-lookup"><span data-stu-id="ad340-139">For the Windows shell, this means changes to display specifiers take effect after a user logs off and back on again.</span></span> <span data-ttu-id="ad340-140">Pour les composants logiciels enfichables d’administration, les modifications prennent effet lors du rechargement du composant logiciel enfichable ou de la console, autrement dit, si vous démarrez une nouvelle instance du fichier de console ou d’une nouvelle instance de Mmc.exe et que vous ajoutez le composant logiciel enfichable, les données du spécificateur d’affichage les plus récentes sont récupérées.</span><span class="sxs-lookup"><span data-stu-id="ad340-140">For the administrative snap-ins, changes take effect when the snap-in or console file is reloaded, that is, if you start a new instance of the console file or new Mmc.exe instance and add the snap-in, the latest display specifier data is retrieved.</span></span>

 

<span data-ttu-id="ad340-141">Pour plus d’informations et pour obtenir un exemple de code sur la façon d’implémenter une extension de menu contextuel, consultez [l’exemple de code pour l’implémentation de l’objet com du menu contextuel](example-code-for-implementation-of-the-context-menu-com-object.md).</span><span class="sxs-lookup"><span data-stu-id="ad340-141">For more information, and a code example of how to implement a context menu extension, see [Example Code for Implementation of the Context Menu COM Object](example-code-for-implementation-of-the-context-menu-com-object.md).</span></span>

 

 