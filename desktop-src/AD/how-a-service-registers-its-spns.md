---
title: Comment un service enregistre ses SPN
description: Avant qu’un client puisse utiliser un SPN pour authentifier une instance d’un service, le SPN doit être inscrit sur le compte d’utilisateur ou d’ordinateur que l’instance de service utilisera pour ouvrir une session.
ms.assetid: 39712c1f-3a9a-4c98-a1cb-879ab0b4cb63
ms.tgt_platform: multiple
keywords:
- Comment un service inscrit sa publicité SPN
- nom de principal du service AD, comment un service enregistre ses SPN
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 74410be3a024fc6accd1d8394e2ba8335be9f550
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103839310"
---
# <a name="how-a-service-registers-its-spns"></a><span data-ttu-id="4ceec-105">Comment un service enregistre ses SPN</span><span class="sxs-lookup"><span data-stu-id="4ceec-105">How a Service Registers its SPNs</span></span>

<span data-ttu-id="4ceec-106">Avant qu’un client puisse utiliser un SPN pour authentifier une instance d’un service, le SPN doit être inscrit sur le compte d’utilisateur ou d’ordinateur que l’instance de service utilisera pour ouvrir une session.</span><span class="sxs-lookup"><span data-stu-id="4ceec-106">Before a client can use an SPN to authenticate an instance of a service, the SPN must be registered on the user or computer account that the service instance will use to log on.</span></span> <span data-ttu-id="4ceec-107">En règle générale, l’inscription du SPN est effectuée par un programme d’installation de service s’exécutant avec des privilèges d’administrateur de domaine.</span><span class="sxs-lookup"><span data-stu-id="4ceec-107">Typically, SPN registration is done by a service installation program running with domain administrator privileges.</span></span>

<span data-ttu-id="4ceec-108">Le programme d’installation du service qui installe une instance de service sur un ordinateur hôte effectue généralement la procédure suivante.</span><span class="sxs-lookup"><span data-stu-id="4ceec-108">The service installer that installs a service instance on a host computer typically performs the following procedure.</span></span>

<span data-ttu-id="4ceec-109">**Pour inscrire des SPN pour une instance de service**</span><span class="sxs-lookup"><span data-stu-id="4ceec-109">**To register SPNs for a service instance**</span></span>

1.  <span data-ttu-id="4ceec-110">Appelez la fonction [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) pour créer un ou plusieurs SPN uniques pour l’instance de service.</span><span class="sxs-lookup"><span data-stu-id="4ceec-110">Call the [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) function to create one or more unique SPNs for the service instance.</span></span> <span data-ttu-id="4ceec-111">Pour plus d’informations, consultez [formats de noms pour les noms de principal du service uniques](name-formats-for-unique-spns.md).</span><span class="sxs-lookup"><span data-stu-id="4ceec-111">For more information, see [Name Formats for Unique SPNs](name-formats-for-unique-spns.md).</span></span>
2.  <span data-ttu-id="4ceec-112">Appelez la fonction [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) pour enregistrer les noms sur le compte d’ouverture de session du service.</span><span class="sxs-lookup"><span data-stu-id="4ceec-112">Call the [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) function to register the names on the service's logon account.</span></span>

<span data-ttu-id="4ceec-113">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) inscrit des noms de principal du service en tant que propriété d’un objet de compte d’utilisateur ou d’ordinateur dans l’annuaire.</span><span class="sxs-lookup"><span data-stu-id="4ceec-113">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) registers SPNs as a property of a user or computer account object in the directory.</span></span> <span data-ttu-id="4ceec-114">les objets **utilisateur** et **ordinateur** ont un attribut **servicePrincipalName** , qui est un attribut à valeurs multiples pour le stockage de tous les noms de principal du service associés à un compte d’utilisateur ou d’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="4ceec-114">**user** and **computer** objects have a **servicePrincipalName** attribute, which is a multi-valued attribute for storing all the SPNs associated with a user or computer account.</span></span> <span data-ttu-id="4ceec-115">Si le service s’exécute sous un compte d’utilisateur, les noms de principal du service sont stockés dans l’attribut **servicePrincipalName** de ce compte.</span><span class="sxs-lookup"><span data-stu-id="4ceec-115">If the service runs under a user account, the SPNs are stored in the **servicePrincipalName** attribute of that account.</span></span> <span data-ttu-id="4ceec-116">Si le service s’exécute dans le compte LocalSystem, les noms de principal du service sont stockés dans l’attribut **servicePrincipalName** du compte de l’ordinateur hôte du service.</span><span class="sxs-lookup"><span data-stu-id="4ceec-116">If the service runs in the LocalSystem account, the SPNs are stored in the **servicePrincipalName** attribute of the account of the service's host computer.</span></span> <span data-ttu-id="4ceec-117">L’appelant **DsWriteAccountSpn** doit spécifier le nom unique de l’objet de compte sous lequel les noms de principal du service sont stockés.</span><span class="sxs-lookup"><span data-stu-id="4ceec-117">The **DsWriteAccountSpn** caller must specify the distinguished name of the account object under which the SPNs are stored.</span></span>

<span data-ttu-id="4ceec-118">Pour vous assurer que les noms de principal du service inscrits sont sécurisés, l’attribut **servicePrincipalName** ne peut pas être écrit directement. Il peut uniquement être écrit en appelant [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span><span class="sxs-lookup"><span data-stu-id="4ceec-118">To ensure that registered SPNs are secure, the **servicePrincipalName** attribute cannot be written directly; it can only be written by calling [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span></span> <span data-ttu-id="4ceec-119">L’appelant doit disposer d’un accès en écriture à l’attribut **servicePrincipalName** du compte cible.</span><span class="sxs-lookup"><span data-stu-id="4ceec-119">The caller must have write-access to the **servicePrincipalName** attribute of the target account.</span></span> <span data-ttu-id="4ceec-120">En règle générale, l’accès en écriture est accordé par défaut uniquement aux administrateurs de domaine.</span><span class="sxs-lookup"><span data-stu-id="4ceec-120">Typically, write access is granted by default only to domain administrators.</span></span> <span data-ttu-id="4ceec-121">Toutefois, il existe un cas particulier dans lequel le système autorise un service s’exécutant sous le compte LocalSystem à inscrire ses propres noms de principal du service sur le compte d’ordinateur de l’hôte du service.</span><span class="sxs-lookup"><span data-stu-id="4ceec-121">However, there is a special case in which the system allows a service running under the LocalSystem account to register its own SPNs on the computer account of the service's host.</span></span> <span data-ttu-id="4ceec-122">Dans ce cas, le SPN en cours d’écriture doit avoir la forme « <service class> / <host> » et « &lt; host &gt; » doit être le nom DNS de l’ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="4ceec-122">In this case, the SPN being written must have the form "<service class>/<host>" and "&lt;host&gt;" must be the DNS name of the local computer.</span></span>

<span data-ttu-id="4ceec-123">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) peut également supprimer des SPN d’un compte.</span><span class="sxs-lookup"><span data-stu-id="4ceec-123">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) can also remove SPNs from an account.</span></span> <span data-ttu-id="4ceec-124">Un paramètre d’opération indique si les noms de principal du service doivent être ajoutés au compte, supprimés du compte ou utilisés pour remplacer complètement tous les SPN actuels pour le compte.</span><span class="sxs-lookup"><span data-stu-id="4ceec-124">An operation parameter indicates whether the SPNs are to be added to the account, removed from the account, or used to completely replace all current SPNs for the account.</span></span> <span data-ttu-id="4ceec-125">Quand une instance de service est désinstallée, supprimez tous les SPN inscrits pour cette instance.</span><span class="sxs-lookup"><span data-stu-id="4ceec-125">When a service instance is uninstalled, remove any SPNs registered for that instance.</span></span>

<span data-ttu-id="4ceec-126">Pour plus d’informations et pour obtenir un exemple de code qui inscrit ou annule l’enregistrement des noms principaux de service d’un service, consultez [enregistrement des noms principaux de service pour un service](registering-the-spns-for-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="4ceec-126">For more information and a code example that registers or unregisters a service's SPNs, see [Registering the SPNs for a Service](registering-the-spns-for-a-service.md).</span></span>

<span data-ttu-id="4ceec-127">Les services basés sur l’hôte qui utilisent le format de SPN simple « <service class> / <host> » ont la possibilité d’utiliser la fonction [**DsServerRegisterSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) , qui crée et inscrit des SPN pour une instance de service.</span><span class="sxs-lookup"><span data-stu-id="4ceec-127">Host-based services that use the simple SPN format "<service class>/<host>", have the option of using the [**DsServerRegisterSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) function, which both creates and registers SPNs for a service instance.</span></span> <span data-ttu-id="4ceec-128">**DsServerRegisterSpn** est une fonction d’assistance qui appelle [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) et [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span><span class="sxs-lookup"><span data-stu-id="4ceec-128">**DsServerRegisterSpn** is a helper function that calls [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) and [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span></span>

<span data-ttu-id="4ceec-129">Pour plus d’informations, consultez [comptes d’ouverture de session du service](service-logon-accounts.md).</span><span class="sxs-lookup"><span data-stu-id="4ceec-129">For more information, see [Service Logon Accounts](service-logon-accounts.md).</span></span>

 

 




