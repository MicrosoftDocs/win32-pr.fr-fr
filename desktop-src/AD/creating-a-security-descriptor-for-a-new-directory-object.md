---
title: Création de descripteurs de sécurité pour les nouveaux objets d’annuaire
description: Vous pouvez utiliser ADSI pour créer un descripteur de sécurité et le définir en tant que propriété nTSecurityDescriptor d’un nouvel objet, ou l’utiliser pour remplacer la propriété nTSecurityDescriptor d’un objet existant.
ms.assetid: b9ff626f-17f1-4fc1-9d6e-4f47e29a5aeb
ms.tgt_platform: multiple
keywords:
- Création d’un descripteur de sécurité pour un nouvel objet annuaire AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78265d27c52023d669e27fc9890fd2d5273e2ffd
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/17/2020
ms.locfileid: "104462899"
---
# <a name="creating-security-descriptors-for-new-directory-objects"></a><span data-ttu-id="f86b5-104">Création de descripteurs de sécurité pour les nouveaux objets d’annuaire</span><span class="sxs-lookup"><span data-stu-id="f86b5-104">Creating Security Descriptors for new directory objects</span></span>

<span data-ttu-id="f86b5-105">Vous pouvez utiliser ADSI pour créer un descripteur de sécurité et le définir en tant que propriété **ntSecurityDescriptor** d’un nouvel objet, ou l’utiliser pour remplacer la propriété **ntSecurityDescriptor** d’un objet existant.</span><span class="sxs-lookup"><span data-stu-id="f86b5-105">You can use ADSI to create a security descriptor and set it as a new object's **nTSecurityDescriptor** property or use it to replace an existing object's **nTSecurityDescriptor** property.</span></span>

<span data-ttu-id="f86b5-106">Pour créer un descripteur de sécurité pour un objet :</span><span class="sxs-lookup"><span data-stu-id="f86b5-106">To create a security descriptor for an object:</span></span>

1.  <span data-ttu-id="f86b5-107">Utilisez [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) pour créer l’objet com ADSI pour le nouveau descripteur de sécurité et obtenir un pointeur d’interface [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) vers cet objet.</span><span class="sxs-lookup"><span data-stu-id="f86b5-107">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new security descriptor and get an [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) interface pointer to that object.</span></span> <span data-ttu-id="f86b5-108">N’oubliez pas que l’ID de classe est le **\_ SecurityDescriptor CLSID**.</span><span class="sxs-lookup"><span data-stu-id="f86b5-108">Be aware that the class ID is **CLSID\_SecurityDescriptor**.</span></span>
2.  <span data-ttu-id="f86b5-109">Utilisez la méthode [**IADsSecurityDescriptor ::p ut \_ owner**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) pour définir le propriétaire de l’objet.</span><span class="sxs-lookup"><span data-stu-id="f86b5-109">Use the [**IADsSecurityDescriptor::put\_Owner**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the owner of the object.</span></span> <span data-ttu-id="f86b5-110">Le tiers de confiance est un utilisateur, un groupe ou un autre principal de sécurité.</span><span class="sxs-lookup"><span data-stu-id="f86b5-110">The trustee is a user, group, or other security principal.</span></span> <span data-ttu-id="f86b5-111">Une application doit utiliser la valeur de la propriété appropriée de l’objet utilisateur ou groupe du tiers de confiance auquel appliquer l’entrée du contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="f86b5-111">An application should use the value from the appropriate property from the user or group object of the trustee to which to apply the ACE.</span></span>
3.  <span data-ttu-id="f86b5-112">Utilisez la méthode de [**\_ contrôle IADsSecurityDescriptor ::p ut**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) pour contrôler si les listes DACL et les listes SACL sont héritées par l’objet de son conteneur parent.</span><span class="sxs-lookup"><span data-stu-id="f86b5-112">Use the [**IADsSecurityDescriptor::put\_Control**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to control whether DACLs and SACLs are inherited by the object from its parent container.</span></span>
4.  <span data-ttu-id="f86b5-113">Utilisez [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) pour créer l’objet com ADSI pour la liste DACL pour le nouveau descripteur de sécurité et obtenir un pointeur d’interface [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) vers cet objet.</span><span class="sxs-lookup"><span data-stu-id="f86b5-113">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the DACL for the new security descriptor and get an [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) interface pointer to that object.</span></span> <span data-ttu-id="f86b5-114">N’oubliez pas que l’ID de classe est **CLSID \_ AccessControlList**.</span><span class="sxs-lookup"><span data-stu-id="f86b5-114">Be aware that the class ID is **CLSID\_AccessControlList**.</span></span>
5.  <span data-ttu-id="f86b5-115">Pour chaque entrée du contrôle d’accès à ajouter à la liste DACL, utilisez [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) pour créer l’objet com ADSI pour la nouvelle entrée du contrôle d’accès et obtenir un pointeur d’interface [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) vers cet objet.</span><span class="sxs-lookup"><span data-stu-id="f86b5-115">For each ACE to add to the DACL, use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new ACE and get an [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface pointer to that object.</span></span> <span data-ttu-id="f86b5-116">N’oubliez pas que l’ID de classe est CLSID \_ AccessControlEntry.</span><span class="sxs-lookup"><span data-stu-id="f86b5-116">Be aware that the class ID is CLSID\_AccessControlEntry.</span></span>
6.  <span data-ttu-id="f86b5-117">Pour chaque entrée du contrôle d’accès à ajouter à la liste DACL, définissez les propriétés de l’entrée du contrôle d’accès à l’aide des méthodes de propriété de l’objet [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) de l’ACE.</span><span class="sxs-lookup"><span data-stu-id="f86b5-117">For each ACE to add to the DACL, set the properties of the ACE using the property methods of the ACE's [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object.</span></span> <span data-ttu-id="f86b5-118">Pour plus d’informations sur les propriétés à définir sur une entrée du contrôle d’accès, consultez [définition des droits d’accès sur un objet](setting-access-rights-on-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="f86b5-118">For more information about the properties to set on an ACE, see [Setting Access Rights on an Object](setting-access-rights-on-an-object.md).</span></span>
7.  <span data-ttu-id="f86b5-119">Pour chaque entrée du contrôle d’accès à ajouter à la liste DACL, utilisez la méthode **QueryInterface** sur l’objet [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) pour obtenir un pointeur [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="f86b5-119">For each ACE to add to the DACL, use the **QueryInterface** method on the [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object to get an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="f86b5-120">La méthode [**IADsAccessControlList :: AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) requiert un pointeur d’interface **IDISPATCH** vers l’entrée du contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="f86b5-120">The [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) method requires an **IDispatch** interface pointer to the ACE.</span></span>
8.  <span data-ttu-id="f86b5-121">Pour chaque entrée du contrôle d’accès à ajouter à la liste DACL, utilisez [**IADsAccessControlList :: AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) pour ajouter la nouvelle entrée du contrôle d’accès à la liste DACL.</span><span class="sxs-lookup"><span data-stu-id="f86b5-121">For each ACE to add to the DACL, use [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) to add the new ACE to the DACL.</span></span> <span data-ttu-id="f86b5-122">N’oubliez pas que l’ordre des ACE dans la liste de contrôle d’accès peut affecter l’évaluation de l’accès à l’objet.</span><span class="sxs-lookup"><span data-stu-id="f86b5-122">Be aware that the order of the ACEs within the ACL can affect the evaluation of access to the object.</span></span> <span data-ttu-id="f86b5-123">Pour un accès correct à l’objet, vous devrez peut-être créer une nouvelle liste de contrôle d’accès, ajouter les entrées de contrôle d’accès de l’ACL existante dans l’ordre approprié à la nouvelle liste de contrôle d’accès, puis remplacer l’ACL existante dans le descripteur de sécurité par la nouvelle liste de contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="f86b5-123">The correct access to the object may require you to create a new ACL, add the ACEs from the existing ACL in the correct order to the new ACL, and then replace the existing ACL in the security descriptor with the new ACL.</span></span> <span data-ttu-id="f86b5-124">Pour plus d’informations, consultez [ordre des entrées de commande dans une liste DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span><span class="sxs-lookup"><span data-stu-id="f86b5-124">For more information, see [Order of ACEs in a DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span></span>
9.  <span data-ttu-id="f86b5-125">Suivez les étapes 4-8 pour créer la liste SACL pour le nouveau descripteur de sécurité.</span><span class="sxs-lookup"><span data-stu-id="f86b5-125">Follow Steps 4-8 to create the SACL for the new security descriptor.</span></span>
10. <span data-ttu-id="f86b5-126">Utilisez la méthode [**IADsSecurityDescriptor ::p ut \_ DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) pour définir la liste DACL.</span><span class="sxs-lookup"><span data-stu-id="f86b5-126">Use the [**IADsSecurityDescriptor::put\_DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the DACL.</span></span> <span data-ttu-id="f86b5-127">Pour plus d’informations sur les DACL, consultez [DACL null et listes DACL vides](null-dacls-and-empty-dacls.md).</span><span class="sxs-lookup"><span data-stu-id="f86b5-127">For more information about DACLs, see [Null DACLs and Empty DACLs](null-dacls-and-empty-dacls.md).</span></span>
11. <span data-ttu-id="f86b5-128">Utilisez la méthode [**IADsSecurityDescriptor ::p ut \_ SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) pour définir la liste SACL.</span><span class="sxs-lookup"><span data-stu-id="f86b5-128">Use the [**IADsSecurityDescriptor::put\_SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the SACL.</span></span>
12. <span data-ttu-id="f86b5-129">Convertissez l’objet [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) en [**Variant**](/windows/win32/api/oaidl/ns-oaidl-variant) à l’aide de la méthode **QueryInterface** de l’objet **IADsSecurityDescriptor** pour obtenir une interface [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="f86b5-129">Convert the [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) object to a [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) by using the **QueryInterface** method of the **IADsSecurityDescriptor** object to obtain an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) interface.</span></span> <span data-ttu-id="f86b5-130">Définissez ensuite le membre **VT** du **Variant** sur **VT \_ Dispatch** et définissez le membre **pdispVal** de la **variante** comme étant égal au pointeur **IDispatch** .</span><span class="sxs-lookup"><span data-stu-id="f86b5-130">Then set the **vt** member of the **VARIANT** to **VT\_DISPATCH** and set the **pdispVal** member of the **VARIANT** equal to the **IDispatch** pointer.</span></span>
13. <span data-ttu-id="f86b5-131">Obtient un pointeur d’interface [**IADs**](/windows/desktop/api/iads/nn-iads-iads) vers l’objet.</span><span class="sxs-lookup"><span data-stu-id="f86b5-131">Obtain an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer to the object.</span></span>
14. <span data-ttu-id="f86b5-132">Utilisez la méthode [**IADs ::P ut**](/windows/desktop/api/iads/nf-iads-iads-put) avec « ntSecurityDescriptor » et la [**variante**](/windows/win32/api/oaidl/ns-oaidl-variant) créée ci-dessus pour écrire le nouveau descripteur de sécurité dans le cache de propriétés.</span><span class="sxs-lookup"><span data-stu-id="f86b5-132">Use the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) method with "nTSecurityDescriptor" and the [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) created above to write the new security descriptor to the property cache.</span></span>
15. <span data-ttu-id="f86b5-133">Utilisez la méthode [**IADs :: setinfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) pour mettre à jour la propriété sur l’objet dans le répertoire.</span><span class="sxs-lookup"><span data-stu-id="f86b5-133">Use the [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) method to update the property on the object in the directory.</span></span>

 

 