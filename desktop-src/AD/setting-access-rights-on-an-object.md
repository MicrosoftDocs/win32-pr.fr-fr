---
title: Définition des droits d’accès sur un objet
description: Cette rubrique explique comment créer un ACE pour un droit d’accès et définir cette entrée de contrôle d’accès sur la liste DACL d’un objet.
ms.assetid: c0b45709-4652-46c7-8d52-44076802d109
ms.tgt_platform: multiple
keywords:
- Définition des droits d’accès sur un objet AD
- Objets AD, définition des droits d’accès sur un objet
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2bcf54de381dab2af1dab4ea44654fb0a5682f06
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/17/2020
ms.locfileid: "104462819"
---
# <a name="setting-access-rights-on-an-object"></a>Définition des droits d’accès sur un objet

Lorsque vous utilisez les objets COM ADSI [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) (descripteur de sécurité), [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) (DACL et SACL) et [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) (ACE) pour ajouter une entrée de contrôle d’accès à une liste de contrôle d’accès, vous apportez des modifications à la propriété **ntSecurityDescriptor** de l’objet spécifié dans le cache de propriétés. Cela signifie placer les méthodes sur les objets qui contiennent la nouvelle entrée du contrôle d’accès et la méthode [**IADs. setinfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) doit être appelée pour écrire le descripteur de sécurité mis à jour dans le répertoire à partir du cache de propriétés.

Pour plus d’informations et pour obtenir un exemple de code qui définit une entrée du contrôle d’accès sur un objet dans Active Directory Domain Services, consultez [exemple de code pour la définition d’une entrée du contrôle d’accès sur un objet d’annuaire](example-code-for-setting-an-ace-on-a-directory-object.md).

Utilisez le processus général suivant pour créer une entrée du contrôle d’accès pour un droit d’accès et définir cette entrée de contrôle d’accès sur la liste DACL d’un objet.

1.  Obtient un pointeur d’interface [**IADs**](/windows/desktop/api/iads/nn-iads-iads) vers l’objet.
2.  Utilisez la méthode [**IADs. obten**](/windows/desktop/api/iads/nf-iads-iads-get) pour récupérer le descripteur de sécurité de l’objet. Le nom de la propriété contenant le descripteur de sécurité est **ntSecurityDescriptor**. La propriété est retournée en tant que [**Variant**](/windows/win32/api/oaidl/ns-oaidl-variant) contenant un pointeur [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) (le membre **VT** est **VT \_ Dispatch**). Appelez **QueryInterface** sur ce pointeur **IDispatch** pour qu’une interface [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) utilise les méthodes sur cette interface pour accéder à la liste de contrôle d’accès du descripteur de sécurité.
3.  Utilisez la propriété [**IADsSecurityDescriptor. DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) pour accéder à la liste DACL. La méthode retourne un pointeur [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) . Appelez **QueryInterface** sur ce pointeur **IDispatch** pour qu’une interface [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) utilise les méthodes sur cette interface pour accéder aux ACE individuelles dans la liste de contrôle d’accès.
4.  Utilisez [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) pour créer l’objet com ADSI pour la nouvelle entrée du contrôle d’accès et obtenir un pointeur d’interface [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) vers cet objet. N’oubliez pas que l’ID de classe est CLSID \_ AccessControlEntry.
5.  Définissez les propriétés de l’entrée du contrôle d’accès à l’aide des méthodes [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) :

    1.  Utilisez [**IADsAccessControlEntry ::p le \_ tiers**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) de confiance pour définir le tiers de confiance auquel s’applique cette entrée du contrôle d’accès. Le tiers de confiance est un utilisateur, un groupe ou un autre principal de sécurité. Votre application doit utiliser la valeur de la propriété appropriée de l’objet utilisateur ou groupe du tiers de confiance auquel vous souhaitez appliquer l’entrée du contrôle d’accès. Le tiers de confiance est spécifié en tant que **BSTR** et peut prendre les formes suivantes :
        -   Compte de domaine (nom d’ouverture de session utilisé dans une version précédente de Windows NT) sous la forme « <domain> \\ <user account> », où « &lt; domaine &gt; » est le nom du domaine Windows NT qui contient l’utilisateur et « &lt; compte d’utilisateur &gt; » est la propriété **sAMAccountName** de l’utilisateur spécifié. Par exemple : « Fabrikam \\ JeffSmith ».
        -   Principal de sécurité connu qui représente des identités spéciales définies par le système de sécurité de Windows NT, telles que tout le monde, système local, Self-principal, utilisateur authentifié, propriétaire créateur, etc. Les objets représentant les principaux de sécurité connus sont stockés dans le conteneur de principaux de sécurité connu sous le conteneur de configuration. Par exemple, ouverture de session anonyme.
        -   Groupe intégré qui représente les groupes d’utilisateurs intégrés définis par le système de sécurité de Windows NT. Il se présente sous la forme « BUILTIN \\ <group name> », où « &lt; nom &gt; de groupe » est le nom du groupe d’utilisateurs intégré. Les objets représentant les groupes prédéfinis sont stockés dans le conteneur Builtin sous le conteneur de domaine. Par exemple, « \\ administrateurs BUILTIN ».
        -   SID (format de chaîne) de l’utilisateur spécifié, qui est la propriété **objectSID** de l’utilisateur spécifié. Vous pouvez convertir au format de chaîne à l’aide de la fonction [**ConvertSidToStringSid a**](/windows/desktop/api/sddl/nf-sddl-convertsidtostringsida) dans l’API de sécurité Win32. Par exemple : « S-1-5-32-548 ».
    2.  Utilisez la propriété [**IADsAccessControlEntry. AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) pour définir le masque qui spécifie le droit d’accès. L’énumération de l’énumération des [**\_ \_ droits ADS**](/windows/win32/api/iads/ne-iads-ads_rights_enum) spécifie les droits d’accès que vous pouvez définir sur un objet d’annuaire.
    3.  Utilisez la propriété [**IADsAccessControlEntry. AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) pour spécifier si vous souhaitez autoriser ou refuser les droits d’accès définis par **AccessMask**. Pour les droits standard, il peut s’agir de **publicités \_ ACETYPE \_ accès \_ autorisé** ou de **publicités \_ ACETYPE \_ accès \_ refusé**. Pour les droits spécifiques aux objets (droits qui s’appliquent à une partie spécifique d’un objet ou à un type d’objet spécifique), utilisez les objets **ad \_ ACETYPE \_ Access \_ allowed \_ Object** ou **ad \_ ACETYPE \_ Access \_ denied \_**. L’énumération d’énumérations [**\_ \_ ACETYPE ADS**](/windows/win32/api/iads/ne-iads-ads_acetype_enum) spécifie les types d’accès que vous pouvez définir sur une entrée du contrôle d’accès.
    4.  Utilisez la propriété [**IADsAccessControlEntry. AceFlags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) pour spécifier si d’autres conteneurs ou objets situés sous l’objet spécifié peuvent hériter de l’entrée du contrôle d’accès. L’énumération d’énumérations [**\_ \_ ACEFLAG ADS**](/windows/win32/api/iads/ne-iads-ads_aceflag_enum) spécifie les indicateurs d’héritage que vous pouvez définir sur une entrée du contrôle d’accès.
    5.  Utilisez la propriété [**IADsAccessControlEntry. Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) pour spécifier si le droit s’applique à une partie spécifique de l’objet, un type d’objet hérité ou les deux.
    6.  Si la valeur **Flags** est définie sur le **\_ \_ type d’objet indicateur \_ \_ ADS**, définissez la propriété [**IADsAccessControlEntry. OBJECTTYPE**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) sur spécifiez une chaîne qui contient le GUID de la classe d’objet (pour les **publicités \_ Right \_ DS \_ Create \_ Child** ou **ADS Right supprimer un \_ \_ \_ \_ enfant**), Property, Property Set, valided Write ou Extended Right auquel s’applique l’entrée du contrôle d’accès. Le GUID doit être spécifié sous la forme d’une chaîne sous la forme produite par la fonction [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) dans la bibliothèque com.
    7.  Si **Flags** est défini sur ADS, le **\_ type d' \_ objet hérité est \_ \_ \_ présent**, définissez la propriété [**IADSACCESSCONTROLENTRY. InheritedObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) pour spécifier une chaîne qui contient le GUID de la classe d’objet héritée à laquelle l’entrée du contrôle d’accès s’applique. Le GUID doit être spécifié sous la forme d’une chaîne sous la forme produite par la fonction [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) dans la bibliothèque com.

6.  Utilisez la méthode **QueryInterface** sur l’objet [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) pour récupérer un pointeur [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) . La méthode [**IADsAccessControlList. AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) requiert un pointeur d’interface **IDISPATCH** vers l’entrée du contrôle d’accès.
7.  Utilisez [**IADsAccessControlList. AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) pour ajouter la nouvelle entrée du contrôle d’accès à la liste DACL. N’oubliez pas que l’ordre des ACE dans la liste de contrôle d’accès peut affecter l’évaluation de l’accès à l’objet. Pour un accès correct à l’objet, vous devrez peut-être créer une nouvelle liste de contrôle d’accès, ajouter les entrées du contrôle d’accès de l’ACL existante dans l’ordre approprié à la nouvelle liste de contrôle d’accès, puis remplacer l’ACL existante dans le descripteur de sécurité par la nouvelle liste de contrôle d’accès. Pour plus d’informations, consultez [ordre des entrées de commande dans une liste DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).
8.  Utilisez la propriété [**IADsSecurityDescriptor. DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) pour écrire la liste DACL contenant la nouvelle entrée du contrôle d’accès dans le descripteur de sécurité. Pour plus d’informations sur les DACL, consultez [DACL null et listes DACL vides](null-dacls-and-empty-dacls.md).
9.  Utilisez la méthode [**IADs. put**](/windows/desktop/api/iads/nf-iads-iads-put) pour écrire le descripteur de sécurité dans la propriété **ntSecurityDescriptor** de l’objet dans le cache de propriétés.
10. Utilisez la méthode [**IADs. setinfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) pour mettre à jour la propriété sur l’objet dans le répertoire.

 

 