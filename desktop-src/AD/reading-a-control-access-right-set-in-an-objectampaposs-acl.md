---
title: Lecture d’un droit d’accès de contrôle défini dans l’ACL d’un objet
description: Les propriétés de l’interface IADsAccessControlEntry sont utilisées pour accorder ou refuser des droits d’accès de contrôle.
ms.assetid: 2c6fef91-990e-4954-9aff-c9ec72d13972
ms.tgt_platform: multiple
keywords:
- Lecture d’un droit d’accès de contrôle défini dans l’ACL d’un objet Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4877c96a95fc94095c79ad129e8a07b1c786abe1
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/17/2020
ms.locfileid: "104030991"
---
# <a name="reading-a-control-access-right-set-in-an-objects-acl"></a><span data-ttu-id="be023-104">Lecture d’un droit d’accès de contrôle défini dans l’ACL d’un objet</span><span class="sxs-lookup"><span data-stu-id="be023-104">Reading a Control Access Right Set in an Object's ACL</span></span>

<span data-ttu-id="be023-105">À l’aide d’ADSI, vous lisez une entrée de contrôle d’accès de contrôle comme vous le feriez pour n’importe quelle autre entrée de contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="be023-105">Using ADSI, you read a control access right ACE just as you would any other ACE in an ACL.</span></span> <span data-ttu-id="be023-106">Sachez que vous pouvez également utiliser les API de sécurité Win32 pour lire les ACL sur les objets d’annuaire.</span><span class="sxs-lookup"><span data-stu-id="be023-106">Be aware that you can also use the Win32 security APIs to read ACLs on directory objects.</span></span> <span data-ttu-id="be023-107">Toutefois, les droits d’accès de contrôle utilisent les propriétés de l’interface [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) de manière à accorder et refuser des droits d’accès au contrôle :</span><span class="sxs-lookup"><span data-stu-id="be023-107">However, control access rights use the properties of the [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface in a manner that is specific to granting and denying control access rights:</span></span>

-   <span data-ttu-id="be023-108">[**AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) doit contenir **les \_ droits \_ d' \_ \_ accès au contrôle d’annuaire Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="be023-108">[**AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) must contain **ADS\_RIGHT\_DS\_CONTROL\_ACCESS**.</span></span>
-   <span data-ttu-id="be023-109">La valeur [**Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) est le **type d' \_ objet indicateur ADS \_ \_ \_ présent**.</span><span class="sxs-lookup"><span data-stu-id="be023-109">[**Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) value is **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT**.</span></span>
-   <span data-ttu-id="be023-110">[**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) est le format de chaîne de l’attribut **rightsGUID** du droit d’accès au contrôle.</span><span class="sxs-lookup"><span data-stu-id="be023-110">[**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is the string form of the **rightsGUID** attribute of the control access right.</span></span> <span data-ttu-id="be023-111">Le format de chaîne du GUID est le même que celui de la fonction de bibliothèque COM [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) .</span><span class="sxs-lookup"><span data-stu-id="be023-111">The string format of the GUID is the same string format as the [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) COM Library function.</span></span>
-   <span data-ttu-id="be023-112">[**AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) est soit **ADS \_ AceType \_ Access \_ allowed \_ Object** pour accorder au tiers de confiance le droit d’accès du contrôle, soit l' **\_ objet ADS AceType \_ accès \_ refusé \_** pour refuser au tiers de confiance le droit d’accès au contrôle.</span><span class="sxs-lookup"><span data-stu-id="be023-112">[**AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is either **ADS\_ACETYPE\_ACCESS\_ALLOWED\_OBJECT** to grant the trustee the control access right or **ADS\_ACETYPE\_ACCESS\_DENIED\_OBJECT** to deny the trustee the control access right.</span></span>
-   <span data-ttu-id="be023-113">Le [**tiers de confiance**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) est le principal de sécurité ; Il s’agit de l’utilisateur, du groupe, de l’ordinateur, et ainsi de suite, à laquelle l’entrée du contrôle d’accès s’applique.</span><span class="sxs-lookup"><span data-stu-id="be023-113">[**Trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is the security principal; that is the user, group, computer, and so on, to which the ACE applies.</span></span>

<span data-ttu-id="be023-114">Utilisez la procédure suivante pour lire une entrée du contrôle d’accès pour un objet ADSI.</span><span class="sxs-lookup"><span data-stu-id="be023-114">Use the following procedure to read an ACE for an ADSI object.</span></span> <span data-ttu-id="be023-115">La procédure suivante s’applique aux applications C et C++.</span><span class="sxs-lookup"><span data-stu-id="be023-115">The following procedure applies to C and C++ applications.</span></span>

<span data-ttu-id="be023-116">**Pour lire une entrée du contrôle d’accès pour un objet ADSI**</span><span class="sxs-lookup"><span data-stu-id="be023-116">**To read an ACE for an ADSI object**</span></span>

1.  <span data-ttu-id="be023-117">Obtient un pointeur d’interface [**IADs**](/windows/desktop/api/iads/nn-iads-iads) vers l’objet.</span><span class="sxs-lookup"><span data-stu-id="be023-117">Get an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer to the object.</span></span>
2.  <span data-ttu-id="be023-118">Utilisez la méthode [**IADs :: obten**](/windows/desktop/api/iads/nf-iads-iads-get) pour récupérer le descripteur de sécurité de l’objet.</span><span class="sxs-lookup"><span data-stu-id="be023-118">Use the [**IADs::Get**](/windows/desktop/api/iads/nf-iads-iads-get) method to get the security descriptor of the object.</span></span> <span data-ttu-id="be023-119">Le nom de la propriété qui contient le descripteur de sécurité est « nTSecurityDescriptor ».</span><span class="sxs-lookup"><span data-stu-id="be023-119">The name of the property that contains the security descriptor is "nTSecurityDescriptor".</span></span> <span data-ttu-id="be023-120">La propriété est retournée en tant que **Variant** qui contient un pointeur [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="be023-120">The property will be returned as a **VARIANT** that contains an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="be023-121">N’oubliez pas que le membre **VT** est **VT \_ Dispatch**.</span><span class="sxs-lookup"><span data-stu-id="be023-121">Be aware that the **vt** member is **VT\_DISPATCH**.</span></span> <span data-ttu-id="be023-122">Appelez **QueryInterface** sur ce pointeur **IDispatch** pour qu’une interface [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) utilise les méthodes sur cette interface pour accéder à la liste de contrôle d’accès du descripteur de sécurité.</span><span class="sxs-lookup"><span data-stu-id="be023-122">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) interface to use the methods on that interface to access the security descriptor ACL.</span></span>
3.  <span data-ttu-id="be023-123">Utilisez la méthode [**IADsSecurityDescriptor :: obten \_ DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) pour accéder à la liste de contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="be023-123">Use the [**IADsSecurityDescriptor::get\_DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to get the ACL.</span></span> <span data-ttu-id="be023-124">La méthode retourne un pointeur [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="be023-124">The method returns an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="be023-125">Appelez **QueryInterface** sur ce pointeur **IDispatch** pour qu’une interface [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) utilise les méthodes sur cette interface pour accéder aux ACE individuelles dans la liste de contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="be023-125">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) interface to use the methods on that interface to access the individual ACEs in the ACL.</span></span>
4.  <span data-ttu-id="be023-126">Utilisez la méthode [**IADsAccessControlList :: obten \_ \_ NewEnum**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-get__newenum) pour énumérer les ACE.</span><span class="sxs-lookup"><span data-stu-id="be023-126">Use the [**IADsAccessControlList::get\_\_NewEnum**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-get__newenum) method to enumerate the ACEs.</span></span> <span data-ttu-id="be023-127">La méthode retourne un pointeur [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) .</span><span class="sxs-lookup"><span data-stu-id="be023-127">The method returns an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer.</span></span> <span data-ttu-id="be023-128">Appelez **QueryInterface** sur ce pointeur **IUnknown** pour récupérer une interface [**IEnumVARIANT**](/windows/win32/api/oaidl/nn-oaidl-ienumvariant) .</span><span class="sxs-lookup"><span data-stu-id="be023-128">Call **QueryInterface** on that **IUnknown** pointer to get an [**IEnumVARIANT**](/windows/win32/api/oaidl/nn-oaidl-ienumvariant) interface.</span></span>
5.  <span data-ttu-id="be023-129">Utilisez la méthode [**IEnumVARIANT :: Next**](/windows/win32/api/oaidl/nf-oaidl-ienumvariant-next) pour énumérer les ACE dans la liste de contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="be023-129">Use the [**IEnumVARIANT::Next**](/windows/win32/api/oaidl/nf-oaidl-ienumvariant-next) method to enumerate the ACEs in the ACL.</span></span> <span data-ttu-id="be023-130">La propriété est retournée en tant que **Variant** qui contient un pointeur [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="be023-130">The property is returned as a **VARIANT** that contains an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="be023-131">N’oubliez pas que le membre **VT** est **VT \_ Dispatch**.</span><span class="sxs-lookup"><span data-stu-id="be023-131">Be aware that the **vt** member is **VT\_DISPATCH**.</span></span> <span data-ttu-id="be023-132">Appelez **QueryInterface** sur ce pointeur **IDispatch** pour obtenir une interface [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) pour lire l’entrée du contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="be023-132">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface to read the ACE.</span></span>
6.  <span data-ttu-id="be023-133">Appelez la [**méthode IADsAccessControlEntry :: \_ obtenir AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) pour obtenir le **AccessMask** et vérifier que la valeur **AccessMask** pour l’indicateur d' **\_ \_ \_ \_ accès au contrôle de service d’annuaire AD Right** .</span><span class="sxs-lookup"><span data-stu-id="be023-133">Call the [**IADsAccessControlEntry::get\_AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the **AccessMask** and verify that the **AccessMask** value for the **ADS\_RIGHT\_DS\_CONTROL\_ACCESS** flag.</span></span> <span data-ttu-id="be023-134">S’il a cet indicateur, l’ACE contient un droit d’accès de contrôle.</span><span class="sxs-lookup"><span data-stu-id="be023-134">If it has this flag, the ACE contains a control access right.</span></span>
7.  <span data-ttu-id="be023-135">Appelez la méthode [**IADsAccessControlEntry :: obtenir \_ Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) pour obtenir l’indicateur pour le type d’objet.</span><span class="sxs-lookup"><span data-stu-id="be023-135">Call the [**IADsAccessControlEntry::get\_Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the flag for the object type.</span></span>
8.  <span data-ttu-id="be023-136">Valeur de la case à cocher Vérifier la valeur des [**indicateurs**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) pour les **annonces de type indicateur \_ \_ \_ \_ présent** .</span><span class="sxs-lookup"><span data-stu-id="be023-136">Check [**Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) value for **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT** flag.</span></span> <span data-ttu-id="be023-137">Si la valeur **Flags** est définie sur le **\_ \_ type d’objet indicateur \_ \_ ADS**, appelez la méthode **IADsAccessControlEntry :: obtenir \_ ObjectType** pour obtenir une chaîne qui contient le RIGHTSGUID du droit d’accès du contrôle auquel s’applique l’entrée du contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="be023-137">If **Flags** is set to **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT**, call the **IADsAccessControlEntry::get\_ObjectType** method to get a string that contains the rightsGUID of the control access right that the ACE applies to.</span></span>
9.  <span data-ttu-id="be023-138">Appelez la méthode [**IADsAccessControlEntry :: obten \_ AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) pour accéder au type d’entrée du contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="be023-138">Call the [**IADsAccessControlEntry::get\_AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the ACE type.</span></span> <span data-ttu-id="be023-139">Le type sera un **objet ad \_ ACETYPE \_ Access \_ allowed \_** pour accorder au tiers de confiance le droit d’accès du contrôle ou l' **\_ objet ad ACETYPE \_ Access \_ denied \_** pour refuser le droit d’accès au contrôle.</span><span class="sxs-lookup"><span data-stu-id="be023-139">The type will be an **ADS\_ACETYPE\_ACCESS\_ALLOWED\_OBJECT** to grant the trustee the control access right or **ADS\_ACETYPE\_ACCESS\_DENIED\_OBJECT** to deny the control access right.</span></span>
10. <span data-ttu-id="be023-140">Appelez la méthode [**IADsAccessControlEntry :: obtient le \_ tiers de confiance**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) pour accéder au principal de sécurité, c’est-à-dire à l’utilisateur, au groupe, à l’ordinateur, etc. auquel s’applique l’entrée du contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="be023-140">Call the [**IADsAccessControlEntry::get\_Trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the security principal; that is user, group, computer, and so on to which the ACE applies.</span></span>
11. <span data-ttu-id="be023-141">Lorsque vous avez terminé avec les chaînes [**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) et **fiduciaire** , utilisez [**SysFreeString**](/windows/win32/api/oleauto/nf-oleauto-sysfreestring) pour libérer la mémoire pour ces chaînes.</span><span class="sxs-lookup"><span data-stu-id="be023-141">When finished with the [**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) and **Trustee** strings, use [**SysFreeString**](/windows/win32/api/oleauto/nf-oleauto-sysfreestring) to free the memory for those strings.</span></span>
12. <span data-ttu-id="be023-142">Lorsque vous avez terminé avec les interfaces, appelez **Release** pour décrémenter ou libérer toutes les références d’interface.</span><span class="sxs-lookup"><span data-stu-id="be023-142">When finished with the interfaces, call **Release** to decrement or release all the interface references.</span></span>

 

 