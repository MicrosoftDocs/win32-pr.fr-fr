---
title: Utilisation de DsAddSidHistory
description: Cette rubrique explique comment utiliser la fonction DsAddSidHistory.
ms.assetid: cbf4983c-551d-4771-870e-a192ed898eb7
ms.tgt_platform: multiple
keywords:
- Utilisation de DsAddSidHistory Active Directory
- Active Directory Active Directory, utilisation de, à l’aide de DsAddSidHistory
- DsAddSidHistory Active Directory, utilisation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d45792dbd8c7a2bfa2dd047111a3ed165a2011e
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103671206"
---
# <a name="using-dsaddsidhistory"></a><span data-ttu-id="e33d8-106">Utilisation de DsAddSidHistory</span><span class="sxs-lookup"><span data-stu-id="e33d8-106">Using DsAddSidHistory</span></span>

<span data-ttu-id="e33d8-107">La fonction [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) obtient l’identificateur de sécurité (SID) du compte principal d’un principal de sécurité d’un domaine (le domaine source) et l’ajoute à l’attribut **SIDHistory** d’un principal de sécurité dans un autre domaine (de destination) d’une autre forêt.</span><span class="sxs-lookup"><span data-stu-id="e33d8-107">The [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) function gets the primary account security identifier (SID) of a security principal from one domain (the source domain) and adds it to the **sIDHistory** attribute of a security principal in another (destination) domain in a different forest.</span></span> <span data-ttu-id="e33d8-108">Lorsque le domaine source est en mode natif Windows 2000, cette fonction récupère également les valeurs **SIDHistory** du principal source et les ajoute au **SIDHistory** du principal de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-108">When the source domain is in Windows 2000 native mode, this function also retrieves the **sIDHistory** values of the source principal and adds them to the destination principal's **sIDHistory**.</span></span>

<span data-ttu-id="e33d8-109">L’ajout de sid au **SIDHistory** d’un principal de sécurité est une opération sensible à la sécurité qui accorde efficacement au principal de destination l’accès à toutes les ressources accessibles au principal source, à condition que des approbations existent entre les domaines de ressources applicables et le domaine de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-109">Adding SIDs to a security principal's **sIDHistory** is a security-sensitive operation that effectively grants to the destination principal access to all resources accessible to the source principal, provided that trusts exist from applicable resource domains to the destination domain.</span></span>

<span data-ttu-id="e33d8-110">Dans un domaine Windows 2000 en mode natif, une ouverture de session utilisateur crée un jeton d’accès qui contient le SID du compte principal de l’utilisateur et les SID de groupe, ainsi que le **SIDHistory** de l’utilisateur et le **SIDHistory** des groupes dont l’utilisateur est membre.</span><span class="sxs-lookup"><span data-stu-id="e33d8-110">In a native mode Windows 2000 domain a user logon creates an access token that contains the user primary account SID and group SIDs, as well as the user **sIDHistory** and the **sIDHistory** of the groups of which the user is a member.</span></span> <span data-ttu-id="e33d8-111">Le fait d’avoir ces anciens sid (valeurs **SIDHistory** ) dans le jeton de l’utilisateur accorde à l’utilisateur l’accès aux ressources protégées par des listes de contrôle d’accès (ACL) contenant les anciens sid.</span><span class="sxs-lookup"><span data-stu-id="e33d8-111">Having these former SIDs (**sIDHistory** values) in the user's token grants the user access to resources protected by access-control lists (ACLs) containing the former SIDs.</span></span>

<span data-ttu-id="e33d8-112">Cette opération facilite certains scénarios de déploiement de Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="e33d8-112">This operation facilitates certain Windows 2000 deployment scenarios.</span></span> <span data-ttu-id="e33d8-113">En particulier, il prend en charge un scénario dans lequel les comptes d’une nouvelle forêt Windows 2000 sont créés pour les utilisateurs et les groupes qui existent déjà dans un environnement de production Windows NT 4,0.</span><span class="sxs-lookup"><span data-stu-id="e33d8-113">In particular, it supports a scenario in which accounts in a new Windows 2000 forest are created for users and groups that already exist in an Windows NT 4.0 production environment.</span></span> <span data-ttu-id="e33d8-114">En plaçant le SID de compte Windows NT 4,0 dans le compte Windows 2000 **SIDHistory**, l’accès aux ressources réseau est préservé pour que l’utilisateur se connecte à son nouveau compte Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="e33d8-114">By placing the Windows NT 4.0 account SID in the Windows 2000 account **sIDHistory**, access to network resources is preserved for the user logging onto his new Windows 2000 account.</span></span>

<span data-ttu-id="e33d8-115">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) prend également en charge la migration des serveurs de ressources des contrôleurs de domaine secondaires windows NT 4,0 (ou des contrôleurs de domaine et des serveurs membres dans un domaine Windows 2000 en mode natif) vers un domaine Windows 2000 en tant que serveurs membres.</span><span class="sxs-lookup"><span data-stu-id="e33d8-115">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) also supports migration of Windows NT 4.0 backup domain controllers (BDCs) resource servers (or DCs and member servers in a native mode Windows 2000 domain) to a Windows 2000 domain as member servers.</span></span> <span data-ttu-id="e33d8-116">Pour cette migration, vous devez créer, dans le domaine Windows 2000 de destination, les groupes locaux de domaine qui contiennent, dans leur **SIDHistory**, les SID principaux des groupes locaux définis sur le BDC (ou les groupes locaux de domaine référencés dans les listes de contrôle d’accès sur les serveurs Windows 2000) dans le domaine source.</span><span class="sxs-lookup"><span data-stu-id="e33d8-116">This migration requires the creation, in the destination Windows 2000 domain, of domain local groups that contain, in their **sIDHistory**, the primary SIDs of the local groups defined on the BDC (or domain local groups referenced in ACLs on the Windows 2000 servers) in the source domain.</span></span> <span data-ttu-id="e33d8-117">En créant un groupe local de destination contenant le **SIDHistory** et tous les membres du groupe local source, l’accès aux ressources serveur migrées, protégées par des ACL référençant le groupe local source, est conservé pour tous les membres.</span><span class="sxs-lookup"><span data-stu-id="e33d8-117">By creating a destination local group containing the **sIDHistory** and all members of the source local group, access to the migrated server resources, protected by ACLs referencing the source local group, is maintained for all members.</span></span>

> [!Note]  
> <span data-ttu-id="e33d8-118">L’utilisation de [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) nécessite une compréhension des implications administratives et de sécurité plus larges dans ces scénarios et dans d’autres scénarios.</span><span class="sxs-lookup"><span data-stu-id="e33d8-118">Use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires an understanding of its broader administrative and security implications in these and other scenarios.</span></span> <span data-ttu-id="e33d8-119">Pour plus d’informations, consultez le livre blanc « planification de la migration de Windows NT vers Microsoft Windows 2000 », fourni comme Dommig.doc dans les outils de support de Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="e33d8-119">For more information, see the white paper "Planning Migration from Windows NT to Microsoft Windows 2000", delivered as Dommig.doc in the Windows 2000 Support Tools.</span></span> <span data-ttu-id="e33d8-120">Cette documentation est également disponible sur le CD du produit \\ , sous \\ outils de support.</span><span class="sxs-lookup"><span data-stu-id="e33d8-120">This documentation may also be found on the product CD under \\support\\tools.</span></span>

 

## <a name="authorization-requirements"></a><span data-ttu-id="e33d8-121">Conditions d’autorisation</span><span class="sxs-lookup"><span data-stu-id="e33d8-121">Authorization Requirements</span></span>

<span data-ttu-id="e33d8-122">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requiert des privilèges d’administrateur dans les domaines source et de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-122">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires administrator privileges in the source and destination domains.</span></span> <span data-ttu-id="e33d8-123">Plus précisément, l’appelant de cette API doit être membre du groupe administrateurs de domaine dans le domaine de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-123">Specifically, the caller of this API must be a member of the Domain Administrators group in the destination domain.</span></span> <span data-ttu-id="e33d8-124">Une vérification codée en dur pour cette appartenance est effectuée.</span><span class="sxs-lookup"><span data-stu-id="e33d8-124">A hard-coded check for this membership is performed.</span></span> <span data-ttu-id="e33d8-125">En outre, l’appelant ou le compte fourni dans le paramètre *SrcDomainCreds* , s’il n’est pas **null**, doit être membre du groupe administrateurs ou administrateurs de domaine dans le domaine source.</span><span class="sxs-lookup"><span data-stu-id="e33d8-125">Also, the caller or the account provided in the *SrcDomainCreds* parameter, if not **NULL**, must be a member of either the Administrators or Domain Administrators group in the source domain.</span></span>

## <a name="domain-and-trust-requirements"></a><span data-ttu-id="e33d8-126">Exigences relatives au domaine et à la confiance</span><span class="sxs-lookup"><span data-stu-id="e33d8-126">Domain and Trust Requirements</span></span>

<span data-ttu-id="e33d8-127">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requiert que le domaine de destination soit en mode natif Windows 2000 ou ultérieur, car seul ce type de domaine prend en charge l’attribut **SIDHistory** .</span><span class="sxs-lookup"><span data-stu-id="e33d8-127">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires that the destination domain be in Windows 2000 native mode or later, because only this domain type supports the **sIDHistory** attribute.</span></span> <span data-ttu-id="e33d8-128">Le domaine source peut être soit Windows NT 4,0, soit Windows 2000, en mode mixte ou natif.</span><span class="sxs-lookup"><span data-stu-id="e33d8-128">The source domain may be either Windows NT 4.0 or Windows 2000, mixed or native mode.</span></span> <span data-ttu-id="e33d8-129">Les domaines source et de destination ne doivent pas se trouver dans la même forêt.</span><span class="sxs-lookup"><span data-stu-id="e33d8-129">The source and destination domains must not be in the same forest.</span></span> <span data-ttu-id="e33d8-130">Les domaines Windows NT 4,0 sont par définition non dans une forêt.</span><span class="sxs-lookup"><span data-stu-id="e33d8-130">Windows NT 4.0 domains are by definition not in a forest.</span></span> <span data-ttu-id="e33d8-131">Cette contrainte inter-forêts garantit que les SID dupliqués, qu’ils apparaissent en tant que sid primaires ou valeurs **SIDHistory** , ne sont pas créés dans la même forêt.</span><span class="sxs-lookup"><span data-stu-id="e33d8-131">This inter-forest constraint ensures that duplicate SIDs, whether appearing as primary SIDs or **sIDHistory** values, are not created in the same forest.</span></span>

<span data-ttu-id="e33d8-132">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requiert une approbation externe entre le domaine source et le domaine de destination dans les cas indiqués dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="e33d8-132">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires an external trust from the source domain to the destination domain in the cases listed in the following table.</span></span>



| <span data-ttu-id="e33d8-133">Cas</span><span class="sxs-lookup"><span data-stu-id="e33d8-133">Case</span></span>                                                                             | <span data-ttu-id="e33d8-134">Description</span><span class="sxs-lookup"><span data-stu-id="e33d8-134">Description</span></span>                                                                                                                                                                                                                                                                 |
|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="e33d8-135">Le domaine source est Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="e33d8-135">The source domain is Windows 2000.</span></span><br/>                                    | <span data-ttu-id="e33d8-136">L’attribut **SIDHistory** source, disponible uniquement dans les domaines sources Windows 2000, peut être en lecture seule à l’aide de LDAP, ce qui nécessite cette approbation pour la protection de l’intégrité.</span><span class="sxs-lookup"><span data-stu-id="e33d8-136">The source **sIDHistory** attribute, available only in Windows 2000 source domains, may be read only using LDAP, which requires this trust for integrity protection.</span></span><br/>                                                                                             |
| <span data-ttu-id="e33d8-137">Le domaine source est Windows NT 4,0 et *SrcDomainCreds* a la **valeur null**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-137">The source domain is Windows NT 4.0 and *SrcDomainCreds* is **NULL**.</span></span><br/> | <span data-ttu-id="e33d8-138">L’emprunt d’identité, requis pour prendre en charge les opérations de domaine source à l’aide des informations d’identification de l’appelant, dépend de cette approbation.</span><span class="sxs-lookup"><span data-stu-id="e33d8-138">The impersonation, required to support source domain operations using the caller's credentials, depends on this trust.</span></span> <span data-ttu-id="e33d8-139">L’emprunt d’identité requiert également que le contrôleur de domaine de destination ait la valeur « approuvé pour la délégation » activée par défaut sur les contrôleurs de domaine.</span><span class="sxs-lookup"><span data-stu-id="e33d8-139">Impersonation also requires that the destination domain controller has "Trusted for Delegation" enabled by default on domain controllers.</span></span><br/> |



 

<span data-ttu-id="e33d8-140">Toutefois, aucune approbation n’est requise entre les domaines source et de destination si le domaine source est Windows NT 4,0 et *SrcDomainCreds* n’a pas la **valeur null**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-140">However, there is no trust required between the source and destination domains if the source domain is Windows NT 4.0 and *SrcDomainCreds* is not **NULL**.</span></span>

## <a name="source-domain-controller-requirements"></a><span data-ttu-id="e33d8-141">Configuration requise du contrôleur de domaine source</span><span class="sxs-lookup"><span data-stu-id="e33d8-141">Source Domain Controller Requirements</span></span>

<span data-ttu-id="e33d8-142">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requiert que le contrôleur de domaine, sélectionné comme cible pour les opérations dans le domaine source, soit le contrôleur de domaine principal dans les domaines windows NT 4,0 ou l’émulateur de contrôleur de domaine principal dans les domaines Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="e33d8-142">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires that the domain controller, selected as the target for operations in the source domain, be the PDC in Windows NT 4.0 domains or the PDC Emulator in Windows 2000 domains.</span></span> <span data-ttu-id="e33d8-143">L’audit du domaine source est généré par le biais d’opérations d’écriture. par conséquent, le contrôleur de domaine principal est requis dans les domaines sources Windows NT 4,0 et la restriction PDC uniquement garantit que les audits **DsAddSidHistory** sont générés sur un seul ordinateur.</span><span class="sxs-lookup"><span data-stu-id="e33d8-143">Source domain auditing is generated by way of write operations, therefore, the PDC is required in Windows NT 4.0 source domains, and the PDC-only restriction ensures that **DsAddSidHistory** audits are generated on a single computer.</span></span> <span data-ttu-id="e33d8-144">Cela réduit le besoin d’examiner les journaux d’audit de tous les contrôleurs de service pour surveiller l’utilisation de cette opération.</span><span class="sxs-lookup"><span data-stu-id="e33d8-144">This reduces the need to review the audit logs of all DCs to monitor use of this operation.</span></span>

> [!Note]  
> <span data-ttu-id="e33d8-145">Dans les domaines source Windows NT 4,0, le contrôleur de domaine principal (Target of Operations in the source Domain) doit exécuter Service Pack 4 (SP4) et versions ultérieures pour garantir une prise en charge de l’audit appropriée.</span><span class="sxs-lookup"><span data-stu-id="e33d8-145">In Windows NT 4.0 source domains, the PDC (target of operations in the source domain) must be running Service Pack 4 (SP4) and later to ensure proper auditing support.</span></span>

 

<span data-ttu-id="e33d8-146">La valeur de Registre suivante doit être créée en tant que \_ valeur reg DWORD et définie sur 1 sur le contrôleur de domaine source pour les contrôleurs de domaine sources Windows NT 4,0 et windows 2000.</span><span class="sxs-lookup"><span data-stu-id="e33d8-146">The following registry value must be created as a REG\_DWORD value and set to 1 on the source domain controller for both Windows NT 4.0 and Windows 2000 source DCs.</span></span>

```
HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
         Control
            Lsa
               TcpipClientSupport
```

<span data-ttu-id="e33d8-147">La définition de cette valeur active les appels RPC sur le transport TCP.</span><span class="sxs-lookup"><span data-stu-id="e33d8-147">Setting this value enables RPC calls over the TCP transport.</span></span> <span data-ttu-id="e33d8-148">Cela est nécessaire car, par défaut, les interfaces SAMRPC sont accessibles à distance uniquement sur les canaux nommés.</span><span class="sxs-lookup"><span data-stu-id="e33d8-148">This is required because, by default, SAMRPC interfaces are remotable only on named pipes.</span></span> <span data-ttu-id="e33d8-149">L’utilisation de canaux nommés aboutit à un système de gestion des informations d’identification adapté aux utilisateurs connectés de manière interactive à effectuer des appels en réseau, mais n’est pas flexible pour un processus système qui effectue des appels réseau avec les informations d’identification fournies par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e33d8-149">Using named pipes results in a credential management system suitable for interactively logged-on users making networked calls, but is not flexible for a system process that makes network calls with user-supplied credentials.</span></span> <span data-ttu-id="e33d8-150">RPC sur TCP est plus adapté à cet effet.</span><span class="sxs-lookup"><span data-stu-id="e33d8-150">RPC over TCP is more suitable for that purpose.</span></span> <span data-ttu-id="e33d8-151">La définition de cette valeur ne diminue pas la sécurité du système.</span><span class="sxs-lookup"><span data-stu-id="e33d8-151">Setting this value does not diminish system security.</span></span> <span data-ttu-id="e33d8-152">Si cette valeur est créée ou modifiée, le contrôleur de domaine source doit être redémarré pour que ce paramètre prenne effet.</span><span class="sxs-lookup"><span data-stu-id="e33d8-152">If this value is created or changed, the source domain controller must be restarted for this setting to take effect.</span></span>

<span data-ttu-id="e33d8-153">Un nouveau groupe local, « <SrcDomainName> $ $ $ », doit être créé dans le domaine source à des fins d’audit.</span><span class="sxs-lookup"><span data-stu-id="e33d8-153">A new local group, "<SrcDomainName>$$$", must be created in the source domain for auditing purposes.</span></span>

## <a name="auditing"></a><span data-ttu-id="e33d8-154">Audit</span><span class="sxs-lookup"><span data-stu-id="e33d8-154">Auditing</span></span>

<span data-ttu-id="e33d8-155">Les opérations [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) sont auditées pour s’assurer que les administrateurs de domaine source et de destination sont en mesure de détecter le moment où cette fonction a été exécutée.</span><span class="sxs-lookup"><span data-stu-id="e33d8-155">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operations are audited to ensure that both source and destination domain administrators are able to detect when this function has been run.</span></span> <span data-ttu-id="e33d8-156">L’audit est obligatoire dans les domaines source et de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-156">Auditing is mandatory in both the source and destination domains.</span></span> <span data-ttu-id="e33d8-157">**DsAddSidHistory** vérifie que le mode d’audit est activé dans chaque domaine et que l’audit de gestion des comptes des événements de réussite/échec est activé.</span><span class="sxs-lookup"><span data-stu-id="e33d8-157">**DsAddSidHistory** verifies that the Audit Mode is on in each domain and that Account Management auditing of Success/Failure events is on.</span></span> <span data-ttu-id="e33d8-158">Dans le domaine de destination, un événement d’audit « ajouter l’historique des SID » unique est généré pour chaque opération **DsAddSidHistory** réussie ou ayant échoué.</span><span class="sxs-lookup"><span data-stu-id="e33d8-158">In the destination domain, a unique "Add Sid History" audit event is generated for each successful or failed **DsAddSidHistory** operation.</span></span>

<span data-ttu-id="e33d8-159">Les événements d’audit « ajouter un historique des SID » uniques ne sont pas disponibles sur les systèmes Windows NT 4,0.</span><span class="sxs-lookup"><span data-stu-id="e33d8-159">Unique "Add Sid History" audit events are not available on Windows NT 4.0 systems.</span></span> <span data-ttu-id="e33d8-160">Pour générer des événements d’audit qui reflètent sans ambiguïté l’utilisation de [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) sur le domaine source, il effectue des opérations sur un groupe spécial dont le nom est l’identificateur unique dans le journal d’audit.</span><span class="sxs-lookup"><span data-stu-id="e33d8-160">To generate audit events that unambiguously reflect use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) against the source domain, it performs operations on a special group whose name is the unique identifier in the audit log.</span></span> <span data-ttu-id="e33d8-161">Un groupe local, « <SrcDomainName> $ $ $ », dont le nom est composé du nom NetBIOS du domaine source est ajouté avec trois signes dollar ($) (code ASCII = 0x24 et Unicode = U + 0024), doit être créé sur le contrôleur de domaine source avant d’appeler **DsAddSidHistory**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-161">A local group, "<SrcDomainName>$$$", whose name is composed of the source domain NetBIOS name appended with three dollar signs ($) (ASCII code = 0x24 and Unicode = U+0024), must be created on the source domain controller prior to calling **DsAddSidHistory**.</span></span> <span data-ttu-id="e33d8-162">Chaque utilisateur source et groupe global qui est une cible de cette opération est ajouté à, puis supprimé de l’appartenance de ce groupe.</span><span class="sxs-lookup"><span data-stu-id="e33d8-162">Each source user and global group that is a target of this operation is added to and then removed from the membership of this group.</span></span> <span data-ttu-id="e33d8-163">Cela génère des événements ajouter un membre et supprimer un membre dans le domaine source, qui peuvent être analysés en recherchant des événements qui référencent le nom du groupe.</span><span class="sxs-lookup"><span data-stu-id="e33d8-163">This generates Add Member and Delete Member audit events in the source domain, which can be monitored by searching for events that reference the group name.</span></span>

> [!Note]  
> <span data-ttu-id="e33d8-164">Les opérations [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) sur des groupes locaux dans un domaine source en mode mixte windows NT 4,0 ou Windows 2000 ne peuvent pas être auditées, car les groupes locaux ne peuvent pas être membres d’un autre groupe local et ne peuvent donc pas être ajoutés au <SrcDomainName> groupe local « $ $ $ » spécial.</span><span class="sxs-lookup"><span data-stu-id="e33d8-164">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operations on local groups in a Windows NT 4.0, or Windows 2000 mixed-mode source domain cannot be audited because local groups cannot be made members of another local group and therefore cannot be added to the special "<SrcDomainName>$$$" local group.</span></span> <span data-ttu-id="e33d8-165">Ce manque d’audit ne présente pas de problème de sécurité au domaine source, car l’accès aux ressources du domaine source n’est pas affecté par cette opération.</span><span class="sxs-lookup"><span data-stu-id="e33d8-165">This lack of auditing does not present a security issue to the source domain, because source domain resource access is not affected by this operation.</span></span> <span data-ttu-id="e33d8-166">L’ajout du SID d’un groupe local source à un groupe local de destination n’accorde pas l’accès aux ressources sources, protégées par ce groupe local, à des utilisateurs supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="e33d8-166">Adding the SID of a source local group to a destination local group does not grant access to source resources, protected by that local group, to any additional users.</span></span> <span data-ttu-id="e33d8-167">L’ajout de membres au groupe local de destination ne leur accorde pas l’accès aux ressources sources.</span><span class="sxs-lookup"><span data-stu-id="e33d8-167">Adding members to the destination local group does not grant them access to source resources.</span></span> <span data-ttu-id="e33d8-168">Les membres ajoutés bénéficient d’un accès uniquement aux serveurs du domaine de destination qui ont été migrés à partir du domaine source, qui peut avoir des ressources protégées par le SID du groupe local source.</span><span class="sxs-lookup"><span data-stu-id="e33d8-168">Added members are granted access only to servers in the destination domain migrated from the source domain, which may have resources protected by the source local group SID.</span></span>

 

## <a name="data-transmission-security"></a><span data-ttu-id="e33d8-169">Sécurité de la transmission de données</span><span class="sxs-lookup"><span data-stu-id="e33d8-169">Data Transmission Security</span></span>

<span data-ttu-id="e33d8-170">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) applique les mesures de sécurité suivantes :</span><span class="sxs-lookup"><span data-stu-id="e33d8-170">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) enforces the following security measures:</span></span>

-   <span data-ttu-id="e33d8-171">Appelé à partir d’une station de travail 2000 Windows, les informations d’identification de l’appelant sont utilisées pour l’authentification et la confidentialité-protéger l’appel RPC au contrôleur de domaine de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-171">Called from a Windows 2000 workstation, the caller's credentials are used to authenticate and privacy-protect the RPC call to the destination domain controller.</span></span> <span data-ttu-id="e33d8-172">Si *SrcDomainCreds* n’a pas la **valeur null**, la station de travail et le DC de destination doivent prendre en charge le chiffrement 128 bits pour la confidentialité-protéger les informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="e33d8-172">If *SrcDomainCreds* is not **NULL**, both the workstation and the destination DC must support 128-bit encryption to privacy-protect the credentials.</span></span> <span data-ttu-id="e33d8-173">Si le chiffrement 128 bits n’est pas disponible et que *SrcDomainCreds* est fourni, l’appel doit être effectué sur le contrôleur de l’emplacement de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-173">If 128-bit encryption is not available and *SrcDomainCreds* are provided, then the call must be made on the destination DC.</span></span>
-   <span data-ttu-id="e33d8-174">Le contrôleur de domaine de destination communique avec le contrôleur de domaine source à l’aide de *SrcDomainCreds* ou des informations d’identification de l’appelant pour l’authentification mutuelle et l’intégrité. Protégez la lecture du SID de compte source (à l’aide d’une recherche Sam) et **SIDHistory** (à l’aide d’une lecture LDAP).</span><span class="sxs-lookup"><span data-stu-id="e33d8-174">The destination domain controller communicates with the source domain controller using either *SrcDomainCreds* or the caller's credentials to mutually authenticate and integrity-protect the read of the source account SID (using a SAM lookup) and **sIDHistory** (using an LDAP read).</span></span>

## <a name="threat-models"></a><span data-ttu-id="e33d8-175">Modèles de menace</span><span class="sxs-lookup"><span data-stu-id="e33d8-175">Threat Models</span></span>

<span data-ttu-id="e33d8-176">Le tableau suivant répertorie les menaces potentielles associées à l’appel [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) et traite les mesures de sécurité pertinentes pour une menace particulière.</span><span class="sxs-lookup"><span data-stu-id="e33d8-176">The following table lists the potential threats associated with the [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) call and addresses the security measures pertinent to the particular threat.</span></span>



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="e33d8-177">Menace potentielle</span><span class="sxs-lookup"><span data-stu-id="e33d8-177">Potential threat</span></span></th>
<th><span data-ttu-id="e33d8-178">Mesure de sécurité</span><span class="sxs-lookup"><span data-stu-id="e33d8-178">Security measure</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="e33d8-179">Attaque de l’intercepteur</span><span class="sxs-lookup"><span data-stu-id="e33d8-179">Man in the Middle Attack</span></span><br/> <span data-ttu-id="e33d8-180">Un utilisateur non autorisé intercepte le <em>SID de recherche de l’appel de retour de l’objet source</em> , en remplaçant le SID de l’objet source par un SID arbitraire à insérer dans un sIDHistory de l’objet cible.</span><span class="sxs-lookup"><span data-stu-id="e33d8-180">An unauthorized user intercepts the <em>lookup SID of source object</em> return call, replacing the source object SID with an arbitrary SID for insertion into a target object SIDhistory.</span></span><br/></td>
<td><span data-ttu-id="e33d8-181">Le <em>SID de recherche de l’objet source</em> est un RPC authentifié, à l’aide des informations d’identification d’administrateur de l’appelant, avec la protection des messages d’intégrité du paquet.</span><span class="sxs-lookup"><span data-stu-id="e33d8-181">The <em>lookup SID of source object</em> is an authenticated RPC, using the caller's administrator credentials, with packet integrity message protection.</span></span> <span data-ttu-id="e33d8-182">Cela garantit que l’appel de retour ne peut pas être modifié sans détection.</span><span class="sxs-lookup"><span data-stu-id="e33d8-182">This ensures that the return call cannot be modified without detection.</span></span> <span data-ttu-id="e33d8-183">Le contrôleur de domaine de destination crée un &quot; événement d’audit de l’historique des SID unique &quot; qui reflète le SID ajouté au <strong>SIDHistory</strong>du compte de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-183">The destination domain controller creates a unique &quot;Add SID History&quot; audit event that reflects the SID added to the destination account <strong>sIDHistory</strong>.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="e33d8-184">Domaine source cheval de Troie</span><span class="sxs-lookup"><span data-stu-id="e33d8-184">Trojan Source Domain</span></span><br/> <span data-ttu-id="e33d8-185">Un utilisateur non autorisé crée un &quot; &quot; domaine source cheval de Troie sur un réseau privé qui a le même SID de domaine et certains des mêmes SID de compte que le domaine source légitime.</span><span class="sxs-lookup"><span data-stu-id="e33d8-185">An unauthorized user creates a &quot;Trojan Horse&quot; source domain on a private network that has the same domain SID and some of the same account SIDs as the legitimate source domain.</span></span> <span data-ttu-id="e33d8-186">L’utilisateur non autorisé tente ensuite d’exécuter <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> dans un domaine de destination pour obtenir le SID d’un compte source.</span><span class="sxs-lookup"><span data-stu-id="e33d8-186">The unauthorized user then attempts to run <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> in a destination domain to obtain the SID of a source account.</span></span> <span data-ttu-id="e33d8-187">Cela s’effectue sans avoir besoin des informations d’identification d’administrateur de domaine source réelles et sans laisser de piste d’audit dans le véritable domaine source.</span><span class="sxs-lookup"><span data-stu-id="e33d8-187">This is done without the need for the real source Domain Administrator credentials and without leaving an audit trail in the real source domain.</span></span> <span data-ttu-id="e33d8-188">La méthode d’utilisateur non autorisée pour créer le domaine source cheval de Troie peut être l’une des suivantes :</span><span class="sxs-lookup"><span data-stu-id="e33d8-188">The unauthorized user's method for creating the Trojan Horse source domain could be one of the following:</span></span>
<ul>
<li><span data-ttu-id="e33d8-189">Obtenez une copie (sauvegarde BDC) du domaine source SAM.</span><span class="sxs-lookup"><span data-stu-id="e33d8-189">Obtain a copy (BDC backup) of the source domain SAM.</span></span></li>
<li><span data-ttu-id="e33d8-190">Créez un nouveau domaine, en modifiant le SID du domaine sur le disque afin qu’il corresponde au SID du domaine source légitime, puis créez suffisamment d’utilisateurs pour instancier un compte avec le SID souhaité.</span><span class="sxs-lookup"><span data-stu-id="e33d8-190">Create a new domain, altering the domain SID on disk to match the legitimate source domain SID, then create enough users to instantiate an account with the desired SID.</span></span></li>
<li><span data-ttu-id="e33d8-191">Créer un réplica BDC.</span><span class="sxs-lookup"><span data-stu-id="e33d8-191">Create a BDC replica.</span></span> <span data-ttu-id="e33d8-192">Cela nécessite des informations d’identification d’administrateur de domaine source.</span><span class="sxs-lookup"><span data-stu-id="e33d8-192">This requires source domain Administrator credentials.</span></span> <span data-ttu-id="e33d8-193">L’utilisateur non autorisé utilise ensuite le réplica sur un réseau privé pour mettre en œuvre l’attaque.</span><span class="sxs-lookup"><span data-stu-id="e33d8-193">Then the unauthorized user takes the replica to a private network to implement the attack.</span></span></li>
</ul>
<br/></td>
<td><span data-ttu-id="e33d8-194">Bien qu’il existe de nombreuses façons pour un utilisateur non autorisé de récupérer ou de créer un SID d’objet source souhaité, l’utilisateur non autorisé ne peut pas l’utiliser pour mettre à jour le <strong>SIDHistory</strong> d’un compte sans être membre du groupe administrateurs de domaine de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-194">Although there are many ways for an unauthorized user to retrieve or create a desired source object SID, the unauthorized user cannot use it to update an account's <strong>sIDHistory</strong> without being a member of the destination Domain Administrators group.</span></span> <span data-ttu-id="e33d8-195">Étant donné que la vérification, sur le contrôleur de domaine de destination, pour l’appartenance à un administrateur de domaine est codée en dur, sur le contrôleur de domaine cible, il n’existe aucune méthode permettant d’effectuer une modification de disque pour modifier les données de contrôle d’accès qui protègent cette fonction.</span><span class="sxs-lookup"><span data-stu-id="e33d8-195">Because the check, on the destination domain controller, for Domain Administrator membership is hard-coded, on the target DC, there is no method for doing a disk modification to change the access control data protecting this function.</span></span> <span data-ttu-id="e33d8-196">Une tentative de clonage d’un compte source cheval de Troie est auditée dans le domaine de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-196">An attempt to clone a Trojan Horse source account is audited in the destination domain.</span></span> <span data-ttu-id="e33d8-197">Cette attaque est atténuée en réservant l’appartenance au groupe administrateurs de domaine uniquement pour les personnes hautement fiables.</span><span class="sxs-lookup"><span data-stu-id="e33d8-197">This attack is mitigated by reserving membership in the Domain Administrators group for only highly trusted individuals.</span></span><br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="e33d8-198">Modification sur disque de l’historique SID</span><span class="sxs-lookup"><span data-stu-id="e33d8-198">On-disk Modification of SID History</span></span><br/> <span data-ttu-id="e33d8-199">Un utilisateur non autorisé sophistiqué, avec des informations d’identification d’administrateur de domaine et ayant un accès physique à un contrôleur de domaine dans le domaine de destination, peut modifier une valeur <strong>SIDHistory</strong> de compte sur le disque.</span><span class="sxs-lookup"><span data-stu-id="e33d8-199">A sophisticated unauthorized user, with Domain Administrator credentials and with physical access to a DC in the destination domain, could modify an account <strong>sIDHistory</strong> value on disk.</span></span><br/></td>
<td><span data-ttu-id="e33d8-200">Cette tentative n’est pas activée à l’aide de <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="e33d8-200">This attempt is not enabled by use of <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>.</span></span> <span data-ttu-id="e33d8-201">Cette attaque est atténuée en empêchant l’accès physique aux contrôleurs de domaine, à l’exception des administrateurs hautement approuvés.</span><span class="sxs-lookup"><span data-stu-id="e33d8-201">This attack is mitigated by preventing physical access to domain controllers to all except highly trusted administrators.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="e33d8-202">Code non autorisé utilisé pour supprimer les protections</span><span class="sxs-lookup"><span data-stu-id="e33d8-202">Rogue Code Used to Remove Protections</span></span><br/> <span data-ttu-id="e33d8-203">Un utilisateur non autorisé ou un administrateur malveillant disposant d’un accès physique au code du service d’annuaire pourrait créer du code non autorisé :</span><span class="sxs-lookup"><span data-stu-id="e33d8-203">An unauthorized user or rogue administrator with physical access to the Directory Service code could create rogue code that:</span></span>
<ol>
<li><span data-ttu-id="e33d8-204">Supprime la vérification de l’appartenance au groupe administrateurs de domaine dans le code.</span><span class="sxs-lookup"><span data-stu-id="e33d8-204">Removes the check for membership in the Domain Administrators group in the code.</span></span></li>
<li><span data-ttu-id="e33d8-205">Modifie les appels sur le contrôleur de domaine source qui pointe le SID sur un LookupSidFromName qui n’est pas audité.</span><span class="sxs-lookup"><span data-stu-id="e33d8-205">Changes the calls on the source domain controller that points the SID to a LookupSidFromName that is not audited.</span></span></li>
<li><span data-ttu-id="e33d8-206">Supprime les appels du journal d’audit.</span><span class="sxs-lookup"><span data-stu-id="e33d8-206">Removes audit log calls.</span></span></li>
</ol>
<br/></td>
<td><span data-ttu-id="e33d8-207">Une personne ayant un accès physique au code du service d’annuaire et suffisamment compétent pour créer du code non fiable a la possibilité de modifier arbitrairement l’attribut <strong>SIDHistory</strong> d’un compte.</span><span class="sxs-lookup"><span data-stu-id="e33d8-207">Someone with physical access to the DS code and knowledgeable enough to create rogue code has the capability of arbitrarily modifying the <strong>sIDHistory</strong> attribute of an account.</span></span> <span data-ttu-id="e33d8-208">L’API <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> n’augmente pas ce risque de sécurité.</span><span class="sxs-lookup"><span data-stu-id="e33d8-208">The <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> API does not increase this security risk.</span></span><br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="e33d8-209">Ressources vulnérables aux sid volés</span><span class="sxs-lookup"><span data-stu-id="e33d8-209">Resources Vulnerable to Stolen SIDs</span></span><br/> <span data-ttu-id="e33d8-210">Si un utilisateur non autorisé a réussi à utiliser l’une des méthodes décrites ici pour modifier un compte <strong>SIDHistory</strong>de compte, et si les domaines de ressources dignes d’intérêt approuvent le domaine de compte d’utilisateur non autorisé, l’utilisateur non autorisé peut accéder aux ressources du SID volé, éventuellement sans quitter une piste d’audit dans le domaine de compte à partir duquel le SID a été volé.</span><span class="sxs-lookup"><span data-stu-id="e33d8-210">If an unauthorized user has succeeded in using one of the methods described here to modify an account <strong>sIDHistory</strong>, and if the resource domains of interest trust the unauthorized user account domain, then the unauthorized user can get unauthorized access to the stolen SID's resources, potentially without leaving an audit trail in the account domain from which the SID was stolen.</span></span><br/></td>
<td><span data-ttu-id="e33d8-211">Les administrateurs de domaine de ressources protègent leurs ressources en configurant uniquement les relations d’approbation qui sont logiques du point de vue de la sécurité.</span><span class="sxs-lookup"><span data-stu-id="e33d8-211">Resource domain administrators protect their resources by setting up only those trust relationships that make sense from a security perspective.</span></span> <span data-ttu-id="e33d8-212">L’utilisation de <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> est limitée, dans le domaine cible approuvé, aux membres du groupe administrateurs de domaine qui possèdent déjà des autorisations étendues dans le cadre de leurs responsabilités.</span><span class="sxs-lookup"><span data-stu-id="e33d8-212">Use of <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> is restricted, in the trusted target domain, to members of the Domain Administrators group who already have broad permissions within the scope of their responsibilities.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="e33d8-213">Domaine cible non autorisé</span><span class="sxs-lookup"><span data-stu-id="e33d8-213">Rogue Target Domain</span></span><br/> <span data-ttu-id="e33d8-214">Un utilisateur non autorisé crée un domaine Windows 2000 avec un compte dont le <strong>SIDHistory</strong> contient un SID qui a été volé à partir d’un domaine source.</span><span class="sxs-lookup"><span data-stu-id="e33d8-214">An unauthorized user creates a Windows 2000 domain with an account whose <strong>sIDHistory</strong> contains a SID that has been stolen from a source domain.</span></span> <span data-ttu-id="e33d8-215">L’utilisateur non autorisé utilise ce compte pour un accès non autorisé aux ressources.</span><span class="sxs-lookup"><span data-stu-id="e33d8-215">The unauthorized user uses this account for unauthorized access to resources.</span></span><br/></td>
<td><span data-ttu-id="e33d8-216">L’utilisateur non autorisé requiert des informations d’identification d’administrateur pour le domaine source afin d’utiliser <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>et laisse une piste d’audit sur le contrôleur de domaine source.</span><span class="sxs-lookup"><span data-stu-id="e33d8-216">The unauthorized user requires Administrator credentials for the source domain in order to use <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>, and leaves an audit trail on the source domain controller.</span></span> <span data-ttu-id="e33d8-217">Le domaine cible non autorisé bénéficie d’un accès non autorisé uniquement dans les autres domaines qui approuvent le domaine non autorisé, ce qui requiert des privilèges d’administrateur dans ces domaines de ressources.</span><span class="sxs-lookup"><span data-stu-id="e33d8-217">The rogue target domain gains unauthorized access only in other domains that trust the rogue domain, which requires Administrator privileges in those resource domains.</span></span><br/></td>
</tr>
</tbody>
</table>



 

## <a name="operational-constraints"></a><span data-ttu-id="e33d8-218">Contraintes opérationnelles</span><span class="sxs-lookup"><span data-stu-id="e33d8-218">Operational Constraints</span></span>

<span data-ttu-id="e33d8-219">Cette section décrit les contraintes opérationnelles liées à l’utilisation de la fonction [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) .</span><span class="sxs-lookup"><span data-stu-id="e33d8-219">This section describes the operational constraints of using the [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) function.</span></span>

<span data-ttu-id="e33d8-220">Le SID de *SrcPrincipal* ne doit pas déjà exister dans la forêt de destination, qu’il s’agisse d’un SID de compte principal ou de l' **attribut sIDHistory** d’un compte.</span><span class="sxs-lookup"><span data-stu-id="e33d8-220">The SID of *SrcPrincipal* must not already exist in the destination forest, either as a primary account SID or in the **sIDHistory** of an account.</span></span> <span data-ttu-id="e33d8-221">L’exception est que [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) ne génère pas d’erreur lors de la tentative d’ajout d’un SID à un **SIDHistory** qui contient un SID identique.</span><span class="sxs-lookup"><span data-stu-id="e33d8-221">The exception is that [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) does not generate an error when attempting to add a SID to a **sIDHistory** that contains an identical SID.</span></span> <span data-ttu-id="e33d8-222">Ce comportement permet à **DsAddSidHistory** de s’exécuter plusieurs fois avec une entrée identique, ce qui aboutit à la réussite et à un état final cohérent, pour faciliter l’utilisation des développeurs d’outils.</span><span class="sxs-lookup"><span data-stu-id="e33d8-222">This behavior enables **DsAddSidHistory** to be run multiple times with identical input, resulting in success and a consistent end state, for tool developer ease-of-use.</span></span>

> [!Note]  
> <span data-ttu-id="e33d8-223">La latence de réplication du catalogue global peut fournir une fenêtre pendant laquelle des SID dupliqués peuvent être créés.</span><span class="sxs-lookup"><span data-stu-id="e33d8-223">Global Catalog replication latency may provide a window during which duplicate SIDs may be created.</span></span> <span data-ttu-id="e33d8-224">Toutefois, les SID dupliqués peuvent être facilement supprimés par un administrateur.</span><span class="sxs-lookup"><span data-stu-id="e33d8-224">However, duplicate SIDs can be easily deleted by an administrator.</span></span>

 

<span data-ttu-id="e33d8-225">*SrcPrincipal* et *DstPrincipal* doivent être de l’un des types suivants :</span><span class="sxs-lookup"><span data-stu-id="e33d8-225">*SrcPrincipal* and *DstPrincipal* must be one of the following types:</span></span>

-   <span data-ttu-id="e33d8-226">Utilisateur</span><span class="sxs-lookup"><span data-stu-id="e33d8-226">User</span></span>
-   <span data-ttu-id="e33d8-227">Groupe avec sécurité activée, y compris :</span><span class="sxs-lookup"><span data-stu-id="e33d8-227">Security Enabled Group, including:</span></span>

    <dl> <span data-ttu-id="e33d8-228">Groupe local</span><span class="sxs-lookup"><span data-stu-id="e33d8-228">Local group</span></span>  
    <span data-ttu-id="e33d8-229">Groupe global</span><span class="sxs-lookup"><span data-stu-id="e33d8-229">Global group</span></span>  
    <span data-ttu-id="e33d8-230">Groupe de domaine local (Windows 2000 en mode natif uniquement)</span><span class="sxs-lookup"><span data-stu-id="e33d8-230">Domain local group (Windows 2000 native mode only)</span></span>  
    <span data-ttu-id="e33d8-231">Groupe universel (Windows 2000 en mode natif uniquement)</span><span class="sxs-lookup"><span data-stu-id="e33d8-231">Universal group (Windows 2000 native mode only)</span></span>  
    </dl>

<span data-ttu-id="e33d8-232">Les types d’objets de *SrcPrincipal* et *DstPrincipal* doivent correspondre.</span><span class="sxs-lookup"><span data-stu-id="e33d8-232">The object types of *SrcPrincipal* and *DstPrincipal* must match.</span></span>

-   <span data-ttu-id="e33d8-233">Si *SrcPrincipal* est un utilisateur, *DstPrincipal* doit être un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e33d8-233">If *SrcPrincipal* is a User, *DstPrincipal* must be a User.</span></span>
-   <span data-ttu-id="e33d8-234">Si *SrcPrincipal* est un groupe local ou de domaine local, *DstPrincipal* doit être un groupe de domaine local.</span><span class="sxs-lookup"><span data-stu-id="e33d8-234">If *SrcPrincipal* is a Local or Domain Local Group, *DstPrincipal* must be a Domain Local Group.</span></span>
-   <span data-ttu-id="e33d8-235">Si *SrcPrincipal* est un groupe global ou universel, *DstPrincipal* doit être un groupe global ou universel.</span><span class="sxs-lookup"><span data-stu-id="e33d8-235">If *SrcPrincipal* is a Global or Universal Group, *DstPrincipal* must be a Global or Universal Group.</span></span>

<span data-ttu-id="e33d8-236">*SrcPrincipal* et *DstPrincipal* ne peuvent pas être de l’un des types suivants : ([**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) échoue avec une erreur dans ces cas)</span><span class="sxs-lookup"><span data-stu-id="e33d8-236">*SrcPrincipal* and *DstPrincipal* cannot be one of the following types: ([**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) fails with an error in these cases)</span></span>

-   <span data-ttu-id="e33d8-237">Ordinateur (station de travail ou contrôleur de domaine)</span><span class="sxs-lookup"><span data-stu-id="e33d8-237">Computer (workstation or domain controller)</span></span>
-   <span data-ttu-id="e33d8-238">Approbation inter-domaines</span><span class="sxs-lookup"><span data-stu-id="e33d8-238">Inter-domain trust</span></span>
-   <span data-ttu-id="e33d8-239">Compte dupliqué temporaire (fonctionnalité presque inutilisée, ancien élément LANman)</span><span class="sxs-lookup"><span data-stu-id="e33d8-239">Temporary duplicate account (virtually unused feature, a legacy of LANman)</span></span>
-   <span data-ttu-id="e33d8-240">Comptes avec des SID bien connus.</span><span class="sxs-lookup"><span data-stu-id="e33d8-240">Accounts with Well Known SIDs.</span></span> <span data-ttu-id="e33d8-241">Les SID bien connus sont identiques dans chaque domaine ; ainsi, l’ajout de ces éléments à un **SIDHistory** violerait l’exigence d’unicité des SID d’une forêt Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="e33d8-241">Well Known SIDs are identical in every domain; thus adding them to a **sIDHistory** would violate the SID uniqueness requirement of a Windows 2000 forest.</span></span> <span data-ttu-id="e33d8-242">Les comptes avec des SID bien connus incluent les groupes locaux suivants :</span><span class="sxs-lookup"><span data-stu-id="e33d8-242">Accounts with Well Known SIDs include the following local groups:</span></span>

    <dl> <span data-ttu-id="e33d8-243">Opérateurs de compte</span><span class="sxs-lookup"><span data-stu-id="e33d8-243">Account operators</span></span>  
    <span data-ttu-id="e33d8-244">Administrateurs</span><span class="sxs-lookup"><span data-stu-id="e33d8-244">Administrators</span></span>  
    <span data-ttu-id="e33d8-245">Opérateurs de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="e33d8-245">Backup operators</span></span>  
    <span data-ttu-id="e33d8-246">Invités</span><span class="sxs-lookup"><span data-stu-id="e33d8-246">Guests</span></span>  
    <span data-ttu-id="e33d8-247">Opérateurs d’impression</span><span class="sxs-lookup"><span data-stu-id="e33d8-247">Print operators</span></span>  
    <span data-ttu-id="e33d8-248">Duplicateur</span><span class="sxs-lookup"><span data-stu-id="e33d8-248">Replicator</span></span>  
    <span data-ttu-id="e33d8-249">Opérateurs de serveur</span><span class="sxs-lookup"><span data-stu-id="e33d8-249">Server operators</span></span>  
    <span data-ttu-id="e33d8-250">Utilisateurs</span><span class="sxs-lookup"><span data-stu-id="e33d8-250">Users</span></span>  
    </dl>

<span data-ttu-id="e33d8-251">Si *SrcPrincipal* a un identificateur relatif connu (RID) et un préfixe spécifique à un domaine, c’est-à-dire les administrateurs de domaine, les utilisateurs de domaine et les ordinateurs du domaine, *DstPrincipal* doit posséder le même RID bien connu pour que [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) puisse fonctionner correctement.</span><span class="sxs-lookup"><span data-stu-id="e33d8-251">If *SrcPrincipal* has a well-known relative identifier (RID) and a domain specific prefix, that is, Domain Administrators, Domain Users, and Domain Computers, then *DstPrincipal* must possess the same well-known RID in order for [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) to succeed.</span></span> <span data-ttu-id="e33d8-252">Les comptes avec des RID bien connus incluent les utilisateurs et les groupes globaux suivants :</span><span class="sxs-lookup"><span data-stu-id="e33d8-252">Accounts with well-known RIDs include the following users and global groups:</span></span>

-   <span data-ttu-id="e33d8-253">Administrateur</span><span class="sxs-lookup"><span data-stu-id="e33d8-253">Administrator</span></span>
-   <span data-ttu-id="e33d8-254">Invité</span><span class="sxs-lookup"><span data-stu-id="e33d8-254">Guest</span></span>
-   <span data-ttu-id="e33d8-255">Administrateurs de domaine</span><span class="sxs-lookup"><span data-stu-id="e33d8-255">Domain administrators</span></span>
-   <span data-ttu-id="e33d8-256">Invités du domaine</span><span class="sxs-lookup"><span data-stu-id="e33d8-256">Domain guests</span></span>
-   <span data-ttu-id="e33d8-257">Utilisateurs du domaine</span><span class="sxs-lookup"><span data-stu-id="e33d8-257">Domain users</span></span>

## <a name="setting-the-registry-value"></a><span data-ttu-id="e33d8-258">Définition de la valeur de Registre</span><span class="sxs-lookup"><span data-stu-id="e33d8-258">Setting the Registry Value</span></span>

<span data-ttu-id="e33d8-259">La procédure suivante montre comment définir la valeur de registre TcpipClientSupport.</span><span class="sxs-lookup"><span data-stu-id="e33d8-259">The following procedure shows how to set the TcpipClientSupport registry value.</span></span>

<span data-ttu-id="e33d8-260">**Pour définir la valeur de registre TcpipClientSupport**</span><span class="sxs-lookup"><span data-stu-id="e33d8-260">**To Set the TcpipClientSupport Registry Value**</span></span>

1.  <span data-ttu-id="e33d8-261">Créez la valeur de Registre suivante en tant que \_ valeur reg DWORD sur le contrôleur de domaine source et définissez sa valeur sur 1.</span><span class="sxs-lookup"><span data-stu-id="e33d8-261">Create the following registry value as a REG\_DWORD value on the source domain controller and set its value to 1.</span></span>

    <span data-ttu-id="e33d8-262">**HKEY \_ local \_ machine \\ System \\ CurrentControlSet \\ contrôle \\ LSA \\ TcpipClientSupport**</span><span class="sxs-lookup"><span data-stu-id="e33d8-262">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\TcpipClientSupport**</span></span>

2.  <span data-ttu-id="e33d8-263">Ensuite, redémarrez le contrôleur de domaine source.</span><span class="sxs-lookup"><span data-stu-id="e33d8-263">Then, restart the source domain controller.</span></span> <span data-ttu-id="e33d8-264">Cette valeur de registre fait en sorte que le SAM écoute le protocole TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="e33d8-264">This registry value causes the SAM to listen on TCP/IP.</span></span> <span data-ttu-id="e33d8-265">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) échoue si cette valeur n’est pas définie sur le contrôleur de domaine source.</span><span class="sxs-lookup"><span data-stu-id="e33d8-265">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) will fail if this value is not set on the source domain controller.</span></span>

## <a name="enabling-auditing-of-usergroup-management-events"></a><span data-ttu-id="e33d8-266">Activation de l’audit des événements de gestion des utilisateurs/groupes</span><span class="sxs-lookup"><span data-stu-id="e33d8-266">Enabling Auditing of User/Group Management Events</span></span>

<span data-ttu-id="e33d8-267">La procédure suivante montre comment activer l’audit des événements de gestion des utilisateurs/groupes dans un domaine source ou de destination Windows 2000 ou Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="e33d8-267">The following procedure shows how to enable auditing of User/Group management events in a Windows 2000 or Windows Server 2003 source or destination domain.</span></span>

<span data-ttu-id="e33d8-268">**Pour activer l’audit des événements de gestion des utilisateurs/groupes dans un domaine source ou de destination Windows 2000 ou Windows Server 2003**</span><span class="sxs-lookup"><span data-stu-id="e33d8-268">**To enable auditing of User/Group management events in a Windows 2000 or Windows Server 2003 source or destination domain**</span></span>

1.  <span data-ttu-id="e33d8-269">Dans le composant logiciel enfichable MMC utilisateurs et ordinateurs Active Directory, sélectionnez le conteneur contrôleurs de domaine de domaine de destination.</span><span class="sxs-lookup"><span data-stu-id="e33d8-269">In the Active Directory Users and Computers MMC Snap-in, select the destination domain Domain Controllers container.</span></span>
2.  <span data-ttu-id="e33d8-270">Cliquez avec le bouton droit sur **contrôleurs de domaine** , puis choisissez **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-270">Right-click **Domain Controllers** and choose **Properties**.</span></span>
3.  <span data-ttu-id="e33d8-271">Cliquez sur l’onglet **stratégie de groupe** .</span><span class="sxs-lookup"><span data-stu-id="e33d8-271">Click the **Group Policy** tab.</span></span>
4.  <span data-ttu-id="e33d8-272">Sélectionnez la **stratégie contrôleurs de domaine par défaut** et cliquez sur **modifier**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-272">Select the **Default Domain Controllers Policy** and click **Edit**.</span></span>
5.  <span data-ttu-id="e33d8-273">Sous **Configuration ordinateur \\ Paramètres Windows paramètres de \\ sécurité \\ stratégies locales \\ stratégie d’audit**, double-cliquez sur **auditer la gestion des comptes**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-273">Under **Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Audit Policy**, double-click **Audit Account Management**.</span></span>
6.  <span data-ttu-id="e33d8-274">Dans la fenêtre **auditer la gestion des comptes** , sélectionnez audit des **réussites** et des **échecs** .</span><span class="sxs-lookup"><span data-stu-id="e33d8-274">In the **Audit Account Management** window, select both **Success** and **Failure** auditing.</span></span> <span data-ttu-id="e33d8-275">Les mises à jour de stratégie prennent effet après un redémarrage ou après l’actualisation.</span><span class="sxs-lookup"><span data-stu-id="e33d8-275">Policy updates take effect after a restart or after a refresh occurs.</span></span>
7.  <span data-ttu-id="e33d8-276">Vérifiez que l’audit est activé en affichant la stratégie d’audit effective dans le composant logiciel enfichable MMC stratégie de groupe.</span><span class="sxs-lookup"><span data-stu-id="e33d8-276">Verify that auditing is enabled by viewing the effective audit policy in the Group Policy MMC Snap-in.</span></span>

<span data-ttu-id="e33d8-277">La procédure suivante montre comment activer l’audit des événements de gestion des utilisateurs/groupes dans un domaine Windows NT 4,0.</span><span class="sxs-lookup"><span data-stu-id="e33d8-277">The following procedure shows how to enable auditing of User/Group management events in a Windows NT 4.0 domain.</span></span>

<span data-ttu-id="e33d8-278">**Pour activer l’audit des événements de gestion des utilisateurs/groupes dans un domaine Windows NT 4,0**</span><span class="sxs-lookup"><span data-stu-id="e33d8-278">**To enable auditing of User/Group management events in a Windows NT 4.0 domain**</span></span>

1.  <span data-ttu-id="e33d8-279">Dans le **Gestionnaire des utilisateurs pour les domaines**, cliquez sur le menu **stratégies** et sélectionnez **audit**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-279">In **User Manager for Domains**, click the **Policies** menu and select **Audit**.</span></span>
2.  <span data-ttu-id="e33d8-280">Sélectionnez **auditer ces événements**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-280">Select **Audit These Events**.</span></span>
3.  <span data-ttu-id="e33d8-281">Pour la **gestion des utilisateurs et des groupes**, vérifiez la **réussite et l’échec**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-281">For **User and Group Management**, check **Success and Failure**.</span></span>

<span data-ttu-id="e33d8-282">La procédure suivante montre comment activer l’audit des événements de gestion des utilisateurs/groupes dans un domaine source Windows NT 4,0, Windows 2000 ou Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="e33d8-282">The following procedure shows how to enable auditing of User/Group management events in a Windows NT 4.0, Windows 2000, or Windows Server 2003 source domain.</span></span>

<span data-ttu-id="e33d8-283">**Pour activer l’audit des événements de gestion des utilisateurs/groupes dans un domaine source Windows NT 4,0, Windows 2000 ou Windows Server 2003**</span><span class="sxs-lookup"><span data-stu-id="e33d8-283">**To enable auditing of User/Group management events in a Windows NT 4.0, Windows 2000, or Windows Server 2003 source domain**</span></span>

1.  <span data-ttu-id="e33d8-284">Dans le **Gestionnaire des utilisateurs pour les domaines**, cliquez sur le menu **utilisateur** , puis sélectionnez **nouveau groupe local**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-284">In **User Manager for Domains**, click the **User** menu and select **New Local Group**.</span></span>
2.  <span data-ttu-id="e33d8-285">Entrez un nom de groupe composé du nom NetBIOS du domaine source, à l’aide de trois signes dollar ($), par exemple, FABRIKAM $ $ $.</span><span class="sxs-lookup"><span data-stu-id="e33d8-285">Enter a group name composed of the source domain NetBIOS name appended with three dollar signs ($), for example, FABRIKAM$$$.</span></span> <span data-ttu-id="e33d8-286">Le champ description doit indiquer que ce groupe est utilisé pour auditer l’utilisation des [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) ou des opérations de clonage.</span><span class="sxs-lookup"><span data-stu-id="e33d8-286">The description field should indicate that this group is used to audit use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) or cloning operations.</span></span> <span data-ttu-id="e33d8-287">Assurez-vous qu’il n’y a aucun membre dans le groupe.</span><span class="sxs-lookup"><span data-stu-id="e33d8-287">Ensure there are no members in the group.</span></span> <span data-ttu-id="e33d8-288">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-288">Click **OK**.</span></span>

<span data-ttu-id="e33d8-289">L’opération [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) échoue si l’audit de source et de destination n’est pas activé comme décrit ici.</span><span class="sxs-lookup"><span data-stu-id="e33d8-289">The [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operation fails if source and destination auditing are not enabled as described here.</span></span>

## <a name="set-up-trust-if-required"></a><span data-ttu-id="e33d8-290">Configurer l’approbation si nécessaire</span><span class="sxs-lookup"><span data-stu-id="e33d8-290">Set up Trust if Required</span></span>

<span data-ttu-id="e33d8-291">Si l’une des conditions suivantes est vraie, une approbation doit être établie entre le domaine source et le domaine de destination (cela doit se produire dans une autre forêt) :</span><span class="sxs-lookup"><span data-stu-id="e33d8-291">If one of the following is true, a trust must be established from the source domain to the destination domain (this must occur in a different forest):</span></span>

-   <span data-ttu-id="e33d8-292">Le domaine source est Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="e33d8-292">The source domain is Windows Server 2003.</span></span>
-   <span data-ttu-id="e33d8-293">Le domaine source est Windows NT 4,0 et *SrcDomainCreds* a la **valeur null**.</span><span class="sxs-lookup"><span data-stu-id="e33d8-293">The source domain is Windows NT 4.0 and *SrcDomainCreds* is **NULL**.</span></span>

 

 





