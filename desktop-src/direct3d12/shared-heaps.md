---
title: Tas partagés
description: Le partage est utile pour les architectures multiprocessus et multi-adaptateurs.
ms.assetid: 67C6B1D4-BF76-45A9-BADC-7C9520C900EB
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f4271055f88e38484041c225b6b17c6d75f0d98
ms.sourcegitcommit: d6102d9e2b26368142fe5b006c65acb50c98be65
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/26/2019
ms.locfileid: "74104452"
---
# <a name="shared-heaps"></a><span data-ttu-id="bfab2-103">Tas partagés</span><span class="sxs-lookup"><span data-stu-id="bfab2-103">Shared Heaps</span></span>

<span data-ttu-id="bfab2-104">Le partage est utile pour les architectures multiprocessus et multi-adaptateurs.</span><span class="sxs-lookup"><span data-stu-id="bfab2-104">Sharing is useful for multi-process and multi-adapter architectures.</span></span>

-   [<span data-ttu-id="bfab2-105">Vue d’ensemble du partage</span><span class="sxs-lookup"><span data-stu-id="bfab2-105">Sharing overview</span></span>](#sharing-overview)
-   [<span data-ttu-id="bfab2-106">Partage des tas entre les processus</span><span class="sxs-lookup"><span data-stu-id="bfab2-106">Sharing heaps across processes</span></span>](#sharing-heaps-across-processes)
-   [<span data-ttu-id="bfab2-107">Partage des segments de mémoire entre les adaptateurs</span><span class="sxs-lookup"><span data-stu-id="bfab2-107">Sharing heaps across adapters</span></span>](#sharing-heaps-across-adapters)
-   [<span data-ttu-id="bfab2-108">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="bfab2-108">Related topics</span></span>](#related-topics)

## <a name="sharing-overview"></a><span data-ttu-id="bfab2-109">Vue d’ensemble du partage</span><span class="sxs-lookup"><span data-stu-id="bfab2-109">Sharing overview</span></span>

<span data-ttu-id="bfab2-110">Les tas partagés permettent deux choses : le partage de données dans un segment de mémoire dans un ou plusieurs processus et l’empêchement d’un choix non déterministe de disposition de texture non définie pour les ressources placées dans le tas.</span><span class="sxs-lookup"><span data-stu-id="bfab2-110">Shared heaps enable two things: sharing data in a heap across one or more processes, and precluding a non-deterministic choice of undefined texture layout for resources placed within the heap.</span></span> <span data-ttu-id="bfab2-111">Le partage de tas entre les adaptateurs élimine également le besoin de marshaling de l’UC des données.</span><span class="sxs-lookup"><span data-stu-id="bfab2-111">Sharing heaps across adapters also removes the need for CPU marshaling of the data.</span></span>

<span data-ttu-id="bfab2-112">Les tas et les ressources validées peuvent être partagés.</span><span class="sxs-lookup"><span data-stu-id="bfab2-112">Both heaps and committed resources can be shared.</span></span> <span data-ttu-id="bfab2-113">Le partage d’une ressource validée partage en fait le tas implicite ainsi que la description de la ressource validée, de sorte qu’une description de ressource compatible peut être mappée au segment de mémoire à partir d’un autre appareil.</span><span class="sxs-lookup"><span data-stu-id="bfab2-113">Sharing a committed resource actually shares the implicit heap along with the committed resource description, such that a compatible resource description can be mapped to the heap from another device.</span></span>

<span data-ttu-id="bfab2-114">Toutes les méthodes sont libres de threads et héritent de la sémantique D3D11 existante de la conception de partage de handle NT.</span><span class="sxs-lookup"><span data-stu-id="bfab2-114">All methods are free-threaded and inherit the existing D3D11 semantics of the NT handle sharing design.</span></span>

-   [<span data-ttu-id="bfab2-115">**ID3D12Device::CreateSharedHandle**</span><span class="sxs-lookup"><span data-stu-id="bfab2-115">**ID3D12Device::CreateSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createsharedhandle)
-   [<span data-ttu-id="bfab2-116">**ID3D12Device::OpenSharedHandle**</span><span class="sxs-lookup"><span data-stu-id="bfab2-116">**ID3D12Device::OpenSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandle)
-   [<span data-ttu-id="bfab2-117">**ID3D12Device::OpenSharedHandleByName**</span><span class="sxs-lookup"><span data-stu-id="bfab2-117">**ID3D12Device::OpenSharedHandleByName**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandlebyname)

## <a name="sharing-heaps-across-processes"></a><span data-ttu-id="bfab2-118">Partage des tas entre les processus</span><span class="sxs-lookup"><span data-stu-id="bfab2-118">Sharing heaps across processes</span></span>

<span data-ttu-id="bfab2-119">Les tas partagés sont spécifiés avec l' \_ \_ indicateur de segment de mémoire D3D12 \_ membre Shared de l’énumération des [**\_ \_ indicateurs de tas D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .</span><span class="sxs-lookup"><span data-stu-id="bfab2-119">Shared heaps are specified with the D3D12\_HEAP\_FLAG\_SHARED member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="bfab2-120">Les tas partagés ne sont pas pris en charge sur les segments de mémoire accessibles par le processeur : D3D12 le type de segment de mémoire, D3D12 de type de segment \_ \_ \_ \_ \_ \_ READBACK et \_ type de segment D3D12 \_ \_ personnalisé sans \_ propriété de page d’UC D3D12 \_ \_ \_ non \_ disponible.</span><span class="sxs-lookup"><span data-stu-id="bfab2-120">Shared heaps are not supported on CPU-accessible heaps: D3D12\_HEAP\_TYPE\_UPLOAD, D3D12\_HEAP\_TYPE\_READBACK, and D3D12\_HEAP\_TYPE\_CUSTOM without D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE.</span></span>

<span data-ttu-id="bfab2-121">En excluant un choix non déterministe de la mise en page de texture non définie, vous risquez de nuire considérablement aux scénarios de rendu différés sur certains GPU, ce qui n’est donc pas le comportement par défaut pour les ressources placées et validées.</span><span class="sxs-lookup"><span data-stu-id="bfab2-121">Precluding a non-deterministic choice of undefined texture layout can significantly impair deferred rendering scenarios on some GPUs, so it is not the default behavior for placed and committed resources.</span></span> <span data-ttu-id="bfab2-122">Le rendu différé est altéré sur certaines architectures GPU, car les dispositions de texture déterministes diminuent la bande passante de mémoire effective atteinte lors du rendu simultané à plusieurs textures cibles de rendu de même format et de même taille.</span><span class="sxs-lookup"><span data-stu-id="bfab2-122">Deferred rendering is impaired on some GPU architectures because deterministic texture layouts decrease the effective memory bandwidth achieved when rendering simultaneously to multiple render target textures of the same format and size.</span></span> <span data-ttu-id="bfab2-123">Les architectures GPU évoluent en tirant parti des dispositions de texture non déterministes afin de prendre en charge des modèles Swizzle standardisés et des mises en page standardisées efficaces pour le rendu différé.</span><span class="sxs-lookup"><span data-stu-id="bfab2-123">GPU architectures are evolving away from leveraging non-deterministic texture layouts in order to support standardized swizzle patterns and standardized layouts efficiently for deferred rendering.</span></span>

<span data-ttu-id="bfab2-124">Les tas partagés sont également associés à d’autres coûts mineurs :</span><span class="sxs-lookup"><span data-stu-id="bfab2-124">Shared heaps come with other minor costs as well:</span></span>

-   <span data-ttu-id="bfab2-125">Les données du tas partagé ne peuvent pas être recyclées de manière flexible en tant que segments in-process en raison de problèmes de divulgation d’informations. la mémoire physique est donc zero’ed plus souvent.</span><span class="sxs-lookup"><span data-stu-id="bfab2-125">Shared heap data cannot be recycled as flexibly as in-process heaps due to information disclosure concerns, so physical memory is zero'ed more often.</span></span>
-   <span data-ttu-id="bfab2-126">La surcharge du processeur supplémentaire et l’utilisation de la mémoire système augmentent lors de la création et de la destruction des tas partagés.</span><span class="sxs-lookup"><span data-stu-id="bfab2-126">There is a minor additional CPU overhead and increased system memory usage during creation and destruction of shared heaps.</span></span>

## <a name="sharing-heaps-across-adapters"></a><span data-ttu-id="bfab2-127">Partage des segments de mémoire entre les adaptateurs</span><span class="sxs-lookup"><span data-stu-id="bfab2-127">Sharing heaps across adapters</span></span>

<span data-ttu-id="bfab2-128">Les segments de mémoire partagés entre les adaptateurs sont spécifiés avec l' \_ \_ indicateur de tas D3D12 \_ \_ membre Cross- \_ adapter partagé de l’énumération d' [**\_ \_ indicateurs de tas D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .</span><span class="sxs-lookup"><span data-stu-id="bfab2-128">Shared heaps across adapters is specified with the D3D12\_HEAP\_FLAG\_SHARED\_CROSS\_ADAPTER member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="bfab2-129">Les tas partagés entre les adaptateurs permettent à plusieurs adaptateurs de partager des données sans que l’UC ne remarshale les données entre eux.</span><span class="sxs-lookup"><span data-stu-id="bfab2-129">Cross adapter shared heaps enable multiple adapters to share data without the CPU marshaling the data between them.</span></span> <span data-ttu-id="bfab2-130">Bien que les capacités des adaptateurs déterminent la manière dont les adaptateurs efficaces peuvent passer des données entre eux, l’activation des copies GPU augmente la bande passante effective.</span><span class="sxs-lookup"><span data-stu-id="bfab2-130">While varying adapter capabilities determine how efficient adapters can pass data between them, merely enabling GPU copies increases the effective bandwidth achieved.</span></span> <span data-ttu-id="bfab2-131">Certaines dispositions de texture sont autorisées sur les tas d’adaptateurs croisés pour prendre en charge un échange de données de texture, même si ces dispositions de texture ne sont pas prises en charge par ailleurs.</span><span class="sxs-lookup"><span data-stu-id="bfab2-131">Some texture layouts are allowed on cross adapter heaps to support an interchange of texture data, even if such texture layouts are not otherwise supported.</span></span> <span data-ttu-id="bfab2-132">Certaines restrictions peuvent s’appliquer à ces textures, telles que la prise en charge de la copie uniquement.</span><span class="sxs-lookup"><span data-stu-id="bfab2-132">Certain restrictions may apply to such textures, such as only supporting copying.</span></span>

<span data-ttu-id="bfab2-133">Le partage entre les adaptateurs fonctionne avec les tas créés en appelant [**ID3D12Device :: CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span><span class="sxs-lookup"><span data-stu-id="bfab2-133">Cross-adapter sharing works with heaps created by calling [**ID3D12Device::CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span></span> <span data-ttu-id="bfab2-134">Les applications peuvent ensuite créer des ressources via [**CreatePlacedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span><span class="sxs-lookup"><span data-stu-id="bfab2-134">Applications can then create resources via [**CreatePlacedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span></span> <span data-ttu-id="bfab2-135">Elle est également autorisée par les ressources/segments de mémoire créés par [**CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) , mais uniquement pour les ressources TEXTURE2D de la dimension D3D12 des ressources principales \_ \_ \_ (reportez-vous à la [**\_ \_ dimension de ressource D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span><span class="sxs-lookup"><span data-stu-id="bfab2-135">It is also allowed by resources/heaps created by [**CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) but only for row-major D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D resources (refer to [**D3D12\_RESOURCE\_DIMENSION**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span></span> <span data-ttu-id="bfab2-136">Le partage entre les adaptateurs ne fonctionne pas avec [**CreateReservedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span><span class="sxs-lookup"><span data-stu-id="bfab2-136">Cross-adapter sharing does not work with [**CreateReservedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span></span>

<span data-ttu-id="bfab2-137">Pour le partage entre les adaptateurs, toutes les règles habituelles de partage des ressources entre les files d’attente s’appliquent toujours.</span><span class="sxs-lookup"><span data-stu-id="bfab2-137">For cross-adapter sharing, all of the usual cross-queue resource sharing rules still apply.</span></span> <span data-ttu-id="bfab2-138">Les applications doivent émettre les barrières appropriées pour garantir une synchronisation et une cohérence appropriées entre les deux cartes.</span><span class="sxs-lookup"><span data-stu-id="bfab2-138">Applications must issue the appropriate barriers to ensure proper synchronization and coherence between the two adapters.</span></span> <span data-ttu-id="bfab2-139">Les applications doivent utiliser des limites entre les adaptateurs pour coordonner la planification des listes de commandes soumises à plusieurs adaptateurs.</span><span class="sxs-lookup"><span data-stu-id="bfab2-139">Applications should use cross-adapter fences to coordinate the scheduling of command lists submitted to multiple adapters.</span></span> <span data-ttu-id="bfab2-140">Il n’existe aucun mécanisme permettant de partager des ressources entre les adaptateurs entre les versions de l’API D3D.</span><span class="sxs-lookup"><span data-stu-id="bfab2-140">There is no mechanism to share cross-adapter resources across D3D API versions.</span></span> <span data-ttu-id="bfab2-141">Les ressources partagées entre les adaptateurs sont uniquement prises en charge dans la mémoire système.</span><span class="sxs-lookup"><span data-stu-id="bfab2-141">Cross-adapter shared resources are only supported in system memory.</span></span> <span data-ttu-id="bfab2-142">Les segments de mémoire partagés/ressources entre les adaptateurs sont pris en charge dans \_ \_ les segments par défaut du type de tas D3D12 \_ et \_ \_ les tas personnalisés de type de tas D3D12 \_ (avec le pool de mémoire N0 et les propriétés de la page d’UC de combinaison d’écriture).</span><span class="sxs-lookup"><span data-stu-id="bfab2-142">Cross-adapter shared heaps/resources are supported in D3D12\_HEAP\_TYPE\_DEFAULT heaps and D3D12\_HEAP\_TYPE\_CUSTOM heaps (with the L0 memory pool, and write-combine CPU page properties).</span></span> <span data-ttu-id="bfab2-143">Les pilotes doivent s’assurer que les opérations de lecture/écriture GPU pour les tas partagés entre les adaptateurs sont cohérentes avec d’autres GPU sur le système.</span><span class="sxs-lookup"><span data-stu-id="bfab2-143">Drivers must be sure that GPU read/write operations to cross-adapter shared heaps are coherent with other GPUs on the system.</span></span> <span data-ttu-id="bfab2-144">Par exemple, il se peut que le pilote doive exclure les données du tas résidant dans les caches GPU qui ne sont généralement pas nécessaires lorsque l’UC ne peut pas accéder directement aux données du tas.</span><span class="sxs-lookup"><span data-stu-id="bfab2-144">For example, the driver may need to exclude the heap data from residing in GPU caches that typically don’t need to be flushed when the CPU cannot directly access the heap data.</span></span>

<span data-ttu-id="bfab2-145">Les applications doivent limiter l’utilisation des tas entre les adaptateurs uniquement aux scénarios qui requièrent les fonctionnalités qu’ils fournissent.</span><span class="sxs-lookup"><span data-stu-id="bfab2-145">Applications should confine the usage of cross adapter heaps to only those scenarios which require the functionality they provide.</span></span> <span data-ttu-id="bfab2-146">Les tas entre les adaptateurs se trouvent dans \_ le pool de mémoire D3D12 \_ \_ L0, ce qui n’est pas toujours ce que [**GetCustomHeapProperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) suggère.</span><span class="sxs-lookup"><span data-stu-id="bfab2-146">Cross-adapter heaps are located in D3D12\_MEMORY\_POOL\_L0, which is not always what [**GetCustomHeapProperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) suggests.</span></span> <span data-ttu-id="bfab2-147">Ce pool de mémoire n’est pas efficace pour les architectures d’adaptateurs discrètes/NUMA.</span><span class="sxs-lookup"><span data-stu-id="bfab2-147">That memory pool is not efficient for discrete/ NUMA adapter architectures.</span></span> <span data-ttu-id="bfab2-148">Et, les dispositions de texture les plus efficaces ne sont pas toujours disponibles.</span><span class="sxs-lookup"><span data-stu-id="bfab2-148">And, the most efficient texture layouts are not always available.</span></span>

<span data-ttu-id="bfab2-149">Les limitations suivantes s'appliquent également :</span><span class="sxs-lookup"><span data-stu-id="bfab2-149">The following limitations also apply:</span></span>

-   <span data-ttu-id="bfab2-150">Les indicateurs de tas associés aux niveaux de segment de mémoire doivent être un \_ indicateur de tas D3D12 \_ \_ autoriser \_ toutes les \_ mémoires tampons \_ et les \_ textures.</span><span class="sxs-lookup"><span data-stu-id="bfab2-150">The heap flags related to heap tiers must be D3D12\_HEAP\_FLAG\_ALLOW\_ALL\_BUFFERS\_AND\_TEXTURES.</span></span>
-   <span data-ttu-id="bfab2-151">L' \_ indicateur de segment de mémoire D3D12 \_ \_ partagé doit également être défini.</span><span class="sxs-lookup"><span data-stu-id="bfab2-151">D3D12\_HEAP\_FLAG\_SHARED must also be set.</span></span>
-   <span data-ttu-id="bfab2-152">Le \_ type de segment D3D12 \_ \_ par défaut doit être défini ou le \_ \_ type de segment D3D12 \_ personnalisé avec le \_ pool de mémoires D3D12 \_ \_ N0 et la propriété de page d' \_ UC D3D12 \_ \_ \_ non \_ disponible doivent être définis.</span><span class="sxs-lookup"><span data-stu-id="bfab2-152">Either D3D12\_HEAP\_TYPE\_DEFAULT must be set or D3D12\_HEAP\_TYPE\_CUSTOM with D3D12\_MEMORY\_POOL\_L0 and D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE must be set.</span></span>
-   <span data-ttu-id="bfab2-153">Seules les ressources avec l' \_ indicateur de ressource D3D12 \_ \_ allow \_ travers \_ adapter peuvent être placées sur des segments de mémoire entre les adaptateurs.</span><span class="sxs-lookup"><span data-stu-id="bfab2-153">Only resources with D3D12\_RESOURCE\_FLAG\_ALLOW\_CROSS\_ADAPTER may be placed on cross-adapter heaps.</span></span>

<span data-ttu-id="bfab2-154">Pour plus d’informations sur l’utilisation de plusieurs cartes, reportez-vous à la section [systèmes à plusieurs adaptateurs](multi-engine.md) .</span><span class="sxs-lookup"><span data-stu-id="bfab2-154">For more information on using multiple adapters, refer to the [Multi-adapter systems](multi-engine.md) section.</span></span>

## <a name="related-topics"></a><span data-ttu-id="bfab2-155">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="bfab2-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bfab2-156">Sous-allocation au sein des tas</span><span class="sxs-lookup"><span data-stu-id="bfab2-156">Suballocation Within Heaps</span></span>](suballocation-within-heaps.md)
</dt> </dl>

 

 




