---
title: Chaînes de permutation
description: Les chaînes d’échange contrôlent la rotation de la mémoire tampon d’arrière-plan, formant ainsi la base de l’animation graphique.
ms.assetid: AABF5FDE-DB49-4B29-BC0E-032E0C7DF9EB
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ebbc7ec1b62ba620b42bc85c1c1f491ff7ba952d
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/12/2021
ms.locfileid: "104548551"
---
# <a name="swap-chains"></a><span data-ttu-id="e7095-103">Chaînes de permutation</span><span class="sxs-lookup"><span data-stu-id="e7095-103">Swap Chains</span></span>

<span data-ttu-id="e7095-104">Les chaînes d’échange contrôlent la rotation de la mémoire tampon d’arrière-plan, formant ainsi la base de l’animation graphique.</span><span class="sxs-lookup"><span data-stu-id="e7095-104">Swap chains control the back buffer rotation, forming the basis of graphics animation.</span></span>

## <a name="overview"></a><span data-ttu-id="e7095-105">Vue d’ensemble</span><span class="sxs-lookup"><span data-stu-id="e7095-105">Overview</span></span>

<span data-ttu-id="e7095-106">Le modèle de programmation pour les chaînes de permutation dans Direct3D 12 n’est pas identique à celui des versions antérieures de D3D.</span><span class="sxs-lookup"><span data-stu-id="e7095-106">The programming model for swap chains in Direct3D 12 is not identical to that in earlier versions of D3D.</span></span> <span data-ttu-id="e7095-107">La commodité de programmation, par exemple, de prise en charge de la rotation automatique des ressources qui était présente dans D3D10 et D3D11 n’est pas prise en charge à l’heure actuelle.</span><span class="sxs-lookup"><span data-stu-id="e7095-107">The programming convenience, for example, of supporting automatic resource rotation that was present in D3D10 and D3D11 is not now supported.</span></span> <span data-ttu-id="e7095-108">Les applications activées pour la rotation automatique des ressources permettent de restituer le même objet d’API, tandis que la surface réelle rendue change chaque cadre.</span><span class="sxs-lookup"><span data-stu-id="e7095-108">Automatic resource rotation enabled apps to render the same API object while the actual surface being rendered changes each frame.</span></span> <span data-ttu-id="e7095-109">Le comportement des chaînes de permutation est modifié avec Direct3D 12 pour permettre à d’autres fonctionnalités de Direct3D 12 d’avoir une surcharge de l’UC faible.</span><span class="sxs-lookup"><span data-stu-id="e7095-109">The behavior of swap chains is changed with Direct3D 12 to enable other features of Direct3D 12 to have low CPU overhead.</span></span> <span data-ttu-id="e7095-110">La clé de couleur automatique et l’échantillonnage multiple ne sont pas pris en charge, bien que l’étirement et la rotation soient, en particulier, toujours.</span><span class="sxs-lookup"><span data-stu-id="e7095-110">Automatic color key and multisampling are not supported, although notably stretching and rotation still are.</span></span>

### <a name="buffer-lifetime"></a><span data-ttu-id="e7095-111">Durée de vie de la mémoire tampon</span><span class="sxs-lookup"><span data-stu-id="e7095-111">Buffer lifetime</span></span>

<span data-ttu-id="e7095-112">Les applications sont autorisées à stocker des descripteurs précréés qui font référence à des tampons d’arrière-plan. cette option est activée en garantissant que l’ensemble de mémoires tampons détenu par une chaîne de permutation ne change jamais pendant la durée de vie de la chaîne de permutation.</span><span class="sxs-lookup"><span data-stu-id="e7095-112">Apps are allowed to store pre-created descriptors which reference back buffers This is enabled by ensuring that the set of buffers owned by a swap chain never changes for the lifetime of the swap chain.</span></span> <span data-ttu-id="e7095-113">L’ensemble de mémoires tampons retourné par [**IDXGISwapChain :: GetBuffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) ne change pas tant que certaines API ne sont pas appelées :</span><span class="sxs-lookup"><span data-stu-id="e7095-113">The set of buffers returned by [**IDXGISwapChain::GetBuffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) doesn't change until certain APIs are called:</span></span>

-   [<span data-ttu-id="e7095-114">**IDXGISwapChain::ResizeTarget**</span><span class="sxs-lookup"><span data-stu-id="e7095-114">**IDXGISwapChain::ResizeTarget**</span></span>](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget)
-   [<span data-ttu-id="e7095-115">**IDXGISwapChain::ResizeBuffers**</span><span class="sxs-lookup"><span data-stu-id="e7095-115">**IDXGISwapChain::ResizeBuffers**</span></span>](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers)

<span data-ttu-id="e7095-116">L’ordre des mémoires tampons retournées par [**GetBuffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) ne change jamais.</span><span class="sxs-lookup"><span data-stu-id="e7095-116">The order of buffers returned by [**GetBuffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) never changes.</span></span>

<span data-ttu-id="e7095-117">[**IDXGISwapChain3 :: GetCurrentBackBufferIndex**](/windows/desktop/api/dxgi1_4/nf-dxgi1_4-idxgiswapchain3-getcurrentbackbufferindex) retourne l’index de la mémoire tampon d’arrière-plan actuelle à l’application.</span><span class="sxs-lookup"><span data-stu-id="e7095-117">[**IDXGISwapChain3::GetCurrentBackBufferIndex**](/windows/desktop/api/dxgi1_4/nf-dxgi1_4-idxgiswapchain3-getcurrentbackbufferindex) returns the index of the current back buffer to the app.</span></span>

### <a name="swap-effects"></a><span data-ttu-id="e7095-118">Permuter les effets</span><span class="sxs-lookup"><span data-stu-id="e7095-118">Swap effects</span></span>

<span data-ttu-id="e7095-119">Les seuls effets d’échange pris en charge sont [**DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect) et [**DXGI_SWAP_EFFECT_FLIP_DISCARD**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect), ce qui nécessite que le nombre de tampons soit supérieur à un.</span><span class="sxs-lookup"><span data-stu-id="e7095-119">The only supported swap effects are [**DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect) and [**DXGI_SWAP_EFFECT_FLIP_DISCARD**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect), which requires the buffer count to be greater than one.</span></span>

### <a name="transitioning-between-windowed-and-full-screen-modes"></a><span data-ttu-id="e7095-120">Transition entre les modes fenêtre et plein écran</span><span class="sxs-lookup"><span data-stu-id="e7095-120">Transitioning between windowed and full-screen modes</span></span>

<span data-ttu-id="e7095-121">Direct3D 12 ne prend pas en charge le mode exclusif plein écran (FSE).</span><span class="sxs-lookup"><span data-stu-id="e7095-121">Direct3D 12 doesn't support full-screen exclusive mode (FSE).</span></span> <span data-ttu-id="e7095-122">Au lieu de cela, lorsqu’un jeu est la seule application visible à l’écran, le système d’exploitation utilise une stratégie appelée « optimisation de l’écran complet » (FSO) pour obtenir un effet similaire à FSE sans les inconvénients en matière de performances.</span><span class="sxs-lookup"><span data-stu-id="e7095-122">Instead, when a game is the only visible application on-screen, the OS uses a strategy called full-screen optimisations (FSO) to achieve a similar effect to FSE without the performance drawbacks.</span></span> <span data-ttu-id="e7095-123">Pour plus d’informations sur le FSO, consultez [démystification des optimisations en plein écran](https://devblogs.microsoft.com/directx/demystifying-full-screen-optimizations/).</span><span class="sxs-lookup"><span data-stu-id="e7095-123">For more info about FSO, see [Demystifying Fullscreen Optimisations](https://devblogs.microsoft.com/directx/demystifying-full-screen-optimizations/).</span></span>

<span data-ttu-id="e7095-124">Direct3D 12 maintient la restriction que les applications doivent appeler [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) après la transition entre les modes plein écran et avec fenêtres (les chaînes de permutation de modèle d3d11 présentent les mêmes restrictions).</span><span class="sxs-lookup"><span data-stu-id="e7095-124">Direct3D 12 maintains the restriction that applications must call [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) after transitioning between windowed and full-screen modes (D3D11 flip-model swap chains have the same restrictions).</span></span>

<span data-ttu-id="e7095-125">Les transitions [**IDXGISwapChain :: SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) ne modifient pas l’ensemble des mémoires tampons visibles par l’application dans la chaîne de permutation.</span><span class="sxs-lookup"><span data-stu-id="e7095-125">The [**IDXGISwapChain::SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) transitions do not change the set of app-visible buffers in the swap chain.</span></span> <span data-ttu-id="e7095-126">Seuls les appels [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) et [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) créent ou détruisent des mémoires tampons visibles par l’application.</span><span class="sxs-lookup"><span data-stu-id="e7095-126">Only the [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) and [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) calls create or destroy app-visible buffers.</span></span> <span data-ttu-id="e7095-127">Toutefois, dans Direct3D 12 [**IDXGISwapChain :: SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) ne passe pas en mode plein écran et modifie simplement les résolutions et les fréquences d’actualisation pour autoriser les optimisations en plein écran.</span><span class="sxs-lookup"><span data-stu-id="e7095-127">However, in Direct3D 12 [**IDXGISwapChain::SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) doesn't enter full-screen exclusive mode, and simply changes resolutions and refresh rates to allow full-screen optimisations.</span></span> <span data-ttu-id="e7095-128">Ces modifications peuvent être apportées par une application sans l’utilisation de cette méthode</span><span class="sxs-lookup"><span data-stu-id="e7095-128">These changes can be made by an app without the use of this method</span></span>

<span data-ttu-id="e7095-129">Quand ou [**IDXGISwapChain ::P renvoyer**](/windows/win32/api/dxgi/nf-dxgi-idxgiswapchain-present) ou [**IDXGISwapChain1 ::P renvoyé**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1) est appelé, la mémoire tampon d’arrière-plan à présenter doit être dans l’état d' [**État de \_ ressource D3D12 \_ \_ présent**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_resource_states) .</span><span class="sxs-lookup"><span data-stu-id="e7095-129">When or [**IDXGISwapChain::Present**](/windows/win32/api/dxgi/nf-dxgi-idxgiswapchain-present) or [**IDXGISwapChain1::Present**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1) is called, the back buffer to be presented must be in the [**D3D12\_RESOURCE\_STATE\_PRESENT**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_resource_states) state.</span></span> <span data-ttu-id="e7095-130">La présence échouera avec l' **erreur dxgi d' \_ \_ \_ appel non valide** si ce n’est pas le cas.</span><span class="sxs-lookup"><span data-stu-id="e7095-130">Present will fail with **DXGI\_ERROR\_INVALID\_CALL** if this is not the case.</span></span>

<span data-ttu-id="e7095-131">Les chaînes d’échange plein écran continuent d’avoir la restriction indiquant que [**SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate)(false, null) doit être appelé avant la version finale de la chaîne de permutation.</span><span class="sxs-lookup"><span data-stu-id="e7095-131">Full-screen swap chains continue to have the restriction that [**SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate)(FALSE, NULL) must be called before the final release of the swap chain.</span></span> <span data-ttu-id="e7095-132">**SetFullscreenState**(false) parvient sur les chaînes de permutation s’exécutant sur les périphériques Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="e7095-132">**SetFullscreenState**(FALSE) succeeds on swap chains running on Direct3D 12 devices.</span></span>

<span data-ttu-id="e7095-133">Les opérations présentes se produisent sur la file d’attente 3D fournie lors de la création de utilise permutation, et les applications sont libres de présenter simultanément plusieurs chaînes de permutation, ainsi que d’enregistrer et d’exécuter des listes de commandes.</span><span class="sxs-lookup"><span data-stu-id="e7095-133">Present operations occur on the 3D queue provided at swapchain creation, and apps are free to concurrently present multiple swap chains, and record and execute command lists.</span></span>

<span data-ttu-id="e7095-134">Lorsque la dernière partie du travail (par exemple, le post-traitement des frames) est effectuée sur une file d’attente de calcul, ou n’implique pas la file d’attente graphique de l’appareil, la création d’une deuxième file d’attente 3D à présenter peut être bénéfique et empêcher la latence de la présentation qui retarde le début de la trame suivante.</span><span class="sxs-lookup"><span data-stu-id="e7095-134">When the final part of the graphics work (for example, frame postprocessing) is done on a compute queue, or doesn't involve the device's graphics queue, creating a second 3D queue to present on can be beneficial and prevent the latency of presentation delaying the start of the next frame.</span></span> 

### <a name="example"></a><span data-ttu-id="e7095-135">Exemple</span><span class="sxs-lookup"><span data-stu-id="e7095-135">Example</span></span>

<span data-ttu-id="e7095-136">L’exemple de code suivant est présent dans la boucle de rendu principale :</span><span class="sxs-lookup"><span data-stu-id="e7095-136">The following example code would be present in the main rendering loop:</span></span>

```cpp
void Present()
{
    m_swapChain->Present(0, m_presentFlags);
    m_backBufferIndex = (m_backBufferIndex + 1) % m_backBufferCount;
}
```

### <a name="creating-swap-chains"></a><span data-ttu-id="e7095-137">Création de chaînes de permutation</span><span class="sxs-lookup"><span data-stu-id="e7095-137">Creating swap chains</span></span>

<span data-ttu-id="e7095-138">Lors de l’utilisation des appels [**CreateSwapChainForHwnd**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforhwnd), [**CreateSwapChainForCoreWindow**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcorewindow)ou [**CreateSwapChainForComposition**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcomposition) , Notez que le paramètre *pDevice* nécessite en fait un pointeur vers une file d’attente de commandes directe dans Direct3D 12, et non un appareil.</span><span class="sxs-lookup"><span data-stu-id="e7095-138">When using the [**CreateSwapChainForHwnd**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforhwnd), [**CreateSwapChainForCoreWindow**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcorewindow), or [**CreateSwapChainForComposition**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcomposition) calls, note that the *pDevice* parameter actually requires a pointer to a direct command queue in Direct3D 12, and not a device.</span></span>

### <a name="presenting-on-windows-7"></a><span data-ttu-id="e7095-139">Présentation de Windows 7</span><span class="sxs-lookup"><span data-stu-id="e7095-139">Presenting on Windows 7</span></span>

<span data-ttu-id="e7095-140">Quand vous ciblez Direct3D 12 sur Windows 7, les types DXGI nécessaires pour Direct3D 12 ne sont pas présents. vous devez donc utiliser le **ID3D12CommandQueueDownLevel** fourni par D3D12On7 (interrogé à partir de la file d’attente de commandes directe) à présenter.</span><span class="sxs-lookup"><span data-stu-id="e7095-140">When targeting Direct3D 12 on Windows 7, the necessary DXGI types for Direct3D 12 are not present, so you must use the D3D12On7-provided **ID3D12CommandQueueDownLevel** (queried off of the direct command queue) to present.</span></span>

<span data-ttu-id="e7095-141">Vous fournissez une liste de commandes ouverte à la méthode présente Windows 7, qui sera ensuite utilisée, fermée et automatiquement envoyée à l’appareil.</span><span class="sxs-lookup"><span data-stu-id="e7095-141">You provide an open command list to the Windows 7 present method, which will then be used, closed, and automatically submitted to the device for you.</span></span> <span data-ttu-id="e7095-142">Vous devez fournir une mémoire tampon d’arrière-plan qui doit être créée par l’application, doit être une ressource validée, doit avoir un échantillon unique et doit être de l’un des formats suivants.</span><span class="sxs-lookup"><span data-stu-id="e7095-142">You must provide a back buffer which must be app-created, must be a committed resource, must be single-sampled, and must be one of the following formats.</span></span>

* <span data-ttu-id="e7095-143">**DXGI_FORMAT_R16G16B16A16_FLOAT**</span><span class="sxs-lookup"><span data-stu-id="e7095-143">**DXGI_FORMAT_R16G16B16A16_FLOAT**</span></span>
* <span data-ttu-id="e7095-144">**DXGI_FORMAT_R10G10B10A2_UNORM**</span><span class="sxs-lookup"><span data-stu-id="e7095-144">**DXGI_FORMAT_R10G10B10A2_UNORM**</span></span>
* <span data-ttu-id="e7095-145">**DXGI_FORMAT_R8G8B8A8_UNORM**</span><span class="sxs-lookup"><span data-stu-id="e7095-145">**DXGI_FORMAT_R8G8B8A8_UNORM**</span></span>
* <span data-ttu-id="e7095-146">**DXGI_FORMAT_R8G8B8A8_UNORM_SRGB**</span><span class="sxs-lookup"><span data-stu-id="e7095-146">**DXGI_FORMAT_R8G8B8A8_UNORM_SRGB**</span></span>
* <span data-ttu-id="e7095-147">**DXGI_FORMAT_B8G8R8X8_UNORM**</span><span class="sxs-lookup"><span data-stu-id="e7095-147">**DXGI_FORMAT_B8G8R8X8_UNORM**</span></span>
* <span data-ttu-id="e7095-148">**DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM**</span><span class="sxs-lookup"><span data-stu-id="e7095-148">**DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM**</span></span>
* <span data-ttu-id="e7095-149">**DXGI_FORMAT_B8G8R8A8_UNORM**</span><span class="sxs-lookup"><span data-stu-id="e7095-149">**DXGI_FORMAT_B8G8R8A8_UNORM**</span></span>
* <span data-ttu-id="e7095-150">**DXGI_FORMAT_B8G8R8A8_UNORM_SRGB**</span><span class="sxs-lookup"><span data-stu-id="e7095-150">**DXGI_FORMAT_B8G8R8A8_UNORM_SRGB**</span></span>

## <a name="related-topics"></a><span data-ttu-id="e7095-151">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="e7095-151">Related topics</span></span>

* [<span data-ttu-id="e7095-152">D3D12_HEAP_FLAGS</span><span class="sxs-lookup"><span data-stu-id="e7095-152">D3D12_HEAP_FLAGS</span></span>](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags)
* [<span data-ttu-id="e7095-153">Didacticiels vidéo sur DirectX Advanced Learning : fréquence d’images délimitée</span><span class="sxs-lookup"><span data-stu-id="e7095-153">DirectX advanced learning video tutorials : Unthrottled Framerate</span></span>](https://www.youtube.com/watch?v=wn02zCXa9IU)
* [<span data-ttu-id="e7095-154">Rendu</span><span class="sxs-lookup"><span data-stu-id="e7095-154">Rendering</span></span>](rendering.md)
