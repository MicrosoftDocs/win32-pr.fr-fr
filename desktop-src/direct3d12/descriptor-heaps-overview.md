---
title: Vue d’ensemble des tas de descripteurs
description: Les tas de descripteurs contiennent de nombreux types d’objets qui ne font pas partie d’un objet d’État du pipeline (PSO), tels que les vues des ressources de nuanceur (SRVs), les vues d’accès non ordonnées (UAVs), les vues de mémoire tampon constante (CBVs) et les échantillonneurs.
ms.assetid: 14561E77-44E0-4A58-8456-F40D59ECA175
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a8bf720ebb71d016457fa4383a8d33aa62e2eee4
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/16/2019
ms.locfileid: "74104807"
---
# <a name="descriptor-heaps-overview"></a><span data-ttu-id="5115d-103">Vue d’ensemble des tas de descripteurs</span><span class="sxs-lookup"><span data-stu-id="5115d-103">Descriptor Heaps Overview</span></span>

<span data-ttu-id="5115d-104">Les tas de descripteurs contiennent de nombreux types d’objets qui ne font pas partie d’un objet d’État du pipeline (PSO), tels que les vues des ressources de nuanceur (SRVs), les vues d’accès non ordonnées (UAVs), les vues de mémoire tampon constante (CBVs) et les échantillonneurs.</span><span class="sxs-lookup"><span data-stu-id="5115d-104">Descriptor heaps contain many object types that are not part of a Pipeline State Object (PSO), such as Shader Resource Views (SRVs), Unordered Access Views (UAVs), Constant Buffer Views (CBVs), and Samplers.</span></span>

-   [<span data-ttu-id="5115d-105">Rôle des tas de descripteurs</span><span class="sxs-lookup"><span data-stu-id="5115d-105">The Purpose of Descriptor Heaps</span></span>](#the-purpose-of-descriptor-heaps)
-   [<span data-ttu-id="5115d-106">Synchronisation</span><span class="sxs-lookup"><span data-stu-id="5115d-106">Synchronization</span></span>](#synchronization)
-   [<span data-ttu-id="5115d-107">Binding</span><span class="sxs-lookup"><span data-stu-id="5115d-107">Binding</span></span>](#binding)
-   [<span data-ttu-id="5115d-108">Basculement des tas</span><span class="sxs-lookup"><span data-stu-id="5115d-108">Switching heaps</span></span>](#switching-heaps)
-   [<span data-ttu-id="5115d-109">Offres groupées</span><span class="sxs-lookup"><span data-stu-id="5115d-109">Bundles</span></span>](#bundles)
-   [<span data-ttu-id="5115d-110">Gestion</span><span class="sxs-lookup"><span data-stu-id="5115d-110">Management</span></span>](#management)
-   [<span data-ttu-id="5115d-111">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="5115d-111">Related topics</span></span>](#related-topics)

## <a name="the-purpose-of-descriptor-heaps"></a><span data-ttu-id="5115d-112">Rôle des tas de descripteurs</span><span class="sxs-lookup"><span data-stu-id="5115d-112">The Purpose of Descriptor Heaps</span></span>

<span data-ttu-id="5115d-113">L’objectif principal d’un tas de descripteur est d’englober la majeure partie de l’allocation de mémoire nécessaire pour stocker les spécifications de descripteur des types d’objets que les nuanceurs font référence à une fenêtre de rendu aussi grande que possible (idéalement une image entière de rendu ou plus).</span><span class="sxs-lookup"><span data-stu-id="5115d-113">The primary purpose of a descriptor heap is to encompass the bulk of memory allocation required for storing the descriptor specifications of object types that shaders reference for as large of a window of rendering as possible (ideally an entire frame of rendering or more).</span></span> <span data-ttu-id="5115d-114">Si une application bascule les textures que le pipeline voit rapidement à partir de l’API, il doit y avoir de l’espace dans le tas du descripteur pour définir les tables de descripteurs à la volée pour chaque ensemble d’États requis.</span><span class="sxs-lookup"><span data-stu-id="5115d-114">If an application is switching which textures the pipeline sees rapidly from the API, there has to be space in the descriptor heap to define descriptor tables on the fly for every set of state needed.</span></span> <span data-ttu-id="5115d-115">L’application peut choisir de réutiliser les définitions si les ressources sont réutilisées dans un autre objet, par exemple, ou simplement assigner l’espace du tas séquentiellement lorsqu’il change de différents types d’objets.</span><span class="sxs-lookup"><span data-stu-id="5115d-115">The application can choose to reuse definitions if the resources are used again in another object, for example, or just assign the heap space sequentially as it switches various object types.</span></span>

<span data-ttu-id="5115d-116">Les tas de descripteurs permettent également aux composants logiciels individuels de gérer le stockage du descripteur séparément.</span><span class="sxs-lookup"><span data-stu-id="5115d-116">Descriptor heaps also allow individual software components to manage descriptor storage separately from each other.</span></span>

<span data-ttu-id="5115d-117">Tous les segments de mémoire sont visibles par le processeur.</span><span class="sxs-lookup"><span data-stu-id="5115d-117">All heaps are visible to the CPU.</span></span> <span data-ttu-id="5115d-118">L’application peut également demander les propriétés d’accès de l’UC qu’un tas de descripteur doit avoir (le cas échéant) : écriture combinée, écriture différée, etc.</span><span class="sxs-lookup"><span data-stu-id="5115d-118">The application can also request which CPU access properties a descriptor heap should have (if any) – write combined, write back, and so on.</span></span> <span data-ttu-id="5115d-119">Les applications peuvent créer autant de tas de descripteurs que vous le souhaitez, quelles que soient les propriétés souhaitées.</span><span class="sxs-lookup"><span data-stu-id="5115d-119">Apps can create as many descriptor heaps as desired with whatever properties are desired.</span></span> <span data-ttu-id="5115d-120">Les applications ont toujours la possibilité de créer des tas de descripteurs qui sont exclusivement à des fins de préproduction qui sont sans contrainte et qui sont copiés dans des tas de descripteurs qui sont utilisés pour le rendu si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="5115d-120">Apps always have the option to create descriptor heaps that are purely for staging purposes that are unconstrained in size, and copying to descriptor heaps that are used for rendering as necessary.</span></span>

<span data-ttu-id="5115d-121">Il existe des restrictions concernant ce que peut atteindre le même tas de descripteur.</span><span class="sxs-lookup"><span data-stu-id="5115d-121">There are some restrictions in what can go in the same descriptor heap.</span></span> <span data-ttu-id="5115d-122">Les entrées CBV, UAV et SRV peuvent se trouver dans le même tas de descripteur.</span><span class="sxs-lookup"><span data-stu-id="5115d-122">CBV, UAV and SRV entries can be in the same descriptor heap.</span></span> <span data-ttu-id="5115d-123">Toutefois, les entrées d’échantillonneurs ne peuvent pas partager un segment de mémoire avec des entrées CBV, UAV ou SRV.</span><span class="sxs-lookup"><span data-stu-id="5115d-123">However, Samplers entries cannot share a heap with CBV, UAV or SRV entries.</span></span> <span data-ttu-id="5115d-124">En règle générale, il existe deux ensembles de tas de descripteurs, l’un pour les ressources communes et le second pour les échantillonneurs.</span><span class="sxs-lookup"><span data-stu-id="5115d-124">Typically, there are two sets of descriptor heaps, one for the common resources and the second for Samplers.</span></span>

<span data-ttu-id="5115d-125">L’utilisation de tas de descripteurs par Direct3D 12 reflète ce que fait la majeure partie du matériel GPU, qui consiste soit à exiger des descripteurs en temps réel uniquement dans des tas de descripteurs, soit à réduire le nombre de bits d’adressage si ces tas sont utilisés.</span><span class="sxs-lookup"><span data-stu-id="5115d-125">The use of descriptor heaps by Direct3D 12 mirrors what most GPU hardware does, which is to either require descriptors live only in descriptor heaps, or simply that fewer addressing bits are needed if these heaps are used.</span></span> <span data-ttu-id="5115d-126">Direct3D 12 requiert l’utilisation de tas de descripteurs, il n’est pas possible de placer des descripteurs n’importe où dans la mémoire.</span><span class="sxs-lookup"><span data-stu-id="5115d-126">Direct3D 12 does require the use of descriptor heaps, there is no option to put descriptors anywhere in memory.</span></span>

<span data-ttu-id="5115d-127">Les tas de descripteurs ne peuvent être modifiés qu’immédiatement par le processeur, il n’est pas possible de modifier un tas de descripteur par le GPU.</span><span class="sxs-lookup"><span data-stu-id="5115d-127">Descriptor heaps can only be edited immediately by the CPU, there is no option to edit a descriptor heap by the GPU.</span></span>

## <a name="synchronization"></a><span data-ttu-id="5115d-128">Synchronization</span><span class="sxs-lookup"><span data-stu-id="5115d-128">Synchronization</span></span>

<span data-ttu-id="5115d-129">Le contenu du tas du descripteur peut être modifié avant, pendant et après l’enregistrement des listes de commandes qui le référencent.</span><span class="sxs-lookup"><span data-stu-id="5115d-129">Descriptor heap contents can be changed before, during and after recording command lists that reference it.</span></span> <span data-ttu-id="5115d-130">Toutefois, les descripteurs ne peuvent pas être modifiés lorsqu’une liste de commandes soumise pour l’exécution peut référencer cet emplacement, car cela pourrait appeler une condition de concurrence.</span><span class="sxs-lookup"><span data-stu-id="5115d-130">However, descriptors cannot be changed while a command list submitted for execution might reference that location, as this could invoke a race condition.</span></span>

## <a name="binding"></a><span data-ttu-id="5115d-131">Liaison</span><span class="sxs-lookup"><span data-stu-id="5115d-131">Binding</span></span>

<span data-ttu-id="5115d-132">Au plus un tas combiné CBV/SRV/UAV et un tas d’échantillonneur peuvent être liés à un moment donné.</span><span class="sxs-lookup"><span data-stu-id="5115d-132">At most one CBV/SRV/UAV combined heap and one Sampler heap can be bound at any one time.</span></span> <span data-ttu-id="5115d-133">Ces tas sont partagés entre les graphiques et les pipelines de calcul (décrits dans leurs objets PSO).</span><span class="sxs-lookup"><span data-stu-id="5115d-133">These heaps are shared between both the graphics and compute pipelines (described in their PSOs).</span></span>

## <a name="switching-heaps"></a><span data-ttu-id="5115d-134">Basculement des tas</span><span class="sxs-lookup"><span data-stu-id="5115d-134">Switching heaps</span></span>

<span data-ttu-id="5115d-135">Il est acceptable pour une application de basculer les tas dans la même liste de commandes ou dans d’autres, à l’aide des API [**SetDescriptorHeaps**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps) et [**Reset**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-reset) .</span><span class="sxs-lookup"><span data-stu-id="5115d-135">It is acceptable for an application to switch heaps within the same command list or in different ones using the [**SetDescriptorHeaps**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps) and [**Reset**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-reset) APIs.</span></span> <span data-ttu-id="5115d-136">Sur un matériel, il peut s’agir d’une opération coûteuse, nécessitant un blocage du GPU pour vider tout le travail dépendant du tas du descripteur actuellement lié.</span><span class="sxs-lookup"><span data-stu-id="5115d-136">On some hardware, this can be an expensive operation, requiring a GPU stall to flush all work that depends on the currently bound descriptor heap.</span></span> <span data-ttu-id="5115d-137">Par conséquent, si les tas de descripteurs doivent être modifiés, les applications doivent essayer de le faire lorsque la charge de travail GPU est relativement légère, peut-être limiter les modifications au début d’une liste de commandes.</span><span class="sxs-lookup"><span data-stu-id="5115d-137">As a result, if descriptor heaps must be changed, applications should try to do so when the GPU workload is relatively light, perhaps limiting changes to the start of a command list.</span></span>

## <a name="bundles"></a><span data-ttu-id="5115d-138">Offres groupées</span><span class="sxs-lookup"><span data-stu-id="5115d-138">Bundles</span></span>

<span data-ttu-id="5115d-139">Avec les offres groupées, il ne peut y avoir qu’un seul appel à la méthode [**SetDescriptorHeaps**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps) , et les tas de descripteurs définis doivent correspondre exactement à ceux de la liste de commandes qui appelle le bundle.</span><span class="sxs-lookup"><span data-stu-id="5115d-139">With bundles there can only be one call to the [**SetDescriptorHeaps**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps) method, and the descriptor heaps set must match exactly those of the command list calling the bundle.</span></span> <span data-ttu-id="5115d-140">Si le bundle ne modifie pas les tables de descripteurs, il n’a pas besoin de définir les tas de descripteurs.</span><span class="sxs-lookup"><span data-stu-id="5115d-140">If the bundle does not change descriptor tables, it does not need to set the descriptor heaps.</span></span>

<span data-ttu-id="5115d-141">Pour obtenir la liste des appels d’API qui ne peuvent pas être utilisés avec les offres groupées, consultez [création et enregistrement des listes de commandes et des offres groupées](recording-command-lists-and-bundles.md).</span><span class="sxs-lookup"><span data-stu-id="5115d-141">For a list of API calls that cannot be used with bundles, refer to [Creating and Recording Command Lists and Bundles](recording-command-lists-and-bundles.md).</span></span>

## <a name="management"></a><span data-ttu-id="5115d-142">Gestion</span><span class="sxs-lookup"><span data-stu-id="5115d-142">Management</span></span>

<span data-ttu-id="5115d-143">Pour afficher tous les objets d’une scène, de nombreux descripteurs seront nécessaires et des stratégies de gestion différentes peuvent être suivies.</span><span class="sxs-lookup"><span data-stu-id="5115d-143">To render all of the objects in a scene, many descriptors will be needed, and there are some different management strategies that can be followed.</span></span>

<span data-ttu-id="5115d-144">La stratégie la plus simple consisterait à remplir une nouvelle zone du tas de descripteur avec toutes les exigences pour l’appel de dessin suivant.</span><span class="sxs-lookup"><span data-stu-id="5115d-144">The most basic strategy would be to fill in a fresh area of the descriptor heap with all of the requirements for the next draw call.</span></span> <span data-ttu-id="5115d-145">Ainsi, juste avant d’émettre l’appel de dessin sur la liste de commandes, un pointeur de table de descripteur est défini sur le début de la table nouvellement remplie.</span><span class="sxs-lookup"><span data-stu-id="5115d-145">So, just before issuing the draw call on the command list, a descriptor table pointer would be set to the start of the freshly populated table.</span></span> <span data-ttu-id="5115d-146">L’avantage est qu’il n’est pas nécessaire d’enregistrer l’emplacement d’un descripteur particulier dans le tas.</span><span class="sxs-lookup"><span data-stu-id="5115d-146">The upside is that there is no need to record where any particular descriptor is in the heap.</span></span>

<span data-ttu-id="5115d-147">L’inconvénient de cette stratégie est qu’il peut y avoir un grand nombre de descripteurs dans le tas du descripteur, en particulier lors du rendu d’une scène très similaire et que l’espace du tas du descripteur va être utilisé rapidement.</span><span class="sxs-lookup"><span data-stu-id="5115d-147">The downside to this strategy is that there could be a lot of repetition of descriptors in the descriptor heap, especially when a very similar scene is being rendered, and that descriptor heap space is going to be used up quickly.</span></span> <span data-ttu-id="5115d-148">Des tas de descripteurs distincts pour ceux qui sont affichés sur le GPU et pour ceux qui sont enregistrés par le processeur, seraient probablement nécessaires pour éviter les conflits.</span><span class="sxs-lookup"><span data-stu-id="5115d-148">Separate descriptor heaps for those being rendered on the GPU and for those being recorded by the CPU, would probably be necessary to avoid conflict.</span></span> <span data-ttu-id="5115d-149">Vous pouvez également utiliser un système de sous-allocation.</span><span class="sxs-lookup"><span data-stu-id="5115d-149">Alternatively a sub-allocation system could be used.</span></span>

<span data-ttu-id="5115d-150">En outre, le système de base peut être optimisé davantage en utilisant avec précaution les tables de descripteurs qui se chevauchent d’un appel de dessin à l’étape suivante, afin que seuls les nouveaux descripteurs nécessaires soient ajoutés.</span><span class="sxs-lookup"><span data-stu-id="5115d-150">Also, the basic system could be further optimized by careful use of overlapping descriptor tables from one draw call to the next, so that only the new descriptors required are added.</span></span>

<span data-ttu-id="5115d-151">Une stratégie plus efficace que la plus simple consisterait à préremplir les tas de descripteurs avec les descripteurs requis pour les objets (ou les matériaux) qui sont connus pour faire partie de la scène.</span><span class="sxs-lookup"><span data-stu-id="5115d-151">A more efficient strategy than the basic one would be to pre-fill descriptor heaps with descriptors required for the objects (or materials) that are known to be part of the scene.</span></span> <span data-ttu-id="5115d-152">L’idée est qu’il n’est nécessaire de définir la table du descripteur qu’au moment du dessin, car le tas du descripteur est rempli à l’avance.</span><span class="sxs-lookup"><span data-stu-id="5115d-152">The idea here is that it is only necessary to set the descriptor table at draw time, as the descriptor heap is populated ahead of time.</span></span>

<span data-ttu-id="5115d-153">Une variante de la stratégie de préremplissage consiste à traiter le tas du descripteur comme un tableau énorme, contenant tous les descripteurs requis dans des emplacements connus fixes.</span><span class="sxs-lookup"><span data-stu-id="5115d-153">A variation of the pre-filling strategy is to treat the descriptor heap as one huge array, containing all the required descriptors in fixed known locations.</span></span> <span data-ttu-id="5115d-154">L’appel de dessin doit ensuite uniquement recevoir un ensemble de constantes qui sont les index dans le tableau de où les descripteurs doivent être utilisés.</span><span class="sxs-lookup"><span data-stu-id="5115d-154">Then the draw call needs only to receive a set of constants which are the indices into the array of where the descriptors are that need to be used.</span></span>

<span data-ttu-id="5115d-155">Une autre optimisation consiste à s’assurer que les constantes racine et les descripteurs racine contiennent des constantes qui changent le plus souvent, plutôt que de placer des constantes dans le tas du descripteur.</span><span class="sxs-lookup"><span data-stu-id="5115d-155">A further optimization is to ensure root constants and root descriptors contain those that change most frequently, rather than place constants in the descriptor heap.</span></span> <span data-ttu-id="5115d-156">Pour la plupart des matériels, il s’agit d’un moyen efficace de gérer les constantes.</span><span class="sxs-lookup"><span data-stu-id="5115d-156">For most hardware this is an efficient way of handling constants.</span></span>

<span data-ttu-id="5115d-157">Dans la pratique, un moteur graphique peut utiliser une stratégie différente dans différentes situations, et combiner des éléments de chaque stratégie pour répondre aux exigences de dessin particulières.</span><span class="sxs-lookup"><span data-stu-id="5115d-157">In practice a graphics engine might use a different strategy in different situations, and combine elements of each strategy to suit the particular drawing requirements.</span></span>

## <a name="related-topics"></a><span data-ttu-id="5115d-158">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="5115d-158">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5115d-159">Tas de descripteurs</span><span class="sxs-lookup"><span data-stu-id="5115d-159">Descriptor Heaps</span></span>](descriptor-heaps.md)
</dt> </dl>

 

 




