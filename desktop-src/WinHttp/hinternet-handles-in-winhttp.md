---
description: Les services HTTP Microsoft Windows (WinHTTP) utilisent des handles pour effectuer le suivi des paramètres et des informations requis lors de l’utilisation du protocole HTTP.
ms.assetid: 0bd82860-1347-40c8-ae77-c4d865c109be
title: Descripteurs HINTERNET dans WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bf374675ad6f2114dd48e0a3ff1db50cd0dd7f9c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104560987"
---
# <a name="hinternet-handles-in-winhttp"></a><span data-ttu-id="acb52-103">Descripteurs HINTERNET dans WinHTTP</span><span class="sxs-lookup"><span data-stu-id="acb52-103">HINTERNET Handles in WinHTTP</span></span>

<span data-ttu-id="acb52-104">Les services HTTP Microsoft Windows (WinHTTP) utilisent des handles pour effectuer le suivi des paramètres et des informations requis lors de l’utilisation du protocole HTTP.</span><span class="sxs-lookup"><span data-stu-id="acb52-104">Microsoft Windows HTTP Services (WinHTTP) uses handles to keep track of settings and information required when using the HTTP protocol.</span></span> <span data-ttu-id="acb52-105">Chaque descripteur conserve les informations pertinentes pour une session HTTP, une connexion avec un serveur HTTP ou une ressource spécifique.</span><span class="sxs-lookup"><span data-stu-id="acb52-105">Each handle maintains information pertinent to an HTTP session, a connection with an HTTP server, or a specific resource.</span></span> <span data-ttu-id="acb52-106">Cette rubrique décrit les différents types de descripteurs, les conventions d’affectation de noms pour ces handles et leur structure hiérarchique.</span><span class="sxs-lookup"><span data-stu-id="acb52-106">This topic describes the various types of handles, the naming conventions for these handles, and their hierarchical structure.</span></span>

-   [<span data-ttu-id="acb52-107">À propos des handles HINTERNET</span><span class="sxs-lookup"><span data-stu-id="acb52-107">About HINTERNET Handles</span></span>](#about-hinternet-handles)
-   [<span data-ttu-id="acb52-108">Descripteurs de nommage</span><span class="sxs-lookup"><span data-stu-id="acb52-108">Naming Handles</span></span>](#naming-handles)
-   [<span data-ttu-id="acb52-109">Hiérarchie des handles</span><span class="sxs-lookup"><span data-stu-id="acb52-109">Handle Hierarchy</span></span>](#handle-hierarchy)
-   [<span data-ttu-id="acb52-110">Explication de la hiérarchie des handles</span><span class="sxs-lookup"><span data-stu-id="acb52-110">Explanation of the Handle Hierarchy</span></span>](#explanation-of-the-handle-hierarchy)

## <a name="about-hinternet-handles"></a><span data-ttu-id="acb52-111">À propos des handles HINTERNET</span><span class="sxs-lookup"><span data-stu-id="acb52-111">About HINTERNET Handles</span></span>

<span data-ttu-id="acb52-112">Les handles qui sont créés et utilisés par WinHTTP sont appelés Handles **HINTERNET** .</span><span class="sxs-lookup"><span data-stu-id="acb52-112">The handles that are created and used by WinHTTP are called **HINTERNET** handles.</span></span> <span data-ttu-id="acb52-113">Les fonctions WinHTTP retournent des handles **HINTERNET** qui ne sont pas interchangeables avec d’autres Handles, donc ils ne peuvent pas être utilisés avec des fonctions telles que [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) ou [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle).</span><span class="sxs-lookup"><span data-stu-id="acb52-113">The WinHTTP functions return **HINTERNET** handles that are not interchangeable with other handles, so they cannot be used with functions such as [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) or [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle).</span></span> <span data-ttu-id="acb52-114">De même, les autres Handles ne peuvent pas être utilisés avec les fonctions WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="acb52-114">Similarly, other handles cannot be used with WinHTTP functions.</span></span> <span data-ttu-id="acb52-115">Par exemple, un handle retourné par [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) ne peut pas être passé à [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata).</span><span class="sxs-lookup"><span data-stu-id="acb52-115">For example, a handle returned by [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) cannot be passed to [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata).</span></span> <span data-ttu-id="acb52-116">Ces handles **HINTERNET** ne peuvent pas être fermés lorsqu’un appel d’API utilisant le descripteur est en cours.</span><span class="sxs-lookup"><span data-stu-id="acb52-116">These **HINTERNET** handles cannot be closed while an API call using the handle is in progress.</span></span> <span data-ttu-id="acb52-117">Pour éviter une condition de concurrence, les applications doivent protéger le descripteur et l’empêcher d’être fermé tant que l’appel d’API est en cours.</span><span class="sxs-lookup"><span data-stu-id="acb52-117">To avoid a race condition, applications should protect the handle and prevent it from being closed for as long as the API call is in progress.</span></span>

<span data-ttu-id="acb52-118">Les fonctions Microsoft Win32 Internet (WinInet) utilisent également des handles **HINTERNET** .</span><span class="sxs-lookup"><span data-stu-id="acb52-118">Microsoft Win32 Internet (WinInet) functions also use **HINTERNET** handles.</span></span> <span data-ttu-id="acb52-119">Toutefois, les handles utilisés dans les fonctions WinInet ne peuvent pas être modifiés avec les handles utilisés dans les fonctions WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="acb52-119">However, the handles used in WinInet functions cannot be interchanged with the handles used in WinHTTP functions.</span></span> <span data-ttu-id="acb52-120">Pour plus d’informations sur WinInet, consultez [à propos de WinInet](/windows/desktop/WinInet/about-wininet).</span><span class="sxs-lookup"><span data-stu-id="acb52-120">For more information about WinInet, see [About WinINet](/windows/desktop/WinInet/about-wininet).</span></span>

<span data-ttu-id="acb52-121">La fonction [**WinHttpCloseHandle**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpclosehandle) ferme les handles WinHTTP **HINTERNET** .</span><span class="sxs-lookup"><span data-stu-id="acb52-121">The [**WinHttpCloseHandle**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpclosehandle) function closes WinHTTP **HINTERNET** handles.</span></span>

## <a name="naming-handles"></a><span data-ttu-id="acb52-122">Descripteurs de nommage</span><span class="sxs-lookup"><span data-stu-id="acb52-122">Naming Handles</span></span>

<span data-ttu-id="acb52-123">Dans la documentation WinHTTP, les descriptions des fonctions dans l’interface de programmation d’applications (API) et l’exemple de code illustrent la création et l’utilisation de différents types de descripteurs **HINTERNET** .</span><span class="sxs-lookup"><span data-stu-id="acb52-123">Throughout the WinHTTP documentation, descriptions of functions in the application programming interface (API) and sample code show the creation and use of various types of **HINTERNET** handles.</span></span> <span data-ttu-id="acb52-124">Pour assurer le suivi des différents types de handles disponibles, le nom de ces descripteurs est cohérent.</span><span class="sxs-lookup"><span data-stu-id="acb52-124">To keep track of the different types of handles available, the naming of these handles is consistent.</span></span> <span data-ttu-id="acb52-125">Le tableau suivant présente les identificateurs utilisés par Convention dans la documentation.</span><span class="sxs-lookup"><span data-stu-id="acb52-125">The following table shows the identifiers used by convention in the documentation.</span></span>



| <span data-ttu-id="acb52-126">Type de handle</span><span class="sxs-lookup"><span data-stu-id="acb52-126">Handle type</span></span>       | <span data-ttu-id="acb52-127">Handle de création de fonction</span><span class="sxs-lookup"><span data-stu-id="acb52-127">Function creating handle</span></span>                                                                                                          | <span data-ttu-id="acb52-128">Identificateur</span><span class="sxs-lookup"><span data-stu-id="acb52-128">Identifier</span></span> |
|-------------------|-----------------------------------------------------------------------------------------------------------------------------------|------------|
| <span data-ttu-id="acb52-129">Handle générique</span><span class="sxs-lookup"><span data-stu-id="acb52-129">Generic handle</span></span>    | <span data-ttu-id="acb52-130">[**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen), [**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect)ou [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)</span><span class="sxs-lookup"><span data-stu-id="acb52-130">[**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen), [**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect), or [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)</span></span> | <span data-ttu-id="acb52-131">hInternet</span><span class="sxs-lookup"><span data-stu-id="acb52-131">hInternet</span></span>  |
| <span data-ttu-id="acb52-132">Handle de session</span><span class="sxs-lookup"><span data-stu-id="acb52-132">Session handle</span></span>    | [<span data-ttu-id="acb52-133">**WinHttpOpen**</span><span class="sxs-lookup"><span data-stu-id="acb52-133">**WinHttpOpen**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen)                                                                                                | <span data-ttu-id="acb52-134">hSession</span><span class="sxs-lookup"><span data-stu-id="acb52-134">hSession</span></span>   |
| <span data-ttu-id="acb52-135">Handle de connexion</span><span class="sxs-lookup"><span data-stu-id="acb52-135">Connection handle</span></span> | [<span data-ttu-id="acb52-136">**WinHttpConnect**</span><span class="sxs-lookup"><span data-stu-id="acb52-136">**WinHttpConnect**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect)                                                                                          | <span data-ttu-id="acb52-137">hConnect</span><span class="sxs-lookup"><span data-stu-id="acb52-137">hConnect</span></span>   |
| <span data-ttu-id="acb52-138">Handle de demande</span><span class="sxs-lookup"><span data-stu-id="acb52-138">Request handle</span></span>    | [<span data-ttu-id="acb52-139">**WinHttpOpenRequest**</span><span class="sxs-lookup"><span data-stu-id="acb52-139">**WinHttpOpenRequest**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)                                                                                  | <span data-ttu-id="acb52-140">hRequest</span><span class="sxs-lookup"><span data-stu-id="acb52-140">hRequest</span></span>   |



 

## <a name="handle-hierarchy"></a><span data-ttu-id="acb52-141">Hiérarchie des handles</span><span class="sxs-lookup"><span data-stu-id="acb52-141">Handle Hierarchy</span></span>

<span data-ttu-id="acb52-142">Les handles **HINTERNET** sont conservés dans une hiérarchie.</span><span class="sxs-lookup"><span data-stu-id="acb52-142">The **HINTERNET** handles are maintained in a hierarchy.</span></span> <span data-ttu-id="acb52-143">Le handle retourné par [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) est le descripteur de **HINTERNET** de session.</span><span class="sxs-lookup"><span data-stu-id="acb52-143">The handle returned by [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) is the session **HINTERNET** handle.</span></span> <span data-ttu-id="acb52-144">L’appel de **WinHttpOpen** initialise les fonctions WinHTTP et commence un contexte de session qui gère les informations et paramètres utilisateur pendant toute la durée de vie du handle de session.</span><span class="sxs-lookup"><span data-stu-id="acb52-144">Calling **WinHttpOpen** initializes the WinHTTP functions and begins a session context that maintains user information and settings throughout the life of the session handle.</span></span> <span data-ttu-id="acb52-145">[**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect) spécifie un serveur HTTP ou https cible et crée un handle de **HINTERNET** de connexion.</span><span class="sxs-lookup"><span data-stu-id="acb52-145">[**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect) specifies a target HTTP or HTTPS server and creates a connection **HINTERNET** handle.</span></span> <span data-ttu-id="acb52-146">Par défaut, le handle de connexion hérite des paramètres pour le handle de session.</span><span class="sxs-lookup"><span data-stu-id="acb52-146">By default, the connection handle inherits the settings for the session handle.</span></span> <span data-ttu-id="acb52-147">Chaque ressource spécifiée avec un appel à [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest) est affectée à un descripteur de **HINTERNET** de requête.</span><span class="sxs-lookup"><span data-stu-id="acb52-147">Each resource specified with a call to [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest) is assigned a request **HINTERNET** handle.</span></span>

<span data-ttu-id="acb52-148">Le diagramme suivant illustre la hiérarchie des handles **HINTERNET** .</span><span class="sxs-lookup"><span data-stu-id="acb52-148">The following diagram illustrates the hierarchy of **HINTERNET** handles.</span></span> <span data-ttu-id="acb52-149">Chaque zone du diagramme représente une fonction WinHTTP qui retourne un handle **HINTERNET** .</span><span class="sxs-lookup"><span data-stu-id="acb52-149">Each box in the diagram represents a WinHTTP function that returns an **HINTERNET** handle.</span></span>

![fonctions qui créent des handles](images/art-winhttp2.png)

<span data-ttu-id="acb52-151">Après avoir fermé un handle, l’application doit être préparée à recevoir des notifications de rappel sur le descripteur jusqu’à ce que la valeur finale du **\_ handle d’état de rappel \_ \_ \_ WinHTTP** soit retournée pour indiquer que le handle est complètement fermé.</span><span class="sxs-lookup"><span data-stu-id="acb52-151">After closing a handle, the application must be prepared to receive callback notifications on the handle until the final **WINHTTP\_CALLBACK\_STATUS\_HANDLE\_CLOSED** value is returned to indicate that the handle is completely closed.</span></span>

<span data-ttu-id="acb52-152">Un descripteur de session est appelé le parent d’un handle de connexion qu’il a utilisé pour créer ; de même, le descripteur de connexion et son descripteur de session parent sont les parents de tous les descripteurs de demande que le handle de connexion est utilisé pour créer.</span><span class="sxs-lookup"><span data-stu-id="acb52-152">A session handle is termed the parent of any connection handle it used to create; likewise, both the connection handle and its parent session handle are termed parents of any request handle that the connection handle is used to create.</span></span>

<span data-ttu-id="acb52-153">Lorsqu’un descripteur parent est fermé, les enfants qu’il a sont invalidés indirectement, même s’ils ne se ferment pas eux-mêmes, et les demandes ultérieures qui les utilisent échouent avec l’erreur erreur **\_ \_ handle non valide**.</span><span class="sxs-lookup"><span data-stu-id="acb52-153">When a parent handle is closed, any children it has are indirectly invalidated even if not closed themselves, and subsequent requests using them fail with the error **ERROR\_INVALID\_HANDLE**.</span></span> <span data-ttu-id="acb52-154">Les demandes asynchrones en attente ne peuvent pas être exécutées correctement.</span><span class="sxs-lookup"><span data-stu-id="acb52-154">Pending asynchronous requests cannot be relied on to complete correctly.</span></span>

<span data-ttu-id="acb52-155">Le diagramme suivant montre les fonctions qui utilisent le handle **HINTERNET** créé par [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="acb52-155">The following diagram shows the functions that use the **HINTERNET** handle created by [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="acb52-156">Les zones ombrées représentent des fonctions WinHTTP qui créent des handles et les zones simples affichent les fonctions qui utilisent ces handles **HINTERNET** .</span><span class="sxs-lookup"><span data-stu-id="acb52-156">The shaded boxes represent WinHTTP functions that create handles, and the plain boxes show the functions that use those **HINTERNET** handles.</span></span> <span data-ttu-id="acb52-157">Le diagramme est également organisé pour indiquer l’ordre dans lequel les fonctions WinHTTP sont normalement appelées.</span><span class="sxs-lookup"><span data-stu-id="acb52-157">The diagram is also organized to show the order in which WinHTTP functions are normally called.</span></span>

![fonctions qui créent des handles](images/art-winhttp2.png)

## <a name="explanation-of-the-handle-hierarchy"></a><span data-ttu-id="acb52-159">Explication de la hiérarchie des handles</span><span class="sxs-lookup"><span data-stu-id="acb52-159">Explanation of the Handle Hierarchy</span></span>

<span data-ttu-id="acb52-160">Tout d’abord, un descripteur de session est créé avec [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen).</span><span class="sxs-lookup"><span data-stu-id="acb52-160">First, a session handle is created with [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen).</span></span> <span data-ttu-id="acb52-161">[**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect) requiert le descripteur de session comme premier paramètre et retourne un handle de connexion pour un serveur spécifié.</span><span class="sxs-lookup"><span data-stu-id="acb52-161">[**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect) requires the session handle as its first parameter and returns a connection handle for a specified server.</span></span> <span data-ttu-id="acb52-162">Un handle de demande est créé par [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest), qui utilise le handle de connexion créé par [**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect).</span><span class="sxs-lookup"><span data-stu-id="acb52-162">A request handle is created by [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest), which uses the connection handle created by [**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect).</span></span> <span data-ttu-id="acb52-163">Si l’application choisit d’ajouter des en-têtes supplémentaires à la demande, ou si elle est nécessaire pour que l’application définisse des informations d’identification pour l’authentification, [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) et [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) peuvent être appelés à l’aide de ce handle de demande.</span><span class="sxs-lookup"><span data-stu-id="acb52-163">If the application chooses to add additional headers to the request, or if is it necessary for the application to set credentials for authentication, [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) and [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) can be called using this request handle.</span></span> <span data-ttu-id="acb52-164">La demande est envoyée par [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest), qui utilise le handle de demande.</span><span class="sxs-lookup"><span data-stu-id="acb52-164">The request is sent by [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest), which uses the request handle.</span></span> <span data-ttu-id="acb52-165">Après l’envoi de la demande, des données supplémentaires peuvent être envoyées au serveur à l’aide de [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata), ou l’application peut passer directement à [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) pour indiquer qu’aucune information supplémentaire n’est envoyée au serveur.</span><span class="sxs-lookup"><span data-stu-id="acb52-165">After sending the request, additional data can be sent to the server using [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata), or the application can skip directly to [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) to specify that no more information is sent to the server.</span></span> <span data-ttu-id="acb52-166">À ce stade, en fonction de l’objectif de l’application, le descripteur de demande peut être utilisé pour appeler [**WinHttpQueryHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryheaders), [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes)ou récupérer une ressource avec [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable) et [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata).</span><span class="sxs-lookup"><span data-stu-id="acb52-166">At this point, depending on the purpose of the application, the request handle can be used to call [**WinHttpQueryHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryheaders), [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes), or retrieve a resource with [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable) and [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata).</span></span>

 

 
