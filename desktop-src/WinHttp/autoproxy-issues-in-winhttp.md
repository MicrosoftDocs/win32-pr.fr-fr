---
description: Tenez compte des points importants suivants lors de l’utilisation de la fonctionnalité de proxy AutoProxy WinHTTP.
ms.assetid: 9bae89b7-8f54-42ec-a240-998c97e26d25
title: Problèmes liés au proxy AutoProxy dans WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 22c6edbf56ec1ffc4dfac930a5d4858429cc6447
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104209862"
---
# <a name="autoproxy-issues-in-winhttp"></a><span data-ttu-id="db73b-103">Problèmes liés au proxy AutoProxy dans WinHTTP</span><span class="sxs-lookup"><span data-stu-id="db73b-103">AutoProxy Issues in WinHTTP</span></span>

<span data-ttu-id="db73b-104">Tenez compte des points importants suivants lors de l’utilisation de la fonctionnalité de proxy AutoProxy WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="db73b-104">Consider the following important issues when using the WinHTTP autoproxy feature.</span></span>

## <a name="only-one-proxy-server-is-currently-supported"></a><span data-ttu-id="db73b-105">Un seul serveur proxy est actuellement pris en charge</span><span class="sxs-lookup"><span data-stu-id="db73b-105">Only One Proxy Server is Currently Supported</span></span>

<span data-ttu-id="db73b-106">WinHTTP ne prend actuellement pas en charge les configurations de proxy qui spécifient plusieurs serveurs proxy.</span><span class="sxs-lookup"><span data-stu-id="db73b-106">WinHTTP does not currently support proxy configurations that specify more than one proxy server.</span></span> <span data-ttu-id="db73b-107">Si [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) retourne une structure d' [**\_ \_ informations de proxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) qui contient une liste de serveurs proxy, que l’application définit ensuite sur le handle de demande à l’aide de l’option de proxy de l' **\_ option \_ WinHTTP** , WinHTTP utilise uniquement le premier serveur proxy de la liste.</span><span class="sxs-lookup"><span data-stu-id="db73b-107">If [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) returns a [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure that contains a list of proxy servers, which the application then sets on the request handle using the **WINHTTP\_OPTION\_PROXY** option, WinHTTP uses only the first proxy server in the list.</span></span> <span data-ttu-id="db73b-108">Si ce serveur proxy n’est pas accessible, WinHTTP n’effectue pas de basculement vers les autres serveurs proxy de la liste.</span><span class="sxs-lookup"><span data-stu-id="db73b-108">If that proxy server is not accessible, WinHTTP does not failover to any of the other proxy servers in the list.</span></span> <span data-ttu-id="db73b-109">Il revient à l’application de gérer ce cas en redéfinissant l’option de **\_ \_ proxy de l’option WinHTTP** avec le serveur proxy suivant dans la liste et en renvoyant la demande.</span><span class="sxs-lookup"><span data-stu-id="db73b-109">It is up to the application to handle this case by setting the **WINHTTP\_OPTION\_PROXY** option again with the next proxy server in the list, and resending the request.</span></span>

## <a name="security-risk-mitigation"></a><span data-ttu-id="db73b-110">Atténuation des risques de sécurité</span><span class="sxs-lookup"><span data-stu-id="db73b-110">Security Risk Mitigation</span></span>

<span data-ttu-id="db73b-111">Le traitement du fichier de configuration automatique de proxy requiert l’exécution du code de script téléchargé.</span><span class="sxs-lookup"><span data-stu-id="db73b-111">Processing the proxy auto-configuration file requires executing downloaded script code.</span></span> <span data-ttu-id="db73b-112">Voici quelques problèmes de sécurité à prendre en compte : si le serveur sur lequel réside le fichier PAC a été compromis, il est possible que le code de script PAC soit malveillant.</span><span class="sxs-lookup"><span data-stu-id="db73b-112">Some security concerns to consider: If the server on which the PAC file resides has been compromised, it is possible the PAC script code is malicious.</span></span> <span data-ttu-id="db73b-113">Par conséquent, WinHTTP utilise les précautions suivantes pour protéger le client :</span><span class="sxs-lookup"><span data-stu-id="db73b-113">Therefore, WinHTTP uses the following precautions to protect the client:</span></span>

1.  <span data-ttu-id="db73b-114">Le code de script ne peut pas instancier des objets ActiveX.</span><span class="sxs-lookup"><span data-stu-id="db73b-114">The script code is prevented from instantiating any ActiveX objects.</span></span> <span data-ttu-id="db73b-115">Cela bloque un grand nombre de fonctionnalités potentiellement dangereuses, telles que la possibilité d’accéder à des fichiers et d’effectuer des e/s réseau.</span><span class="sxs-lookup"><span data-stu-id="db73b-115">This blocks a lot of potentially dangerous functionality, such as the ability to access files and to perform network I/O.</span></span>
2.  <span data-ttu-id="db73b-116">\* \* Windows Server 2003 : \* \*[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) délègue l’intégralité du traitement WPAD à un service hors processus externe, le service de découverte automatique de proxy Web WinHTTP, qui s’exécute sous le compte d’utilisateur intégré du service local à faibles privilèges.</span><span class="sxs-lookup"><span data-stu-id="db73b-116">\*\*Windows Server 2003:  \*\*[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) delegates the entire WPAD processing to an external out-of-process service, the WinHTTP Web Proxy Auto-Discovery service, which runs under the low-privileged Local Service built-in user account.</span></span>

3.  <span data-ttu-id="db73b-117">**Windows XP avec SP2 et Windows Server 2003 :** Un script PAC n’est pas autorisé à s’exécuter pendant plus de 60 secondes, après quoi l’exécution du script est terminée.</span><span class="sxs-lookup"><span data-stu-id="db73b-117">**Windows XP with SP2 and Windows Server 2003:** A PAC script is not permitted to execute for longer than 60 seconds, after which script execution is terminated.</span></span>

4.  <span data-ttu-id="db73b-118">**Windows XP avec SP2 et Windows Server 2003 :** WinHTTP rejette les fichiers PAC d’une taille supérieure à 1 Mo.</span><span class="sxs-lookup"><span data-stu-id="db73b-118">**Windows XP with SP2 and Windows Server 2003:** WinHTTP rejects PAC files larger than 1MB.</span></span> <span data-ttu-id="db73b-119">La taille d’un fichier PAC type est généralement inférieure à quelques kilo-octets.</span><span class="sxs-lookup"><span data-stu-id="db73b-119">A typical PAC file is usually no more than a few kilobytes in size.</span></span>

<span data-ttu-id="db73b-120">Sachez que le traitement du code de script PAC requiert l’utilisation de COM, car WinHTTP utilise le composant Microsoft JScript pour exécuter le script.</span><span class="sxs-lookup"><span data-stu-id="db73b-120">Be aware that processing the PAC script code requires the use of COM, because WinHTTP uses Microsoft JScript component to execute the script.</span></span> <span data-ttu-id="db73b-121">Si WinHTTP ne peut pas déléguer le traitement du protocole WPAD à un service de découverte automatique de proxy Web externe hors processus, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) charge le runtime com dans le processus d’application pour la durée de l’appel.</span><span class="sxs-lookup"><span data-stu-id="db73b-121">If WinHTTP cannot delegate WPAD protocol processing to an external, out-of-process Web Proxy Auto-Discovery service, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) loads the COM runtime within the application process for the duration of the call.</span></span> <span data-ttu-id="db73b-122">Si l’application elle-même utilise déjà COM, cela ne devrait pas poser de problème.</span><span class="sxs-lookup"><span data-stu-id="db73b-122">If the application itself is already using COM, this should not be a concern.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="db73b-123">Considérations relatives aux performances</span><span class="sxs-lookup"><span data-stu-id="db73b-123">Performance Considerations</span></span>

<span data-ttu-id="db73b-124">Le processus de détection automatique peut être lent, peut-être pendant plusieurs secondes.</span><span class="sxs-lookup"><span data-stu-id="db73b-124">The auto-detection process can be slow, possibly as long as several seconds.</span></span> <span data-ttu-id="db73b-125">Les fonctions [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) et [WinHttpDetectAutoProxyConfigUrl](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) sont des fonctions de blocage et synchrones.</span><span class="sxs-lookup"><span data-stu-id="db73b-125">The [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) and [WinHttpDetectAutoProxyConfigUrl](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) functions are blocking, synchronous functions.</span></span> <span data-ttu-id="db73b-126">Il peut s’agir d’un mécanisme de détection automatique particulier (tel que DHCP) qui est beaucoup plus lent que l’autre (par exemple, DNS).</span><span class="sxs-lookup"><span data-stu-id="db73b-126">It could be that one particular auto-detection mechanism (such as DHCP) is much slower than the other (such as DNS).</span></span> <span data-ttu-id="db73b-127">Si le type de détection automatique WinHTTP de type détection automatique **\_ \_ \_ \_ DHCP** et **WinHTTP \_ détecte automatiquement les \_ \_ types \_ DNS \_** , les indicateurs de détection automatique sont spécifiés, WinHTTP utilise le protocole DHCP en premier, conformément à la spécification WPAD.</span><span class="sxs-lookup"><span data-stu-id="db73b-127">If both the **WINHTTP\_AUTO\_DETECT\_TYPE\_DHCP** and **WINHTTP\_AUTO\_DETECT\_TYPE\_DNS\_A** auto-detection flags are specified, WinHTTP uses DHCP first, in accordance with the WPAD specification.</span></span> <span data-ttu-id="db73b-128">Si aucune URL PAC n’est détectée en émettant une requête DHCP, WinHTTP tente de localiser le fichier PAC à une adresse DNS connue.</span><span class="sxs-lookup"><span data-stu-id="db73b-128">If no PAC URL is discovered by issuing a DHCP request, then WinHTTP tries to locate the PAC file at a well-known DNS address.</span></span>

<span data-ttu-id="db73b-129">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) utilise le paramètre de handle de session WinHTTP pour la mise en cache du fichier PAC et les résultats de la détection automatique.</span><span class="sxs-lookup"><span data-stu-id="db73b-129">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) uses the WinHTTP Session handle parameter for caching the PAC file and the results of auto-detection.</span></span> <span data-ttu-id="db73b-130">Il est préférable d’utiliser le même handle de session pour plusieurs appels **WinHttpGetProxyForUrl** , si possible, afin d’éviter la détection répétée d’URL PAC et le téléchargement de fichiers.</span><span class="sxs-lookup"><span data-stu-id="db73b-130">It is best to use the same session handle for multiple **WinHttpGetProxyForUrl** calls if possible to avoid repeated PAC URL detection and file downloading.</span></span> <span data-ttu-id="db73b-131">Le fichier PAC est mis en cache en mémoire uniquement et est ignoré lorsque l’application ferme le descripteur de session.</span><span class="sxs-lookup"><span data-stu-id="db73b-131">The PAC file is cached in-memory only, and is discarded when the application closes the session handle.</span></span>

<span data-ttu-id="db73b-132">En raison de l’impact sur les performances de la fonction de proxy, il est recommandé que seuls les applications ou les services du client de bureau utilisent la fonctionnalité. les applications basées sur le serveur doivent s’appuyer sur l’administrateur du serveur à l’aide de l’utilitaire « ProxyCfg.exe ».</span><span class="sxs-lookup"><span data-stu-id="db73b-132">Because of the performance impact of autoproxy, it is recommended that only desktop client applications or services use the feature; server-based applications should rely on the server administrator using the "ProxyCfg.exe" utility.</span></span>

 

 



