---
description: 'Les considérations de sécurité suivantes s’appliquent aux applications qui utilisent WinHTTP : les certificats de serveur ne sont vérifiés qu’une seule fois par session.'
ms.assetid: 287e85ed-a324-4785-872a-26e4ab37986d
title: Considérations sur la sécurité WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b80d813fa5b50cb9c880598d3187c697412d1dab1d7fdd80b4507d17d03eff6a
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/11/2021
ms.locfileid: "119955689"
---
# <a name="winhttp-security-considerations"></a>Considérations sur la sécurité WinHTTP

Les considérations de sécurité suivantes s’appliquent aux applications qui utilisent WinHTTP :

-   **Les certificats de serveur ne sont vérifiés qu’une seule fois par session.** Une fois qu’un certificat a été vérifié, il reste valide pour la durée de la session active. Tant que l’empreinte de certificat correspond, ce qui indique que le certificat n’a pas changé, le certificat continue d’être revalidée. En conséquence, toute modification apportée aux critères de validation, par le biais des indicateurs protocole, révocation-vérification ou certificat-erreur-ignorer, ne prend pas effet une fois que le certificat est vérifié. Pour que cette modification prenne effet immédiatement, la session en cours doit être terminée et une nouvelle doit être démarrée. De même, l’expiration d’un certificat au cours d’une session ne peut être détectée que si l’application elle-même vérifie régulièrement le serveur de certificats pour récupérer les données d’expiration.
-   **Le proxy automatique implique le téléchargement et l’exécution de scripts.** La prise en charge automatique de la découverte de proxy implique la détection via DHCP ou DNS, le téléchargement et l’exécution de scripts proxy tels que les scripts Java. Pour obtenir un degré de sécurité plus élevé, une application doit éviter de transmettre l’indicateur **\_ \_ \_ InProcess du proxy automatique WinHTTP** afin que la détection automatique de proxy soit initiée hors processus. En même temps, WinHTTP tente par défaut d’exécuter un script de proxy automatique in-process si le script ne s’exécute pas correctement. Si vous pensez que ce comportement de secours pose un risque inacceptable, désactivez le comportement de secours avec l’indicateur **WinHTTP \_ AutoProxy \_ exécuter le \_ processus \_ uniquement** .
-   **Les \_ fonctions de rappel d’État WinHTTP \_ doivent retourner promptement.** Lorsque vous écrivez l’une de ces fonctions de rappel, veillez à ce qu’elle ne soit pas bloquée. Par exemple, ni le rappel, ni aucune fonction qu’il appelle, ne doit afficher une boîte de dialogue utilisateur ou attendre un événement. Si une fonction de [*\_ \_ rappel d’État WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) est bloquée, elle affecte la planification interne de WinHTTP et entraîne le refus du service d’autres demandes au sein du même processus.
-   **Les \_ fonctions de rappel d’État WinHTTP \_ doivent être réentrantes.** Lors de l’écriture d’un rappel, évitez les variables statiques ou d’autres constructions qui ne sont pas sûres en cas de réentrée, et évitez d’appeler d’autres fonctions qui ne sont pas réentrantes.
-   **Si une opération asynchrone est possible, transmettez des valeurs NULL pour les paramètres OUT.** Si vous avez activé l’opération asynchrone en inscrivant une fonction de rappel, transmettez toujours des valeurs **null** pour ces paramètres comme *lpdwDataAvailable* pour [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable), *lpdwBytesRead* pour [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata)ou *lpdwBytesWritten* pour [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata). Dans certains cas, le thread appelant se termine avant la fin de l’opération, et si les paramètres de sortie ne sont pas **null**, la fonction peut finir par écrire dans la mémoire qui a déjà été libérée.
-   **L’authentification Passport n’est pas infaillible.** Tout schéma d’authentification basé sur les cookies est vulnérable aux attaques. La version de Passport 1,4 est basée sur les cookies et est donc sujette aux vulnérabilités associées à un modèle d’authentification par cookie ou par formulaire. La prise en charge de Passport est désactivée par défaut dans WinHTTP. Il peut être activé à l’aide de l’option [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).
-   **L’authentification de base ne doit être utilisée que sur une connexion sécurisée.** L’authentification de base, qui envoie le nom d’utilisateur et le mot de passe en texte clair (voir [RFC 2617](https://www.ietf.org/rfc/rfc2617.txt)), doit être utilisée uniquement sur des connexions SSL ou TLS chiffrées.
-   **La définition de la stratégie de connexion automatique sur « faible » peut présenter un risque.** Lorsque la stratégie de connexion automatique est définie sur faible, les informations d’identification d’ouverture de session d’un utilisateur peuvent être utilisées pour s’authentifier sur n’importe quel site. Toutefois, il n’est pas recommandé de s’authentifier auprès des sites que vous n’approuvez pas.
-   **Les connexions SSL 2,0 ne sont pas utilisées, sauf si elles sont activées explicitement.** Les protocoles de sécurité TLS 1,0 et SSL 3,0 sont considérés comme plus sûrs que SSL 2,0. Par défaut, WinHTTP demande TLS 1,0 ou SSL 3,0 lors de la négociation d’une connexion SSL, et non SSL 2,0. La prise en charge de SSL 2,0 dans WinHTTP ne peut être activée qu’en appelant [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).
-   **La vérification de la révocation des certificats doit être explicitement demandée.** Par défaut, lors de l’exécution de l’authentification par certificat, WinHTTP ne vérifie pas si le certificat du serveur a été révoqué. La vérification de la révocation des certificats peut être activée à l’aide de [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).
-   **Les applications doivent s’assurer qu’une session est mappée à une identité unique.** Une session WinHTTP ne doit correspondre qu’à une seule identité ; autrement dit, une session WinHTTP est utilisée pour gérer l’activité Internet d’un seul utilisateur authentifié ou d’un groupe d’utilisateurs anonymes. Toutefois, étant donné que WinHTTP n’applique pas automatiquement ce mappage, votre application doit prendre des mesures pour s’assurer qu’une seule identité est impliquée.
-   **Les opérations sur un handle de demande WinHTTP doivent être synchronisées.** Par exemple, une application doit éviter de fermer un handle de demande sur un thread pendant qu’un autre thread envoie ou reçoit une demande. Pour mettre fin à une demande asynchrone, fermez le handle de demande au cours d’une notification de rappel. Pour mettre fin à une demande synchrone, fermez le handle lorsque l’appel WinHTTP précédent est retourné.
-   **Les fichiers de trace contiennent des informations sensibles.** Les fichiers de trace sont protégés à l’aide de listes de Access-Control (ACL) afin qu’il soit normalement accessible uniquement par l’administrateur local ou par le compte d’utilisateur qui l’a créé. Évitez de compromettre les fichiers de trace par un accès non autorisé.
-   **Évitez de transmettre des données sensibles via** [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption). Ne fournissez pas un nom d’utilisateur, un mot de passe ou toute autre information d’identification à **WinHttpSetOption** , car vous n’avez aucun contrôle sur le schéma d’authentification utilisé, et les données sensibles peuvent être envoyées de manière inattendue en texte clair. Utilisez [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) et **WinHttpSetCredentials** au lieu de **WinHttpSetOption** pour définir les informations d’identification.
-   **La redirection automatique peut poser un risque pour la sécurité.** Par défaut, la redirection (un message 302) est suivie automatiquement, même pour une publication. Pour éviter la possibilité de redirections fausses, les applications doivent désactiver la redirection automatique ou surveiller la réorientation dans les rappels lors de la publication d’informations sensibles.
-   **Les en-têtes définis par l’utilisateur sont transférés entre les redirections inchangées.** Les en-têtes définis par l’utilisateur, tels que les cookies ajoutés avec **WinHTTPAddRequestHeaders**, sont transférés entre les redirections sans modification, tandis que les en-têtes générés par WinHTTP sont automatiquement mis à jour. Si le transfert d’un en-tête défini par l’utilisateur entre les redirections pose un risque de sécurité, utilisez le rappel de [*\_ \_ rappel d’État WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) avec l' **État de rappel WinHTTP de \_ \_ \_ redirection** pour modifier l’en-tête en question chaque fois qu’une redirection se produit.
-   **WinHTTP n’est pas réentrant en mode synchrone.** Étant donné que WinHTTP n’est pas réentrant en mode synchrone, ne planifiez pas les appels de procédure asynchrone (APC) qui peuvent appeler dans WinHTTP sur un thread d’application qui s’exécute à l’intérieur d’une fonction WinHTTP. En mode synchrone, WinHTTP effectue une « attente d’alerte », et si le thread en attente est préemptée pour exécuter un APC, puis réentre ensuite WinHTTP, l’état interne de WinHTTP peut être endommagé.

 

 
