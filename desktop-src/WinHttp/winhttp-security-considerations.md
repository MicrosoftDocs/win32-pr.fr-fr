---
description: 'Les considérations de sécurité suivantes s’appliquent aux applications qui utilisent WinHTTP : les certificats de serveur ne sont vérifiés qu’une seule fois par session.'
ms.assetid: 287e85ed-a324-4785-872a-26e4ab37986d
title: Considérations sur la sécurité WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc06725ba03631eb4d5e5c29f8cfa0aae69b5022
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104484977"
---
# <a name="winhttp-security-considerations"></a><span data-ttu-id="e0676-103">Considérations sur la sécurité WinHTTP</span><span class="sxs-lookup"><span data-stu-id="e0676-103">WinHTTP Security Considerations</span></span>

<span data-ttu-id="e0676-104">Les considérations de sécurité suivantes s’appliquent aux applications qui utilisent WinHTTP :</span><span class="sxs-lookup"><span data-stu-id="e0676-104">The following security considerations apply to applications that use WinHTTP:</span></span>

-   <span data-ttu-id="e0676-105">**Les certificats de serveur ne sont vérifiés qu’une seule fois par session.**</span><span class="sxs-lookup"><span data-stu-id="e0676-105">**Server certificates are only verified once per session.**</span></span> <span data-ttu-id="e0676-106">Une fois qu’un certificat a été vérifié, il reste valide pour la durée de la session active.</span><span class="sxs-lookup"><span data-stu-id="e0676-106">After a certificate has been verified, it remains valid for the duration of the current session.</span></span> <span data-ttu-id="e0676-107">Tant que l’empreinte de certificat correspond, ce qui indique que le certificat n’a pas changé, le certificat continue d’être revalidée.</span><span class="sxs-lookup"><span data-stu-id="e0676-107">As long as the certificate fingerprint matches, which indicates that the certificate has not changed, the certificate continues to be re-validated.</span></span> <span data-ttu-id="e0676-108">En conséquence, toute modification apportée aux critères de validation, par le biais des indicateurs protocole, révocation-vérification ou certificat-erreur-ignorer, ne prend pas effet une fois que le certificat est vérifié.</span><span class="sxs-lookup"><span data-stu-id="e0676-108">As a result, any change in the validation criteria, through the protocol, revocation-check, or certificate-error-ignore flags, does not take effect once the certificate is verified.</span></span> <span data-ttu-id="e0676-109">Pour que cette modification prenne effet immédiatement, la session en cours doit être terminée et une nouvelle doit être démarrée.</span><span class="sxs-lookup"><span data-stu-id="e0676-109">To force such a change to take effect immediately, the current session must be ended and a new one started.</span></span> <span data-ttu-id="e0676-110">De même, l’expiration d’un certificat au cours d’une session ne peut être détectée que si l’application elle-même vérifie régulièrement le serveur de certificats pour récupérer les données d’expiration.</span><span class="sxs-lookup"><span data-stu-id="e0676-110">Similarly, expiration of a certificate during the course of a session can only be detected if the application itself checks the certificate server periodically to retrieve expiration data.</span></span>
-   <span data-ttu-id="e0676-111">**Le proxy automatique implique le téléchargement et l’exécution de scripts.**</span><span class="sxs-lookup"><span data-stu-id="e0676-111">**Auto-proxy involves downloading and executing scripts.**</span></span> <span data-ttu-id="e0676-112">La prise en charge automatique de la découverte de proxy implique la détection via DHCP ou DNS, le téléchargement et l’exécution de scripts proxy tels que les scripts Java.</span><span class="sxs-lookup"><span data-stu-id="e0676-112">The automatic proxy discovery support involves detecting through DHCP or DNS, downloading, and executing proxy scripts such as Java scripts.</span></span> <span data-ttu-id="e0676-113">Pour obtenir un degré de sécurité plus élevé, une application doit éviter de transmettre l’indicateur **\_ \_ \_ InProcess du proxy automatique WinHTTP** afin que la détection automatique de proxy soit initiée hors processus.</span><span class="sxs-lookup"><span data-stu-id="e0676-113">To achieve a higher degree of security, an application must avoid passing the **WINHTTP\_AUTOPROXY\_RUN\_INPROCESS** flag, so that the auto-proxy discovery is initiated out-of-process.</span></span> <span data-ttu-id="e0676-114">En même temps, WinHTTP tente par défaut d’exécuter un script de proxy automatique in-process si le script ne s’exécute pas correctement.</span><span class="sxs-lookup"><span data-stu-id="e0676-114">Even then, WinHTTP tries by default to run an auto-proxy script in-process if the script fails to run properly out-of-process.</span></span> <span data-ttu-id="e0676-115">Si vous pensez que ce comportement de secours pose un risque inacceptable, désactivez le comportement de secours avec l’indicateur **WinHTTP \_ AutoProxy \_ exécuter le \_ processus \_ uniquement** .</span><span class="sxs-lookup"><span data-stu-id="e0676-115">If you believe that this fallback behavior poses an unacceptable risk, disable the fallback behavior with the **WINHTTP\_AUTOPROXY\_RUN\_OUTPROCESS\_ONLY** flag.</span></span>
-   <span data-ttu-id="e0676-116">**Les \_ fonctions de rappel d’État WinHTTP \_ doivent retourner promptement.**</span><span class="sxs-lookup"><span data-stu-id="e0676-116">**WINHTTP\_STATUS\_CALLBACK functions must return promptly.**</span></span> <span data-ttu-id="e0676-117">Lorsque vous écrivez l’une de ces fonctions de rappel, veillez à ce qu’elle ne soit pas bloquée.</span><span class="sxs-lookup"><span data-stu-id="e0676-117">When you write one of these callback functions, be careful that it does not block.</span></span> <span data-ttu-id="e0676-118">Par exemple, ni le rappel, ni aucune fonction qu’il appelle, ne doit afficher une boîte de dialogue utilisateur ou attendre un événement.</span><span class="sxs-lookup"><span data-stu-id="e0676-118">For example, neither the callback nor any function it calls should display a user dialog or wait for an event.</span></span> <span data-ttu-id="e0676-119">Si une fonction de [*\_ \_ rappel d’État WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) est bloquée, elle affecte la planification interne de WinHTTP et entraîne le refus du service d’autres demandes au sein du même processus.</span><span class="sxs-lookup"><span data-stu-id="e0676-119">If a [*WINHTTP\_STATUS\_CALLBACK*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) function does block, it affects WinHTTP's internal scheduling and causes other requests within the same process to be denied service.</span></span>
-   <span data-ttu-id="e0676-120">**Les \_ fonctions de rappel d’État WinHTTP \_ doivent être réentrantes.**</span><span class="sxs-lookup"><span data-stu-id="e0676-120">**WINHTTP\_STATUS\_CALLBACK functions must be reentrant.**</span></span> <span data-ttu-id="e0676-121">Lors de l’écriture d’un rappel, évitez les variables statiques ou d’autres constructions qui ne sont pas sûres en cas de réentrée, et évitez d’appeler d’autres fonctions qui ne sont pas réentrantes.</span><span class="sxs-lookup"><span data-stu-id="e0676-121">When writing a callback, avoid static variables or other constructs that are unsafe under reentrance, and avoid calling other functions that are not reentrant.</span></span>
-   <span data-ttu-id="e0676-122">**Si une opération asynchrone est possible, transmettez des valeurs NULL pour les paramètres OUT.**</span><span class="sxs-lookup"><span data-stu-id="e0676-122">**If asynchronous operation is possible, pass NULLs for OUT parameters.**</span></span> <span data-ttu-id="e0676-123">Si vous avez activé l’opération asynchrone en inscrivant une fonction de rappel, transmettez toujours des valeurs **null** pour ces paramètres comme *lpdwDataAvailable* pour [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable), *lpdwBytesRead* pour [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata)ou *lpdwBytesWritten* pour [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata).</span><span class="sxs-lookup"><span data-stu-id="e0676-123">If you have enabled asynchronous operation by registering a callback function, always pass **NULL** values for such OUT parameters as *lpdwDataAvailable* for [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable), *lpdwBytesRead* for [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata), or *lpdwBytesWritten* for [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata).</span></span> <span data-ttu-id="e0676-124">Dans certains cas, le thread appelant se termine avant la fin de l’opération, et si les paramètres de sortie ne sont pas **null**, la fonction peut finir par écrire dans la mémoire qui a déjà été libérée.</span><span class="sxs-lookup"><span data-stu-id="e0676-124">Under some circumstances, the calling thread is terminated before the operation completes, and if the OUT parameters are not **NULL**, the function can end up writing to memory that has already been freed.</span></span>
-   <span data-ttu-id="e0676-125">**L’authentification Passport n’est pas infaillible.**</span><span class="sxs-lookup"><span data-stu-id="e0676-125">**Passport authentication is not foolproof.**</span></span> <span data-ttu-id="e0676-126">Tout schéma d’authentification basé sur les cookies est vulnérable aux attaques.</span><span class="sxs-lookup"><span data-stu-id="e0676-126">Any cookie-based authentication scheme is vulnerable to attack.</span></span> <span data-ttu-id="e0676-127">La version de Passport 1,4 est basée sur les cookies et est donc sujette aux vulnérabilités associées à un modèle d’authentification par cookie ou par formulaire.</span><span class="sxs-lookup"><span data-stu-id="e0676-127">Passport version 1.4 is cookie based, and therefore subject to the vulnerabilities that are associated with any cookie or form-based authentication scheme.</span></span> <span data-ttu-id="e0676-128">La prise en charge de Passport est désactivée par défaut dans WinHTTP. Il peut être activé à l’aide de l’option [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="e0676-128">Passport support is disabled by default in WinHTTP; it can be enabled using [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>
-   <span data-ttu-id="e0676-129">**L’authentification de base ne doit être utilisée que sur une connexion sécurisée.**</span><span class="sxs-lookup"><span data-stu-id="e0676-129">**Basic authentication should only be used over a secure connection.**</span></span> <span data-ttu-id="e0676-130">L’authentification de base, qui envoie le nom d’utilisateur et le mot de passe en texte clair (voir [RFC 2617](https://www.ietf.org/rfc/rfc2617.txt)), doit être utilisée uniquement sur des connexions SSL ou TLS chiffrées.</span><span class="sxs-lookup"><span data-stu-id="e0676-130">Basic authentication, which sends the user name and password in clear text (see [RFC 2617](https://www.ietf.org/rfc/rfc2617.txt)), should be used only over encrypted SSL or TLS connections.</span></span>
-   <span data-ttu-id="e0676-131">**La définition de la stratégie de connexion automatique sur « faible » peut présenter un risque.**</span><span class="sxs-lookup"><span data-stu-id="e0676-131">**Setting Auto-Logon Policy to "low" can pose a risk.**</span></span> <span data-ttu-id="e0676-132">Lorsque la stratégie de connexion automatique est définie sur faible, les informations d’identification d’ouverture de session d’un utilisateur peuvent être utilisées pour s’authentifier sur n’importe quel site.</span><span class="sxs-lookup"><span data-stu-id="e0676-132">When the Auto-Logon Policy is set to low, a user's logon credential can be used to authenticate against any site.</span></span> <span data-ttu-id="e0676-133">Toutefois, il n’est pas recommandé de s’authentifier auprès des sites que vous n’approuvez pas.</span><span class="sxs-lookup"><span data-stu-id="e0676-133">However, it is not good security practice to authenticate against sites you do not trust.</span></span>
-   <span data-ttu-id="e0676-134">**Les connexions SSL 2,0 ne sont pas utilisées, sauf si elles sont activées explicitement.**</span><span class="sxs-lookup"><span data-stu-id="e0676-134">**SSL 2.0 connections are not used unless explicitly enabled.**</span></span> <span data-ttu-id="e0676-135">Les protocoles de sécurité TLS 1,0 et SSL 3,0 sont considérés comme plus sûrs que SSL 2,0.</span><span class="sxs-lookup"><span data-stu-id="e0676-135">The TLS 1.0 and SSL 3.0 security protocols are considered more secure than SSL 2.0.</span></span> <span data-ttu-id="e0676-136">Par défaut, WinHTTP demande TLS 1,0 ou SSL 3,0 lors de la négociation d’une connexion SSL, et non SSL 2,0.</span><span class="sxs-lookup"><span data-stu-id="e0676-136">By default, WinHTTP requests TLS 1.0 or SSL 3.0 when negotiating an SSL connection, not SSL 2.0.</span></span> <span data-ttu-id="e0676-137">La prise en charge de SSL 2,0 dans WinHTTP ne peut être activée qu’en appelant [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="e0676-137">SSL 2.0 support in WinHTTP can only be enabled by calling [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>
-   <span data-ttu-id="e0676-138">**La vérification de la révocation des certificats doit être explicitement demandée.**</span><span class="sxs-lookup"><span data-stu-id="e0676-138">**Certificate-revocation checking must be explicitly requested.**</span></span> <span data-ttu-id="e0676-139">Par défaut, lors de l’exécution de l’authentification par certificat, WinHTTP ne vérifie pas si le certificat du serveur a été révoqué.</span><span class="sxs-lookup"><span data-stu-id="e0676-139">By default, when performing certificate authentication, WinHTTP does not check whether the server's certificate has been revoked.</span></span> <span data-ttu-id="e0676-140">La vérification de la révocation des certificats peut être activée à l’aide de [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="e0676-140">Certificate-revocation checking can be enabled using [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>
-   <span data-ttu-id="e0676-141">**Les applications doivent s’assurer qu’une session est mappée à une identité unique.**</span><span class="sxs-lookup"><span data-stu-id="e0676-141">**Applications must ensure that a session maps to a single identity.**</span></span> <span data-ttu-id="e0676-142">Une session WinHTTP ne doit correspondre qu’à une seule identité ; autrement dit, une session WinHTTP est utilisée pour gérer l’activité Internet d’un seul utilisateur authentifié ou d’un groupe d’utilisateurs anonymes.</span><span class="sxs-lookup"><span data-stu-id="e0676-142">A WinHTTP session should map to one and only one identity; that is, a WinHTTP session is used to manage the Internet activity of a single authenticated user, or a group of anonymous users.</span></span> <span data-ttu-id="e0676-143">Toutefois, étant donné que WinHTTP n’applique pas automatiquement ce mappage, votre application doit prendre des mesures pour s’assurer qu’une seule identité est impliquée.</span><span class="sxs-lookup"><span data-stu-id="e0676-143">However, because WinHTTP does not enforce this mapping automatically, your application must take steps to ensure that only a single identity is involved.</span></span>
-   <span data-ttu-id="e0676-144">**Les opérations sur un handle de demande WinHTTP doivent être synchronisées.**</span><span class="sxs-lookup"><span data-stu-id="e0676-144">**Operations on a WinHTTP request handle should be synchronized.**</span></span> <span data-ttu-id="e0676-145">Par exemple, une application doit éviter de fermer un handle de demande sur un thread pendant qu’un autre thread envoie ou reçoit une demande.</span><span class="sxs-lookup"><span data-stu-id="e0676-145">For example, an application should avoid closing a request handle on one thread while another thread is sending or receiving a request.</span></span> <span data-ttu-id="e0676-146">Pour mettre fin à une demande asynchrone, fermez le handle de demande au cours d’une notification de rappel.</span><span class="sxs-lookup"><span data-stu-id="e0676-146">To terminate an asynchronous request, close the request handle during a callback notification.</span></span> <span data-ttu-id="e0676-147">Pour mettre fin à une demande synchrone, fermez le handle lorsque l’appel WinHTTP précédent est retourné.</span><span class="sxs-lookup"><span data-stu-id="e0676-147">To terminate a synchronous request, close the handle when the previous WinHTTP call returns.</span></span>
-   <span data-ttu-id="e0676-148">**Les fichiers de trace contiennent des informations sensibles.**</span><span class="sxs-lookup"><span data-stu-id="e0676-148">**Trace files contain sensitive information.**</span></span> <span data-ttu-id="e0676-149">Les fichiers de trace sont protégés à l’aide de listes de Access-Control (ACL) afin qu’il soit normalement accessible uniquement par l’administrateur local ou par le compte d’utilisateur qui l’a créé. Évitez de compromettre les fichiers de trace par un accès non autorisé.</span><span class="sxs-lookup"><span data-stu-id="e0676-149">Trace files are protected using Access-Control Lists (ACLs) so that one can normally be accessed only by the local administrator or by the user account that created it.Avoid compromising trace files by any unauthorized access.</span></span>
-   <span data-ttu-id="e0676-150">**Évitez de transmettre des données sensibles via** [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="e0676-150">**Avoid passing sensitive data through** [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="e0676-151">Ne fournissez pas un nom d’utilisateur, un mot de passe ou toute autre information d’identification à **WinHttpSetOption** , car vous n’avez aucun contrôle sur le schéma d’authentification utilisé, et les données sensibles peuvent être envoyées de manière inattendue en texte clair.</span><span class="sxs-lookup"><span data-stu-id="e0676-151">Do not supply a user name, password or any other credentials to **WinHttpSetOption** because you have no control over the authentication scheme that is used, and the sensitive data could unexpectedly be sent in clear text.</span></span> <span data-ttu-id="e0676-152">Utilisez [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) et **WinHttpSetCredentials** au lieu de **WinHttpSetOption** pour définir les informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="e0676-152">Use [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) and **WinHttpSetCredentials** instead of **WinHttpSetOption** for setting credentials.</span></span>
-   <span data-ttu-id="e0676-153">**La redirection automatique peut poser un risque pour la sécurité.**</span><span class="sxs-lookup"><span data-stu-id="e0676-153">**Automatic redirection can pose a security risk.**</span></span> <span data-ttu-id="e0676-154">Par défaut, la redirection (un message 302) est suivie automatiquement, même pour une publication.</span><span class="sxs-lookup"><span data-stu-id="e0676-154">By default, redirection (a 302 message) is followed automatically even for a POST.</span></span> <span data-ttu-id="e0676-155">Pour éviter la possibilité de redirections fausses, les applications doivent désactiver la redirection automatique ou surveiller la réorientation dans les rappels lors de la publication d’informations sensibles.</span><span class="sxs-lookup"><span data-stu-id="e0676-155">To avoid the possibility of spurious redirects, applications should disable auto-redirect or monitor re-direction in callbacks when posting sensitive information.</span></span>
-   <span data-ttu-id="e0676-156">**Les en-têtes définis par l’utilisateur sont transférés entre les redirections inchangées.**</span><span class="sxs-lookup"><span data-stu-id="e0676-156">**User-defined headers are transferred across redirects unchanged.**</span></span> <span data-ttu-id="e0676-157">Les en-têtes définis par l’utilisateur, tels que les cookies ajoutés avec **WinHTTPAddRequestHeaders**, sont transférés entre les redirections sans modification, tandis que les en-têtes générés par WinHTTP sont automatiquement mis à jour.</span><span class="sxs-lookup"><span data-stu-id="e0676-157">User-defined headers, such as cookies added with **WinHTTPAddRequestHeaders**, are transferred across redirects without modification, while headers generated by WinHTTP are automatically updated.</span></span> <span data-ttu-id="e0676-158">Si le transfert d’un en-tête défini par l’utilisateur entre les redirections pose un risque de sécurité, utilisez le rappel de [*\_ \_ rappel d’État WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) avec l' **État de rappel WinHTTP de \_ \_ \_ redirection** pour modifier l’en-tête en question chaque fois qu’une redirection se produit.</span><span class="sxs-lookup"><span data-stu-id="e0676-158">If transferring a user-defined header across redirects poses a security risk, use the [*WINHTTP\_STATUS\_CALLBACK*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) callback with the **WINHTTP\_CALLBACK\_STATUS\_REDIRECT** completion to modify the header in question whenever a redirect occurs.</span></span>
-   <span data-ttu-id="e0676-159">**WinHTTP n’est pas réentrant en mode synchrone.**</span><span class="sxs-lookup"><span data-stu-id="e0676-159">**WinHTTP is not reentrant in synchronous mode.**</span></span> <span data-ttu-id="e0676-160">Étant donné que WinHTTP n’est pas réentrant en mode synchrone, ne planifiez pas les appels de procédure asynchrone (APC) qui peuvent appeler dans WinHTTP sur un thread d’application qui s’exécute à l’intérieur d’une fonction WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="e0676-160">Because WinHTTP is not reentrant in synchronous mode, do not schedule asynchronous procedure calls (APC) that can call into WinHTTP on an application thread that executes inside a WinHTTP function.</span></span> <span data-ttu-id="e0676-161">En mode synchrone, WinHTTP effectue une « attente d’alerte », et si le thread en attente est préemptée pour exécuter un APC, puis réentre ensuite WinHTTP, l’état interne de WinHTTP peut être endommagé.</span><span class="sxs-lookup"><span data-stu-id="e0676-161">While in synchronous mode, WinHTTP performs an "alertable wait," and if the waiting thread is pre-empted to execute an APC and then later re-enters WinHTTP again, WinHTTP's internal state can be corrupted.</span></span>

 

 
