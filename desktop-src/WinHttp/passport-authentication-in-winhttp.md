---
description: Les services HTTP Microsoft Windows (WinHTTP) prennent entièrement en charge l’utilisation côté client du protocole d’authentification Microsoft Passport. Cette rubrique fournit une vue d’ensemble des transactions impliquées dans l’authentification Passport et explique comment les gérer.
ms.assetid: 395d7aef-4da0-4664-8328-7d31ce58fedd
title: Authentification Passport dans WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7b8fc00217c7c14fbd4635fab68398d2056c1ea5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104484184"
---
# <a name="passport-authentication-in-winhttp"></a><span data-ttu-id="383f4-104">Authentification Passport dans WinHTTP</span><span class="sxs-lookup"><span data-stu-id="383f4-104">Passport Authentication in WinHTTP</span></span>

<span data-ttu-id="383f4-105">Les services HTTP Microsoft Windows (WinHTTP) prennent entièrement en charge l’utilisation côté client du protocole d’authentification Microsoft Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-105">Microsoft Windows HTTP Services (WinHTTP) fully support the client side use of the Microsoft Passport authentication protocol.</span></span> <span data-ttu-id="383f4-106">Cette rubrique fournit une vue d’ensemble des transactions impliquées dans l’authentification Passport et explique comment les gérer.</span><span class="sxs-lookup"><span data-stu-id="383f4-106">This topic provides an overview of the transactions involved in Passport authentication and how to handle them.</span></span>

> [!Note]  
> <span data-ttu-id="383f4-107">Dans WinHTTP 5,1, l’authentification Passport est désactivée par défaut.</span><span class="sxs-lookup"><span data-stu-id="383f4-107">In WinHTTP 5.1, Passport authentication is disabled by default.</span></span>

 

## <a name="passport-14"></a><span data-ttu-id="383f4-108">Passport 1,4</span><span class="sxs-lookup"><span data-stu-id="383f4-108">Passport 1.4</span></span>

<span data-ttu-id="383f4-109">Passport est un composant principal des services de bloc de Microsoft .NET.</span><span class="sxs-lookup"><span data-stu-id="383f4-109">Passport is a core component of the Microsoft .NET building block services.</span></span> <span data-ttu-id="383f4-110">Elle permet aux entreprises de développer et d’offrir des services Web distribués dans un large éventail d’applications et permet à ses membres d’utiliser un nom et un mot de passe de connexion sur tous les sites Web participants.</span><span class="sxs-lookup"><span data-stu-id="383f4-110">It enables businesses to develop and offer distributed Web services across a wide range of applications and enables its members to use one sign-in name and password at all participating Web sites.</span></span>

<span data-ttu-id="383f4-111">WinHTTP assure la prise en charge de la plateforme pour Microsoft Passport 1,4 en implémentant le protocole côté client pour l’authentification Passport 1,4.</span><span class="sxs-lookup"><span data-stu-id="383f4-111">WinHTTP provides platform support for Microsoft Passport 1.4 by implementing the client-side protocol for Passport 1.4 authentication.</span></span> <span data-ttu-id="383f4-112">Il libère les applications des détails de l’interaction avec l’infrastructure Passport et des noms d’utilisateurs et mots de passe stockés dans Windows XP.</span><span class="sxs-lookup"><span data-stu-id="383f4-112">It frees applications from the details of interacting with the Passport infrastructure and the Stored User Names and Passwords in Windows XP.</span></span> <span data-ttu-id="383f4-113">Cette abstraction utilise Passport, et non pas du point de vue d’un développeur, que les schémas d’authentification traditionnels comme Basic ou Digest.</span><span class="sxs-lookup"><span data-stu-id="383f4-113">This abstraction makes using Passport no different from a developer's perspective than using traditional authentication schemes like Basic or Digest.</span></span>

<span data-ttu-id="383f4-114">**Windows XP :** La clé de Registre **\\ Passport NumRegistrationRuns du logiciel HKCU \\ Microsoft \\ Windows \\ CurrentVersion \\ Internet \\ \\** identifie le nombre de fois où l’Assistant authentification Passport s’affiche lorsque l’authentification Passport est requise.</span><span class="sxs-lookup"><span data-stu-id="383f4-114">**Windows XP:** The **HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Passport\\NumRegistrationRuns** registry key identifies the number of times the Passport Authentication Wizard is displayed when PassPort authentication is required.</span></span> <span data-ttu-id="383f4-115">Si la valeur de cette clé est définie sur un nombre supérieur à 5, l’Assistant n’est pas affiché.</span><span class="sxs-lookup"><span data-stu-id="383f4-115">If the value for this key is set to a number greater than 5, the wizard is not displayed.</span></span>

<span data-ttu-id="383f4-116">Les sections suivantes décrivent les transactions impliquées dans l’authentification Passport du point de vue d’une application cliente.</span><span class="sxs-lookup"><span data-stu-id="383f4-116">The following sections describe the transactions involved in Passport authentication from the point of view of a client application.</span></span> <span data-ttu-id="383f4-117">Pour le développement Passport côté serveur, consultez la présentation de la documentation du kit de développement logiciel (SDK) Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-117">For server-side Passport development, see the Passport SDK Documentation Overview.</span></span>

-   [<span data-ttu-id="383f4-118">Requête initiale</span><span class="sxs-lookup"><span data-stu-id="383f4-118">Initial Request</span></span>](#initial-request)
-   [<span data-ttu-id="383f4-119">Serveur de connexion Passport</span><span class="sxs-lookup"><span data-stu-id="383f4-119">Passport Login Server</span></span>](#passport-login-server)
-   [<span data-ttu-id="383f4-120">Demande authentifiée</span><span class="sxs-lookup"><span data-stu-id="383f4-120">Authenticated Request</span></span>](#authenticated-request)

### <a name="initial-request"></a><span data-ttu-id="383f4-121">Requête initiale</span><span class="sxs-lookup"><span data-stu-id="383f4-121">Initial Request</span></span>

<span data-ttu-id="383f4-122">Lorsqu’un client demande une ressource sur un serveur qui requiert l’authentification Passport, le serveur vérifie la présence de [*tickets*](glossary.md)dans la demande.</span><span class="sxs-lookup"><span data-stu-id="383f4-122">When a client requests a resource on a server that requires Passport authentication, the server checks the request for the presence of [*tickets*](glossary.md).</span></span> <span data-ttu-id="383f4-123">Si un *ticket* valide est envoyé avec la demande, le serveur répond avec la ressource demandée.</span><span class="sxs-lookup"><span data-stu-id="383f4-123">If a valid *ticket* is sent with the request, the server responds with the requested resource.</span></span> <span data-ttu-id="383f4-124">Si le *ticket* n’existe pas sur le client, le serveur répond avec un code d’État 302.</span><span class="sxs-lookup"><span data-stu-id="383f4-124">If the *ticket* does not exist on the client, the server responds with a 302 status code.</span></span> <span data-ttu-id="383f4-125">La réponse comprend l’en-tête Challenge, « WWW-Authenticate : Passport 1.4 ».</span><span class="sxs-lookup"><span data-stu-id="383f4-125">The response includes the challenge header, "WWW-Authenticate: Passport1.4".</span></span> <span data-ttu-id="383f4-126">Les clients qui n’utilisent pas Passport peuvent suivre la redirection vers le serveur de connexion Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-126">Clients that are not using Passport can follow the redirection to the Passport login server.</span></span> <span data-ttu-id="383f4-127">Les clients plus avancés contactent généralement le contact Passport pour déterminer l’emplacement du serveur de connexion Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-127">More advanced clients typically contact the Passport nexus to determine the location of the Passport login server.</span></span>

> [!Note]  
> <span data-ttu-id="383f4-128">Le point central du réseau Microsoft Passport est la *connexion Passport,* qui facilite la synchronisation des sites des participants Passport pour s’assurer que chaque site dispose des informations les plus récentes sur la configuration du réseau et d’autres problèmes.</span><span class="sxs-lookup"><span data-stu-id="383f4-128">Central to the Microsoft Passport network is the Passport *Nexus*, which facilitates synchronization of Passport participant sites to assure that each site has the latest details on network configuration and other issues.</span></span> <span data-ttu-id="383f4-129">Chaque composant Passport (gestionnaire Passport, serveurs de connexion, serveurs de mise à jour, etc.) communique régulièrement avec la connexion pour récupérer les informations dont il a besoin pour localiser et communiquer correctement avec les autres composants du réseau Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-129">Each Passport component (Passport Manager, Login servers, Update servers, and so on) periodically communicates with the Nexus to retrieve the information it needs to locate, and properly communicate with, the other components in the Passport network.</span></span> <span data-ttu-id="383f4-130">Ces informations sont récupérées sous la forme d’un document XML appelé document de configuration de composant ou CCD.</span><span class="sxs-lookup"><span data-stu-id="383f4-130">This information is retrieved as an XML document called a Component Configuration Document, or CCD.</span></span>

 

<span data-ttu-id="383f4-131">L’illustration suivante montre la demande initiale à une filiale Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-131">The following image shows the initial request to a Passport affiliate.</span></span>

![image affiche la demande initiale à une filiale Passport.](images/art-passport1.png)

### <a name="passport-login-server"></a><span data-ttu-id="383f4-133">Serveur de connexion Passport</span><span class="sxs-lookup"><span data-stu-id="383f4-133">Passport Login Server</span></span>

<span data-ttu-id="383f4-134">Un serveur de connexion Passport gère toutes les demandes de [*tickets*](glossary.md) pour toutes les ressources d’une *autorité de domaine* Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-134">A Passport login server handles all requests for [*tickets*](glossary.md) for any resource in a Passport *domain authority*.</span></span> <span data-ttu-id="383f4-135">Avant qu’une demande puisse être authentifiée à l’aide de Passport, l’application cliente doit contacter le serveur de connexion pour obtenir les *tickets* appropriés.</span><span class="sxs-lookup"><span data-stu-id="383f4-135">Before a request can be authenticated using Passport, the client application must contact the login server to obtain the appropriate *tickets*.</span></span>

<span data-ttu-id="383f4-136">Lorsqu’un client demande des [*tickets*](glossary.md) à partir d’un serveur de connexion Passport, le serveur de connexion répond généralement avec un code d’état 401 pour indiquer que les informations d’identification de l’utilisateur doivent être fournies.</span><span class="sxs-lookup"><span data-stu-id="383f4-136">When a client requests [*tickets*](glossary.md) from a Passport login server, the login server typically responds with a 401 status code to indicate that user credentials must be provided.</span></span> <span data-ttu-id="383f4-137">Lorsque ces informations d’identification sont fournies, le serveur de connexion répond avec les *tickets* requis pour accéder à la ressource spécifiée sur le serveur qui contient la ressource initialement demandée.</span><span class="sxs-lookup"><span data-stu-id="383f4-137">When these credentials are provided, the login server responds with the *tickets* required to access the specified resource on the server that contains the originally requested resource.</span></span> <span data-ttu-id="383f4-138">Le serveur de connexion peut également rediriger le client vers un autre serveur qui peut fournir la ressource demandée.</span><span class="sxs-lookup"><span data-stu-id="383f4-138">The login server can also redirect the client to another server that can provide the requested resource.</span></span>

![image montre une demande de ticket client à un serveur de connexion Passport.](images/art-passport2.png)

### <a name="authenticated-request"></a><span data-ttu-id="383f4-140">Demande authentifiée</span><span class="sxs-lookup"><span data-stu-id="383f4-140">Authenticated Request</span></span>

<span data-ttu-id="383f4-141">Lorsque le client a les [*tickets*](glossary.md) qui correspondent à un serveur donné, ces *tickets* sont inclus avec toutes les demandes adressées à ce serveur.</span><span class="sxs-lookup"><span data-stu-id="383f4-141">When the client has the [*tickets*](glossary.md) that correspond to a given server, those *tickets* are included with all requests to that server.</span></span> <span data-ttu-id="383f4-142">Si les *tickets* n’ont pas été modifiés depuis qu’ils ont été récupérés à partir du serveur de connexion Passport et que les *tickets* sont valides pour le serveur de ressources, le serveur de ressources envoie une réponse qui comprend à la fois la ressource demandée et les cookies indiquant que l’utilisateur est authentifié pour les demandes ultérieures.</span><span class="sxs-lookup"><span data-stu-id="383f4-142">If the *tickets* have not been modified since they were retrieved from the Passport login server, and the *tickets* are valid for the resource server, the resource server sends a response that includes both the requested resource and cookies that indicate that the user is authenticated for future requests.</span></span>

<span data-ttu-id="383f4-143">Les cookies supplémentaires dans la réponse sont destinés à accélérer le processus d’authentification.</span><span class="sxs-lookup"><span data-stu-id="383f4-143">The additional cookies in the response are intended to speed the authentication process.</span></span> <span data-ttu-id="383f4-144">Les demandes supplémentaires dans la même session pour les ressources sur les serveurs dans la même autorité de domaine Passport incluent toutes ces cookies supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="383f4-144">Additional requests in the same session for resources on servers in the same Passport Domain Authority all include these additional cookies.</span></span> <span data-ttu-id="383f4-145">Les informations d’identification n’ont pas besoin d’être envoyées à nouveau au serveur de connexion tant que les cookies n’ont pas expiré.</span><span class="sxs-lookup"><span data-stu-id="383f4-145">Credentials do not need to be sent to the login server again until the cookies expire.</span></span>

![image affiche une demande authentifiée auprès du serveur de connexion Passport.](images/art-passport3.png)

## <a name="using-passport-in-winhttp"></a><span data-ttu-id="383f4-147">Utilisation de Passport dans WinHTTP</span><span class="sxs-lookup"><span data-stu-id="383f4-147">Using Passport in WinHTTP</span></span>

<span data-ttu-id="383f4-148">L’authentification Passport dans WinHTTP est très similaire à d’autres schémas d’authentification.</span><span class="sxs-lookup"><span data-stu-id="383f4-148">Passport authentication in WinHTTP is very similar to other authentication schemes.</span></span> <span data-ttu-id="383f4-149">Consultez [authentification dans WinHTTP](authentication-in-winhttp.md) pour obtenir une vue d’ensemble de l’authentification dans WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="383f4-149">See [Authentication in WinHTTP](authentication-in-winhttp.md) for an overview of authentication in WinHTTP.</span></span>

<span data-ttu-id="383f4-150">Dans WinHTTP 5,1, l’authentification Passport est désactivée par défaut et doit être explicitement activée avec [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) avant son utilisation.</span><span class="sxs-lookup"><span data-stu-id="383f4-150">In WinHTTP 5.1, Passport authentication is disabled by default and must be explicitly enabled with [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) before use.</span></span>

<span data-ttu-id="383f4-151">WinHTTP gère un grand nombre des détails de la transaction en interne pour l’authentification Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-151">WinHTTP handles many of the transaction details internally for Passport authentication.</span></span> <span data-ttu-id="383f4-152">Pendant la demande initiale, le serveur répond avec un code d’État 302 lorsque l’authentification est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="383f4-152">During the initial request, the server responds with a 302 status code when authentication is necessary.</span></span> <span data-ttu-id="383f4-153">Le code d’État 302 indique en fait une redirection et fait partie du protocole Passport pour la compatibilité descendante.</span><span class="sxs-lookup"><span data-stu-id="383f4-153">The 302 status code actually indicates a redirection and is part of the Passport protocol for backwards compatibility.</span></span> <span data-ttu-id="383f4-154">WinHTTP masque le code d’État 302 et contacte le contact Passport, puis le serveur de connexion.</span><span class="sxs-lookup"><span data-stu-id="383f4-154">WinHTTP hides the 302 status code and contacts the Passport nexus, and then the login server.</span></span> <span data-ttu-id="383f4-155">L’application WinHTTP est informée du code d’état 401 envoyé par le serveur de connexion pour demander les informations d’identification de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="383f4-155">The WinHTTP application is notified of the 401 status code sent by the login server to request user credentials.</span></span> <span data-ttu-id="383f4-156">Toutefois, pour l’application, elle apparaît comme si l’état 401 provient du serveur à partir duquel la ressource a été demandée.</span><span class="sxs-lookup"><span data-stu-id="383f4-156">To the application, however, it appears as if the 401 status originates from the server from which the resource was requested.</span></span> <span data-ttu-id="383f4-157">De cette façon, l’application WinHTTP ignore les interactions avec d’autres serveurs, et elle peut gérer l’authentification Passport avec le même code qui gère d’autres schémas d’authentification.</span><span class="sxs-lookup"><span data-stu-id="383f4-157">In this way, the WinHTTP application is unaware of interactions with other servers, and it can handle Passport authentication with the same code that handles other authentication schemes.</span></span>

<span data-ttu-id="383f4-158">En règle générale, une application WinHTTP répond à un code d’état 401 en fournissant les informations d’identification d’authentification.</span><span class="sxs-lookup"><span data-stu-id="383f4-158">Typically, a WinHTTP application responds to a 401 status code by supplying authentication credentials.</span></span> <span data-ttu-id="383f4-159">Lorsque les informations d’identification sont fournies avec [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) ou [**SetCredentials**](iwinhttprequest-setcredentials.md) pour l’authentification Passport, les informations d’identification sont envoyées au serveur de connexion, et non au serveur indiqué dans la demande.</span><span class="sxs-lookup"><span data-stu-id="383f4-159">When credentials are supplied with [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) or [**SetCredentials**](iwinhttprequest-setcredentials.md) for passport authentication, the credentials are actually being sent to the login server, not to the server indicated in the request.</span></span>

<span data-ttu-id="383f4-160">Toutefois, lors de la réponse à un code d’État 407, une application WinHTTP doit utiliser [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) pour fournir les informations d’identification du proxy, plutôt que [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span><span class="sxs-lookup"><span data-stu-id="383f4-160">However, when responding to a 407 status code, a WinHTTP application must use [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) to provide proxy credentials, rather than [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span></span> <span data-ttu-id="383f4-161">Dans la mesure où **WinHttpSetOption** est un moyen moins sûr de fournir des informations d’identification, il doit normalement être évité.</span><span class="sxs-lookup"><span data-stu-id="383f4-161">Because **WinHttpSetOption** is a less secure way to supply credentials, it should normally be avoided.</span></span>

<span data-ttu-id="383f4-162">Une fois récupérés, les [*tickets*](glossary.md) sont gérés en interne et sont automatiquement envoyés aux serveurs applicables dans les demandes ultérieures.</span><span class="sxs-lookup"><span data-stu-id="383f4-162">Once retrieved, [*tickets*](glossary.md) are managed internally and are automatically sent to applicable servers in future requests.</span></span>

> [!Note]  
> <span data-ttu-id="383f4-163">WinHTTP vous permet de désactiver la redirection automatique en appelant la fonction [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) pour l' [**\_ option WinHTTP \_ désactiver \_**](option-flags.md) l’indicateur de fonctionnalité et en spécifiant la valeur [**WinHTTP \_ Désactiver les \_ redirections**](option-flags.md).</span><span class="sxs-lookup"><span data-stu-id="383f4-163">WinHTTP enables you to disable automatic redirection by calling the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function for the [**WINHTTP\_OPTION\_DISABLE\_FEATURE**](option-flags.md) flag and specifying a value of [**WINHTTP\_DISABLE\_REDIRECTS**](option-flags.md).</span></span> <span data-ttu-id="383f4-164">La désactivation de la redirection n’interfère pas avec la redirection que WinHTTP gère en interne pour les transactions Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-164">Disabling redirection does not interfere with the redirection that WinHTTP handles internally for Passport transactions.</span></span>

 

<span data-ttu-id="383f4-165">WinHTTP peut terminer avec succès l’authentification Passport même si une application désactive la redirection automatique.</span><span class="sxs-lookup"><span data-stu-id="383f4-165">WinHTTP can successfully complete the Passport authentication even if an application disables auto redirection.</span></span> <span data-ttu-id="383f4-166">Toutefois, une fois l’authentification Passport terminée, une redirection implicite doit se produire à partir de l’URL du serveur de connexion Passport vers l’URL d’origine.</span><span class="sxs-lookup"><span data-stu-id="383f4-166">However, after the Passport authentication is complete, an implicit redirect must occur from the Passport login server URL back to the original URL.</span></span> <span data-ttu-id="383f4-167">Cette redirection n’est pas déclenchée par une réponse HTTP 302, mais est implicite dans le protocole Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-167">This redirect is not triggered by a 302 HTTP response, but is implicit in the Passport protocol.</span></span>

<span data-ttu-id="383f4-168">WinHTTP gère cette redirection implicite.</span><span class="sxs-lookup"><span data-stu-id="383f4-168">WinHTTP handles this implicit redirect specially.</span></span> <span data-ttu-id="383f4-169">Si une application a désactivé la redirection automatique, WinHTTP exige que l’application donne une « autorisation » à la fonction WinHTTP à rediriger automatiquement dans ce cas particulier.</span><span class="sxs-lookup"><span data-stu-id="383f4-169">If an application has disabled automatic redirection, WinHTTP requires that the application give WinHTTP "permission" to redirect automatically in this special case.</span></span>

<span data-ttu-id="383f4-170">Pour que WinHTTP redirige vers l’URL d’origine après l’authentification, l’application doit inscrire une fonction de rappel à l’aide de [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback).</span><span class="sxs-lookup"><span data-stu-id="383f4-170">In order to have WinHTTP redirect back to the original URL after authentication, the application must register a callback function using [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback).</span></span> <span data-ttu-id="383f4-171">WinHTTP peut ensuite notifier l’application avec un \_ rappel de REdirection de l’état de rappel WinHTTP \_ , ce \_ qui permet à l’application d’annuler la redirection.</span><span class="sxs-lookup"><span data-stu-id="383f4-171">WinHTTP can then notify the application with a WINHTTP\_CALLBACK\_STATUS\_REDIRECT callback, which allows the application to cancel the redirect.</span></span> <span data-ttu-id="383f4-172">Une application n’a pas besoin de fournir des fonctionnalités dans la fonction de rappel ; l’inscription du rappel est suffisante pour permettre à WinHTTP de suivre cette redirection de cas spéciaux.</span><span class="sxs-lookup"><span data-stu-id="383f4-172">An application does not need to provide any functionality in the callback function; registration of the callback is sufficient to enable WinHTTP to follow this special-case redirect.</span></span>

<span data-ttu-id="383f4-173">Le message d’échec de connexion WinHTTP de l’erreur \_ \_ \_ est généré si aucune fonction de rappel n’est définie par l’application.</span><span class="sxs-lookup"><span data-stu-id="383f4-173">The ERROR\_WINHTTP\_LOGIN\_FAILURE message is generated if a callback function is not set by the application.</span></span>

### <a name="passport-cobranding"></a><span data-ttu-id="383f4-174">Comarketing Passport</span><span class="sxs-lookup"><span data-stu-id="383f4-174">Passport Cobranding</span></span>

<span data-ttu-id="383f4-175">Contrairement aux schémas d’authentification traditionnels pris en charge par WinHTTP, Passport peut être largement [*développé.*](glossary.md)</span><span class="sxs-lookup"><span data-stu-id="383f4-175">Unlike traditional authentication schemes supported by WinHTTP, Passport can be extensively [*cobranded*](glossary.md).</span></span> <span data-ttu-id="383f4-176">Lors de la réception d’un code d’état 401 qui indique un défi, une application peut récupérer le graphique et le texte de la *comarketing* .</span><span class="sxs-lookup"><span data-stu-id="383f4-176">Upon receiving a 401 status code that indicates a challenge, an application can retrieve the *cobranding* graphic and text.</span></span> <span data-ttu-id="383f4-177">Récupérez une URL pour le graphique de *comarquage* en appelant [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) avec l' \_ option WinHTTP indicateur d’URL de \_ \_ comarketing Passport \_ .</span><span class="sxs-lookup"><span data-stu-id="383f4-177">Retrieve a URL for the *cobranding* graphic by calling [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) with the WINHTTP\_OPTION\_PASSPORT\_COBRANDING\_URL flag.</span></span> <span data-ttu-id="383f4-178">Récupérez le texte de la *comarque* en appelant [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) avec l' \_ option WinHTTP indicateur de \_ \_ texte comarque Passport \_ .</span><span class="sxs-lookup"><span data-stu-id="383f4-178">Retrieve the *cobranding* text by calling [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) with the WINHTTP\_OPTION\_PASSPORT\_COBRANDING\_TEXT flag.</span></span> <span data-ttu-id="383f4-179">Ces éléments peuvent être utilisés pour personnaliser une boîte de dialogue de collecte des informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="383f4-179">These items can be used to customize a credential-gathering dialog.</span></span>

### <a name="stored-user-names-and-passwords"></a><span data-ttu-id="383f4-180">Noms d’utilisateur et mots de passe stockés</span><span class="sxs-lookup"><span data-stu-id="383f4-180">Stored User Names and Passwords</span></span>

<span data-ttu-id="383f4-181">Windows XP a introduit le concept de noms d’utilisateurs et de mots de passe stockés.</span><span class="sxs-lookup"><span data-stu-id="383f4-181">Windows XP introduced the concept of Stored User Names and Passwords.</span></span> <span data-ttu-id="383f4-182">Si les informations d’identification Passport d’un utilisateur sont enregistrées via l' **Assistant Inscription Passport** ou la **boîte de dialogue informations d’identification** standard, elles sont enregistrées dans les noms d’utilisateur et mots de passe stockés.</span><span class="sxs-lookup"><span data-stu-id="383f4-182">If a user's Passport credentials are saved through the **Passport Registration Wizard** or the standard **Credential Dialog**, it is saved in the Stored User Names and Passwords.</span></span> <span data-ttu-id="383f4-183">Quand vous utilisez WinHTTP sur Windows XP ou version ultérieure, WinHTTP utilise automatiquement les informations d’identification dans les noms d’utilisateurs et les mots de passe stockés si les informations d’identification ne sont pas définies explicitement.</span><span class="sxs-lookup"><span data-stu-id="383f4-183">When using WinHTTP on Windows XP or later, WinHTTP automatically uses the credentials in the Stored User Names and Passwords if credentials are not explicitly set.</span></span> <span data-ttu-id="383f4-184">Cela est similaire à la prise en charge des informations d’identification d’ouverture de session par défaut pour NTLM/Kerberos.</span><span class="sxs-lookup"><span data-stu-id="383f4-184">This is similar to the support of default logon credentials for NTLM/Kerberos.</span></span> <span data-ttu-id="383f4-185">Toutefois, l’utilisation des informations d’identification Passport par défaut n’est pas soumise aux paramètres de stratégie d’ouverture de session automatique.</span><span class="sxs-lookup"><span data-stu-id="383f4-185">However, use of default Passport credentials is not subject to the automatic logon policy settings.</span></span>

### <a name="disabling-passport-authentication"></a><span data-ttu-id="383f4-186">Désactivation de l’authentification Passport</span><span class="sxs-lookup"><span data-stu-id="383f4-186">Disabling Passport Authentication</span></span>

<span data-ttu-id="383f4-187">Certaines applications peuvent nécessiter la possibilité de désactiver l’authentification Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-187">Some applications might require the ability to disable Passport authentication.</span></span> <span data-ttu-id="383f4-188">Par exemple, lorsqu’une filiale Passport répond avec le code d’état initial 302, il peut être préférable de suivre la redirection indiquée et d’afficher la page d’authentification Passport HTML plutôt que d’autoriser WinHTTP à gérer l’authentification en interne.</span><span class="sxs-lookup"><span data-stu-id="383f4-188">For example, when a Passport affiliate responds with the initial 302 status code, it might be preferable to follow the indicated redirection and render the HTML Passport authentication page rather than allowing WinHTTP to handle the authentication internally.</span></span> <span data-ttu-id="383f4-189">L’authentification Passport est désactivée dans WinHTTP en appelant la fonction [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) avec l’option WinHTTP \_ configurer l' \_ \_ \_ authentification Passport et en passant la valeur WinHTTP \_ désactiver l' \_ \_ authentification Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-189">Passport authentication is disabled in WinHTTP by calling the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function with the WINHTTP\_OPTION\_CONFIGURE\_PASSPORT\_AUTH option and passing the value WINHTTP\_DISABLE\_PASSPORT\_AUTH.</span></span> <span data-ttu-id="383f4-190">Vous pouvez ensuite la réactiver avec WINHTTP \_ activer \_ l' \_ authentification Passport.</span><span class="sxs-lookup"><span data-stu-id="383f4-190">It can later be re-enabled with WINHTTP\_ENABLE\_PASSPORT\_AUTH.</span></span>

<span data-ttu-id="383f4-191">L’authentification Passport ne peut pas être désactivée lors de l’utilisation de l’objet [**WinHttpRequest**](winhttprequest.md) .</span><span class="sxs-lookup"><span data-stu-id="383f4-191">Passport authentication cannot be disabled when using the [**WinHttpRequest**](winhttprequest.md) object.</span></span>

<span data-ttu-id="383f4-192">Comme indiqué plus haut dans cette section, l’authentification Passport est désactivée par défaut dans WinHTTP 5,1 et doit être explicitement activée avec [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) avant son utilisation.</span><span class="sxs-lookup"><span data-stu-id="383f4-192">As noted earlier in this section, Passport authentication is disabled by default in WinHTTP 5.1, and must be explicitly enabled with [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) before use.</span></span>

## <a name="passport-configuration-overrides-used-for-testing"></a><span data-ttu-id="383f4-193">Remplacements de la configuration Passport utilisés pour le test</span><span class="sxs-lookup"><span data-stu-id="383f4-193">Passport Configuration Overrides Used for Testing</span></span>

<span data-ttu-id="383f4-194">WinHTTP s’appuie sur les informations de configuration qu’il télécharge à partir du serveur de transfert Passport pour prendre en charge l’authentification Passport 1,4.</span><span class="sxs-lookup"><span data-stu-id="383f4-194">WinHTTP relies on the configuration information it downloads from the passport nexus server to support Passport 1.4 authentication.</span></span> <span data-ttu-id="383f4-195">Par défaut, ce serveur sécurisé (SSL) est nexus.passport.com et la ressource de configuration est RDR/pprdr. asp, qui est appelée configuration de Passport « en direct ».</span><span class="sxs-lookup"><span data-stu-id="383f4-195">By default this secure (SSL) server is nexus.passport.com, and the configuration resource is rdr/pprdr.asp, which is known as the "live" passport configuration.</span></span> <span data-ttu-id="383f4-196">Le format des informations est un en-tête HTTP personnalisé « PassportURLs », suivi de paires attribut-valeur séparées par des virgules.</span><span class="sxs-lookup"><span data-stu-id="383f4-196">The format of the information is a custom HTTP header "PassportURLs", followed by comma delimited attribute-value pairs.</span></span>

<span data-ttu-id="383f4-197">Par exemple, « https://nexus.passport.com/rdr/pprdr.asp » retourne les informations de configuration suivantes :</span><span class="sxs-lookup"><span data-stu-id="383f4-197">For example, "https://nexus.passport.com/rdr/pprdr.asp" returns the following configuration information:</span></span>

``` syntax
PassportURLs: DARealm=Passport.net,
DALogin=login.passport.com/login2.asp,
DAReg=https://register.passport.com/defaultwiz.asp,
Properties=https://memberservices.passport.com/ppsecure/MSRV_EditProfile.asp,
Privacy=https://www.passport.com/consumer/privacypolicy.asp,
GeneralRedir=https://nexusrdr.passport.com/redir.asp,
Help=https://memberservices.passport.com/UI/MSRV_UI_Help.asp,
ConfigVersion=2
\r\n
```

<span data-ttu-id="383f4-198">Les parties qui sont pertinentes pour WinHTTP sont DARealm, DALogin et ConfigVersion.</span><span class="sxs-lookup"><span data-stu-id="383f4-198">The parts that are relevant to WinHTTP are DARealm, DALogin, and ConfigVersion.</span></span> <span data-ttu-id="383f4-199">Pour des raisons de performances, elles sont mises en cache pendant la durée de vie d’une session WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="383f4-199">For performance reasons, they are cached for the lifetime of a WinHTTP session.</span></span> <span data-ttu-id="383f4-200">Ces trois valeurs peuvent être remplacées par les applications qui sont requises pour fonctionner avec une autre infrastructure Passport autre que la configuration de production « en direct » en modifiant les paramètres de registre appropriés sous</span><span class="sxs-lookup"><span data-stu-id="383f4-200">These three values can be overridden by applications that are required to work with another passport infrastructure other than the "live" production setup by changing the appropriate registry settings under</span></span>

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Microsoft
         Windows
            CurrentVersion
               Internet Settings
                  WinHttp
                     Passport Test
```

``` syntax
LoginServerRealm (REG_SZ)    For example: abc.net
LoginServerUrl (REG_SZ)      For example: https://private-login.passport.com/login2.asp
ConfigVersion (REG_DWORD)    For example: 10
```

<span data-ttu-id="383f4-201">Si LoginServerUrl est présent dans le registre, WinHTTP ne contacte pas le serveur de communication pour d’autres valeurs de configuration.</span><span class="sxs-lookup"><span data-stu-id="383f4-201">If LoginServerUrl is present in the registry, WinHTTP does not contact the nexus server for other configuration values.</span></span> <span data-ttu-id="383f4-202">Dans ce cas, LoginServerRealm et ConfigVersion doivent également être définis dans le registre pour corriger les valeurs.</span><span class="sxs-lookup"><span data-stu-id="383f4-202">In this case, LoginServerRealm and ConfigVersion should also be set through the registry to correct values.</span></span>

<span data-ttu-id="383f4-203">Une application peut, à des fins de test, être requise pour télécharger la configuration de Passport à partir d’un serveur de transfert privé.</span><span class="sxs-lookup"><span data-stu-id="383f4-203">An application may, for testing purposes, be required to download passport configuration from a private nexus server.</span></span> <span data-ttu-id="383f4-204">Pour ce faire, vous pouvez substituer deux valeurs de Registre sous</span><span class="sxs-lookup"><span data-stu-id="383f4-204">This can be done by overriding two registry values under</span></span>

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Microsoft
         Windows
            CurrentVersion
               Internet Settings
                  WinHttp
                     Passport Test
```

``` syntax
NexusHost (REG_SZ)    e.g. private-nexus.passport.com
NexusObj(REG_SZ)      e.g. config/passport.asp
```

## <a name="related-topics"></a><span data-ttu-id="383f4-205">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="383f4-205">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="383f4-206">Authentification dans WinHTTP</span><span class="sxs-lookup"><span data-stu-id="383f4-206">Authentication in WinHTTP</span></span>](authentication-in-winhttp.md)
</dt> </dl>

 

 



