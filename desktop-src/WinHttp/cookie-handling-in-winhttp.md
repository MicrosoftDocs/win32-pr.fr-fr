---
description: Gestion des cookies dans WinHTTP
ms.assetid: ef0f0847-05f6-4477-8e48-e0bea66314ab
title: Gestion des cookies dans WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8e3b596225dc3c741ab9ed0139a63e343e7afb3d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106539349"
---
# <a name="cookie-handling-in-winhttp"></a><span data-ttu-id="5eb7e-103">Gestion des cookies dans WinHTTP</span><span class="sxs-lookup"><span data-stu-id="5eb7e-103">Cookie Handling in WinHTTP</span></span>

<span data-ttu-id="5eb7e-104">Les données de session HTTP sont transmises entre le client et le serveur dans l’en-tête de cookie de la demande ou de la réponse.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-104">HTTP session data is passed between the client and server in the cookie header of the request or the response.</span></span> <span data-ttu-id="5eb7e-105">Le serveur envoie des cookies au client dans l’en-tête Set-Cookie de la réponse et l’API WinHTTP renvoie le cookie de serveur au serveur dans l’en-tête du cookie de la demande.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-105">The server sends cookies to the client in the Set-cookie header of the response and the WinHTTP API resends the server cookie to the server in the cookie header of the request.</span></span> <span data-ttu-id="5eb7e-106">Les spécifications de gestion des cookies, décrites dans le document RFC 2109 (mécanisme de gestion d’état HTTP), sont implémentées par défaut dans WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-106">The cookie handling specifications, described in rfc 2109 (HTTP State Management Mechanism), are implemented by default in WinHTTP.</span></span> <span data-ttu-id="5eb7e-107">Les spécifications de gestion des cookies récentes, décrites dans le document RFC 2964, ne sont pas prises en charge par WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-107">Recent cookie handling specifications, described in rfc 2964, are not supported by WinHTTP.</span></span>

<span data-ttu-id="5eb7e-108">WinHTTP obtient le cookie de l’en-tête serveurs Set-Cookie et le stocke dans un cache pour chaque session.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-108">WinHTTP obtains the cookie from the servers Set-Cookie header and stores it in a cache on a per-session basis.</span></span> <span data-ttu-id="5eb7e-109">Ce cookie est renvoyé sur les demandes suivantes dans la même session WinHTTP où la cible correspond à la source du cookie.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-109">This cookie is resent on subsequent requests in the same WinHTTP session where the target matches the source of the cookie.</span></span> <span data-ttu-id="5eb7e-110">L’API WinHTTP régénère l’en-tête du cookie de la demande pour chaque tronçon de la demande.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-110">The WinHTTP API regenerates the request cookie header for each leg in the request.</span></span>

<span data-ttu-id="5eb7e-111">La liste suivante décrit plusieurs options que les applications clientes WinHTTP peuvent utiliser pour gérer les cookies :</span><span class="sxs-lookup"><span data-stu-id="5eb7e-111">The follow list describes several options that WinHTTP client applications can use to handle cookies:</span></span>

-   <span data-ttu-id="5eb7e-112">Gestion automatique des cookies : WinHTTP gère automatiquement les cookies et l’application cliente n’effectue aucune gestion personnalisée des cookies.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-112">Automatic Cookie Handling - WinHTTP automatically handles cookies and the client application performs no custom cookie handling.</span></span>
-   <span data-ttu-id="5eb7e-113">Désactiver la gestion automatique des cookies : la gestion automatique des cookies dans l’API WinHTTP est désactivée et aucun cookie n’est envoyé.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-113">Disable Automatic Cookie Handling - Automatic cookie handling in the WinHTTP API is disabled and no cookies are sent.</span></span>
-   <span data-ttu-id="5eb7e-114">Spécifier manuellement tous les cookies : la gestion automatique des cookies est désactivée et l’application cliente ajoute ou supprime tous les en-têtes de cookies pour chaque demande de la session.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-114">Manually specify all Cookies – Automatic cookie handling is disabled and the client application adds or removes all cookie headers for each request in the session.</span></span>
-   <span data-ttu-id="5eb7e-115">Gestion manuelle et automatique des cookies : combine la gestion automatique et manuelle des cookies.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-115">Manual and Automatic Cookie Handling - Combine automatic and manual cookie handling.</span></span>

## <a name="disabling-automatic-cookie-handling"></a><span data-ttu-id="5eb7e-116">Désactivation de la gestion automatique des cookies</span><span class="sxs-lookup"><span data-stu-id="5eb7e-116">Disabling Automatic Cookie Handling</span></span>

<span data-ttu-id="5eb7e-117">Pour désactiver la gestion des cookies, l’application cliente WinHTTP appelle la fonction [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) avec le paramètre *valeur dwOption* défini sur la \_ fonctionnalité de désactivation de l’option WinHTTP \_ \_ et le paramètre *lpBuffer* défini sur WinHTTP \_ désactiver \_ les cookies.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-117">To disable cookie handling, the WinHTTP client application calls the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function with the *dwOption* parameter set to WINHTTP\_OPTION\_DISABLE\_FEATURE, and the *lpBuffer* parameter set to WINHTTP\_DISABLE\_COOKIES.</span></span> <span data-ttu-id="5eb7e-118">Le paramètre *hInternet* peut être un handle de session ou un handle de demande.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-118">The *hInternet* parameter can be either a session handle or a request handle.</span></span> <span data-ttu-id="5eb7e-119">Lorsque la gestion des cookies est désactivée sur un handle de demande qui a envoyé une demande précédente, le client doit supprimer manuellement les en-têtes de cookie de requête existants avec la fonction [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) avant d’envoyer la requête suivante.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-119">When cookie handling is disabled on a request handle that has sent a previous request, the client should manually remove existing request cookie headers with the [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) function before sending the next request.</span></span> <span data-ttu-id="5eb7e-120">Pour plus d’informations, consultez [Suppression d’en-têtes de cookies](#removing-cookie-headers).</span><span class="sxs-lookup"><span data-stu-id="5eb7e-120">For more information, see [Removing Cookie Headers](#removing-cookie-headers).</span></span>

<span data-ttu-id="5eb7e-121">**Remarque**  L’application cliente doit définir tous les cookies de la session après la désactivation du mode automatique.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-121">**Note**  The client application must set all cookies on the session after automatic mode has been disabled.</span></span>

## <a name="manually-specifying-all-cookies"></a><span data-ttu-id="5eb7e-122">Spécification manuelle de tous les cookies</span><span class="sxs-lookup"><span data-stu-id="5eb7e-122">Manually Specifying All Cookies</span></span>

<span data-ttu-id="5eb7e-123">Lorsque la gestion automatique des cookies est désactivée, l’application cliente WinHTTP a la possibilité de spécifier manuellement tous les cookies.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-123">When automatic cookie handling is disabled, the WinHTTP client application has the option to manually specify all cookies.</span></span> <span data-ttu-id="5eb7e-124">Pour définir manuellement le cookie, l’application appelle [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) en spécifiant l’en-tête de cookie dans le paramètre *pwszHeaders* .</span><span class="sxs-lookup"><span data-stu-id="5eb7e-124">To manually set the cookie, the application calls [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) specifying the cookie header in the *pwszHeaders* parameter.</span></span> <span data-ttu-id="5eb7e-125">L’application cliente doit effacer tous les en-têtes de cookies avant de renvoyer la requête.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-125">The client application should clear all cookie headers before resending the request.</span></span>

<span data-ttu-id="5eb7e-126">L’application cliente doit également modifier l’en-tête du cookie lorsque la requête a été redirigée.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-126">The client application should also change the cookie header when the request has been redirected.</span></span> <span data-ttu-id="5eb7e-127">Pour modifier le cookie sur les demandes redirigées, le client spécifie une fonction de rappel avec [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) qui répond au cas de rappel de redirection.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-127">To change the cookie on redirected requests, the client specifies a callback function with [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) that responds to the redirect callback case.</span></span> <span data-ttu-id="5eb7e-128">Le gestionnaire de rappel doit effacer le cookie précédemment envoyé sur la demande en appelant [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span><span class="sxs-lookup"><span data-stu-id="5eb7e-128">The callback handler should clear the cookie previously sent on the request by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span></span> <span data-ttu-id="5eb7e-129">Pour plus d’informations sur la suppression des en-têtes de cookie, consultez [suppression des en-têtes de cookies](#removing-cookie-headers).</span><span class="sxs-lookup"><span data-stu-id="5eb7e-129">For more information about removing cookie headers, see [Removing Cookie Headers](#removing-cookie-headers).</span></span>

## <a name="manual-and-automatic-cookie-handling"></a><span data-ttu-id="5eb7e-130">Gestion manuelle et automatique des cookies</span><span class="sxs-lookup"><span data-stu-id="5eb7e-130">Manual and Automatic Cookie Handling</span></span>

<span data-ttu-id="5eb7e-131">Les applications clientes WinHTTP peuvent combiner le mécanisme de gestion automatique des cookies WinHTTP avec la gestion manuelle des cookies.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-131">WinHTTP client applications can combine the WinHTTP automatic cookie handling mechanism with manual cookie handling.</span></span> <span data-ttu-id="5eb7e-132">L’application ajoute des cookies personnalisés à l’en-tête de cookie généré automatiquement avant d’envoyer la demande avec la fonction [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) .</span><span class="sxs-lookup"><span data-stu-id="5eb7e-132">The application adds custom cookies to the automatically generated cookie header before sending the request with the [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) function.</span></span> <span data-ttu-id="5eb7e-133">Le cookie personnalisé doit être le premier en-tête de cookie de la demande pour que l’API WinHTTP met correctement en cache le cookie.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-133">The custom cookie should be the first cookie header in the request for the WinHTTP API to properly cache the cookie.</span></span> <span data-ttu-id="5eb7e-134">L’application cliente doit également supprimer les cookies envoyés sur les demandes précédentes avant de renvoyer une demande sur le même handle de demande.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-134">The client application should also remove cookies sent on previous requests before resending a request on the same request handle.</span></span> <span data-ttu-id="5eb7e-135">Pour plus d’informations, consultez Suppression d’en-têtes de cookies.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-135">For more information, see Removing Cookie Headers.</span></span>

<span data-ttu-id="5eb7e-136">Les cookies ajoutés à une demande avant l’appel à [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) sont inclus dans toutes les demandes WinHTTP envoyées pour le compte des appels **WinHttpSendRequest** et [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) suivants.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-136">Cookies added to a request before the call to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) are included in all WinHTTP requests sent on behalf of the next **WinHttpSendRequest** and [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) calls.</span></span> <span data-ttu-id="5eb7e-137">L’application cliente peut avoir besoin de supprimer l’en-tête de cookie lorsque la requête a été redirigée.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-137">The client application may need to clear the cookie header when the request has been redirected.</span></span> <span data-ttu-id="5eb7e-138">Pour effacer le cookie sur les demandes redirigées, le client spécifie une fonction de rappel avec [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) qui répond au cas de rappel de redirection.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-138">To clear the cookie on redirected requests, the client specifies a callback function with [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) that responds to the redirect callback case.</span></span> <span data-ttu-id="5eb7e-139">Le gestionnaire de rappel doit effacer le cookie qui a été précédemment envoyé sur la demande en appelant [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span><span class="sxs-lookup"><span data-stu-id="5eb7e-139">The callback handler should clear the cookie that was previously sent on the request by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span></span> <span data-ttu-id="5eb7e-140">La fonction de rappel ne peut pas définir de nouveaux cookies personnalisés sur le rappel de redirection.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-140">The callback function may not set new custom cookies on the redirect callback.</span></span> <span data-ttu-id="5eb7e-141">Le client doit attendre la fin de **WinHttpReceiveResponse** avant d’ajouter de nouveaux cookies pour l’appel **WinHttpSendRequest** suivant.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-141">The client must wait for **WinHttpReceiveResponse** to complete before adding new cookies for the next **WinHttpSendRequest** call.</span></span>

## <a name="removing-cookie-headers"></a><span data-ttu-id="5eb7e-142">Suppression des en-têtes de cookie</span><span class="sxs-lookup"><span data-stu-id="5eb7e-142">Removing Cookie Headers</span></span>

<span data-ttu-id="5eb7e-143">L’application cliente WinHTTP devra peut-être effacer le cookie de requête existant avant de renvoyer une demande pour empêcher les cookies qui ont été envoyés sur les demandes précédentes d’être renvoyés à nouveau sur la requête actuelle. Pour plus d’informations, consultez la remarque suivante.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-143">The WinHTTP client application may need to clear the existing request cookie before resending a request to prevent cookies that were sent on previous requests from being sent again on the current request; for more information, see the following Note.</span></span> <span data-ttu-id="5eb7e-144">Sachez également que les cookies n’ont pas besoin d’être effacés avant l’envoi de la première requête sur le descripteur de demande.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-144">Also be aware that Cookies do not have to be cleared before the first request is sent on the request handle.</span></span> <span data-ttu-id="5eb7e-145">Le client peut effacer les cookies existants en appelant [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) avec un en-tête de cookie vide dans le paramètre *pwszHeaders* et l' \_ \_ \_ indicateur de remplacement d’indicateur de ADDREQ WinHTTP défini dans le paramètre *dwModifier* .</span><span class="sxs-lookup"><span data-stu-id="5eb7e-145">The client can clear existing cookies by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) with an empty cookie header in the *pwszHeaders* parameter and the WINHTTP\_ADDREQ\_FLAG\_REPLACE flag set in the *dwModifier* parameter.</span></span> <span data-ttu-id="5eb7e-146">L’exemple de code suivant montre comment effacer l’en-tête de cookie de la demande.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-146">The following code example shows how to clear the cookie header on the request.</span></span>

``` syntax
WinHttpAddRequestHeaders( hRequest, 
                          L"Cookie:", 
                          -1, 
                          WINHTTP_ADDREQ_FLAG_REPLACE);
```

<span data-ttu-id="5eb7e-147">L’API WinHTTP présente différents comportements de gestion des cookies pour les versions du système d’exploitation antérieures à Windows XP avec Service Pack 2 (SP2) et Windows Server 2003 avec Service Pack 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="5eb7e-147">The WinHTTP API has different cookie handling behaviors for versions of the operating system earlier than Windows XP with Service Pack 2 (SP2) and Windows Server 2003 with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="5eb7e-148">\* \* Windows XP avec SP2 et versions ultérieures et Windows Server 2003 avec SP1 et versions ultérieures : \* \*</span><span class="sxs-lookup"><span data-stu-id="5eb7e-148">\*\*Windows XP with SP2 and later and Windows Server 2003 with SP1 and later:  \*\*</span></span>

<span data-ttu-id="5eb7e-149">L’API WinHTTP efface tous les cookies envoyés sur les requêtes précédentes pour le handle de demande.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-149">The WinHTTP API clears all cookies sent on previous requests for the request handle.</span></span> <span data-ttu-id="5eb7e-150">Le client peut ajouter manuellement de nouveaux en-têtes de cookie avant chaque appel à WinHttpSendRequest.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-150">The client can manually add new cookie headers before each call to WinHttpSendRequest.</span></span> <span data-ttu-id="5eb7e-151">Si la fonctionnalité de gestion automatique des cookies de l’API WinHTTP n’a pas été désactivée, l’API WinHTTP ajoute le nouvel en-tête de cookie (ou ajoute un nouvel en-tête de cookie si l’application cliente n’en a pas ajouté manuellement) avec le cookie du serveur.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-151">If the automatic cookie handling functionality of the WinHTTP API has not been disabled, the WinHTTP API will append the new cookie header (or add a new cookie header if the client application did not add one manually) with the cookie from the server.</span></span>

<span data-ttu-id="5eb7e-152">\* \* Windows XP avec SP2 et Windows Server 2003 avec SP1 : \* \*</span><span class="sxs-lookup"><span data-stu-id="5eb7e-152">\*\*Windows XP with SP2 and Windows Server 2003 with SP1:  \*\*</span></span>

<span data-ttu-id="5eb7e-153">L’API WinHTTP n’efface pas l’en-tête de cookie de requête une fois [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) terminé.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-153">The WinHTTP API does not clear the request cookie header after [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) completes.</span></span> <span data-ttu-id="5eb7e-154">Les cookies envoyés dans les demandes précédentes seront renvoyés dans les appels suivants à [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span><span class="sxs-lookup"><span data-stu-id="5eb7e-154">Cookies sent in previous requests will be resent in subsequent calls to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span></span> <span data-ttu-id="5eb7e-155">L’application cliente WinHTTP doit effacer les en-têtes de cookies existants avant de renvoyer une demande sur le handle de demande.</span><span class="sxs-lookup"><span data-stu-id="5eb7e-155">The WinHTTP client application should clear existing cookies headers before resending a request on the request handle.</span></span>

 

 



