---
description: Un objet Semaphore est un objet de synchronisation qui gère un nombre compris entre zéro et une valeur maximale spécifiée.
ms.assetid: d9da1d98-a306-4e2d-a149-1eef6a724751
title: Objets Semaphore
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a77f36313d76c5d98c786a76f10ad8439965f180
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106528328"
---
# <a name="semaphore-objects"></a><span data-ttu-id="4ca2f-103">Objets Semaphore</span><span class="sxs-lookup"><span data-stu-id="4ca2f-103">Semaphore Objects</span></span>

<span data-ttu-id="4ca2f-104">Un *objet Semaphore* est un objet de synchronisation qui gère un nombre compris entre zéro et une valeur maximale spécifiée.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-104">A *semaphore object* is a synchronization object that maintains a count between zero and a specified maximum value.</span></span> <span data-ttu-id="4ca2f-105">Le nombre est décrémenté chaque fois qu’un thread termine une attente pour l’objet Semaphore et est incrémenté chaque fois qu’un thread libère le sémaphore.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-105">The count is decremented each time a thread completes a wait for the semaphore object and incremented each time a thread releases the semaphore.</span></span> <span data-ttu-id="4ca2f-106">Lorsque le nombre atteint zéro, aucun thread supplémentaire ne peut attendre que l’état de l’objet sémaphore soit signalé.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-106">When the count reaches zero, no more threads can successfully wait for the semaphore object state to become signaled.</span></span> <span data-ttu-id="4ca2f-107">L’état d’un sémaphore est défini sur « signalé » quand son nombre est supérieur à zéro et sur « non signalé » quand son nombre est égal à zéro.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-107">The state of a semaphore is set to signaled when its count is greater than zero, and nonsignaled when its count is zero.</span></span>

<span data-ttu-id="4ca2f-108">L’objet Semaphore est utile pour contrôler une ressource partagée pouvant prendre en charge un nombre limité d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-108">The semaphore object is useful in controlling a shared resource that can support a limited number of users.</span></span> <span data-ttu-id="4ca2f-109">Il agit comme une porte qui limite le nombre de threads qui partagent la ressource à un nombre maximal spécifié.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-109">It acts as a gate that limits the number of threads sharing the resource to a specified maximum number.</span></span> <span data-ttu-id="4ca2f-110">Par exemple, une application peut limiter le nombre de fenêtres qu’elle crée.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-110">For example, an application might place a limit on the number of windows that it creates.</span></span> <span data-ttu-id="4ca2f-111">Elle utilise un sémaphore avec un nombre maximal égal à la limite de la fenêtre, en décrémentant le nombre chaque fois qu’une fenêtre est créée et en l’incrémentant à chaque fois qu’une fenêtre est fermée.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-111">It uses a semaphore with a maximum count equal to the window limit, decrementing the count whenever a window is created and incrementing it whenever a window is closed.</span></span> <span data-ttu-id="4ca2f-112">L’application spécifie l’objet Semaphore dans l’appel à l’une des [fonctions Wait](wait-functions.md) avant la création de chaque fenêtre.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-112">The application specifies the semaphore object in call to one of the [wait functions](wait-functions.md) before each window is created.</span></span> <span data-ttu-id="4ca2f-113">Lorsque le nombre est égal à zéro, ce qui indique que la limite de la fenêtre a été atteinte : la fonction Wait bloque l’exécution du code de création de fenêtre.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-113">When the count is zero—indicating that the window limit has been reached—the wait function blocks execution of the window-creation code.</span></span>

<span data-ttu-id="4ca2f-114">Un thread utilise la fonction [**CreateSemaphore,**](/windows/desktop/api/WinBase/nf-winbase-createsemaphorea) ou [**CreateSemaphoreEx**](/windows/desktop/api/WinBase/nf-winbase-createsemaphoreexa) pour créer un objet Semaphore.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-114">A thread uses the [**CreateSemaphore**](/windows/desktop/api/WinBase/nf-winbase-createsemaphorea) or [**CreateSemaphoreEx**](/windows/desktop/api/WinBase/nf-winbase-createsemaphoreexa) function to create a semaphore object.</span></span> <span data-ttu-id="4ca2f-115">Le thread de création spécifie le nombre initial et la valeur maximale du nombre pour l’objet.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-115">The creating thread specifies the initial count and the maximum value of the count for the object.</span></span> <span data-ttu-id="4ca2f-116">Le nombre initial ne doit pas être inférieur à zéro ni supérieur à la valeur maximale.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-116">The initial count must be neither less than zero nor greater than the maximum value.</span></span> <span data-ttu-id="4ca2f-117">Le thread de création peut également spécifier un nom pour l’objet Semaphore.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-117">The creating thread can also specify a name for the semaphore object.</span></span> <span data-ttu-id="4ca2f-118">Les threads d’autres processus peuvent ouvrir un handle vers un objet sémaphore existant en spécifiant son nom dans un appel à la fonction [**OpenSemaphore**](/windows/win32/api/synchapi/nf-synchapi-opensemaphorew) .</span><span class="sxs-lookup"><span data-stu-id="4ca2f-118">Threads in other processes can open a handle to an existing semaphore object by specifying its name in a call to the [**OpenSemaphore**](/windows/win32/api/synchapi/nf-synchapi-opensemaphorew) function.</span></span> <span data-ttu-id="4ca2f-119">Pour plus d’informations sur les noms des objets mutex, Event, Semaphore et Timer, consultez [synchronisation entre processus](interprocess-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="4ca2f-119">For additional information about names for mutex, event, semaphore, and timer objects, see [Interprocess Synchronization](interprocess-synchronization.md).</span></span>

<span data-ttu-id="4ca2f-120">Si plusieurs threads sont en attente sur un sémaphore, un thread en attente est sélectionné.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-120">If more than one thread is waiting on a semaphore, a waiting thread is selected.</span></span> <span data-ttu-id="4ca2f-121">Ne supposez pas un ordre FIFO (premier entré, premier sorti).</span><span class="sxs-lookup"><span data-stu-id="4ca2f-121">Do not assume a first-in, first-out (FIFO) order.</span></span> <span data-ttu-id="4ca2f-122">Les événements externes tels que les APC en mode noyau peuvent modifier l’ordre d’attente.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-122">External events such as kernel-mode APCs can change the wait order.</span></span>

<span data-ttu-id="4ca2f-123">Chaque fois que l’une des [fonctions Wait](wait-functions.md) est retournée parce que l’état d’un sémaphore a été signalé, le nombre du sémaphore est réduit d’une unité.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-123">Each time one of the [wait functions](wait-functions.md) returns because the state of a semaphore was set to signaled, the count of the semaphore is decreased by one.</span></span> <span data-ttu-id="4ca2f-124">La fonction [**ReleaseSemaphore,**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) augmente le nombre d’un sémaphore d’une quantité spécifiée.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-124">The [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) function increases a semaphore's count by a specified amount.</span></span> <span data-ttu-id="4ca2f-125">Le nombre ne peut jamais être inférieur à zéro ou supérieur à la valeur maximale.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-125">The count can never be less than zero or greater than the maximum value.</span></span>

<span data-ttu-id="4ca2f-126">Le nombre initial d’un sémaphore est généralement défini sur la valeur maximale.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-126">The initial count of a semaphore is typically set to the maximum value.</span></span> <span data-ttu-id="4ca2f-127">Le décompte est ensuite décrémenté à partir de ce niveau, car la ressource protégée est consommée.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-127">The count is then decremented from that level as the protected resource is consumed.</span></span> <span data-ttu-id="4ca2f-128">Vous pouvez également créer un sémaphore avec un nombre initial de zéro pour bloquer l’accès à la ressource protégée pendant l’initialisation de l’application.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-128">Alternatively, you can create a semaphore with an initial count of zero to block access to the protected resource while the application is being initialized.</span></span> <span data-ttu-id="4ca2f-129">Après l’initialisation, vous pouvez utiliser [**ReleaseSemaphore,**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) pour incrémenter le nombre à la valeur maximale.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-129">After initialization, you can use [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) to increment the count to the maximum value.</span></span>

<span data-ttu-id="4ca2f-130">Un thread qui possède un objet mutex peut attendre de façon répétée que le même objet mutex soit signalé sans que son exécution ne soit bloquée.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-130">A thread that owns a mutex object can wait repeatedly for the same mutex object to become signaled without its execution becoming blocked.</span></span> <span data-ttu-id="4ca2f-131">Toutefois, un thread qui attend plusieurs fois le même objet Semaphore décrémente le nombre du sémaphore chaque fois qu’une opération d’attente est terminée ; le thread est bloqué lorsque le nombre est égal à zéro.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-131">A thread that waits repeatedly for the same semaphore object, however, decrements the semaphore's count each time a wait operation is completed; the thread is blocked when the count gets to zero.</span></span> <span data-ttu-id="4ca2f-132">De même, seul le thread qui possède un mutex peut appeler la fonction [**ReleaseMutex**](/windows/win32/api/synchapi/nf-synchapi-releasemutex) , même si tout thread peut utiliser [**ReleaseSemaphore,**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) pour augmenter le nombre d’un objet Semaphore.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-132">Similarly, only the thread that owns a mutex can successfully call the [**ReleaseMutex**](/windows/win32/api/synchapi/nf-synchapi-releasemutex) function, though any thread can use [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) to increase the count of a semaphore object.</span></span>

<span data-ttu-id="4ca2f-133">Un thread peut décrémenter plusieurs fois le nombre d’un sémaphore en spécifiant de manière répétée le même objet Semaphore dans les appels à l’une des [fonctions Wait](wait-functions.md).</span><span class="sxs-lookup"><span data-stu-id="4ca2f-133">A thread can decrement a semaphore's count more than once by repeatedly specifying the same semaphore object in calls to any of the [wait functions](wait-functions.md).</span></span> <span data-ttu-id="4ca2f-134">Toutefois, l’appel de l’une des fonctions d’attente à plusieurs objets avec un tableau qui contient plusieurs handles du même sémaphore n’entraîne pas de décrémentations multiples.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-134">However, calling one of the multiple-object wait functions with an array that contains multiple handles of the same semaphore does not result in multiple decrements.</span></span>

<span data-ttu-id="4ca2f-135">Lorsque vous avez fini d’utiliser l’objet Semaphore, appelez la fonction [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) pour fermer le descripteur.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-135">When you have finished using the semaphore object, call the [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) function to close the handle.</span></span> <span data-ttu-id="4ca2f-136">L’objet Semaphore est détruit quand son dernier descripteur a été fermé.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-136">The semaphore object is destroyed when its last handle has been closed.</span></span> <span data-ttu-id="4ca2f-137">La fermeture du handle n’affecte pas le nombre de sémaphores ; par conséquent, veillez à appeler [**ReleaseSemaphore,**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) avant de fermer le handle ou avant que le processus ne se termine.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-137">Closing the handle does not affect the semaphore count; therefore, be sure to call [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) before closing the handle or before the process terminates.</span></span> <span data-ttu-id="4ca2f-138">Sinon, les opérations d’attente en attente expirent ou se poursuivent indéfiniment, selon qu’une valeur de délai d’attente a été spécifiée ou non.</span><span class="sxs-lookup"><span data-stu-id="4ca2f-138">Otherwise, pending wait operations will either time out or continue indefinitely, depending on whether a time-out value has been specified.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4ca2f-139">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="4ca2f-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4ca2f-140">Utilisation d’objets Semaphore</span><span class="sxs-lookup"><span data-stu-id="4ca2f-140">Using Semaphore Objects</span></span>](using-semaphore-objects.md)
</dt> </dl>

 

 
