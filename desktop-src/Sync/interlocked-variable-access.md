---
description: Les applications doivent synchroniser l’accès aux variables partagées par plusieurs threads.
ms.assetid: 729c0e68-ef52-4d6c-b771-a89043a937e6
title: Accès aux variables verrouillées
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ca2e083d3e3420e870ad9781b0d262df3d0786f1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106518798"
---
# <a name="interlocked-variable-access"></a><span data-ttu-id="fae0e-103">Accès aux variables verrouillées</span><span class="sxs-lookup"><span data-stu-id="fae0e-103">Interlocked Variable Access</span></span>

<span data-ttu-id="fae0e-104">Les applications doivent synchroniser l’accès aux variables partagées par plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="fae0e-104">Applications must synchronize access to variables that are shared by multiple threads.</span></span> <span data-ttu-id="fae0e-105">Les applications doivent également s’assurer que les opérations sur ces variables sont effectuées de manière atomique (effectuées dans leur intégralité ou pas du tout.)</span><span class="sxs-lookup"><span data-stu-id="fae0e-105">Applications must also ensure that operations on these variables are performed atomically (performed in their entirety or not at all.)</span></span>

<span data-ttu-id="fae0e-106">Les lectures et écritures simples dans des variables 32 bits correctement alignées sont des opérations atomiques.</span><span class="sxs-lookup"><span data-stu-id="fae0e-106">Simple reads and writes to properly-aligned 32-bit variables are atomic operations.</span></span> <span data-ttu-id="fae0e-107">En d’autres termes, vous ne vous retrouvez pas avec une seule partie de la variable mise à jour. tous les bits sont mis à jour de manière atomique.</span><span class="sxs-lookup"><span data-stu-id="fae0e-107">In other words, you will not end up with only one portion of the variable updated; all bits are updated in an atomic fashion.</span></span> <span data-ttu-id="fae0e-108">Toutefois, la synchronisation de l’accès n’est pas garantie.</span><span class="sxs-lookup"><span data-stu-id="fae0e-108">However, access is not guaranteed to be synchronized.</span></span> <span data-ttu-id="fae0e-109">Si deux threads lisent et écrivent à partir de la même variable, vous ne pouvez pas déterminer si un thread effectuera son opération de lecture avant que l’autre n’exécute son opération d’écriture.</span><span class="sxs-lookup"><span data-stu-id="fae0e-109">If two threads are reading and writing from the same variable, you cannot determine if one thread will perform its read operation before the other performs its write operation.</span></span>

<span data-ttu-id="fae0e-110">Les lectures et écritures simples pour aligner correctement les variables 64 bits sont atomiques sur Windows 64 bits.</span><span class="sxs-lookup"><span data-stu-id="fae0e-110">Simple reads and writes to properly aligned 64-bit variables are atomic on 64-bit Windows.</span></span> <span data-ttu-id="fae0e-111">Il n’est pas garanti que les lectures et écritures dans les valeurs 64 bits soient atomiques sur les fenêtres 32 bits.</span><span class="sxs-lookup"><span data-stu-id="fae0e-111">Reads and writes to 64-bit values are not guaranteed to be atomic on 32-bit Windows.</span></span> <span data-ttu-id="fae0e-112">Il n’est pas garanti que les lectures et écritures dans les variables d’autres tailles soient atomiques sur les plateformes.</span><span class="sxs-lookup"><span data-stu-id="fae0e-112">Reads and writes to variables of other sizes are not guaranteed to be atomic on any platform.</span></span>

## <a name="the-interlocked-api"></a><span data-ttu-id="fae0e-113">API verrouillée</span><span class="sxs-lookup"><span data-stu-id="fae0e-113">The Interlocked API</span></span>

<span data-ttu-id="fae0e-114">Les fonctions verrouillées fournissent un mécanisme simple pour synchroniser l’accès à une variable partagée par plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="fae0e-114">The interlocked functions provide a simple mechanism for synchronizing access to a variable that is shared by multiple threads.</span></span> <span data-ttu-id="fae0e-115">Elles effectuent également des opérations sur les variables de manière atomique.</span><span class="sxs-lookup"><span data-stu-id="fae0e-115">They also perform operations on variables in an atomic manner.</span></span> <span data-ttu-id="fae0e-116">Les threads de processus différents peuvent utiliser ces fonctions si la variable est dans la mémoire partagée.</span><span class="sxs-lookup"><span data-stu-id="fae0e-116">The threads of different processes can use these functions if the variable is in shared memory.</span></span>

<span data-ttu-id="fae0e-117">Les fonctions [**InterlockedIncrement**](/windows/win32/api/winnt/nf-winnt-interlockedincrement) et [**InterlockedDecrement**](/windows/win32/api/winnt/nf-winnt-interlockeddecrement) combinent les étapes impliquées dans l’incrémentation ou la décrémentation d’une variable en une opération atomique.</span><span class="sxs-lookup"><span data-stu-id="fae0e-117">The [**InterlockedIncrement**](/windows/win32/api/winnt/nf-winnt-interlockedincrement) and [**InterlockedDecrement**](/windows/win32/api/winnt/nf-winnt-interlockeddecrement) functions combine the steps involved in incrementing or decrementing a variable into an atomic operation.</span></span> <span data-ttu-id="fae0e-118">Cette fonctionnalité est utile dans un système d’exploitation multitâche, dans lequel le système peut interrompre l’exécution d’un thread pour accorder une tranche de temps processeur à un autre thread.</span><span class="sxs-lookup"><span data-stu-id="fae0e-118">This feature is useful in a multitasking operating system, in which the system can interrupt one thread's execution to grant a slice of processor time to another thread.</span></span> <span data-ttu-id="fae0e-119">Sans cette synchronisation, deux threads peuvent lire la même valeur, l’incrémenter de 1 et stocker la nouvelle valeur pour une augmentation totale de 1 au lieu de 2.</span><span class="sxs-lookup"><span data-stu-id="fae0e-119">Without such synchronization, two threads could read the same value, increment it by 1, and store the new value for a total increase of 1 instead of 2.</span></span> <span data-ttu-id="fae0e-120">Les fonctions d’accès variable interbloquées se protègent contre ce type d’erreur.</span><span class="sxs-lookup"><span data-stu-id="fae0e-120">The interlocked variable-access functions protect against this kind of error.</span></span>

<span data-ttu-id="fae0e-121">Les fonctions [**interlockedexchang**](/windows/win32/api/winnt/nf-winnt-interlockedexchange) et [**InterlockedExchangePointer**](/windows/win32/api/winnt/nf-winnt-interlockedexchangepointer) échangent atomiquement les valeurs des variables spécifiées.</span><span class="sxs-lookup"><span data-stu-id="fae0e-121">The [**InterlockedExchange**](/windows/win32/api/winnt/nf-winnt-interlockedexchange) and [**InterlockedExchangePointer**](/windows/win32/api/winnt/nf-winnt-interlockedexchangepointer) functions atomically exchange the values of the specified variables.</span></span> <span data-ttu-id="fae0e-122">La fonction [**InterlockedExchangeAdd**](/windows/win32/api/winnt/nf-winnt-interlockedexchangeadd) combine deux opérations : l’ajout de deux variables et le stockage du résultat dans l’une des variables.</span><span class="sxs-lookup"><span data-stu-id="fae0e-122">The [**InterlockedExchangeAdd**](/windows/win32/api/winnt/nf-winnt-interlockedexchangeadd) function combines two operations: adding two variables together and storing the result in one of the variables.</span></span>

<span data-ttu-id="fae0e-123">Les fonctions [**InterlockedCompareExchange**](/windows/win32/api/winnt/nf-winnt-interlockedcompareexchange), [**InterlockedCompare64Exchange128**](/previous-versions/windows/desktop/legacy/ms683553(v=vs.85))et [**InterlockedCompareExchangePointer**](/windows/win32/api/winnt/nf-winnt-interlockedcompareexchangepointer) combinent deux opérations : la comparaison de deux valeurs et le stockage d’une troisième valeur dans l’une des variables, en fonction du résultat de la comparaison.</span><span class="sxs-lookup"><span data-stu-id="fae0e-123">The [**InterlockedCompareExchange**](/windows/win32/api/winnt/nf-winnt-interlockedcompareexchange), [**InterlockedCompare64Exchange128**](/previous-versions/windows/desktop/legacy/ms683553(v=vs.85)), and [**InterlockedCompareExchangePointer**](/windows/win32/api/winnt/nf-winnt-interlockedcompareexchangepointer) functions combine two operations: comparing two values and storing a third value in one of the variables, based on the outcome of the comparison.</span></span>

<span data-ttu-id="fae0e-124">Les fonctions [**InterlockedAnd**](/windows/win32/api/winnt/nf-winnt-interlockedand), [**interverrouiller**](/windows/win32/api/winnt/nf-winnt-interlockedor)et [**InterlockedXor**](/windows/win32/api/winnt/nf-winnt-interlockedxor) effectuent atomiquement les opérations and, or et Xor, respectivement.</span><span class="sxs-lookup"><span data-stu-id="fae0e-124">The [**InterlockedAnd**](/windows/win32/api/winnt/nf-winnt-interlockedand), [**InterlockedOr**](/windows/win32/api/winnt/nf-winnt-interlockedor), and [**InterlockedXor**](/windows/win32/api/winnt/nf-winnt-interlockedxor) functions atomically perform AND, OR, and XOR operations, respectively.</span></span>

<span data-ttu-id="fae0e-125">Il existe des fonctions spécifiquement conçues pour effectuer un accès variable avec verrouillage sur les valeurs et les valeurs de mémoire 64 bits, et elles sont optimisées pour une utilisation sous Windows 64 bits.</span><span class="sxs-lookup"><span data-stu-id="fae0e-125">There are functions that are specifically designed to perform interlocked variable access on 64-bit memory values and addresses, and are optimized for use on 64-bit Windows.</span></span> <span data-ttu-id="fae0e-126">Chacune de ces fonctions contient « 64 » dans le nom ; par exemple, [**InterlockedDecrement64**](/windows/win32/api/winnt/nf-winnt-interlockeddecrement64) et [**InterlockedCompareExchangeAcquire64**](/previous-versions/windows/desktop/legacy/ms683566(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="fae0e-126">Each of these functions contains "64" in the name; for example, [**InterlockedDecrement64**](/windows/win32/api/winnt/nf-winnt-interlockeddecrement64) and [**InterlockedCompareExchangeAcquire64**](/previous-versions/windows/desktop/legacy/ms683566(v=vs.85)).</span></span>

<span data-ttu-id="fae0e-127">La plupart des fonctions verrouillées fournissent des barrières de mémoire complètes sur toutes les plateformes Windows.</span><span class="sxs-lookup"><span data-stu-id="fae0e-127">Most of the interlocked functions provide full memory barriers on all Windows platforms.</span></span> <span data-ttu-id="fae0e-128">Il existe également des fonctions qui combinent les opérations d’accès aux variables interverrouillées de base avec la sémantique d’acquisition et de libération de l’ordonnancement de mémoire prise en charge par certains processeurs.</span><span class="sxs-lookup"><span data-stu-id="fae0e-128">There are also functions that combine the basic interlocked variable access operations with the acquire and release memory ordering semantics supported by certain processors.</span></span> <span data-ttu-id="fae0e-129">Chacune de ces fonctions contient le mot « Acquire » ou « Release » dans leur nom ; par exemple, [**InterlockedDecrementAcquire**](/previous-versions/windows/desktop/legacy/ms683583(v=vs.85)) et [**InterlockedDecrementRelease**](/previous-versions/windows/desktop/legacy/ms683586(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="fae0e-129">Each of these functions contains the word "Acquire" or "Release" in their names; for example, [**InterlockedDecrementAcquire**](/previous-versions/windows/desktop/legacy/ms683583(v=vs.85)) and [**InterlockedDecrementRelease**](/previous-versions/windows/desktop/legacy/ms683586(v=vs.85)).</span></span> <span data-ttu-id="fae0e-130">Acquérir la sémantique de mémoire spécifiez que l’opération de mémoire qui est effectuée par le thread actuel sera visible avant toute tentative d’opérations de mémoire.</span><span class="sxs-lookup"><span data-stu-id="fae0e-130">Acquire memory semantics specify that the memory operation being performed by the current thread will be visible before any other memory operations are attempted.</span></span> <span data-ttu-id="fae0e-131">La sémantique de libération de mémoire spécifie que l’opération de mémoire qui est effectuée par le thread actuel sera visible une fois toutes les autres opérations de mémoire effectuées.</span><span class="sxs-lookup"><span data-stu-id="fae0e-131">Release memory semantics specify that the memory operation being performed by the current thread will be visible after all other memory operations have been completed.</span></span> <span data-ttu-id="fae0e-132">Ces sémantiques vous permettent de forcer les opérations de mémoire à effectuer dans un ordre spécifique.</span><span class="sxs-lookup"><span data-stu-id="fae0e-132">These semantics allow you to force memory operations to be performed in a specific order.</span></span> <span data-ttu-id="fae0e-133">Utilisez la sémantique Acquire lors de l’entrée d’une région protégée et de la sémantique de libération quand vous la quittez.</span><span class="sxs-lookup"><span data-stu-id="fae0e-133">Use acquire semantics when entering a protected region and release semantics when leaving it.</span></span>

## <a name="related-topics"></a><span data-ttu-id="fae0e-134">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="fae0e-134">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="fae0e-135">Intrinsèques du compilateur</span><span class="sxs-lookup"><span data-stu-id="fae0e-135">Compiler Intrinsics</span></span>](/cpp/intrinsics/compiler-intrinsics?view=vs-2019)
</dt> <dt>

[<span data-ttu-id="fae0e-136">Problèmes de synchronisation et de multiprocesseur</span><span class="sxs-lookup"><span data-stu-id="fae0e-136">Synchronization and Multiprocessor Issues</span></span>](synchronization-and-multiprocessor-issues.md)
</dt> </dl>

 

 
