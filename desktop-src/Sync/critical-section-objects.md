---
description: Un objet de section critique fournit une synchronisation similaire à celle fournie par un objet mutex, à ceci près qu’une section critique ne peut être utilisée que par les threads d’un processus unique.
ms.assetid: 2ec11a42-3d12-4d60-9dd7-dc38926d56e1
title: Objets de section critique
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cbcada1f2ddbc6d370445f36a3dbd51c5c9f54bf
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/08/2021
ms.locfileid: "106536519"
---
# <a name="critical-section-objects"></a><span data-ttu-id="04bc6-103">Objets de section critique</span><span class="sxs-lookup"><span data-stu-id="04bc6-103">Critical Section Objects</span></span>

<span data-ttu-id="04bc6-104">Un *objet de section critique* fournit une synchronisation similaire à celle fournie par un objet mutex, à ceci près qu’une section critique ne peut être utilisée que par les threads d’un processus unique.</span><span class="sxs-lookup"><span data-stu-id="04bc6-104">A *critical section object* provides synchronization similar to that provided by a mutex object, except that a critical section can be used only by the threads of a single process.</span></span> <span data-ttu-id="04bc6-105">Les objets de section critique ne peuvent pas être partagés entre plusieurs processus.</span><span class="sxs-lookup"><span data-stu-id="04bc6-105">Critical section objects cannot be shared across processes.</span></span>

<span data-ttu-id="04bc6-106">Les objets Event, mutex et Semaphore peuvent également être utilisés dans une application à processus unique, mais les objets de section critique offrent un mécanisme plus rapide et plus efficace pour la synchronisation d’exclusion mutuelle (un test spécifique au processeur et une instruction SET).</span><span class="sxs-lookup"><span data-stu-id="04bc6-106">Event, mutex, and semaphore objects can also be used in a single-process application, but critical section objects provide a slightly faster, more efficient mechanism for mutual-exclusion synchronization (a processor-specific test and set instruction).</span></span> <span data-ttu-id="04bc6-107">À l’instar d’un objet mutex, un objet de section critique ne peut appartenir qu’à un seul thread à la fois, ce qui le rend utile pour protéger une ressource partagée de l’accès simultané.</span><span class="sxs-lookup"><span data-stu-id="04bc6-107">Like a mutex object, a critical section object can be owned by only one thread at a time, which makes it useful for protecting a shared resource from simultaneous access.</span></span> <span data-ttu-id="04bc6-108">Contrairement à un objet mutex, il n’existe aucun moyen de savoir si une section critique a été abandonnée.</span><span class="sxs-lookup"><span data-stu-id="04bc6-108">Unlike a mutex object, there is no way to tell whether a critical section has been abandoned.</span></span>

<span data-ttu-id="04bc6-109">À compter de Windows Server 2003 avec Service Pack 1 (SP1), les threads en attente d’une section critique n’acquièrent pas la section critique sur une base « premier arrivé, premier servi ».</span><span class="sxs-lookup"><span data-stu-id="04bc6-109">Starting with Windows Server 2003 with Service Pack 1 (SP1), threads waiting on a critical section do not acquire the critical section on a first-come, first-serve basis.</span></span> <span data-ttu-id="04bc6-110">Cette modification augmente considérablement les performances pour la plupart du code.</span><span class="sxs-lookup"><span data-stu-id="04bc6-110">This change increases performance significantly for most code.</span></span> <span data-ttu-id="04bc6-111">Toutefois, certaines applications dépendent du classement FIFO (premier entré, premier sorti) et peuvent s’exécuter mal ou pas du tout sur les versions actuelles de Windows (par exemple, les applications qui utilisent des sections critiques comme limiteur de débit).</span><span class="sxs-lookup"><span data-stu-id="04bc6-111">However, some applications depend on first-in, first-out (FIFO) ordering and may perform poorly or not at all on current versions of Windows (for example, applications that have been using critical sections as a rate-limiter).</span></span> <span data-ttu-id="04bc6-112">Pour vous assurer que votre code continue à fonctionner correctement, vous devrez peut-être ajouter un niveau de synchronisation supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="04bc6-112">To ensure that your code continues to work correctly, you may need to add an additional level of synchronization.</span></span> <span data-ttu-id="04bc6-113">Par exemple, supposons que vous ayez un thread de producteur et un thread de consommateur qui utilisent un objet de section critique pour synchroniser leur travail.</span><span class="sxs-lookup"><span data-stu-id="04bc6-113">For example, suppose you have a producer thread and a consumer thread that are using a critical section object to synchronize their work.</span></span> <span data-ttu-id="04bc6-114">Créez deux objets d’événement, un pour chaque thread à utiliser pour signaler qu’il est prêt pour que l’autre thread continue.</span><span class="sxs-lookup"><span data-stu-id="04bc6-114">Create two event objects, one for each thread to use to signal that it is ready for the other thread to proceed.</span></span> <span data-ttu-id="04bc6-115">Le thread de consommateur attend que le producteur signale son événement avant d’entrer dans la section critique, et le thread producteur attend que le thread de consommateur signale son événement avant d’entrer dans la section critique.</span><span class="sxs-lookup"><span data-stu-id="04bc6-115">The consumer thread will wait for the producer to signal its event before entering the critical section, and the producer thread will wait for the consumer thread to signal its event before entering the critical section.</span></span> <span data-ttu-id="04bc6-116">Une fois que chaque thread quitte la section critique, il signale son événement pour libérer l’autre thread.</span><span class="sxs-lookup"><span data-stu-id="04bc6-116">After each thread leaves the critical section, it signals its event to release the other thread.</span></span>

<span data-ttu-id="04bc6-117">**Windows Server 2003 et Windows XP :** Les threads qui attendent une section critique sont ajoutés à une file d’attente ; ils sont réveillés et acquièrent généralement la section critique dans l’ordre dans lequel ils ont été ajoutés à la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="04bc6-117">**Windows Server 2003 and Windows XP:** Threads that are waiting on a critical section are added to a wait queue; they are woken and generally acquire the critical section in the order in which they were added to the queue.</span></span> <span data-ttu-id="04bc6-118">Toutefois, si les threads sont ajoutés à cette file d’attente à un rythme suffisamment rapide, les performances peuvent être dégradées en raison du temps nécessaire pour réveiller chaque thread en attente.</span><span class="sxs-lookup"><span data-stu-id="04bc6-118">However, if threads are added to this queue at a fast enough rate, performance can be degraded because of the time it takes to awaken each waiting thread.</span></span>

<span data-ttu-id="04bc6-119">Le processus est chargé d’allouer la mémoire utilisée par une section critique.</span><span class="sxs-lookup"><span data-stu-id="04bc6-119">The process is responsible for allocating the memory used by a critical section.</span></span> <span data-ttu-id="04bc6-120">En règle générale, cette opération est effectuée en déclarant simplement une variable de type **critique \_ section**.</span><span class="sxs-lookup"><span data-stu-id="04bc6-120">Typically, this is done by simply declaring a variable of type **CRITICAL\_SECTION**.</span></span> <span data-ttu-id="04bc6-121">Avant que les threads du processus puissent l’utiliser, initialisez la section critique à l’aide de la fonction [**InitializeCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsection) ou [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) .</span><span class="sxs-lookup"><span data-stu-id="04bc6-121">Before the threads of the process can use it, initialize the critical section by using the [**InitializeCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsection) or [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) function.</span></span>

<span data-ttu-id="04bc6-122">Un thread utilise la fonction [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) ou [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) pour demander la propriété d’une section critique.</span><span class="sxs-lookup"><span data-stu-id="04bc6-122">A thread uses the [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) or [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) function to request ownership of a critical section.</span></span> <span data-ttu-id="04bc6-123">Elle utilise la fonction [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) pour libérer la propriété d’une section critique.</span><span class="sxs-lookup"><span data-stu-id="04bc6-123">It uses the [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) function to release ownership of a critical section.</span></span> <span data-ttu-id="04bc6-124">Si l’objet de section critique est actuellement détenu par un autre thread, **EnterCriticalSection** attend indéfiniment de la propriété.</span><span class="sxs-lookup"><span data-stu-id="04bc6-124">If the critical section object is currently owned by another thread, **EnterCriticalSection** waits indefinitely for ownership.</span></span> <span data-ttu-id="04bc6-125">En revanche, lorsqu’un objet mutex est utilisé pour l’exclusion mutuelle, les [fonctions Wait](wait-functions.md) acceptent un intervalle de délai d’attente spécifié.</span><span class="sxs-lookup"><span data-stu-id="04bc6-125">In contrast, when a mutex object is used for mutual exclusion, the [wait functions](wait-functions.md) accept a specified time-out interval.</span></span> <span data-ttu-id="04bc6-126">La fonction **TryEnterCriticalSection** tente d’entrer dans une section critique sans bloquer le thread appelant.</span><span class="sxs-lookup"><span data-stu-id="04bc6-126">The **TryEnterCriticalSection** function attempts to enter a critical section without blocking the calling thread.</span></span>

<span data-ttu-id="04bc6-127">Quand un thread possède une section critique, il peut effectuer des appels supplémentaires à [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) ou [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) sans bloquer son exécution.</span><span class="sxs-lookup"><span data-stu-id="04bc6-127">When a thread owns a critical section, it can make additional calls to [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) or [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) without blocking its execution.</span></span> <span data-ttu-id="04bc6-128">Cela empêche un thread de se bloquer lorsqu’il attend une section critique qu’il détient déjà.</span><span class="sxs-lookup"><span data-stu-id="04bc6-128">This prevents a thread from deadlocking itself while waiting for a critical section that it already owns.</span></span> <span data-ttu-id="04bc6-129">Pour libérer sa propriété, le thread doit appeler [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) une fois pour chaque fois qu’il a entré la section critique.</span><span class="sxs-lookup"><span data-stu-id="04bc6-129">To release its ownership, the thread must call [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) one time for each time that it entered the critical section.</span></span> <span data-ttu-id="04bc6-130">Il n’existe aucune garantie quant à l’ordre dans lequel les threads en attente acquièrent la propriété de la section critique.</span><span class="sxs-lookup"><span data-stu-id="04bc6-130">There is no guarantee about the order in which waiting threads will acquire ownership of the critical section.</span></span>

<span data-ttu-id="04bc6-131">Un thread utilise la fonction [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) ou [**SetCriticalSectionSpinCount**](/windows/win32/api/synchapi/nf-synchapi-setcriticalsectionspincount) pour spécifier un nombre de spins pour l’objet de section critique.</span><span class="sxs-lookup"><span data-stu-id="04bc6-131">A thread uses the [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) or [**SetCriticalSectionSpinCount**](/windows/win32/api/synchapi/nf-synchapi-setcriticalsectionspincount) function to specify a spin count for the critical section object.</span></span> <span data-ttu-id="04bc6-132">La rotation signifie que lorsqu’un thread essaie d’acquérir une section critique verrouillée, le thread entre dans une boucle, vérifie si le verrou est libéré et, si le verrou n’est pas libéré, le thread passe en mode veille.</span><span class="sxs-lookup"><span data-stu-id="04bc6-132">Spinning means that when a thread tries to acquire a critical section that is locked, the thread enters a loop, checks to see if the lock is released, and if the lock is not released, the thread goes to sleep.</span></span> <span data-ttu-id="04bc6-133">Sur les systèmes à un seul processeur, le nombre de spins est ignoré et le nombre de spins de la section critique est défini sur 0 (zéro).</span><span class="sxs-lookup"><span data-stu-id="04bc6-133">On single-processor systems, the spin count is ignored and the critical section spin count is set to 0 (zero).</span></span> <span data-ttu-id="04bc6-134">Sur les systèmes multiprocesseurs, si la section critique n’est pas disponible, le thread appelant tourne *dwSpinCount* fois avant d’effectuer une opération d’attente sur un sémaphore associé à la section critique.</span><span class="sxs-lookup"><span data-stu-id="04bc6-134">On multiprocessor systems, if the critical section is unavailable, the calling thread spins *dwSpinCount* times before performing a wait operation on a semaphore that is associated with the critical section.</span></span> <span data-ttu-id="04bc6-135">Si la section critique devient libre pendant l’opération de rotation, le thread appelant évite l’opération d’attente.</span><span class="sxs-lookup"><span data-stu-id="04bc6-135">If the critical section becomes free during the spin operation, the calling thread avoids the wait operation.</span></span>

<span data-ttu-id="04bc6-136">Tout thread du processus peut utiliser la fonction [**DeleteCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-deletecriticalsection) pour libérer les ressources système qui sont allouées lorsque l’objet de section critique est initialisé.</span><span class="sxs-lookup"><span data-stu-id="04bc6-136">Any thread of the process can use the [**DeleteCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-deletecriticalsection) function to release the system resources that are allocated when the critical section object is initialized.</span></span> <span data-ttu-id="04bc6-137">Une fois cette fonction appelée, l’objet de section critique ne peut pas être utilisé pour la synchronisation.</span><span class="sxs-lookup"><span data-stu-id="04bc6-137">After this function is called, the critical section object cannot be used for synchronization.</span></span>

<span data-ttu-id="04bc6-138">Lorsqu’un objet de section critique est détenu, les seuls autres threads affectés sont les threads en attente de propriété dans un appel à [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection).</span><span class="sxs-lookup"><span data-stu-id="04bc6-138">When a critical section object is owned, the only other threads affected are the threads that are waiting for ownership in a call to [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection).</span></span> <span data-ttu-id="04bc6-139">Les threads qui ne sont pas en attente sont libres de continuer à s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="04bc6-139">Threads that are not waiting are free to continue running.</span></span>

## <a name="related-topics"></a><span data-ttu-id="04bc6-140">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="04bc6-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="04bc6-141">Objets mutex</span><span class="sxs-lookup"><span data-stu-id="04bc6-141">Mutex Objects</span></span>](mutex-objects.md)
</dt> <dt>

[<span data-ttu-id="04bc6-142">Utilisation d’objets de section critique</span><span class="sxs-lookup"><span data-stu-id="04bc6-142">Using Critical Section Objects</span></span>](using-critical-section-objects.md)
</dt> </dl>

 

 
