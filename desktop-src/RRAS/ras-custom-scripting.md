---
title: Scripts personnalisés RAS
description: Les développeurs peuvent créer une DLL de script personnalisé qui réside sur un ordinateur client RAS. Cette DLL peut communiquer avec le serveur au cours du processus d’établissement d’une connexion.
ms.assetid: c27b8b02-6018-4441-a355-1fb890b9001c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c625f020d9dafcb352c5f1b382014f9dba189330
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103941099"
---
# <a name="ras-custom-scripting"></a><span data-ttu-id="7ddd8-104">Scripts personnalisés RAS</span><span class="sxs-lookup"><span data-stu-id="7ddd8-104">RAS Custom Scripting</span></span>

<span data-ttu-id="7ddd8-105">Les développeurs peuvent créer une DLL de script personnalisé qui réside sur un ordinateur client RAS.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-105">Developers can create a custom-scripting DLL that resides on a RAS client computer.</span></span> <span data-ttu-id="7ddd8-106">Cette DLL peut communiquer avec le serveur au cours du processus d’établissement d’une connexion.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-106">This DLL can communicate with the server during the process of establishing a connection.</span></span>

<span data-ttu-id="7ddd8-107">**Windows NT :** Les scripts personnalisés ne sont pas disponibles.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-107">**Windows NT:** Custom scripting is not available.</span></span>

## <a name="setting-up-the-dll"></a><span data-ttu-id="7ddd8-108">Configuration de la DLL</span><span class="sxs-lookup"><span data-stu-id="7ddd8-108">Setting up the DLL</span></span>

<span data-ttu-id="7ddd8-109">Pour configurer la DLL, créez une valeur portant le nom **CustomScriptDllPath** sous la clé de Registre suivante :</span><span class="sxs-lookup"><span data-stu-id="7ddd8-109">To set up the DLL, create a value with the name **CustomScriptDllPath** under the following registry key:</span></span>

```
HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
         Services
            Rasman
               Parameters
```

<span data-ttu-id="7ddd8-110">Cette valeur doit être de type **reg \_ expand \_ SZ**.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-110">This value should be of type **REG\_EXPAND\_SZ**.</span></span> <span data-ttu-id="7ddd8-111">La valeur doit contenir le chemin d’accès à la DLL de script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-111">The value should contain the path to the custom-scripting DLL.</span></span> <span data-ttu-id="7ddd8-112">Une seule DLL de script personnalisé est prise en charge pour chaque ordinateur client RAS.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-112">Only one custom-scripting DLL is supported for each RAS client computer.</span></span>

## <a name="interaction-between-the-server-ras-and-the-custom-scripting-dll"></a><span data-ttu-id="7ddd8-113">Interaction entre le serveur, RAS et la DLL Custom-Scripting</span><span class="sxs-lookup"><span data-stu-id="7ddd8-113">Interaction Between the Server, RAS, and the Custom-Scripting DLL</span></span>

<span data-ttu-id="7ddd8-114">La DLL de script personnalisé doit exporter un point d’entrée unique : [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn).</span><span class="sxs-lookup"><span data-stu-id="7ddd8-114">The custom scripting DLL should export a single entry point: [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn).</span></span> <span data-ttu-id="7ddd8-115">RAS appelle cette fonction lors de l' \_ État interactif RASCS du processus de connexion.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-115">RAS calls this function during the RASCS\_Interactive state of the connection process.</span></span> <span data-ttu-id="7ddd8-116">L' \_ État interactif RASCS est un état suspendu, qui permet à l’utilisateur d’interagir avec une interface utilisateur présentée par la dll de script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-116">The RASCS\_Interactive state is a paused state, which allows the user to interact with a user interface presented by the custom-scripting DLL.</span></span> <span data-ttu-id="7ddd8-117">Pour plus d’informations sur les États de connexion, consultez [**RASCONNSTATE**](/previous-versions/windows/desktop/legacy/aa376727(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="7ddd8-117">See [**RASCONNSTATE**](/previous-versions/windows/desktop/legacy/aa376727(v=vs.85)) for more information about connection states.</span></span>

<span data-ttu-id="7ddd8-118">RAS passera comme paramètres à la fonction [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) :</span><span class="sxs-lookup"><span data-stu-id="7ddd8-118">RAS will pass as parameters to the [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) function:</span></span>

-   <span data-ttu-id="7ddd8-119">Handle vers le port sur l’ordinateur client utilisé pour la connexion.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-119">A handle to the port on the client computer that is being used for the connection.</span></span>
-   <span data-ttu-id="7ddd8-120">Chaînes qui identifient l’annuaire téléphonique et l’entrée pour la connexion.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-120">Strings that identify the phone book and entry for the connection.</span></span>
-   <span data-ttu-id="7ddd8-121">RAS transmet également un handle à une fenêtre pour permettre à la DLL de présenter une interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-121">RAS also passes in a handle to a window to enable the DLL to present a user interface.</span></span>
-   <span data-ttu-id="7ddd8-122">Ensemble de pointeurs de fonction que la DLL peut utiliser pour communiquer avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-122">A set of function pointers that the DLL can use to communicate with the server.</span></span>

<span data-ttu-id="7ddd8-123">Pour plus d’informations sur ces paramètres, consultez [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) .</span><span class="sxs-lookup"><span data-stu-id="7ddd8-123">See [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) for more information about these parameters.</span></span>

<span data-ttu-id="7ddd8-124">RAS passe un pointeur vers une structure [**RASCUSTOMSCRIPTEXTENSIONS**](/previous-versions/windows/desktop/legacy/aa376738(v=vs.85)) comme dernier paramètre à [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn).</span><span class="sxs-lookup"><span data-stu-id="7ddd8-124">RAS passes a pointer to a [**RASCUSTOMSCRIPTEXTENSIONS**](/previous-versions/windows/desktop/legacy/aa376738(v=vs.85)) structure as the last parameter to [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn).</span></span> <span data-ttu-id="7ddd8-125">Cette structure contient un pointeur vers une fonction de type [**PFNRASSETCOMMSETTINGS**](/windows/desktop/api/Ras/nc-ras-pfnrassetcommsettings).</span><span class="sxs-lookup"><span data-stu-id="7ddd8-125">This structure contains a pointer to a function of type [**PFNRASSETCOMMSETTINGS**](/windows/desktop/api/Ras/nc-ras-pfnrassetcommsettings).</span></span> <span data-ttu-id="7ddd8-126">La DLL de script personnalisé appelle cette fonction pour modifier les paramètres de communication sur le port utilisé par la connexion.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-126">The custom-scripting DLL calls this function to modify the communication settings on the port being used by the connection.</span></span>

<span data-ttu-id="7ddd8-127">RAS sert d’intermédiaire pour l’interaction entre le serveur et la DLL de script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-127">RAS mediates the interaction between the server and the custom-scripting DLL.</span></span> <span data-ttu-id="7ddd8-128">En règle générale, le serveur lance la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-128">Typically, the server initiates the dialog.</span></span> <span data-ttu-id="7ddd8-129">Par exemple, le serveur peut demander le nom d’utilisateur et le mot de passe de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-129">For example, the server may request the user name and password of the user.</span></span>

<span data-ttu-id="7ddd8-130">Lorsque vous utilisez des scripts personnalisés pour établir une connexion, le serveur n’a pas besoin d’exécuter Windows NT 4,0 ou Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-130">When using custom-scripting to establish a connection, the server need not be running Windows NT 4.0 or Windows 2000.</span></span>

## <a name="custom-scripting-user-interface-must-support-idcancel"></a><span data-ttu-id="7ddd8-131">L’interface utilisateur de script personnalisé doit prendre en charge IDCANCEL</span><span class="sxs-lookup"><span data-stu-id="7ddd8-131">Custom Scripting User Interface Must Support IDCANCEL</span></span>

<span data-ttu-id="7ddd8-132">Si le numéroteur personnalisé affiche une interface utilisateur, l’interface utilisateur doit prendre en charge les \_ messages de commande WM où LOWORD (*wParam*) est égal à IDCANCEL.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-132">If the custom dialer displays a user interface, the user interface must support WM\_COMMAND messages where LOWORD(*wParam*) equals IDCANCEL.</span></span>

## <a name="configuring-the-connection"></a><span data-ttu-id="7ddd8-133">Configuration de la connexion</span><span class="sxs-lookup"><span data-stu-id="7ddd8-133">Configuring the Connection</span></span>

<span data-ttu-id="7ddd8-134">Le point d’entrée [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) peut être appelé à partir de [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga) ou, sur Windows XP, à partir de [**rasdial**](/windows/desktop/api/Ras/nf-ras-rasdiala).</span><span class="sxs-lookup"><span data-stu-id="7ddd8-134">The [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) entry point can be invoked from [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga) or, on Windows XP, from [**RasDial**](/windows/desktop/api/Ras/nf-ras-rasdiala).</span></span>

<span data-ttu-id="7ddd8-135">Pour appeler [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) à partir de [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga), définissez l' \_ option RASEO CustomScript dans l’entrée de l’annuaire téléphonique pour la connexion.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-135">To invoke [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) from [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga), set the RASEO\_CustomScript option in the phone-book entry for the connection.</span></span> <span data-ttu-id="7ddd8-136">Consultez le membre **dwfOptions** de [**RASENTRY**](/previous-versions/windows/desktop/legacy/aa377274(v=vs.85)) pour obtenir une description des options d’entrée de l’annuaire téléphonique.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-136">See the **dwfOptions** member of [**RASENTRY**](/previous-versions/windows/desktop/legacy/aa377274(v=vs.85)) for a description of phone-book entry options.</span></span> <span data-ttu-id="7ddd8-137">Utilisez les fonctions [**RasGetEntryProperties**](/windows/desktop/api/Ras/nf-ras-rasgetentrypropertiesa) et [**RasSetEntryProperties**](/windows/desktop/api/Ras/nf-ras-rassetentrypropertiesa) pour définir cette option par programmation.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-137">Use the [**RasGetEntryProperties**](/windows/desktop/api/Ras/nf-ras-rasgetentrypropertiesa) and [**RasSetEntryProperties**](/windows/desktop/api/Ras/nf-ras-rassetentrypropertiesa) functions to set this option programmatically.</span></span>

<span data-ttu-id="7ddd8-138">**Windows XP :** Pour appeler [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) à partir de [**rasdial**](/windows/desktop/api/Ras/nf-ras-rasdiala), l’appel à **rasdial** doit spécifier une structure [**RASDIALEXTENSIONS**](/previous-versions/windows/desktop/legacy/aa377029(v=vs.85)) , et cette structure doit spécifier l' \_ indicateur UseCustomScripting RDEOPT.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-138">**Windows XP:** To invoke [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) from [**RasDial**](/windows/desktop/api/Ras/nf-ras-rasdiala), the call to **RasDial** must specify a [**RASDIALEXTENSIONS**](/previous-versions/windows/desktop/legacy/aa377029(v=vs.85)) structure, and this structure must specify the RDEOPT\_UseCustomScripting flag.</span></span> <span data-ttu-id="7ddd8-139">En outre, l’entrée de l’annuaire téléphonique pour la connexion doit spécifier l' \_ option RASEO CustomScript comme décrit dans le paragraphe précédent.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-139">In addition, the phone-book entry for the connection must specify the RASEO\_CustomScript option as described in the preceding paragraph.</span></span>

## <a name="invoking-the-custom-scripting-dll"></a><span data-ttu-id="7ddd8-140">Appel de la DLL de script personnalisé</span><span class="sxs-lookup"><span data-stu-id="7ddd8-140">Invoking the Custom Scripting DLL</span></span>

<span data-ttu-id="7ddd8-141">Si l’utilisateur active une connexion pour une entrée de l’annuaire téléphonique pour laquelle RASEO \_ CustomScript est défini, Ras appelle la dll de script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-141">If the user activates a connection for a phone-book entry that has RASEO\_CustomScript set, RAS invokes the custom-scripting DLL.</span></span> <span data-ttu-id="7ddd8-142">Dans ce scénario, RAS appelle la DLL de script personnalisé à partir de [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga).</span><span class="sxs-lookup"><span data-stu-id="7ddd8-142">In this scenario, RAS invokes the custom-scripting DLL from [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga).</span></span>

<span data-ttu-id="7ddd8-143">Pour appeler la DLL de script personnalisé par programmation, établissez la connexion à l’aide de la fonction [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga) .</span><span class="sxs-lookup"><span data-stu-id="7ddd8-143">To invoke the custom-scripting DLL programmatically, establish the connection using the [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga) function.</span></span> <span data-ttu-id="7ddd8-144">Sur Windows XP, la fonction [**rasdial**](/windows/desktop/api/Ras/nf-ras-rasdiala) appelle également la dll de script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="7ddd8-144">On Windows XP, the [**RasDial**](/windows/desktop/api/Ras/nf-ras-rasdiala) function also invokes the custom-scripting DLL.</span></span>

 

 